{
  "article_text": [
    "counterparty credit risk has recently moved to the forefront of attention of the financial industry and government regulatory agencies . prior to 2007 ,",
    "financial institutions used to make provisions for possible counterparty defaults based on _ ad hoc _ assumptions and proprietary metrics . as a result of the financial crisis of 2007 - 2008 and",
    "the subsequent stricter regulatory requirements , careful analysis and more rigorous modeling methodologies of counterparty credit risk have become a centerpiece of prudent risk management practice . in particular , these developments led to the establishment of special business units within financial institutions whose sole purpose is to monitor and mitigate counterparty credit risk .",
    "summaries of various approaches to counterparty credit risk modeling can be found in @xcite , @xcite , @xcite .    in a counterparty credit risk model ,",
    "one considers two parties , namely a dealer ( `` a bank '' ) and a client ( `` a counterparty '' ) such as an asset manager , hedge fund or corporate , which have a portfolio of over the counter ( otc ) transactions between them . over the time horizon of the transactions , a default of either the bank or",
    "the counterparty may occur .",
    "the objective of the model is to put a dollar value on this default risk and develop strategies to mitigate it .",
    "the portfolio of transactions is typically structured as a collection of netting sets . from the risk management perspective",
    ", the cash flows within the same netting set are allowed to partially offset each other .",
    "generally , counterparty credit risk is managed through maintaining appropriate reserves of cash and high quality financial assets . in the case of credit support annex ( csa )",
    "@xcite transactions , the two parties exchange and manage collateral .",
    "additionally , a fully fledged counterparty credit risk model takes into account the impact of margining and funding costs .    in this paper , we are concerned with a general approach to counterparty credit risk modeling .",
    "a natural modeling framework for counterparty credit risk , which we adopt in our discussion , is provided by backward stochastic differential equations ( bsdes ) . in particular",
    ", this approach allows for an efficient and fully consistent description of counterparty default valuation along with its hedging strategy , and can be easily implemented numerically .",
    "bsdes , in the context of finance , have been studied in the literature since the 1990 s , see @xcite , and have recently been applied to counterparty credit risk modeling , see e.g @xcite , @xcite .",
    "our approach extends the partial differential equations ( pde ) framework developed earlier by burgard and kjaer @xcite , see also @xcite , @xcite , @xcite .",
    "their methodology is based on a dynamic replication strategy involving the underlying assets as well as both parties credit sensitive zero coupon bonds , and it culminates in the fundamental pde for the counterparty credit sensitive value of an instrument .",
    "they also provide closed form solutions to the fundamental pde in a number of relevant cases . here , we extend their approach to a more general multivariate diffusion setting including stochastic interest rates and default intensities .    following a similar strategy",
    ", we formulate the counterparty credit risk model in purely probabilistic terms .",
    "the dynamic replication approach leads to a jump diffusion bsde with a random time horizon .",
    "the reason why a jump may occur in the bsde is that the possible default of either the counterparty or the bank itself ( and associated changes in the value of the portfolio ) can occur at a random time .",
    "equations of this type are usually very challenging to solve numerically @xcite .",
    "motivated by the method developed in @xcite , we reduce our fundamental jump diffusion bsde to a continuous bsde with a fixed terminal time .    in case of a counterparty or bank default , their assets are liquidated and the claims of their creditors are settled .",
    "different close out conventions are used to determine the value of the portfolio of transactions between the two parties at default . here , we discuss in detail two explicit close out conventions .",
    "the solutions to the corresponding fundamental bsdes are interpreted in terms of the commonly used valuation adjustments ( the `` xvas '' ) . in one of the cases , a closed form representation of the solution is available , while in the other one",
    ", we derive an accurate approximation to the solution .",
    "an important practical aspect is the computational feasibility of the solution to the fundamental bsde . in practice ,",
    "the portfolio of transactions between the dealer and the counterparty may consist of hundreds ( or thousands ) of different positions .",
    "naive modeling of such a portfolio leads to a high dimensional stochastic system .",
    "we discuss an approximation method that allows us to reduce the full model to model driven by a moderate number of risk factors .",
    "we then prove that reduced factor bsde indeed approximates the fundamental bsde .",
    "moreover , we briefly discuss the question of choosing an appropriate pricing measure .    for continuous diffusion bsdes ,",
    "efficient numerical schemes have been developed , see e.g. @xcite .",
    "we apply a scheme to numerically solve the reduced fundamental bsde which requires an efficient methodology to calculate conditional expected values . to this end",
    ", we use a variant of the longstaff - schwartz @xcite regression technique that is adapted to our setting . specifically , we propose the use of hermite polynomials as basis functions .",
    "hermite polynomials have various advantages , for example they exhibit an addition formula and a martingale property , which provide practical means for calculating conditional expectations .",
    "additionally , using the hermite architecture allows us to represent a part of the solution of the bsde in terms of explicit expressions .",
    "we continue the study of the numerical aspects of the problem in @xcite .    the paper is organized as follows .",
    "we present our model setup and develop the fundamental equations describing the value of a portfolio with and without counterparty credit risk in section [ bsdesec ] . the special case of deterministic interest rates and dividends , leading to a burgard - kjaer type of pde ,",
    "is covered in section [ sec : bkpde ] . in section [ sec : valueadj ] , we discuss the total value adjustments for the two most common close out values .",
    "we then turn our attention to practical issues such as the choice of pricing measure and risk factor reduction in section [ sec : pricingmeasurefactorreduction ] .",
    "finally , we propose a numerical algorithm to solving the fundamental bsde using monte carlo methods in section [ numsec ] .",
    "the key technical results are proved in the appendix .",
    "in this section we present a mathematical formulation of the problem of modeling counterparty credit risk between two counterparties : @xmath0 ( a `` bank '' ) and @xmath1 ( a `` client '' ) .",
    "the equations written below assume the perspective of the bank @xmath0 .",
    "we study contracts on an asset @xmath2 between the bank and its counterparty @xmath1 , both of which may default . in our setting neither of the two possible defaults",
    "have an effect on the asset @xmath2 .    with this situation in mind",
    ", we consider a probability space @xmath3 and let the market filtration @xmath4 be generated by an @xmath5-dimensional brownian motion @xmath6 and augmented by all @xmath7-null sets .",
    "the information on default events is represented by the filtration @xmath8 to be specified later .",
    "we define the enlarged filtration @xmath9 by @xmath10 , for all @xmath11 .",
    "then @xmath12 is a filtered probability space satisfying the usual conditions .",
    "see for example ( * ? ? ?",
    "* vi.3 ) for the properties of progressive enlargements of filtrations .",
    "let @xmath13 denote the price process , namely an @xmath5-dimensional markov process with infinitesimal generator @xmath14 .",
    "the dynamics of the asset under the measure @xmath15 are @xmath16 here , @xmath17 and @xmath18 are deterministic functions and @xmath6 is a standard @xmath5-dimensional brownian motion .",
    "we assume the usual conditions for @xmath19 and @xmath20 to guarantee the existence and uniqueness of the strong solution to this sde .",
    "additionally , @xmath21 is an @xmath5-dimensional real vector .",
    "we consider a netting set @xmath22 consisting of @xmath5 instruments which may comprise of derivatives and cash type with underlying asset @xmath2 . from the counterparty risk management perspective",
    ", transactions with a fixed counterparty are allowed to be offset against each other within a netting set .",
    "the composition of netting sets is set forth by bilateral agreements .",
    "we denote the time @xmath23-value of the netting set by @xmath24 .",
    "additionally , we consider the riskless ( default - risk - free ) bank account @xmath25 .",
    "its dynamics is given by @xmath26 where @xmath27 is a stochastic credit riskless interest rate . in the following ,",
    "we assume that @xmath27 as well as all other rates and dividends are adapted with respect to the market filtration @xmath28 . from the financial perspective",
    ", @xmath27 is the rate paid by a theoretical `` central margin account '' , and can be proxied by the ois rate .    in our model we allow for both , the bank and its counterparty to default .",
    "we let @xmath29 and @xmath30 be the random default times of the bank and the counterparty respectively and denote their indicator processes by counting processes @xmath31 and @xmath32 the natural filtration generated by @xmath33 and @xmath34 constitutes the default event filtration @xmath35 , i.e. @xmath36 . both counting processes @xmath33 , @xmath34 are assumed to be cox processes , i.e. they have stochastic , time - dependent intensities @xmath37 , @xmath38 , i.e. @xmath39,\\ ] ] and @xmath40.\\ ] ]    we denote the bank s and counterparty s default risky , zero - recovery zcbs @xmath41 and @xmath42 with respective maturities @xmath43 and @xmath44 . they follow the dynamics @xmath45 here , the adapted stochastic processes @xmath46 are the yields on @xmath41 and @xmath42 , respectively .",
    "the legal framework for otc derivative trades is provided by the _ isda master agreement _",
    "@xcite which contains a common core and adjustable terms to be agreed on by both parties .",
    "the agreement aims at mitigating ( counterparty ) risk by documenting aspects like netting , collateral cash - flows , default events and the close out process ( see e.g. @xcite ) . in a world , where usually several transactions with a counterparty occur , netting allows the two parties to offset what they owe to one another .",
    "the financial crisis in 2008 fueled the need for derivative pricing methodologies that include aspects of counterparty credit risk .",
    "the goal is to find the value @xmath47 of a netted portfolio of derivatives @xmath22 on @xmath2 allowing for both the bank @xmath0 as well as its counterparty @xmath1 to default .",
    "more precisely , we let @xmath48 denote the time @xmath23 value of the netting set @xmath22 with time horizon @xmath49 , which is assumed to satisfy @xmath50 .",
    "the value of the netting set @xmath22 between the bank and the counterparty without counterparty default risk is denoted by @xmath51 .",
    "the difference between these two values , denoted by @xmath52 , is called the total valuation adjustment , i.e. @xmath53 .    to mitigate counterparty credit risk , the two parties exchange collateral in form of cash or high quality financial instruments .",
    "the mechanics of collateral in otc transactions are specified by the csa which is usually amended to the isda master agreement .",
    "typically , one distinguishes between two kinds of collateral , namely the initial margin and the variation margin .",
    "the former is posted by both counterparties without any netting taking place .",
    "the amount of initial margin is calculated using risk based methods such as var , covar or stress tests .",
    "these calculations involve historical simulations , typically using an observation window of 1 to 5 years , see e.g. @xcite . to ensure that the collateral can be retrieved in a default scenario ,",
    "it is segregated and can not be used to , for example , fund other positions .",
    "in contrast , variation margins , which we denote as @xmath54 , are calculated frequently based on the market value of the transactions , and they can be netted and rehypothecated . we denote the initial margin posted by the bank @xmath0 to the counterparty by @xmath55 , whereas the amount from the counterparty is denoted by @xmath56 .",
    "the margin value adjustment ( mva ) is the bank s cost of posting the initial margin @xmath55 to the counterparty over the time @xmath57 $ ] .",
    "the guidelines for margin requirements are set forth in @xcite .",
    "while the collateral ensures that the defaulting party partially meets its contractual obligations in the event of a default , regulatory capital is designed to help the surviving party manage a potential loss arising from the default .",
    "specific guidelines for calculating the regulatory capital @xmath58 , the amount of reserves the bank must hold , are provided in the _ basel iii _ document which was introduced in 2010 .",
    "the cost of holding this capital over the time @xmath57 $ ] is called capital value adjustment ( kva ) .",
    "another component of the total value adjustment is the funding value adjustment ( fva ) .",
    "essentially , the fva accounts for the costs of funding of uncollateralized ( or partly collateralized ) positions .",
    "there is a debate around how the funding adjustment should be treated in a framework like ours , see @xcite , pp .",
    "349 - 356 , and @xcite , @xcite .    in the following",
    "we first find the default free value @xmath59 of the contract in terms of a conditional expectation .",
    "we present the cash - flow netting at default and the cash flows associated with the portfolio that is set up to replicate the value @xmath47 .",
    "then the fundamental bsde describing the counterparty credit risky value @xmath47 is derived .",
    "note that , from now on , all interest rates are considered adapted stochastic processes unless stated otherwise .",
    "the value @xmath59 of the netting set @xmath60 without credit counterparty risk depends solely on the price process @xmath2 and is derived similarly to the price in the classical black - scholes model .",
    "as usual , we can set up a self - financing portfolio @xmath61 replicating @xmath59 .",
    "however , contrary to the classical pricing theory , the position in @xmath2 is not funded at a single riskless rate @xmath27 , but instead financed by a repurchasing agreement ( repo ) at a repo rate @xmath62 .",
    "the securities are pledged as collateral against cash to purchase the securities . in practice ,",
    "a haircut is applied to the amount of cash received against the collateral , that is the loan size is smaller than the current face value of the pledged securities .",
    "the amount of haircut depends on the quality of the securities . here",
    ", for simplicity , we shall assume a zero haircut ; it is straightforward to adapt our calculations to accommodate for non - zero haircuts .    the replicating portfolio @xmath61 consists of a position in @xmath63 units of @xmath2 , @xmath64 units in a repo cash account @xmath65 , and @xmath66 units of @xmath25 , i.e. we must have @xmath67 for all times @xmath68 $ ] .",
    "note that @xmath63 and @xmath64 are @xmath5-dimensional vectors .",
    "we describe the different cash flows in the following :    _ securities funding : _ we assume the position in the security @xmath2 is exclusively financed by the ( default - risk - free ) repo cash account @xmath65 , which means , we always have @xmath69 this equation stems from the fact that if we enter into a long position in @xmath2 , i.e. @xmath70 , we need to finance this buy by receiving a fully collateralized loan through a repo agreement , i.e. @xmath71 . on the other hand , if we sell @xmath2 , i.e. @xmath72 , we invest the received cash into @xmath65 , i.e. @xmath73 . the cash account @xmath65 accrues at the repo rate @xmath62 and decreases at the dividend yield @xmath74 of the underlying asset @xmath2 , i.e. it evolves according to @xmath75 where @xmath76 is the diagonal matrix whose diagonal is given by the vector @xmath77 .",
    "recall that , according to our assumption , all rates , like @xmath74 and @xmath62 here , are adapted stochastic processes .",
    "_ riskless deposit : _ from equations and , we see that the amount @xmath59 is financed / earns the riskless rate @xmath27 , more precisely we get @xmath78    the self - financing condition then implies that the replicating portfolio @xmath61 has the dynamics @xmath79 which , together with the dynamics for @xmath2 , @xmath65 and @xmath25 , leads to @xmath80 where we have used equations and in the last equality .",
    "if we now set @xmath81 , we can formulate the default free portfolio dynamics in terms of a bsde with terminal value @xmath82 , i.e. @xmath83 the value @xmath59 , namely the first part of the solution @xmath84 of this equation , can be found explicitly , as the driver is linear in @xmath59 and @xmath85 .",
    "more precisely , from appendix [ app : linbsde ] we obtain @xmath86,\\ ] ] where @xmath87 the equation above extends the classic black - scholes model in that it explicitly accounts for position financing cost . in the following",
    "we will regard the process @xmath59 as a known input into the counterparty credit risk model .      over the lifetime of the portfolio of transactions , the bank or the counterparty may default . at the time of default , the counterparty credit risk adjusted value of the portfolio @xmath47 is determined by the terms specified in the isda master agreement and can take several forms . in general the value at default",
    "is impacted by the party that defaults first , the close out value @xmath88 and the collateral @xmath89 and @xmath54 . in the literature , see @xcite for more background information , several different conventions to determine the value at default can be found .    in the following we use the notation @xmath90 , and @xmath91 . ] . in a situation",
    "where the counterparty defaults , the bank is already in possession of the collateral @xmath92 .",
    "now , if the unsecured value @xmath93 is negative , i.e. the bank owes money to the counterparty , the bank has to pay the full outstanding amount @xmath94 .",
    "otherwise the bank is able to recover only a fraction of the outstanding value , more precisely @xmath95 , where @xmath96 $ ] is the recovery rate in case @xmath1 defaults .",
    "we are not concerned here with recovery rate modeling and so , for simplicity , we assume that @xmath97 is deterministic . in reality ,",
    "recovery rates are an unknown random variable , not necessarily measurable with respect to @xmath98 . in summary , we see that the value at default , in case @xmath1 defaults , has the form @xmath99    similarly , if the bank itself defaults , it has the right to proper fulfillment of the contract and hence , in addition to the collateral amount @xmath100 , it receives the outstanding balance @xmath101 . if @xmath102 , the bank pays a fraction of its own obligation , namely @xmath103 , where @xmath104 $ ] is the bank s ( deterministic ) recovery rate .",
    "this means the value at default , at the bank s own default , can be expressed as follows : @xmath105    as a consequence , the portfolio value at default ( at time @xmath106 ) is explicitly given by @xmath107 to consider the credit risky portfolio value @xmath47 prior to default , we set up a replicating portfolio including a cash account , which reflects funding and collateral exchange related cash flows .",
    "classical pricing theory is developed around the assumption that market participants can freely borrow and lend , without the necessity of exchanging collateral , at a single interest rate , namely the riskless interest rate @xmath27 .",
    "here we take a more realistic approach and specify the different funding costs associated with different types of lending .",
    "additionally , we include collateral margining and the banks interest earning / paying on different types of capital .",
    "our goal is to build a self - financing replicating portfolio for the counterparty credit risky portfolio value @xmath47 , which we pursue in the next section .",
    "the replicating portfolio @xmath108 comprises of @xmath63 units of @xmath2 , @xmath109 units of @xmath41 , @xmath110 units of @xmath42 , and @xmath111 units of the vector of cash accounts @xmath112 , where @xmath113 and @xmath111 are stochastic processes .",
    "the vector of cash accounts @xmath112 is composed of several accounts each with their own rate of accumulation which will be discussed in more detail in the following .",
    "more precisely , the account @xmath112 decomposes into @xmath114 cash accounts which we write as vector @xmath115 we assume that each cash account is default - risk - free and has the value 1 at @xmath116 , e.g. @xmath117 .",
    "the corresponding strategy @xmath111 is given as @xmath118 we need the value of @xmath119 at each time @xmath120 to replicate the value @xmath121 , i.e. @xmath122 , or equivalently @xmath123    _ securities funding : _ as explained in section [ sec : valuev ] , taking a position in the underlying @xmath2 requires entering a repo transaction .",
    "the transaction is fully collateralized and we must have @xmath124 where the dynamics of the cash account are again given by .    _ counterparty bond funding : _ similarly , the bank enters into position in counterparty s bonds @xmath42 through a repo transaction , i.e. we must always have @xmath125 the evolution of the repo cash account @xmath126 is given by @xmath127 where @xmath128 is the repo rate for the bonds @xmath42 .",
    "the bank and its counterparty have to satisfy regulatory and collateral requirements for bilateral transactions for which the rules are set forth by the csa and government regulatory agencies .",
    "_ initial margin : _ initial margins are exchanged at the inception of the contract and held in segregated accounts which leaves them unaffected in case of a default event .",
    "note that initial margins are not netted .",
    "the initial margin @xmath129 , that the counterparty posts with the bank , finances @xmath130 units of the margin account @xmath131 , i.e. we have @xmath132 the dynamics of @xmath131 is given by @xmath133 representing the interest rate @xmath134 the bank pays it s counterparty on the initial margin received .    in the same way the initial margin to the counterparty , @xmath135 , is held in @xmath136 units of another margin account @xmath137 , meaning we have @xmath138 the dynamics of the account @xmath137 is @xmath139 where @xmath140 is the rate received by the bank for the initial margin posted .",
    "_ variation margin : _ unlike the initial margin , the variation margin @xmath54 is usually fully rehypothecable which we will come back to when we consider the funding of the different margins . in case @xmath141 , corresponding to the counterparty having posted collateral with the bank , it is then financed by @xmath142 shares of the margin account @xmath143 .",
    "the csa rules dictate that an interest rate @xmath144 is to be paid to the counterparty . on the other hand",
    ", @xmath145 describes the bank s collateral posted to its counterparty into the account @xmath143 , earning the rate @xmath144 . to sum up",
    ", we always have @xmath146 and the dynamics of @xmath143 is @xmath147    _ regulatory capital cash flows : _ we include the cost of regulatory capital @xmath58 into the model .",
    "the capital is raised from equity and debt investors which amounts to holding @xmath148 units of a cash account @xmath149 , i.e. it holds @xmath150 denoting the cost of capital with @xmath151 , the dynamics of @xmath149 are @xmath152    _ funding of uncollateralized positions : _ so far , we addressed the question of funding only for the positions in the underlying stock @xmath2 , the default - risky counterparty bond @xmath42 and the regulatory capital @xmath58 . here , we deal with the funding of the gap between the derivative value @xmath47 and the collateral . recall that in the classical black scholes model , there is no collateral and the delta position in the underlying stock is financed using the risk free bank account .",
    "hence the amount that needs to be funded is the difference between the derivative value and the delta position . in our case",
    "the collateral comprises of initial and variation margin , @xmath55 , @xmath56 and @xmath54 respectively .",
    "the value @xmath55 to be paid to the counterparty always needs to be funded , whereas the variation margin @xmath54 lowers the funding requirement if @xmath141 but otherwise raises it as well . since the initial margin @xmath56 from the counterparty is positive , it would lower the funding requirement too . however , initial margins are not rehypothecable and hence the value that needs to be funded is @xmath153 the bank has two sources of funding .",
    "one way of financing is issuing its own bonds @xmath41 , the other is external funding through a financing account .",
    "the value of the financing account @xmath154 together with the position @xmath155 hence always needs to be @xmath156 the dynamics of @xmath157 depend on whether the value @xmath154 is positive or negative . in the former case ,",
    "this cash is invested at the riskless rate @xmath27 in order to not introduce further credit risk , whereas in the latter case funds are raised at the cost of @xmath158 .",
    "consequently , the evolution of @xmath159 is given by @xmath160 where @xmath161 .",
    "having specified the structure of the different cash accounts , we are now ready to define the dynamics of the portfolio @xmath61 that replicates @xmath47 prior to a default event . since we require that the replicating portfolio @xmath162 is self - financing , i.e. any changes in the portfolio value arise exclusively from changes in the underlying instruments , we must have that @xmath163 along with the dynamics for @xmath2 , @xmath41 and @xmath42 and the above dynamics of the different cash accounts , we obtain @xmath164 where in the last equality we have used formulas - .",
    "we can simplify the dynamics to @xmath165 this equation describes the dynamics of the replicating portfolio prior to @xmath166 .      our next goal is to formulate the above replication problem in terms of a bsde . to this end we set @xmath167 since @xmath168 , we get @xmath169 finally , defining the driver @xmath170 we can write the evolution of our hedging portfolio as the following bsde , @xmath171 , \\\\ \\hat v_{\\tau \\wedge t } & =   \\e1 _ { \\tau > t } \\mathfrak{n}(s_t ) + \\e1 _ { \\tau \\leq t } \\theta_{\\tau}. \\end{split}\\ ] ] we refer to this equation as the _ fundamental bsde _ of counterparty credit risk modeling . recall that the default value @xmath172 has been defined in section [ sec : closeout ] .    unlike standard sdes which in applications are supplemented by initial value conditions ,",
    "a bsde is posed with a terminal value condition .",
    "the terminal condition for the fundamental bsde requires accounting for three possible outcomes . if neither the bank nor the counterparty default before the final maturity @xmath49 , our process ends at @xmath49 , with @xmath173 . on the other hand ,",
    "if a default occurs prior to @xmath49 , the portfolio is closed out and the process terminates early . in this case , the final portfolio value @xmath172 depends on of which of the parties defaults first , and is given by .",
    "note that the fundamental bsde has a possible jump in the event of a default at time @xmath174 , which makes its numerical implementation rather complex .",
    "fortunately , there is an explicit mapping of this equation onto a continuous bsde , which is conceptually clear and allows for a standard numerical implementation .",
    "this transformation is presented in detail in appendix [ transformation ] .",
    "specifically , we show there that @xmath121 , @xmath175 , @xmath176 , and @xmath177 can be represented , for all @xmath178 $ ] , as @xmath179 where the pair of processes @xmath180 is the solution to the following bsde : @xmath181 . \\end{split}\\ ] ] we refer to this equation as the _ reduced fundamental bsde_. we emphasize here that it is enough to find the solution to the reduced bsde and then use to find the credit - risky portfolio value @xmath47 .",
    "hence will play a central role in the remainder of the paper .    as a simple yet instructive example of the above reduction",
    ", we consider the following jump bsde : @xmath182 where @xmath183 , @xmath184 , @xmath185 are constants and @xmath186 is an @xmath187-measurable random variable .",
    "we find a closed form solution to this bsde by following the steps outlined above .",
    "the key is again to reduce the bsde with random time horizon and a jump into a bsde with fixed time horizon @xmath49 and without jumps .",
    "the corresponding reduced equation given by @xmath188 is a linear inhomogeneous ode .",
    "its solution reads @xmath189 as a consequence , applying theorem [ thm : transformedbsde ] gives the explicit solution @xmath190 of as @xmath191 notice that it would be hard to solve directly without the reduction step .",
    "in this section we derive the fundamental pde in the spirit of burgard and kjaer , see @xcite , @xcite .",
    "the pde approach requires that all the rates and dividends introduced above are deterministic . in that sense",
    "the approach based on the fundamental bsde , which requires only that the rates and dividends are adapted to @xmath28 , is more general .",
    "we derive the burgard - kjaer pde starting with the reduced fundamental bsde .",
    "namely , we make the following ansatz : @xmath192 where @xmath193 is a smooth function @xmath194\\times\\br^n\\to\\br$ ] . applying ito s lemma",
    "we find that @xmath195 here , the markovian generator @xmath196 is defined by @xmath197 and @xmath198 is the driver defined in . as a consequence ,",
    "we find that @xmath199 and hence @xmath200 satisfies the following terminal value problem : @xmath201 the derivation above is standard , see e.g. @xcite for more details .",
    "note that , explicitly equation takes the form @xmath202 recall that @xmath203 and @xmath204 depend explicitly on the portfolio close out value @xmath88 , as explained in section [ sec : closeout ] .",
    "specific cases for close out values @xmath88 are obtained along the lines of the arguments in section [ sec : valueadj ] and coincide with the pdes derived in @xcite . in particular , we see from the argument above that the process @xmath205 is essentially the delta of the portfolio .",
    "once the solution to is established , the solution of the fundamental bsde can explicitly be written as @xmath206 from a practical perspective , this representation of the solution to the fundamental bsde may be hard to use .",
    "numerical algorithms for solving high dimensional pdes tend to have poor performance characteristics .",
    "we believe that monte carlo simulations , discussed in section [ numsec ] , offer a more efficient and robust approach .",
    "another consequence of is the feynman - kac representation of the solution to .",
    "namely , integrating and taking the conditional expectation given the current state of the underlying @xmath2 , we find that @xmath207 .",
    "\\end{split}\\ ] ] actually , the representation above is , in general , not an explicit representation of the solution to the pde .",
    "instead it is an alternative equation for , stated as an integral equation .",
    "we now proceed to determining the valuation adjustment to the portfolio value accounting for the counterparty credit risk .",
    "let @xmath208 denote the difference between the counterparty credit - risky portfolio value @xmath209 and the risk neutral portfolio value @xmath59 , i.e. @xmath210 the total valuation adjustment @xmath211 is then given by @xmath212 .",
    "as before , we let @xmath88 denote the portfolio close out value at the time of default .",
    "below we consider separately two commonly considered close out conventions , namely @xmath213 and @xmath214 .",
    "we first consider the case of the close out value @xmath88 being equal to @xmath59 , namely the risk neutral portfolio value .",
    "this is the standard convention widely adopted in the industry , see @xcite , @xcite .",
    "fortuitously , the corresponding reduced fundamental bsde turns out to be linear , and thus can be solved in closed form .    to see this",
    ", we observe that the driver @xmath198 in , together with , is given by @xmath215 which is a linear function in @xmath209 and @xmath216 .",
    "note that @xmath59 is given by and is simply an exogenous input to the equation . according to [ app : linbsde ] , the corresponding reduced fundamental bsde can be solved explicitly . to streamline the notation we first set @xmath217 we also define the stochastic exponential @xmath218 for @xmath219 .",
    "observe that as a consequence of the following factorization property holds : @xmath220 this shows that the impact of the counterparty risk on the time evolution of the fundamental bsde consists in additional discounting .",
    "using formula in appendix [ app : linbsde ] , the solution to the reduced fundamental bsde can thus be written as @xmath221 \\\\ & = \\ee_t\\big[e^{-\\int_t^t   ( r^\\cb_u + r_u^\\cc - q^\\cc_u ) du } \\,\\gamma_{t , t}\\ , \\fn(s_t ) + \\int_t^t e^{-\\int_t^s   ( r^\\cb_u + r_u^\\cc - q^\\cc_u ) du } \\,\\gamma_{t , s}\\ , g_s ds\\big ] .",
    "\\end{split}\\ ] ] note that the formula above is a natural extension of .",
    "now , using the fact that @xmath222 , we find after some algebra that the valuation adjustment @xmath223 defined in can explicitly be expressed as @xmath224\\\\ & \\quad - ( 1-r^\\cc ) \\ee_t\\big[\\int_t^t d_{r^\\cb + r^\\cc - q^\\cc}(t , s)\\ , \\gamma_{t , s } \\ , ( r_s^\\cc - q_s^\\cc)(v_s - x_s - i^{fc}_s)^+   ds\\big]\\\\ & \\quad - ( 1-r^\\cb ) \\ee_t\\big[\\int_t^t d_{r^\\cb + r^\\cc - q^\\cc}(t , s)\\ , \\gamma_{t , s } \\ , ( r_s^\\cb - r_s)(v_s - x_s+i^{tc}_s)^- ds\\big]\\\\ & \\quad + \\ee_t\\big[\\int_t^t d_{r^\\cb + r^\\cc - q^\\cc}(t , s)\\ , \\gamma_{t , s } \\ , r^k_s k_s ds\\big]\\\\ & \\quad + \\ee_t\\big[\\int_t^t d_{r^\\cb + r^\\cc - q^\\cc}(t , s)\\ , \\gamma_{t , s } \\,\\big ( r_s^{fc } i^{fc}_s - ( r_s^{tc } + r_s ) i^{tc}_s + ( r_s^x + r_s ) x_s",
    "\\big )   ds\\big]\\\\ & \\quad + \\ee_t\\big[\\int_t^t d_{r^\\cb + r^\\cc - q^\\cc}(t , s)\\ , \\gamma_{t , s } \\,(r^f_s - r_s ) ( v_s - x_s+i^{tc}_s ) ^- ds\\big ] , \\end{split}\\ ] ] where @xmath225 is the discount factor over the time interval @xmath226 $ ] using rate @xmath227 .",
    "the first term on the right hand side of reflects the difference in discounting in the classic black - scholes model and counterparty credit risky discounting as discussed above .",
    "the remaining terms on the right hand side can be identified as follows : @xmath228,\\ ] ] represents the credit valuation adjustment ( cva ) , @xmath229,\\ ] ] represents the debt valuation adjustment ( dva ) , @xmath230,\\ ] ] represents the capital valuation adjustment ( kva ) , @xmath231,\\ ] ] represents the margin valuation adjustment ( mva ) , and finally @xmath232\\ ] ] is the funding valuation adjustment ( fva ) .",
    "we now connect the solution of the reduced fundamental bsde , to the solution to the fundamental bsde .",
    "explicitly , we have the following relation between the two solutions : @xmath233 the expressions derived above extend the corresponding explicit formulas in @xcite .",
    "choosing the adjusted portfolio value @xmath234 as the close out value , we note that the generator of the reduced fundamental bsde has the following form : @xmath235 in contrast to the case of @xmath213 , the resulting reduced fundamental bsde is nonlinear in @xmath209 , and an explicit representation to its solution is not available .    instead , we can construct an approximate solution , assuming that the counterparty credit risk adjustment @xmath223 is small relative to @xmath59 .",
    "specifically , we use the approximation : @xmath236 this approximation is first order accurate in @xmath223 . substituting @xmath237 into , where @xmath59 satisfies the riskless equation , and using the above approximations , we obtain the following linear bsde for the adjustment @xmath223 , @xmath238 here , @xmath239 , where @xmath240 is defined in , @xmath241 is the following effective discounting rate : @xmath242 and @xmath243    using the results summarized in appendix [ app : linbsde ] , we can solve this linear bsde explicitly .",
    "namely , we define the following stochastic exponential : @xmath244 then formula in appendix [ app : linbsde ] yields @xmath245\\\\ & = \\ee_t\\big[\\int_t^t d_{\\fr}(t , s ) \\gamma_{t , s } \\big(g_s + r_sv_s\\big ) ds\\big ] .",
    "\\end{split}\\ ] ] explicitly , the expression above can be written as @xmath246\\\\ & \\quad - ( 1-r^\\cc ) \\ee_t\\big[\\int_t^t d_\\fr(t , s)\\ , \\gamma_{t , s } \\",
    ", ( r_s^\\cc - q_s^\\cc)(v_s - x_s - i^{fc}_s)^+   ds\\big]\\\\ & \\quad - ( 1-r^\\cb ) \\ee_t\\big[\\int_t^t d_\\fr(t , s)\\ , \\gamma_{t , s } \\ , ( r_s^\\cb - r_s)(v_s - x_s+i^{tc}_s)^- ds\\big]\\\\ & \\quad + \\ee_t\\big[\\int_t^t d_\\fr(t , s)\\ , \\gamma_{t , s } \\ , r^k_s k_s ds\\big]\\\\ & \\quad + \\ee_t\\big[\\int_t^t d_\\fr(t , s)\\ , \\gamma_{t , s } \\,\\big ( r_s^{fc } i^{fc}_s - ( r_s^{tc } + r_s ) i^{tc}_s + ( r_s^x + r_s ) x_s   \\big ) ds\\big]\\\\ & \\quad + \\ee_t\\big[\\int_t^t d_\\fr(t , s)\\ , \\gamma_{t , s } \\,(r^f_s - r_s ) ( v_s - x_s+i^{tc}_s ) ^- ds\\big ]",
    ". \\end{split}\\ ] ] the individual terms in this expression can be interpreted in a fashion similar to the analogous terms in .",
    "notice that , compare to , the discount rate @xmath247 is replaced with @xmath241 .",
    "the first term on the right hand side of is an artifact of the difference in discounting in the classic black - scholes model and the counterparty credit risky discounting .",
    "the remaining terms on the right hand side have the following interpretation : @xmath248,\\ ] ] represents the credit valuation adjustment ( cva ) , @xmath249,\\ ] ] represents the debt valuation adjustment ( dva ) , @xmath250,\\ ] ] represents the capital valuation adjustment ( kva ) , @xmath251,\\ ] ] represents the margin valuation adjustment ( mva ) , and finally @xmath252\\ ] ] is the funding valuation adjustment ( fva ) .",
    "finally , we notice that the solution to the fundamental bsde is related to the riskless portfolio value @xmath59 via the following approximation : @xmath253 where @xmath254 is the total adjustment calculated above .",
    "we emphasize that , unlike , the relations above link the solution of the fundamental bsde to the solution of reduced fundamental bsde .",
    "up until now we have not addressed the issue of choosing a pricing measure @xmath15 .",
    "the bank s portfolio may consist of a large number of assets . in practice ,",
    "each of the asset classes is valued under its own martingale measure , which in turn depends on the appropriate choice of numeraire .",
    "for example , swaptions are priced under the forward swap measure , while equity options are priced under the rolling bank account measure . from the pricing perspective",
    "this approach is fully consistent , the choice of numeraire does not affect model valuations . however , the choice of pricing measure is crucial from the enterprise risk management perspective .",
    "the risk of a portfolio composed of various assets is not the sum of the risks of its components , as the dependences between assets may reduce or increase the total risk .",
    "it is thus important that the monte carlo simulations are carried out under a common pricing measure .",
    "there is no natural way of aggregating the different martingale measures into one pricing measure for the entire portfolio .",
    "we will not discuss this issue in detail here . in our model specification we simply assume a pricing measure @xmath15 that is not a martingale measure but rather behaves like a historical ( aggregate ) measure .",
    "the choice of @xmath15 is determined by the bank s risk appetite , regulatory requirements , and other factors , see e.g. @xcite , @xcite .    once the aggregate pricing measure @xmath15 has been selected , the next issue is model calibration .",
    "there are two categories of variables entering the model : ( i ) directly observable such as asset prices , interest rates , recovery rates , etc . , and ( ii )",
    "not directly observable variables , which have to be estimated from the market data , such as volatilities , correlations , default intensities , etc .. generally , for the indirectly observable model inputs , parameters inferred from cross - sectional market prices are associated with various martingale measures , while parameters inferred from historical time series are associated with physical measures .",
    "notice that parameters such as volatilities can be deduced from both types of calculations .",
    "their numerical values will differ depending on whether they are calculated as market implieds or by means of maximum likelihood estimation .",
    "however , typically the only practical way of calculating correlations is from historic time series . for default intensities , the cds market , whenever available , yields risk neutral default probabilities . for less liquid names , without a liquid cds market , historical default data , such as moody s dbs bank or various credit ranking models , can be used ( see e.g. @xcite ) .",
    "another practical issue is the choice of risk factors .",
    "a financial institution is likely to contain thousands of positions in a netting set , each of which subject to market and counterparty risk . from a practical perspective , an analysis of a system with such a large number of risk factors is infeasible . in order to bring the dimensionality of the problem to a manageable size , a methodology of reducing the number of risk factors is required .    in mathematical terms",
    ", we are facing the issue of approximating the solution to the following high - dimensional fbsde : @xmath255 under the usual lipschitz conditions on the coefficients , standard results guarantee the existence and uniqueness of the solution @xmath256 to this system ( see e.g. @xcite ) .    a common approach used in practice is principal component analysis ( pca ) . specifically , the instantaneous covariance of the price process has the spectral decomposition : @xmath257 where @xmath258 are the eigenvalues ordered by size , and @xmath259 are the spectral projections .",
    "generically , each of the eigenvalues is non - degenerate and each of the spectral projections defines a one - dimensional subspace . in general , the eigenvalues and spectral projections are stochastic and depend on the realization of the process @xmath260 and time @xmath23 .",
    "the left hand side of is estimated from suitable market data , as discussed above .",
    "reduction of risk factors is practical if only a small number @xmath261 of eigenvalues explain the covariance matrix , i.e. @xmath262 with @xmath263 where @xmath264 is a given tolerance level .",
    "we thus consider the projection operator @xmath265 onto the subspace spanned by the eigenvectors corresponding to the first @xmath266 eigenvalues .",
    "the key assumption ensuring that practicality of the factor reduction methodology is that @xmath267 is stable , and so its range persists regardless of market conditions .",
    "we can formulate this requirement heuristically as @xmath268dt , \\end{split}\\ ] ] i.e. @xmath267 is approximately equal to its average @xmath269 over time @xmath49 .",
    "we refer to the orthonormal basis in @xmath270 defined by this projection as the principal factors .",
    "the existence of @xmath269 is a strong assumption and it is not true in a general mathematical set up .",
    "rather , it is an empirical fact indicating that the financial markets are driven by a relatively small number of persistent economic factors .",
    "we define the following quantity : @xmath271 \\,du\\big)^{1/2}\\\\ & = \\big(\\int_0^t \\ee \\big [ \\tr \\big(\\sigma(u , s_u)^\\top \\sigma(u , s_u)-p\\sigma(u , s_u)^\\top \\sigma(u , s_u)p \\big ) \\big ] \\,du\\big)^{1/2}. \\end{split}\\ ] ] in words , @xmath272 measures the average discrepancy between the true covariance of the assets and the truncated covariance given by the projection onto the principal factors .    the key fact , established below ,",
    "is that the price process @xmath2 of @xmath273 can be , to a good degree of accuracy , explained in terms of the principal risk factors .",
    "specifically , we consider the projection @xmath274 of the brownian motion @xmath275 on the principal factors . in general",
    ", @xmath276 is not a brownian motion .",
    "however , we can choose a standard @xmath266-dimensional wiener process @xmath277 such that @xmath278 where @xmath279 is a constant @xmath280-matrix with the property that @xmath281 and @xmath282 .",
    "we now consider a system driven by the principal risk factors , more precisely @xmath283 where the drift and diffusion coefficients are the same as in . as this equation",
    "can be understood as an sde with a new diffusion coefficient @xmath284 , existence and uniqueness of the solution are obvious .",
    "we expect that the solution to this sde is approximately equal to the true process @xmath260 .",
    "we turn these intuitions into a mathematical statement as follows . for an adapted , matrix - valued process",
    "@xmath285 we introduce the following semi - norm : @xmath286^{1/2},\\ ] ] and the norm @xmath287 then we have the following theorem .",
    "[ facredthm ] assume that @xmath19 and @xmath20 are lipschitz continuous : @xmath288 with constant @xmath289 and @xmath290 , and satisfy the standard growth conditions : @xmath291 with @xmath240 constant .    then has a unique strong solution , and @xmath292 where @xmath293 is a constant .",
    "the proof of this theorem is presented in appendix [ app : facredproof ] .",
    "the theorem above says that the price process @xmath294 driven by the truncated risk factors indeed approximates the true price process @xmath260 .",
    "the tightness of the approximation is given by @xmath295 , and it may degrade exponentially fast in the time horizon @xmath49 .",
    "we now consider the backward part of the system of equations driven by the principal risk factors : @xmath296 note that , unlike , the driving process in is not a standard brownian motion anymore but the martingale @xmath297 .",
    "there are several theoretical and practical aspects to be considered when working with this equation , which we will address in @xcite .",
    "for instance , existence of a solution @xmath298 to the above equation can be shown , however the solution is not unique . to see this ,",
    "recall that the process @xmath299 represents the delta hedging strategy , also compare . reducing the risk factors",
    "leads to an incomplete market as one can not fully hedge one s position anymore .",
    "we may , for example , choose @xmath299 to be a minimum variance strategy . in order to prove uniqueness of the solution",
    ", we have to introduce another process , compare @xcite .    in order to measure the discrepancy between the exact bsde and its approximation",
    ", we find it convenient to introduce the following ( semi-)norms for adapted , vector - valued processes : @xmath300^{1/2},\\\\ \\|x\\|_{\\beta,2 } & = \\big ( \\int_0^t \\|x_u\\|^2_\\beta \\ , du \\big)^{1/2},\\\\ \\|x\\|_{\\beta,\\infty } & = \\sup_{0 \\leq t \\leq t } \\|x_t\\|_\\beta .",
    "\\end{split}\\ ] ] the following theorem shows that the solution to equation approximates the solution of the backward part of system .    [ facredthmbackward ] assume that the terminal value @xmath186 and the driver @xmath301 are lipschitz continuous : @xmath302 then there exist constants @xmath303 , depending on the time horizon @xmath49 , such that the following inequalities hold : @xmath304 du   & \\leq c_3 \\|\\widetilde s - s \\|_{2,\\infty } .",
    "\\end{split}\\ ] ]    the proof of this theorem is presented in appendix [ app : facredproof ] .",
    "consequently , the solution @xmath305 can be approximated by the processes @xmath298 driven by the principal risk factors .",
    "moreover , the third of the inequalities in shows that the residual portion of @xmath85 is small .",
    "in this section we discuss a general numerical framework for solving continuous fbsdes using monte carlo methods .",
    "such equations include the reduced fundamental bsde discussed above .",
    "we propose an algorithm for finding the counterparty credit - risky value @xmath47 as an application .",
    "the method is then illustrated in a simple example .",
    "we briefly review a method for discretization of the forward backward system @xmath306 this method is classic and has been originally proposed by bouchaud and touzi in @xcite .    for the forward process",
    "@xmath2 , we apply a standard discretization scheme ( see e.g. @xcite ) such as euler s or milstein s scheme ( for the latter , assuming suitable integrability conditions ) .",
    "let @xmath307 denote a regular time grid , where @xmath308 .",
    "in particular , for the euler scheme , the approximation takes the form of the following discretized forward process @xmath309 where @xmath310 and @xmath311 .    in order to approximate the backward part of the fbsde",
    ", we set @xmath312 , @xmath313 and @xmath314 .",
    "this leads to the following system : @xmath315 starting with the terminal condition @xmath316 we proceed with finding @xmath317 and @xmath318 for all @xmath319 .",
    "note that the @xmath317 s in are not adapted and depend on @xmath318 .",
    "these two problems can be solved by taking conditional expectations which leads to @xmath320 \\\\ & = \\ee_i \\left [ y_{i+1 } \\right ] +   f(s_i , y_{i } , z_i ) \\delta_i , \\end{split}\\ ] ] where we have used the notation @xmath321=\\ee _",
    "{ t_i } [ \\ , \\cdot \\ , ] $ ] .",
    "this implicit scheme can transformed into an explicit scheme by @xmath322 .",
    "\\end{split}\\ ] ] in order to determine @xmath318 , we multiply by an increment @xmath323 and take conditional expectations .",
    "this yields @xmath324 & = \\ee_i \\left [ y_{i+1 } \\delta w_{i } \\right ] - z_{i } \\delta_i , \\end{split}\\ ] ] and hence we obtain the following expression for @xmath325 : @xmath326 .\\ ] ]    we are thus led to the following discrete time scheme for solving the backward part of system : @xmath327 , \\\\",
    "y_{i}&= \\ee_i \\big [ y_{i+1 } +   f(s_i , y_{i+1 } , z_i ) \\delta_i   \\big],\\\\ \\end{split}\\ ] ] for @xmath328 .",
    "note that simulating this system requires numerical estimation of the conditional expected values @xmath329 $ ] .",
    "we discuss this issue in the following section .",
    "a practical and powerful method of computing the conditional expected values in is the longstaff - schwartz regression method originally developed for pricing american options @xcite ( see also @xcite ) .",
    "we use a variant of this method that involves the hermite polynomials .",
    "this choice is natural as expressions involving conditional expectations of hermite polynomials of gaussian random variables lead to convenient closed form expressions .",
    "let @xmath330 , @xmath331 , denote the @xmath227-th normalized hermite polynomial corresponding to the standard gaussian measure @xmath332 .",
    "for a multi - index @xmath333 , where each @xmath334 is a nonnegative integer , we define @xmath335 these functions form an orthonormal basis for the hilbert space @xmath336 , where @xmath337 is the standard gaussian measure in @xmath5 dimensions , @xmath338 .    the key property of @xmath339 is the following addition formula for @xmath340 $ ] and @xmath341 : @xmath342 consequently , integrating over @xmath343 with respect to @xmath337 yields the following conditioning rules : @xmath344 & = \\chi^{|\\underline{k}|/2}\\mathrm{he}_{\\underline{k}}(w ) , \\\\ \\ee\\big[\\mathrm{he}_{\\underline{k}}(\\sqrt{\\chi } \\ , w+\\sqrt{1-\\chi}\\,x)\\,x_a \\,|\\,w\\big ] & = \\chi^{|\\underline{k}-1|/2 } ( 1-\\chi)^{1/2 } \\ , \\frac{\\d \\mathrm{he}_{\\underline{k } } ( w)}{\\d w_a}\\,.\\\\ \\end{split}\\ ] ] here , @xmath345 are independent @xmath5-dimensional standard normal random variables",
    ". the latter rule is found using the addition formula and orthonormality of hermite polynomials with respect to the standard gaussian measure .",
    "we shall use these rules in order to estimate the conditional expected values in .",
    "we set @xmath346 , for @xmath347 , where @xmath348 is an @xmath5-dimensional standard normal random variable .",
    "we notice that @xmath349 where @xmath350 , and where @xmath351 is standard normal and independent of @xmath348 . in the following",
    ", we shall use this decomposition in conjunction with .",
    "now , we assume the following linear architecture : @xmath352 where @xmath58 is the cutoff value of the order of the hermite polynomials . this is simply a truncated expansion of the random variable @xmath353 in terms of the orthonormal basis @xmath354 .",
    "the values of the fourier coefficients are estimated by means of ordinary least square regression .",
    "then , as a consequence of the conditioning rule , @xmath355=\\sum_{\\underline{k}:\\,|\\underline{k}|\\leq k}\\,g_{\\underline{k},i+1}\\,\\chi_i^{|\\underline{k}|/2}\\,\\mathrm{he}_{\\underline{k}}(w_i).\\ ] ] in other words , conditioning @xmath353 on @xmath356 is equivalent to multiplying its fourier coefficients @xmath357 by the factor @xmath358",
    ".    in practice , the formula for @xmath318 given by is hard to use .",
    "instead , we find an explicit expression using the hermite architecture , which was performant in our experiments .",
    "the following identity holds : @xmath359\\\\ & = \\frac{1}{\\sqrt{t_i}}\\sum_{k\\leq k } g_{k , i+1 } \\chi_{i}^{k/2}\\ , k \\mathrm{he}_{{k-1 } } ( w_i ) .",
    "\\end{split}\\ ] ]    it is sufficient to establish in the one - dimensional case . using and we readily find that @xmath360&= \\sqrt{\\delta_i}\\ee_i[\\mathrm{he}_k(\\sqrt{\\chi_i}\\,w_i+\\sqrt{1-\\chi_i}\\,x_i ) x_i]\\\\ & =   \\frac{\\delta_i}{\\sqrt{t_i } } \\,\\chi_{i}^{k/2 } \\ , \\frac{\\d \\mathrm{he}_{{k } } ( w_i)}{\\d w_i}\\,,\\\\ \\end{split}\\ ] ] where we have also used the second of the identities .",
    "consequently , using , we find that @xmath361\\\\ & =   \\sum_{k\\leq k } g_{k , i+1 } \\chi_{i}^{k/2}\\ , \\frac{\\d \\mathrm{he}_{{k } } ( w_i)}{\\d w_i}. \\\\ \\end{split}\\ ] ] comparing this with , we see that holds .    now that we have found a practical representation for @xmath318",
    ", we proceed calculating @xmath317 in . to this end",
    ", we repeat the calculations in and with @xmath353 replaced by @xmath362 .      in order to solve the fundamental bsde numerically ,",
    "we proceed as follows .",
    "first we select the number of risk factors as in section [ sec : pricingmeasurefactorreduction ] .",
    "we then generate @xmath363 paths of the multi - factor brownian motion required to simulate the dynamics of the underlying portfolio . using the spectral decomposition approach to generating the brownian paths ,",
    "a practical choice could be @xmath364 .",
    "next , we simulate the asset price process @xmath2 by solving the forward equation of .",
    "we use the price process @xmath2 as an input to find the value @xmath59 , given by , of the netting set subject to no counterparty credit risk .",
    "another key input into the model are the default intensities @xmath37 and @xmath38 .",
    "choosing @xmath37 and @xmath38 deterministic is the simplest possible and commonly selected option .",
    "however , this does not allow one to model wrong / right way risk @xcite , @xcite , @xcite . on the other hand , modeling stochastic default rates requires a stochastic dynamic .",
    "a standard approach consists in modeling @xmath37 and @xmath38 as diffusion processes .",
    "the brownian drivers of these diffusions are appropriately correlated with the brownian motions driving the underlying asset @xmath2 .",
    "the sign of the magnitude of these correlations allows one to quantify the impact of wrong way risk on the counterparty credit . solving the diffusions for @xmath37 and @xmath38 and applying",
    "the acceptance rejection method then generates the default times @xmath30 and @xmath29 .",
    "next , the reduced fundamental bsde @xmath209 is solved . since the reduced fundamental",
    "bsde is of the form , the numerical methodology discussed in sections [ subsec : discretizingfbsde ] and [ subsec : hermitepolynomials ] can be applied directly . for practical purposes we can choose @xmath58 , the maximum order of hermite polynomials , to be a small integer @xmath365 .",
    "this choice offers a reasonable balance between accuracy and performance of the computation .",
    "finally , we find the counterparty credit risky portfolio value @xmath47 as a result of the preceding computations using formula .",
    "in this section we illustrate the numerical method discussed above by applying it to a simple bsde with a known explicit solution .",
    "a more thorough analysis of the above method as applied to the fundamental bsde will be presented in a separate publication , see @xcite .",
    "specifically , consider the following nonlinear bsde : @xmath366 with a counting process @xmath367 , the first default time @xmath368 , and a constant real - valued vector @xmath369 .",
    "moreover @xmath370 and @xmath371 .",
    "note that this bsde has a random time horizon @xmath174 at which a jump occurs .    as discussed in section [ transformation ] , the bsde can be reduced to one without the jump and with a fixed time horizon . according to theorem [ thm : transformedbsde ]",
    "the reduced bsde is given by @xmath372 this bsde has an explicit solution , which reads @xmath373 where @xmath374 for all @xmath68 $ ] .",
    "the solution @xmath375 of is now obtained from solution to the reduced bsde as @xmath376    we will now construct a numerical solution to the reduced bsde . more precisely , we compare the numerical solution to its explicit solution in the case of @xmath377 .",
    "we assume the time horizon of @xmath378 , and choose the following values of the parameters : @xmath379 we divide the time interval into @xmath380 subintervals and generate @xmath381 monte carlo paths .",
    "for estimating the conditional expected values we choose the hermite architecture , with @xmath382 .",
    "figure [ traj ] shows representative monte carlo trajectories simulating @xmath383 and @xmath85 .",
    "here , the black lines are the paths of the exact solution , while the red lines are the numerical approximations calculated according to the algorithm above .",
    "notice that the approximate path of @xmath383 is very close to the exact trajectory .",
    "however , the paths representing @xmath85 differ more .",
    "apparently the numerical solution to the @xmath85 process of a bsde converges slower than the numerical solution to the @xmath383 process .",
    "figure 1        on the other hand , the expected values of both @xmath383 and @xmath85 are close approximations of the exact solution of the bsde .",
    "this is shown in figure [ expvalues ] .",
    "figure 2        finally , figure [ relerror ] shows the relative error of the expected values of @xmath383 and @xmath85 versus the expected values of the exact solution .",
    "in this section we present general results on sdes and bsdes we have used throughout the paper .",
    "first we are interested how the fundamental bsde with jumps can be transformed into a reduced fundamental bsde .",
    "the fundamental bsde can more generally be expressed as an equation @xmath384 , \\\\",
    "y_{\\tau \\wedge t } & = \\e1_{\\tau > t } \\xi + \\e1_{\\tau\\leq t } ( \\theta^1_\\tau \\e1_{\\tau= \\tau^1 } + \\ldots + \\theta^m_\\tau \\e1_{\\tau= \\tau^m } ) , \\end{split}\\ ] ] driven by an @xmath5-dimensional brownian motion @xmath6 and a counting process @xmath385 .",
    "the solution to this bsde is the set @xmath375 of adapted stochastic processes that satisfies .",
    "the driver @xmath386 is a given deterministic function and @xmath387 denotes the first default time .",
    "the bsde has a possible random time horizon , more precisely its terminal value depends on whether a default event happens before the fixed time horizon @xmath49 . in that case",
    "the bsde stops at the random time @xmath174 at an entry of the adapted stochastic process @xmath388 .",
    "otherwise the bsde carries on to the final time @xmath49 with an @xmath389- measurable random variable @xmath186 as the final value .",
    "although jump bsdes are rather complex to handle , we are in the particular situation that only ever one jump occurs and it happens at the very end of the bsde .",
    "this is what we can use to transform the above random horizon jump bsde into an equation without jumps and with a fixed terminal time , i.e. @xmath390 , \\\\",
    "\\cy_t & = \\xi . \\end{split}\\ ] ] the following result is a generalization of theorem 4.3 in @xcite , giving us the possibility to express the solution to the jump bsde in terms of the solution of a continuous bsde .",
    "in the first case no default happens before the terminal time , i.e. @xmath393 . on @xmath394 we have from that @xmath395 , @xmath396 and @xmath397 for all @xmath68 $ ] .",
    "as @xmath391 solves , we have @xmath398 , \\\\",
    "y_t & = \\xi = \\e1_{\\tau > t } \\xi + \\e1_{\\tau\\leq t } ( \\theta^1_\\tau \\e1_{\\tau= \\tau^1 } + \\ldots + \\theta^m_\\tau \\e1_{\\tau= \\tau^m } ) .",
    "\\end{split}\\ ] ] on @xmath394 .",
    "additionally we know @xmath399 on @xmath394 and hence we derive .",
    "in the second case a default happens between now and @xmath49 , more precisely we look at @xmath400 \\ } = \\{\\tau >   t \\ } \\cap \\{\\tau \\leq t \\ }   $ ] . then again from we have on @xmath400 \\}$ ] that @xmath401 , @xmath402 , @xmath403 for all @xmath404 . using that @xmath391 solves , we obtain @xmath405 for @xmath406 $ ] .",
    "the definition of @xmath279 from gives @xmath407 meaning we have .",
    "the last case considers the situation when the default happens before or at time @xmath23 , i.e. @xmath408 . again from we have @xmath409 and thus on @xmath410 we get @xmath411 which is equation in integral form .",
    "continuous linear bsdes are equations with a driver that is linear in @xmath383 and @xmath85 , meaning we consider equations of the type @xmath412,\\\\ y_t&=\\xi ,   \\end{split}\\ ] ] with @xmath5-dimensional brownian motion @xmath6 , @xmath389 measurable random terminal value @xmath186 and @xmath52 , @xmath112 , @xmath413 being adapted stochastic processes .",
    "the solution of this equation is any pair of adapted processes @xmath305 that satisfies . these are some of the few bsdes for which at least the first part of the solution @xmath383 can be found explicitly . from (",
    "* proposition 2.2 ) we have @xmath414 \\\\ \\end{split}\\ ] ] where @xmath415 here , @xmath416 denotes the stochastic exponential of a stochastic process @xmath54 .",
    "we begin by rewriting the sdes for @xmath2 and @xmath417 in the integral form : @xmath418 consequently , their difference is given by @xmath419 and thus , by means of ito s isometry , @xmath420 \\,du\\big)^{1/2}. \\end{split}\\ ] ] note that @xmath421 \\,du \\\\ & = \\int_0^t \\ee \\big [ \\tr \\big (   \\sigma(u , s_u)^\\top \\sigma(u , s_u ) - p \\sigma(u , s_u)^\\top \\sigma(u , s_u ) p \\big ) \\big ] \\,du \\\\ & = \\int_0^t \\delta(u)^2 du , \\end{split}\\ ] ] where @xmath272 is defined by . using lipschitz continuity ,",
    "this yields @xmath422 where @xmath413 is a constant , explicitly given as @xmath423 .",
    "we shall now invoke classic grnwall s inequality : if @xmath424 is a nonnegative continuous function with @xmath425 where @xmath426 is a non - decreasing function and @xmath427 , then @xmath428 squaring , and applying the inequality above to @xmath429 , we obtain @xmath430 where we have set @xmath431 . taking the supremum over @xmath432 yields the claim .      the difference between and the backward part of the system",
    "is given by @xmath433 in the following we adapt the arguments used to prove the existence of a solution to a bsde ( see @xcite , @xcite ) .",
    "applying ito s formula to the process @xmath434 , where the constant @xmath435 will be chosen later , yields @xmath436 taking expectations on both sides of this equation leads to the following identity : @xmath437 du \\\\ & =   \\|\\xi ( \\widetilde s_t ) - \\xi ( s_t)\\|_\\beta^2 + 2 \\int_t^t \\ee\\big[e^{\\beta u } ( \\widetilde y_u - y_u)\\big ( f(u,\\widetilde s_u , \\widetilde y_u , \\widetilde z_u ) - f(u , s_u , y_u , z_u ) \\big)\\big ] du.\\\\ \\end{split}\\ ] ] using lipschitz continuity of the terminal condition @xmath186 and driver @xmath301 , we obtain that @xmath438 du \\\\ & \\leq k_\\xi \\|\\widetilde s_t - s_t\\|_\\beta^2 + 2 k_f\\int_t^t \\ee\\big [ e^{\\beta u } |\\widetilde y_u - y_u|\\big ( |\\widetilde s_u - s_u| + |\\widetilde y_u - y_u| + |\\widetilde z_u - z_u| \\big)\\big ] du .",
    "\\end{split}\\ ] ] using the elementary inequality @xmath439 where @xmath440 is a constant , we find that @xmath441 we thus arrive at the following key inequality : @xmath442 du\\\\ & \\leq k_\\xi \\|\\widetilde s_t - s_t\\|_\\beta^2 + k_f\\int_t^t \\|\\widetilde s_u - s_u\\|^2_\\beta   du",
    ". \\end{split}\\ ] ] now , we choose @xmath443 sufficiently large so that @xmath444 , and then subsequently we choose @xmath184 so that @xmath445 .",
    "99 andersen , l. , duffie , d. , and song , y. : funding value adjustments , working paper ( 2016 ) .",
    "barles , g. , buckdahn , r. , pardoux , e. : _ backward stochastic differential equations and integral partial differential equations _ , stochastic and stochastic reports 60 , 5783 ( 1997 ) .",
    "basel committee on banking supervision _",
    "margin requirements for non - centrally cleared derivatives _ ( 2015 ) .",
    "basel committee on banking supervision _",
    "basel iii : the stardardised approach for measuring counterparty credit risk exposures : frequently asked questions _",
    "bertsekas , d. p. : _ dynamic programming and optimal control _ , vol .",
    "2 , athena scientific ( 2012 ) .",
    "bichuch , m. , capponi , a. , sturm , s. : _ arbitrage - free xva _ , http://arxiv.org/pdf/1608.02690v1.pdf[arxiv:1608.02690 ] ( 2016 ) .",
    "bouchard b. , touzi n. : _ discrete time approximation and monte - carlo simulation of backward stochastic differential equations _ , stochastic processes and their applications , vol 111 , 2 , 175 - 206 ( 2004 ) .",
    "brigo d. , morini m. , and pallavicini a. : _ counterparty credit risk , collateral and funding : with pricing cases for all asset classes _ , wiley , isbn : 978 - 0 - 470 - 74846 - 6 ( 2013 ) .",
    "burgard c. , and kjaer m. : _ pde representation of derivatives with bilateral counterparty risk and funding costs _ , the journal of credit risk , 7(3 ) , 1 - 19 ( 2011 ) .",
    "canabarro , e. , and duffie , d. : _ measuring and marking counterparty risk _ , asset / liability management for financial institutions , institutional investor books ( 2003 ) . crpey s. , bielecki t. , and brigo d. : _ counterparty risk and funding : a tale of two puzzles _ , chapman and hall / crc financial mathematics series , isbn : 978 - 1466516458 ( 2014 ) evans , l. c. : _ partial differential equations _ ,",
    "ams ( 1998 ) .",
    "geiss , c. , labart , c. : _ simulation of bsdes with jumps by wiener chaos expansion _ , http://arxiv.org/pdf/1502.05649v1.pdf[arxiv:1502.05649 ] ( 2015 ) .",
    "ghamami , s. , and goldberg , l. r. : _ stochastic intensity models of wrong way risk : wrong way cva need not exceed independent cva _ , working paper ( 2012 ) .",
    "green , a. : _ xva : credit , funding and capital valuation adjustments _ , wiley ( 2015 ) .",
    "green , a. , kenyon , c. : _ mva : initial margin valuation adjustment by replication and regression _ , https://arxiv.org/pdf/1405.0508.pdf[arxiv:1405.0508 ] ( 2014 ) .",
    "green , a. , kenyon , c. , and dennis , c. : _ kva : capital valuation adjustment _ , https://arxiv.org/pdf/1405.0515.pdf[arxiv:1405.0515 ] ( 2014 ) .",
    "gregory , j. : _ the xva challenge : counterparty credit risk , funding , collateral , and capital _ , wiley ( 2015 ) .",
    "gregory , j. : _ the impact of initial margin in otc derivatives _ , working paper ( 2016 ) .",
    "hull , j. , and white , a. : _ valuing derivatives : funding value adjustments and fair value _ , fin .",
    "j. , * 70 * , 46 - 56 ( 2014 ) .",
    "isda publications http://www.isda.org ( 2016 ) .",
    "el karoui n. , mazliak , l. : _ backward stochastic differential equations _ , crc press , isbn 9780582307339 ( 1997 ) .",
    "el karoui n. , peng s. , and quenez m.c .",
    ": _ bsdes in finance _ , mathematical finance , 7 ( 1 ) , 1 - 71 ( 1997 ) .",
    "kenyon c. , green a. , berrahoui , m. : _ which measure for pfe ?",
    "the risk appetite measure _ , preprint arxiv ( 2015 ) .",
    "kharroubi i. , lim t. and ngoupeyou a. : _ mean variance hedging on uncertain time horizon in a market with a jump _ , applied mathematics and optimization , 68 ( 3 ) , 413 - 444 ( 2013 ) .",
    "kloeden , p. , and platen , e. : _ numerical solution of stochastic differential equations _ , ( 1992 ) .",
    "lesniewski , a. , lewis , h. , and richter , a. : _ wrong way risk _ , working paper ( 2016 ) .",
    "lesniewski , a. , richter , a. : _ risk factor reduction in a bsde setting _ , working paper ( 2016 ) .",
    "longstaff , f. a. , and schwartz , e. s. : _ valuing american options by simulation : a simple least - squares approach _ , rev . fin .",
    ", 14 ( 1 ) , 113 - 147 ( 2001 ) . moody s : https://www.moodys.com/credit-ratings/dbs-bank-ltd-credit-rating-2922[_dbs credit rating _ ] , ( 2016 ) pardoux , e. , and rascanu , a. : _ stochastic differential equations , backward sdes , partial differential equations _ , springer ( 2014 ) .",
    "protter , p. : _ stochastic integration and differential equations _ , springer ( 2004 ) .",
    "stein , h. : _ fixing underexposed snapshots - proper computation of credit exposures under the real world and risk neutral measures _ , technical report , bloomberg lp , december , 1 - 23 ( 2013 ) ."
  ],
  "abstract_text": [
    "<S> we discuss a general dynamic replication approach to counterparty credit risk modeling . </S>",
    "<S> this leads to a fundamental jump - process backward stochastic differential equation ( bsde ) for the credit risk adjusted portfolio value . </S>",
    "<S> we then reduce the fundamental bsde to a continuous bsde . depending on the close out value convention </S>",
    "<S> , the reduced fundamental bsde s solution can be represented explicitly or through an accurate approximate expression . </S>",
    "<S> furthermore , we discuss practical aspects of the approach , important for industry applications : ( i ) efficient numerical methodology for solving a bsde driven by a moderate number of brownian motions , and ( ii ) factor reduction methodology that allows one to approximately replace a portfolio driven by a large number of risk factors with a portfolio driven by a moderate number of risk factors . </S>"
  ]
}