{
  "article_text": [
    "since their introduction by fomin and zelevinsky @xcite , cluster algebras have been related to diverse areas of mathematics such as total positivity , quiver representations , tropical geometry , lie theory , poisson geometry , and teichmller theory .",
    "there is an important class of cluster algebras arising from _ bordered surfaces with marked points _ , introduced by fomin , shapiro , and thurston in @xcite ( which in turn generalized work of fock and goncharov @xcite and gekhtman , shapiro , and vainshtein @xcite ) , and further developed in @xcite .",
    "such cluster algebras are interesting for several reasons : they comprise  most \" of the mutation - finite skew - symmetric cluster algebras @xcite , and also they can be thought of as coordinate rings for the _ decorated teichmller space _ of @xmath1 .",
    "more specifically , the cluster variable associated to an arc in @xmath1 corresponds to the _ penner coordinate _ @xcite or _ exponentiated lambda length _ of that arc .",
    "because of the interpretation in terms of decorated teichmller space , one can express the laurent expansion of a cluster variable associated to an arc in terms of a product of matrices in @xmath2 ; this was explained by fock and goncharov in @xcite in the coefficient - free case . on the other hand , in our previous work with schiffler @xcite , we gave formulas for the laurent expansion of every cluster variable in terms of perfect matchings of certain planar graphs .",
    "we worked in the generality of principal coefficients , and as a consequence proved the positivity conjecture for cluster algebras from surfaces whose coefficient system is of geometric type .    besides the positivity conjecture , a main open problem about cluster algebras is to construct ( vector - space ) bases which have  good \" positivity properties .",
    "it is expected ( and in many cases proved ) that the cluster monomials are linearly independent @xcite , and should be a part of such a basis , but in general , one needs some extra elements to complete the cluster monomials to a basis . in concurrent work",
    "@xcite , we construct bases for the cluster algebras @xmath0 from surfaces , with principal coefficients with respect to a seed @xmath3 . in order to construct these bases and",
    "prove that they span the cluster algebra , we need to associate cluster algebra elements @xmath4 not only to arcs but also to generalized arcs and closed loops @xmath5 ( with self - intersections allowed ) .",
    "our formulas in @xcite for such elements also involve matchings of certain graphs , but in the case of closed loops , these graphs lie on a mbius strip or an annulus .    in this paper",
    "we associate cluster algebra elements @xmath6 to generalized arcs and closed loops @xmath5 using products of matrices in @xmath2 .",
    "we prove that this definition using matrices agrees with the definition using matchings , that is , that @xmath7 for any generalized arc or closed loop @xmath5 . in order to prove this",
    ", we prove a general combinatorial result which explains how to enumerate matchings of a _ snake _ or _ band _ graph using products of @xmath8 matrices .",
    "we then prove _ skein relations _",
    ", which allow us to multiply elements @xmath9 and @xmath10 , where @xmath11 and @xmath12 are generalized arcs or closed loops .",
    "topologically , these skein relations resolve crossings in the corresponding arcs or loops .    note that our matrix formulas and skein relations generalize prior work of fock and goncharov @xcite , who worked in the coefficient - free case .",
    "however , it is crucial for us to work in the context of principal coefficients , because our proofs in @xcite use the notion of _ @xmath13-vectors _ , which are defined in the case of principal coefficients .",
    "matrix formulas have also appeared in related literature , including @xcite .",
    "this paper is organized as follows .",
    "we give background on cluster algebras from surfaces in section [ sect surfaces ] . in sections [ sect main ] and [ sec matrix ]",
    "we give our combinatorial formulas from @xcite and our matrix formulas for the cluster algebra elements associated to generalized arcs and closed loops . in section [ sec : matrix = match ] we prove that these two formulas coincide .",
    "finally , in section [ sec : skein ] we prove the skein relations .",
    "acknowledgements : we would like to thank sergey fomin , ren guo , christophe reutenauer , and helen wong for useful discussions .",
    "we are particularly grateful to ralf schiffler for his joint work with us , to alexander goncharov for inquiring about the connection between his work and ours , and to dylan thurston for his inspirational lectures in morelia , mexico .",
    "we assume that the reader is familiar with the notion of a cluster algebra and the terminology of @xcite , including principal coefficients and @xmath14-polynomials",
    ". we will begin by providing background on cluster algebras from surfaces .",
    "building on work of fock and goncharov @xcite , and of gekhtman , shapiro and vainshtein @xcite , fomin , shapiro and thurston @xcite associated a cluster algebra to any _ bordered surface with marked points_. in this section we will recall that construction , as well as further results of fomin and thurston @xcite .",
    "[ _ bordered surface with marked points _ ]",
    "let @xmath15 be a connected oriented 2-dimensional riemann surface with ( possibly empty ) boundary .",
    "fix a nonempty set @xmath16 of _ marked points _ in the closure of @xmath15 with at least one marked point on each boundary component .",
    "the pair @xmath1 is called a _ bordered surface with marked points_. marked points in the interior of @xmath15 are called _ punctures_.    for technical reasons , we require that @xmath1 is not a sphere with one , two or three punctures ; a monogon with zero or one puncture ; or a bigon or triangle without punctures .",
    "[ _ ordinary arcs _ ] an _ arc _ @xmath17 in @xmath1 is a curve in @xmath15 , considered up to isotopy , such that : the endpoints of @xmath17 are in @xmath16 ; @xmath17 does not cross itself , except that its endpoints may coincide ; except for the endpoints , @xmath17 is disjoint from @xmath16 and from the boundary of @xmath15 ; and @xmath17 does not cut out an unpunctured monogon or an unpunctured bigon .",
    "curves that connect two marked points and lie entirely on the boundary of @xmath15 without passing through a third marked point are _ boundary segments_. note that boundary segments are not ordinary arcs .",
    "[ _ crossing numbers and compatibility of ordinary arcs _ ] for any two arcs @xmath18 in @xmath15 , let @xmath19 be the minimal number of crossings of arcs @xmath20 and @xmath21 , where @xmath20 and @xmath21 range over all arcs isotopic to @xmath17 and @xmath22 , respectively .",
    "we say that arcs @xmath17 and @xmath22 are _ compatible _ if @xmath23 .",
    "[ _ ideal triangulations _ ] an _ ideal triangulation _ is a maximal collection of pairwise compatible arcs ( together with all boundary segments ) .",
    "the arcs of a triangulation cut the surface into _",
    "ideal triangles_.    there are two types of ideal triangles : triangles that have three distinct sides and triangles that have only two .",
    "the latter are called _ self - folded _ triangles .",
    "note that a self - folded triangle consists of an arc @xmath24 whose endpoints coincide , together with an arc @xmath25 to an enclosed puncture which we dub a _ radius_. following the notation of @xcite , we will refer to an arc @xmath24 cutting out a once - punctured monogon as a _",
    "noose_.    [ _ ordinary flips _ ]",
    "ideal triangulations are connected to each other by sequences of _ flips_. each flip replaces a single arc @xmath5 in a triangulation @xmath3 by a ( unique ) arc @xmath26 that , together with the remaining arcs in @xmath3 , forms a new ideal triangulation .    in a cluster algebra associated to an unpunctured surface",
    ", the cluster variables correspond to arcs , the clusters to triangulations , and the mutations to flips .",
    "however , in a cluster algebra associated to a surface with punctures , one needs to generalize the notion of arc and triangulation in order to get a combinatorial framework that encodes the whole cluster complex . in @xcite ,",
    "the authors introduced _ tagged arcs _ and _ tagged triangulations _ , and showed that they are in bijection with cluster variables and clusters .",
    "[ _ tagged arcs _ ] a _ tagged arc _ is obtained by taking an arc that is not a noose and marking (  tagging \" ) each of its ends in one of two ways , _ plain _ or _ notched _ , so that the following conditions are satisfied :    * an endpoint lying on the boundary of @xmath15 must be tagged plain * if the endpoints of an arc coincide , then they must be tagged in the same way .",
    "[ _ representing ordinary arcs by tagged arcs _ ] one can represent an ordinary arc @xmath12 by a tagged arc @xmath27 as follows . if @xmath12 is not a noose , then @xmath27 is simply @xmath12 with both ends tagged plain . otherwise , @xmath12 is a noose based at point @xmath28 , which contains the puncture @xmath29 inside it .",
    "let @xmath11 be the unique arc connecting @xmath28 and @xmath29 and compatible with @xmath12 .",
    "then @xmath27 is obtained by tagging @xmath11 plain at @xmath28 and notched at @xmath29 .",
    "[ _ compatibility of tagged arcs _ ] [ compatible ] tagged arcs @xmath11 and @xmath12 are called _ compatible _ if and only if the following properties hold :    * the arcs @xmath30 and @xmath31 obtained from @xmath11 and @xmath12 by forgetting the taggings are compatible ; * if @xmath32 then at least one end of @xmath11 must be tagged in the same way as the corresponding end of @xmath12 ; * @xmath33 but they share an endpoint @xmath28 , then the ends of @xmath11 and @xmath12 connecting to @xmath28 must be tagged in the same way .    [ _ tagged triangulations _ ] a maximal ( by inclusion ) collection of pairwise compatible tagged arcs is called a _ tagged triangulation_.",
    "one can associate an exchange matrix and hence a cluster algebra to any bordered surface @xmath1 @xcite .",
    "[ _ signed adjacency matrix of an ideal triangulation _ ] [ adj - matrix ] choose any ideal triangulation @xmath3 , and let @xmath34 be the @xmath35 arcs of @xmath3 . for any triangle @xmath36 in @xmath3",
    "which is not self - folded , we define a matrix @xmath37 as follows .",
    "* @xmath38 and @xmath39 in the following cases : * * @xmath40 and @xmath41 are sides of @xmath36 with @xmath41 following @xmath40 in the clockwise order ; * * @xmath41 is a radius in a self - folded triangle enclosed by a noose @xmath42 , and @xmath40 and @xmath42 are sides of @xmath36 with @xmath42 following @xmath40 in the clockwise order ; * * @xmath40 is a radius in a self - folded triangle enclosed by a noose @xmath42 , and @xmath42 and @xmath41 are sides of @xmath36 with @xmath41 following @xmath42 in the clockwise order ; * @xmath43 otherwise .    then define the matrix @xmath44 by @xmath45 , where the sum is taken over all triangles in @xmath3 that are not self - folded .",
    "note that @xmath46 is skew - symmetric and each entry @xmath47 is either @xmath48 , or @xmath49 , since every arc @xmath50 is in at most two triangles .",
    "* theorem 7.11 ) and ( * ? ? ?",
    "* theorem 5.1 ) [ clust - surface ] fix a bordered surface @xmath1 and let @xmath51 be the cluster algebra associated to the signed adjacency matrix of a tagged triangulation ( see ( * ? ? ?",
    "* definition 9.18 ) ) .",
    "then the ( unlabeled ) seeds @xmath52 of @xmath51 are in bijection with tagged triangulations @xmath3 of @xmath1 , and the cluster variables are in bijection with the tagged arcs of @xmath1 ( so we can denote each by @xmath53 , where @xmath5 is a tagged arc ) .",
    "moreover , each seed in @xmath51 is uniquely determined by its cluster .",
    "furthermore , if a tagged triangulation @xmath54 is obtained from another tagged triangulation @xmath3 by flipping a tagged arc @xmath55 and obtaining @xmath56 , then @xmath57 is obtained from @xmath52 by the seed mutation replacing @xmath53 by @xmath58 .",
    "[ ordinary - tagged ] by a slight abuse of notation , if @xmath5 is an ordinary arc which is not a noose ( so that the tagged arc @xmath59 is obtained from @xmath5 by tagging both ends plain ) , we will often write @xmath53 instead of @xmath60 .    in this paper we will typically fix a triangulation @xmath61 of @xmath1 .",
    "the initial cluster variables correspond to the arcs @xmath40 , and we will denote them by either @xmath62 or @xmath63 . similarly , we will denote the initial coefficient variables by either @xmath64 or @xmath65 .    given a surface @xmath1 with a puncture @xmath66 and a tagged arc @xmath5 , we let both @xmath67 and @xmath68 denote the arc obtained from @xmath5 by changing its notching at @xmath66 .",
    "( so if @xmath5 is not incident to @xmath66 , @xmath69 . )",
    "if @xmath66 and @xmath70 are two punctures , we let @xmath71 denote the arc obtained from @xmath5 by changing its notching at both @xmath66 and @xmath70 . given a tagged triangulation @xmath3 of @xmath15 ,",
    "we let @xmath72 denote the tagged triangulation obtained from @xmath3 by replacing each @xmath73 by @xmath67 .",
    "besides labeling cluster variables of @xmath74 by @xmath75 , where @xmath50 is a tagged arc of @xmath1 , we will also make the following conventions :    * if @xmath24 is an unnotched noose with endpoints at @xmath70 cutting out a once - punctured monogon containing puncture @xmath66 and radius @xmath25 , then we set @xmath76 . *",
    "if @xmath12 is a boundary segment , we set @xmath77 .    the exchange relation corresponding to a flip in an ideal triangulation is called a _",
    "generalized ptolemy relation_. it can be described as follows .",
    "@xcite[ptolemy ] let @xmath78 be arcs ( including nooses ) or boundary segments of @xmath1 which cut out a quadrilateral ; we assume that the sides of the quadrilateral , listed in cyclic order , are @xmath78 .",
    "let @xmath79 and @xmath80 be the two diagonals of this quadrilateral ; see figure [ figflip ] .",
    "then @xmath81 for some coefficients @xmath82 and @xmath83 .",
    "this follows from the interpretation of cluster variables as _ lambda lengths _ and the ptolemy relations for lambda lengths ( * ? ? ?",
    "* theorem 7.5 and proposition 6.5 ) .",
    "note that some sides of the quadrilateral in proposition [ ptolemy ] may be glued to each other , changing the appearance of the relation .",
    "there are also generalized ptolemy relations for tagged triangulations , see ( * ? ? ?",
    "* definition 7.4 ) .",
    "in this paper we work with cluster algebras @xmath84 with _ principal coefficients _ with respect to the seed @xmath85 . concretely ,",
    "these are defined by using a @xmath86 extended exchange matrix whose top @xmath87 part is @xmath88 , and whose bottom @xmath87 part is the identity matrix . see @xcite for more details . when @xmath88 comes from a triangulation of a bordered surface @xmath1",
    ", one can compute the coefficients using thurston s theory of measured laminations ; see @xcite and also @xcite . concretely",
    ", one can compute principal coefficients with respect to the seed @xmath85 ( where @xmath3 is a tagged triangulation ) using the _ shear coordinates _ with respect to the @xmath35 _ elementary laminations _ associated to the @xmath35 tagged arcs of @xmath3 ( * ? ? ? * definition 16.2 ) .    for a cluster algebra @xmath89 with exchange matrix @xmath88 and an arbitrary semifield @xmath90 of coefficients ,",
    "laurent expansions of cluster variables can be computed from the formula in @xmath91 by the following theorem .",
    "* theorem 3.7 ) [ th : reduction - principal ] let @xmath51 be a cluster algebra over an arbitrary semifield @xmath90 and contained in the ambient field @xmath92 , with a seed at an initial vertex @xmath93 given by @xmath94 then the cluster variables in  @xmath51 can be expressed as follows : @xmath95    an important class of semifields @xmath90 are the _ tropical semifields_.    [ _ tropical semifield _ ]",
    "let @xmath96 be an abelian group ( written multiplicatively ) freely generated by the @xmath97 .",
    "we define @xmath98 in @xmath99 by @xmath100 and call @xmath101 a _ tropical semifield_.    a cluster algebra is of _ geometric type _ whenever @xmath90 is such a semifield .",
    "notice that in this case , the denominator of equation ( [ eq : xjt - reduction - principal ] ) is a monomial .",
    "in this section we fix a bordered surface @xmath1 , an ideal triangulation @xmath61 , and the cluster algebra @xmath84 with principal coefficients with respect to the seed @xmath85 .",
    "we will explain how to associate an element @xmath102 of ( the fraction field of ) @xmath103 to each generalized arc or closed loop @xmath5 in @xmath1 .",
    "our definition of the cluster algebra element associated to a closed loop comes from joint work of the authors together with ralf schiffler @xcite .",
    "each element will be defined as a sum over matchings of a graph . when @xmath5 is an ordinary arc",
    ", @xmath102 recovers the cluster expansion formula for the cluster variable associated to @xmath5 , with respect to @xmath85 @xcite .",
    "[ _ generalized arcs _ ] [ gen - arc ] a _ generalized arc",
    "_ in @xmath1 is a curve @xmath5 in @xmath15 such that : the endpoints of @xmath5 are in @xmath16 ; except for the endpoints , @xmath5 is disjoint from @xmath16 and the boundary of @xmath15 ; @xmath5 does not cut out an unpunctured monogon or an unpunctured bigon . note that we allow a generalized arc to cross itself a finite number of times .",
    "we consider generalized arcs up to isotopy ( of immersed arcs ) .",
    "in particular , an isotopy can not remove a contractible kink from a generalized arc .",
    "[ _ closed loops _ ]",
    "a closed loop in @xmath1 is a closed curve @xmath5 in @xmath15 which is disjoint from @xmath16 and the boundary of @xmath15 .",
    "we allow a closed loop to have a finite number of self - intersections . as in definition",
    "[ gen - arc ] , we consider closed loops up to isotopy .    a closed loop in @xmath1 is called _ essential _ if :    * it is not contractible nor contractible onto a single puncture ; * it does not have self - intersections .",
    "let @xmath17 be a generalized arc in @xmath1 which is not in @xmath3 .",
    "choose an orientation on @xmath17 , let @xmath104 be its starting point , and let @xmath105 be its endpoint .",
    "we denote by @xmath106 the points of intersection of @xmath17 and @xmath3 in order .",
    "let @xmath107 be the arc of @xmath3 containing @xmath108 , and let @xmath109 and @xmath110 be the two ideal triangles in @xmath3 on either side of @xmath107 .    to each @xmath108",
    "we associate a _ tile _ @xmath111 , an edge - labeled triangulated quadrilateral ( see the right - hand - side of figure [ digoncross ] ) , which is defined to be the union of two edge - labeled triangles @xmath112 and @xmath113 glued at an edge labeled @xmath107 .",
    "the triangles @xmath112 and @xmath113 are determined by @xmath109 and @xmath110 as follows .",
    "if neither @xmath109 nor @xmath110 is self - folded , then they each have three distinct sides ( though possibly fewer than three vertices ) , and we define @xmath112 and @xmath113 to be the ordinary triangles with edges labeled as in @xmath109 and @xmath110 .",
    "we glue @xmath112 and @xmath113 at the edge labeled @xmath107 , so that the orientations of @xmath112 and @xmath113 both either agree or disagree with those of @xmath109 and @xmath114 ; this gives two possible planar embeddings of a graph @xmath111 which we call an _",
    "ordinary tile_.    if one of @xmath109 or @xmath110 is self - folded , then in fact @xmath3 must have a local configuration of a bigon ( with sides @xmath28 and @xmath29 ) containing a radius @xmath25 incident to a puncture @xmath66 inscribed inside a loop @xmath24 , see figure [ triptile ] . if @xmath17 has no self - intersection as it passes through the self - folded triangle , then @xmath17 must either    * intersect the loop @xmath24 and terminate at puncture @xmath66 , or * intersect the loop @xmath24 , radius @xmath25 and then @xmath24 again .    in case ( 1 ) , we associate to @xmath108 ( the intersection point with @xmath24 ) an _ ordinary tile _ @xmath111 consisting of a triangle with sides @xmath115 which is glued along diagonal @xmath24 to a triangle with sides @xmath116 . as before there are two possible planar embeddings of @xmath111 .    in case ( 2 ) , we associate to the triple of intersection points @xmath117 a union of tiles @xmath118 , which we call a _ triple tile _ , based on whether @xmath17 enters and exits through different sides of the bigon or through the same side .",
    "these graphs are defined by the first three examples in figure [ triptile ] ( each possibility is denoted in boldface within a concatenation of five tiles ) .",
    "note that in each case there are two possible planar embeddings of the triple tile .",
    "we call the tiles @xmath119 and @xmath120 within the triple tile _ ordinary tiles_.    on the other hand ,",
    "if @xmath17 has a self - intersection inside the self - folded triangle , then the local configuration in the associated graph is as in the last two examples of figure [ triptile ] .",
    "[ def : relative - orientation ] given a planar embedding @xmath121 of an ordinary tile @xmath111 , we define the _ relative orientation _ @xmath122 of @xmath121 with respect to @xmath3 to be @xmath123 , based on whether its triangles agree or disagree in orientation with those of @xmath3 .",
    "note that in figure [ triptile ] , the lowest tile in each of the five graphs in the middle ( respectively , rightmost ) column has relative orientation @xmath124 ( respectively , @xmath125 ) , as indicated by the signs in the figures . also note that by construction , the planar embedding of a triple tile @xmath126 satisfies @xmath127 .    using the notation above , the arcs @xmath107 and @xmath128 form two edges of a triangle @xmath114 in @xmath3 . define @xmath129 to be the third arc in this triangle",
    "if @xmath114 is not self - folded , and to be the radius in @xmath114 otherwise .",
    "we now recursively glue together the tiles @xmath131 in order from @xmath132 to @xmath133 , subject to the following conditions .    1 .",
    "triple tiles must stay glued together as in figure [ triptile ] .",
    "2 .   for two adjacent ordinary tiles",
    ", each of which may be an exterior tile of a triple tile , we glue @xmath120 to @xmath121 along the edges labeled @xmath129 , choosing a planar embedding @xmath134 for @xmath120 so that @xmath135 see figure [ figglue ] .",
    "after glueing together the @xmath133 tiles , we obtain a graph ( embedded in the plane ) , which we denote @xmath136 .",
    "let @xmath137 be the graph obtained from @xmath136 by removing the diagonal in each tile .",
    "we call @xmath137 the _ snake graph _ associated to @xmath5 with respect to @xmath3",
    ". figure [ triptile ] gives examples of a dotted arc @xmath5 and the corresponding graph @xmath136 .",
    "each @xmath5 intersects @xmath3 five times , so each @xmath136 has five tiles .      recall that if @xmath50 is a boundary segment then @xmath138 , and if @xmath50 is a noose cutting out a once - punctured monogon with radius @xmath25 and puncture @xmath66 , then @xmath139 .    [ _ crossing monomial _ ] if @xmath17 is an ordinary arc and @xmath140 is the sequence of arcs in @xmath3 which @xmath17 crosses , we define the _ crossing monomial _ of @xmath5 with respect to @xmath3 to be @xmath141    [ _ perfect matchings and weights_][def : perfect ] a _ perfect matching _ of a graph @xmath142 is a subset @xmath143 of the edges of @xmath142 such that each vertex of @xmath142 is incident to exactly one edge of @xmath143 . if the edges of a perfect matching @xmath143 of @xmath137 are labeled @xmath144 , then we define the _ weight _ @xmath145 of @xmath143 to be @xmath146 .",
    "[ _ minimal and maximal matchings _ ] by induction on the number of tiles it is easy to see that @xmath137 has precisely two perfect matchings which we call the _ minimal matching _ @xmath147 and the _ maximal matching _",
    "@xmath148 , which contain only boundary edges . to distinguish them ,",
    "if @xmath149 ( respectively , @xmath125 ) , we define @xmath150 and @xmath151 to be the two edges of @xmath136 which lie in the counter - clockwise ( respectively , clockwise ) direction from the diagonal of @xmath152 . then @xmath153 is defined as the unique matching which contains only boundary edges and does not contain edges @xmath150 or @xmath151 .",
    "@xmath154 is the other matching with only boundary edges .    for an arbitrary perfect matching @xmath143 of @xmath155 , we let @xmath156 denote the symmetric difference , defined as @xmath157 .",
    "* theorem 5.1 ) [ thm y ] the set @xmath156 is the set of boundary edges of a ( possibly disconnected ) subgraph @xmath158 of @xmath137 , which is a union of cycles .",
    "these cycles enclose a set of tiles @xmath159 , where @xmath160 is a finite index set .",
    "we use this decomposition to define _ height monomials _ for perfect matchings .",
    "note that the exponents in the height monomials defined below coincide with the definition of height functions given in @xcite for perfect matchings of bipartite graphs , based on earlier work of @xcite , @xcite , and @xcite for domino tilings .",
    "[ _ height monomial and specialized height monomial _ ] [ height ] let @xmath161 be an ideal triangulation of @xmath1 and @xmath5 be an ordinary arc of @xmath1 . by lemma [ thm y ] , for any perfect matching @xmath143 of @xmath137 , @xmath162 encloses the union of tiles @xmath159 .",
    "we define the _ height monomial _ @xmath163 of @xmath143 by @xmath164 where @xmath165 is the number of tiles in @xmath159 whose diagonal is labeled @xmath166 .",
    "we define the _ specialized height monomial _",
    "@xmath167 of @xmath143 to be the specialization @xmath168 , where @xmath169 is defined below .",
    "@xmath170    [ e_p ] for an arc @xmath171 and a puncture @xmath66 ,",
    "let @xmath172 denote the number of ends of @xmath50 incident to @xmath66 ( so if both ends of @xmath50 are at @xmath66 , @xmath173 ) . additionally ,",
    "if @xmath5 is a generalized arc or loop , then @xmath174 denotes the number of crossings between @xmath50 and @xmath5 .",
    "[ def : matching ] let @xmath1 be a surface , @xmath61 an ideal triangulation , and @xmath84 be the cluster algebra with principal coefficients with respect to @xmath85 . let @xmath17 be a generalized arc and let @xmath137 denote its snake graph .",
    "we will define a laurent polynomial @xmath102 which lies in ( the fraction field of ) @xmath103 , as well as a laurent polynomial @xmath175 obtained from @xmath102 by specialization .    1 .",
    "if @xmath5 cuts out a contractible monogon , then @xmath176 is equal to zero . 2 .",
    "if @xmath17 has a contractible kink , let @xmath177 denote the corresponding tagged arc with this kink removed , and define @xmath178 .",
    "3 .   otherwise ,",
    "define @xmath179 where the sum is over all perfect matchings @xmath143 of @xmath137 .",
    "define @xmath175 to be the laurent polynomial obtained from @xmath102 by specializing all the @xmath62 to @xmath132 .",
    "* thm 4.9 ) [ thm msw ] use the notation of definition [ def : matching ] .",
    "when @xmath5 is an arc ( with no self - intersections ) , @xmath102 is the laurent expansion of the cluster variable @xmath180 , with respect to the seed @xmath85 , and @xmath175 is its _ f - polynomial_.    in a few cases ( see lemma [ f - polynomial ] ) , the elements @xmath175 may not be polynomials , only laurent polynomials .",
    "however , it s known that a cluster algebra with principal coefficients with respect to the seed @xmath181 is contained in @xmath182 $ ] ( * ? ? ?",
    "* proposition 3.6 ) .",
    "motivated by this fact and also theorem [ th : reduction - principal ] , we see that we should define the cluster algebra element associated to a generalized arc as in definition [ rightdefinition ] .",
    "[ rightdefinition ] let @xmath90 be the tropical semifield @xmath183 .",
    "we define the cluster algebra element @xmath184 associated to a generalized arc by @xmath185    most of the time ( see lemma [ f - polynomial ] ) @xmath175 is a polynomial with constant term @xmath132 , and hence @xmath186 .      by using a variant of the above construction , for each closed loop",
    "@xmath5 we will associate an element of ( the fraction field of ) @xmath103 @xcite .",
    "[ _ band graph corresponding to a closed loop @xmath5 _ ] [ def band ] let @xmath5 be a closed loop in @xmath1 , which may or not have self - intersections , but is not contractible and has no contractible kinks . we pick a triangle @xmath36 traversed by @xmath5 arbitrarily , let @xmath66 be a point in the interior of this triangle which lies on @xmath5 , and let @xmath29 and @xmath187 be the two sides of triangle crossed by @xmath5 immediately before and following its travel through point @xmath66 , respectively .",
    "let @xmath28 be the third side of @xmath36 . note that these definitions make sense even if @xmath36 is self - folded .",
    "we let @xmath188 denote the arc from @xmath66 back to itself that exactly follows closed loop @xmath5 .",
    "see the left of figure [ fig band ] .",
    "we start by building the snake graph @xmath189 as defined above . in the first tile of @xmath189 , let @xmath190 denote the vertex at the corner of the edge labeled @xmath28 and the edge labeled @xmath29 , and let @xmath191 denote the vertex at the other end of the edge labeled @xmath28 .",
    "similarly , in the last tile of @xmath189 , let @xmath192 denote the vertex at the corner of the edge labeled @xmath28 and the edge labeled @xmath187 , and let @xmath193 denote the vertex at the other end of the edge labeled @xmath28 . see the right of figure [ fig band ] .    from @xmath189",
    ", we build @xmath194 , the band graph for the closed loop @xmath5 , by identifying the edges labeled @xmath28 in the first and last tiles so that the vertices @xmath190 and @xmath192 and the vertices @xmath191 and @xmath193 are glued together .",
    "we refer to the two vertices obtained by identification as @xmath190 and @xmath191 , and to the edge obtained by identification as the _",
    "cut edge_. the resulting graph lies on an annulus or a mbius strip .",
    "[ _ good matchings on a band graph _ ] [ def good matching ] let @xmath143 be a perfect matching of a band graph @xmath195 .",
    "we call @xmath143 _ good _ if either @xmath190 and @xmath191 are matched to each other ( @xmath196 and @xmath197 ) or if both edges @xmath198 and @xmath199 lie on one side of the cut edge .",
    "[ descend ] let @xmath195 be a band graph obtained by identifying two edges of the snake graph @xmath142 .",
    "the good matchings of @xmath195 can be identified with a subset of the perfect matchings of @xmath142 .",
    "let @xmath200 be a good matching of @xmath195 .",
    "thinking of @xmath200 as a subset of edges of @xmath142 , then by definition of good we can add to it either the edge @xmath201 or the edge @xmath202 to get a perfect matching @xmath143 of @xmath142 . in this case , we say that the perfect matching @xmath143 of @xmath142 _ descends _ to a good matching @xmath200 of @xmath195 . in particular , the minimal matching of @xmath142 descends to a good matching of @xmath195 , which we also call _ minimal_. ( to see this , just consider the cases of whether @xmath142 has an odd or even number of tiles , and observe that the minimal matching of @xmath142 always uses one of the edges @xmath201 and @xmath202 . )",
    "[ def closed loop]let @xmath1 be a surface , @xmath61 an ideal triangulation , and @xmath84 be the cluster algebra with principal coefficients with respect to @xmath85 .",
    "let @xmath17 be a closed curve .",
    "we define a laurent polynomial @xmath102 which lies in ( the fraction field of ) @xmath103 , as well as a laurent polynomial @xmath175 obtained from @xmath102 by specialization .    1 .",
    "if @xmath17 is a contractible loop , then let @xmath203 .",
    "2 .   if @xmath17 is a closed loop without self - intersections enclosing a single puncture @xmath66 : * if @xmath3 contains a self - folded triangle containing @xmath66 , then let @xmath204 , where @xmath25 is the radius incident to @xmath66 .",
    "* otherwise , let @xmath205 , where @xmath172 is given by definition [ e_p ] . in terms of matchings in a band graph , as below , but this definition in terms of @xmath206 is simpler to compute . ]",
    "if @xmath17 has a contractible kink , let @xmath177 denote the corresponding closed curve with this kink removed , and define @xmath178 .",
    "4 .   otherwise , let @xmath207 where the sum is over all good matchings @xmath143 of the band graph @xmath208 .",
    "define @xmath175 to be the laurent polynomial obtained from @xmath102 by specializing all the @xmath62 to @xmath132 .",
    "[ rightdefinition2 ] we also apply definition [ rightdefinition ] to define the cluster algebra element @xmath184 when @xmath5 is a closed loop .",
    "[ f - polynomial ] if @xmath3 has no self - folded triangles , then for any generalized arc or loop @xmath5 , @xmath175 is a polynomial with constant term @xmath132 .",
    "if @xmath3 has self - folded triangles , then for any arc ( without self - intersections ) or essential loop @xmath5 , @xmath175 is a polynomial with constant term @xmath132 .    by definition , @xmath209 , where the sum is over all matchings ( resp .",
    "good matchings ) of the snake graph ( resp .",
    "band graph ) of @xmath5 . clearly @xmath210 is a polynomial in the variables @xmath211 , with constant term @xmath132 .",
    "the only way that proposition [ f - polynomial ] might fail is if the specialization @xmath169 produces a laurent monomial which is not a monomial , or an extra constant term .",
    "however , whenever @xmath5 is an arc or an essential loop , each time @xmath5 goes through a noose , its local configuration must look like one of the first three diagrams in figure [ triptile ] . by inspection",
    ", it s impossible for the height monomial @xmath163 of a matching @xmath143 of the corresponding band graph to include a contribution from the tile labeled @xmath25 _ without _ also including a contribution from one of the two adjacent tiles labeled @xmath24 .",
    "therefore @xmath168 will never produce a denominator . also , it s impossible for @xmath168 to produce an addition term equal to @xmath132 : such a term would need to have a factor of @xmath212 , but then there would be no way to cancel the numerator @xmath213 .",
    "we end this section with two examples illustrating the computation of @xmath102 .",
    "[ example of a laurent expansion corresponding to a closed loop ] [ exampleband ]    consider the ideal triangulation @xmath3 and closed loop @xmath5 on the left of figure [ fig ex - band ] . in this case , we obtain the band graph @xmath214 appearing on the right of figure [ fig ex - band ] .",
    "we thus compute @xmath215 by specializing @xmath216 .",
    "in particular , @xmath214 has six good matchings , as listed in figure [ fig ex - band2 ] .",
    "[ examples of laurent expansions for generalized arcs through a self - folded triangle ] [ examplefolded ]    consider the ideal triangulation @xmath3 and the generalized arc @xmath217 on the top ( resp .",
    "@xmath218 on the bottom ) on the left of figure [ fig ex - folded ] . in this case",
    ", we obtain the snake graph @xmath219 ( resp .",
    "@xmath220 ) appearing on the right of figure [ fig ex - folded ] .",
    "we thus compute @xmath221 and @xmath222 by specializing @xmath223 , @xmath224 .",
    "notice that in the case of @xmath225 , we obtain a laurent polynomial expansion with a @xmath226 in the denominator . the corresponding algebraic quantity @xmath227 is in fact a _ laurent _ polynomial and not a polynomial in this case .",
    "to obtain the associated cluster algebra element @xmath228 , we follow definition [ rightdefinition ] , and divide @xmath225 by the tropical evaluation of @xmath229 , which is @xmath230 .",
    "this gives us @xmath231 .",
    "in this section we also fix a bordered surface @xmath1 and ideal triangulation @xmath3 of @xmath1 .",
    "we then associate a laurent polynomial to each arc , generalized arc , and closed loop in @xmath1 ; this laurent polynomial represents the corresponding element of the cluster algebra @xmath232 with principal coefficients with respect to the seed @xmath3 .",
    "our formula works by associating a product of matrices to each such arc ( respectively , loop ) , and then computing its upper right entry ( respectively , trace ) .",
    "our formulas are closely related to those given in @xcite and @xcite . in particular , if we set our initial cluster variables equal to @xmath132 , we recover fock and goncharov s _ @xmath233-coordinates _ , and if we set our coefficient variables equal to @xmath132 , we recover their _ @xmath234-coordinates_.    before presenting our formulas , we need to define some _ elementary steps _ , and the matrices associated to them .",
    "( the points @xmath235 , @xmath236 , @xmath237 ) for each marked point @xmath238 , draw a small circle @xmath239 locally around @xmath240 . if @xmath240 is on the boundary of @xmath15 , then we only consider the intersection @xmath241 .",
    "the circles are chosen small enough so that @xmath242 for each pair of distinct marked points @xmath240 and @xmath243 .",
    "for each arc @xmath171 and marked point @xmath238 incident to @xmath50 , we let @xmath235 denote the intersection point @xmath244 . we let",
    "@xmath236 ( resp .",
    "@xmath237 ) denote a point on @xmath239 which is very close to @xmath235 but in the clockwise ( resp .",
    "counterclockwise ) direction from @xmath245 .",
    "see figure [ fig infinitesimal ] .",
    "( elementary steps ) given @xmath1 and @xmath3 , we define three types of _ elementary steps _ , each of which connects two points of the form @xmath246 and @xmath247 .",
    "we also associate a @xmath8 matrix @xmath248 to each elementary step @xmath249 .    *",
    "the first type of step is shown in figure [ fig step12 ] .",
    "we consider two arcs @xmath50 and @xmath250 from @xmath3 which are both incident to a marked point @xmath240 and which form a triangle with third side @xmath251 .",
    "then our first type of step is a curve which travels either clockwise or counterclockwise around @xmath239 between @xmath50 and @xmath250 , without crossing them .",
    "the matrix corresponding to this step is @xmath252 $ ] , where we choose the positive ( resp .",
    "negative ) sign if the step is clockwise ( resp .",
    "counterclockwise ) . *",
    "the second type of step is shown in figure [ fig step34 ] .",
    "this step moves along a circle @xmath239 connecting two points @xmath236 and @xmath237 , so in particular it crosses the arc @xmath50 .",
    "if the step travels clockwise ( resp .",
    "counterclockwise ) , we associate to it the matrix @xmath253 $ ] ( resp . , @xmath254 $ ] ) .",
    "* the third type of step is shown in figure [ fig step56 ] . given two marked points @xmath240 and @xmath243 connected by some @xmath171 , such a step follows a path parallel to @xmath50 , and connects @xmath246 and @xmath255 we associate the matrix @xmath256 $ ] to such a step if @xmath50 lies beneath it ( when we orient the step from left to right ) , and we associate the inverse matrix @xmath257 $ ] to the step otherwise .",
    "@xmath258 $ ] @xmath259 $ ]    @xmath253 $ ] @xmath254 $ ]    @xmath256 $ ] @xmath257 $ ]    [ rem : not_in_sl2 ] note that the two matrices associated to elementary steps of type 1 and elementary steps of type 3 are inverses in @xmath260 . also , the product of the two matrices associated to elementary steps of type 2 is @xmath261 times the identity .",
    "we are now ready to associate a matrix to each generalized arc and closed loop .",
    "( matrix associated to an arc or loop)[matrixforarc ] given @xmath1 , @xmath3 , and a generalized arc @xmath5 in @xmath1 from @xmath262 to @xmath263 , we choose a curve @xmath264 which has the following properties :    * it begins at a point @xmath265 of the form @xmath266 , where @xmath50 is an arc of @xmath3 incident to @xmath262 . *",
    "it ends at a point @xmath267 of the form @xmath268 . *",
    "it is a concatenation of elementary steps , and is isotopic to the portion of @xmath5 between @xmath269 and @xmath270 . *",
    "the intersections of @xmath264 with @xmath3 are in bijection with the intersections of @xmath5 with @xmath3 .    given a closed loop @xmath5 in @xmath1 , we choose a curve @xmath264 which has the following properties :    * it starts and ends at a point @xmath271 which has the form @xmath246 , where @xmath171 is crossed by @xmath5 .",
    "* it is a concatenation of elementary steps , and is isotopic to @xmath5 . *",
    "the intersections of @xmath264 with @xmath3 are in bijection with the intersections of @xmath5 with @xmath3 .    in both cases , we refer to the curve @xmath264 as an _",
    "@xmath16-path_. if @xmath272 is the decomposition of @xmath264 into elementary steps , then we define @xmath273 by convention , the matrix associated to the empty path is the identity matrix .",
    "( reduced matrix associated to an arc or loop ) [ def : reduced_matrix ] as noted in remark [ rem : not_in_sl2 ] , the matrices corresponding to elementary steps of type @xmath274 are not in @xmath260 .",
    "for some applications , it will be more useful to use the matrices @xmath275 \\mathrm{~and~ }   \\left [ \\begin{matrix } { \\mathsf{y}}_{\\tau}^{1/2 } & 0 \\\\ 0 & { \\mathsf{y}}_{\\tau}^{-1/2 } \\end{matrix}\\right]\\ ] ] instead for a step in the clockwise ( resp .",
    "counterclockwise ) direction . in other words",
    ", we divide by @xmath276 for every elementary step of type @xmath274 crossing the arc @xmath50 .",
    "if so , we will let @xmath277 denote the corresponding matrix product in @xmath260 .",
    "clearly @xmath278 and @xmath279 depend on our choice of @xmath264",
    ". however , it turns out that nevertheless , we can read off from them invariants which depends only on @xmath5 .    given a @xmath8 matrix @xmath280 ,",
    "let @xmath281 denote @xmath282 .",
    "let @xmath283 denote the trace of @xmath16 .",
    "[ lem ma ] fix @xmath1 and @xmath3 as usual .",
    "let @xmath217 and @xmath218 be a generalized arc and a closed loop , respectively , with no contractible kinks . then for any two @xmath16-paths @xmath249 and @xmath284 associated to @xmath217 , we have that @xmath285 and for any two @xmath16-paths @xmath249 and @xmath284 associated to @xmath218 , we have that @xmath286 the analogous results also hold for the reduced matrices corresponding to an @xmath16-path .",
    "lemma [ lem ma ] allows us to make the following definitions .",
    "[ def : chi ] let @xmath5 be a generalized arc and @xmath56 be a closed loop , and let @xmath249 and @xmath284 denote arbitrary @xmath16-paths associated to @xmath5 and @xmath56 , respectively .",
    "we associate three ( related ) algebraic quantities to @xmath5 and @xmath56 :    1 .",
    "@xmath287 and @xmath288 .",
    "2 .   @xmath289 and @xmath290 .",
    "3 .   @xmath291 and @xmath292    when @xmath3 has no self - folded triangles , the first and third definitions coincide .",
    "the third definition is the most fundamental , and we will show in section [ sec : matrix = match ] that @xmath293 , where @xmath294 is the sum over matchings which we defined in section [ sect main ] .",
    "the second definition will be used in our proofs of skein relations in section [ sec : skein ] .    [",
    "proof of lemma [ lem ma ] ] consider an @xmath16-path @xmath249 .",
    "first note that the two @xmath16-paths @xmath295 and @xmath296 in figure [ fig infinitesimal ] have the property that @xmath297 ; in other words , they are equal as elements of @xmath298 .",
    "this means that a local adjustment of an @xmath16-path which replaces one segment @xmath295 by another segment @xmath296 will not affect the value of @xmath299 or @xmath300 .",
    "next , note that @xmath301 \\left [ \\begin{matrix } { \\mathsf{y}}_{\\tau } & 0 \\\\      0 & 1 \\end{matrix}\\right ] =   \\left [ \\begin{matrix } 1 & 0 \\\\      0 & { \\mathsf{y}}_{\\tau } \\end{matrix}\\right ] \\left [ \\begin{matrix } 0 & x_{\\tau } \\\\",
    "\\frac{-1}{x_{\\tau } } & 0 \\end{matrix}\\right].$ ] dividing by @xmath276 on both sides also preserves this identity .",
    "this implies that if at some point an @xmath16-path crosses an arc and then travels along that arc , then a local adjustment which switches the order of these two steps will not affect the final value of @xmath299 or @xmath300 .    finally , if @xmath249 is the @xmath16-path for a generalized arc @xmath5 , note that we can change its starting point @xmath302 by choosing the other point @xmath303 which is obtained from @xmath265 by traveling around the circle @xmath304 without crossing any arcs of @xmath3 .",
    "the result will still be an @xmath16-path @xmath284 for @xmath5 , and we will have that @xmath305 where @xmath306 is lower - triangular with @xmath132 s on the diagonal .",
    "therefore @xmath307 .",
    "similarly , we can change the ending point @xmath267 , and we will still have an @xmath16-path @xmath284 for @xmath5 such that @xmath307 .    now",
    "the proof of lemma [ lem ma ] for generalized arcs follows from the fact that any two @xmath16-paths for @xmath5 can be obtained from each other by a combination of the above local adjustments . to complete the proof in the case that @xmath5 is a closed loop , note that choosing a different starting point @xmath271 for the @xmath16-path @xmath249 amounts to circularly re - arranging the matrix product .",
    "the fact that this operation does not affect @xmath300 follows from the identity @xmath308 .",
    "the analogous identities for @xmath309 and @xmath310 also hold .",
    "[ reducedmats ] we can actually strengthen lemma [ lem ma ] in the case of reduced matrices . whenever @xmath249 is an @xmath16-path ( for some generalized arc or closed loop ) from @xmath262 to @xmath263 and @xmath284 is another path from @xmath262 to @xmath263 that is isotopic to @xmath249 ( with possibly some extra intersections with @xmath3 ) , we have that @xmath311 .    our first main result is the following .",
    "[ thm matrix - match ] let @xmath1 be a bordered surface with an ideal triangulation @xmath3 , and let @xmath312 be the corresponding tagged triangulation .",
    "let @xmath89 be the corresponding cluster algebra with principal coefficients with respect to @xmath313 .",
    "* suppose @xmath17 is a generalized arc in @xmath15 without contractible kinks ( this may include a noose ) .",
    "let @xmath137 be the graph constructed in section [ sect graph ] .",
    "then @xmath314 where the sum is over all perfect matchings @xmath143 of @xmath137 . combining this with theorem [ thm msw ]",
    ", it follows that when @xmath5 is an arc , @xmath315 is the laurent expansion of @xmath316 with respect to @xmath85 . *",
    "suppose that @xmath17 is a closed loop which is not contractible , has no contractible kinks , and does not enclose a single puncture .",
    "then @xmath317 where the sum is over all good matchings @xmath143 of the band graph @xmath208 .    comparing our formulas to those of fock and goncharov @xcite , we observe the following .    [ fgxcoord ] fix @xmath1 and @xmath3 .",
    "let @xmath5 be a generalized arc or closed loop , and suppose that it crosses arcs @xmath318 in @xmath3 .",
    "then if we substitute @xmath319 and @xmath320 into @xmath321 , the resulting expression will give the associated @xmath233-coordinates for @xmath5 with respect to @xmath3 .",
    "on the other hand , if we substitute @xmath322 and @xmath323 into @xmath315 , the resulting expression will give the associated @xmath234-coordinate for @xmath5 with respect to @xmath3 .",
    "in the case of @xmath234-coordinates , this result is immediate . comparing our notation with that of fock and goncharov @xcite",
    ", their @xmath14-matrices realize elementary steps of type @xmath132 and their @xmath324-matrices realize elementary steps of type @xmath325 .",
    "( note that when we set @xmath323 , a matrix corresponding to an elementary step of type @xmath274 is the identity matrix . )    to obtain their formula for @xmath233-coordinates we coarsen our vertex structure on @xmath1 by using the subset @xmath326 consisting only of the @xmath237 s .",
    "we thereby get a coarsened graph which contains a triangle ( as opposed to a hexagon ) for each triangle of the triangulation @xmath3 and a single edge ( as opposed to two edges ) crossing each @xmath171",
    ". see figure [ fig fg - xcoord ] .",
    "any @xmath16-path from @xmath327 to @xmath328 can be decomposed into quasi - elementary steps , each of which goes between vertices of @xmath326 .",
    "one possible quasi - elementary step combines a ( counterclockwise ) step of type @xmath132 followed by a step of type @xmath325 .",
    "we obtain    @xmath329   \\left[\\begin{matrix }   1 & 0 \\\\ -1 & 1 \\end{matrix}\\right ] = \\left [ \\begin{matrix } -1 & 1 \\\\ -1 & 0 \\end{matrix}\\right ] .\\ ] ]    the other possible quasi - elementary step crosses an arc @xmath330 and combines a step of @xmath274 and a step of type @xmath325 ( in the positive direction ) .",
    "these steps correspond to the matrices @xmath331   \\left[\\begin{matrix }   1 & 0 \\\\ 0 & x_\\tau \\end{matrix}\\right ] =   \\frac{1}{\\sqrt{x_\\tau } } \\cdot   \\left[\\begin{matrix }   x_\\tau & 0 \\\\ 0 & 1 \\end{matrix}\\right ]",
    "\\left [ \\begin{matrix } 0 & 1 \\\\ -1 & 0 \\end{matrix}\\right ] =    \\left [ \\begin{matrix } 0 & \\sqrt{x_\\tau } \\\\ -\\frac{1}{\\sqrt{x_\\tau } } & 0 \\end{matrix}\\right],\\ ] ] where we have divided by @xmath332 as our @xmath16-path transverses @xmath330 , which is crossed by the arc @xmath5 .    note that the matrix @xmath333 differs slightly from the matrix @xmath334 $ ] used by fock and goncharov .",
    "we will utilize the matrix equality @xmath335 \\left [ \\begin{matrix }   - a_2 &   b_2 \\\\",
    "c_2 & - d_2\\end{matrix}\\right ] = - \\left [ \\begin{matrix } -(a_1 a_2 + b_1 c_2 ) & ( a_1 b_2 + b_1 d_2 ) \\\\",
    "( c_1 a_2 + d_1 c_2 ) & - ( c_1 b_2 + d_1 d_2 ) \\end{matrix}\\right],\\ ] ] which indicates how the matrix product changes if we negate the diagonal entries of the constituent matrices .",
    "as our formulas for @xmath336 only involve matrix products consisting of @xmath333 , @xmath337 , and the anti - diagonal matrices @xmath338 , we have by induction that the absolute values of the upper right entries and traces of these matrix products agree with the formulas for @xmath233-coordinates in section 4.1 of @xcite .",
    "theorem [ thm matrix - match ] immediately implies the following .",
    "[ pos ] the quantity @xmath315 is a laurent polynomial with all coefficients positive .    in the case that each @xmath323 , corollary [ pos ] was also proved by fock and goncharov in ( * ? ? ?",
    "* section 12.2 ) .",
    "in this section we will prove theorem [ thm matrix - match ] .",
    "we will start by giving two general combinatorial results in section [ comb - matching ] about how one can enumerate matchings of ( abstract ) snake and band graphs using appropriate products of @xmath8 matrices , and then apply these results in the case that the snake and band graphs come from arcs and loops in a surface .",
    "[ abstractsnake ] an _ abstract snake graph _ with @xmath133 tiles is formed by concatenating the following _ puzzle pieces _ :    * an _ initial triangle _ * @xmath339 _ parallelograms _ @xmath340 , where each @xmath341 is either + ( a _ north - pointing _ or _ east - pointing _ parallelogram ) * a _ final triangle _ , based on whether @xmath133 is odd or even .",
    "we then erase all diagonal edges ( those with slope @xmath125 ) from the figure .",
    "[ abstractband ] an _ abstract band graph _ with @xmath133 tiles is formed by concatenating the following _ puzzle pieces _ :    * an _ initial triangle _ * @xmath339 _ parallelograms _ @xmath340 , where each @xmath341 is as before . * a _ final triangle _ , based on whether @xmath133 is odd or even .",
    "we then identify the edges @xmath28 and @xmath342 , the vertices @xmath190 and @xmath192 , and the vertices @xmath191 and @xmath193 .",
    "finally , we erase all diagonal edges ( those with slope @xmath125 ) from the figure .    just as in definitions",
    "[ def : perfect ] and [ def good matching ] , we can consider the perfect matchings of an abstract snake graph and the good matchings of an abstract band graph .",
    "additionally , we can use definitions [ def : perfect ] and [ height ] to associate to each perfect matching @xmath143 of an abstract snake graph and to each good matching @xmath143 of an abstract band graph its _ weight _ and _ height _ monomials @xmath145 and @xmath163 .",
    "[ abstractmatrix ] let @xmath142 be an abstract snake or band graph with @xmath133 tiles .",
    "we will associate to @xmath142 a matrix @xmath343 .",
    "first we define some matrices @xmath344,  ,@xmath345 , where each @xmath346 is either @xmath347 $ ] or @xmath348 $ ] , subject to the following conditions :    * @xmath344 is of the first type if @xmath349 is a north - pointing parallelogram , and otherwise it is of the second type ; * for @xmath350 , @xmath346 is of the first type if both @xmath351 and @xmath352 have the same shape , and otherwise , it is of the second type .    finally , if @xmath353 , we set @xmath354,$ ] and otherwise , we set @xmath355 .",
    "a main result of this section is the following .    [ match1 ] suppose that @xmath142 is an abstract snake graph with @xmath133 tiles .",
    "then its perfect matching enumerator is given by @xmath356   m_d \\left[\\begin{matrix } 0 & x_a \\\\ -\\frac{1}{x_a } & \\frac{x_b}{x_{i_1}}\\end{matrix}\\right ] \\bigg),\\ ] ] where the sum is over all perfect matchings of @xmath142 .",
    "now suppose that @xmath142 is an abstract band graph with @xmath133 tiles .",
    "then its good matching enumerator is given by @xmath357 m_d \\bigg),\\ ] ] where the sum is over all good matchings of @xmath142 .",
    "the main step towards proving theorem [ match1 ] is the following .",
    "[ prop : abstractmatrixelts ] let @xmath142 be an abstract snake graph with @xmath133 tiles . write @xmath358 $ ]",
    ". then we have @xmath359 where @xmath360 , @xmath361 , @xmath362 , and @xmath363 are the sets of perfect matchings of @xmath142 which use the edges @xmath364 ; @xmath365 ; @xmath366 ; and @xmath367 , respectively .",
    "the proof of this proposition is straightforward , using induction on @xmath133 , and considering what happens as one adds one more tile to a snake graph .",
    "when @xmath353 , the graph @xmath142 consists of an initial triangle glued to a final triangle , set @xmath368 , sets @xmath361 , @xmath362 are empty , and set @xmath369 .",
    "thus the base case , where @xmath370 equals the @xmath274-by-@xmath274 identity matrix , holds .    for @xmath371 , we let @xmath372 denote the graph obtained by gluing together the initial triangle , parallelograms @xmath373 , and the final triangle . for convenience , we label the final triangle in @xmath372 with @xmath374 and @xmath375 , and note that the orientation of this triangle depends on whether @xmath376 is odd or even . by changing edge labels , we observe that the graph @xmath372 is isomorphic to the subgraph of @xmath142 consisting of the first @xmath376 tiles .",
    "in particular ,",
    "we either replace the edge label @xmath374 with @xmath377 and @xmath375 with @xmath378 , or vice - versa . in the first case , we have bijections between the following pairs of perfect matchings :    * @xmath379 , * @xmath380 , * @xmath381 , and * @xmath382 .",
    "see figures [ figgg ] and [ gg - matrix ] . in the second case",
    ", we have bijections between the following pairs of perfect matchings :    * @xmath383 , * @xmath384 , * @xmath385 , and * @xmath386 .",
    "note that the set @xmath360 contains the minimal matching of @xmath142 , while @xmath363 contains the maximal matching .",
    "consequently , by altering the weights and heights accordingly , we obtain @xmath387   = \\left[\\begin{matrix } 1 & 0 \\\\ \\frac{x_{a_{d-1}}}{x_{i_{d-1}}x_{i_{d } } } & { \\mathsf{y}}_{i_{d-1 } } \\end{matrix}\\right ]   \\left[\\begin{matrix } a_{d-1 } & b_{d-1 } \\\\",
    "c_{d-1 } & d_{d-1 } \\end{matrix}\\right]\\ ] ] in the first case , and we obtain @xmath388   = \\left[\\begin{matrix } \\frac{x_{i_{d}}}{x_{i_{d-1 } } } & x_{a_{d-1 } } { \\mathsf{y}}_{i_{d-1 } } \\\\ 0 & \\frac{x_{i_{d-1 } } { \\mathsf{y}}_{i_{d-1}}}{x_{i_{d } } } \\end{matrix}\\right ] \\left[\\begin{matrix } a_{d-1 } & b_{d-1 } \\\\ c_{d-1 } & d_{d-1 } \\end{matrix}\\right]\\ ] ] in the second case . comparing these equations with the definition of matrix @xmath345",
    ", we see that the two cases agree with the two cases in definition [ abstractmatrix ] .",
    "we have the following immediate corollary of proposition [ prop : abstractmatrixelts ] .",
    "[ cor : permatch ] let @xmath142 be an abstract snake graph with @xmath133 tiles .",
    "write @xmath358 $ ]",
    ". then @xmath389    \\left[\\begin{matrix } a_d & b_d \\\\ c_d & d_d \\end{matrix}\\right ] \\left[\\begin{matrix } 0 & x_a \\\\ -\\frac{1}{x_a } & \\frac{x_b}{x_{i_1}}\\end{matrix}\\right ] \\bigg),\\end{aligned}\\ ] ] where the sum at the left is over all perfect matchings of @xmath142 .",
    "proposition [ prop : abstractmatrixelts ] also implies the following .",
    "[ prop : abstractbandelts ] let @xmath142 be an abstract snake graph with @xmath133 tiles , but with a labeling obtained by substituting @xmath390 for @xmath391 , @xmath342 for @xmath392 , and @xmath378 for @xmath29 ( the same labeling which is used for a band graph ) .",
    "write @xmath358 $ ]",
    ". then we have @xmath393 where @xmath360 , @xmath361 , @xmath362 , and @xmath363 are the sets of perfect matchings of @xmath142 which respectively use the edges @xmath28 and @xmath390 from the first and last triangle , @xmath378 and @xmath390 from the first and last triangle , @xmath28 and @xmath342 from the first and last triangle , and @xmath378 and @xmath342 from the first and last triangle .",
    "[ band - formula ] let @xmath142 be an abstract band graph with @xmath133 tiles . write @xmath358 $ ]",
    ". then @xmath394   \\left[\\begin{matrix } a_d & b_d \\\\ c_d & d_d \\end{matrix}\\right ] \\bigg),\\end{aligned}\\ ] ] where the sum at the left is over all good matchings of @xmath142 .",
    "note that corollary [ cor : permatch ] and corollary [ band - formula ] immediately imply the first and second parts of theorem [ match1 ] .",
    "consider the sets of matchings @xmath360 , @xmath361 , @xmath362 and @xmath363 which were defined in proposition [ prop : abstractbandelts ] .",
    "let @xmath142 be the snake graph from proposition [ prop : abstractbandelts ] , and let @xmath195 denote the band graph obtained from @xmath142 by identifying edge @xmath28 and @xmath342 .",
    "note that every perfect matching of @xmath142 in @xmath360 ( respectively , @xmath362 and @xmath363 ) descends to a good matching of @xmath195 if we remove the edge @xmath28 ( respectively , @xmath28 and @xmath342 ) from it .",
    "moreover , every good matching of @xmath195 can be obtained uniquely from one of the sets @xmath360 , @xmath362 , and @xmath363 .",
    "( on the other hand , no matching @xmath143 from @xmath361 can give rise to a good matching of @xmath195 . )",
    "this completes the proof .      to facilitate the proof of theorem [ thm matrix - match ]",
    ", we will associate to each arc @xmath5 a _ _",
    "s__tandard @xmath16-path @xmath264 , and show that the matrix formula coming from that @xmath16-path has the same form as from corollary [ cor : permatch ] .",
    "[ def : standard ] let @xmath5 be a generalized arc that goes from point @xmath143 to point @xmath395 , crossing the arcs @xmath396 in order .",
    "label the first triangle @xmath397 that @xmath5 crosses with sides @xmath28 , @xmath29 , and @xmath398 in clockwise order so that @xmath143 is the intersection of the arcs @xmath28 and @xmath29 ; and label the last triangle @xmath399 crossed with sides @xmath391 , @xmath392 , and @xmath400 in clockwise order , with @xmath395 being the intersection of the arcs @xmath391 and @xmath392 .",
    "see figure [ retracted ] .    or    we define @xmath264 so that it starts and ends at points @xmath401 and @xmath402 , where the sign is chosen so that the starting and ending points lie inside the triangles @xmath397 and @xmath399 . the path @xmath264 starts with an elementary step of type 3 along arc @xmath28 , followed by a step of type 1 between arcs @xmath28 and @xmath398 .",
    "the segment we have defined so far ends at a point of the form @xmath403 ( and does not cross @xmath398 ) .",
    "subsequently , we define the sequence of elementary steps in @xmath264 based on whether the arc @xmath128 lies clockwise or counterclockwise from the arc @xmath107 in the unique triangle containing the corresponding segment of @xmath264 .",
    "if it is counterclockwise , we proceed with the definition of @xmath264 by adding an elementary step of type 2 which crosses @xmath107 and then a step of type 1 between @xmath107 and @xmath128 . if the orientation is clockwise , we again begin with a step of type 2 which crosses @xmath107 , however , we then have a step of type 1 between @xmath107 and @xmath129 .",
    "we then follow a step of type 3 in the positive direction along @xmath129 , succeeded by a step of type 1 between @xmath129 and @xmath128 . in both of these cases ,",
    "we do not cross or touch @xmath128 .",
    "this progression keeps the path in the same relative position after each double or quadruple step , and as a consequence , we can iterate our construction .",
    "see figure [ trans ] .",
    "after @xmath376 transitions as in figure [ trans ] , the path is at a point @xmath404 , on the side closer to the arc labeled @xmath392 , and is about to cross @xmath400 .",
    "we then add an elementary step of type 2 which crosses @xmath400 , a step of type 1 , and then a step of type 3 which travels along @xmath392 to the point @xmath402 .",
    "we call this particular @xmath16-path @xmath264 the _ standard @xmath16-path associated to @xmath5_.    we remark that in the above definition , if there are three arcs @xmath107 , @xmath128 , and @xmath405 such that @xmath128 is in the clockwise direction from @xmath107 and @xmath405 is in the clockwise direction from @xmath128 , then the standard @xmath16-path @xmath264 will have some back - tracking : there will be two consecutive steps of type 3 which travel in opposite directions along @xmath128 .    let @xmath5 be a closed loop which crosses exactly @xmath133 arcs of @xmath3 ( counted with multiplicity ) .",
    "choose a triangle @xmath36 in @xmath3 such that two of its arcs are crossed by @xmath5 .",
    "label those two arcs @xmath398 and @xmath400 , where @xmath398 is in the clockwise direction from @xmath400 .",
    "label the third side of @xmath36 by @xmath28 .",
    "let @xmath66 be a point on @xmath5 which lies in @xmath36 and has the form @xmath406 .",
    "finally , let @xmath396 denote the ordered sequence of arcs which are crossed by @xmath5 , when one travels from @xmath66 away from @xmath36 .",
    "we define the _",
    "standard @xmath16-path @xmath264 associated to @xmath5 _ exactly as in definition [ def : standard ] , starting and ending at the point @xmath66 and travelling along elementary steps based on whether @xmath128 is counterclockwise or clockwise from @xmath107 . in this case",
    ", we need to consider indices modulo @xmath35 : note that the last elementary steps of @xmath264 will be determined by the fact that the arc @xmath390 is in the clockwise direction from @xmath378 .",
    "see figure [ retracted2 ] .",
    "we now turn to the proof of theorem [ thm matrix - match ] .",
    "first we consider the case that @xmath5 is a generalized arc .",
    "consider its standard @xmath16-path @xmath264 , and recall definition [ matrixforarc ] , which gives an algorithm for associating a product of matrices to a concatenation of elementary steps such as @xmath264 .",
    "note that the first two steps of this path correspond to the matrix product @xmath407\\left[\\begin{matrix } 0 & x_a \\\\ -\\frac{1}{x_a } & 0 \\end{matrix}\\right ] = \\left[\\begin{matrix } 0 & x_a \\\\ -\\frac{1}{x_a } & \\frac{x_b}{x_{i_1}}\\end{matrix}\\right],\\ ] ]    and the last three steps of @xmath264 correspond to @xmath408   \\left[\\begin{matrix } 1 & 0 \\\\ \\frac{x_w}{x_{i_d } x_z } & 1 \\end{matrix}\\right ] \\left[\\begin{matrix } 1 & 0 \\\\ 0 & { \\mathsf{y}}_{i_d } \\end{matrix}\\right ] = \\left[\\begin{matrix } \\frac{x_w}{x_{i_d } } & x_z { \\mathsf{y}}_{i_d } \\\\",
    "-\\frac{1}{x_z } & 0 \\end{matrix}\\right].\\ ] ]      applying definition [ matrixforarc ] to @xmath264 , we find that @xmath411   \\left[\\begin{matrix } a & b \\\\ c & d \\end{matrix}\\right ] \\left[\\begin{matrix } 0 & x_a \\\\ -\\frac{1}{x_a } & \\frac{x_b}{x_{i_1}}\\end{matrix}\\right]\\bigg),\\ ] ] where the middle matrix is obtained by multiplying together a sequence of matrices of the form @xmath412 \\mathrm{~~or~~ } \\left[\\begin{matrix } \\frac{x_{i_{j+1}}}{x_{i_j } } & x_{a_j } { \\mathsf{y}}_{i_j } \\\\ 0 & \\frac{x_{i_j } { \\mathsf{y}}_{i_j}}{x_{i_{j+1 } } } \\end{matrix}\\right],\\ ] ] for @xmath409 .    note that this has precisely the same form as , and therefore by corollary [ cor : permatch ] , @xmath413 has an interpretation in terms of the perfect matchings of some abstract snake graph @xmath142 . moreover , if one compares definitions [ abstractsnake ] and [ abstractmatrix ] with the construction of snake graphs associated to arcs in section [ sect graph ] , it is clear that the abstract snake graph @xmath142 is precisely the snake graph @xmath155 associated to the arc @xmath5 .",
    "this completes the proof of theorem [ thm matrix - match ] when @xmath5 is a generalized arc .",
    "now we consider the case that @xmath5 is a closed loop .",
    "consider its standard @xmath16-path @xmath264 .",
    "note that as before , for @xmath414 from @xmath132 to @xmath339 , the matrix for the portion of the path from @xmath107 to @xmath128 corresponds respectively to or , depending on whether @xmath128 lies counterclockwise or clockwise from @xmath107 .",
    "since @xmath398 is in the clockwise direction from @xmath400 ( by construction ) , the last few steps of @xmath264 correspond to @xmath415.$ ]    therefore from definition [ matrixforarc ] we have that @xmath416   \\left[\\begin{matrix } a & b \\\\ c & d \\end{matrix}\\right ] \\bigg),\\ ] ] where the rightmost matrix is obtained by multiplying together a sequence of matrices of the form @xmath412 \\mathrm{~~or~~ } \\left[\\begin{matrix } \\frac{x_{i_{j+1}}}{x_{i_j } } & x_{a_j } { \\mathsf{y}}_{i_j } \\\\ 0 & \\frac{x_{i_j } { \\mathsf{y}}_{i_j}}{x_{i_{j+1 } } } \\end{matrix}\\right],\\ ] ] for @xmath409 .    note",
    "that this has precisely the same form as the expression in corollary [ band - formula ] , and therefore it follows that @xmath413 has an interpretation in terms of the good matchings of some abstract band graph @xmath142 .",
    "moreover , if one compares definitions [ abstractband ] and [ abstractmatrix ] with the construction of band graphs associated to arcs in definition [ def band ] , it is clear that the abstract band graph @xmath142 is precisely the band graph @xmath417 associated to the arc @xmath5 .",
    "this completes the proof of theorem [ thm matrix - match ] .",
    "consider the loop @xmath5 and ideal triangulation as in example [ exampleband ] .",
    "note that the standard @xmath16-path @xmath418 for this @xmath5 is illustrated in figure [ retracted2 ] , where the arcs of triangulation are labelled slightly differently .    using the arc labels from figure [ fig ex - band ] , we see in this case that @xmath419 , where @xmath420   \\left [ \\begin{matrix } \\frac{x_{4}}{x_{3 } } & b_3 { \\mathsf{y}}_{3 } \\\\ 0 & \\frac{x_{3}{\\mathsf{y}}_{3}}{x_{4 } } \\end{matrix}\\right ] \\left [ \\begin{matrix } 1 & 0 \\\\ \\frac{b_4}{x_{2}x_{3 } } & { \\mathsf{y}}_{2 } \\end{matrix}\\right ] \\left [ \\begin{matrix } 1 & 0 \\\\ \\frac{b_1}{x_{1}x_{2 } } & { \\mathsf{y}}_{1 } \\end{matrix}\\right ] \\\\ & = &   \\left[\\begin{matrix } \\frac{x_1 ^ 2x_2x_4 + { \\mathsf{y}}_3x_1",
    "^ 2b_1b_4 + { \\mathsf{y}}_3{\\mathsf{y}}_4x_1x_3b_2b_4 + { \\mathsf{y}}_2{\\mathsf{y}}_3x_1x_3b_1b_3 + { \\mathsf{y}}_2{\\mathsf{y}}_3{\\mathsf{y}}_4x_3 ^ 2b_1b_2}{x_1x_2x_3x_4 } & \\frac{{\\mathsf{y}}_1{\\mathsf{y}}_2{\\mathsf{y}}_3(x_1b_3 + { \\mathsf{y}}_4x_3b_2)}{x_4}\\\\ \\frac{{\\mathsf{y}}_3{\\mathsf{y}}_4(x_1b_4 + { \\mathsf{y}}_2x_3b_1)}{x_1 ^ 2x_2 } & \\frac{{\\mathsf{y}}_1{\\mathsf{y}}_2{\\mathsf{y}}_3{\\mathsf{y}}_4x_3}{x_1 } \\end{matrix}\\right ] .\\end{aligned}\\ ] ] computing the trace of this matrix product , we see that @xmath176 and @xmath421 agree .",
    "the last equality follows from the absence of self - folded triangles in the triangulation @xmath3 and the fact that the @xmath422 s label boundary segments .",
    "recall that the signs of three algebraic quantities defined in the last section , definition [ def : chi ] , depended on the choice of the @xmath16-path @xmath249 associated to the generalized arc or loop @xmath5 .",
    "[ standard - sign ] if we use the standard @xmath16-path , definition [ def : standard ] , for the generalized arc or loop @xmath5 with no contractible kinks , then every coefficient of @xmath423 , @xmath321 , and @xmath315 is positive .    for the purposes of this lemma , we consider a contractible loop @xmath5 to contain a _",
    "contractible kink_. in particular , note that in this case that the signs of the three quantities are _ negative _ :",
    "@xmath424\\right ) = -2 $ ] for such a loop .",
    "given @xmath5 , which is a generalized arc or loop which has no contractible kinks , let @xmath264 denote a corresponding standard @xmath16-path . by inspection , the matrices @xmath278 and @xmath279 can be decomposed into a product of matrices where almost all entries are positive .",
    "the only negative entries appearing are the lower - left entries of the first and third matrices in ; these entries do not affect the upper - right entry of this triple product . in the case when @xmath5 is a loop , we use instead , where no negative entries appear .    if @xmath249 is a _ non - standard _",
    "@xmath16-path for the generalized arc or loop @xmath5 , then @xmath249 can be deformed into a standard @xmath16-path @xmath264 by the local adjustments utilized in the proof of lemma [ lem ma ] :    1 .",
    "going from @xmath425 to @xmath426 in figure [ fig infinitesimal ] clockwise instead of counterclockwise , 2 .   reversing the order of a step of type 2 crossing an arc @xmath427 and a step of type 3 moving along the arc @xmath40 , 3 .   rotating around an @xmath239 using a combination of steps of types 1 and 2 , 4 .   reselecting the starting or ending point of the @xmath16-path corresponding to a closed loop .",
    "each local adjustment of type ( 1 ) or ( 2 ) changes the sign of the corresponding matrix but does not otherwise affect the matrix .",
    "the local adjustments of type ( 3 ) and ( 4 ) does not affect @xmath428 or @xmath429 of the resulting matrix product .",
    "in this section we prove certain _ skein relations _ , which give multiplication formulas for the cluster algebra elements corresponding to generalized arcs and loops , i.e. arcs and loops which are allowed to have self - intersections .",
    "we work in the setting of principal coefficients . to prove these results",
    ", we use the matrix formulas from section [ sec matrix ] .",
    "the proofs of skein relations then follow from the matrix identities in lemma [ matrix - identity ] . throughout this section",
    "we fix a marked surface @xmath1 , an ideal triangulation @xmath61 , and the cluster algebra @xmath430 which has principal coefficients with respect to @xmath3 .",
    "we define the _ smoothing of @xmath432 or @xmath433 at the point @xmath190 _ to be the pair of configurations @xmath434 and @xmath435 , where @xmath434 ( respectively , @xmath435 ) is the same as @xmath436 except for the local change that replaces the crossing or self - intersection @xmath437 with the pair of segments @xmath438 ( resp . , @xmath439 ) .",
    "note that in the case that two generalized arcs cross , each resulting configuration contains two generalized arcs ; if two closed loops cross , each resulting configuration contains only a single closed loop ( necessarily with self - intersections ) ; and if a generalized arc and a closed loop cross , then each configuration is a single generalized arc .",
    "when a self - intersection is smoothed , one of the two resulting configurations has an extra closed loop .",
    "see figures [ fig : orient ] , [ skein3figure ] , and [ skein5figure ] .",
    "when @xmath1 is a surface without punctures , there are simple formulas for the skein relations . however , the formulas are somewhat more complicated to write down in the presence of punctures . for this reason , we start by writing down the formula in the unpunctured case , and give the appropriate generalization ( together with proofs of all results ) in section [ withpunctures ] .",
    "[ elem - laminate ]",
    "let @xmath5 be an arc in an unpunctured surface @xmath1 .",
    "denote by @xmath440 the curve which runs along @xmath5 within a small neighborhood of it .",
    "such a curve is known as the _ elementary lamination _ associated to @xmath5 , see ( * ? ? ?",
    "* definition 16.2 ) .",
    "if @xmath5 has an endpoint @xmath28 on a ( circular ) component @xmath436 of the boundary of @xmath15 , then @xmath440 begins at a point @xmath441 located near @xmath28 in the counterclockwise direction , and proceeds along @xmath5 as shown in figure [ laminate ] .",
    "in particular , if @xmath61 , then we let @xmath442 denote @xmath443 .    [ up : skein1 ] let @xmath217 and @xmath218 be two generalized arcs which intersect each other at least once ; let @xmath190 be a point of intersection ; and let @xmath444 , @xmath445 and @xmath446 , @xmath447 be the two pairs of arcs obtained by smoothing @xmath217 and @xmath218 at @xmath190 .",
    "we then obtain the following identity : @xmath448 where @xmath449 , @xmath450 , and @xmath451 .",
    "[ up : skein2 ] let @xmath217 be a generalized arc or loop and let @xmath218 be a generalized loop , such that @xmath217 and @xmath218 intersect each other ; let @xmath190 be a point of intersection .",
    "let @xmath11 and @xmath12 be the two oriented generalized arcs or loops obtained by _ smoothing _ @xmath217 and @xmath218 at @xmath190 , as in figure [ skein3figure ] .",
    "@xmath452 where @xmath453 , @xmath454 , and @xmath455 .",
    "[ up : skein3 ] let @xmath5 be a generalized arc or closed loop with a self - intersection at @xmath190 .",
    "let @xmath444 , @xmath445 , and @xmath12 be the generalized arcs and loops obtained by _ smoothing _ at @xmath190 , as in figure [ skein5figure ] .",
    "then we have the identity @xmath456 where @xmath453 , @xmath457 , and @xmath455 .",
    "[ rem : no - self - folded ] for technical reasons we assume in this section that the ideal triangulation @xmath3 has no self - folded triangles . in particular , when there is a self - folded triangle , we can not use the dictionary between signed intersection numbers and transverse measures that is described below in remark [ ft - dict ] .",
    "[ signed - exc ] let @xmath464 be a loosened @xmath16-path .",
    "we define the _ signed excess _ of @xmath458 with respect to the arc @xmath427 as @xmath465 we also make the convention that if @xmath11 is a closed loop , then @xmath466 .      by definition",
    "[ loosened ] , the matrix @xmath468 associated to a loosened @xmath16-path @xmath469 can be decomposed as a product @xmath470 , where @xmath460 and @xmath461 consist only of steps of types 1 and 2 .",
    "therefore @xmath471 and @xmath472 are lower - triangular matrices in @xmath260 , so we obtain @xmath473 \\overline{m}(\\rho_\\gamma )   \\left [ \\begin{matrix } \\prod_{i=1}^n { \\mathsf{y}}_i^{a_i/2 } & 0 \\\\ * & \\prod_{i=1}^n { \\mathsf{y}}_i^{-a_i/2 } \\end{matrix}\\right ] \\right)\\right| \\\\   & = &   |\\operatorname{ur}\\left(\\overline{m}(\\rho_{\\gamma})\\right)| \\prod_{i=1}^n { \\mathsf{y}}_i^{b_i/2-a_i/2 } = \\overline{\\chi}_{\\gamma , t }   \\prod_{i=1}^n { \\mathsf{y}}_i^{\\frac{-\\tilde{\\ell}(\\tilde{\\rho}_{\\gamma } , \\tau_i)}{2}}.\\end{aligned}\\ ] ] here , the last equality follows from definition [ signed - exc ] .    for convenience , we also record the following identities involving @xmath8 matrices .",
    "if @xmath240 is a @xmath8 matrix , let @xmath474 denote its upper right entry , and @xmath475 denote its trace .",
    "these identities will be used to prove skein relations involving reduced matrices associated to generalized arcs and loops ( as in definition [ def : reduced_matrix ] ) .",
    "[ prop : skein1 ] let @xmath217 and @xmath218 be two generalized arcs which intersect each other at least once ; let @xmath190 be a point of intersection ; and let @xmath444 , @xmath445 and @xmath446 , @xmath447 be the two pairs of arcs obtained by smoothing @xmath217 and @xmath218 at @xmath190 , as in figure [ fig : orient ] .",
    "in particular , we choose orientations and label these four arcs so that : @xmath480    we then construct standard @xmath16-paths ( definition [ def : standard ] ) @xmath481 from @xmath482 to @xmath483 and @xmath484 from @xmath485 to @xmath486 .",
    "we let @xmath487 be a loosened @xmath16-path from @xmath486 to @xmath482 that extends a standard @xmath16-path corresponding to @xmath446 .",
    "finally , we choose loosened @xmath16-paths @xmath488 and @xmath489 so that @xmath490 we then obtain the following identity : @xmath491    [ prop : skein2 ] let @xmath217 be a generalized arc or loop and let @xmath218 be a generalized loop , such that @xmath217 and @xmath218 intersect each other ; let @xmath190 be a point of intersection .",
    "let @xmath11 and @xmath12 be the two oriented generalized arcs or loops obtained by _ smoothing _ @xmath217 and @xmath218 at @xmath190 , as in figure [ skein3figure ] .",
    "we construct standard @xmath16-paths @xmath492 and @xmath493 , respectively , so that they intersect at some @xmath494 .",
    "we let @xmath495 be the first portion of the @xmath16-path @xmath492 ( up until @xmath246 ) , and @xmath496 be the second portion ; if @xmath217 is a loop , then we let @xmath496 denote the empty path . we then choose loosened @xmath16-paths ( or just @xmath16-paths when @xmath217 is a closed loop ) @xmath497 and @xmath498 for @xmath11 and @xmath12 such that @xmath499 , and @xmath500 .",
    "we have the identity @xmath501    [ prop : skein3 ] let @xmath5 be a generalized arc or closed loop with a self - intersection at @xmath190 .",
    "let @xmath444 , @xmath445 , and @xmath12 be the generalized arcs and loops obtained by _ smoothing _ at @xmath190 , as in figure [ skein5figure ] . construct the standard @xmath16-path @xmath418 for @xmath5 , and write it as @xmath502 , where the subpaths meet at point @xmath190 .",
    "( if @xmath5 is a loop , we let @xmath503 be the empty path . )",
    "we define an @xmath16-path @xmath504 , and choose loosened @xmath16-paths @xmath505 and @xmath506 which are isotopic to @xmath507 and @xmath508 , respectively .",
    "then we have the identity @xmath509      we start by proving proposition [ prop : skein1 ] .",
    "let @xmath510 , @xmath511 , and @xmath512 . by and remark [ reducedmats ] ,",
    "we have that @xmath513 by , it follows that @xmath514 applying lemma [ skein - subs ] to each of @xmath515 , and @xmath489 , and substituting into the above equation , we obtain , as desired .",
    "we now prove proposition [ prop : skein2 ] .",
    "let @xmath516 , @xmath517 , and @xmath518 . in the case that @xmath217 is a loop , @xmath11 and @xmath12 are also loops , and @xmath519 for any arc @xmath427 .",
    "since in this case , @xmath497 and @xmath498 are @xmath16-paths ( not loosened @xmath16-paths ) , we obtain immediately from . in the case",
    "that @xmath217 is a generalized arc , we have that @xmath497 and @xmath498 are loosened @xmath16-paths , so we apply lemma [ skein - subs ] to @xmath520 and @xmath521 .",
    "we then obtain from .",
    "the proof of proposition [ prop : skein3 ] is analogous .",
    "we set @xmath522 @xmath523 and @xmath524 .",
    "if @xmath5 is a generalized arc , then from we have that @xmath525 and if @xmath5 is a closed loop , then from we have that @xmath526 applying lemma [ skein - subs ] gives .",
    "we can use the previous three propositions to obtain formulas for the quantities @xmath423 . before stating these formulas",
    ", we introduce a variant of intersection numbers that we refer to as the _ signed intersection number _ between a ( loosened ) @xmath16-path @xmath249 and an arc @xmath171 .",
    "[ ft - dict ] our definitions of signed intersection numbers and signed excess for loosened @xmath16-paths are motivated by the definition of transverse measures appearing in ( * ? ? ?",
    "13 ) . in particular , when @xmath3 has no self - folded triangles , the signed intersection number @xmath529 between a loosened @xmath16-path @xmath458 corresponding to an arc @xmath5 and an arc @xmath171 is equal to the _ transverse measure _",
    "@xmath530 between a _ lift _",
    "@xmath531 of the arc @xmath5 to an _ opened surface _ and a lift @xmath532 of the elementary lamination corresponding to arc @xmath171 .",
    "there is a direct connection between these two quantities if @xmath3 has self - folded triangles as well , but the formula relating the two is more complicated . in particular , in this case we have a multi - lamination containing two elementary laminations spiralling into a puncture ( one clockwise , one counterclockwise ) , but the transverse measures associated to such laminations do not match up as simply to the signed intersection numbers which are defined in this paper .",
    "since we have assumed that @xmath3 has no self - folded triangles , we have that @xmath536 .",
    "now it follows from definition [ def : chi ] that when we substitute the quantities @xmath423 for @xmath321 in propositions [ prop : skein1 ] , [ prop : skein2 ] and [ prop : skein3 ] , we get an extra factor of @xmath537 for every elementary step of type 2 in the corresponding @xmath16-path .",
    "this explains the appearance of the @xmath538 s ( implicitly via the signed intersection numbers ) in the exponents of the new identities .",
    "corollary [ cor : skein ] then follows from , , and .",
    "note that the coefficients in corollary [ cor : skein ] seem to depend on our choices of @xmath16-paths and loosened @xmath16-paths .",
    "however , it follows from ( * ? ? ?",
    "* ( 13.10 ) ) ( which cites @xcite and well - known facts about intersection numbers ) that in fact the coefficients do not depend on our choices . to apply ( * ? ? ?",
    "* ( 13.10 ) ) to our situation , we use the dictionary indicated in remark [ ft - dict ] in the case when @xmath3 has no self - folded triangles .",
    "though the signed intersection numbers or signed excesses _ do _ depend on the choices of loosened @xmath16-paths , the differences between the signed intersection numbers appearing in the exponents of these expressions are independent of these choices .",
    "it suffices to show that the exponent of each @xmath65 in corollary [ cor : skein ] is an integer ( not a half - integer ) .",
    "we first claim that for any loosened @xmath16-path @xmath540 , @xmath541 . to see this , write @xmath542 , and let @xmath543 , @xmath544 , and @xmath545 . then @xmath546 and @xmath547 .",
    "it s clear that both @xmath548 and @xmath549 have the same parity .",
    "now observe that if @xmath436 ( as in definition [ def : smoothing ] ) is a pair of curves with an intersection or one curve with a self - intersection , and we smooth @xmath436 at a point @xmath190 , obtaining @xmath434 , then @xmath550 is a ( positive ) even integer . here ,",
    "if @xmath551 , then @xmath552 denotes @xmath553 .",
    "the lemma follows .",
    "we now turn back to the unpunctured surface case , and propositions [ up : skein1 ] , [ up : skein2 ] , and [ up : skein3 ] . in this situation ,",
    "every marked point @xmath238 is on the boundary of @xmath15 , and thus we have an arc segment @xmath241 ( rather than a circle @xmath239 ) associated to each @xmath238 .",
    "we define some new notation that will be useful in the proofs of these propositions .",
    "given a boundary component @xmath554 containing @xmath240 , we let @xmath555 denote the boundary segment immediately before and incident to @xmath240 when traveling along @xmath554 in the counterclockwise direction . we let @xmath556 denote the clockwise - most vertex on @xmath241 , which also has the form @xmath557",
    ". see figure [ fig horobound ] . with this notation in mind",
    ", we now prove propositions [ up : skein1 ] , [ up : skein2 ] , and [ up : skein3 ] together , using corollary [ cor : skein ] .",
    "the main idea of this proof is that for each arc @xmath11 involved in one of the skein relations , we can choose a loosened @xmath16-path @xmath497 such that @xmath558 .",
    "in particular , we choose loosened @xmath16-paths @xmath559 so that they start and end at a point in the set @xmath560 . for a generalized arc @xmath5 ,",
    "this completely determines the starting and ending points of the associated loosened @xmath16-path @xmath540 . as",
    "above , we decompose such a loosened @xmath16-path @xmath540 as @xmath561 where @xmath264 is an @xmath16-path , and @xmath562 consists only of steps of type @xmath132 and @xmath274 .",
    "first , observe that in this situation the signed excess @xmath563 is nonnegative and equal to @xmath564 for any generalized arc @xmath5 and any arc @xmath427 ; see figure [ fig : sgn - excess ] .",
    "second , observe from figure [ fig horobound ] that the relationship between @xmath556 and @xmath40 is analogous to the relationship between @xmath240 and @xmath442 : in particular , any arc @xmath427 incident to @xmath240 lies in the counterclockwise direction ( along @xmath554 ) from @xmath556 just as the corresponding elementary lamination @xmath442 lies in the counterclockwise direction from @xmath240 .",
    "consequently , for any generalized arc or loop @xmath5 and arc @xmath427 , we have the identity @xmath565 plugging into corollary [ cor : skein ] completes the proof of all three propositions .",
    "see figure [ fig mbar ] for an example ; note that of the three laminations listed , @xmath566 is the only lamination that crosses @xmath567 and @xmath568 but not @xmath569 .",
    "analogously the concatenation @xmath570 can be pulled taut as to avoid intersections with @xmath446 and @xmath447 .",
    "this yields the loosened @xmath16-path @xmath571 .",
    "however , the loosened @xmath16-paths @xmath572 and @xmath487 must intersect both the pairs @xmath569 and @xmath568 .",
    "this is consistent with the exchange relation @xmath573 that we obtain by shear coordinates in this example .",
    "s. fomin , m. shapiro , and d. thurston , cluster algebras and triangulated surfaces .",
    "part i : cluster complexes , _ acta math . _",
    "* 201 * ( 2008 ) , 83 - 146 .",
    "s. fomin and d. thurston , cluster algebras and triangulated surfaces .",
    "part ii : lambda lengths , preprint ( 2008 ) , s. fomin and a. zelevinsky , cluster algebras i : foundations , _",
    "soc . _ * 15 ( 2002 ) , 497 - 529 . *"
  ],
  "abstract_text": [
    "<S> this paper concerns cluster algebras with principal coefficients @xmath0 associated to bordered surfaces @xmath1 , and is a companion to a concurrent work of the authors with schiffler @xcite . given any ( generalized ) arc or loop in the surface  with or without self - intersections </S>",
    "<S>  we associate an element of ( the fraction field of ) @xmath0 , using products of elements of @xmath2 . </S>",
    "<S> we give a direct proof that our matrix formulas for arcs and loops agree with the combinatorial formulas for arcs and loops in terms of matchings , which were given in @xcite . </S>",
    "<S> finally , we use our matrix formulas to prove _ skein relations _ for the cluster algebra elements associated to arcs and loops . </S>",
    "<S> our matrix formulas and skein relations generalize prior work of fock and goncharov @xcite , who worked in the coefficient - free case . </S>",
    "<S> the results of this paper will be used in @xcite in order to show that certain collections of arcs and loops comprise a vector - space basis for @xmath0 . </S>"
  ]
}