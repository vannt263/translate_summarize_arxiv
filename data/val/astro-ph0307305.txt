{
  "article_text": [
    "charge coupled devices ( ccds ) are ideal detectors in many astronomical applications .",
    "they are available in large - format arrays , have high quantum efficiency ( qe ) , a linear response , and , if cooled sufficiently , a very low dark current .",
    "their major shortcoming is readout noise , i.e.  the additional noise added by the on - chip output amplifier , where the charge of the detected photo - electrons is converted into an output voltage . currently , the typical noise levels achieved at slow readout rates ( e.g. khz pixel rates ) are little better than @xmath0 electrons per read @xcite .",
    "at the higher readout rates ( mhz pixel rates ) often used , for example , for adaptive optics and interferometric applications , far poorer performance is the norm , with typical noise levels of @xmath1 electrons per readout @xcite .",
    "a novel solution to this problem , in which on - chip gain is used to amplify the signal prior to readout , has recently been demonstrated by e2v technologies ( formerly marconi applied technologies , @xcite ) . in this approach ,",
    "an extended serial register is used to allow electron avalanche multiplication so that a large mean gain can be realised prior to a conventional readout amplifier .",
    "although the effective gain can be very large , the detailed process by which the signal is amplified is stochastic and so introduces additional noise at the output .",
    "the effects of this noise , and its correction by a judicious analysis of the output from a typical low light level ccd ( hereafter l3ccd ) are the primary subjects of this paper .",
    "the content of the paper is as follows . in section 2",
    "we describe how the l3ccd works and develop a numerical and probabilistic model of the gain mechanism . in section 3 we discuss techniques for analysing the noisy output signal of an l3ccd and the implications for photometric accuracy and signal - to - noise ratio ( snr ) , and we conclude in section 4 .",
    "the l3ccd architecture is similar to that of a normal ccd except that it has extended serial register , called the multiplication register , allowing for additional serial transfers before the signal reaches the ouput amplifier ( see fig .",
    "[ l3pic ] ) .",
    "the electrode voltages in the multiplication register can be adjusted so that avalanche multiplication of the electrons occurs as they are moved through each element of this part of the device . at each step , the probability , @xmath2 , of producing an additional electron per initial input electron is small  typically this may be @xmath3  but the cumulative effect of many transfers can be very large .",
    "for example , for a register comprising @xmath4 elements ( the number of elements in the ccd65 from e2v technologies ) , the mean gain , @xmath5 , will be @xmath6 , when @xmath7 .",
    "in general , the probability distribution of the output @xmath8 , for an input of @xmath9 ( integer ) photo - electrons , where the mean gain is @xmath5 will be given approximately by ( appendix a and fig .",
    "[ probdistgraph ] ) @xmath10 when the photon input level is relatively small and the gain is large .",
    "this distribution has a mean of @xmath11 and a variance of @xmath12 and at high light levels is approximately gaussian . the signal noise introduced by this multiplication process is independent of the photon input .",
    "the snr of an l3ccd output is obtained by combining in quadrature the noise due to the poisson nature of light with the noise from the multiplication process . at a mean light level @xmath13 photons per pixel , this gives an snr equal to @xmath14 where @xmath15 ( the excess noise factor , hereafter enf ) is equal to @xmath16 for an l3ccd output with large gain .",
    "the nature of the multiplication process means that in general there will not be a one - to - one mapping between the number of electrons entering and leaving the multiplication register ( see fig .",
    "[ probdistgraph ] ) , so that in principle there will be always be some uncertainty when estimating the input flux . for a ccd with no gain , @xmath15 is equal to unity , and so to achieve the same snr when using a large gain , we will need to detect twice as many photons , meaning that the multiplication process has effectively halved the qe of the device .",
    "this is a serious loss as astronomers are happy to spend a lot of money on optical coatings to increase system throughput by only a few percent , and do not want to accept the loss in effective qe that the use of an l3ccd implies . to be able to increase the effective qe using signal processing is therefore essential if l3ccds are to be used effectively for astronomy .",
    "this is the main driving force behind our investigation , which aims to use our additional knowledge of the system to allow us to reduce the uncertainty in the measured fluxes .",
    "photons are shown for a mean gain of 6629 .",
    "note the significant overlap between different inputs which causes uncertainties when estimating the input from the output.,width=321 ]      we consider processing strategies which allow up to minimize the stochastic multiplication noise . at very low light levels ,",
    "much less than one detected photon per imaging pixel , we are able to use the l3ccd in a photon counting mode . at these low light levels , we will either get zero or one photons in a pixel per integration time .",
    "this will then result in either a signal much smaller than the amplifier read noise ( zero photons ) , or when a detected photo - electron is amplified , a much larger signal .",
    "provided the mean multiplication gain is much greater than the read noise , we can then treat any signal above some threshold as having arisen from one photon event . replacing the range of signals we get from a pixel containing one photon ( curve 1 in fig .",
    "[ probdistgraph ] ) eliminates the variance in output signal introduced by the multiplication process of the l3ccd and increases the snr to a value we expect from a conventional ccd with negligible read - out noise .    at higher",
    "light levels this technique will not work , since coincidence losses ( more than one photon falling on a pixel , being interpreted as one photon ) will become increasingly important .",
    "nevertheless , the idea of thresholding can still be helpful if we use more than one threshold .",
    "we can see how this might work as follows .",
    "an l3ccd with a mean multiplication gain of @xmath5 might give an output signal of @xmath17 .",
    "this could be due to a single detected photon that has been amplified by an unusually large amount .",
    "alternatively , if we set thresholds @xmath18 and @xmath19 and estimate the flux to be @xmath9 detected photo - electrons before multiplication if the detected signal satisfies @xmath20 , then we will be able to maximize our chance of estimating the flux correctly if we choose thresholds correctly .",
    "it is the determination of these threshold levels and any corrections that need to be applied in order to conserve flux which we now consider , together with their impact on the l3ccd output snr .",
    "we have considered many different signal - processing strategies , and provide details of the most useful selection here .",
    "we investigate which of these provide the largest snr improvement . when investigating these strategies , we assume that the data is first thresholded at some level above the on - chip readout noise level ( typically @xmath21 where @xmath22 is the rms noise due to the readout amplifier ) so that amplifier read noise is negligible . following this",
    ", the strategies considered are :    1 .",
    "analogue : : :    the output signal is divided by the mean gain .",
    "2 . photon counting ( pc ) : : :    if the output signal is above a single fixed noise threshold it is    treated as representing one input photon .",
    "poisson probability ( pp ) : : :    threshold levels are set where the probability of an output resulting    from a mean input of @xmath9 poisson photons is equal to the    probability of the output resulting from a mean input of    @xmath23 poisson photons .",
    "the photon counting ( pc ) thresholding strategy will underestimate flux at light levels where there is a non - zero probability of more than one photon being detected on a single pixel .",
    "the poisson probability ( pp ) strategy will overestimate the flux , particularly at low light levels , and so a theoretically determined correction is necessary after the detections , which we investigate in section 3 .      at a given mean light level , @xmath13 photons per pixel",
    ", the l3ccd output with mean gain @xmath5 can be estimated by providing the photon input in eq .",
    "[ probdisteqn ] with a poisson probability distribution , giving : @xmath24 where @xmath25 is the probability that the l3ccd output will be @xmath8 when the mean light level is @xmath13 , and the mean gain is @xmath5 .",
    "we use this distribution to determine threshold boundaries for the pp thresholding strategy , which are given in table  1 .",
    "these are placed at the points where the probability of getting an output @xmath8 with a mean light level @xmath13 is equal to the probability of getting the same output @xmath8 with a mean light level of @xmath26 as shown in fig .",
    "[ poissonprobdistgraph ] , i.e. finding @xmath8 such that @xmath27 where the @xmath28 threshold boundary is placed at position @xmath8 , and @xmath29 is defined in eq .",
    "[ sumprobdist ] .",
    "this results in threshold boundary positions independent of the mean light level .",
    "the theoretically predicted mean flux and enf arising from this strategy is also calculated .",
    ".threshold boundaries in units of mean gain , for a pp thresholding strategy . [ cols=\"^,<,^,<\",options=\"header \" , ]      +    . threshold boundaries for the pp thresholding strategy are placed where these curves cross.,width=321 ]      monte - carlo simulations were used to verify that our threshold positions were chosen correctly , and that our calculations of photon input estimation and enf were correct .",
    "input photon streams were generated for differing mean light levels assuming poisson statistics , and were injected into the first pixel of a multiplication register of length @xmath30 .",
    "the transfer of this signal to the next pixel of the register was then computed assuming a probability @xmath2 that any given photo - electron would be amplified to give 2 photo - electrons , and a probability @xmath31 that the transfer took place with no amplification .",
    "this process was then repeated a further @xmath32 times to simulate the output expected for the initial input signal . in this way ,",
    "the expected output for l3ccds with differing multiplication probabilities and register lengths could easily be generated for differing input light levels and threshold boundary positions .",
    "large numbers of these output data sequences were then processed to verify that the theoretical enf and flux estimation calculations were correct .      in order to assess the performance of different signal - processing strategies ,",
    "the quality of the signal recovery was quantified using both the enf and the following misfit function , @xmath33 : @xmath34 where @xmath35 is the true input photon count and @xmath36 the value of the input signal estimated from the thresholded l3ccd output , @xmath37 .",
    "data sequences comprising many tens of thousands of signal values were generated so as to allow different methods for generating the estimates @xmath38 from the raw l3ccd outputs @xmath39 .",
    "the minimization of this misfit function corresponds to the best input prediction .",
    "an ideal detector will give a misfit of @xmath40 , and a variance equal to the variance of the input ( poisson ) data , @xmath41 , with the snr equal to @xmath42 .",
    "a non - ideal detector will have greater dispersion in the output , resulting in a reduced snr of @xmath14 where @xmath15 is the enf .",
    "when investigating our l3ccd output thresholding strategies , it is helpful to consider three different light level regimes .",
    "the first of these is when the mean light level is low , much less than one photon per pixel per readout .",
    "secondly , we consider intermediate light levels , with between about @xmath43 photons per pixel per readout , and finally above this , high light levels are considered .",
    "this separation allows us to apply the different processing strategies able to maximize the snr at each light level .",
    "our results are independent of multiplication register lengths typically found on l3ccds ( greater than 100 elements ) , though a shorter register length will generally give a slightly lower enf ( eq .",
    "[ matsuoeq ] ) .    as shown in fig .",
    "[ outputvgaingraph ] and fig .",
    "[ outputfor4graph ] , the on - chip amplifier readout noise can have a significant impact on the flux determination if the mean gain is not much larger than the noise threshold level ( below which any signal is ignored ) , particularly at low light levels . by setting the noise threshold level at least @xmath44 above the mean on - chip readout noise ( assuming readout noise with an rms of @xmath22 ) , and using a mean gain at least ten times greater than the noise threshold level , we are able to minimize the effect of the on - chip readout noise . as light level or gain are increased , the effect of readout noise is reduced .     above the noise level , @xmath45 ,",
    "@xmath22 being the rms noise , while lower curves set the noise threshold at @xmath46 , @xmath47 , @xmath44 ( dotted curve ) , @xmath48 and @xmath21 above the mean noise .",
    "a noiseless readout ( @xmath49 ) would give a value of unity for all gains.,width=321 ]     above the mean noise level when @xmath22 , the rms noise , is equal to @xmath50 .",
    "the upper ( solid ) curve is for 10 photons per pixel , lower curves for 1 ( dashed ) , 0.1 ( dotted ) and 0.01 ( dash - dotted ) photons per pixel respectively .",
    "the effect of readout noise is minimized at higher light levels and gains .",
    "curves are normalised to a value of unity representing a noiseless readout.,width=321 ]      as discussed in section  [ lllsect ] , if the mean light level is low ( much less than one photon per pixel per readout ) , we can use a pc thresholding strategy , treating every signal above some noise threshold as representing one photon .",
    "this removes all dispersion introduced by the multiplication process and effectively eliminates any additional noise .",
    "the signal - to - noise ratio from many such samples scales as @xmath51 as shown in fig .",
    "[ enfvlightgraph ] .",
    "the mean gain does not need to be accurately determined , but should be kept well above the readout noise , as mentioned in the previous section .",
    "if this is not the case then some real signals will have insufficient amplification and will be treated as noise , leading to inaccuracies in flux estimation .",
    "is equivalent to halving the qe of the l3ccd.,width=321 ]    coincidence losses will result in nonlinearities in the flux prediction as the light level increases . if the mean light level is @xmath52 photons per pixel then two or more photo - electrons will be detected on a pixel less than 2 per cent of the time , resulting in a relatively small coincidence loss which can be corrected easily . however ,",
    "if the mean light level is @xmath53 photon per pixel , coincidence losses are larger and we would estimate the light level to be only @xmath54 photons per pixel .",
    "this nonlinearity can be determined and so we can correct the detected photon flux while this nonlinearity remains small , for light levels up to about @xmath53 photon per pixel . at higher light levels",
    ", our estimated light level tends towards unity and so we are unable to deduce the correct light level without much uncertainty .",
    "our pc thresholding strategy may be applied here , but will overestimate the flux , since there is a significant probability that the output from a single photon input will be placed into the second ( or greater ) threshold bin .",
    "[ outputvlightgraph ] shows the size of the error in flux estimation for our pc and pp thresholding strategies as a function of light level , and hence the nonlinearity correction that should be applied after data from many frames has been thresholded in this way .",
    ", dashed ) and analogue ( dash - dotted ) thresholding strategies .",
    "curves are theoretical , while markers are from monte - carlo simulation and negligible readout noise is assumed ( @xmath55 ) .",
    "we see that flux is overestimated at low light levels using a pp strategy , but that this nonlinearity can be corrected for.,width=321 ]      at intermediate light levels up to about twenty photons per pixel , we can not use a pc thresholding strategy as coincidence losses become large .",
    "however , as discussed previously it is still possible to process the output , reducing the enf .",
    "our pp processing strategy can be applied at any light level though is most advantageous in this light level regime , and gives decreasing improvements up to about @xmath56 photons per pixel per frame . above this , the photometric accuracy and enf are indistinguishable from those obtained using the analogue processing strategy .",
    "threshold boundaries from the pp processing strategy are independent of light level .",
    "summing thresholded output signal values and applying a nonlinearity correction for light level provides us with a good estimate of the flux .",
    "[ outputvlightgraph ] shows the nonlinearity correction which should be applied . without this",
    ", the flux will be overestimated at lower light levels since there is always a significant probability that the output from a single photon will be interpreted as two or more photons .",
    "we find that theoretical results and those from our monte - carlo calculations agree almost perfectly , as would be expected , as shown for example by fig .",
    "[ outputvlightgraph ] .      at high light levels , the input photon ( poisson ) distribution becomes symmetrical about the mean light level , having the form of a gaussian .",
    "the multiplication noise distribution also tends to a gaussian , and so the l3ccd output distribution is gaussian .",
    "we treat the output as we would a conventional ccd , simply dividing by the mean gain , using the analogue processing strategy .",
    "this does not remove any of the dispersion introduced by the multiplication process , giving an enf , @xmath15 , of @xcite @xmath57 where @xmath30 is the multiplication register length , @xmath5 the mean gain , and the approximation is valid when @xmath30 and @xmath5 are large , as is usual for an l3ccd .",
    "the snr is then @xmath58 , effectively halving the qe , and the misfit function ( eq . ( [ misfiteqn ] ) ) is also greater than for other thresholding strategies , as shown in fig .",
    "[ misfitvlightgraph ]",
    ".        this analogue processing technique may be applied at any light level , though due to the large enf , other methods can give an improvement in snr , particularly at light levels below about 20 photons per pixel per readout . at very high light levels , where the mean light level is a few times the square of the on - chip amplifier read noise of the l3ccd ( typically @xmath59 for fast readout , @xcite ) , the multiplication gain can be turned off , and then no statistical noise is added , giving poisson shot noise scaling as @xmath51 .",
    "this is the mode in which a conventional ccd is used .",
    "an enf of @xmath16 effectively halves the qe of the ccd , which is a serious loss .",
    "[ enfvlightgraph ] compares the enf for various thresholding modes , as a function of light level .",
    "we can see that a combination of pc and pp thresholding strategies allows us to reduce the enf for light levels up to about twenty photons per pixel .",
    "it is interesting to note that the enf tends towards zero for the pc strategy at high light levels .",
    "this is because we always interpret every signal as one photon , and so the result has no noise .",
    "however , in this mode , we are unable to predict the input flux , and so it is useless at high light levels , as seen from the misfit function ( fig .",
    "[ misfitvlightgraph ] ) .    for the pp thresholding strategy , the enf tends towards @xmath16 as the light level increases , and above about twenty photons per pixel we see that there is little advantage in thresholding , with the raw l3ccd output giving similar noise performance .",
    "however , thresholding does lead to a significant improvement in noise performance , reducing the enf up to twenty photons per pixel .",
    "we also see that the misfit function remains low when we apply these thresholding schemes ( fig .  [ misfitvlightgraph ] ) using a combination of the pc and pp thresholding strategies .",
    "the pc thresholding strategy only performs well for light levels up to about 0.5 photons per pixel , and should not be used above 1 photon per pixel .",
    "[ outputvlightgraph ] shows that a nonlinearity correction for flux will be required during post - processing for light levels greater than about 0.1 photons per pixel when using a pc thresholding strategy , and at light levels less than about 20 photons per pixel when using a pp thresholding strategy .",
    "we can correct the flux for a pp thresholding strategy approximately according to @xmath60 where @xmath61 is the result of the initial thresholding and summation process .",
    "the result of this correction is shown in fig .",
    "[ outputvlightgraph ] .",
    "similarly , the flux for a pc thresholding strategy can be corrected according to @xmath62 though the error in corrected flux becomes large as @xmath63 .      as an example of where thresholding techniques can be used , we consider the lucky imaging technique @xcite , as used in astronomy to overcome atmospheric effects on medium sized telescopes .",
    "snapshot images are taken with very short exposure times ( of order 10 - 30ms ) .",
    "many such images are taken , and the images with least atmospheric smearing are kept and added together after centroiding .",
    "an l3ccd is required since the light levels will be very low .",
    "we can threshold each data frame using both the pc and pp thresholding strategies and summing with previous frames immediately ( in parallel since these thresholding schemes are applied after detection ) . at the end of the observing run , these two images",
    "can then be combined after applying the nonlinearity correction for flux , depending on whether the signal on each pixel is low or high .      apart from when using the photon counting ( single thresholding ) strategy ,",
    "we require knowledge of the mean gain .",
    "this can be controlled to about 1 per cent @xcite which , with gains of order 1000 , requires millivolt stability for the clock - high l3ccd electrode voltage .",
    "errors here will only have a small effect on our estimates at low light levels and at higher light levels , the flux estimate error will be proportional to the error in gain .",
    "we have studied the stochastic gain process of l3ccds and characterised the noise added by this multiplication process . for different signal level regimes",
    ", we have investigated the best processing strategy for the l3ccd output with regard to estimating the true photon input .    in summary",
    ", we find that :    1 .",
    "single thresholding of the l3ccd output can be applied accurately for photon rates up to about 0.5 photons per pixel per readout with a small nonlinearity correction .",
    "multiple thresholding ( binning ) of the l3ccd output can be applied at any light level , and is most advantageous with light levels between 0.5 - 20 photons per pixel per readout .",
    "this can reduce the excess noise factor introduced by the multiplication process from @xmath16 to @xmath64 at light levels of about one photon per pixel .",
    "3 .   using a combination of single and multiple thresholding strategies leads to further improvement , decreasing the excess noise factor to unity at lower light levels .",
    "if the gain is not known accurately , threshold boundaries will be chosen wrongly .",
    "however , the gain can be controlled to about 1 per cent , so this effect is small .",
    "our recommendation when using l3ccds at low light levels ( less than 0.5 photons per pixel per readout ) is that a single threshold processing strategy on the l3ccd output should be used . at higher light levels up to about 20 photons per pixel , threshold boundaries placed with the pp thresholding strategy should be used .",
    "a nonlinearity correction should then be used , leading to correct flux estimation and an improvement in snr performance from @xmath58 to @xmath65 in the best case , without requiring an initial estimate of the mean light level . at high light levels greater than about 20 photons per pixel ,",
    "using the raw output does not lead to worse snr performance than that obtained with other thresholding techniques .",
    "since l3ccds provide the best snr performance at low light levels using a single threshold , we recommend that if possible , they are always used in this regime , increasing the frame rate if necessary to keep the number of photons per pixel low ( @xmath66 ) . a new controller being developed for",
    "l3ccds will allow pixel rates of up to 30mhz , allowing the potential of l3ccds to be maximized .",
    "ab would like to thank bob tubbs for useful comments and discussions .",
    "baldwin j. e. , tubbs r. n. , cox g. c. , mackay c. d. , wilson r. w. , anderson m. i. , 2001 , aa 368 , l1 - 4 jerram p. , pool p. , bell r. , burt d. , bowring s. , spencer s. , hazelwood m. , moody i. , catlett n. , heyes p. , 2001",
    "spie 4306 , p. 178",
    "mackay c. d. , tubbs r. n. , bell r. , burt d. , moody i. , 2001 , proc .",
    "spie 4306 , p. 289 matsuo k. , teich m. , saleh b. , 1985 , ieee transactions on electron devices , vol .",
    "ed-32 , no .",
    "@xcite give the output probability distribution for a electron multiplication device ( e.g.  an l3ccd ) , with @xmath30 elements in the multiplication register , and a probability @xmath67 of producing an extra electron at each stage , for a single photon input , as      if @xmath30 is large and @xmath67 is small , we find that this can be approximated to an exponential distribution : @xmath69 where @xmath70 signifies the probability of an output @xmath8 for a single photon input , with mean gain @xmath5 .",
    "this gives @xmath71 , as expected .",
    "where @xmath76 is valid from @xmath77 ( and is in fact zero at @xmath78 ) .",
    "we can see that for moderately large @xmath8 ( and @xmath8 usually will be large over most of the distribution , since the gain is large ) we can simplify to give a general probability distribution :      which has an expectation @xmath11 and variance @xmath12 , and fits the actual distribution almost perfectly .",
    "variations on this are possible , for example taking more care at small @xmath8 , though since the overall differences are small , the simplified version is used here .",
    "this approximation is not valid for large @xmath9 , and a gaussian distribution with the same mean and variance should be used instead ."
  ],
  "abstract_text": [
    "<S> low light level charge coupled devices ( l3ccds ) have recently been developed , incorporating on - chip gain . </S>",
    "<S> they may be operated to give an effective readout noise much less than one electron by implementing an on - chip gain process allowing the detection of individual photons . however , the gain mechanism is stochastic and so introduces significant extra noise into the system . in this paper </S>",
    "<S> we examine how best to process the output signal from an l3ccd so as to minimize the contribution of stochastic noise , while still maintaining photometric accuracy .    </S>",
    "<S> we achieve this by optimising a transfer function which translates the digitised output signal levels from the l3ccd into a value approximating the photon input as closely as possible by applying thresholding techniques . </S>",
    "<S> we identify several thresholding strategies and quantify their impact on photon counting accuracy and effective signal - to - noise .    </S>",
    "<S> we find that it is possible to eliminate the noise introduced by the gain process at the lowest light levels . </S>",
    "<S> reduced improvements are achieved as the light level increases up to about twenty photons per pixel and above this there is negligible improvement . operating l3ccds at very high speeds will keep the photon flux low , giving the best improvements in signal - to - noise ratio .    </S>",
    "<S> [ firstpage ]    instrumentation : detectors  techniques : photometric  methods : statistical  methods : numerical .    </S>",
    "<S> this is a preprint of an article accepted for publication in monthly notices of the royal astronomical society 2003 the royal astronomical society . </S>"
  ]
}