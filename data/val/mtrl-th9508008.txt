{
  "article_text": [
    "during the last decade , first - principles total - energy methods based on density functional theory  ( dft ) combined with the pseudopotential method , have become established as a major tool in the study of condensed matter  @xcite .",
    "the dft - pseudopotential approach is now widely used for both static and dynamic simulations on an enormous range of condensed - matter problems . however , these methods suffer from a severe drawback in that their computational cost generally increases as the cube of the number of atoms in the system .",
    "this unfavorable scaling limits the size of systems that can be studied with current methods and today s computers to a few hundred atoms at most .",
    "this @xmath0 scaling appears in spite of the fact that the complexity of the problem increases only linearly with the system size .",
    "this observation suggests that the unfavorable scaling of current methods is a consequence of the way in which the electronic structure problem is being addressed .",
    "conventional methods rely either on diagonalization of the hamiltonian or orthonormalization of a set of occupied orbitals , both of which are intrinsically @xmath0 operations .",
    "it is clear that more efficient methods in which the effort is proportional to the number of atoms must be possible , and in recent years a considerable effort has been devoted to finding such ` linear - scaling ' schemes  @xcite .",
    "the earliest linear - scaling scheme appears to be the ` divide and conquer ' method of yang  @xcite .",
    "this obtains the electronic density and hence the total energy by dividing the system into overlapping sub - systems that can be treated independently .",
    "the density is calculated for each sub - system with conventional lcao - dft .",
    "the hamiltonian for each sub - system , which includes the potential due to the other sub - systems , is diagonalized independently , thus avoiding the need to diagonalize the full hamiltonian .",
    "this procedure is repeated until self - consistency is achieved .",
    "baroni and giannozzi  @xcite also proposed a scheme that directly determines the electron density .",
    "they do this by discretizing the kohn - sham hamiltonian on a real - space grid , and then using the recursion method of haydock , heine and kelly  @xcite to obtain the diagonal elements of the green s function , from which the electron density can be computed by contour integration . in this case",
    "linear scaling results from the fact that the continued fraction used to evaluate a particular diagonal element of the green s function can be truncated once a certain neighborhood of each point has been explored . this neighborhood is independent of the system size for sufficiently large systems .    more recently , several new schemes that resemble traditional first - principles methods have been reported .",
    "galli and parrinello  @xcite pointed out that some improvement could be achieved in the scaling of a conventional dft calculation by requiring spatial localization of the electronic orbitals .",
    "this localization was achieved by adding certain non - local constraining terms to the hamiltonian , or by using a filtering procedure .",
    "the total energy can then be obtained as a functional of the localized orbitals @xmath1 and their _ conjugate _",
    "orbitals @xmath2 , but in order to obtain these conjugate orbitals , the overlap matrix @xmath3 has to be inverted .",
    "since spatial localization implies sparsity of @xmath3 , this can be achieved in @xmath4 operations , so that some improvement with respect to @xmath0 is obtained .",
    "a step further in this direction was made independently by mauri , galli and car  @xcite ( hereafter referred to as mgc ) and by ordejn _",
    "et al . _",
    "they introduced a new functional of the occupied orbitals that possesses the same ground state as the conventional energy functional , but with the added advantage of leading naturally to orthogonal orbitals when minimized . if this new functional",
    "is minimized with respect to orbitals that are constrained to remain localized in chosen regions of space , as suggested by galli and parrinello  @xcite , a linear scaling method results . in the original formulation , the number of orbitals entering the new functional is equal to half the number of electrons in the system .",
    "this restriction seems to lead to very slow convergence , and to the appearance of spurious local minima in the functional .",
    "this problem has been recently overcome by kim , mauri and galli  @xcite , by generalizing the functional so that it depends on an arbitrary number of orbitals .",
    "the linear - scaling scheme most relevant to the present work is that put forward by li , nunes and vanderbilt  @xcite ( hereafter referred to as lnv ) in the context of tight - binding semi - empirical calculations . in this method ,",
    "linear scaling is achieved by taking advantage of the real space localization properties of the density matrix , @xmath5 . by introducing a spatial cutoff @xmath6 in @xmath7 , such that @xmath8 is set to zero if @xmath9 , the number of non - zero elements in @xmath7 increases only linearly with the system size .",
    "the electronic structure problem is then formulated as a minimization of the total energy with respect to the truncated density matrix , subject to the constraints of idempotency ( @xmath10 ) and correct trace ( @xmath11 , where @xmath12 is the number of electrons ) .",
    "the scheme of lnv consists of an algorithm for imposing these constraints that at the same time fulfils the goal of linear scaling .",
    "the idempotency of @xmath7 is the most difficult constraint to impose , and this scheme achieves it by expressing @xmath7 in terms of an auxiliary matrix , which we denote in this paper by @xmath13 .",
    "this is subjected to a _ purifying _ transformation due to mcweeny  @xcite .",
    "if @xmath13 is a near - idempotent matrix , i.e. if its eigenvalues lie close to  0 or  1 , this transformation will return @xmath7 as a more nearly idempotent matrix , and thus it is possible to minimize the total energy with respect to @xmath13 while ensuring the near idempotency of @xmath7 . by construction , the method is variational ( i.e. @xmath14 ) , and it has been shown that the convergence of calculated properties with the parameter @xmath6 is fairly rapid  @xcite .",
    "it is now being widely used in tight - binding simulations of large systems .",
    "recently , the idea of working with the density matrix has been applied to dft linear scaling schemes .",
    "this has been done independently by hierse and stechel  @xcite and by hernndez and gillan  @xcite . in both cases ,",
    "the density matrix is represented in real space as : @xmath15 where the @xmath16 are a set of localized functions , and @xmath17 is a symmetric matrix .",
    "the total energy is expressed in terms of @xmath18 , and minimization is carried out with respect to both the @xmath16 and the @xmath17 .",
    "hierse and stechel  @xcite use a number of functions @xmath16 equal to the number of occupied orbitals , but this restriction is not present in our scheme .",
    "the consequences of this and other differences between the two methods will be addressed later in this paper .",
    "previously , only a brief description of our method has been published  @xcite . in this paper",
    "we give a detailed description of the method , together with some illustrations of its practical performance and a discussion of its relation to other methods . in section 2 , the method is outlined and its theoretical foundations are discussed .",
    "the practical implementation of the method is then described in section 3 .",
    "the tests we have performed to probe the practical usefulness of the scheme are presented in section 4 . in section 5 , we assess what has been achieved and we discuss possible future developments , with particular attention to the problems that need to be overcome before the method can be generally applied . some of the mathematical analysis is reported in an appendix .",
    "we need to recall briefly the principles of dft  @xcite .",
    "the total energy @xmath19 of the system of valence electrons and atomic cores is expressed as : @xmath20 where the terms on the right are the kinetic , pseudopotential , hartree and exchange - correlation energies of the electrons , and @xmath21 is the madelung energy of the cores .",
    "the first two energies are : @xmath22 where @xmath23 are the kohn - sham ( ks ) orbitals , @xmath24 is the total pseudopotential operator , and @xmath25 is the number of occupied orbitals .",
    "the energies @xmath26 and @xmath27 can be written in terms of the electron number density @xmath28 : @xmath29 where for simplicity we assume the local density approximation ( lda ) for @xmath27 , with @xmath30 the exchange - correlation energy per electron .",
    "the number density is : @xmath31 the important principle for present purposes is that the true ground - state energy and electron density are obtained by minimizing @xmath19 with respect to the ks orbitals , subject to the constraint that the latter are kept orthonormal .    in the standard formulation of dft , which we have just summarized ,",
    "all the occupied orbitals are fully occupied .",
    "however , it is frequently convenient , for physical , computational or formal reasons , to generalize the theory so that orbitals can be partially occupied .",
    "spatial orbital @xmath32 , rather than containing 2 electrons , may now contain @xmath33 electrons , where the occupation number @xmath34 lies in the range @xmath35 .",
    "the number density @xmath28 now becomes : @xmath36 and the kinetic and pseudopotential energies are : @xmath37 the expressions for @xmath26 and @xmath27 in terms of @xmath28 are unchanged .",
    "the usual physical reason for making this generalization is that one wishes to treat the electrons at a non - zero temperature , in which case the @xmath34 are fermi - dirac occupation numbers  @xcite ; computationally , the generalization is sometimes made in order to get rid of the troublesome discontinuity at the fermi level in metallic systems  @xcite .",
    "our reason for considering it here is that it will be relevant to the density matrix formulation .",
    "we shall assume that if @xmath19 is minimized both with respect to the @xmath23 ( subject to orthonormality ) and with respect to the @xmath34 ( subject to the restriction @xmath35 and the condition that the sum @xmath34 be equal to @xmath38 ) , then we arrive at exactly the ground state that is obtained by the more usual minimization with respect to fully occupied states @xmath23 .",
    "another way of putting this is that the energy can not be reduced below the normal ground state by allowing partial occupation .",
    "now we turn to the density matrix , which is defined by @xmath39 it follows from this definition that @xmath40 is a hermitian operator whose eigenvalues are all in the interval @xmath41 $ ] .",
    "the converse is also true : a hermitian operator @xmath42 whose eigenvalues are @xmath34 and whose eigenfunctions are @xmath32 can be written as in equation ( [ eq : rho_def ] ) . in terms of such an operator @xmath42 , let the kinetic energy , pseudopotential energy and number density be defined as : @xmath43 with @xmath26 and @xmath27 expressed in the usual way in terms of @xmath28 .",
    "it follows from what we have said before that if @xmath19 is minimized with respect to @xmath44 subject to the condition that the eigenvalues of the latter are in the required interval and add up to @xmath38 , then we arrive at the usual ground state .",
    "this is the density matrix formulation of dft .",
    "since dft is variational , any restriction placed on the class of density matrices @xmath45 that can be searched over has the effect of raising the minimum energy @xmath46 above its true ground - state value @xmath47 ; progressive relaxation of such a restriction makes @xmath46 tend to @xmath47 .",
    "now in general the density matrix in the true ground state tends to zero as the separation of its arguments @xmath48 increases .",
    "this strongly suggests the usefulness of estimating @xmath47 by searching over @xmath45 with the restriction that : @xmath49 where @xmath6 is a chosen cutoff radius . the resulting estimate @xmath50 will tend to @xmath47 from above as @xmath51",
    "the manner in which @xmath52 goes to zero at large separations depends on the electronic structure of the system , and particularly on whether there is a gap between the highest occupied and lowest unoccupied states .",
    "it is rigourously established that in one - dimensional systems having a gap @xmath7 decays exponentially with separation , while in gapless systems it decays only as an inverse power  @xcite .",
    "it is presumed that three - dimensional systems behave similarly .",
    "this suggests  though to our knowledge it is unproven  that @xmath53 exponentially for insulators and algebraically for metals",
    ".    clearly in practical calculations we can not work directly with a six - dimensional function @xmath45 , even if it vanishes beyond a chosen radius .",
    "it is essential that @xmath7 be separable , i.e. representable in the form : @xmath54 for practical purposes , there must be only a finite number of @xmath55 functions , which will be referred to as support functions . for @xmath7 to be hermitian",
    ", we must require that the matrix @xmath17 be hermitian .",
    "the restriction to a finite number of support functions is equivalent to the condition that @xmath7 have only this number of non - zero eigenvalues , and this is the essence of the separability requirement . with this , we now have two independent restrictions on @xmath7 : localization and separability .",
    "the localization of @xmath7 can be imposed by requiring that the support functions be non - zero only within chosen regions , which we call the support regions , and that the coefficients @xmath17 vanish if the separation of the support regions of @xmath16 and @xmath56 exceeds a chosen cutoff .",
    "we now have a general framework for linear - scaling dft schemes . in practical calculations ,",
    "the @xmath16 functions will be represented either as a linear combination of basis functions , or simply by numerical values on a grid .",
    "either way , the amount of information contained in a support function will be independent of the size of the system .",
    "the amount of information in the support functions will then scale linearly with the size of the system , and the number of @xmath17 coefficients will scale in the same way .",
    "this in turn implies that the electron density @xmath57 and all the terms in the total energy can be calculated in a number of operations which scales linearly with system size .      in this general scheme ,",
    "the ground state is determined by searching over support functions and @xmath17 matrices .",
    "however , it is essential that this search be confined to those @xmath16 and @xmath17 for which the eigenvalues of @xmath18 lie in the interval [ 0,1 ] .",
    "this is a troublesome condition to impose , because we certainly do not wish to work directly with these eigenvalues .",
    "we can achieve what we want by expressing @xmath7 in a form that satisfies the condition automatically .",
    "the scheme developed in this paper is the dft analogue of the tight - binding scheme of lnv  @xcite .",
    "we write the density matrix as : @xmath58 where @xmath59 is an auxiliary function .",
    "( the asterix here indicates the continuum analogue of matrix multiplication . for arbitrary two - point functions @xmath60 and @xmath61 , we use the notation @xmath62 as a short - hand for the statement : @xmath63 the reason this works is that the eigenvalues @xmath64 of @xmath7 automatically satisfy @xmath65 provided the eigenvalues @xmath66 of @xmath13 are in the range @xmath67 ; in addition , @xmath64 has turning points at the values 0 and 1 . since",
    "the ground state is obtained when @xmath68 or 1 , there is a natural mechanism whereby variation of @xmath13 drives @xmath7 towards idempotency .    to obtain the separable form of @xmath7 ( eq .  ( [ eq : separable ] ) )",
    ", we write : @xmath69 which implies the matrix relation : @xmath70 where @xmath71 is the overlap matrix of support functions : @xmath72 the ground state is now obtained by minimizing @xmath19 with respect to the @xmath16 and the @xmath73 matrix , with the @xmath17 matrix given by eq .",
    "( [ eq : k_of_l ] ) . in the practical calculations",
    "reported later , the @xmath16 are non - zero only inside spherical regions of radius @xmath74 , and the @xmath73 are non - zero only if the centres of the regions @xmath75 and @xmath76 are separated by less than a cutoff distance @xmath77 .",
    "it will be useful for the purposes of later discussion to note how a closely related scheme leads back to the mgc method  @xcite .",
    "this scheme is obtained by writing : @xmath78 where @xmath13 is required to be positive semi - definite .",
    "since the eigenvalues @xmath66 can be expressed as @xmath79 where @xmath80 is real , the eigenvalues of @xmath7 are given by : @xmath81 this quartic function lies in the range [ 0,1 ] for @xmath82 and has turning points when @xmath68 and 1 .",
    "this give an alternative mechanism for driving @xmath7 towards idempotency . with",
    "@xmath13 given , as before , by eq .",
    "( [ eq : sigma_def ] ) , it is straightforward to show that @xmath13 is positive semi -",
    "definite if and only if the matrix @xmath73 is positive semi - definite , and this is equivalent to the condition that @xmath73 be expressible as : @xmath83 the result is that @xmath59 must have the form : @xmath84 where : @xmath85 following arguments presented by nunes and vanderbilt  @xcite in the tight - binding context , it can now be shown that this scheme is exactly equivalent to the linear - scaling dft scheme of mgc .",
    "we now give a prescription for the calculation of the energy functional , and of its derivatives with respect to the support functions @xmath16 and the @xmath73 parameters , and we describe how minimization of the energy can be carried out in practice .",
    "central to our implementation of the method described in the previous section is the use of a regular cubic real - space grid , spanning the whole system under study .",
    "there have been a number of recent implementations of conventional dft - pseudopotential calculations using real - space grids  @xcite .",
    "the support functions are represented by their values at the grid points .",
    "since these functions are required to be spatially localized , they have non - zero values only on the grid points inside the localization regions . in the present work ,",
    "these regions are chosen to be spherical , and their centres are at the atomic positions .",
    "real - space integration is replaced by summation over grid points , so that e.g. the overlap matrix elements are calculated as : @xmath86 where the sum goes over the set of grid points @xmath87",
    "common to the localization regions of both @xmath16 and @xmath56 , and @xmath88 is the volume per grid point .",
    "the action of the kinetic energy operator on the support functions is evaluated using a finite difference technique . to @xmath89th order in the grid spacing , @xmath90",
    ", we have that @xmath91 where @xmath92 and @xmath93 are integer indices labelling grid point @xmath87 , and the coefficients @xmath94 can be calculated beforehand .",
    "equivalent expressions can be used for @xmath95 and @xmath96 , and it is thus possible to evaluate @xmath97 approximately at each grid point . from eqs .",
    "( [ eq : traces ] ) and ( [ eq : separable ] ) , the kinetic energy is given by : @xmath98 where @xmath99 once @xmath100 has been evaluated at each grid point using eq .",
    "( [ eq : finitedifference ] ) , the @xmath101 matrix elements are calculated by summing over grid points , just as for @xmath71 ( see eq .",
    "( [ eq : overlap ] ) ) .    in order to evaluate the exchange - correlation , hartree and pseudopotential contributions to the total energy , we first need to evaluate the electron density at each grid point . from eqs .",
    "( [ eq : traces ] ) and ( [ eq : separable ] ) , the density at grid point @xmath87 is : @xmath102 from this , it is straightforward to evaluate the exchange - correlation energy by summing the quantity @xmath103 $ ] over grid points .",
    "the exchange - correlation potential @xmath104 can also be calculated at each point , and is given as @xmath105 \\right\\ } \\ ; .\\end{aligned}\\ ] ]    to obtain the hartree energy and potential we use the fast fourier transform ( fft ) method to transform the calculated electronic density into reciprocal space , thus obtaining its fourier components @xmath106 .",
    "the hartree energy is then given as @xmath107 where @xmath108 is the volume of the simulation cell .",
    "the hartree potential in reciprocal space is : @xmath109 this can be constructed on the reciprocal - space grid , and transformed to obtain the hartree potential in real space .",
    "fft is , of course , an @xmath110 operation rather than an @xmath111 operation , but the difference is negligible for present purposes .",
    "we restrict ourselves here to local pseudopotentials , so that the value of the total pseudopotential @xmath112 at grid point @xmath87 is formally given by : @xmath113 where @xmath114 is the ionic pseudopotential and @xmath115 is the position of ion @xmath116 . in practice , however , @xmath112 can not be calculated like this , because @xmath114 has a coulomb tail @xmath117 at large @xmath118 , where @xmath119 is the core charge . in order to obtain a linear - scaling algorithm for @xmath120 , we proceed as follows .",
    "the ionic pseudopotential is represented as the sum of the coulomb potential due to a gaussian charge distribution @xmath121 and a short - range potential @xmath122 .",
    "the total charge in @xmath121 is @xmath123 , and the distribution is given by : @xmath124 where the parameter @xmath75 governs the rate of decay of the gaussian .",
    "we therefore have : @xmath125 the part of @xmath126 coming from @xmath127 can now be calculated as a direct sum over ions , as in eq .",
    "( [ eq : pseudo_sum ] ) .",
    "since @xmath127 can be neglected beyond a certain radius , this part of the calculation scales linearly .",
    "the part of @xmath126 coming from the array of gaussians can be treated in exactly the same way as the hartree potential .",
    "the pseudopotential energy is then calculated by summation over the real - space grid : @xmath128      once the contributions to the total energy have been obtained as outlined above , we need to vary both @xmath73 and @xmath16 in order to minimize it .",
    "the @xmath73 and @xmath16 are independent variables , and the problem breaks naturally into two separate minimizations that can be carried out in an alternating manner : one with respect to @xmath73 with fixed @xmath16 , and the other with respect to @xmath16 with fixed @xmath73 . indeed , the choice of object function can be different for the two types of variation , and when minimizing with respect to the @xmath73 we find it more convenient to take @xmath129 as our object function , where @xmath130 is the chemical potential and @xmath12 is the electron number .",
    "we return to this point below .",
    "expressions for the derivatives with respect to @xmath73 and @xmath16 are obtained in appendix a. the partial derivative of @xmath108 with respect to @xmath73 is given by @xmath131_{\\alpha \\beta } \\label{eq : partialab}\\end{aligned}\\ ] ] where @xmath132 , and @xmath133 is the matrix representation of the ks hamiltonian in the support function representation .",
    "it is worth noting that this expression is exactly the same as would be obtained in a non - orthogonal tight - binding formalism  @xcite",
    ". there is , however , one important difference : in self - consistent  dft calculations the hamiltonian matrix elements depend on @xmath73 through the electronic density @xmath134 .",
    "the partial derivative of the total energy with respect to @xmath16 at grid point @xmath87 is given by @xmath135 \\phi_\\beta({\\bf r}_\\ell ) , \\label{eq : partialphi}\\end{aligned}\\ ] ] where @xmath136 is the kohn - sham operator , which is made to act on support function @xmath56 .",
    "it is important to notice that because of the spatial localization of the support functions , and the finite range of @xmath137 , all the matrices involved in the calculation of these derivatives are sparse , when the system is large enough .",
    "provided this sparsity is exploited in the computational scheme , the method scales linearly with the size of the system .    in the scheme of lnv",
    "@xcite , it is proposed to work at constant chemical potential , rather than at constant electron number .",
    "we prefer to maintain the electron number constant .",
    "the variations with respect to @xmath73 and @xmath16 will in general cause the electron number to differ from the correct value , and it is therefore necessary to correct this effect as the minimization proceeds .",
    "we achieve this in the following manner : during the minimization with respect to @xmath137 , the current search direction is projected so that it is tangential to the local surface of constant @xmath12 , i.e. perpendicular to @xmath138 at the current position .",
    "this ensures that the minimization along this direction will cause only a small change in @xmath12 , and it is expected that at the new minimum @xmath12 will differ only slightly from the required value . in any case , it is possible to return to a position as close as desired to the constant @xmath12 surface by following the local gradient @xmath138 .",
    "if the value of the chemical potential @xmath130 is appropriately chosen , this correction step can be carried out without losing the reduction in @xmath108 obtained by performing the line minimization , and this is why we prefer to take @xmath108 as the object function instead of the total energy , when minimizing with respect to @xmath137 .",
    "we find that this scheme is capable of maintaining the electron number close to its correct value throughout the minimization , and is also simple to implement .",
    "the gradient @xmath138 has elements @xmath139 which , as all other gradients discussed earlier , can be calculated in @xmath111 operations .",
    "minimization with respect to @xmath140 will also have the effect of changing the electron number .",
    "however , given that the two types of variation are performed alternately , the correction during the @xmath137 minimization is sufficient to counteract this effect .",
    "given that variation of @xmath73 causes the electronic density to change , and this in turn implies that the hamiltonian matrix elements change , it would seem necessary to update the hamiltonian at each step of the minimization with respect to @xmath137 .",
    "however , we find that this can be avoided by considering @xmath133 fixed during this part of the minimization . strictly speaking ,",
    "if @xmath133 is held fixed while @xmath137 is varied , we are not minimizing @xmath141 but rather @xmath142 , where @xmath143 is given by @xmath144 \\ ; .\\end{aligned}\\ ] ] if this minimization were carried out through to convergence , this would be equivalent to diagonalizing @xmath133 in the representation of the current support functions . at convergence",
    ", it will be found in general that @xmath137 and @xmath133 are not mutually consistent , and if consistency is required , one needs to update @xmath133 and repeat the minimization , iterating this cycle until consistency was achieved .",
    "this is not necessary in practice , because @xmath133 will be updated at the next variation with respect to the support functions .",
    "the minimization of @xmath145 has practical advantages in that it avoids the updating of the hamiltonian at each step , and , because of its construction , it is a cubic polynomial in every possible search direction , so it is possible to find the exact location of line minima during its minimization .",
    "the minimization with respect to @xmath140 can be carried out by simply moving along the gradient @xmath146 eq .",
    "( [ eq : partialphi ] ) ( steepest descents ) or by using this expression to construct mutually conjugate directions ( conjugate gradients ) .",
    "in order to test our @xmath111 dft scheme , we have performed calculations on a system of 512 si atoms treated using a local pseudopotential .",
    "the purpose of these tests is to find out how the total energy depends on the two spatial cutoff radii : the support - region radius @xmath74 , and the @xmath137-matrix cutoff radius @xmath77 .",
    "the practical usefulness of the scheme , and the size of system for which linear - scaling behavior is attained depend on the rate of convergence of @xmath19 to its exact value as @xmath74 and @xmath77 are increased . here , ` exact ' refers only to the absence of errors due to the truncation of @xmath147 ; other sources of inexactness , such as the use of a discrete grid and a local pseudopotential , are of no concern here .",
    "the system treated is a periodically repeating cell containing 512 atoms of diamond - structure si having the experimental lattice parameter ( 5.43  ) .",
    "the local pseudopotential is the one constructed by appelbaum and hamann  @xcite , which is known to give a satisfactory representation of the self - consistent band structure .",
    "the lda exchange - correlation energy is calculated using the ceperley - alder formula  @xcite .",
    "we use a grid spacing of 0.34  , which is similar to the spacing typically used in pseudopotential plane - wave calculations on si , and is sufficient to give reasonable accuracy .",
    "the second derivatives of the @xmath148 needed in the calculation of @xmath149 are computed using the second - order formula given in eq .",
    "( [ eq : finitedifference ] ) .",
    "a support region is centred on every atom , and each such region contains four support functions .",
    "one can imagine that these support functions correspond roughly to the single 3@xmath150 function and the three 3@xmath151 functions that would be used in a tight - binding description , but we stress that nothing obliges us to work with this number of support functions . in keeping with the tight - binding picture , the initial guess for the support functions",
    "is taken to be a gaussian multiplied by a constant , @xmath152 , @xmath153 or @xmath154 , so that the functions have the symmetry of @xmath150 and @xmath151 states . as an initial guess for the @xmath137-matrix ,",
    "we take the quantity @xmath155 , where @xmath3 is the overlap matrix calculated for the initial support functions .",
    "this guess for @xmath137 , which represents the expansion of @xmath156 to first order , is crude , and does not yield the correct value of @xmath157 .",
    "this error is corrected by displacing @xmath137 iteratively along the gradient @xmath138 until @xmath12 is within a required tolerance of the correct value .",
    "the initial guesses for the @xmath16 and the @xmath73 define the initial hamiltonian and overlap matrices . from this starting point",
    ", we make a number of conjugate - gradient line searches to minimize @xmath108 by varying @xmath137 , with the hamiltonian and overlap matrices held fixed .",
    "this is followed by a sequence of line searches in which the @xmath16 are varied .",
    "we refer to the sequence of @xmath137 moves followed by a sequence of @xmath158 moves as a _",
    "cycle_. the entire energy minimization consists of a set of cycles . in practice",
    ", we have found that cycles consisting of five @xmath137 moves and two @xmath158 moves work satisfactorily , and that @xmath19 is converged to within @xmath159  ev / atom after typically 50 - 60 cycles .",
    "this would not be an efficient rate of convergence for routine applications , but is more than adequate for present purposes .",
    "our test calculations confirm our earlier finding  @xcite that for the si perfect crystal @xmath19 is already quite close to its exact value when @xmath77 = 5.0   .",
    "we have therefore used this value of @xmath77 to make calculations of @xmath19 as a function of @xmath74 ( see fig",
    "the results show that @xmath19 converges very quickly with increasing @xmath74 , and that it is within @xmath160  0.1  ev of its fully converged value for @xmath74 = 3.05   . in order to show how @xmath19 depends on @xmath77 , we present a series of results at the two region radii @xmath74 = 2.04 and 2.38    ( see fig .",
    "these results indicate that there is only a slow variation with @xmath77 and that this variation is almost the same for different values of @xmath74 .",
    "this means that it is possible to converge the total energy to satisfactory accuracy with easily manageable spatial cutoffs .",
    "it is interesting to know the form of the support functions for the self - consistent ground state .",
    "these are shown in fig .  2 for the case @xmath74 = 3.05 , @xmath77 = 5   .",
    "the support functions shown here are the first ( initially @xmath150  gaussian ) and second ( @xmath161  gaussian ) .",
    "profiles of the support functions along the  [ 100 ] , [ 110 ] and  [ 111 ] directions are shown .",
    "the support functions are seen to be symmetric with respect to the center of the support region ( @xmath162 ) along the [ 100 ] and [ 110 ] directions . along the [ 111 ] direction",
    "there is a slight asymmetry resulting from the presence of a nearest neighbour ion , which lies at 2.35    from the origin in the positive direction .",
    "remarkably , the @xmath150-like support function seems to be almost perfectly spherically symmetric , except near the peak at @xmath163   . it is encouraging to see that the support functions go rather smoothly to zero at the region boundary , and this confirms that the boundary is having little effect on the results .",
    "we have tried to do three things in this work : to develop the basic formalism needed to underpin @xmath111 dft - pseudopotential methods ; to implement one such method and identify the main technical issues in doing so ; and to present the results of tests on a simple but important system , which allow us to gauge the usefulness of the method .",
    "we have shown that a rather general class of @xmath111 dft - pseudopotential methods can be based on a formulation of dft in terms of the density matrix , and that this formulation is equivalent to commonly used versions of dft that operate with fractional occupation numbers . from this viewpoint ,",
    "the key challenge is to ensure that the eigenvalues of the variable density matrix lie between 0 and 1 , and we have seen that the method of lnv  @xcite gives a way of doing this . the implementation of the basic ideas has been achieved by performing all calculations in real space , with the dft integrals approximated by sums on a grid  except for the use of fft to treat the hartree term .",
    "an alternative here would be to work with atomic - like basis functions , but we note that the use of a grid preserves an important link with conventional plane - wave methods , as will be analysed in more detail elsewhere .",
    "our test results on perfect - crystal si show that the total energy converges rapidly as the real - space cutoffs are increased , and that it is straightforward to achieve a precision comparable with that of normal plane - wave calculations .",
    "an important question for any @xmath111 method is the system size at which it starts to beat a standard @xmath164 method  a plane - wave method in the present case .",
    "this will clearly depend strongly on the system , but even for si it is too soon to answer it on the basis of practical calculations .",
    "the cross - over point depends on the prefactor in the linear scaling , and this is strongly affected by the efficiency of the coding .",
    "all we have attempted to do here is to address the problem of achieving @xmath111 behavior .",
    "the question of the prefactor is a separate matter , which will need separate investigation .",
    "it should be clear that there is much more to do before the present methods can be routinely applied to real problems .",
    "we have deliberately not discussed in detail the problems of doing calculations on a real - space grid .",
    "such problems have been discussed outside the linear - scaling context in several recent papers  @xcite , and it should be possible to apply the advances reported there to @xmath111 dft calculations .",
    "in particular , curvilinear grids  @xcite for the treatment of strongly attractive pseudopotentials are likely to be very important for @xmath111 calculations . we have also not discussed here the calculation of forces on the atoms , the problems that may arise when the boundaries of support regions cross grid points , and the general question of translational invariance within grid - based techniques .",
    "we have noted already that our method is related to other recently proposed methods . as shown in sec .",
    "2 , the mauri - galli - car scheme is obtained from ours by taking an alternative polynomial expression for the density matrix @xmath7 in terms of the auxiliary matrix @xmath13 .",
    "it would clearly be interesting to repeat the calculations done here using this approach . in a sense , this is what has already been done by hierse and stechel  @xcite , except that instead of performing calculations on a grid , they use a minimal atomic basis set .",
    "the hydrocarbon systems used by them for test purposes are also rather different from the si crystal we have studied .    finally , we note that our linear - scaling scheme is intended for calculations on very large systems , and this means that parallel implementation will play a key role .",
    "the test calculations we have presented were , in fact , performed on a massively parallel machine , and the parallel - coding techniques we have developed will be described in a separate paper .",
    "the work of cmg is supported by the high performance computing initiative ( hpci ) under grant gr / k41649 , and the work of eh by epsrc grant gr / j01967 . the major calculations were done on the cray t3d at edinburgh parallel computing centre using an allocation of time from the hpci .",
    "code development and subsidiary analysis were made using local hardware funded by epsrc grant gr / j36266 . we gratefully acknowledge useful discussions with d. vanderbilt .",
    "we derive here expressions for the derivatives @xmath165 and @xmath166 .      in dft , the total energy eq .",
    "( [ eq : totalenergy ] ) has two types of contributions : those that can be written as the trace of some operator acting on the density matrix , as is the case for the kinetic and pseudopotential energies ( see eq .",
    "( [ eq : traces ] ) ) , and those that depend only on the diagonal elements of @xmath7 , i.e. the electron density , namely the hartree and exchange - correlation energies .",
    "the madelung term , @xmath167 , does not depend on either @xmath73 or @xmath148 , so it will make no contribution to the variation in total energy as these are changed . denoting by @xmath168 the kinetic or pseudopotential contribution to the energy , we have : @xmath169 c_{\\delta \\gamma } \\ ; , \\label{eq : energycont}\\end{aligned}\\ ] ] where @xmath170 for the kinetic energy , and for the pseudopotential @xmath171 where @xmath172 is in general a non - local pseudopotential operator .",
    "clearly , @xmath173 does not depend on @xmath73 for either operator , so this term does not change as @xmath73 is varied .",
    "it is thus easy to see that @xmath174 , \\label{eq : ecab}\\end{aligned}\\ ] ] where @xmath175 is the matrix representation of the corresponding operator ( kinetic energy or pseudopotential ) in the basis of the support functions .    for the hartree and exchange - correlation contributions , denoted by @xmath176 ,",
    "we have that @xmath177 the electron density @xmath134 is simply @xmath178 , so that : @xmath179 \\phi_\\delta({\\bf r}).\\end{aligned}\\ ] ] in the case of the hartree contribution , we have @xmath180 where @xmath181 is the hartree potential , while in the case of the exchange - correlation contribution we have @xmath182 = \\mu_{\\rm xc}({\\bf r}),\\end{aligned}\\ ] ] where @xmath183 is the exchange - correlation potential . if we take @xmath184 to represent either @xmath181 or @xmath185 as the case may be , we see that expression  ( [ eq : evab ] ) reduces to @xmath186,\\end{aligned}\\ ] ] where @xmath187 by comparing this expression with eq .",
    "( [ eq : ecab ] ) , it is easy to see that the partial derivative of the total energy with respect to @xmath73 can be written more compactly as @xmath188 , \\label{eq : etotalab}\\end{aligned}\\ ] ] where @xmath189 is the sum of the corresponding matrix elements of the kinetic , pseudopotential , hartree and exchange - correlation operators , i.e. the matrix representation of the kohn - sham hamiltonian in the basis of the support functions .",
    "recall that in practice , we do not vary @xmath19 but rather vary @xmath190 with respect to @xmath191 .",
    "however , it is trivial to obtain @xmath192 from eq .",
    "( [ eq : etotalab ] ) by simply substituting the matrix elements of @xmath133 by those of @xmath193 . once this is done , eq .",
    "( [ eq : etotalab ] ) corresponds to eq .",
    "( [ eq : partialab ] ) .    [",
    "[ functional - derivative - of - e_rm - tot - with - respect - to - phi_alpha ] ] functional derivative of @xmath19 with respect to @xmath16 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~    according to eq .",
    "( [ eq : separable ] ) , the density matrix , and hence the total energy , can be regarded as a function of the quantities @xmath16 and @xmath17 .",
    "when @xmath16 is varied , @xmath19 therefore varies firstly because of its direct dependence on @xmath16 , and secondly because of the implicit dependence of the @xmath17 matrix on @xmath16 through its dependence on the overlap matrix elements @xmath71 ( see eq .  ( [ eq : k_of_l ] ) ) ; we call these two types of variation type 1 and type 2 .    to see how variations of type 1 behave , consider first the kinetic and pseudopotential energies",
    ". the type 1 variation of either of these is given by : @xmath194 where @xmath195 represents the kinetic energy or the pseudopotential operator .",
    "the variation of the integral gives @xmath196 the last equality follows from the fact that @xmath195 is a hermitian operator .",
    "the type 1 variation of @xmath168 can therefore be expressed as : @xmath197 where @xmath198 represents the action of the operator @xmath195 on @xmath56 evaluated at the point @xmath199 .    now consider the type 2 variation of @xmath168 due to the variation of the overlap matrix elements .",
    "the variation of @xmath71 is @xmath200 and the type 2 variation of @xmath168 is then obtained by applying this expression to eq .",
    "( [ eq : energycont ] ) . after a little manipulation ,",
    "one obtains : @xmath201 here , @xmath175 is the matrix whose elements are : @xmath202 combining eqs .",
    "( [ eq : conphi1 ] ) and  ( [ eq : conphi2 ] ) , we obtain the following expression for the total variations of the kinetic and pseudopotential energies : @xmath203 \\phi_\\beta({\\bf r } ) .",
    "\\label{eq : de_dphi_kps}\\end{aligned}\\ ] ]    for the remaining terms ( hartree and exchange - correlation ) , variation in the energy results from variation in the electron density .",
    "thus we need to calculate @xmath204 \\phi_\\gamma({\\bf r}').\\end{aligned}\\ ] ] again , we will have variations coming directly from the change in @xmath205 and variations coming indirectly from changes in the overlap matrix elements .",
    "the total variation of @xmath206 will be @xmath207 \\nonumber \\\\ & & + \\ ; 2 \\sum_{\\beta \\gamma}\\phi_\\beta({\\bf r}')\\phi_\\gamma({\\bf r } ' ) \\frac{\\delta}{\\delta \\phi_\\alpha({\\bf r } ) } [ 3(lsl)_{\\beta \\gamma } - 2 ( lslsl)_{\\beta \\gamma } ] \\ ; .\\end{aligned}\\ ] ] substituting this expression into @xmath208 where the quantity @xmath209 represents the hartree or exchange - correlation potential , we find , after some manipulation : @xmath210 \\phi_\\beta({\\bf r } ) \\ ; .\\end{aligned}\\ ] ] combining this expression for the hartree and exchange - correlation derivatives with eq .",
    "( [ eq : de_dphi_kps ] ) for the kinetic and pseudopotential derivatives , we find : @xmath211 \\phi_\\beta({\\bf r } ) \\ ; , \\label{eq : de_dphi}\\end{aligned}\\ ] ] where @xmath136 is the kohn - sham operator , and @xmath133 is its matrix representation in the basis of support functions .",
    "note that in the practical grid - based calculations , the derivative we actually want is @xmath212 , which describes the variation of @xmath19 with respect to change of @xmath16 at the grid point @xmath87 .",
    "the formula for @xmath213 is identical to eq .",
    "( [ eq : de_dphi ] ) except that we need to multiply by the volume per grid point @xmath88 .",
    "see e.g. m.c .",
    "payne , m.p .",
    "teter , d.c .",
    "allan , t.a .",
    "arias and j.d .",
    "joannopoulos , rev .",
    "* 64 * , 1045 ( 1993 ) ; m.j .",
    "gillan , in _ computer simulation in materials science _ , edited by m.  meyer and v.  pontikis , kluwer , dordrecht ( 1991 ) ; g.  galli and a.  pasquarello , in _ computer simulation in chemical physics _ , edited by m.p .",
    "allen and d.j .",
    "tildesley , kluwer , dordrecht ( 1993 ) ."
  ],
  "abstract_text": [
    "<S> a recently proposed linear - scaling scheme for density - functional pseudopotential calculations is described in detail . </S>",
    "<S> the method is based on a formulation of density functional theory in which the ground state energy is determined by minimization with respect to the density matrix , subject to the condition that the eigenvalues of the latter lie in the range [ 0,1 ] . </S>",
    "<S> linear - scaling behavior is achieved by requiring that the density matrix should vanish when the separation of its arguments exceeds a chosen cutoff . </S>",
    "<S> the limitation on the eigenvalue range is imposed by the method of li , nunes and vanderbilt . </S>",
    "<S> the scheme is implemented by calculating all terms in the energy on a uniform real - space grid , and minimization is performed using the conjugate - gradient method . </S>",
    "<S> tests on a 512-atom si system show that the total energy converges rapidly as the range of the density matrix is increased . </S>",
    "<S> a discussion of the relation between the present method and other linear - scaling methods is given , and some problems that still require solution are indicated . </S>"
  ]
}