{
  "article_text": [
    "in many soft - matter and biological systems electrostatic interactions have a strong influence on the physical behavior . a typical example are charge  stabilized colloidal dispersions @xcite , whose structure is mainly determined by the interplay between van der waals attraction and electrostatic repulsion .",
    "a simplifying feature is the fact that it is often sufficient to describe the structure of the `` cloud '' of surrounding ions ( counterions and salt ions ) just in terms of mean field theory , in particular if the ions are monovalent . at the center of this theory is the well  known poisson ",
    "boltzmann equation , which , from the mathematical point of view , is a nonlinear partial differential equation .",
    "analytical work in this field has been mainly confined to the linearized ( debye  hckel ) version , which however is often insufficient , in particular near strongly charged objects .",
    "this has prompted efforts to develop methods to solve the equation numerically , ideally in three dimensions and without restrictions on the underlying geometry or spatial symmetry .",
    "these are usually based on standard finite ",
    "difference @xcite or finite ",
    "element @xcite techniques ( for a recent review see ref .",
    "@xcite ) , and have meanwhile reached a substantial degree of sophistication and complexity .",
    "recently , however , maggs @xcite has put forward a completely new approach to electrostatics in soft ",
    "matter research , which bears a certain similarity to lattice gauge theories @xcite .",
    "the central idea is to use the _ electric field _",
    "@xmath0 instead of the electrostatic potential @xmath1 as the quantity on which the algorithm operates , and to view gauss law @xmath2 as a _ constraint _ for the field configurations . on a lattice , it is then easy to construct an electric field ( @xmath0 ) configuration which satisfies gauss law for a given ( arbitrary ) charge density @xmath3 .",
    "the hard part is rather the transversal part of the field , which should satisfy @xmath4 , but initially does not ( unless one uses a sophisticated initialization procedure based upon solving the poisson equation ) .",
    "this transversal degree of freedom can then be removed by local relaxations ( this is the approach taken in the present paper ) , or integrated out by performing a monte carlo @xcite or molecular dynamics @xcite simulation on the overall system .",
    "a crucial aspect of the method is to locally update both @xmath3 and @xmath0 simultaneously in a way that gauss law is still satisfied _ after _ the update , i.  e. the `` constraint surface '' is never left .    the original maggs approach is based upon a system of discrete charges whose statistical physics is treated in a consistent way .",
    "however , it is also possible to apply this to the mean field version of the theory , i.  e. the poisson  boltzmann equation .",
    "the purpose of the present paper is to outline how this can be done in practice . in sec .",
    "[ sec : derivation ] we derive the method by re  formulating the poisson  boltzmann theory in terms of a free energy functional , which is minimized by using a maggs  type algorithm .",
    "in contrast to previous formulations , this functional provides a true minimum , and therefore the procedure is very straightforward and simple , unconditionally stable , and has a rather modest storage requirement which scales only linearly with the number of grid points . in terms of computational speed , the method can probably not yet compete with the existing packages ; however , it is reasonable to assume that more advanced versions that combine the basic methodology with acceleration techniques like adaptive mesh refinement and / or unstructured meshes , may become a very useful tool .",
    "section [ sec : numerics ] presents numerical results obtained with our current simple implementation , while sec .",
    "[ sec : speedup ] discusses optimizations based upon fast fourier transforms and hierarchical pre  conditioners .",
    "finally , sec . [",
    "sec : conclus ] finishes with some concluding remarks .",
    "consider a system of fixed charges , with total charge @xmath5 ( @xmath6 denotes the elementary charge ) dispersed in a solvent with dielectric constant @xmath7 .",
    "the system is confined to a three  dimensional finite domain of volume @xmath8 .",
    "the charges can be distributed either in macroscopic particles or in any other kind of boundary .",
    "furthermore , the domain contains counterions of total charge @xmath9 such that the system as a whole is charge neutral .",
    "the total number of counterions is @xmath10 , such that @xmath11 , where @xmath12 is their valence .",
    "furthermore , the presence of other ionic species ( salt ions ) is allowed if they satisfy charge neutrality , i.  e. if @xmath13 , where @xmath14 is the valence of the ionic species @xmath15 and @xmath16 is its number .",
    "the continuum theory provides equations for the concentrations ( particle number densities ) @xmath17 of each ionic species @xmath15 and the electrostatic potential @xmath18 . in the stationary regime ( no time dependence ) and in thermal equilibrium characterized by the thermal energy @xmath19",
    ", they take the form @xcite @xmath20 the first equation is the equilibrium version of the nernst ",
    "planck equation , which balances the diffusion current of ionic species @xmath15 against the drift caused by the electric field @xmath21 .",
    "the second equation is the poisson equation , taking into account all ionic species as a source term , while the fixed charges appear as boundary conditions .",
    "the total number of particles is obtained by integrating the concentration over the whole domain : @xmath22 and the charge neutrality may then be expressed by @xmath23 with @xmath24 by integrating eq .",
    "[ eq : nernst_planck ] one obtains @xmath25 where the integration constant @xmath26 has the dimension of a concentration , and , for normalization reasons , must have the value @xmath27 inserting this result into eq .",
    "[ eq : poisson ] , one obtains the poisson ",
    "boltzmann equation : @xmath28 which is an equation for @xmath1 only .",
    "however , for the algorithm to be discussed below , it will be advantageous to rather consider the equivalent coupled set of equations ( eqs .",
    "[ eq : nernst_planck ] , [ eq : poisson ] ) .",
    "the poisson ",
    "boltzmann equations can be rewritten in terms of nondimensional quantities , i.  e. in reduced units .",
    "the argument of the exponential in eq .",
    "[ eq : poisson_boltzmann ] suggests the most natural way of rescaling the potential : @xmath29 i.  e. the reduced potential is the electrostatic energy of an elementary charge in units of the thermal energy .",
    "this leads to @xmath30 where @xmath31 is the bjerrum length . introducing a parameter @xmath32 as a characteristic length scale ( see below ) ,",
    "the gradient operator is rescaled via @xmath33 .",
    "this allows writing the equations in the nondimensional form @xmath34 where @xmath35 is the reduced concentration . in terms of the electric field",
    "@xmath36 , the equations are @xmath37 the normalization condition for the amount of species @xmath15 is transformed to @xmath38 with @xmath39 the choice of the parameter @xmath40 is completely immaterial for the mathematical formulation of the problem .",
    "it is only important to map the numerical results back onto a physical system , and therefore a matter of convention . for many applications ,",
    "the choice @xmath41 turns out to be quite useful : this is the natural screening parameter in the finite  volume version of linearized poisson  boltzmann theory ( therefore it also appears in the corresponding treatment of asymmetric electrolytes @xcite ) . in the case of only one monovalent ionic species ( the counterions @xmath42 )",
    ", this reduces to @xmath43 it should be noted that in this case @xmath44 .    from now on , we will be concerned with the problem of numerically solving the reduced set eqs .",
    "[ eq : nernstplanck3][eq : curl3 ] . in",
    "what follows , the primes will be omitted , with the understanding that all quantities ( including @xmath16 and @xmath8 ) are given in reduced units .      following the ideas of maggs and rosetto @xcite , the poisson ",
    "boltzmann equation can be re  formulated as a constrained variational problem , where a free energy functional is minimized .",
    "this functional is constructed such that its euler  lagrange equations are equivalent to eqs .",
    "[ eq : nernstplanck3][eq : curl3 ] .",
    "its form is @xmath45 the first term corresponds to the electrostatic energy and the second to the entropy .",
    "gauss law and the mass normalization conditions are included as constraints , via lagrange multipliers : the field @xmath46 is the electrostatic potential , while the numbers @xmath47 are the chemical potentials of the species @xmath15 .",
    "the euler ",
    "lagrange equations for this variational problem will be derived next .",
    "variation with respect to @xmath1 and @xmath47 just recovers the constraint equations @xmath48 variation with respect to @xmath49 results in @xmath50 while variation with respect to @xmath0 yields @xmath51 the dependence on the unknown lagrange multipliers is removed by taking the gradient of eq .",
    "[ eq : variation1 ] and the curl of eq .",
    "[ eq : variation2 ] to obtain @xmath52 finally , inserting eq .",
    "[ eq : variation2 ] into eq .",
    "[ eq : variation3 ] leads to @xmath53 in summary , the derived equations ( eqs .",
    "[ eq : variation5 ] , [ eq : constraint1 ] , [ eq : variation4 ] ) are the desired set  in other words , the solution of the minimization problem is identical to the solution of the poisson ",
    "boltzmann equation .    in this context",
    ", one should make a few important observations .",
    "firstly , we note that solving the euler ",
    "lagrange equations will provide one and _ only one _ solution : it has been proven ( by variational methods ) that the poisson  boltzmann equation has one unique solution @xcite .",
    "secondly , it is easy to show that the solution is indeed a local minimum : by writing @xmath54 where @xmath55 , @xmath56 form the solution of the problem , and @xmath57 , @xmath58 are small deviations which satisfy the constraints , i.  e. @xmath59 one finds @xmath60 i.  e. small deviations from the solution will always increase the functional .",
    "together with the uniqueness , this shows that the functional has one and only one minimum , which corresponds to the solution of the poisson  boltzmann problem .",
    "therefore , a procedure that relaxes all degrees of freedom of the functional such that it is systematically decreased , while staying on the constraint surface , will ultimately run into the one and only minimum of the free energy landscape .",
    "the iterative procedure may be slow and hampered by small eigenvalues of the hessian at the minimum , but such problems can be kept under control by careful convergence checks and variation of the number of iterations .",
    "a simple algorithm that initializes the system on the constraint surface , keeps it there , and systematically decreases @xmath61 by local updates of all non  constrained degrees of freedom will be outlined in sec .",
    "[ sub : algorithm ] . since the constraints are always satisfied during the procedure , the lagrange  multiplier terms in the functional may be omitted , such that it is simplified to @xmath62 it should also be noted that previous approaches that were also based upon a free  energy functional ( see , e.  g. , ref .",
    "@xcite ) , did _ not _ truly search for a minimum , but rather for a _ saddle point_.",
    "these methods were not based upon a functional that involves the electric field , but rather one that depends on the electrostatic potential , @xmath63 where the @xmath47 are , as before , the lagrange multipliers corresponding to the mass normalization conditions . however , in contrast to its meaning in eqs .",
    "[ eq : define_functional_1 ] , [ eq : define_functional_2 ] , @xmath1 is here _ not _ a lagrange multiplier , but rather a degree of freedom .",
    "it is straightforward to show that the euler  lagrange equations of this problem are equivalent to the poisson  boltzmann equation . to show that this solution is indeed not a minimum but rather a saddle point , one again decomposes @xmath1 and @xmath49 into the solution plus small deviations , @xmath64 with @xmath65 this yields @xmath66 i.  e.",
    "the quadratic form of the deviations is _ not _ positive  definite .",
    "it is natural to suspect that this lack of positive  definiteness causes various numerical difficulties in terms of stability , which therefore are intrinsically absent in the new formulation .",
    "the computational domain is a rectangular parallelepiped of size @xmath67 with periodic boundary conditions .",
    "this box is discretized by a simple orthorombic ( usually : cubic ) lattice with sites @xmath68 and lattice spacings @xmath69 , @xmath70 enumerating the cartesian directions . the volume of a unit cell is thus @xmath71 .",
    "the concentrations @xmath49 are variables on the sites , while the electric field is associated with the _ links_. the positions of the concentration fields are the vectors @xmath72 where @xmath73 are integers .",
    "the field @xmath74 is located at the positions @xmath75 similarly , the positions for @xmath76 and @xmath77 are @xmath78 respectively .",
    "furthermore , it is useful to define @xmath79 these definitions allow to approximate the functional by @xmath80 and to also discretize the divergence operator in a straightforward way : @xmath81 gauss law then reads @xmath82 introducing fluxes via @xmath83 this is rewritten as @xmath84 finally , the normalization condition for the amount of ionic species @xmath15 is discretized as @xmath85      the numerical minimization procedure starts from some configuration of the discretized fields @xmath86 and @xmath0 which satisfies all the constraints , i.  e. the normalization conditions for the ions , plus gauss law .",
    "the algorithm then performs successive local changes in the electric fields and the concentrations , analogously to the monte carlo moves of maggs and rosetto @xcite .",
    "these moves have the big advantage that they rigorously conserve the constraints .",
    "in contrast to ref .",
    "@xcite , however , the moves are not stochastic , but rather deterministic , and constructed in such a way that they decrease the functional , and do this optimally .",
    "since the free energy landscape of this problem has a simple structure ( as discussed in sec . [ sec : variational_approach ] ) , the procedure relaxes the fields into the one and only minimum , which is the solution of the poisson ",
    "boltzmann equation .",
    "the algorithm can be summarized as follows :    1 .",
    "distribute the fixed charges .",
    "2 .   classify the grid points .",
    "distribute the ionic species uniformly in the moveable nodes .",
    "4 .   initialize the electric field .",
    "perform the field moves for all the plaquettes ( smallest closed loops ) in the grid .",
    "perform the concentration moves for all pairs of adjacent moveable nodes .",
    "check if the changes in the functional caused by steps 5 and 6 are less than a given tolerance : if yes , then stop , otherwise , return to step 5 .    in the beginning ,",
    "fixed charges and ionic species must be distributed over the grid .",
    "fixed charges are usually associated with surfaces .",
    "therefore elements of surface charge density must be mapped onto elements of volume charge density , so that they can be associated with some of the nodes .",
    "these nodes are then marked as `` fixed '' and no particles can enter or leave them after initialization .",
    "further nodes may be marked as `` fixed '' if they are known to be empty ( for example , if they represent the interior of a particle ) .",
    "the nodes representing the volume where ions can move are marked as `` moveable '' .",
    "initially , each ionic species is uniformly distributed over the `` moveable '' nodes .",
    "choosing the correct amount of charges then automatically results in charge neutrality of the overall system .",
    "the next step consists in initializing the electric field so that it satisfies gauss law for the initial charge distribution .",
    "one possibility is to solve the poisson equation with some numerical method .",
    "this needs to be done only once , in the initialization .",
    "an alternative , based on charge neutrality , is to initialize each component by means of a recursion over the spatial dimensions @xcite , which is equivalent to applying gauss law to linear chains of nodes .",
    "first the lattice is decomposed into a set of planes perpendicular to the @xmath87axis and it is required that @xmath74 takes the same identical value for all links with identical @xmath87coordinate . then in one ( arbitrary ) plane of links we set @xmath88 .",
    "starting from there , we can then calculate @xmath74 step by step in the subsequent planes of links , where the change in @xmath74 is given by the plane  averaged charge density between the links .",
    "assuming that the procedure is started at the charge plane @xmath89 , it reads @xmath90 where @xmath91 is the plane  averaged charge density at @xmath92 .",
    "charge neutrality combined with the periodic boundary conditions ensures that this procedure will give consistent results after closing the one  dimensional loop .",
    "then each plane is decomposed into a sequence of lines , perpendicular to the @xmath87 and the @xmath93axis , and the analogous procedure is applied to obtain the field in @xmath93direction .",
    "the charges which occur here are the line averages , where however the plane averages have been subtracted ( the latter have already been taken into account via @xmath74 ) .",
    "finally , the lines are decomposed into sites , and @xmath77 is determined from the remaining charges where both line and plane averages have been subtracted .    for field changes , elementary closed loops on the faces of the unit cells ( plaquettes )",
    "are considered . for the orthorombic lattice ,",
    "these are comprised of four nodes and respective links , such that each node is connected to two plaquette links .",
    "now , these four fields are modified in such a way that the flux on each link is changed by the same amount ( taking into account the orientation along the closed loop ) . therefore , gauss law will still be satisfied after that move , since at every node there will be some more flux entering but also the same amount of flux leaving .",
    "let us , for example , consider a plaquette perpendicular to the @xmath94axis , with a sequence of fields @xmath74 , @xmath95 , @xmath96 , @xmath76 along the loop , where @xmath74 , @xmath96 are positive if the field points in positive @xmath87direction ( and analogous for @xmath76 , @xmath95 )",
    ". then the field updates are given by @xmath97 or , in terms of fluxes , @xmath98 where the parameter @xmath99 can be chosen arbitrarily without violating gauss law .",
    "the associated change in the functional is given by @xmath100 which is minimized for @xmath101 this yields the optimal values for the field changes .",
    "axis , for various grid resolutions as indicated by the legends.,scaledwidth=47.0% ]    axis , for various grid resolutions as indicated by the legends.,scaledwidth=47.0% ]    for concentration moves between two adjacent nodes ( connected by a single link ) , gauss law is also conserved if the electric flux is updated accordingly .",
    "suppose that before the move the two adjacent nodes @xmath102 and @xmath103 have , respectively , concentrations @xmath104 and @xmath105 of some ionic species with valence @xmath106 .",
    "without loss of generality we may assume that node @xmath107 has a larger index value than node @xmath108 . the electric flux from node @xmath108 to node @xmath107",
    "is then given by @xmath109 , where @xmath110 is the length of the link , and @xmath111 the field on it .",
    "now , a certain ( positive or negative ) amount @xmath112 is moved from @xmath108 to @xmath107 , i.  e. @xmath113 gauss law tells us that the flux should change by @xmath114 , and this is the case for @xmath115 the resulting change in the functional is given by @xmath116 in order to find the optimal value for @xmath112 , we minimize this expression .",
    "the result is a nonlinear equation , @xmath117 which must be solved numerically . by introducing @xmath118 the equation",
    "is transformed to @xmath119 which shows that it has exactly one solution ( the slope of the left hand side is always positive ) . since @xmath120 ,",
    "the solution will satisfy the condition @xmath121 which is equivalent to @xmath122 , @xmath123 , such that @xmath112 will be in the physically admissible range .",
    "finally , the shape of the left hand side guarantees that a newton iteration starting at @xmath124 will always converge ; hence , this rapid procedure was implemented .",
    "in this section , the feasibility of the present approach is demonstrated by two numerical examples .",
    "the choice of parameters is inspired by previous computer simulations on electrokinetics done in our group @xcite .",
    "we therefore quote them here in unscaled `` physical '' units , where @xmath125 denotes our elementary length scale ( the lennard ",
    "jones diameter in our simulations ) .",
    "all calculations are done with a bjerrum length @xmath126 .",
    "the fixed charge distribution ( boundary condition ) consists of positive charges only , while there is only one ionic species , the monovalent counterions with valence @xmath127 .",
    "the resulting data are also given in `` physical '' units .",
    "consider that the fixed charges are distributed in two infinite parallel plates , perpendicular to the @xmath128-axis , placed at @xmath129 and @xmath130 .",
    "the surface charge density in each plate is @xmath131 . furthermore , suppose that there are no salt ions and that the counterions ( of valence @xmath106 , concentration @xmath132 ) are distributed in the region between the planes .",
    "charge neutrality is given by @xmath133    for this case , the problem is one  dimensional and its analytical solution is well  known @xcite .",
    "therefore , it is ideally suited to test the algorithm .",
    "in reduced units , the poisson ",
    "boltzmann equation is @xmath134 which can be interpreted as newton s equation of motion of a particle with unit mass , whose coordinate is @xmath1 and where the time corresponds to @xmath128 .",
    "hence , this equation can be solved via standard methods of classical mechanics @xcite .",
    "the result is given by @xmath135 where the parameter @xmath136 is related to @xmath108 via @xmath137 .",
    "the surface charge density is given by @xmath138 therefore , @xmath136 can be obtained by solving a simple nonlinear equation numerically .    [ cols=\"^,^,^ \" , ]     as one sees from tab .",
    "[ tab : comparison ] , the number of necessary iterations and the amount of cpu time are quite large .",
    "we have therefore looked for strategies to speed up the procedure without sacrificing the basic formulation that provides intrinsic stability .",
    "one possibility is to remove the rotational component of the electric field not by means of plaquette moves but rather by solving the poisson equation . within the chosen discretization scheme , the electrostatic potential needs to be an object associated with the sites , such that the electric field on a link is obtained by simply taking the potential difference between the adjacent sites",
    "this leads to the simplest possible finite  difference scheme for the poisson equation , which can be solved efficiently and in a stable way by using a fast fourier transform ( fft ) and the appropriate lattice green s function @xcite .",
    "this has the advantage that one single lattice sweep not only reduces the rotational component ( as is the case for the plaquette moves ) but rather eliminates it completely .",
    "therefore the fft promises to increase the convergence speed .",
    "an easy implementation is possible using the well  known and efficient fftw3 library routine @xcite .",
    "it should be noted that the link moves , which update the concentrations and the fields simultaneously , remain unchanged , such that the procedure still stays strictly on the constraint surface .    in a first implementation , we eliminated all plaquette moves and replaced them with fft sweeps done during initialization as well as subsequently after every 25th link sweep .",
    "as seen from tab .",
    "[ tab : speedup ] , this improves the efficiency roughly by a factor of @xmath139 .",
    "these results were obtained on the same computer as those of tab . [",
    "tab : comparison ] .",
    "furthermore , we can tackle the slowdown that comes from the fact that the ions have to be moved by site  by ",
    "site hops throughout the system ( `` hydrodynamic slowing down '' ) . to this end",
    ", we first run the calculation on a rather coarse grid ( in practice , we started with @xmath140 ) , such that most of the necessary `` mass transport '' is already done in that preliminary run .",
    "starting from there , we go to a finer grid ( in practice , we reduced the lattice spacing in all three directions by a factor of two ) and linearly interpolate the output of the previous run onto that grid . then the free energy is relaxed again ; the output of that run is interpolated onto a yet finer grid , and so on .",
    "obviously , this can be done rather easily by a straightforward recursion , until the desired grid resolution is reached .",
    "the runs before the finest resolution may then be viewed as a `` pre  conditioner '' .",
    "this optimization yields another speedup by roughly 25@xmath141 , as seen from tab .",
    "[ tab : speedup ] .",
    "these are obviously two rather simple optimizations , which do not interfere with the basic data structure of the simple cartesian grid .",
    "further optimizations , which are however much more complicated , are possible by ( i ) adaptive mesh refinement ( i.  e. a fine resolution is only used in those regions where the fields vary strongly ) , and ( ii ) using finite  element  type unstructured grids",
    ". such more advanced approaches would be based upon constructing the dual ( voronoi ) lattice in order to define and calculate the fluxes .",
    "while this is expected to yield further substantial speedups , this was not attempted here , and is rather mentioned as a suggestion for the larger community .",
    "variational techniques were used to develop an algorithm for the poisson  boltzmann equation .",
    "the required amount of memory scales linearly with the system size . in our first simple implementation ,",
    "all moves are local .",
    "this leads to fast memory access and fast calculations at each move .",
    "furthermore , the algorithm can be easily parallelized . on the other hand ,",
    "the charges need time to move between distant nodes .",
    "in fact , while the time spent on each move is essentially constant , the total number of sweeps required depends highly on how large a grid is swept .",
    "considerable speedups were possible by using ffts and a hierarchical pre  conditioner , but the basic `` hydrodynamic slowing down '' remains still present .",
    "further speedups are likely to be possible by adaptive mesh refinement and by using unstructured grids .",
    "existing algorithms based on standard discretizations of the differential operators are probably significantly faster than even the fastest of our current implementations",
    ". nevertheless , the approach that we have outlined in the present paper has the inherent advantage that its mathematical formulation provides _ intrinsic _ stability .",
    "this is mainly due to the fact that the free energy functional is formulated in terms of the electric field instead of the electrostatic potential , which provides a search for a _ true minimum _ in function space , rather than for a saddle point . as a result",
    ", the algorithm is very robust , in the sense that it will _ always _ converge to the solution , and at every iteration it approaches the solution more closely .",
    "furthermore , the essential conservation laws that are at the heart of electrostatics  conservation of mass and conservation of electric flux  are built into the formulation with machine accuracy .",
    "we believe that these are fundamental advantages directly related to the underlying physics of the problem , and we consider them as much more important than implementation details .",
    "the maggs formulation provides a new way of thinking about electrostatics , and we hope that this , in combination with existing numerical `` technology '' , will in the future bring about very useful algorithms ."
  ],
  "abstract_text": [
    "<S> a variational approach is used to develop a robust numerical procedure for solving the nonlinear poisson  boltzmann equation . following maggs et al . </S>",
    "<S> , we construct an appropriate constrained free energy functional , such that its euler  lagrange equations are equivalent to the poisson  boltzmann equation . </S>",
    "<S> this is a formulation that searches for a true minimum in function space , in contrast to previous variational approaches that rather searched for a saddle point . </S>",
    "<S> we then develop , implement , and test an algorithm for its numerical minimization , which is quite simple and unconditionally stable . the analytic solution for planar geometry </S>",
    "<S> is used for validation . </S>",
    "<S> some results are presented for a charged colloidal sphere surrounded by counterions , and optimizations based upon fast fourier transforms and hierarchical pre  conditioning are briefly discussed . </S>"
  ]
}