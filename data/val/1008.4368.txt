{
  "article_text": [
    "while gravity is the dominant force in star formation , radiative processes are crucial as well .",
    "most basically , radiation removes energy , allowing a collapsing cloud to maintain a nearly constant , low temperature as its density and gravitational binding energy rise by many orders of magnitude .",
    "radiative cooling is what makes star formation a dynamic rather than a quasi - static process , a point understood quite early ( see the review by * ? ? ?",
    "at densities below @xmath0 h atoms @xmath1 , cooling occurs primarily via collisionally - excited atomic or molecular line emission , while at higher densities dust and gas become thermally well - coupled via collisions , and thermal radiation by dust grains is the dominant cooling process ( e.g. * ? ? ?",
    "* ) . at yet higher densities",
    "the coupled dust - gas fluid becomes optically thick to its own cooling radiation , causing the temperature to rise in a quasi - adiabatic fashion @xcite .    while one - dimensional simulations of this collapse can include quite sophisticated treatments of radiative transfer between gas parcels ( e.g. * ? ? ?",
    "* ) , the computational difficulty of handling rhd in three dimensions led to a long period in which most 3d simulations of star formation simply dispensed with radiation entirely , choosing instead to represent the cooling processes either by a cooling function that removes energy at a rate dependent only on local gas properties , or by an even simpler equation of state that prescribes the gas temperature as a function of density .",
    "however , this approach has a major flaw : it does not allow energy exchange between parcels of gas , or between stars and diffuse gas . the last few years have seen a number of studies pointing out that this energy exchange is crucial to the dynamics of star formation , and that it can be dealt with only by rhd simulations .",
    "the most important radiative transfer processes can be broken into three rough categories : thermal feedback , in which collapsing gas and stars heat the gas and thereby change its pressure ; force feedback , in which radiation exerts forces on the gas that alter its motion ; and chemical feedback , in which radiation changes the chemical state of the gas ( e.g.  by ionizing it ) , and this chemical change somehow affects the dynamics .",
    "each of these processes has been the object of intense study in the last few years .    with regard to thermal feedback , @xcite pointed out that how gas fragments , and thus the stellar mass distribution that results from fragmentation , is extremely sensitive to how the temperature varies with density . @xcite and @xcite showed that one consequence of this sensitivity is that radiation produced by the first few stars to form in a given region can heat the gas around them , reducing the ability of that gas to fragment , favoring monolithic collapse to massive stars and suppressing formation of low mass objects .",
    "subsequent numerical simulations @xcite using a variety of methods have confirmed this effect .",
    "force feedback becomes important in the context of massive stars , which produce such high luminosities that the radiative force they exert on dusty interstellar gas can exceed their gravitational force .",
    "a number of authors have argued based on one - dimensional models that this process sets an upper limit on stellar masses @xcite .",
    "more recent work in two ( @xcite ; also see the contribution by kuiper et al .  in these proceedings ) and three @xcite dimensions instead suggests that force feedback does not limit stellar masses .",
    "deciding the question requires radiation - hydrodynamic simulations .",
    "the most important type of chemical feedback is photoionization , which raises the gas from @xmath2 k to @xmath3 k. this causes a number of important dynamic effects , including ejecting mass from star - forming clouds @xcite , altering the magnetic field structure @xcite , and driving turbulent motions @xcite .",
    "radiation also drives other chemical processes , but these are usually not important for dynamics , and thus may be handled by post - processing simulations . in this review",
    "i limit myself to radiative effects that are dynamically important and must therefore be simulated in tandem with the hydrodynamic evolution of the system .",
    "the equations of radiation hydrodynamics ( rhd ) in conservation form read @xcite @xmath4 where @xmath5 , @xmath6 , @xmath7 , and @xmath8 are the gas density , velocity , specific energy , and pressure .",
    "the source term on the right hand side represents the rate at which radiation transfers momentum and energy to the gas . for simplicity",
    "i have omitted terms describing gravity and magnetic fields , which would appear as additional sources on the right hand side .",
    "the rate at which radiation transfers energy and momentum to the gas is described by the radiation four - force vector @xmath9 , @xmath10 \\left ( \\begin{array}{c } 1 \\\\ { \\mathbf{n}}\\end{array } \\right)\\ ] ] where @xmath11 is a unit vector , @xmath12 is the radiation intensity at frequency @xmath13 in direction @xmath11 , and @xmath14 and @xmath15 are the extinction coefficient and emissivity of the gas as a function of frequency @xmath13 and direction @xmath11 .",
    "finally , the intensity is governed by the transfer equation , @xmath16 for simplicity i have omitted terms describing scattering , which is generally not important for the radiation - hydrodynamics of star formation .",
    "the equations of rhd are , like the ordinary equations of fluid dynamics , characterized by dimensionless numbers .",
    "the two most important ones for radiation - hydrodynmics are @xmath17 , where @xmath18 is the characteristic value of @xmath6 , and @xmath19 , where @xmath20 is the size - scale of the system and @xmath21 is the photon mean free path .",
    "the first ratio @xmath22 characterizes how relativistic the system is . in writing equation ( [ eq : conslaws ] ) in non - relativistic form",
    ", we have already assumed that @xmath23 .",
    "the second , @xmath24 , characterizes how optically thick it is .",
    "systems with @xmath25 are described as being in the streaming limit , and are characterized by weak matter - radiation interaction .",
    "those with @xmath26 are in the diffusion limit and have strong - matter radiation coupling .",
    "both limits appears in star formation problems .",
    "the full system of equations ( [ eq : conslaws ] ) and ( [ eq : transfer ] ) is seven - dimensional , with quantities varying in time , space ( 3 dimensions ) , direction ( 2 dimensions ) , and frequency .",
    "unfortunately , this makes full numerical solution prohibitively expensive even on modern supercomputers .",
    "we are therefore reduced to approximations .",
    "there are two broad classes of approximation in common use in star formation simulations : moment methods and characteristic methods .",
    "a third category , monte carlo methods , has been used extensively in post - processing radiative transfer calculations , but has not been used extensively in radiation - hydrodynamic simulations .",
    "i will not discuss it in detail .      in the discussion that follows",
    "i introduce the most common methods used in amr rhd methods , and in table [ tab : codes ] i summarize which method(s ) are used in each code .",
    "the codes i include in the table are as follows : * orion * is the oldest and probably best - tested amr rhd code , but is not publicly available , and currently lacks a magnetohydrodynamic ( mhd ) capability @xcite .",
    "* ramses * is an amr mhd code that was recently upgraded with a radiation solver , although the latter is not ( as of this writing ) publicly available @xcite . *",
    "flash * is an open source amr mhd code with extensive chemistry capabilities and several add - on modules that handle radiation in different ways @xcite .",
    "* enzo * is an open source amr hd code ( an mhd version exists but is not public ) with cosmology capabilities and two different radiation methods @xcite . *",
    "pluto * is an open source amr mhd code with a newly - developed radiation solver @xcite .",
    "there are also a number of fixed , nested grid codes in use , but i will not mention these by name .",
    "lccclcc + & & + & * @xmath13 resolution * & * frame * & & * code * & * @xmath13 resolution * & * ray scheme * + orion & mg , 2 t & mixed & & orion & 1f & healpix + ramses & 2 t & comoving & & flash & mg & hybrid characteristics + enzo & 2 t & comoving & & enzo & 1f & healpix + pluto & 1 t & comoving & & pluto & mg & sphere +        the basic idea of a moment method is to take moments of the transfer equation , in exact analogy to the chapman - enskog procedure used to derive the equations of fluid dynamics from the kinetic theory of gases . to take the zeroth moment",
    "we integrate the transfer equation over all directions ; to obtain the first moment we multiply both sides by the unit vector @xmath11 and then integrate ; for the second moment we multiply by the rank two tensor @xmath27 and integrate , and so forth . as in the analogous fluid case",
    ", the procedure yields an exact solution if carried out to infinitely many orders , but one instead makes an approximation by truncating the procedure after finitely many orders . usually ",
    "finitely many \" here means one or two , and the first two moments of equation ( [ eq : transfer ] ) are @xmath28 where @xmath29 are the first three moments of the radiation intensity : the radiation energy density , radiation flux , and radiation pressure tensor . in these equations the direction - dependence in the transfer equation is removed and the dimensionality of the problem is lowered by two , but at the price of introducing the radiation pressure tensor , for which we do not have an equation ( since we have not expanded the transfer equation to the next order ) and must instead make an approximation .    because moment methods necessarily involve smoothing the angular dependence of the radiation field , they are best suited to representing diffuse , smooth radiation fields .",
    "this makes them ideal for handling thermal and force feedback , which tend to be dominated by diffuse infrared light re - radiated by dust grains .",
    "they are less suited for chemical feedback , which is usually dominated by direct , highly beamed radiation from a handful of stellar sources .",
    "a further advantage of moment methods is that their computational cost is independent of the number of sources , and usually scales only as @xmath30 or @xmath31 , where @xmath30 is the number of cells .",
    "they also parallelize fairly easily .",
    "moment methods can be classified based on several design choices that are made in their construction , all of which involve some tradeoff between computational expense and accuracy .",
    "see table [ tab : codes ] for a list of the design choices made in each of the popular codes .",
    "_ closure order .",
    "_ the first choice is whether to retain both of the first two moment equations , or to retain only the zeroth moment and adopt a closure approximation for the radiation flux ; all the moment methods currently used in practical star formation simulations make the latter choice , using a closure known as flux - limited diffusion ( fld ) . in a medium where the photon mean free path is small compared to the size of the system , eddington showed that the radiation flux in the fluid rest frame approaches @xmath32 where @xmath33 is the rosseland mean opacity , @xmath34 is the planck function .",
    "this is known as the diffusion approximation .",
    "while it is quite good in optically thick media , it breaks down in optically thin regions because as @xmath35 the signal speed approaches infinity rather than properly limiting to @xmath36 .",
    "the fld approximation is an attempt to fix this problem by instead setting the radiation flux to @xmath37 where @xmath38 is a function that has the property that @xmath39 in optically thick regions and @xmath40 in optically thin regions , so that @xmath41 , its correct limiting value .",
    "many choices for the function @xmath38 are possible ; the most common one in astrophysical applications is the @xcite limiter , @xmath42 , where @xmath43 .",
    "however , all of these limiters are of unknown accuracy in the intermediate optical depth regime , and all fld methods suffer from the problem that they discard information about the directionality and momentum content of the radiation field .",
    "higher order moment methods exist and can solve some of these problems ( e.g.  variable tensor eddington factor methods , @xcite , and the m1 closure method , @xcite ) , but none have yet proven cheap and robust enough for use in practical amr star formation simulations .",
    "_ frequency resolution . _",
    "the second choice in setting up an rhd moment method is the level of resolution in frequency .",
    "most accurate is the multigroup ( mg ) method , in which one discretizes equation ( [ eq : momenteqn ] ) in frequency , solving one version of the equation for each frequency bin . all the bins are coupled via the matter temperature , which affects the extinction and emissivity and thus the radiation four - force vector ( equation [ eq : forcevec ] ) .",
    "next most accurate is the 2 t method , in which one takes the radiation spectrum to be a planck function characterized by a single temperature @xmath44 ( thus removing a dimension from the problem ) , but allows @xmath44 to be different than the gas temperature @xmath45 .",
    "simplest of all is the 1 t method , in which one assumes @xmath46 , allowing a further simplification of the equations .",
    "as one might expect , this choice involves a tradeoff between accuracy and cost ; the 1 t method is cheapest but badly misestimates both the radiation spectrum and @xmath45 in the streaming regime . in comparison 2 t methods still produce incorrect radiation spectra in the streaming regime , but make much smaller errors in the matter temperature .",
    "they are intermediate in cost .",
    "mg provides a good representation of both the spectrum and the matter temperature but is most expensive .",
    "_ choice of frame .",
    "_ the third design choice is whether to formulate the equations in the comoving frame or using mixed frames .",
    "extinction @xmath47 and emissivity @xmath48 are simple , isotropic functions in the frame comoving with the fluid , but in other frames they contain complex directional dependence as a result of relativistic boosting .",
    "one might think that this effect is small in non - relativistic flows , but ignoring it is equivalent to neglecting the work done by radiation on the gas @xcite , which is obviously unacceptable if radiation forces are non - negligible .",
    "to avoid complex velocity dependence in @xmath48 and @xmath47 , it is highly desirable to write them in the comoving frame .",
    "the simplest choice after that is to write the radiation quantities ( @xmath49 , @xmath50 ) in the comoving frame as well ( e.g.  see @xcite ) , but this carries a significant cost .",
    "since the comoving frame is non - inertial in any system with non - constant fluid velocity , the comoving radiation energy is not a conserved quantity , and thus comoving - frame codes can not be exactly conservative . moreover , every time the resolution changes and the velocity field is refined , the reference frame change as well , introducing errors in conservation that are likely to accumulate with increasing refinement .",
    "the alternative is a mixed - frame formulation in which one writes the radiation quantities in the inertial lab frame .",
    "deriving this formulation is tricky , since one must carefully account for the lorentz transformations between frames , but the resulting equations are explicitly conservative , and can be discretized in a manner that conserves energy to machine precision @xcite .      in characteristic methods",
    "one solves the transfer equation ( [ eq : transfer ] ) directly , but only along selected rays .",
    "given this solution , one can compute the radiation four - force vector ( equation [ eq : forcevec ] ) directly .",
    "this provides much greater accuracy in computing the radiation intensity along those rays , but at the cost of neglecting all other rays .",
    "for this reason it is best used for chemical feedback , which tends to be dominated by the rays coming from a small number of sources .",
    "it is not well - suited to handling diffuse radiation fields , and simulations based on this technique are generally no better than non - radiative simulations when it comes to handling effects like fragmentation being altered by a diffuse ir radiation field .",
    "the cost of these methods scales as the number of cells times the number of sources , but with a coefficient that is generally smaller than for moment methods .",
    "thus these methods are cheaper than moment methods when the number of sources and rays is small , but become impractically expensive if the number of sources is even a small fraction of the number of cells . as with moment methods , there are several design choices to be made in setting up a characteristic method .",
    "_ frequency resolution .",
    "_ as in the moment method case , one can choose either to retain the frequency - dependence in the transfer equation by using multiple frequency groups ( the mg method ) , or one can integrate over frequency . in this case",
    "one does not generally assign a temperature to the radiation ; instead , since for chemical feedback one cares about photons only above a certain energy , the usual approximation is to adopt an average photon energy .",
    "this is the single - frequency ( 1f ) approximation .",
    "_ ray - drawing scheme .",
    "_ there are also a number of schemes for drawing rays from the point source(s ) .",
    "the simplest is the spherical ray technique : one uses spherical coordinates , requires that the source be at the origin , and simply draws rays aligned with the computational grid .",
    "this parallelizes almost perfectly and is very simple to code , but is obviously unsuited to any problem with multiple stellar sources or where the locations at which stars form is not known _ a priori_. the other two schemes in wide use are healpix - based adaptive trees @xcite and the hybrid characteristics @xcite , both of which operate on top of an underlying cartesian grid .",
    "the healpix scheme is based on the hierarchical equal area isolatitude pixelization of the sphere , which divides the sphere into a equal area pixels that can be subdivided indefinitely , allowing the angular resolution to adapt to match that of the underlying grid .",
    "the hybrid characteristics scheme works by combining a method of short characteristics within individual amr grids with a method of long characteristics between grids .",
    "neither suffer from the limitations of the spherical ray method .",
    "hybrid methods attempt to combine the best features of characteristic and moment methods .",
    "characteristics work well for the highly beamed radiation coming directly from a star or some other point source .",
    "however , once this radiation is absorbed , following its re - emission with characteristics becomes unreasonably expensive , and a moment method is a far better choice .",
    "the underlying idea of a hybrid method , first used in multidimensional simulations by @xcite and recently implemented in the pluto code @xcite , is to use characteristics for the  first absorption \" , then switch to a moment method .",
    "one does this by performing a characteristic trace from the star or stars to determine the rate of energy and momentum input into each cell by direct radiation .",
    "one adds this as a source term on the right hand side of the moment equation ( [ eq : momenteqn ] ) , then solves as one would in a pure moment method .",
    "the computationally - cheap characteristic step can use mg , while the more expensive moment solve uses the 1 t or 2 t approximation . since the first absorption is generally the part of the problem where the frequency dependence is most important , this method achieves some of the accuracy of a fully frequency - dependent calculation at significantly lower cost .",
    "i close this review with a brief discussion of possible future directions for amr rhd in the star formation context .",
    "one such likely direction comes from combining realistic treatments of thermal , force , and chemical feedback into a single simulation , rather than treating only one or two of them at a time as in current simulations .",
    "since the first two effects are most easily handled by moment methods and the third by characteristic methods , hybrid techniques are the natural solution . to be competitive in handling thermal and force feedback , however",
    ", these methods will have to be linked to more advanced moment methods than has been attempted before .",
    "nonetheless , a hybrid method combining frequency - dependent characteristic tracing with a 2 t , mixed frame fld method is a straightforward extension of current techniques , and seems a logical place to start .",
    "further in the future , second order moment methods are likely to become important .",
    "developing them to the point where they can run reliably in a parallel environment on adaptive grids will be a major algorithmic undertaking , one that is likely to require the assistance of computer scientists and applied mathematicians in addition to astronomers .",
    "if successful , these methods will be able to handle both beamed and diffuse radiation fields within a single framework , and will remove many of the limitations of the fld approximation .",
    "monte carlo methods are another candidate to replace the current dominance of fld and characteristic methods .",
    "they are very computationally costly , since many photons are required to suppress poisson noise , but they have the advantage of near perfect parallelization . since the future of supercomputing seems to be heading toward the development of ever - larger numbers of processors , each of which is no faster than the processors of the previous generation , this may prove to be a decisive advantage .    finally , a caveat : for all the limitations of our current rhd methods , it is not entirely obvious that our numerical techniques are the limiting factor in the accuracy of our simulations .",
    "the main agent for coupling radiation and gas at the high densities where stars form is dust .",
    "our knowledge of dust grain properties , such as sublimation temperatures and grain size distributions in dense environments , is quite limited , and appears likely to advance less quickly than either computer power or algorithmic technique",
    ". it may be the case in the future that our knowledge of dust becomes the limiting factor in the accuracy of rhd simulations .",
    ", m.  l. , bryan , g.  l. , harkness , r. , bordner , j. , reynolds , d. , oshea , b. , & wagner , r. 2008 , in petascale computing : algorithms and applications , ed .",
    "d.  a. bader , computational science series ( chapman & hall / crc ) , 83101 , arxiv:0705.1556                      i thank richard klein , chris mckee , and loius howell for helpful discussions .",
    "i acknowledge support from : an alfred p.  sloan fellowship ; nasa through atfp grant nnx09ak31 g and through the spitzer theoretical research program , through a contract issued by the jpl ; and the nsf through grant ast-0807739 ."
  ],
  "abstract_text": [
    "<S> i provide a pedagogic review of adaptive mesh refinement ( amr ) radiation hydrodynamics ( rhd ) methods and codes used in simulations of star formation , at a level suitable for researchers who are not computational experts . </S>",
    "<S> i begin with a brief overview of the types of rhd processes that are most important to star formation , and then i formally introduce the equations of rhd and the approximations one uses to render them computationally tractable . </S>",
    "<S> i discuss strategies for solving these approximate equations on adaptive grids , with particular emphasis on identifying the main advantages and disadvantages of various approximations and numerical approaches . </S>",
    "<S> finally , i conclude by discussing areas ripe for improvement . </S>"
  ]
}