{
  "article_text": [
    "wannier functions are a well - established tool in the solid state physics community . in addition to providing intuition on chemical bonding , they are the theoretical and computational underpinning of many developments such as tight - binding approximations @xcite , interpolation of band structures @xcite , and the so - called modern theory of polarization or orbital magnetization @xcite .",
    "wannier functions are however not uniquely defined , and the choice of the phase of the ( quasi-)bloch functions can have a dramatic impact on their spatial localization . as for a single isolated bloch band , it was realized already in the sixties that in specific situations , appropriate choices of gauge lead to exponentially localized wannier functions  @xcite .",
    "progress was made in the eighties by nenciu  @xcite as well as helffer and sjstrand  @xcite , who proved in the general case the existence of a bloch gauge yielding exponentially localized wannier functions .    whenever bloch bands intersect each other , as it generically happens in 3d crystals , bloch functions can not be smooth  and not even continuous  at the crossing points ( excluding the exceptional case of 1d systems ) . in this situation ,",
    "a multi - band approach is mandatory .",
    "as early realized @xcite , in insulators and semiconductors it is convenient to consider all the bloch bands below the fermi level as a whole , and to replace bloch functions with quasi - bloch functions , namely eigenfunctions of the projector @xmath0 on the occupied bands .",
    "their preimages under the bloch transform are called composite wannier functions , since they refer to a composite family of energy bands . for the sake of a simpler terminology",
    ", we will skip the adjective `` composite '' in the next sections .",
    "the existence of an orthonormal basis of well - localized wannier functions is equivalent to the existence of an orthonormal frame of quasi - bloch functions , spanning @xmath1 , which is both smooth and periodic as a function of @xmath2 .",
    "such an existence problem has been a long - standing problem in theoretical solid - state physics .",
    "the solution for 1d systems was provided in @xcite , while a solution for 2d and 3d systems required the crucial use of geometric ideas and methods @xcite .    from a practical viewpoint , marzari and",
    "vanderbilt introduced an optimization procedure to minimize the spread of wannier functions @xcite and compute maximally - localized wannier functions ( mlwfs ) .",
    "the corresponding localization functional is now known as the marzari - vanderbilt ( mv ) functional .",
    "the approach based on the minimization of the mv functional was developed before a full understanding of the theoretical criteria for localization was gained .",
    "it however gives very satisfactory results in many situations , and has become one of the standard tools of computational solid state physics .",
    "it was conjectured in @xcite that global minimizers of the mv functional are exponentially localized , a fact which was proved recently in @xcite , thereby providing a firm and mathematically consistent ground for the mv optimization .",
    "it has however been observed that , in some situations , the minimization of the mv functional could fail because the algorithm remained trapped in `` false local minima '' presenting unphysical oscillations @xcite .",
    "this issue is to be distinguished from physically relevant `` real '' local minima @xcite and was associated with bad initial guesses obtained by the projection method and fine @xmath2-point meshes .",
    "this problem has been considered recently in @xcite , where an alternative , more robust method is presented .",
    "this method is however still based on a projection and requires a physical input in the choice of basis functions , while the algorithm we present here does not require any input or parameter tuning . in that sense",
    "it is similar to the recently proposed scdm algorithm @xcite , which uses columns of the density matrix to provide localized wannier functions .",
    "compared to this method , our approach works directly in bloch space , avoiding any representation of the density matrix in real space , and is readily implementable using the same input as standard mlwfs computation .",
    "it also does not depend on a potentially ill - conditioned matrix inversion .",
    "we will show in this work that the issue of `` false local minima '' occurs when the initial guess corresponds to a bloch gauge with vortex - like discontinuities , which prevent the convergence of the mv optimization algorithm on fine samplings of the brillouin zone . to provide an admissible initial guess for the mv algorithm",
    ", we should really find a continuous bloch gauge , a mathematically non - trivial task .",
    "this issue has been studied recently in @xcite and @xcite , where the authors develop constructive algorithms which complement the abstract existence results of @xcite .",
    "both methods are however not trivial to implement in practice , that of @xcite requiring a perturbation argument that might yield to bloch gauge with very sharp transitions , and that of @xcite relying on cumbersome interpolation procedures .    in this work",
    ", we present an algorithm inspired by the theoretical works of @xcite and @xcite but more suited for actual implementation .",
    "this method fixes the gauge at the @xmath3 point in the brillouin zone and then incrementally on its neighboring points , until the whole brillouin zone is covered .",
    "certain pseudo - periodicity conditions have then to be satisfied , which we enforce by the method of obstruction matrices developed in @xcite .",
    "this requires finding continuous and periodic logarithms of families of unitaries , a problem discussed in @xcite .",
    "we propose an algorithm to solve this problem .",
    "although we are unable to prove that this step always produces a continuous bloch gauge , we conjecture it to be the case , and support this claim by numerical tests .",
    "our algorithms only provides a continuous bloch gauge , which yields algebraically - decaying wannier functions .",
    "therefore , we see this algorithm not as an end in itself but as a way to obtain good initial guesses for the mv localization procedure .",
    "we show by numerical examples on two- and three - dimensional systems that this two - step process always yields localized wannier functions , which is not the case for state - of - the - art methods based on the projection method .",
    "we therefore advocate the use of our method when good initial guesses are not available .",
    "we however emphasize that our method only finds `` real '' local minima of the marzari - vanderbilt functional , which might or might not possess optimal spread ( _ i.e .",
    "_ be a global minimum ) .",
    "since they are devoid of any physical input , they might also not correspond to physically intuitive wannier functions .",
    "therefore , we do not see our method as a replacement of the traditional construction of wannier functions for systems where physical insight are available , but rather as an automated procedure that will always produce exponentially - localized wannier functions in the case when intuition is lacking .",
    "this article is organized as follows .",
    "section  [ sec : statement ] introduces the notation and recalls some well - known facts on wannier functions .",
    "we next present our algorithm in a one - dimensional case in section  [ sec:1d ] , then its extensions to the two- and three - dimensional settings in sections  [ sec:2d ] and  [ sec:3d ] .",
    "the subtle issue of the appropriate choice of continuous and periodic logarithms is discussed in section  [ sec : logpb ] .",
    "we finally illustrate the approach with numerical results in section  [ sec : num ] , and present some perspectives in section  [ sec : conclusion ] .",
    "we consider a @xmath4-dimensional crystal .",
    "we denote by @xmath5 the corresponding bravais lattice , by @xmath6 a unit cell centered on the origin , and by @xmath7 the reciprocal lattice , with @xmath8 .",
    "we choose the vectors @xmath9 as a basis for the reciprocal lattice . in these coordinates ,",
    "the brillouin zone is @xmath10   \\right\\ } }      \\simeq \\left[-\\frac12 , \\frac12\\right]^{d},\\ ] ] where the symbol @xmath11 refers to the fact that hereafter we will identify the vector @xmath12 with its components @xmath13 with respect to the reciprocal basis .",
    "the key input of our algorithm is a family @xmath0 of orthogonal projectors of rank @xmath14 , which is smooth with respect to the wave vector @xmath15 .",
    "such projectors are obtained , in standard solid - state physics computations , by spectral projections of the effective one - body schrdinger operator @xmath16 where @xmath17 is a real - valued @xmath18-periodic potential . more precisely ,",
    "introduce the bloch orbitals @xmath19 , with periodic parts @xmath20 , so that @xmath21 the integer @xmath22 labels the band index , while @xmath23 denotes the quasi - momentum . for a fixed @xmath23 , the periodic functions @xmath24 form an orthogonal basis of @xmath25 consisting of solutions of the following eigenvalue problem : @xmath26 where the @xmath27 are labeled by @xmath22 in increasing order .",
    "our convention for the bloch transform is @xmath28 in order to construct wannier functions from the bloch orbitals , we identify a set @xmath29 of @xmath14 bloch bands in the energy spectrum .",
    "we assume that they are isolated in the sense that @xmath30 this gap condition is satisfied for instance by the occupied bands of an insulator or a semiconductor .",
    "it ensures that the spectral projector @xmath31 is a smooth ( and even analytic ) function of @xmath2 @xcite .",
    "the underlying symmetries of the hamiltonian @xmath32 translate into corresponding symmetries of the family of projectors @xmath0 .",
    "we first note that , because the potential @xmath33 is real , @xmath0 satisfies the time - reversal property @xmath34 where @xmath35 is the anti - unitary operator corresponding to complex conjugation , namely @xmath36 we also note that , for any @xmath37 , @xmath38 with the following unitary translation operators @xmath39 the convention we use here is slightly different from the one in  @xcite : our definition of @xmath40 ensures that @xmath41 is an eigenvector of @xmath42 ( so that @xmath40 is a translation by @xmath43 ) .",
    "the family of operators @xmath44 is a unitary group representation of @xmath45 , in the sense that @xmath46    in view of the time - reversal symmetry   and the translation property  , we can restrict ourselves to studying the reduced brillouin zone @xmath47   &     \\\\",
    "k_j \\in [ { \\mbox{\\footnotesize $ - \\frac{1}{2}$ } } , { \\mbox{\\footnotesize $ \\frac{1}{2}$ } } ]   & \\text { for } j { \\geqslant}2   \\end{array }   \\right\\ } }   \\simeq   \\left[0,\\frac12\\right ] \\times \\left[-\\frac12 , \\frac12\\right]^{d-1},\\end{aligned}\\ ] ] and map functions defined for @xmath48 to functions defined for any @xmath49 by reflection and translation .    similarly to @xcite",
    ", we do not use the specific structure of the model , so that the approach presented here can be applied to various other periodic models of quantum mechanics , such as tight - binding models or relativistic models described by a dirac operator .",
    "we only require a continuous family of projectors @xmath0 satisfying and , for some unitary operators @xmath44 and an anti - unitary operator @xmath35 satisfying @xmath50    [ rmk : more_symmetries ] it is possible to further restrict the brillouin zone under consideration when @xmath0 has more symmetries than the time - reversal and translation symmetries and .",
    "the construction we present here does not take into account these possible additional symmetries , and therefore may produce wannier functions that do not respect these symmetries",
    ". our algorithm could be extended to work only on the irreducible brillouin zone , but this is outside the scope of this paper .",
    "the fundamental element to construct well localized wannier functions and the output of our algorithm is a bloch frame depending smoothly on the wave vector @xmath2 . by definition , a bloch frame ( or , shortly , a frame ) is a mapping from @xmath51 to an orthonormal basis @xmath52 of @xmath53 , such that each component satisfies the pseudo - periodicity property @xmath54 the latter condition expresses the fact that such functions are compatible with the symmetries of the family of projectors given by .",
    "we emphasize that , despite the similarity in the notation , we do not assume that the functions @xmath55 are ( the periodic part of ) bloch functions . it is only assumed that @xmath56 while @xmath57 does not hold true in general .",
    "such functions are sometimes called quasi - bloch functions in the literature .    as already noticed @xcite ,",
    "the existence of a smooth bloch frame is not trivial in view of the competition between the smoothness of @xmath58 and the property , which encodes a global topological constraint .",
    "for instance , it is known that in some models with broken time - reversal symmetry ( _ e.g .",
    "_ in the presence of a magnetic field or in a chern insulator ) there can not exist any such continuous frame , due to a topological obstruction @xcite .    for two given frames @xmath58 and @xmath59 ,",
    "we write @xmath60 for the @xmath61 matrix with entries @xmath62 for a @xmath61 matrix @xmath63 , we write @xmath64 note that , if @xmath58 is a frame , then so is @xmath65 when the matrices @xmath63 are unitary for all values of @xmath49 . similarly , for an operator @xmath66 , @xmath67",
    "is obtained by applying @xmath66 to all components @xmath68 of @xmath69 independently .",
    "these conventions allow for a uniform notation whether @xmath68 are functions or coefficients in a basis set of size @xmath70 ( in which case @xmath69 is a @xmath71 matrix , and the previous definitions are simply restatements of matrix multiplication rules ) .",
    "( composite ) wannier functions are defined , for a given frame @xmath58 , by @xmath72 and the translations of these functions : @xmath73 the wannier functions @xmath74 form a complete orthonormal basis of the subspace of @xmath75 associated with the chosen @xmath14 bands .",
    "the localization properties of the wannier functions are determined by the regularity of the frame @xmath58 .",
    "this can be seen from the fact that , because @xmath58 satisfies the pseudo - periodicity property , an integration by parts gives @xmath76 therefore , a @xmath77 frame yields wannier functions that decay faster than any polynomial , and an analytic frame yields exponentially localized wannier functions ( see section 2 of @xcite for a more precise statement involving the sobolev regularity of @xmath20 ) . in practice ,",
    "the frame straightforwardly coming out of the simulations , computed on the reduced brillouin zone , is usually not smooth because of the arbitrary phases of the @xmath20 and of the possible crossings between the energy levels @xmath78 .",
    "therefore , some correction through a family of unitary matrices @xmath63 has to be applied to the frame in order to transform it into a smooth frame @xmath79 .",
    "although it is easy to fix phases to impose local smoothness , global smoothness is a more complicated issue because the frame , extended by reflection and translation to the full space @xmath80 , might not be continuous at the boundary of the reduced brillouin zone .",
    "certain compatibility or gluing conditions should be satisfied in order for this extension to be smooth .",
    "our problem is to compute real - valued localized wannier functions , which , after bloch transform , is equivalent to the following .    [ pbm ]",
    "find a smooth frame @xmath58 such that @xmath81    the additional property ensures that the wannier functions are real - valued .",
    "we discuss in the next section an algorithm for constructing continuous frames .",
    "we do not attempt to impose a higher degree of regularity , as done in @xcite via abstract procedures , but consider a more pragmatic approach where a subsequent smoothing of the continuous frame is obtained with the mv algorithm .",
    "our hope is that the continuous frame we obtain at the end of our procedure is a sufficiently good initial guess for the minimization of the mv functional in order to actually converge towards a minimizer .",
    "we present here a practical algorithm to solve problem  [ pbm ] in dimension  1 .",
    "it can be seen as a discretization of well - known procedures to construct smooth frames @xcite , dating back to at least @xcite , and discussed in @xcite section iv.c.1 .",
    "we however carefully present this simple case since , as in  @xcite , it is the building block of the algorithm in higher dimensions .",
    "we start from a given frame @xmath58 on the reduced brillouin zone @xmath82 $ ] , which we then extend to the whole space @xmath83 by the relations   and  .",
    "more precisely , we first extend @xmath58 to @xmath84 by @xmath85 , and then to any @xmath86 by @xmath87 where @xmath88 is such that @xmath89 $ ] .",
    "this procedure yields a globally continuous frame if and only if the frame on @xmath90 is continuous and satisfies the following compatibility conditions at @xmath91 and @xmath92 : @xmath93 the algorithm we propose consists of four steps : choosing a starting frame at @xmath91 satisfying , propagating this to @xmath94 $ ] , enforcing at @xmath92 , and propagating this fix back to @xmath94 $ ] .",
    "[ [ step-1-fix-0 . ] ] step 1 : fix @xmath91 .",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + + + +    the first step is to choose a frame @xmath95 satisfying  .",
    "since @xmath96 is real - valued , this can be done by choosing an orthonormal set of real - valued eigenfunctions of @xmath96 .",
    "[ [ step-2-propagate - from - k0-to - k-12 . ] ] step 2 : propagate from @xmath97 to @xmath98 .",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    evolving the eigenvector at @xmath97 to @xmath99 can be done in various ways , for instance by the sz .- nagy intertwining unitary as done in  @xcite . here",
    "we describe a natural way of performing this operation on a mesh of @xmath100-points , using a lwdin orthogonalization procedure .",
    "assume that a mesh @xmath101 of @xmath82 $ ] is given .",
    "we construct iteratively @xmath102 since @xmath103 is continuous , provided the mesh spacing is sufficiently small , the overlap matrix @xmath104 has its eigenvalues bounded away from 0 , so that @xmath105 is a well - defined orthonormal basis of @xmath106 .",
    "when the mesh spacing tends to zero , it can be shown that @xmath58 converges to the solution of the following ode , with initial condition @xmath95 : @xmath107^ { * } u_k + u_k^ { * } \\left[\\frac{dp(k)}{dk } u_k\\right ] \\right).\\ ] ] in particular , the function @xmath108 is smooth .    [",
    "[ step-3-enforcing - at - k-12 . ] ] step 3 : enforcing at @xmath98 .",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    the previous step yields a frame that is continuous , satisfies the compatibility condition , but not  .",
    "note however that @xmath109 , so that @xmath110 and @xmath111 are both orthonormal bases of the same space .",
    "there exists therefore a unitary matrix @xmath112 , which we call `` obstruction matrix '' following @xcite , such that @xmath113 this matrix can be explicitly computed as @xmath114 .",
    "a simple computation also shows that @xmath115 : @xmath116_{nm } & = \\langle u_{n,1/2 } , \\tau_{1 } c u_{m,1/2 } \\rangle = \\langle c \\tau_{1 } c u_{m,1/2 } , c u_{n,1/2}\\rangle = \\langle \\tau_{-1 } u_{m,1/2 } , c u_{n,1/2}\\rangle \\\\ & = \\langle u_{m,1/2 } , \\tau_{1 } c u_{n,1/2}\\rangle = [ { u_{\\mathrm{obs}}}]_{mn}. \\end{aligned}\\ ] ] therefore @xmath117 .",
    "we now look for a matrix @xmath118 such that @xmath119 satisfies the compatibility condition . applying @xmath120 and using ,",
    "we get @xmath121 we see that @xmath119 satisfies the compatibility condition if and only if @xmath122 , _ i.e.  _ @xmath123 . since @xmath124",
    ", we can choose @xmath125 with this choice , @xmath119 satisfies .",
    "we define the fractional power of a normal matrix in the usual way , by applying the exponent to its eigenvalues . for matrices with complex eigenvalues @xmath126 such as @xmath112",
    ", defining @xmath127 requires choosing a branch cut in the complex plane for the logarithm , which we fix by using the principal determination , _",
    "i.e.  _ for all @xmath128 $ ] .",
    "[ [ step-4-correct - the - frame - on - mathcal - b_rm - red . ] ] step 4 : correct the frame on @xmath90 .",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    the last step is to globally define a new frame @xmath129 on @xmath90 by interpolation : @xmath130 note that @xmath131 , and so @xmath129 satisfies . in the limit of infinitely small mesh spacing ,",
    "the mapping @xmath132 is continuous , and so is @xmath133 , which implies that @xmath134 is continuous on @xmath90 .",
    "the compatibility conditions finally ensure that @xmath135 can be extended to a continuous frame for all @xmath86 .",
    "we have only imposed continuity in our construction , but we actually get a smooth frame . this is because the frame we constructed is the same as the one we would obtain by defining @xmath58 on @xmath83 via the propagation , then @xmath136 .",
    "the latter frame is smooth because both @xmath132 and @xmath133 are .",
    "as in the one - dimensional case , we first construct a frame on the reduced brillouin zone @xmath137 \\times \\left[-\\frac12 , \\frac12\\right],\\end{aligned}\\ ] ] and then extend it by symmetry to the whole space using   and  .",
    "this yields a globally continuous frame if and only if the frame on the reduced brillouin zone is continuous and the following compatibility conditions are satisfied : @xmath138    note that these conditions are now edge conditions , relating two points of the same edge ( for and ) or two points on opposite edges ( for ) , in contrast to the point conditions of the one - dimensional case .",
    "these edge conditions imply compatibility conditions at the special points @xmath139 and @xmath140 , which are the fixed points of the symmetry group .",
    "all these conditions can be visualized on figure [ fig : bz2d ] .",
    "we take care of these conditions in a sequential manner : we first find a frame on @xmath141 $ ] that satisfies , extend this to a frame satisfying , then enforce the condition on the right edge .    [",
    "[ step-1-constructing - a - frame - satisfying - and . ] ] step 1 : constructing a frame satisfying   and  .",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    we first use the one - dimensional construction to obtain a frame @xmath142 with @xmath143 , satisfying as well as @xmath144 then , for every @xmath145 $ ] , we propagate from @xmath146 to @xmath147 using the propagation procedure described in   in the one - dimensional case .",
    "this defines a frame on @xmath90 .",
    "the compatibility condition   at @xmath148 is propagated for any @xmath149 $ ] , which implies that is satisfied .",
    "let us prove this when starting from @xmath150 and going to @xmath151 .",
    "we define @xmath152 .",
    "then , using   and then  , @xmath153 so that follows upon normalizing the frames as @xmath154 . however , is not satisfied in general .    [",
    "[ step-2-enforcing - the - compatibility - conditions - at - the - corners-12-pm-12 . ] ] step 2 : enforcing the compatibility conditions   at the corners @xmath155 .",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    before satisfying on the right edge , we enforce the condition at the corner @xmath156 , where the condition implies @xmath157 this is a point compatibility condition analogous to the one encountered in the one - dimensional case . to enforce it",
    ", we consider the unitary obstruction matrix @xmath158 and define the modified frame @xmath159 the modified frame @xmath129 satisfies by construction .",
    "note also that the transformation   preserves the compatibility conditions   and  .",
    "moreover , and imply that @xmath129 also satisfies the corner condition at @xmath160 : @xmath161 in order to simplify the notation , we drop the prime in the remainder of the algorithm , and simply denote by @xmath58 the modified frame obtained at the end of this step .    [",
    "[ step-3-enforcing - on - the - right - edge . ] ] step 3 : enforcing   on the right edge .",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    we still need to modify @xmath58 to satisfy for any value of @xmath162 $ ] .",
    "we define to this end the following family of obstruction matrices : @xmath163 these matrices satisfy by construction @xmath164 at this point , we would like to define a new frame by @xmath165 the frame @xmath129 satisfies all the compatibility conditions  -- , is continuous with respect to @xmath166 , but may fail to be continuous with respect to @xmath167 , because the eigenvalues of @xmath112 may pass through the branch cut of the logarithm in the negative real axis . we are therefore faced with the problem of the continuous periodic logarithm : find a matrix valued function @xmath168 , with @xmath169 hermitian , which is continuous and satisfies the following conditions for all @xmath145 $ ] : @xmath170 if such a function exists , the frame @xmath171 is continuous and satisfies the compatibility conditions  -- .",
    "we delay the discussion of this problem to section  [ sec : logpb ] .",
    "the behavior of the algorithm on a simple example can be visualized in figure  [ fig : ex_alg ] .",
    "the algorithm produces a continuous frame .",
    "however , in contrast to the 1d case , it does not provide any additional regularity . because the 1d construction guarantees a smooth frame , there are no discontinuities of derivatives in the vertical direction , _",
    "i.e.  _ at the points @xmath172",
    ". however , the condition for the first derivative to be continuous at a point @xmath147 is @xmath173 which is in general incompatible with  .",
    "this yields discontinuous derivatives at @xmath174 .",
    "this means that the wannier function will only decay algebraically in the @xmath175 direction , as can be seen in the right panel of figure [ fig : ex_alg ] .",
    "this is however easily fixed by the application of the mv minimization algorithm , as will be shown on figure [ fig : ours ] in section [ sec : num ] .",
    "we note that the mv algorithm is essentially equivalent to other forms of smoothing , such as for instance the one employed in @xcite : the mv algorithm can be seen as the gradient flow of a dirichlet - like energy functional , _",
    "i.e.  _ a heat flow , whose solution can be written as a convolution similar to the one used in @xcite .",
    "0.33   real part of the average of the first component , @xmath176 , of a bloch frame corresponding to @xmath177 bloch bands , as a function of @xmath178^{2}$ ] ( top ) and associated wannier function @xmath179 in logarithmic scale ( bottom ) .",
    "the real part of the average of @xmath180 is used as a proxy to visualize the regularity of the frame @xmath181 .",
    "+ after step 1 , the frame satisfies the compatibility conditions related to vertical translations , and the associated wannier function is localized vertically , but not horizontally ( left panel ) .",
    "after step 2 , the frame satisfies all the compatibility conditions at the corners @xmath182 ( with @xmath183 ) , but not on the vertical edges between these points .",
    "the associated wannier function is still delocalized horizontally ( middle panel ) .",
    "after step 3 , the frame satisfies all the compatibility conditions and is globally continuous , although not smooth .",
    "the associated wannier function is localized , but exhibits a slow algebraic horizontal decay ( right panel ) .",
    "see section [ sec : num ] for the details of the model used.,title=\"fig : \" ]    0.33   real part of the average of the first component , @xmath176 , of a bloch frame corresponding to @xmath177 bloch bands , as a function of @xmath178^{2}$ ] ( top ) and associated wannier function @xmath179 in logarithmic scale ( bottom ) .",
    "the real part of the average of @xmath180 is used as a proxy to visualize the regularity of the frame @xmath181 .",
    "+ after step 1 , the frame satisfies the compatibility conditions related to vertical translations , and the associated wannier function is localized vertically , but not horizontally ( left panel ) . after step 2 , the frame satisfies all the compatibility conditions at the corners @xmath182 ( with @xmath183 ) , but not on the vertical edges between these points .",
    "the associated wannier function is still delocalized horizontally ( middle panel ) .",
    "after step 3 , the frame satisfies all the compatibility conditions and is globally continuous , although not smooth .",
    "the associated wannier function is localized , but exhibits a slow algebraic horizontal decay ( right panel ) .",
    "see section [ sec : num ] for the details of the model used.,title=\"fig : \" ]    0.33   real part of the average of the first component , @xmath176 , of a bloch frame corresponding to @xmath177 bloch bands , as a function of @xmath178^{2}$ ] ( top ) and associated wannier function @xmath179 in logarithmic scale ( bottom ) .",
    "the real part of the average of @xmath180 is used as a proxy to visualize the regularity of the frame @xmath181 .",
    "+ after step 1 , the frame satisfies the compatibility conditions related to vertical translations , and the associated wannier function is localized vertically , but not horizontally ( left panel ) . after step 2",
    ", the frame satisfies all the compatibility conditions at the corners @xmath182 ( with @xmath183 ) , but not on the vertical edges between these points .",
    "the associated wannier function is still delocalized horizontally ( middle panel ) .",
    "after step 3 , the frame satisfies all the compatibility conditions and is globally continuous , although not smooth .",
    "the associated wannier function is localized , but exhibits a slow algebraic horizontal decay ( right panel ) .",
    "see section [ sec : num ] for the details of the model used.,title=\"fig : \" ]    0.33   real part of the average of the first component , @xmath176 , of a bloch frame corresponding to @xmath177 bloch bands , as a function of @xmath178^{2}$ ] ( top ) and associated wannier function @xmath179 in logarithmic scale ( bottom ) .",
    "the real part of the average of @xmath180 is used as a proxy to visualize the regularity of the frame @xmath181 .",
    "+ after step 1 , the frame satisfies the compatibility conditions related to vertical translations , and the associated wannier function is localized vertically , but not horizontally ( left panel ) . after step 2 , the frame satisfies all the compatibility conditions at the corners @xmath182 ( with @xmath183 ) , but not on the vertical edges between these points .",
    "the associated wannier function is still delocalized horizontally ( middle panel ) .",
    "after step 3 , the frame satisfies all the compatibility conditions and is globally continuous , although not smooth .",
    "the associated wannier function is localized , but exhibits a slow algebraic horizontal decay ( right panel ) .",
    "see section [ sec : num ] for the details of the model used.,title=\"fig : \" ]    0.33   real part of the average of the first component , @xmath176 , of a bloch frame corresponding to @xmath177 bloch bands , as a function of @xmath178^{2}$ ] ( top ) and associated wannier function @xmath179 in logarithmic scale ( bottom ) .",
    "the real part of the average of @xmath180 is used as a proxy to visualize the regularity of the frame @xmath181 .",
    "+ after step 1 , the frame satisfies the compatibility conditions related to vertical translations , and the associated wannier function is localized vertically , but not horizontally ( left panel ) .",
    "after step 2 , the frame satisfies all the compatibility conditions at the corners @xmath182 ( with @xmath183 ) , but not on the vertical edges between these points .",
    "the associated wannier function is still delocalized horizontally ( middle panel ) . after step 3",
    ", the frame satisfies all the compatibility conditions and is globally continuous , although not smooth .",
    "the associated wannier function is localized , but exhibits a slow algebraic horizontal decay ( right panel ) .",
    "see section [ sec : num ] for the details of the model used.,title=\"fig : \" ]    0.33   real part of the average of the first component , @xmath176 , of a bloch frame corresponding to @xmath177 bloch bands , as a function of @xmath178^{2}$ ] ( top ) and associated wannier function @xmath179 in logarithmic scale ( bottom ) .",
    "the real part of the average of @xmath180 is used as a proxy to visualize the regularity of the frame @xmath181 .",
    "+ after step 1 , the frame satisfies the compatibility conditions related to vertical translations , and the associated wannier function is localized vertically , but not horizontally ( left panel ) . after step 2 , the frame satisfies all the compatibility conditions at the corners @xmath182 ( with @xmath183 ) , but not on the vertical edges between these points .",
    "the associated wannier function is still delocalized horizontally ( middle panel ) .",
    "after step 3 , the frame satisfies all the compatibility conditions and is globally continuous , although not smooth .",
    "the associated wannier function is localized , but exhibits a slow algebraic horizontal decay ( right panel ) .",
    "see section [ sec : num ] for the details of the model used.,title=\"fig : \" ]",
    "we use the same induction to pass from the two - dimensional to the three - dimensional case as the one to pass from the one - dimensional to the two - dimensional case .",
    "we define a frame on the reduced brillouin zone @xmath184 \\times \\left[-\\frac12 , \\frac12\\right]^{2},\\ ] ] and extend it to the full reciprocal space by symmetry .",
    "the compatibility conditions to be satisfied by the frame @xmath58 are now @xmath185",
    "our first step is to use the two - dimensional algorithm to build a frame @xmath186 on the face @xmath187 .",
    "this frame satisfies  , and additionally @xmath188 for any @xmath189^{2}$ ] , we propagate from @xmath190 to @xmath191 using  .",
    "this defines a continuous frame on @xmath90 which satisfies -- , but not .",
    "[ [ step-2-enforcing - on - the - edges - of - the - face - k_1 - 12 . ] ] step 2 : enforcing on the edges of the face @xmath192 .",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    as in the two - dimensional case , before enforcing   on the whole face @xmath192 , we enforce it on the four edges of its boundary . in order to do this",
    ", we first fix the corner @xmath193 , for which the compatibility condition is @xmath194 we define the obstruction matrix @xmath195 and introduce @xmath196 by construction , @xmath129 satisfies  .",
    "the compatibility conditions -- are also still valid for the modified frame @xmath129 . in addition , in view of   and  - , the frame @xmath129 satisfies the compatibility conditions at the other corners @xmath197 and @xmath198 .",
    "we next enforce the condition on the edge @xmath199 , namely : @xmath200 the corresponding unitary obstruction matrix is @xmath201 note that @xmath202 and @xmath203 . as in the two - dimensional case , provided",
    "we can solve the logarithm problem , we find a hermitian logarithm @xmath204 satisfying @xmath205 , @xmath206 and @xmath207 , and modify the frame as @xmath208 the modified frame @xmath209 then satisfies on the two edges @xmath210 .",
    "we repeat this construction on the edge @xmath211 , and introduce appropriate hermitian matrices @xmath212 such that @xmath213 satisfies on the two edges @xmath214 .    to simplify the notation",
    ", we drop the primes in the remainder of the algorithm , and simply denote by @xmath58 the modified frame obtained at the end of this step .    [ [ step-3-enforcing - on - the - whole - face - k_1 - 12 . ] ] step 3 : enforcing on the whole face @xmath192 .",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    the compatibility condition   is , on the whole face @xmath215 : @xmath216 we therefore introduce the family @xmath217 of unitary obstruction matrices @xmath218 because of the previous step , @xmath219 as in the two - dimensional case , we would like to define a new frame satisfying all the compatibility conditions as @xmath220 we again face with the logarithm problem , which we discuss in section  [ sec : logpb ] .    as a mathematical curiosity , this construction immediately extends to higher dimensions , again provided the logarithm problem can be solved . by induction , we first build a frame on @xmath141^{d-1}$ ] , then propagate it to @xmath94 \\times [ -1/2 , 1/2]^{d-1}$ ] .",
    "we next fix the obstruction on the boundary of @xmath221^{d-1}$ ] , and conclude by finding a continuous logarithm of the obstruction matrix on @xmath221^{d-1}$ ] to correct the frame .",
    "we come back in this section to the so - called logarithm problem , summarized in problem  [ pbm : log ] below .",
    "an element @xmath49 is denoted @xmath222 in this section .",
    "we also introduce the set of edges in dimension 3 ( vertices in dimension 2 ) @xmath223^{d-1 } \\ , \\left| \\ , k_i \\in \\left\\ { -\\frac12,\\frac12 \\right\\ } \\textrm { for some } 2 { \\leqslant}i { \\leqslant}d \\right .",
    "\\right\\}.\\ ] ] with this notation , we can summarize the logarithm problem as follows .",
    "[ pbm : log ] given a continuous mapping @xmath224 from @xmath225^{d-1}$ ] to the set of unitary matrices , such that @xmath226 and @xmath227^{d-1 } , \\qquad u(-{\\mathbf{k } } ' ) = u({\\mathbf{k}}')^{t},\\end{aligned}\\ ] ] find a continuous mapping @xmath228 from @xmath225^{d-1}$ ] to the set of hermitian matrices , such that @xmath229 and , for all @xmath230^{d-1}$ ] , @xmath231    this is the problem as used by our construction in the previous two sections : is satisfied because we fixed the obstruction matrix on the edges , while stems from the structure of the conditions and .",
    "let us already note that this problem can not be solved in general ( see the counter - example in  @xcite , which we recall in section  [ sec : eig_collisions ] ) .",
    "we describe an algorithm that solves the problem provided that the type of eigenvalue collisions present in this counter - example does not occur . in our numerical tests , we did not encounter such difficulties and were always able to solve the logarithm problem .",
    "we refer to section [ sec : eig_collisions ] for a discussion of this issue .",
    "a logarithm of @xmath224 can be found by starting at @xmath232 , and by following the eigenvalues of @xmath224 to ensure the continuity of @xmath228 .",
    "this procedure can be seen as a discrete counterpart of the phase following procedure used in  ( * ? ? ?",
    "* lemma  2.13 ) for a single band .",
    "assume that @xmath233 $ ] is partitioned as @xmath234 .",
    "we set @xmath235 , and iteratively determine @xmath236 as a logarithm of @xmath237 , taking into account the phase information in @xmath238 . to this end , we diagonalize @xmath237 as @xmath239 , where @xmath240 is unitary and @xmath241 a diagonal matrix whose entries have modulus  1 .",
    "we then set @xmath242 , where @xmath243 is the diagonal matrix given by @xmath244 where @xmath245 is the distance of the imaginary number @xmath246 to the set of diagonal elements of @xmath247 .",
    "the matrix - valued function @xmath228 is finally extended from @xmath248 $ ] to @xmath225 $ ] by the relation @xmath249 .",
    "the continuity at @xmath250 is ensured because @xmath251 ( see  ) .",
    "figure  [ fig:2d_log ] shows the algorithm in action on one example . with a naive phase determination , _",
    "i.e.  _ @xmath252 , the matrix - valued function @xmath228 is not continuous when the eigenvalues of @xmath224 cross @xmath253 , and therefore the eigenvalues of @xmath228 cross @xmath254 ( left panel ) .",
    "this is because the complex logarithm is only continuous outside its branch cut , chosen here on the negative real axis .",
    "when that happens in our procedure , the integer @xmath255 jumps to accommodate this , and the eigenvalues of @xmath228 evolve smoothly ( right panel ) .    , with a naive determination ( left ) and with our algorithm ( right ) .",
    "this example was obtained by a variation of the potential presented in section [ sec : num ] with @xmath256.,title=\"fig:\",scaledwidth=45.0% ] , with a naive determination ( left ) and with our algorithm ( right ) .",
    "this example was obtained by a variation of the potential presented in section [ sec : num ] with @xmath256.,title=\"fig:\",scaledwidth=45.0% ]    if the eigenvalues of @xmath224 never collide for values of @xmath257 in the open interval @xmath258 , then @xmath228 is continuous in the limit of infinitesimal mesh spacing .",
    "this is a consequence of the fact that the minimizer in   is always uniquely determined , and the phase following procedure ensures that the eigenvalues are determined continuously when they cross the value @xmath253 ( see also the continuity result stated in  ( * ? ? ?",
    "* lemma  2.13 ) ) .",
    "the continuity of the frame is preserved even if a crossing happens , as long as the integer @xmath259 is the same for all the colliding eigenvalues . on the other hand , when two eigenvalues with different values of @xmath260 collide",
    ", @xmath228 is discontinuous . in the example of figure  [ fig:2d_log ] , this would correspond to a collision of the top and bottom eigenvalues . in this case",
    ", our algorithm fails .",
    "we however never observed such a situation in all the tests we have performed .",
    "we discuss this in more details in section [ sec : eig_collisions ] .",
    "the three - dimensional case is handled similarly to the two - dimensional case , in slices : for every  @xmath167 , we find a continuous logarithm of @xmath261 , which we call @xmath262 .",
    "as long as there are no crossings between eigenvalues with different values of @xmath260 , this @xmath228 is continuous with respect to both @xmath167 and @xmath263 , which solves the problem .",
    "the prototypical case of a problematic eigenvalue collision is exemplified by the following situation ( see  ( * ? ? ?",
    "* example  2.25 ) ) : let @xmath264 and , for @xmath86 , define @xmath265 the eigenvalues of this matrix are ( see figure  [ fig : badlog ] ) @xmath266 if the matrix - valued function @xmath228 is continuous at @xmath97 , the phases of its eigenvalues must respectively vary by amounts of @xmath267 and @xmath268 when evolving from @xmath269 to @xmath99 .",
    "therefore , @xmath270 must have eigenvalues @xmath271 and can not be equal to @xmath91 .",
    "this shows that no matrix logarithm can simultaneously be continuous and satisfy @xmath272 .",
    ", the principal logarithm of the eigenvalues of  . ]    in @xcite , the authors avoid this problem by relaxing problem  [ pbm : log ] to the following weaker problem : find a sequence of hermitian , continuous matrices @xmath273 for @xmath230^{d-1}$ ] , equal to @xmath274 on @xmath275 , and such that @xmath276 this is in fact sufficient for our purposes .",
    "coming back to the last step of the algorithm in the three - dimensional case , assume that , instead of finding @xmath228 satisfying and setting @xmath277 we find a family of functions @xmath278 with values in the space of hermitian matrices , which in addition satisfy  .",
    "then we can fix the frame in @xmath279 steps by defining @xmath280 the corrected frame @xmath129 is continuous and satisfies all the required compatibility conditions .",
    "in @xcite , the authors use the relaxed problem   in two steps .",
    "their proof relies crucially on the analyticity properties of the eigenvalues and eigenvectors , and is tied to the one - dimensional case @xmath281 , _ i.e.  _ @xmath282 .",
    "moreover , it does not provide a practical way of computing the hermitian matrices @xmath283 . a natural extension to their method to dimension",
    "@xmath284 is to slightly perturb @xmath63 to eliminate any problematic eigenvalue collision , and replace eigenvalue crossings with avoided crossings , which the authors allude to in ( * ? ? ?",
    "* remark 1.10 ) .",
    "for the two - dimensional and three - dimensional cases , where it is necessary to avoid crossings in one - dimensional and two - dimensional settings respectively , generic perturbations will turn the crossings into avoided crossings , because the space of unitary matrices with repeated eigenvalues is of codimension 3 .",
    "this argument can be made precise using the transversality theorem @xcite , but the construction is technical and we refrain from doing so here .",
    "this allows us to find a continuous logarithm @xmath285 of a perturbation @xmath286 of @xmath63 by the procedure above .",
    "then , @xmath287 is very close to @xmath288 , and therefore its eigenvalues never cross @xmath253 .",
    "there is therefore no obstruction in finding a logarithm @xmath289 of @xmath290 .",
    "finally , @xmath291 the problem with this approach is that it is not clear how to best implement in practice the perturbation argument , because small gaps in @xmath286 result in eigenvectors that are continuous but have very large variations , yielding large derivatives for @xmath292 .",
    "therefore , although we could in principle design a scheme to treat such eigenvalue collisions , it is likely to be unstable on coarse meshes , and would require some parameters to be fine - tuned .",
    "we do not discuss such extensions here since , as explained in section  [ sec : num ] , we have never encountered any problematic eigenvalue collisions in our numerical tests on two- and three - dimensional systems .",
    "we do not know whether there is a topological reason forbidding such crossings , or whether crossings only occur on subspaces of codimension  3 and are therefore generically absent in two- and three - dimensional situations , where the obstruction matrices depend on 1 and 2 parameters respectively .",
    "this section presents numerical tests of the method proposed here , as well as a comparison with the projection method .",
    "we first detail our methodology .",
    "we then test the algorithms on two - dimensional toy models , three - dimensional semiconductors with effective potentials , and dft computations .",
    "results on topological insulators are presented in an appendix .",
    "we present in this section numerical experiments illustrating our algorithm .",
    "we solve the periodic schrdinger equation   using a galerkin basis consisting of all plane waves @xmath293 for @xmath37 such that @xmath294 , for some fixed energy cut - off @xmath295 .",
    "note that the basis we consider does not depend on the value of @xmath48 , in contrast to most plane - wave codes , which use the @xmath2-dependent cut - off condition @xmath296 .",
    "this is done for convenience in our rudimentary implementation .",
    "this has a number of undesirable properties .",
    "for instance , the equality @xmath297 is only approximately valid , in the regime where @xmath2 and @xmath298 are not too large .",
    "in addition , @xmath44 is not unitary when restricted to the vector space spanned by the galerkin basis .",
    "these properties are however recovered in the limit when @xmath299 . in our tests , we take @xmath295 large enough to avoid these problems .      as a first test , we use an artificial potential with randomly chosen coefficients , with unit cell @xmath300 ^ 2 $ ] .",
    "more precisely , @xmath301 where the only nonzero coefficients @xmath302 were selected randomly .",
    "the results we present here correspond to the following set of coefficients : @xmath303 with this potential , the first five bands are isolated from the higher energy ones , so we choose @xmath304 .",
    "we note that this system is entirely unphysical , and was chosen to be a challenging test for our algorithm . on this system , it is hard to get good initialization for the projection method , because the centers and shapes of the wannier functions are a priori unknown .",
    "the result of our algorithm can be seen in figure  [ fig : ours ] , where we represent the first component @xmath180 of our bloch frame as a function of @xmath2 , using the same methodology as in figure  [ fig : ex_alg ] .",
    "we also plot the associated wannier function @xmath179 to check its spatial decay . on this very simple example",
    ", there is no ambiguity in finding the logarithm on the right edge , because the eigenvalues of the obstruction matrix never cross the value @xmath253 , as can be seen in figure  [ fig : phase_2d ] .",
    "we therefore obtain a continuous frame , which leads to localized wannier functions .",
    "however , there are slight discontinuities in the first derivative at the edges @xmath305 for @xmath306 .",
    "this translates into a slow spatial decay of the wannier function in the @xmath307 direction .",
    ", we plot the average real part of the first component @xmath180 of the bloch frame with @xmath177 as a function of @xmath2 ( left ) , and corresponding wannier function ( right).,title=\"fig:\",scaledwidth=49.0% ] , we plot the average real part of the first component @xmath180 of the bloch frame with @xmath177 as a function of @xmath2 ( left ) , and corresponding wannier function ( right).,title=\"fig:\",scaledwidth=49.0% ]    , we plot the average real part of the first component @xmath180 of the bloch frame with @xmath177 as a function of @xmath2 ( left ) , and corresponding wannier function ( right).,title=\"fig:\",scaledwidth=49.0% ] , we plot the average real part of the first component @xmath180 of the bloch frame with @xmath177 as a function of @xmath2 ( left ) , and corresponding wannier function ( right).,title=\"fig:\",scaledwidth=49.0% ]    to smooth the discontinuities of @xmath308 , we use the mv procedure .",
    "the output of this minimization is given in figure  [ fig : ours_mv ] .",
    "on this simple example , the main features of the frame do not change , but some extra regularization occurs .",
    "this removes the spatial tail of the wannier function in the @xmath309 direction .",
    "we checked that the wannier function we obtain presents an exponential decay , provided the cut - off energy @xmath295 and the number of iterations of the mv algorithm are sufficiently large .",
    "we next compare the results of our algorithm to the ones obtained from the projection method commonly used to initialize the mv algorithm @xcite .",
    "the initial guesses for the projection method are @xmath14 gaussian functions centered at random positions .",
    "the width of these gaussian functions is chosen to match approximately the size of the localized wannier functions we obtained with our method .",
    "figure  [ fig : proj ] represents the bloch frame obtained by one example of such a projection , before and after running the mv minimization .",
    ".,title=\"fig:\",scaledwidth=49.0% ] .,title=\"fig:\",scaledwidth=49.0% ]    .,title=\"fig:\",scaledwidth=49.0% ] .,title=\"fig:\",scaledwidth=49.0% ]",
    "although the frame is smooth in most regions , and obeys by construction the symmetry properties , we can see isolated points of discontinuity , which visually manifest themselves as rapid changes of color .",
    "moreover , the mv minimization procedure fails to further localize the initial guess , a situation the authors of @xcite refer to as `` false local minima '' .",
    "the behavior around the isolated points of singularity can be understood as follows .",
    "we denote by @xmath310 the periodic parts of the bloch transform of the trial wannier functions used as an initial guess .",
    "when @xmath311 , according to the projection method , the corresponding frame is given by @xmath312 where @xmath313 is any vector in the one - dimensional vector space @xmath1 , which can be chosen locally continuous , and @xmath314 is the phase of @xmath315 .",
    "this phase is well - defined and continuous as long as @xmath315 is non - zero .",
    "the condition @xmath316 is a set of two real equations , which generically admits point solutions in dimension  2 , and solutions on a one - dimensional manifold in dimension  3 .",
    "the frame @xmath58 is singular at these values .",
    "the analysis when @xmath317 is more involved but yields the same conclusions : the frame is singular when the overlap matrix @xmath318 is not invertible , which generically is a set of two equations . by formal analogy with similar phenomena in other application fields , we call such singular sets _ vortices_. vortices are points in dimension  2 , and lines in dimension  3 .",
    "a more quantitative information about the behavior of frames around vortices can be obtained by introducing the notion of eigenspace vorticity @xcite , which generalizes the pseudospin winding number appearing in the literature on graphene @xcite .    as can be seen in figure  [ fig : proj_mv ]",
    ", the mv minimization fails to resolve these vortices : on a finite mesh , these pathological singularities appear as local minima of the functional .",
    "this is because the mv algorithm was designed with a continuous input in mind .",
    "the continuity ensures that , when the mesh is fine enough , the matrix elements @xmath319 , defined in and used crucially in the algorithm , are close to @xmath320 .",
    "this allows to define their logarithm unambiguously . in the presence of vortices ,",
    "this quantity is not close to @xmath320 , even on fine meshes , and the algorithm is not well - defined .    in order to confirm that the undesirable behavior of the mv algorithm arises from the existence of initial vortices",
    ", we consider the case of a single band .",
    "the dominant contribution to the mv functional is given by @xcite @xmath321 & = \\int_{{{\\mathcal b}}}\\int_{y}|\\nabla_{{\\mathbf{k } } }                    u_{{\\mathbf{k}}}({\\mathbf{r}})|^{2 } d{\\mathbf{r}}\\ , d{\\mathbf{k}}.                    \\ ] ] consider a model vortex at @xmath322 ( without loss of generality ) , and let @xmath323 .",
    "we consider the model vortex @xmath324 in a neighborhood of @xmath91 .",
    "then @xmath325 has a @xmath326 singularity at @xmath91 .",
    "therefore , on a @xmath327 grid , we can expect that the mv functional diverges like @xmath328 . in dimension  3 , where vortices are lines",
    ", @xmath329 also presents a @xmath326 divergence , where @xmath330 is the distance from @xmath2 to the line of singularities .",
    "this also yields a logarithmic divergence of the functional .",
    "the reasoning is similar for @xmath331 .",
    "such a divergence is observed in our simulations : for the simple case presented here , the values of the mv functional at convergence of the algorithm on a @xmath332 , @xmath333 , @xmath334 and @xmath335 grid respectively , are 3.7 , 5.7 , 7.9 and 9.6 .",
    "this is consistent with a logarithmic divergence .",
    "however , since the divergence is relatively mild ( logarithmic only ) , when the mesh is sufficiently coarse , these vortices are found not to impact the algorithm , which converges to non - singular minima .",
    "for instance , the mv algorithm on the example considered here converges to a smooth minimum on a @xmath336 grid in @xmath2-space , but stalls without removing the vortices on @xmath337 grids and finer .",
    "this explains the observation in ( * ? ? ?",
    "* section  iv.d.2 ) , where the mv minimization is reported to sometimes fail for random initial guesses .",
    "the authors state that `` this problem [ false local minima ] is not associated with the presence of a large number of bands , but instead with the use of fine @xmath2-point meshes '' , consistent with our observation that the energy contribution of a vortex diverges logarithmically with the grid spacing .",
    "they also `` never observed the system to become trapped in a false local minimum when starting from reasonable trial projection functions '' .",
    "in the situation we consider here ( a random potential ) , `` reasonable trial projection functions '' are hard to devise in advance .",
    "we have found vortices to occur for a large class of initial inputs , although of course not for ones close to real maximally - localized wannier functions , where the overlap matrix @xmath318 has its eigenvalues bounded away from zero .",
    "by contrast , our algorithm always succeeded in constructing a good frame , even on more complicated systems where the eigenvalues of the obstruction matrix cross the value @xmath253 , as in figure  [ fig:2d_log ] . in order to investigate whether the type of problematic eigenvalue collisions of the obstruction matrix described in section [ sec : logpb ] was possible , we played with the fourier coefficients  @xmath338 , but were not able to see any .",
    "in fact , the only way we could make the eigenvalues of the obstruction matrix collide is by closing the gap @xmath339 , which violates the hypotheses of our problem ( we only consider isolated bands ) .",
    "we do not know if it is fundamentally impossible for eigenvalues of the obstruction matrix to cross at a finite gap ( for topological reasons , for instance ) , or if it is simply an exceptional situation which we failed to encounter in our tests .",
    "the previous two - dimensional example with a random potential was artificial and not representative of real systems . to test our algorithm on more realistic cases",
    ", we use the simple effective one - body potentials of @xcite in a zincblende structure , discretized on a plane - wave basis .",
    "these pseudopotentials were chosen to obtain representative band structures at minimal cost . in this framework",
    ", the potential @xmath340 reads @xmath341 where @xmath342 and @xmath343 is the lattice constant of the zincblende structure .",
    "the form factors @xmath344 and @xmath345 , as well as the parameters @xmath343 for various compounds , are tabulated in  @xcite .",
    "we first test our algorithm on silicon .",
    "we study the first four bands , which are isolated from the others .",
    "as in the 2d case , our algorithm was able to produce a continuous frame , as seen in figure  [ fig:3d_ours ] , where we plot again the average real part of the first component of the bloch frame , on the cut plane @xmath346 .",
    "0.49 , before ( left ) and after ( right ) the mv algorithm , on a @xmath347 grid.,title=\"fig : \" ]    0.49 , before ( left ) and after ( right ) the mv algorithm , on a @xmath347 grid.,title=\"fig : \" ]    figure [ fig : phase_si ] represents the @xmath348 different phases of the eigenvalues of the obstruction matrix @xmath217 in the three stages of the algorithm : fixing the corners , the edges and the face .    before fixing the corners , there is a conical intersection in the eigenvalues at @xmath349 .",
    "this is a non - generic case , presumably due to eigenvalue degeneracy at @xmath3 in the model , itself related to a particular symmetry of the potential .",
    "however , this intersection is harmless , as it connects eigenvalues with the same phase determination . after fixing the corners",
    ", the conical intersection moves to the corners , and the phase of all the eigenvalues has a maximum of about @xmath350 , well below @xmath351 .",
    "fixing the edges is not necessary in this case .",
    "0.6     0.4     0.4     to compare our method to the projection method , as in the 2d case , we use as initial wannier functions gaussians centered on random points .",
    "the projection method yields a continuous frame as long as the overlap matrix @xmath352 is positive - definite for all @xmath23 .",
    "as can be seen in figure [ fig : mineig ] , this matrix becomes indefinite on vortex lines .",
    "this yields discontinuous frames , as illustrated in figure [ fig:3d_before ] . in our tests with random positions of the gaussians , this occurred about half the time . as in the 2d case ,",
    "the mv algorithm is unable to remove these vortices when the sampling of the brillouin zone is fine enough . in this example",
    ", the mv algorithm was able to remove the vortices on grids of size up to @xmath353 , but not on finer grids .",
    "as expected , when the wannier centers are selected appropriately , the mv algorithm converges to localized wannier functions .",
    "0.49 , before ( left ) and after ( right ) the mv algorithm , on a @xmath347 grid .",
    "the mv algorithm is able to smooth out the general features of the frame , but not to remove the vortices.,title=\"fig : \" ]    0.49 , before ( left ) and after ( right ) the mv algorithm , on a @xmath347 grid .",
    "the mv algorithm is able to smooth out the general features of the frame , but not to remove the vortices.,title=\"fig : \" ]    silicon represents an easy test case because it possesses a relatively large direct gap between the valence and conduction bands .",
    "this makes the projector on the valence bands a smooth function of @xmath2 , which in turn produces well - localized wannier functions .",
    "we also tried our algorithm on more complicated semiconductors such as indium arsenide , still using the pseudopotentials of @xcite .",
    "indium arsenide has a very small direct gap , resulting in sharp variations in the brillouin zone near the band edges which require a fine sampling of the brillouin zone to resolve accurately the band structure .",
    "although the obstruction phases of figure [ fig : phase_si ] are more rugged in this case , their amplitude at the last step is still less than about @xmath350 , well below @xmath351 , and our algorithm has no problem distinguishing the bands to fix the phases .      we have implemented our algorithm in a way that is compatible with the standard code wannier90 @xcite . to that end",
    ", we note that our method , while presented here with frames , can also be implemented in the wannier90 paradigm where one computes a fixed set of electronic orbitals @xmath354 for each @xmath2-point , and then finds a set @xmath355 of unitaries from which the final frame is constructed as @xmath356 .",
    "the advantage of this approach for the mv algorithm is that only the low - dimensional unknowns @xmath355 have to be optimized , and that the only inputs from electronic structure codes are the overlap matrices @xmath357 where @xmath358 runs over nearest neighbors of @xmath91 on the @xmath2-space mesh .",
    "this separates the computation of the @xmath20 from the computation of wannier functions , and facilitates the creation of independent libraries .",
    "similarly to the traditional mv minimization , in our algorithm we only need as input the overlap matrices @xmath359 ( ` .mmn ` file ) to compute the final frame @xmath356 and output the unitary matrix @xmath355 at each @xmath2-point ( ` .amn ` file ) .",
    "because this format does not explicitly account for the time - reversal symmetry , it is more convenient to use a modified version of our algorithm ( see appendix ) , which does not use the time - reversal symmetry .",
    "the resulting code is available at https://github.com/antoine-levitt/wannier and can readily be inserted in any workflow using wannier90 .",
    "we have tested our algorithm on bulk silicon computed by the code quantum espresso @xcite using the pbe exchange - correlation functional .",
    "our conclusions are the same as those of the previous section using an effective potential approach .",
    "the phases of the obstruction matrix are similar to those of figure [ fig : phase_si ] , and our algorithm produces a continuous frame .",
    "the corresponding wannier functions are localized , as can be seen on figure [ fig : wannier_visu ] .",
    "these wannier functions are not maximally - localized , but form a good initial guess for the mv algorithm .",
    "by contrast , initializing the algorithm with randomly - centered s - type orbitals ( as is the default in wannier90 in the absence of a specific prescription ) might yield an algorithm that can converge to a `` false local minimum '' , especially on fine meshes , as can be seen in figure [ fig : wannier90_conv ] .",
    "however , when the initial guess is good enough , the convergence is satisfactory , and even faster than using our algorithm to produce an initial guess .",
    "0.49 -point mesh .",
    "we use as initial guess ( 1 ) the one produced by our algorithm ; ( 2 ) the projection method with bond - centered s - type orbitals ; ( 3 ) the projection method with s - type orbitals with random centers ( five different realizations ) . on the left panel",
    ", the black and light blue curves eventually converged to the global minimum after about 500 iterations , but the red one converged to a local minimum to machine precision .",
    "the red and black curves on the right panel seem to have converged to a local minimum , but the gradient is non - zero and the energy keeps decreasing , although very slowly ; after 100,000 iterations , the energy was still above 136 bohr@xmath360.,title=\"fig : \" ]    0.49 -point mesh .",
    "we use as initial guess ( 1 ) the one produced by our algorithm ; ( 2 ) the projection method with bond - centered s - type orbitals ; ( 3 ) the projection method with s - type orbitals with random centers ( five different realizations ) . on the left panel",
    ", the black and light blue curves eventually converged to the global minimum after about 500 iterations , but the red one converged to a local minimum to machine precision .",
    "the red and black curves on the right panel seem to have converged to a local minimum , but the gradient is non - zero and the energy keeps decreasing , although very slowly ; after 100,000 iterations , the energy was still above 136 bohr@xmath360.,title=\"fig : \" ]    the computational time of our algorithm is dominated by the cost of a few operations on @xmath61 matrices at each @xmath2-point , and is therefore comparable to that of one iteration of the mv algorithm .",
    "by contrast , the projection method requires computations on the plane - wave grid , and is therefore much more costly .",
    "therefore , the total time for the computation of mlwfs is lower with our algorithm , even when it requires more iterations to converge than the projection method with good initial guesses .",
    "we proposed an algorithm to obtain well - localized wannier functions without any initial guess or free parameters , and presented numerical results showing its correctness , as well as its superiority compared to the projection method on very fine meshes and when good initial guesses are not available .",
    "the flipside to this is that our method , which does not utilize the physics of the system , might not yield optimal wannier functions , but only local minima .",
    "we anticipate our method to be useful for systems where no physical intuition is available , and where well - localized wannier functions , even if not optimal or physically sensible , can be used for example for wannier interpolation @xcite .",
    "our algorithm can fail when eigenvalues of the obstruction matrix corresponding to different number of turns @xmath255 collide .",
    "we have never found this to be the case in practice .",
    "however , it is unclear whether such a phenomenon is impossible because of topological reasons or if it is simply rare and we have never found it in our tests . a better understanding of this issue is a worthwhile direction of research . our algorithm could be adapted to tackle such collisions , but would be significantly more complicated , introduce free parameters , and be less robust for coarse @xmath2-point meshes , which is why we refrain from doing so in this work .    as we demonstrated , a singular input to the mv algorithm may or may not yield a physically relevant answer , depending on the size of the mesh : singularities may not be seen on a coarse mesh , while fine meshes emphasize the divergent contribution of the vortices to the functional . in this case , the mv algorithm stalls and is unable to converge to a `` true '' local minimum . the behavior of the mv algorithm in this case would be interesting to study from a numerical analysis point of view .",
    "another important question is whether any continuous frame will yield exponentially - localized wannier functions when used as initial guess to the mv algorithm .    on the numerical side",
    ", our algorithm , publicly available at https://github.com/antoine-levitt/wannier , can readily be interfaced in standard workflows using the wannier90 @xcite code .",
    "our construction preserves the time - reversal symmetry , but not any other symmetries the crystal might possess , unlike the construction in @xcite .",
    "the extension of our method to additional symmetries is also an interesting direction for future work .",
    "we wish to thank the anonymous referees for useful suggestions and comments .",
    "our algorithm was introduced in the framework of time - reversal symmetric systems , and more precisely of a symmetry of _ bosonic _ type , which is one in which the anti - unitary time - reversal operator @xmath35 squares to @xmath320 .",
    "this is the case where we know theoretically that there exist localized wannier functions .",
    "although a detailed study is outside the scope of this paper , it is interesting to explore what happens when this assumption fails , and in particular investigate the case of topological insulators .",
    "our algorithm can be adapted very simply to systems without time - reversal symmetry ( or with a _",
    "fermionic _ one , that squares to @xmath253 ) , and we explain it here for one- and two - dimensional systems ( the three - dimensional case is a simple extension ) .    in 1d , we first start with a frame at @xmath3 , which we do not impose to be real . then , we propagate it using to the segments @xmath94 $ ] and @xmath233 $ ] . at this point ,",
    "generically @xmath361 : we compute the unitary obstruction matrix @xmath362 , and set @xmath363 , which is now a continuous frame .    in 2d",
    ", we apply the same construction as in the 1d case to build a continuous frame on the segment from @xmath364 to @xmath365 that satisfies @xmath366 .",
    "then , we propagate it horizontally and obtain a frame @xmath367 on @xmath225^{2}$ ] .",
    "generically , @xmath368 , which we now fix in two steps .",
    "we define the top edge obstruction matrix @xmath369 , set @xmath370 , and drop the primes for simplicity .",
    "we now define the obstruction matrix @xmath371 , which , like in the time - reversal symmetric case , satisfies @xmath372 .",
    "provided we can find a continuous logarithm @xmath373 of @xmath374 , we set @xmath375 and obtain a continuous frame .",
    "note that , as this algorithm always produces a continuous frame if the logarithm problem is solved , it follows that the logarithm problem can not be solved for materials with non - zero chern numbers , where we know that there can not exist a continuous frame @xcite .",
    "we will now show how exactly the existence of a logarithm fails on a chern insulator .",
    "we test our algorithm on the prototype of chern insulators , the two band haldane model .",
    "we use the same notation as in the original paper @xcite : the parameters @xmath376 and @xmath377 are the nearest and next - nearest neighbors hopping terms , @xmath378 is the phase , which breaks the time - reversal symmetry , and @xmath379 is the on - site energy , which breaks the inversion symmetry .",
    "we used as parameters @xmath380 and @xmath381 , and consider the first band ( @xmath382 ) . note that since the haldane model only has one band , it is not a good test case to see the collision of eigenvalues we are concerned about in section [ sec : logpb ] , but",
    "rather illustrates how our algorithm fails on a topological insulator with a non - zero chern number , as any algorithm must , since continuous frames can not exist in this case @xcite .",
    "the haldane model is a time - reversal - symmetric insulator for @xmath383 .",
    "when @xmath378 is increased and the time - reversal symmetry is broken , the band gap decreases until it closes at@xmath384 .",
    "after that point , it is a chern insulator ( with chern number @xmath320 ) .     as a function of @xmath167 for the haldane model with @xmath385 , for @xmath383 ( left ) ,",
    "@xmath386 ( middle ) and @xmath387 ( right ) . as @xmath378 increases ,",
    "the time - reversal symmetry breaks down , and at @xmath388 , the gap closes and @xmath224 jumps abruptly from @xmath253 to @xmath320 .",
    "when @xmath388 is increased into the chern insulator regime , the map @xmath224 has degree 1 , and no choice of branch cut can make its phase continuous and periodic.,title=\"fig : \" ]   as a function of @xmath167 for the haldane model with @xmath385 , for @xmath383 ( left ) , @xmath386 ( middle ) and @xmath387 ( right ) .",
    "as @xmath378 increases , the time - reversal symmetry breaks down , and at @xmath388 , the gap closes and @xmath224 jumps abruptly from @xmath253 to @xmath320 .",
    "when @xmath388 is increased into the chern insulator regime , the map @xmath224 has degree 1 , and no choice of branch cut can make its phase continuous and periodic.,title=\"fig : \" ]   as a function of @xmath167 for the haldane model with @xmath385 , for @xmath383 ( left ) , @xmath386 ( middle ) and @xmath387 ( right ) . as @xmath378 increases ,",
    "the time - reversal symmetry breaks down , and at @xmath388 , the gap closes and @xmath224 jumps abruptly from @xmath253 to @xmath320 .",
    "when @xmath388 is increased into the chern insulator regime , the map @xmath224 has degree 1 , and no choice of branch cut can make its phase continuous and periodic.,title=\"fig : \" ]    as can be seen in figure [ fig : haldane ] , when @xmath378 is small , the phase of the obstruction matrix ( here , a single number ) evolves smoothly and symmetrically with respect to the origin : @xmath112 evolves in the upper half - circle @xmath389 , and goes from @xmath320 to @xmath253 and back again , taking the same path in reverse .",
    "when @xmath378 increases , the transition from @xmath253 back to @xmath320 gets sharper , until it is discontinuous at the critical threshold @xmath390 .",
    "when @xmath378 increases again , this discontinuity is resolved , but this time @xmath112 goes through the lower half - circle on its way back .",
    "the net result is that a logarithm of @xmath391 will pick up a phase factor of @xmath267 when going from @xmath392 to @xmath393 , and can not therefore be continuous and periodic .",
    "we now turn to the case of @xmath394 topological insulators@xcite .",
    "@xmath394 topological insulators are characterized by a _",
    "fermionic _ time - reversal symmetry , squaring to @xmath253 instead of @xmath320 as the one considered in this paper , and possess a @xmath394 topological invariant .",
    "systems with an odd invariant have a topological obstruction to the construction of frames respecting the time - reversal symmetry , but no obstruction to the construction of non - symmetric frames @xcite .",
    "we test our algorithm on the kane - mele model @xcite . with the same notation as in @xcite , we choose @xmath395 . for this choice of parameters ,",
    "the system is in a regular insulator phase for @xmath396 , and in a quantum spin hall phase for @xmath397 .     as a function of @xmath167 for the kane - mele model , for @xmath398 , with @xmath399 ( left ) and @xmath400 ( right ) . as @xmath401 decreases , the system transitions from an even to an odd @xmath394 invariant , and eigenvalues with different numbers of turns collide.,title=\"fig : \" ]   as a function of @xmath167 for the kane - mele model , for @xmath398 , with @xmath399 ( left ) and @xmath400 ( right ) .",
    "as @xmath401 decreases , the system transitions from an even to an odd @xmath394 invariant , and eigenvalues with different numbers of turns collide.,title=\"fig : \" ]    we show in figure [ fig : kane - mele ] that this transition introduces a collision of eigenvalues with different numbers of turns .",
    "the correspondence between the eigenvalue collisions and the @xmath394 invariant was recently proved in ( * ? ? ?",
    "* proposition 5.7 ) .",
    "let us stress that this collision occurs because of the non - trivial topological states of systems with _",
    "fermionic _ time - reversal symmetry . for systems with a _",
    "bosonic _ form of time - reversal ( the ones we consider in this paper ) , we found no such crossings .",
    "p.  giannozzi , s.  baroni , n.  bonini , m.  calandra , r.  car , c.  cavazzoni , d.  ceresoli , g.  chiarotti , m.  cococcioni , i.  dabo , et  al .",
    "uantum espresso : a modular and open - source software project for quantum simulations of materials .",
    ", 21(39):395502 , 2009 .",
    "a.  mostofi , j.  yates , g.  pizzi , y .- s .",
    "lee , i.  souza , d.  vanderbilt , and n.  marzari .",
    "an updated version of wannier90 : a tool for obtaining maximally - localised wannier functions .",
    ", 185(8):23092310 , 2014 ."
  ],
  "abstract_text": [
    "<S> we propose an algorithm to determine maximally localized wannier functions ( mlwfs ) . </S>",
    "<S> this algorithm , based on recent theoretical developments , does not require any physical input such as initial guesses for the wannier functions , unlike popular schemes based on the projection method . </S>",
    "<S> we discuss how the projection method can fail on fine grids when the initial guesses are too far from mlwfs . </S>",
    "<S> we demonstrate that our algorithm is able to find localized wannier functions through tests on two - dimensional systems , simplified models of semiconductors , and realistic dft systems by interfacing with the wannier90 code . </S>",
    "<S> we also test our algorithm on the haldane and kane - mele models to examine how it fails in the presence of topological obstructions . </S>"
  ]
}