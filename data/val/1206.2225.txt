{
  "article_text": [
    "electron structure calculations based on solving the kohn - sham density functional theory ( ksdft )  @xcite play an important role in the analysis of electronic , structural and optical properties of molecules , solids and other nano structures .",
    "the kohn - sham equations define a nonlinear eigenvalue problem @xmath0\\psi_{i } = \\varepsilon_{i } \\psi_{i},\\\\    & \\rho({{\\mathbf{r } } } ) = \\sum_{i } f_{i } { \\lvert\\psi_{i}({{\\mathbf{r}}})\\rvert}^2 , \\quad \\int    \\psi^{*}_{i}({{\\mathbf{r } } } ) \\psi_{j}({{\\mathbf{r } } } ) { \\,\\mathrm{d}}{{\\mathbf{r}}}= \\delta_{ij } ,    \\end{split }    \\label{eqn : ks}\\ ] ] where @xmath1 are the kohn - sham eigenvalues ( or quasi - particle energies ) and @xmath2 are called the kohn - sham wavefunctions or orbitals .",
    "these eigenfunctions define the electron density @xmath3 , which in turn defines the kohn - sham hamiltonian @xmath4 = -\\frac12 \\delta + { \\mathcal{v}}[\\rho ] + { v_{\\mathrm{ion } } } , \\label{eqn : ksham}\\ ] ] where @xmath5 is the laplacian operator , @xmath6 is a nonlinear function of @xmath7 , and @xmath8 is a potential function that is independent of @xmath7 .",
    "the parameters @xmath9 that appear in the definition of @xmath7 , which are often referred to as the occupation number , are defined by @xmath10 where @xmath11 is proportional to the inverse of the temperature @xmath12 and @xmath13 is called the chemical potential chosen to ensure that @xmath14 s satisfy @xmath15 for a system that contains @xmath16 electrons .",
    "the right hand side of ( [ eqn : fermidirac ] ) is known as the fermi - dirac function evaluated at @xmath17 .",
    "when @xmath11 is sufficiently large , the fermi - dirac function behaves like a step function that drops from 1 to 0 at @xmath13 ( which lies between @xmath18 and @xmath19 ) .",
    "spin degeneracy is omitted here for simplicity .    in this paper",
    ", we assume the kohn - sham system ( [ eqn : ks ] ) is defined within the domain @xmath20 ^ 3 $ ] with periodic boundary conditions , and the number of electrons @xmath16 is proportional to the volume of the domain .    because the eigenvalue problem ( [ eqn : ks ] ) is nonlinear , it is often solved iteratively by a class of algorithms called _ self - consistent field iterations _ ( scf ) .",
    "we will show in the following that the scf iteration can be viewed as a fixed point iteration applied to a nonlinear system of equations defined in terms of the potential @xmath21 that appears in   or the charge density @xmath7 .",
    "the function evaluation in each step of the scf iteration is relatively expensive .",
    "hence , it is desirable to reduce the total number of scf iteration by accelerating its convergence . furthermore",
    ", we would like the convergence rate to be independent of the size of the system . in the past few decades",
    ", a number of acceleration schemes have been proposed  @xcite . however ,",
    "none of the existing methods provide a satisfactory solution to the convergence issues to be examined in this paper , especially the issue of size dependency .",
    "the purpose of the paper is twofold .",
    "first , we summarize a number of ways to accelerate the scf iteration .",
    "many of the schemes we discuss already exist in both the physics and the applied mathematics literature  @xcite .",
    "we analyze the convergence properties of these acceleration schemes . in our analysis",
    ", we assume a good starting guess to the charge density or the potential is available .",
    "such a starting guess is generally not difficult to obtain in real applications . as a result",
    ", the convergence of the scf iteration can be analyzed through the properties of the jacobian operator associated with the nonlinear map defined in terms of the potential or the density .",
    "acceleration schemes can be developed by constructing approximations to the jacobian or its inverse .",
    "these acceleration schemes can also be viewed as preconditioning techniques for solving a system of nonlinear equations .",
    "it turns out that the scf iteration exhibits quite different convergence behavior for insulating and metallic systems  @xcite .",
    "these two types of systems are distinguished by the gap between @xmath18 and @xmath19 as the number of electrons @xmath16 , or equivalently the system size increases to infinity . for insulating systems , @xmath22 where @xmath23 , whereas for metallic systems , @xmath24 .",
    "different accelerating ( or preconditioning ) techniques are required for insulating and metallic systems .",
    "the second purpose of this paper is to propose a new framework for constructing a preconditioner for accelerating the scf iteration .",
    "the preconditioner constructed under this framework , which we call the elliptic preconditioner , provides a unified treatment of insulating and metallic systems .",
    "it is effective for complex materials that contain both an insulating and a metallic component .",
    "this type of system is considered to be difficult  @xcite for a standard kohn - sham solver , especially when the @xmath11 parameter in   is relatively large ( or the temperature is low ) .",
    "the paper is organized as follows . in section",
    "[ sec : fixedpt ] , we introduce the fixed point iteration for solving the kohn - sham problem , and the simple mixing method as the simplest acceleration method .",
    "more advanced preconditioning techniques are discussed in section  [ sec : advance ] . in section  [ sec : convergence ] , we discuss the convergence behavior of the acceleration methods for increasing system sizes . based on these discussions , a new preconditioner called the elliptic preconditioner is presented in section  [ sec : elliptic ] .",
    "the performance of the elliptic preconditioner is compared to existing techniques for one dimensional model problems and a realistic three dimensional problem in section  [ sec : numerical ] .",
    "we conclude and discuss future work in section  [ sec : conclusion ] .    in this paper ,",
    "the kohn - sham orbitals @xmath25 are assumed to be in @xmath26 . in practical calculations",
    ", they are discretized in a finite dimensional space such as the space spanned by a set of planewaves . as a result",
    ", each operator corresponds to a finite dimensional matrix . our discussion in this paper",
    "is not restricted to any specific type of discretization of the kohn - sham orbitals . to simplify our discussion",
    ", we will not distinguish operators defined on @xmath26 from the corresponding matrices obtained from discretization unless otherwise noted .",
    "this applies to both differential and integral operators .",
    "neither will we distinguish integral operators from their kernels .",
    "for example , we may simply denote @xmath27({{\\mathbf{r}}})\\equiv \\int a({{\\mathbf{r}}},{{\\mathbf{r } } } ' ) g({{\\mathbf{r}}}'){\\,\\mathrm{d}}{{\\mathbf{r}}}'$ ] by @xmath28 and represent the operator @xmath29 by @xmath30 .",
    "it follows from the spectral theory that the charge density @xmath7 defined in ( [ eqn : ks ] ) can be written as @xmath31-\\mu i)}\\right]^{-1}({{\\mathbf{r}}},{{\\mathbf{r } } } ) .",
    "\\label{eqn : rhofix}\\ ] ] here @xmath32({{\\mathbf{r}}},{{\\mathbf{r}}})$ ] denotes the diagonal elements of a matrix , and @xmath33 is an identity operator .",
    "that is , @xmath3 is the diagonal part of the fermi - dirac function evaluated at the kohn - sham hamiltonian .",
    "the right - hand side of ( [ eqn : rhofix ] ) defines a fixed point map from @xmath7 to itself .",
    "a similar fixed point map is also defined implicitly in terms of the potential @xmath34({{\\mathbf{r}}})$ ] , where @xmath35({{\\mathbf{r } } } ) = \\int       \\frac{\\rho({{\\mathbf{r}}}')}{|{{\\mathbf{r}}}-{{\\mathbf{r}}}'|}{\\,\\mathrm{d}}{{\\mathbf{r } } } '   + v_{{\\mathrm{xc}}}[\\rho]({{\\mathbf{r } } } ) ,    \\label{eqn : vform}\\ ] ] where the first term corresponds to the electron - electron repulsion , and @xmath36 $ ] is a nonlinear functional of @xmath7 and is known as the _ exchange - correlation _ potential that accounts for many - body effects of the electrons .",
    "the choice of @xmath37 is not unique .",
    "a number of expressions are available in the physics literature  @xcite . however , for the purpose of this paper , we do not need to be concerned with the explicit form of @xmath37 .",
    "it should be noted that @xmath37 is often much smaller than the electron - electron repulsion term in magnitude .",
    "if the dirac exchange @xcite is used , @xmath37 often contains a term proportional to @xmath38 .",
    "it follows from   and   that @xmath7 is implicitly a function of the potential @xmath39 , which we will denote by @xmath40 . the analysis we present below and the acceleration strategies we propose are applicable to both the density fixed point map ( [ eqn : rhofix ] ) and the potential fixed point map @xmath41 .",
    "\\label{eqn : vfix}\\ ] ] without loss of generality , we will focus on the potential fixed point map ( [ eqn : vfix ] ) in the rest of the paper .",
    "we remark that evaluating @xmath42 $ ] in   requires solving a poisson equation , but the computation of @xmath43 requires either diagonalizing the hamiltonian @xmath44 $ ] or approximating the fermi - dirac function of @xmath44 $ ] directly  @xcite .",
    "therefore , computing @xmath43 is much more costly than computing @xmath42 $ ] .",
    "the simplest method for seeking the solution of   is the fixed point iteration . in such an iteration",
    ", we start from some input potential @xmath45 , and iterate the following equation @xmath46 , \\label{eqn : fixiter}\\ ] ] until ( hopefully ) the difference between @xmath47 and @xmath48 is sufficiently small .",
    "when @xmath48 is sufficiently close to the fixed point solution @xmath49 , we may analyze the convergence of the fixed point iteration   by linearizing the function @xmath50 $ ] defined in ( [ eqn : vfix ] ) at @xmath49 .",
    "if we define @xmath51 , subtracting @xmath49 from both sides of ( [ eqn : fixiter ] ) and approximating @xmath52 $ ] by its first - order taylor expansion at @xmath49 yields @xmath53 where @xmath54 is the jacobian of @xmath55 $ ] with respect to @xmath39 evaluated at @xmath49 .",
    "it follows from the chain rule that @xmath56 taking the functional derivative of @xmath55 $ ] given in   with respect to @xmath3 yields @xmath57 where the terms in eq .",
    "represent kernels of integral operators evaluated at @xmath58 and @xmath59 .",
    "the first term on the right hand side of ( [ eqn : dvdr ] ) is the coulomb kernel .",
    "it will be denoted by @xmath60 below .",
    "the second term is the functional derivative of the exchange - correction potential with respect to @xmath7 .",
    "it is often denoted by @xmath61 and is a hermitian matrix .    in the physics literature , the functional derivative of @xmath62 with respect to @xmath39",
    "is often referred to as the independent particle polarizability matrix , and denoted by @xmath63 . at zero temperature",
    ", @xmath63 is given by the adler - wiser formula  @xcite @xmath64 where @xmath65 , @xmath66 , are the eigenpairs defined in ( [ eqn : ks ] ) .",
    "note that @xmath67 is a hermitian matrix , and is negative semidefinite since @xmath68 .",
    ".   can be iterated recursively to yield @xmath69 therefore , a necessary condition that guarantees the convergence of the fixed point iteration is @xmath70 where @xmath71 is the spectral radius of the operator ( or matrix ) @xmath29 .",
    "unfortunately this condition is generally not satisfied as we will show later .",
    "however , a simple modification of the fixed point iteration can be made to overcome potential convergence failure as long as @xmath72 is bounded .",
    "the modification takes the form @xmath73\\right ) ,    \\label{eqn : simplemixingupdate}\\ ] ] where @xmath74 is a scalar parameter . the updating formula given above",
    "is often referred to as simple mixing .",
    "when @xmath75 is sufficiently close to @xmath49 , the error propagation of simple mixing scheme is @xmath76 notice that @xmath77 is simply the jacobian of the residual function @xmath78 $ ] with respect to @xmath39 .",
    "we will denote this jacobian by @xmath79 .",
    "its value at @xmath49 will be denoted by @xmath80 . in the physics literature , this jacobian is often referred to as a _ dielectric _ operator  @xcite , and denoted by @xmath81 . furthermore ,",
    "when @xmath82 is positive definite ,    @xmath81 only has real eigenvalues because it can be symmetrized through a similarity transformation @xmath83 where the symmetrized dielectric operator @xmath84 is hermitian and has real eigenvalues .",
    "we remark that the assumption that @xmath82 is positive definite may not always hold , especially when the material contains low electron density regions in which the exchange - correlation kernel @xmath85 contains large negative entries .",
    "however , because in general the product of @xmath85 and @xmath67 is much smaller in magnitude than @xmath86 , it is reasonable to expect that the eigenvalues of @xmath81 are close to those of @xmath87 , which are real .",
    "this type of approximation is also used in section  [ sec : elliptic ] where we discuss how to construct an effective preconditioner for accelerating the fixed point iteration .",
    "it follows from ( [ eqn : errorsimplemixing ] ) that simple mixing will lead to convergence if @xmath88 if @xmath89 is an eigenvalue of @xmath80 , then the condition given in   implies that @xmath90 consequently , @xmath89 must satisfy @xmath91 note that ( [ eqn : alfabond1 ] ) is only meaningful when @xmath92 holds .",
    "therefore , @xmath93 is often referred to as the _ stability condition _ of a material  @xcite . furthermore ,",
    "when @xmath89 is bounded , it is always possible to find a parameter @xmath74 to ensure the convergence of the modified fixed point iteration even though the convergence may be slow .",
    "we should comment that the stability condition @xmath92 holds in most cases because @xmath94 is typically much smaller in magnitude than @xmath95 .",
    "note that @xmath96 is positive definite , and @xmath67 is negative semidefinite .",
    "when the stability condition fails , phase transition may occur , such as the transition from uniform electron gas to wigner crystals in the presence of low electron density  @xcite .",
    "such a case is beyond the scope of the current study .",
    "nonetheless , @xmath97 can become very large in practice even when the stability condition holds , especially for metallic systems of large sizes , as we will show in section  [ sec : convergence ] .",
    "a large @xmath97 requires @xmath74 to be set to a small value to ensure convergence . even though convergence can be achieved",
    ", it may be extremely slow .",
    "the simple mixing scheme selects @xmath74 as a scalar in ( [ eqn : simplemixingupdate ] ) .",
    "if we replace the scalar @xmath74 by the inverse of the jacobian matrix of the function @xmath78 $ ] evaluated at @xmath48 , we obtain a newton s update of @xmath39 .",
    "when @xmath48 is in the region where the linear approximation given by ( [ eqn : fixedpointerror ] ) is sufficiently accurate , newton s method converges quadratically to the solution of ( [ eqn : vfix ] ) .",
    "the difficulty with applying newton s method directly is that the jacobian matrix @xmath98}{\\partial v}|_{v = v_k}$ ] or its inverse can not be easily evaluated .",
    "however , we may apply a jacobian - free krylov newton technique  @xcite to obtain newton s update    @xmath99,\\ ] ] by solving the linear system @xmath100 iteratively using , for example , the gmres algorithm  @xcite .",
    "the matrix vector multiplication of the form @xmath101 , which is required in each gmres iteration , can be approximated by finite difference @xmath102-{\\mathcal{v}}[f(v_k)]}{\\epsilon},\\ ] ] for an appropriately chosen scalar @xmath103 .",
    "the finite difference calculation requires one additional function evaluation of @xmath104 $ ] per gmres step .",
    "therefore , even though newton s method may exhibit quadratic convergence , each newton iteration may be expensive if the number of gmres steps required to solve the correction equation ( [ eq : corrv ] ) is large .",
    "the convergence rate of the gmres method for solving the linear system   is known to satisfy  @xcite @xmath105 where @xmath106 is the condition number of @xmath107 , and @xmath108 is the approximation of @xmath109 at the @xmath110th step of the gmres iteration . as we will show in section  [ sec : convergence ] , the condition number @xmath111 can grow rapidly with respect to the size of the system , especially for metallic systems .",
    "therefore the number of iterations required by an iterative solver also grows with respect to the size of the system unless preconditioning strategies are employed .",
    "an alternative to newton s method for solving ( [ eqn : vfix ] ) is a quasi - newton method that replaces @xmath112 with an approximate jacobian inverse @xmath113 that is easy to compute and apply .",
    "in such a method , the updating strategy becomes @xmath114 \\right ) .",
    "\\label{eqn : quasinewtonupdate}\\ ] ] the simple mixing scheme discussed in the previous section can be viewed as a quasi - newton method in which @xmath113 is set to @xmath115 ( or equivalently as a nonlinear version of the richardson s iteration ) .",
    "more sophisticated quasi - newton updating schemes can be devised by using broyden s techniques  @xcite to construct better approximations to @xmath116 or @xmath112 . in broyden s second method , @xmath113",
    "is obtained by performing a sequence of low - rank modifications to some initial approximation @xmath117 of the jacobian inverse using a recursive formula  @xcite derived from the following constrained optimization problem @xmath118 where @xmath119 is the approximation to the jacobian constructed in the @xmath120th broyden iteration .",
    "the matrices @xmath121 and @xmath122 above are defined as @xmath123 where @xmath124 and @xmath125 are defined by @xmath126 and @xmath127 respectively .",
    "it is easy to show that the solution to ( [ bmin2 ] ) is @xmath128 where @xmath129 denotes the pseudo - inverse of @xmath122 , i.e. , @xmath130 .",
    "we remark that in practice @xmath131 is not constructed explicitly since we only need to apply @xmath131 to a residual vector @xmath132 .",
    "this operation can be carried out by solving a linear least squares problem with appropriate regularization ( e.g. , through a truncated singular value decomposition ) .    a variant of broyden s method is anderson s method  @xcite in which @xmath119 is fixed to an initial approximation @xmath117 at each iteration .",
    "it follows from eq .   that anderson s method updates the potential as @xmath133 in particular ,",
    "if @xmath117 is set to @xmath115 , we obtain anderson s method @xmath134 commonly used in ksdft solvers .      an alternative way to derive broyden",
    "s method is through a technique called direct inversion of iterative subspace ( diis ) .",
    "the technique is originally developed by pulay for accelerating a hartree - fock calculation  @xcite .",
    "hence it is often referred to as the _ pulay mixing _ in the condensed matter physics community .",
    "the motivation of pulay s method is to minimize the difference between @xmath39 and @xmath55 $ ] within a subspace @xmath135 that contains previous approximations to @xmath39 . in pulay s original work  @xcite , the optimal approximation to @xmath39 from @xmath135 is expressed as @xmath136 , where @xmath75 ( @xmath137 ) are previous approximations to @xmath39 , and the coefficients @xmath138 chosen to satisfy the constraint @xmath139 .",
    "when @xmath75 s are all sufficiently close to the solution of ( [ eqn : vfix ] ) , @xmath140 \\approx \\alpha_j { \\mathcal{v}}[f(v_j)]$ ] holds .",
    "hence we may obtain @xmath138 ( and consequently @xmath141 ) by solving the following quadratic program @xmath142 where @xmath143 $ ] .",
    "note that ( [ eqn : pulaymin ] ) can be reformulated as an unconstrained minimization problem if @xmath141 is required to take the form @xmath144 , where @xmath145 can be any unconstrained real number .",
    "again , if we assume @xmath55 $ ] is approximately linear at @xmath75 and let @xmath146 , minimizing @xmath147 \\|$ ] with respect to @xmath148 yields @xmath149 , where @xmath122 is the same as that defined in ( [ syk ] ) .    in @xcite , pulay s method for updating @xmath39 is defined as @xmath150 ) , \\label{eqn : pulay}\\ ] ] where @xmath117 is an initial approximation to the inverse of the jacobian ( at the solution ) .",
    "substituting @xmath151 into ( [ eqn : pulay ] ) yields exactly anderson s updating formula  .",
    "if @xmath152 is the solution to ( [ eqn : vfix ] ) , then subtracting it from both sides of the quasi - newton updating formula @xmath114 \\right)\\ ] ] yields @xmath153 where @xmath154 is the jacobian of the function @xmath78 $ ] at @xmath152 and @xmath113 is the approximation to @xmath155 constructed at the @xmath156th step . if @xmath113 is a constant matrix @xmath157 for all @xmath156 , we can rewrite ( [ eqn : dvupdate ] ) as @xmath158    ideally , we would like to choose @xmath157 to be @xmath155 to minimize the error in the linear regime .",
    "however , this is generally not possible ( since we do not know @xmath152 ) .",
    "however , if @xmath157 is sufficiently close to @xmath155 , we may view @xmath157 as a preconditioner for a preconditioned fixed point iteration defined by ( [ eqn : pfixit ] ) .",
    "a desirable property for @xmath157 is that @xmath159 or @xmath160 because @xmath161 , we may construct @xmath157 by seeking approximations to @xmath162 and @xmath67 first and inverting the approximate jacobian in ( [ eqn : dvupdate ] ) .",
    "this is the approach taken by ho , ihm and joannopoulos in  @xcite , which is sometimes known as the hij approach .",
    "the hij approach approximates the matrix @xmath67 by using alder - wiser formula given in eq .   which requires computing all eigenvalues and eigenvectors associated with the kohn - sham hamiltonian defined at @xmath48 .",
    "the resulting computational cost for constructing @xmath67 alone is @xmath163 due to the explicit construction of each pair of @xmath164 and @xmath165 for @xmath166 and @xmath167 .",
    "such a preconditioning strategy is not practical for large problems .",
    "an alternative to the hij approach is to use the `` extrapolar '' method proposed in  @xcite .",
    "this method replaces @xmath168 by planewaves for large @xmath169 . as a result",
    ", the number of @xmath170 s that needs to be computed is reduced .",
    "however , such a reduction does not lead to a reduction in the computational complexity of constructing @xmath67 , which still scales as @xmath163 .",
    "therefore , the preconditioning strategy will become increasingly more expensive as the system size increases .",
    "a more efficient preconditioner that works well for simple metallic systems is the kerker preconditioner  @xcite .",
    "the potential updating scheme associated with this preconditioner is often known as the kerker mixing scheme .",
    "the construction of the kerker preconditioner is based on the observation that the coulomb operator @xmath96 can be diagonalized by the fourier basis ( planewaves ) , and the eigenvalues of the coulomb operator are @xmath171 , where @xmath172 is the magnitude of a sampled wave vector associated with the fourier basis function of the form @xmath173 .",
    "furthermore , for simple metals the polarizability operator @xmath67 can be approximately diagonalized by the fourier basis .",
    "the eigenvalues of @xmath67 are bounded from below and above .",
    "therefore , if we omit the contribution from @xmath174 , the eigenvalues of @xmath80 are @xmath175 for some constant @xmath176 which is related to the thomas - fermi screening length  @xcite .",
    "but the true value of @xmath177 is generally unknown .    by neglecting the effect of @xmath174 in @xmath178 , the kerker scheme sets",
    "@xmath157 to @xmath179 where @xmath180 is the matrix representation of the discretized fourier basis that diagonalizes both @xmath96 and @xmath67 , and the diagonal matrix @xmath181 contains @xmath182 on its diagonal , for some appropriately chosen constant @xmath183 , and @xmath74 is a parameter chosen to ensure   is satisfied .    as a result ,",
    "the eigenvalues of @xmath184 associated with the kerker preconditioner are approximately @xmath185 . when @xmath186 is small , the corresponding eigenvalue of @xmath184 is approximately @xmath187 .",
    "when @xmath186 is large , the corresponding eigenvalue of @xmath184 is approximately @xmath74 . by choosing an appropriate @xmath188",
    "we can ensure that all eigenvalues are within @xmath189 even when @xmath183 is not completely in agreement with the true @xmath177 .",
    "the behavior of @xmath67 for simple insulating systems is very different from that for simple metallic systems .",
    "for simple insulating systems , the eigenvalues of @xmath67 corresponding to small @xmath186 modes behave like @xmath190 where @xmath191 is a constant  @xcite . as a result ,",
    "the spectral radius of @xmath79 is bounded by a constant when the contribution from the exchange - correlation is negligible .",
    "therefore , we can choose @xmath192 with an appropriate @xmath74 to ensure the condition ( [ eqn : eigbound ] ) is satisfied .",
    "the optimal choice of @xmath74 will be discussed in the next section .",
    "we should also note that when @xmath113 is allowed to change from one iteration to another through the use of quasi - newton updates , the convergence of the preconditioned fixed point ( or quasi - newton ) iteration can be q - superlinear  @xcite .",
    "in the previous section , we identified the condition under which a preconditioned fixed - point iteration applied to the kohn - sham problem converges . in this section",
    ", we discuss the optimal rate of convergence and its dependency on the size of the physical system .",
    "ideally , we would like to construct a preconditioner to ensure the rate of convergence to be independent of the system size .",
    "when the preconditioner is chosen to be @xmath193 ( i.e. , simple mixing ) , the convergence of the preconditioned fixed point iteration is guaranteed if @xmath74 satisfies the condition given in ( [ eqn : alfabond1 ] ) . as is the case for analyzing richardson s iteration for linear equations , it is easy to show that the optimal choice of @xmath74 , which is the solution to the following problem @xmath194 must satisfy @xmath195 where @xmath196 and @xmath197 are the largest and smallest eigenvalues of @xmath154 respectively .    the solution to ( [ minmaxeig ] ) is @xmath198 therefore , the optimal convergence rate of simple mixing is simply  @xcite @xmath199 where @xmath200 is the condition number of the jacobian at the solution .      the convergence rate of broyden s method can be shown to be q - superlinear when it is applied to a smooth function , and when the starting guess of the solution is sufficiently close to the true solution and the starting guess of jacobian is sufficiently close to the true jacobian at the solution @xcite .",
    "however , in the anderson or pulay scheme , we reset the previous approximation to the jacobian to @xmath201 at each iteration . therefore , its convergence may not be superlinear in general .",
    "one interesting observation made by a number of researchers @xcite is that @xmath202 approximately lies in the krylov subspace @xmath203 when @xmath204 is sufficiently close to @xmath49 , and @xmath47 is constructed to have a minimum @xmath205 in this subspace in the anderson / pulay scheme even though we do not know this subspace explicitly .",
    "( since we do not know @xmath49 or @xmath80 . )",
    "therefore , one can draw a connection between the anderson / pulay scheme and the gmres  @xcite algorithm for solving a linear system of equations  @xcite . as a result",
    ", if the anderson or pulay scheme converges , and when the pseudo - inverse of @xmath206 is computed in exact arithmetic , heuristic reasoning suggests that the convergence rate may be approximately bounded by @xmath207 clearly , when @xmath208 is large , the anderson / pulay acceleration scheme is superior to the simple mixing scheme .",
    "when a good initial approximation to the inverse of the jacobian ( e.g. the kerker preconditioner ) , @xmath117 is available , it can be combined with the anderson / pulay acceleration scheme to make the fixed point iteration converge more rapidly .      a natural question that arises when we apply",
    "a preconditioned fixed point iteration to a large atomistic system is whether the convergence rate depends on the size of the system .    for periodic systems , the size of the system",
    "is often characterized by the number of unit cells in the computational domain . to simplify our discussion , we assume the unit cell to be a simple cubic cell with a lattice constant @xmath209 . for non - periodic systems such as molecules",
    ", we can construct a fictitious ( cubic ) supercell that encloses the molecule and periodically extend the supercell so that properties of the system can be analyzed through fourier analysis . in both cases",
    ", we assume the number of atoms in each supercell is proportional to @xmath210 .    because the convergence rates of both the simple mixing and anderson s method depend on the condition number of @xmath80",
    ", we should examine the dependency of @xmath211 with respect to @xmath209 .",
    "when a good initial guess to the jacobian @xmath117 is available , we should examine the dependency of @xmath212 with respect to @xmath209 . recall that @xmath213 , where @xmath96 is positive definite , @xmath174 is symmetric but not necessarily positive definite and @xmath67 is symmetric negative semidefinite .",
    "the eigenvalues of @xmath80 satisfy @xmath214 where @xmath215 is independent of the system size .",
    "the inequality @xmath216 gives the stability condition of the system .",
    "the dependency of @xmath217 on @xmath209 is generally difficult to analyze .",
    "however , for simple model systems such as a jellium system ( or uniform electron gas ) in which @xmath218 for some constant @xmath219 , we may use fourier analysis to show that the eigenvalues of @xmath80 are simply @xmath220 where @xmath172 , @xmath177 is a constant , and @xmath221 is known as the _ lindhard _ response function  @xcite .",
    "the lindhard function satisfies @xmath222 hence by taking @xmath223 , @xmath224 is determined by @xmath225 . as a result , the convergence of a fixed point iteration preconditioned by simple mixing and/or modified by anderson s method tends to become slower for a jellium system as the system size increases . when the kerker preconditioner is used , the eigenvalues of @xmath226 are @xmath227 they are approximately @xmath74 when @xmath186 is large , and are determined by @xmath228 when @xmath186 is small .",
    "since the smallest @xmath186 satisfies @xmath229 , the convergence rate of the kerker preconditioned fixed point iteration is independent of system size for a jellium system .",
    "the same conclusion can be reached for simple metals such as na or al which behave like free electrons  @xcite .",
    "therefore , the kerker preconditioner is an ideal preconditioner for simple metals .",
    "however , the kerker preconditioner is not an appropriate preconditioner for insulating systems .",
    "although in general the jacobian associated with the insulating system can not be diagonalized by the fourier basis , it can be shown that @xmath230 is an approximate eigenfunction of @xmath67 with the corresponding eigenvalue @xmath231  @xcite .",
    "if we neglect the contribution from @xmath174 , @xmath230 is also an approximate eigenfunction of @xmath80 with the corresponding eigenvalue @xmath232 for small @xmath186 s .",
    "if @xmath157 is chosen to be the kerker preconditioner , then the corresponding eigenvalue of @xmath226 is @xmath233 as the system size @xmath209 increases , the smallest @xmath186 , which satisfies @xmath229 , becomes smaller .",
    "consequently , the corresponding eigenvalue of @xmath226 approaches zero . the convergence rate , which is determined by @xmath234 , deteriorates as the system size increases .    for insulating systems ,",
    "a good preconditioner is simply @xmath115 , where @xmath74 is chosen to be close to @xmath235 ( in general , we do not know the value of @xmath236 ) .",
    "when such a preconditioner is used the convergence the fixed point iteration becomes independent of the system size .",
    "as we have seen above , simple insulating and metallic systems call for different types of preconditioners to accelerate the convergence of a fixed point iteration for solving the kohn - sham problem . a natural question one may ask is how we should construct a preconditioner for a complex material that may contain both insulating and metallic components or metal surfaces .",
    "before we answer this question , we should point out that the analysis of the spectral properties of @xmath80 that we presented earlier relies heavily on the assumption that the eigenfunctions of @xmath80 are approximately planewaves .",
    "although this assumption is generally acceptable for simple materials , it may not hold for more complex systems . therefore , to develop a more general technique for constructing a good preconditioner",
    ", it may be more advantageous to explore ways to approximate @xmath237 or the solution to the equation @xmath238 directly for some residue @xmath132 .",
    "one of the difficulties with this approach is in getting a good approximation of the polarizability operator @xmath67 in @xmath239 .",
    "the use of the adler - wiser formula given in   would require computing almost all eigenpairs of @xmath240 .",
    "even when some of the @xmath241 s can be replaced by simpler functions such as planewaves  @xcite , constructing this operator and working with it would take at least @xmath242 operations .",
    "therefore it is desirable to replace the adler - wiser representation of @xmath67 with something much simpler and cheaper to compute .",
    "however , making such a modification to @xmath67 only may introduce undesirable error near low electron density regions because @xmath85 contains terms proportional to @xmath243 ( which originates from the dirac exchange term @xcite ) .",
    "this problem can be avoided by using the observations made in the physics community that the product of @xmath85 and @xmath67 is relatively small compared to @xmath86 , even though this observation has not been rigorously proved . as a result , it is reasonable to approximate @xmath80 by @xmath244 . for historical reasons ,",
    "this approximation is known as the random phase approximation ( rpa ) in the physics literature  @xcite .",
    "note that , under rpa , we may rewrite @xmath245 as @xmath246 since @xmath247 , applying @xmath245 to a vector @xmath248 simply amounts to solving the following equation @xmath249    to construct a preconditioner @xmath157 , we will replace @xmath67 with a simpler operator .",
    "in many cases , we can choose the approximation to be a local ( diagonal ) operator defined by a function @xmath250 , although other type of more sophisticated operators are possible . to compensate for the simplification of @xmath67",
    ", we replace the laplacian operator on the left of   by @xmath251 for some appropriately chosen function @xmath252 .",
    "this additional change yields the following elliptic partial differential equation ( pde ) @xmath253 because our construction of the preconditioner involves solving an elliptic equation , we call such a preconditioner an _ elliptic preconditioner_.    although the new framework we use to construct a preconditioner for the fixed point iteration is based on heuristics and certain simplifications of the jacobian , it is consistent with the existing preconditioners that are known to work well with simple metals or insulators .    for example , for metallic systems , setting @xmath254 and @xmath255 for some constant @xmath256 yields @xmath257 the solution of the above equation is exactly the same as what is produced by the kerker preconditioner .    for isotropic insulating system ,",
    "setting @xmath258 and @xmath259 yields @xmath260 the solution to the above equation is simply @xmath261 such a solution corresponds to simple mixing with @xmath74 set to @xmath262 .    for a complex material that consists of both insulating and metallic components , it is desirable to choose approximation of @xmath252 and @xmath250 that are spatially dependent . the asymptotic behavior of @xmath67 with respect to the sizes of both insulating and metallic systems suggests that @xmath252 and @xmath250 should be chosen to satisfy @xmath263 and @xmath264 . in this case , the operator defined on the left hand side of ( [ eqn : rpaelliptic ] ) is a strongly elliptic operator .",
    "such an operator is symmetric positive semi - definite .",
    "the implementation of the elliptic preconditioner only requires solving an elliptic equation . in general @xmath265",
    "are spatially dependent , and solving the elliptic preconditioner requires more than just a fourier transform and scaling operation as is the case for the kerker preconditioner . however , it is generally much less time consuming than evaluating the kohn - sham map or constructing @xmath67 or @xmath116 . in particular ,",
    "fast algorithms such as multigrid  @xcite , fast multipole method ( fmm )  @xcite , hierarchical matrix  @xcite solver and hierarchical semi - separable ( hss ) matrix  @xcite can be applied to solve eq .   with @xmath266 arithmetic operations . even if we can not achieve @xmath266 complexity , eq .",
    "can often be solved efficiently by krylov subspaces iterative methods as we will show in the next section .",
    "our numerical experience suggests that simple choices of @xmath252 and @xmath250 can produce satisfactory convergence result for complicated systems .",
    "for example , if we place a metallic system in vacuum to ascertain its surface properties  @xcite , we can choose @xmath250 to be a nonzero constant in the metallic region , and almost @xmath267 in the vacuum part .",
    "the resulting piecewise constant function can be smoothed by convolving it with a gaussian kernel .",
    "similarly , @xmath252 can be chosen to be @xmath268 in the metallic region , and a constant larger than @xmath268 in the vacuum region .",
    "due to the simplification that we made about the @xmath67 term in the jacobian and the omission of the @xmath269 term altogether , the construction of an elliptic preconditioner alone may not be sufficient to reduce the number of fixed point iterations required to reach convergence .",
    "however , such a preconditioner can be easily combined with the broyden type of quasi - newton technique such as anderson s method discussed in  [ sec : broyden ] to further improve the convergence of the self - consistent field iteration .",
    "this is the approach we take in the examples that we will show in the next section .",
    "in this section , we demonstrate the performance of the elliptic preconditioner proposed in the previous section , and compare it with other acceleration schemes through two examples .",
    "the first example consists of a one - dimensional ( 1d ) reduced hartree - fock model problem that can be tuned to exhibit both metallic and insulating features .",
    "the second example is a three - dimensional ( 3d ) problem we construct and solve in kssolv  @xcite , which is a matlab toolbox for solving kohn - sham equations for small molecules and solids implemented entirely in matlab m - files .",
    "kssolv uses planewave expansion to discretize the kohn - sham equations .",
    "it also uses the troullier - martins pseudopotential  @xcite with the lda exchange - correlation functional to approximate the ionic potential .",
    "the 1d reduced hartree - fock model was introduced by solovej  @xcite , and has been used for analyzing defects in solids in  @xcite .",
    "the simplified 1d model neglects the contribution of the exchange - correlation term .",
    "nonetheless , typical behaviors of an scf iteration observed for 3d problems can be exemplified by this 1d model .",
    "in addition to neglecting the exchange - correlation potential , we also use a pseudopotential to represent the electron - ion interaction .",
    "this makes our 1d model slightly different from that presented in @xcite .",
    "the hamiltonian in our 1d reduced hartree - fock model is given by @xmath4 = -\\frac{1}{2 } \\frac{d^2}{dx^2 } + \\int k(x , y ) ( \\rho(y)+m(y ) ) { \\,\\mathrm{d}}y     \\label{eqn : hrhf}\\ ] ] here @xmath270 , with the position of the @xmath271-th nuclei denoted by @xmath272 .",
    "each function @xmath273 takes the form @xmath274 where @xmath275 is an integer representing the charge of the @xmath271-th nucleus .",
    "the parameter @xmath276 represents the width of the nuclei in the pseudopotential theory . clearly as @xmath277 , @xmath278 which is the charge density for an ideal nucleus . in our numerical simulation",
    ", we set @xmath276 to a finite value .",
    "the corresponding @xmath273 is called a _ pseudo charge density _ for the @xmath271-th nucleus .",
    "we refer to the function @xmath279 as the total pseudo - charge density of the nuclei .",
    "the system satisfies charge neutrality condition , _ i.e._@xmath280 since @xmath281 , the charge neutrality condition   implies @xmath282 where @xmath16 is the total number of electrons in the system . to simplify discussion ,",
    "we omit the spin contribution here .    instead of using a bare coulomb interaction , which diverges in 1d",
    ", we adopt a yukawa kernel @xmath283 which satisfies the equation @xmath284 as @xmath285 , the yukawa kernel approaches the bare coulomb interaction given by the poisson equation .",
    "the parameter @xmath286 is used to make the magnitude of the electron static contribution comparable to that of the kinetic energy .",
    "the parameters used in the reduced hartree - fock model are chosen as follows .",
    "atomic units are used throughout the discussion unless otherwise mentioned .",
    "for all the systems tested below , the distance between each atom and its nearest neighbor is set to @xmath287 a.u .. the yukawa parameter @xmath288 is small enough so that the range of the electrostatic interaction is sufficiently long , and @xmath286 is set to @xmath289 .",
    "the nuclear charge @xmath290 is set to @xmath291 for all atoms .",
    "since spin is neglected , @xmath292 implies that each atom contributes to @xmath291 occupied bands .",
    "the hamiltonian operator is represented in a planewave basis set .",
    "the temperature of the system is set to @xmath293 k , which is usually considered to be very low , especially for the simulation of metallic systems .    by adjusting the parameters @xmath294 ,",
    "the reduced hartree - fock model can be tuned to resemble an insulating , metallic or hybrid system .",
    "we apply the elliptic preconditioner with different choices of @xmath295 and @xmath296 to all three cases . in the case of an insulator and a metal , both @xmath295 and @xmath296",
    "are chosen to be constant functions .",
    "for the hybrid system , @xmath295 and @xmath296 are constructed by convolving a step function with a gaussian kernel as shown in figure  [ fig : axbx1d ] .",
    "the @xmath297 values used for all these cases are listed in table  [ tab : prob1 ] along with the constant values chosen for @xmath295 and @xmath296 in the insulating and metallic cases . for the hybrid case , we partition the entire domain @xmath298 $ ] into two subdomains : @xmath299 $ ] and @xmath300 $ ] .",
    "the @xmath297 value is set to @xmath301 in the first subdomain and @xmath302 in the second subdomain .",
    ".test cases and scf parameters used for the 1d model .",
    "[ cols=\"^,^,^,^,^\",options=\"header \" , ]     for all three cases , we apply anderson s method , anderson s method combined with the kerker preconditioner , and anderson s method combined with the elliptic preconditioner to the scf iteration .",
    "the @xmath74 parameter used in the anderson scheme is set to @xmath303 in all tests .",
    "the @xmath183 parameter is set to @xmath303 for the insulating and metallic cases , and @xmath304 for the hybrid case .",
    "the converged electron density @xmath7 associated with the three 1d test cases as well as the 74 smallest eigenvalues associated with the hamiltonian defined by the converged @xmath7 are shown in figure  [ fig : rhoandeig1d ] .",
    "the first @xmath305 eigenvalues correspond to occupied states , and the rest correspond to the first @xmath287 unoccupied states . for the insulator case",
    ", the electron density fluctuates between @xmath306 and @xmath307 .",
    "there is a finite gap between the highest occupied eigenvalue ( @xmath308 ) and the lowest unoccupied eigenvalue ( @xmath309 ) .",
    "the band gap is @xmath310 a.u .. the electron density associated with the metallic case is relatively uniform in the entire domain .",
    "the corresponding eigenvalues lie on a parabola ( which is the correct distribution for uniform electron gas . ) in this case , there is no gap between the occupied eigenvalues and the unoccupied eigenvalues . for the hybrid case ,",
    "the electron density is uniformly close to a constant in the metallic region ( except at the boundary ) , and fluctuates in the insulating region .",
    "there is no gap between the occupied and unoccupied states .",
    "+   +    in figure  [ fig : converge1d ] , we show the convergence behavior of all three acceleration schemes for three test cases by plotting the relative self - consistency error in potential against the iteration number . in each one of the subfigures , the blue line with circles , the red line with triangles and the black line with triangles correspond to tests performed on a 32-atom , 64-atom and 128-atom system respectively .",
    "we observe that the combination of anderson s method and the elliptic preconditioner gives the best performance in all test cases . in particular , the number of scf iterations required to reach convergence is more or less independent from the type of system and system size .",
    "we can clearly see that the use of the kerker preconditioner leads to deterioration in convergence speed when the system size increases for insulating and hybrid systems .",
    "on the other hand , anderson s method alone is not sufficient to guarantee the convergence of scf iteration for metallic and hybrid systems .",
    "all these observed behaviors are consistent with the analysis we presented in the previous section .",
    "+   +      in this subsection , we compare the performance of different preconditioning techniques discussed in section  [ sec : advance ] when they are applied to a 3d problem constructed in kssolv  @xcite , a matlab toolbox for solving kohn - sham problems for molecules and solids .",
    "we have chosen to use the kssolv toolbox because of its ease of use , especially for prototyping new algorithms .",
    "the results presented here can be reproduced by other more advanced dft software packages such as quantum espresso  @xcite , with some additional programming effort .",
    "the model problem we construct consists of a chain of sodium atoms placed in a vacuum region that extends on both ends of the chain .",
    "the sodium chain contains a number of body - centered cubic ( bcc ) unit cells .",
    "the dimension of the unit cell along each direction is @xmath311 a.u .. each unit cell contains two sodium atoms . to examine the size dependency of the preconditioning techniques",
    ", we tested both a 16-unit cell ( 32-atoms ) model and a larger 32-unit cell ( 64 atoms ) model .",
    "the converged electron density on the @xmath312 plane ( or the [ 100 ] plane in crystallography terminology ) associated with the 32-atom model is shown in figure  [ fig : naconfig ] .",
    "slice of the electron density @xmath313 of the 32-atom sodium system with large vacuum regions at both ends . , title=\"fig:\",scaledwidth=80.0% ] +    figure  [ fig : convna ] shows how anderson s method , the combination of anderson s method and the kerker preconditioner and the combination of anderson s method and the elliptic preconditioner behave for both the 32-atom and the 64-atom sodium systems .",
    "for the 32-atom problem , the parameter @xmath74 for the anderson s method is set to @xmath314 .",
    "the parameter @xmath183 required in both the kerker preconditioner and the elliptic preconditioner is set to 0.05 . for the 64-atom problem ,",
    "the parameter @xmath74 is set to @xmath315 . for simplicity the function @xmath295 required in the elliptic preconditioner",
    "is set to a constant function @xmath316 .",
    "the @xmath296 function ( shown in figure  [ fig : naellipticb ] for the 32-atom problem ) is constructed by convolving a square wave function with a value of @xmath317 in the sodium region and @xmath267 in the vacuum region with a gaussian kernel .",
    "the scf iteration is declared to be converged when the relative self - consistency error in the potential is less than @xmath318 .",
    "slices of the function @xmath319 used in the elliptic preconditioner for a 32-atom sodium system with large vacuum regions at both ends.,title=\"fig:\",scaledwidth=80.0% ]    as we can clearly see from figure  [ fig : convna ] , the use of the anderson s method with the elliptic preconditioner leads to rapid convergence . furthermore , the number of iterations ( around 30 ) required to reach convergence does not change significantly as we move from the 32-atom problem to the 64-atom problem .",
    "using anderson s method alone enables us to reach convergence in 60 iterations for the 32-atom problem .",
    "however , it fails to reach convergence within 100 iterations for the 64-atom case .",
    "when anderson s method is combined with the kerker preconditioner , the scf iteration converges very slowly for both the 32-atom and the 64-atom problems .",
    "na atoms ( a ) and @xmath305 na atoms ( b).,title=\"fig:\",scaledwidth=35.0% ]   na atoms ( a ) and @xmath305 na atoms ( b).,title=\"fig:\",scaledwidth=35.0% ]",
    "we discussed techniques for accelerating the convergence of the self - consistent iteration for solving the kohn - sham problem .",
    "these techniques make use of the spectral properties of the jacobian operator associated with the kohn - sham fixed point map . they can also be viewed as preconditioners for a fixed point iteration .",
    "we pointed out the crucial difference between insulating and metallic systems and different strategies for constructing preconditioners for these two types of systems .",
    "a desirable property of the preconditioner is that the number of fixed point iterations is independent of the size of the system .",
    "we showed how this property can be maintained for both insulators and metals .",
    "furthermore , we proposed a new preconditioner that treats insulating and metallic systems in a unified way .",
    "this preconditioner , which we refer to as an elliptic preconditioner , is constructed by solving an elliptic pde with spatially dependent variable coefficients .",
    "constructing preconditioners for insulating and metallic systems simply amounts to setting these coefficients to appropriate functions .",
    "the real advantage of this type of preconditioner is that it allows us to tackle more difficult problems that contain both insulating and metallic components at low temperature .",
    "we showed by simple numerical examples that this is indeed the case .",
    "although the size of the systems used in our examples are relatively small because we are limited by the use of matlab , we can already see the benefit of an elliptic preconditioner in terms of keeping the number of scf iterations relatively constant even as the system size gets larger . to fully test whether the preconditioner can achieve the goal of keeping the scf iterations system size independent , we should implement the elliptic preconditioner in a standard electronic structure calculation software packages such as quantum espresso  @xcite , abinit  @xcite and siesta  @xcite etc .",
    "that are properly parallelized , which we plan to do in the near future .",
    "this work was supported by the laboratory directed research and development program of lawrence berkeley national laboratory under the u.s .",
    "department of energy contract number de - ac02 - 05ch11231 ( l. l. and c. y. ) .",
    "we would like to thank eric cancs , roberto car , weinan e , weiguo gao , jianfeng lu , lin - wang wang and lexing ying for helpful discussion ."
  ],
  "abstract_text": [
    "<S> we discuss techniques for accelerating the self consistent field ( scf ) iteration for solving the kohn - sham equations . </S>",
    "<S> these techniques are all based on constructing approximations to the inverse of the jacobian associated with a fixed point map satisfied by the total potential . </S>",
    "<S> they can be viewed as preconditioners for a fixed point iteration . </S>",
    "<S> we point out different requirements for constructing preconditioners for insulating and metallic systems respectively , and discuss how to construct preconditioners to keep the convergence rate of the fixed point iteration independent of the size of the atomistic system . </S>",
    "<S> we propose a new preconditioner that can treat insulating and metallic system in a unified way . </S>",
    "<S> the new preconditioner , which we call an elliptic preconditioner , is constructed by solving an elliptic partial differential equation . </S>",
    "<S> the elliptic preconditioner is shown to be more effective in accelerating the convergence of a fixed point iteration than the existing approaches for large inhomogeneous systems at low temperature .    </S>",
    "<S> kohn - sham density functional theory , self consistent field iteration , fixed point iteration , elliptic preconditioner    65f08 , 65j15 , 65z05 </S>"
  ]
}