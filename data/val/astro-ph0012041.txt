{
  "article_text": [
    "the calculation of the gravitational force is the most expensive part of almost all @xmath1-body simulations .",
    "the barnes - hut treecode @xcite is a widely used algorithm to reduce the cost of the force calculation . in the treecode ,",
    "forces on a particles from distant particles are replaced by multipole expansions of groups of particles .",
    "more distant particles are organized into larger groups , so that the truncation error of the expansion is similar everywhere .",
    "hierarchical tree structure is used to form grouping efficiently .",
    "the calculation cost is reduced from @xmath2 to @xmath3 .",
    "even with the treecode , the cost of force calculation is still high , and it dominates the total calculation cost . in order to accelerate the treecode further , we can use grape @xcite .",
    "grape is a special - purpose hardware for the calculation of gravitational force between particles .",
    "it works in cooperation with a general - purpose computer ( host computer ) .",
    "the host computer does everything except for the force calculation .",
    "the application of grape to the treecode is introduced by @xcite , who implemented barnes ( 1990 ) modified algorithm on grape-1a @xcite .",
    "@xcite and @xcite reported its performance on grape-3 and grape-5 , respectively .",
    "the speedup factor they obtained is in the range of 30 to 50 .",
    "although grape can significantly accelerate the treecode , its application has been limited to simulations where the requirement for the accuracy is modest .",
    "since grape can only calculate forces from point mass particles , we have not been able to handle terms of the multipole expansion higher than dipole .",
    "thus , the calculation cost grows quickly when high accuracy is required .    in this letter",
    ", we introduce the pseudoparticle multipole method ( p@xmath0m@xmath0 ) which makes it possible to evaluate higher - order expansions on grape . in p@xmath0m@xmath0",
    ", multipole expansions are represented by a small number of pseudoparticles .",
    "the masses and positions of pseudoparticles are determined so that they have the same expansion coefficients as the corresponding physical particles up to the specified order . with the p@xmath0m@xmath0 ,",
    "we can use grape to evaluate high order terms , since they are expressed by particles .    in this letter , we first describe the procedure to express quadrupole moment using three particles (   2 ) .",
    "then we briefly describe the generalization to higher order expansion (   3 ) .",
    "finally we give the result of numerical tests on grape-4 (   4 ,   5 ) .",
    "in p@xmath0m@xmath0 , we distribute the pseudoparticles so that they exactly reproduce the coefficients of the multipole expansion of real ( physical ) particles up to a given order . conceptually , in order to obtain such a distribution , first we calculate the expansion coefficients from the distribution of physical particles .",
    "we then solve the inverse problem to obtain the masses and positions of pseudoparticles . in the following ,",
    "we describe a practical procedure to obtain the distribution of the pseudoparticles which can be used up to quadrupoles",
    ".    in cartesian coordinates , the multipole expansion up to quadrupoles of the potential due to @xmath1 particles is expressed as @xmath4 \\right\\}.\\ ] ] the mass @xmath5 and the position @xmath6 of pseudoparticles must be determined so that they give the same @xmath7 up to a given order @xmath8 .",
    "in general , the expansion up to the @xmath8-th order has @xmath9 independent terms .",
    "since each pseudoparticle has four degrees of freedom ( one for mass and three for position ) , theoretically we can reproduce the expansion using @xmath10 pseudoparticles . here",
    "@xmath11 denotes the minimum integer not smaller than @xmath12 .    in order to express multipole expansion of order @xmath13",
    ", we need @xmath14 pseudoparticle .",
    "we must put the particle so that @xmath15 and @xmath16 reproduce the first term ( monopole term ) of the right hand side of equation ( [ eq : mpicart ] ) . for this purpose",
    "we can set the mass @xmath17 , where @xmath18 is the total mass of physical particles .",
    "at least formally , the position of the pseudoparticle can be anywhere . in figure",
    "[ fig : p012 ] we place them at the origin as example . in practice , we would never use zeroth order expansion since we can achieve the first order accuracy with one particle , as we will see below .",
    ", width=302 ]    for @xmath19 , @xmath5 and @xmath6 must reproduce the first and the second term ( dipole term ) of the right hand side of equation ( [ eq : mpicart ] ) . we can satisfy this condition by placing a single pseudoparticle with mass @xmath18 at the center of mass of physical particles , @xmath20 ( see figure [ fig : p012]b ) , as is done with the original barnes - hut treecode .    for @xmath21 ,",
    "the minimum number of pseudoparticles necessary is @xmath22 . in the following",
    ", we ll see whether we can actually construct the distribution of three pseudoparticles which reproduces the multipole expansion up to quadrupole .    in order to reproduce the first and the second terms , the total mass of the pseudoparticles should be @xmath18 , and their center of mass",
    "should be located at @xmath20 .",
    "this is achieved by making their total mass @xmath18 and center of mass to be the same as that of physical particles . in the following ,",
    "we use a coordinate system shifted so that @xmath23 .",
    "pseudoparticles should have the same quadrupole tensor @xmath24 - { \\displaystyle \\frac{1}{2}\\sum_{i=1}^n m_i { { \\mbox{\\boldmath{${r}$}}}}_i^2}\\ ] ] as physical particles to reproduce the third term in equation ( [ eq : mpicart ] ) .    by definition , @xmath25 is symmetric and traceless",
    ". therefore we can choose the coordinate axe so that @xmath25 is diagonalized .",
    "in this coordinate system , @xmath25 is expressed as : @xmath26.\\ ] ] we can choose @xmath27 and @xmath28 , so that the relation @xmath29 is satisfied .",
    "obviously , all three pseudoparticles should be on the x - y plane .",
    "now our problem is reduced to determining the masses and positions of three particles on the x - y plane so that they give the quadrupole moment tensor of the form ( [ eq : qmat ] ) .",
    "there are a variety of ways to satisfy this requirement . here",
    "we give just one example .",
    "we still have three extra degrees of freedom , since we can change masses and positions of two particles on the x - y plane freely , and we have only three constraint . in our procedure",
    ", we set the masses as @xmath30 these masses reproduce the first term of the equation ( [ eq : mpicart ] ) .",
    "now we have only one extra degree of freedom left .",
    "we use it by setting @xmath12 component of @xmath31 to 0 .",
    "now we can determine the position vectors as follows : @xmath32 , { { \\mbox{\\boldmath{${r_2}$ } } } } = \\left [ \\begin{array}{c } \\alpha \\\\ -\\beta \\\\ 0 \\end{array } \\right ] , { { \\mbox{\\boldmath{${r_3}$ } } } } = \\left [ \\begin{array}{c } -\\alpha \\\\ -\\beta \\\\ 0 \\end{array } \\right ] , \\ ] ] where @xmath33 and @xmath34 are defined as @xmath35 note that both @xmath33 and @xmath34 are guaranteed to be real numbers . as we have already mentioned , this solution is not unique .",
    "for example , if we set @xmath36 , instead of @xmath12 , component of @xmath31 to 0 , we obtain another solution that attains the same order of accuracy .",
    "here we describe the generalization of p@xmath0m@xmath0  for multipole expansion of higher order . using the procedure we described in the previous section",
    ", we can express multipole expansion up to quadrupole , with the minimum number of pseudoparticles theoretically required .",
    "however , the described procedure depends closely on the nature of quadrupole - moment tensor , and it is difficult to extend this procedure to higher orders .",
    "@xcite proposed a different approach based on the orthogonality of spherical harmonics .",
    "his approach gives a systematic procedure to obtain the distribution for an arbitrary order .",
    "since his procedure needs rather large number of pseudoparticles , it is not efficient when the required accuracy is modest .",
    "but it may be useful for calculations that require very high accuracy . in the following ,",
    "we briefly describe his procedure . here",
    "we use spherical coordinates for mathematical convenience .",
    "the multipole expansion of the potential @xmath37 is expressed as @xmath38 in spherical coordinates @xmath39 . here",
    "@xmath40 is the spherical harmonics and @xmath41 are the expansion coefficients . in order to approximate the potential field due to the distribution of @xmath1 particles",
    ", the coefficients should satisfy @xmath42 where @xmath43 and @xmath44 are the masses and positions of the particles , and @xmath45 denotes the complex conjugate . in order to express the expansion @xmath37 up to the @xmath8-th order",
    ", @xmath46 pseudoparticles must give the same coefficients @xmath41 for all @xmath9 combinations of @xmath47 and @xmath48 in the range of @xmath49 and @xmath50 .",
    "thus , their masses @xmath5 and the positions @xmath51 should satisfy @xmath52 for @xmath49 and @xmath50 . the mass @xmath5 and the position @xmath6 are obtained as the solution of this equation .    as we have seen in the previous section ,",
    "it is possible to directly solve this equation for relatively small @xmath8 , say , @xmath53 . for large @xmath8",
    ", it is difficult because the equation is nonlinear . in addition",
    ", it is not clear whether or not an acceptable solution exists for arbitrary distribution of physical particles .",
    "the key idea of makino s approach is to fix the positions of pseudoparticles .",
    "equation ( [ eq : coeffij ] ) is nonlinear for the positions @xmath6 , but is linear for the masses @xmath5 .",
    "thus , if we fix the positions , the equation becomes linear . on the other hand ,",
    "the necessary number of pseudoparticles increases , since we can adjust only the masses of pseudoparticles , and the degree of freedom assigned to each particle is reduced from four to one .",
    "we restrict the distribution of pseudoparticles to the surface of a sphere centered at the origin , so that the the mathematics are further simplified . with this restriction ,",
    "the coefficients of multipole expansion are expressed as the spherical harmonic expansion of the masses of pseudoparticles . if we choose the positions of pseudoparticles so that the numerical integration over their positions retains the orthogonality of spherical harmonics up to the @xmath8-th order , the mass of pseudoparticles are obtained as the inverse transform of the expansion through numerical integration .    in makino s procedure ,",
    "the spherical @xmath54-design @xcite is used as the distribution of pseudoparticles .",
    "the spherical @xmath54-design is defined as a set of points on a unit sphere with the following characteristics .",
    "the summation of an arbitrary polynomial of a degree at most @xmath54 over the points exactly match the integration over the sphere ( except for a constant coefficient ) . using spherical @xmath54-design",
    ", we can achieve expansion order @xmath55 . here",
    "@xmath56 denotes the maximum integer not larger than @xmath12 .",
    "for example , multipole expansion of order @xmath57 and @xmath58 are expressed with number of points @xmath59 and @xmath60 , respectively .",
    "see @xcite for the number of points for higher @xmath8 , and the position coordinates of the points .",
    "using p@xmath0m@xmath0 , we implemented an arbitrary - order treecode ( hereafter p@xmath0m@xmath0  treecode ) on grape-4 @xcite and a unix workstation .",
    "the source code for these implementations are available upon request . in the following",
    "we show the results of numerical tests for the accuracy and the performance . for the measurement",
    ", we used one grape-4 processor board ( 47 processors , 15 gflops ) .",
    "the host computer for grape-4 is a compaq alphastation xp1000 with alpha 21264 processor , running at 500 mhz .",
    "we uniformly distributed 262144 equal - mass particles within a unit sphere .",
    "then we calculated the force on each particle with p@xmath0m@xmath0  treecode , and measured relative error @xmath61 and calculation time @xmath62 for various values of the opening angle @xmath63 .",
    "the error @xmath61 is defined as r.m.s .",
    "relative difference from the exact force .",
    "as the exact force , we used the force calculated with direct summation algorithm on the host computer using ieee-754 standard 64-bit arithmetic .",
    "figures [ fig : err ] and [ fig : time ] show the results . in figure",
    "[ fig : err ] , the errors for p@xmath0m@xmath0  treecode  of orders @xmath19 through 4 are plotted as functions of @xmath63 .",
    "we can see that the error roughly scales as @xmath64 .",
    "this behavior agrees well with the theoretical estimate given by @xcite .",
    "the saturation of the accuracy at @xmath65 is due to the hardware limitation of grape-4 .",
    "plotted against the opening angle @xmath63 .",
    "solid curve with filled squares shows the result of p@xmath0m@xmath0  treecode  of order @xmath21 .",
    "four long - dashed curves with open triangle , square , pentagon , and hexagon are for generalized p@xmath0m@xmath0  treecode  of @xmath66 , and @xmath58 , respectively .",
    "solid curve with filled triangles is for treecode of order @xmath19 .",
    "[ fig : err],width=302 ]        in figure [ fig : time ] , the force error @xmath61 is plotted as functions of the calculation time @xmath62 .",
    "we can see that p@xmath0m@xmath0  treecode  of order @xmath21 is the fastest for a wide range of accuracy ( @xmath67 ) . for low accuracy ( @xmath68 ) , the treecode of order @xmath19 is the fastest . for extremely high accuracy ( @xmath69 ) ,",
    "p@xmath0m@xmath0  treecode  of order @xmath70 is likely to be the fastest , if the accuracy is not limited by the hardware .",
    "we performed the same test without grape-4 , and found that grape-4 accelerates the calculation by a factor of 10 ( for @xmath71 ) to 150 ( for @xmath72 ) .",
    "here we discuss the overall accuracy of the simulation with p@xmath0m@xmath0  treecode  on grape-4 .",
    "we have already seen our code attain high accuracy in calculation of instantaneous force , but this high accuracy does not necessarily guarantee the accuracy of the total simulation .",
    "for example , if the force errors in consecutive timesteps are strongly correlated , they accumulate . as a result , overall accuracy of the orbits of stars",
    "might be worse , compared to the case with weaker correlation .",
    "we performed a simulation of the collision of two identical galaxies .",
    "we chose the system of units so that the total mass of each galaxy and the gravitational constant are both unity and the total energy of each galaxy is @xmath73 .",
    "galaxy model we used is the hernquist model @xcite with 65536 equal - mass particles .",
    "we cut off the distribution at radius 20 .",
    "we place the galaxies at initial separation 3.0 , and gave initial velocities so that they would follow a parabolic head on collision .",
    "we integrated this system up to @xmath74 with time step @xmath75 and softening parameter @xmath76 .",
    "we performed the same simulation using three different codes , namely , p@xmath0m@xmath0  treecode of order @xmath21 , the treecode of order @xmath19 , and the direct summation algorithm .",
    "for treecode simulations , the opening angle @xmath63 is @xmath77 .",
    "figure [ fig : dyn ] shows the results .",
    "the relative error of the total energy , @xmath78 , is plotted as a function of time @xmath54 .",
    "for all runs , we can see three bumps around @xmath79 , and 8 , which correspond to close encounters of two galaxies .",
    "these bumps comes from the time - integration error , since they can be seen in the result of the direct summation algorithm with highly accurate force calculation .",
    "we can regard the deviation from the result of the direct summation as being caused by the error of the force calculated with the treecodes .",
    "for the treecode with @xmath21 , the maximum deviation from the direct summation is @xmath80 , while for @xmath19 it is @xmath81 .",
    "this a factor of 10 difference is consistent with the difference of the accuracy of the instantaneous force shown in figure [ fig : err ] .",
    "thus , we can conclude that the high accuracy in the instantaneous force offered by our new p@xmath0m@xmath0  does improve the overall accuracy of the time integration .",
    "we thank piet hut , yoko funato , toshiyuki fukushige and toshikazu ebisuzaki for invaluable discussions concerning the subject of this paper .",
    "this work is supported by the research for the future program of japan society for the promotion of science , jsps - rftf 97p01102 ."
  ],
  "abstract_text": [
    "<S> in this letter we describe the pseudoparticle multipole method ( p@xmath0m@xmath0 ) , a new method to express multipole expansion by a distribution of pseudoparticles . </S>",
    "<S> we can use this distribution of particles to calculate high order terms in both the barnes - hut treecode and fmm . </S>",
    "<S> the primary advantage of p@xmath0m@xmath0  is that it works on grape . </S>",
    "<S> grape is a special - purpose hardware for the calculation of gravitational force between particles . </S>",
    "<S> although the treecode has been implemented on grape , we could handle terms only up to dipole , since grape can calculate forces from point - mass particles only . </S>",
    "<S> thus the calculation cost grows quickly when high accuracy is required . </S>",
    "<S> with p@xmath0m@xmath0 , the multipole expansion is expressed by particles , and thus grape can calculate high order terms . using p@xmath0m@xmath0 , we implemented an arbitrary - order treecode on grape-4 . </S>",
    "<S> timing result shows grape-4 accelerates the calculation by a factor between 10 ( for low accuracy ) to 150 ( for high accuracy ) . </S>",
    "<S> even on general - purpose programmable computers , our method offers the advantage that the mathematical formulae and therefore the actual program is much simpler than that of the direct implementation of multipole expansion . </S>"
  ]
}