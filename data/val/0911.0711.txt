{
  "article_text": [
    "measurements of the vector magnetic field in the solar atmosphere are crucial for understanding a wide variety of physical phenomena . using the linear polarisation of magnetically sensitive spectral lines to infer the component of the field transverse to the line - of - sight results in an ambiguity of 180@xmath0 in its direction @xcite .",
    "this ambiguity must be resolved in order to completely determine the magnetic field vector .",
    "several methods are currently in use to resolve the ambiguity ( for overviews see ; ) . in general",
    ", each method involves an assumption or approximation that may not be appropriate for observations of solar magnetic fields .    a promising approach , which can potentially avoid unrealistic assumptions , is to exploit the divergence - free property of magnetic fields ( _ e.g. , _ ; ; ; ; ; ) .",
    "one challenge in calculating the divergence is that it requires information about the variation of the field in the direction perpendicular to the solar surface . to this end",
    "it is possible to derive from observations the variation of the field along the line - of - sight direction ( _ e.g. , _ ; ; ; ; ; , @xcite ; ; ; ; , @xcite ) .",
    "the line - of - sight direction is not perpendicular to the solar surface , except at disk centre ; therefore some care is required to correctly treat the geometrical perspective .",
    "in @xcite  ( @xcite , henceforth paper  i ) we showed that the ambiguity can be resolved with line - of - sight and horizontal heliographic derivative information by using the divergence - free property without additional assumptions about the nature of the field . to resolve the ambiguity away from disk centre we demonstrated that it is sufficient to determine four pieces of information : _",
    "i ) _ the sign of the line - of - sight derivative of the line - of - sight component of the magnetic field ; _ ii ) _ the sign and magnitude of the line - of - sight derivative of the magnitude of the transverse component of the field ; _ iii ) _ the sign and magnitude of the line - of - sight derivative of the azimuthal angle ; and _ iv ) _ the sign and magnitude of the horizontal heliographic derivatives of the magnitude of the transverse component of the field and the azimuthal angle .",
    "paper  i was a theoretical examination in which we assumed that all necessary derivatives could be determined exactly at a given location and that the solar surface could be represented by the heliographic plane .",
    "the aim of this paper is to investigate how the divergence - free property can be used to resolve the ambiguity for data where the magnetic field is measured at discrete spatial locations . using synthetic data we test two methods that have previously appeared in the literature ( _ e.g. ,",
    "_ ; ; ; ; ) ; both of these are based on the divergence but they make different assumptions about how to use it to resolve the ambiguity . we show that both of these methods can produce significant errors . for this reason , we present a more robust algorithm , the global minimisation method .",
    "the outline of this paper is as follows . in section  [ sec_divb ]",
    "we describe the derivation of the divergence - free condition for any position on the solar disk in terms of observable quantities and discuss the consequences for ambiguity resolution . in section  [ sec_synth ]",
    "we review the synthetic data and metrics that will be used to test the performance of the ambiguity resolution algorithms . in section  [ algorithms ]",
    "we test the algorithms and the validity of the assumptions made . in section  [ sec_conc ]",
    "we draw conclusions .",
    "within a limited field of view we assume that the solar surface can be represented by the heliographic plane , which is tangent to the solar surface at the position given by the central meridian angle , the latitude , and the @xmath1- and @xmath2-angles . over the heliographic plane ,",
    "the image components of the magnetic field are related to the heliographic components according to the following transformation :    @xmath3    where the coefficients @xmath4 are taken from equation  ( 1 ) of , @xmath5 is the line - of - sight component of the field , and the components of the field perpendicular to the line - of - sight direction are given by    @xmath6    where @xmath7 is the magnitude of the component transverse to the line - of - sight and the azimuthal angle , @xmath8 , is the angle between the transverse component of the field and the @xmath9-axis ( where @xmath9 and @xmath10 are coordinates on the plane perpendicular to the line - of - sight ) . the azimuthal angle can only be determined observationally within the range @xmath11 .",
    "the derivative in the direction perpendicular to the heliographic plane , @xmath12 , can not be directly measured away from disk centre . however , the derivative along the line - of - sight direction , @xmath13 , can be measured ( see below for further discussion ) .",
    "these derivatives are related as follows :    @xmath14    where @xmath15 is any differentiable function , @xmath16 is the distance along the line - of - sight direction , and @xmath17 and @xmath18 are coordinates on the heliographic plane .",
    "derivatives with respect to horizontal heliographic distance , @xmath19 and @xmath20 , can be approximated with techniques such as finite differences and finite elements using discrete measurements over the heliographic plane . for convenience ,",
    "we work with the line - of - sight distance @xmath16 , although in practice the field is likely to be inferred as a function of optical depth ; in which case a model atmosphere must be used to determine the correspondence between line - of - sight distance and optical depth ( _ e.g. , _ ; ; ; ) .",
    "equations  ( [ b_h ] ) and ( [ dlos ] ) can be used to express the divergence of the field in terms of observable quantities ( _ i.e. , _ derivatives of the image components of the field with respect to @xmath17 , @xmath18 , and @xmath16 ) ,    @xmath21    where    @xmath22    equations  ( [ divb2 ] ) and ( [ da ] ) show that the computation of the divergence requires the line - of - sight derivatives of all three components of the magnetic field vector , except at disk centre where the coefficients @xmath23 ( see paper  i for further discussion ) .",
    "several techniques have appeared in the literature to measure the line - of - sight variation of the magnetic field ( often but not always including the full magnetic field vector ) .",
    "we briefly discuss three that could be employed to evaluate the various terms in equations  ( [ divb2 ] ) and ( [ da ] ) .",
    "the first and possibly most straightforward is to measure the field at different heights using multiple spectral lines ( _ e.g. , _ ; ) .",
    "the inferred height difference between measurements can be several hundred kilometres or more depending on line choice , although exact heights can not be easily quantified due to the lines often broad range of formation height .",
    "a second approach makes use of a single ( generally chromospheric ) line that forms over a range of heights .",
    "inversions performed at multiple , but limited wavelength ranges near ( for example ) the core and separately in the line wing can return the field strengths at different atmospheric heights ( _ e.g. , _ ; ) .",
    "again , estimates of the field are obtained at discrete but broad heights which may be separated by tens or hundreds of kilometres .",
    "a third approach recovers the line - of - sight stratification of the magnetic field during the inversion of the stokes spectra through a formalism based on response functions ( _ e.g. , _ ; ; ; , @xcite ; ; , @xcite ) .",
    "the field is computed at discrete heights ( inversion nodes ) which may be separated by several hundred kilometres ( _ e.g. , _ ) ; interpolation can map the results onto a grid with points separated by as little as 5 kilometres . for all of the aforementioned techniques , the field",
    "is effectively sampled discretely .",
    "therefore , the line - of - sight derivatives in equations  ( [ divb2 ] ) and ( [ da ] ) must be approximated .",
    "it is important to understand that the inferred line - of - sight derivatives of the transverse components of the field , @xmath24 and @xmath25 , depend on the ambiguity resolution at all heights used to approximate line - of - sight derivatives .",
    "consequently , for ambiguity resolution algorithms based on these derivatives , vector magnetogram data should be disambiguated simultaneously at all relevant heights .",
    "compared several techniques for disambiguating single - height magnetogram data for which information about the variation of the field out of the heliographic plane was not available . to test the performance of the various algorithms based on the divergence we use the same magnetic field configurations that were used by for which the correct ambiguity resolution is known and magnetic field data are available at two heights .",
    "methods based on the divergence require magnetic field data from at least two heights .",
    "all methods examined in this paper could be adapted for data with more than two heights ; however , this can add a degree of complexity to the disambiguation process ( depending on the algorithm ) because all heights may need to be disambiguated simultaneously .",
    "for each synthetic magnetogram , the field is sampled at discrete spatial locations .",
    "the grid points are intended to mimic pixel centres , although the exact value of the field is provided .",
    "thus , the effects of noise and unresolved structure in both the line - of - sight and horizontal heliographic directions are neglected ( see _ e.g. , _ ) ; these issues are beyond the scope of this investigation and will be considered in a separate paper .",
    "the grid points at each height are aligned in the line - of - sight direction and separated by a line - of - sight distance , @xmath26 .    ;",
    "positive / negative vertical magnetic flux is indicated by _",
    "red_/_blue _ contours at 100 , 1000 , 2000  g , and the magnetic neutral line is indicated by the _",
    "black _ contour .",
    "horizontal magnetic field is plotted at every fifth pixel , with magnitude proportional to arrow length .",
    "tickmarks are in units of pixels .",
    "( a ) vector magnetic field at @xmath27 from the numerical simulation of fan and gibson  ( 2004 ) at their time step 56 ( @xmath28 is a length scale , effectively the size of the simulation domain in the @xmath29-direction ) .",
    "the pixel size is @xmath30 .",
    "this is an exact reproduction of figure  1 from metcalf  _ et al . _  ( 2006 ) .",
    "( b ) vector magnetic field for the multipole structure in image coordinates .",
    "the pixel size is @xmath31 .",
    "this is an exact reproduction of figure  2 from metcalf  _ et al . _  ( 2006 ) .",
    ", title=\"fig:\",scaledwidth=49.0% ] ; positive / negative vertical magnetic flux is indicated by _",
    "red_/_blue _ contours at 100 , 1000 , 2000  g , and the magnetic neutral line is indicated by the _",
    "black _ contour .",
    "horizontal magnetic field is plotted at every fifth pixel , with magnitude proportional to arrow length .",
    "tickmarks are in units of pixels .",
    "( a ) vector magnetic field at @xmath27 from the numerical simulation of fan and gibson  ( 2004 ) at their time step 56 ( @xmath28 is a length scale , effectively the size of the simulation domain in the @xmath29-direction ) .",
    "the pixel size is @xmath30 .",
    "this is an exact reproduction of figure  1 from metcalf  _ et al . _  ( 2006 ) .",
    "( b ) vector magnetic field for the multipole structure in image coordinates .",
    "the pixel size is @xmath31 .",
    "this is an exact reproduction of figure  2 from metcalf  _ et al . _  ( 2006 ) .",
    ", title=\"fig:\",scaledwidth=49.0% ]    the field shown in figure  [ synth](a ) is a snapshot from the numerical mhd simulation of of a highly twisted flux tube emerging into an overlying potential field `` arcade '' . because the simulation results are provided on a three - dimensional rectangular grid this case corresponds to disk centre , where the line - of - sight and @xmath32-directions are parallel .",
    "figure  [ synth](a ) shows the field at the first height ( as used by ) ; the second height used in this investigation lies above this , and is discussed in detail below .    the field displayed in figure  [ synth](b )",
    "is constructed from a collection of point sources located on a plane below the surface .",
    "the contribution to the field from each source is calculated using the green s function given by with a constant value of the force - free parameter @xmath33 .",
    "this magnetogram is located away from disk centre , centred at n @xmath34 , w @xmath35 , and it includes the effects of curvature .",
    "again figure  [ synth](b ) shows the field at the first height ( as used by ) ; the second height lies above this and is discussed further below .    to quantify the performance of the various algorithms we will use the same four metrics presented in : the fraction of pixels correctly disambiguated @xmath36 , the fraction of magnetic flux with the correct solution @xmath37 , the fraction of strong horizontal field regions ( @xmath38  g ) with the correct solution @xmath39 , and a measure of the discrepancy in the vertical current between the retrieved and correct solution , @xmath40 ; note that @xmath40 can have values outside the range @xmath41 $ ] unlike the other three metrics .",
    "thus the results presented here can be directly compared to those obtained for the algorithms examined by .",
    "in this section we test several disambiguation methods all based on the divergence - free condition but which employ different assumptions and implementation details .",
    "first , we examine two methods that have previously appeared in the literature : the @xcite criterion ( _ e.g. , _ ; ; ; ) and the sequential minimisation method ( _ e.g. , _ ) .",
    "we find that both of these methods can produce significant errors for both synthetic data sets .",
    "consequently , we present and test a third algorithm , the global minimisation method .      one non - iterative approach that was originally proposed by and tested on synthetic data by , , and , involves expressing the divergence - free condition as an inequality . for any position on the solar disk ( except the limb ) the divergence - free condition",
    "can be written as    @xmath42    assuming that the various derivatives can be determined reliably , given the sign of @xmath43 the ambiguity can in principle be resolved by choosing the azimuthal angle such that @xmath44 satisfies equation  ( [ divb1 ] ) . if @xmath45 or @xmath46 then equation  ( [ divb1 ] ) can not be used to resolve the ambiguity .",
    "consequently , for discrete observations equation  ( [ divb1 ] ) can not be used if @xmath47 or if @xmath48 , where @xmath49 is an estimate of the measurement error in the respective derivatives .",
    "one advantage of using equation  ( [ divb1 ] ) to resolve the ambiguity is that only the sign of @xmath43 is required , not its magnitude ; note , however , that the sign and magnitude of @xmath24 and @xmath25 are required away from disk centre ( see paper  i ) .",
    "one limitation of using equation  ( [ divb1 ] ) is that the inferred divergence of the field is not exactly zero ( in general ) when approximated from discrete observations , so the inequality is not exact ( ) .    ( a ) ) .",
    "_ contours _ are the same as figure  [ synth](a ) , except that the _ green _ contour is the magnetic neutral line .",
    "areas with the correct / incorrect ambiguity resolution are _",
    "black_/_white _ ( the same convention as metcalf  _ et al .",
    ". initial configuration has @xmath50 .",
    "( b ) same as ( a ) except the initial configuration of azimuthal angles is random.,title=\"fig:\",scaledwidth=49.0% ] ( a ) ) .",
    "_ contours _ are the same as figure  [ synth](a ) , except that the _ green _ contour is the magnetic neutral line .",
    "areas with the correct / incorrect ambiguity resolution are _",
    "black_/_white _ ( the same convention as metcalf  _ et al .",
    "_ , 2006 ) .",
    "initial configuration has @xmath50 .",
    "( b ) same as ( a ) except the initial configuration of azimuthal angles is random.,title=\"fig:\",scaledwidth=49.0% ]    the algorithm proceeds as follows . at a given height each column of pixels is scanned from @xmath51 to @xmath52 , and different columns are disambiguated from @xmath53 to @xmath54 .",
    "hereafter , the indices @xmath55 , @xmath56 , and @xmath57 correspond to pixel labelling in the @xmath9- , @xmath10- , and @xmath16-directions , respectively , and @xmath58 and @xmath59 refer to the number of pixels in the @xmath9- and @xmath10-directions , respectively . for @xmath60 and @xmath61 at a given height @xmath57 we approximate the horizontal heliographic derivatives @xmath19 and @xmath20 at pixel @xmath62 with three - point finite differences using the measurements at pixels : @xmath62 , @xmath63 , and @xmath64 . at disk centre , where the heliographic and image coordinates are equivalent ,",
    "these approximations reduce to standard two - point forward finite differences . at the boundaries @xmath54 and @xmath52 the geometry of the finite differencing stencil is modified to use only pixels within the field of view . at the lower / upper height forward /",
    "backward finite differences are used to approximate the line - of - sight derivative @xmath13 using measurements from the two heights .",
    ".performance metrics for the flux tube and arcade at disk centre for the various ambiguity resolution algorithms ( with @xmath65  pixel ) .",
    "the lower height is evaluated . [ cols=\"^,^,^,^,^\",options=\"header \" , ]     the assumption made by this method is tested by using the correct solution to evaluate each of the terms in equation  ( [ divb1 ] ) with the various derivatives approximated as described above . in figures  [ inequality ] and [ inequality_tpd7 ] areas that satisfy the inequality in equation  ( [ divb1 ] ) for the correct solution are shown along with areas that violate equation  ( [ divb1 ] ) . also shown are areas which suffer from the degenerate case where equation  ( [ divb1 ] ) can not be used to distinguish the two realisations , as the sign of @xmath44 is the same for both the correct and the incorrect choice of azimuthal angle at the pixel of interest .",
    "this is the case for a large fraction of the field of view for both synthetic data sets .",
    "the method appears to do quite well in figure  [ fan_ts56](a ) and figure  [ compare_tpd7_wuai](a ) because we do not test the other realisation if the initial one satisfies equation  ( [ divb1 ] ) and we do not check that equation  ( [ divb1 ] ) is satisfied after the choice of azimuthal angle is changed .",
    "the degeneracy is partly due to the details of the implementation and could be avoided by changing the azimuthal angle in all pixels referenced by the finite differencing stencil at a particular location , rather than at a single pixel ; unfortunately , such an approach would be very sensitive to the initial configuration .",
    "_ contours _ are the same as figure  [ fan_ts56 ] .",
    "areas that satisfy / violate the wu and ai criterion , equation  ( [ divb1 ] ) , are coloured _ black_/_white_. areas for which the sign of @xmath44 is the same for both choices of the azimuthal angle are coloured _ gray_.,scaledwidth=49.0% ]    ( b ) ) ; _ black_/_white_/_gray _ indicate areas which satisfy , do not satisfy , and are degenerate to the inequality in equation  ( [ divb1 ] ) , following figure  [ inequality ] .",
    "( b ) same as ( a ) except for the second height .",
    ", title=\"fig:\",scaledwidth=49.0% ] ( b ) ) ; _ black_/_white_/_gray _ indicate areas which satisfy , do not satisfy , and are degenerate to the inequality in equation  ( [ divb1 ] ) , following figure  [ inequality ] .",
    "( b ) same as ( a ) except for the second height .",
    ", title=\"fig:\",scaledwidth=49.0% ]      presented a method which assumes that the magnitude of the divergence is minimised over the set of pixels used to approximate the divergence at a particular location .",
    "disambiguation then proceeds as a sequence of minimisation problems based at each pixel in the field of view .",
    "we apply this approach as follows . at a given height ,",
    "we examine pixels in the same order as in section  [ sec_wuai ] . for the pixels referenced by the finite differencing stencil at a particular location we choose the permutation of azimuthal angles that corresponds to the minimum of @xmath66 , the approximation for the divergence at the pixel @xmath67 .",
    "we compute the divergence using the methods described in section  [ sec_wuai ] , with all approximations made about the lower height .",
    "the azimuthal angle at each pixel is fixed by the stencil that first references it .",
    "this approach examines both permutations of the azimuthal angle at each pixel , therefore the initial configuration does not affect its performance , although it is sensitive to the order in which pixels are examined .",
    "the performance of this method is shown for the flux tube and arcade ( figure  [ compare_min_local](a ) ) . at disk centre",
    "the disambiguation at each height is independent because @xmath24 and @xmath25 are not required to compute the divergence and the approximations for horizontal heliographic derivatives involve measurements at a single height ; results for the lower height are displayed in figure  [ compare_min_local](a ) . for the multipole field positioned away from disk centre ( figures  [ compare_tpd7_min_local](a ) and ( b ) ) both heights are disambiguated simultaneously as required for off - disk - centre data .",
    "performance metrics for the lower height in each case are provided in tables  [ fan_tab ] and [ tpd7_tab ] .    .",
    "( b ) validity of the assumption made by the sequential minimisation method .",
    "areas that satisfy / violate the assumption are coloured _",
    "black_/_white_. _ contours _ are the same as ( a ) . , title=\"fig:\",scaledwidth=49.0% ] .",
    "( b ) validity of the assumption made by the sequential minimisation method .",
    "areas that satisfy / violate the assumption are coloured _",
    "black_/_white_. _ contours _ are the same as ( a ) . ,",
    "title=\"fig:\",scaledwidth=49.0% ]    ( a ) .",
    "( b ) same as ( a ) except for the second height , 1 pixel ( or @xmath31 ) above that shown in ( a ) .",
    "( c ) validity of the assumption made by the sequential minimisation method applied to the multipole field , following figure  [ compare_min_local](b ) .",
    "( d ) same as ( c ) except for the second height .",
    ", title=\"fig:\",scaledwidth=49.0% ] ( a ) .",
    "( b ) same as ( a ) except for the second height , 1 pixel ( or @xmath31 ) above that shown in ( a ) .",
    "( c ) validity of the assumption made by the sequential minimisation method applied to the multipole field , following figure  [ compare_min_local](b ) .",
    "( d ) same as ( c ) except for the second height .",
    ", title=\"fig:\",scaledwidth=49.0% ]    ( a ) .",
    "( b ) same as ( a ) except for the second height , 1 pixel ( or @xmath31 ) above that shown in ( a ) .",
    "( c ) validity of the assumption made by the sequential minimisation method applied to the multipole field , following figure  [ compare_min_local](b ) .",
    "( d ) same as ( c ) except for the second height .",
    ", title=\"fig:\",scaledwidth=49.0% ] ( a ) .",
    "( b ) same as ( a ) except for the second height , 1 pixel ( or @xmath31 ) above that shown in ( a ) .",
    "( c ) validity of the assumption made by the sequential minimisation method applied to the multipole field , following figure  [ compare_min_local](b ) .",
    "( d ) same as ( c ) except for the second height .",
    ", title=\"fig:\",scaledwidth=49.0% ]    for each pixel the ambiguity is resolved by the stencil that references it first .",
    "hence , for the pixels in a given stencil this algorithm assumes that the correct ambiguity resolution will be recovered for the unresolved pixels if the previously resolved pixels have the correct ambiguity resolution .",
    "we show areas for which this assumption is valid for both test cases in figure  [ compare_min_local](b ) and figures  [ compare_tpd7_min_local](c ) and ( d ) .",
    "evidently , this assumption is not universally valid when the divergence is approximated from discrete observations .",
    "however , the fraction of pixels that violate this assumption is smaller than the fraction that retrieve the incorrect azimuthal angle .",
    "there are two reasons that this method fails at a particular pixel : _",
    "i ) _ the assumption is incorrect ; and _ ii ) _ the propagation of an erroneous solution that originates in a region where the assumption is incorrect .",
    "propagation accounts for most of the areas with the incorrect azimuthal angle in figure  [ compare_min_local](a ) and figures  [ compare_tpd7_min_local](a ) and ( b ) .",
    "most , but not all , pixels that violate the assumption initiate the propagation of errors . also , there are pixels that violate the assumption but still retrieve the correct ambiguity resolution ; these situations can occur when the assumption is violated and a neighbouring pixel has the incorrect ambiguity resolution , allowing the algorithm to get back onto the correct solution .",
    "the algorithm described above is different from the implementation of in that they used four - point finite elements to approximate horizontal heliographic derivatives ( we note that there may also be other differences ) .",
    "we have tested other versions of this algorithm employing different approximations for the horizontal heliographic derivatives , such as four - point finite differences and finite elements .",
    "the results are very similar to those shown in figure  [ compare_min_local ] and [ compare_tpd7_min_local ] : all versions examined violate the underlying assumption at some locations and subsequently propagate errors in the solution .",
    "this method can propagate errors because it is sequential .",
    "we have tried a non - sequential approach which assumes that @xmath66 is minimised within the stencil based at each pixel regardless of the solution obtained in neighbouring pixels . for both synthetic data",
    "sets the fraction of pixels for which this assumption is violated is actually larger than for the sequential approach .",
    "therefore , we conclude that the non - sequential approach does not substantially improve the performance of this method .",
    "in this section we present an iterative , global method which is based on the approximation for the divergence summed over the entire field of view .",
    "this approach is related to the `` minimum energy '' algorithm for single - height data ( see _ e.g. , _ ; ; ; ) .",
    "we assume that the correct configuration of azimuthal angles over the field of view is the one that corresponds to the minimum of    @xmath68    equation  ( [ esb ] ) consists of two terms corresponding to the approximations for the divergence based at each of the two heights , @xmath57 and @xmath69 . for data positioned away from disk centre , where both heights are disambiguated simultaneously ,",
    "we find that algorithms based on equation  ( [ esb ] ) consistently retrieve a better solution than algorithms based on a single term . for the divergence at the first / second height",
    "the line - of - sight derivatives are approximated with forward / backward finite differences .",
    "for each of these terms the horizontal heliographic derivatives are approximated using three - point finite differences as described in section  [ sec_wuai ] .",
    "we have tested several different ways to approximate horizontal heliographic derivatives , such as four - point finite differences and three- and four - point finite elements , but these do not significantly affect the performance of the algorithm .",
    "the number of possible solutions for this optimisation problem is finite but very large , @xmath70 , making a brute - force search for the global minimum of @xmath71 impractical .",
    "one method that works well for large , discrete , global optimisation problems such as this is simulated annealing ( _ e.g. , _ ; ; ) . using simulated annealing , the global minimisation method proceeds as follows .",
    "a pixel is selected at random .",
    "if changing the azimuthal angle at that pixel reduces the value of @xmath71 then the change is always accepted .",
    "if changing the azimuthal angle increases the value of @xmath71 then the change is sometimes accepted , with a probability given by    @xmath72    where @xmath73 is the `` temperature '' and @xmath74 is the change in @xmath71 ( equation  ( [ esb ] ) ) caused by changing the azimuthal angle ; positive values of @xmath74 imply that @xmath71 increases due to the reconfiguration .",
    "the ability to sometimes accept an `` uphill '' reconfiguration enables simulated annealing to avoid getting stuck in a sub - optimal solution , provided that the cooling rate is sufficiently slow and the initial temperature is sufficiently high ( _ e.g. , _ ) .    the annealing schedule ( the initial temperature , the number of reconfigurations attempted at each temperature setting , and the cooling rate ) can require some experimentation ; in the interests of simplicity we use the following prescription . the initial temperature , @xmath75",
    ", should greatly exceed any expected value of @xmath74 . starting with the initial configuration of azimuthal angles we examine @xmath76 reconfigurations of randomly chosen pixels ( which are all accepted ) and take two times the maximum value of @xmath77 as the initial temperature .",
    "it should be noted that this process effectively randomises the initial configuration of the azimuthal angles and therefore the initial configuration does not affect the final result ( likewise , the high initial temperature further randomises the initial configuration because almost all reconfigurations will be accepted during early temperature increments ) . at each temperature setting we examine @xmath78 reconfigurations of the azimuthal angle at randomly chosen pixels .",
    "the temperature varies according to @xmath79 , where @xmath80 is the cooling rate and @xmath81 is the label of the temperature increment ; we use @xmath82 .",
    "we continue in this fashion until one of the following three conditions is satisfied : _",
    "i ) _ no reconfigurations are accepted at the most recent temperature setting ; _ ii ) _ the temperature is sufficiently low ( less than @xmath83 ) ; or _",
    "iii ) _ for ten consecutive temperature increments the value of @xmath71 does not change substantially ( _ i.e. , _",
    "@xmath84 , where @xmath85 is the value of @xmath71 at the end of temperature increment @xmath81 ) .    for the flux tube and arcade positioned at disk centre",
    ", we show the fraction of pixels correctly disambiguated by the global minimisation method , @xmath36 , as a function of the vertical grid spacing @xmath26 ( figure  [ dz_plot ] ) ; only the lower height is evaluated because the disambiguations at each height are independent at disk centre for the derivative approximations employed here .",
    "the simulation results of have a vertical grid spacing @xmath26 of @xmath30 ( equal to the horizontal grid spacing ) .",
    "for the first height we use the snapshot displayed in figure  [ synth](a ) at @xmath86 .",
    "we allow the second height to vary , using all heights in the range @xmath87 . for each setting of @xmath26",
    "we disambiguate twenty times with the algorithm described above but with a different sequence of random numbers for each disambiguation .",
    "independent disambiguations can behave differently because simulated annealing is a stochastic optimisation algorithm : the decision to move to higher @xmath71 is probabilistic ( equation  ( [ pup ] ) ) and the order in which pixels are examined is random .",
    "consequently , if the annealing schedule is not ideal ( _ e.g. , _ if the cooling rate is too fast ) the global minimum may not be found and a different answer may be obtained for a different sequence of random numbers . to ensure that the global minimum is found for real magnetogram data it may be necessary to repeat the disambiguation process multiple times with different sequences of random numbers , a slower cooling rate , and/or with more attempted reconfigurations at each temperature setting .    , as a function of vertical grid spacing @xmath26 ( in units of horizontal pixels ) for the global minimisation method with a fixed annealing schedule applied to the flux tube and arcade configuration ( figure  [ synth](a ) ) . for each setting of @xmath26",
    "twenty disambiguations are executed with different sequences of random numbers .",
    "the _ gray _ dots represent the resultant @xmath36 value for each of these disambiguations .",
    "the _ black _ line connects the median of the @xmath36 values for each @xmath26 setting and the _ gray _ lines connect the corresponding minimum and maximum of the @xmath36 values .",
    "the _ dotted _ horizontal line at @xmath88 is included for reference.,scaledwidth=49.0% ]    for the flux tube and arcade at disk centre with @xmath89  pixel the global minimisation method retrieves the correct azimuthal angle at every pixel for all twenty disambiguations with the imposed annealing schedule ( see table  [ fan_tab ] ) .",
    "several points are worth noting regarding figure  [ dz_plot ] : _ i ) _ broadly speaking , the performance decreases as @xmath26 increases . _ ii ) _ the scatter of the @xmath36 values increases as @xmath26 increases ( most noticeably for @xmath90  pixels ) .",
    "_ iii ) _ for @xmath91  pixels the correct solution is no longer found for all twenty disambiguations .",
    "the maximum of the @xmath36 values is one at this point so the correct solution could be obtained simply by disambiguating multiple times and selecting the solution with the smallest value of @xmath71 . _",
    "iv ) _ the point where the maximum of the @xmath36 values deviates from one is @xmath92  pixels . beyond this point ,",
    "a perfectly correct solution is not obtained for any of the twenty disambiguations with the imposed annealing schedule , yet for the largest values of @xmath26 the median value for @xmath36 is still greater than 0.99 .",
    "pixels , following figure  [ fan_ts56 ] .",
    "( a ) the solution retrieved with the best @xmath36 value .",
    "( b ) the solution retrieved with the worst @xmath36 value .",
    ", title=\"fig:\",scaledwidth=49.0% ]  pixels , following figure  [ fan_ts56 ] .",
    "( a ) the solution retrieved with the best @xmath36 value .",
    "( b ) the solution retrieved with the worst @xmath36 value .",
    ", title=\"fig:\",scaledwidth=49.0% ]    for large values of @xmath26 the difference between the best and worst solutions retrieved by the global minimisation method can be significant ( figure  [ compare_fan_me ] ) .",
    "the main cause of such deviations is the annealing schedule .",
    "we have conducted experiments that show that more consistent and better results can be obtained at large values of @xmath26 with annealing schedules that involve slower cooling rates or more attempted reconfigurations at each temperature setting .    for the multipole field positioned away from disk centre the variation of @xmath36 as a function of the line - of - sight grid spacing @xmath26 is shown ( figure  [ dz_plot2 ] ) ; both heights are disambiguated simultaneously as required for off - disk - centre data .",
    "for the first height we use the field displayed in figure  [ synth](b ) .",
    "we allow the second height to vary in increments along the line - of - sight direction corresponding to the horizontal pixel size , @xmath31 .",
    "of the twenty disambiguations with @xmath65  pixel , only two solutions obtained @xmath88 for both heights ( see table  [ tpd7_tab ] ) ; the remainder of solutions obtained @xmath93 or better at each height .",
    "the performance of the global minimisation method applied to the multipole field configuration ( figure  [ dz_plot2 ] ) degrades more rapidly as @xmath26 increases than it does for the flux tube and arcade ( figure  [ dz_plot ] ) .",
    "this is partly because the optimisation problem for data positioned away from disk centre is substantially more challenging , as both heights must be disambiguated simultaneously .",
    "differences in the variation of the two fields with height may also contribute to the contrasting performance .",
    "the synthetic data for the multipole field configuration include the effects of curvature but we have not included curvature in the treatment of the divergence ( equations  ( [ divb2 ] ) and ( [ da ] ) ) .",
    "experiments with two synthetic data sets that have the same field configuration but include and exclude curvature indicate that curvature does not significantly influence the performance of the global minimisation algorithm , provided that the field of view is much smaller than the radius of curvature of the sun .    in figure  [ dz_plot2 ]",
    ", we see that for some values of @xmath26 larger than 31  pixels ( _ red _ dots in figure  [ dz_plot2 ] ) , the algorithm retrieves solutions with @xmath71 less than that for the correct solution .",
    "thus , the assumption that the correct solution corresponds to the configuration of azimuthal angles that minimises @xmath71 ( equation  ( [ esb ] ) ) is violated in these cases . nevertheless , the performance of the resulting solutions is quite good , with @xmath36 values greater than 0.99 at both heights ( see _ e.g. , _",
    "figure  [ compare_tpd7_2 ] ) . for @xmath26 larger than",
    "53  pixels no such solutions are found , which probably indicates that the fixed annealing schedule employed here is less than ideal for large values of @xmath26 .",
    ", as a function of vertical grid spacing @xmath26 ( in units of horizontal pixels ) for the global minimisation method with a fixed annealing schedule applied to the multipole field configuration in figure  [ synth](b ) , following figure  [ dz_plot ] .",
    "the _ red _ dots represent the @xmath36 values for each of the disambiguations that retrieved a solution with @xmath71 less than that for the correct solution .",
    "( b ) same as ( a ) except for the second height .",
    ", title=\"fig:\",scaledwidth=49.0% ] , as a function of vertical grid spacing @xmath26 ( in units of horizontal pixels ) for the global minimisation method with a fixed annealing schedule applied to the multipole field configuration in figure  [ synth](b ) , following figure  [ dz_plot ] .",
    "the _ red _ dots represent the @xmath36 values for each of the disambiguations that retrieved a solution with @xmath71 less than that for the correct solution .",
    "( b ) same as ( a ) except for the second height .",
    ", title=\"fig:\",scaledwidth=49.0% ]    results for a case where the retrieved solution has @xmath71 less than that for the correct solution are shown for the multipole configuration with @xmath94  pixels ( figure  [ compare_tpd7_2 ] ) .",
    "interestingly areas that fail occur at different locations at each height ; this situation is fairly typical for @xmath95  pixels . for smaller values of @xmath26 incorrect regions tend to occur at similar locations at both heights .",
    "pixels , following figure  [ compare_tpd7_wuai](a ) . for this particular case @xmath71 for the retrieved solution is less than that for the correct solution .",
    "( b ) same as ( a ) except for the second height , 50 pixels above that shown in ( a ) .",
    ", title=\"fig:\",scaledwidth=49.0% ]  pixels , following figure  [ compare_tpd7_wuai](a ) . for this particular case @xmath71 for the retrieved solution is less than that for the correct solution .",
    "( b ) same as ( a ) except for the second height , 50 pixels above that shown in ( a ) .",
    ", title=\"fig:\",scaledwidth=49.0% ]    for the flux tube and arcade we have not found a solution for which @xmath71 is less than that for the correct solution , in the case where the horizontal resolution is fixed but the vertical resolution varies ( figure  [ dz_plot ] ) . we find that this situation does arise for the flux tube and arcade when both the horizontal and vertical sampling are about a factor of seven times coarser than on the original grid .",
    "clearly , the validity of the underlying assumption made by the global minimisation method  that the correct configuration of azimuthal angles corresponds to the minimum value of @xmath71  is sensitive to the spatial resolution of the observations .",
    "this suggests that for real magnetogram data ( that may contain noise and/or unresolved structure ) additional constraints or criteria may be required to determine if the global minimum corresponds to the correct solution .",
    "it may also be possible to use measurement error information to determine the uncertainties associated with the configuration corresponding to the global minimum .",
    "we investigate how the divergence - free property of magnetic fields can be exploited to resolve the azimuthal ambiguity that is present in solar vector magnetogram data by using line - of - sight and horizontal heliographic derivative information approximated from discrete measurements . using synthetic data we test several methods that each make different assumptions about how to use the divergence to resolve the ambiguity .",
    "we find that all of the assumptions considered can be violated when the divergence is approximated from discrete measurements ( depending on the nature of the field and the resolution of the observations ) , but some assumptions are more robust than others .",
    "the @xcite criterion expresses the divergence - free condition as an inequality ( _ e.g. , _ ; ; ; ) .",
    "we find that methods based on this criterion are very sensitive to the smoothness of the initial configuration of azimuthal angles and the order in which pixels are examined .",
    "in addition , the underlying assumption can be incorrect over a significant fraction of the field of view when derivatives are approximated from discrete measurements .",
    "the sequential minimisation method ( ) assumes that the magnitude of the divergence is minimised over the pixels used to approximate the divergence at each point .",
    "our tests indicate that this approach is more robust than the @xcite criterion but can produce errors when the underlying assumption is violated .",
    "moreover , the algorithm can propagate erroneous solutions into regions that do not violate the underlying assumption .",
    "we find that the most promising algorithm is the global minimisation method which assumes that the correct configuration of azimuthal angles corresponds to the minimum of the magnitude of the divergence summed over the entire field of view .",
    "this method relies on the magnitude of the divergence .",
    "therefore , with this method , the _ sign and magnitude _ of the line - of - sight derivatives of all three components of the magnetic field vector are required to resolve the azimuthal ambiguity away from disk centre .    for the synthetic data employed here , the field is sampled at discrete spatial locations where the exact value of the field is provided .",
    "thus , the effects of noise and unresolved structure in both the horizontal heliographic and line - of - sight directions are neglected .",
    "the performance of the global minimisation method is very promising , but before this approach can be reliably applied to real magnetogram data its performance should be tested with more realistic synthetic data that include the effects of noise and unresolved structure ( _ e.g. , _ ) .",
    "the authors would like to thank yuhong fan for providing one of the synthetic data sets used in this investigation .",
    "this work was supported by funding from nasa under contracts nnh05cc75c and nnh09ce60c .",
    "boulmezaoud , t.z . ,",
    "amari , t. : 1999 , _ astron .",
    "astrophs . _ * 347 * , 1005 .",
    "chiu , y.t . ,",
    "hilton , h.h . : 1977 , _ astrophys .",
    "j. _ * 212 * , 873 .",
    "collados , m. , martnez pillet , v. , ruiz cobo , b. , del toro iniesta , j.c . ,",
    "vzquez , m. : 1994 , _ astron .",
    "astrophs . _ * 291 * , 622 .",
    "crouch , a.d .",
    ", barnes , g. : 2008 , _ solar phys . _",
    "* 247 * , 25 , paper  i. cuperman , s. , li , j. , semel , m. : 1993 , _ astron .",
    "_ * 278 * , 279 .",
    "del toro iniesta , j.  c. , ruiz cobo , b. : 1996 , _ solar phys . _",
    "* 164 * , 169 .",
    "eibe , m.t . ,",
    "aulanier , g. , faurobert , m. , mein , p. , malherbe , j.m . : 2002 , _ astron",
    ". astrophs . _",
    "* 381 * , 290 .",
    "fan , y. , gibson , s.  e. : 2004 , _ astrophys .",
    "j. _ * 609 * , 1123 .",
    "gary , g.a . , hagyard , m.j . : 1990 , _ solar phys .",
    "_ * 126 * , 21 .",
    "geman , s. , geman , d. : 1984 , _ ieee transactions on pattern analysis and machine intelligence _ * 6 * , 721 .",
    "harvey , j.w . : 1969 , ph.d .  thesis .",
    "kirkpatrick , s. , gelatt , c.d . ,",
    "vecchi , m.p . : 1983 , _ science _ * 220 * , 671 .",
    "leka , k.d . ,",
    "metcalf , t.r . : 2003 , _ solar phys . _",
    "* 212 * , 361 .",
    "leka , k.d . ,",
    "barnes , g. , crouch , a.d .",
    ": 2009 , in:_second hinode science meeting .",
    "_ in press .",
    "leka , k.d . ,",
    "barnes , g. , crouch , a.d . , metcalf , t.r . ,",
    "gary , g.a .",
    ", jing , j. , liu , y. : 2009 , _ solar phys .",
    "_ in press .",
    "li , j. , amari , t. , fan , y. : 2007 , _ astrophys . j. _ * 654 * , 675 .",
    "li , j. , cuperman , s. , semel , m. : 1993 , _ astron .",
    "astrophs . _ * 279 * , 214 .",
    "liu , y. , wang , j. , yan , y. , ai , g. : 1996 , _ solar phys . _ * 169 * , 79 .",
    "maltby , p. , avrett , e.h . , carlsson , m. , kjeldseth - moe , o. , kurucz , r.l .",
    ", loeser , r. : 1986 , _ astrophys .",
    "j. _ * 306 * , 284 .",
    "metcalf , t.r .",
    ": 1994 , _ solar phys . _",
    "* 155 * , 235 .",
    "metcalf , t.r . ,",
    "jiao , l. , mcclymont , a.n . ,",
    "canfield , r.c .",
    ", uitenbroek , h. : 1995 , _ astrophys .",
    "j. _ * 439 * , 474 .",
    "metcalf , t.r .",
    ", leka , k.d.,barnes , g. , lites , b.w . ,",
    "georgoulis , m.k . ,",
    "pevtsov , a.a . , _",
    ": 2006 , _ solar phys . _ * 237 * , 267 .",
    "metropolis , n. , rosenbluth , a. , rosenbluth , m. , teller , a. , teller e. : 1953 _ j chem .",
    "* 21 * , 1087 .",
    "press , w.h . ,",
    "teukolsky , s.a .",
    ", vetterling , w.t . , flannery , b.p .",
    ": 1992 , numerical recipes in fortran , 2nd edition , cambridge university press , cambridge , p. 436 .",
    "ruiz cobo , b. , del toro iniesta , j.c . : 1992 , _ astrophys .",
    "j. _ * 398 * , 375 .",
    "socas - navarro , h. : 2004 , _ astrophys .",
    "j. _ * 614 * , 457 .",
    "socas - navarro , h. : 2005 , _ astrophys .",
    "j. _ * 631 * , l167 .",
    "socas - navarro , h. : 2007 , _ astrophys .",
    "j. suppl . _",
    "* 169 * , 439 .",
    "socas - navarro , h. , trujillo bueno , j. , ruiz cobo , b. : 2000 , _ astrophys . j. _ * 530 * , 977 .",
    "vernazza , j.e . ,",
    "avrett , e.h . , loeser , r. : 1981 , _ astrophys . j. suppl . _ * 45 * , 635 .",
    "westendorp plaza , c. , del toro iniesta , j.c . , ruiz cobo , b. , martnez pillet , v. , lites , b.w . , and skumanich , a. : 1998 , _ astrophys . j. _ * 494 * , 453 .",
    "westendorp plaza , c. , del toro iniesta , j.c .",
    ", ruiz cobo , b. , martnez pillet , v. , lites , b.w . , and skumanich , a. : 2001 , _ astrophys .",
    "j. _ * 547 * , 1130 .",
    "wu , l. , ai , g. : 1990 , _ acta astrophysica sinica _ * 10 * , 371 ."
  ],
  "abstract_text": [
    "<S> we investigate how the divergence - free property of magnetic fields can be exploited to resolve the azimuthal ambiguity present in solar vector magnetogram data , by using line - of - sight and horizontal heliographic derivative information as approximated from discrete measurements . using synthetic data we test several methods that each make different assumptions about how the divergence - free property can be used to resolve the ambiguity . </S>",
    "<S> we find that the most robust algorithm involves the minimisation of the absolute value of the divergence summed over the entire field of view . </S>",
    "<S> away from disk centre this method requires the sign and magnitude of the line - of - sight derivatives of all three components of the magnetic field vector . </S>"
  ]
}