{
  "article_text": [
    "the concept of photometric redshift estimation is over four decades old . since @xcite",
    "the methodology has changed only incrementally but its role in astronomy has completely spun around .",
    "the astronomy community originally received the idea with serious skepticism , which , over time , thanks to a series of breakthroughs in the field ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) , slowly faded . today",
    "the next generation telescopes plan to perform photometric observations only , and completely rely on these kind of estimation techniques for most of their key science projects including cosmology and large - scale structure .",
    "while getting ready for extracting most of our new scientific knowledge from photometric measurements , we have to examine the current limitations of the various techniques and understand the underlying assumptions .",
    "essentially all currently existing implementation can be categorized into two classes of methods : empirical estimators and template fitting .",
    "reviewing the history of the research area is outside the scope this study ; see @xcite for a rich cross section of the field instead ; now we look at the basic concepts and the differences in the traditional methodologies .",
    "empirical methods map the relation of the observed and desired properties using a training set ; e.g. , piecewise linear or polynomial fitting , or via other regression methods like artificial neural nets , support vector machines , etc .",
    "template - fitting techniques rely on prior knowledge encoded in the model s spectral energy distributions ( seds ) that can be matched to observations .",
    "why are the current implementations of these two so different ?",
    "there is no fundamental reason , e.g. , one could generate training sets from model templates .",
    "why do only template - fitting algorithms use photometric uncertainties and not the empirical ones ? why do people estimate the redshifts independently from other physical properties , e.g. , often use empirical redshift estimates and then template spectra for type determination ? we know",
    "these quantities are correlated and should be dealt with in a consistent way . the answers to these questions",
    "are usually direct consequences of limitations in the models and the measurements .",
    "if the model seds matched all the observations , we would know everything about all the objects in the universe .",
    "the uncertainties would be used more often if they provided reliable extra information .",
    "the `` photo - z '' label currently associated with the above methods , should gain a new meaning .",
    "we should expect more from the codes than a single estimate per object . the implementations need to provide the full joint probability density functions of all desired physical parameters ,",
    "so we can develop new statistical tools that utilize all the information available .    in this paper",
    ", we are not concerned with what observables are the best to use or which filter set is optimal for special cases of the generalized photometric inversion problem , which depend on the specific science cases , instead we derive a probabilistic formalism to address the common issues . in section  [",
    "sec : method ] , we introduce the methodology and derive the formulas for determining the photometric constraints on physical properties . section  [ sec : models ] , describes the traditional empirical and template - fitting algorithms as special cases of the proposed framework , and the advanced techniques that go beyond their limits . in section  [ sec : disc ] , we illustrate the concepts and detail the practical aspects . section  [ sec : sum ] concludes our study .    throughout the paper ,",
    "we use the capital @xmath0 letter for probabilities and the lower - case @xmath1 letter for probability density functions , or pdfs for short .",
    "we start by formulating the problem as general as possible .",
    "the challenge is to constrain physical properties of sources with some observables in a data set denoted by @xmath2 , hereafter the query set .",
    "since model spectra would never be perfectly suitable for all desired parameters , one will need a training set , @xmath3 .",
    "in fact there is no reason to demand that these data sets have the same observables .",
    "the mapping is provided by some model , @xmath4 .",
    "for example , magnitudes of different photometric systems can be mapped on to one another , say , @xmath5 observations to @xmath6 @xcite by empirical formulas . in general , let @xmath7 be a set of observables in the training set @xmath3 that also contains extra information about the physical properties @xmath8 , and let @xmath9 denote the observables of the query set @xmath2 .",
    "our model is parameterized by a vector @xmath10 ; @xmath11 the model @xmath4 can predict the observables @xmath7 and @xmath9 for a given parameter via the density @xmath12 and has a prior on its parameters @xmath13 .",
    "for example , one can build models based on the @xcite or @xcite templates that can be used to calculate the colors of sources at a given redshift in any particular photometric system .",
    "however , the modeling goes beyond just estimating the values for a given parameter , because the observational uncertainties also enter the formula .",
    "later on , we will discuss in details how to establish various models ; for now , the above functions are assumed to be known .",
    "furthermore , let us assume that the training set samples the entire space of the observables , and discuss the selection effects later .",
    "our goal is to derive the probability density function ( pdf ) of the physical properties @xmath8 for a given query point @xmath14 with @xmath15 observations using our model @xmath4 .",
    "this function , @xmath16 , is the solution of the generalized photometric inversion problem and the subject of this section .",
    "the next two paragraphs discuss probabilistic concepts analogous to elements of template fitting and empirical estimation , respectively , in the context of our probabilistic formalism .",
    "next we address the burning issues of selection effects and feasibility .",
    "the first step is to make the connection between the observables .",
    "it can be done formally by calculating the probability density of @xmath7 for the query point @xmath14 .",
    "we do this via the equality of @xmath17 where the right - hand side contains integrals of known functions over the model s parameter domain @xmath18 and over @xmath7 for the marginalization @xmath19 we see how this is superior to the techniques analogous to the traditional way .",
    "the usual solution involves fitting for the best - match model parameter using , for example , maximum likelihood estimation ( mle ) , and accepting that parameter at face value to derive the estimates . here",
    ", we consider all possible model parameters and add up their contributions .",
    "we note that the above general mapping formula is valid in case of improper priors , too , in the sense that the posterior is always properly normalized to unity . if one has no prior knowledge about the model parameters , and wishes to use a noninformative prior , e.g. , flat , formally he / she is allowed to do so ; see more on the priors later on .",
    "next we establish the relation between the observable and the desired physical parameters .",
    "the traditional way is to assume the properties of interest to be a function of the observables .",
    "some of the existing methods utilize explicit functions such as a polynomial or piecewise linear , while others use more obscure mappings such as a decision tree or an artificial neural net .",
    "conceptually , they are just assuming a fitting function @xmath20 which is tuned to reproduce the elements of the training set as best as possible .",
    "the problem with this assumption is that there is no guarantee that the same @xmath7 observables always correspond to the same @xmath8 properties .",
    "in fact , we know that degeneracies are present in most data sets . clearly , the above assumption is an unnecessary restriction over the general relation of @xmath7 and @xmath8 denoted by @xmath21 . in other words",
    ", the traditional model is @xmath22 using dirac s @xmath23 symbol .",
    "a better way is not to restrict the distribution arbitrarily to an unknown surface but to leave the formula general .",
    "we can establish the proper relation by observing the fact that @xmath24 the right - hand side is a ratio of two densities that ( both ) can be estimated from the training set , e.g. , using voronoi tessellation or kernel density estimation ( kde ) .    having derived the above relation",
    ", one can compute the final pdf of interest as the integral over the possible observables in the training set @xmath25 when it is possible to accurately characterize this distribution by a gaussian function or some mixture model , one can compress the numerical results into a few parameters . when the pdf is unimodal , which is often not the case , the expectation value should suffice for an estimate @xmath26 the above equation is similar to kernel regression @xcite in case of using kde , except it is a generalization to incorporate the uncertainties in the data sets .",
    "photometric redshifts and other such properties are often used in statistical studies for their availability for a large number of sources , even though they provide relatively loose constraints on individual objects .",
    "the full pdfs of the sources are best suited to derive the ensemble properties of entire catalogs or even specific subsamples .",
    "the distribution of the properties over a set of measurements @xmath2 is given by the average @xmath27 hence there is no need for an extra deconvolution step to recover the underlying distribution of the objects in a sample , because their average pdf is exactly that .",
    "a common example is the estimation of the redshift distribution @xmath28 for various subsamples , say , at different distances .",
    "when selection bias is not an issue for the scientific analysis , e.g. , lensing studies , one can even choose the subsets to optimize the contrast of the averaged pdfs .",
    "the inherent limitations of a finite training set pose a serious problem for any estimator , which is often neglected .",
    "our formalism introduced earlier is no exception , hence we now turn to examine the effects .",
    "the selection function is the probability of a source , with observables @xmath7 making it into the training set , @xmath29 .",
    "the region that the training set can sample is the window function @xmath30 , which takes the value of 1 where the selection function is nonzero , and 0 otherwise .",
    "for example , @xmath31 for a survey that has a magnitude limit of 22 in a @xmath32 band .",
    "the selection function is expected to enter our method at two separate places : the marginalization over @xmath7 and via the density estimates used for the relation @xmath21 .",
    "the former appears to be inevitable but causes problems only at the boundaries of the selection criteria .",
    "if the integrand @xmath33 in equation  ( [ eq : pz ] ) vanishes within the integration domain of the window function @xmath30 , the results are valid .",
    "otherwise the estimated pdf is biased in an unknown way .",
    "the probability of @xmath14 being inside the window function is the right indicator of the problem occurring @xmath34 when this probability is close to 1 , the training set provides good support for the photometric inversion problem , but when the value is low , the query point is known to be outside the regime of the training set .",
    "the relation between the desired properties and the observables is the other issue as it is only probed on the training set .",
    "the relation as seen on the training set depends on the true relation and the selection function via the equation @xmath35 if the selection function strictly depends only on @xmath7 , we have @xmath36 and find that the empirical relation is identical to the true one on the selection domain . if the sampling frequency is low , the measured relation is noisier and less robust numerically .",
    "this is a critical point , which is worth emphasizing once again : the @xmath37 equality holds only if @xmath8 does not influence the selection in any way , not even indirectly via some hidden parameter .",
    "a counter example is the common case of cutting on morphological parameters in the selection function , while only considering the fluxes for @xmath7 .",
    "another interesting consequence is that one can not use only the colors to estimate , say , photometric redshifts , if a magnitude cut was involved in the selection of the training set .",
    "yet another issue is cosmic variance , which might cause the relation to depend on the position in the sky .",
    "the solution in all cases is to revise the selection of the training set , if possible , or to add the hidden observables into @xmath7 , and extend the model to include them .",
    "previously we have hinted at how models can be constructed but , until now , they have just been assumed to be known . a model is a combination of the limitations in our observations , both in the training and query sets , and the parameterization of the observables . from discussing the topic in the most general way",
    ", we now turn to the practicalities of real - life astronomical observations",
    ".    today the errors of extracted fluxes of photometric measurements are independent estimates of the uncertainties in the separate passbands .",
    "typically , gaussian errors are assumed , and the catalogs would quote 1@xmath38 values for every source . analyzing the repeated observations in the sloan digital sky survey ( sdss ;",
    "* ) , @xcite have shown that this simple picture is wrong , and the off - diagonal elements of the covariance matrix are significant .",
    "this is not surprising .",
    "one of the major components in the photometric uncertainty is the error in the determination of the aperture . if the multicolor measurements share a common aperture , e.g. , sdss model magnitudes that are best suited for colors , the flux measurements will be inevitably correlated .",
    "thus an improved error model of the photometric observations is described by a multivariate normal distribution , @xmath39 , with a mean of @xmath40 and covariance matrix @xmath41 .",
    "the next generation survey telescopes that plan to visit the sources on multiple occasions will be able to better determine the full covariance matrices from actual observations to improve our understanding of the errors .",
    "hence , for now it is general enough to consider error estimates that are fully described by the covariances .    in this reasonable approximation ,",
    "the @xmath12 mapping is also a normal distribution with a full covariance matrix that includes cross - catalog terms , if necessary , that go beyond the calibration work on the individual catalogs .",
    "if the apertures are locked together for better color determination , one has to obtain the dependencies via a data set that contains sources with all @xmath7 and @xmath9 measurements .",
    "however , when the processing pipelines are independent , one can assume that the uncertainties in @xmath7 and @xmath9 are also independent , and write a realistic @xmath4 as the product of the two gaussians : @xmath42 the dependences in the means @xmath43 and @xmath44 are straightforward to model and , even in the most complicated case , are similar , in spirit , to the traditional template - fitting procedures . for example , when considering a synthetic model of galaxies , one has to vary the redshift , age , optical depth , and so on , to derive high - resolution model spectra for different parameters , and then convolve them with the broadband filters to get the fluxes .",
    "clearly modeling the covariance matrices is more complicated and would require many more parameters to model accurately",
    ". if @xmath10 is a minimal set of parameters that is enough to describe @xmath43 and @xmath44 , there are some other hidden parameters or hyperparameters that are also needed for the covariances .",
    "the fully bayesian way is to establish the relation of the covariance matrix and the hyperparameters along with a hyperprior ( the prior on the hyperparameters ) , and to marginalize over the extra dependence . even though , this relation between the elements of the covariance matrix and the observables could , in principle , be modeled based on the catalogs , it may prove impractical .",
    "the empirical bayes approach , admittedly more optimistic but easily quantifiable , is to find the most likely hyperparameter and substitute it into the dependence . in practice ,",
    "for every parameter @xmath10 , one can find the values of @xmath43 and @xmath44 and the closest measurement points , whose covariance matrices are good estimates .",
    "if the covariance matrix changes slowly with @xmath7 compared to its widths , one can safely calculate the values at the catalog points by using the corresponding error matrices , @xmath45 the only concern with this approximation is the noise on the elements of the covariance .",
    "if needed , one could improve on the stability by smoothing or fitting locally over the catalog entries .",
    "the consequences of the model approximation in equation  ( [ eq : normal ] ) are most intriguing from the implementation aspect of the methodology . as long as we only evaluate the pdfs at the observed locations , the calculations are more straightforward and computationally less expensive .",
    "the field of numerical evaluation of complicated multidimensional integrals that usually emerge in bayesian analysis such as ours is well studied .",
    "the solution typically involves some randomized algorithms that range from simple direct sampling from the prior to adaptive strategies often based on markov chain monte carlo ( mcmc ) methods , e.g. , gibbs sampling .",
    "although this topic is beyond the scope of the present discussion , we briefly touch on the basic idea to illustrate the concepts and provide some insight on how to derive the final results numerically , namely the value of @xmath46 and the function @xmath16 .",
    "the clever construction of the chain in the mcmc algorithm yields model parameters @xmath47 that can be considered independent random realization drawn from the posterior distribution , @xmath48 in our case . with the chain in hand , one can readily approximate the integral by the average over the mcmc samples .",
    "the mapping of the observables then becomes @xmath49 where @xmath50 is the index of the training point @xmath51 closest to @xmath52 .",
    "when the query point is well within the regime of the training set , this approximation is valid .",
    "what happens otherwise ? often the uncertainties are larger outside the selection criteria , e.g. , the photometric errors beyond the flux limit . by using the covariance matrix of the closest training point ,",
    "one actually artificially decreases the contribution to the integral making @xmath33 tighter .",
    "while the accuracy of the calculation is affected , the change is such that it reduces the value of the integral in @xmath46 , which is the measure of reliability .",
    "hence , if we measure a large value , we can be confident of the result .",
    "having said that we note that in practice the covariances probably do not change fast enough to pose a significant problem in this calculation for the objects along the edge of the selection function , and farther away the probabilities are very small anyway .",
    "once we know that the estimation is in the safe regime , we can compute the @xmath16 integral ignoring the window function completely by summing up at preset @xmath53 points in our region of interest , e.g. , a fine redshift grid , as @xmath54 where the @xmath55 densities and the matrix @xmath56 are obtained from the numerical density estimates once for the training set ; see equation  ( [ eq : zx ] ) . here , we made use of the fact that the @xmath57 points are ( naturally ) drawn from the distribution @xmath58 .    in order to perform these summations efficiently for many query points , one has to utilize fast searching mechanisms in the space of the observables .",
    "the situation is complicated by the strong correlation in the observables and the varying mahalanobis metric , yet , a significant speedup can be achieved by adequate multidimensional indexing of the color  space as described in @xcite .      in classical sed - fitting approaches",
    ", one does not technically have a training set .",
    "although , formally it can be generated from a grid of model parameters @xmath59 as , where @xmath60 is often simply a subset of @xmath10 , e.g. , the redshift is just one of the parameters in the models of seds .",
    "traditionally , this artificial training set has no errors associated with the reference points , hence we have @xmath61 and , assuming @xmath43 has an inverse , @xmath62 the analytical calculation yields an intuitive result , where the grid points are weighted by their likelihood multiplied by the corresponding prior @xmath63 in the limit of a flat prior , this is the classic mle case , which is equivalent to the @xmath64 minimization techniques used in most sed - fitting implementations today , where the measurements are compared to the simulated observations at the grid points to select the optimum .",
    "one obvious exception is the algorithm of @xcite , which actually applies an explicit empirical redshift prior in this equation , hence it is often referred to as `` bayesian . ''",
    "the selection of a set of templates is another simple prior but on the spectral type , even if well hidden , implicit , and not often admitted .",
    "researchers routinely seek for templates that provide the best redshift estimates . strictly speaking ,",
    "this is cheating .",
    "the selection should be based on how well the templates represent the data in the space of the observables , and not based on their performance in the estimation .",
    "naturally , there is a connection , but not in that direction .",
    "the templates that follow the data will likely provide better estimates ; however , templates that yield good estimates are not guaranteed to match the data .",
    "the development of a class of methods by @xcite and @xcite can be considered early attempts to achieve a better sed prior . here , the templates are statistically modified to represent the observations more accurately , while not optimized for redshift estimation whatsoever .",
    "clearly , these are just the first steps in this direction . instead of just assigning 1 and 0 weights to the templates by either including them or not ( respectively ) as typically done today",
    ", one can explicitly formalize more realistic priors over a broader range of seds that are driven by scientific knowledge and/or ensemble statistics .",
    "an obvious but rather important improvement in the new framework is the ability to naturally introduce and utilize the uncertainties of the template spectra .",
    "we know that the models are not perfect , and this can be easily characterized . as an example",
    ", one can use the same prescription for the spectral synthesis , but build on a various stellar libraries to analyze the differences . when using empirical templates , the implementation is even more evident .",
    "we fold in the uncertainties by abandoning the simplified relation in equation  ( [ eq : diracx ] ) and creating a more realistic model with the estimated finite errors .      the new methodology in the limit of the classic empirical algorithms goes well beyond the usual techniques , which consist of simply establishing the fitting function in equation  ( [ eq : fit ] ) .",
    "we can utilize those fits ( or preferably estimate the densities numerically to map the full relation ) , but we can also properly consider the uncertainties .",
    "the parameterization of a minimalist model is done by a position in the space of the observables , i.e. , @xmath10 is the same type of quantity as @xmath7 and @xmath9 , e.g. , @xmath65 fluxes .",
    "namely , we choose and .",
    "even though the observables in @xmath7 and @xmath9 are the same quantities , the mapping is still required to fold in the photometric errors . with an improper flat prior @xmath66 , the mapping of the observables is integrated analytically @xmath67 while this model is clearly very simple , it is quite powerful and conceptually more sound than a number of traditional methods .",
    "we will use it for illustrations in the upcoming discussions .",
    "other simple forms of priors can also be handled analytically , e.g. , linear and gaussian , that may be reasonable approximations at least locally .",
    "otherwise we resort to the numerical evaluation .",
    "the problem with the classic empirical methods is the requirement of having the same set of observables for both the training and the query sets .",
    "the limitations of the sed - fitting techniques come from the fact that the models can not perfectly describe the relation of observables and the physical properties .    in the realm of our unified framework , we can have more advanced methods that combine these two previously separate classes of techniques .",
    "we can introduce new algorithms to take advantage of the training points even if their photometric observables differ from those in the query set .",
    "the idea is the following : true to the spirit of empirical methods , we utilize the training set to provide the relation between the physical properties we wish to constrain and some observables ; see equation  ( [ eq : zx ] ) .",
    "in addition to this empirical relation , we apply a mapping from the observables of the query set to that of the training set based on sed modeling , like in the template fitting procedures .",
    "for example , if the training set contains @xmath5 magnitudes , one can map them to @xmath6 using equation  ( [ eq : xy ] ) .",
    "the intriguing observation to make here is that one does not even need realistic physical models to start with , because the physics is in the training set and not the model .",
    "let us consider a model @xmath4 , which is a complete basis on the observed wavelength range , e.g. , legendre polynomials or fourier series with the parameterization by their coefficients .",
    "the manifold of the physical spectra is naturally contained within . in practice , this model needs to be only sufficiently complete and band - limited so that real seds can be well described ; this is a weak prior that we can set up based on all the spectra we observed and simulated before .",
    "a model spectrum corresponding to a certain parameter value in @xmath4 can be convolved with the appropriate transmission curves to yield the observables @xmath43 and @xmath44 , even if they are unphysical . hence",
    ", formally we have the basis of our mapping , @xmath12 .",
    "as long as the data provide good enough constraints on the model parameters , the mapping is valid and the algorithm follows the routine .",
    "when the observations barely constrain the model parameters and large volumes of unphysical seds have significant likelihood , the mapping will be wrong .",
    "the solution is to apply a prior to consider only the physical seds .",
    "using the entire catalog , one can derive an empirical physical prior statistically , which we will discuss in the next section .",
    "these new advanced methods overcome the usual difficulties in photometric redshift estimation , and offer a way out of the half - century - old dilemma .",
    "they are a natural extension of everything that has worked before in the field : a straightforward combination of the two previously separate methodologies .",
    "next we demonstrate the new framework in action by applying a simple model to real - life data , which is followed by discussions of the qualities of training sets and the prior .      to illustrate the concepts introduced earlier , we apply the aforementioned minimalist empirical model to a sample of galaxies .",
    "we choose sdss sources for their well - studied photometric uncertainties .",
    "following @xcite , we estimate the full covariance matrix for all objects , and utilize them in the subsequent analysis .",
    "we randomly select a quarter of the entire main galaxy sample ( mgs ; * ? ? ?",
    "* ) of dr6 to be the training set , roughly 100 thousand objects .",
    "our query set is a smaller disjoint random subset for illustration purposes .",
    "first , we map the observables ( magnitudes to magnitudes ) analytically using our simple model in equation  ( [ eq : emp_map ] ) .",
    "the calculation is done inside the dr6 database by sql user - defined functions .",
    "next , we compute the conditional pdfs by a dual - tree kde implementation @xcite at preset locations defined by the @xmath3 training and @xmath2 query sets in magnitude space and a uniform high - resolution redshift grid . the practical complication with any density estimation is the fact that it is scale - dependent and changes with the metric .",
    "we are further limited in our applications to fix bandwidths for the conditional density estimation in the current implementation of the estimator .",
    "we adopt a bandwidth of @xmath68 in a metric that scales the magnitudes to the redshift . in other words , the resolution in redshift space is set by @xmath69 , the full width half maximum of the normal distributions , and we re - scale the magnitudes by a factor of @xmath70 to reasonably match the density of the sources in the separate subspaces .",
    "this simple technique is expected perform reasonably well within the regime where the sources are suitably dense but not in the outskirts where a larger variable bandwidth is needed in magnitude space .",
    "the theory of more sophisticated conditional density estimation is well - studied ( e.g. , * ? ? ?",
    "* ) , and advanced adaptive implementations are in the works to help out ( lee & gray , 2008 ; private communication ) .    figure  [ fig : pdf ] illustrates the nature of the @xmath71 relation , in this case the multicolor measurements and redshift @xmath72 , as well as the final redshift distribution , @xmath73 , incorporating the photometric uncertainties in our model .",
    "we see that the redshift is really not a simple function of the magnitudes but rather a more general relation .",
    "this is even more so for observables that constrain the physical properties less than the @xmath6 measurements .",
    "the relation itself ( shown as a dotted line ) might provide an overly optimistic view of the uncertainties at times and usually much noisier than the final pdf ( shown in solid ) that sums up these relations with appropriate weights .",
    "the top panels show intrinsically red galaxies at three different redshifts , which were selected based on the mixing angle of the first two principal components , also known as the ` eclass ` in the sdss terminology .",
    "the bottom panels show the more problematic blue galaxies at similar redshifts .",
    "note the consistent performance of the estimator on the red sources as a function redshift in comparison to the blue galaxies that have broader pdfs at higher redshifts and are noisier , especially at the largest distances .    in the bottom rightmost panel ,",
    "the distribution is not even centered around the spectroscopic redshift , but skewed toward lower values .",
    "this object is very close to the edge of the training set , and the result would be considered unreliable due to the lack of calibrators at higher redshift that would still be within the sources photometric uncertainties .",
    "a very attractive feature of the new pdf estimator derived earlier in equation  ( [ eq : res ] ) is its conceptual independence from the sampling of the calibrators .",
    "many statistical tools rely heavily on having a representative training set and only provide unbiased results in that limit . in our case , the training points simply provide locations where the evaluation is feasible and their density is essentially just a resolution factor .",
    "the sampling frequency of the training set only affects the accuracy of the numerical integral in equation  ( [ eq : num_res ] ) but not in a systematic way as long as the query point is well within the boundaries of the window function .",
    "a denser training set will provide higher resolution in the summation , but there is a practical limit beyond which one expects no improvement .",
    "the reason is that the new calibrator sources are essentially identical to the ones already in the training set .",
    "the number of spectroscopic measurements to be carried out for calibration purposes is limited by finite resources .",
    "it is vital to acquire reliable training sets for the new generation photometric studies .",
    "a good training set has a well - defined selection function , using criteria based on only the observables one plans to model for the estimation , and , within that , a smart adaptive sampling strategy to optimize the coverage in observable space .",
    "clearly , the densest regions can be subsampled , but one needs all training points in the outskirts of the manifold for broad support .",
    "for this reason , the simplest random subsampling of the underlying population will not suffice .",
    "instead , a stratified sampling strategy is to be pursued .    to demonstrate that the methodology is robust to this kind of systematic changes in the training set",
    ", we create a stratified subset and perform the previous analysis the same way .",
    "the sampling is done by including sources randomly based on their local density @xmath58 in magnitude space .",
    "a galaxy is included in the training set only if the ratio of some constant @xmath74 and the local density is larger than a randomly generated real number , @xmath75 , uniform between 0 and 1 , i.e. , @xmath76 .",
    "we set the value of @xmath74 to yield a subsample that is half the size of the original data set .",
    "figure  [ fig : strat ] shows the results for the previously selected sources based on the smaller stratified subset .",
    "the basic shape of the curves is practically the same in most cases , only somewhat noisier but without systematics .",
    "one exception is the blue galaxy at around @xmath77 , where the subsampling somewhat amplifies the effect of the large wall in sdss at @xmath78 .",
    "the blue galaxy at the highest redshift is essentially unchanged ( except for the part at the lowest redshift where the density in magnitude space is larger to start with ) because the stratified sampling ( by construction ) has no effect on its already very sparse neighborhood .",
    "optimal sampling is difficult to achieve . in fact , it is difficult even to define .",
    "in addition to the photometric uncertainties , the desired resolution of the physical quantities also sets limits on the sampling frequency . this is prominent in the case of degenerate regions where an extended part of the physical parameter space is cramped into a small volume of observables .",
    "simulations built on realistic sed models can help cross - check these factors , and evaluate the performance of the estimator ahead of time . in the ideal case",
    ", one would create stratified training sets in the space of the physical parameters instead of the observables , which should be more feasible in the near future with improved spectral modeling ( e.g. , * ? ? ?",
    ".      the distribution of sources in a training set may be artificial and , as we just argued , should be optimized for coverage with a practical upper bound on the density tuned to the photometric inaccuracies and source diversity .",
    "however , the distribution in the query set is often physical and can be used to derive an empirical prior for our model .",
    "the basic observation is that the density of sources in the query set , @xmath79 , should match the predicted density of the model , @xmath80 .",
    "the latter is calculated for any prior as the convolution , @xmath81 if we substitute @xmath79 measured from the sources on the left - hand side of the equation , the only unknown is the prior , which we can solve for using the elegant deconvolution technique of @xcite and @xcite .    to see why",
    "a physically sensible prior is important , let us consider the density of sources in the training set within the window function . since the density is proportional to the product of the underlying @xmath82 density and the selection function , @xmath83 a significant volume of the window function is not sampled by the training set , where @xmath82 is zero . without a reasonable",
    "prior , the mapping @xmath33 could yield wrong weights for unphysical observables in the summation of equation  ( [ eq : pz ] ) .",
    "hence , any model needs some physical information . even if one is hesitant to take the empirical prior at face value , the domain of the model parameters should be carefully considered . in case of template fitting",
    ", this happens implicitly , even if not optimally , via the selection of the set or manifold of template spectra , but can be also done for even the empirical algorithms .",
    "starting from first principles of bayesian probability theory , we built a description and obtained the solution of the generic photometric inversion problem , where the physical properties of sources are constrained based on observational measurements .",
    "the new approach yields a formalism that encapsulates the field of photometric redshift estimation , and contains the traditional methods as special cases . in our systematic analysis of the mathematical problem , we put previous techniques in context and pointed out the directions for improvement in each .",
    "the proposed extensions to the current methods represent significant progress in more respects .",
    "we avoid the common assumption of the physical properties being a single - valued function of the observables by treating their relation in a more general way .",
    "thus the formalism is not prone to fail in regions , where the data sets are degenerate .",
    "we showed how to estimate the corresponding probability density of this relation .",
    "in addition , the uncertainties of the observables are propagated all the way to the results via explicit modeling of the accuracies .",
    "we discussed various aspects of the modeling from the simplest empirical case to the application of seds .",
    "this general framework allows for the construction of novel , more advanced methods that combine the attractive qualities of empirical and template - fitting algorithms .",
    "one can build empirical estimators based on training sets that have different observables from the query set , e.g. , @xmath5 photometry to @xmath6 , via sed modeling .",
    "we can improve the methods by creating more and more realistic models that include , for example , the strengths of the emission lines in galaxies ( following * ? ? ?",
    "* ) and their inclination angles ( based on * ? ? ?",
    "* ) among the model parameters to properly marginalize over the nuance parameters for a more reliable mapping of the observables .",
    "the current limitations come from the lack of good understanding of the photometric uncertainties . from previous studies , we know that the flux measurements in various passbands are correlated , yet , most catalogs only quote errors on the individual fluxes . for more precise scientific measurements via tighter photometric constraints , we need better photometric error models in the future .",
    "upcoming survey telescopes will observe all sources multiple times , hence will be able to get a better handle on the errors and their covariances .",
    "understadning these systematics is probably one of the highest priority tasks in the preparation for the upcoming era of photometric science .",
    "the proper solution of the generalized photometric inversion problem may be straightforward on paper , but efficient implementations of realistic models with appropriate priors involve many advanced concepts in statistics , and can only be built on the most recent and on - going developments in computer science , e.g. , multi - dimensional indexing in databases .",
    "even then the computations are not trivial to carry out , and have significantly higher demand for compute power than previous methods .",
    "the immediate future work is to have such a unified framework developed and ready for the next generation imaging surveys .",
    "the author is grateful to alexander s. szalay , istvn csabai and andrew j. connolly for originally introducing the problem , and for the countless inspiring discussions on various aspects of the topic over the course of many years ever since .",
    "the presented work has grown out of their collaboration on hubble space telescope and sloan digital sky survey data .",
    "also the author thanks dongryeol lee and alexander g. gray of the fastlab team at the georgia institute of technology for making their dual - tree kde implementation available for this work , and for their continuing support to the astronomy community .",
    "this study was supported by the gordon and betty moore foundation via gbmf 554 .",
    "budavri , t. , szalay , a.s .",
    ", connolly , a.j . ,",
    "csabai , i. & dickinson , m.e . , 1999 , in asp conf .",
    "proc . , 191 , photometric redshifts and high redshift galaxies , ed .  r. j. weymann , l. j. storrie ",
    "lombardi , m. sawicki , & r. brunner , ( san francisco , ca : asp ) , 19                connolly , a.j .",
    ", budavri , t. , szalay , a.s . , csabai , i. , & brunner , r.j . , 1999 , in _ photometric redshifts and high redshift galaxies , _ eds .",
    "r.j.weymann , l.j .",
    "storrie  lombardi , m.  sawicki , & r.  brunner , ( san francisco : asp ) , 13"
  ],
  "abstract_text": [
    "<S> we present a rigorous mathematical solution to photometric redshift estimation and the more general inversion problem . </S>",
    "<S> the challenge we address is to meaningfully constrain unknown properties of astronomical sources based on given observables , usually multicolor photometry , with the help of a training set that provides an empirical relation between the measurements and the desired quantities . </S>",
    "<S> we establish a formalism that blurs the boundary between the traditional empirical and template - fitting algorithms , as both are just special cases that are discussed in detail to put them in context . </S>",
    "<S> the new approach enables the development of more sophisticated methods that go beyond the classic techniques to combine their advantages . </S>",
    "<S> we look at the directions for further improvement in the methodology , and examine the technical aspects of practical implementations . </S>",
    "<S> we show how training sets are to be constructed and used consistently for reliable estimation . </S>"
  ]
}