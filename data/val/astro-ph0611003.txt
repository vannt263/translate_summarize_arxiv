{
  "article_text": [
    "astrophysical systems described by radiation hydrodynamics span a tremendous range of scales and parameter regimes , from the interiors of stars ( e.g. * ? ? ?",
    "* ) to accretion disks around compact objects ( e.g. * ? ? ?",
    "* ) to dusty accretion flows around massive protostars ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) to galactic - scale flows onto agn ( e.g. * ? ? ?",
    "all of these systems have in common that matter and radiation are strongly interacting , and that the energy and momentum carried by the radiation field is significant in comparison to that carried by the gas .",
    "thus an accurate treatment of the problem must include analysis of both the matter and the radiation , and of their interaction .",
    "numerical methods exist to simulate such systems in a variety of dimensionalities and levels of approximation . in three dimensions , treatments of the matter and",
    "radiation fields generally adopt the flux - limited diffusion approximation , first introduced by @xcite , for reasons of computational cost and simplicity ( e.g. * ? ? ?",
    "flux - limited diffusion is optimal for treating continuum transfer in a system such as an accretion disk , stellar atmosphere , or opaque interstellar gas cloud where the majority of the interesting behavior occurs in optically thick regions that are well described by pure radiation diffusion , but there is a surface of optical depth unity from which energy is radiated away . applying pure diffusion to these problems would lead to unphysically fast radiation from this surface , so flux - limited diffusion provides a compromise that yields a computationally simple and accurate description of the interior , while also giving a reasonably accurate loss rate from the surface @xcite .",
    "however , the level of accuracy provided by this approximation has been unclear because the equations of radiation hydrodynamics for flux - limited diffusion have previously only been analyzed to zeroth order in @xmath0 . in contrast",
    ", several authors have analyzed the radiation hydrodynamic equations in the general case to beyond first order in @xmath0 ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* and references therein ) .",
    "in a zeroth order treatment , one neglects differences between quantities in the laboratory frame and the comoving frame .",
    "the problem with this approach is that in an optically thick fluid , the radiation flux only follows fick s law ( @xmath1 ) in the comoving frame , and in other frames there is an added advective flux of radiation enthalpy , as first demonstrated by @xcite . in certain regimes ( i.e.  the dynamic diffusion limit  see below ) this advective flux can dominate the diffusive flux @xcite .",
    "@xcite does give a flux - limiter usable to first order in @xmath0 , which is an approach to the problem of flux - limiting with relativistic corrections that is an alternative to the one we pursue in this paper .",
    "however , this approach does not correctly handle the dynamic diffusion limit , a case that as we show requires special attention because order @xmath2 terms can be important .",
    "furthermore , @xcite derives his flux - limiter directly from the transfer equation , so the computation provides little insight into the relative importance of radiation hydrodynamic terms , and the level of accuracy obtained by using the uncorrected flux - limiter , the most common procedure in astrophysical applications .",
    "@xcite were the first to derive the mixed frame equations of radiation hydrodynamics dynamics to order @xmath0 in frequency - integrated and frequency - dependent forms , and gave numerical algorithms for solving them .",
    "@xcite , @xcite , and @xcite give alternate forms of these equations , as well as numerical algorithms for solving them .",
    "however , these treatments require that one solve the radiation momentum equation ( and for the frequency - dependent equations calculate over many frequencies as well ) , rather than adopt the flux - limited diffusion approximation .",
    "while this preferable from a standpoint of accuracy , since it allows explicit conservation of both momentum and energy and captures the angular - dependence of the radiation field in a way that diffusion methods can not , treating the radiation momentum equation is significantly more computationally costly than using flux - limited diffusion , making it difficult to use in three - dimensional calculations .    in this paper",
    "we analyze the equations of radiation hydrodynamics under the approximations that the radiation field has a thermal spectrum and obeys the flux - limited diffusion approximation , and that scattering is negligible for the system . our goal is to derive an accurate set of mixed frame equations , meaning that radiation quantities are written in the lab frame , but fluid quantities , in particular fluid opacities , are evaluated in the frame comoving with the fluid .",
    "this formulation is optimal for three - dimensional simulations , because writing radiation quantities in the lab frame lets us use an eulerian grid on which the radiative transfer problem may be solved by any number of standard methods , while avoiding the need to model the direction- and velocity - dependence of the lab frame opacity and emissivity of a moving fluid .    in ",
    "[ equations ] we begin from the general lab frame equations of hydrodynamics to first order in @xmath0 , apply the flux - limited diffusion approximation in the frame comoving with the gas where it is applicable , and transform the appropriate radiation quantities into the lab frame , thereby deriving the corresponding mixed frame equations suitable for implementation in numerical simulations .",
    "we retain enough terms to ensure that we achieve order unity accuracy in all regimes , and order @xmath0 accuracy for static diffusion problems . in ",
    "[ termanalysis ] we assess the significance of the higher order terms that appear in our equations , and consider where treatments omitting them are acceptable , and where they are likely to fail .",
    "we show that , in at least some regimes , the zeroth order treatments most often used are likely to produce results that are incorrect at order unity .",
    "we also compare our equations to the comoving frame equations commonly used in other codes . in ",
    "[ algorithm ] we take advantage of the ordering of terms we derive for the static diffusion regime to construct a radiation hydrodynamic simulation algorithm for static diffusion problems that is simpler and faster than those now in use , which we implement in the orion adaptive mesh refinement code . in ",
    "[ tests ] we demonstrate it in a selection of test problems .",
    "finally , we summarize our results in   [ summary ] .",
    "in the discussion that follows , we adopt the convention of writing quantities measured in the frame comoving with a fluid with a subscript zero .",
    "quantities in the lab frame are written without subscripts .",
    "we write scalars in italics ( e.g.  @xmath3 ) , vectors in boldface ( e.g.  @xmath4 ) , and rank two tensors in calligraphy ( e.g.  @xmath5 ) .",
    "we indicate tensor contractions over a single index by dots ( e.g.  @xmath6 ) , tensor contractions over two indices by colons ( e.g.@xmath7 ) , and tensor products of vectors without any operator symbol ( e.g.  @xmath8 ) . also note that we follow the standard convention in radiation hydrodynamics rather than the standard in astrophysics , in that when we refer to an opacity @xmath9 we mean the total opacity , measured in units of inverse length , rather than the specific opacity , measured in units of length squared divided by mass . since we are neglecting scattering , we may set the extinction @xmath10 .      before beginning our analysis , it is helpful to examine some characteristic dimensionless numbers for a radiation hydrodynamic system , since evaluating these quantities provides a useful guide to how we should analyze our equations .",
    "let @xmath11 be the characteristic size of the system under consideration , @xmath12 be the characteristic velocity in this system , and @xmath13 , be the photon mean free path .",
    "following @xcite , we can define three distinct limiting cases by considering the dimensionless ratios @xmath14 , which characterizes the optical depth of the system , and @xmath15 , which characterizes how relativistic it is .",
    "since we focus on non - relativistic systems , we assume @xmath16 .",
    "we term the case @xmath17 , in which the radiation and gas are weakly coupled , the _ streaming _ limit . if @xmath18 then radiation and gas are strongly coupled , and the system is in the diffusion limit .",
    "we can further subdivide the diffusion limit into the cases @xmath19 and @xmath20 .",
    "the former is the _ dynamic diffusion _ limit , while the latter is the _",
    "static diffusion _ limit . in summary ,",
    "the limiting cases are @xmath21    physically , the distinction between static and dynamic diffusion is that in dynamic diffusion radiation is principally transported by advection by gas , so that terms describing the work done by radiation on gas and the advection of radiation enthalpy dominate over terms describing either diffusion or emission and absorption . in the static diffusion limit",
    "the opposite holds .",
    "a paradigmatic example of a dynamic diffusion system is a stellar interior .",
    "the optical depth from the core to the surface of the sun is @xmath22 , and typical convective and rotational velocities are @xmath23 cm s@xmath24 , so the sun is strongly in the dynamic diffusion regime .",
    "in contrast , an example of a system in the static diffusion limit is a relatively cool , dusty , outer accretion disk around a forming massive protostar , as studied e.g.  by @xcite .",
    "the specific opacity of gas with the standard interstellar dust abundance to infrared photons is @xmath25 @xmath26 g@xmath24 , and at distances of more than a few au from the central star the density is generally @xmath27 g @xmath28 . for a disk of scale",
    "height @xmath29 au , the optical depth to escape is @xmath30 the velocity is roughly the keplerian speed , so @xmath31 where @xmath32 is the mass of the star and @xmath33 is the distance from it .",
    "thus , this system is in a static diffusion regime by roughly two orders of magnitude .    in the analysis that follows , our goal will be to obtain expressions that are accurate for the leading terms in all regimes .",
    "this is somewhat tricky , particularly for diffusion problems , because we are attempting to expand our equations simultaneously in the two small parameters @xmath34 and @xmath35 .",
    "the most common approach in radiation hydrodynamics is to expand expressions in powers of @xmath34 alone , and only analyze the equations in terms of @xmath36 after dropping terms of high order in @xmath34 .",
    "however , this approach can produce significant errors , because terms in the radiation hydrodynamic equations proportional to the opacity are multiplied by a quantity of order @xmath36 .",
    "thus , in our derivation we will repeatedly encounter expressions proportional to @xmath37 , and in a problem that is either in the dynamic diffusion limit or close to it ( @xmath38 ) , it is inconsistent to drop these terms while retaining ones that are of order @xmath34 .",
    "we therefore retain all terms up to order @xmath39 in our derivation unless we explicitly check that they are not multiplied by terms of order @xmath36 , and can therefore be dropped safely .",
    "we now start our derivation , beginning from the lab frame equations of radiation hydrodynamics @xcite @xmath40 & = & c g^0 \\\\ \\label{raden1 } \\frac{\\partial e}{\\partial t } + \\nabla \\cdot { \\mathbf{f}}&= & - c",
    "g^0 \\\\ \\label{radmom1 } \\frac{1}{c^2 } \\frac{\\partial { \\mathbf{f}}}{\\partial t } + \\nabla\\cdot{\\mathcal{p } } & = & -{\\mathbf{g}}\\end{aligned}\\ ] ] where @xmath41 , @xmath42 , @xmath43 , and @xmath44 are the density , velocity , specific energy ( thermal plus kinetic ) , and thermal pressure of the gas , @xmath45 , @xmath46 , and @xmath47 are the radiation energy density , flux , and pressure tensor , @xmath48 @xmath49 is the radiation four - force density @xmath50 , \\\\",
    "c{\\mathbf{g } } & = & \\int_0^{\\infty } d\\nu \\int d\\omega\\ , [ \\kappa({\\mathbf{n}},\\nu ) i({\\mathbf{n } } , \\nu ) - \\eta({\\mathbf{n}},\\nu ) ] { \\mathbf{n}},\\end{aligned}\\ ] ] and @xmath51 is the intensity of the radiation field at frequency @xmath52 traveling in direction @xmath53 . here",
    "@xmath54 and @xmath55 are the direction- and frequency - dependent radiation absorption and emission coefficients in the lab frame .",
    "intuitively , we can understand @xmath56 as the rate of energy absorption from the radiation field minus the rate of energy emission for the fluid , and @xmath57 as the rate of momentum absorption from the radiation field minus the rate of momentum emission .",
    "equations ( [ massconservation ] )  ( [ en1 ] ) are accurate to first order in @xmath0 , while equations ( [ raden1 ] )  ( [ radmom1 ] ) are exact .",
    "note that no terms involving opacity or optical depth appear explicitly in any of these equations , so the fact that they are accurate to first order in @xmath34 means that they include all the leading order terms .    in order to derive the mixed - frame equations , we must now evaluate the radiation four - force @xmath49 in terms of lab frame radiation quantities and comoving frame emission and absorption coefficients .",
    "@xcite show that , if the flux spectrum of the radiation is direction - independent , the radiation four - force on a thermally - emitting material to all orders in @xmath0 is given in terms of moments of the radiation field by @xmath58 e - \\gamma{\\kappa_{\\rm 0p}}a_r t_0 ^ 4   \\nonumber \\\\ & & { } - \\gamma ( { \\mathbf{v}}\\cdot{\\mathbf{f}}/c^2 ) [ { \\kappa_{\\rm 0f}}- 2\\gamma^2 ( { \\kappa_{\\rm 0f}}-{\\kappa_{\\rm 0e } } ) ] \\nonumber \\\\ & & { }   - \\gamma^3 ( { \\kappa_{\\rm 0f}}-{\\kappa_{\\rm 0e } } ) ( { \\mathbf{v}}{\\mathbf{v}})\\colon{\\mathcal{p}}/c^2 , \\\\ { \\mathbf{g } } & = & \\gamma{\\kappa_{\\rm 0f}}({\\mathbf{f}}/c )   - \\gamma { \\kappa_{\\rm 0p}}a_r t_0 ^ 4 ( { \\mathbf{v}}/c ) \\nonumber \\\\ & & { } -   [ \\gamma^3 ( { \\kappa_{\\rm 0f}}- { \\kappa_{\\rm 0e } } ) ( { \\mathbf{v}}/c ) e + \\gamma{\\kappa_{\\rm 0f}}({\\mathbf{v}}/c)\\cdot { \\mathcal{p } } ] \\nonumber \\\\ & & { } + \\gamma^3 ( { \\kappa_{\\rm 0f}}-{\\kappa_{\\rm 0e } } ) [ 2 { \\mathbf{v}}\\cdot{\\mathbf{f}}/c^3 - ( { \\mathbf{v}}{\\mathbf{v}})\\colon{\\mathcal{p}}/c^3 ] { \\mathbf{v}},\\end{aligned}\\ ] ] where @xmath59 is the lorentz factor and @xmath60 is the gas temperature .",
    "the three opacities that appear are the planck- , energy- , and flux - mean opacities , which are defined by @xmath61 where @xmath62 and @xmath63 are the comoving frame radiation energy and flux per unit frequency , @xmath64 and @xmath65 are the corresponding frequency - integrated energy and flux , and @xmath66 and @xmath67 are the frequency - dependent and frequency - integrated planck functions .    note that we have implicitly assumed that the opacity and emissivity are directionally - independent in the fluid rest frame , which is the case for any conventional material .",
    "we have also assumed that the flux spectrum is independent of direction , allowing us to replace the flux - mean opacity vector with a scalar .",
    "this may not be the case for an optically thin system , or one in which line transport is important , but since we are limiting our application to systems to which we can reasonably apply the diffusion approximation , this is not a major limitation .    to simplify @xmath68 , first we assume that the radiation has a blackbody spectrum , so that @xmath69 . in this case , clearly @xmath70 second , we adopt the flux - limited diffusion approximation ( see below ) , so in optically thick parts of the flow @xmath71 ( fick s law ) .",
    "this implies that @xmath72 ( \\nabla t_0 ) / \\kappa_0(\\nu_0)$ ] , and substituting this into ( [ fluxmeandef ] ) shows that the flux - mean opacity @xmath73 is equal to the rosseland - mean opacity , defined by @xmath74 in optically thin parts of the flow , @xmath75 , so in principle we should have @xmath76 .",
    "however , interpolating between these cases is complex , and the flux - limited diffusion approximation is of limited accuracy for optically thin flows in complex geometries .",
    "moreover , our approximation that the radiation spectrum is that of a blackbody at the local radiation temperature is itself problematic in the optically thin limit , so setting @xmath77 would not necessarily be more accurate than using @xmath78 . we therefore choose to optimize our accuracy in the optically thick part of the flow and set @xmath79 with these two approximations , the only two opacities remaining in our equations are @xmath78 and @xmath80 , both of which are independent of the spectrum of the radiation field and the direction of radiation propagation , and which may therefore be tabulated as a function of temperature for a given material once and for all .",
    "next , we expand @xmath49 in powers of @xmath0 , retaining terms to order @xmath2 . in performing this expansion ,",
    "we note that @xmath81 , and @xmath82 .",
    "the resulting expression for the radiation four - force is @xmath83 \\nonumber \\\\ & & { } + ( { \\kappa_{\\rm 0p}}-{\\kappa_{\\rm 0r } } ) \\frac{{\\mathbf{v}}{\\mathbf{v}}}{c^2}\\colon{\\mathcal{p}}+ o\\left(\\frac{v^3}{c^3}\\right ) \\label{g01 } \\\\ { \\mathbf{g } } & = & { \\kappa_{\\rm 0r}}\\frac{{\\mathbf{f}}}{c }   + { \\kappa_{\\rm 0p}}\\left(\\frac{{\\mathbf{v}}}{c}\\right ) \\left(e - \\frac{4\\pi b}{c}\\right ) \\nonumber \\\\ & & { } - { \\kappa_{\\rm 0r}}\\left[\\frac{{\\mathbf{v}}}{c}e + \\frac{{\\mathbf{v}}}{c}\\cdot { \\mathcal{p}}\\right ] + \\frac{1}{2}\\left(\\frac{v}{c}\\right)^2 { \\kappa_{\\rm 0r}}\\frac{{\\mathbf{f}}}{c } \\nonumber \\\\ & & { } + 2 ( { \\kappa_{\\rm 0r}}-{\\kappa_{\\rm 0p } } ) \\frac{({\\mathbf{v}}\\cdot{\\mathbf{f}}){\\mathbf{v}}}{c^3 } + o\\left(\\frac{v^3}{c^3}\\right ) \\label{gvec1}\\end{aligned}\\ ] ]    it is helpful at this point , before we making any further approximations , to examine the scalings of these terms with the help of our dimensionless parameters @xmath34 and @xmath36 . in the streaming limit ,",
    "radiation travels freely at @xmath84 and emission and absorption of radiation by matter need not balance , so @xmath85 and @xmath86 . for static diffusion , @xcite",
    "show that @xmath87 and @xmath88 . for dynamic diffusion",
    ", radiation travels primarily by advection , so @xmath89 .",
    "we show in appendix [ dyndiffusionscaling ] that for dynamic diffusion @xmath90 .",
    "note that the scaling @xmath91 given in @xcite appears to be incorrect , as we show in the appendix . using these values",
    ", we obtain the scalings shown in table [ gscalings ] for the terms in ( [ g01 ] ) and ( [ gvec1 ] ) .",
    "ccccc @xmath92 & @xmath93 & @xmath94 & @xmath95 & @xmath96 + @xmath92 & @xmath97 & @xmath98 & @xmath34 & @xmath99 + @xmath92 & @xmath100 & @xmath101 & @xmath101 & @xmath99 + @xmath92 & @xmath102 & @xmath101 & @xmath103 & @xmath104 + @xmath92 & @xmath105 & @xmath101 & @xmath101 & @xmath99 + @xmath57 & @xmath106 & @xmath107 & @xmath108 & @xmath109 + @xmath57 & @xmath110 & @xmath98 & @xmath111 & @xmath112 + @xmath57 & @xmath113 $ ] & @xmath98 & @xmath98 & @xmath109 + @xmath57 & @xmath114 & @xmath101 & @xmath39 & @xmath112 + @xmath57 & @xmath115 & @xmath101 & @xmath39 & @xmath112 +    the table shows that , despite the fact that we have kept all terms that are formally order @xmath39 or more , in fact we only have leading - order accuracy in the dynamic diffusion limit , because in this limit the order unity and order @xmath34 terms in @xmath92 vanish to order @xmath39 . to obtain the next - order terms , we would have had to write @xmath92 to order @xmath116 .",
    "a corollary of this is that treatments of the dynamic diffusion limit that do not retain order @xmath39 terms are likely to produce equations that are incorrect at order unity , since they will have dropped terms that are of the same order as the ones that have been retained .    at this point",
    "we could begin dropping terms that are insignificant at the order to which we are working , but it is cumbersome to construct a table analogous to table [ gscalings ] at every step of our derivation .",
    "it is more convenient to continue our analysis retaining all the terms in ( [ g01 ] ) and ( [ gvec1 ] ) , and to drop terms only periodically .    before moving on ,",
    "there is a subtlety in ( [ g01 ] ) and ( [ gvec1 ] ) that is worth commenting on .",
    "consider a gray fluid , one in which @xmath117 . in @xmath56 , the term that describes the work done by radiation , @xmath118 , has the opposite sign from what one might naively expect .",
    "using @xmath56 in the gas energy equation ( [ en1 ] ) in this case implies that the gas energy increases when @xmath42 and @xmath46 are anti - aligned , i.e.  when gas moves into an oncoming photon flux .",
    "we can understand the origin of this somewhat counter - intuitive behavior by considering the example of a fluid in thermal equilibrium with a radiation field in its rest frame ( i.e.@xmath119 ) . in the comoving frame",
    ", the radiation four - force behaves as one intuitively expects : at leading order the rate at which the radiation field transfers momentum density to the gas is @xmath120 , and the rate at which the gas energy density changes as a result is @xmath121 ( * ? ? ?",
    "* their equations 53a and 53b )",
    ". thus , gas loses energy when it moves opposite the direction of the flux , and hence opposite the force .",
    "however , now consider the fluid as seen by an observer in a frame boosted by velocity @xmath122 relative to the fluid .",
    "the observer sees the radiation energy density as @xmath45 , which differs from @xmath64 by @xmath123 ( see equation [ etransform ] ) , and this difference is the reason that the work term in @xmath92 is @xmath124 . physically , this happens because an observer who sees the fluid moving at velocity @xmath42 also sees the radiation and gas as being out of thermal equilibrium ( @xmath125 ) , since @xmath45 and @xmath64 are different .",
    "this disequilibrium leads the radiation and gas to exchange energy at a rate that is opposite in direction and twice as large as the radiation work , @xmath126 .",
    "this is why the  work \" term has the opposite sign than the one we might expect .",
    "thus , for the rest of this paper , while for convenience we continue to refer to @xmath127 and the terms to which it gives rise as  work \" terms , it is important to keep in mind that in reality this term contains contributions from two different effects of comparable magnitude , the ",
    "newtonian work \" @xmath128 and the post - newtonian term @xmath129 describing the imbalance between emission and absorption that an observer sees solely because the fluid is moving .",
    "with this point understood , we now adopt the flux - limited diffusion approximation @xcite , under which we drop the radiation momentum equation ( [ radmom1 ] ) and set the radiation flux in the comoving frame to @xmath130 where @xmath131 is a dimensionless number called the flux - limiter .",
    "many functional forms for @xmath131 are possible . for the code implementation",
    "we describe later , we adopt the @xcite flux - limiter , given by @xmath132 however , our derivation is independent of this choice .",
    "regardless of their exact functional form , all flux limiters have the property that in an optically thick medium @xmath133 , thereby giving @xmath134\\nabla e_0 $ ] , the correct value for diffusion . in an optically thin medium , @xmath135 , where @xmath136 is the unit vector antiparallel to @xmath137 , so the flux approaches @xmath138 , and the propagation speed of radiation is correctly limited to @xmath84 .    for the @xcite flux - limiter we adopt",
    ", the corresponding approximate value for the radiation pressure tensor is @xcite @xmath139,\\ ] ] where @xmath140 is the identity tensor of rank 2 and @xmath141 physically , this approximation interpolates between the behavior in very optically thick regions , where @xmath142 , the radiation pressure is isotropic , and off - diagonal components vanish , and optically thin regions , where @xmath143 and the radiation pressure tensor is zero orthogonal to @xmath136 and @xmath64 parallel to it .",
    "note that for pure diffusion @xcite and @xcite show that the pressure tensor reduces to @xmath144 plus off - diagonal elements of order @xmath111 or @xmath39 .",
    "our approximation does not quite reproduce this , since in the diffusion limit it gives @xmath145 plus off - diagonal elements of order @xmath146 .",
    "we might therefore worry that , in the static diffusion regime where @xmath20 , we will have an incorrect term .",
    "however , examination of our final equations below shows that all terms arising from off - diagonal elements of @xmath147 are smaller than order @xmath34 in the static diffusion limit , so adopting the @xcite approximation for the pressure tensor does not introduce any incorrect terms at order @xmath34 in the final equations .    to use the approximations ( [ fldflux ] ) and ( [ fldpressure ] ) to evaluate the radiation four - force",
    ", we must lorentz transform them to express the radiation quantities in the lab frame .",
    "the lorentz transforms for the energy , flux , and pressure to second order in @xmath0 are @xcite @xmath148 \\label{etransform }   \\\\ { \\mathbf{f } } & = & { \\mathbf{f}}_0 + { \\mathbf{v}}e_0 + { \\mathbf{v}}\\cdot{\\mathcal{p}}_0 + \\frac{1}{2c^2 } \\left[v^2 { \\mathbf{f}}_0 + 3 { \\mathbf{v}}({\\mathbf{v}}\\cdot{\\mathbf{f}}_0)\\right ] \\label{ftransform } \\\\ { \\mathcal{p } } & = & { \\mathcal{p}}_0 + \\frac{{\\mathbf{v}}{\\mathbf{f}}_0 + { \\mathbf{f}}_0{\\mathbf{v}}}{c^2 } + \\frac{1}{c^2}\\left[{\\mathbf{v}}{\\mathbf{v}}e_0 + { \\mathbf{v}}({\\mathbf{v}}\\cdot{\\mathcal{p}}_0)\\right ] .",
    "\\label{ptransform}\\end{aligned}\\ ] ] note that in the expression for @xmath47 we have simplified the final term using the fact that @xmath147 is a symmetric tensor .    using the same scaling arguments we used to construct table [ gscalings ] , we see that @xmath47 and @xmath147 differ at order @xmath34 in the streaming limit , at order @xmath111 for static diffusion , and at order @xmath39 for dynamic diffusion .",
    "since this is below our accuracy goal , we need not distinguish @xmath47 and @xmath147 .",
    "the same is true of @xmath45 and @xmath64 .",
    "however , @xmath46 is different . in the comoving frame in an optically thick system ,",
    "one is in the static diffusion regime , so @xmath149 .",
    "since @xmath150 and @xmath151 are of order @xmath152 , and in dynamic diffusion @xmath153 , this means that @xmath150 and @xmath151 are the dominant components of @xmath46 in dynamic diffusion , and must therefore be retained .",
    "thus , @xmath154 which is simply the rest frame flux plus terms describing the advection of radiation enthalpy .    substituting ( [ fldpressure ] ) with @xmath155 and ( [ fluxtransform ] ) into the four - force density ( [ g01 ] ) and",
    "( [ gvec1 ] ) , and continuing to retain terms to order @xmath2 , gives @xmath156   \\nonumber \\\\ & & { } + \\frac{1}{2}\\left(\\frac{v}{c}\\right)^2 { \\kappa_{\\rm 0p}}\\left(e-\\frac{4\\pi b}{c}\\right ) \\label{gztrans } \\\\ { \\mathbf{g } } & = & - \\lambda \\nabla e + { \\kappa_{\\rm 0p}}\\frac{{\\mathbf{v}}}{c }   \\left(e - \\frac{4\\pi b}{c}\\right ) \\nonumber \\\\ & & { } -\\frac{1}{2}\\left(\\frac{v}{c}\\right)^2 \\lambda \\nabla e   \\nonumber \\\\ & & { } + 2\\lambda\\left(\\frac{{\\kappa_{\\rm 0p}}}{{\\kappa_{\\rm 0r}}}-1\\right ) \\frac{({\\mathbf{v}}\\cdot\\nabla e){\\mathbf{v}}}{c^2}. \\label{gtrans}\\end{aligned}\\ ] ] here @xmath53 is the unit vector antiparallel to @xmath157 .",
    "we again remind the reader that , although these equations contain terms of order @xmath39 , they are not truly accurate to order @xmath39 because we did not retain all the @xmath39 when applying the lorentz transform to the flux and pressure .",
    "however , these equations include all the terms that appear at the order of accuracy to which we are working , and by retaining terms of order @xmath39 we guarantee that these terms will be preserved .",
    "inserting @xmath49 and the lab frame flux ( [ labflux ] ) into the gas momentum and energy equations ( [ mom1 ] ) and ( [ en1 ] ) , and the radiation energy equation ( [ raden1 ] ) , and again retaining terms to order @xmath2 gives @xmath158 - { \\kappa_{\\rm 0p}}(4\\pi b - c e )   \\nonumber \\\\ & & { } + \\lambda\\left(2\\frac{{\\kappa_{\\rm 0p}}}{{\\kappa_{\\rm 0r}}}-1\\right ) { \\mathbf{v}}\\cdot\\nabla e   \\nonumber \\\\ & & { }   - \\frac{{\\kappa_{\\rm 0p}}}{c } e \\left[\\frac{3 - r_2}{2 } v^2 +   \\frac{3 r_2 - 1}{2 } ( { \\mathbf{v}}\\cdot{\\mathbf{n}})^2 \\right ]   \\nonumber \\\\ & & { } - \\frac{1}{2}\\left(\\frac{v}{c}\\right)^2 { \\kappa_{\\rm 0p}}\\left(4 \\pi b - c e\\right ) \\label{en2 } \\\\",
    "\\frac{\\partial}{\\partial t}e & = & \\nabla\\cdot\\left(\\frac{c\\lambda}{{\\kappa_{\\rm 0r } } } \\nabla e\\right ) + { \\kappa_{\\rm 0p}}(4\\pi b - c e ) \\nonumber \\\\ & & { } -\\lambda \\left(2\\frac{{\\kappa_{\\rm 0p}}}{{\\kappa_{\\rm 0r}}}-1\\right ) { \\mathbf{v}}\\cdot \\nabla e \\nonumber \\\\ & & { }   + \\frac{{\\kappa_{\\rm 0p}}}{c } e",
    "\\left [ \\frac{3-r_2}{2 } v^2 + \\frac{3r_2 - 1}{2 } ( { \\mathbf{v}}\\cdot{\\mathbf{n}})^2 \\right ] \\nonumber \\\\ & & { } - \\nabla \\cdot \\left [ \\frac{3-r_2}{2 } { \\mathbf{v}}e + \\frac{3 r_2 - 1}{2 } { \\mathbf{v}}\\cdot({\\mathbf{n}}{\\mathbf{n } } ) e\\right ] \\nonumber \\\\ & & { } + \\frac{1}{2}\\left(\\frac{v}{c}\\right)^2 { \\kappa_{\\rm 0p}}\\left(4 \\pi b - c e\\right ) .",
    "\\label{raden2}\\end{aligned}\\ ] ] at this point we construct table [ eqscalings ] showing the scalings of the radiation terms to see which must be retained and which are superfluous . in constructing the table , we take spatial derivatives to be of characteristic scaling @xmath159 , i.e.  we assume that radiation quantities vary on a size scale of the system , rather than over a size scale of the photon mean free path .",
    "in the streaming limit , @xmath160 and @xmath161 . in the diffusion limit",
    "@xmath162 and @xmath163 .    ccccc m & @xmath164 & @xmath94 & @xmath108 & @xmath108 + m & @xmath165 & @xmath166 & @xmath111 & @xmath167 + m & @xmath168 & @xmath101 & @xmath39 & @xmath39 + m & @xmath169 & @xmath37 & @xmath39 & @xmath39 + g and r & @xmath170 & @xmath94 & @xmath95 & @xmath99 + g and r & @xmath171 & @xmath98 & @xmath34 & @xmath172 + g and r & @xmath173e$ ] & @xmath101 & @xmath101 & @xmath99 + g and r & @xmath174 [ ( 3r_2 - 1)/2]e$ ] & @xmath101 & @xmath103 & @xmath103 + g and r & @xmath175 & @xmath37 & @xmath103 & @xmath176 + r & @xmath177 $ ] & @xmath108 & @xmath95 & @xmath35 + r & @xmath178 { \\mathbf{v}}e\\}$ ] & @xmath34 & @xmath34 & @xmath172 + r & @xmath179 { \\mathbf{v}}\\cdot({\\mathbf{n}}{\\mathbf{n } } ) e\\}$ ] & @xmath34 & @xmath180 & @xmath180 +    using table [ eqscalings ] to drop all terms that are not significant at leading order in any regime , we arrive at our final equations : @xmath181 - { \\kappa_{\\rm 0p}}(4\\pi b - c e )   \\nonumber \\\\ & & { } + \\lambda\\left(2\\frac{{\\kappa_{\\rm 0p}}}{{\\kappa_{\\rm 0r}}}-1\\right ) { \\mathbf{v}}\\cdot\\nabla e   \\nonumber \\\\ & & { }   - \\frac{3-r_2}{2 } { \\kappa_{\\rm 0p}}\\frac{v^2}{c } e \\label{gasenergy } \\\\",
    "\\frac{\\partial}{\\partial t}e & = & \\nabla\\cdot\\left(\\frac{c\\lambda}{{\\kappa_{\\rm 0r } } } \\nabla e\\right ) + { \\kappa_{\\rm 0p}}(4\\pi b - c e ) \\nonumber \\\\ & & { } -\\lambda \\left(2\\frac{{\\kappa_{\\rm 0p}}}{{\\kappa_{\\rm 0r}}}-1\\right ) { \\mathbf{v}}\\cdot",
    "\\nabla e \\nonumber \\\\ & & { }   + \\frac{3-r_2}{2 } { \\kappa_{\\rm 0p}}\\frac{v^2}{c } e \\nonumber \\\\ & & { }    - \\nabla\\cdot\\left(\\frac{3-r_2}{2}{\\mathbf{v}}e\\right ) .",
    "\\label{radenergy}\\end{aligned}\\ ] ] these represent the equations of momentum conservation for the gas , energy conservation for the gas , and energy conservation for the radiation field , which , together with the equation of mass conservation ( [ massconservation ] ) , fully describe the system under the approximations we have adopted .",
    "they are accurate and consistent to leading order in the streaming and dynamic diffusion limits .",
    "they are accurate to first order in @xmath34 in the static diffusion limit , since we have had to retain all order @xmath34 terms in this limit because they are of leading order in dynamic diffusion problems . also note that if in a given problem one never encounters the dynamic diffusion regime , it is possible to drop more terms , as we discuss in   [ algorithm ] .",
    "the equations are easy to understand intuitively .",
    "the term @xmath182 in the momentum equation ( [ momentumconservation ] ) simply represents the radiation force @xmath106 , neglecting distinctions between the comoving and laboratory frames which are smaller than leading order in this equation .",
    "similarly , the terms @xmath183 and @xmath184 in the two energy equations ( [ gasenergy ] ) and ( [ radenergy ] ) represent radiation absorbed minus radiation emitted by the gas , and the work done by the radiation field as it diffuses through the gas .",
    "the factor @xmath185 arises because the term contains contributions both from the newtonian work and from a relativistically - induced mismatch between emission and absorption .",
    "the term proportional to @xmath186 represents another relativistic correction to the work , this one arising from boosting of the flux between the lab and comoving frames . in the radiation energy equation ( [ radenergy ] ) , the first term on the left hand side is the divergence of the radiation flux , i.e.  the rate at which radiation diffuses , and the last term on the right hand side represents advection of the radiation enthalpy @xmath187 by the gas .",
    "it is also worth noting that equations ( [ en2 ] ) and ( [ raden2 ] ) are manifestly energy - conserving , since every term in one equation either has an obvious counterpart in the other with opposite sign , or is clearly an advection .",
    "in contrast , the momentum equation ( [ momentumconservation ] ) is not manifestly momentum - conserving , since there is a force term @xmath182 with no equal and opposite counterpart .",
    "this non - conservation of momentum is an inevitable side - effect of using the flux - limited diffusion approximation , since this approximation amounts to allowing the radiation field to transfer momentum to the gas without explicitly tracking the momentum of the radiation field and the corresponding transfer from gas to radiation .",
    "our dynamical equations result from retaining at least some terms that are formally of order @xmath39 . even though our analysis shows that these terms can be the leading ones present , due to cancellations of lower order terms",
    ", one might legitimately ask whether they are ever physically significant . in   [ ordcomparison ] we address this question by comparing our equations to those that result from lower order treatments . in ",
    "[ framecomparison ] , we also compare our equations with those generally used in comoving frame formulations of radiation hydrodynamics .    to make our work in this section more transparent , and since we are more interested in physical intuition than rigorous derivation here , we specialize to the diffusion regime in gray materials .",
    "thus , we set @xmath188 and @xmath189 .",
    "a more general analysis produces the same conclusions , but is more mathematically cumbersome .",
    "we also focus on the radiation energy equation , since all the terms that appear in the gas energy equation also appear in it , and because there are no higher order terms present in the momentum equation . under these assumptions ,",
    "our radiation energy equation ( [ radenergy ] ) becomes @xmath190      a common approach in radiation - hydrodynamic problems is to expand the equations in @xmath34 , rather than in both @xmath34 and @xmath36 as we have done , and drop at least some terms that are of order @xmath39 in every regime ( e.g * ? ? ?",
    "* ) . to determine how equations derived in this manner compare to our higher order treatment , we compare our simplified energy equation ( [ difffull ] ) to the corresponding equation one would obtain by following this procedure with ( [ radenergy ] )",
    "this resulting energy equation is @xmath191 _ it is important to caution at this point that , as we show below , equation ( [ difffirstorder ] ) is not accurate to leading order in at least some cases , and should not be used for computations unless one carefully checks that the missing terms never become important in the regime covered by the computation . _",
    "compared to the energy equation ( [ difffull ] ) that we obtain by retaining all leading order terms in @xmath34 and @xmath36 , ( [ difffirstorder ] ) is missing the term @xmath192 . if we think of the flux as having two parts , a  diffusion \" part proportional to @xmath157 that comes from radiation diffusion in the comoving frame , and a ",
    "relativistic \" part proportional to @xmath193 that comes from the lorentz transformation between lab and comoving frames , then it is natural to describe the @xmath194 term as the `` diffusion work '' arising from the combination of the diffusion flux and the post - newtonian emission - absorption mismatch ( as discussed in   [ equationderivation ] ) , and the @xmath195 as the `` relativistic work '' arising from the relativistic flux .",
    "the presence or absence of this relativistic work term is the difference between our leading order - accurate equation and the equation one would derive by dropping @xmath39 terms . analyzing when , if ever , this term is physically important lets us identify in which situations a lower order treatment may be inadequate .    if we use table [ eqscalings ] to compare the relativistic work term to the emission / absorption term , we find that @xmath196 $ ] is of order @xmath197 for static diffusion , and of order unity for dynamic diffusion .",
    "thus , the term is never important in a static diffusion problem , but is always important for a non - uniform , non - equilibrium dynamic diffusion problem system .",
    "we add the caveats about non - uniformity and time - dependence because in a system where there is no radiation - gas energy exchange , the relativistic work term will be small due to a cancellation .",
    "the example in appendix [ dyndiffusionscaling ] shows that in an equilibrium , uniform medium , the terms @xmath198 and @xmath199 cancel exactly at orders up to @xmath39 .",
    "we expect any system where variations occur on a scale for which @xmath200 to resemble such a uniform , equilibrium medium , and thus we do not expect the term @xmath192 to be important in such a system .",
    "that said , there is still clearly a problem with omitting the relativistic work term in a system where @xmath201 . in this case ,",
    "table [ eqscalings ] implies that _ every _ term on the right hand side is roughly equally important regardless of whether we use the static of dynamic diffusion scalings . to illustrate this point ,",
    "consider a radiation - dominated shock .",
    "the width of such a shock is set by the balance between radiation diffusing upstream from the hot post - shock region into the cold pre - shock region , and advection of the radiation back downstream by the pre - shock gas .",
    "this condition requires that @xmath202 across the shock @xcite , so its width @xmath203 . since @xmath45 changes by of order unity across this distance ,",
    "its spatial derivative is of order @xmath204 . applying this to ( [ difffull ] )",
    ", we find that each term on the right hand side is of order @xmath205 .",
    "since the terms like @xmath206 describing advection and @xmath207 $ ] describing diffusion are obviously important in the structure of the shock , causing order unity changes in @xmath45 , and the relativistic work term is comparable , it follows that the relativistic work term is equally important .",
    "one can obtain the correct structure within a radiation - dominated shock only by retaining the relativistic work term .    an interesting point to note here",
    "is that omitting the relativistic work term will not produce errors upstream or downstream of a shock , because @xmath208 in these regions .",
    "furthermore , the jump conditions across a shock should be correct .",
    "the omitted term affects radiation - gas energy exchange , not total energy conservation , and all that is required to get the correct jump conditions are conservation of mass and energy , plus correct computation of the upstream and downstream radiation pressures .",
    "the lower order treatment will therefore only make errors within the shock . whether this is physically important , or it is sufficient to get the jump conditions correct , depends on whether one is concerned with structures on scales for which @xmath202 .",
    "an astrophysical example of a system where one does care about structures on this scale is a radiation - dominated accretion disk subject to photon bubble instability @xcite .",
    "such disks are in the dynamic diffusion regime over the entire disk , but photon bubbles form on small scales within them , and individual bubbles may have @xmath202 across them .",
    "many popular numerical treatments of radiation hydrodynamics ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) use a comoving formulation of the equations rather than our mixed frame formulation .",
    "it is therefore useful to compare our equations to the standard comoving frame equations . in the comoving formulation ,",
    "the evolution equation for the radiation field is usually the first law of thermodynamics for the comoving radiation field @xcite , @xmath209 this equation is accurate to first order in @xmath34 in the sense that it contains all the correct leading order terms and all terms that are smaller than them by order @xmath34 or less .    to compare this to our mixed frame radiation energy equation ( [ radenergy ] )",
    ", we replace the comoving frame energy @xmath64 in ( [ firstlaw ] ) with the lab frame energy @xmath45 using the lorentz transformation ( [ etransform ] ) and retain all terms that are of leading order in any regime . in practice , this means that we set @xmath210 inside the time derivative , since the difference between @xmath45 and @xmath64 is at most @xmath111 or @xmath39 for static or dynamic diffusion . however , when replacing @xmath64 with @xmath45 in the heating / cooling term @xmath211 , we must retain all the terms in ( [ etransform ] ) because the leading term @xmath212 is itself only of order @xmath146 or @xmath39 relative to @xmath45 , so the difference between @xmath45 and @xmath64 can be of leading order . and",
    "@xmath64 here is different from the situation when we first applied the lorentz transformation to derive ( [ gztrans ] ) and ( [ gtrans ] ) . in that case",
    "we did not need to retain the distinction between @xmath45 and @xmath64 , because in deriving ( [ gztrans ] ) and ( [ gtrans ] ) there were no terms involving @xmath64 explicitly .",
    "instead , @xmath64 appeared only implicitly , as part of the flux @xmath46 , and non - leading order corrections to @xmath46 are not of leading order in any regime .",
    "in contrast , @xmath64 does appear explicitly in ( [ firstlaw ] ) .",
    "] this gives a transformed equation @xmath213 .",
    "\\label{firstlaw1}\\end{aligned}\\ ] ]    if we now adopt the diffusion approximation @xmath214 and @xmath215 , use the lorentz transformation to replace @xmath64 with @xmath45 throughout , and again only retain terms that are of leading in order in some regime , then it is easy to verify that ( [ firstlaw1 ] ) reduces to ( [ difffull ] ) .",
    "thus , our evolution equation is equivalent to the comoving frame first law of thermodynamics for the radiation field , _ provided that one retains all the leading order terms with respect to @xmath34 and @xmath36 , including some that are of order @xmath39 , when evaluating the lorentz transformation_.    while the equations are equivalent , the mixed frame formulation has two important advantages over the comoving frame formulation when it comes to practical computation .",
    "first , we are able to write the equations in a manner that allows a numerical solution algorithm to conserve total energy to machine accuracy .",
    "we present such an algorithm in ",
    "[ algorithm ] .",
    "in contrast , it is not possible to write a conservative update algorithm using the comoving frame equations .",
    "the reason for this is that a conserved total energy only exists in an inertial frame , and for a fluid whose velocity is not a constant in space and time , the comoving frame is not inertial .",
    "the lack of a conserved energy is a serious drawback to comoving frame formulations .",
    "a second advantage of the mixed - frame formulation is that it is far more suited to implementation in codes with dynamically modified grid structures such as adaptive mesh refinement methods .",
    "since the radiation energy is a conserved quantity , it is obvious how to refine or coarsen it in a conservative manner . on the other hand , there is no obviously correct method for refining or coarsening the comoving frame energy density , because it will not even be defined in the same reference frames before and after the refinement procedure .",
    "our analysis shows that for static diffusion , the terms involving diffusion and emission minus absorption of radiation always dominate over those involving radiation work and advection . in addition , some terms are always smaller than order @xmath34 .",
    "this suggests an opportunity for a significant algorithmic improvement over earlier approaches while still retaining order @xmath34 accuracy in the solution . in a simulation ,",
    "one must update terms for the radiation field implicitly , because otherwise stability requirements limit the update time step to values comparable to the light - crossing time of a cell .",
    "standard approaches ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) therefore update all terms involving radiation implicitly except the advection term and the radiation force term in the gas momentum equation .",
    "however , implicit updates are computationally expensive , so the simpler the terms to be updated implicitly can be made , the simpler the algorithm will be to code and the faster it will run . since the work and advection terms are non - dominant , we can produce a perfectly stable algorithm without treating them implicitly . even if this treatment introduces numerically unstable modes in the work or advection terms , they will not grow because the radiation diffusion and emission / absorption terms , which are far larger , will smooth them away each time step .    for the case of static diffusion ,",
    "we therefore adopt the order @xmath0 equations ( [ massconservation ] ) and ( [ momentumconservation ] ) for mass and momentum conservation . for our energy equations ,",
    "we adopt ( [ gasenergy ] ) and ( [ radenergy ] ) , but drop terms that are smaller than order @xmath34 for static diffusion .",
    "this gives @xmath216 - { \\kappa_{\\rm 0p}}(4\\pi b - c e )   \\nonumber \\\\ & & { } + \\lambda \\left(2\\frac{{\\kappa_{\\rm 0p}}}{{\\kappa_{\\rm 0r}}}-1\\right ) { \\mathbf{v}}\\cdot\\nabla e   \\label{gasenstatdiff } \\\\",
    "\\frac{\\partial}{\\partial t}e & = & \\nabla\\cdot\\left(\\frac{c\\lambda}{{\\kappa_{\\rm 0r } } } \\nabla e\\right ) + { \\kappa_{\\rm 0p}}(4\\pi b - c e ) \\nonumber \\\\ & & { } -\\lambda \\left(2\\frac{{\\kappa_{\\rm 0p}}}{{\\kappa_{\\rm 0r}}}-1\\right ) { \\mathbf{v}}\\cdot \\nabla e \\nonumber \\\\ & & { } - \\nabla \\cdot \\left(\\frac{3-r_2}{2}{\\mathbf{v}}e\\right ) \\label{radenstatdiff}\\end{aligned}\\ ] ] to solve these , we operator split the diffusion and emission / absorption terms , which we treat implicitly , from the work and advection terms , which we treat explicitly . to do this , we write our gas / radiation state as @xmath217 and our evolution equations as @xmath218 where we have broken our right hand side up into non - radiative terms to be handled explicitly , @xmath219 \\\\ 0 \\end{array } \\right),\\ ] ] radiative terms to be handled explicitly , @xmath220 and radiative terms that must be handled implicitly , @xmath221      for each update cycle , we start with the state @xmath222 at the old time .",
    "we first perform an implicit update to the radiation and gas energy densities using @xmath223 .",
    "any number of methods are possible for this . for our implementation of this algorithm in the orion adaptive mesh refinement ( amr ) code ,",
    "we use the method of @xcite , which we will not discuss in detail here . to summarize",
    ", the algorithm involves writing the equations using second order accurate spatial discretization and a time discretization that limits to backwards euler for large values of @xmath224 ( to guarantee stability ) and to crank - nicolson when @xmath225 is small ( to achieve second order time accuracy ) .",
    "this yields a matrix equation for the radiation and gas energy densities at the new time , which may be solved on both individual grids and over a hierarchy of nested grids ( as is necessary for amr ) using standard multigrid techniques .",
    "the output of this procedure is an intermediate state @xmath226 which has been updated for @xmath223 .",
    "once the implicit update is done , we compute the ordinary hydrodynamic update . as with the implicit update , this",
    "may be done using the hydrodynamics method of one s choice .",
    "for our implementation , we use the godunov method described by @xcite , @xcite , and @xcite .",
    "this update gives us @xmath227 , the state updated for @xmath223 and @xmath228 .",
    "the only modification we make to the standard update algorithm is to include a radiation pressure term in the effective sound speed used to compute the courant condition .",
    "thus , we take @xmath229 and set the time step to @xmath230 where @xmath231 is the ratio of specific heats for the gas , @xmath232 is the courant factor ( usually 0.5 ) , and the maximum is evaluated over all cells .",
    "for amr , this condition is applied independently on each level @xmath233 , and the time step is set using the values of @xmath234 in the standard amr manner ( e.g. * ? ? ? * ) .",
    "the factor @xmath235 gives us a means of interpolating between optically thick cells , where radiation pressure contributes to the restoring force and thus increases the effective signal speed , and optically thin cells , where radiation does not provide any pressure .",
    "finally , we compute the force and advection terms in @xmath236 . in our implementation",
    "we compute all of these at cell centers using second order centered differences . for @xmath237",
    "this is @xmath238 other derivatives are computed in an analogous manner .",
    "we then find the new state by @xmath239    this update is manifestly only first order - accurate in time for the explicit radiation terms , but there is no point in using a more complex update because our operator splitting of some of the radiation terms means that we are performing our explicit update using a time - advanced radiation field , rather than the field at a half time step .",
    "( @xcite show that one can avoid this problem for gravitational body forces because the potential is linear in the density , so it is possible to derive the half - time step potential from the whole time step states .",
    "no such fortuitous coincidence occurs for the radiation field .",
    ") this necessarily limits us to first order accuracy in time for the terms we treat explicitly .",
    "however , since these terms are always small compared to the dominant radiation terms , the overall scheme should still be closer to second order than first order in accuracy .",
    "our algorithm has two significant advantages in comparison to other approaches , in particular those based on comoving frame formulations of the equations ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) . in any of these approaches , since the radiation work terms are included in the implicit update , one must solve an implicit quartic equation arising from the combination of the terms @xmath170 and @xmath240 .",
    "this may be done either at the same time one is iterating to update the flux divergence term @xmath241 @xcite , or in a separate iteration to be done once the iterative solve for the flux divergence update is complete @xcite . in contrast , since our iterative update involves only @xmath170 and @xmath241 , using the @xcite algorithm we may linearize the equations and never need to solve a quartic , leading to a simpler update algorithm and a faster iteration step .",
    "moreover , by using the @xcite time - centering , we obtain second order accuracy in time whenever @xmath45 is changing slowly , as opposed to the backwards euler differencing of @xcite , @xcite , and @xcite , which is always first order - accurate in time .",
    "thus , our algorithm provides a faster and simpler approach than the standard one .",
    "a second advantage of our update scheme is that it retains the total energy - conserving character of the underlying equations . in each of the update steps involving radiation , for @xmath236 and @xmath242 , the non - advective update terms in the radiation and gas energy equations",
    "are equal and opposite .",
    "thus , it is trivial to write the update scheme so that it conserves total energy to machine precision .",
    "this property is particularly important for turbulent flows with large radiation energy gradients , such as those that occur in massive star formation ( e.g. * ? ? ?",
    "* ) , because numerical non - conservation is likely to be exacerbated by the presence of these features .",
    "in contrast , in comoving frame formalisms such as those of @xcite , @xcite , and @xcite the exchange terms in their gas and radiation energy equations are not symmetric . as a result ,",
    "their update schemes do not conserve total energy exactly .",
    "the underlying physical reason for this asymmetry is that total energy is conserved only in inertial frames such as the lab frame ; it is not conserved in the non - inertial comoving frame .",
    "for this reason , there is no easy way to write a conservative update scheme from a comoving formulation .",
    "our algorithm also has two significant limitations , one obvious and one subtle .",
    "the obvious limit is that our algorithm is only applicable for static diffusion problems . for dynamic diffusion problems , e.g.stellar interiors or radiation - dominated shocks ,",
    "our scheme is unstable unless an appropriately small timestep is used .",
    "whether this instability is due to the explicit advection term , the explicit work term , or both is not clear . since codes such as zeus",
    "@xcite treat the advection explicitly without instability , however , it seems likely that the work term is the culprit .",
    "regardless of the cause , even if we were to use a time step small enough to guarantee stability , since the work and advection terms can be comparable to or larger than the diffusion and heating / cooling terms for dynamic diffusion , an algorithm that treats all the terms implicitly or all explicitly , rather than our mix , is likely to be more accurate .",
    "the subtle limitation is in our treatment of the hydrodynamics .",
    "we perform the hydrodynamic update using a riemann solver unmodified for the presence of radiation force , work , and heating and cooling terms .",
    "these terms should change the characteristic velocities of the wave families in ways that depend on the radiation hydrodynamic regime of the system .",
    "for example , in optically thick systems we should have a radiation - acoustic mode rather than a simple sound wave , and in optically thin systems where the radiation time scale is short compared to the mechanical time scale , a gas may act as if it were isothermal even if it has @xmath243 . in some cases , failure to modify the riemann solver appropriately for these effects may produce substantial errors , including a reduction in the order of accuracy of the method from second to first @xcite .",
    "the severity of these effects for a given problem depends the degree of stiffness of the radiation source terms .",
    "it should also be noted that the other radiation diffusion methods most commonly used for three - dimensional problems also suffer from this defect , so this is not a comparative disadvantage of our method relative to others .",
    "here we describe five tests of our static diffusion algorithm , done using our implementation of the algorithm in the orion amr code , various aspects of which are described in detail by ( * ? ? ?",
    "* multifluid hydrodynamics ) , ( * ? ? ?",
    "* hydrodynamics and gravity ) , ( * ? ? ?",
    "* hydrodynamics and gravity ) , ( * ? ? ?",
    "* gravity ) , ( * ? ? ?",
    "* radiation transport ) , ( * ? ? ?",
    "* sink particles ) , and ( * ? ? ?",
    "* magnetohydrodynamics ) .",
    "for all of these tests we use a single fluid with no magnetic fields and no self - gravity .      as an initial check of the gas - radiation energy exchange in our code in a case",
    "when radiation pressure is not significant and the gas is at rest , we simulate the non - equilibrium marshak wave problem . in this problem , a zero - temperature , motionless , gaseous medium occupying all space at @xmath244 is subject to a constant radiation flux @xmath245 incident on its surface at @xmath246 .",
    "the gas is held stationary , appropriate for early times before hydrodynamic motions become significant .",
    "the medium is gray , with opacity @xmath247 , and the constant - volume specific heat capacity of the gas is taken to have the same @xmath248 dependence as that of the radiation , i.e. @xmath249_v = \\alpha t_g^3 $ ] , where @xmath250 is the gas temperature .",
    "the gas is not assumed to be in thermal equilibrium with the radiation field , so the gas and radiation temperatures may be different .    @xcite",
    "give a semi - analytic solution to the time - dependent behavior of the radiation energy density @xmath251 and gas temperature @xmath252 for this problem .",
    "they introduce the dimensionless position and time variables @xmath253 and @xmath254 and the `` retardation '' parameter @xmath255 , and show that the dimensionless radiation energy density @xmath256 \\\\ & = & 1 - \\frac{2\\sqrt{3}}{\\pi }   \\int_0^{1 } d\\eta\\ ; e^{-\\tau \\eta^2 } \\left\\{\\frac{\\sin[x\\gamma_1(\\eta)+\\theta_1(\\eta ) ] } { \\eta\\sqrt{3 + 4\\gamma_1 ^ 2(\\eta)}}\\right\\ }   \\nonumber \\\\ & & { } - \\frac{\\sqrt{3}}{\\pi } e^{-\\tau }   \\int_0 ^ 1 d\\eta\\ ; \\left(e^{-\\tau/(\\epsilon \\eta ) } \\right . \\nonumber \\\\ & & \\quad { } \\left.\\left\\{\\frac{\\sin[x\\gamma_2(\\eta)+\\theta_2(\\eta ) ] } { \\eta(1+\\epsilon\\eta)\\sqrt{3 + 4\\gamma_2 ^ 2(\\eta)}}\\right\\}\\right ) , \\label{uintegral}\\end{aligned}\\ ] ] where @xmath257 and @xmath258 the dimensionless gas energy density is @xmath259 \\\\ & = &   u(x,\\tau ) - \\frac{2\\sqrt{3}}{\\pi } \\int_0 ^ 1 d\\eta \\ ;",
    "\\left ( e^{-\\tau(1-\\eta^2 ) } \\right .",
    "\\nonumber \\\\ & & \\quad \\left .",
    "\\left\\ { \\frac { \\sin[x\\gamma_3(\\eta)+\\theta_3(\\eta ) ] } { \\sqrt { 4-\\eta^2 + 4\\epsilon\\eta^2(1-\\eta^2 ) } } \\right\\ }",
    "\\right ) \\nonumber \\\\ & & { } + \\frac{\\sqrt{3}}{\\pi } e^{-\\tau } \\int_0 ^ 1 d\\eta \\ ; \\left ( e^{-\\tau/(\\epsilon \\eta ) } \\right .",
    "\\nonumber \\\\ & & \\quad \\left .",
    "\\left\\ { \\frac { \\sin[x \\gamma_2(\\eta)+\\theta_2(\\eta ) ] } { \\eta\\sqrt{3 + 4\\gamma_2 ^ 2(\\eta ) } } \\right\\ } \\right ) , \\label{vintegral}\\end{aligned}\\ ] ] where @xmath260 numerical evaluation of the integrals ( [ uintegral ] ) and ( [ vintegral ] ) for @xmath12 and @xmath261 is not trivial because the integrands perform an infinite number of oscillations about zero as @xmath262 .",
    "correct computation of the result when @xmath36 is small and @xmath263 is large requires careful numerical analysis to ensure that the positive and negative contributions cancel properly ( j. bolstad , 2007 , in preparation ) .",
    "we compare the properly computed semi - analytic results for @xmath12 and @xmath261 to a calculation performed with orion using @xmath264 cm@xmath24 and @xmath266 ( so @xmath267 ) .",
    "the computational domain goes from @xmath268 to @xmath269 cm ( and thus to an optical depth @xmath270 ) , and is resolved by 100 equally - sized cells . for this test ,",
    "since we are comparing to a pure diffusion result , we set the flux limiter @xmath271 everywhere .",
    "figures [ marshakrad ] and [ marshakgas ] compare the semi - analytic dimensionless radiation and gas energy densities with the values computed by orion . at @xmath272",
    "the agreement is fairly poor due to low numerical resolution , since the wave only reaches an optical depth of @xmath273 and @xmath274 is the size of an individual computational cell .",
    "however , at later times when the wave is resolved by a reasonable number of cells , the agreement between the code result and the semi - analytic solution is excellent .",
    "we next compare to a test problem in which the gas is not at rest : a sedov - type blast wave with radiation diffusion .",
    "@xcite gave the first similarity solution to the problem of a point explosion with heat conduction , and following @xcite and @xcite , we can adapt this solution to the case of a point explosion with radiation diffusion .",
    "this tests our code s ability to follow coupled radiation - hydrodynamics in cases where radiation pressure is small .",
    "we first summarize the semi - analytic solution .",
    "consider an @xmath275 dimensional space filled with an adiabatic gas with equation of state @xmath276 , where @xmath277 is the gas constant .",
    "the planck mean opacity @xmath80 of the gas is very high , so the gas and radiation temperatures are always equal .",
    "the rosseland mean opacity has a powerlaw form @xmath278 , and we assume that it is always high enough to place us in the diffusion regime , so @xmath279 .",
    "note that the choice of @xmath280 as the exponent of the opacity powerlaw is a necessary condition for applying the @xcite conduction solution to our radiation diffusion problem .",
    "moreover , the similarity solution does not include radiation energy density or pressure , so we consider only temperatures for which the gas energy density and pressure greatly exceed the radiation energy density and pressure , i.e. @xmath281 .    under the assumptions described above , we may re - write the gas and radiation energy equations ( [ gasenergy ] ) and ( [ radenergy ] ) as a single conduction - type equation for the temperature , @xmath282 where @xmath283 is the constant - volume specific heat of the gas , @xmath284 , @xmath285 , and @xmath286 .",
    "this equation has the same form as the conduction equation considered by @xcite .",
    "consider now a point explosion at the origin of a spherically symmetric region with an initial powerlaw density distribution @xmath287 .",
    "initially the gas temperature @xmath288 and pressure @xmath44 are negligible .",
    "the explosion occurs at the origin at time zero , so the initial gas energy density is @xmath289 .",
    "@xcite show that if the initial density profile has a powerlaw index @xmath290 then one may obtain a similarity solution via the change of variables @xmath291 here , @xmath292 , @xmath293 , @xmath294 , and @xmath295 are the dimensionless distance , density , velocity , and temperature , @xmath296 and @xmath297 is a constant with units of @xmath298[\\mbox{time}]^{-\\alpha}$ ] whose value is determined by a procedure we discuss below .    with this similarity transformation , the equations of motion and heat conduction reduce to @xmath299',\\end{aligned}\\ ] ] and @xmath300 = \\mu ( 1-u ) [ \\ln(\\xi^2\\theta ) ] ' } \\nonumber \\\\ & & { } + \\beta_0 \\theta^b g^{a-1 } \\xi^{(2b-1)/\\alpha }   \\cdot \\left((\\ln \\theta ) '' + [ \\ln ( \\xi^2\\theta ) ] ' \\right .",
    "\\\\ & & \\left .",
    "{ } \\cdot   \\left\\{n-2+a[\\ln(\\xi^{-k_{\\rho } } g ) ] '   + ( b+1 ) [ \\ln ( \\xi^2 \\theta)]'\\right\\}\\right),\\end{aligned}\\ ] ] where @xmath301 , @xmath302 , and @xmath303 this constitutes a fourth - order system of non - linear ordinary differential equations .",
    "all physical solutions to these equations pass through two discontinuities , a heat front and a shock front , with the heat front at larger radius . however , the jump conditions for these discontinuities are easy to determine , and one can integrate between them . for a given @xmath304 ,",
    "the solution depends only on the dimensionless parameter @xmath305 which measures the strength of the explosion .",
    "large values of @xmath306 constitute `` strong '' explosions , and the ratio of heat front radius to shock front radius is a monotonically increasing function of @xmath306 .",
    "it is important at this point to add a cautionary note : in deriving the similarity solution , we assumed that radiation energy density is negligible in comparison to gas energy density .",
    "this can not strictly be true at early times , since at @xmath307 the temperature diverges at the origin , and the radiation energy density varies as @xmath288 to a higher power than the gas energy density .",
    "however , the true behavior should approach the similarity solution at later times .    while we have reduced the gas dynamical equations to a system of ordinary differential equations that is trivial to integrate , solving",
    "the full problem is complex because the equations still depend on the unknown parameter @xmath304 , which in turn depends on @xmath297 . to solve the problem",
    ", we must determine @xmath304 from the given initial conditions .",
    "@xcite describe the iteration procedure required to do this in detail , and we only summarize it here . to find a solution ,",
    "one first chooses a value @xmath308 for the dimensionless radius of the heat front , applies the boundary conditions at the front , and guesses a corresponding value of @xmath304 .",
    "for each @xmath309 there exists a unique @xmath304 for which it is possible to integrate the equations back from @xmath310 to the location of the shock front at @xmath311 , apply the shock jump conditions , and continue integrating back to the origin at @xmath312 without having the solution become double - valued and thus unphysical .",
    "one iterates to identify the allowed value of @xmath304 for the chosen @xmath309 , and this gives the unique density , velocity , and temperature profiles allowed for that @xmath309 .",
    "however , the solution one finds in this way may not correspond to the desired value of @xmath306 .",
    "@xcite show that @xmath313^{b-1/2}.\\ ] ] thus , each choice of @xmath309 corresponds to a particular value of @xmath306 , and one must iterate a second time to find the value of @xmath309 that gives the value of @xmath306 determined from the input physical parameters of the problem .",
    "alternately , instead of specifying a desired value of @xmath306 , one may specify a ratio @xmath314 , which also determines a unique value for @xmath309 .",
    "for our comparison between the semi - analytic solution and orion , we adopt the parameters @xmath315 , @xmath316 , @xmath317 , @xmath318 , @xmath319 , and @xmath320 , which yields a strength @xmath321 and a ratio @xmath322 . in the simulation , we turn off terms in the code involving radiation pressure and forces , and we set @xmath271 exactly .",
    "we use one - dimensional spherical polar coordinates rather than cartesian coordinates ; the solution procedures for this are identical to the ones outlined in   [ algorithm ] , with the exception that the gradient and divergence operators have their spherical rather than cartesian forms , and the cell - centered finite differences are modified appropriately .",
    "our computational domain goes covers @xmath323 , resolved by 256 , 512 , or 1024 cells , and has reflecting inner and outer boundary conditions . to initialize the problem we set initial density to the powerlaw profile @xmath324 ( with @xmath325 set from equation [ krhoeq ] ) , the initial velocity to zero , and the initial energy density to a small value , except in the cell adjacent to the origin , where its value is @xmath326 .",
    "figures [ blastwaveden ] , [ blastwavevel ] , and [ blastwavetemp ] compare the semi - analytic density , velocity , and temperature profiles to the values we obtain from orion after running to a time @xmath327 . as the plots show , the orion results agree very well with the semi - analytic solution , and the agreement improves with increasing resolution . in the lowest resolution run , there is a small oscillation in the density and velocity about a third of the way to the shock , which is likely due to the initial blast energy being deposited in a finite - volume region rather than as a true @xmath328 function .",
    "however , this vanishes at higher resolutions .",
    "overall , the largest errors are in the temperature in the shocked gas .    as a metric of convergence , we plot the error of our simulation relative to the analytic solution as a function of resolution in figure [ blastwaveerr ] .",
    "we do this for the quantities @xmath329 and @xmath330 , the positions of the shock and heat fronts , and their ratio @xmath331 . for this purpose",
    ", we define the location of the heat and shock fronts for the simulations as the positions of the cell edges where @xmath332 and @xmath333 are most negative . as the plot shows , at the highest resolution the errors in all three quantities are @xmath334 , and the calculation appears to be converging .",
    "the order of convergence is roughly 0.6 in all three quantities .",
    "it is worth noting that computing the locations of the heat and shock fronts is a particularly strong code test , because obtaining the correct propagation velocities for the two fronts requires that the code conserve total energy very well .",
    "non - conservative codes have significant difficulties with this test @xcite .",
    "our third test is to simulate a tube filled with radiation and gas .",
    "the gas within the tube is optically thick , so the diffusion approximation applies .",
    "the two ends of the tube are held at fixed radiation and gas temperature , and radiation diffuses through the gas from one end of the tube to the other .",
    "the radiation flowing through the tube exerts a force on the gas , and the gas density profile is such that , with radiation pressure , the gas is in pressure balance and should be stationary . for computational simplicity , we set the rosseland- and planck - mean opacities per unit mass of the gas to a constant value @xmath9 . a simulation of this system tests our code s ability to compute accurately the radiation pressure force in the very optically thick limit .",
    "we first derive a semi - analytic solution for the configuration of the tube satisfying our desired conditions . since the gas is very optically thick and we are starting the system in equilibrium , we set @xmath335 .",
    "the fluid is initially at rest .",
    "the condition of pressure balance amounts to setting @xmath336 in equation ( [ momentumconservation ] ) , so that the radiation pressure force balances the gas pressure gradient .",
    "thus , we have @xmath337 in the second step we have set @xmath338 and @xmath339 , where @xmath340 is the mean particle mass , and we have set @xmath271 as is appropriate for the optically thick limit . the radiation energy equation ( [ radenstatdiff ] ) for our configuration",
    "is simply @xmath341    equations ( [ radtube1 ] ) and ( [ radtube2 ] ) are a pair of coupled non - linear ordinary differential equations for @xmath288 and @xmath41 .",
    "the combined degree of the system is three , so we need three initial conditions to solve them . thus , let the tube run from @xmath342 to @xmath343 , with temperature , density , and density gradient @xmath60 , @xmath344 , and @xmath345 at @xmath346 .",
    "for a given choice of initial conditions , it is trivial to solve ( [ radtube1 ] ) and ( [ radtube2 ] ) numerically to find the density and temperature profile .",
    "we wish to investigate both the radiation pressure and gas pressure dominated regimes , so we choose parameters to ensure that our problem covers both . the choice @xmath347 , @xmath348 cm , @xmath349 g @xmath28 , @xmath350 g @xmath351 , and @xmath352 k satisfies this requirement if we adopt @xmath353 g and @xmath354 @xmath26 g@xmath24 .",
    "figure [ radtubesol ] shows the density , temperature , and pressure as a function of position for these parameters .",
    "we solve the equations to obtain the density and temperature as a function of position , and then set these values as initial conditions in a simulation .",
    "the simulation has 128 cells along the length of the tube on the coarsest level .",
    "we impose dirichlet boundary conditions on the radiation field , with the radiation temperature at each end of the tube set equal to its value as determined from the analytic solution .",
    "we use symmetry boundary conditions on the hydrodynamics , so that gas can neither enter nor leave the computational domain . to ensure that our algorithm does not encounter problems at the boundaries between amr levels , we refine the central @xmath355 of the problem domain to double the resolution of the base grid .",
    "we evolve the system for 10 sound crossing times and measure the amount by which the density and temperature change relative to the exact solution .",
    "we plot the relative error , defined as ( numerical solution @xmath356 analytic solution ) / ( analytic solution ) , in the density , gas temperature , and radiation temperature in figure [ radtubeerr ] .",
    "as the plot shows , our numerical solution agrees with the analytic result to better than @xmath357 throughout the computational domain .",
    "the density error is smallest in the higher resolution central region , as expected .",
    "there is a very small increase in error at level boundaries , but it is still at the less than @xmath357 level .      the previous test focuses on radiation pressure forces in the optically thick limit . to test the optically thin limit ,",
    "we simulate accretion onto a radiating point particle .",
    "we consider a point mass @xmath358 radiating with a constant luminosity @xmath359 accreting from a background medium .",
    "the medium consists of gas which has zero velocity and density @xmath360 far from the particle .",
    "we take the gas to be isothermal with constant temperature @xmath288 , and enforce that it is not heated or cooled radiatively by setting its planck opacity @xmath361 .",
    "we set the rosseland opacity of the gas to a constant non - zero value @xmath78 , and choose @xmath360 such that the computational domain is optically thin . in this case",
    ", the radiation free - streams away from the point mass , and the radiation energy density and radiative force per unit mass on the gas are @xmath362 where @xmath363 is the radial vector from the particle and @xmath33 is its magnitude .",
    "the gravitational force per unit mass is @xmath364 , so the net force per unit mass is @xmath365 where @xmath366 is the fraction of the eddington luminosity with which the point mass is radiating .",
    "since the addition of radiation does not alter the @xmath367 dependence of the specific force , the solution is simply the standard @xcite solution , but for an effective mass of @xmath368 .",
    "the accretion rate is the bondi rate @xmath369 where @xmath370 is the bondi radius for the effective mass , @xmath371 is the gas sound speed at infinity , and @xmath292 is a numerical factor of order unity that depends on the gas equation of state . for an isothermal gas , @xmath372 , and the radial profiles of the non - dimensional density @xmath373 and velocity @xmath374 are given by the solutions to the non - linear algebraic equations @xcite @xmath375 where @xmath376 is the dimensionless radius .",
    "to set up this test , we make use of the lagrangian sink particle algorithm of @xcite , coupled with the `` star particle '' algorithm of @xcite which allows the sink particle to act as a source of radiation .",
    "we refer readers to those papers for details on the sink and star particle algorithms .",
    "we simulate a computational domain @xmath377 cm on a side , resolved by @xmath378 cells , with a particle of mass @xmath379 @xmath380 and luminosity @xmath381 @xmath382 at its center . we adopt fluid properties @xmath383 g @xmath28 , @xmath384 @xmath26 g@xmath24 , and @xmath385 cm s@xmath24 , corresponding to a gas of pure , ionized hydrogen with a temperature of @xmath386 k. with these values , @xmath387 , @xmath388 cm , and @xmath389 g s@xmath24 .",
    "we use inflow boundary conditions on the gas and dirichlet boundary conditions on the radiation field , with the radiation energy density on the boundary set to the value given by equation ( [ eanalyt ] ) .",
    "figure [ bondisol ] compares the steady - state density @xmath390 and velocity @xmath12 computed by orion to the analytic solution .",
    "the agreement is excellent , with differences between the analytic and numerical solutions of @xmath391 everywhere except very near the accretion radius at @xmath392 .",
    "the maximum error is @xmath393 at the surface of the accretion region ; this is comparable to the error in density for non - radiative bondi accretion with similar resolution in @xcite . in comparison ,",
    "the solution is nowhere near the solution that would be obtained without radiation . after running for @xmath394 bondi times ( @xmath395 ) ,",
    "the average accretion rate is @xmath396 g s@xmath24 .",
    "while this differs from the analytic solution by @xmath397 , the error is also not tremendously different from that obtained by @xcite when the bondi radius was resolved by 4 accretion radii , and is nowhere near the value of @xmath398 g s@xmath24 which would occur without radiation .",
    "we should at this point mention one limitation of our algorithm , as applied on an adaptive grid , that this test reveals .",
    "the @xmath367 gradient in the radiation energy density is very steep , and we compute the radiation force by computing gradients in @xmath45 .",
    "we found that , in an amr calculation , differencing this steep gradient across level boundaries introduced significant artifacts in the radiation pressure force .",
    "with such a steep gradient , we were only able to compute the radiation pressure force accurately on fixed grids , not adaptive grids .",
    "this is not a significant limitation for most applications though , since for any appreciable optical depth the gradient will be much shallower than @xmath367 . as the radiation pressure tube test in   [ radtube ] demonstrates , in an optically thick problem the errors that arise from differencing across level boundaries are less than 1% .",
    "the previous two tests check our ability to compute the radiation pressure force accurately in the optically thick and optically thin limits .",
    "however , they do not strongly test radiation advection by gas . to check this ,",
    "we simulate a diffusing , advecting radiation pulse .",
    "the initial condition is a uniform background of gas and radiation far from the pulse .",
    "centered on @xmath399 there is an increase in the radiation energy density and a corresponding decrease in the gas density , so that the initial condition is everywhere in pressure balance . as radiation diffuses out of the pulse , pressure support",
    "is lost and the gas moves into the lower density region .",
    "we can not solve this problem analytically , but we can still perform a very useful test of the methodology by comparing a case in which the gas is initially at rest with respect to the computational grid with a case in which the gas is moving at a constant velocity with respect to the grid .",
    "the results should be identical when shifted to lie on top of one another , but the work and advection terms will be different in the stationary case than in the advected case . checking that the results do not change when we advect the problem enables us to determine if our code is correctly handling the advection of radiation by the gas .    for our simulations ,",
    "we use equal initial gas and radiation temperatures , with temperature and density profiles @xmath400 with @xmath401 k , @xmath402 k , @xmath403 g @xmath28 , @xmath404 cm , @xmath405 g , and @xmath354 @xmath26 g@xmath24 .",
    "the density , temperature , and pressure profiles are shown in figure [ radadvectsetup ] . in the bottom panel ,",
    "the solid line is the total pressure , the dashed line is the gas pressure , and the dot - dashed line is the radiation pressure . as the figure indicates , the system is initially in pressure balance .",
    "we compare two runs , one where the velocity is zero everywhere and another with a uniform initial velocity @xmath406 cm s@xmath24 in the @xmath263 direction . in both",
    "runs the simulation domain extends from @xmath407 to @xmath408 cm , resolved by 512 cells with no adaptivity .",
    "we use periodic boundary conditions on the gas and the radiation , and run for @xmath409 s , long enough for the pulse to have been advected over its own initial width twice .    to check our results",
    ", we shift the advected run by 48 cm in the @xmath410 direction , so that it should lie on top of the unadvected run .",
    "figure [ radadvectfinal ] shows the configuration of the advected and unadvected runs at this point . we then plot the relative difference between the advected and unadvected runs , defined as @xmath411 , in figure [ radadvecterr ] .",
    "we do not differentiate between the gas and radiation temperatures , because they are identical at the @xmath412 level .",
    "we do not plot the error in velocity because the velocities in the unadvected run are close to zero over most of the computational domain .",
    "as the plot shows , the difference between the advected and unadvected runs is less than @xmath413 everywhere in the simulation .",
    "we derive the correct equations for mixed frame flux - limited diffusion radiation hydrodynamics .",
    "the error in our equations if of order @xmath2 in the static diffusion limit , and of order @xmath0 in the dynamic diffusion and streaming limits .",
    "we give the equations in a form that is well - suited to implementation in numerical simulations , because they make it trivial to maintain exact conservation of total energy .",
    "our analysis reveals that lower order formulations of the equations , which neglect differences between the laboratory and comoving frames , are incorrect at order unity for systems in the dynamic diffusion limit .",
    "it remains to be seen how serious this defect is in practice , but analytic arguments suggest that at a minimum one ought to be very careful in applying zeroth order codes to problems where there are interesting or important structures on scales for which @xmath201 .",
    "we give the equations that are correct to leading order for dynamic diffusion , which do not suffer from this problem .",
    "our analysis also reveals that , for static diffusion problems , one can obtain a significant algorithmic simplification and speedup compared to algorithms based on comoving frame formulations of the equations by treating non - dominant radiation terms explicitly rather than implicitly .",
    "this advance is possible even though the underlying equations of our method conserve total energy to machine precision while comoving frame formulations of the equations do not .",
    "this property is particularly important for flows that are turbulent or otherwise involve large gradients in gas or radiation properties , since these are the problems most likely to suffer from numerical non - conservation .",
    "we demonstrate an implementation of this method in the orion adaptive mesh refinement code , and show that it provides excellent agreement with analytic and semi - analytic solutions in a series of test problems covering a wide range of radiation - hydrodynamic regimes .",
    "we thank j.  i. castor and j.  m. stone for helpful comments on the manuscript , and t.  a. thompson for helpful discussions .",
    "we also thank the referee for comments that improved the paper .",
    "support for this work was provided by nasa through hubble fellowship grant # hsf - hf-01186 awarded by the space telescope science institute , which is operated by the association of universities for research in astronomy , inc .",
    ", for nasa , under contract nas 5 - 26555 ( mrk ) ; nasa atp grants nag 5 - 12042 and nng06gh96 g ( rik and cfm ) ; the us department of energy at the lawrence livermore national laboratory under contract w-7405-eng-48 ( rik and jb ) ; and the nsf through grants ast-0098365 and ast-0606831 ( cfm ) .",
    "this research was also supported by grants of high performance computing resources from the arctic region supercomputing center ; the nsf san diego supercomputer center through npaci program grant ucb267 ; the national energy research scientific computing center , which is supported by the office of science of the u.s .",
    "department of energy under contract no .",
    "de - ac03 - 76sf00098 , through ercap grant 80325 ; and the us department of energy at the lawrence livermore national laboratory under contract w-7405-eng-48 .",
    "here we show that the emission minus absorption term @xmath414 is of order @xmath415 in the dynamic diffusion limit .",
    "@xcite argue that in this limit @xmath414 is of order @xmath416 . however , this conclusion is based on their analysis of the second order equilibrium diffusion approximation ( * ? ? ?",
    "461 - 466 ) , in which they retain terms of order @xmath111 while dropping those of order @xmath39 .",
    "while this is correct for static diffusion , in the dynamic diffusion limit @xmath417 , so the approach in @xcite is not consistent , and is insensitive to terms of order @xmath39",
    ".    we will not give a general proof that @xmath418 for dynamic diffusion , but we can establish it by a simple thought experiment . consider a system that is infinitely far into the dynamic diffusion limit , in the sense that @xmath419 : an infinite uniform medium that is at rest and in perfect thermal equilibrium between the radiation field and the gas .",
    "in the rest frame of the medium , these assumption require @xmath420 , @xmath421 , and @xmath422 .",
    "now consider an observer moving at velocity @xmath42 relative to the medium .",
    "in the observer s frame , @xmath423 is the same because the gas temperature @xmath60 is a world - scalar , and the lorentz transform to all orders for the energy gives @xmath424",
    "\\left(\\frac{4 \\pi b}{c}\\right ) \\\\ & = & \\left(\\frac{4 \\pi b}{c}\\right ) \\left[1 + \\frac{4}{3}\\left(\\frac{v^2}{c^2}\\right ) + o\\left(\\frac{v^4}{c^4}\\right)\\right].\\end{aligned}\\ ] ] thus , for this case it is clear that @xmath418 to leading order .",
    "note that using the correct scaling is necessary to obtain sensible behavior from the equations in the dynamic diffusion limit .",
    "if one assumes that @xmath425 , then in the gas and radiation energy equations ( [ gasenergy ] ) and ( [ radenergy ] ) in the dynamic diffusion limit , the term @xmath426 e$ ] is of higher order than any other term except perhaps the time derivative .",
    "since this term is non - zero for any system with non - zero velocity , opacity , and radiation energy density , this means that there would be no way for the time derivative term to ever vanish .",
    "thus , a system in the dynamic diffusion limit could never be in equilibrium unless its velocity or radiation energy were zero everywhere .",
    "clearly this can not be correct , since it predicts that our static , infinite , uniform medium can not be in equilibrium when seen by an observer moving by at velocity @xmath42 , even though it is manifestly in equilibrium in its own rest frame . on the other hand ,",
    "if we take @xmath427 , as computed from the lorentz transform , it is trivial to verify that equations ( [ gasenergy ] ) and ( [ radenergy ] ) correctly give @xmath428 , and @xmath429 as well .",
    "the observer sees a flux that does work on the gas , but this is precisely canceled by a mismatch between emission and absorption of radiation by the gas , leading to zero net energy transfer ."
  ],
  "abstract_text": [
    "<S> we analyze the mixed frame equations of radiation hydrodynamics under the approximations of flux - limited diffusion and a thermal radiation field , and derive the minimal set of evolution equations that includes all terms that are of leading order in any regime of non - relativistic radiation hydrodynamics . </S>",
    "<S> our equations are accurate to first order in @xmath0 in the static diffusion regime . </S>",
    "<S> in contrast , we show that previous lower order derivations of these equations omit leading terms in at least some regimes . in comparison to comoving frame formulations of radiation hydrodynamics , </S>",
    "<S> our equations have the advantage that they manifestly conserve total energy , making them very well - suited to numerical simulations , particularly with adaptive meshes . for systems in the static diffusion regime </S>",
    "<S> , our analysis also suggests an algorithm that is both simpler and faster than earlier comoving frame methods . </S>",
    "<S> we implement this algorithm in the orion adaptive mesh refinement code , and show that it performs well in a range of test problems . </S>"
  ]
}