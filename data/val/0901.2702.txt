{
  "article_text": [
    "the solar dynamic observatory will be launched from cape canaveral in june 2009 / 2010 on an atlas v booster . on board this satellite there will be several instruments dedicated to the study of the solar photospheric and coronal magnetic fields and their relation to the interplanetary medium , space weather and earth climatology .",
    "the helioseismic and magnetic imager is an instrument developed at stanford university , lockheed - martin solar and astrophysics laboratory and at the high altitude observatory .",
    "hmi consists of a combination of a lyot filter and two michelson interferometers . between the two michelson there is a set of three 10th order retarders : @xmath1 , @xmath2 and @xmath1 .",
    "located after these , there is a beam splitter that divides the light between two twin 4096@xmath04096 ccd cameras .",
    "each camera will acquire full - disk images of the sun with a pixel size of 0.5 arcsec .",
    "the first camera , to be referred to as _ doppler camera _ , will be devoted to the measurement of the right and left circular polarization , @xmath3 , at 6 wavelength positions across the fe i ( @xmath4=2.5 ) 6173.35    line every 50 seconds or less . with this",
    ", full disk maps of the line of sight components of the magnetic field and velocity will be produced with a 50 second cadence for helioseismic studies .",
    "the second one , hereafter referred to as _ vector camera _ , will measure the full stokes vector @xmath5 at the same wavelengths as the doppler camera .",
    "the cadence in the vector camera will be about 120 seconds .",
    "borrero et al .",
    "( 2007 ) have conducted a detailed study of the vector camera performance , and concluded that photon noise and p - mode cross - talk between the different stokes parameters makes the 2-minute data inappropriate to determine the magnetic field vector with the desired degree of accuracy .",
    "they suggest averaging the observed stokes vector every 10 minutes before it is inverted .    therefore our objective has been to create an inversion code for the radiative transfer equation able to process 13.5 million pixels in 10 minutes : _ 22500 pixels",
    "/ second_. our task benefits from the fact that each pixel is treated independently , and therefore our problem can be parallelized in a straight - forward fashion , resulting in a time saving which is directly proportional to the number of cpus employed . consequently , very fast ( _ 3000 - 10000 pixels / second _ ) inversion strategies such a principal component analysis ( pca ; rees et al .",
    "2000 ; socas - navarro et al .",
    "2001 ) or artificial neural networks ( anns ; socas - navarro 2003 , 2005 ) could meet the hmi requirements with a very small number of cpus . without entering into details about the different methods , their accuracy and robustness ( an interested reader is referred to the recent reviews by del toro iniesta 2003a and bellot rubio 2006 ) ,",
    "it is generally acknowledged that these fast inversion techniques retrieve a magnetic field vector that is more suitable for a qualitative analysis such as active region evolution and tracking , global magnetic field appearance .",
    "our aim with hmi is to provide the magnetic field vector on the solar surface with an accuracy good enough to carry out more quantitative studies .",
    "a further concern , from the point of view of hmi characteristics and scientific objectives , is the fact that current implementations of anns do not allow to obtain a measure of the goodness of the inversion , e.g. @xmath6 .",
    "pca does retrieve such a measure in terms of the so - called pca distance .",
    "however , principal component analysis is usually employed to reduce the dimensionality of the problem ( e.g. by inverting the first pca or fourier coefficients of the observed stokes vector ) .",
    "it is unclear how pca will perform when inverting data from filtergram instruments , such as hmi , where the number of data points is already very small ( six points in wavelength across the four stokes parameters ) .    a good compromise between accuracy and speed is achieved by traditional iterative non - linear squares fitting algorithms , specially if applied to the milne - eddington ( m - e ) solution of the radiative transfer equation ( landolfi & landi deglinnocenti 1982 ) .",
    "the reason for this lies in the simplified thermodynamics of this approximation , that avoids tedious iterative calculations and evaluations of the partial pressures , ionization and hydrostatic equilibrium , etc ( ruiz cobo 2006 ) .",
    "in addition , the analytical nature of the m - e solution allows to calculate also analytical derivatives , which significantly speeds up the inversion process .",
    "the first m - e inversion code that fully takes into account magneto - optical effects dates back , to the best of our knowledge , to auer et al .",
    "( 1977 ) ( see also skumanich & lites 1987 ) .",
    "this has been for many years the standard inversion technique employed in the analysis of advance stokes polarimeter data ( asp ; previously stokes ii : baur et al . 1981 ) ,",
    "and thus it is widely known as the hao / asp inversion code . as a consequence of the increase in the cpus speed since the late 80 s",
    ", the hao / asp code has gone from inverting several pixels per hour to about _ 10 pixels / second_. thus , meeting hmi s goal would require more than 2000 cpus .",
    "clearly further modifications and refinements over these type of m - e inversion codes are necessary if we are to meet hmi s requirements with a limited number ( @xmath760 ) of cpus .    after a brief introduction to stokes inversion ( section 2 )",
    ", we have divided these modifications into three groups : those made on the synthesis module of the code ( section 3 ) ; modifications made on the inversion module of the code ( section 4 ) , and implementation of an accurate initial guess model for the inversion process ( section 5 ) . in section 6",
    "we present a study of the inversion code s profile and speed .",
    "section 7 shows results obtained from the application of vfisv to hinode / sp data and finally , section 8 summarizes our results .",
    "in this section we will describe very briefly how a stokes inversion code typically works .",
    "the idea is to familiarize the reader with the common procedures and nomenclature to facilitate the understanding of the following sections .",
    "more details about this topic can be found in ( with different levels of complexity ) ruiz cobo & del toro iniesta ( 1992 ) , frutiger ( 2001 ) , del toro iniesta ( 2003b ) , borrero ( 2004 ) and references therein .",
    "the basic idea of any stokes inversion code is to iteratively fit the observed stokes vector at each wavelength position @xmath8 is the total intensity , @xmath9 and @xmath10 are the linear polarization profiles and @xmath11 is the circular polarization . ] .",
    "this fit is done by producing a synthetic stokes vector @xmath12 , that it is then compared at each wavelength position with the observed one via the @xmath6 of the fit :    @xmath13 ^ 2 \\frac{w_{ij}^2}{\\sigma_i^2}\\ ] ]    where @xmath14 is the number of wavelength points observed ( @xmath15 in hmi s case ) and @xmath16 is the number of free parameters .",
    "therefore @xmath17 refers to number of degrees of freedom in the inversion . @xmath18 and",
    "@xmath19 refer to each of the 4 stokes parameters ( @xmath20 index ) at each wavelength position ( @xmath21 index ) for both the observed and synthetic stokes vector .",
    "section 4.3 discusses in detail the parameters @xmath22 and @xmath23 .",
    "the synthetic profiles depend on a series of model parameters @xmath24 with @xmath25 .",
    "these parameters define the physical model that we presume as valid : lte , non - lte , multi - component atmospheres , gradients along the line - of - sight , etc . in the case of a milne - eddington atmosphere ,",
    "these typically are : @xmath26 .",
    "the first 5 of them are the thermodynamic parameters : source function at the base of the photosphere ( @xmath27 ) , gradient of the source function ( @xmath28 ) , center to continuum absorption coefficient ( @xmath29 ) , damping ( @xmath30 ) , and doppler width of the spectral line ( @xmath31 ) .",
    "the next three refer to the three components of the magnetic field vector : strength @xmath32 , inclination with respect to the observer @xmath33 , and azimuth of the magnetic field vector in the plane perpendicular to the observer @xmath34 .",
    "the following two are kinematic parameters : line - of - sight velocity of the plasma harboring the magnetic field ( @xmath35 ) , and the macroturbulent velocity ( @xmath36 ; used to model unresolved velocity fields ) .",
    "the last parameter , @xmath37 , is a geometrical parameter that defines what portion of the resolution element is filled with a magnetized plasma .",
    "@xmath12 is computed in the synthesis module of the inversion code .",
    "this module also retrieves the @xmath16 derivatives of the synthetic stokes vector with respect to the model parameters ( free parameters ) : @xmath38 .",
    "once the synthetic stokes profiles are obtained , we can determine the @xmath6 of the fit ( equation 1 ) .",
    "with the derivatives it is possible to compute @xmath39 , which is f - dimensional vector where each of its components can be expressed as :    @xmath40    we can also compute the modified hessian matrix : @xmath41 .",
    "this matrix is basically the regular hessian matrix , where second derivatives have been neglected and where the diagonal elements are modified by means of a parameter @xmath42 :    @xmath43 ^ 2\\end{aligned}\\ ] ]    according to the recipe of the levenberg - mardquart algorithm , using @xmath39 and @xmath41 allows us to determine the perturbations , @xmath44 , that must be applied to the model parameters at iteration @xmath45 , @xmath46 , in order to improve @xmath6 .",
    "@xmath47    @xmath48    to avoid singularities in the inversion of the modified hessian matrix ( equation 5 ) the singular value decomposition method is often employed .",
    "once the new model parameters @xmath49 have been determined , the synthesis module is called again to produce the synthetic stokes vector and its derivatives , as depicted in figure 1 .",
    "then , a new @xmath6 is computed and the iteration continues .",
    "vfisv will be employed for the automatic inversion of data of the fe i ( @xmath50=2.5 ) 6173.33     line ( see table 1 ) .",
    "therefore a straightforward implementation of its zeeman pattern can be hardcoded into the inversion code , avoiding needless extra calculations using the quantum numbers @xmath14 , @xmath51 and @xmath52 of the atomic levels involved .",
    ".atomic parameters for the lower and upper levels of the atomic transition originating the fe i 6173.33    spectral line ( from nave et al .",
    "the land factors have been calculated in the ls approximation ( see for example eq .  8.30 in del toro iniesta ( 2003b ) . [ cols=\"^,^\",options=\"header \" , ]",
    "in this section we present results from the application of vfisv to spectropolarimetric data from hinode / sp . we have used here two different data sets .",
    "they correspond to observations carried out on november 14 , 2006 and may 3 , 2007 respectively .",
    "both datasets encompass active regions ar 10923 and 10953 , which were located at around @xmath53 .",
    "the second dataset has already been used in our experiments in sections 4.1 and 6 .",
    "they are comprised by a set of 538 and 1000 fits files , therefore having 550,912 and 1,024,000 stokes profiles , respectively . since hinode / sp observes the fe i lines at 6301.5 and 6302.5    we have trimmed the observations to use only the second spectral line ( see section 3.1 ) .",
    "after that , we convolved the original observations with the theoretical filter profiles from hmi , to reduce the number of wavelength positions to 6 .",
    "each map has been inverted using a quad - core ( 4-cpus ) intel xeon machine at 2.66 ghz .",
    "the first map was inverted in 227.13 seconds , whereas the second one was ready after 405.88 seconds .",
    "this translates into a speed of 606.38 and 630.73 profiles / sec / cpu .",
    "thus , inverting 22500 profiles / seconds ( as requested by hmi ; see section 1 ) is possible with only 35 - 40 cpus .",
    "maps of the magnetic field strength for these two regions are presented in figure 9 . for better visualization only the regions around the two sunspots",
    "are displayed ( the original maps are 86``@xmath0164 '' and 163``@xmath0164 '' ) .",
    "we have also tested vfisv with more than 1000 maps available from the hinode / sp database that have been verified for level-1 ( bruce lites , _ private communication _ ) .",
    "we have found that vfisv yields adequate results for all kind of structures : network , plage , sunspots , etc .",
    "the main issues that we have found are :    * we have observed systematic errors in the umbra of those sunspots , when these are located very close to the limb ( @xmath54 ) . * when inverting using a filling factor ( @xmath37 free ) about 1 - 2 % of pixels in the very quiet sun regions ( e.g. internetwork ) yield inadequate results .",
    "these are characterized by very large magnetic field strength , @xmath55 gauss , and very small magnetic filling factors : @xmath56 . * in sunspots where the magnetic field is extremely high in the umbra , @xmath55 gauss , we observe saturation effects in the magnetic field strength whenever we invert only 6 wavelength positions .",
    "this effect disappears when using the full spectral profile .",
    "we have developed an inversion code for the polarized radiative transfer equation .",
    "the code s name is vfisv : very fast inversion of the stokes vector .",
    "this code assumes that the properties of the solar photosphere are well described by the milne - eddington approximation .",
    "it will be employed to routinely invert polarimetric data from the heliseismic and magnetic imager ( hmi ) that will fly on - board of the solar dynamics observatory ( sdo ) in june 2009/2010 .",
    "the code is written in fortran 90 and parallelized with mpich-2 .",
    "we have introduced a number of improvements in this code that makes it able to achieve an inversion speed of about 600 pixels per seconds per cpu . at this pace",
    "it will be possible to provide solar full - disk maps ( with 1 \" resolution ) of the solar magnetic field vector every 10 minutes , using less than 40 cpus .",
    "the code has been tested with observations from the spectropolarimeter onboard hinode .",
    "it is freely available for download through the community spectro - polarimetric analysis center initiative at the high altitude observatory and national center for atmospheric research ( lites et al .",
    "2007 ; http://www.hao.ucar.edu/projects/csac/ ) .",
    "auer , l.h . ,",
    "house , l.l .",
    "& heasley , j.n .",
    "1977 : _ solar phys _ , 55 , 47 - 61 baur , t.g . , elmore , d.e . ,",
    "lee , r.h , qerfeld , c.w . & rogers , s.r .",
    "1981 : _ solar phys _ , 70 , 395 bellot rubio , l.r .",
    "2006 : asp conference series , 358 , 107 .",
    "proceedings of the solar polarization workshop 4 in boulder , colorado , usa .",
    "eds : roberto casini and b.w .",
    "lites bishop , c.m .",
    "1994 : neural networks for pattern recognition .",
    "oxford university press , 1994 .",
    "borrero , j.m .",
    ", tomczyk , s. , norton , a. , darnell , t. , schou , j. , scherrer , p. , bush , r. & liu , y. 2007 : _ solar phys _ , 240 , 177 borrero , j.m . ,",
    "lites , b.w . & solanki , s.k . 2008 : a&a , 481 , l13-l16 borrero , j.m . &",
    "solanki , s.k .",
    "2008 : apj , 687 , 668 - 677 borrero , j.m . : 2004 , phd thesis , gttingen univertity ( germany ) , published by copernicus gmbh .",
    "isbn 3 - 936596 - 33 - 0 del toro iniesta , j.c .",
    "2003a : astronomische nachrichten , 324 , no.4 , 383 del toro iniesta , j.c .",
    "in introduction to spectropolarimetry . cambridge university press , 2003b .",
    "isbn : 0521818273 jefferies , j.t .",
    "& mickey , d.l .",
    "1991 : apj , 372 , 694 - 702 hui , a.k . ,",
    "armstrong , b.h .",
    "& wray , a.a . 1977 : jqstr , 18 , 509 - 516 kosugi , t. , matsuzaki , k. , sakuo , t. et al .",
    "2007 : _ solar physics _ , 243 , 3 letchworth , k.l . & benner , d.c 2007 : jqsrt , 107 , 173 - 192 lites , b.w .",
    ", elmore , d.f .",
    "& streander , k.v .",
    "2001 : asp conf .",
    "series , vol 236 .",
    "advanced solar polarimetry .",
    "m.  sigwarth ( san francisco : asp ) nave , g. , johansson , s. , learner , r.c.m . & thorne , p. 1994 : apjs , 94 , 221 - 459 neckel , h. & labs , d. 1994 : _ solar phys _ , 153 , 91 - 114 landolfi , m. & landi deglinnocenti , e. 1982 : _ solar phys _ , 78 , 355 lites , b. , casini , r. , garcia , j. & socas - navarro , h. 2007 : memorie della societa astronomica italiana , 78 , 148 orozco surez & del toro iniesta , j.c . : 2007 , a&a , 462 , 1137 - 1145 press , w. , flannery , b. , teukolsky , s. & vetterling , w. 1986 : numerical recipes - the art of scientific computing .",
    "cambridge : cambridge university press .",
    "rees , d.e .",
    ", lpez ariste a. , thatcher , j. & semel , m. 2000 : a&a , 355 , 759 .",
    "ruiz cobo , b. 2006 : modern solar facilities - advanced solar science , proceedings of a workshop held at gttingen september 27 - 29 , 2006 isbn 978 - 3 - 938616 - 84 - 0 . published by universittsverlag gttingen .",
    "skumanich , a. & lites , b.w .",
    "1987 : apj , 322 , 473 socas - navarro , h. , lpez ariste , a. & lites , b.w . 2001 : apj , 553 , 949 socas - navarro , h. : 2003 , neural networks , 16 , 355 socas - navarro , h. : 2005 , apj , 621 , 545 unsold , a. : 1955 , physik der sternatmospharen .",
    "berlin , springer .",
    "westendorp plaza , c. , del toro iniesta , j.c .",
    ", ruiz cobo , b. , martnez pillet , v. , lites , b.w . & skumanich , a. 1998 : apj , 494 , 453 wittmann , a. : 1974 , _ solar phys _ , 35"
  ],
  "abstract_text": [
    "<S> in this paper we describe in detail the implementation and main properties of a new inversion code for the polarized radiative transfer equation ( vfisv : very fast inversion of the stokes vector ) . </S>",
    "<S> vfisv will routinely analyze pipeline data from the helioseismic and magnetic imager ( hmi ) on - board of the solar dynamics observatory ( sdo ) . </S>",
    "<S> it will provide full - disk maps ( 4096@xmath04096 pixels ) of the magnetic field vector on the solar photosphere every 10 minutes . </S>",
    "<S> for this reason vfisv is optimized to achieve an inversion speed that will allow it to invert 16 million pixels every 10 minutes with a modest number ( approx . </S>",
    "<S> 50 ) of cpus . here </S>",
    "<S> we focus on describing a number of important details , simplifications and tweaks that have allowed us to significantly speed up the inversion process . </S>",
    "<S> we also give details on tests performed with data from the spectropolarimeter on - board of the hinode spacecraft .    </S>",
    "<S> example.eps gsave newpath 20 20 moveto 20 220 lineto 220 220 lineto 220 20 lineto closepath 2 setlinewidth gsave .4 setgray fill grestore stroke grestore </S>"
  ]
}