{
  "article_text": [
    "this paper describes our computer program speden that reconstructs the density from the diffraction patterns of individual particles .",
    "speden is of interest for three reasons .",
    "diffractive imaging promises to improve the resolution , sensitivity , and practical wavelength range in x - ray microscopy , for three - dimensional objects that are tolerant to x - rays .",
    "a few examples are defects in semiconductor structures , phase separation in alloys , nano - scale machines and laser fusion targets .",
    "a long - term vision is the possibility of high - resolution reconstruction of diffraction patterns of single bio - molecules . of broad theoretical interest",
    "is speden s unique approach to the reconstruction of scatterers - a difficult mathematical problem . in the rest of this section",
    "we expand on these three topics .",
    "reconstruction of the electron density from non - uniformly sampled , three - dimensional diffraction patterns is of wide interest and applicability with present - day sources . in radiation - tolerant samples ,",
    "x - ray diffraction and diffraction tomography are capable of higher resolution than ( straight- or cone - beam ) tomography alone . in tomography , resolution is limited by the quality of the incident beam and by the spatial resolution of the detector ; in diffraction the resolution can be as fine as the wavelength of the incident radiation .",
    "experimentally , diffraction imaging has already produced x - ray images at higher resolution than possible with available x - ray optics ( miao et al .",
    ", 1999 , and he et al . , 2002 ) .",
    "the price to be paid for these benefits is the intrinsic difficulty of the reconstruction .",
    "nevertheless , several successful reconstructions from experimental x - ray data , using the iterative hybrid input - output version of the gerchberg - saxton - fienup ( gsf ) algorithm , have been reported recently ( miao et al .",
    ", 2002 , and marchesini et al . , 2003 ) .",
    "the first successful application of this algorithm to electron diffraction data was reported in 2001 ( weierstall et al . , 2002 ) , and it has been used more recently to produce the first atomic - resolution image of a single carbon nanotube ( zuo et al . , 2003 ) .",
    "in biology , the use of the gsf has recently been shown to dramatically reduce the number of images needed for tomographic cryoelectronmicroscopy of protein monolayer crystals , so that phasing can be based mainly on the three - dimensional diffraction data ( spence et al . , 2003 ) .",
    "the development of speden was also prompted by the promise of new ways to image bio - molecules .",
    "free - electron lasers can , in principle , provide x - ray pulses of tens to hundreds of femtoseconds in length and brightness up to ten orders of magnitude greater than synchrotron radiation . it was predicted that , under such circumstances , it should be possible to dispense with crystals and reconstruct the electron density of single biological particles from their diffraction pattern ( neutze et al . , 2000 ) . in proposed experiments , a large number of single particles will be injected into the x - ray beam in random orientation and their diffraction patterns will be recorded , each in a single shot of the free - electron laser .",
    "such diffraction patterns will be very noisy and their resolution will be limited by the signal to noise ( s / n ) ratio .",
    "the measured diffraction patterns that correspond to different orientations of the particle will be classified into a number of mutually exclusive classes .",
    "the images within each class will then be averaged and the class averages assembled into a three - dimensional diffraction pattern by finding their mutual orientation relationships .",
    "finally , the three - dimensional diffraction pattern will be reconstructed to yield the electron density of the molecule .",
    "we have worked on the analysis of all three steps of such an experiment .",
    "the essence of the first analysis is that the maximum x - ray intensity at a given pulse length is limited by the requirement that the molecule stay intact during the pulse , even though it eventually disintegrates ( hau - riege et al . ,",
    "the second analysis discusses the division of noisy diffraction patterns into a number of distinct classes . if the images are divided into too few classes , the available resolution is not realized .",
    "if the patterns are divided into too many classes , the class averages will be poor and the pattern quality suffers .",
    "the individual class averages , each corresponding to a well - defined orientation of the particle , will be assembled into a three - dimensional diffraction pattern .",
    "the result will be a three - dimensional diffraction pattern that is measured at a limited number of orientations .",
    "it will be , therefore , sparse , irregular and will have a limited signal to noise ratio ( huldt et al . , 2003 ) .",
    "the program speden , described in this paper , provides a way to optimally determine the electron density from such a three - dimensional ensemble of continuous diffraction patterns .",
    "we first give an analysis of their properties and discuss the methods and the expected difficulties of reconstructing a `` sensible '' electron density from them .",
    "we then describe how speden adapts the holographic method ( szoke et al . , 1997a ) in crystallography to deal with continuous diffraction patterns as opposed to discrete bragg spots ; this will be discussed in the next section .",
    "we then report quantitative results of preliminary tests for verifying the correctness of our method .",
    "these tests use computed and measured diffraction patterns from samples of inorganic particles .",
    "the reconstruction of the density of scatterers from its diffraction pattern is an `` inverse problem '' .",
    "other , well - studied inverse problems are those of computed tomography , image deblurring , phase recovery in astronomy , and crystallography . in tomography , for example , an inversion algorithm ( e.g. filtered back projection ) is used to recover the density of scatterers from the measured tomograms .",
    "it is widely recognized that the reconstructed density is very sensitive to inaccuracies in the measurement .",
    "small errors in the diffraction pattern cause large errors in the reconstruction .",
    "this property is called ill - posedness or ill conditioning .",
    "the reconstruction of the electron density from x - ray diffraction patterns is indeed ill conditioned .",
    "it also has two _ additional _ difficulties .",
    "first , in contrast to tomography , there are no direct inversion algorithms  not even approximate ones .",
    "second , the reconstructed electron density at any sample point is influenced strongly by the electron densities of all sample points , as opposed to a limited number of them .",
    "therefore , errors in density are non - local and `` propagate '' far .    fortunately , very good fundamental discussions of these subjects are provided in the books of daubechies ( daubechies , 1992 ) , bertero and boccacci ( bertero et al . , 1998 , bertero , 1989 ) and natterer ( natterer , 1996 , natterer and wbbeling , 2001 ) . in somewhat simplified terms , the reconstruction of the electron density is similar to finding the inverse of an ill - conditioned non - square matrix , a subject thoroughly discussed in golub and van loan ( golub et al . , 1996 ) .",
    "we consider these mathematical properties to be essential for understanding the successes and limitations of reconstruction algorithms ; we will try to be fully cognizant of them in the discussion that follows .",
    "the crystallographic phase problem is a good starting point for further discussion .",
    "it was first realized by sayre ( sayre , 1952 ) that the number of observable complex structure factors , limited by the bragg condition , is equivalent to a critical sampling of the electron density in the unit cell of the crystal .",
    "the sampling theorem of whittaker and shannon teaches us that , if the amplitudes and phases of all the diffraction peaks were accurately measured , the electron density could , in principle , be reconstructed everywhere ( bricogne , 1992 ) .",
    "unfortunately , only the amplitudes of the bragg reflections are measured , not their phases .",
    "therefore there is not enough information in the diffraction pattern for a unique reconstruction of the electron density .",
    "sayre proposed ( sayre , 1980 ) that if we could measure the diffraction amplitudes `` in between '' the bragg peaks , we should have enough information to reconstruct the electron density , or to `` phase '' the diffraction pattern .",
    "this is exactly the situation in diffraction from a single particle .    nevertheless , it is still difficult to reconstruct the electron density , even from a well `` oversampled '' diffraction pattern .",
    "one corollary of critical sampling is that the amplitudes and phases of the bragg reflections of a crystal are independent of one other , but any structure factor in between them depends on the surrounding ones to some extent .",
    "therefore , too much oversampling does not help to obtain independent data , although it does improve the s / n ratio by reducing the noise .",
    "ill posedness is still with us , although with oversampling , the error propagates less .",
    "an additional difficulty with diffraction patterns from a set of discrete orientations of a particle is that at low resolution the diffraction pattern is well oversampled while at high resolution the sampling is sparse .",
    "a fundamental property of diffraction is that the position and the handedness of the electron density are undetermined , resulting sometimes in stagnation of the algorithm and drift in the position of the results ( stark , 1987 ) .",
    "there are two well - known , necessary remedies for the lack of information and for the ill posedness of the reconstruction problem .",
    "the more important one is the need for more information .",
    "for example , one way to include _ a priori _ knowledge is to accept reconstructed electron densities only if they are `` reasonable '' .",
    "the second remedy is to use `` stabilized '' or pseudo - inversion algorithms . in the next section",
    "we introduce our version of a real space reconstruction algorithm ; we will argue that our algorithm deals with all these problems optimally , at least in some sense .",
    "we return to the comparison of our algorithm with other methods for phase - recovery in section 2.3 .",
    "subsectionspeden , a real - space algorithm    in this section we outline the workings of our reconstruction program , speden .",
    "speden uses a real - space method for reconstruction ; its acronym stands for single particle electron density . for computational efficiency the particle to be recovered is put into a _ fictitious _ unit cell that is several times larger than the particle itself . all reconstruction algorithms use this artifice in order to be able to calculate structure factors by fast fourier transform techniques .",
    "the resulting similarity with crystallography enables the use of many crystallographic concepts .",
    "in fact , the recognition of this similarity enabled us to write a program , speden , based on our crystallographic program , eden , with relatively small modifications .",
    "the most significant difference between the two programs is that in crystallography the bragg condition restricts the reciprocal lattice vectors to integer values , while the continuous diffraction pattern can be - and usually is - measured at arbitrary , non - integer values of the reciprocal lattice vectors .    in speden , in common with eden ,",
    "the ( unknown ) electron density is represented by a set of gaussian basis functions , with unknown amplitudes , that fill the fictitious unit cell uniformly . this way the recovery is reduced to the solution of a large set of quadratic equations .",
    "the program `` solves '' these equations by finding the number of electrons in each basis function so as to agree optimally with the measured diffraction intensities as well as with other `` prior knowledge '' .",
    "prior knowledge includes the emptiness of the unit cell outside the molecule , the positivity of the electron density , possibly some low - resolution image of the object , etc .",
    "each one of those conditions is described by a cost function that measures the deviation of the calculated data from the observed data .",
    "one of the cost functions describes the deviation of the calculated diffraction pattern from the measured one ; others depend on the deviation of the recovered density from prior knowledge .",
    "measured data are weighted by their certainty ( inverse uncertainty ) , other prior knowledge is weighted by its `` reliability '' . the mathematical method used is ( constrained ) conjugate gradient optimization of the sum of cost functions . at each step of the optimization , there is a set of amplitudes available that describe the current electron density in the full unit cell . a full set of structure factors is calculated by fourier transforming the current electron density .",
    "when the unit cell is larger than the particle , the structure factors can be stably interpolated to compare them with measured structure factor amplitudes .",
    "we refer to the cited literature that shows that the procedure we outlined is equivalent to a stabilized ( quasi ) solution of the inverse problem ( daubechies , 1992 ; bertero et al . , 1998 ; and natterer et al . , 2001 ) . as such ,",
    "it is optimally suited for sparse , irregular , incomplete and noisy data .    in the following subsections",
    "we describe very briefly the common features of eden and speden as well as their differences . a more complete description of eden can be found in previous papers ( szoke et al .",
    ", 1997a , and szoke , 1998 ) .",
    "the electron density is represented as a sum of basis functions , adapted to the resolution of the data . specifically , we take little gaussian `` blobs '' of width comparable to the resolution , and put their centers on a regular grid that fills the `` unit cell '' and whose grid spacing is comparable to the resolution .",
    "the amplitudes of the gaussians are proportional to the local electron density .",
    "in fact , the number of electrons contained in each gaussian constitutes the set of our basic unknowns .",
    "the above is identical to the representation of the electron density in eden .",
    "some mathematical details follow .",
    "the actual formula for the representation of the electron density as a sum of gaussians is    @xmath0.\\ ] ]    the centers of the gaussians are positioned at grid points , @xmath1 , where @xmath2 is a counting index . in our fictitious unit cell ,",
    "the grid is orthogonal , the grid spacing is @xmath3 and the centers of the gaussians are usually on two intercalating ( body centered ) grids for best representation of the electron density . the number @xmath4 of the order unity , determines the width of the gaussians relative to their spacing , @xmath3 .",
    "finally and most importantly , @xmath5 is the _ unknown _ number of electrons in the vicinity of the grid point @xmath6 .",
    "the values of @xmath5 are real , and in future may also be complex - valued to allow for photo - absorption in addition to scattering .",
    "( the latter can be significant when diffraction measurements are made at longer x - ray wavelengths . )    given @xmath5 the structure factors can be calculated by @xmath7 } \\sum\\limits_{p = 1}^{p } n(p)\\exp \\left [      2\\pi i \\bm{h } \\cdot { \\cal f}\\bm{r}(p )      \\right ] \\,,\\ ] ] using a fast fourier transform .",
    "the vector @xmath8 , a triplet of integers , denotes the reciprocal lattice vector , the operator f transforms from real space ( cartesian ) coordinates to fractional coordinates , and @xmath9 denotes the dual transformation .",
    "the constants appearing in eqs .",
    "( [ eq1 ] , [ eq2 ] ) were discussed in some detail previously ( szoke et al . , 1997b ) .",
    "for completeness , we define them here .",
    "the crystallographic @xmath10 factor is given by @xmath11 .",
    "the `` crystallographic resolution '' , @xmath12 , determines the grid spacing , @xmath3 by the relation , @xmath13 , where @xmath14 is a constant of the order unity . for a body - centered lattice we set @xmath14",
    "= 0.7 and @xmath15 = 0.6 . for a simple lattice , we use @xmath14 = 0.6 and @xmath15 = 0.8 .",
    "note that the gaussian basis functions are not used in a one - to - one correspondence with single atoms , but are simply used to describe the 3d electron density at the resolution that is appropriate to the data resolution . in the special case that the resolution was about the size of an atom and an atom happened to be sitting exactly on a grid point , that atom would be represented by a single basis function .",
    "if the atom is not on a grid point , or if the atom happens to be fat , because of thermal motion , that same atom would be represented by many basis functions .",
    "similarly , at lower resolution , a single basis function represents assemblies of atoms .",
    "the measured diffraction pattern of the molecule is proportional to the absolute square of the structure factors . in speden",
    "we do account for the curvature of the ewald sphere .",
    "there are two subtle points : the diffraction pattern is measured only in a finite number of directions , @xmath16 ; and as a rule , those directions are not along the reciprocal lattice vectors of the ( fictitious ) unit cell for a single particle . in other words , the measurement directions , @xmath16 , are usually not integers and they are not uniformly distributed in reciprocal space .",
    "this is the main difference between crystallography and single particle diffraction and , therefore , between eden and speden .",
    "the essence of _ any _ reconstruction algorithm is to try to find an electron density distribution such that the calculated diffraction pattern matches the observed one . in our representation , we try to find a set of @xmath5 , such that    @xmath17    for each measurement direction , @xmath18 .",
    "let us assume for a moment that @xmath18 are integers .",
    "when the representation of the unknown density is substituted from ( [ eq2 ] ) , for each measured value of @xmath18 , equation ( [ eq3 ] ) becomes a quadratic equation in the unknowns , @xmath5 .",
    "the number of equations is the number of measured diffraction intensities .",
    "it is usually not equal to the number of independent unknowns that are the number of grid points in the unit cell .",
    "the equations usually contain inconsistent information , due to experimental errors .",
    "the equations are also ill conditioned and therefore their solutions are extremely sensitive to noise in the data . under these conditions",
    "the equations may have many solutions or , more usually , no solution at all .",
    "our way of circumventing these problems is to obtain a `` quasi solution '' of ( [ eq3 ] ) by minimizing the discrepancy , or cost function ( see e.g. stark , 1987 , and bertero et al . , 1998 )",
    "@xmath19 ^ 2\\ ] ]    the weights , @xmath20 , are usually set to be proportional to the inverse square of the uncertainty of the measured structure factors , @xmath21 . as discussed by szoke ( szoke , 1999 ) ,",
    "this is equivalent to a maximum likelihood solution of the equations .",
    "let us now discuss the first , previously ignored difficulty in the reconstruction . when we try to reconstruct the electron density from real experimental data , we have to compare the set of measured @xmath22 , where @xmath18 are not necessarily integers , with the calculated structure factor amplitudes , @xmath23 , that are on a regular grid , i.e. have integer @xmath24 . in principle , given an electron density of the molecule , one could calculate the structure factors in the experimental directions .",
    "nevertheless , for computational efficiency , we put the ( unknown ) molecule or particle into a fictitious unit cell that is larger than the molecule .",
    "we will also demand that the gaussians outside the molecular envelope be empty .",
    "( in practice , sizes of molecules are known from their composition ; particle sizes and shapes may be known from lower - resolution imaging . )",
    "as long as the distances of the gaussian basis functions are kept to be the experimental resolution , the number of `` independent '' unknowns neither increases nor decreases , in principle , by this computational device .",
    "the structure factors are calculated on an integer grid in the large unit cell , so they are essentially oversampled in each dimension by the same factor of the size of the large cell to the size of the molecule .",
    "the oversampling allows stable interpolation of the calculated structure factor amplitudes from integer @xmath24 to the fractional @xmath16 everywhere , independent of the density of the actual measurements .",
    "note that interpolation from fractional @xmath16 to integer @xmath24 is not always a stable procedure !    in the present implementation of speden , we get sufficient accuracy with the simplest , tri - linear interpolation in the amplitudes of @xmath25 if we choose the fictitious unit cell to be three times larger than the molecule in each dimension . now ,",
    "some mathematical details : the reciprocal space vector * h*(@xmath26 is within a cube , bounded by eight corners @xmath27 with integer values . let us denote the fractional parts of the components of @xmath18 as @xmath28 .",
    "we define weights for the eight corners , @xmath29 , by taking the products of the fractional parts of @xmath30 , or @xmath31 with those of @xmath32 or @xmath33 and @xmath34 or @xmath35 .",
    "the cost function to be minimized now becomes    @xmath36 ^ 2\\,.\\end{aligned}\\ ] ]    a similar approach of applying crystallographic algorithms to continuous diffraction data has been done with direct methods [ spence et al . ,",
    "2003 ] . in this case",
    ", however , the ewald sphere was approximated by a plane .",
    "let us assume that we have some , possibly uncertain , knowledge of the electron density in parts of the unit cell from an independent source , i.e. one that does not come from the x - ray measurement itself .",
    "this is the kind of knowledge present when the unknown molecule is placed into a larger unit cell and we demand that the unit cell be empty outside the molecule .",
    "this kind of knowledge was also referred to as a `` sensible '' electron density in the introduction .",
    "we represent this knowledge by a target electron density @xmath37 and by a real - space weight function @xmath38",
    ". it will be desirable that the actual electron density of the molecule , @xmath39 , as represented by @xmath5 , be close to the target electron density ; the weight function @xmath38 expresses the strength of our belief in the suggested value of the electron density .",
    "note that target densities can be assigned in any region of the unit cell independently of those in any other region .",
    "the simplest way to express the above statement mathematically is to minimize the value of the cost function    @xmath40 ^ 2 \\,,\\ ] ]    where @xmath41 is a scale factor and @xmath42 is a normalizing constant , described in somoza et al . , 1995 .",
    "( in the _ absence _ of information at and around the molecule , weights are generally unity where it is known that there is no molecule and zero elsewhere . )",
    "the same procedure is used in eden .",
    "the knowledge of the electron density at low resolution can be expressed by a low - resolution spatial target .",
    "crystallographers call this phase extension .",
    "the essence is that , during the process of the search for an optimal electron density , we try to keep its low resolution component as close to the known density as possible .",
    "a convenient way to accomplish this is the following . given @xmath5 , we smear out its gaussian representation and compare it to the equally smeared out target . actually , it is easier to carry out the computation in reciprocal space .",
    "we define @xmath43 where the current `` smeared ''",
    "structure factors are calculated using the low resolution , @xmath44 , @xmath45\\sum\\limits_{p = 1}^{p } { n(p)\\exp [ 2\\pi   i{\\rm { \\bf h } } \\cdot { \\cal f}{\\rm { \\bf r}}(p ) ] } .\\ ] ]    the original low - resolution target is prepared analogously from the ( presumably ) known electron density , @xmath46 . the same procedure is used in eden .      in the presence of a target density , the actual cost function used in the computer program is the sum of @xmath47 ( [ eq5 ] ) , @xmath48 ( [ eq6 ] ) and @xmath49 ( [ eq7 ] )    @xmath50    the fast algorithm described in somoza et al . , 1995 , and szoke et al .",
    ", 1997b , is always applicable to the calculation of the full cost function , ( [ eq9 ] ) .",
    "there is a clear possibility of defining more target functions .",
    "they are all added together to form @xmath51 that is minimized to find the optimum electron density .",
    "the minimization of the cost function ( [ eq9 ] ) is carried out in speden ( as in eden ) by d. goodman s conjugate gradient algorithm ( goodman , 1991 ) .",
    "it has proven to be very robust and efficient in years of use in eden .",
    "the essential properties of the algorithm that make it so advantageous for our application is that the positivity of the electron density , @xmath52 , is always enforced and that the gradient vector in real space can be calculated by fast fourier transform .",
    "the gradient calculation needed only a very simple modification for the interpolation in reciprocal space , eq .",
    "( [ eq5 ] ) .",
    "the line search algorithm does not use the hessian , so matrices are never calculated .    as with any local minimization",
    ", global convergence is not achieved .",
    "we discussed this problem in our previous papers and came to the conclusion that , usually , the minimum surface of the cost function ( [ eq7 ] ) is so complicated that finding a global minimum would take more computer time than the existence of the universe .",
    "reconstruction of the scatterer from a continuous diffraction pattern has a tangled history replete with repeated discoveries .",
    "some of the present authors are also guilty of ignorance of prior work .",
    "we referred to the pioneering insights in section 2.1.2 .",
    "the `` recent '' period of algorithms started with the work of miao , sayre and chapman ( miao et al .",
    "1998 ) who pointed out that the fraction of the unit cell where the density is known is an important parameter for convergence . in somewhat later work , with oversampled structure factors calculated on a regular grid ,",
    "the crystallographic program eden successfully demonstrated the recovery of the electron density using a simulated data set from the photoactive yellow protein ( szoke , 1999 ) .",
    "the protein was put into a fictitious unit cell , twice the size of the original one , and a target with zero density was used outside the original unit cell of the protein .",
    "similarly , miao and sayre ( miao et al . , 2000 ) have studied empirically how much oversampling is required in two- and three - dimensional reconstructions of a simulated data set ; using a version of the gerchberg  saxton ",
    "fienup ( gsf ) algorithm . among recent articles we mention robinson et al ( 2001 ) ,",
    "williams et al ( 2003 ) , marchesini et al .",
    "( 2003 ) and references therein , in addition to those mentioned in the introduction .",
    "all reconstruction algorithms of oversampled diffraction patterns use _ a priori _ information on the shape and size of the particle . in our previous studies in crystals we found that such information is very valuable .",
    "for example , eden converges surprisingly well for proteins at low resolution where the only information used is that the molecule is a single `` blob '' .",
    "eden also converges for synthetic problems with a good knowledge of the solvent volume , which is greater than 50% ( beran et al . , 1995 ) or 60% ( eden ) .",
    "a similar conclusion was reached in miao et al .",
    "( 1998 ) . in comparison ,",
    "when a molecule is embedded in a 3-fold larger fictitious unit cell , the empty `` solvent '' occupies @xmath5396% of the cell volume .    as discussed previously ,",
    "the reconstruction of scatterers from their diffraction pattern is a difficult mathematical problem . in many cases",
    "the indeterminacy of the absolute position of the object and of its handedness causes difficulties in convergence .",
    "that is definitely the case with speden so , in that sense , speden is not a good algorithm .",
    "empirically , the gsf algorithm has a larger radius of convergence and deals better with stagnation ( marchesini et al .",
    "2003 )    another family of difficulties arises when there is _ a priori _ information available , but there is only incomplete and noisy data . under such conditions",
    "the main questions are how to find a solution that optimally takes into account the available information and that is the best `` sensible '' one that reproduces the noisy and incomplete data to its limited accuracy .",
    "it is this second set of conditions for which speden was written .",
    "although , in this paper , we show only its performance for artificial and `` easy '' but incomplete data , speden s older sister , eden has been shown to have those properties on a large range of crystallographic data sets , ranging from cuo@xmath54 to the ribosome .",
    "we expect that such properties of eden will be inherited by speden , considering that their fundamental mathematical properties are sufficiently similar .",
    "the best known , and successful class of algorithms is the group of iterative transform algorithms that we refer to as gerchberg - saxton ( gs ) ( gerchberg et al . , 1972 ) , and its development , in which support constraints and feedback are added , the gs - fienup ( gsf ) or hybrid input - output algorithm ( fienup et al . , 1982 ; aldroubi et al . , 2001 ;",
    "bauschke et al .",
    ", 2002 ; bauschke at al . , 2003 ) .",
    "the essence of the gsf algorithms is that they iterate the n - pixel data between real and reciprocal spaces via ffts and enforce the known constraints in each of these spaces .",
    "depending on the degree of noise in the data , these algorithms usually converge in about a hundred to a thousand iterations .",
    "the weak convergence ( non divergence ) of the gs algorithm has been proven in the absence of noise ( fienup et al . , 1982 ) .",
    "there is no mathematical proof that these algorithms will converge in general , but it is reasonable that by sequentially projecting onto the set that satisfies the real space constraints and the set that satisfies the reciprocal space constraints , the intersection ( corresponding to a valid solution ) should be approached .",
    "this is definitely true for projections onto convex sets , but unfortunately these sets are not convex ( stark , 1987 ) . in practice ,",
    "despite the fact that the modulus constraint is non - convex , the algorithms often converge even in the presence of noise in about several hundred iterations .",
    "the main difference between the gsf algorithms and speden is that speden does not iteratively project onto the sets of solutions that satisfy the real - space or reciprocal space constraints separately , but rather it minimizes a cost function that includes all the constraints of both spaces .",
    "it does this by varying quantities in real space only ( the @xmath5 s ) and the cost evaluation only requires a forward transform from real space to reciprocal space . as the cost function never increases , speden reaches only a local minimum .    in spite of its `` small '' radius of convergence , there are some expected advantages to speden s algorithm .. in speden we compare the @xmath55 to the @xmath56 by interpolating from the samples of @xmath55(*h * ) , calculated on a regular grid , to the measured sample vectors * h*. since the gridded @xmath57 are a complete set ( due to the fact they are sampled above the nyquist frequency ) the interpolation is stable and performed with little error . since an inverse transform is required in the gsf algorithms , the measured diffraction data @xmath58 ( recorded on ewald spheres in reciprocal space ) must be interpolated to the gridded data points * h*. the observed data might not be a complete set , especially at high resolution where the density of samples is sparser : this may lead to error .",
    "an additional possible difficulty with the gsf algorithms is that the effective number of unknowns may increase with the size of the fictitious unit cell , while in speden the effective number of unknowns is constant . finally , in speden",
    ", weightings can be properly applied to all data and knowledge .",
    "the measured data is inversely weighted by its uncertainty ; it is a procedure equivalent to maximum likelihood methods and it should be optimal , at least in theory . as a side effect",
    ", when the constraints are inconsistent , speden still converges to a well - defined and correct solution .",
    "( note that for noisy data the constraints are almost always inconsistent . )",
    "weightings are also applied to reflect our confidence in real - space constraints , and these weightings are consistently used in real space .    * tests *    speden has certain built - in limitations .",
    "in particular , of course , reconstruction is only as good as the diffraction measurements and derived structure factor amplitudes are reliable .",
    "there are also other less obvious limitations .",
    "for example , there are inherent inaccuracies due to the gaussian representation of the electron density in real space .",
    "( szoke et al . , 1997a ) also ,",
    "the trilinear interpolation for representing integer ( hkl ) structure factor amplitudes on a non - integer grid is only approximate .",
    "finally , as a fundamental limitation of _ any _ reconstruction method , both the absolute position and the handedness of the molecule are undefined .",
    "we performed preliminary tests to verify the capabilities and limitations of our reconstruction method using computed and experimentally obtained diffraction patterns . in this section ,",
    "we first describe the reconstruction of simple `` molecules '' from synthetic diffraction patterns with speden .",
    "specifically , we discuss how the convergence of speden is affected by the errors due to interpolation in reciprocal space , by the quantity of observed structure factors , @xmath59 , by the extent of the `` known '' starting model , and by the uniformity of sampling in reciprocal space .",
    "we then describe the reconstruction of simple two - dimensional objects from synthetic and measured diffraction patterns with speden .",
    "we created synthetic `` molecules '' in the format of the protein data bank ( pdb ) files ( berman et al . , 2000 ) .",
    "each molecule was composed of 15 point - like carbon atoms , placed at random positions within a cube measuring 16.8  in each dimension and `` measured '' to 4  resolution ; these values correspond to crystallographic @xmath10 factors of 185.7 @xmath60 .",
    "the molecule was then shifted so that its center - of - mass was at the center of the cube .",
    "all our simulations were repeated using molecules with several different random arrangements .",
    "initially , the `` unit cell '' coincided with the dimensions of the cube in which the atoms were placed ; later , larger cells were used and the atoms were positioned in their center .",
    "we also generated `` starting models '' by removing atoms from the full  molecule  .",
    "both full and partial molecules served to generate structure factors ( @xmath61 ) , using the atomic positions and the b factors .",
    "starting models were generated from the @xmath55 , using speden s preprocessor , back , which finds the optimal real - space representation for an input @xmath61 .",
    "initially , sets of `` measurements '' ( @xmath62 ) were generated by deleting the phases of the calculated structure factors of the full or partial molecule .",
    "the @xmath63 files so generated had all integer @xmath16 .",
    "the uncertainty of the measured structure factors , @xmath64 , were chosen to be    @xmath65    with @xmath66 for @xmath67 , and @xmath68 for @xmath69 .",
    "we used two alternate methods to generate @xmath63 files for non - integer @xmath18 : in the first method , we used a unit cell whose dimensions were incommensurate with one another and with the edge of the cube , but whose volume equaled that of the cube .",
    "the resulting @xmath63 file , generated again from @xmath61 files by deleting the phases , then had its indices scaled back appropriately , yielding fractional @xmath18 .",
    "a different second method was used to sample the reciprocal @xmath18 space non - uniformly : @xmath70 at fractional @xmath18 were calculated using tri - linear interpolation from @xmath62 data on a regular grid that , in turn , was at four times the regular resolution in reciprocal space .    for each of these @xmath63 files ,",
    "some constraining information is required in order to find the atom positions .",
    "we used two types of constraints : one of them identified the ( approximate ) empty region ; the other one used @xmath61 at a considerably lower resolution .",
    "we call them the empty target and the low - resolution target , respectively .",
    "both are based on the assumption that at a considerably lower resolution , the general position of atoms as one or more `` blobs '' in empty space is known .",
    "the low - resolution @xmath71 was prepared by smearing the full @xmath72 file to 10  .",
    "the empty target identified the empty points in terms of a mask .",
    "then , throughout speden s iteration process , using the solver solve , the program attempted to match the current electron / voxel values in masked - in regions to empty ( @xmath73 ) values .",
    "the phase - extension target used the same @xmath71 file ; during the iteration process , at each step , the current real - space solution was smeared to that low resolution in reciprocal space and restrained to agree with that target .      besides inspecting the reconstructed electron density visually , we used four quantitative measures to compare the reconstructed image with the electron density from the full molecule at 4  :    1 .",
    "real - space rms error : we calculated the real - space electron density from the electron / voxel files , a process we call regridding .",
    "we then calculated the root - mean - square ( rms ) error of the electron densities , @xmath74 and @xmath75 , defined as @xmath76 we permitted one file to be shifted with respect to the other file , in order to minimize the distance .",
    "phase difference : we calculated the average ( amplitude - weighted ) phase difference between the @xmath61 at the end of the run and the corresponding @xmath61 generated from the full molecule .",
    "final @xmath77 factor : we calculated the crystallographic r factor ( giacovazzo et al . , 2002 ) at the end of the run .",
    "count error : we compared the integrated real - space electron density generated from a run result with the true number of electron as identified in the pdb file , on an atom - by - atom basis . the integration was performed around each atom over a sphere with a radius that was 1.5 times the grid spacing .",
    "the figure - of - merit is the rms error .",
    "of all these measures , the final @xmath77 factor was the least useful to assess the quality of the reconstructed image .",
    "the @xmath77 factor tends to be lower for a small number of entries in the observation file since there are fewer equations to satisfy during the reconstruction . in such a case",
    ", a visual inspection shows that the reconstructed electron density may have little resemblance to the 15 carbon atoms .",
    "however , there was a good correlation among the other three measures .",
    "the solutions looked correct when the phase difference between solution and full @xmath61 was less than 20 , the count error between solution and pdb model was 0.2 or lower ( out of 6 ) , and the rms distance measure was less than 0.2 .      for computational purposes",
    ", we placed the ( unknown ) molecule or particle into a fictitious unit cell that is larger than the molecule , and calculated the structure factors on an integer grid in the large unit cell , oversampled by the same ratio : the size of the large cell to the size of the molecule .",
    "we then calculated the structure factor at fractional * h * from the structure factor at integer * h * using tri - linear interpolation .",
    "the interpolation error becomes smaller when larger unit cells are used ( at the expense of computation time ) .",
    "we studied the effect of the unit cell size on convergence of speden .    in the initial tests ,",
    "the unit cell was the same size as the original molecule , and the starting ( known ) part of the molecule consisted of the full molecule . when the molecule consisted of atoms on grid points and the @xmath63 files had integer @xmath78 , unsurprisingly speden converged , as did eden on the same data set",
    "however , we found that speden did not converge to a unique solution if either the atoms were not on grid points or when the @xmath63 file had non - integer @xmath18 , or both , since the solution meandered in real space .    in subsequent tests , we generated larger unit cells and applied a target over the empty part of the unit cell , in an attempt to restrain the meandering problem .",
    "we embedded the molecule in a cell that was 2 or 3 times greater in each dimension .",
    "an empty target was used that essentially covered the empty 7/8-th or 26/27-th of the unit cell , respectively .",
    "we applied a high relative weight for this empty target , and we still used the full molecule as a starting position .",
    "we found that both the larger cell and the empty target are of critical value in enabling speden to converge to the correct solution . comparing the 2-fold larger unit cell versus the 3-fold unit cell",
    ", there was a great improvement in the latter case .",
    "these results show that for tri - linear interpolation , it is adequate to use a unit cell that is 3 times greater in each dimension .",
    "we expect that more sophisticated interpolation algorithms should allow using smaller unit cells .      a three - fold enlarged unit cell increases the number of unknown amplitudes of the gaussians , n(p ) , by a factor of 27 . in principle , the emptiness of the volume around the molecule restrains the effective number of independent unknowns .",
    "nevertheless , if the number of equations , which is given by the number of entries in the fobs file , is not increased , it is easy for the solver to `` hide '' electrons among the large number of unknowns in the system , even when the empty target constraint is used .",
    "in fact we found that when we compared the final fcalc from solve against the starting fcalc , on the one hand , and the correct fcalc on the other , solve s final fcalc was closer to the starting one than to the correct one .",
    "in other words , the cost function in reciprocal space was not a sufficiently strong constraint in speden s algorithm , for this synthetic problem . in a similar real case ,",
    "more experimental diffraction patterns need to be collected in order that speden would be able to find the corresponding image without other information .      in the next set of synthetic tests",
    ", we attempted to recover missing information by starting from a partial model that contained less than the full complement of 15 atoms . in these simulations , we used @xmath63 files with non - integer @xmath18 , a three - fold enlarged unit cell , an empty target or a phase extension target , and randomly positioned atoms .",
    "we found that a low - resolution spatial target significantly helps speden to converge .",
    "figure 1 ( a ) shows the results of the comparison of the reconstructed image with the electron density from the full pdb file when a phase extension target is used .",
    "the phase extension target was calculated at a resolution of 10  .",
    "we found that it was generally possible to recover 5 , 10 , or even all 15 of the atoms .",
    "please note that the amount of information in such a phase extension target is ( 4/10)@xmath79 6% of the information in the perfect solution .",
    "it was more difficult to reconstruct the original electron density when we used an empty target , as shown in figure 1 ( b ) .",
    "speden was able to recover 5 out of the 15 atoms , but did not converge when 10 atoms were unknown . perhaps surprisingly ,",
    "the case where there was no starting model at all ( 0 atoms known ) did consistently better than those cases where a partial model was given as a starting condition .      in this set of synthetic tests",
    ", we addressed the question of how difficult it is to recover the molecule from a non - uniform set of samples in reciprocal space , similar to real data sets , and how the results compare with the reconstruction from a uniformly - sampled data set .",
    "we generated two - dimensional diffraction patterns of the synthetic carbon molecule for different particle orientations , corresponding to recorded diffraction patterns in a `` real '' experiment .",
    "the two - dimensional diffraction patterns were linearly interpolated from a three - dimensional diffraction pattern ; the latter was calculated on an additionally double - fine grid over the already triple - sized unit cells , i.e. using a unit cell that was a total of six times larger than the molecule in each direction .",
    "further refining the grid of the three - dimensional diffraction pattern did not alter the results significantly .",
    "the three - dimensional diffraction pattern , in turn , was the fourier transform of the gridded electron density of the synthetic molecule .",
    "two - dimensional patterns do not sample the diffraction space uniformly .",
    "the sampling density near the center of the diffraction space is much larger than the sampling density further away .",
    "we used a completeness measure to characterize the sampling uniformity .",
    "the reciprocal space is divided into cells that are 4@xmath80/@xmath81 by 4@xmath80/@xmath82 by 4@xmath80/@xmath83 in size , where @xmath81 , @xmath82 , and @xmath83 are the molecule sizes in each dimension .",
    "the completeness then is the ratio of cells in reciprocal space that contain at least one measurement over the total number of cells .",
    "figure 2 shows the completeness of the input observation files as a function of the number of diffraction patterns .",
    "also shown in figure 2 is the number of calculated diffraction intensities .",
    "we then used speden to recover 7 out of the 15 atoms .",
    "the molecule was embedded in a unit cell that was three times larger in each dimension , and we used an empty solvent target .",
    "figure 3 shows the errors of the reconstructed electron density as a function of the number of two - dimensional diffraction patterns .",
    "the orientations of the diffraction patterns were chosen at random , and the calculations were repeated for four different molecules . for comparison , also shown in figure 3 are the errors of the electron density of the 8 known atoms ( `` partial model '' ) , and the errors of the reconstructed electron densities when a three - dimensional diffraction pattern is used which was oversampled three times ( `` integer hkl '' ) or six times ( `` fractional hkl '' ) .    as discussed above , the @xmath77 factor is not a useful measure to assess the quality of the reconstructed image , but the rms and count errors are better measures for the reconstruction quality .",
    "surprisingly , we found that _ four _ two - dimensional patterns are sufficient to reconstruct the electron density as well as in the case the full three - dimensional diffraction pattern is given .",
    "four two - dimensional patterns have a remarkably low sampling completeness of only 14% . further increasing the completeness or the number of observations",
    "does not improve the quality of the reconstruction .",
    "we would like to note , however , that these results could be dependent on the choice of the test model , and that for different test models the number of required two - dimensional patterns may be larger .      in the final set of tests , we demonstrate spedens ability to recover missing information for a two - dimensional configuration of 37 au balls in a plane .",
    "we reconstructed the au balls using ( i ) a synthetic diffraction pattern and ( ii ) an experimentally obtained diffraction pattern as discussed by he et al .",
    ", 2003 . in the following",
    "we will discuss both cases , starting with the synthetic diffraction data .",
    "the 37 au balls are arranged in a plane as shown in figure 4 .",
    "the arrangement of the balls is similar to the experimental case discussed by he et al . , 2003 .",
    "the au balls were 50 nm in diameter .",
    "we generated an artificial set of `` measurements '' ( @xmath84 ) by calculating the structure factors ( @xmath85 to 30 nm resolution and deleting the phases .",
    "the uncertainty of the measured structure factors , @xmath64 , were chosen according to equation ( [ eq10 ] ) .",
    "we generated an initial model by smearing the full @xmath72 file to 90 nm , and running back on it .",
    "the initial model is shown in figure 5 . in figures",
    "5 7 , we only show one plane .",
    "we also used this smeared @xmath61 to generate a low - resolution spatial target as well as an empty target outside the molecule .",
    "the corresponding weight function is shown in figure 6 .",
    "we then used speden to reconstruct the au balls .",
    "as shown in figure 7 , speden reconstructed the electron density successfully .",
    "however , we further found that if we use an empty starting model , speden has difficulties converging to the correct electron density .",
    "there are two reasons for this behavior .",
    "first , without an initial model , the symmetry of the system is not broken , and speden stagnates since the support does not distinguish between the object and its centrosymmetric copy .",
    "second , the mask and the reconstructed electron density are possibly shifted with respect to each other .",
    "if the initial model is empty , the position of the reconstructed electron density is mostly determined in the early iteration of the solve algorithm and can be partially cut off by the solvent .",
    "the algorithm has difficulty shifting the result .",
    "it is necessary to provide information about the location of the electron density to a certain degree , for example in the form of a smeared model .",
    "note that the gsf algorithms are designed to overcome these problems when there is abundant and accurate data available .",
    "we will now discuss the reconstruction of the au balls using experimental data . to generate a starting model , we took the experimental @xmath59 data along with the phases obtained by he at al .",
    ", 2003 using a version of the gsf algorithm , and smeared this data to 80 nm .",
    "the starting model is shown in figure 8 .",
    "we used the same data to generate a real space target with a target fraction of 99.7% , shown in figure 9 .",
    "similar to the case of the synthetic test data , we chose @xmath86(*h * ) according to equation ( [ eq10 ] ) .",
    "we then used speden to reconstruct the au balls .",
    "figure 10 ( a ) shows the reconstructed electron density , and figure 10 ( b ) shows a scanning electron microscope ( sem ) picture of the sample .",
    "we found that speden reconstructed the electron density from the experimental data successfully .",
    "in this paper we presented speden , a method to reconstruct the electron density of single particles from their x - ray diffraction patterns , using an adaptation of the holographic method in crystallography .",
    "unlike existing gsf algorithms , speden minimizes a cost function that includes all the constraints of both real space and reciprocal space , by varying quantities in real space only , so that the cost evaluation requires only a forward transform from real space to reciprocal space .",
    "speden finds a local minimum of the cost function using the conjugate gradient algorithm .",
    "we implemented speden as a computer program , and tested it on synthetic and experimental data .",
    "our initial results indicate that speden works well .",
    "this work was performed under the auspices of the u.s .",
    "department of energy by university of california , lawrence livermore national laboratory under contract w-7405-eng-48 and doe contract de - ac03 - 76sf00098 ( lbl ) .",
    "sm acknowledges funding from the national science foundation .",
    "the center for biophotonics , an nsf science and technology center , is managed by the university of california , davis , under cooperative agreement no ."
  ],
  "abstract_text": [
    "<S> speden is a computer program that reconstructs the electron density of single particles from their x - ray diffraction patterns , using a single - particle adaptation of the holographic method in crystallography . </S>",
    "<S> ( szoke , a. , szoke , h. , and somoza , j.r . , 1997 . </S>",
    "<S> acta cryst . </S>",
    "<S> a53 , 291 - 313 . ) the method , like its parent , is unique that it does not rely on `` back '' transformation from the diffraction pattern into real space and on interpolation within measured data . </S>",
    "<S> it is designed to deal successfully with sparse , irregular , incomplete and noisy data . </S>",
    "<S> it is also designed to use prior information for ensuring sensible results and for reliable convergence . </S>",
    "<S> this article describes the theoretical basis for the reconstruction algorithm , its implementation and quantitative results of tests on synthetic and experimentally obtained data . </S>",
    "<S> the program could be used for determining the structure of radiation tolerant samples and , eventually , of large biological molecular structures without the need for crystallization .    </S>",
    "<S> szoke    chapman    szoke    marchesini    noy    he    howells    weierstall    spence    speden is a computer program that reconstructs the electron density of single particles from their x - ray diffraction patterns , using an adaptation of the holographic method in crystallography . </S>",
    "<S> it is designed to deal successfully with sparse , irregular , incomplete and noisy data . </S>"
  ]
}