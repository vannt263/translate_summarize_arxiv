{
  "article_text": [
    "astronomers do not have a luxury of testing their ideas of , e.g. , galaxy and star formation in a purpose designed laboratory . instead , testing grounds are provided by observations and numerical simulations .",
    "the latter in effect represent experiments with a given set of physical laws included .",
    "clearly , the more physics is included in the simulations the more realistic the latter should be . presently , two basic physical processes  gravity and hydrodynamics ",
    "are modelled well by a variety of methods and codes .",
    "for example , one reliable and widely used numerical method of modelling gas dynamics is smoothed particle hydrodynamics ( sph ) @xcite .",
    "it has been used in the various fields of astrophysics , and is especially powerful when resolving high density regions is key .",
    "the method is grid - less and fully lagrangian in nature , facilitating modelling of arbitrary geometry systems . for reviews of the sph method see , for example , @xcite .",
    "radiation transfer and interaction with matter is another basic process operating in astrophysical systems .",
    "starting from the pioneering ideas of @xcite , great efforts have been expended to model radiation ",
    "matter interactions in sph .",
    "when gaseous systems modelled are optically thick , photons scatter or get absorbed and re - emitted multiple times before escaping the system @xcite .",
    "this situation is well approximated by the diffusion approximation .",
    "several authors have already incorporated this radiation transfer scheme in sph @xcite .",
    "the diffusion approximation is usually complemented by a flux limiter method to model optically thin regions where photons stream freely rather than diffuse ( e.g. , * ? ? ?",
    "most recently @xcite implemented the diffusion radiation scheme in the cosmological code gadget @xcite supplementing it by the variable eddington tensor as a closure relation .",
    "ray tracing methods is a principally different approach to radiative transfer , where the radiative transfer equation is solved along chosen directions ( rays ) .",
    "most applications only consider rays that start at discrete sources of radiation field , such as bright stars , etc .",
    ", essentially neglecting the diffuse radiation field . as far as the density estimation is concerned , some authors used density defined at the locations of the nearest neighbours along the rays @xcite , whereas others approximated the density field using the nodes of the tree structure one way or another @xcite . the most recent developments use the sph density field directly , e.g. , c.f .",
    "codes sphray @xcite and traphic @xcite . @xcite developed a method to transport radiation on adaptive random lattices , and showed that the algorith is very efficient for cosmological re - ionisation problems .",
    "monte - carlo methods are similar in spirit and yet substantially different from the ray tracing codes . in the former ,",
    "the idea is to discretise the radiation field into `` packets '' , choose directions and emission time of these packets stochastically to obey proper physical constraints , and then propagate the packets through matter in accord with radiation transfer equations .",
    "the main problem for the method is stochastic noise caused by photon packet statistics ( for an early sph application see * ? ? ?",
    "@xcite presents some new interesting ideas about using a smoothing kernel in a monte - carlo simulation .",
    "most of these applications were tailored to photo - ionisation problems in the field of star formation or cosmology , where the density field can be considered static as rays propagate through it ( the  static diffusion limit  ; see * ? ? ?",
    "* ) , and where radiation pressure effects can be omitted .",
    "there are also a number of radiation transfer codes working with a grid - based hydrodynamics codes rather sph ( e.g. , * ? ? ?",
    "we do not discuss these methods here .",
    "here we present and test a new photon packet based radiation transfer scheme combined with an sph code .",
    "the method uses the sph density field directly , thus preserving the `` native '' sph resolution .",
    "the previous efforts did not consider the radiation pressure effects , studying instead radiative heating / cooling and photo - ionisation .",
    "here we study the radiation pressure effects instead .",
    "we assume that gas equation of state is known ( e.g. , isothermal or polytrophic ) and consider only the radiation pressure forces .",
    "this allows us to thoroughly test precision of our approach and numerical noise effects .",
    "there is no fundamental difficulty in including the heating / cooling and photoionisation processes in our scheme , and we shall extend our method in that direction in the near future .",
    "another defining characteristic of our new method is that the photon field is evolved in the same time - dependent way , although on shorter time steps , as gas dynamics , and therefore the method is intrinsically time - dependent .",
    "radiative transfer equation along a ray @xcite is @xmath0 where @xmath1 is the specific radiation intensity , @xmath2 is the opacity coefficient , @xmath3 is gas density and @xmath4 is emissivity of the gas . in general @xmath1 and @xmath4",
    "are functions of direction , radiation frequency , position and time .",
    "the first term on the right hand side represents removal of radiation from the beam by absorption and scattering , whereas the last term describes local emission of radiation into the beam s direction .    in monte carlo methods",
    ", the radiation field is sampled via photon packets . in the simplest reincarnation of the method ,",
    "both terms on the right hand side of equation [ perenos ] are treated stochastically .",
    "the photon mean free path , @xmath5 , is calculated as @xmath6 .",
    "a random number , @xmath7 , uniformly distributed over @xmath8 $ ] , is generated .",
    "a photon is allowed to travel distance @xmath9 , at which point it interacts with gas by passing its energy and momentum to gas _",
    "completely_. the photon is then re - emitted according to physics of a chosen set of radiation processes , and followed again until it escapes the system .",
    "our radiation transfer scheme is slightly modified from this .",
    "firstly , instead of using discontinuous photon jumps , we explicitly track packet s trajectory in space as @xmath10 where @xmath11 and @xmath12 are the current and initial photon locations , and @xmath13  const is the photon propagation speed ( not necessarily the speed of light ; see  [ sec : prompt ] ) .",
    "secondly , photon momentum , @xmath14 , and photon energy @xmath15 are reduced _ continuously _ due to absorption or scattering as @xmath16 thus , the first term on the right hand side of equation [ perenos ] is treated continuously rather than stochastically .",
    "this reduces the statistical noise significantly .",
    "photons are discarded when their momentum drops below a small ( @xmath17 ) fraction of their `` birth momentum '' @xmath18 .    however , the re - emission term , i.e. , the last one in equation [ perenos ] is modelled similarly to classical monte - carlo methods in that it is stochastic in nature .",
    "this is unavoidable in monte carlo methods due to the need to employ a finite number of photon packets ( e.g. , * ? ? ?",
    "in practice , at every photon s time step @xmath19 , the photon momentum absorbed , @xmath20 , is calculated according to equation [ absorption_only ] . as stated in the introduction ,",
    "we concentrate in this paper on the radiation pressure effects , and assume that radiation absorbed from the beam is completely re - emitted on the spot in a new random direction .",
    "this is the case for pure scattering of radiation or for local radiative equilibrium between radiation and gas . in these cases",
    "the amount of momentum ( energy ) to be re - emitted in the interaction considered is exactly @xmath20 .",
    "probability of re - emitting a new photon with momentum ( energy ) @xmath18 ( @xmath21)is defined as @xmath22 .",
    "a random number , @xmath7 , uniform on @xmath8 $ ] , is generated . if @xmath23 , a new photon with momentum @xmath18 and a random direction of propagation is created .",
    "this conserves photon field s energy and momentum in a time - average sense .",
    "this scheme can be adapted to allow for non - equilibrium situations when radiative cooling is not equal radiative heating .",
    "multi - frequency radiation transfer is also straight forward if tedious to implement .",
    "we have done some of these developments already and will report it in a future paper .",
    "the radiation transfer approach described in ",
    "[ sec : smc ] embodies the classical radiation transfer equations and must be correct on that basis .",
    "nevertheless , we tested our approach against the discrete monte - carlo method on a simple test problem where the gas density and opacity are fixed and independent of the radiation field .",
    "this setup does not require using gas dynamics at all , and hence no sph particles were used to model the density field . in the test , photons are emitted at a constant rate at the midplane of a plane - parallel slab @xmath24 $ ] .",
    "the main parameter of the problem is the total optical depth of the gas between @xmath25 and @xmath26 , @xmath27 .",
    "we ran the radiation transfer part of the code until a steady state photon packet distribution was achieved .",
    "figure [ fig : slab_rt ] shows the ratio of the local radiation energy density to the radiation flux out of the slab as a function of @xmath28-coordinate inside the slab . for convenience , the speed of light is set to unity .",
    "two tests are shown , one for @xmath29 ( left panel ) and the other for @xmath30 ( right panel ) .",
    "black solid curves show the same quantity computed with the standard monte carlo technique , whereas the red dashed curves are computed with the modified method described above . for the latter time - dependent calculation",
    ", we averaged over a number of snapshots .",
    "the disagreement is quite small everywhere except for the region near @xmath25 .",
    "the difference in that region is simply due to the finite time resolution of the red curves .",
    "namely , these curves are obtained by averaging snapshots of the simulation data .",
    "the time step between the snapshots is long enough for the photons introduced at times between the snapshots to diffuse away from their starting @xmath25 location , broadening the peak . the monte carlo curve , on the other hand ,",
    "is obtained by following individual photons progress out of the slab , and therefore the information about the initial location of the photon is retained and is evident in the peak at @xmath25 .",
    "these tests demonstrate that the radiation transfer is modelled properly with our approach at least in the simple situations considered here .",
    "we now discuss coupling the radiation transfer scheme to sph .",
    "a photon mean free path is given by @xmath31 where @xmath2 is the gas opacity coefficient and @xmath3 is gas mass density _ at the photon s current location .",
    "_ we require an accurate method of local gas density estimation , and therefore we use directly the density field representation of the sph method . in the sph , gas density at a position @xmath32",
    "is given by the superposition of smoothed contributions from individual sph particles : @xmath33 where @xmath34 is the sph kernel , @xmath35 is the location , @xmath36 is the smoothing radius of particle @xmath37 , and @xmath38 is the contribution of particle @xmath37 to the density at @xmath39 .",
    "the summation goes over all the `` neighbours ''  sph particles that contribute to @xmath3 at @xmath39 , i.e. , have non - zero values of @xmath34 at this location .",
    "note that in this approach there is no expectation of the number of gas neighbours of a photon , @xmath40 , to be constant or limited in any other way .",
    "in particular , having @xmath41 is perfectly feasible and simply means that the photon propagates through an `` empty '' patch of space .",
    "having determined @xmath5 at the photon s location , we find the decrement in photon s momentum , @xmath42 , at that location according to equation [ absorption_only ] .",
    "this decrement is then passed to the photon s sph neighbours to enforce conservation of momentum .",
    "if @xmath43 , there is a question of what fraction of @xmath42 should be passed to a particular neighbour @xmath37 .",
    "we assume that the neighbours contribute to the interaction with a photon directly proportionally to their density @xmath44 at the photon s location ( see equation [ eqn : density ] ) .",
    "hence the momentum passed to neighbour @xmath37 is @xmath45 as we limit the photon time step to ensure that @xmath46 ( see equation [ dtgamma ] ) , this approach yields physically correct result .",
    "the momentum transferred to the sph particle @xmath37 from interactions with different photon packets @xmath47 is additive , and is used to define the radiation pressure force on that particle .",
    "we sum all the interactions that the sph particle experienced during its time step @xmath48 , and then define the radiation pressure force on particle @xmath37 by @xmath49    due to limitations on photon propagation time steps @xmath19 ( see below ) , an sph particle may interact several times with a particular photon @xmath47 .",
    "there is however ho paradox here , as this simply means that the radiation transfer equation is integrated in multiple points along the photon s trajectory within each sph particle , increasing the precision of the method over traditional monte - carlo approaches .",
    "this formulation also allows us to enforce an exact pair - wise conservation of momentum in the interactions of matter and radiation",
    ". the energy transfer can be calculated in exactly same manner except @xmath42 is replaced by @xmath50 .",
    "external radiation sources such as stars or accreting compact objects emit photon packets with a given momentum @xmath18 .",
    "the rate of packet emission is given by @xmath51 where @xmath52 is the luminosity of the source and @xmath53 is the speed of light .",
    "the radiation field can be chosen to be isotropic or beamed / restricted to a range of directions .",
    "there are several issues to consider when deciding how far the photon can travel in a single flight @xmath54 .",
    "first of all , this distance should be much smaller than the typical sph smoothing length , @xmath55 , in the region , or else the photon will `` skip '' interactions with some sph particles altogether .",
    "this constraint is important in both optically thin and thick regimes . in the optically thick case , an additional constraint need to be placed to insure that photons do not propagate in one step by more than a fraction of their mean free path , @xmath5 . in the opposite case photons",
    "would `` diffuse ''",
    "though optically thick regions in an unphysical way , i.e. , too quickly .",
    "these constrains are combined by requiring @xmath56\\ ; , \\label{dtgamma}\\ ] ] where @xmath57 is a small dimensionless number . in practice",
    "we use @xmath58 .    as discussed below in  [ sec : prompt ] , in the `` prompt escape '' regime , it is possible to reduce the photon propagation speed below the speed of light , which then allows us to integrate photon trajectory on longer time steps without compromising the physics of the problem .",
    "following @xcite , radiation hydrodynamics of a problem can be divided into three different regimes .",
    "let @xmath59 be a characteristic gas velocity , such as the sound speed or the bulk gas velocity , whichever is greater .",
    "define @xmath60 and optical depth of the system @xmath61 , where @xmath62 is the geometric size of the system .",
    "the three limiting regimes @xcite are @xmath63 @xmath64 @xmath65    in the first regime a typical photon leaves the system in a single flight . in the second case",
    "the photon scatters or get absorbed and re - emitted approximately @xmath66 times before leaving the system . for what follows it",
    "is important that in the first two regimes photons escape from the system on timescale , @xmath67 , much shorter than the matter distribution can alter significantly , i.e. , @xmath68 here @xmath69 is the geometric size of the system . in contrast , in the dynamic diffusion limit the photon diffusion time is larger than the crossing time of the system , @xmath70",
    ".    equation [ tesc ] shows that the exact value of the speed of light is irrelevant in the free streaming and the static diffusion limits ; it is so high it can be considered infinite . to the contrary , in the dynamic diffusion limit the exact value of speed of light is important as it defines the time scale on which radiation from the system leaks out , and that time scale is long .",
    "therefore , we combine the free streaming limit and the static diffusion limit of @xcite into the `` prompt escape '' regime given by the equation [ tesc ] . in this limit",
    "it is numerically convenient and physically permissible to reduce the photon propagation speed @xmath71 below @xmath53 , as long as the system still satisfies equation [ tesc ] with @xmath53 replaced by @xmath71 .",
    "we found that this speeds up calculations in which gas dynamics is important , although the scaling is not as efficient as the factor @xmath72 .",
    "the reason for that is that although photon time step ( equation [ dtgamma ] ) is indeed longer by the factor of @xmath72 , the number of photon packets for a given @xmath14 is correspondingly higher ( see equation [ ngamma ] and note that @xmath73 ) .",
    "this radiation - gas momentum transfer method has been implemented in the sph / n - body code gadget @xcite that is widely used for cosmological simulations . for the tests presented here the cosmological options of the code",
    "are turned off .",
    "gadget uses a barnes - hut tree to speed up calculation of gravitational forces and for finding neighbours .",
    "as photon packets have no mass associated with them , we turn off the gravity calculation for these particles . they are also not included in building the barnes - hut tree .    to find sph neighbours of a photon",
    ", we first find all sph particles that are inside a sphere with size @xmath74 which is chosen to be much larger than the mean sph particle smoothing length .",
    "we then further select only those sph particles @xmath37 that contain the photon within their smoothing length @xmath36 .    after calculating the radiation pressure force for a given sph particle @xmath37",
    ", the corresponding radiative acceleration @xmath75 is added to the hydrodynamical and gravitational accelerations that the particle experiences .",
    "we have also added the radiation pressure acceleration to the time step criteria for the sph particles , as described in @xcite .",
    "this ensures that sph particle time steps are appropriately short for particles with large radiation pressure accelerations .      in  [ sec :",
    "slab_transfer ] we tested the radiation transfer methods for the density field given by a simple analytical function ( a constant ) . in ",
    "[ sec : interactions ] we presented a way to model radiation transfer in an arbitrary density field represented by the sph particles .",
    "it is a logical step forward in complexity of the tests to now repeat the slab test of  [ sec : slab_transfer ] in a self - consistent sph density field .    to accomplish this",
    ", we consider a non self - gravitating accretion disc in orbit around a massive ( @xmath76 in code units ) central source .",
    "the disc is assumed to be locally isothermal , with internal energy @xmath59 scaling as @xmath77 , where @xmath69 is radius , and @xmath78 is the internal energy at the inner edge of the disc , @xmath79 .",
    "this scaling yields a constant ratio of the vertical disc scale height , @xmath80 , to radius",
    ". the outer radius of the disc is @xmath81 .",
    "the disc was then relaxed for a large number of orbits without any radiation field , which yields a gaussian vertical density profile @xcite . keeping this density profile fixed",
    ", we then introduced photon sources in the disc midplane and allowed the photons to propagate out of the disc keeping the opacity coefficient @xmath82 fixed everywhere in the disc .",
    "figure [ fig : slab_transfer ] shows the resulting photon energy density distribution within the slab ( solid curve ) in exactly same manner as in the fixed density tests shown before in figure [ fig : slab_rt ] . as before ,",
    "the radiation field has been averaged over several snapshots to reduce statistical noise .",
    "the respective monte - carlo result obtained for the same density distribution is shown in figure [ fig : slab_transfer ] with the red dashed curve .",
    "there is a very good agreement between the curves , except for the peak region in the red curve .",
    "time sampling differences in the two simulations explain the discrepancy in the curves ; see discussion of figure [ fig : slab_rt ] in  [ sec : slab_transfer ] .",
    "this test suggests that the radiation transfer part of our approach is working as expected . below",
    "we shall move on to tests that involve gas dynamics .",
    "young massive stars produce most of their radiation in the uv wavelengths .",
    "dust in the interstellar gas has a very large absorption opacity for uv photons , with @xmath83 up to a few hundred @xmath84 g. if these photons are absorbed and re - emitted in the infrared , where roseland opacity is orders of magnitude smaller than @xmath83 , in many applications one can effectively assume @xmath85 . in this case",
    "it is sufficient to consider only the radiation pressure from the uv photons emitted by the young stars , and neglect the re - radiated component . finally , one can approximate the large uv opacity by an infinitely large one , @xmath86 .",
    "photon packet propagation is then trivial : packets travel in straight lines with constant momentum @xmath87 until they encounter an sph particle(s ) , at which point they are absorbed and their momentum is transferred to that particle(s ) .",
    "this `` on the spot '' absorption method can also be used to model _ fast _ gas winds from massive stars or luminous black holes in the momentum driven regime . in the latter case",
    "the cooling time in the outflow is short .",
    "shocked outflow gas cools very quickly , and hence its thermal pressure can be neglected .",
    "the momentum transferred to the ambient medium provides the push to drive the shell out .",
    "if the wind velocity is much higher than the velocity of the expanding shell and the speed of sound in the ambient gas , one can also neglect the mass outflow from the source .",
    "this is justified as the mass flux in the wind is small compared with that of the ambient gas being driven out .    the `` on the spot '' approximation presents a convenient test ground of our code since it is possible to derive exact analytical solutions in the simplest cases . in particular , we consider a single radiation source embedded in an infinite initially uniform isothermal medium .",
    "gravity is turned off for simplicity .    in practice",
    "we set up periodic boundary conditions for a cubic box with dimensions , @xmath62 , of unity on a side .",
    "these boundary conditions are appropriate and do not affect our results since the radiation force effects are contained to a small region within the box during the simulations .",
    "gas internal energy is fixed at @xmath88 , hence sound speed @xmath89 .",
    "the total mass of the gas inside the box is @xmath76 .",
    "the unit of time is @xmath90 .",
    "@xmath91 sph particles is used in these tests .",
    "the initial condition is obtained by relaxing the box without the radiation source to a state of nearly constant gas density over hundreds of dynamical times for the simulation box .",
    "we first consider a case with a relatively small source luminosity @xmath92 in the code units . in this case",
    "a quasi - steady state should be set up quickly .",
    "we consider that state here .",
    "figure [ fig : onthespot ] shows the density profiles obtained in four different runs at dimensionless time @xmath93 , when the sph quantities approach a quasi steady state .",
    "theoretical expected density profile is given by @xmath94 for @xmath95 and @xmath96  const  @xmath97 for @xmath98 . here",
    "@xmath99 is the size of the cavity opened up by the radiation .",
    "this is obtained by requiring a force balance between the momentum flux from the source , @xmath100 , and the external pressure of the gas @xmath101 : @xmath102^{1/2}\\;. \\label{rcav}\\ ] ] the expected discontinuous density profile is shown with the solid ( black ) line ( we have neglected a slight density increase due to evacuation of the gas from the cavity , since @xmath103 , the box size ) .",
    "figure [ fig : onthespot_v ] shows instantaneous velocities of sph particles corresponding to the respective panels in figure [ fig : onthespot ] .",
    "theoretically expected result for velocity in the steady state is @xmath104 everywhere , of course .",
    "figures [ fig : onthespot ] and [ fig : onthespot_v ] show that at relatively large values of the photon packet momentum , corresponding to a lower packet injection rate @xmath105 , the method is inaccurate . for @xmath106 ,",
    "no cavity is opened at all around the source . moreover , sph particle velocities have random components at a 30% fraction of the sound speed , even at regions far behind the expected discontinuity at @xmath107 .",
    "in contrast , tests with @xmath108 and @xmath109 produce nearly identical results with velocity fluctuations below a few percent level at @xmath110 .    physically , if @xmath111 , interaction of an sph particle with a single photon packet may accelerate the particle to velocity exceeding the sound speed , leading to a significant numerical noise . in the tests presented here ,",
    "a typical sph particle momentum is @xmath112 , as @xmath113 .",
    "therefore , the two runs with @xmath114 do very poorly , as expected .",
    "these numerical experiments show that the minimum accuracy requirement _ in optically thick _",
    "limit is @xmath115    for further quantitative analysis of the errors , consider now the width @xmath116 of the transition layer .",
    "this layer is defined as the region in which sph density goes from zero to unity .",
    "first , note that on average , a gas parcel within volume @xmath117 situated on the inner face of the transition region receives one photon packet every @xmath118 seconds . during this time , sph particles inside the parcel experience no radiation pressure `` pushes '' .",
    "we assume that in the absence of radiation forces , the volume is quickly accelerated by the pressure gradient force to @xmath119 .",
    "there are @xmath120 sph particles within the volume , where @xmath121 is the typical number of sph neighbours ( usually chosen to be around 40 ) .",
    "due to the spherical symmetry of the problem , the parcel travels inwards to the radiation source a distance @xmath122 before it is turned back by the arrival of the next photon packet . finally , since the volume element is located on the inner boundary of the cavity evacuated by the radiation pressure , it will expand when moving into the cavity .",
    "hence the appropriate smoothing length of the element will be larger than that far from the cavity , and in general we expect @xmath123 in that region . using the latter estimate in equation [ deltat1 ]",
    ", we obtain for the thickness of the transition layer , @xmath124^{1/3}\\;. \\label{deltar}\\ ] ] the transition layer thickness calculated in this way is indicated in figure [ fig : onthespot ] with dotted ( @xmath125 ) and dashed ( @xmath126 ) lines .",
    "it appears to be a good estimate for the three runs out of the four shown in the figure . in the run with the highest photon packet resolution ,",
    "i.e. , the smallest @xmath14 , equation [ deltar ] is an under - estimate .",
    "this is simply because a density discontinuity in sph can not be narrower than the width of the kernel , i.e. , the minimum smoothing length , which is about @xmath127 for all the four tests .",
    "inserting equations [ rcav ] and [ ngamma ] into equation [ deltar ] , and requiring @xmath128 to not exceed the characteristic smoothing length of the problem leads to the same requirement of the packet s momentum to be small enough compared with the typical sph momentum ( equation [ psph ] ) .",
    "summarising the results of these tests , we see that we can use the condition [ psph ] as the photon packet resolution requirement in an optically thick limit .",
    "in addition , stochastic noise arguments appeared useful when determining the width of the transition layer in figure [ fig : onthespot ] .",
    "keeping to the model of a single source radiating photons isotropically into an infinite , constant density , isothermal medium , we performed a further test whereby the luminosity of the source was significantly higher , @xmath129 .",
    "this time the focus of our attention is the evolution of the radius of the expanding shell with time , well before it reaches the equilibrium cavity size .",
    "this test is closely related to the ram - pressure driven wind test ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) , but with the important distinction that in our method the photon ` gas ' is massless . this however should be a good approximation to a low density but high velocity outflow .",
    "the other important aspect of our model is the isothermal condition , corresponding physically to a shocked gas region that is allowed to cool very quickly , i.e. when the cooling time in the shocked gas is far shorter than the dynamical time .",
    "this tends to occur when the temperature is less than @xmath91 k , so that line cooling from ions dominates @xcite .",
    "the picture then is that of a momentum - conserving ` snowplow ' phase of an expanding gaseous bubble as it sweeps up the ambient gas into an increasingly massive shell .",
    "this model has three zones : ( i ) an evacuated cavity through which free - streaming photons are being emitted from the central star ( ii ) a shell of shocked ism gas at temperature @xmath130 bounded by an outer shock front and ( iii ) the undisturbed uniform ism at temperature @xmath130 .",
    "the initial conditions for this test and numerical setup are same as in  [ sec : steady ] .",
    "the choice of the higher luminosity is motivated by a requirement that the mach number be high so that the pressure from the ambient gas did not have a significant effect on the evolution of the shell during the run . to aid this ,",
    "the gas internal energy was set to a lower value of @xmath131 .",
    "the analytical solution to a momentum - conserving bubble can be derived by considering the thin - shell approximation , whereby the swept - up gas is assumed to be concentrated in an infinitely thin shell that is being driven by the impinging wind . in reality",
    "the shell gets thicker the more gas it sweeps up , but at all times the thickness of the shell , @xmath132 , is much less than the radius @xcite : @xmath133 where @xmath134 is the mach number and @xmath69 is the radius of the shell .",
    "the zeroth order accuracy analytical solution is found by equating the rate of change of momentum of the expanding shell to the momentum flux from the stellar luminosity : @xmath135 = \\frac{l}{c}\\;.\\ ] ] the time evolution of the radius of the shell is therefore given by , @xmath136 we assumed here that the velocity of the particles carrying the momentum outflow from the source , @xmath71 , is much larger than the shell velocity , @xmath137 .",
    "this solution can be further improved by taking account of the finite speed of the wind ( photon packets in our code ) . in this case",
    "there is a time delay of @xmath138 before the wind particles strike the ambient gas .",
    "in addition , external pressure from the ambient medium provides some restoring force , slowing down the expansion of the bubble .",
    "factoring these effects into equation [ eq : shell ] leads to a more accurate description of the shell : @xmath139 = \\frac{l}{c } \\left ( t - \\frac{r}{v_{\\gamma}}\\right ) - 4\\pi r^{2 } \\rho c_{s}^2 t\\ ] ] which is integrated numerically to obtain a solution for @xmath69 .",
    "figure [ fig : expanding_shell ] shows the results of the test with @xmath140 .",
    "the solid black line shows the time evolution of the shock front ( identified by the peak in the density distribution ) in the sph simulation .",
    "the analytical result given by equation [ ranalytical1 ] is shown with the red dotted line .",
    "the green dotted line in figure [ fig : expanding_shell ] is a numerical solution of the more accurate equation [ eq : shell_numerical ] .",
    "the difference between the two expected solutions ( red and green ) is rather minimal since the external pressure is small compared with the ram pressure of the outflow and the photon packet s velocity is large , @xmath141 .",
    "figure [ fig : expanding_shell ] shows an excellent agreement between the expected 1d solution and the simulation s result .",
    "a simple but useful test of gas dynamics is provided by optically thin gas illuminated by a constant radiation flux . clearly the radiation force in this case",
    "must be a constant independent of position or time . in the stochastic approach of our method , however , the force can in principle vary spuriously due to statistical fluctuations , which may lead to numerical artefacts .",
    "our goal here is to investigate their nature , magnitude and scaling with the number of photon packets used .    as in  [ sec : onspot ] , the initial condition is a uniform density box with a side equal to 1 .",
    "the sph particles are allowed to interact with each other hydrodynamically only ( i.e. , self - gravity is turned off ) . in the tests reported here , a given number of photons @xmath142 propagates in the positive @xmath143-direction .",
    "the momentum of photons is set by requiring the time and volume averaged radiative acceleration be equal to a parameter @xmath144 .    in the limit of an infinite number of photons and an absence of any numerical artefacts , all the sph particles",
    "should be accelerated with acceleration @xmath144 , so that their @xmath143-component of velocity is @xmath145 . in reality",
    "different sph particles interact with different number of photons due to stochastic fluctuations , and hence their accelerations and @xmath146 are not exactly equal .",
    "we define the mach number of spurious sph velocity fluctuations as a measure of the error in this test : @xmath147^{1/2}\\ ; , \\label{macherr}\\ ] ] where @xmath148 is the total number of the sph particles , and @xmath149 is the average particle velocity at time @xmath150 .",
    "the quantity in the square brackets is the velocity dispersion , of course .",
    "we can build a simple `` theory '' to estimate the error in these tests .",
    "we shall assume that velocity dispersion is driven by the stochastic fluctuations in the number of photon - sph interactions in different regions of the box .",
    "we shall also assume that fluctuations in these will be uncorrelated on a timescale of order the sound crossing time of the box , @xmath151 . during this time the mean number of the interactions between photons and a parcel of gas with size @xmath152 ( where @xmath55 is the smoothing length ) is @xmath153 where @xmath154 is the volume average density of photons in the box .",
    "the parcel is going to be accelerated to velocity @xmath155 during this time .",
    "each photon then accelerates the parcel by a velocity increment of @xmath156 as the number of photon - parcel interactions fluctuates by @xmath157 , we expect that random velocity fluctuations will be of the order of @xmath158 figure [ fig : slab_box_error ] compares the measured error and the one predicted by equation [ dispv ] for three runs . in the runs",
    "the sph particle number is fixed at @xmath159 , @xmath160 , @xmath161 , and the number of photon packets inside the box is varied from @xmath162 ( upper curve ) , through 300 ( middle , dashed curve ) to @xmath163 ( lower , dashed curve ) .",
    "the respective straight lines show the `` theoretical '' estimate given by equation [ dispv ] .",
    "the agreement is reassuringly good .",
    "one can also note that the error indeed saturates rather than grows with time , except for a few initial sound crossing times .",
    "this is due to the stochastic fluctuation becoming uncorrelated on dynamical time , as we assumed above .",
    "we also ran a large number of additional tests all with the same setup described in this section , but varying the number of sph particles up to @xmath164 , mean radiation pressure acceleration @xmath144 ( increasing it to @xmath165 and @xmath166 ) , and also varying the photon velocity @xmath71 by a factor of 2 in either direction .",
    "the resulting errors and their scalings were compared with that predicted by equation [ dispv ] , confirming the excellent agreement of the expected and measured errors further .",
    "equation [ dispv ] shows that , at the same @xmath144 ( equivalently , the same radiation flux ) , the velocity error scales as @xmath167 the scaling of @xmath168 with the number of photon packets as @xmath169 could be intuitively expected on the basis of poisson statistics of random fluctuations .",
    "the scaling of equation [ dispv ] with the smoothing length @xmath55 , which is proportional to @xmath170 , shows another important point .",
    "if a larger number of sph particles is used , resulting in a higher spatial resolution within the simulation volume , then the number of photon packets should also be increased ( if one wishes to keep the velocity errors within a given limit ) .",
    "consider optically thin gas in the vicinity of a very massive point mass , e.g. , a black hole , radiating exactly at the eddington limit .",
    "obviously , gas particles should experience no net force from the point source .",
    "in particular , if sph particle velocities are zero initially , they should remain zero , and any gas motion is an evidence of problems in the numerical methods used .    for ease of analysis",
    ", we consider a self - gravitating gas cloud , with a polytrophic index @xmath171 . in the absence of external forces",
    "the cloud settles into a well known equilibrium configuration for polytropic stars .",
    "this equilibrium state is obtained by relaxing ( that is evolving ) the isolated cloud for many dynamical times to provide a noise - free initial condition .",
    "gravity is switched on in this test . however , as our focus is on testing the radiation pressure force , the gravitational force of the gas acting on the point mass is switched off . the radiation source is hence fixed in its initial location , which simplifies a quantitative analysis of the results below .",
    "the mass unit for the test is the mass of the point source , @xmath172 .",
    "the mass of the cloud is @xmath173 .",
    "the polytropic constant is such that the equilibrium size of the cloud , @xmath174 , is approximately 4 units of length .",
    "25,000 sph particles are used to model the cloud .",
    "the tidal force from the central point is of the order of @xmath175 , where @xmath69 is distance to the point mass .",
    "there are two distinct regimes , then . in the first the tidal force acting on",
    "the cloud exceeds the self - gravity of the cloud , @xmath176 , whereas in the opposite regime the self - gravity of the cloud dominates over the tidal force .",
    "the former regime occurs when @xmath177 , the separation between the point mass and the centre of the cloud , is relatively small , @xmath178 .",
    "the case of a negligible tidal force , @xmath179 , occurs when the cloud is far away from the black hole , e.g. , @xmath180 .      in these tests",
    "the cloud is initially positioned at @xmath25 and the emitter is at @xmath182 . at this separation ,",
    "the tidal force is approximately 10 times greater than self - gravity of the cloud .",
    "thus , a @xmath183% error in the radiation pressure force is larger than the self - gravity holding the cloud together .",
    "these tests are hence expected to be very sensitive to numerical deficiencies of our method .",
    "we performed two tests in this setup . in the first , labelled lrz10 ( low resolution , @xmath181 ) , the dimensionless photon momentum is @xmath184 , whereas in the second , named hrz10 ( higher resolution ) , @xmath185 .",
    "the mass of the sph particles is the same in both tests , @xmath186 .",
    "the typical momentum of sph particles , defined as @xmath187 , is @xmath188 in code units .",
    "therefore , in both of these runs @xmath189 .",
    "figure [ fig : z10_standard ] shows the column density profile of the cloud at time @xmath190 for both runs .",
    "the left panel shows run lrz10 and the right panel shows hrz10 .",
    "time @xmath190 corresponds to about 3 free - fall times at the given source - cloud separation . in both cases there is a certain deformation of the cloud .",
    "as expected , the lower resolution test produces poorer results than the higher resolution test .",
    "a more detailed error analysis is described in  [ sec : error_analysis ] below .      in this test the separation of the cloud and the source is set to @xmath191 , thus we label the test z30 .",
    "the photon packet momentum is @xmath192 in the test .",
    "the parameters of the gas cloud are exactly the same as in tests lrz10 and hrz10 , but because the cloud is farther away from the point mass , typical sph momentum is a little lower , @xmath193 .",
    "thus in terms of ratio @xmath194 test z30 is very similar to lrz10 .",
    "however , since the cloud is farther away , the self - gravity of the cloud actually exceeds the tidal force by a factor of about 3 .",
    "therefore , one expects intuitively that the same level of stochastic error in the radiation pressure force will result in smaller perturbations as the radiation pressure force itself is smaller .",
    "this is indeed borne out by the test . by the time @xmath195 , which is again about three free - fall time scales from the clouds initial location",
    ", no visible deformation of the cloud has occurred .",
    "we therefore do not show the column density for test z30 .      to quantify the accuracy of the tests , we calculate the centre of mass velocity of the cloud , @xmath196 as a function of time . using this in place of @xmath197 in equation [ macherr ]",
    ", we define the mean mach number of spurious velocity fluctuations in the cloud .",
    "figure [ fig : z10_standard_err ] shows these quantities as a function of time for lrz10 ( red curves ) and z30 ( black ) runs .",
    "the mach number of velocity fluctuations are shown with thick solid lines .",
    "the centre of mass velocities are shown normalised to @xmath198 , where @xmath199 , the circular keplerian velocity at the appropriate separation @xmath200 for the test .    the motion of the cloud s centre of mass characterises the systematic error of the method .",
    "both runs demonstrate that the velocity of the centre of mass of the cloud is between 1 to 2 % of the keplerian velocity after about 3 free - fall times .",
    "this translates into inaccuracy in the calculation of the radiation pressure force versus point mass gravity , averaged over all sph particles , of a fraction of a percent",
    ". this accuracy should be sufficient for simulations in which gravity forces are calculated to a similar fractional precision .",
    "furthermore , we found that this offset , although always small for a large enough number of photon packets , actually depends on the random number generator used to approximate the isotropic photon field .",
    "the results can thus be improved by using quasi - random rather than pseudo - random sequences for photon packet s angular distribution .",
    "we shall investigate this issue in the future .    the mach number of the fluctuations , instead , quantifies the difference in the radiative accelerations received by different parts of the cloud .",
    "we again use the simple logic of random stochastic fluctuations in the number of photon packets @xmath201 interacting with an sph particle with smoothing length @xmath55 , as explained in  [ sec : slab ] .",
    "thin solid curves in figure [ fig : z10_standard_err ] show the mach number of velocity errors predicted by this simple argument . evidently , the errors are again explainable by the poisson noise estimates .",
    "in this test the initial condition is the same optically thin cloud as used in  [ sec : static ] , but the point mass source is located exactly at the centre of the cloud , and allowed to accrete gas particles that are separated from it by less than @xmath202 .",
    "the radiation field in this test is halved to @xmath203 .",
    "while the analytical solution to this problem ( for the given initial density profile ) is not known to us , we note that the setup is exactly identical to a non - radiating sink particle with mass @xmath204 placed into the centre of the cloud and allowed to accrete the gas within the sink radius @xmath205 .",
    "the desired control result is thus obtained by running the hydro - gravity part of the code only with the sink particle mass @xmath204 .",
    "photon momentum is set to @xmath206 .",
    "figure [ fig : accretion1 ] presents both the radiation hydrodynamical simulation and the control hydro run with @xmath204 at dimensionless time @xmath207 .",
    "the lower panel shows the sph particle radial velocities normalised by the local free - fall velocity @xmath208 with @xmath204 .",
    "the upper panel shows the density profile of the cloud .",
    "both velocity and density profiles of the rhd simulation and the control run are nearly identical , although one can notice a larger amount of scatter in the @xmath209 test .",
    "the results continue to be very similar at latter times as well , and the accretion rate histories are also very similar .",
    "the radiation transfer method thus performs reasonably well .    to quantify the errors of the tests",
    ", we estimate their magnitude based on the poisson noise arguments in the same manner as in  [ sec : slab ] .",
    "in particular , we can apply equations [ dv1 ] and [ dispv ] , except that the characteristic time is now not @xmath151 but the local dynamical time , @xmath210 with @xmath211 ( and @xmath212 in the code units ) .",
    "thus , the number of photon packets passed through a given particle is estimated as @xmath213 .",
    "the stochastic velocity fluctuations due to the finite number of photon packets is then @xmath214    to compare the expected fluctuations given by equation [ dv_accretion ] with those actually incurred , we ran a poorer resolution test with @xmath108 , i.e. , ten times larger than the test shown in figure [ fig : accretion1 ] .",
    "the errors ( scatter ) are then obviously larger .",
    "figure [ fig : accretion_errors ] shows the results in black dots for two snapshots at times indicated .",
    "the red lines show the control run , as before , but this time velocity curves in the lower panel of the figure include the expected errors . in particular , the upper red sequence of dots is @xmath215 , whereas the lower red dots is @xmath216 , where @xmath168 is calculated with equation [ dv_accretion ] .    evidently , the scatter in the radiation transfer simulation ( black dots ) is very similar in magnitude to what is predicted by equation [ dv_accretion ] . at the earlier time snapshot , shown on the left side of figure [ fig : accretion_errors ] ,",
    "the measured velocity scatter is somewhat larger than our prediction .",
    "we believe this is due to the fact that equation [ dv_accretion ] does not include the poisson noise resulting from the initial distribution of photons packets at @xmath217 .",
    "the latter is generated by sampling a uniform random distribution in both emission time and directions .    in conclusion ,",
    "these tests demonstrate the potential of the method for accretion and radiation pressure problems , and that equation [ dv_accretion ] once again provides a reliable estimate of the stochastic errors of the results .",
    "a new method for implementation of radiation pressure force in an sph code has been presented .",
    "radiation is modelled via a time - dependent monte - carlo approach .",
    "photon packet s momentum is transferred to sph particles via direct photon - to - gas interactions that are calculated as photons propagate through the field of sph particles .",
    "the sph density field is used to calculate the sph density at photon packet s positions , thus maximising the accuracy of the method . as a result , local and global momentum conservation in the interactions between radiation and gas is achieved .",
    "several tests have been presented to check the consistency and accuracy of the method , as well as error scalings with parameters of the problem .",
    "it was found that the main deficiency of the method , as for any monte carlo method , is the poisson noise resulting from a finite number of photon packets used . in order to reduce velocity fluctuations to subsonic levels",
    ", photon packet s momentum @xmath14 should be chosen to be below the typical sph particle momentum , @xmath218 , where @xmath219 is the characteristic sph particle velocity .",
    "we shall now try to generalise and summarise the error estimates and various constraints on performance of the code .",
    "we first assume an optically thin case .",
    "let @xmath220 be the radiation flux at a given location in the gas .",
    "the flux is related to the photon number density @xmath221 , photon momentum @xmath14 and photon velocity @xmath71 through @xmath222 as the energy carried by the photon packet is @xmath223 .",
    "the rate at which photons are passing through sph particles is @xmath224 the momentum passed to the sph particle by one photon packet is @xmath225 and thus the velocity change @xmath226 is independent of sph mass @xmath227 ( in the optically thin approximation ) .",
    "therefore , at time @xmath150 the velocity fluctuations can be estimated as @xmath228^{1/2 } \\sim \\frac{\\kappa}{h } \\left[\\frac{{\\cal f}_{\\rm rad } p_\\gamma t}{c}\\right]^{1/2}\\ ; , \\label{dvoft}\\ ] ] now , let us define radiation acceleration time @xmath229 , where @xmath230 is the radiative acceleration acting on the sph particle , and @xmath231 is the radiation pressure force on the sph particle . during this characteristic time , the radiation pressure force would accelerate the sph particle from rest to velocity @xmath232 in the absence of other forces .    using equation [ dvoft ]",
    ", the mach number of the fluctuations , defined by equation [ macherr ] , can be shown to be @xmath233^{1/2}\\;.\\ ] ] finally , introducing the `` optical depth '' of the sph particle as @xmath234 , we arrive at @xmath235^{1/2 } \\left(\\frac{t}{t_{\\rm rad}}\\right)^{1/2}\\ ; , \\label{merrfinal}\\ ] ] where @xmath236 .",
    "this was derived in the optically thin limit , i.e. , when @xmath237 . in the limit @xmath238 , the momentum passed from one photon to an sph particle",
    "is reduced from the expression given by equation [ dmom ] to @xmath239 where @xmath240 is the number of sph neighbours for the photon .",
    "as the latter is always at least one when a photon packet interacts with gas , we arrive at the following estimate for the optically thick case , @xmath241^{1/2 } \\left(\\frac{t}{t_{\\rm rad}}\\right)^{1/2}\\ ; , \\label{merrthick}\\ ] ]    both the optically thin limit ( equation [ merrfinal ] ) and the optically thick limit ( equation [ merrthick ] ) demonstrate the importance of choosing photon packet momentum , @xmath87 to be significantly smaller than that of an sph particle to guarantee a reasonable accuracy .",
    "we also notice that applicability of the method to a particular problem depends on the desired level of accuracy . for example",
    ", tidal disruption of a gaseous cloud near a luminous super - massive black hole is a highly dynamic process . to get an insight in the overall dynamics of the process",
    ", it is sufficient to simulate the system for a few dynamical times at the peri - centre of the orbit .",
    "a sufficiently small photon packet s momentum , @xmath242 , should provide a sufficient accuracy in this case .",
    "however if one is interested in a secular evolution of a system , then the required precision is much higher , and careful tests should be done to establish the required value of @xmath14 , or equivalently the photon injection rate @xmath243 .",
    "let us now estimate the required number of photon packets for a given luminosity of the system @xmath244 , subject to the constraint @xmath245 , @xmath246 .",
    "number of packets emitted per unit time is @xmath247 where we exploited the fact that @xmath248 .",
    "@xmath249 here is the total gas mass of the system .",
    "the minimum time that the simulation should last for is the dynamical time , @xmath250 . during this time",
    "the number of photon packets emitted is @xmath251 , and thus @xmath252 where @xmath253 is the radiation energy emitted during the system light crossing time and @xmath254 is the total gas energy . if there are no additional sources of radiation in the cloud , such as bright stars , then the luminosity of the system is of the order of @xmath255 where @xmath256 is the cooling time . in that case",
    "the ratio is @xmath257 many astrophysically interesting problems are in the regime where the cooling time is comparable with dynamical time of the system , in which case the ratio becomes @xmath258 from these expressions it is obvious that the number of photons does not need to exceed the number of sph particles while satisfying the @xmath259 condition for these particular cases .",
    "however , if there is a very bright point source dominating the luminosity of the system , then the number of photon packets needs to be correspondingly higher .",
    "for example , in the tests presented in ",
    "[ sec : static ] , photons produced during the duration of the simulations outnumbered sph particles by factors of @xmath260 .",
    "our radiation transfer method unfortunately becomes very expensive in optically thick medium , i.e. , when the optical depth of the system , @xmath261 , is very high .",
    "this is due to two factors .",
    "first of all , photons scatter or get absorbed / re - emitted @xmath262 ( that is many ) times before they exit the system .",
    "they thus `` hang around '' for longer before exiting the system , hence increasing computational cost of the simulation .",
    "secondly , they require smaller time steps as we now show .",
    "recall that in ",
    "[ sec : prompt ] we argued that it is numerically permissible and beneficial to use photon packets with velocity @xmath71 smaller than the velocity of light in the following case .",
    "in moderately optically thick , non relativistic plasmas , photons pass through the system much quicker than dynamical time , and hence exact value of @xmath71 is unimportant .",
    "the photon time step can then be increased inversely proportional to @xmath71 . however ,",
    "this is possible only as long as @xmath263 or else using too small a value for @xmath71 would incorrectly put the radiation transfer into the dynamic diffusion limit ( see  [ sec : prompt ] ) .",
    "further , in the optically thick case the photon time step is limited to @xmath264 , where @xmath5 is the mean free path ( equation [ dtgamma ] ) . comparing this to dynamical time of the system , @xmath265 where we used equation [ vgamma ] to constrain @xmath71 .",
    "this expression changes to @xmath266 if one sets @xmath267 .",
    "obviously , in both of these cases the time step becomes very small as @xmath261 increases , and the code becomes quite inefficient .    in problems with a very high optical depth combining the dynamic monte carlo and",
    "the diffusion approximation in very optically thick regions would be optimal , although it is not clear whether such `` on the fly '' method could be devised .",
    "a new time - dependent algorithm to model radiation transfer in sph simulations was presented . in the present paper we concentrated on the radiation pressure effects , i.e. , the momentum transfer between the radiation and the gas , assuming a given equation of state for the gas .",
    "we performed a number of tests of the code .",
    "our method is grid - less and can be applied to arbitrary geometries .",
    "the main disadvantage of the method , as with any photon packet based schemes , is the poisson noise due to a finite number of photons . on the other hand ,",
    "these stochastic errors can be readily estimated and controlled by increasing the number of photon packets .",
    "the method is best applicable to optically thin or moderately optically thick systems , as following photon trajectories become very expensive at high optical depths .",
    "extension of the approach to include energy exchange between the gas and radiation will be presented in a future paper .",
    "multi - frequency radiation transfer can also be naturally added .",
    "the authors express gratitude to volker springel who provided the code gadget-3 , helped with the numerical implementation and provided useful comments on the paper .",
    "theoretical astrophysics research at the university of leicester is supported by a stfc rolling grant .",
    "h.  j.  g.  l.  m. , cassinelli j.  p. , 1999",
    ", introduction to stellar winds , introduction to stellar winds , by henny j.  g.  l.  m.  lamers and joseph p.  cassinelli , pp .",
    "isbn 0521593980 .",
    "cambridge , uk : cambridge university press , june 1999 ."
  ],
  "abstract_text": [
    "<S> we present a new framework for radiation hydrodynamics simulations . </S>",
    "<S> gas dynamics is modelled by the smoothed particle hydrodynamics ( sph ) , whereas radiation transfer is simulated via a time - dependent monte - carlo approach that traces photon packets . as a first step in the development of the method , in this paper we consider the momentum transfer between radiation field and gas , which is important for systems where radiation pressure is high . </S>",
    "<S> there is no fundamental limitations on the number of radiation sources , geometry or the optical depth of the problems that can be studied with the method . </S>",
    "<S> however , as expected for any monte - carlo transfer scheme , stochastic noise presents a serious limitation . </S>",
    "<S> we present a number of tests that show that the errors of the method can be estimated accurately by considering poisson noise fluctuations in the number of photon packets that sph particles interact with per dynamical time . </S>",
    "<S> it is found that for a reasonable accuracy the momentum carried by photon packets must be much smaller than a typical momentum of sph particles . </S>",
    "<S> we discuss numerical limitations of the code , and future steps that can be taken to improve performance and applicability of the method .    </S>",
    "<S> [ firstpage ]    physical data and processes : radiative transfer  physical data and processes : hydrodynamics </S>"
  ]
}