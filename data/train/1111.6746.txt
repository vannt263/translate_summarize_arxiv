{
  "article_text": [
    "fmos @xcite is the near - infrared fiber multi - object spectrograph that has been in operation as one of the open - use instruments on the subaru telescope since 2009 .",
    "it can configure 400 fibers of @xmath0 aperture in a 30@xmath1 diameter field of view at the primary focus .",
    "the 400 infrared spectra in two groups are taken by two spectrographs called irs1 and irs2 ( infrared spectrograph 1 and 2 ) in either of two modes : a low - resolution mode with a spectral resolution of @xmath2 20   in the 0.9 - 1.8 @xmath3 m wavelength range , and a high - resolution mode of @xmath2 5   in one of the quarter wavelength ranges of 0.90 - 1.14 , 1.01 - 1.25 , 1.11 - 1.35 , 1.40 - 1.62 , 1.49 - 1.71 , or 1.59 - 1.80 @xmath3 m .",
    "the bright oh - airglow emission lines are masked by the mask mirror @xcite installed in these spectrographs .    the individual tools for image reduction in this package were developed during engineering and guaranteed - time observations since 2008 , in conjunction with other operation and reduction software . although these tools were not developed as part of the public reduction software of fmos , they are now stable , thus they have earned the name of `` fibre - pac '' ( fmos image - based reduction package ) .",
    "the basic concepts underlying the package are as follows :    1 .",
    "most of the reduction is processed by iraf .",
    "several complicated steps are processed by original software written in c using the cfitsio library @xcite .",
    "3 .   almost all of the reduction processes are automated using script files in text format .",
    "4 .   modification of the text files is done by general unix commands .",
    "the original 2-dimensional information is kept as far as possible throughout the reduction processes .",
    "these concepts enable easy implementation and open processing without the inconvenience of licensed or black box parts and ensure traceable operation with visual confirmation .",
    "the 2-dimensional information has advantages not only in filtering out unexpected noise using their small sizes but also on detection of faint emission - features . in this paper",
    ", we describe the reduction process of the fmos images based on its aug.9 - 2011 version , taking care of complex conditions in the infrared , using multiple fibers and the oh - suppressed spectrograph .",
    "the fmos images are acquired by a uniform interval non - destructive readout technique called `` up - the - ramp sampling '' ( hereafter `` ramp sampling '' for short ) .",
    "a typical exposure of 900 seconds consists of 54 images .",
    "after an exposure is finished , a final frame ( treated as a `` raw image '' in the reduction process ) is created where the count in each pixel is calculated by performing a least squares fit to the signal count of 54 images .",
    "in addition to suppressing readout noise , the advantages of the ramp sampling are 1 ) saturated pixels can be estimated from the counts prior to saturation , and 2 ) cosmic - ray events can be detected as an unexpected jump in the counts and removed from the final frame @xcite .",
    "the detection threshold of the cosmic - ray events has been currently set to 10@xmath4 in an empirical way based on the real fmos images .",
    "for irs1 , the fit and the cosmic - ray rejection are done during the ramp sampling , so that the final frame is ready as the exposure finishes . for irs2",
    ", however , the nonlinear bias variation prevents fitting the slope during the exposure .",
    "instead , the ramp fitting is executed after the simple background subtraction ( cf .",
    " 3.2 ) has been performed for all of the images taken during the sampling .",
    "for example , 54 background - subtracted ramp images are prepared prior to fitting . consequently the nonlinear bias component is subtracted together with the background photons .",
    "( 80mm,80mm)figure1.eps    figure [ fig : raw_image ] shows the resulting `` raw image '' after ramp sampling 54 times using irs1 .",
    "raw images for irs2 do not exist for the reasons explained above .",
    "the raw images have the following components :    1 .   thermal background ( @xmath5300 e/900 s ) 2",
    ".   suppressed oh - airglow ( @xmath5600 e/900 s on average ) 3 .",
    "remaining cosmic ray events ( @xmath5200 e / event ) 4 .   read noise ( @xmath510 e rms/54 ramp readout ) 5 .",
    "object ( @xmath530 e/900 s for a 20 mag(ab ) object ) 6 .",
    "dark current ( @xmath610 e/900 s ) 7 .",
    "bias offset ( @xmath610 e / exposure ) 8 .",
    "cross - talk between quadrants ( @xmath50.15% of the count ) 9 .",
    "bad pixels having no efficiency , unusual large dark current , or too large noise ( @xmath50.2% of the pixels ) 10 . on - chip",
    "amplifier glow at the corners of the four quadrants ( @xmath52000 e/54 ramp readout ) 11 .",
    "unknown external noise in a stripe pattern ( quite rare and the amplitude is @xmath5100 e/900 s at most ) 12 .",
    "point spread function ( psf ) of the fiber of 5 pixels with a pitch of 10 pixels between spectra ( having almost no cross talk of the spectra on either side ) 13 .",
    "position of an individual fiber along the slit 14 .",
    "optical distortion 15 .",
    "quantum efficiency and its pixel - to - pixel variation ( `` flat '' pattern ) 16 .",
    "system throughput variation with wavelength 17 .",
    "atmospheric transmittance 18 .",
    "intrinsic absorption and emission of the objects    the thermal background can be removed in the initial subtraction described in subsection 3.2 .",
    "the 2nd strongest component , residual airglow , can be subtracted by interpolation of the background of other fibers after the optical distortion is corrected using a dome - flat image taken in the same observation mode .",
    "the remaining cosmic - ray and other strong noise features having a size smaller than the psf of a fiber are removed in three subsequent stages with different threshold counts . besides the science frames , the following images are necessary for this reduction process .    detector - flat ] reduction process -----------------      before performing a reduction of the science frames , a preparatory process is applied to the dome - flat and th - ar spectral images to determine the optical distortion and the wavelength calibration of the image .",
    "first , flat fielding : the dome - flat image is divided by the detector - flat image to remove differences in the quantum efficiency between pixels .",
    "second , bad pixel correction : the registered and temporally prominent bad pixels , which are picked up by subtraction of 3@xmath73 median filtered image , are replaced with an interpolated value from the surrounding pixels .    third , correction of the spatial distortion : the @xmath8-axis of the image is converted using @xmath9 .",
    "( here , the origin is at the center of the image . )",
    "the four parameters are chosen to make the psf amplitude in the image projected along the @xmath10-axis maximum ( cf .",
    "figure [ fig : spacial_distortion ] ) . in this modification process",
    ", the dome - flat spectrum from each fiber with 9 pixels in width is converted into a parallel line to make a `` combined 1d image '' ( as in figure [ fig : spectral_distortion ] ) that includes the pattern of the airglow mask .",
    "( 80mm,79mm)figure2a.eps ( 80mm,80mm)figure2b.eps    fourth , correction of the spectral distortion : the @xmath10-axis of the combined 1d image is converted using @xmath11 , in which the two parameters are determined for each line so as to minimize the shift and the magnification difference in the mask pattern . the 200 resulting @xmath12 and @xmath13 parameters",
    "are fitted with fourth - order polynomials in @xmath8 to remove the local matching error in the pattern .",
    "this conversion process makes the mask pattern straight in the column direction ( cf .",
    "figure [ fig : spectral_distortion ] ) , which is necessary for better subtraction of the residual airglow lines in the science frames .",
    "these parameters obtained from the dome - flat image are also applied to the th - ar spectral image to make a combined 1d image , as shown in figure [ fig : thar_lamp ] .",
    "although the slit image of each emission line and of the airglow masks should be parallel , alignment errors cause small differences between them .",
    "finally , wavelength calibration : the correlation between the observed wavelength and the pixels of each spectrum are determined , as represented by @xmath14 .",
    "the resulting @xmath15 , @xmath16 , @xmath17 , and @xmath18 coefficients are used to calculate the corresponding wavelengths in each spectrum without changing them , because the @xmath10 positions of the individual fibers in the slit may exhibit some scatter due to imperfect fiber alignment along the slit .",
    "the results of the wavelength calibration are confirmed by comparing the reduced th - ar spectra with an artificial image based on the known wavelengths of the th - ar emission lines ( cf",
    ". figure [ fig : thar_lamp ] ) .",
    "the typical calibration error of the spectra is less than 1 pixel , corresponding to 5   or 1.2   in the low- or high - resolution mode , respectively .",
    "( 80mm,18mm)figure3.eps    ( 80mm,18mm)figure4.eps      since the usual fmos observations are carried out using an @xmath19 nodding pattern of the telescope , @xmath20 simple sky subtractions can be performed using two different sky images : @xmath21 and @xmath22 ( where @xmath23 denotes the image taken at position @xmath24 of the @xmath25-th pair ) . for irs2 , these sky - subtracted frames are calculated by the ramp fitting algorithm applied to the sky - subtracted sub - frames .",
    "when the brightness of the oh airglow varies monotonically , most of it can be canceled by merging these two images according to @xmath26 .",
    "the weight @xmath27 is chosen to make the sum of the absolute count @xmath28 a minimum within the range @xmath29 .",
    "figure [ fig : initial_subtraction ] shows a pair of sky - subtracted images and the merged one . typically , the weight @xmath27 is equal to about 0.5 .",
    "( 50mm,50mm)figure5a.eps ( 50mm,50mm)figure5b.eps ( 50mm,50mm)figure5c.eps      after the initial background subtraction , cross talk is removed by subtracting 0.15% for irs1 and 1% for irs2 from each quadrant .",
    "next , the bias difference between the quadrants ( as indicated in figure [ fig : initial_subtraction ] , the lower left quadrant tends to show a higher bias level ) is corrected to make the average over each quadrant equal . after flat fielding using the detector flat image , the registered and temporally prominent bad pixels are rejected , together with the four adjacent pixels by interpolating the surrounding pixels .",
    "the processed image is converted into a combined 1d image based on the distortion parameters obtained in the preparatory reduction process .",
    "however , only one line of each spectrum ( 9 pixels in width ) is extracted instead of summing the 9 lines .",
    "one can thereby make a set of 9 combined 1d images each of which consists of a different part of each spectrum ( cf .",
    "figure [ fig : residual_subtraction ] ) .",
    "in other words , the psf of a fiber is divided into 9 pieces , only one of which is used in a combined 1d image .",
    "the flexure or temperature change in the spectrograph causes a small difference between the dome - flat and the scientific images along the vertical direction in position . this difference is corrected using the vertical position of the spectra of bright stars . in this way , the counts of the residual sky becomes smooth along the columns after the relative throughput correction of the fibers .",
    "the residual airglow lines are fitted and subtracted in these images , and then the relative throughput difference is multiplied to restore the noise level back to the original state .",
    "the residual subtracted images are recombined to form an image in which the psf of the fiber is determined .",
    "medium - level bad pixels having smaller size than the psf of a fiber are replaced at the end of this process .",
    "( 50mm,50mm)figure6a.eps ( 50mm,50mm)figure6b.eps ( 50mm,50mm)figure6c.eps      there are two ways to observe scientific targets with the @xmath19 nodding pattern : `` normal beam switching '' ( nbs ) , in which all targets are observed at position @xmath24 ( all the fibers are supposed to observe `` blank '' sky at position @xmath30 ) , and `` cross beam switching '' ( cbs ) , in which less than half of the fibers are allocated to the targets at position @xmath24 while the others are at position @xmath30 . in the cbs observation mode , the same targets appear in both images collected in positions @xmath24 or @xmath30 . however , the target spectra in position @xmath30 are merged to minimize the absolute flux of the residual airglow lines in the initial background subtraction process .",
    "thus the same reduction process has to be applied to the images in position @xmath30 , replacing the negative spectra of position @xmath24 with the corresponding parts of the position @xmath30 image ( as shown in figure [ fig : merge_pair ] ) . the merged images ( or all of the position @xmath24 images in the nbs mode )",
    "are then combined into one averaged image .",
    "finally , the combined image is divided into a set of 9 combined 1d images again , in order to perform a fine subtraction of the residual background .",
    "the recomposed image also goes through a bad pixel rejection process .",
    "( 50mm,50mm)figure7a.eps ( 50mm,50mm)figure7b.eps ( 50mm,50mm)figure7c.eps      although the correction for spectral distortions was performed to straighten the images of the airglow masks ( as in figure [ fig : spectral_distortion ] ) , there remain small differences among the throughput patterns of the spectra because of the local shape errors of the mask elements or because of the presence of dust on the mask mirror .",
    "these differences are corrected by dividing the averaged image by a `` relative '' dome - flat image in which the common spectral features have been removed by normalizing the count along lines and columns ( cf .",
    "figure [ fig : relative_domeflat ] ) . after correcting the relative differences of the throughput patterns among the spectra , the corresponding spectra from positions @xmath24 ( positive ) and @xmath30 ( negative ) taken in the cbs observation mode are ready to be combined .",
    "the negative spectra in the image are then inverted and rearranged so that they can be combined with the corresponding positive spectra ( as shown in figure [ fig : cbs_combine ] ) .",
    "( 80mm,18mm)figure8.eps    ( 50mm,50mm)figure9a.eps ( 50mm,50mm)figure9b.eps ( 50mm,50mm)figure9c.eps      in the process of fitting and subtract the residual background , some fraction of the object flux can be subtracted . the best way to retain",
    "the object flux is to mask the objects during the fit .",
    "faint objects to be masked are therefore selected by a human eye on the combined image and the reduction process is repeated with these masks applied .",
    "the mask density should not be too high to make the residual background subtraction work well : the maximum density allowed is roughly 75% of the image .      before the mask edge correction process , the distribution of noise in an image is truncated poisson distribution caused by the bad pixel rejection process in three subsequent stages .",
    "although the noise level in an image is almost homogeneous at this stage , the noise level map becomes complicated during the throughput correction and cbs combine . to estimate the noise level of each pixel",
    ", a frame is defined that consists of the squared noise level measured along columns just before the mask edge correction . here",
    ", the noise level is measured by a 3@xmath4 clipping algorithm iterated ten times for each column , while some extra contribution proportional to the count is added to the clipped pixels .",
    "this square - noise frame is divided by the squared image of the relative dome flat , and reduced to half wherever a pair of spectra is averaged during the cbs combine .",
    "note that the noise level of the bright objects is probably underestimated because the systematic uncertainty ( i.e. sub - pixel shifts of the spectra in raw images and tiny variation of the throughput pattern caused by the instrument status such as temperature ) is the major contribution for them .",
    "to calibrate the flux of the scientific targets , at least one bright ( @xmath31@xmath32mag ) star in each science frames is needed as a spectral reference , because it must have almost the same atmospheric absorption feature as that for the scientific targets in the same field of view .",
    "all the spectra are divided by the reference spectrum , and then multiplied by the expected spectrum of the reference star whose flux and spectral type are known or can be determined by the observed values in two different wavelength regions . if the cataloged or estimated spectrum of the reference star is correct , all the observed spectra will then be calibrated accurately . in the next subsection , the method to estimate the reference star spectrum is described .      since the flux and slope of the spectrum of a reference star are determined from the measured counts in an image",
    ", one needs the slope - removed template spectra including the intrinsic absorption features of the star .",
    "we analyzed 128 stellar spectra in the irtf spectral library @xcite split into seven groups : f0-f9iv / v ( 19 objects ) , g0-g8iv / v ( 14 objects ) , k0-k7iv / v ( 10 objects ) , f0-f9i / ii / iii ( 21 objects ) , g0-g9i / ii / iii ( 31 objects ) , k0-k3i / ii / iii ( 17 objects ) , and k4-k7i / ii / iii ( 16 objects ) . in each group",
    ", the spectra were averaged to improve the s / n ratio and divided by the results of the linear fitting , so that slope - removed template spectra of seven different types were prepared ( cf . figure [ fig : irtflib ] ) . here ,",
    "only f , g , and k type stars were used to make the slope - removed template spectra , because 1 ) their slope - removed spectra become roughly straight in @xmath33 - @xmath34 plot , 2 ) these stars are quite popular and easy to select in the target field , and 3 ) a and earlier type spectra are neither available in the irtf spectral library , nor in other database with similar qualities .",
    "next , the correlations between the spectral types and the slopes of the spectra have to be established .",
    "figure [ fig : type_slope ] shows the distribution of measured value of 128 stellar spectra from figure [ fig : irtflib ] .",
    "the stellar types are numbered from 0 ( f0 ) to 29 ( k9 ) while the slopes are defined by @xmath35 in @xmath36 .",
    "the correlations between the spectral types and the slopes are determined by second - order polynomial fits to the distributions of stellar types iii and v :    @xmath37 @xmath38    as a result , any spectrum from f0 to k9 can be synthesized by multiplying a linear spectrum having a defined slope with the intrinsic absorption spectrum from the interpolation of the nearest two slope - removed template spectra .",
    "( 80mm,80mm)figure10a.ps ( 80mm,80mm)figure10b.ps    ( 80mm,80mm)figure11.ps      the first step in the calibration process is the relative throughput correction of fibers in which the averaged throughput of position @xmath24 and @xmath30 is used for the merged spectra in the cbs combine process . the next step is to remap the pixels with an increment of 5  / pixel ( 1.25  / pixel in the high - resolution mode ) based on the correlation between the observed wavelength and the pixels determined in the preparatory reduction process . in this remapping process , the observed wavelengths are multiplied by the count of each pixel in order to convert the value from photon count to @xmath34 .",
    "next , the converted count is divided by the atmospheric transmittance function of the airmass present during the observation , so as to roughly correct for the effects of atmospheric absorption . after this correction",
    ", the flux of the reference star is estimated from the converted count at around 1.31@xmath3 m , assuming that the total system efficiency under good seeing condition is 2.5% including losses at the entrance of the fibers .",
    "the slope of the spectrum is then measured with a fixed efficiency ratio between 1.21 and 1.55 @xmath3 m .",
    "( the value of this ratio will be confirmed in the check process , along with the total system efficiency of 2.5% . ) finally , the observed scientific spectra are divided by the reference spectrum and multiplied by the stellar spectra from the measured flux and slope . here",
    ", the type v and iii absorption templates are adopted as the reference spectra , respectively bluer than g5 and redder than k1 ( cf .",
    "figure [ fig : type_slope ] ) .",
    "as a consequence , two of the intrinsic absorption templates of fv , gv , k1iii , and k4iii ( in figure [ fig : irtflib ] ) are used to interpolate the absorption of the reference spectrum . if the stellar type of the reference star is known , the corresponding synthesized spectrum is used instead of this predicted spectrum .    a resulting wavelength- and flux - calibrated image",
    "is shown in figure [ fig : calib_image ] .",
    "the size of this image is 1800@xmath71800 pixels , the wavelength in @xmath3 m is @xmath39 , the @xmath25-th spectrum is located between @xmath40 and @xmath41 , and the count is in @xmath3jy .",
    "the square - noise frame is converted in a similar way except that all factors are multiplied twice .",
    "the 1d spectrum of each object is extracted from this image with a user - defined mask of 9 pixels , together with the square - noise frame .",
    "an example of the final 1d spectrum is shown in figure [ fig:1d_spectrum ] .",
    "( 80mm,80mm)figure12a.eps ( 80mm,80mm)figure12b.eps    ( 80mm,80mm)figure13.ps      the results are checked by comparing the resulting flux in the @xmath42 and @xmath43 bands with the photometric data in the catalog .",
    "if all the factors contributing to the system efficiency are normal , the flux should be consistent with the catalog value .",
    "the accuracy of the efficiency ratio between 1.21 and 1.55 @xmath3 m can also be confirmed by these diagrams for most cases .",
    "figure [ fig : mag_fnu ] shows an example of such a comparison .",
    "however , weather conditions , telescope and instrument focus , extended ( non - stellar ) morphology of targets , and position accuracy of the catalog may cause the lower observed flux of some targets than that expected from the catalog . under sufficiently good conditions",
    ", the observed flux should match the catalog magnitude as shown in the thick line in figure [ fig : mag_fnu ] with some downward scatter due to small allocation error of the fibers .",
    "also , if the estimated efficiency ratio between 1.21 and 1.55 is not correct , the points of @xmath42 and @xmath43 will have small offset in this figure .",
    "the reduction process for fmos images includes two special processing steps .",
    "one is the segmented processing of the spectra to handle a given part of the psf as a unit , while the other is the automatic modeling of the reference spectrum to calibrate the scientific targets .",
    "the segmented processing enable to keep the original 2-dimensional information which has a large effect on bad pixel filtering and detection of faint emission - lines .",
    "most of the processes are carried out automatically , but the object mask preparation and the reference star selection require user judgement .",
    "the fibre - pac is available from the fmos instrument page of the subaru web site , together with the sample dataset presented in this paper .",
    "the base reduction platform is iraf and the reduction scripts and sources are free and open , so that users can check what is happening in each step by sending the commands one at a time .",
    "this work was supported by a grant - in - aid for scientific research ( b ) of japan ( 22340044 ) and by a grant - in - aid for the global coe program `` the next generation of physics , spun from universality and emergence '' from the ministry of education , culture , sports , science , and technology ( mext ) of japan .",
    "iraf is distributed by the national optical astronomy observatories , which are operated by the association of universities for research in astronomy , inc .",
    ", under cooperative agreement with the national science foundation .",
    "fixsen , d.  j. , offenberg , j.  d. , hanisch , r.  j. , et al .",
    "2000 , , 112 , 1350 iwamuro , f. , motohara , k. , maihara , t. , hata , r. , & harashima , t.  2001 , , 53 , 355 kimura , m. , et al .",
    "2010 , , 62 , 1135 pence , w.  1999 , astronomical data analysis software and systems viii , 172 , 487 rayner , j.  t. , cushing , m.  c. , & vacca , w.  d.  2009 , , 185 , 289"
  ],
  "abstract_text": [
    "<S> the fibre - pac ( fmos image - based reduction package ) is an iraf - based reduction tool for the fiber multiple - object spectrograph ( fmos ) of the subaru telescope . to reduce fmos images , a number of special techniques are necessary because each image contains about 200 separate spectra with airglow emission lines variable in spatial and time domains , and with complicated throughput patterns for the airglow masks . in spite of these features , </S>",
    "<S> almost all of the reduction processes except for a few steps are carried out automatically by scripts in text format making it easy to check the commands step by step . </S>",
    "<S> wavelength- and flux - calibrated images together with their noise maps are obtained using this reduction package . </S>"
  ]
}