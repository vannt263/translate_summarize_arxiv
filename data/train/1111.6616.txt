{
  "article_text": [
    "constraint satisfaction problems are fundamental computational problems that arise in many areas of theoretical computer science . in recent years",
    ", a considerable amount of research has been concentrated on the classification of those constraint satisfaction problems that can be solved in polynomial time , and those that are computationally hard . in this paper",
    ", we contribute to this line of research and generalize an important tractability condition from finite domain constraint satisfaction to a broad class of infinite domain constraint satisfaction problems .",
    "we work with the following definition of constraint satisfaction problems ( csps ) , which is well - adapted to treat csps over infinite as well as finite domains .",
    "the definition is based on the concept of a _ homomorphism _ between relational structures , and equivalent to the standard definition for finite domain csps .",
    "a _ ( relational ) structure _ @xmath1 consists of a ( not necessarily finite ) _ domain _ @xmath2 ( or simply @xmath1 when no confusion can arise ) , and a set of relations on @xmath2 , each of a finite positive arity .",
    "each relation is named by a _ relation symbol _ @xmath3 ; the corresponding relation in @xmath1 is denoted by @xmath4 .",
    "the set of all relation symbols is called the _ signature _ of the structure .",
    "a _ homomorphism _ from a relational structure @xmath1 to a relational structure @xmath5 over the same signature is a mapping @xmath6 such that for each relation symbol @xmath3 , and tuple @xmath7 , it holds that @xmath8 , where @xmath9 is applied component - wise to @xmath10 .",
    "the existence of a homomorphism from @xmath1 to @xmath5 is denoted by @xmath11 . for a fixed structure , traditionally denoted by @xmath12 , with finite relational signature @xmath13 the _ constraint satisfaction problem for @xmath12 _ ( denoted by @xmath14 )",
    "is the following problem .",
    "* csp(@xmath12 ) * + instance : a finite structure @xmath1 over the signature @xmath13 .",
    "+ question : is there a homomorphism from @xmath1 to @xmath12 ?",
    "+    to give an example , the three - colorability problem can be formulated as @xmath15 , where @xmath16 is the complete graph with three elements .",
    "a basic example of an infinite - domain csp is @xmath17 , where @xmath18 is the strict linear ordering of the rationals .",
    "jeavons and co - authors  @xcite made the ground - breaking observation that for finite structures @xmath12 , the complexity of @xmath14 is captured by the _",
    "polymorphisms _ of @xmath12 , defined as follows . when @xmath19 is a @xmath20-ary function , and @xmath3 is an an @xmath0-ary relation over @xmath21 , then we say that _ @xmath9 preserves @xmath3 _ if for all @xmath0-tuples @xmath22 , we have @xmath23,\\dots , t_k[1 ] ) , \\dots , f(t_1[n],\\dots , t_k[n ] ) ) \\in r.\\ ] ] a _ polymorphism _ of a relational structure @xmath12 with domain @xmath24 is a function from @xmath25 to @xmath21 that preserves all relations of @xmath12 . in other words ,",
    "a polymorphism is a homomorphism from @xmath26 to @xmath12 , for some @xmath20 .",
    "the exploitation of polymorphisms for classifying the complexity of csps is sometimes referred to as the _ universal - algebraic approach_. indeed , very often tractability of @xmath14 is linked to polymorphisms of @xmath12 with certain ` good properties ' . for a finite domain @xmath27 , it is known that @xmath14 is np - hard unless @xmath12 has a polymorphism @xmath19 satisfying @xmath28 for all @xmath29 , and it is conjectured that @xmath14 can be solved in polynomial - time whenever @xmath12 has such a polymorphism  @xcite a _ cyclic term _ when it satisfies the additional requirement of being idempotent ; @xmath30 for all @xmath31 .",
    "they state the conditions for np - hardness and the conjecture for polynomial - time tractability in terms of the absence or presence of such cyclic terms among the polymorphisms of the _ core of @xmath12 _ , cf .  section  [ sect : mc - cores ] .",
    "it is not hard to verify that their condition is equivalent to the one given here . ] .",
    "this conjecture is known to hold in several special cases when @xmath9 satisfies stronger identities .",
    "we will now look at one such case .",
    "an operation @xmath32 is called    * _ idempotent _ if @xmath33 ; * _ commutative _ if @xmath34 for all @xmath35 ; * _ associative _ if @xmath36 for all @xmath37 ; * a _ semi - lattice operation _ if it is commutative , associative , and idempotent .    jeavons , cohen , and gyssens  @xcite proved that for every finite structure @xmath12 with a polymorphism that is a semi - lattice operation , the problem @xmath14 can be solved in polynomial time . in this paper , we present a generalization of this result to a large class of infinite - domain csps .",
    "all infinite structures considered are assumed to be countably infinite . to state the result",
    ", we need the following definitions .    a bijective homomorphism with an inverse that is also a homomorphism is called an _ isomorphism_. an _ automorphism _ of a relational structure @xmath12 is an isomorphism between @xmath12 and itself , and the set of all automorphisms of @xmath12 is denoted by @xmath38 . for a subset @xmath39 of the domain of @xmath12 , the _ orbit of @xmath39 _ in @xmath12 is the set @xmath40 .",
    "when @xmath39 is of cardinality @xmath0 , then we call the orbit of @xmath39 in @xmath12 an _ orbit of @xmath0-subsets_. if the number of orbits of @xmath0-subsets of @xmath12 is at least @xmath41 for some @xmath42 and all sufficiently large @xmath0 , then we say that @xmath12 has _ exponential growth_. otherwise , we say that @xmath12 has sub - exponential growth , or that @xmath12 is a _ sub - exponential structure_. note that every finite structure is a sub - exponential structure since for @xmath0 greater than the domain size , there are no @xmath0-subsets at all , hence zero orbits .",
    "but also the structure @xmath18 ( and all structures with domain @xmath43 whose relations are first - order definable in @xmath18 ) is sub - exponential : it has only one orbit of @xmath0-subsets , for all @xmath0 ( see e.g.  @xcite ) .",
    "our main result is the following .",
    "[ thm : main ] let @xmath12 be a sub - exponential structure with finite relational signature . if @xmath12 has a semi - lattice polymorphism , then @xmath14 can be be solved in polynomial time .",
    "finite domain structures with a semi - lattice polymorphism can be solved by a standard technique , known as _ establishing arc - consistency _",
    "the situation is different for sub - exponential structures with a semi - lattice polymorphism .",
    "consider for instance the structure @xmath44 .",
    "it has the same automorphism group as @xmath18 and hence is sub - exponential as well .",
    "this structure has the function @xmath45 on @xmath43 as a polymorphism , but it has been shown that there is no @xmath20 such that this problem can be solved by establishing @xmath20-consistency  @xcite .",
    "tractability of @xmath46 instead follows from the following more general result of  @xcite : every structure @xmath12 with domain @xmath47 that has the same automorphism group as @xmath18 and that is preserved by the minimum function ( or the maximum function ) has a polynomial - time tractable csp .",
    "our result will be a proper generalization of this result and of the mentioned result of jeavons , cohen , and gyssens .",
    "let us remark that for a general infinite structure , a semi - lattice polymorphism does not suffice to ensure tractability . for an arbitrary subset @xmath48 of @xmath49 , let @xmath50 be the structure @xmath51 .",
    "every such structure has min ( and max ) as a semi - lattice polymorphism .",
    "we claim that csp(@xmath50 ) and csp(@xmath52 ) are different problems for distinct subsets @xmath48 and @xmath53 of @xmath49 .",
    "let @xmath54 be any element in @xmath55 , where @xmath56 denotes the symmetric difference of the sets , and let @xmath57 be the instance on variables @xmath58 containing the constraints @xmath59 , @xmath60 for @xmath61 , and @xmath62 .",
    "then @xmath57 is a satisfiable instance for precisely one of the problems csp(@xmath50 ) and csp(@xmath52 ) .",
    "it follows that there are as many pairwise distinct csps of this type as there are subsets of @xmath49 , i.e. , uncountably many .",
    "however , there are no more than countably many algorithms , hence csp@xmath63 is undecidable for some @xmath48 .",
    "the example of the previous paragraph relies on the fact that for all structures @xmath50 , there is an _",
    "infinite _ number of orbits of @xmath64-subsets .",
    "when the number of orbits of @xmath0-subsets of @xmath12 is finite for all @xmath0 , then the structure is called _",
    "@xmath65-categorical _ in model theory  @xcite . for @xmath65-categorical structures ,",
    "polymorphisms still capture the computational complexity of @xmath14  @xcite .",
    "our main result can thus be seen as a contribution to the further extension of the universal - algebraic approach from finite to @xmath65-categorical structures .",
    "our paper is structured as follows . in section  [",
    "sect : alg ] we introduce a new algorithmic technique to solve infinite - domain constraint satisfaction problems , and present a reduction of @xmath14 for structures @xmath12 with a semi - lattice polymorphism to an _ efficient sampling algorithm _ for @xmath12 .",
    "the basic idea is that when there is such an efficient sampling algorithm for @xmath12 , then we can use the arc - consistency procedure for finite domain csps to solve @xmath14 ( we actually use the _ uniform _ version of the arc - consistency procedure where both @xmath1 and a finite template @xmath5 are part of the input ) .",
    "in fact , this technique works under a slightly more general assumption on @xmath12 : instead of requiring the existence of a semi - lattice polymorphism , we only require that @xmath12 has _ totally symmetric _",
    "polymorphisms of all arities .",
    "the next part of our paper , section  [ sect : classification ] , is devoted to the proof that all sub - exponential structures @xmath12 with totally symmetric polymorphisms of all arities admit such an efficient sampling algorithm . here , our proof is based on a _ classification _ of those structures @xmath12 .",
    "we would like to remark that the general algorithmic technique is applicable also for many structures with totally symmetric polymorphisms of all arities that are _ not _ sub - exponential , and this will be illustrated by some examples in section  [ sect : beyond ] .",
    "in fact , we make the conjecture that when @xmath12 is an @xmath65-categorical structure with a semi - lattice polymorphism , then @xmath14 is in p. however , unlike the case of sub - exponential structures , we can not provide a classification result like the one in section  [ sect : classification ] for this more general case , and so this remains an interesting open question .",
    "one of the basic building blocks of our algorithm will be the arc - consistency procedure .",
    "we start this section by recalling , in the case of finite relational structures , the connection between the applicability of this procedure , homomorphisms from the _ set structure _ , and the existence of _ totally symmetric polymorphisms_.    let @xmath5 be a finite structure with a finite relational signature , and let @xmath1 be an instance of @xmath66 . the _ arc - consistency procedure _ ( ac ) applied to the problem @xmath67 works by reducing a set of possible images for each variable in @xmath1 .",
    "if such a set becomes empty during the procedure , it follows that there can be no homomorphism , so ac rejects .",
    "otherwise , ac accepts .",
    "an algorithm for ac is shown in figure  [ fig : alg - ac ] .",
    "we say that arc - consistency _ solves _ the problem @xmath66 if , for every instance @xmath1 , the procedure accepts _ if and only if _ @xmath11 .",
    "arc - consistency is sometimes called _ hyperarc - consistency _ when applied to structures with relations of arity greater than two .",
    "it can be implemented to run in time that is polynomial in @xmath68 , take e.g.  ac-3  @xcite .",
    "the _ set structure _ of @xmath5 , denoted by @xmath69 , has as vertices all non - empty subsets of the domain of @xmath5 .",
    "for every @xmath20-ary relation @xmath70 , we have @xmath71 iff for every @xmath72 and @xmath73 , there exists @xmath74 such that @xmath75 .",
    "a @xmath20-ary function @xmath76 is called _ totally symmetric _",
    "if for all @xmath77 we have @xmath78 we say that a structure @xmath5 has _ totally symmetric polymorphisms of all arities _ if , for each @xmath79 , there is a @xmath20-ary polymorphism of @xmath12 that is totally symmetric .",
    "the following is well - known , cf .",
    "@xcite .",
    "[ thm : equiv ] let @xmath5 be a finite structure with a finite relational signature .",
    "the following are equivalent .    1 .",
    "the arc - consistency procedure solves @xmath66 .",
    "2 .   there is a homomorphism @xmath80 .",
    "the structure @xmath5 has totally symmetric polymorphisms of all arities .",
    "it is clear that when @xmath12 has a semi - lattice operation @xmath9 , then it also has a totally symmetric polymorphism @xmath81 of arity @xmath0 , for each @xmath82 : @xmath83 from theorem  [ thm : equiv ] , it thus follows that arc - consistency solves @xmath66 whenever @xmath5 is a finite relational structure with a semi - lattice polymorphism . in our arguments",
    ", we only need the weaker condition on totally symmetric polymorphisms of all arities ; this gives us a stronger result .",
    "the other component of our algorithm will be a procedure to efficiently `` sample '' appropriate finite substructures of an infinite structure @xmath12 .",
    "formally , we make the following definition .",
    "let @xmath12 be a structure over a finite relational signature .",
    "we say that an algorithm is a _ sampling algorithm for @xmath12 _ if , given a positive integer @xmath0 , it computes a finite structure @xmath5 that is isomorphic to a substructure of @xmath12 such that @xmath11 if and only if @xmath84 , for every instance @xmath1 with @xmath85",
    ". a sampling algorithm is called _ efficient _ if its running time is bounded by a polynomial in @xmath0 .",
    "we are now ready to give an outline of our algorithm .",
    "let @xmath12 be a sub - exponential structure over a finite relational signature , and assume that @xmath12 has totally symmetric polymorphisms of all arities .",
    "the main idea of our algorithm is to reduce @xmath14 to an appropriate _ uniform _ finite domain csp .",
    "that is , when given an instance @xmath1 of @xmath14 , we reduce to the following problem : decide whether @xmath1 maps homomorphically to @xmath5 , where @xmath5 is a finite substructure of @xmath12 returned by a sampling algorithm for @xmath12 on input @xmath86 , and @xmath5 is considered as part of the input .",
    "the algorithm is given in figure  [ fig : alg - csp ] .",
    "note that we rely on arc - consistency for deciding whether @xmath1 maps homomorphically to @xmath5 .",
    "hence , for this approach to work , we need to establish the following .    1",
    ".   there should be an efficient sampling algorithm which samples some @xmath5 from @xmath12 .",
    "2 .   the arc - consistency procedure applied to @xmath87 should accept if and only if @xmath11 .",
    "the first condition implies that the size of @xmath5 is polynomial in the size of @xmath1 , and since ac can be implemented to run in time that is polynomial in @xmath68 , it follows that our algorithm will be polynomial in @xmath86 .",
    "the second condition ensures that the algorithm gives the correct answer for every instance @xmath1 of @xmath14",
    ".    it will be the purpose of section  [ sect : classification ] to prove that an efficient sampling algorithm for @xmath12 exists .",
    "we state this result as follows .",
    "[ thm : alg - cond ] let @xmath12 be a sub - exponential structure with a finite relational signature and totally symmetric polymorphisms of all arities . then there is an efficient sampling algorithm for @xmath12 .",
    "we next prove one part of a generalization of the equivalence between the second and third item of theorem  [ thm : equiv ] to infinite domains .",
    "this result has a converse for all @xmath65-categorical structures , cf .",
    "section  [ sect : disc ] .",
    "[ lem : totsymtohomo ] let @xmath12 be a structure over a finite relational signature .",
    "if @xmath12 has totally symmetric polymorphisms of all arities , then @xmath88 for all finite substructures @xmath89 .",
    "let @xmath39 be a finite substructure of @xmath12 , and let @xmath9 be an @xmath54-ary totally symmetric polymorphism of @xmath12 , where @xmath90 and @xmath20 is the maximum arity of any relation in @xmath12 .",
    "let @xmath91 be the function defined on a non - empty set @xmath92 by @xmath93 , where the list of arguments of @xmath9 is padded to length @xmath54 by elements already occurring in @xmath94 .",
    "we claim that @xmath95 is a homomorphism @xmath88 .",
    "we must show that @xmath96 for an arbitrary relation @xmath3 , and tuples @xmath97 . for each @xmath98 ,",
    "let @xmath99 be a set of @xmath20-tuples such that @xmath100 \\mid t \\in t_i \\",
    "} = u_i$ ] .",
    "note that @xmath100 \\mid t \\in t_j , 1 \\leq j \\leq k \\ } = u_i$ ] , and that we can choose @xmath101 to have size @xmath102 , for each @xmath72 .",
    "let @xmath103 be an enumeration of @xmath104 and @xmath105 be an enumeration of @xmath101 .",
    "we then have @xmath106,\\dots , t^{1}_{l(1)}[i],\\dots , t^{k}_1[i],\\dots , t^{k}_{l(k)}[i],t^{k}_{l(k)}[i ] , \\dots , t^{k}_{l(k)}[i]),\\ ] ] for all @xmath98 .",
    "since @xmath9 is a polymorphism of @xmath12 , and @xmath107 for all @xmath72 and @xmath108 , it follows that @xmath96 .",
    "the correctness and efficiency of our algorithm now follows from the previous lemma in conjunction with the existence of an efficient sampling algorithm for @xmath12 .",
    "[ thm : correctness ] let @xmath12 be a structure over a finite relational signature with totally symmetric polymorphisms of all arities .",
    "if there exists an efficient sampling algorithm for @xmath12 , then the algorithm in figure  [ fig : alg - csp ] correctly solves @xmath14 in polynomial time .",
    "let @xmath1 be the input structure and let @xmath5 be the structure returned by the sampling algorithm for @xmath12 on input @xmath86 .",
    "the sampling algorithm runs in polynomial time in @xmath86 , so the size of @xmath5 will be polynomial in @xmath86 . since ac(@xmath109 ) can be implemented to run in time polynomial in @xmath68 , it follows that the entire algorithm runs in polynomial time .    to show correctness ,",
    "note that if ac(@xmath109 ) rejects , then @xmath110 which is equivalent to @xmath111 since @xmath5 was produced by the sampling algorithm for @xmath12 on input @xmath86 .",
    "we may therefore safely reject .",
    "otherwise , ac@xmath87 terminates with a non - empty list @xmath112 for each @xmath113 .",
    "furthermore , for each @xmath20-ary relation @xmath4 , tuple @xmath114 , index @xmath72 , and element @xmath115 , we know that @xmath116 contains a tuple @xmath117 with @xmath118 . in other words",
    "@xmath119 , so the function @xmath120 is a homomorphism . by assumption , @xmath12 has totally symmetric polymorphisms of all arities , so lemma  [ lem : totsymtohomo ] implies the existence of a homomorphism @xmath121 . in conclusion",
    ", we have a homomorphism @xmath122 .    as a direct corollary of theorem  [ thm : alg - cond ] and theorem  [ thm : correctness ]",
    ", we get the following result , which also implies our main result , theorem  [ thm : main ] .",
    "[ thm : yyy ] let @xmath12 be a sub - exponential structure with a finite relational signature . if @xmath12 has totally symmetric polymorphisms of all arities , then @xmath14 is solvable in polynomial time .",
    "the purpose of this section is to prove theorem  [ thm : alg - cond ] , showing that every sub - exponential structure has an efficient sampling algorithm .",
    "our approach is based on a _ classification _ of sub - exponential structures with totally symmetric polymorphisms of all arities .",
    "the general outline of this classification is as follows .",
    "we first present an argument that reduces the classification task to those sub - exponential structures @xmath12 that are _ model - complete cores _ and have totally symmetric polymorphisms of all arities ( section  [ sect : mc - cores ] ) .",
    "from there on , the classification follows a decomposition of the automorphism group of @xmath12 .",
    "the next step is the reduction to those structures @xmath12 having a _ transitive _ automorphism group ( section  [ ssect : general ] ) .",
    "we then use the fact that the automorphism group of @xmath12 has only finitely many congruence relations to further reduce the classification task to the case that the automorphism group of @xmath12 is _ primitive _ ( section  [ ssect : finest ] ) . combining the central theorem from  @xcite on primitive permutation groups with a sub - exponential number of orbits of @xmath0-subsets with cameron s theorem on highly set - transitive permutation groups",
    "@xcite we finish the classification in section  [ ssect : primitive ] .",
    "we find it instructive to give a ` top - down ' presentation of the classification proof , rather than starting from special cases , and to assemble more general sub - exponential structures from specific ones .",
    "we thus take a decomposition approach , and show first how to describe the most general case in terms of its components .",
    "this sometimes leads to forward - references of results , but we believe that the reader will be compensated by a more accessible presentation .      before we start , we recall a basic fact which will frequently be used in the following arguments , and which explains the interaction between permutation group theory and logic for @xmath65-categorical structures .",
    "let @xmath12 be a relational structure . in this paper",
    ", we say that a relation @xmath3 over the domain of @xmath12 is _ first - order definable _ in @xmath12 if there is a first - order formula @xmath123 such that @xmath124 is true in @xmath125 if and only if @xmath126 .",
    "we say that a relational structure @xmath127 is first - order definable in @xmath12 if @xmath127 and @xmath12 have the same domain and every relation @xmath3 in @xmath127 is first - order definable in @xmath12 .",
    "we say that two relational structures are _ first - order interdefinable _ if one of them is first - order definable in the other , and vice versa .",
    "[ thm : ryll ] let @xmath12 be @xmath65-categorical .",
    "then a relation @xmath3 is preserved by all automorphisms of @xmath12 if and only if @xmath3 has a first - order definition in @xmath12 .",
    "in particular , two structures are first - order interdefinable if and only if they have the same automorphism group .",
    "this theorem makes possible a translation of terminology between logic and permutation groups .",
    "we illustrate its use with the following , which will be needed later on .",
    "congruence _ of a permutation group is an equivalence relation that is preserved by all permutations in the group .",
    "a permutation group is called _ primitive _ if the only congruences are the equivalence relation with just one equivalence class , and the equivalence relation where all equivalence classes are of size one ; it is called _ imprimitive _ otherwise . by theorem  [ thm : ryll ] , the congruences of the automorphism group of an @xmath65-categorical structure @xmath12 are precisely the first - order definable equivalence relations of @xmath12 .",
    "we will say that @xmath12 is _ primitive _ if its automorphism group is primitive .",
    "a permutation group @xmath128 on a countable set @xmath94 is called _ closed _ if and only if it is the automorphism group of a relational structure with domain @xmath94 .",
    "the topological explanations for this terminology can be found in  @xcite , theorem 2.4.4 .",
    "the corresponding topology is called the _ topology of pointwise convergence _ on @xmath129 , where @xmath129 denotes the set of all permutations of @xmath94 . in this topology ,",
    "the open sets are unions of sets of the form @xmath130 , for @xmath0-tuples @xmath131 , @xmath132 of elements of @xmath94 .",
    "a subset @xmath133 of @xmath134 is _ dense ( in @xmath128 ) _ if the closure of @xmath133 with respect to this topology equals @xmath128 .",
    "an endomorphism of a relational structure @xmath12 is a homomorphism from @xmath12 to @xmath12 ; we denote the set of all endomorphisms of @xmath12 by @xmath135 .",
    "a relational structure is called a _ core _ if every endomorphism of @xmath12 is an embedding into a relational structure @xmath56 is an isomorphism between @xmath12 and an induced substructure of @xmath56 . ] . for a relational structure @xmath56 , a _ core of @xmath56 _ is a core structure @xmath12 that is homomorphically equivalent to @xmath56 , that is , there is a homomorphism from @xmath12 to @xmath56 and vice versa .",
    "a first - order formula is called _ primitive positive _ if it is of the form @xmath136 where @xmath137 are atomic formulas .",
    "the importance of primitive positive definitions in this paper comes from the fact that relations with a primitive positive definition in a relational structure @xmath12 are preserved by the polymorphisms of @xmath12 .",
    "the motivation of these definitions for constraint satisfaction with finite templates @xmath56 comes from the following facts .    *",
    "every finite relational structure @xmath56 has a core @xmath12 , and @xmath12 is unique up to isomorphism .",
    "* when @xmath12 is a core of @xmath56 , then @xmath12 and @xmath56 have the same csp . * in a finite core structure @xmath12 , every orbit of @xmath0-tuples is an @xmath0-tuple of elements of @xmath12 , then the _ orbit of @xmath10 ( in @xmath12 ) _ is the set @xmath138 . ]",
    "is primitive positive definable .",
    "these properties have been generalized to @xmath65-categorical structures .",
    "to precisely state the result , we need the following concepts .",
    "a structure @xmath12 is _ model - complete _ if every embedding of @xmath12 into itself preserves all first - order formulas .",
    "we later need the following .",
    "[ lem : mc - cores ] an @xmath65-categorical relational structure @xmath56 is a model - complete core if and only if the group of automorphisms of @xmath56 is dense in the endomorphism monoid of @xmath56 , that is , for every endomorphism @xmath9 and finite subset @xmath48 of @xmath139 , there is an automorphism @xmath140 of @xmath56 agreeing with @xmath9 on @xmath48 .",
    "[ thm : mc - cores ] let @xmath56 be an @xmath65-categorical relational structure",
    ". then    1 .",
    "[ enum : hascore ] @xmath56 is homomorphically equivalent to a model - complete core @xmath12 ; 2 .",
    "[ enum : unique ] the structure @xmath12 is unique up to isomorphism , and @xmath65-categorical or finite ; 3 .",
    "[ enum : ppdef ] in @xmath12 , every orbit of @xmath0-tuples is primitive positive definable .    for our classification project ( and our algorithmic result )",
    ", it therefore suffices to study the csps for model - complete cores of sub - exponential structures .",
    "let us first show that the model - complete core of a sub - exponential structure is again sub - exponential .",
    "this follows from the following more general result .",
    "[ prop : orbit - non - growth ] let @xmath56 be an @xmath65-categorical relational structure , and let @xmath12 be its model - complete core .",
    "then for every @xmath0 , the number of orbits of @xmath0-subsets in @xmath12 is at most the number of orbits of @xmath0-subsets in @xmath56 .",
    "let @xmath9 be a homomorphism from @xmath56 to @xmath12 , and @xmath140 be a homomorphism from @xmath12 to @xmath56 .",
    "since @xmath12 is a core , it follows that @xmath141 is an embedding , so @xmath140 is injective .",
    "it now suffices to show that when two @xmath0-subsets @xmath142 of @xmath12 are mapped by @xmath140 to two @xmath0-subsets @xmath143 in the same orbit of @xmath0-subsets in @xmath56 , then @xmath144 and @xmath145 lie in the same orbit of @xmath0-subsets in @xmath12 .",
    "let @xmath146 be an @xmath0-tuple listing all the elements in @xmath144 , let @xmath147 be an automorphism of @xmath56 that maps @xmath148 to @xmath149 , and let @xmath150 .",
    "since @xmath151 lists all the elements of @xmath149 , we can arrange the elements of @xmath145 into an @xmath0-tuple @xmath152 such that @xmath153 . by theorem  [ thm : mc - cores]([enum : ppdef ] ) , there are primitive positive definitions @xmath154 and @xmath155 of the orbits of @xmath146 and @xmath152",
    ". since @xmath140 , @xmath147 , and @xmath9 preserve primitive positive formulas , the tuple @xmath156 satisfies @xmath154 .",
    "but @xmath157 , and hence @xmath158 also satisfies @xmath155 .",
    "therefore , @xmath154 and @xmath155 define the same orbit of @xmath0-tuples , and so @xmath146 and @xmath152 are in the same orbit .",
    "this implies that @xmath144 and @xmath145 are in the same orbit of @xmath0-subsets .",
    "in general it might not be true that the model - complete core of a sub - exponential structure with a semi - lattice polymorphism has again a semi - lattice polymorphism .",
    "a finite example of this situation can be derived from proposition  5.2 in  @xcite .",
    "this example shows a finite poset with a semi - lattice polymorphism which retracts to a poset without a semi - lattice polymorphism . by introducing constants ,",
    "the latter structure can be turned into a core of the former .",
    "however , we always have the following .",
    "let @xmath56 be an @xmath65-categorical relational structure with an @xmath0-ary totally symmetric polymorphism .",
    "then the model - complete core of @xmath56 also has an @xmath0-ary totally symmetric polymorphism .",
    "let @xmath12 be the model - complete core of @xmath56 , and let @xmath159 and @xmath160 be homomorphisms .",
    "when @xmath9 is an @xmath0-ary totally symmetric polymorphism of @xmath56 , then @xmath161 defined by @xmath162 is totally symmetric , and a polymorphism of @xmath12 .",
    "once we have a sampling algorithm for the core @xmath12 of a structure @xmath56 , we obtain a sampling algorithm for @xmath56 as follows .",
    "let @xmath160 be a homomorphism and let @xmath163 be a sample returned by the sampling algorithm for @xmath12 on input @xmath0 .",
    "we then let the sample @xmath5 of @xmath56 be the substructure induced by the image of @xmath163 under @xmath164 . for any structure @xmath1 of size @xmath0",
    "it follows that @xmath165 implies @xmath84 which implies @xmath166 , so @xmath5 is indeed a sample of @xmath56 .",
    "the structure @xmath5 can be computed in polynomial time in the size of @xmath163 which in turn is polynomial in @xmath0 , so @xmath5 can be computed in polynomial time in @xmath0 .",
    "we conclude that it suffices to show theorem  [ thm : alg - cond ] for the special case of sub - exponential structures that are model - complete cores and have totally symmetric polymorphisms of all arities .",
    "let @xmath12 be a sub - exponential model - complete core .",
    "since @xmath12 is sub - exponential , it has in particular a finite number of orbits of 1-subsets , called _ orbits _ for short .",
    "a structure is called _ transitive _ if it has only one orbit .",
    "[ prop : trans - mc - cores ] let @xmath12 be an @xmath65-categorical model - complete core , and let @xmath127 be the expansion of @xmath12 by all primitive positive definable relations .",
    "let @xmath48 be an orbit of @xmath12 , and @xmath167 be the restriction of @xmath127 to @xmath48 .",
    "then @xmath167 is a transitive model - complete core .",
    "first observe that every automorphism @xmath147 of @xmath12 is also an automorphism of @xmath127 and preserves @xmath48 , and hence @xmath168 is an endomorphism of @xmath167 . since the same also applies to the inverse of @xmath147 , we have that also @xmath168 has an inverse in @xmath169 , and therefore is an automorphism of @xmath167 .",
    "so , the restriction of an automorphism of @xmath12 to @xmath48 is an automorphism of @xmath167 , and therefore @xmath167 is transitive .    to show that @xmath167 is a model - complete core , let @xmath170 be an endomorphism of @xmath167 , and let @xmath10 be a @xmath20-tuple of elements from @xmath48 .",
    "then any primitive positive formula that holds on @xmath10 in @xmath12 also holds on @xmath171 , since @xmath167 is the restriction of an expansion of @xmath12 by all primitive positive definable relations .",
    "since @xmath12 is a model - complete core , the orbits of @xmath20-tuples are primitive positive definable in @xmath12 by theorem  [ thm : mc - cores](3 ) , and hence there is an automorphism @xmath147 of @xmath12 that maps @xmath170 to @xmath171 .",
    "then @xmath168 is an automorphism of @xmath167 .",
    "this shows that @xmath172 is dense in @xmath169 , and the statement follows from lemma  [ lem : mc - cores ] .",
    "the following result is proved in section  [ ssect : finest ] and section  [ ssect : primitive ] .",
    "[ thm : transitive ] let @xmath56 be a transitive sub - exponential model - complete core with totally symmetric polymorphisms of all arities . then @xmath56 is either a structure of size 1 , or it is isomorphic to a structure which is first - order interdefinable with @xmath18 .",
    "any such structure with a finite relational signature has an efficient sampling procedure .",
    "so we are left with the task to design an efficient sampling algorithm for @xmath12 using the efficient sampling algorithms for each substructure of @xmath12 induced by an orbit of @xmath12 . for this , we need to analyze how the automorphism group @xmath128 of @xmath12 is built from its _ transitive constituents _ , that is , from the permutation groups of the form @xmath173 on @xmath48 where @xmath48 is an orbit of @xmath12 . in general , we only know that @xmath128 is a subdirect product of its transitive constituents ( see , e.g. ,  @xcite ) . in our case , we can make this decomposition more precise , since we have a good knowledge of the group @xmath174 .",
    "[ lem : convex ] [ lem : convexorbits ] let @xmath12 be a sub - exponential structure with an @xmath175-invariant linear order @xmath176 defined on the union of two orbits @xmath48 and @xmath53",
    ". then @xmath48 and @xmath53 are convex with respect to @xmath176 .",
    "assume to the contrary that there are elements @xmath177 , @xmath178 such that @xmath179 .",
    "since @xmath180 and @xmath181 lie in the same orbit , there is an automorphism @xmath147 of @xmath12 such that @xmath182 .",
    "let @xmath183 for @xmath184 , and let @xmath185 for @xmath186 .",
    "since @xmath147 preserves the order @xmath176 , we have @xmath187 , and @xmath188 . by repeated application of @xmath147",
    ", we obtain @xmath189 for all @xmath184 , and finally @xmath190 .",
    "hence , we can encode sequences @xmath191 in subsets @xmath89 of size @xmath54 by letting @xmath192 iff @xmath193 and @xmath194 iff @xmath195 .",
    "different sequences of length @xmath54 then correspond to different orbits of @xmath54-subsets in @xmath12 .",
    "this contradicts the assumption that @xmath12 is sub - exponential .",
    "we now describe the automorphism groups of sub - exponential structures where the transitive constituents @xmath196 for all orbits @xmath197 of @xmath128 are isomorphic to @xmath174 : the following theorem shows that in this case @xmath128 is precisely what cameron  @xcite calls the _ intransitive action _ of the direct product @xmath198 on @xmath199 .",
    "we will say that a permutation group @xmath134 is _ transitive on a subset @xmath200 _ if for all @xmath201 , there exists a permutation @xmath202 such that @xmath203 .",
    "otherwise , we say that @xmath128 is _ intransitive on @xmath204_.    [ thm : no - interaction ] let @xmath12 be a sub - exponential structure with automorphism group @xmath128 and orbits @xmath205 , and for @xmath206 let @xmath207 be the transitive constituent of @xmath128 on @xmath104 .",
    "assume that @xmath207 is isomorphic to @xmath174 for all @xmath98 .",
    "then , @xmath208 is an automorphism of @xmath12 if and only if @xmath209 for each @xmath98 .",
    "since @xmath207 is isomorphic to @xmath174 for each @xmath72 , there is by theorem  [ thm : ryll ] a first - order definable dense linear order @xmath210 on each orbit @xmath104 .",
    "we will use @xmath176 to collectively denote these orders , and rely on the context to determine which orbit it applies to .",
    "the result is trivial for @xmath211 , so assume that @xmath212 .",
    "let @xmath213 be the intransitive action of @xmath214 on @xmath199 .",
    "it suffices to show that @xmath128 is dense in @xmath213 ; since @xmath128 is closed , they must then be equal .",
    "assume for the sake of contradiction that @xmath128 is not dense in @xmath213 .",
    "then , there are finite sequences @xmath215 and @xmath216 in @xmath12 , and an automorphism @xmath217 such that @xmath218 , but @xmath219 for all @xmath220",
    ". furthermore we can choose @xmath215 and @xmath216 so that @xmath221 for some @xmath222 . by applying @xmath223 to @xmath224 and @xmath147",
    ", we may then assume that @xmath225 and @xmath226 . by a _",
    "@xmath227-interval _ , we will mean an inclusion - maximal convex subset of @xmath228 , for some @xmath72 , where convexity is evaluated with respect to @xmath104 .",
    "now @xmath229 lies in some @xmath227-interval @xmath230 , and since @xmath231 , we have @xmath232 as well . by assumption",
    "we have @xmath233 for all @xmath234 , so @xmath235 is intransitive on @xmath230 . on the other hand ,",
    "if we let @xmath236 , where @xmath48 is the orbit of @xmath12 containing @xmath230 , then @xmath237 is clearly transitive on each @xmath238-interval contained in @xmath48 : each @xmath238-interval contained in @xmath48 is an orbit , and its corresponding transitive constituent of @xmath237 is isomorphic to @xmath239 . in particular , @xmath240 is transitive on @xmath230 .",
    "it therefore follows that we can find a subsequence @xmath241 of @xmath227 containing @xmath238 , and an element @xmath242 such that @xmath243 is transitive on @xmath230 but @xmath244 is not .    by lemma  [ lem : convexorbits ]",
    ", we have that every orbit of @xmath245 contained in @xmath230 is convex .",
    "since @xmath244 is intransitive on @xmath230 , it follows that there is an initial segment @xmath246 definable in @xmath245 .",
    "let @xmath247 , @xmath248 , and pick an automorphism @xmath249 such that @xmath203 .",
    "now @xmath250 and @xmath251 is definable in @xmath252 .",
    "let @xmath253 and for @xmath254 , let @xmath255 . by repeating this procedure , we get an increasing sequence of sets @xmath256 which are all definable in @xmath257 , where @xmath258 . for @xmath254 ,",
    "pick @xmath259 , so that each of the elements @xmath260 lies in a different orbit of @xmath257 .",
    "we now encode a set @xmath261 as the subset @xmath262 of @xmath12 consisting of the elements in @xmath241 , @xmath263 , and @xmath264 .",
    "let @xmath265 be another set with encoding @xmath266 , and let @xmath202 be an automorphism such that @xmath267 .",
    "then @xmath147 has to fix @xmath241 and @xmath263 , i.e. , @xmath147 must be an automorphism of @xmath257 .",
    "therefore @xmath147 can not map @xmath260 to @xmath268 for @xmath269 , so @xmath39 must be equal to @xmath270 .",
    "the set @xmath262 has size at most @xmath271 , and since we can fix the size of @xmath241 , we conclude that the number of distinct orbits of @xmath54-subsets of @xmath12 is at least @xmath272 .",
    "this contradicts the sub - exponentiality of @xmath12 , so @xmath128 must be dense in @xmath213 , and the result follows .",
    "together with the remarks of section  [ sect : mc - cores ] , the following implies theorem  [ thm : alg - cond ] .    every sub - exponential model - complete core @xmath12 with totally symmetric polymorphisms of all arities and a finite relational signature @xmath13 has an efficient sampling algorithm .    for a given @xmath0",
    ", we have to compute a @xmath13-structure @xmath5 in polynomial time in @xmath0 such that for all structures @xmath1 of size @xmath0 we have @xmath84 if and only if @xmath11 .",
    "let @xmath197 be the orbits of @xmath12 .",
    "let @xmath127 be the expansion of @xmath12 by all primitive positive definable relations , and let @xmath273 be the structures induced in @xmath127 by the orbits @xmath197 of @xmath12 . by proposition  [ prop : trans - mc - cores ] , @xmath274 is a transitive model - complete core , for all @xmath275",
    ". since @xmath274 also has totally symmetric polymorphisms of all arities ( obtained as the restrictions of the totally symmetric polymorphisms of @xmath12 to @xmath104 ) , we can apply theorem  [ thm : transitive ] , and conclude that each of the structures @xmath274 either has size 1 , or is isomorphic to a structure which is first - order interdefinable with @xmath18 .",
    "we will now prove that an efficient sampling procedure exists in the case when each of the structures @xmath274 is isomorphic to a structure which is first - order interdefinable with @xmath18 .",
    "the proof can easily be modified to handle the case when some of the structures @xmath274 have size 1 .",
    "let @xmath54 be the maximal arity of @xmath13 , and let @xmath276 be the signature that contains a relation symbol for each at most @xmath54-ary primitive positive definable relation in @xmath13 .",
    "for all @xmath275 , let @xmath277 be the structure obtained from @xmath278 by removing all relations except the relations for the symbols from @xmath276 .",
    "then @xmath277 has a finite signature , and we conclude by theorem  [ thm : transitive ] that @xmath277 has an efficient sampling procedure .",
    "let @xmath279 be the @xmath276-structure produced by this sampler for @xmath277 on input @xmath0 ; we can assume that it has exactly @xmath0 vertices @xmath280",
    ". the output of our algorithm will be the @xmath13-reduct of a @xmath276-structure @xmath5 with vertex set @xmath281 .",
    "since the orbits are primitive positive definable in @xmath12 , there is a unary relation symbol @xmath282 in @xmath276 for each orbit @xmath48 of @xmath12 .",
    "the structure @xmath5 will be such that @xmath283 , for all @xmath275 and @xmath284 .",
    "note that by theorem  [ thm : no - interaction ] , all such structures @xmath5 will be isomorphic .    for @xmath285 , we now add tuples to the relation @xmath70 as follows .",
    "we first fix a partition @xmath286 of the arguments of @xmath3 into at most @xmath20 parts .",
    "let @xmath287 be the arguments of @xmath3 of the @xmath72-th part . for each @xmath72 the relation @xmath288,\\dots , t[p^i_{l(i ) } ] )",
    "\\mid t \\in r \\text { and } t[p^j_l ] \\in u_j \\text { for all } j \\leq k , l \\leq l(j )   \\big \\}\\end{aligned}\\ ] ] is primitive positive definable in @xmath12 , and there is a relation symbol @xmath289 for this relation in @xmath276 .",
    "it is clear that given @xmath286 and the relations @xmath289 of @xmath279 we can efficiently compute the relation @xmath290,\\dots , t[p^i_{l(i ) } ] ) \\in r(p , i )   \\text { for all } i \\leq k   \\big \\ } \\ ; .\\ ] ] it follows from theorem  [ thm : no - interaction ] that @xmath3 equals the union of @xmath291 over all partitions @xmath286 of the arguments of @xmath3  and since there is a constant number of such partitions , @xmath3 can be computed in polynomial time .",
    "we are left with the task to prove theorem  [ thm : transitive ] .",
    "we now proceed to show that when @xmath12 is a transitive sub - exponential model - complete core with totally symmetric polymorphisms of all arities , then it is also primitive . combining this result with the following two theorems",
    "shows that @xmath12 is isomorphic to a structure with a first - order definition in @xmath292 .",
    "this allows us to finish the proof of theorem  [ thm : transitive ] in the next section .",
    "[ thm : macpherson ] let @xmath128 be a primitive but not highly set - transitive permutation group on an infinite set @xmath94 . if @xmath293 is a real number with @xmath294 , then @xmath128 has more than @xmath41 orbits of @xmath0-subsets of @xmath94 , for all sufficiently large @xmath0 .",
    "[ thm : cameron ] a permutation group @xmath128 on an infinite set is highly set - transitive iff it is isomorphic to the automorphism group of a structure with a first - order definition in @xmath292 .",
    "we will need two more lemmas .",
    "let @xmath3 and @xmath39 be two binary relations .",
    "an _ alternating closed walk on @xmath3 and @xmath39 of length @xmath295 _ is a sequence of elements @xmath296 , with @xmath297 , and such that @xmath298 and @xmath299 , for @xmath300 .",
    "[ lem : aclwalk ] let @xmath3 and @xmath39 be two binary relations that are preserved by a totally symmetric function @xmath81 of arity @xmath301 . if there is an alternating closed walk on @xmath3 and @xmath39 of length @xmath295 , then @xmath302 .    since @xmath298 for @xmath300 , we have @xmath303 , for @xmath304 and @xmath305 .",
    "similarly , since @xmath299 for @xmath300 , we have @xmath306 , for @xmath307 and @xmath308 .",
    "note that @xmath309 and that @xmath310",
    ". therefore , @xmath303 and @xmath311 , hence @xmath312 .",
    "an _ orbital _ of @xmath12 is an orbit of @xmath175 acting component - wise on ordered pairs of elements of @xmath12 .",
    "every structure always has the _ trivial orbital _",
    "@xmath313 .",
    "[ lem : k1 ] let @xmath12 be a model - complete core with finitely many orbitals and a totally symmetric polymorphism @xmath81 of arity @xmath0 for all @xmath301 .",
    "let @xmath94 be an equivalence class of a first - order definable equivalence relation on @xmath12 .",
    "if @xmath314 for some @xmath315 and @xmath316 , then @xmath317 .    by assumption , there exists a smallest integer @xmath318 such that @xmath319 .",
    "let @xmath320 , and for @xmath321 , let @xmath322 be the orbital of @xmath12 containing the tuple @xmath323 .",
    "then , we have the inclusion @xmath324 .    since @xmath12 has finitely many orbitals , we can find integers @xmath325 such that @xmath326 .",
    "in fact , we can do this while ensuring that @xmath327 .",
    "note that @xmath328 , and that @xmath329 , for all @xmath72 .",
    "in particular , the following sequence is an alternating closed walk on @xmath330 and @xmath331 of length @xmath332 .",
    "@xmath333    as @xmath12 is a model - complete core , each orbital is primitive positive definable in @xmath12 , and hence preserved by @xmath81 for each @xmath301 . from lemma  [ lem : aclwalk ]",
    ", it now follows that the orbitals @xmath330 and @xmath334 intersect , and therefore they must be equal .",
    "this implies that the tuples @xmath335 and @xmath336 are in the same orbital , so there exists an automorphism @xmath337 of @xmath12 which fixes @xmath338 and maps @xmath339 to @xmath340 . since @xmath337 fixes @xmath338 , we have @xmath341 , and from the choice of @xmath342 , we have @xmath343 .",
    "it follows that @xmath344 , so @xmath345 , and hence @xmath346 as well . due to the choice of @xmath347 ,",
    "this is only possible if @xmath348 , so we conclude that @xmath147 preserves @xmath94 .",
    "we are now ready to prove the main result of this section .",
    "[ prop : transisprim ] let @xmath12 be a transitive sub - exponential model - complete core with totally symmetric polymorphisms of all arities . then @xmath12 has size 1 , or it is infinite and primitive .",
    "assume that @xmath12 has size at least 2 .",
    "let @xmath349 and @xmath350 denote the congruence of @xmath175 with equivalence classes of size 1 , and the congruence with a single equivalence class , respectively .",
    "let @xmath351 be an inclusion - maximal congruence from the set of all congruences different from @xmath350 .",
    "existence of @xmath351 follows from @xmath12 having finitely many first - order definable equivalence relations , and the existence of @xmath349 .",
    "we want to show that @xmath351 must in fact be @xmath349 from which it follows that @xmath175 is primitive .",
    "let @xmath27 .",
    "by @xmath352 we will denote the set of equivalence classes of @xmath351 . for @xmath31 ,",
    "let @xmath353 $ ] denote the equivalence class of @xmath351 containing @xmath338 , and for @xmath315 , let @xmath354 denote the function on @xmath352 which maps @xmath353 $ ] to @xmath355 $ ] for each equivalence class @xmath353 $ ] of @xmath351 .",
    "( it follows from @xmath351 being a congruence that @xmath354 is well - defined . )",
    "we then have that @xmath356 is a permutation group on @xmath352 .",
    "let @xmath357 .",
    "for each equivalence class @xmath358 , choose @xmath359 such that @xmath360 = x_i$ ] .",
    "let @xmath361 and @xmath362 be two @xmath0-subsets of @xmath363 such that @xmath364 for some @xmath315 . then , @xmath365 , so the number of orbits of @xmath0-subsets of @xmath133 is sub - exponential whenever @xmath12 is sub - exponential .",
    "assume that @xmath133 is finite .",
    "pick two distinct equivalence classes @xmath94 and @xmath204 of @xmath351 .",
    "since @xmath12 is transitive , we can find @xmath315 such that @xmath366 .",
    "but if @xmath133 is finite , then @xmath314 for some @xmath316 , so @xmath317 by lemma  [ lem : k1 ] , a contradiction .",
    "therefore @xmath133 must be infinite .",
    "congruences of @xmath133 are in one - to - one correspondence with the congruences of @xmath175 containing @xmath351 .",
    "as the latter are precisely @xmath351 and @xmath350 , it follows that @xmath133 is primitive .",
    "it now follows from theorem  [ thm : macpherson ] that @xmath133 is highly set - transitive , and so from theorem  [ thm : cameron ] that @xmath133 is isomorphic to the automorphism group @xmath367 of a structure with a first - order definition in @xmath292 . the group @xmath367 either has one or two non - trivial orbitals .",
    "if it only has one non - trivial orbital , then so does @xmath133 , hence for any two distinct equivalence classes @xmath94 and @xmath204 of @xmath351 , there is an automorphism @xmath147 of @xmath12 such that @xmath368 and @xmath369 .",
    "again by lemma  [ lem : k1 ] , it follows that @xmath317 , a contradiction .",
    "so @xmath367 has two non - trivial orbitals , one of which is the order @xmath176 on @xmath43 . via the isomorphism",
    ", @xmath133 thus has a non - trivial orbital @xmath176 which is a linear order on the equivalence classes of @xmath351 .",
    "let @xmath3 be a binary relation on @xmath12 defined by @xmath370 iff @xmath353 < y[e]$ ] . for @xmath315",
    ", we have that @xmath354 preserves @xmath176 , so @xmath147 preserves @xmath3 .",
    "assume now that the equivalence classes of @xmath351 have size greater than 1 .",
    "we can then encode a sequence in @xmath371 as a set @xmath372 : choose @xmath373 so that @xmath374 for @xmath375 , encode a value 0 in position @xmath72 by enforcing @xmath376 , @xmath377 , and encode a value 1 by enforcing @xmath378 .",
    "the relations @xmath351 , @xmath379 , and @xmath3 are all preserved by @xmath175 , so if two @xmath295-subsets encodes distinct sequences , then they must be contained in distinct orbits of @xmath295-subsets .",
    "hence , the number of orbits of @xmath295-subsets is greater than or equal to @xmath380 , which contradicts @xmath12 being sub - exponential .",
    "so the equivalence classes of @xmath351 are of size 1 , i.e. , @xmath381 , and @xmath12 is primitive .",
    "assume that @xmath12 is a transitive sub - exponential model - complete core with totally symmetric polymorphisms of all arities .",
    "if @xmath12 is of size greater than 1 , then it is infinite and primitive ( proposition  [ prop : transisprim ] ) , so it is highly set - transitive ( theorem  [ thm : macpherson ] ) and hence isomorphic to a structure @xmath127 with a first - order definition in @xmath18 ( theorem  [ thm : cameron ] ) . to prove the first part of theorem  [ thm : transitive ]",
    ", we have to show that @xmath127 is in fact first - order interdefinable with @xmath18 .",
    "if the binary relation @xmath176 is an orbital of @xmath127 , then @xmath176 is first - order definable in @xmath127 by theorem  [ thm : ryll ] , and interdefinability follows .",
    "otherwise , the smallest orbital of @xmath127 that contains @xmath176 also contains a pair @xmath382 such that @xmath383 .",
    "it follows that @xmath127 has an automorphism @xmath147 such that @xmath203 and @xmath384 , i.e. , @xmath385 .",
    "since @xmath127 has totally symmetric polymorphisms of all arities , we can apply lemma  [ lem : k1 ] to deduce @xmath386 , a contradiction .    to prove the second part of theorem  [ thm : transitive ]",
    ", we show that any structure with a finite relational signature and a first - order definition in @xmath18 has an efficient sampling algorithm .",
    "a relational structure @xmath12 is _ homogeneous _ ( or _ ultrahomogeneous _ ) if every isomorphism between finite induced substructures of @xmath12 can be extended to an automorphism of @xmath12 .",
    "a structure @xmath12 with signature @xmath13 _ admits quantifier - elimination _ if every first - order @xmath13-formula is over @xmath12 equivalent to a quantifier - free @xmath13-formula .",
    "an @xmath65-categorical structure admits quantifier - elimination iff it is homogeneous  @xcite .",
    "let @xmath387 : = \\{1,\\dots , n\\}$ ] .",
    "[ thm : primitive ] every structure @xmath12 with a finite relational signature @xmath13 and a first - order definition in @xmath18 has an efficient sampling algorithm . on input @xmath0 , the output of the algorithm is a structure of size @xmath0 .",
    "the structure @xmath18 is homogeneous , and hence admits quantifier - elimination .",
    "let @xmath388 be first - order definitions of the relations @xmath389 of @xmath12 , written in quantifier - free conjunctive normal form .",
    "for a given @xmath0 , we compute a finite @xmath13-structure @xmath5 with domain @xmath387 $ ] as follows , where @xmath387 $ ] is viewed as a subset of @xmath390 . for each @xmath72 , let @xmath391 be the @xmath392-ary relation over the domain @xmath387 $ ] that contains all @xmath392-tuples that satisfy @xmath393 ( where @xmath392 is the number of free variables of @xmath393 ) .",
    "since @xmath393 is of constant size in @xmath0 , the relation @xmath391 can be computed in time @xmath394 .",
    "the resulting structure @xmath395 ; r^b_1,\\dots , r^b_k)$ ] is clearly a substructure of @xmath12 .",
    "moreover , if @xmath1 is a finite @xmath13-structure with @xmath0 elements , and @xmath396 is a homomorphism from @xmath1 to @xmath12 , then by high set - transitivity of @xmath12 there is an automorphism @xmath147 of @xmath12 such that @xmath397 $ ] .",
    "hence , @xmath1 homomorphically maps to @xmath12 if and only if @xmath1 homomorphically maps to @xmath5 .",
    "in this section we illustrate with a couple of examples the possibility of extending our tractability result beyond sub - exponential structures . all examples of @xmath65-categorical structures with totally symmetric polymorphisms of all arities that we are aware of have a first - order interpretation over the structure @xmath18 .",
    "interpretations are a central concept from model theory , which we briefly recall in the following .",
    "let @xmath276 and @xmath13 be relational signatures , @xmath56 a @xmath276-structure , and @xmath12 a @xmath13-structure .",
    "@xmath398-dimensional ( first - order ) interpretation @xmath230 of @xmath12 in @xmath56 _ consists of ( cf .",
    "@xcite )    1 .   a @xmath276-formula @xmath399 ; 2 .   for each atomic @xmath13-formula @xmath400 , a @xmath276-formula @xmath401 , where @xmath402 are disjoint @xmath398-tuples of distinct variables ; and 3 .",
    "a surjective map @xmath403 ;    such that for all atomic @xmath13-formulas @xmath404 and all @xmath405 , @xmath406 holds in @xmath12 if and only if @xmath407 holds in @xmath56 .",
    "our interest in interpretations also stems from the following result .",
    "[ lem : interpretq ] every structure @xmath12 with a finite relational signature @xmath13 and a @xmath398-dimensional interpretation in @xmath18 has an efficient sampling algorithm . on input @xmath0 ,",
    "the output of the algorithm is a structure of size at most @xmath408 .",
    "let @xmath230 be a @xmath398-dimensional interpretation of @xmath12 in @xmath292 . on input @xmath0",
    ", we compute a finite @xmath13-structure @xmath5 which is the induced substructure of @xmath12 on the domain @xmath409^d))$ ] . for an @xmath54-ary @xmath285",
    ", we do the following .",
    "let @xmath410 be the interpretation in @xmath292 of the atomic formula @xmath411 , given in quantifier - free conjunctive normal form .",
    "we now evaluate @xmath410 on each sequence of @xmath398-tuples , @xmath412^d)$ ] .",
    "the formula @xmath413 is true iff the tuple @xmath414 is in @xmath70 .",
    "since @xmath404 is of constant size in @xmath0 , it follows that we can compute the relation @xmath70 in @xmath415 time .",
    "the signature @xmath13 is finite , so there is a relation of highest arity , independent of @xmath0 , which provides the upper bound on the time complexity of the algorithm .    next , let @xmath1 be a finite @xmath13-structure with @xmath0 elements , and assume that @xmath416 is a homomorphism .",
    "this implies @xmath11 as well : the image of @xmath1 under @xmath417 has at most @xmath0 elements , @xmath418 .",
    "let @xmath419 be tuples in @xmath420 such that @xmath421 , and let @xmath422 ) be the function such that @xmath423 for all @xmath72 .",
    "note that @xmath419 contains at most @xmath424 distinct values of @xmath43 . by high set - transitivity of @xmath292",
    ", it follows that there is an automorphism @xmath147 of @xmath292 such that @xmath425 $ ] for each @xmath72 and @xmath108 , where @xmath426 .",
    "now for each relation symbol @xmath285 , we have @xmath427 iff @xmath428 holds in @xmath292 iff @xmath429 holds in @xmath292 , and this in turn is true if and only if @xmath430 .",
    "it follows that @xmath431 is a homomorphism from @xmath1 to @xmath5 .",
    "below , we give a number of examples of structures with exponential growth that are interpretable in @xmath18 , and have semi - lattice operations .",
    "let ` @xmath176 ' , ` @xmath432 ' , and ` @xmath433 ' denote the usual inequality and equality relations on @xmath43 .",
    "let @xmath434 be the relational structure over @xmath435 with binary relations @xmath436 for @xmath437 , where @xmath438 is defined by @xmath439 .",
    "this structure is exponential . to obtain a lower bound on the growth rate of @xmath434 ,",
    "pick an @xmath0-subset @xmath440 , and assume that the projection of @xmath1 on the second component contains exactly @xmath20 distinct values . for @xmath98 ,",
    "let @xmath441 denote the number of elements that have the @xmath72th largest second component value .",
    "then , @xmath442 determines a _ composition of @xmath0 _ ,",
    "i.e. , an expression for @xmath0 as an ordered sum of positive integers . two sets @xmath443 which determine different compositions must be in different orbits . thus , the number of orbits of @xmath0-subsets of @xmath444 is at least @xmath445 , the number of compositions of @xmath0 .    hence , theorem  [ thm : yyy ] does not apply to @xmath434 . instead",
    ", tractability can be inferred as follows .",
    "the structure @xmath434 has a two - dimensional interpretation @xmath230 in @xmath18 .",
    "the formula @xmath446 is always true , @xmath447 is the identity on @xmath435 , and the interpretations of @xmath3 and @xmath39 are as given above . furthermore , it is easy to verify that @xmath434 is invariant under the semi - lattice operations given by ( component - wise ) @xmath448 and @xmath449 .",
    "tractability of @xmath450 now follows from theorem  [ thm : correctness ] and lemma  [ lem : interpretq ] .    for any @xmath451",
    ", this example can be generalized to a structure with @xmath452 @xmath398-ary relations , and with a @xmath398-dimensional interpretation in @xmath292 .",
    "the csp of each such structure is polynomial - time solvable .",
    "[ fig:1 ]    ( -1,-1 ) rectangle ( 1,1.5 ) ; ( ) at ( 0,-0.5 ) @xmath453 ; ( c ) at ( 0.5cm,0 ) [ ] ; ( b ) at ( 0,0.75 cm ) [ ] edge[edge](c ) ; ( a ) at ( -0.5cm,0 ) [ ] edge[edge](c ) edge[edge ] ( b ) ;    ( -1,-1 ) rectangle ( 1,1.5 ) ; ( ) at ( 0,-0.5 ) @xmath454 ; ( c ) at ( 0.5cm,0 ) [ ] ; ( b ) at ( 0,0.75 cm ) [ ] edge[edged](c ) ; ( a ) at ( -0.5cm,0 ) [ ] edge[edged](c ) edge[edged ] ( b ) ;    ( -1,-1 ) rectangle ( 1,1.5 ) ; ( ) at ( 0,-0.5 ) @xmath455 ; ( c ) at ( 0.5cm,0 ) [ ] ; ( b ) at ( 0,0.75 cm ) [ ] edge[edge](c ) ; ( a ) at ( -0.5cm,0 ) [ ] edge[edged](c ) edge[edged ] ( b ) ;    ( -1,-1 ) rectangle ( 1,1.5 ) ; ( ) at ( 0,-0.5 ) @xmath456 ; ( c ) at ( 0.5cm,0 ) [ ] ; ( b ) at ( 0,0.75 cm ) [ ] edge[edged](c ) ; ( a ) at ( -0.5cm,0 ) [ ] edge[edged](c ) edge[edge ] ( b ) ;    the _ age _ of a structure @xmath12 is defined as the class of all finite structures isomorphic to a substructure of @xmath12 .",
    "let @xmath457 be a signature with two binary relation symbols , and let @xmath458 be the set of structures in fig .",
    "[ fig:1 ] , where the tuples of @xmath3 ( @xmath39 ) are given by the solid ( dashed ) arrows .",
    "let @xmath459 be the class of all finite structures with signature @xmath457 for which every three - element substructure is isomorphic to a structure in @xmath262 .",
    "it can be shown that @xmath459 is an _ amalgamation class _ so that its _ frass limit _ exists ( cf .",
    "theorem  6.1.2 in @xcite ) .",
    "this is the up to isomorphism unique countable homogeneous structure with age @xmath459 .",
    "the following describes a relational structure @xmath460 with age @xmath459 which can be verified to be homogeneous .",
    "it follows that @xmath460 is isomorphic to the frass limit of @xmath459 .",
    "let @xmath461 , where @xmath462 is the relation @xmath463 , and @xmath464 is the relation @xmath465 . the growth rate of @xmath460 can be bounded as in the previous example , and here it turns out that the number of orbits of @xmath0-subsets is precisely @xmath445 .",
    "the structure @xmath460 also has a two - dimensional interpretation in @xmath18 and semi - lattice polymorphisms given by ( component - wise ) @xmath448 and @xmath449 , so tractability follows once again from theorem  [ thm : correctness ] and lemma  [ lem : interpretq ] .",
    "let @xmath466 be the following relational structure .",
    "the domain @xmath467 is the disjoint union of two copies of @xmath43 .",
    "the binary relation @xmath468 defines a perfect matching between the elements of @xmath48 and the elements of @xmath53 , and the binary relation @xmath176 defines a dense linear order on @xmath467 such that @xmath469 for all @xmath470 and @xmath471 , and for @xmath472 , we have @xmath473 iff @xmath474 for the elements @xmath177 with @xmath475 .",
    "the structure @xmath476 is invariant under the semi - lattice operations given by @xmath448 and @xmath449 defined with respect to the order @xmath176 on @xmath467 .",
    "it has two orbits and @xmath477 is isomorphic ( as an abstract group ) to @xmath239 . by theorem  [ thm : no - interaction",
    "] , this implies that @xmath476 does not have sub - exponential growth .",
    "but @xmath476 has a 2-dimensional interpretation @xmath230 in @xmath292 , so @xmath478 is polynomial - time solvable : let @xmath479 be the formula @xmath480 , and let @xmath481 be the copy of @xmath338 in @xmath48 if @xmath482 and the copy of @xmath338 in @xmath53 if @xmath383 . the matching @xmath468 on @xmath483 and @xmath484",
    "is interpreted by the formula @xmath485 and the order @xmath176 on @xmath483 and @xmath484 is interpreted by the formula @xmath486 .",
    "every finite structure @xmath5 has an interpretation @xmath230 in @xmath292 , in fact , even in @xmath487 .",
    "let @xmath488 and the dimension of the interpretation be @xmath489 .",
    "the formula @xmath490 is true if and only if for exactly one @xmath72 it holds that @xmath491 .",
    "equality is interpreted by the formula @xmath492 it is now straightforward to write down first - order formulas @xmath493 that interpret the relations of @xmath5 .",
    "when @xmath3 is @xmath20-ary , then the formula @xmath493 is a disjunction of conjunctions with @xmath494 variables @xmath495 .",
    "for each tuple @xmath496 , the disjunction contains the conjunct @xmath497 .",
    "the examples in this section suggest the following question .    [",
    "quest : interpretations ] is it true that all @xmath65-categorical relational structures with totally symmetric polymorphisms of all arities have a first - order interpretation over @xmath292 ?",
    "in this article we prove that constraint satisfaction problems for templates @xmath12 where the number of orbits of @xmath0-subsets of @xmath12 grows sub - exponentially in @xmath0 can be solved in polynomial time when @xmath12 has a semi - lattice polymorphism .",
    "in fact , we showed the stronger result which only requires the existence of totally symmetric polymorphisms of all arities , instead of requiring the existence of a semi - lattice polymorphism .",
    "this algorithmic result can be showed in two stages :    1 .   in the first stage , we reduce csp@xmath498 , for structures @xmath12 with totally symmetric polymorphisms of all arities , to solving certain uniform finite domain csps , and to the task to find an efficient sampling algorithm for @xmath12 .",
    "2 .   in the second stage ,",
    "we _ classify _ sub - exponential structures @xmath12 with totally symmetric polymorphisms of all arities , and use the classification to verify that there always exists an efficient sampling algorithm for @xmath12 .",
    "the reduction presented in the first stage crucially relies on the fact that when @xmath12 has totally symmetric polymorphisms of all arities , then for all finite induced substructures @xmath39 of @xmath12 the set structure of @xmath39 homomorphically maps to @xmath12 ( lemma  [ lem : totsymtohomo ] ) .",
    "we want to remark that this connection has a converse when @xmath12 is @xmath65-categorical .",
    "[ lem : omegaequiv ] let @xmath12 be an @xmath65-categorical structure over a finite relational signature .",
    "then @xmath12 has totally symmetric polymorphisms of all arities if and only if @xmath88 for all finite substructures @xmath89 .",
    "the forward direction was proved in lemma  [ lem : totsymtohomo ] .",
    "the remaining direction can be proved using a common technique for constructing homomorphisms to @xmath65-categorical structures .",
    "given an arbitrary positive integer @xmath0 , we want to produce an @xmath0-ary totally symmetric polymorphism @xmath9 of @xmath12 .",
    "the idea of the proof is as follows : let @xmath499 be an enumeration of the elements of @xmath27 , and let @xmath500 . for each @xmath79 ,",
    "let @xmath501 be the set of homomorphisms from @xmath502)$ ] to @xmath12 .",
    "introduce an equivalence relation @xmath503 on @xmath501 by defining @xmath504 iff @xmath505 for some automorphism @xmath147 of @xmath12 .",
    "let @xmath506 denote the set of equivalence classes of @xmath501 under @xmath503 .",
    "arrange the elements of @xmath507 into a forest containing at least one infinite tree : each @xmath508 is defined to be the root of a separate tree , and for each @xmath212 , and @xmath509 , define the parent of @xmath510 to be the equivalence class containing the restriction of @xmath511 to the non - empty subsets of @xmath512 .",
    "this definition is independent of the choice of representative in @xmath513 , so each equivalence class in @xmath506 , @xmath212 , has precisely one parent .",
    "since @xmath12 is @xmath65-categorical , it follows that there are finitely many equivalence classes for a fixed @xmath20 .",
    "hence , there are finitely many trees and each tree is finitely branching in each node . by assumption , @xmath506 is non - empty for each @xmath79 , so some tree has unbounded height .",
    "now , knig s tree lemma implies the existence of an infinite path @xmath514 in some tree .",
    "assume that there are representatives @xmath515 , such that @xmath516 is the restriction of @xmath511 to the non - empty subsets of @xmath512 .",
    "we show that this path can be extended indefinitely : choose @xmath517 arbitrarily and let @xmath518 be its restriction to the non - empty subsets of @xmath519 .",
    "then , there exists an automorphism @xmath147 such that @xmath520 .",
    "it follows that @xmath521 is the restriction of @xmath522 to the non - empty subsets of @xmath519 , hence we can define @xmath523 .    now , for any @xmath0-tuple @xmath524 over @xmath21 , define @xmath525 , where @xmath54 is an any integer such that @xmath526 . by the construction of the sequence @xmath527 ,",
    "the function @xmath9 is a well - defined totally symmetric @xmath0-ary function on @xmath21 . to verify that @xmath9 is a polymorphism of @xmath12 , let @xmath528 be an @xmath347-ary relation , and @xmath529 .",
    "let @xmath530,\\dots , t_n[i]\\}$ ] , for @xmath531 .",
    "assume without loss of generality that @xmath54 has been chosen large enough so that @xmath532 . then @xmath533,\\dots , t_n[i ] ) = f_m(u_i)$ ] for all @xmath72 .",
    "by definition of the set structure , we have @xmath534)}$ ] . since @xmath535 is a homomorphism ,",
    "we conclude that @xmath536 , so @xmath9 is indeed a polymorphism .    because of the general applicability of the algorithmic approach in section  [ sect : alg ] , and because of the fact that the known structures of exponential growth that have totally symmetric polymorphisms seem to be well - behaved ( see section  [ sect : beyond ] )",
    ", we make the following conjecture ."
  ],
  "abstract_text": [
    "<S> a famous result by jeavons , cohen , and gyssens shows that every constraint satisfaction problem ( csp ) where the constraints are preserved by a _ </S>",
    "<S> semi - lattice operation _ can be solved in polynomial time . </S>",
    "<S> this is one of the basic facts for the so - called _ universal - algebraic approach _ to a systematic theory of tractability and hardness in finite domain constraint satisfaction .    </S>",
    "<S> not surprisingly , the theorem of jeavons et al .  fails for arbitrary infinite domain csps . </S>",
    "<S> many csps of practical interest , though , and in particular those csps that are motivated by _ qualitative reasoning calculi _ from artificial intelligence , can be formulated with constraint languages that are rather well - behaved from a model - theoretic point of view . in particular , the automorphism group of these constraint languages tends to be _ large _ in the sense that the number of orbits of @xmath0-subsets of the automorphism group is bounded by some function in @xmath0 . in this paper </S>",
    "<S> we present a generalization of the theorem by jeavons et al .  to infinite domain csps where the number of orbits of @xmath0-subsets grows sub - exponentially in @xmath0 , and prove that preservation under a semi - lattice operation for such csps implies polynomial - time tractability . unlike the result of jeavons et al . </S>",
    "<S> , this includes many csps that can not be solved by datalog .    </S>",
    "<S> = [ draw , circle , fill = black , text = white , minimum size=2pt , inner sep=0pt ] = [ -latex ] = [ -latex , dashed ] </S>"
  ]
}