{
  "article_text": [
    "the importance of modeling type  ia supernova ( sn  ia ) light curves is clear from the large number of methods that have been developed for this purpose .",
    "an incomplete sample includes mlcs / mlcs2k2 @xcite , stretch @xcite , super stretch @xcite , @xmath2 @xcite , batm @xcite , cmagic @xcite , salt , and salt2 .",
    "for some sne the different techniques produce quite different results , but when applied to a moderately sized sample the overall results appear to be fairly similar @xcite .",
    "these packages are most frequently used to derive relative distances which can then be used to constrain the cosmological parameters .",
    "depending on the data set , current methods give relative distances to a precision of @xmath3 . the potential reward for any small improvement in",
    "how well distances can be extracted from sn data is large .",
    "this paper presents the details of sifto , a light - curve analysis tool developed for use with data from the supernova legacy survey .",
    "snls follows a two - pronged analysis approach : most of the steps are carried out twice using independent methods , and the results are compared .",
    "this includes spectroscopic typing , photometry , calibration , light - curve fitting , and the extraction of the cosmological parameters .",
    "the details of the complementary light - curve fitting method ( salt / salt2 ) are described in and g07 . by design",
    ", sifto takes a simpler algorithmic approach than salt2 , which should make the results somewhat more robust to the details of the training sample .",
    "salt2 , however , should have more growth potential as future data sets become available",
    ".    the features of sifto are :    * the shape of the light - curve is described by a single stretch parameter , the stretch in the rest - frame @xmath1 band , @xmath4 . however , the model is generalized so that different observed filters stretch by different amounts as a function of wavelength and @xmath4 (   [ subsec : stretch ] ) .",
    "* sn  ia colors are handled by allowing the normalization of the fit in each observed filter to vary independently .",
    "the resulting colors are then combined to form a single color parameter when the results of the light - curve fit are transformed into a distance (   [ subsec : colormodel ] ) .",
    "* for the a06 data sample , the rms of the sifto - derived distances around the best fit cosmological parameters is 0.16 mag .",
    "this is identical to salt2 on the same data set , and is a clear improvement over salt and mlcs2k2 (   [ subsec : hizcomparison ] ) .",
    "* when we train sifto and salt2 on the same data set using the same non - sn related settings ( filter functions , etc . )",
    "the cosmological results are very similar (   [ sec : retrain_compare ] ) .",
    "the outputs of sifto are a set of light - curve parameters ( the time of maximum and the @xmath4 ) and the spectral energy distribution ( sed ) of the sn as a function of time . from this information",
    "one can construct a distance estimate by finding the magnitude in the rest frame @xmath1 band ( @xmath5 ) on a fiducial epoch and some set of rest - frame colors .",
    "the peak magnitude , stretch , and color can be combined to form a relative distance estimate .",
    "there are many similarities between sifto and salt / salt2 . unlike the other packages mentioned above , sifto , salt , and salt2 work in flux space by manipulating a model of the sed directly . by working with the seds ,",
    "the fits are naturally performed in the observer frame without the need for a distinct @xmath6-correction step . like salt2",
    ", sifto incorporates high - redshift snls data when deriving the model sed , which allows us to extend our model further towards the blue than is possible with only low - z data .",
    "this is particularly important when working with surveys that sample a large range of redshifts , since in this case some of the observed filters may be bluer than the rest - frame @xmath0 band at the highest redshifts .",
    "this is true even of many surveys which obtain supplemental near - ir photometry .",
    "snls observes sne in the range @xmath7 in four filters ( @xmath8 ) , which are similar to the usno system described in @xcite . at the lowest - redshifts , these filters essentially sample @xmath9 , and at highest @xmath10 and @xmath11 .",
    "it is critical that our model handles both situations in a consistent fashion . for @xmath12 ,",
    "@xmath13  is bluer in the rest frame than @xmath0 , and the same holds for @xmath14  at @xmath15 .",
    "since the sn is often still detected in these filters , if our model extends only to @xmath0 ( 3600  ) we will have to ignore some of our signal .",
    "incorporating @xmath14  for the highest redshift sne is particularly helpful because the @xmath16  data are both noisier ( due to fringing , sky brightness , and a drop in the ccd quantum efficiency ) and harder to calibrate than @xmath13 , @xmath14 , and @xmath17 , and it is necessary that we have good quality observations of each sn in at least two filters to measure the color .",
    "there are many algorithmic differences between the fitters .",
    "sifto uses a spectral template as an input to the training process , although this template was informed by the results of initial sifto fits , while salt2 includes spectra more directly in the model derivation .",
    "the method of adjusting the sed models are also very different , with salt2 in principle allowing for more detailed modeling of individual features .",
    "however , given the limitations of current training samples , the most important difference between salt / salt2 and sifto lies in how sn colors are handled . in sifto , the sed is adjusted to match the observed frame colors in each filter , rather than by imposing a single color model across all filters simultaneously as in salt / salt2 .",
    "the justification is that sne  ia show evidence for some additional variability in their colors , particularly in the near - uv , so forcing the fit to match a single color law at all wavelengths may give a poor result .",
    "note that sifto , salt , and salt2 do account for a relationship between stretch and color when the results are converted into a distance . in this paper , this relationship is taken to be linear .",
    "sifto is designed for use with modern , well measured sn data sets , and is not suited for the analysis of poorly sampled light curves . specifically ,",
    "if the number of observations in a filter in the range -20 to 40 rest frame days relative to @xmath1 maximum is less than about 3 , then the fit in that filter may not be reliable .",
    "this proviso only applies to historical sn  ia samples  even at the highest redshifts , current observations are of high enough quality that this is not a problem .",
    "our approach is not well suited to the rest - frame near - ir ( @xmath18 or redder ) , where a stretch - like prescription does not work well .",
    "our base sed model is an updated version of ( * ? ? ?",
    "* hereafter h07 ) , adjusted to match sn  ia observations in a number of synthetic filters (   [ subsec : sedmodel ] ) .",
    "our template includes an error snake representing the uncertainty in the template and intrinsic variability of sne  ia (   [ subsec : errorsnake ] ) .",
    "sifto is designed so that the effects of most systematics can be modeled by adjusting the color relation , and do not require fully retraining the entire template (   [ subsec : systematics ] ) .",
    "the data used to train the sifto model is described in   [ sec : data ] .",
    "the derived light - curve parameters are the most reliable when there are data within @xmath19 rest frame days of the epoch of peak @xmath1 luminosity (   [ sec : daygap ] ) .",
    "the distinction between light - curve fitters and distance estimators is often not made explicit in the literature .",
    "the majority of the published packages are light - curve fitters , with the exception of mlcs / mlcs2k2 and batm .",
    "a light - curve fitter attempts to find the best fit to a given set of sn  ia photometry .",
    "the parameters of this fit can then be converted into a distance estimate if desired , but technically this step is not part of the fit .",
    "a distance estimator attempts to find the distance directly rather than trying to obtain the best fit to the data . in both cases one is only trying to find relative distances ; nothing described in this paper depends on knowing the absolute distance to any sn , the hubble constant , or the absolute magnitude of any sn in any bandpass .",
    "the advantage of a distance estimator is that the output is directly what is desired for _ most _ applications of sn  ia data .",
    "therefore , the products of such an analysis are simpler to use , and in principle such an approach may do a better job extracting the information directly relevant to this purpose .",
    "their primary disadvantage is that , by their nature , they must use distance information in their training , usually in the form of residuals from the best - fit hubble relation .",
    "this makes it difficult to include both very low - redshift sne ( which are not in the smooth hubble flow ) , and high - redshift data ( where the residual depends on the cosmological parameters ) . to use high - z data properly",
    ", it would be necessary to re - train the model from scratch for every value of the cosmological parameters one evaluates , which would be extremely computationally expensive .",
    "therefore , in practice , light - curve fitters have access to a more data for training purposes . neither approach is obviously superior , and we will not attempt to give a comprehensive comparison of their merits here . because we find the advantages of incorporating data from a range of redshifts in our training compelling , sifto is a light - curve fitter .      like salt / salt2 , sifto works by manipulating a sed model .",
    "most fitters do not take this approach .",
    "instead , they are defined in some set of rest - frame filters and use @xmath6-corrections to transfer the model to the observed frame . that is , they work in photometry space rather than sed space .",
    "this is simpler , but the fact that the @xmath6-corrections must be calculated and applied in a distinct step can lead to complications in ensuring that the two steps are fully consistent with each other . working directly with the seds",
    "obviates this difficulty ; formally , sifto , salt , and salt2 do not calculate @xmath6-corrections , although this is perhaps more of a pedagogical distinction than a practical one .",
    "this choice requires that we work with fluxes rather than magnitudes , which is desirable anyways because using magnitudes will bias fits to low signal - to - noise data .",
    "we start with a base model for some fiducial sn  ia and then use additional parameters to adjust the sed to best match a particular sn .",
    "two parameters are fairly obvious ( some overall flux normalization and overall time offset ) , but beyond this the parameterization is somewhat arbitrary",
    ". theoretical modeling of sne  ia is sufficiently difficult that it offers little guidance here , so our choice of parameters is empirical .",
    "the existence of a relation between between the shape of the light curve and the peak brightness of the sn is very well established , as is the relation between the color and luminosity .",
    "these are in the sense that more slowly evolving sne are observed to be more luminous ( the wider - brighter relationship ) , and redder sne are fainter ( bluer - brighter ) .",
    "the former is clearly related to sn physics , while the latter is very likely some combination of sn properties and external effects such as dust .      the sifto model for light - curve shape",
    "is based on the stretch parameterization @xcite . here ,",
    "the timescale over which a sn  ia evolves is modified by multiplying by a factor @xmath20 .",
    "sne with higher @xmath20 evolve more slowly , with broader light curves . changing",
    "the stretch simply widens or narrows the light curve in a linear fashion .    in most previous applications of stretch either the same value",
    "was applied at all wavelengths or the stretch values were fit independently in each filter .",
    "the quality and quantity of snls data shows that the first is no longer sufficient , and we can improve on the second by relating the stretches of different filters .",
    "sifto uses an empirical relation between the stretch in @xmath1 ( @xmath4 ) and the effective rest - frame wavelength of the observed filters .",
    "this is constrained to work like a simple stretch factor in rest - frame @xmath1 . with this adjustment ,",
    "the stretch model is a very good description of our observations , as will be demonstrated later .",
    "however , this approach does not work well in the rest - frame @xmath18 and redder , which may be an issue for some data sets , although not snls .",
    "the salt model is based on the stretch prescription in @xmath1 , but not in other filters , while salt2 allows for more general behavior .      rather than imposing a relation between different",
    "observed filters during the light - curve fit , in sifto this relation is used when the fit parameters are converted into a distance .",
    "the normalization of the fit to each observed filter is allowed to float independently during the fit .",
    "the sed is then adjusted using splines to match these observed colors .",
    "we find that single parameter functions ( such as dust laws or the salt / salt2 color relation ) are generally unable to reproduce the full variety of observed colors across more than two observed filters , which is likely indicative of some intrinsic variability in sne  ia .",
    "therefore , the parameters in each fit are the time of maximum luminosity in the rest - frame @xmath1-band @xmath21 , the stretch @xmath4 , and @xmath22 normalization parameters , one for each observed filter whose rest frame wavelength lies within the range our model is defined .",
    "@xmath23 for most snls data , except at the redshift extremes .",
    "the results can be used to produce a corrected distance which makes a better standard candle : @xmath24 @xmath25 and @xmath26 must be determined empirically along with the cosmological parameters , @xmath5 is the peak rest - frame magnitude in the @xmath1 band , and @xmath27  is some sort of color parameter . in principle",
    "we could have several color parameters , one for each observed color , but it would be difficult to ensure that the color was being applied consistently across the entire sample .",
    "we therefore combine the different observed colors into a single parameter , using the sn data themselves to derive the relationship between different rest - frame colors .",
    "one of the consequences of this relation is that any linear variation of the intrinsic color of sne  ia with stretch is absorbed by the @xmath25 term .",
    "therefore , our method _ does _ model some aspects of intrinsic color and how it relates to light - curve shape . the differences between this approach and that currently used by mlcs2k2 are threefold :",
    "first , mlcs2k2 includes a quadratic term in the light - curve shape .",
    "this has a small effect except at the extremes of the sn population .",
    "second , mlcs2k2 makes use of several priors on the parameters , of which the color prior is the most important .",
    "third , it assumes that any residual color that remains after the correction for light - curve shape is due to milky way - like dust , and therefore @xmath26 is ( usually ) set to 4.1 for the @xmath28 color . in effect , these assumptions mean that sn colors can only derive from three sources : the shape of the light curve , dust , and possibly some scatter in the intrinsic colors which has no effect on the luminosity .",
    "mlcs2k2 could be modified to relax this set of assumptions .",
    "therefore , the current distinction between intrinsic and extrinsic colors in mcls2k2 versus sifto and salt / salt2 is more practical than philosophical , and is mostly related to the exact nature of the color and light - curve shape priors used by mlcs2k2 . whether or not these priors are beneficial depends on whether the smaller statistical errors obtained by using them outweigh the enhanced sensitivity to evolution or other systematic errors in the prior distributions ( e.g. , the distribution of extinction and how it interacts with survey selection effects ) that they introduce .",
    "@xcite demonstrates that either dust along the line of sight to local sne is either quite different than we expect , or that sn intrinsic colors are not predicted completely by a linear or quadratic light - curve shape model by showing that @xmath26 is significantly less than 4.1 .",
    "we have further investigated this question by introducing a quadratic stretch term into our corrected magnitudes , and find that it has virtually no effect on @xmath26 . in other words , adding an additional quadratic term like the one used in mlcs2k2 does little to address the issue of intrinsic versus extrinsic color .",
    "we build a model that can combine the different measured colors for individual sne into a single color parameter by taking sne with simultaneous rest - frame @xmath29 observations and using this data to predict @xmath28 as a function of @xmath30 and @xmath4 . here , as elsewhere in this paper , colors are always measured at the epoch of @xmath1 maximum . in effect , this is loosely similar to the salt / salt2 approach , except that the color model has been separated from the light - curve fit and the sed model building . in a06 a similar relation , implicitly included in the salt training process , was determined purely by low - z sn data .",
    "@xmath0 data is notoriously difficult to calibrate ( e.g. , * ? ? ?",
    "* ) , and relatively little is available , although the situation has improved considerably recently @xcite . by using snls data",
    "we can overcome this problem  the rest - frame @xmath0 generally maps to either observer frame @xmath31 or @xmath32 , both of which are well calibrated .",
    "in addition , this data is available for virtually all of our sne . as a result ,",
    "the color relation is considerably better constrained than was the case in a06 .",
    "our color relation takes the form @xmath33 we then combine this with the actual measured @xmath28 ( if available ) using a weighted average to form our color parameter @xmath27 , which therefore represents the @xmath28 color of the sn at peak , usually after correction for milky - way extinction .",
    "this differs by an arbitrary constant offset from the definition used in salt / salt2 .",
    "the data suggests that there is some additional intrinsic dispersion in how well @xmath28 can be predicted by @xmath30 beyond that attributable to measurement errors  in other words , the different colors do carry some independent information",
    ". this should not be entirely surprising , as there has long been a theoretical expectation that sne  ia are not as homogeneous in the near - uv as at longer wavelengths @xcite .",
    "this is supported by observations @xcite .",
    "we account for this by degrading the assigned uncertainty in the predicted @xmath28 by an additional factor @xmath34 added in quadrature with the measurement error .",
    "this plays a similar role to the @xmath6-correction uncertainties discussed in g07 , although it is expressed in a different fashion .    because of this additional scatter it is important that the statistic used to measure @xmath35 allows for dispersion beyond that represented by the measurement errors .",
    "we use the multiple regression method of @xcite , which also provides estimates of @xmath34 , and couple these fits with iterative @xmath36 outlier rejection when deriving the relation .",
    "a further refinement is to extend this model bluer than the rest - frame @xmath0-band .",
    "we define an artificial filter defined as the @xmath0-band filter of @xcite blueshifted by @xmath37 , which we refer to as @xmath38 , and which has an effective wavelength of @xmath39  .",
    "we then use a similar relation to the above to predict @xmath28 given @xmath40 .",
    "not surprisingly , this relationship is not as well determined since it is measured with higher - redshift , and hence noisier , observations .",
    "nonetheless , the additional information provided by @xmath38 is useful with the highest - redshift snls observations (  [ sec : results ] ) .",
    "we denote the coefficients of this relation as @xmath41 and @xmath42 , with a corresponding @xmath43 .",
    "the same technique can also be applied to @xmath44 . since",
    "this is not useful for the majority of snls data ( which do not have rest frame @xmath45 observations ) , we do not discuss these coefficients here .",
    "this gives us ( potentially ) three estimates of @xmath28  that from @xmath30 , @xmath40 , and finally the actual @xmath28 .",
    "we form a weighted mean of whatever subset are available to form @xmath27 , taking care to propagate the covariances .",
    "the additional scatter represented by @xmath34 and similar terms usually has a significant effect on the final weights .",
    "large extrapolations are undesirable in this process because they increase the importance of the boundary conditions used when we adjust the sed . to avoid this",
    ", we require that each of our synthetic rest frame magnitudes ( @xmath46 ) has an observed frame filter within 650 (in the rest frame ) , and do not allow the same observed filter to be matched to multiple rest - frame filters .",
    "with the requirement in place , our fits are very insensitive to the form of the boundary conditions .",
    "the model blue - ward of @xmath0 ( @xmath47  ) is completely determined by snls data .",
    "this means that the question of how well this part of the model is calibrated observationally is determined by our @xmath13and @xmath14  calibrations , which are secure .",
    "the translation from magnitudes to flux is not as precise in this wavelength regime ( i.e. , we do not know the flux of vega in @xmath38 as well as in the standard filters ) , and so in an absolute sense our model sed has some additional calibration uncertainties here . however , because we do not have any observer frame data in this wavelength range , these are completely irrelevant to our current application .",
    "that is , the sed of vega could be replaced with any function below 3000   and it would have no effect on our derived distances . of more interest is the concern that sne  ia may not be good standard candles in the near - uv , and that there may be external factors ( such as dust ) which vary more with environment at 3000   than at 3600  .",
    "given our sed model @xmath48 ( described in   [ subsec : sedmodel ] ) , parameterized by the observed epoch @xmath49 , the stretch in the @xmath1 band @xmath4 , the epoch of peak luminosity in the @xmath1 band @xmath21 , the @xmath22 phase - independent multiplicative factors @xmath50 , we define the effective broadband integrated flux @xmath51 in a filter @xmath52 of a sn observed at a heliocentric redshift @xmath53  by @xmath54 where @xmath55 is the dimensionless total ( atmosphere + optics + filter + ccd ) system transmission function .",
    "note that this is not the energy flux absorbed by the detector , differing both in normalization and by including an extra factor of @xmath56 inside the integral .",
    "the utility of this quantity stems from its relation to astronomical magnitudes : @xmath57 .",
    "the factor of @xmath56 is a result of the fact that astronomical magnitudes are defined in terms of counts , not energy .",
    "the calibration process by which observations are placed on a standard photometric system involves a similar term over some reference spectrum whose magnitudes are known ; this is conventionally taken to be the spectrum of vega .",
    "we require the @xmath50 to be positive .",
    "the @xmath58 are never known perfectly , and this should be included in the systematics error budget of any cosmological analysis , including the consequences for sifto or any other light - curve fitter .",
    "an exploration of how well these are known for different supernova samples is beyond the scope of this paper . we expect to update sifto as our understanding of various calibrations improves and new sn samples become available .",
    "the light - curve fit then minimizes @xmath59 where @xmath60 is the number of datapoints in the j@xmath61 filter , @xmath62 is the template error , @xmath63 is the effective wavelength of filter @xmath52 ( see below ) , and @xmath64 are the observed data points with errors @xmath65 .",
    "the parameterization of @xmath48 is the most critical element .",
    "we start with a model for the sed of a fiducial @xmath66 sn  ia , @xmath67 , where we define @xmath4 so that the mean value averaged over our training sample is unity , and @xmath68 is a time series of spectral templates covering the range 20009000   with a unique sed at every epoch from @xmath69 to @xmath70 days .",
    "we then form the effective epoch @xmath71 , and then use this quantity to select the appropriate sed from @xmath68 , linearly interpolating between the two nearest tabulated epochs .",
    "we next apply the stretch model as described below , and adjust the sed to match the observed colors so that the final result is a single sed which can be used to predict the magnitudes in any filter at any desired redshift .",
    "usually this is used to compute rest - frame magnitudes in some standard set of filters such as @xmath46 .    the method used to adjust",
    "the sed is similar to that described in h07 : we multiply the sed by an interpolating cubic spline under tension ( @xmath72 ) , with the spline knots placed at the effective wavelengths of the observed filters . in order to ensure that the sed remains positive , we work in log space . an example is shown in figure  [ fig : mangle_example ] .",
    "we experimented with a variety of functional forms to smoothly scale the spectrum in place of splines , and found similar results using linear or higher - order polynomial interpolation .      in the sifto model , @xmath73 ,",
    "the stretch in filter @xmath52 , is not necessarily the same as @xmath4 .",
    "our model for this correction is @xmath74 , where @xmath75 and @xmath63 are the effective rest frame wavelengths of @xmath1 and the @xmath76 filter for our fiducial , @xmath66 sed at @xmath77 : @xmath78 and similarly for @xmath63 , although for the latter the redshift of the sn needs to be taken into account .",
    "given the stretch in the observed filter , we adjust the corresponding flux normalization by multiplying it by the ratio : @xmath79 this gives observer - frame flux in each observed filter . there is still only one light - curve shape parameter , @xmath4 .",
    "the stretch function @xmath80 is represented by a spline , and is derived from both external and snls sn  ia data as follows .",
    "we require that at least one of the filters lie within 250  of rest frame @xmath1 in order to ensure that @xmath4 is well determined .",
    "however , in addition to fits to individual filters , we also consider nearest neighbor combinations of the snls filters ( @xmath81 , @xmath82 , and @xmath83 ) , and include the sn if the mean wavelength of these filters meets the above requirement . in these cases @xmath1 is well bracketed , so @xmath4 is also well constrained .",
    "the stretch and ( mean ) rest - frame effective wavelength is recorded for each fit .",
    "the results are shown in figure  [ fig : stretchratio_sb ] .",
    "alhough the relationship between @xmath4 and @xmath73 varies slightly with wavelength , a general trend is apparent : @xmath4 is typically smaller than @xmath73 for small @xmath4 and larger for large @xmath4 .",
    "it is also apparent that the low - z and snls samples probe different ranges in @xmath4 ( with the low - z sample containing more low-@xmath4 sne and the snls sample more high-@xmath4 sne ) .",
    "this is not surprising given expected selection effects and the possibility of an evolving population ( e.g. , * ? ? ?",
    "* ) .    to model the trends , we fit the relation between @xmath4 and @xmath73 using least - squares in @xmath84  wide bins , using a cubic spline with three knot points in @xmath4 smoothly joined to a linear relation at low and high @xmath4 .",
    "each wavelength bin contains 2060 datapoints ; three example bins corresponding to @xmath0 , @xmath85 and @xmath45 are shown in figure  [ fig : stretch_wave ] .",
    "the relationship between @xmath4 and @xmath73 at any intermediate @xmath63 can be found by linearly interpolating the fit coefficients in wavelength .",
    "we do not probe all areas of @xmath86 equally well , with clusters around the low - z filter mean - wavelengths ; this is an area where larger samples of sne  ia will be extremely beneficial .",
    "examples of the derived function are shown in figure  [ fig : stretchfunction ] .",
    "we can test the necessity of this more complex treatment of stretch by applying the sifto model to the photometry from a06 ( see  [ subsec : hizcomparison ] for more details ) .",
    "for the model described above , we find a @xmath87  of 2890 for 2822 degrees of freedom .",
    "if we remove the wavelength dependence of the stretch model the @xmath87  climbs to 3037 , and if we instead use a purely linear model in place of the splines , the @xmath87  is 2935 .",
    "these correspond to a decrease in likelihood by a factor of 70 and 3 , respectively .",
    "however , we note that the cosmological results and the scatter around the best fit are almost identical in all three cases ( @xmath88 mag difference in the rms )",
    ". the lack of improvement in the relative distances can be interpreted as an illustration of the difference between a light - curve fitter and a distance estimator .      the starting point for our base sed model",
    "@xmath68 is an updated version of the time series of spectral templates of h07 which incorporates the additional low - z spectroscopy presented in @xcite .",
    "the procedures of h07 are designed so that the relative strengths of adjacent features are correct , but are not intended to adjust the broadband colors or their evolution with time , so some modification is necessary .",
    "we developed a set of light - curve templates that are used to address this issue .",
    "these templates are purely an intermediate step , and play no role in the fitting process once @xmath68 is determined .",
    "there are many approaches one might use to build the templates . for sifto , we construct a set of synthetic filters and then use sn data to build light - curve templates in each of these filters .",
    "we then adjust @xmath68 to match these templates using interpolating splines as described earlier .",
    "this process requires @xmath6-correcting the observed data points , which are at a variety of redshifts , to the nearest template filter .",
    "since the @xmath6-correction depends on the model sed , this procedure is carried out iteratively .",
    "we follow a fairly standard approach by parameterizing each light - curve template as a set of cubic splines with the knot points tuned by hand to best describe the data ( e.g. , @xcite ) .",
    "the number of knots ranges from 3 ( for poorly constrained filters ) to 8 for the redder filters which have a more complex template .",
    "since cubic splines are used , the templates are only smooth up to first order in the derivatives ; applications which require higher degrees of smoothness should not use sifto . the splines are joined smoothly to a polynomial at early times , and an exponential decay function at late times .",
    "the location of the join can be set for each filter ; generally the early time polynomial joins the splines around epoch @xmath89 , and the exponential tail around @xmath90 , although in some filters this is much lower due to the lack of good late - time data .",
    "the early - time polynomial is of the form @xmath91 , where @xmath92 is the date of zero flux ( i.e. , the date of explosion ) .",
    "therefore , for our template , the colors of the sn at early times are not constant in all cases due to the cubic term .",
    "we require the polynomial coefficients to be positive to ensure that the early time light - curve increases monotonically at early times , which we expect on physical grounds .",
    "linear and quartic terms were not found to improve the fits .",
    "the choice of which filters to construct templates in is fairly arbitrary .",
    "if only low - z data is used for training , then a natural choice would be the landolt @xmath93 filters , redshifted slightly to the mean redshift of the sample .",
    "since we use both low - z and snls data , this is no longer optimal .",
    "we want to make use of information blue - ward of @xmath0 , and it is also useful to insert filters between the more widely spaced landolt filters to make better use of our observations and improve the smoothness of the model .",
    "we use a set of synthetic logarithmically spaced filters between 4800   and 6800  , and also include @xmath1 and @xmath18 .",
    "in addition , we include three bluer filters which are blueshifted and widened versions of the first log filter .",
    "the @xmath1 filter is included to make it easier to compare the resulting template with previous work , and @xmath18 to ensure well - behaved boundary conditions while building @xmath68 .",
    "we do not use the part of the model redder than 7100 when applying sifto to observations because our stretch parameterization is not expected to work well .",
    "the synthetic log filters are denoted as log5 ",
    "log8 , and the three bluer filters are arb0  arb2 . the light - curves in arb0 and arb1 are determined purely by snls data .",
    "our filters are shown in relation to the landolt filters in figure  [ fig : templatefilters ] .",
    "arb2 matches @xmath0 ( but is slightly redder ) , log6 roughly matches @xmath85 , @xmath45 is split up into two narrower filters which are better matches to the snls observations ( log7 and log8 ) , and there is an additional filter between @xmath1 and @xmath85 ( log5 ) . the filters are summarized in table  [ tbl : templateparams ] .",
    "the sifto model should only be used for observations from 2700 to 7100   ( rest frame ) .",
    "we use cubic terms in the early - time polynomials for the arb0 , arb2 , and log5 filters . for arb0 ,",
    "including this term reduces the @xmath87of the template fit to our training sample from 171 for 155 degrees of freedom to 167 . for arb2",
    "the @xmath87  goes from 4613 to 4515 for 1605 degrees of freedom , and for log5 from 2280 for 1004 degrees of freedom to 2001 .",
    "we caution that these @xmath87  values do not incorporate the template error snake as described in ",
    "[ subsec : errorsnake ] , and hence we do not expect the reduced @xmath87  to be close to unity .",
    "it is difficult to evaluate how significant the improvements in the @xmath87  are , since the process of building the error snake involves inflating the errors to take into account the residuals from the model .",
    "however , in the other filters the best fit value of the cubic coefficient is zero .",
    "the procedure of building the templates in each filter is as follows : first , all of the data is fit using sifto with the current version of @xmath68 .",
    "the observed data is @xmath6- and mw - extinction corrected to the best matching template filter , and the timescale is normalized using @xmath21 and the stretch in each filter @xmath73 .",
    "the data points from each sn in each filter are normalized to an arbitrary value in order to remove the colors of the individual sne from the template .",
    "the templates are then fit to the datapoints in each filter , and @xmath68 is adjusted using the spline procedure to match the model .",
    "the procedure is then iterated until convergence , which typically requires @xmath94 iterations .",
    "we also adjust the template so that @xmath95 represents the peak flux in @xmath1 , and adjust @xmath4 so that the mean over our training sample is unity .",
    "it is convenient for our template to have roughly the colors of a fiducial sn  ia . given the asymmetry of the color distribution we use the median color to define these values .",
    "there is no single sn with exactly this color , and if there were it would not constrain all of our template filters . therefore , we take the mean 10% of the sn",
    "closest to the median color to define each color , and use this in the normalization process above . note that this process does not affect the resulting light - curve fits as long as sharp , unphysical gradients are avoided .",
    "changing the colors individually by up to 0.3 mag has no effect on the resulting fits because our procedure adjusts the sed template to match the observed colors .    with the above ingredients , we can write @xmath48 as @xmath96 where @xmath72 is the spline used to make the sed have the desired colors , and not that used to construct @xmath68 .",
    "@xmath97 is uniquely determined by the combination of the @xmath98 products , @xmath68 , and the observed filters .",
    "@xmath48 can then be used to evaluate the flux in any desired filter , and not just those actually observed .",
    "lcrrrrr arb0 & 2689 & 2798 & 529 & @xmath99 & 3 & 12 + arb1 & 3187 & 3206 & 530 & @xmath100 & 4 & 25 + arb2 & 3685 & 3704 & 510 & @xmath100 & 5 & 30 + b & 4413 & 4330 & 893 & @xmath89 & 6 & 50 + log5 & 4784 & 4755 & 497 & @xmath101 & 5 & 41 + log6 & 5382 & 5363 & 559 & @xmath89 & 6 & 48 + log7 & 6055 & 6030 & 628 & @xmath89 & 6 & 50 + log8 &",
    "6812 & 6854 & 707 & @xmath100 & 7 & 47 + i & 8060 & 8008 & 1526 & @xmath100 & 7 & 47 +      sifto incorporates an estimate of the uncertainty in @xmath68 .",
    "this represents both the uncertainty in our modeling process , and , much more importantly , some measure of the intrinsic variability of sne  ia .",
    "salt2 and mlcs2k2 also incorporate an error snake , but some older fitters do not .",
    "the uncertainty in the template is very important when fitting low - z data , where the photometric uncertainties can often be quite small .",
    "it also plays a critical role when evaluating @xmath13and @xmath14  observations of high - z sn , where the model is more poorly constrained .",
    "we tabulate the template error at the wavelengths of each of the template filters in one day bins and then linearly interpolate between these errors in wavelength space to get the error in the sed , which gives us the @xmath62 term in equation  [ eq : lcfit ] .",
    "there are several methods used to derive the error snake , which give similar results .",
    "the most direct approach is to fit all of the sne using sifto , and then determine the additional error that would make the @xmath102 of the data relative to the model be 1 per degree of freedom .",
    "the difficulty with this approach is that at some epochs the measurement errors of individual observations dominate the scatter .",
    "the snls error bars are roughly constant with epoch in flux space because it is a rolling search , but a 10% variation in the template flux at any given epoch is much larger in absolute flux at peak than at late or early times .",
    "therefore , measuring the same relative variation at late times is more difficult , requiring an accurate cancellation of two numbers subtracted in quadrature . compensating for",
    "this fact is the tendency of the template error to be larger in relative terms at late times which partially arises from the fact that we have renormalized the fits to each sn at peak . in order to improve our sensitivity at late and early epochs",
    ", we adopt a slightly modified procedure . in the core of the light curve ( @xmath89 to @xmath103 days )",
    "we use the @xmath87  method directly , but at late and early times we substitute a measure based on the rms , but multiplied by the ratio between the @xmath87  result and the rms as measured in the core .",
    "the results of this procedure are generally quite similar to that of the raw @xmath87  method ( within about @xmath104 ) .",
    "the other method we consider is to use bootstrap - with - replacement to estimate the template errors .",
    "this gives similar results , but the @xmath87  + rms approach is more robust and slightly more conservative in that it gives larger errors ( by @xmath105 on average ) , so we use this for our final model .",
    "the error snake is used iteratively using the template construction process .",
    "some examples are shown in figure  [ fig : errorsnake ] .",
    "since we usually have a large number of observations in each epoch bin for each filter , the formal statistical error in how well we can measure the mean template is much smaller ( @xmath106 times ) than the template error we quote .",
    "some of this is probably due to failures in the photometry , uncertainties in the @xmath6-corrections , and inconsistencies between different samples .",
    "however , looking at any of these in detail ( for example , by considering only data from a single source such as snls , or looking at sn in a narrow redshift range where @xmath6-correction uncertainties are less important in a relative sense ) , none of these effects is the right order of magnitude to explain the observed scatter .",
    "we conclude that sn variability is the dominant factor in the template error , except in our bluest artificial filter where the sample is small .    like salt2 , our error snake does not incorporate off diagonal terms ",
    "i.e. , the residual from the model at a given epoch is assumed to be uncorrelated with nearby epochs .",
    "given the complexity of our model space , the current data set does not provide robust constraints on these terms .",
    "mlcs2k2 , which has a simpler model and does not work with a sed , includes off - diagonal terms with simplifying assumptions .",
    "modeling of systematic errors is becoming increasingly important for sn cosmology .",
    "one issue which has been neglected is that because our sn model is empirically derived from sn data , the effects of the systematics on the model must also be considered in the error budget .",
    "this is important even if no high - z data is used in the training .",
    "an advantage that sifto has over most other light - curve fitters is that the effects of epoch - independent systematics can be studied simply by re - deriving the color relation , rather than having to fully retrain all aspects of the model .",
    "for example , a change in the snls @xmath13zeropoint data does not affect the sed model because during the training process the data from each sn is normalized to an arbitrary level .",
    "it will , however , affect the relation between the measured colors of the sn population .",
    "approaches which fold the modeling of sn colors into the model derivation more directly ( salt / salt2 , mlcs2k2 ) do not have this luxury .",
    "this does not apply to any effect which can change the shape of the light curve , such as uncertainties in the filter responses .",
    "however , in most cases these are second order effects compared with the changes in the derived color relation .",
    "this makes systematic analysis with sifto comparatively easy .",
    "our training sample consists of photometry for nearby sne  ia from the literature as well as high - redshift snls observations .",
    "the low - z data generally has higher signal - to - noise ratios , but are also much more heterogeneous .",
    "more importantly , the snls data offers considerably better wavelength coverage than the low - z sample , both in the near - uv and between the standard landolt filters .",
    "furthermore , the rest - frame @xmath0 band data from snls is better calibrated and more reliable than that from the low - z data .",
    "the photometric references of the 72 low - z sne used in this paper are given in table  [ tbl : lowzsample ] .",
    "we have not included sub - luminous ( sn 1991bg - like ) sne  ia in our sample because they are not well represented by our base sed , and have excluded extremely peculiar sne such as sn 2002cx @xcite .",
    "furthermore , we have not included all of the available photometry for every sn . in cases where photometry is available from multiple sources",
    ", we compare the light - curves from multiple bands and , if they are not consistent , choose some subset of the sources .",
    "we try to choose the photometry that has the best coverage , or that from the data source with the most other sne ( i.e. , we prefer observations from a large sample like @xcite ) .",
    "we also exclude individual bands on a sn by sn basis where the photometry seems to be internally inconsistent or has additional problems ( e.g. , the @xmath0 band data for sn 1999ee ) .",
    "in addition we use 98 high - redshift snls sne from the first three years of the survey .",
    "our training process requires that the peak of each observed filter be fairly well constrained so that we can re - normalize the light - curves accurately , a necessity since we do not impose a color relation during the training process or fits .",
    "therefore , to use an individual bandpass for a sn , we require that it have at least one datapoint within 5 rest - frame days of maximum .",
    "this requirement is far more stringent than is necessary to carry out a cosmological analysis , so less than half of our high - z data are used in the training process .",
    "we use only sne with firm spectroscopic identification .",
    "the h07 template makes use of snls spectra , which are particularly critical when constraining the near - uv sed . as was the case for the low - z sample ,",
    "we exclude sne which are known to be unusual , such as the super - chandrasekhar mass 03d3bb @xcite .    for snls",
    ", we adopt the radially - dependent sagem filter scans for the megacam filters , corrected for the f/4 converging beam and incorporating the mauna kea extinction curve at the mean survey airmass of 1.2 .",
    "a06 used radially averaged versions of these scans . for the low - z data we adopt the @xcite realization of the landolt filter functions .",
    "ideally we would have natural system magnitudes and bandpasses for all of the low - z photometry , but this information is generally not available .",
    "hopefully this will not be the case for future low - z data sets .",
    "currently we do not implement any airmass dependence in our assumed filter functions , since tests show that this is negligible in comparison with the other bandpass uncertainties .",
    "lll 1981d & @xmath29 & h91 + 1986 g & @xmath29 & p87 + 1989b & @xmath29 & w94 + 1990n & @xmath29 & l98 + 1990o & @xmath107 & h96 + 1990af & @xmath107 & h96 + 1992ae & @xmath107 & h96 + 1992al & @xmath108 & h96 + 1992bc & @xmath108 & h96 + 1992bg & @xmath109 & h96 + 1992bh & @xmath109 & h96 + 1992bl & @xmath107 & h96 + 1992bo & @xmath108 & h96 + 1992bp & @xmath109 & h96 + 1992br & @xmath107 & h96 + 1992bs & @xmath107 & h96 + 1993b & @xmath107 & h96 + 1993h & @xmath108 & h96 , a04 + 1993o & @xmath109 & h96 + 1993ag & @xmath107 & h96 + 1994 m & @xmath108 & r99 , a04 + 1994s & @xmath109 & r99 + 1994ae & @xmath108 & r05 , a04 + 1995d & @xmath108 & r99 + 1995e & @xmath108 & r99 + 1995ac & @xmath108 & r99 + 1995al & @xmath108 & r99 + 1995bd & @xmath108 & r99 , a04 + 1996c & @xmath108 & r99 + 1996x & @xmath93 & r99 , s01 + 1996ab & @xmath107 & r99 + 1996bl & @xmath108 & r99 + 1996bo & @xmath108 & r99 + 1997e & @xmath93 & j06 + 1997bp & @xmath93 & j06 + 1997dg & @xmath93 & j06 + 1997do & @xmath110 & j06 + 1998v & @xmath93 & j06 + 1998aq & @xmath93 & r05 + 1998bu & @xmath93 & j99 , s99 + 1998dx & @xmath29 & j06 + 1998es & @xmath93 & j06 + 1999aa & @xmath93 & j06 , a04 , k00 + 1999ac & @xmath93 & j06 + 1999aw & @xmath108 & s02a + 1999cc & @xmath110 & j06 , k06 + 1999cl & @xmath107 & j06 , k06 + 1999dk & @xmath111 & k01 , a04 + 1999dq & @xmath93 & j06 + 1999ee & @xmath108 & s02b + 1999ek & @xmath108 & j06 , k04 + 1999gd & @xmath110 & j06 + 1999gp & @xmath111 & j06 , k01 + 2000ca & @xmath93 & k04 + 2000cn & @xmath93 & j06 + 2000dk & @xmath111 & j06 + 2000fa & @xmath93 & j06 + 2001v & @xmath110 & v03 , l06a + 2001ba & @xmath109 & k04 + 2001bt & @xmath108 & k04 + 2001cn & @xmath108 & k04 + 2001cz & @xmath108 & k04 + 2001el & @xmath108 & k03 + 2002bf & @xmath108 & l05 + 2002bo & @xmath108 & k04 + 2002er & @xmath110 & p04 + 2003cg & @xmath93 & er06 + 2004s & @xmath93 & k07 + 2004eo & @xmath93 & p07b + 2004fu & @xmath107 & t06 + 2005am & @xmath9 & l06a + 2005cf & @xmath93 & p07a + [ tbl : lowzsample ]",
    "the light - curve templates can be seen in figure  [ fig : templatefits ] . the different manner",
    "in which the snls and low - z data sets sample wavelength space is clear  only the snls data offer any constraints blue - ward of @xmath0 ( arb0 and arb1 ) , and the wavelength region between @xmath1 and @xmath85 ( log5 ) and @xmath85 and @xmath45 ( log7 ) , while the nearby data provide most of the constraints in @xmath112 .",
    "however , in the filters where substantial coverage is provided by both sets ( log3 , @xmath1 , log6 ) , the agreement is impressive .",
    "in addition , the homogeneity of sne  ia light curves is also apparent . note that in the @xmath18 band extensive culling has been performed because many sn do not match the template .",
    "this is acceptable because we are only including @xmath18 to ensure well behaved boundary conditions , and do not use this part of the model directly when applying the model to sn observations .",
    "example fits to high and low redshift snls sne are shown in figures  [ fig : example_one ] and [ fig : example_two ] ( the same sn were used as examples in g07 ) .",
    "the parameters of the color relations used to determine parameter @xmath27  ( equation  [ eq : colorrelation ] ) are given in tables  [ tbl : colorparams ] and [ tbl : colorparams02 ] , and the @xmath30 and @xmath40 relations shown in figures  [ fig : colorparams ] and [ fig : colorparams02 ] . the @xmath30 relation is derived from 72 snls and 33 low - z sne , and the @xmath40 relation from 63 snls sne . here , because there are few sne with both @xmath85 and @xmath38 measurements , we include data with no rest - frame @xmath85 observations by using their @xmath30 colors to predict @xmath28 , incorporating the additional uncertainty due to @xmath34 and the appropriate covariances .",
    "the requirements to be included in the color relation fit are less stringent than those required to be used when measuring @xmath68 since we do not require that the fits to each filter be strongly constrained in isolation .",
    "the primary limitation is instead that most sne do not have simultaneous measurements of @xmath30 and @xmath28 .",
    "carrying out this test with salt2 gives similar values for the @xmath34 parameters .",
    "it is interesting to consider the residuals from the @xmath30 versus @xmath28 relation .",
    "the slope of the dominant relation is clearly inconsistent with that expected from extinction . however , there are a number of outliers that are displaced in a direction that could be explained by extinction .",
    "this leads us to hypothesize that the color relations for the majority of sne in our sample are dominated by intrinsic effects , with a minority instead dominated by dust .",
    "following g07 , we can get some feel for how useful extending the model blue - ward of @xmath0 is be comparing measurements of @xmath27  if the model is cut at different wavelengths .",
    "this is shown in table  [ tbl : uveffects ] for 04d3cy ( @xmath113 ) and 04d3gx ( @xmath114 ) .",
    "the errors include statistical uncertainties , template errors , and @xmath6-correction errors as described in h07 .",
    "the benefits for the higher redshift sn are clear .",
    "lrr @xmath115 & 0.352 & 0.049 + @xmath116 & 0.218 & 0.064 + @xmath117 & @xmath1180.051 & 0.007 + @xmath34 & 0.055 & 0.005 + @xmath115 & 0.435 & 0.067 + @xmath116 & 0.302 & 0.076 + @xmath117 & @xmath1180.067 & 0.008 + @xmath34 & 0.044 & 0.006 + @xmath115 & 0.259 & 0.090 + @xmath116 & 0.145 & 0.132 + @xmath117 & @xmath1180.037 & 0.016 + @xmath34 & 0.071 & 0.011 +    lrr @xmath119 & 0.121 & 0.050 + @xmath120 & 0.172 & 0.138 + @xmath42 & @xmath1180.110 & 0.027 + @xmath43 & 0.050 & 0.008 +    llrlll 3980  & @xmath17@xmath16 & @xmath121 & 0 & 0 & 1 + 3250  & @xmath14@xmath17@xmath16 & @xmath122 & 0 & 0.69 & 0.31 + 2700  & @xmath13@xmath14@xmath17@xmath16 & @xmath123 & 0.43 & 0.40 & 0.18 + 3980  & @xmath17@xmath16 & @xmath124 & 0 & 1 & 0 + 3250  & @xmath14@xmath17@xmath16 & @xmath125 & 0 & 1 & 0 + 2700  & @xmath13@xmath14@xmath17@xmath16 & @xmath126 & 0.60 & 0.40 & 0.00 +    the stretch is only defined relative to some fiducial template , and does not have any independent meaning when comparing different fitters , or even different versions of the same fitter . instead",
    ", a variable like @xmath2 can be used which has a more physical definition .",
    "is the amount in magnitudes which the @xmath1 band light curve has dimmed 15 rest frame days after peak .",
    "] however , in practice , because light - curve fits are relatively insensitive to the exact shape of the light - curve template near peak , even @xmath2 is somewhat ambiguous , and will change when the light - curve model is updated .",
    "therefore , we simply provide the relation between @xmath2 and @xmath4 for our template : @xmath127 this relation should _ not _ be used for precision work , such as attempting to combine data fit with different packages .      for the @xmath30 color relation , we can split the sample into low - z and snls data as a test of sn evolution .",
    "this results in the values given in table  [ tbl : colorparams ] .",
    "there is some tension between the values .",
    "however , this only includes statistical errors , and systematics are expected to be of similar importance .",
    "the details of our systematics analysis will be presented with our cosmological results elsewhere , but it is useful to summarize some of the more important contributions .",
    "the most important uncertainties arise from the uncertainty in the magnitudes of our flux standard ( vega ) on the landolt system ( which affect our @xmath6-corrections ) and the uncertainty in the calibration of the low - z data .",
    "the former are dominated by the raw observational uncertainties of vega from @xcite . to determine how well calibrated the low - z data is to the landolt system , we compare photometry of the same sne obtained by different observers , and conclude that there is a global zeropoint uncertainty of about 0.015 mag in @xmath107 for each survey .",
    "for @xmath0 the situation is more complicated . as noted previously ,",
    "observer frame @xmath0 data is more difficult to calibrate than @xmath107 , so we double this value to 0.03 mag in this filter .",
    "however , as it turns out the @xmath1 zeropoint uncertainty dominates over @xmath0 , at least partially because it affects both @xmath30 and @xmath28 .    in order to test the effects of these systematics",
    ", we adjust the relevant parameter ( e.g.  the @xmath0 zeropoint ) , then re - derive the sifto model and color relations .",
    "we then consider the change in @xmath128 to be the resulting systematic in @xmath115 , etc .",
    "for the uncertainties in the magnitude of vega , we find @xmath129 and @xmath130 .",
    "we do not include @xmath34 because its value is likely to simply test the homogeneity of the data sample rather than be a good test for evolutionary effects .",
    "for the zeropoints of the low - z data , we find @xmath131 and @xmath132 .",
    "other , smaller , contributions include the uncertainty in the megacam and landolt bandpasses and the megacam zeropoints .",
    "the latter is particularly important for @xmath116 , giving @xmath133 for sub-1% zeropoint uncertainties .    putting this information together",
    ", we conclude that @xmath134 , @xmath135 , and @xmath136 .",
    "the resulting @xmath87  is 4.57 for 3 degrees of freedom , which is expected to occur by random chance in the case of no evolution 21% of the time .",
    "[ sec : daygap ] one question we can ask of our model is whether or not it can predict the peak luminosity of the sn when we have no observations at that epoch .",
    "that is , how well can our model extrapolate from late time observations to the peak ? in principle , the template error snake should allow us to handle situations where there is little or no data near peak , since the result will simply be a measurement with very large errors .",
    "however , the error snake is not known perfectly , so we would like to test this statement .",
    "most sn cosmology analyses have required that sne have data near peak , but the exact value used for this cut varies from paper to paper and is usually not explained . the previous generation of sn fitting packages , which often did not incorporate template errors , frequently produce implausibly precise results when used in this situation .",
    "our test is based on real observations ; a test on simulated data is currently likely only to be useful as an internal consistency check .",
    "we collect a sample of very well sampled , high - s / n light - curves with data well before peak , and then , for each sn , compare the results of the fits to all of the available data to those where we steadily remove more and more photometry from around the peak .",
    "we parameterize this by the daygap , defined as the epoch of the first included point relative to the date of @xmath1 maximum , and explore the range from @xmath1185 to + 15 days .",
    "our sample consists of the 11 low - z sne : 1992a , 1995d , 1999aa , 1999dq , 1999ee , 2000e , 2002bo , 2002er , 2003du , 2004eo , and 2005cf .",
    "even these sne generally do not have data before day @xmath11810 , which is why we have not tried to answer the complementary question of how well our model can predict the peak magnitudes of sne  ia if we only have pre - maximum observations .",
    "there are two things we want to test : that the results are unbiased , and that the errors reflect the missing data appropriately . for the latter ,",
    "we compare the @xmath87  of the difference between the light - curve parameters for the full light - curve , and for those at various values of the daygap .",
    "since the different fits to the same sn should be positively correlated , we will probably slightly over - estimate our errors .",
    "this test is sensitive to small calibration difficulties that arise when different telescope / detector systems observe different parts of the light - curve , which is frequently the case with low - z data .",
    "this will artificially inflate the differences .",
    "therefore , the precise value should not be taken too seriously ; what we are looking for are sharp changes in the @xmath87 .",
    "the most important parameter to test is @xmath137 as defined in equation  [ eqn : mbcorr ] , which is used to construct the hubble diagram .",
    "rough numerical simulation suggests that bias values larger than about 0.02 are significant .",
    "most of the variables show relatively little structure in their @xmath87 , so we only present the two given in figure  [ fig : daygap ] .",
    "first , the @xmath87  of the peak magnitude in @xmath1 rises sharply around day 510 after peak .",
    "second , while this effect is also visible for @xmath137 , the effects are slightly muted .",
    "our tests show little evidence for bias in the corrected peak magnitude .",
    "based on the @xmath87-like test , a good policy is to require data within @xmath19 days of peak when using sifto .",
    "note that the accuracy of the derived parameters does degrade considerably as the daygap is increased in all parameters ( see the bottom of figure  [ fig : daygap ] ) , so sne with no data near peak will contribute relatively little information to the hubble diagram .",
    "we carry out the same test with other fitters in  [ subsec : lowzcomparison ] , and find generally similar results .",
    "in this section , we compare the results of sifto with those of other fitters , particularly the published versions of salt and salt2 . our main focus will be on comparisons of sifto , salt2 , etc .",
    "when they are used as distance estimators rather than as light - curve fitters .",
    "there are a number of non - sn related settings that affect this comparison ( i.e. , the assumed filter response of the landolt filters , etc . ) , so this comparison is not entirely fair . in   [ sec : retrain_compare ] we present the results when these differences are removed which provides a much more accurate test of how different the results of the fitters really are .",
    "we discuss mlcs2k2 in a more limited fashion in this section , keeping in mind the following limitations : first , mlcs2k2 makes use of a number of priors which should be accounted for in any detailed comparison , and which in principle should be modified for the particular data set under consideration .",
    "second , it fits in magnitude space , which will introduce a bias when comparing low signal - to - noise data .",
    "finally , the current version of mlcs2k2 does not properly handle the case where more than one observed filter maps to the same rest frame landolt filter .",
    "this limits the sample size that can be compared using snls data .",
    "we also consider comparisons of the hubble diagram .",
    "all of the fitters require that some additional uncertainty be added to the luminosity distances when computing the best - fit cosmology .",
    "this is often referred to as `` intrinsic scatter '' or `` intrinsic dispersion , '' and presumably reflects our imperfect understanding of sn  ia .",
    "we denote this quantity by @xmath138 , and find @xmath139 mag for sifto . comparing the values of @xmath138  for the different fitters",
    "is _ not _ currently a useful mechanism for comparison .",
    "the issue lies with the limitations of the template error snakes , which are difficult to determine and are very sensitive to how accurate the input flux errors are measured .",
    "in addition , currently both sifto and salt2 do not include off - diagonal terms in the error snake ( i.e. , different epochs are considered uncorrelated ) , an assumption which is clearly not true .",
    "this is particularly an issue for salt2 , which imposes the color relation during the fits .",
    "both effectively absorb this unknown into @xmath138 , and there is no reason to expect this to affect both equally . therefore we limit ourselves to the more robust comparison of the rms of the resulting hubble diagram .",
    "however , the rms also includes the effect of measurement errors , so is only useful as a comparison statistic if precisely the same set of input data are used for all fitters .",
    "a complication is that there is considerable overlap between the data used to measure the rms and that used to derive the sifto model ; the same issue applies to salt2 , mlcs2k2 , and ( to a lesser extent ) salt .",
    "however , we note that sifto / salt / salt2 make absolutely no use of relative distance information as part of the training process .",
    "we begin by comparing salt2 and sifto as light - curve fitters  that is , in terms of how well they fit the available photometry rather than in terms of the precision of their relative distances . here",
    "we do have the problem that the training process is specifically designed to reduce the scatter of the input photometry with respect to the model , so it is beneficial to train and test the models with disjoint data sets .",
    "we have carried this process out for sifto by randomly splitting the training sample in half ( giving about 90 sne for both testing and training ) , training a set of templates on the first half , and then applying that model to the second half .",
    "we then look at the residual between the model and input flux normalized so that the predicted peak flux in each filter is unity .",
    "because this includes observational errors , we split this up into redshift bins ( @xmath140 ) . in order to mitigate photometry failures ,",
    "we sigma - clip the residuals at @xmath141 for both fitters .",
    "the results are shown for salt2 and sifto in figure  [ fig : lcrms ] using the same photometry .",
    "this comparison is unfair in two ways : first , the splitting into disjoint training and testing samples has not been carried out for salt2 .",
    "second , the sifto model has more free parameters since a color relation is not imposed during the fitting process . nonetheless , the two fitters give comparable results .",
    "the different light - curve fitters generally agree quite well on the derived light - curve parameters , particularly when the mcls2k2 priors are removed .",
    "examples are shown in figures  [ fig : stretch_compare ] and [ fig : colour_compare ] .",
    "we generally do not expect perfect agreement between the different light - curve parameters , but only that there be a clear relation between the values .",
    "this is particularly true when discussing measures of the light - curve shape , which are defined very differently , and sn color , which can have an arbitrary offset related to the intrinsic color of the fiducial sn  ia .",
    "the data set for this comparison is 78 low - z sne from the literature , using the same general requirements as were used in @xcite , although the sample here is larger because we can include sne which are not in the smooth hubble flow .",
    "the derived parameters are clearly quite correlated between the different fitters , although there are a number of outliers in each relation .",
    "the @xmath5 comparison is consistent at about the 1% level globally , and since for most purposes only the relative distances matter , this is encouraging .",
    "next we turn to the rms around the low - redshift hubble diagram .",
    "we take the above sample , remove all sne with @xmath142 , and then fit the hubble diagram assuming @xmath143 and @xmath144  the exact values are unimportant because of the limited redshift range of our test sample .",
    "the rms values and @xmath138  are given in table  [ tbl : lowzvals ] .",
    "mlcs2k2 is not included in this test because of complications related to the interpretation of sn colors , which in turn is related to the question of whether or not the low - z hubble flow is really smooth or has a hubble bubble , something that mlcs2k2 favors and the other fitters do not @xcite . since we do not include a bubble in our test , this will tend to artificially inflate the rms for mcls2k2 .",
    "however , we do perform the test using a larger data set below , where this issue is mitigated by a larger , higher - redshift sample .",
    "lll salt & 0.156 & 0.134 + salt2 & 0.158 & 0.129 + sifto & 0.155 & 0.119 +    we find that the three fitters perform equally well on this data set .",
    "this is simultaneously encouraging and discouraging ; it gives us confidence in the different fitters , but at the same time suggests that it is not easy to significantly improve the quality of the distance estimates for sn  ia beyond the @xmath145 level without some improvement in the training data set .",
    "interestingly , when we perform the same comparison with high - z sne , salt2 and sifto do considerably better than salt .    finally , we can test the other fitters to see how well they fare if there are no data near peak , using the same method and set of 11 sne as in   [ sec : daygap ] .",
    "it is particularly interesting to consider salt , which alone among those discussed here does not have a template error snake .",
    "the bias values are shown in figure  [ fig : daygap_bias ] and the @xmath87-like test results in figure  [ fig : daygap_compare ] .",
    "mlcs2k2 performs the best in the @xmath87-like test , which is also true for the individual fit quantities .",
    "mlcs2k2 and salt display some bias even for low values of the daygap .",
    "one possible explanation is that both fitters would benefit from some improvement in their pre - maximum light - curve model .",
    "we note that salt does quite poorly in the @xmath87-like test , as expected .",
    "furthermore , we obtain similar results when we do not use the template error snake in sifto .",
    "the real lesson is then that including template errors plays a critical role in obtaining reliable fits when there are no data near peak .",
    "[ subsec : hizcomparison ] it is also interesting to compare the results of fits to high - redshift snls data .",
    "we first compare sifto to the published versions of salt and salt2 . because we can apply each fitter to the same photometry , again the best comparison statistic is the rms of the resulting hubble diagram around the best fit .",
    "the alternatives all have problems . in particular",
    ", comparing the resulting errors on the cosmological parameters is a badly flawed metric unless the fits are virtually identical , given the non - linearity of the parameter space .",
    "an additional complication occurs if the constraint contours impinge on a physically prohibited region , such as @xmath146 .",
    "tests with synthetic data sets are perhaps useful as an internal consistency check , but we do not currently understand sne  ia well enough for them to have any absolute meaning .    for this set",
    "we start with the set used in a06 and modify it slightly .",
    "we removed two sne without solid spectroscopic type identification ( 04d2iu and 04d3is ) , one with photometry problems ( 03d4cn ) , and one which is probably sn 1991bg - like , and hence not well represented by any of the models ( sn 1992bf ) .",
    "we also removed a number of sne whose light - curves are poorly sampled ( sne 1997y , 1998eg , 03d3bh , 03d4gl , 04d1ag ) .",
    "finally , we added two low - z objects , sne 2001v and 2002bf .",
    "this leaves us with a sample of 43 nearby sne and 65 high - redshift ones .",
    "we carry out three cosmological fits for each : a flat - universe @xmath147fit , a @xmath147  + @xmath148  fit , and a flat - universe @xmath147 + @xmath149 fit . for the latter ,",
    "we incorporate the sdss baryon acoustic oscillations ( bao ) measurements of @xcite , since these are marvelously orthogonal to the sn constraints .",
    "the results are given in table  [ tbl : rmsvalues ] .",
    "a bootstrap analysis indicates that the error in the rms for this sample is @xmath150 mag . from the perspective of the rms test , sifto and salt2",
    "are indistinguishable , and both considerably outperform salt .",
    "we also demonstrate the effects of not incorporating the @xmath38 filter in sifto , which worsens the rms values at approximately the @xmath151 level .",
    "we note that the benefits of extending the model bluer than @xmath0 are greater for the third year snls sample than are shown here .",
    "this is probably a result of the fact that the @xmath16  exposure times have been increased , so our @xmath152 sne now have better measurements of @xmath5 and hence have increased weight in our fits .",
    "the rms including high - z data is slightly worse than if only low - z sne are used , which simply reflects the larger observational errors of the distant sample .",
    "lll + flat @xmath147 & 0.161 & @xmath153 + @xmath147 + @xmath148 & 0.160 & @xmath154 + & & @xmath155 + flat @xmath147 + @xmath149 & 0.161 & @xmath156 + & & @xmath157 + flat @xmath147 & 0.171 & @xmath158 + @xmath147 + @xmath148 & 0.170 & @xmath159 + & & @xmath160 + flat @xmath147 + @xmath149 & 0.172 & @xmath161 + & & @xmath162 +   + flat @xmath147 & 0.187 & @xmath163 + @xmath147 + @xmath148 & 0.187 & @xmath164 + & & @xmath165 + flat @xmath147 + @xmath149 & 0.188 & @xmath166 + & & @xmath167 +   + flat @xmath147 & 0.160 & @xmath168 + @xmath147 + @xmath148 & 0.160 & @xmath169 + & & @xmath170 + flat @xmath147 + @xmath149 & 0.160 & @xmath171 + & & @xmath172 +    some of the resulting constraints are shown in figure  [ fig : fittercompare ] .",
    "we see that some differences remain between the fitters .",
    "we shall turn to the question of whether this reflects significant differences between the models in  [ sec : retrain_compare ] .",
    "a weakness of the rms as a test statistic is that it is sensitive to outliers .",
    "including @xmath173 iterative outlier rejection does not appreciably change the results .",
    "we can perform a more limited version of this test including mlcs2k2 , although given the caveats given earlier this is somewhat less certain and has a smaller sample size .",
    "we obtain the results of mlcs2k2 fits to the a06 photometry from @xcite .",
    "this is a subset of the full data set , with about 93 sne in total .",
    "we therefore limit the salt , salt2 , and sifto fits to the same sample .",
    "we do not include the essence sne in this test . carrying out a similar analysis as the above ,",
    "the rms for salt is 0.179 mag , for salt2 0.159 mag , for sifto 0.160 mag , and for mlcs2k2 0.205 mag .",
    "as noted for the low - z comparison , the mlcs2k2 value is somewhat inflated by the issue of the hubble bubble .",
    "if we approximately remove this effect by hand , the rms for mlcs2k2 is about 0.19 mag , so we conclude that its rms is similar to salt . adjusting the priors to better match the survey properties of snls might improve the performance of mlcs2k2 .",
    "it will be interesting to perform this comparison again once the issues surrounding sn colors have been resolved .",
    "the differences between the salt2 and sifto results on the a06 photometry reflect not only differences in the underlying model but also a variety of incidental settings , many of which are not related to sne at all .",
    "while these differences are interesting , and play a role in the systematics error budget of our final result , here they simply obscure what we really want to know : what effect do the differences in approach have on the cosmological parameters ?    we can try to answer this question better by using the same non - sn related settings for both fitters ( filter functions , the magnitudes of vega on the landolt system , etc . ) .",
    "the published version of salt2 was trained on the set of snls photometry available at the time using the megacam calibration of a06 .",
    "there are now more snls sne available , and the calibration has been improved .",
    "we can further enhance the comparison by training both fitters on exactly the same low - z and snls photometry , using the same filter functions assumed by salt2 in sifto , and adding the additional low - z sne provided by t.  matheson to salt2 .    carrying out this prescription",
    ", we obtain the results in table  [ tbl : retrain_rmsvalues ] and figure  [ fig : fitterretraincompare ] . the results substantially closer to each other .",
    "this is very encouraging , and suggests that in terms of the cosmological results the two approaches agree very well .",
    "lll + flat @xmath147 & 0.159 & @xmath174 + @xmath147 + @xmath148 & 0.161 & @xmath175 + & & @xmath176 + flat @xmath147 + @xmath149 & 0.160 & @xmath177 + & & @xmath178 +   + flat @xmath147 & 0.159 & @xmath179 + @xmath147 + @xmath148 & 0.160 & @xmath180 + & & @xmath181 + flat @xmath147 + @xmath149 & 0.160 & @xmath182 + & & @xmath183 +",
    "we have described sifto , a light - curve analysis package developed for use with snls data . it is most similar in spirit to salt / salt2 : all three work by adjusting a model of the sed rather than with templates in some rest - frame filters , and , like salt2",
    ", sifto includes high - z snls data in the training process .",
    "this allows us to extend our model blue - ward of the rest - frame @xmath0 , which is extremely valuable when fitting high - z sne .",
    "distances and residuals from the hubble relation are not used in our training process , so this is not dependent on the cosmological parameters .",
    "the model can be applied to observations from 2700 to 7100   in the rest frame .",
    "the greatest difference between salt / salt2 and sifto is the manner in which sn colors are handled .",
    "sifto does not impose a color model during the actual light - curve fit , but instead adjusts the sed to match the observer frame colors .",
    "the sed is then used to measure various rest - frame colors , and these are combined to form a single color parameter @xmath27 . the relation used to combine measurements",
    "is derived using sne at intermediate and low redshifts where each of the colors are well measured .",
    "the advantages of extending the model further towards the near - uv , made possible by including hi - z data , are significant .",
    "this is an argument in favor of the light - curve fitter class of packages ( such as salt , salt2 , and sifto ) versus distance estimators , which can not incorporate high - redshift data as easily .",
    "we find that sifto produces the most reliable results when photometry is available within 7 rest frame days of the @xmath1 peak , and data prior to peak is not necessary .",
    "the same result applies to the other fitters as well .",
    "including a template error in the model is particularly important when there are no data near peak .",
    "we have carried out a number of tests comparing sifto to other packages .",
    "we find that salt , salt2 , sifto , and mlcs2k2 agree fairly well in terms of the derived light - curve parameters when the full sn sample is considered . in terms of their performance on the hubble diagram , for low - z data salt , salt2 , and sifto",
    "are comparable . however , when the test is extended to higher redshifts , sifto and salt2 out - perform salt , and sifto performs as well as salt2 , while mlcs2k2 performs about as well as salt .",
    "these comparisons show that there are real , although small , differences in the derived cosmological parameters from each when they applied to the same photometry . if we train sifto and salt2 using the same non - sn related settings and photometry , we find that the differences are much smaller .",
    "this indicates that , for currently available data , the fundamental differences between the salt2 and sifto models are minor despite the significant differences in approach and algorithmic design .",
    "the authors would like to thank saurabh jha and adam riess for making mlcs2k2 available , as well as for a number of useful discussions .",
    "we would also like to thank tom matheson for providing additional low - z spectroscopy prior to publication , and the anonymous referee for many useful comments .",
    "m.  s.  acknowledges support from the royal society ."
  ],
  "abstract_text": [
    "<S> we present sifto , a new empirical method for modeling type  ia supernovae ( sne  ia ) light curves by manipulating a spectral template . </S>",
    "<S> we make use of high - redshift sn data when training the model , allowing us to extend it bluer than rest frame @xmath0 . </S>",
    "<S> this increases the utility of our high - redshift sn observations by allowing us to use more of the available data . </S>",
    "<S> we find that when the shape of the light curve is described using a stretch prescription , applying the same stretch at all wavelengths is not an adequate description . </S>",
    "<S> sifto therefore uses a generalization of stretch which applies different stretch factors as a function of both the wavelength of the observed filter and the stretch in the rest - frame @xmath1 band . </S>",
    "<S> we compare sifto to other published light - curve models by applying them to the same set of sn photometry , and demonstrate that sifto and salt2 perform better than the alternatives when judged by the scatter around the best fit luminosity distance relationship . </S>",
    "<S> we further demonstrate that when sifto and salt2 are trained on the same data set the cosmological results agree . </S>"
  ]
}