{
  "article_text": [
    "observations show that giant molecular clouds ( gmcs ) in local group galaxies convert at most a few percent of their mass into stars per cloud crossing time @xcite , and that clouds are typically destroyed in a few crossing times @xcite , well before they have converted a significant fraction of their mass into stars .",
    "observations also strongly support the idea that gmcs are gravitationally bound @xcite ,",
    "so the fact that they survive for more than a crossing time yet do not collapse entirely into stars strongly suggests that internal feedback plays a dominant role in gmc evolution .",
    "hii regions driven by newly - formed massive stars are likely to be the dominant sources of energy injection and mass loss in clouds , and are therefore critical to gmc evolution @xcite .",
    "@xcite show using semi - analytic models that feedback from hii regions can quantiatively reproduce the observed lifetime , star formation rate , and star formation efficiency of gmcs . however , these calculations rely on simple analytic solutions for the evolution of spherically - symmetric hii regions in non - magnetic gas .",
    "understanding the detailed evolution of gmcs will require a considerably more sophisticated numerical approach , and for this reason three - dimensional simulation of the evolution of molecular clouds under the influence of internal sources of ionizing radiation is a critical problem in numerical astrophysics .",
    "in this paper we have the dual purpose of presenting a new algorithm for simulation of hii regions in molecular clouds , and using this algorithm to explore potential computational problems that arise in general for simulations of this type .",
    "we also demonstrate our new algorithm in a simple application , the expansion of an hii region into a uniform neutral gas in which the magnetic pressure greatly exceeds the thermal pressure , as it does in molecular clouds . in the past year",
    "several authors have considered the problem of simulating hii regions , and presented both algorithms ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) and results on the evolution of hii regions in turbulent hydrodynamic media @xcite .",
    "for a recent review see @xcite .",
    "several authors have also presented methods for simulation of ionizing radiation - hydrodynamics ( irhd ) in a cosmological context ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) , which differs from the problem in the context of present - day molecular clouds primarily in the amount of cooling to which the gas is subjected and the conditions of the gas before it is ionized . finally , researchers studying the evolution of ultracompact hii regions planetary nebulae have presented algorithms and results for ionizing radiative transfer with hydrodynamics and magnetohydrodynamics in 2d and 3d under the simplifying assumption that the ionized gas has a perfectly sharp edge and is always in thermal and ionization equilibrium ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "our algorithm improves on previous work in that it is the first to couple ionizing radiative transfer to magnetohydrodynamics ( irmhd ) without imposing an assumption of thermal or ionization equilibrium .",
    "the inclusion of magnetic fields is important because observations indicate that the magnetic energy in molecular clouds is comparable to the kinetic and gravitational potential energies @xcite .",
    "thus , dynamical expansion of ionized regions may be significantly altered by magnetic confinement , an effect we wish to explore .",
    "indeed , we show that even in the simple case of expansion of an hii region into a uniform , magnetized medium , the magnetic field produces qualitatively new phenomena",
    ". the alfven speeds of a few km s@xmath0 typically found in molecular clouds reduce the strength of shocks associated with expanding ionization fronts at early times , and at later times turn off the shocks entirely , greatly reducing the collection of gas and possibly thereby reducing the amount of triggered star formation .",
    "a non - equilibrium treatment of the ionization structure is important because we find that a non - equilibrium treatment of the thermal and ionization structure of the ionized gas leads to modest but significant effects on quantities such as the expansion rate of hii regions , effects that are lost in the assumption of perfect radiative equilibrium .    before exploring these new phenomena , however ,",
    "we point out that there has yet to be a detailed study of potential computational problems and constraints that arise in 3d simulations of irhd and irmhd with the strong cooling and large temperature contrasts that are expected for modern day ( as opposed to primordial ) interstellar chemistry .",
    "we have therefore performed a detailed comparison of simulations using our method to analytic solutions for computationally challenging problems , as a way of searching for potential difficulties that may arise in general irhd methods .",
    "we discover several conditions that a simulation must satisfy to reproduce analytic results correctly .",
    "one must limit the amount by which the gas pressure is allowed to change between hydrodynamic updates , for a ray - tracing method one must periodically rotate the orientation of the rays , and one must either resolve the ionization front or restrict the rate of cooling at the front to suppress excess cooling due to numerical mixing .",
    "we show that failure to meet these conditions produces quantitatively incorrect results .",
    "the remainder of this paper proceeds as follows . in   [ formulation ]",
    "we describe the physical formulation of the problem that we adopt , including our approximations and assumptions . in   [ algorithm ] we present our simulation algorithm . in   [ tests ] we compare our code to analytic solutions , and thereby demonstrate the existence of conditions that numerical methods must satisfy in order to reproduce analytic solutions correctly .",
    "we use our method to simulate the evolution of hii regions in magnetized media in   [ mhdresults ] , and finally we summarize and present conclusions in   [ conclusion ] .",
    "we wish to simulate the evolution of a magnetized molecular gas subjected to an ionizing radiation field due to point sources within it .",
    "the @xmath1 sources of ionization are located at positions @xmath2 , and each has an ionizing luminosity of @xmath3 , in units of photons per unit time above the lyman limit .",
    "we treat the ionizing sources as monochromatic , and assume that they emit all their ionizing photons at frequencies near the ionization threshhold of hydrogen . since our focus is on the dynamics of the cloud rather than the detailed chemistry of the ionized gas , this approximation is quite reasonable .",
    "we describe the gas by a total mass density @xmath4 , density of neutral species @xmath5 , velocity @xmath6 , and total energy density @xmath7 .",
    "the gas is threaded by a magnetic field @xmath8 .",
    "the interface between an hii region and a molecular cloud is a photodissociation region ( pdr ) , within which there is a significant amount of atomic gas . in principle",
    "we should therefore separately track ionized , atomic , and molecular hydrogen , and possibly other species as well .",
    "however , pdrs do not have a signicant effect on the large - scale dynamics of the ionized gas unless the ionizing source is very weak or the neutral gas is much less dense than as typical for molecular clouds , as we show in   [ pdrs ] .",
    "for this reason , we neglect atomic gas , and assume that the density of molecular gas is @xmath5 and the density of ionized gas is @xmath9 .",
    "we compute the evolution of our gas using the equations of multi - species ideal mhd including radiative heating and cooling and chemical evolution terms . in conservative form , these are @xmath10 & = & { \\mathcal{g}}- { \\mathcal{l}}\\\\ \\label{neutralconservation } \\frac{\\partial { \\rho_{n}}}{\\partial t } + \\nabla\\cdot({\\rho_{n}}{\\mathbf{v } } ) & = & { \\mathcal{r}}- { \\mathcal{i}},\\end{aligned}\\ ] ] where @xmath11 is the total pressure , @xmath12 is the gas thermal pressure , @xmath13 and @xmath14 are the rates of recombination and ionization , measured in mass per unit time per unit volume , and @xmath15 and @xmath16 are the rates of radiative heating and cooling , in energy per unit time per unit volume .",
    "the total energy density @xmath7 not including atomic or molecular binding energies is @xmath17 where @xmath18 is the gas thermal energy density .",
    "we adopt an ideal gas equation of state , so the pressure is @xmath19 with @xmath20 , corresponding to a monatomic gas .",
    "this choice of @xmath21 is appropriate because ionized gas is monatomic , and hydrogen in molecular clouds , while diatomic , is generally too cool to access its rotational or vibrational degrees of freedom .",
    "it therefore acts as if it were monatomic for the purpose of dynamics .",
    "in addition to the evolution equations , the magnetic field is subject to the divergence - free constraint @xmath22 physically , equations ( [ massconservation ] ) , ( [ momentumconservation ] ) , and ( [ energyconservation ] ) represent conservation of mass , momentum , and energy , equation ( [ fluxfreezing ] ) represents the approximation that the magnetic field is perfectly frozen in to the fluid , and equation ( [ neutralconservation ] ) states that the mass of neutral gas is conserved by advection , and is altered only by ionizations and recombinations .",
    "equation ( [ divbconstraint ] ) expresses the non - existence of magnetic monopoles .",
    "note that we have adopted a system of units in which the magnetic permeability @xmath23 ; to convert to cgs units , we multiply our magnetic field strengths by a factor of @xmath24 .      to complete the evolution equations , we must specify the rates of the radiative processes : recombination , ionization , heating , and cooling .",
    "recombination is the simplest of these .",
    "we adopt the on - the - spot approximation whereby any recombination to the ground state of hydrogen is assumed to yield an ionizing photon with a very short mean free path , which will in turn cause another ionization at essentially the same location as the recombination @xcite . on the other hand , recombinations to excited states of hydrogen produce photons with long mean free paths , which are assumed to escape the hii region .",
    "thus , the recombination rate is approximately @xmath25 where @xmath26 g is the mean gas mass per hydrogen atom ( for a gas of hydrogen and helium in the standard cosmic abundance ) , @xmath27 and @xmath28 are the number densities of electrons and hydrogen nuclei , and @xmath29 is the case b recombination coefficient , @xmath30 @xmath31 s@xmath0 @xcite at a gas temperature @xmath32",
    ". the h@xmath33 and e@xmath34 number densities are @xmath35 and @xmath36 , where @xmath37 is the carbon abundance in the ism @xcite .",
    "this assumes that all carbon is singly - ionized .",
    "since the first ionization potential of carbon is smaller than that of hydrogen , this is likely to be the case in regions where there is any ionized hydrogen present , which are the only regions for which we care about the recombination rate .    in the on - the - spot approximation ,",
    "the ionization rate is relatively easy to compute as well , since we need only solve the radiative transfer equation only along rays from ionizing sources .",
    "the ionizing flux at position @xmath38 due to the @xmath1th ionizing source is @xmath39 where @xmath40 is the optical depth to ionizing photons along the path from @xmath2 to @xmath38 , @xmath41 is the number density of neutral hydrogen atoms , @xmath42 is the number density of hydrogen nuclei , @xmath43 @xmath44 is the cross section for absorption of a photon at the ionization threshhold by a neutral hydrogen atom , and @xmath45 @xmath46 per h atom is the cross section for absorption of ionizing photons by dust grains @xcite . for the purposes of the tests we report in this paper , for which we are comparing to analytic solutions derived for pure hydrogen , we set @xmath47 .",
    "the photoionization rate is just the rate at which these photons are absorbed , so the total photoionization rate due to all sources at position @xmath48 is @xmath49 we also compute the rate of ionizations due to collisions between neutral hydrogen atoms and electrons , @xmath50 where the collisional ionization rate coefficient is @xcite @xmath51 although for the gas densities and temperatures in the systems with which we are concerned here this term is generally negligible .",
    "the total ionization rate is the sum of these two terms , @xmath52    it should be noted that @xcite has recently pointed out that diffuse photons ( i.e. those that have been absorbed and re - emitted ) can be as important as direct photons in determining the structure of hii regions , so the on - the - spot approximation we adopt is potentially problematic",
    ". however , the importance of diffuse versus direct photons depends strongly on the degree of central concentration of the gas inside the hii region .",
    "once an hii region becomes d type , which is the phase in which we are most interested from the standpoint of radiation hydrodynamic evolution , the gas inside the ionized region is nearly uniform in density .",
    "for this case , @xcite finds that direct photons dominate diffuse ones over the majority of the hii region volume , and the on - the - spot approximation is reasonable .",
    "nonetheless , the on - the - spot approximation does make the shadows cast by dense gas sharper than they should be in reality , and we must keep this limitation in mind .",
    "we can approximately determine the heating and cooling rates by breaking them up into heating and cooling associated with ionization and recombination of hydrogen atoms , and all other sources of heating and cooling .",
    "the heating rates due to ionization and recombination of hydrogen are quite simple in our monochromatic treatment of the ionizing radiation . in this approximation",
    ", each absorption of an ionizing photon delivers @xmath53 ev of thermal energy to the gas @xcite , so the photoionization heating rate is @xmath54 each recombination of a hydrogen atom allows photons to escape , leading to a loss of energy .",
    "a microphysical calculation of the resulting cooling rate gives @xmath55 , where @xcite @xmath56 for temperatures @xmath57 k , and recombination cooling falls to negligible values at lower temperatures .    for heating and cooling that are not directly due to ionization of hydrogen , we use simple optically - thin heating and cooling curves . in molecular gas , we adopt the approximate cooling and heating functions of @xcite , and in partially ionized gas we compute the cooling rate following @xcite .",
    "our calculation includes the cooling by ion - electron collisions involving the first and second ionized states of o , n , and ne , which are the dominant coolants in hii regions under solar metallicity conditions",
    ". we also include free - free cooling .",
    "thus , the total heating and cooling rates are @xmath58 and @xmath59 where the subscripts ki , rec , and ion - ff indicate heating and cooling following the @xcite curves , from recombinations , and from ion - neutral collisions and free - free emission in ionized gas . with these cooling curves ,",
    "the equilibrium temperature in neutral gas at a density of @xmath60 @xmath31 is approximately @xmath61 k , and the equlibrium temperature in fully ionized gas is approximately @xmath62 k , with some weak density dependence .      here",
    "we justify our earlier statement that we can neglect pdrs in studying the large - scale dynamics of most hii regions . we do this using the analytic pdr models of @xcite .",
    "note that @xcite consider the case of convex fronts , in which a neutral cloud is bathed in ionizing radiation , whereas we are more concerned with concave fronts , for which the source is embedded within a molecular medium . to avoid complications arising from this , we will only consider the case of plane - parallel ionization fronts .",
    "however , the results should qualitatively generalize to our concave case .",
    "first consider a system a short time after an ionizing source turns on , before a shock front forms .",
    "in this case , there is only a dissociation front and an ionization front . the propogation speed of each front",
    "is then determined solely by the rate at which ionizing or dissociating photons reach it .",
    "let @xmath63 and @xmath64 be the stellar luminosities in units of ionizing lyman continuum ( @xmath65 ) and dissociating fuv ( @xmath66 ) photons per second emitted by the ionizing source , and @xmath67 and @xmath68 be the optical depths from the source to the respective fronts . in this case an ionization front at a distance @xmath69 from the source propogates at a velocity @xmath70 where @xmath71 is the number density of hydrogen nuclei outside the front .",
    "the dissociation front propogates at a rate @xmath72 where @xmath73 is the front radius , and the factor of 0.15 arises because only a minority of fuv photons actually produce dissociations . for stars of type o3 or earlier ,",
    "i.e. those that drive significant hii regions , @xmath74 , so @xmath75 unless the lyman continuum optical depth is large enough compared to the fuv optical depth so that the fraction of lyman continuum photons reaching the front is @xmath76 of the number of fuv photons reaching the front .",
    "this requires @xmath77 .",
    "since the dust extinction cross section for fuv photons is larger than for lyman continuum photons by a factor of @xmath78 @xcite , this can only happen if there is significant attenuation of lyman continuum photons due to recombining gas within the hii region . at early times",
    "before recombinations are significant compared to photoionizations , this means @xmath75 and the ionization and dissocation fronts will be coincident . in this case ,",
    "our neglect of the dissocation front is obviously not a problem .",
    "as the ionization front radius approaches the strmgren radius , @xmath79 recombinations within the ionized region produce a significant neutral population that raises @xmath67 but not @xmath68 and slows expansion of the ionization front relative to the dissociation front .",
    "if this process continued indefinitely then the dissocation front would eventually race ahead of the ionization front .",
    "however , slowing of the ionization front will also eventually allow a shock to form , converting it from r type to d type , and this will sweep gas up into a dense shell and modify the propagation speed of both the ionization and dissociation fronts .",
    "how much can the ionization front slow down before a shock forms ?",
    "the condition for a shock to form is that the ionization front speed drops to of order the speed of a strong shock driven by the ionized gas , which is twice the ionized gas sound speed @xmath80 .",
    "thus , a shock forms when @xmath81 if we now approximate that @xmath82 once @xmath83 , it follows that @xmath84 where in the second step we have scaled to typical values for galactic molecular clouds and hii regions , @xmath85 , @xmath86 , @xmath87 , and @xmath88 .",
    "thus , the dissociation front will not begin moving faster than the ionization front until @xmath89 , but a shock will form once @xmath90 .",
    "once a shock forms , we must consider how the width of the pdr compares to the width of the shocked layer to determine if the dissociation front can ever propogate ahead of the shock . in equilibrium ,",
    "the column density of hydrogen atoms through a pdr is roughly @xcite @xmath91^{-1},\\ ] ] where @xmath92 @xmath46 is the attenuation cross section of dusty gas to fuv photons and the factor @xmath93 is a dimensionless number describing the balance between h@xmath94 formation and dissociation .",
    "since the numerical factor involving @xmath93 is at most 0.21 , this implies that there is a maximum hydrogen column @xmath95 through a pdr .",
    "non - equilibrium pdrs are generally narrower than this .",
    "the column of hydrogen swept up in the dense shell around an ionized region shortly after it forms is roughly @xmath96 .",
    "if we compare this to the maximum column density of a pdr , we find that the column of hydrogen @xmath96 present when the shock first forms exceeds the maximum column of a pdr whenever @xmath97 thus , for @xmath98 s@xmath0 , which is the case for any strong ionizing source , the dissociation front will essentially always remain trapped between the ionization front and the shock front , except perhaps for a very brief interval when the front is changing from r type to d type and the lyman continuum optical depth through the ionized region is about @xmath99 . as a result , the dissociation front will not have a significant effect on the dynamics of the ionized region , since the only gas it can affect will be gas that has already been shocked and is about to be ionized .",
    "the dissociation front will simply be passively carried along .",
    "this can break down if we consider weak ionizing sources , or if we have a medium substantially less dense than @xmath100 @xmath31 , the typical mean density in a gmc .",
    "if either of these is the case , then a dissocation front may run ahead of the shock front and pre - heat the gas , thereby affecting the dynamics . in this case",
    "our neglect of the atomic gas becomes more problematic .",
    "however , even when pre - heating occurs , the dissociation front will only precede the shock front for a limited time , until the ionized region has swept up the critical column density @xmath101 .",
    "thus , even for weak ionizing sources or low density regions , our approximation will only be invalid around the time when the front transitions from r type to d type .",
    "our simple analytic calculation is in good agreement with the detailed one - dimensional simulations of @xcite , who also find that the molecular hydrogen dissociation front around an expanding hii region becomes trapped between the shock and ionization fronts shortly after the front transitions from r type to d type .",
    "we solve the evolution equations on a cartesian grid with uniform cell spacing @xmath102 using an operator split approach , in which we alternate conservative mhd updates with the source terms on the right hand sides set to zero with radiation updates in which we add the source terms . in designing this update algorithm",
    ", we bear in mind two factors .",
    "first , due to the comparitively simple nature of the radiation update , computing a single explicit update using the radiation source terms is computationally much cheaper than computing a single magnetohyrodynamic update .",
    "for this reason , we choose to sub - cycle the radiation update relative to the mhd update .",
    "this effectively makes our radiation update step implicit , since during any given simulation time step we iterate the temperature and chemical state of each cell over many explicit update cycles .",
    "second , the overall update time step is restricted by both radiation and mhd . the time step must obey the courant condition , but we also wish to impose a heating / cooling time step condition .",
    "if the energy in a cell changes too much between mhd updates , the corresponding large changes in pressure from one time step to the next may lead to inaccurate solutions .",
    "we therefore wish to limit the amount by which the energy in a cell can change between mhd updates , which in turn imposes a time step constraint associated with the rate of heating or cooling .",
    "note that , in contrast , the mhd update is not directly affected by the neutral density @xmath5 , so we need not impose a corresponding constraint on the overall simulation time step arising from changes in the chemical state of the gas .    in order to satisfy these constraints",
    ", we perform a two - step update procedure , illustrated schematically in figure [ progflow ] . at the end of time",
    "step @xmath1 , in each cell we have a vector of quantities @xmath103 at time @xmath104 .",
    "( here @xmath105 is the gas momentum , and we are glossing over the fact that in the athena algorithm the magnetic field is actually stored at cell faces rather than cell centers . )",
    "we wish to determine the properties @xmath106 at time @xmath107 .",
    "we first update the gas energy @xmath7 and neutral density @xmath5 using only the terms on the right hand sides of equations ( [ massconservation ] ) - ( [ neutralconservation ] ) .",
    "this update covers a time @xmath108 , where @xmath109 is the courant time step for the current configuration , and @xmath110 is a time step imposed by a requirement that the internal energy of a cell not change by too much per time step .",
    "this gives us an intermediate vector @xmath111 .",
    "since we do not want to have to perform an mhd update every time we do a radiation update , the radiation update procedure is iterative .",
    "therefore @xmath112 is not simply @xmath113 , and similarly for @xmath114 .",
    "we give a step - by - step description of the radiation update procedure in ",
    "[ radiationalgorithm ] , and defer formal definition of @xmath115 , @xmath112 , and @xmath114 until then .",
    "second , we perform an mhd update to gas quantities starting from state @xmath111 , advancing the conservation equations ( [ massconservation ] ) - ( [ neutralconservation ] ) with the source terms on the right hand sides set to zero .",
    "this advance covers the same time @xmath116 as the radiation update .",
    "we perform this update using the standard athena explicit mhd update procedure , which is described in @xcite , with the trivial addition of the passive scalar advection equation ( [ neutralconservation ] ) for the neutral density .",
    "the overall program flow is independent of the details of the mhd update algorithm . for the runs we report in this paper , we configure athena to use its directionally - unsplit 6-solve upwind constrained - transport method , the roe riemann solver with h correction , and second - order spatial accuracy .",
    "we do not describe these methods in greater detail here , and instead refer readers to the gardiner & stone papers . at the end of this step ,",
    "we have updated @xmath117 for all the terms in the evolution equations ( [ massconservation ] ) - ( [ neutralconservation ] ) , so the final state is @xmath106 , and we may begin the next time step .    it should be noted that our update cycle is quite similar to that of @xcite .",
    "our radiation update algorithm combines elements of the approaches @xcite and @xcite , together with some novel techniques that through the tests we describe in   [ tests ] we found necessary to achieve high accuracy . our procedure to advance the input state @xmath117 to the intermediate state @xmath111is as follows .",
    "we do two prepatory steps before beginning a radiation update .",
    "first , we compute the courant time step @xmath118 for the configuration @xmath119 .",
    "second , we construct a tree of rays following the prescription of @xcite for each radiation source .",
    "we will not review the full formalism of this method here , but a summary of its relevant properties is that from each source one sends out a tree of rays in directions that correspond to the centers of pixels in the healpix pixelization scheme @xcite . at its coarsest level",
    "the tree contains 12 rays uniformly spaced over the unit sphere , but the scheme is hierarchical , such that any ray may be subdivided into four child rays an arbitrary number of times . after the @xmath120th such division , the unit sphere is discretized into @xmath121 pixels , so that each pixel covers a solid angle @xmath122 sr .",
    "as we follow rays outward , we subdivide them to guarantee that at a distance @xmath123 from the source @xmath124 , i.e. that the solid angle that a given ray represents is always smaller than the solid angle subtended by a cell of the cartesian grid by at least a factor of 2 .",
    "we always divide each ray at least twice , so we never have fewer than @xmath125 rays .    along each ray",
    "we construct a list of the cells through which that ray passes , and the length of the ray segment that lies within each cell .",
    "if we are running a calculation in parallel , so that the computational domain is subdivided into a series of processor domains that are contiguous rectangular blocks , we first construct the list of processor domains through which a ray passes . on each processor",
    "we only store information about rays for which either the ray , its parent , or one of its children intersects that processor s domain . this enables us to pass information from one processor to the next as we walk outward along the ray tree without storing the full tree on each processor .",
    "if the source is moving , we repeat this procedure every time the source moves , generally every time we perform an mhd update . for a source that is fixed in space , we build a new tree every fifth mhd time step .",
    "each time we build the tree we rotate it into a random orientation to minimize errors due to discretization in angle .",
    "we discuss this procedure , and why it is necessary , in more detail in   [ treerebuild ] .    with these preparations",
    "done , we begin the iterative update procedure .",
    "we compute the ionizing flux passing through every cell by walking outward along the rays , following the procedure outlined in @xcite .",
    "suppose a particular ray representing a solid angle @xmath126 starts at a distance @xmath127 from the source , and that the flux of ionizing photons at this point is @xmath128 .",
    "the ray passes through a sequence of @xmath129 cells , and we define @xmath130 as the length of the ray segment that intersects the @xmath131th cell , @xmath132 as the distance from the source to cell @xmath131 , and @xmath133 as the radiation flux reaching cell @xmath131 .",
    "the optical depth through cell @xmath131 is @xmath134 , where @xmath71 and @xmath1 are the number densities of neutral hydrogen atoms and hydrogen nuclei in the cell .",
    "the flux reaching the next cell is just @xmath135 and conservation of ionizing photons therefore implies that the number of ionizations per unit time in cell @xmath131 due to photons moving along this ray is @xmath136 .",
    "the corresponding rates of mass photoionization per unit volume and photoionization heating per unit volume are @xmath137    we use this procedure to trace the photons along each ray , starting from the 12 coarsest ones .",
    "once we have reached the end of a ray , we pass the flux @xmath138 that escapes the final cell on to its child rays and repeat this procedure for them .",
    "we continue until we either reach the edge of the computational domain or until such a small fraction of the photons remain ( we use @xmath139 ) that it is no longer worthwhile to continue following them .",
    "the total mass photoionization rate @xmath140 and photoionization heating rate @xmath141 in a cell at time @xmath142 is simply the sum of the rates contributed by all the rays that intersect it , as determined by equations ( [ iray ] ) and ( [ gray ] ) , for the gas properties at that time @xmath143 .",
    "once we have determined the rates of change of the neutral mass and energy due to photoionization , we determine the rates due to recombination , collisional ionization , and optically thin heating and cooling using equations ( [ recomb ] ) , ( [ collion ] ) , ( [ recombcool ] ) , ( [ otheating ] ) , and ( [ otcooling ] ) .",
    "these calculations are purely local , and we simply perform them using the current state of the gas @xmath143 . for reasons we discuss in   [ mixedcells ] , we set the heating and cooling rate due to molecular transitions to zero in cells with ionization fractions between @xmath144 and @xmath145 . adding the rates from local processes together with the photoionization rates",
    "gives the total rate of change of the gas energy @xmath146 and the neutral density @xmath147 at time @xmath142 .",
    "once we know the rates of change of the energy and neutral density , we compute the time step for this iteration , @xmath148,\\end{aligned}\\ ] ] where the maximum is over the three quantities in the parentheses computed over all cells .",
    "thus , the iteration time step is chosen so that the maxmium fractional change in the internal energy @xmath18 , neutral density @xmath5 , or ion density @xmath9 in any cell is 10% . we also want to ensure that the total radiation time we advance is no larger than the courant time step in the initial configuration , so if @xmath149 , we set @xmath150 .",
    "once we have fixed the time step @xmath151 for this iteration of the radiation update , we actually perform the update to find the new state @xmath152 we terminate iteration if one of the following conditions is satisfied : ( 1 ) we have advanced over the total time determined by the courant time step in the initial configuration , i.e. @xmath153 ; ( 2 ) we have advanced over a total time that is equal to or larger than the courant time step in the _ current _ configuration , i.e. @xmath154 ; ( 3 ) the internal energy of a cell has changed by more than a factor of @xmath155 from the its initial value , i.e. @xmath156 , where again the maximum is over both quantities and over all cells . if none of these conditions are met , we do another iteration , starting with a calculation of the photoionization rate by traversing the tree .",
    "the state when iteration terminates is the intermediate state we use as an input to the conservative mhd update .",
    "thus , if iteration terminates after @xmath157 cycles , then @xmath158 the time step for the mhd update is then set to @xmath159 , the time for which we have computed the radiation update . if the iteration terminates due to condition ( 1 ) , this will be the courant time step of the initial state , @xmath160 .",
    "if it terminates due to condition ( 2 ) , this will be @xmath161 , the courant time step of the intermediate , post - radiation state .",
    "if it terminates due to condition ( 3 ) , the time step will be @xmath162 , the time it takes for the internal energy to change by a factor @xmath155 in the cell that changes by the largest factor . in practice",
    ", the third condition is usually the most restrictive , since as the ionization front advances over a single cell the internal energy of that cell changes by a factor of @xmath163 , and we find that @xmath164 is required to obtain good solutions .",
    "we present tests to determine what value of @xmath155 produces acceptable results for simple radiation hydrodynamics problems in   [ timestep ] .      as part of our algorithm , we set @xmath165 and @xmath166 , the cooling and heating rates due to molecular processes , to zero in cells with ionization fractions between @xmath144 and @xmath145 .",
    "we do this in order to prevent a problem with overcooling in mixed ionization cells . to understand why this is necessary ,",
    "let us first consider what happens at an ionization front in reality . in the fully molecular gas outside the front , heating due to cosmic rays and interstellar uv and cooling due to molecular emission balance and",
    "the gas is effectively isothermal ; in the fully ionized gas on the other side , heating by ionizing photons and cooling by recombination and forbidden line emission also balance to keep the gas isothermal .",
    "the ionized and molecular regions are separated by a pdr and an ionization front .",
    "the true thickness of the ionization front is of order the mean - free path of an ionizing photon , which in a gas at a typical molecular cloud density @xmath167 @xmath31 is @xmath168 au .",
    "once an expanding ionization front becomes d type and sweeps up a dense shell of material , the thickness will be even smaller",
    ". the ionization fraction will be between @xmath144 and @xmath145 only within this thin layer .",
    "because the hot ionized gas on one side of the front and the cool molecular gas on the other side are physically separated , and there is no mechanism to efficiently transport heat across the front , gas that gains energy from ionizing photons can not lose it via molecular cooling .",
    "now , however , consider what happens in a simulation with finite resolution .",
    "if one simulates a region that is parsecs or more in size , the @xmath169 au width of an ionization front will generally be much smaller than the size of a computational cell . as a result",
    ", the ionization front will be smeared out into a width comparable to cell size , and this numerical mixing will supply a mechanism to transport heat from ionized gas into molecular gas .",
    "this can lead to a dramatic overestimate of the energy loss rate , because molecular emission is so efficient . in effect , the rate limiting step in cooling will become how rapidly energy can be transported into neutral gas by numerical mixing .",
    "we demonstrate this effect in a real simulation in   [ dfrontcooling ] .",
    "ideally one would solve this problem by either resolving the width of the ionization front ( or at least coming close enough to render the overcooling region too small to do much damage ) , or using an interface - tracking technique to follow the position of the front on a subgrid scale .",
    "however , the former option is prohibitively expensive in three dimensions ( though it is feasible in two dimensions , e.g. @xcite ) , and the latter is extremely cumbersome in a three - dimensional simulation .",
    "therefore we adopt a much simpler solution : since we know physically that cells at an ionization front should contribute negligibly to the overall cooling rate , we simply set the molecular cooling rate in these cells to zero .",
    "this leads to a very minor underestimate of the cooling rate , but the error is small because in reality the front has a tiny volume and therefore should contribute negligibly to the overall cooling rate . as we show in   [ dfrontcooling ] , this procedure enables us to match analytic solutions to very high precision , whereas if we leave the cooling on in mixed cells we find large errors relative to analytic solutions .",
    "our method does assume that the boundary between the ionized and molecular gas can be described well as a single , simple front .",
    "if instead the molecular and ionized gas are mixed into a two - phase medium with a complex interface that has structures small compared to a computational cell ( for example dense clumps of cold molecular gas surrounded by a hot , ionized interclump medium ) , then our approach of simply turning off molecular cooling will fail . in this case",
    ", one would either need to resolve the complex interface , or use a detailed subgrid model of heating and cooling to account for the two - phase nature of the medium .",
    "here we present tests of our code against analytic solutions . since we are not aware of any analytic solutions for ionizing radiative transfer with magnetohydrodynamics in more than one dimension , all of the tests we present in this section are hydrodynamic rather than magnetohydrodynamic , i.e. @xmath170 .",
    "we present magnetohydrodynamic results in   [ mhdresults ] .",
    "a first , basic test of our implementation is the propogation of a spherical ionization front in a medium in which there is no hydrodynamic evolution and no recombinations .",
    "physically , this is the type of expansion that should occur at the very earliest stages of an hii region s life , before there has been time for either hydrodynamic motions or for a significant number of recombinations to occur . in this case",
    ", a source with ionizing luminosity @xmath171 placed in a uniform medium with density @xmath4 produces an ionized region whose radius is simply set by equating the number of ionizing photons produced up to a time @xmath172 with the number of hydrogen atoms within the radius @xmath173 .",
    "thus , we should find @xmath174    this problem is effectively a test of photon conservation in our code .",
    "since our radiation method is in principle exactly photon - conserving , we should be able to compute the position of the ionization front accurately to the resolution of our computational grid .",
    "we preform a test with a source of ionizing luminosity @xmath175 ionizing photons s@xmath0 placed in a uniform medium of density @xmath176 g @xmath31 ( @xmath167 @xmath31 ) and an initial temperature of 20 k. the source is at the center of a computational domain that runs from @xmath177 pc to @xmath178 pc in each direction . for this test",
    "we disable the mhd update in our code , and set the rates for all radiative processes except photoionization to zero .",
    "we use a resolution of @xmath179 cells .",
    "figure [ rifnr ] shows the computed radius of the ionization front versus time in our test .",
    "as the plot shows , the computed solution agrees with the analytic prediction to better than a percent , which is an error much smaller than the size of a computational cell .",
    "figure [ rprofnr ] shows the radial profile of the ionization fraction versus radius for every cell in our computational domain at a time of @xmath180 s ( @xmath181 kyr ) , and figure [ rslicenr ] shows the neutral fraction in an equatorial slice through the domain .",
    "as the plots show , the ionization front is entirely confined to cells at the analytically computed front radius at this time , @xmath182 pc .",
    "thus , our code passes this test quite well .",
    "a next test of our code is in the case where there are still no motions , but recombinations do occur . physically , this represents the next phase in the expansion of an r type ionization front , when the recombination rate becomes competitive with the photoionization rate , but before the excess pressure in the ionized gas causes the hii region to begin hydrodynamically expanding .",
    "if the recombination coefficient @xmath29 is constant , this problem has an analytic solution : at time @xmath172 , the radius of the ionization front is @xmath183 where @xmath184 is the strmgren radius and @xmath185 is the recombination time scale for the gas . at early times",
    "this solution matches the case of powerlaw expansion discussed in   [ norecomb ] , but as times @xmath186 the ionization front slows down due to recombinations . at times",
    "@xmath187 , the front radius approaches @xmath188 and the front velocity drops to zero .    for any realistic cooling curve ,",
    "for which the heaitng and cooling rates depend on the density , radiation flux , and the ionization state , there will be some small temperature variation in time and space within the hii region , so @xmath29 will not be exactly constant and the analytic solution will not apply exactly . to enable us to compare with the analytic solution as well as possible , and therefore to make the strongest possible evaluation of the code , for the purposes of this test we set @xmath189 @xmath31 s@xmath0 independent of temperature .",
    "we run this test using the same initial conditions and resolution as in   [ norecomb ] , which give @xmath190 pc and @xmath191 kyr for our chosen value of @xmath29 . for this test",
    ", we again disable the mhd update step in our code , but allow the entire radiation module to operate normally .",
    "we run for @xmath180 s ( @xmath181 kyr ) , which is more than @xmath192 .",
    "figure [ rifnh ] shows the position of the ionization front versus time , computed as in   [ norecomb ] , and figure [ rprofnh ] shows the radial profile of the neutral density at a time of @xmath180 s. as we found in ",
    "[ norecomb ] , the ionization front is entirely confined to a radial extent of a single cell , so the front is as spherical as possible given our cartesian grid .",
    "the accuracy of the front position is @xmath193 , better than a single cell .",
    "the tests described in   [ norecomb ] and   [ rtype ] demonstrate that our radiation module produces correct results on its own , and the tests in @xcite show that the mhd module works well .",
    "however , we must also test how the two modules work together .",
    "we therefore consider the problem of the hydrodynamic evolution of a uniform neutral medium with initial density @xmath194 and temperature @xmath195 within which there is an ionizing source .",
    "this problem has a well - known solution . at early times",
    "there is an r type ionization front : the source ionizes the gas out to a radius @xmath196 , and heats it to @xmath197 k , but the gas does not move and the ionization front is not preceeded by a shock .",
    "however , the ionized region is overpressured relative to the surrounding gas , and it expands on a sound crossing time scale , @xmath198 , where @xmath199 cm s@xmath0 is the sound speed in the ionized gas .",
    "as it expands , it sweeps up a dense shell of neutral material , forming a d type ionization front .",
    "the expansion is subsonic with respect to the ionized gas , so the ionized region has an almost uniform density and temperature .",
    "ionization balance requires that this density vary as @xmath200 , so the shell is driven outward by a pressure @xmath201 . in the limit where the pressure in the ionized region that is driving the shell greatly exceeds the thermal pressure in the ambient medium , and the neutral mass in the shell greatly exceeds the mass within the ionized region , conservation of momentum for the shell implies that after a time @xmath172 it expands to a radius @xcite @xmath202 the thickness of the shell relative to its radius is of order @xmath203 , where @xmath204 is the isothermal sound speed in the neutral gas and @xmath205^{-3/7}$ ] is the velocity of the shell . as with the analytic solution for the r type ionization front , this strictly applies only if the ionized gas sound speed @xmath80 is constant . for a realistic cooling curve",
    ", we expect this to be nearly but not perfectly true .",
    "we run simulations with an initial density @xmath206 g @xmath31 , temperature @xmath207 k , and an ionizing source of luminosity @xmath208 s@xmath0 .",
    "the source is placed at the center of a box running from @xmath177 pc to @xmath178 pc in every direction . for these values of @xmath4 and @xmath171 , and assuming an ionized region temperature of roughly @xmath209 k , we have @xmath210 pc and @xmath211 myr .",
    "we expect that the similarity solution will apply for times @xmath212",
    ". the lower limit on the time is imposed by the requirement that the mass in the swept - up shell be much larger than the mass in the interior of the hii region , and the upper time limit comes from the requirement that the pressure in the hii region greatly exceed the ambient pressure , or equivalently that the thickness of the shell be much smaller than its radius .",
    "we run all our tests for 1 myr , or @xmath213 .",
    "we begin with simulations at resolutions of @xmath179 , @xmath214 , and @xmath215 , using a factor @xmath216 for our heating time step constraint ( i.e. we allow the internal energy of a cell to change by up to a factor of 4 between hydrodynamic updates . ) figure [ rprofd ] shows the radial distribution of densities , temperatures , neutral fractions , and isothermal sound speeds in the gas in the simulations after 1 myr . as we expect , the density and temperature in the ionized region are almost constant .",
    "the density peaks at the position of the overdense shell , but the shell is spread over a few cells , so its width decreases with resolution .",
    "this spreading is to be expected .",
    "the true physical thickness of the shell at this time should be roughly a percent of @xmath217 , smaller than the size of a single computational cell .",
    "however , our code has some numerical viscosity , particularly for motions that are not aligned with the computational grid , and this spreads shocks over @xmath218 cells . as figure [ dimg ] shows , despite this spreading the front remains round at each resolution .",
    "we next compute the radius of the dense shell as a function of time in our simulation .",
    "we do this by identifying all the cells whose densities are at least 10% larger than the initial density , and then taking the average of their radii . using an overdensity cutoff different from @xmath219 modifies the results in detail , but not qualitatively .",
    "we compare this measurement to the analytic solution in figure [ rdfres ] . as the plot shows , the radius of our simulated shell matches the analytically computed radius at late times quite well in all the runs .",
    "the error is always smaller than cell in size , which is the best that can be expected using a cartesian grid with finite numerical viscosity .",
    "this error is @xmath220 of the analytically computed radius at the lowest resolution and less than @xmath144 at the highest resolution .",
    "the error generally decreases with time , both because the ratio of the radius to a cell size is increasing , and because the analytic solution is becoming a better and better approximation as time increases .",
    "we have shown that our method can match the analytic solution for the propogation of a d type ionization front with a heating time step constraint of @xmath216 , meaning that we allow the pressure in a cell to change by at most a factor of 4 between hydrodynamic updates . however , we would like to explore a range of heating time step constraints to determine if the accuracy of the solution is affected by the choice of @xmath155 .",
    "we therefore re - run our @xmath214 simulation with @xmath221 , @xmath222 , and @xmath223 to see if the quality of the solution changes significantly .",
    "the choice @xmath223 corresponds to essentially no constraint on the hydrodynamic time step other than the ordinary courant condition .",
    "we wish to use as large a value of @xmath155 as possible , because that will minimize the computational cost by enabling us to take fewer of the more expensive mhd updates per radiation update .",
    "of course if @xmath155 is too large then the cost of the radiation update will dominate the total computation cost , and there will be no additional advantage in increasing @xmath155 . where exactly this crossover occurs depends on the number of processors and the geometry of the ionization front .",
    "figure [ rdff ] shows the radius of the shell versus time as computed in our simulations with varying values of @xmath155 , and as computed analytically .",
    "the results show that the radius approaches the analytic solution somewhat fall all @xmath155 , but that the error is larger and the convergence slower for larger values of @xmath155 .",
    "this suggests that numerical methods in which the temperature change between hydrodynamic updates is unconstrained ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) or is limited only to values of @xmath224 ( e.g. * ? ? ?",
    "* ) may produce quantitatively incorrect results for the expansion rates of d type ionization fronts , although the error is likely to be only a few cells .",
    "this problem may not affect methods that implicitly update the hydrodynamics and the radiation together ( e.g. * ? ? ?",
    "* ) , rather than in an operator split fashion , but we are unaware of any such methods for ionizing radiation transport as opposed to local heating and cooling functions .    note",
    ", however , that even with large @xmath155 the error does decrease in time .",
    "this result is easy to understand intuitively .",
    "once the front is well into the d type phase , the courant time step is set by the sound speed in the ionized region , which is roughly constant . as the front sweeps up more material and slows down ,",
    "the rate at which gas is heated from the inital temperature to the ionized temperature decreases , so , on average , the fractional change in cell temperature per fixed courant time step is a decreasing function of time .",
    "thus , the error one makes by allowing a large change in gas temperature per courant time step decreases with time .",
    "this means that codes with unconstrained temperature changes per hydrodynamic update are likely to be most inaccurate at early times when fronts are moving at speeds close to the ionized sound speed , and are most accurate at late times when fronts move slowly .      to demonstrate why it is necessary to rotate the orientation of the rays in our calculation regularly , we repeat our @xmath214 , @xmath216 test calculation without ever rotating the rays",
    "the mean radial positions of the dense shell and the ionization front are essentially the same in the two calculations , but the shape of the ionization front is significantly different .",
    "figure [ rebimg ] shows the neutral fraction in slices through the simulations without and with ray rotation after 1 myr of evolution . with rotation of the rays ,",
    "as shown in the lower panel , the ionization front boundary is smooth and round . without rotation ,",
    "as shown in the upper panel , there are projections of partially neutral gas several cells into the ionized region , and the front boundary is much less smooth . if one is interested in studying instabilities or similar phenomena at the ionization front boundary , the presence of these fingers of neutral gas is potentially problematic , since they may serve as seeds for instability .",
    "these projections are caused by differences in ionization rate for cells at the same radius due to discretization in angle .",
    "when the orientation of the rays is constant over long times , small differences in ionization rate at different angles can build up to produce the finger - like structures shown in the figure .",
    "one could reduce the discretization error by using a more refined ray tree , for example by requiring that the solid angle subtended by a cell always be at least four times as large as the solid angle corresponding to a single ray , rather than twice as large as we require . however , this is potentially expensive , since every factor @xmath155 increase in the angular resolution multiplies the time required to compute the photoionization rate by a factor of @xmath225 , and the photoionization rate is computed during every radiation iteration .",
    "it is also overkill , since the angular disretization errors only build up over many time steps .",
    "rotating the rays at intervals of 5 hydrodynamic time steps , as we have done for the simulation shown in the lower panel of figure [ rebimg ] , eliminates or vastly reduces the occurence of neutral gas fingers in the ionized region .",
    "the computational cost of rebuilding the ray tree every 5 hydrodynamic time steps is completely negligible and , for parallel calculations , requires no additional inter - processor communication .",
    "we next explore the question of cooling in cells with mixed ionization states . as discussed in",
    "  [ mixedcells ] , we set the molecular cooling rate @xmath226 in cells where the ionization fraction is between @xmath144 and @xmath145 in order to prevent excessive cooling due to numerical mixing of ionized and neutral gas . to demonstrate why this is necessary , we repeat our simulation of a d type ionization front with @xmath216 with cooling allowed in all cells regardless of ionization fraction .",
    "figure [ rdfcool ] shows the result .",
    "the run where all cells can cool lags the analytic solution even at early times , and the error does not decrease with time .",
    "the error at 1 myr of evolution is roughly 14% , which is far larger than a single cell ; the error in the slope of the of the @xmath217 versus @xmath172 curve at 1 myr is 10% .",
    "in contrast , the error with mixed - ionization cooling disabled is @xmath227 , which corresponds roughly to the center - to - corner distance of a single cell .",
    "the slope of the curve differs from the analytic value by less than 1% .",
    "the lag is a result of numerical mixing at the ionization front coupled with strong molecular cooling . to demonstrate this , we plot in figure [ coolrate ] both the total cooling rate @xmath228 ( panel a ) and the molecular cooling rate @xmath229 ( panel b ) as a function of position from our run with cooling in mixed cells allowed , at a time of 1 myr . as the plot shows , with cooling allowed in mixed cells , the energy loss rate from cells at the ionization front is much larger than that from cells either inside or outside the front",
    ".    one might think this is to be expected , since the cells at the ionization front are the ones furthest out of equilibrium , and are the places where much of the energy from ionizing photons is deposited . however , 91% of the cooling in the region with an ionization fraction larger than @xmath144 comes from molecular cooling rather than from recombination or forbidden line cooling , the processes that should dominate in ionized regions .",
    "molecular cooling dominates even if we consider only much more strongly ionized regions .",
    "only if we limit our attention to gas where the ionization fraction is greater than @xmath230 do we find that molecular processes provide less than 50% of the total cooling rate . that molecular cooling is the dominant cooling process even in gas that is up to 74% ionized is a clear sign that the cooling rate is being artificially enhanced by numerical smearing of the ionization front , since for a real ionization front there should be no molecules to cool in regions that are significantly ionized .",
    "this suggests that simulations can only compute the correct expansion rate for hii regions if they suppress the effects of numerical mixing at the ionization front .",
    "this may explain why some numerical simulations without this precaution produce results that lag the true solution significantly ( e.g. * ? ? ? * ) unless they have enough resolution to at least marginally resolve the ionization front ( e.g. * ? ? ?",
    "* ) , something that is not generally feasible in three dimensions .",
    "note , however , that the strength of this effect depends on the existence of extremely rapid cooling processes for the non - ionized gas .",
    "if the chemistry is such that the neutral gas is not able to cool rapidly , the error will be much smaller .",
    "for example , with primordial cosmological chemistry the lag is much smaller because the neutral gas cooling is much less efficient ( d. whalen , 2006 , private communication ) .",
    "an important point is that the evolution in the case with overcooling is _ qualitatively _ correct .",
    "there is an expanding , spherical hii region driving a dense shell of swept - up material , and following a radius versus time curve that resembles the correct solution .",
    "it is only when one _ quantitatively _ checks the numerical method against an analytic solution that the problem becomes clear .",
    "this highlights the importance of performing quantitative comparisons of numerical and analytic results .",
    "now that we have determined the constraints our numerical method must obey from tests against analytic solutions in the hydrodynamic case , in this section we demonstrate our method in the simplest magnetohydrodynamic case .",
    "several authors have considred the structure of magnetized ionization fronts in the past .",
    "however , these treatments have been limited to mathematically rigorous but one - dimensional analyses ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) or to simple , quasi - empirical models ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) in more dimensions .",
    "@xcite gives an analytic model for the implosion of a spherical magnetized gas clump exposed to an external ionizing source , but his solution is limited to that case . to date , there has been no detailed simulation of the evolution of an hii region driven by a point source expanding into a magnetized medium in three dimensions .",
    "we consider a neutral medium with initially uniform density @xmath194 and isothermal sound speed @xmath204 , threaded by a magnetic field @xmath231 oriented in the @xmath48 direction .",
    "we place a source of constant ionizing luminosity @xmath171 at the origin that begins radiating at time @xmath232 .",
    "we restrict ourselves to the case most relevant to ionizing sources in magnetized molecular clouds , in which the thermal pressure in ionized gas at the initial density greatly exceeds the magnetic pressure , which in turn greatly exceeds the thermal pressure in neutral gas at the initial density .",
    "thus , @xmath233 , where @xmath234 is the alfven speed in the neutral gas and @xmath80 is the ionized gas sound speed .",
    "we can sketch out an approximate evolutionary scenario for this configuration using simple analytic estimates . at times",
    "@xmath235 , the gas has not yet had time to move in response to photoionization heating .",
    "since photons do not feel the magnetic field , the evolution should be identical to that of a non - magnetized r type ionization front . at @xmath236 ,",
    "the ionized gas begins to expand due to its high thermal pressure .",
    "since by assumption @xmath237 , the magnetic field in the gas is initially unable to resist this expansion .",
    "thus , as in the non - magnetic case , a d type ionization front forms , gas moves radially outward , and a spherical dense shell forms .",
    "ionization balance requires that when the shell bouding the hii region reaches a radius @xmath217 , the gas that remains in its interior and is not in the shell wall must have started within a distance @xmath238 of the ionizing source .",
    "since the magnetic field is frozen into the gas , the magnetic flux passing through the interior of the ionized region is therefore @xmath239 where @xmath240 is the magnitude of the magnetic field in the neutral gas outside the shell .",
    "in contrast , the total flux passing through the ionized region and the dense shell combined is simply the initial flux that passed through a circle of radius @xmath217 , @xmath241 since the magnetic flux through the hii region interior rises as @xmath242 at late times , while the total flux through the hii region interior and the dense shell varies as @xmath243 , the fraction of magnetic field lines passing through the hii region that pass through the shell interior must decline with time as @xmath244 . physically , this occurs because magnetic field lines are being dragged with the gas out of the hii region interior and concentrated in the dense shell .",
    "as time progresses , the magnetic field changes the evolution in two ways .",
    "first , magnetic pressure and tension oppose the expansion of the shell perpendicular to the magnetic field , causing it to deform and become aspherical .",
    "this effect should become significant when magnetic pressure is comparable to thermal pressure in the ionized gas , i.e. when @xmath245 . since @xmath246",
    "before magnetic effects are significant , we should see significant deformation of the hii region when it reaches a radius of order @xmath247 , and the shell velocity is @xmath248 .",
    "second , magnetic pressure in the swept - up shell will limit compression in the shock perpendicular to the magnetic field to a factor of order @xmath249 .",
    "this will make the shell thinner along the field and thicker perpendicular to it , an effect that will become noticable when @xmath250 .",
    "thus , we expect both magnetic effects to become significant when the region has expanded to a radius of roughly @xmath251 where we have defined the magnetic critical radius @xmath252 for the hii region",
    ". assuming @xmath253 , this happens at roughly a time @xmath254 after the start of the evolution .",
    "the evolution will then enter a new stage in which the thermal pressure inside the ionized region is small compared to the magnetic pressure , but both still greatly exceed the thermal pressure in the neutral gas . since @xmath255",
    ", gas will be able to move only along field lines , and those field lines will be approximately straight . since expansion is subsonic with respect to the ionized gas and we are concerned with times @xmath256 , the density in the ionized gas along each field line is constant . along the field , gas motions are unrestricted and the evolution will be a normal d type ionization front as seen in non - magnetized gas .",
    "perpendicular to the field , magnetic pressure effects become more and more dominant as time goes on .",
    "the ionized gas continues to escape along field lines , so the pressure driving expansion perpendicular to the field continues falling , which causes the front to slow and the density contrast to decrease perpendicular to the field . at the same time , everywhere that the magnetic field is at all oblique to the front , a slow mode will move into the neutral medium .",
    "this mode will remove magnetic support from the front by bending the field lines so that they become perpendicular to the shock @xcite .",
    "this loss of magnetic support will cause the shell to transition from thick and magnetic pressure - dominated to thin and without much magnetic support over a larger and larger solid angle as time goes on , until only the circle exactly perpendicular to the initial magnetic field is not occupied by a dense shell .",
    "we simulate an initially neutral uniform medium with density @xmath257 g @xmath31 ( @xmath167 @xmath31 ) and temperature @xmath258 k , threaded by a magnetic field",
    "@xmath259 @xmath260 g ( @xmath261 in the units we use in this paper ) .",
    "this gives an alfven speed of 2.6 km s@xmath0 and a sound speed of 0.20 km s@xmath0 in the gas at the initial time .",
    "the computational domain runs from @xmath177 pc to @xmath178 pc in every direction , and there is an ionizing source at the origin with luminosity @xmath208 s@xmath0 , giving an initial strmgren radius @xmath210 pc and sound crossing time @xmath262 myr , assuming a sound speed @xmath263 km s@xmath0 in the ionized region . for these parameters",
    "the magnetic critical radius is @xmath264 pc and the magnetic critical time is @xmath265 myr . the simulation uses a resolution of @xmath215 cells and a heating / cooling time step constraint of @xmath216 .",
    "we run the simulation for a time of @xmath266 myr .",
    "figures [ magearly1 ] and [ magearly2 ] show slices through the computational domain at a time of @xmath268 myr .",
    "as expected , the hii region almost spherical , although there is already a slight asymmetry visible .",
    "the outer boundary of the dense shell is nearly perfectly round , and is at essentially the same radius as we would expect for a non - magnetized region at the same time .",
    "however , the shell is slightly thicker in the direction perpendicular to the field than in the direction along the field , due to magnetic pressure opposing compression .",
    "also as expected , because magnetic field lines are being advected with the gas , the magnetic field inside the hii region is much weaker than the background field , and the magnetic field in the dense shell is much stronger than the background field .",
    "figures [ magmid1 ] and [ magmid2 ] show the same slices as figures [ magearly1 ] and [ magearly2 ] at a time @xmath270 myr .",
    "as expected , the magnetic effects have now become pronounced .",
    "the inner , ionized region is strongly prolate , so that it is roughly a factor of 2 longer along the field than perpendicular to it . along the field ,",
    "the dense shell is still only a few cells thick , the same as in the non - magnetic case , but in the directions perpendicular to the field its thickness is not much smaller than its radius , again as we expect .",
    "however , the outer edge of the expanding shell is still not too far from spherical , and in the direction along the field its radius is close to @xmath252 , the radius we would expect were there no field present .",
    "interestingly , the shell extends somewhat further in the direction across the field than in the direction along it , so the outer radius of the swept up shell in the @xmath271 and @xmath272 directions is noticably larger than @xmath252 .",
    "this is likely because at @xmath273 the expansion speed is comparable to the alfven speed , and is slower than the fast magnetosonic speed . across the field ,",
    "signals from the shell can propogate by fast magnetosonic waves more rapidly than the shell can expand along the field .",
    "this creates a density disturbance , carried by the fast mode , ahead of the radius that the shell would have reached had there been no magnetic field .",
    "since fast waves can not propogate parallel to the magnetic field , the leading edge of the disturbance has advanced less in the @xmath48 direction than in the @xmath271 or @xmath272 directions .",
    "figures [ maglate1 ] and [ maglate2 ] show the simulation at our final time slice , @xmath275 . in the evolution after time @xmath276 ,",
    "the inner ionized region becomes more prolate , expanding more rapidly along the field than perpendicular to it . along the field , in the @xmath48 direction , there continues to be dense shell of swept up material .    in the @xmath271 and @xmath272 directions , perpendicular to the field lines ,",
    "the thick shell of gas bounded between the ionization front and the fast mode front , has also continued to expand .",
    "however , its overdensity is decreasing , and at this time is only @xmath277 @xmath31 , so it is within @xmath278 of the background density , and smaller than the density at time @xmath276 .",
    "the shell expansion velocity perpendicular to the field lines is much smaller than the alfven speed in the neutral gas , and is comparable to the sound speed , so the leading edge of the shell is no longer a shock . instead , the shell is just a small overdensity that is gradually relaxing away .",
    "the boundary between the neutral and ionized regions in the @xmath271 and @xmath272 directions appears to be somewhat corrugated , but this may well be a numerical artifact , particularly since figure [ maglate2 ] shows that the structure at the ionization front is aligned with the computational grid",
    ". it may be that for ionization fronts that are nearly static , as this one is due to magnetic confinement , rebuilding the ray tree once every five time steps is insufficient to prevent the growth of structures .    in between the @xmath48 direction and the @xmath271 direction ,",
    "there is a region where the field is oblique relative to the ionization front .",
    "as predicted by @xcite , this region shows two types of behavior depending on how close the field is to being parallel or perpendicular to the front .",
    "closer to the @xmath48 direction , the field been bent so it is close to perpendicular to the front , and a dense shell bounded has formed at the ionization front .",
    "closer to the @xmath271 direction , the field is not bent and enters the front at an oblique angle , and there is no shock or dense shell .",
    "the solid angle over which a dense shell exists appears to be increasing in time .",
    "while expansion of the ionized region perpendicular to the field has slowed , the expansion velocity along the field lines is actually larger or about the same as it was at time @xmath276 . to understand the origin of this effect , consider the jump conditions that govern the expansion of the dense shell in the @xmath48 direction at late times , when the expansion is strongly subsonic with respect to the ionized gas , but the thermal pressure in the ionized gas is still much greater than the thermal pressure in the neutral gas . in the rest frame of the shell",
    ", this means that ram pressure of neutral gas flowing into the shell must balance the thermal pressure of ionized gas downstream from it .",
    "thus , @xmath279 , so the shell expansion velocity obeys @xmath280 . thus far",
    "our analysis could apply just as well to a non - magnetized hii region .",
    "the difference that the magnetic field makes is that it greatly reduces the expansion rate of the ionized region in two directions .",
    "this prevents the density from dropping as fast as in the hydrodynamic case , which keeps the expansion velocity larger at later times .    however , while the decline in ionized gas density and pressure is slower than in the hydrodynamic case , since gas continues to flow out of the ionzied region along field lines into the end caps , the pressure inside the hii region is always decreasing after time @xmath276 . by @xmath281 ,",
    "the hii region is in the limit where the magnetic pressure inside the ionization front is higher than the thermal pressure . as a result ,",
    "the field lines have begun to straighten out inside the ionized region , so they are kinked only at the dense end caps .",
    "the magnetic energy density inside the ionized region is actually larger than at time @xmath276 , since for @xmath282 field lines that were pushed into the dense shell start to move back into the ionized region interior .",
    "we have demonstrated an algorithm for computing the evolution of magnetized molecular gases subjected to internal sources of ionizing radiation , which is potentially applicable to molecular clouds . in testing our algorithm ,",
    "we have discovered three conditions that are likely to apply to ionizing radiation hydrodynamic and magnetohydrodynamic codes in general .",
    "first , to achieve maximum accuracy the update time step must be limited so that the temperature in cells does not change by more than a factor of @xmath283 between hydrodynamic or magnetohydrodynamic updates .",
    "larger values of @xmath155 produce small but significant errors in the expansion rates of d type ionization fronts .",
    "second , when using a ray - tracing approach to compute the ionizing radiative transfer , one should rotate the orientation of the rays periodically to avoid a build - up of errors caused by the discretization of angles around the ionizing source .",
    "failure to obey this conditions results in fronts that should be spherical developing aspherical features , and in more complex calculations this could potentially seed instabilities .",
    "third , and most significantly , one must avoid overcooling caused by numerical smearing of the ionization front .",
    "this can be handled most easily by suppressing cooling in cells with mixed ionization fractions .",
    "failure to obey this condition leads to an unphysical loss of energy from expanding hii regions that causes them to lag analytic solutions by tens of percent .",
    "a calculation that satisfies these three constraints can reproduce the analytic solution for the expansion of a d type ionization front to an accuracy of a percent for at least @xmath284 ionized sound - crossing times .    using our algorithm ,",
    "we report the first three - dimensional simulations of the expansion of an hii region into a magnetized gas .",
    "we show that the presence of a magnetic field distorts the hii region , and greatly reduces the strength of the shock and the density contrast in directions perpendicular to the magnetic field .",
    "this leads to the formation of an hii region which is bounded by a dense shell of swept - up gas along the field , but not perpendicular to it .",
    "the absence of a dense shell over much of the solid angle means that , in the presence of strong , ordered magnetic fields , hii regions may not be able to collect and compress as much gas as one might expect from purely hydrodynamic estimates .",
    "this may reduce the efficiency of triggered star formation from hii regions .",
    "we thank r. crockett , r. klein , c. mckee , e. ostriker , and d. whalen for helpful discussions , and the referee for comments that improved the paper .",
    "support for this work was provided by nasa through hubble fellowship grant # hsf - hf-01186 awarded by the space telescope science institute , which is operated by the association of universities for research in astronomy , inc .",
    ", for nasa , under contract nas 5 - 26555 ( mrk ) and by award de - fg52 - 06na26217 from the doe ( jms ) .",
    "this research used computational facilities supported by nsf grant ast-0216105 .",
    "the authors are pleased to acknowledge that the work reported on in this paper was substantially performed at the tigress high performance computer center at princeton university which is jointly supported by the princeton institute for computational science and engineering and the princeton university office of information technology ."
  ],
  "abstract_text": [
    "<S> we present a method for simulating the evolution of hii regions driven by point sources of ionizing radiation in magnetohydrodynamic media , implemented in the three - dimensional athena mhd code . </S>",
    "<S> we compare simulations using our algorithm to analytic solutions and show that the method passes rigorous tests of accuracy and convergence . </S>",
    "<S> the tests reveal several conditions that an ionizing radiation - hydrodynamic code must satisfy to reproduce analytic solutions . as a demonstration of our new method , we present the first three - dimensional , global simulation of an hii region expanding into a magnetized gas . </S>",
    "<S> the simulation shows that magnetic fields suppress sweeping up of gas perpendicular to magnetic field lines , leading to small density contrasts and extremely weak shocks at the leading edge of the hii region s expanding shell . </S>"
  ]
}