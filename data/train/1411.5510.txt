{
  "article_text": [
    "[ sec1 ]    the literature on functional data analysis has seen a spectacular growth in the last twenty years , showing promise in applications ranging from genetics [ @xcite ] to proteomics [ @xcite ] , epidemiology [ @xcite ] and oceanography [ @xcite ] . because functional data are inherently complex ,",
    "functional clustering is useful as an exploratory tool in characterizing variability among subjects ; the resulting clusters can be used as a predictive tool or simply as a hypothesis - generating mechanism that can help guide further research .",
    "some examples of functional clustering methods include @xcite , who use b - spline fitting coupled with @xmath0-means clustering ; @xcite , who apply @xmath0-means clustering via the principal points of random functions ; @xcite , who develop methods for sparsely sampled functional data that employ spline representations ; @xcite , where the robust @xmath0-means method for functional clustering is developed ; @xcite , who use a fourier representation for the functions along with @xmath0-means clustering ; @xcite , where a bayesian hierarchical clustering approach that relies on spline representations is proposed ; @xcite , who build a hierarchical bayesian model that employs a bayesian nonparametric mixture model on the coefficients of the wavelet representations ; and @xcite , where a @xmath0-centers functional clustering approach is developed that relies on the karhunen ",
    "love representation of the underlying stochastic process generating the curves and accounts for both the means and the modes of variation differentials between clusters .",
    "all of the functional clustering methods described above have been designed for situations where a single curve is observed for each subject or experimental condition .",
    "extensions to nested designs where multiple curves are collected per subject typically assume that coefficients describing subject - specific curves arise from a common parametric distribution , and clustering procedures are then applied to the parameters of this underlying distribution .",
    "the result is a procedure that generates clusters of subjects based on their average response curve , which is not appropriate in applications in which subjects vary not only in the average but also in the variability of the replicate curves . for example , in studies of trajectories in reproductive hormones that collect data from repeated menstrual cycles , the average trajectory may provide an inadequate summary of a woman s reproductive functioning .",
    "some women have regular cycles with little variability across cycles in the hormone trajectories , while other women vary substantially across cycles , with a subset of the cycles having very different trajectory shapes .",
    "in fact , one indication of impending menopause and a decrease in fecundity is an increase in variability across the cycles .",
    "hence , in forming clusters and characterizing variability among women and cycles in hormone trajectories , it is important to be flexible in characterizing both the mean curve and the distribution about the mean .",
    "this situation is not unique to hormone data , and similar issues arise in analyzing repeated medical images as well as other applications .",
    "this paper discusses hierarchical bayes models for clustering nested functional data in the context of the early pregnancy study ( eps ) [ @xcite ] , where progesterone profiles were collected for both conceptive and nonconceptive women from multiple menstrual cycles .",
    "our models use spline bases along with mixture priors to create sparse but flexible representations of the hormone profiles , and can be applied directly to other basis systems such as wavelets .",
    "we start by introducing a hierarchical random effects model on the spline coefficients which , along with a generalization of the dirichlet process mixture ( dpm ) prior [ @xcite ] , allows for mean - response - curve clustering of women , in the spirit of @xcite . then , we extend the model to generate distribution - based clusters using a nested dirichlet process ( ndp ) [ @xcite ] .",
    "the resulting model simultaneously clusters both curves and subjects , allowing us to identify outlier curves within each group of women , as well as outlying women whose distribution of profiles differs from the rest . to the best of our knowledge",
    ", there is no classical alternative for this type of distribution - based multilevel clustering .        in order to provide some insight into the challenges associated with functional clustering in the context of the eps ,",
    "consider the hormonal profiles depicted in figure  [ fihorpro ] .",
    "frames ( a ) to ( c ) depict the hormone profiles for 3 women , while frame  ( d ) shows the mean profile corresponding to each one of them , obtained by simply averaging all available observations at a given day within the cycle . when looking at the mean profiles in ( d ) , women 43 and 36 seem to have very similar hormonal responses , which are different from those of woman 3 .",
    "however , when the individual profiles are considered , it is clear that most of the cycles of woman 43 look like those of woman 3 and that the big difference in the means is driven by the single abnormal cycle .",
    "this result , although not surprising if we consider that means are notoriously nonrobust , suggests that simple approaches that average profiles over individuals ( or , equivalently , use gaussian distributions to describe subject - specific variability ) might not be the most appropriate for this type of data .",
    "the use of bayesian nonparametric mixture models for clustering has a long history [",
    "@xcite ] and presents a number of practical advantages over other model - based clustering techniques .",
    "nonparametric mixtures induce a probability distribution on the space of partitions of the data , therefore , we do not need to specify in advance the number of clusters in the sample .",
    "once updated using the data , this distribution on partitions allows us to assess variability , and hence characterize uncertainty in the clustering structure ( including that associated with the estimation of the curves ) , providing a more complete picture than classical methods . in this paper",
    ", we work with a generalized dirichlet process ( gdp ) first introduced by @xcite and study some of its properties as a clustering tool . in particular , we show that the gdp generates a richer prior on data partitions than those induced by popular models such as the dirichlet process [ @xcite ] or the two - parameter poisson ",
    "dirichlet process [ @xcite ] , as it allows for an asymptotically bounded number of clusters in addition to logarithmic and power - law rates of growth",
    ".    the paper is organized as follows : section  [ semixfunc ] reviews the basics of nonparametric regression and functional clustering , while section  [ sebnpmixfunc ] explores the design of nonparametric mixture models for functional clustering .",
    "building on these brief reviews , section  [ sefunclustnested ] describes two bayesian approaches to functional clustering in nested designs , while section  [ secompu ] describes markov chain monte carlo algorithms for this problem .",
    "an illustration focused on the eps is presented in section  [ seillus ] .",
    "finally , section  [ seconclusion ] presents a brief discussion and future research directions .",
    "to introduce our notation , consider first a simple functional clustering problem where multiple noisy observations are collected from functions @xmath1 . more specifically , for subjects @xmath2 and within - subject design points @xmath3 , observations consist of ordered pairs @xmath4 , where @xmath5 for example , in the eps , @xmath6 corresponds to the level of progesterone in the blood of woman @xmath7 collected at day @xmath8 of the menstrual cycle , and @xmath9 denotes a smooth trajectory in progesterone for woman @xmath7 ( initially supposing a single menstrual cycle of data from each woman ) , and clusters in @xmath10 could provide insight into the variability in progesterone curves across women , while potentially allowing us to identify abnormal or outlying curves .    if all curves are observed at the same covariate levels ( i.e. , @xmath11 and @xmath12 for every @xmath7 ) , a natural approach to functional clustering is to apply standard clustering methods to the data vectors , @xmath13 .",
    "for example , in the spirit of @xcite , one could apply hierarchical or @xmath0-means clustering to the first few principal components [ @xcite ] . alternatively , with uneven spacings or missing observations , nonparametric regression techniques such as kernel regression [ e.g. , see @xcite ] could be used to interpolate the value of the curves to a common grid , and then traditional clustering techniques could be applied . from a model - based perspective , one could instead suppose that @xmath14 is drawn from a mixture of @xmath0 multivariate gaussian distributions , with each gaussian corresponding to a different cluster [ @xcite ] .",
    "the number of clusters could then be selected using the bic criteria [ @xcite ] or a nonparametric bayes approach could be used to bypass the need for this selection , while allowing the number of clusters represented in a sample of @xmath15 individuals to increase stochastically with sample size [ @xcite ] . a more general approach that allows us to deal with unevenly spaced and missing observations",
    "is to fit a nonparametric model to each curve and then project all the curves onto a common space .",
    "for example , we can represent the unknown function @xmath9 as a linear combination of prespecified basis functions @xmath16 , that is , we can write @xmath17 where @xmath18 are basis coefficients specific to subject @xmath7 , with variability in these coefficients controlling variability in the curves @xmath10 . a common approach to functional clustering is to induce clustering of the curves through clustering of the basis coefficients [ @xcite ] .",
    "then the methods discussed above for clustering of the data vectors @xmath19 in the balanced design case can essentially be applied directly to the basis coefficients @xmath20 .",
    "although the methods apply directly to other choices of basis functions , our focus will be on splines , which have been previously used in the context of hormone profiles [ @xcite ] ; given a set of knots @xmath21 , the @xmath0th member of the basis system is defined as @xmath22 where @xmath23 .",
    "given the knot locations , inferences on @xmath24 and @xmath25 can be carried out using standard linear regression tools , however , selecting the number and location of the nodes @xmath26 can be a challenging task .",
    "a simple solution is to use a large number of equally spaced knots , together with a penalty term on the coefficients to prevent overfitting . from a bayesian perspective",
    ", this penalty term can be interpreted as a prior on the spline coefficients ; for example , the maximum likelihood estimator ( mle ) obtained under an @xmath27 penalty on the spline coefficients is equivalent to the maximum a posteriori estimates for a bayesian model under a normal prior , while the mle under an @xmath28 penalty is equivalent to the maximum a posterior estimate under independent double - exponential priors on the spline coefficients .    instead of the more traditional gaussian and double exponential priors , in this paper we focus on zero - inflated priors , in the spirit of @xcite .",
    "priors of this type enforce sparsity by zeroing out some of the spline coefficients and , by allowing us to select a subset of the knots , provides adaptive smoothing . in their simpler form ,",
    "zero - inflated priors assume that the coefficients are independent from each other and that @xmath29 where @xmath30 denotes the degenerate distribution putting all its mass at @xmath31 , @xmath32 controls the overdispersion of the coefficients with respect to the observations and @xmath33 is the prior probability that the coefficient @xmath34 is different from zero . in order to incorporate a priori dependence across coefficients , we can reformulate the hierarchical model by introducing bernoulli random variables @xmath35 such that @xmath36 where @xmath37 and @xmath38 are , respectively , the vectors of responses and covariates associated with subject @xmath7 , @xmath39 is the matrix of basis functions also associated with subject @xmath7 with entries @xmath40_{tk } = b_k(x_{it})$ ] , @xmath41 and @xmath42 equals 1 independently with probability @xmath33 , and @xmath43 is a @xmath44 covariance matrix .",
    "note that if @xmath43 is a diagonal matrix and @xmath45_{kk } = \\omega_k$ ] , we recover the independent priors in ( [ eqzeroinfpr ] ) .",
    "for the single curve case , choices for  @xmath43 based on the regression matrix @xmath46 are discussed in @xcite , @xcite and @xcite .",
    "although the preceding two - stage approach is simple to implement using off - the - shelf software , it ignores the uncertainty associated with the estimation of the basis coefficients while clustering the curves . in the spirit of @xcite ,",
    "an alternative that deals with this issue is to employ a mixture model of the form @xmath47 where @xmath48 is the vector of coefficients associated with the @xmath0th cluster , @xmath49 is the diagonal selection matrix for the @xmath0th cluster , @xmath50 is the observational variance associated with observations collected in the @xmath0th cluster , @xmath51 can be interpreted as the proportion of curves associated with cluster @xmath0 , and @xmath52 is the maximum number of clusters in the sample . from a frequentist perspective , estimation of this model can be performed using expectation  maximization ( em ) algorithms , while selection of the number of mixture components can be carried out using the bic . alternatively , bayesian inference can be performed for this model using markov chain monte carlo ( mcmc ) algorithms once appropriate priors for the vector @xmath53 and the cluster - specific parameters @xmath54 have been chosen , opening the door to simple procedures for the estimation of the number of clusters in the sample .",
    "note that the model in ( [ eqsimplmodel ] ) can be rewritten as a hierarchical model by introducing latent variables @xmath55 so that @xmath56\\\\[-8pt ] g(\\cdot ) & = & \\sum_{k=1}^{k } w_k \\delta_{({\\bolds{\\theta}}^{*}_k , \\sigma ^{*2}_k , { \\bolds{\\lambda}}_k^ { * } ) } ( \\cdot).\\nonumber\\end{aligned}\\ ] ] therefore , specifying a joint prior on @xmath57 and @xmath58 is equivalent to specifying a prior on the discrete distribution @xmath59 generating the latent variables @xmath60 . in this section",
    "we discuss strategies to specify a flexible prior distribution on this mixing distribution in the context of functional clustering .",
    "in particular , we concentrate on nonparametric specifications for @xmath59 through the class of stick - breaking distributions . a stick - breaking prior [ @xcite ] with baseline measure @xmath61 and precision parameters @xmath62 and @xmath63",
    "is defined as @xmath64 where the atoms @xmath65 are independent and identically distributed samples from @xmath61 and the weights @xmath66 are constructed as @xmath67 , with @xmath68 another independent and identically distributed sequence of random variables such that @xmath69 for @xmath70 and @xmath71 . for example , taking @xmath72 , @xmath73 and @xmath74 for @xmath75 and @xmath76 yields the two - parameter poisson ",
    "dirichlet process [ @xcite ] , denoted @xmath77 , with the choice @xmath78 resulting in the dirichlet process [ @xcite ] , denoted @xmath79 . in mixture models such as ( [ eqsimplmodelh ] ) , @xmath61 acts as the common prior for the cluster - specific parameters @xmath80 , while the sequences @xmath81 and @xmath82 control the a priori expected number and size of the clusters .",
    "the main advantage of nonparametric mixture models such as the poisson  dirichlet process as a clustering tool is that they allow for automatic inferences on the number of components in the mixture . indeed",
    ", these models induce a prior probability on all possible partitions of the set of observations , which is updated based on the information contained in the data",
    ". however , poisson ",
    "dirichlet processes have two properties that might be unappealing in our eps application ; first , they place a relatively large probability on partitions that include many small clusters and , second , they imply that the number of clusters will tend to grow logarithmically ( if @xmath78 ) or as a power law ( if @xmath83 ) as more observations are included in the data set .",
    "however , priors that favor of increasing numbers of clusters without bound as the number of subjects increase have some disadvantages in terms of interpretability and sparsity in characterizing high - dimensional data .",
    "for example , in applying dp mixture models for clustering of the progesterone curves in eps , @xcite obtained approximately 32 different clusters , with half of these clusters singletons .",
    "many of the clusters appeared similar , and it may be that this large number of clusters was partly an artifact of the dp prior .",
    "@xcite proposed a local partition process prior to reduce dimensionality in characterizing the curves , but this method does not produce easily interpretable functional clusters .",
    "hence , it is appealing to use a more flexible global clustering prior that allows the number of clusters to instead converge to a finite constant . with this motivation ,",
    "we focus on the generalized dirichlet process ( gdp ) introduced by @xcite , denoted @xmath84 .",
    "the gdp corresponds to a stick - breaking prior with @xmath72 , @xmath85 and @xmath86 for all @xmath0 . when compared against the poisson ",
    "dirichlet process , the gdp has quite distinct properties .",
    "[ thnumclust ] let @xmath87 be the number of distinct observations in a sample of size @xmath88 from a distribution @xmath59 , where @xmath89 .",
    "the expected number of clusters @xmath90 is given by @xmath91    the proof can be seen in appendix  [ approofexpnumc ] . note that for @xmath92 , this expression simplifies to @xmath93 , a well - known result for the dirichlet process [ @xcite ] .",
    "letting @xmath94 denote the change in the number of clusters in adding the @xmath88th individual to a sample with @xmath95 subjects , stirling s approximation can be used to show that @xmath96 where @xmath97 .",
    "hence , @xmath98 as and new clusters become increasingly rare as the sample size increases .",
    "note that for @xmath99 , the number of clusters will grow slowly but without bound as @xmath88 increases , with @xmath100 .",
    "the rate of growth in this case is proportional to @xmath101 , which is similar to what is obtained by using the poisson dirichlet prior [ @xcite ] .",
    "however , when @xmath102 the expected number of clusters instead converges to a finite constant , which is a remarkable difference compared with the dirichlet and poisson  dirichlet process . as mentioned above , there may be a number of practical advantages to bounding the number of clusters .",
    "in addition , a  finite bound on the number clusters seems to be more realistic in many applications , including the original species sampling applications that motivated much of the early development in this area [ @xcite ] . in order to gain further insight into the clustering structure induced by the @xmath84 , we present in figure  [ ficluststruc ] the relationship between the size of the largest cluster and the mean number of clusters in the partition ( left panel ) , and the mean cluster size and the number of clusters ( right panel ) for a sample of size @xmath103 .",
    "the numbers presented in this figure are based on the results from 20,000 simulations from the stick - breaking prior .",
    "each continuous line corresponds to a combination of shape parameters such that @xmath104 is constant , while the dashed line in the plots corresponds to the combinations available under a dirichlet process .",
    "the plots demonstrate that the additional parameter in the gdp allows us to simultaneously control the number of clusters and the relative size of the clusters , increasing the flexibility of the model as a clustering procedure .     for a sample of size @xmath103 .",
    "panel   shows the relationship between the size of the largest cluster and the mean number of clusters for different gdps , where each curve shares a common @xmath105 .",
    "panel shows the relationship between the average cluster size and the mean number of clusters .",
    "the dashed lines correspond to the combinations available under a standard dirichlet process . ]",
    "the previous discussion focused on the impact of the prior distribution for the mixture weights on the clustering structure .",
    "another important issue in the specification of the model is the selection of the baseline measure @xmath61 .",
    "note that in the functional clustering setting @xmath106 and , therefore , a computationally convenient choice that is in line with our previous discussion on basis selection and zero - inflated priors is to write @xmath107 a prior of this form allows differential adaptive smoothing for each cluster in the data ; the level of smoothness is controlled by @xmath33 ( the prior probability of inclusion for each of the spline coefficients ) and , therefore , it is convenient to assign to it a hyperprior such as @xmath108 .",
    "consider now the case where multiple curves are collected for each subject in the study . in this case , the observations consist of ordered pairs @xmath109 where @xmath110 where @xmath111 is the @xmath112th functional replicate for subject @xmath7 , with @xmath113 , @xmath114 and @xmath115 .",
    "for example , in the eps , @xmath111 is the measurement error - corrected smooth trajectory in the progesterone metabolite pdg over the @xmath112th menstrual cycle from woman @xmath7 , with @xmath116 indexing the sample number and @xmath117 denoting the day within the @xmath118 menstrual cycle relative to a marker of ovulation day .",
    "a natural extension of ( [ eqsimplmodelh ] ) to nested designs arises by modeling the expected evolution of progesterone in time for cycle @xmath112 of woman @xmath7 as @xmath119 and using a hierarchical model for the set of curve - specific parameters @xmath120 in order to borrow information across subjects and/or replicates . in the following subsections ,",
    "we introduce two alternative nonparametric hierarchical priors that avoid parametric assumptions on the distribution of the basis coefficients , while inducing hierarchical functional clustering .      as a first approach",
    ", we consider a gaussian mixture model , which characterizes the basis coefficients for functional replicate @xmath112 from subject @xmath7 as conditionally independent draws from a gaussian distribution with subject - specific mean and variance , in the spirit of @xcite : @xmath121\\\\[-8pt ] g_i & = & \\mathsf{n}\\bigl ( { \\bolds{\\lambda}}_i { \\bolds{\\theta}}_i , \\sigma^2_{i } { \\bolds{\\sigma}}\\bigr),\\nonumber\\end{aligned}\\ ] ] where @xmath122 are as described in expression ( [ eqsimplmodelh ] ) and @xmath123 is a @xmath124 covariance matrix . in this model , the average curve for subject @xmath7",
    "is obtained as @xmath125 , with @xmath126 providing a mechanism for subject - specific basis selection , so that the curves from subject @xmath7 only depend on the basis functions corresponding to nonzero diagonal elements of @xmath126 .",
    "the variability in the replicate curves for the same subject is controlled by @xmath127 , with the subject - specific multiplier allowing subjects to vary in the degree of variability across the replicates .",
    "the need to allow such variability is well justified in the hormone curve application .    in order to borrow information across women ,",
    "we need a hyperprior for the woman specific parameters @xmath128 .",
    "since we are interested in clustering subjects , a natural approach is to specify this hyperprior nonparametrically through a generalized dirichlet process centered around the baseline measure in ( [ eqbaselme ] ) , just as we did for the single curve case .",
    "this yields @xmath129 with @xmath61 given in ( [ eqbaselme ] ) .",
    "since the distribution @xmath59 is almost surely discrete , the model identifies clusters of women with similar average curves . this is clearer if we integrate the curve - specific coefficients @xmath130 and the unknown distribution @xmath59 out of the model to obtain @xmath131\\\\[-8pt]\\nonumber & & \\qquad \\sim \\sum_{k=1}^{k } w_k \\biggl\\ { \\prod_{j=1}^{n_i } \\mathsf{n } \\bigl ( { \\mathbf{b } } ( { \\mathbf{x}}_{ij } ) { \\bolds{\\lambda}}_k^ { * } { \\bolds{\\theta}}_k^ { * } , \\sigma^{*2}_{k } ( \\mathbf{i } + { \\bolds{\\sigma } } ) \\bigr ) \\biggr\\}.\\end{aligned}\\ ] ]    by incorporating the distribution of the selection matrices @xmath132 in the random distribution @xmath59",
    ", this model allows for a different smoothing pattern for each cluster of curves .",
    "this is an important difference with a straight generalization of the model in @xcite , who instead treat the selection matrix as a hyperparameter in the baseline measure @xmath61 and therefore induce a common smoothing pattern across all clusters .",
    "the model is completed by assigning priors for the hyperparameters . for the random effect variances we take inverse - wishart priors : @xmath133    in the spirit of the unit information priors [ @xcite ] , the hyperparameters for these priors can be chosen so that @xmath134 and @xmath135 are proportional to @xmath136 finally , the concentration parameters @xmath137 and @xmath138 are given gamma priors @xmath139 and @xmath140 and the probability of inclusion @xmath33 is assigned a beta prior , @xmath141 .      because the subject - specific distributions @xmath142 were assumed to be gaussian and the nonparametric prior was placed on their means , the model in the previous section clusters subjects based on their average profile . however , as we discussed in section  [ seintro ] , clustering based on the mean profiles might be misleading in studies such as the eps in which there are important differences among subjects in not only the mean curve but also the distribution about the mean . in hormone curve applications , it is useful to identify clusters of trajectories over the menstrual cycle to study variability in the curves and identify outlying cycles that may have reproductive dysfunction .",
    "it is also useful to cluster women based not simply on the average curve but on the distribution of curves . with this motivation in mind , we generalize our hierarchical nonparametric specification to construct a model with additional parameters that enables clustering based on more than proximity between the mean curves .",
    "this generalization further enables clustering within subjects as well as subjects .    to motivate our nonparametric construction , consider first the simpler case in which there are only two types of curves in each cluster of women ( say , normal and abnormal ) , so that it is natural to model the subject - specific distribution as a two - component mixture where @xmath143\\\\[-8pt]\\nonumber & & \\qquad \\sim \\varpi_i \\mathsf{n}\\bigl ( { \\mathbf{b}}({\\mathbf{x}}_{ij } ) { { \\bolds{\\lambda}}}_{1i } { { \\bolds{\\theta}}}_{1i } , { \\sigma}^2_{1i } \\mathbf{i } \\bigr ) + ( 1-\\varpi_i ) \\mathsf{n}\\bigl({\\mathbf{b } } ( { \\mathbf{x}}_{ij } ) { { \\bolds{\\lambda}}}_{2i } { { \\bolds{\\theta}}}_{2i } , { \\sigma}^2_{2i } \\mathbf{i } \\bigr),\\end{aligned}\\ ] ] @xmath144 can be interpreted as the proportion of curves from subject @xmath7 that are in group 1 ( say , normal ) , and @xmath145 are the parameters that describe curves from a normal cycle , @xmath146 is a diagonal variable selection matrix for the normal cycles that zeroes out unnecessary coefficients to avoid overfitting , @xmath147 are the parameters describing the curves from an abnormal cycle , and @xmath148 is the variable selection matrix for the abnormal cycles .",
    "note that in this case we have not one but two variance parameters for each individual , which provide additional flexibility by allowing each cluster of curves to present a different level of observational noise .",
    "this feature is desirable in the eps because , for a given woman , observational noise in abnormal cycles tends to be larger than in normal cycles .    under this formulation ,",
    "the subject - specific distribution is described by the vector of parameters @xmath149 , and clustering subjects could be accomplished by clustering these vectors .",
    "we can accomplish this by using another mixture model that mimics ( [ eqsimplmodel ] ) and ( [ eqjointliksinglecurve ] ) , so that @xmath150    to formulate our bayesian nonparametric model for clustering , we start by rewriting ( [ eqtwocomponent ] ) as a general mixture model where @xmath151 and @xmath152 is a discrete distribution which is assigned a nonparametric prior .",
    "note that this is analogous to the formulation in ( [ eqmeanclustre ] ) , but by replacing the gaussian distribution with a random distribution with a nonparametric prior we are modeling the within - subject variability by clustering curves into groups with homogeneous shape .",
    "now , we need to define a prior over the collection @xmath153 that induces clustering among the distributions . for example",
    ", we could use a discrete distribution _",
    "whose atoms are in turn random distributions _ , for example , @xmath154 where @xmath155 , @xmath156 and @xmath157 independently .",
    "this implies that @xmath158 with @xmath159 and @xmath160 and @xmath61 as in ( [ eqbaselme ] ) .",
    "therefore , if we were to replace the collection @xmath161 with random discrete distributions with only two atoms and we were to integrate over the random distributions @xmath153 , this model would be equivalent to ( [ eqtwocomponent ] ) with @xmath72 .",
    "this model on the collection @xmath153 is a generalization of the nested dirichlet process introduced in @xcite and , as with other models based on nested nonparametric processes , interesting special cases can be obtained by considering the limit of the precision parameters .",
    "for example , letting @xmath162 while keeping @xmath163 fixed induces a model where all menstrual cycles within a woman are assumed to have the same profile , and subjects are clustered according to their mean cycle .",
    "such a model is equivalent to the one obtained by taking @xmath164 in ( [ eqmeanclustre ] ) . on the other hand , by letting @xmath165 while keeping @xmath166 constant , we obtain a model where all subjects are treated as different and menstrual cycles are clustered within each women . in this case , information is borrowed across the menstrual cycles of each women , but not across women .",
    "intuitively , we can think of the model we just described as first clustering curves within a subject via a model - based version of @xmath0-means applied to the subject - specific basis coefficients .",
    "then , two subjects having similar distributions of curve clusters will be clustered together . because we use a joint hierarchical model ,",
    "these stages are done simultaneously .",
    "again , the model is completed by specifying prior distributions on the remaining parameters . as before , we let @xmath167 , @xmath168 and @xmath108 , providing a conditionally conjugate specification amenable for simple computational implementation . finally , for the precision priors of the gdps we set @xmath169",
    "as is commonplace in bayesian inference , we resort to markov chain monte carlo ( mcmc ) algorithms [ @xcite ] for computation in our functional clustering models . given an initial guess for all unknown parameters in the model , the algorithms proceed by sequentially sampling blocks of parameters from their full conditional distributions .",
    "in particular , we design our algorithms using truncated versions of the gdp and the nested gdp , where a large but finite number of atoms are used to approximate the nonparametric mixture distributions .",
    "well - known results on the convergence of truncations as the number of atoms grows that were originally presented in @xcite and @xcite can be directly extended to this problem ( see appendix  [ aptruncgdp ] ) .",
    "furthermore , because most components of the model are conditionally conjugate , most of the full conditional distributions can be directly sampled using gibbs steps .",
    "full details of the algorithm can be seen in the online supplementary materials [ @xcite ] .",
    "convergence of the mcmc algorithms was assessed using the multi - chain method described in @xcite , which was applied to monitor the ( unnormalized ) posterior distribution , as well as the number of occupied clusters on each level of the model and the frobenius norm of the matrices @xmath43 and @xmath123 .",
    "progesterone plays a crucial role in controlling different aspects of reproductive function in women , from fertilization to early development and implantation .",
    "therefore , understanding the variability of hormonal profiles across the menstrual cycle and across subjects is important in understanding mechanisms of infertility and early pregnancy loss , as well as for approaches for identifying abnormal menstrual cycles and women for diagnostic purposes .",
    "our data , extracted from the early pregnancy study [ @xcite ] , consists of log daily creatinine - corrected concentrations of pregnanediol-3-glucuronide ( pdg ) for 60 women along multiple menstrual cycles , measured in micrograms per milligram of creatinine ( g@xmath170ml cr ) .",
    "we focus on day intervals extending from 10 days before ovulation to 2 days after ovulation .",
    "according to the results in @xcite , this interval should include the fertile window of the menstrual cycle during which noncontracepting intercourse has a nonneglible probability of resulting in a conception .",
    "also , for this illustration we considered only nonconceptive cycles and women with at least four cycles in each record .",
    "therefore , the number of curves per woman varies between 4 and 9 .",
    "we analyzed the eps data using both the mean - based clustering model described in section  [ semeanclustering ] and the distribution - based clustering model of section  [ sedistclustering ] .",
    "these models where fitted using the algorithms from section  [ secompu ] . in the mean - based clustering algorithm , the gdp was truncated so that @xmath171 , while in the distribution - based algorithm the nested gdp was truncated so that @xmath171 and @xmath172 .",
    "although these numbers might seem large given the sample sizes involved , a large number of empty components are helpful in improving the mixing of the algorithms . in both cases , we used piecewise linear splines ( @xmath173 ) and @xmath174 knots , corresponding to each of the days considered in the study .",
    "all inferences presented in this section are based on 100,000 samples obtained after a burn - in period of 10,000 iterations .",
    "prior distributions in the mean - based clustering algorithm were set as follows . for the concentration parameters , we used proper priors @xmath175 and @xmath176 , and for the observational variance , we set @xmath177 , so that @xmath178 . note",
    "that setting @xmath179 a priori is natural because ( as we discussed in section  [ sebnpmixfunc ] ) the asymptotic behavior of the expected number of clusters is different if @xmath102 or @xmath180 . on the other hand ,",
    "the prior mean for @xmath181 is based on information from previous studies . to allow uncertainty in the probability of basis selection within the base measure",
    ", we let @xmath182 , implying that we expect about one - third of the spline basis functions to be used in any given cluster .",
    "priors for the distribution - based clustering algorithm were chosen in a similar way , with @xmath183 , @xmath184 , @xmath185 and @xmath186 , while for the baseline measure we picked a prior with the inclusion probabilities @xmath187 and the prior on the group specific variances as given by @xmath188 .    , @xmath138 , @xmath166 , @xmath189 , @xmath163 and @xmath190 .",
    "@xmath191 ( subject - level clustering ) ,  @xmath192 ( curve - level clustering ) . ]    to better understand the effect of our prior on @xmath137 , @xmath138 , @xmath166 , @xmath189 , @xmath163 and @xmath190 , we show in figure  [ fipriorcomp ] the prior expected number of clusters implied by our choices . in particular , figure  [ fipriorcomp](a ) shows that , a priori , we expect between 1 and 8 clusters of subjects with high probability , with the most likely prior value being 3 clusters ( note that this applies to both the mean - based and the distribution - based clustering methods ) .",
    "on the other hand , figure  [ fipriorcomp](b ) shows that , for a subject for which 7 cycles have been observed , we expect between 1 and 3 clusters with high probability . on the other hand ,",
    "to assess the effect of the prior choices on the results , we conducted a small sensitivity analysis .",
    "in particular , the priors for @xmath137 , @xmath138 , @xmath166 , @xmath163 , @xmath189 and @xmath190 were replaced with exponential distributions with mean 2 .",
    "the induced priors on the number of clusters have similar modes to our original specifications but have higher variability , placing substantially more mass on larger number of clusters .",
    "although the posterior distribution for these parameters was somewhat affected , we did not see any substantial change in our posterior inferences on the clustering structure or the curve shapes ( which are the main focus of our analysis ) .",
    "similarly , we explored the effect of a @xmath193 prior on @xmath33 and an @xmath194 prior on @xmath181 without any significant change in the estimates of the hormonal profiles .",
    "we start our analysis by comparing the clustering structure generated by the mean - based and distribution - based models considered in section  [ sefunclustnested ] . for this purpose ,",
    "we show in figures  [ fipairhormeanclust ] and [ fipairhordistclust ] heatmaps of the average pairwise clustering probability matrix under these two models .",
    "entry @xmath195 of the matrix contains the posterior probability that observations @xmath7 and @xmath112 are assigned to the same cluster .",
    "the black squares in the plots correspond to point estimates of the clustering structure obtained through the method described in @xcite . in our case ,",
    "the point estimate is obtained by minimizing a loss function that assigns equal weights to all pairwise misclassification errors .",
    "therefore , the resulting plots provide information about the optimal clustering structure for the data as well as the uncertainty associated with it",
    ".    figures  [ fipairhormeanclust ] and [ fipairhordistclust ] show that the structure of the clusters generated by both models are similar .",
    "for example , cluster 1 from mean - based clustering ( counting from the bottom left corner of figure  [ fipairhormeanclust ] ) contains similar subjects as cluster 1 from distribution - based clustering ( counting from the bottom left corner of figure  [ fipairhordistclust ] ) .",
    "the same is true for cluster 2 from both algorithms , and for cluster 5 from the mean - based clustering model and cluster 4 from the distribution - based model .",
    "there are also similarities in the structure of the outlier clusters ( corresponding to the small clusters at the top and right of both heat maps ) .",
    "both models assign subject 25 to a singleton cluster , while grouping subjects 21 and 53 into a pair , with subjects 40 and 51 in a separate pair .",
    "there are also some important differences between the two methods .",
    "mean - based clustering groups subjects 36 and 43 together and assigns subject 3 to a different cluster ( figure  [ fihorpro ] shows differences in the mean curve of subject 3 ) , while distribution - based cluster groups subjects 3 and 43 together and assigns 36 to a different group .",
    "the behavior illustrates the robustness of distribution - based clustering , because except for a single outlier cycle for subject 43 , the curves for this subject are much more similar to those of subject 3 than those of 36 .",
    "mean - based clustering also treats subjects 11 and 56 as singletons , while distribution - based clustering assigns them to the large cluster 4 ( counting from the bottom left ) .",
    "visually the raw profiles for subjects 11 and 56 are not very different from other profiles in cluster 4 [ see panels ( d ) , ( e ) and ( f ) of figure  [ fihorraw2 ] ] , so this behavior seems reasonable .    .",
    "white corresponds to zero probability , while red corresponds to 1 .",
    "the squares correspond to a point estimate of the cluster structure in the data . ]    .",
    "white corresponds to zero probability , while red corresponds to 1 .",
    "the squares correspond to a point estimate of the cluster structure in the data . ]",
    "figure  [ firechor ] shows reconstructed profiles under the distribution - based clustering model for some representative women in each of the main four groups .",
    "most profiles are flat before ovulation , when hormone levels start to increase .",
    "also , in most clusters the profiles tend to be relatively consistent for any single woman .",
    "however , we can see some outliers , typically corresponding to elevated post - ovulation levels and/or early increases in the hormone levels .",
    "cluster 3 corresponds to women with very low hormonal levels , even after ovulation .",
    "this group has few outliers , and those present are characterized by a slightly larger increase in progesterone after ovulation , which is still under 1  g@xmath170ml cr .",
    "group 2 shows much more diversity in the hormonal profiles , as well as a slightly higher baseline level in progesterone level and an earlier rise in progesterone than group 3 .",
    "group 1 tends to show few outliers , and otherwise differs from the previous ones in a higher baseline level and an early and very fast increase in progesterone .",
    "finally , group 4 presents `` normal '' cycles with the highest baseline level of progesterone ( 1  g@xmath170ml cr ) and the fastest increase in progesterone after ovulation , along with `` abnormal '' cycles with even higher baseline levels and very extreme levels of progesterone after ovulation ( close to 5  g@xmath170ml cr ) .            for comparison we also applied a simple functional clustering approach based on kernel smoothing and hierarchical clustering .",
    "we first fitted a gaussian kernel smoother [ @xcite ] to each of the curves , generated fitted values over a common grid ( in this example we used 6 equally - spaced knots ) , then computed the average predicted values for each subject at each point of the grid , and finally applied complete - linkage hierarchical clustering ( as implemented in the ` r ` package ` mclust ` ) , with the number of clusters selected using  bic .",
    "this approach identified 7 clusters ; figure  [ fidendogram ] shows the associated dendogram , where colors are used to represent the clusters .",
    "some of these clusters are similar to the ones identified by the mean - based clustering model .",
    "for example , the small cluster of 5 subjects ( 3 , 10 , 37 , 45 and 48 ) , corresponding to the fourth cluster from the bottom left in figure  [ fipriorcomp ] , is perfectly identified by hierarchical clustering .",
    "similarly , subjects 21 , 25 , 40 , 51 and 53 , which are all identified as outliers by the mean - based clustering model , are allocated to a single cluster by the hierarchical clustering approach .",
    "however , the majority of the clustering pattern generated by this method is quite different from the one obtained with mean - based or the distribution - based clustering .",
    "furthermore , the number and structure of clusters depends heavily on the number and location of grid points used to interpolate the functions .",
    "for example , when the interpolation grid contains 5 knots we obtain 8 clusters , while 18 clusters are obtained when 11 knots are used for interpolation .",
    "part of this difference could be due to the fact that , because most of the missing values tend to concentrate at the beginning of the cycle , many of the fitted functional values correspond to extrapolations rather than interpolations when a large number of knots are used .",
    "we also note that posterior estimates of the precision parameters on the gdp suggest that a logarithmic rate of growth for the expected number of clusters might be reasonable for this data . for the mean - based clustering ,",
    "the posterior mean for @xmath137 was @xmath196 and the 95% posterior symmetric credible interval was @xmath197 , while the posterior mean for @xmath138 was @xmath198 with 95% credible interval @xmath199 . for the distribution - based clustering ,",
    "the corresponding estimates are @xmath200 @xmath201 and @xmath202 @xmath203 for @xmath166 and @xmath189 , and @xmath204 @xmath205 and @xmath206 @xmath207 for @xmath163 and @xmath190 .",
    "finally , we investigated the relationship between the clusters we identified using our distribution - based clustering algorithm and a series of covariates available for each subject , including age at the beginning of the study ( age ) , age of first menses ( age_mense ) , average length of menses ( mense_length ) , race ( race ) , body mass index ( bmi ) , whether the subject had been taking contraceptives before the start of the study ( ev_pill ) and whether the subject self reports as a consumer of marijuana during the period of the study ( marijuana_use ) . to investigate this relationship",
    ", we used a classification tree , as implemented in the ` r ` package ` rpart ` . to simplify interpretation , we merged all the small outlier clusters into a single group ( which we label cluster 5 ) .",
    "the resulting classification tree ( obtained using a cp value of 0.03 for pruning ) can be seen in figure  [ ficlasstree ] .",
    "note that race and marijuana consumption do not appear to play any role in predicting the shape of the hormonal profiles . on the other hand , bmi ,",
    "along with age , menses length and menses age , seems to have some predictive capability .",
    "for example , a bmi higher than 22 and an age of menses under 12 years old seem to predict progesterone profiles like the ones observed in cluster 3 .",
    "we have presented two approaches to functional clustering in nested designs .",
    "these approaches look into different features of the nested samples and are therefore applicable in different circumstances .",
    "our mean - based clustering approach is easier to interpret and provides an excellent alternative when within - subject samples are homogenous .",
    "however , when within - subject curves are heterogeneous , mean - based clustering can lead to biased results .",
    "therefore , in studies such as the eps , distribution - based models such as the one described here provide a viable alternative that acknowledges the heterogeneity in the function replicates from a subject .",
    "one interesting insight that can be gathered from the results of the eps data is that , for small numbers of functional replicates per subject and rare outliers , the effect of the distribution - based clustering is to perform clustering based on the modal rather than the mean profile .",
    "that is , the distribution - based clustering model is able to automatically discount the abnormal curves , leading to more appropriate clustering patterns if the effect of outliers needs to be removed .",
    "naturally , this perceived advantage of the distribution - based clustering method implicitly assumes that abnormal curves should be discounted .",
    "although that assumption is justified in our application , users should be aware of it when applying our method to other data sets .",
    "let @xmath208 be a sequence of independent and identically distributed samples from a random distribution @xmath59 , which follows a @xmath84 distribution .",
    "also , let @xmath209 be 1 if @xmath210 is different from every @xmath211 , and zero otherwise . clearly , @xmath212 is the number of distinct values among the first @xmath88 samples form a @xmath84 .",
    "@xcite shows that @xmath213 which completes the proof .",
    "[ thbounds ] assume that samples of @xmath88 observations have been collected for each of @xmath214 distributions and are contained in vector @xmath215 .",
    "also , let @xmath216 be , respectively , the prior distribution of the model parameters under the nested gdp model and its corresponding truncation after integrating out the random distributions , and @xmath217 and @xmath218 be the prior predictive distribution of the observations derived from these priors .",
    "then @xmath219 where @xmath220^{j } \\biggr),\\hspace*{25pt}\\mbox{if } l = \\infty , k < \\infty , \\vspace*{8pt}\\cr \\displaystyle4 \\biggl ( 1 - \\biggl [ 1 - \\biggl ( \\frac{b_2}{a_2+b_2 } \\biggr)^{l-1 } \\biggr]^{nj } \\biggr),\\qquad\\mbox{if } l < \\infty , k=\\infty , \\vspace*{8pt}\\cr \\displaystyle4 \\biggl ( 1 - \\biggl [ 1 - \\biggl ( \\frac{b_1}{a_1+b_1 } \\biggr)^{k-1 } \\biggr]^{j",
    "} \\biggl [ 1 - \\biggl ( \\frac{b_2}{a_2+b_2 } \\biggr)^{l-1 } \\biggr]^{nj } \\biggr ) , \\vspace*{5pt}\\cr \\hspace*{170pt}\\mbox{if } l < \\infty , k < \\infty.}\\end{aligned}\\ ] ]    the proof is a direct extension of results in @xcite ( @xcite ) and @xcite and it is omitted for reasons of space .",
    "this result is particularly important since it justifies the use of computational algorithms based on finite mixtures and allows us to choose adequate truncation levels .",
    "we would like to thank nils hjort for his helpful comments and allen wilcox for providing access to the eps data ."
  ],
  "abstract_text": [
    "<S> we discuss functional clustering procedures for nested designs , where multiple curves are collected for each subject in the study . </S>",
    "<S> we start by considering the application of standard functional clustering tools to this problem , which leads to groupings based on the average profile for each subject . after discussing some of the shortcomings of this approach </S>",
    "<S> , we present a mixture model based on a generalization of the nested dirichlet process that clusters subjects based on the distribution of their curves . by using mixtures of generalized dirichlet processes , </S>",
    "<S> the model induces a much more flexible prior on the partition structure than other popular model - based clustering methods , allowing for different rates of introduction of new clusters as the number of observations increases . </S>",
    "<S> the methods are illustrated using hormone profiles from multiple menstrual cycles collected for women in the early pregnancy study . </S>"
  ]
}