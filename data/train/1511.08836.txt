{
  "article_text": [
    "we mathematically study the dynamics of a population of organisms defending against a stochastic pathogen environment using a combination of various immune strategies .    in the model the pathogenic environment",
    "is desribed by a @xmath30-dimensional vector @xmath31 ( here bold symbols refer to vectors ) of @xmath32s and @xmath33s , where @xmath34 if pathogen @xmath35 is present , @xmath32 otherwise . protection of an organism against these pathogens is also described by a @xmath30-dimensional vector @xmath36 , where @xmath37 if the protection ( antibody , tcr , crispr spacer ) against pathogen @xmath35 is present , and @xmath32 otherwise .",
    "we consider the dynamics of a population of organisms reproducing at discrete times @xmath18 .",
    "let @xmath38 be the mean number of organisms in the population at time @xmath18 with protection @xmath36 , for a given environment history @xcite .",
    "the change in population composition from one generation to the next is governed by the reproductive success of individuals in each state @xmath39 , modulated by state switching from parents to offspring : @xmath40 where @xmath41 is the mean number of offspring of an organism of type @xmath36 in environment @xmath42 and @xmath43 is the switching probability from protection state @xmath44 to state @xmath36 . note that the protection state switching probability , which represents to what extent protection is inherited , acquired or lost , generally depends on the state @xmath45 of the environment .    a similar recursion to eq .",
    "[ eqfullrecursion ] can be rewritten for the fraction of the population in each state , @xmath46 , with @xmath47 the total population size : @xmath48 where @xmath49 is a normalization constant enforcing @xmath50 .",
    "the population size verifies @xmath51 , so that the long - term growth rate , @xmath52 , is given by : @xmath53 this rate provides a measure of long - term fitness @xcite .",
    "we assume that the mutation and inheritance probabilities of different pathogen - protection pairs are independent of each other , _ i.e. _ that @xmath54 factorizes over the pathogens , @xmath55 the entries of @xmath56 are given by fig .",
    "1e of the main text : @xmath57 , @xmath58 .",
    "in addition , the effects of different pathogen - protection pairs on the growth rate are taken to be additive , so that , following the definitions of fig .",
    "1c : @xmath59,\\ ] ] where @xmath60 is the growth rate in absence of any immune cost . with these assumptions ,",
    "the distribution @xmath61 also factorizes over @xmath35 : @xmath62 where @xmath63 is the fraction of the population having protection @xmath35 at time @xmath18 . plugging this ansatz into eq .",
    "[ recursion ] with eqs .",
    "[ factorizedswitches ] and [ cost ] yields the following recursion for @xmath63 : @xmath64 the recursion depends on the sequence of @xmath65 , which is a stochastic binary process switching from 0 to 1 with probability @xmath0 , and from 1 to 0 with probability @xmath1 , as in fig .",
    "1e of the main text .",
    "note that the sequence @xmath65 is the same for the whole population ( a quenched variable in the statistical mechanics sense ) .",
    "we have @xmath66 , with : @xmath67\\ ] ] from eq .  [ eqlambda ]",
    "it then follows that @xmath68 the long - term growth rate is a sum of independent terms for each pathogen - protection pair , which allows us to treat the problem of maximizing long - term growth rate one pathogen at a time .",
    "the cost function of the optimization , @xmath69 , can be approximated by solving the recursion equation ( eq .  [ eqrecr ] ) for a large enough number of generations ( we used at least @xmath70 generations ) . since the process is ergodic , averaging over very long periods is equivalent to repeating the process multiple times .",
    "the longer the simulation , the more accurate the evaluation of @xmath69 .",
    "our goal is to optimize @xmath69 over the four parameters @xmath71 constrained to their domain of definition . for numerical purposes ,",
    "all four parameters are first mapped onto the unit interval @xmath72 .",
    "the noise in the evaluation of @xmath69 makes the optimization challenging .",
    "it can be reduced by prolonged simulation or repeated sampling at the expense of a higher computational cost per function evaluation . to optimize under these constraints we use a two - phase algorithm . in the first phase the direct algorithm @xcite provides us with a rough , but global optimization for which we use a relatively low quality approximation .",
    "the results of this first phase are then refined by a pattern search algorithm @xcite .",
    "to minimize the effects of stochasticity , the algorithm takes averages over an adaptive number of independent runs in this step . by estimating the standard error of the computed long - term growth rate from the independent runs , this number can be adapted so that differences between compared parameter values are statistically significant . in the same manner",
    "we can ascertain that the final set of parameter values is locally optimal within some tolerance .    to obtain a phase diagram such as the one shown in fig .",
    "2a we performed a global optimization over all four parameter values as described above , for every environment condition @xmath73 .",
    "based on the results of this first step we defined the features of the obtained phases .",
    "all phases are defined by a subset of the variables lying at a constraint boundary . in order to get more precise boundaries with reasonable computational effort we look at the difference in growth rates between pairs of strategies across environmental conditions . to decrease noise the difference",
    "is calculated across pairs of simulations using the same sequence of pathogens @xmath74 .",
    "using interpolation , this allows us to obtain the line of transition between the two strategies very precisely . to prevent e.g. the mixed strategy to reduce to a crispr - like strategy",
    "we impose that the parameters that are not constrained in a particular strategy are not closer than a tolerance @xmath75 ( @xmath76 for @xmath10 ) of the boundary .",
    "to study the influence of the effects of finite population size we perform direct agent - based simulations of a population of adapting individuals with strategies evolving on a slow timescale .",
    "the population has a finite size @xmath77 that remains fixed over the course of the simulation . at every generation the parents of the @xmath77 individuals are drawn from the individuals making up the previous generation with probabilities proportional to the mean number of offspring @xmath78 of these individuals .",
    "the offspring s state @xmath79 is determined from the state of its parent @xmath80 according to the switching rates @xmath81 defined previously . along with the state @xmath36 ,",
    "the switching rates themselves , @xmath82 , as well as the degree of adaptability , @xmath9  in other words , the parameters defining the immune strategy  are also transmitted to the offspring .",
    "they also change from parent to offspring , although at a much slower rate than the state to preserve a clear separation of timescales between short - term and long - term adaptations . in this setup ,",
    "selection acts on the strategies . after an equilibration phase",
    ", we collect statistics on the strategies adopted by individuals in the population .",
    "to get rid of the effect of deleterious mutations that do not eventually fix in the populations the mutation rate and size were scaled down exponentially with time .",
    "as population size is finite deleterious mutations can fix in the population , which means that even in the limit of zero mutation rate there remains a spread in the distribution of strategies .",
    "hence we do not only represent the median as a measure of the central tendency of a parameter , but also the interquartile range as a measure of its spread .",
    "results are shown in fig .",
    "[ figsievol ] . for a population size of 1000",
    "the median of strategies follows very closely the optimal strategy for an infinite population . for",
    "smaller population sizes the median starts to deviate from the optimum in the infinite population limit .",
    "one of the most notable changes is an increased adaptability of the strategies as seen in the upward shift of the @xmath9 curves with smaller population size at @xmath83 .",
    "to lower the chances of all of the population being mal - adapted , the evolved strategies in small populations diversify the protection state more strongly , as seen from the higher mutation rates for smaller population sizes .",
    "finally , the quite large interquartile ranges show that as expected significant variation of the evolved strategy coexists in small populations ."
  ],
  "abstract_text": [
    "<S> biological organisms have evolved a wide range of immune mechanisms to defend themselves against pathogens . beyond molecular details , these mechanisms differ in how protection is acquired , processed and passed on to subsequent generations </S>",
    "<S>  differences that may be essential to long - term survival . here </S>",
    "<S> , we introduce a mathematical framework to compare the long - term adaptation of populations as a function of the pathogen dynamics that they experience and of the immune strategy that they adopt . </S>",
    "<S> we find that the two key determinants of an optimal immune strategy are the frequency and the characteristic timescale of the pathogens . </S>",
    "<S> depending on these two parameters , our framework identifies distinct modes of immunity , including adaptive , innate , bet - hedging and crispr - like immunities , which recapitulate the diversity of natural immune systems .    </S>",
    "<S> immune systems have evolved to protect organisms against large and unpredictable pathogenic environments . yet </S>",
    "<S> immunity always comes at a cost ( metabolic and maintenance costs , auto - immune disorders , etc .  </S>",
    "<S> @xcite ) , and this cost must be balanced by the benefits that protection confers  @xcite . </S>",
    "<S> faced with the problem of evolving a suitable defense , different organisms , from archae to humans , have developed different strategies to identify and target pathogens , which have given rise to a diversity of mechanisms of immunity .    </S>",
    "<S> a lot of effort has been put into elucidating these mechanisms down to their molecular details in a variety of species  @xcite . beyond many differences </S>",
    "<S> , these studies have revealed many commonalities @xcite , which hint at a possible general understanding of the trade - offs that shape their design @xcite . </S>",
    "<S> for instance , independently of the well - known adaptive immune systems of jawed vertebrates , jawless vertebrates ( e.g. lampreys ) have developed an alternative adaptive system that uses a distinct molecular family of receptors , but both systems function largely in the same way , relying on the generation of a large number of diverse receptors expressed by two types of lymphocytes ( b or t - like cells ) . </S>",
    "<S> likewise , the innate immune systems of invertebrates and vertebrates , share many similarities , relying on the selected expression of germline toll - like receptors upon infection . some of the features of vertebrate immunity are even shared with bacteria , who have developed their own targeted immunity based on the crispr / cas system @xcite , which itself bears strong resemblance with genome protection through interfering rnas in eukaryotes @xcite .    independently of how they evolved and their particular molecular implementation </S>",
    "<S> , we may classify these diverse mechanisms into a few broad modes of immunity : heritable but not adaptable within an individual s lifetime , as innate immune systems ; heritable and adaptable within a lifetime but with the benefits of adaptation being non heritable , as adaptive immune systems ; acquired from the environment and heritable , as the crispr / cas system ; and mixed strategies combining several of these elements . </S>",
    "<S> these broad distinctions call for general principles to characterize the conditions under which one or another mode of immunity may be expected to evolve @xcite . </S>",
    "<S> the diversity and variability of threats from the pathogenic environment suggests that different modes of immunity may offer better protection depending on the patterns of occurrence of pathogens or the effective population size of the protected population . </S>",
    "<S> here we apply a general theoretical framework for analyzing populations in a varying environment @xcite to predict the emergence of the basic forms of observed immunity .        </S>",
    "<S> individuals reproduce in the presence of pathogens , which randomly appear , may persist for several generations and disappear before possibly reappearing at a latter time ( fig .  </S>",
    "<S> 1a ) . in our framework </S>",
    "<S> , a given pathogen has a probability @xmath0 to appear and a probability @xmath1 to disappear from one generation to the next ( fig .  </S>",
    "<S> 1e ) . </S>",
    "<S> the pathogenic dynamics is quantified both by the pathogen frequency @xmath2 , which is the probability that it is present at any given generation , and by the characteristic timescale @xmath3 , which sets how fast pathogens appear and disappear .    </S>",
    "<S> pathogens reduce the fitness of the individuals in the population and the immune system is designed to mitigate this effect . </S>",
    "<S> an individual s fecundity , defined as its expected number of descendants in the next generation @xmath4 , depends on the pathogenic environment and its ability to protect itself against it . each pathogen independently lowers the fecundity of an unprotected individual by a relatively large cost factor @xmath5 ( fig .  </S>",
    "<S> 1b ) . </S>",
    "<S> this cost is reduced to a lower cost @xmath6 when the individual is protected by its immune system , however this protection comes at a minimal but ever - present cost of @xmath7 of maintaining the immune defense in absence of the pathogen ( fig .  </S>",
    "<S> 1c ) .    </S>",
    "<S> we explore the choices and tradeoffs underlying various modes of immunity along three axes : adaptability , heritability , and mode of aquisition . </S>",
    "<S> the first , adaptability axis concerns how much resources are invested in the protection for the return of an efficient response . </S>",
    "<S> this tradeoff imposes a relationship between @xmath8 and @xmath9 ( fig .  </S>",
    "<S> 1d ) : the more effective the defense ( the lower @xmath8 ) , the higher maintenance cost ( the higher @xmath9 ) . </S>",
    "<S> for example , having a large number of immune cells specialized against a specific pathogen allows for a quick and efficient response in case of invasion , but this enhanced protection comes at the cost of producing and maintaining these cells in the absence of the pathogen . </S>",
    "<S> this strategy is adopted , for example , by much of the innate immune systems of plants and animals @xcite . on the contrary </S>",
    "<S> , the adaptive immune system keeps a very small specialized pool of lymphocytes for each potential antigen , and makes them proliferate only in case of infection @xcite . </S>",
    "<S> the second , heritability axis is defined by the probability @xmath10 that the protection is not transmitted to the offspring ( fig .  </S>",
    "<S> 1e ) . </S>",
    "<S> finally , the third , acquisition axis specifies how individuals may acquire the protection without inheriting it from their parent . </S>",
    "<S> this acquisition may occur randomly independently of the environment , with probability @xmath11 , for instance by mutation or phenotypic switching , as is the case for antibiotic resistance in bacteria @xcite ; or it can be induced by the presence of the pathogen with probability @xmath12 , as in crispr - cas immunity ( fig .  </S>",
    "<S> 1e ) @xcite . </S>",
    "<S> this mechanism comes at an extra cost @xmath13 due to maintenance and the risks of uptaking foreign genetic material ( fig .  </S>",
    "<S> 1b ) .        </S>",
    "<S> each choice of the parameters @xmath9 , @xmath10 , @xmath11 and @xmath12 defines a specific immune strategy . this strategy is optimal if a population that adopts it outgrows in the long run any other population following a different strategy . </S>",
    "<S> our goal is to characterize this optimal strategy , in particular its dependency on the two key properties of the pathogen , its frequency @xmath14 and its characteristic time @xmath15 . </S>",
    "<S> we achieve this goal by maximizing the long - term growth rate of populations , defined by @xmath16 , where @xmath17 is the total population size at generation @xmath18 ( fig .  </S>",
    "<S> 1a ; see si for a derivation )  @xcite . conveniently , since the fecundity is affected independently by the different pathogens , each pathogen contributes additivitely to the growth rate and can be studied separately ( fig . </S>",
    "<S> 1b and si ) . </S>",
    "<S> remarkably , we obtain qualitatively different optimal solutions for given values of @xmath14 , @xmath15 , with sharp transitions between these strategies as one varies the parameters of the pathogen statistics , allowing us to define distinct immune regimes ( fig . </S>",
    "<S> 2a ) . </S>",
    "<S> the emergence of these very distinct regimes is not an assumption , but the result of the optimisation itself .    </S>",
    "<S> fig .  </S>",
    "<S> 2b describes these optimal strategies along the three axes of variation outlined earlier . </S>",
    "<S> along the first axis of variation , adaptability , we find that frequent or persistent pathogens are best dealt with by constitutively expressed immunity ( @xmath19 ) , and rare and transient pathogens by investing minimally in the defense ( @xmath20 , in blue ) ; between these two extremes , only a limited form of adaptation is required ( @xmath7 , in green ) . </S>",
    "<S> along the second axis , heritability , we find that carrying the protection at all times ( @xmath21 ) is beneficial for fast pathogens but that losing the protection with probability @xmath22 is more advantageous for slow ones . finally , along the third axis , </S>",
    "<S> acquisition , we verify that there is no need to pay the price of informed acquisition ( @xmath23 ) whenever protection is systematically inherited ( @xmath21 ) ; when it is not the case ( @xmath22 ) , we find that uptake is advantageous for sufficiently infrequent pathogens ( yellow and orange regions ) but that only for very infrequent pathogens does it becomes the exclusive mode of acquisition of protection ( @xmath24 , @xmath25 , in yellow ) </S>",
    "<S> .    each of these distinct regimes , or phases , is instantiated by natural immune systems . for transient and rare pathogens ( blue phase ) , </S>",
    "<S> the optimal strategy is to inherit a defense with minimal constitutive cost . </S>",
    "<S> this strategy is characteristic of the adaptive immune system in vertebrates , where an effective immune response is mounted from a small number of precursor cells , the marginal cost of which is negligible @xcite . for transient but frequent pathogens ( purple phase ) , </S>",
    "<S> the optimal strategy consists instead in inheriting a maximally efficient protection that makes the individuals effectively insensitive to the presence of the pathogen at the expense , however , of a large constitutive cost . </S>",
    "<S> the recognition of pathogen - associated molecular patterns by pattern recognition receptors , as for instance the recognition of lipopolysaccharide by toll - like receptors , is an example of such an innate strategy @xcite . </S>",
    "<S> an intermediate phase ( in green ) separates these two extremes , where adaptation is present with a non - zero constitutive cost . </S>",
    "<S> this strategy , which we call proto - adaptive , is represented by certain specialized cells of the innate immune system , such as natural killer cells @xcite , whose abundance can vary as a function of experienced infections , effectively implementing an adaptive memory within a single generation .    for slow and frequent pathogens ( red phase ) , </S>",
    "<S> protection is acquired with probability @xmath26 and lost with probability @xmath22 independently of the presence of the pathogen . </S>",
    "<S> this bet - hedging strategy is implemented in bacteria that can switch on or off the expression of phage receptors @xcite . for slow but unfrequent pathogens ( yellow phase ) , </S>",
    "<S> a form of bet - hedging is again present , but this time with a non - zero probability to acquire protection only in presence of the pathogen . </S>",
    "<S> an example of such a lamarckian strategy is the crispr - cas immune system in bacteria @xcite . </S>",
    "<S> finally , a mixed phase ( in orange ) is also possible where protection is randomly acquired at a rate that is increased by the presence of the pathogen .    </S>",
    "<S> it is instructive to examine how the parameters of immunity vary within the phases ( fig .  </S>",
    "<S> 2c - d and s1 ) . </S>",
    "<S> as one may expect , the statistical properties of the protection tend to track the pathogen statistics @xcite . </S>",
    "<S> the more frequent the pathogen , the more prevalent the protection in the population ( fig .  </S>",
    "<S> 2c ) . </S>",
    "<S> likewise , the characteristic time of the protection , @xmath27 , grows with that of the pathogen , @xmath15 ( fig .  </S>",
    "<S> 2e ) .    the phase portrait of fig .  </S>",
    "<S> 2a rationalizes the salient differences between the immune systems of prokaryotes and vertebrates . </S>",
    "<S> bacterial and archeal pathogens evolve on timescales that are much closer to those of their pathogens than vertebrates . from the viewpoint of microbes , </S>",
    "<S> the pathogenic environment is relatively constant ( @xmath28 ) , while for vertebrates a particular pathogenic strain is unlikely to survive a single generation ( @xmath29 ) . </S>",
    "<S> consistently with our results , vertebrates use fully heritable modes of immunity , and do not rely on bet - hedging . to deal with unfrequent and fast evolving pathogens such as viruses , they recourse to adaptive mechanisms by which they can upregulate their protection in case of an invasion . </S>",
    "<S> the three predicted strategies  adaptive , proto - adaptive , and innate  correspond to the known modes of immunity in vertebrates @xcite . </S>",
    "<S> prokaryotes , on the other hand , almost systematically use bet - hedging strategies . </S>",
    "<S> they recourse to both the crispr - cas system of acquired immunity @xcite , and to innate immunity through _ e.g. _ restriction endonucleases @xcite , which correspond to the predicted lamarckian and innate bet - hedging strategies of the diagram , respectively . </S>",
    "<S> these results are robust to changes of parameters , although increasing costs can make bet - hedging beneficial even at short characteristic times ( si fig .  </S>",
    "<S> s2 ) .    </S>",
    "<S> bacteria and vertebrates also have very different population sizes , which influence their overall survival probability . to evaluate this impact , we ran stochastic simulations competing different strategies for increasing population sizes ( see si text and si fig .  </S>",
    "<S> s3 ) . </S>",
    "<S> the phase diagram of fig .  </S>",
    "<S> 2a was recovered for populations as small as a thousand , while for smaller populations the boundaries between regimes were smeared . </S>",
    "<S> adaptive strategies were generally favored over crispr - like strategies in small populations . </S>",
    "<S> in addition , for finite populations it is always beneficial to recourse some degree of bet - hedging in order to react quickly to environmental changes and avoid extinction .    by analyzing the long - term fate of populations under minimal assumptions concerning the rules governing adaptability , heritability and acquisition of immune protections , </S>",
    "<S> we have recovered the basic known modes of immunity . </S>",
    "<S> remarkably our results hold even for a single pathogen . </S>",
    "<S> the key determinants of optimal immune strategies are found to be the statistical features of pathogen occurrence : its frequency and its characteristic timescale . as an implication , a diverse pathogenic environment , with varying statistics , will favor mixed solutions , consistently with the observation of multiple immune systems within a same organism  such as adaptive and innate immune systems in vertebrates , or crispr and innate defense in bacteria . </S>",
    "<S> naturally , the molecular implementation of these general principles differs greatly even between organisms sharing the same type of immunity . yet </S>",
    "<S> an evolutionary perspective that accounts for the costs and benefits of protection is enough to explain the most salient features of immunity </S>",
    "<S> . it will be interesting to extend our framework to account for other essential features of immunity , _ </S>",
    "<S> e.g. _ the acquisition of protection by horizontal transfer or the coevolutionary dynamics between pathogens and their hosts . in view of our analysis </S>",
    "<S> , it is already less surprising that complex forms of immunity such as the adaptive immune system have evolved separately in jawed and non - jawed vertebrates , with the same general features but different molecular encodings .    </S>",
    "<S> * acknowledgements . * </S>",
    "<S> the work was supported by grant ercstg n. 306312 .    </S>",
    "<S> 21 natexlab#1#1bibnamefont # 1#1bibfnamefont # 1#1citenamefont # 1#1url # 1`#1`urlprefix[2]#2 [ 2][]#2    , * * , ( ) .    , </S>",
    "<S> * * , ( ) .    </S>",
    "<S> , , , , * * , ( ) .    , </S>",
    "<S> * * , ( ) .    , * * , ( ) .    , * * , ( ) .    , * * , ( ) .    , , , * * , ( ) .    , </S>",
    "<S> * * , ( ) .    , * * , ( ) .    , , , * * , ( ) .    , * * , ( ) .    , * * , ( ) .    , * * , ( ) .    , * * , ( ) .    , * * , ( ) .    , , , , , , , , * * , ( ) .    , , , , </S>",
    "<S> * * , ( ) .    , , , _ </S>",
    "<S> _ , vol .   </S>",
    "<S> ( , ) , ed .    , , , * * , ( ) .    , , , * * , ( ) . </S>"
  ]
}