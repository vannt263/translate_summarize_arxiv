{
  "article_text": [
    "spatially resolved astronomical observations commonly span orders of magnitude variations in the signal - to - noise ratio ( @xmath0 ) across the detector elements , and some spatial elements are often flawed by insufficient @xmath0 .",
    "for this reason , data are often locally averaged together before analyzing them : the resulting @xmath0 is significantly better at the price of a degraded spatial resolution .",
    "two kinds of averaging processes are possible : _ smoothing _ and _ binning_. the smoothing scheme increases the local @xmath0 by somehow correlating neighboring data  e.g. , during a convolution process  while retaining the initial sampling , and therefore the initial number of data points .",
    "on the other hand , the binning technique locally groups and averages together data , resulting in a sparser sampling and a decreased number of final data points . in both cases ,",
    "the number of _ independent _ measurements is equivalently decreased .",
    "while the smoothing technique might present the advantage of simplicity  see e.g. , the very wide use of the ` median filtering '  it is difficult to handle the statistics of the correlations it introduces . as a consequence , smoothing is never used for the quantitative analysis of one - dimensional ( 1d ) spectra .",
    "when a precise error management is needed , or when the actual number of data points to be treated matters ( e.g. , for a heavy subsequent numerical computation ) , binning is more suited .    given the large variations in the @xmath0 across the detector elements  e.g. , from the inner to the outer parts of a galaxy ccd image  it is of interest to use an _ adaptive binning _ scheme where the size of the bin is adapted to the local @xmath0 : bigger bins will be applied in the low-@xmath0 regions , while a higher resolution  i.e. , smaller bins  will be retained in the high-@xmath0 parts .",
    "a well known example is galaxy photometry , where logarithmically spaced radial bins are often adopted ( e.g. * ? ? ?",
    "* ) : many more pixels are used to compute the value of a galaxy profile at large radii than in the center . however",
    ", these algorithms generally use an _ a priori _ knowledge of the @xmath0 distribution ( e.g. the surface brightness profile of the galaxy ) to build the binning scheme .",
    "binning is essential in the case of spectroscopic observations of the stellar kinematics .",
    "in fact the extraction of the line - of - sight velocity distribution ( losvd ) generally involves nonlinear processes and as a result a minimum @xmath0 is _ required _ for a reliable and unbiased extraction of kinematical information from the spectra ( e.g. * ? ? ? * and references therein ) .",
    "accordingly , binning is invariably used to analyze 1d ( e.g.  long slit ) spectroscopic observations .",
    "developments with integral - field spectroscopy ( ifs ; e.g. , ` sauron ` on wht , ` vimos ` on vlt , ` gmos ` on gemini , etc . ) require methods to perform spatial binning of spectra in two dimensions ( 2d ) too .",
    "little work has been done on the subject of fully adaptive 2d - binning .",
    "@xcite developed an algorithm for x - ray imaging data , but the bins that their method produces can contain other bins and are not compact . in the case of spectroscopic data",
    "it makes little sense to bin together spectra coming from pixels that are not close enough to each other and whose properties may differ considerably .",
    "other schemes have to be developed and are described in this paper . in section  [ sec : generic ] we discuss the specific requirements of the 2d - binning problem . in section",
    "[ sec : quadtree ] we present a solution based on the quadtree method , while in section  [ sec : vt ] we develop new methods based on voronoi tessellations . in section",
    "[ sec : optimal ] we present an optimal voronoi 2d - binning algorithm and finally in section  [ sec : concl ] we draw some conclusions .",
    "we tackle here the problem of binning in the spatial direction(s ) . in",
    "what follows the term ` pixel ' refers to a given spatial element of the dataset ( sometimes called ` spaxel ' in the ifs community ) : it can be an actual pixel of a ccd image , or a spectrum position along the slit of a long - slit spectrograph or in the field of view of an ifs ( e.g.  a lenslet or a fiber ) .",
    "each pixel @xmath1 has an associated signal @xmath2 and its corresponding noise @xmath3 .",
    "the pixel signal - to - noise ratio is therefore @xmath4 .",
    "our considerations do not depend on the details used to estimate these quantities , which we assume to be known beforehand . in the case of spectroscopy for instance , the quantity @xmath2 ( resp .",
    "@xmath5 ) associated with a given spectrum @xmath6 can be the signal ( resp .",
    "the noise @xmath7 ) averaged over a given spectral range @xmath8 : @xmath9 when two pixels are coadded the @xmath0 of the resulting bin is computed according to the standard formula : @xmath10 it is important to remember that the term ` binning ' will only refer here to the averaging of observations taken at different positions on the sky ( i.e. , different pixels ) , and _ not _ along the spectral direction .",
    "the binning method in 1d is easy to implement : one only has to make sure that all the bins are adjacent and that their @xmath0 reach a minimum value ( or better that the scatter around the target @xmath0 is minimum ) .",
    "this leads in practice to a unique binning solution ( see a practical algorithm in section  [ sec : accretion ] ) . in 2d",
    "( and higher dimensions ) the situation is more complex as the shape of the bin has then to be taken into consideration .",
    "a good binning scheme has to satisfy the following requirements :    * topological requirement : * : :    the bins should properly tessellate the relevant region    @xmath11 of the sky plane , i.e. , create a partition of    @xmath11 without overlapping or holes .",
    "while this    requirement is trivial to enforce in 1d , it is tricky to implement in    higher dimensions , where the bin shapes vary ; * morphological requirement : * : :    the bin shape has to be as ` compact ' ( or ` round ' ) as possible , so that    the pixels in one bin are as close as possible to each other and can    be associated with a well - defined spatial position . in this way the    best spatial resolution is obtained along all directions ; * uniformity requirement : * : :    the scatter in the @xmath0 of the bins , around a    target value , should be as small as possible .",
    "while a minimum    @xmath0 is generally required , one does not want to    sacrifice spatial resolution to increase the bin    @xmath0 even further .    in what follows",
    "we consider different methods and we apply each one to observations of the barred sa galaxy ngc  2273 ( fig .  [",
    "fig : n2273-snmap ] ) taken with the panoramic ifs ` sauron ` @xcite at the 4.2-m william herschel telescope on la palma .",
    "these observations , carried on in march 2001 , are based on two pointings of @xmath12  s exposures .",
    "they cover a field - of - view of @xmath13 with an effective spatial sampling of @xmath14 , over the 48105350   spectral range .",
    "they have been selected for having high @xmath0 contrast between the inner and the outer parts ( in the range @xmath15@xmath16 ) and a complex @xmath0-distribution , caused by the presence of spiral arms and the merging of multiple exposures ( leading to @xmath0-jumps and irregular outer boundaries , see fig .",
    "[ fig : n2273-snmap ] ) . in the following experiments our goal is to bin these data with a target @xmath0 of @xmath17 per spectral element on average .",
    "bottom panel : _ map of the average @xmath0  per spectral element .",
    "contours are superimposed in the range 1050 with steps of 5 .",
    "note the two vertical @xmath0 jumps close to the middle of the frame and the irregular boundaries due to the merging process of the different exposures.,title=\"fig : \" ]   steps .",
    "_ bottom panel : _ map of the average @xmath0  per spectral element .",
    "contours are superimposed in the range 1050 with steps of 5 .",
    "note the two vertical @xmath0 jumps close to the middle of the frame and the irregular boundaries due to the merging process of the different exposures.,title=\"fig : \" ]      binning is not magic : in 2d , as in 1d , some useful information has to be present in the pixels for any binning method to be effective . in 1d one",
    "usually restricts the spatial region to bin , along the slit , to some range where the pixels are not fully dominated by instrumental noise .",
    "the same can be done in 2d by discarding pixels that contain virtually no signal from the object under examination .",
    "this is not necessary for the ` sauron ` observations discussed here , where the noise in all the pixels is essentially poissonian ( @xmath18 ) .",
    "an alternative approach is to optimally weight the pixels during the summation in a bin : for a given set of pixels , the weights for which the sum ( [ eq : sn_sum ] ) provides the maximum @xmath0 are given by @xmath19 ( e.g. * ? ? ?",
    "this weighting makes full use of photon - noise dominated pixels ( @xmath20 ) , and automatically eliminates from the summation pixels that contain virtually no signal ( @xmath21 ) .",
    "equation  ( [ eq : sn_sum ] ) then becomes : @xmath22    all the following considerations apply unaltered irrespective of whether equation  ( [ eq : sn_optimal ] ) is used instead of equation  ( [ eq : sn_sum ] ) for the estimation of the @xmath0 of each bin .",
    "moreover the two equations automatically coincide in the limit of poissonian noise and in that case no distinction needs to be made .",
    "however , the price to pay for the use of the optimal weighting is that the weights of each pixel contributing to a bin have to be recorded for a complete description of the bin .",
    "this complicates the quantitative interpretation of binned data ( e.g. , in dynamical modeling ) .",
    "it is instructive to first consider the quadtree algorithm @xcite , which we believe is close to the best ` regular ' image processing method that can be used for the present application .",
    "we show that the quadtree method can not produce an _ optimal _ binning  that is satisfying all three previous requirements  so that more complex schemes are required .",
    "these will be presented in section  [ sec : vt ] .",
    "the quadtree method consists of a recursive partition of a region of the plane into axis - aligned squares .",
    "initially one square , the _ root _ , covers the entire region .",
    "subsequently each square , whose @xmath0  is higher than a given threshold , is divided into four equal _ child _ squares , by splitting with horizontal and vertical segments through its center .",
    "the collection of squares then form a tree , with the _ root _ square at the top and with smaller squares at lower levels of the tree .    in fig .",
    "[ fig : quadtree_scatter ] the quadtree method was used to rebin the @xmath0 map of fig .",
    "[ fig : n2273-snmap ] into squares satisfying a minimum @xmath0 requirement .",
    "the nice feature of this binning method is that the resulting bins are squares of various sizes ( except at the border ) . in this way bins are easy to handle , and require little information to be described completely .     .",
    "the bins are overlaid on the s / n map . _",
    "bottom panel : _ @xmath0 scatter in the above binning around @xmath23 ( solid line ) : the squares represent the @xmath0 of each bin , as a function of its distance from the galaxy center .",
    "the central regions ( @xmath24 ) , where the pixels are already above @xmath23 and where binning is not needed , are not shown in this plot , as in the following ones .",
    "the dashed lines represent the limits of the natural scatter , that is @xmath25.,title=\"fig : \" ] .",
    "the bins are overlaid on the s / n map . _",
    "bottom panel : _ @xmath0 scatter in the above binning around @xmath23 ( solid line ) : the squares represent the @xmath0 of each bin , as a function of its distance from the galaxy center .",
    "the central regions ( @xmath24 ) , where the pixels are already above @xmath23 and where binning is not needed , are not shown in this plot , as in the following ones .",
    "the dashed lines represent the limits of the natural scatter , that is @xmath25.,title=\"fig : \" ]    there are however two major shortcomings with this method :    1 .",
    "a @xmath0 spread of a factor @xmath26 is unavoidable due to the fact that the bin area varies by construction in steps of a factor of  4 ; 2 .",
    "unless the original image has a linear size , in pixels , which is a power of two , some bins at the border will not be square and generally will not meet the minimum @xmath0 criterion , becoming unusable for later analysis .",
    "given the inability of methods employing ` regular ' bins to produce optimal 2d tessellations , we now consider schemes which do not have square or rectangular bins .",
    "accordingly we consider the _ voronoi tessellation _ ( vt ) that can be used to generate binnings satisfying all the three requirements of section  [ sec : generic ] .    given a region @xmath11 of the plane and a set of points @xmath27 of @xmath11 , called _",
    "generators _ , a vt is a partition of @xmath11 into regions @xmath28 enclosing the points closer to @xmath29 than to any other generator .",
    "each @xmath30 is referred to as the _ voronoi region _ and here as _ bin _ associated with @xmath29 ( see e.g. * ? ? ? * for a comprehensive treatment ) .",
    "the vt presents many interesting features for the binning problem :    1 .",
    "it naturally enforces the topological requirement ; 2 .",
    "it is efficiently described by the sole coordinates of its generators ; 3 .",
    "it is very easy to implement in the discrete case : given the generator positions , it is sufficient to locate the closest generator to any given pixel to determine the bin to which it belongs .    on the other hand , the fact that a vt is adopted for binning does not enforce by itself the morphological requirement : the bins are convex by construction , but can have very sharp angles .",
    "furthermore , the uniformity requirement is not addressed in any way by the simple use of a vt .",
    "these two shortcomings are clearly illustrated , [ fig : n2273-cvt ] and [ fig : bubbles - final ] , was done by first computing the delaunay triangulation ( see appendix  a ) from the vt generators and then optimally coloring the corresponding graph with the _ mathematica _ package combinatorica by @xcite . ] in fig .",
    "[ fig : monte - carlo ] .",
    "the morphological and uniformity requirements have to be tackled through a properly tailored distribution of the voronoi generators .",
    "we present now a way to produce such a distribution .",
    "is proportional to @xmath31 , where the local density @xmath32 is proportional to the @xmath33 in fig .",
    "[ fig : n2273-snmap ] .",
    "this ensures that the @xmath0  enclosed in each bin is constant on average .",
    "the generators of the vt are indicated by the black dots . _",
    "bottom panel : _ @xmath0 scatter in the above vt .",
    "although the values fluctuate around the desired @xmath17 ( solid line ) , the scatter is large : rms error is 26% ( dashed lines).,title=\"fig : \" ]   is proportional to @xmath31 , where the local density @xmath32 is proportional to the @xmath33 in fig .",
    "[ fig : n2273-snmap ] .",
    "this ensures that the @xmath0  enclosed in each bin is constant on average .",
    "the generators of the vt are indicated by the black dots . _",
    "bottom panel : _ @xmath0 scatter in the above vt .",
    "although the values fluctuate around the desired @xmath17 ( solid line ) , the scatter is large : rms error is 26% ( dashed lines).,title=\"fig : \" ]      in the two important cases where the noise is poissonian or when the pixels in each bin are optimally weighted ( section  [ sec : optim_weigth ] ) , the @xmath34 of one bin is computed by simply summing the @xmath35 of the corresponding pixels ( equation  [ [ eq : sn_optimal ] ] ) .",
    "one can then define a density distribution @xmath36 such that the problem of binning to a constant @xmath0 reduces to that of obtaining a tessellation enclosing equal mass according to @xmath32 .",
    "the _ centroidal voronoi tessellation _ ( cvt ) is a technique which can be used to generate this optimally regular _ and _ uniform vt in the continuous case , or in the limit of a large number of pixels .",
    "given a density function @xmath31 defined in a region @xmath11 , a cvt of @xmath11 is a special class of vt where the generators @xmath29 happen to coincide with the mass centroids @xmath37 of the corresponding voronoi regions @xmath30 . as illustrated in the review by @xcite ,",
    "the cvts are useful to solve a variety of mathematical problems , but can also be observed in many real - life natural examples ( living cells , territories of animals , etc . )",
    ".    one of the most striking characteristics of cvt in the 2d - case is its ability to partition a region into bins whose size varies as a function of the underlying density distribution , but whose shape tends asymptotically to a hexagonal - like lattice for a large number of bins .",
    "another nice feature of cvt is that a simple algorithm exists for its practical computation : the @xcite method , for which the cvt is a fixed point .",
    "although cvt bins are naturally smaller where the density is higher , the @xmath38 relation of the bins is not such that the mass enclosed in every bin is constant : the cvt can not be used directly to produce equal mass bins ( equal @xmath0 in the case of photon noise or with optimal pixels weighting , see section  [ sec : optim_weigth ] ) .",
    "however , we now present a modification of the lloyd algorithm allowing it to converge toward an equi - mass 2d - cvt .",
    "[ [ sec:1d - case ] ] 1d - case .",
    "+ + + + + + + +    it has been demonstrated that in 1d , and asymptotically for large numbers of bins ( which in 1d are intervals ) , the size @xmath39 of the cvt bins is proportional to the one - third power of the underlying density at the midpoint of the bin @xcite : @xmath40 . since the mass enclosed in each bin is @xmath41 , one has @xmath42 : the mass in the cvt bins is only constant for a constant density .",
    "however a cvt can still be used to partition a segment into equal mass intervals .",
    "in fact , one can derive from the previous relations that , if the cvt is performed on a different density @xmath43 , the partition found induces equal - mass bins on the original density @xmath32 : @xmath44 .",
    "this result is not being used in 1d , but can be generalized in 2d ( or higher dimensions ) to produce bins that have the nice regularity properties of the cvts but , in addition , enclose equal mass .    [",
    "[ sec:2d - case ] ] 2d - case .",
    "+ + + + + + + +    in 2d , the so - called gersho conjecture @xcite can be used to predict the corresponding relation between the area @xmath45 of a cvt bin and the underlying density @xmath32 .",
    "a consequence of this conjecture is the _ principle of equal partition of error_. in 2d , it implies that , if @xmath39 is the typical size of the cvt bin , @xmath46 is roughly constantd , one has @xmath47 . ] .",
    "since @xmath48 , one gets the relation @xmath49 . although a rigorous proof of this relation is not known ( du , private communication ) , we have verified with various numerical experiments that this relation is indeed very accurately verified in practice , even with a small number of bins ( fig .",
    "[ fig : area - density ] ) .",
    "relation of a two - dimensional cvt .",
    "over - plotted is the best fitting relation @xmath50 ( solid line ) and , for comparison , the two relations @xmath51 and @xmath52 ( dashed lines ) .",
    "the relation is a perfect straight line , with the exception of the largest bins , closer to the border , and the smallest ones , far from the continuum approximation.,title=\"fig : \" ]    applying the same reasoning in 2d as in the 1d - case , to generate equal - mass bins one has to satisfy the relation @xmath53 , which implies @xmath54 .",
    "we have thus shown that _ a cvt of the density distribution @xmath54 generates a vt with bins that asymptotically enclose a constant mass according to the density @xmath32_.    given a region @xmath11 , a density function @xmath32 and @xmath55 generators @xmath27 , our modified lloyd method to produce an equi - mass 2d - cvt is thus the following :    1 .",
    "select an initial random set @xmath27 of positions for the generators : the probability for a generator to be at position @xmath56 is proportional to @xmath31 ; 2 .",
    "[ item : lloyd2 ] perform a vt of @xmath11 associated with the generators @xmath27 : with the above initial generator distribution , the voronoi regions @xmath28 contain _ on average _ a constant mass , but the scatter is large and the bins are generally badly shaped ( as in fig .  [",
    "fig : monte - carlo ] ) ; 3 .",
    "compute the mass centroids of the @xmath28 according to the density @xmath54 : these constitute now the new set @xmath27 of generators and thus does not enforces equal mass bins . ] ; 4 .",
    "iterate over step [ item : lloyd2 ] until the coordinates of the vt generators do nt change any more .",
    "[ fig : n2273-cvt ] presents a cvt produced by applying the previous algorithm to the density @xmath32 , obtained by linearly interpolating the @xmath33 of ngc  2273 in fig .",
    "[ fig : n2273-snmap ] onto a grid with pixel size @xmath57 smaller than the original size .",
    "this interpolation is used here to approach the continuous case and ensure a better convergence of the modified lloyd algorithm . in this case of a large number of pixels the bins of the vt tend to the theoretical hexagonal shape and adapt nicely to density variations and to the irregular boundary of the region .",
    "the scatter of the @xmath0 is also close to optimal with rms scatter of @xmath58% .     , where @xmath32 is obtained by linear interpolation from the @xmath33 in fig .",
    "[ fig : n2273-snmap ] .",
    "the generators of the cvt are indicated by the black dots . _",
    "bottom panel : _ @xmath0 scatter in the above cvt .",
    "the @xmath0 of the original pixels is shown with the crosses , while the squares represent the @xmath0 of the final bins .",
    "the target @xmath59 is indicated by the solid line .",
    "the rms scatter is @xmath60% ( dashed lines).,title=\"fig : \" ] , where @xmath32 is obtained by linear interpolation from the @xmath33 in fig .",
    "[ fig : n2273-snmap ] .",
    "the generators of the cvt are indicated by the black dots . _",
    "bottom panel : _ @xmath0 scatter in the above cvt .",
    "the @xmath0 of the original pixels is shown with the crosses , while the squares represent the @xmath0 of the final bins . the target @xmath59 is indicated by the solid line .",
    "the rms scatter is @xmath60% ( dashed lines).,title=\"fig : \" ]    this cvt method illustrates the goals towards which an optimal 2d - binning algorithm should tend , but it has still some practical limitations :    1 .",
    "it generates equal - mass bins but _ not _ necessarily equal-@xmath0 bins , unless e.g.  the noise is poissonian or the bins are optimally weighted ( see the beginning of this section ) .",
    "2 .   more importantly the method does not work well when the bins are constituted of just a few pixels .",
    "this is due to the fact that the lloyd method is designed to work in a continuum approximation and does not necessarily converge to the global minimum in a discrete case , unless a good set of initial generators is chosen @xcite . in fig .  [",
    "fig : n2273-cvt - bad ] the same generators as in fig .",
    "[ fig : n2273-cvt ] where used to construct a vt for the coarser ` sauron ` pixel grid of fig .",
    "[ fig : n2273-snmap ] .",
    "the obtained vt is similar to that of fig .",
    "[ fig : n2273-cvt ] , but the @xmath0 scatter increases considerably , due to discretization effects . constructing the bins from an oversampled and interpolated grid is not an acceptable solution if an accurate solution is desired , as this would introduce correlations within the bins .",
    "one wants to construct the bins by coadding actually observed pixels .",
    ", obtained using the same generators ( black dots ) as in fig .",
    "[ fig : n2273-cvt ] . _ bottom panel : _ @xmath0 scatter in the above vt , as a function of the distance from the galaxy center .",
    "note the significant increase of the scatter ( rms of @xmath61% , dashed lines ) around @xmath62 ( solid line ) , compared to fig .",
    "[ fig : n2273-cvt ] , due to discretization effects.,title=\"fig : \" ] , obtained using the same generators ( black dots ) as in fig .",
    "[ fig : n2273-cvt ] .",
    "_ bottom panel : _ @xmath0 scatter in the above vt , as a function of the distance from the galaxy center .",
    "note the significant increase of the scatter ( rms of @xmath61% , dashed lines ) around @xmath62 ( solid line ) , compared to fig .",
    "[ fig : n2273-cvt ] , due to discretization effects.,title=\"fig : \" ]    in practice an optimal 2d - binning method has to preserve the good characteristics of the equi - mass 2d - cvt , in the limit of many pixels , but has to be able to take the discrete nature of pixels into account , when dealing with bins constituted by just a few pixels .",
    "this algorithm is the subject of the next section .      finding a good set of initial generators is crucial for the lloyd algorithm to converge to the global minimum , whenever the discrete nature of pixels is important . in this section",
    "we describe a method we developed to find the generators for the optimal vt taking the discrete nature of pixels into account from the beginning .",
    "the algorithm described here constructs an initial binning trying to generalize to 2d the standard pixel - by - pixel binning algorithm used in 1d .",
    "the centroids of the bins found in this way are then used as starting generators for a cvt .",
    "the method reduces to the previous cvt in the limit of many pixels , but works on a pixel basis with bins made by just a few pixels .    a natural 1d - binning algorithm proceeds as follows :",
    "start a bin from the highest @xmath0 unbinned pixel and accrete neighboring pixels ; when the target @xmath0 is reached a new bin is started and this process is repeated until all pixels have been binned .",
    "to extend this idea to 2d , we need to make a clever choice regarding the pixel to be accreted next , so that the topological and morphological constraints are naturally enforced .",
    "the adopted method always tries to add to the current bin the pixel that is closest to the bin centroid .",
    "furthermore , when a new bin is started , the first pixel is also selected as the one closest to the centroid of all the previously binned pixels .",
    "this simple scheme automatically _ tends to _ generate bins that are compact , and the bin @xmath0 can be carefully monitored on a pixel - by - pixel basis during the accretion phase .",
    "the centroids of the bins found in this way can be used as starting generators for a cvt .",
    "the idea described above is quite simple , but some practical problems have to be solved for a robust implementation of the algorithm . during the accretion of new bins around the bin centroid ,",
    "the topological and morphological criteria _ tend to _ be satisfied by construction , but there can be situations where this is not the case : a common example is when the accretion process hits the boundary of the dataset .",
    "in this situation , as new pixels are accreted , the shape of the growing bin will be dictated more by the shape of the border of the dataset than by the centroid criterion . as a result",
    "some bins can become very elongated or even disconnected before the target @xmath0 is reached .",
    "if this is not prevented , the centroids of the final bins will not always fall close to the bin center and can even lie outside the bin . in this case",
    "the bin centroids will not provide a good set of initial generators for the cvt and the modified lloyd algorithm may not converge to an acceptable solution ( e.g. some bins may not reach @xmath62 ) .",
    "to solve this situation the simple idea of the bin - accretion algorithm has to be complicated a little by making sure that the topological and morphological criteria are enforced for _ all _ bins , and not only for most of them . in practice",
    "the shape of the bin is monitored during the accretion phase and , if the bin does not satisfy some minimal requirements , a new bin is initiated even if the previous bin did not meet the minimum @xmath0 criterion .",
    "the bins that do not have enough @xmath0 at the end of the accretion stage will be reassigned to the closest good bin , before computing the centroids which will be used as starting points of the final cvt .",
    "in this section we translate the ideas illustrated in section  [ sec : vt ] into a practical and robust algorithm that can be used to bin actual 2d data .",
    "our optimal voronoi 2d - binning algorithm is described in detail by the following steps :    1 .",
    "[ item : baa1 ] start the first bin from the highest @xmath0 pixel of the image ; 2 .",
    "[ item : baa2 ] evaluate the mass centroid of the current bin and select the unbinned pixel closest to the centroid as candidate for addition to the bin ; 3 .",
    "[ item : baa3 ] check whether all the following conditions are satisfied in that precise order : 1 .   _",
    "topological criterion : _ the new pixel is adjacent to the current bin ; 2 .   [",
    "item : round ] _ morphological criterion : _ by adding the new pixel , the ` roundness ' @xmath63 ( see below ) of the current bin would remain below a chosen threshold ; 3 .   [ item : baa4 ] _ uniformity criterion : _ by adding the new pixel , the bin @xmath0 would not deviate from @xmath62 more than before the addition while the @xmath0 is already higher than a given fraction ( e.g. , 80% ) of the target @xmath0 ; + if all the previous criteria are fulfilled , the accretion process can go on : add the candidate pixel to the current bin and go back to step [ item : baa2 ] ; 4 .",
    "the accretion process of the current bin has come to an end .",
    "if the uniformity criterion [ item : baa4 ] was met , mark all the pixels in the bin as ` successfully binned ' , otherwise as ` unsuccessfully binned ' ; 5 .",
    "[ item : baa5 ] evaluate the mass centroid of all the pixels already binned and start a new bin from the unbinned pixel closest to this centroid ; go back to step [ item : baa2 ] until all pixels have been binned ; 6 .",
    "compute the centroid of each successful bin and reassign the ` unsuccessfully binned ' pixels to the closest of these centroids ; 7 .",
    "recompute the centroid of each bin obtained from the previous step : these centroids are then used as initial generators of a cvt , which is computed with the modified lloyd method of section  [ sec : cvt ] .",
    "the quantity @xmath63 used in step [ item : round ] is any quantity measuring the ` roundness ' of a bin .",
    "it can be simply defined as : @xmath64 where @xmath65 is the maximum distance between the centroid of the bin and any of the bin pixels , and @xmath66 is the radius of a disk of same area as the whole bin . with this definition ,",
    "@xmath67 for a perfectly circular bin and @xmath68 otherwise .",
    "we found that a roundness threshold @xmath69 gives good results .",
    "[ fig : bin - accretion ] provides a visual explanation of the four major stages of the above algorithm . for illustration purposes ,",
    "it has been applied to a ` continuous ' density distribution , obtained by linearly resampling the @xmath33 of fig .",
    "[ fig : n2273-snmap ] onto a regular @xmath57 finer grid . after a bin - accretion stage ,",
    "the unsuccessfully binned pixels are flagged and reassigned to the closest successful bin , and a vt is generated from the centroids of the bins .",
    "an example of the application of our optimal voronoi 2d - binning algorithm to the actual ` sauron ` data of ngc  2273 is shown in the top panel of fig .",
    "[ fig : bubbles - final ] , while the resulting @xmath0 scatter is shown in the bottom panel : the rms value is @xmath70%",
    ". the @xmath0 values , symmetrically clustered around the target @xmath17 , essentially represent the lowest @xmath0 scatter obtainable from a binning of these data : all the scatter is due to discretization noise , which increases towards the galaxy center , where the bins are made of a smaller number of pixels .",
    "this figure shows that the method is able to guarantee a minimum @xmath0 to _ all _ bins , while retaining a regular shape .",
    "scatter in the above binning .",
    "the solid line represents the target @xmath0 level , while the two dashed lines show the rms scatter ( @xmath71% ) .",
    "note the decrease of the @xmath0 scatter compared to fig .",
    "[ fig : n2273-cvt - bad].,title=\"fig : \" ]   scatter in the above binning .",
    "the solid line represents the target @xmath0 level , while the two dashed lines show the rms scatter ( @xmath71% ) .",
    "note the decrease of the @xmath0 scatter compared to fig .",
    "[ fig : n2273-cvt - bad].,title=\"fig : \" ]    the binning resulting from this algorithm is qualitatively similar to the one obtained using the cvt ( see fig .  [",
    "fig : n2273-cvt - bad ] ) .",
    "but , by contrast to the cvt alone , this method is able to produce bins that are essentially optimal also in the ` small - bins ' regime , with bins of only 24  pixels .",
    "the stellar mean velocity and velocity dispersion fields extracted from the binned data are shown in fig .",
    "[ fig : n2273_velfield ] and fig .",
    "[ fig : n2273_sigfield ] .",
    "the spectra obtained with ` sauron`include prominent gas emission lines of h@xmath72 , [ o@xmath73@xmath744959 , 5007 and [ n@xmath73 @xmath755200 .",
    "the kinematics extraction was performed in pixel - space using the method of @xcite , and adopting a single k1  iii template star observed with ` sauron ` .",
    "the spectral regions possibly contaminated by gas emission lines were excluded from the fit in all spectra . not surprisingly , while for the unbinned data some information can be extracted only from the galaxy central regions , where the pixels @xmath0 is naturally high enough , the use of binned data leads to consistent measurements over the whole observed field .",
    "field measured from the unbinned ` sauron ` data of ngc  2273 ( _ top panel _ ) , is compared to the linearly interpolated velocity field extracted from the 2d - binned spectra ( _ bottom panel _ ) .",
    "the same color levels are used in both plots .",
    "the flux weighted centroids ( _ not _ the vt  generators ) of the bins used ( fig .",
    "[ fig : bubbles - final ] ) are indicated by the black dots .",
    "some representative contours of the galaxy surface brightness are also shown .",
    "the interpolated binned velocity field was truncated to the centroids of the outer bins.,title=\"fig : \" ]   field measured from the unbinned ` sauron ` data of ngc  2273 ( _ top panel _ ) , is compared to the linearly interpolated velocity field extracted from the 2d - binned spectra ( _ bottom panel _ ) .",
    "the same color levels are used in both plots . the flux weighted centroids ( _ not _ the vt  generators ) of the bins used ( fig .",
    "[ fig : bubbles - final ] ) are indicated by the black dots .",
    "some representative contours of the galaxy surface brightness are also shown .",
    "the interpolated binned velocity field was truncated to the centroids of the outer bins.,title=\"fig : \" ]      for the stellar velocity dispersion @xmath76 field .",
    "very little information on the dispersion field can be extracted without binning.,title=\"fig : \" ]   for the stellar velocity dispersion @xmath76 field .",
    "very little information on the dispersion field can be extracted without binning.,title=\"fig : \" ]    the kinematics maps in fig .",
    "[ fig : n2273_velfield ] and [ fig : n2273_sigfield ] were linearly interpolated using a delaunay triangulation of the measured values , which were assigned to the position of the flux weighted centroid of each bin .",
    "if the underlying kinematics varies smoothly over the scale of the bins , and if the measurements errors are negligible , this approach closely recovers the ` true ' kinematical field . using an interpolation it becomes easy to visually detect regularities in the data , like the almost perfect point - symmetry of the velocity field in the bottom panel of fig .",
    "[ fig : n2273_velfield ] .    in general however , with non - negligible errors , any visualization scheme that tries to reproduce",
    "the measurements exactly creates artifacts whose reality is difficult to judge .",
    "the problem lies in the fact that in 2d kinematics maps there is no standard way to visualize error , which one is used to see in 1d kinematics profiles .",
    "for this reason it becomes difficult to distinguish noise fluctuations from real features in the data . a solution would be to use standard non- parametric methods , like ` smoothing splines ' @xcite or ` kernel estimators ' @xcite , to recover the kinematical field and display the maps , taking measurements errors into account .",
    "this assumes of course that the intrinsic 2d field under study is smooth on the scale of a bin .",
    "if this is not the case , there is no way one can tell it from the data : binning is in fact only applied when noise dominates over the small spatial scales , and the fine details are already lost .",
    "the recovery of the intrinsic velocity field is however beyond the scope of the present paper . in 2d like in 1d , binning is generally simply used to obtain a reliable measure of some quantity inside a given spatial region .",
    "the measure is then compared with models ( e.g.dynamical ones ) , which are evaluated exactly inside the same spatial region as the real observation .",
    "as long as the assumption in the model are correct , and model and data are treated in the same way , one does not have to worry about what happens inside each bin .",
    "similar tests of binning ifs data were performed on a number of objects for which data obtained with ` sauron `  were available .",
    "in addition we also performed 2d binning of galaxy images .",
    "the results presented here for ngc  2273 are representative of all the cases we tried .",
    "software implementing in idl the method described in this section is available from + http://www.strw.leidenuniv.nl/@xmath77mcappell / idl/. + in addition to the desired target @xmath0 , only four columns of numbers are required as input : the coordinates @xmath78 of each pixel and the corresponding signal @xmath79 and noise @xmath80 . in output to each pixel",
    "a bin number will be assigned .",
    "the above idl implementation took 3.5 s on a 1 ghz pc to generate the 2d - binning shown in fig .",
    "[ fig : bubbles - final ] , which is composed of 3107 pixels grouped into 335 bins .",
    "the computation time scales roughly with the number of pixels to bin .",
    "the memory needed by the algorithm is comparable to that required to store the pixels themselves .",
    "the problem of adaptively binning 2d data ( e.g.  spatial elements of ifs or imaging data ) to a constant @xmath0 per bin has been analyzed in detail .",
    "the goals towards which an optimal algorithm should tend have been presented , and the limitations of different approaches , making innovative use of the voronoi tessellations , have been discussed . finally a robust algorithm that solves the 2d - binning problem in an optimal way has been described .",
    "the different methods have been applied to the binning and to the extraction of the stellar kinematics from the ` sauron ` data of the barred sa galaxy ngc  2273 .",
    "binning is invariably used to analyze 1d ( e.g.  long - slit ) spectroscopic observations .",
    "we believe adaptive 2d - binning should become common practice for the analysis of 2d data too ( in particular spectral data ) .",
    "this method is being used systematically in the analysis of the ifs data obtained by the ` sauron ` project .",
    "our binning methods can be naturally extended to three dimensions .",
    "the cvt binning described here can also be used with discrete datasets , like e.g.  stellar proper motions observations for globular clusters , or datasets coming from n - body simulations ( e.g. * ? ? ?",
    "* ) , or x - ray data .",
    "mc s research was supported through a european space agency external fellowship .",
    "yc s research was supported through a european community marie curie fellowship .",
    "we thank tim de zeeuw and eric emsellem for helpful comments on the manuscript and gijs verdoes kleijn for lively discussions on 2d - binning .",
    "we are indebted to qiang du for clarifications regarding the gersho conjecture .",
    "we thank the ` sauron ` team for providing the data of ngc  2273 and for fruitful discussions on the method .",
    "bacon r. et al . , 2001 , mnras , 326",
    ", 23    cappellari m. , verolme e.  k. , van der marel r.  p. , verdoes kleijn g.  a. , illingworth g.  d. , franx m. , carollo c.  m. , de zeeuw p.  t. , 2002 , apj , 578 , 787    de zeeuw p.  t. et al .",
    ", 2002 , mnras , 329 , 513    du q. , faber v. , gunzburger m. , 1999 , siam review , 41 , 637    gersho a. , 1979 , ieee trans .",
    "theory , 25 , 373    gray r.  m. , neuhoff d.  l. , 1998 , ieee trans .",
    "theory , 44 , 2325    jedrzejewski r.  i. , 1987 , mnras , 226 , 747    kuijken k. , merrifield m.  r. , 1993 , mnras , 264 , 712    lloyd s.  p. , 1982",
    ", ieee trans .",
    "theory , 28 , 129    okabe a. , boots b. , sugihara k. , chiu s.  n. , 2000 , spatial tessellations : concepts and applications of voronoi diagrams , 2nd edn .",
    "wiley , chichester , uk    pemmaraju s.  v. , skiena s.  s. , 2003 , computational discrete mathematics : combinatorics and graph theory with _ mathematica _ , cambridge university press , cambridge    robertson j.  g. , 1986 , pasp , 98 , 1220    samet h. , 1984 , acm computing surveys , 16 , 187    sanders j.  s. , fabian a.  c. , 2001 , mnras , 325 , 178    schaap w.  e. , van de weygaert r. , 2000 , a&a , 363 , l29    scott d.  w. , 1992 , multivariate density estimation , whiley , new york    whaba g. , 1990 , spline models for observational data , siam , philadelphia",
    "closely related to the vt , is the delaunay triangulation ( in 2d ) , that can be obtained from the tessellation by connecting each generator to the generators of the adjacent voronoi regions .",
    "the delaunay triangulations are widely used in various applications such as finite elements methods and interpolation schemes , due to the fact that , once the set of generators has been defined , they optimize the geometric quality of the resulting triangulation .    a complementary way of looking at the regularity of the grid obtained with the cvt consists of constructing the delaunay triangulation of the generators found by lloyd s algorithm . this triangulation can be easily computed by connecting with each other all generators of adjacent bins and is represented in fig .",
    "[ fig : delaunay ] for the cvt of fig .",
    "[ fig : n2273-cvt ] .",
    "the triangulation obtained is composed of triangles whose shape is asymptotically close to equilateral , and indeed it is easy to understand that hexagonal voronoi regions correspond to equilateral triangles of the delaunay triangulation computed from the same set of generators .",
    "this fact makes obvious the close connection , in the continuum case , between the problem of generating an optimal adaptive 2d - binning of a given region and that of constructing an optimal triangulation of the same region .",
    "these are in fact just two different ways of looking at the same problem . ignoring boundary effects ,",
    "cvt are an extremely simple but powerful tool for the construction of an unstructured mesh , and the obtained triangulations are of quality comparable to the most advanced and complex mesh generation methods .",
    "the @xmath81 relation between the size of cvt bins and the density , which derives from gersho conjecture , makes it possible to adapt the size of the mesh to any desired distribution , while still preserving the equilateral characteristic of the generated mesh ."
  ],
  "abstract_text": [
    "<S> we present new techniques to perform adaptive spatial binning of integral - field spectroscopic ( ifs ) data to reach a chosen constant signal - to - noise ratio per bin . </S>",
    "<S> these methods are required for the proper analysis of ifs observations , but can also be used for standard photometric imagery or any other two - dimensional data . </S>",
    "<S> various schemes are tested and compared by binning and extracting the stellar kinematics of the sa galaxy ngc  2273 from spectra obtained with the panoramic ifs ` sauron ` .    </S>",
    "<S> [ firstpage ]    methods : data analysis  techniques : photometric  techniques : spectroscopic </S>"
  ]
}