{
  "article_text": [
    "lock - in detection is a well - known method for picking out a small modulated signal of interest in the presence of a large background . after multiplying the signal - plus - background by the modulation waveform ,",
    "the dc component is proportional to the signal while the background now alternates and can be filtered out .",
    "an early account of this idea dates back to 1934 @xcite , when it was used to detect the balanced state of an ac bridge .",
    "subsequent improvements to the electronics by michels , curtis and redding @xcite resulted in a practical , narrow - band detector of high sensitivity , now widely known as a lock - in amplifier .",
    "this became a ubiquitous laboratory tool after it was commercialised by robert dicke and princeton applied research @xcite .",
    "the lock - in technique has been extended to measure several modulated signals simultaneously . in the context of high - precision measurement , harrison , player , and sandars ( hps )",
    "@xcite describe signal modulation with complex , multi - frequency waveforms chosen to be mutually orthogonal . more recently in the context of optical tomography refs .",
    "@xcite consider phase - sensitive detection at several frequencies .",
    "careful choice of the frequencies and filter time constants allows the signals to be extracted independently .    in this paper",
    "we extend the work of hps .",
    "first , in order to establish a theoretical framework , we review the case when a single parameter is modulated",
    ". then , in section[sec : multi ] we revist and extend the hps discussion of multi - channel modulation and detection . in section[sec : repeat ] , we introduce and analyse the problem of reproducible backgrounds and in section [ sec : random ] we present a new , stochastic technique that solves the problem .",
    "we close with a summary in section [ sec : conclusions ] .",
    "consider a simple experiment with a scalar output signal , @xmath0 , and a binary control parameter , @xmath1 , which we set to the value @xmath2 or @xmath3 over each of @xmath4 equal time intervals , labeled by the integer @xmath5 .",
    "we sometimes refer to the set of values @xmath6 as a switching pattern or waveform .",
    "we write the signal measured in each time interval as @xmath7 with @xmath8 . here",
    "@xmath9 is a background term , which may be time - varying , and @xmath10 is the modulated part of the signal that we are trying to extract , which we will assume to be constant .",
    "note that this form of the signal does not assume a linear response to the control parameter @xmath6 .",
    "we obtain an estimate , @xmath11 , of the modulation strength , @xmath10 , by looking at the part of the signal correlated with @xmath6 , @xmath12 the error in this estimate of @xmath10 is , @xmath13 our goal is to devise a scheme that gives the best estimate of @xmath10 , least affected by the presence of the background @xmath14 .    if @xmath14 is constant during an experiment , then any switching waveform that is equally often positive and negative will reject it perfectly .",
    "we will call a waveform that has this property _ balanced_.",
    "it is more realistic though to let the background vary in time , and then the cancellation of @xmath14 is normally imperfect . to optimise the choice of @xmath6 we must consider in more detail how @xmath9 varies",
    "let us define the discrete fourier transform of @xmath14 , @xmath15 and write eq.([eq : demoderr ] ) in terms of these fourier components , @xmath16 where the large - bracketed quantity is nothing more than @xmath9 . rewriting this as @xmath17 we see that each fourier component of the background contributes to the error in proportion to the ( inverse ) fourier component of the modulation waveform at that frequency . in the laboratory , the fourier spectrum of the background",
    "is often dominated by the low frequency components , typified by the well - known @xmath18 power spectrum .",
    "in general terms , then , it is often desirable to have the fourier spectrum of the modulation waveform reside at as high a frequency as possible .",
    "the simple modulation @xmath19 achieves this , indeed that is the square - wave version of the standard lock - in detection scheme @xcite .",
    "we shall see , though , that switching waveforms more complex than this fast square wave have some advantages when we come to consider multi - channel detection in section [ sec : multi ] .",
    "equation [ eq : fourier ] describes how a particular time - dependent background , @xmath9 , will produce an error in a particular measurement of @xmath11 . to properly consider the impact of _ noisy _ backgrounds we need to consider what happens when we repeat the measurement a number of times .",
    "a noisy background is one that differs from one experimental realisation to the next , in contrast to a _",
    "reproducible _ background which is the same for each experimental realisation .",
    "we extend our treatment to multiple experimental realisations by allowing @xmath9 to be a stochastic variable . to evaluate the effectiveness of a switching waveform",
    "it is then necessary to consider the statistical properties of the error , @xmath20 , averaged over many experimental realisations .",
    "we begin by limiting ourselves to purely noisy backgrounds , that is backgrounds for which the expected value of @xmath9 is @xmath21 .",
    "we consider backgrounds where this limitation does not hold in section [ sec : repeat ] .",
    "for these purely noisy backgrounds it is easy to see from equation [ eq : demoderr ] that @xmath22 , which is to say that our estimates of @xmath10 will be unbiased .",
    "they will , though , be noisy as @xmath9 changes from one experimental realisation to the next . to quantify this noise",
    "let us calculate the standard deviation , @xmath23 , which gives the statistical uncertainty in our measurement of @xmath10 .",
    "this is given by @xmath24 in the first step here , we have used the fact that @xmath20 has zero mean .    it is common to characterise noise by a power spectrum , which defines the ( real ) amplitude @xmath25 of each fourier component , assumed to be constant for each experimental realisation .",
    "the phase @xmath26 of each component must vary in some way between realisations for this to be called noise .",
    "let us make the simplifying assumption that the phases for each component are independently drawn from a uniform distribution over @xmath27 for each experimental realisation .",
    "although this noise model is quite restricted , it does provide a reasonable approximation to typical laboratory noise and it simplifies equation [ eq : sd ] in an instructive way . inserting @xmath28 into equation[eq : sd ] , and writing the expected value operator explicitly as a sum , we obtain @xmath29 where @xmath30 is the @xmath31th realisation of the stochastic variable @xmath32 . the quantity in parentheses is zero unless @xmath33",
    ", hence the sum simplifies to @xmath34 we see that the individual frequency contributions sum in quadrature for this class of noise .",
    "in section [ sec : single ] we have considered how to find the modulation strength @xmath10 when one parameter is modulated by control parameter @xmath1 .",
    "now we extend this to the case of multiple modulations . to help establish the notation ,",
    "let us consider the signal when there are two control parameters , @xmath35 and @xmath36 , @xmath37 in addition to the responses @xmath38 and @xmath39 , there is also the bilinear response @xmath40 to the product of control parameters .",
    "put another way , this part of the signal is correlated with the _ relative _ sign of the two control parameters .",
    "similarly , with three modulations , there is a trilinear term as well as the bilinear and linear ones . when @xmath41 parameters are modulated by switching waveforms @xmath42 , where @xmath43 , the signal generalises to @xmath44 here @xmath45 labels all the subsets of @xmath46 , i.e. , all the linear , bilinear , trilinear , etc",
    ". terms . for convenience ,",
    "the last equality renames the product of control parameters in term @xmath45 as @xmath47 ( @xmath45 being a label , not a power ) , which we sometimes refer to as an _ analysis waveform_.    with several experimental parameters @xmath48 , each modulated by a different waveform @xmath42 to produce a string of @xmath4 signals @xmath49 , the response @xmath50 to each individual modulation is estimated by the generalisation of equation[eq : extract ] : @xmath51 this relies on the use of switching patterns @xmath42 that are mutually orthogonal . as before we will require the switching waveforms to be balanced , so that constant backgrounds are rejected .",
    "the same strategy also applies to the multi - linear responses , allowing the further generalisation @xmath52 provided the analysis waveforms @xmath53 are also mutually orthogonal . in order",
    "that these multi - linear responses also reject constant backgrounds we will require the analysis waveforms to be balanced , which does not automatically follow from the switching waveforms being balanced . we will call a set of switching waveforms _ completely balanced _ if all products of them ( i.e. all analysis waveforms ) are balanced .",
    "harrison , player and sandars @xcite have presented a simple scheme for generating a set of mutually orthogonal , completely balanced switching waveforms , and a compact notation for naming them .",
    "they start with a basic set of square waves , @xmath54 where @xmath55 indicates the ceiling function . as in section",
    "[ sec : single ] , the integer @xmath5 specifies the time step and runs from zero to @xmath56 , where @xmath4 is the total number of steps in the switching sequence , constrained to be an even integer power of 2 . the integer label @xmath57 ranges from zero to @xmath58 .",
    "for instance , when @xmath59 , we have three basic square waves @xmath60 switching waveforms @xmath1 are constructed by multiplying any combination of basic square waves together .",
    "it is convenient for these to be identified by a binary code that indicates which basic square waves are included , with the @xmath31th least significant bit indicating whether the @xmath31th basic waveform is included .",
    "for example , @xmath61 we will find it useful later to introduce an optional , over - all inversion , indicated by an asterisk .",
    "for example , @xmath62 .",
    "the basic waveforms are all balanced .",
    "the symmetry of the hps waveforms also ensures that multiplying any waveform by a basic waveform flips an equal number of positive and negative entries , leaving the result balanced . in this way ,",
    "all non - trivial waveforms generated with the hps technique are balanced .",
    ", the number of non - trivial hps waveforms is @xmath56 .",
    "by contrast , the number of balanced waveforms is @xmath63 , that being the number of distinct ways to assign the value @xmath2 to @xmath64 of the sites ( and @xmath3 to the rest ) . ]",
    "note that the trivial pattern of constant @xmath2 is a valid hps waveform , which we label @xmath65 , and while it is not balanced , it is useful to include in the discussion as it can be used to extract the average value of the background .    in order to extract all the responses from a signal , all analysis waveforms @xmath53 must be mutually orthogonal .",
    "the construction of the hps waveforms ensures that all distinct waveforms are orthogonal , meaning it is sufficient to ensure that all analysis waveforms are distinct .",
    "note well that this is a stronger constraint than ensuring that all _ switching _ waveforms are distinct .",
    "this point was not addressed by hps @xcite , but is of great practical relevance when it comes to choosing the set of modulation waveforms .",
    "for example , let us choose three modulation waveforms @xmath66 , @xmath67 and @xmath68 .",
    "these are mutually orthogonal , but the analysis waveform @xmath69 is the same as @xmath70 and therefore we can not separate the bilinear response @xmath40 from the linear response @xmath71 with this choice of modulation waveforms .    requiring all the analysis waveforms to be distinct imposes a minimum length on the waveform , which depends on the number of parameters being modulated . given @xmath41 parameters , each modulated with a different switching pattern @xmath42 , the number of independent analysis waveforms @xmath53 is @xmath72 .",
    "linear responses , @xmath73 bilinear responses , @xmath74 trilinear , etc . , terminating with one response to the product of all @xmath75 modulations , plus the trivial waveform @xmath65 . summing the number of responses we obtain a total of @xmath76 .",
    "] since the signal is made up of @xmath4 numbers , @xmath77 , the linear combinations of its elements can only represent @xmath4 independent variables , and therefore a full analysis is only possible if the length @xmath4 of the switching pattern is at least @xmath76 .",
    "this means that the number of digits in the longest binary hps code must equal or exceed the number of parameters being modulated .    to test whether all analysis waveforms resulting from a given set of switching waveforms are distinct and orthogonal",
    ", one could simply generate them and check . in practice , however , we normally test the waveforms in a different way that is equivalent but easier to implement . with @xmath41 switched parameters , the set of switches can be in any one of @xmath76 combined states in each time interval . if the set of switching waveforms is such that each of these @xmath76 states is visited an equal number of times in the @xmath4 measurements , then all of the analysis waveforms are distinct and orthogonal . in the example above of @xmath66 , @xmath67 and @xmath68 , only 4 of the 8 combined switch states",
    "are accessed , specifically @xmath78 , indicating that these switching waveforms do not result in a full set of orthogonal analysis waveforms .",
    "we will employ hps waveforms exclusively in the rest of this paper .",
    "in the latter part of section[sec : single ] we considered a background @xmath14 that varies purely randomly , that is without any consistent , repeatable part .",
    "we showed that although the measurement is perturbed by this background , @xmath11 converges to the true value @xmath10 in the long - term average . in this section",
    "we allow some part of the background to vary in the same way over each set of @xmath4 measurements .",
    "we will see that this gives a biased result when using the detection method described so far , and we show how a modification of the method can remove this bias .    to give a concrete example of such a background we consider a measurement recently made in our laboratory @xcite . in this experiment",
    "a molecular beam is subjected to a number of manipulations by static electric and magnetic fields , rf magnetic fields , and laser light , after which we measure the number of molecules in a particular quantum state .",
    "we modulate these fields in a number of ways , and in particular , we switch the signs of the static electric and magnetic fields .",
    "we seek to detect a modulation strength associated with the relative sign of the electric and magnetic fields , which would indicate that the charge distribution within electrons is not spherical .",
    "we modulate 9 experimental parameters using the scheme described in this paper .",
    "our waveforms have length @xmath79 , and making a single _ block _ of @xmath80 measurements takes a few minutes .",
    "we then repeat this experiment , for months at a time , amassing many thousands of blocks in order to reduce the final measurement uncertainty .",
    "noise sources include shot noise and electronic noise in the detection system , fluctuations of the beam intensity , and instability of the various fields . using the techniques described above we reduce the impact of that noise through careful choice of the modulation waveforms",
    ". however , part of the varying background is reproducible .",
    "for example , the molecular source heats up during each block of measurements , resulting in a drift of the signal @xmath77 as the experiment progresses .",
    "there is a pause between each block where various parameters of the equipment are optimised and during this pause the source cools down again .",
    "the consequent repeating background introduces a bias that would invalidate the measurement , but we are able to suppress the bias by the method we now describe .",
    "let us consider a background which is the sum of a reproducible part @xmath81 and a purely random part .",
    "we define the bias @xmath82 as the error in measuring the parameter @xmath83 , averaged over many experimental realisations .",
    "equation [ eq : mmcextract ] and equation [ eq : mcsig ] then give @xmath84 = \\frac{1}{n } \\sum_{j = 0}^{n - 1}{\\gamma_j w^{q}_j}\\ , \\ ] ] where we have used the linearity of equation [ eq : mmcextract ] and the fact that the random part of the background generates no bias .",
    "the last equality is intended to show the problem clearly : in each experimental realisation the error due to @xmath81 is the same , producing a bias that does not average away .    to get out of this pickle",
    "we can vary the switching waveforms between experimental realisations . in this case",
    "the last equality in equation [ eq : bias ] does not hold , and we must write instead @xmath85 } \\,.\\ ] ] we can see that this offers a solution to the problem : the bias will vanish if the waveform , averaged over all experimental realisations , is orthogonal to the repeating part of the background . the simplest way to arrange this for all @xmath81 is to randomise the waveforms , making @xmath86=0 $ ] . randomising the waveforms",
    "makes sure that the error from the reproducible background is different in each measurement , in effect converting the bias into noise .",
    "there is a pleasing symmetry to this : by introducing structured waveforms we were able to reduce the impact of noisy backgrounds on our measurement , and we see that by introducing randomness into the waveforms we are able to reduce the impact of structured backgrounds .",
    "the dashed line and arrow indicate the power level that would result from spreading the power equally over all fourier components.,width=377 ]    our aim is to randomise the waveforms partially : enough to make sure that measurement bias from reproducible backgrounds is suppressed , while retaining the noise rejecting properties of the lock - in scheme .",
    "we therefore generate new waveforms for each experimental realisation by randomly generating hps codes , but with constraints to ensure that they have the frequency properties we desire .",
    "the hps waveform notation provides a particularly simple way to do this .",
    "let us consider again the experiment described in section [ sec : repeat ] , which uses switching waveforms of length @xmath79 , specified by 12-bit hps codes . to select suitable waveforms for this experiment",
    "we first generate a set of 12-bit codes , one for each switch , choosing the bits at random .",
    "we then check each analysis channel of particular interest to see whether it satisfies two constraints .",
    "first , its hps code must not have more than one zero in the last four bits .",
    "this ensures that the corresponding analysis waveform will reject low frequency noise as a result of its strong high - frequency content .",
    "second , there must be no more than four zeros in the leading eight bits representing the slower basic waveforms .",
    "this ensures that the analysis waveform has a complex structure , needed to suppress the residual error due to slow variations in the background , as discussed by hps @xcite .",
    "if either test is failed , we generate a new set of codes and repeat until the tests are passed . finally , we chose at random whether to invert each switching waveform , with probability 1/2 .",
    "this partial randomisation scheme completely eliminates bias in the measurement . at any step in the sequence of @xmath4 time bins ,",
    "every analysis waveform is randomised , with equal probability of being -1 or + 1 because of the randomly chosen inversions .",
    "this satisfies the requirement that @xmath86=0 $ ] . by randomising the waveform codes between each experimental realisation",
    "we also ensure that no one analysis waveform performs consistently poorly , as would be likely to happen if fixed codes were used .    to understand the impact of the partial randomisation scheme , it is instructive to look at the average power spectra of some waveforms . figure [ fig : single ] shows the power spectrum of a particular 12-bit hps waveform , @xmath87 .",
    "we see that this has most of its power concentrated at high frequency , so it is effective in rejecting low frequency noise",
    ". however , as we have seen , we will be susceptible to bias if we use this waveform for every measurement . at the opposite extreme ,",
    "figure [ fig : random ] shows the average power spectrum for @xmath88 hps waveforms chosen randomly without any constraint on the hps code . while these waveforms will yield an unbiased result , they do not provide good noise rejection as the average power spectrum is completely white .",
    "figure [ fig : partial ] shows the average power spectrum of a waveform generated using the algorithm described above .",
    "we see that this waveform offers the best of both worlds .",
    "the average power is spread over a broad range of the higher frequencies while low freqency components are almost completely absent .",
    "thinking in the time - domain , if we were to string together all the partially randomised waveforms chosen for a given analysis channel , the switching pattern would be high - frequency periodic in the short term but random and uncorrelated in the long term .",
    "it is this combination of short - term periodicity to reject noise , together with long term randomness to reject repetitive backgrounds , that makes the scheme effective .",
    "we have shown that the multi - channel lock - in detection scheme introduced by hps yields information on all the responses , but only after minimum - length and completeness requirements are applied to the choice of modulation waveforms .",
    "a method is given for testing the suitability of the waveform set .",
    "we have shown how to evaluate the standard deviation of the measurement results in the presence of random noise .",
    "finally , we have pointed out that many experiments also have a reproducing pattern of background variation that can bias the results of the measurement .",
    "we have described a scheme for partially randomising the modulation waveforms in such a way that this bias averages to zero and merely contributes to the noise .",
    "this work was supported by the royal society , the uk epsrc and stfc and by the european commission ."
  ],
  "abstract_text": [
    "<S> high - precision measurements benefit from lock - in detection of small signals . here </S>",
    "<S> we discuss the extension of lock - in detection to many channels , using mutually orthogonal modulation waveforms , and show how the the choice of waveforms affects the information content of the signal . </S>",
    "<S> we also consider how well the detection scheme rejects noise , both random and correlated . </S>",
    "<S> we address the particular difficulty of rejecting a background drift that makes a reproducible offset in the output signal and we show how a systematic error can be avoided by changing the waveforms between runs and averaging over many runs . </S>",
    "<S> these advances made possible a recent measurement of the electron s electric dipole moment@xcite . </S>"
  ]
}