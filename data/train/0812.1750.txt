{
  "article_text": [
    "there has been a great deal of attention devoted in recent years to the properties of the hot x - ray - emitting plasma ( the intracluster medium , hereafter icm ) in the central regions of massive galaxy groups and clusters . to a large extent , the focus has been on the competition between radiative cooling losses and various mechanisms that could be heating the gas and therefore ( at least partially ) offsetting the effects of cooling . prior to the launch of the _ chandra _ and _ xmm - newton _ x - ray observatories",
    ", it was generally accepted that large quantities of the icm should be cooling down to very low energies , where it would cease to emit x - rays and eventually condense out into molecular clouds and form stars ( fabian 1994 ) .",
    "however , the amount of cold gas and star formation actually observed in most systems is well below what was expected based on analyses of _ rosat _ , _ asca _ , and _ einstein _",
    "x - ray data ( e.g. , voit & donahue 1995 ; edge 2001 ) . new high spatial and spectral resolution data from _ chandra _ and _ xmm - newton _ has shown that , while cooling is clearly important in many groups and clusters ( so - called ` cool core ' systems ) , relatively little gas is actually cooling out of the x - ray band to temperatures below @xmath0 k ( peterson et al .  2003 ) .",
    "it is now widely believed that some energetic form of non - gravitational heating is compensating for the losses due to cooling .",
    "indeed , it seems likely that such heating goes beyond a simple compensation for the radiated energy .",
    "as well as having a profound effect on the properties of the icm , it seems that the heat input also has important consequences for the formation and evolution of the central brightest cluster galaxy ( bcg ) and therefore for the bright end of the galaxy luminosity function ( e.g. , benson et al .",
    "2003 ; bower et al .  2006 , 2008 ) .",
    "the thermal state of the icm therefore provides an important probe of these processes and a concerted theoretical effort has been undertaken to explore the effects of various heating sources ( e.g. , supermassive black holes , supernovae , thermal conduction , dynamical friction heating of orbiting satellites ) using analytic and semi - analytic models , in addition to idealised and full cosmological hydrodynamic simulations ( e.g. , binney & tabor 1995 ; narayan & medvedev 2001 ; ruszkowski et al .  2004 ; mccarthy et al .  2004 ; kim et al .  2005 ;",
    "voit & donahue 2005 ; sijacki et al .",
    "2008 ) . in most of these approaches",
    ", it is implicitly assumed that _ gravitationally - induced _ heating ( e.g. , via hydrodynamic shocks , turbulent mixing , energy - exchange between the gas and dark matter ) that occurs during mergers / accretion is understood and treated with a sufficient level of accuracy .",
    "for example , most current analytic and semi - analytic models of groups and clusters attempt to take the effects of gravitational heating into account by assuming distributions for the gas that are taken from ( or inspired by ) non - radiative cosmological hydrodynamic simulations  the assumption being that these simulations accurately and self - consistently track gravitational processes .",
    "however , it has been known for some time that , even in the case of identical initial setups , the results of non - radiative cosmological simulations depend on the numerical scheme adopted for tracking the gas hydrodynamics . in particular , mesh - based eulerian ( such as adaptive mesh refinement , hereafter amr ) codes appear to systematically produce higher entropy ( lower density ) gas cores within groups and clusters than do particle - based lagrangian ( such as smoothed particle hydrodynamics , hereafter sph ) codes ( see , e.g. , frenk et al .",
    "1999 ; ascasibar et al .",
    "2003 ; voit , kay , & bryan 2005 ; dolag et al .",
    "2005 ; oshea et al .",
    "this may be regarded as somewhat surprising , given the ability of these codes to accurately reproduce a variety of different analytically solvable test problems ( e.g. , sod shocks , sedov blasts , the gravitational collapse of a uniform sphere ; see , e.g. , tasker et al .",
    "2008 ) , although clearly hierarchical structure formation is a more complex and challenging test of the codes . at present",
    ", the origin of the cores and the discrepancy in their amplitudes between eulerian and lagrangian codes in cosmologically - simulated groups and clusters is unclear .",
    "there have been suggestions that it could be the result of insufficient resolution in the mesh simulations , artificial entropy generation in the sph simulations , galilean non - invariance of the mesh simulations , and differences in the amount of mixing in the sph and mesh simulations ( e.g. , dolag et al .  2005 ; wadsley et al .",
    "we explore all of these potential causes in  4 .",
    "clearly , though , this matter is worth further investigation , as it potentially has important implications for the competition between heating and cooling in groups and clusters ( the cooling time of the icm has a steep dependence on its core entropy ) and the bright end of the galaxy luminosity function . and",
    "it is important to consider that the total heating is not merely the sum of the gravitational and non - gravitational heating terms .",
    "the rankine - hugoniot jump conditions tell us that the efficiency of shock heating ( either gravitational or non - gravitational in origin ) _ depends on the density of the gas at the time of heating _ ( see , e.g. , the discussion in mccarthy et al .",
    "this implies that if gas has been heated before being shocked , the entropy generated in the shock can actually be amplified ( voit et al .",
    "2003 ; voit & ponman 2003 ; borgani et al .  2005",
    "; younger & bryan 2007 ) .",
    "the point is that gravitational and non - gravitational heating will couple together in complex ways , so it is important that we are confident that gravitational heating is being handled with sufficient accuracy in the simulations .",
    "a major difficulty in studying the origin of the cores in cosmological simulations is that the group and cluster environment can be extremely complex , with many hundreds of substructures ( depending on the numerical resolution ) orbiting about at any given time .",
    "furthermore , such simulations can be quite computationally - expensive if one wishes to resolve in detail the innermost regions of groups and clusters ( note that , typically , the simulated cores have sizes @xmath1 ) .",
    "an alternative approach , which we adopt in the present study , is to use idealised simulations of binary mergers to study the relevant gravitational heating processes .",
    "the advantages of such an approach are obviously that the environment is much cleaner , therefore offering a better chance of isolating the key processes at play , and that the systems are fully resolved from the onset of the simulation .",
    "the relatively modest computational expense of such idealised simulations also puts us in a position to be able to vary the relevant physical and numerical parameters in a systematic way and to study their effects .",
    "idealised merger simulations have been used extensively to study a variety of phenomena , such as the disruption of cooling flows ( gmez et al .",
    "2002 ; ritchie & thomas 2002 ; poole et al .  2008 ) , the intrinsic scatter in cluster x - ray and sunyaev - zeldovich effect scaling relations ( ricker & sarazin 2001 ; poole et al .",
    "2007 ) , the generation of cold fronts and related phenomena ( e.g. , ascasibar & markevitch 2006 ) , and the ram pressure stripping of orbiting galaxies ( e.g. , mori & burkert 2000 ; mccarthy et al .   2008b ) .",
    "however , to our knowledge , idealised merger simulations have not been used to elucidate the important issue raised above , nor have they even been used to demonstrate whether or not this issue even exists in non - cosmological simulations .    in the present study",
    ", we perform a detailed comparison of idealised binary mergers run with the widely - used public simulations codes ( an amr code ) and ( a sph code ) .",
    "the paper is organised as follows . in ",
    "2 we give a brief description of the simulation codes and the relevant adopted numerical parameters .",
    "in addition , we describe the initial conditions ( e.g. , structure of the merging systems , mass ratio , orbit ) of our idealised simulations . in  3 , we present a detailed comparison of results from the and runs and confirm that there is a significant difference in the amount of central entropy generated with the two codes . in ",
    "4 we explore several possible causes for the differences we see .",
    "finally , in  5 , we summarise and discuss our findings .",
    "below , we provide brief descriptions of the and hydrodynamic codes used in this study and the parameters we have adopted .",
    "the interested reader is referred to springel , yoshida , & white ( 2001 ) and springel ( 2005b ) for in - depth descriptions of and to fryxell et al .",
    "( 2000 ) for the code .",
    "both codes are representative examples of their respective amr and sph hydrodynamic formulations , as has been shown in the recent code comparison of tasker et al .",
    "( 2008 ) .",
    "[ [ section ] ]    is a publicly available amr code developed by the alliances center for astrophysical thermonuclear flashes .",
    "originally intended for the study of x - ray bursts and supernovae , it has since been adapted for many astrophysical conditions and now includes modules for relativistic hydrodynamics , thermal conduction , radiative cooling , magnetohydrodynamics , thermonuclear burning , self - gravity and particle dynamics via a particle - mesh approach . in this study",
    "we use version 2.5 .",
    "solves the reimann problem using the piecewise parabolic method ( ppm ; colella & woodward 1984 ) .",
    "the present work uses the default parameters , which have been thoroughly tested against numerous analytical tests ( see fryxell et al .",
    "the maximum number of newton - raphson iterations permitted within the riemann solver was increased in order to allow it to deal with particularly sharp shocks and discontinuities whilst the default tolerance was maintained .",
    "the hydrodynamic algorithm also adopted the default settings with periodic boundary conditions being applied to the gas as well as to the gravity solver .",
    "we have modified the gravity solver in to use an fft on top of the multigrid solver ( written by t. theuns ) .",
    "this results in a vast reduction in the time spent calculating the self - gravity of the simulation relative to the publicly available version .",
    "we have rigorously tested the new algorithm against the default multigrid solver , more tests are presented in tasker et al .",
    "( 2008 ) .    to identify regions of rapid flow change , s refinement and de - refinement criteria",
    "can incorporate the adapted lhner ( 1987 ) error estimator .",
    "this calculates the modified second derivative of the desired variable , normalised by the average of its gradient over one cell . with",
    "this applied to the density as is common place , we imposed the additional user - defined criteria whereby the density has to exceed a threshold of @xmath2 , below which the refinement is set to the minimum @xmath3 mesh .",
    "this restricts the refinement to the interior of the clusters and , as we demonstrate below , was found to yield nearly identical results to uniform grid runs with resolution equal to the maximum resolution in the equivalent amr run .",
    "uses an oct - tree block - structured amr grid , in which the block to be refined is replaced by 8 blocks ( in three dimensions ) , of which the cell size is one half of that of the parent block .",
    "each block contains the same number of cells , @xmath4 cells in each dimension in our runs .",
    "the maximum allowed level of refinement , @xmath5 , is one of the parameters of the run . at refinement level @xmath5",
    ", a fully refined amr grid will have @xmath6 cells on a side .",
    "all the merger runs are simulated in 20 mpc on a side periodic boxes in a non - expanding ( newtonian ) space and are run for a duration of @xmath7 gyr . by default",
    ", our simulations are run with a maximum of @xmath8 levels of refinement ( @xmath9 cells when fully refined ) , corresponding to a minimum cell size of @xmath10 kpc , which is small in comparison to the entropy cores produced in non - radiative cosmological simulations of clusters ( but note we explicitly test the effects of resolution in  3 ) .",
    "the simulations include non - radiative hydrodynamics and gravity .",
    "is a publicly available treesph code designed for the simulation of cosmological structure formation . by default , the code implements the entropy conserving sph formalism proposed by springel & hernquist ( 2002 ) .",
    "the code is massively parallel , has been highly optimised and is very memory efficient .",
    "this has led to it being used for some of the largest cosmological simulations to date , including the first n - body simulation with more than @xmath11 dark matter particles ( the _ millennium simulation _ ; springel et al .",
    "2005a ) .",
    "the sph formalism is inherently lagrangian in nature and fully adaptive , with ` refinement ' based on the density .",
    "the particles represent discrete mass elements with the fluid variables being obtained through a kernel interpolation technique ( lucy 1977 ; gingold & monaghan 1977 ; monaghan 1992 ) .",
    "the entropy injected through shocks is captured through the use of an artificial viscosity term ( see , e.g. , monaghan 1997 ) .",
    "we will explore the sensitivity of our merger simulation results to the artificial viscosity in   [ viscosity ] .    by default",
    ", gravity is solved through the use of a combined tree particle - mesh ( treepm ) approach .",
    "the treepm method allows for substantial speed ups over the traditional tree algorithm by calculating long range forces with the particle - mesh approach using fast fourier techniques .",
    "higher gravitational spatial resolution is then achieved by applying the tree over small scales only , maintaining the dynamic range of the tree technique .",
    "this allows to vastly exceed the gravitational resolving power of mesh codes which rely on the particle - mesh technique alone and are thus limited to the minimum cell spacing .",
    "we adopt the following numerical parameters by default for our runs ( but note that most of these are systematically varied in  3 ) . the artificial bulk viscosity , @xmath12 ,",
    "is set to 0.8 .",
    "the number of sph smoothing neighbours , @xmath13 , is set to 32 .",
    "each of our @xmath14 model clusters ( see  2.1 ) are comprised of @xmath15 gas and dark matter particles within @xmath16 , and the gas to total mass ratio is @xmath17 .",
    "thus , the particle masses are @xmath18 and @xmath19 .",
    "the gravitational softening length is set to 10 kpc , which corresponds to @xmath20 initially .",
    "all the merger runs are simulated in 20 mpc on a side periodic boxes in a non - expanding ( newtonian ) space and are run for a duration of @xmath21 10 gyr .",
    "the simulations include basic hydrodynamics only ( i.e. , are non - radiative ) .      in our simulations ,",
    "the galaxy clusters are initially represented by spherically - symmetric systems composed of a realistic mixture of dark matter and gas .",
    "the dark matter is assumed to follow a nfw distribution ( navarro et al .  1996 ; 1997 ) :    @xmath22    where @xmath23 and    @xmath24    here , @xmath16 is the radius within which the mean density is 200 times the critical density , @xmath25 , and @xmath26 .",
    "the dark matter distribution is fully specified once an appropriate scale radius ( @xmath27 ) is selected .",
    "the scale radius can be expressed in terms of the halo concentration @xmath28 .",
    "we adopt a concentration of @xmath29 for all our systems .",
    "this value is typical of massive clusters formed in @xmath30cdm cosmological simulations ( e.g. , neto et al .",
    "2007 ) .    in order to maintain the desired nfw configuration ,",
    "appropriate velocities must be assigned to each dark matter particle .",
    "for this , we follow the method outlined in mccarthy et al .",
    "briefly , the three velocity components are selected randomly from a gaussian distribution whose width is given by the local velocity dispersion [ i.e , @xmath31 . the velocity dispersion profile itself is determined by solving the jeans equation for the mass density distribution given in eqn .",
    "( 1 ) . as in mccarthy",
    "( 2007 ) , the dark matter haloes are run separately in isolation in for many dynamical times to ensure that they have fully relaxed .    for the gaseous component",
    ", we assume a powerlaw configuration for the entropy is the not the actual thermodynamic specific entropy ( @xmath32 ) of the gas , but is related to it via the simple relation @xmath33 .",
    "however , for historical reasons we will refer to @xmath34 as the entropy .",
    "] , @xmath35 , by default .",
    "in particular ,    @xmath36    where the ` virial entropy ' , @xmath37 , is given by @xmath38    this distribution matches the entropy profiles of groups and clusters formed in the non - radiative cosmological simulations of voit , kay , & bryan ( 2005 ) ( vkb05 ) for @xmath39 .",
    "it is noteworthy that vkb05 find that this distribution approximately matches the entropy profiles of both sph ( the code ) and amr ( the code ) simulations . within @xmath40 , however , the amr and sph simulations show evidence for entropy cores , but of systematically different amplitudes .",
    "we initialise our systems without an entropy core [ i.e. , eqn .",
    "( 3 ) is assumed to hold over all radii initially ] to see , first ,",
    "if such cores are established during the merging process and , if so , whether the amplitudes differ between the sph and amr runs , as they do in cosmological simulations . we leave it for future work to explore the differences that result ( if any ) between sph and amr codes when large cores are already present in the initial systems ( e.g. , the merger of two ` non - cool core ' systems ) .    with the mass distribution of dark matter established ( i.e. , after having run the dark matter haloes in isolation ) and an entropy distribution for the gas given by eqn .",
    "( 3 ) , we numerically compute the radial gas pressure profile ( and therefore also the gas density and temperature profiles ) , taking into account the self - gravity of the gas , by simultaneously solving the equations of hydrostatic equilibrium and mass continuity :    @xmath41    two boundary conditions are required to solve these equations .",
    "the first condition is that @xmath42 .",
    "the second condition is that the total mass of hot gas within @xmath16 yields a realistic baryon fraction of @xmath43 . in order to meet the second condition",
    ", we choose a value for @xmath44 and propagate the solution outwards to @xmath16 .",
    "we then iteratively vary the inner pressure until the desired baryon fraction is achieved .    for the simulations ,",
    "the gas particle positions are assigned by radially morphing a glass distribution until the desired gas mass profile is obtained ( see mccarthy et al .",
    "the entropy ( or equivalently internal energy per unit mass ) of each particle is specified by interpolating with eqn .  ( 3 ) . for the simulations , the gas density and entropy of each grid cell is computed by using eqn .  ( 3 ) and interpolating within the radial gas density profile resulting from the solution of eqns .  ( 5 ) and ( 6 ) .",
    "thus , for both the and simulations we start with identical dark matter haloes ( using particle positions and velocities from the isolated runs with a gravitational softening length of 10kpc ) and gas haloes , which have been established by interpolating within radial profiles that have been computed numerically under the assumption that the gas is initially in hydrostatic equilibrium within the dark matter halo . note that when varying the resolution of the simulations we simply change the maximum number of refinements @xmath5  we do not vary the number of dark matter particles  in this way , the initial dark matter distribution is always the same as in the low resolution run in all the simulations we have run .    in both the and simulations ,",
    "the gaseous haloes are surrounded by a low density pressure - confining gaseous medium that prevents the systems from expanding prior to the collision ( i.e. , so that in the case of an isolated halo the object would be static ) but otherwise it has a negligible dynamical effect on the system .",
    "isolated gas+dm haloes were run in both and for 10 gyr in order to test the stability of the initial gas and dark matter haloes .",
    "although deviations in the central entropy develop over the course of the isolated simulations , indicating the systems are not in perfect equilibrium initially , they are small in amplitude ( the central entropy increases by @xmath45 over 10 gyr ) , especially in comparison to the factor of @xmath46 jump in the central entropy that occurs as a result of shock heating during the merger . furthermore",
    ", we note that the amplitude of the deviations in the isolated runs are significantly decreased as the resolution of these runs is increased .",
    "our merger simulations , however , are numerically converged ( see  3 ) , indicating that the deviations have a negligible effect on merger simulation results and the conclusions we have drawn from them .",
    "= 8.4 cm = 8.4 cm",
    "the existence of a discrepancy between the inner properties of the gas in groups and clusters formed in amr and sph cosmological simulations was first noticed in the santa barbara code comparison of frenk et al .",
    "it was subsequently verified in several works , including dolag et al .",
    "( 2005 ) , oshea et al .",
    "( 2005 ) , kravtsov , nagai & vikhlinin ( 2005 ) , and vkb05 .",
    "the latter study in particular clearly demonstrated , using a relatively large sample of @xmath47 simulated groups and clusters , that those systems formed in the amr simulations had systematically larger entropy cores than their sph counterparts . since this effect",
    "was observed in cosmological simulations , it was generally thought that the discrepancy was due to insufficient resolution in the mesh codes at high redshift ( we note , however , that vkb05 argued against resolution being the cause ) .",
    "this would result in under - resolved small scale structure formation in the early universe .",
    "this explanation is consistent with the fact that in the santa barbara comparison the entropy core amplitude tended to be larger for the lower resolution mesh code runs .",
    "our first aim is therefore to determine whether the effect is indeed due to resolution limitations , or if it is due to a more fundamental difference between the two types of code .",
    "we test this using identical idealised binary mergers of spherically - symmetric clusters in and , where it is possible to explore the effects of finite resolution with relatively modest computational expense ( compared to full cosmological simulations ) .      as a starting point",
    ", we investigate the generation of entropy cores in a head on merger between two identical @xmath48 clusters , each colliding with an initial speed of @xmath49 km / s [ i.e. , the initial _ relative _ velocity is @xmath50 , which is typical of merging systems in cosmological simulations ; see , e.g. , benson 2005 ] .",
    "the system is initialised such that the two clusters are just barely touching ( i.e. , their centres are separated by @xmath51 ) .",
    "the simulations are run for a duration of 10 gyr , by the end of which the merged system has relaxed and there is very little entropy generation ongoing .",
    "l l l flash sim .",
    "cells & max .",
    "spatial res .",
    "+ & & ( kpc ) + @xmath52 & equiv .",
    "@xmath53 & 78 + @xmath8 ( default ) & equiv .",
    "@xmath9 & 39 + @xmath54 & equiv .",
    "@xmath55 & 19.5 + @xmath56 & equiv .",
    "@xmath57 & 9.8 + @xmath9 & @xmath9 & 39 +   + gadget-2 sim . &",
    "gas particles & max .",
    "spatial res .",
    "+ & & ( kpc ) + low res .",
    "& @xmath58 & @xmath59 + default & @xmath60 & @xmath61 + hi res .",
    "& @xmath62 & @xmath63 +    our idealised test gives very similar results to non - radiative cosmological simulations  there is a distinct difference in the amplitude of the entropy cores in the amr and sph simulations , with the entropy in the mesh code a factor @xmath64 higher than the sph code .",
    "it is evident that the difference between the codes is captured in a single merger event .",
    "an immediate question is whether this is the result of the different effective resolutions of the codes .",
    "resolution tests can be seen in the left hand panel of figure  [ entropy_radius ] , where we plot the resulting radial entropy distributions . for",
    ", we compare runs with @xmath58 , @xmath60 ( the default ) , and @xmath62 particles .",
    "for we compare amr runs with minimum cell sizes of @xmath65 , @xmath66 ( the default ) , @xmath67 , and @xmath68 kpc and a uniform grid run with the default 39  kpc cell size .",
    "the simulation characteristics for these head on mergers are presented in table 1 .",
    "to make a direct comparison with the cosmological results of vkb05 ( see their fig .",
    "5 ) , we normalise the entropy by the initial ` virial ' entropy ( @xmath37 ; see eqn .  4 ) and the radius by the initial virial radius , @xmath16 .",
    "the plot clearly shows that the simulations converge on two distinctly different solutions within the inner ten percent of @xmath16 , whereas the entropy at large radii shows relatively good agreement between the two codes .",
    "the simulations performed for the resolution test span a factor of 8 in spatial resolution in and approximately a factor of 5 in .",
    "the amr runs effectively converge after reaching a peak resolution equivalent to a @xmath69 run ( i.e. , a peak spatial resolution of @xmath70 kpc or @xmath71 ) .",
    "we have also tried a run with a uniform ( as opposed to adaptive ) @xmath9 grid and the results essentially trace the amr run with an equivalent peak resolution .",
    "this reassures us that our amr refinement criteria is correctly capturing all regions of significance .",
    "the lowest resolution sph run , which only has @xmath72 gas particles within @xmath16 initially , has a slightly higher final central entropy than the default and high resolution sph runs .",
    "this may not be surprising given the tests and modelling presented in steinmetz & white ( 1997 ) .",
    "these authors demonstrated that with such small particle numbers , two - body heating will be important if the mass of a dark matter particle is significantly above the mass of a gas particle .",
    "the runs converge , however , when the number of gas and dark matter particles are increased by an order magnitude ( i.e. , as in our default run ) , yielding a maximum spatial resolution of @xmath61 kpc ( here we use the minimum sph smoothing length as a measure of the maximum spatial resolution ) .        a comparison of the left hand panel of fig .  1 to fig .",
    "5 of vkb05 reveals a remarkable correspondence between the results of our idealised merger simulations and those of their cosmological simulations ( which spanned system masses of @xmath73 ) .",
    "they find that the ratio of the amr and sph core amplitudes is @xmath64 in both the idealised and cosmological simulations .",
    "this difference is also seen in the santa barbara comparison of frenk et al .",
    "( 1999 ) when comparisons are made between the sph simulations and the highest resolution amr simulations carried out in that study ( ie . ,",
    "the ` bryan ' amr results ) amr run in fig .  1 ) .",
    "this consistency presumably indicates that whatever mechanism is responsible for the differing core amplitudes in the cosmological simulations is also responsible for the differing core amplitudes in our idealised simulations .",
    "this is encouraging , as it implies the generation of the entropy cores can be studied with idealised simulations .",
    "as outlined in  1 , the advantage of idealised simulations over cosmological simulations is their relative simplicity .",
    "this gives us hope that we can use idealised simulations to track down the underlying cause of the discrepancy between particle - based and mesh - based hydrodynamic codes .",
    "the right hand panel of figure  [ entropy_radius ] shows the resulting entropy distributions plotted in a slightly different fashion .",
    "here we plot the entropy as a function of ` enclosed ' gas mass @xmath74 .",
    "this is constructed by simply ranking the particles / cells by entropy in ascending order and then summing the masses of the particles / cells [ the inverse , @xmath75 , would therefore be the total mass of gas with entropy lower than @xmath34 ] .",
    "convective stability ensures that , eventually when the system is fully relaxed , the lowest - entropy gas will be located at the very centre of the potential well , while the highest entropy gas will be located at the system periphery .",
    "@xmath74 is therefore arguably a more fundamental quantity than @xmath77 and we adopt this test throughout the rest of the paper .",
    "it is also noteworthy that in order to compute @xmath78 one does not first need to select a reference point ( e.g. , the centre of mass or the position of the particle with the lowest potential energy ) or to bin the particles / cells in any way , both of which could introduce ambiguities in the comparison between the sph and amr simulations ( albeit likely minor ones ) .    in the right hand panel of figure  [ entropy_radius ] , we plot the resulting @xmath74 distributions normalised to the final entropy distribution of the default run .",
    "here we see that the lowest - entropy gas in the runs have a higher entropy , by a factor of @xmath79 , than the lowest - entropy gas in the default run .",
    "naively , looking at the right hand panel of figure  [ entropy_radius ] one might conclude that the discrepancy is fairly minor , given that @xmath80% of the gas has been heated to a similar degree in the sph and amr simulations .",
    "but it is important to keep in mind that it is the properties of the lowest - entropy gas in particular that are most relevant to the issue of heating vs.  cooling in groups and clusters ( and indeed in haloes of all masses ) , since this is the gas that has the shortest cooling time .",
    "the agreement between our results and those from cosmological simulations ( e.g. , frenk et al .",
    "1999 ; vkb05 ) is striking .",
    "the convergence of the entropy distributions in our idealised simulations negates the explanation that inadequate resolution of the high redshift universe in cosmological amr simulations is the root cause of the discrepancy between the entropy cores in sph and amr simulations ( although we note that some of the lower resolution amr simulations in the study of frenk et al .",
    "may not have been fully converged and therefore the discrepancy may have been somewhat exaggerated in that study for those simulations ) .",
    "we therefore conclude that the higher entropy generation in amr codes relative to sph codes within the cores of groups and clusters arises out of a more fundamental difference in the adopted algorithms . below",
    "we examine in more detail how the entropy is generated during the merging process in the simulations and we then systematically explore several possible causes for the differences in the simulations .",
    "we have demonstrated that the entropy generation that takes place in our idealised mergers is robust to our choice of resolution , yet a difference persists in the amount of central entropy that is generated in the sph and mesh simulations .",
    "we now examine the entropy generation as a function of time in the simulations , which may provide clues to the origin of the difference between the codes .",
    "figure  [ 8panelimage ] shows @xmath81 in a slice through the centre of the default simulation at times 0 , 1 , 2 , 3 , 4 , 5 , 7 and 10 gyr .",
    "this may be compared to figure  [ entropygastime ] , which shows the entropy distribution of the simulations as a function of time ( this figure is described in detail below ) .",
    "briefly , as the cores approach each other , a relatively gentle shock front forms between the touching edges of the clusters , with gas being forced out perpendicular to the collision axis .",
    "strong heating does not actually occur until approximately the time when the cores collide , roughly 1.8 gyrs into the run .",
    "the shock generated through the core collision propagates outwards , heating material in the outer regions of the system .",
    "this heating causes the gas to expand and actually overshoot hydrostatic equilibrium .",
    "eventually , the gas , which remains gravitationally bound to the system , begins to fall back onto the system , producing a series of weaker secondary shocks .",
    "gas at the outskirts of the system , which is the least bound , takes the longest to re - accrete .",
    "this dependence of the time for gas to be re - accreted upon the distance from the centre results in a more gradual increase in entropy than seen in the initial core collision . in a _ qualitative _ sense , the heating process that takes place in the simulations is therefore very similar to that seen in the simulations ( see  3 of mccarthy et al .",
    "2007 for an overview of the entropy evolution in idealised mergers ) .",
    "the top left panel in figure  [ entropygastime ] shows the ratio of @xmath74 in the default run relative to @xmath74 in the default run .",
    "the various curves represent the ratio at different times during the simulations ( see figure key  note that these correspond to the same outputs displayed in figure  [ 8panelimage ] ) .",
    "it can clearly be seen that the bulk of the difference in the _ final _ entropy distributions of the simulations is established around the time of core collision .",
    "the ratio of the central entropy in the simulation to the central entropy in the simulation converges after @xmath82 gyr .",
    "the top right panel shows the time evolution of the lowest - entropy gas only in both the and runs .",
    "here we see there are similar trends with time , in the sense that there are two main entropy generation episodes ( core collision and re - accretion ) , but that the entropy generated in the first event is much larger in the run than in the run . far outside the core , however , the results are very similar . for completeness ,",
    "the bottom two panels show @xmath74 at different times for the and runs separately .",
    "the small initial drop in the central entropy at 1 gyr in the run ( see bottom left panel ) is most likely due to interpolation errors at low resolution . this drop in entropy should not physically occur without cooling processes ( which are not included in our simulations ) , but there is nothing to prevent a dip from occurring in the simulations due to numerical inaccuracies ( the second law of thermodynamics is not explicitly hardwired into the mesh code ) . at low resolutions , small violations in entropy conservation can occur due to inaccurate interpolations made by the code .",
    "we have verified that the small drop in entropy does not occur in the higher resolution runs .",
    "we note that while this effect is present in default run , it is small and as demonstrated in fig .",
    "1 the default run is numerically converged .",
    "it is interesting that the to central entropy ratio converges relatively early on in the simulations .",
    "this is in spite of the fact that a significant fraction of the entropy that is generated in both simulations is actually generated at later times , during the re - accretion phase .",
    "evidently , this phase occurs in a very similar fashion in both simulations . in  4 , we will return to the point that the difference between the results of the amr and sph simulations arises around the time of core collision .",
    "= 6.0 cm = 6.0 cm = 6.0 cm = 6.0 cm      it is important to verify that the conclusions we have drawn from our default setup are not unique to that specific initial configuration . using a suite of merger simulations of varying mass ratio and orbital parameters , mccarthy et al .",
    "( 2007 ) demonstrated that the entropy generation that takes place does so in a qualitatively similar manner to that described above in all their simulations .",
    "however , these authors examined only sph simulations .",
    "we have therefore run several additional merger simulations in both and to check the robustness of our conclusions .",
    "all of these mergers are carried out using the same resolution as adopted for the default and runs .    in figure",
    "[ orbit_test ] , we plot the final to @xmath74 ratio for equal mass mergers with varying orbital parameters ( see figure caption ) . in all cases , systematically produces larger entropy cores than , and by a similar factor to that seen in the default merger setup .",
    "interestingly , the off - axis case results in a somewhat larger central entropy discrepancy between and , even though the bulk energetics of this merger are the same as for the default case .",
    "a fundamental difference between the off - axis case and the default run is that the former takes a longer time for the cores to collide and subsequently relax ( but note by the end of the off - axis simulation there is very little ongoing entropy generation , as in the default case ) .",
    "this may suggest that the timescale over which entropy is generated plays some role in setting the magnitude of the discrepancy between the amr and sph simulations .",
    "for example , one possibility is that ` pre - shocking ' due to the artificial viscosity i.e. , entropy generation during the early phases of the collision when the interaction is subsonic or mildly transonic ) in the sph simulations becomes more relevant over longer timescales .",
    "another possibility is that mixing , which is expected to be more prevalent in eulerian mesh simulations than in sph simulations , plays a larger role if the two clusters spend more time in orbit about each other before relaxing into a single merged system ( of course , one also expects enhanced mixing in the off - axis case simply because of the geometry ) .",
    "we explore these and other possible causes of the difference in  4 .",
    "in addition to varying the orbital parameters , we have also experimented with colliding a cluster composed of dark matter only with another cluster composed of a realistic mixture of gas and dark matter ( in this case , we simulated the head on merger of two equal mass @xmath48 clusters with an initial relative velocity of @xmath83 km / s ) .",
    "obviously , this is not an astrophysically reasonable setup .",
    "however , a number of studies have suggested that there is a link between the entropy core in clusters formed in non - radiative cosmological simulations and the amount of energy exchanged between the gas and the dark matter in these systems ( e.g. , lin et al .  2006 ; mccarthy et al .   2007 ) . it is therefore interesting to see whether this experiment exposes any significant differences with respect to the results of our default merger simulation .    ) .",
    "the long - dashed green and short - dashed cyan curves represent head on collisions with initial relative velocities of @xmath84 and @xmath85 ( i.e. , at rest initially ) .",
    "the dot dashed red curve represents an off - axis collision with an initial relative radial velocity of @xmath86 and an initial relative tangential velocity of @xmath87 ( i.e. , the total energy is equivalent to that of the default setup ) .",
    "also shown ( dotted magenta curve ) , is the entropy ratio of a run where one of the clusters is composed of dark matter only and the other of a realistic mixture of gas and dark matter ( see text ) .",
    "all these simulations result in a comparable difference in entropy profile between the mesh code and the sph code .",
    ", width=317 ]    the dotted magenta curve in figure  [ orbit_test ] represents the final to @xmath74 ratio for the case where a dark matter only cluster merges with another cluster composed of both gas and dark matter .",
    "the results of this test are remarkably similar to that of our default merger case .",
    "this indicates that the mechanism responsible for the difference in heating in the mesh and sph simulations in the default merger simulation is also operating in this setup .",
    "although this does not pin down the difference between the mesh and sph simulations , it does suggest that the difference has little to do with differences in the properties of the large hydrodynamic shock that occurs at core collision , as there is no corresponding large hydrodynamic shock in the case where one cluster is composed entirely of dark matter .",
    "however , it is clear from figure 3 that the difference between the default mesh and sph simulations is established around the time of core collision , implying that some source of heating other than the large hydrodynamic shock is operating at this time ( at least in the simulation ) .",
    "we return to this point in  4 .",
    "there are fundamental differences between eulerian mesh - based and lagrangian particle - based codes in terms of how they compute the hydrodynamic and gravitational forces .",
    "ideally , in the limit of sufficiently high resolution , the two techniques would yield identical results for a given initial setup .",
    "indeed , both techniques have been shown to match with high accuracy a variety of test problems with known analytic solutions . however , as has been demonstrated above ( and in other recent studies ; e.g. , agertz et al .  2007 ; trac et al .  2007 ; wadsley et al .",
    "2008 ) differences that do not appear to depend on resolution present themselves in certain complex , but astrophysically - relevant , circumstances .    in what follows , we explore several different possible causes for why the central heating that takes place in mesh simulations exceeds that in the sph simulations .",
    "the possible causes we explore include :    *   [ gravitysolvers ] a difference in gravity solvers - most currently popular mesh codes ( including and ) use a particle - mesh ( pm ) approach to calculate the gravitational force . to accurately capture short range",
    "forces it is therefore necessary to have a finely - sampled mesh .",
    "by contrast , particle - based codes ( such as and ) often make use of tree algorithms or combined tree particle - mesh ( treepm ) algorithms , where the tree is used to compute the short range forces and a mesh is used to compute long range forces .",
    "since the gravitational potential can vary rapidly during major mergers and large quantities of mass can temporarily be compressed into small volumes , it is conceivable differences in the gravity solvers and/or the adopted gravitational force resolution could give rise to different amounts of entropy generation in the simulations .",
    "*   [ galileaninv ] galilean non - invariance of mesh codes - given explicit dependencies in the riemann solver s input states , all eulerian mesh codes are inherently not galilean invariant to some degree .",
    "this can lead to spurious entropy generation in the cores of systems as they merely translate across the simulation volume ( e.g. , tasker et al .",
    "*   [ viscosity ] ` pre - shocking ' in the sph runs - artificial viscosity is required in sph codes to capture the effects of shock heating .",
    "however , the artificial viscosity can in principle lead to entropy production in regions where no shocks should be present ( e.g. , dolag et al .",
    "if such pre - shocking is significant prior to core collision in our sph simulations , it could result in a reduced efficiency of the primary shock . *   [ mixing ] a difference in the amount of mixing in sph and mesh codes - mixing will be suppressed in standard sph implementations where steep density gradients are present , since rayleigh - taylor and kelvin - helmholtz instabilities are artificially damped in such circumstances ( e.g. , agertz et al .",
    "in addition , the standard implementation of artificial viscosity will damp out even _ subsonic _ motions in sph simulations , thereby inhibiting mixing ( dolag et al .",
    "on the other hand , one expects there to be some degree of over - mixing in mesh codes , since fluids are implicitly assumed to be fully mixed on scales smaller than the minimum cell size .",
    "+   + we now investigate each of these possible causes in turn .",
    "we do not claim that these are the only possible causes for the differences we see in the simulations .",
    "they do , however , represent the most commonly invoked possible solutions ( along with hydrodynamic resolution , which we explored in  3 ) to the entropy core discrepancy between sph and mesh codes .       5 , 6 , 7 , and 8 , respectively , which correspond to peak grid cell sizes of @xmath65 , @xmath66 , @xmath67 , and @xmath68 kpc ( respectively ) . the thin solid red curve represents the uniform @xmath9 run . the gravitational softening length adopted for the run is 10 kpc . for reference , @xmath88 kpc .",
    "the vertical dashed line indicates four softening lengths .",
    "the dark matter distribution converges to the result when the numerical resolutions become similar : the observed differences in gas entropy are not due to differences in the underlying dark matter dynamics .",
    ", width=317 ]    in the simulations , gravity is computed using a standard particle - mesh approach . with this approach ,",
    "the gravitational force will be computed accurately only on scales larger than the finest cell size . by contrast , the simulations make use of a combined treepm approach , where the tree algorithm computes the short range gravitational forces and the particle - mesh algorithm is used only to compute long range forces . to test whether or not differences in the gravity solvers ( and/or gravitational force resolution )",
    "are important , we compare the final mass distributions of the dark matter in our simulations .",
    "the distribution of the dark matter should be insensitive to the properties of the diffuse baryonic component , since its contribution to the overall mass budget is small by comparison to the dark matter .",
    "thus , the final distribution of the dark matter tells us primarily about the gravitational interaction alone between the two clusters .",
    "figure  [ dmconverge ] shows the ratio of the final dark matter mass profiles to the final dark matter mass profile . recall that in all runs the number of dark matter particles is the same .",
    "the differences that are seen in this figure result from solving for gravitational potential on a finer mesh .",
    "for the lowest resolution run , we see that the final dark matter mass profile deviates significantly from that of the default run for @xmath89 .",
    "however , this should not be surprising , as the minimum cell size in the default run is @xmath90 . by increasing the maximum refinement level , @xmath5",
    ", we see that the discrepancy between the final and dark matter mass profiles is limited to smaller and smaller radii . with @xmath91 ,",
    "the minimum cell size is equivalent to the gravitational softening length adopted in the default run . in this case",
    ", the final dark matter mass distribution agrees with that of the default run to within a few percent at all radii beyond a few softening lengths ( or a few cell sizes ) , which is all that should be reasonably expected .",
    "a comparison of the various runs with one another ( compare , e.g. , the default run with the @xmath56 run , for which there is a @xmath92% discrepancy out as far as @xmath40 ) may suggest a somewhat slower rate of convergence to the default result than one might naively have expected .",
    "given that we have tested the new fft gravity solver against both the default multigrid solver and a range of simple analytic problems and confirmed its accuracy to a much higher level than this , we speculate that the slow rate of convergence is due to the relatively small number of dark matter particles used in the mesh simulations . in the future , it would be useful to vary the number of dark matter particles in the mesh simulations to verify this hypothesis .    in summary , we find that the resulting dark matter distributions agree very well in the and simulations when the effective resolutions are comparable .",
    "the intrinsic differences between the solvers therefore appear to be minor .",
    "more importantly for our purposes , even though the gravitational force resolution for the default run is not as high as for the default run , this has no important consequences for the comparison of the final entropy distributions of the gas .",
    "it is important to note that , even though the final mass distribution in the simulations shows small differences between @xmath93 and 8 , figure  [ entropy_radius ] shows that the entropy distribution is converged for @xmath94 and is not at all affected by the improvement in the gravitational potential .",
    "and 45 degrees with @xmath56 , respectively .",
    "this comparison illustrates that the effects of galilean non - invariance on the resulting entropy distribution are minor and do not account for the difference in the entropy core amplitudes of the mesh and sph simulations .",
    ", width=317 ]    due to the nature of riemann solvers ( which are a fundamental feature of amr codes ) , it is possible for the evolution of a system to be galilean non - invariant .",
    "this arises from the fixed position of the grid relative to the fluid . the riemann shock tube initial conditions are constructed by determining the amount of material that can influence the cell boundary from either side , within a given time step based on the sound speed",
    "the riemann problem is then solved at the boundary based on the fluid properties either side of the boundary . by applying a bulk velocity to the medium in a given direction , the nature of the solution changes .",
    "although an ideal solver would be able to decouple the bulk velocity from the velocity discontinuity at the shock , the discrete nature of the problem means that the code may not be galilean invariant .",
    "since one expects large bulk motions to be relevant for cosmological structure formation , and clearly is quite relevant for our merger simulations , it is important to quantify what effects ( if any ) galilean non - invariance has on our amr simulations .",
    "we have tested the galilean non - invariance of our simulations in two ways . in the first test",
    ", we simulate an isolated cluster moving across the mesh with an ( initial ) bulk velocity of @xmath50 ( @xmath83 km / s ) and compare it to an isolated cluster with zero bulk velocity .",
    "this is similar to the test carried out recently by tasker et al .",
    "( 2008 ) . in agreement with",
    "tasker et al .",
    "( 2008 ) , we find that there is some spurious generation of entropy in the very central regions ( @xmath95 ) of the isolated cluster that was given an initial bulk motion .",
    "however , after @xmath96 gyr of evolution ( i.e. , the time when the clusters collide in our default merger simulation ) , the increase in the central entropy is only @xmath97% .",
    "this is small in comparison to the @xmath98% jump that takes place at core collision in our merger simulations .",
    "this suggests that spurious entropy generation prior to the merger is minimal and does not account for the difference we see between the sph and amr simulations .",
    "in the second test , we consider different implementations of the default merger simulation .",
    "in one case , instead of giving both systems equal but opposite bulk velocities ( each with magnitude @xmath99 ) , we fix one and give the other an initial velocity that is twice the default value , so that the relative velocity is unchanged .",
    "( we also tried reducing the size of the time steps for this simulation by an order magnitude . ) in addition , we have tried mergers that take place at oblique angles relative to the grid . if the merger is well - resolved and the dynamics are galilean invariant",
    ", all these simulations should yield the same result .",
    "figure  [ flashgalilean ] shows the resulting entropy distributions for these different runs .",
    "the results of this test confirm what was found above ; i.e. , that there is some dependence on the reference frame adopted , but that this effect is minor in general ( the central entropy is modified by @xmath100% ) and does not account for the discrepancy we see between entropy core amplitudes in the default and simulations .    ) until @xmath101 1.6 , 1.7 , 1.8 gyr , respectively , at which point the artificial viscosity is set back to its default value .",
    "the solid magenta squares represent a run with low artificial viscosity throughout , and the open triangles represent the default simulation . reducing the value of the artificial viscosity parameter before the cores collide delays the increase in entropy ( cyan , green and solid red ) , however as soon as the original value is restored , the entropy @xmath34 increases to a level nearly independent of when @xmath102 was restored .",
    "therefore pre - shocking has little effect on the post - shock value of @xmath34 .",
    ", width=317 ]      artificial viscosity is required in sph codes in order to handle hydrodynamic shocks .",
    "the artificial viscosity acts as an excess pressure in the equation of motion , converting gas kinetic energy into internal energy , and therefore raising the entropy of the gas . in standard sph implementations ,",
    "the magnitude of the artificial viscosity is fixed in both space and time for particles that are approaching one another ( it being set to zero otherwise ) .",
    "this implies that even in cases where the mach number is less than unity , i.e. , where formally a shock should not exist , ( spurious ) entropy generation can occur .",
    "this raises the possibility that significant ` pre - shocking ' could occur in our sph merger simulations .",
    "this may have the effect of reducing the efficiency of the large shock that occurs at core collision and could therefore potentially explain the discrepancy between the mesh and sph simulations .",
    "= 8.4 cm = 8.4 cm    dolag et al .",
    "( 2005 ) raised this possibility and tested it in sph cosmological simulations of massive galaxy clusters .",
    "they implemented a new variable artificial viscosity scheme by embedding an on - the - fly shock detection algorithm in that indicates if particles are in a supersonic flow or not . if so , the artificial viscosity is set to a typical value , if not the artificial viscosity is greatly reduced .",
    "this new implementation should significantly reduce the amount of pre - shocking that takes place during formation of the clusters .",
    "the resulting clusters indeed had somewhat higher central entropies relative to clusters simulated with the standard artificial viscosity implementation ( although the new scheme does not appear to fully alleviate the discrepancy between mesh and sph codes ) .",
    "however , whether the central entropy was raised because of the reduction in pre - shocking or if it was due to an increase in the amount of mixing is unclear .",
    "our idealised mergers offer an interesting opportunity to re - examine this test .",
    "in particular , because of the symmetrical geometry of the merger , little or no mixing is expected until the cores collide , as prior to this time there is no interpenetration of the gas particles belonging to the two clusters ( we have verified this ) .",
    "this means that we are in a position to isolate the effects of pre - shocking from mixing early on in the simulations .",
    "to do so , we have devised a crude method meant to mimic the variable artificial viscosity scheme of dolag et al .",
    "in particular , we run the default merger with a low artificial viscosity ( with @xmath103 , i.e. , approximately the minimum value adopted by dolag et al .  ) until the cores collide , at which point we switch the viscosity back to its default value .",
    "we then examine the amount of entropy generated in the large shock .",
    "figure  [ viscosityswitch ] shows the evolution of the central entropy around the time of core collision .",
    "shown are a few different runs where we switch the artificial viscosity back to its default value at different times ( since the exact time of ` core collision ' is somewhat ill - defined ) . here",
    "we see that prior to the large shock very little entropy has been generated , which is expected given the low artificial viscosity adopted up to this point .",
    "a comparison of these runs to the default simulation ( see inset in figure  [ viscosityswitch ] ) shows that there is evidence for a small amount of pre - shocking in the default run .",
    "however , we find that for the cases where the artificial viscosity is set to a low value , the resulting entropy jump ( after the viscosity is switched back to the default value ) is nearly the same as in the default merger simulation . in other words , pre - shocking appears to have had a minimal effect on the strength of the heating that occurs at core collision in the default sph simulation .",
    "this argues against pre - shocking as the cause of the difference we see between the mesh and sph codes .",
    "lastly , we have also tried varying @xmath12 over the range @xmath104 and @xmath105 ( i.e. , values typically adopted in sph studies ; springel 2005b ) for the default run .",
    "we find that the sph results are robust to variations in @xmath12 and can not reconcile the differences between sph and amr results .",
    "= 8.4 cm = 8.4 cm      our experiments with off - axis collisions and collisions with a cluster containing only dark matter suggest that mixing plays an important role in generating the differences between the codes .",
    "several recent studies ( e.g. , dolag et al .  2005 ; wadsley et al .",
    "2008 ) have argued that mixing is handled poorly in standard implementations of sph , both because ( standard ) artificial viscosity acts to damp turbulent motions and because the growth of kh and rt instabilities is inhibited in regions where steep density gradients are present ( agertz et al .",
    "2007 ) . using cosmological sph simulations that have been modified in order to enhance mixing , dolag et al .",
    "( 2005 ) and wadsley et al .",
    "( 2008 ) have shown that it is possible to generate higher central entropies in their galaxy clusters ( relative to clusters simulated using standard implementations of sph ) , yielding closer agreement with the results of cosmological mesh simulations .",
    "this is certainly suggestive that mixing may be the primary cause of the discrepancy between mesh and sph codes .",
    "however , these authors did not run mesh simulations of galaxy clusters and therefore did not perform a direct comparison of the amount of mixing in sph vs. mesh simulations of clusters .",
    "even if one were to directly compare cosmological sph and mesh cluster simulations , the complexity of the cosmological environment and the hierarchical growth of clusters would make it difficult to clearly demonstrate that mixing is indeed the difference .",
    "our idealised mergers offer a potentially much cleaner way to test the mixing hypothesis .",
    "to do so , we re - run the default merger simulation but this time we include a large number of ` tracer particles ' , which are massless and follow the hydrodynamic flow of the gas during the simulation .",
    "the tracer particles are advanced using a second order accurate predictor - corrector time advancement scheme with the particle velocities being interpolated from the grid ( further details are given in the flash manual ( version 2.5 ) at : + http://flash.uchicago.edu/ ) .",
    "each tracer particle has a unique i d that is preserved throughout the simulation , allowing us to track the gas in a lagrangian fashion , precisely as is done in lagrangian sph simulations . to simplify the comparison further ,",
    "we initially distribute the tracer particles within the two clusters in our simulation in exactly the same way as the particles in our initial setup .    in the left hand panel of figure  [ tracers ] ,",
    "we plot the final vs. the initial entropy of particles in the default and merger simulations .",
    "this plot clearly demonstrates that the lowest - entropy gas is preferentially heated in both simulations , however the degree of heating of that gas in the mesh simulation is much higher than in the sph simulation .",
    "consistent with our analysis in  3 , we find that the bulk of this difference is established around the time of core collision .",
    "it is also interesting that the scatter in the final entropy ( for a given initial entropy ) is much larger in the mesh simulation .",
    "the larger scatter implies that convective mixing is more prevalent in the mesh simulation . at or immediately following core collision ( @xmath106 gyr ) , there is an indication that , typically , gas initially at the very centre of the two clusters ( which initially had the lowest entropy ) has been heated more strongly than gas further out [ compare , e.g. , the median @xmath107 at @xmath108 to the median at @xmath109 .",
    "such an entropy inversion does not occur in the sph simulations and likely signals that the extra mixing in the mesh simulation has boosted entropy production .",
    "= 8.4 cm = 8.4 cm    in the right hand panel of figure  [ tracers ] we plot the final vs. the initial enclosed gas mass of particles in the default and merger simulations .",
    "the enclosed gas mass of each particle ( or tracer particle ) is calculated by summing the masses of all other particles ( or cells ) with entropies lower than the particle under consideration , by summing the masses of all particles with potentials lower than @xmath110 for the @xmath111th particle . ] .",
    "this plot confirms our mixing expectations based on the entropy plot in the left hand panel .",
    "in particular , only a small amount of mass mixing is seen in the sph simulation , whereas in the mesh simulation the central @xmath112 of the gas mass has been fully mixed .",
    "the higher degree of mixing in the simulation is shown pictorially in figure  [ particles ] .",
    "the left panel shows the final spatial distribution of the initially lowest - entropy particles in simulation , while the right panel is the analogous plot for tracer particles in the simulation ( see figure caption ) . the larger degree of mixing in the mesh simulation relative to the sph simulation is clearly evident . in the simulation , particles from the two clusters",
    "are intermingled in the final state , while distinct red and blue regions are readily apparent in the sph calculation , a difference which arises immediately following core collision .    the increased mixing boosts entropy production in the simulations , but what is the origin of the increased mixing ?",
    "we now return to the point raised in  3 , that the bulk of the difference between mesh and sph simulation is established around the time of core collision .",
    "this is in spite of the fact that significant entropy generation proceeds in both simulations until @xmath113 gyr .",
    "evidently , both codes treat the entropy generation in the re - accretion phase in a very similar manner .",
    "what is different about the initial core collision phase ? as pointed out recently by agertz et al .",
    "( 2007 ) , sph suppresses the growth of instabilities in regions where steep density gradients are present due to spurious pressure forces acting on the particles .",
    "could this effect be responsible for the difference we see ? to test this idea , we generate 2d projected entropy maps of the sph and mesh simulations to search for signs of clear instability development .",
    "in the case of the sph simulation , we first smooth the particle entropies ( and densities ) onto a 3d grid using the sph smoothing kernel and the smoothing lengths of each particle computed by .",
    "we then compute a gas mass - weighted projected entropy by projecting along the @xmath114-axis . in the case of the simulation",
    ", the cell entropies and densities are interpolated onto a 3d grid and projected in the same manner as for the simulation .",
    "figure  [ instabilities ] shows a snap shot of the two simulations at @xmath115 gyr , just after core collision .",
    "large vortices and eddies are easily visible in the projected entropy map of the simulation but none are evident in the simulation . in order to study the duration of these eddies ,",
    "we have generated 100 such snap shots for each simulation , separated by fixed 0.1 gyr intervals .",
    "analysing the projected entropy maps as a movie , we find that these large vortices and eddies persist in the simulation from @xmath116 gyr .",
    "this corresponds very well with the timescale over which the difference between the sph and mesh codes is established ( see , e.g. , the dashed black curve in the top right panel of figure  [ entropygastime ] ) .",
    "we therefore conclude that extra mixing in the mesh simulations , brought on by the growth of instabilities around the time of core collision , is largely responsible for the difference in the final entropy core amplitudes between the mesh and sph simulations .",
    "physically , one expects the development of such instabilities , since the kh timescale , @xmath117 , is relatively short at around the time of core collision .",
    "we therefore conclude that there is a degree of under - mixing in the sph simulations whether or not the simulations yield the correct result , however , is harder to ascertain . as fluids are _ forced _ to numerically mix on scales smaller than the minimum cell size , it is possible that there is a non - negligible degree of over - mixing in the mesh simulations .",
    "our resolution tests ( see  3 ) show evidence for the default mesh simulation being converged , but it may be that the resolution needs to be increased by much larger factors than we have tried ( or are presently accessible with current hardware and software ) in order to see a difference .",
    "in this paper , we set out to investigate the origin of the discrepancy in the entropy structure of clusters formed in eulerian mesh - based simulations compared to those formed in lagrangian sph simulations .",
    "while sph simulations form clusters with almost powerlaw entropy distributions down to small radii , eulerian simulations form much larger cores with the entropy distribution being truncated at significantly higher values .",
    "previously it has been suspected that this discrepancy arose from the limited resolution of the mesh based methods , making it impossible for such codes to accurately trace the formation of dense gas structures at high redshift .    by running simulations of the merging of idealised clusters",
    ", we have shown that this is not the origin of the discrepancy .",
    "we used the code ( springel 2005b ) to compute the sph solution and the code ( fryxell et al .",
    "2000 ) to compute the eulerian mesh solution . in these idealised simulations ,",
    "the initial gas density structure is resolved from the onset of the simulations , yet the final entropy distributions are significantly different .",
    "the magnitude of the difference generated in idealised mergers is comparable to that seen in the final clusters formed in full cosmological simulations .",
    "a resolution study shows that the discrepancy in the idealised simulations can not be attributed to a difference in the effective resolutions of the simulations .",
    "thus , the origin of the discrepancy must lie in the code s different treatments of gravity and/or hydrodynamics .",
    "we considered various causes in some detail .",
    "we found that the difference was _ not _ due to :    * the use of different gravity solvers .",
    "the two codes differ in that uses a treepm method to determine forces , while uses the pm method alone .",
    "the different force resolutions of the codes could plausibly lead to differences in the energy transfer between gas and dark matter .",
    "yet we find that the dark matter distributions produced by the two codes are almost identical when the mesh code is run at comparable resolution to the sph code .",
    "* galilean non - invariance of mesh codes .",
    "we investigate whether the results are changed if we change the rest - frame defined by the hydrodynamic mesh .",
    "although we find that an artificial core can be generated in this way in the mesh code , its size is much smaller than the core formed once the clusters collide , and is not enough to explain the difference between and .",
    "we show that most of this entropy difference is generated in the space of @xmath118 gyr when the cluster cores first collide . * pre - shocking in sph .",
    "we consider the possibility that the artificial viscosity of the sph method might generate entropy in the flow prior to the core collision , thus reducing the efficiency with which entropy is generated later . by greatly reducing the artificial viscosity ahead of the core collision ,",
    "we show that this effect is negligible .    having shown that none of these numerical issues can explain the difference of the final entropy distributions , we investigated the role of fluid mixing in the two codes .",
    "several recent studies ( e.g. , dolag et al .  2005 ; wadsley et al .",
    "2008 ) have argued that if one increases the amount of mixing in sph simulations the result is larger cluster entropy cores that resemble the amr results . while this is certainly suggestive",
    ", it does not clearly demonstrate that it is the enhanced mixing in mesh simulations that is indeed the main driver of the difference ( a larger entropy core in the mesh simulations need not necessarily have been established by mixing ) . by injecting tracer particles into our simulations ,",
    "we have been able to make an explicit comparison of the amount of mixing in the sph and mesh simulations of clusters .",
    "we find very substantial differences . in the sph computation , there is a very close relation between the initial entropy of a particle and its final entropy .",
    "in contrast , tracer particles in the simulation only show a close connection for high initial entropies .",
    "the lowest @xmath119% of gas ( by initial entropy ) is completely mixed in the simulation .",
    "we conclude that mixing and fluid instabilities are the cause of the discrepancy between the simulation methods .",
    "the origin of this mixing is closely connected to the suppression of turbulence in sph codes compared to the eulerian methods .",
    "this can easily be seen by comparing the flow structure when the clusters collide : while the image is dominated by large scale eddies , these are absent from the sph realisation ( see figure  [ instabilities ] ) .",
    "it is now established that sph codes tend to suppress the growth of kelvin - helmholtz instabilities in shear flows , and this seems to be the origin of the differences in our simulation results ( e.g. , agertz et al .",
    "these structures result in entropy generation through mixing , an irreversible process whose role is underestimated by the sph method .",
    "of course , it is not clear that the turbulent structures are correctly captured in the mesh simulations ( iapichino & niemeyer 2008 ; wadsley et al .",
    "the mesh forces fluids to be mixed on the scale of individual cells . in nature , this is achieved through turbulent cascades that mix material on progressively smaller and smaller scales : the mesh code may well overestimate the speed and effectiveness of this process . ultimately , deep x - ray observations may be able to tell us whether the mixing that occurs in the mesh simulations is too efficient .",
    "an attempt at studying large - scale turbulence in clusters was made recently by schuecker et al .",
    "their analysis of _ xmm - newton _ observations of the coma cluster indicated the presence of a scale - invariant pressure fluctuation spectrum on scales of 40 - 90 kpc and found that it could be well described by a projected kolmogorov / oboukhov - type turbulence spectrum . if the observed pressure fluctuations are indeed driven by scale - invariant turbulence , this would suggest that current mesh simulations have the resolution required to accurately treat the turbulent mixing process . alternatively , several authors have suggested that icm may be highly viscous ( eg . , fabian et al .",
    "2003 ) with the result that fluid instabilities will be strongly suppressed by physical processes .",
    "this might favour the use of sph methods which include a physical viscosity ( sijacki & springel 2006 ) .",
    "it is a significant advance that we now understand the origin of this long standing discrepancy .",
    "our work also has several important implications .",
    "firstly , as outlined in  1 , there has been much discussion in the recent literature on the competition between heating and cooling in galaxy groups and clusters .",
    "the current consensus is that heating from agn is approximately sufficient to offset cooling losses in observed cool core clusters ( e.g. , mcnamara & nulsen 2007 ) .",
    "however , observed present - day agn power output seems energetically incapable of explaining the large number of systems that do not possess cool cores% of all massive x - ray clusters in flux - limited samples do not have cool cores ( e.g. , chen et al .",
    "since at fixed mass cool core clusters tend to be more luminous than non - cool core clusters , the fraction of non - cool core cluster in flux - limited samples may actually be an underestimate of the true fraction . ]",
    "( mccarthy et al .",
    "recent high resolution x - ray observations demonstrate that these systems have higher central entropies than typical cool core clusters ( e.g. , dunn & fabian 2008 ) . one way of getting around the energetics issue is to invoke an early episode of preheating ( e.g. , kaiser 1991 ; evrard & henry 1991 ) .",
    "energetically , it is more efficient to raise the entropy of the ( proto-)icm prior to it having fallen into the cluster potential well , as its density would have been much lower than it is today ( mccarthy et al .",
    "preheating remains an attractive explanation for these systems .",
    "however , as we have seen from our idealised merger simulations , the amount of central entropy generated in our mesh simulations is significant and is even comparable to the levels observed in the central regions of non - cool core clusters .",
    "it is therefore tempting to invoke mergers and the mixing they induce as an explanation for these systems .",
    "however , before a definitive statement to this effect can be made , much larger regions of parameter space should be explored . in particular , a much larger range of impact parameters and mass ratios is required , in addition to switching on the effects of radiative cooling ( which we have neglected in the present study ) .",
    "this would be the mesh code analog of the sph study carried out by poole et al .",
    "( 2006 ; see also poole et al .",
    "we leave this for future work . alternatively , large cosmological mesh simulations , which self - consistently track the hierarchical growth of clusters , would be useful for testing the merger hypothesis",
    ". indeed , burns et al .",
    "( 2008 ) have recently carried out a large mesh cosmological simulation ( with the code ) and argue that mergers at high redshift play an important role in the establishment of present - day entropy cores . however , these results appear to be at odds with the cosmological mesh simulations ( run with the code ) of nagai et al .",
    "( 2007 ) ( see also kravtsov et al .",
    "these authors find that most of their clusters have large cooling flows at the present - day , similar to what is seen in some sph cosmological simulations ( e.g. , kay et al .",
    "2004 ; borgani et al .",
    "on the other hand , the sph simulations of keres et al .",
    "( 2008 ) appear to yield clusters with large entropy cores .",
    "this may be ascribed to the lack of effective feedback in their simulations , as radiative cooling selectively removes the lowest entropy gas ( see , e.g. , bryan 2000 ; voit et al .",
    "2002 ) , leaving only high entropy ( long cooling time ) gas remaining in the simulated clusters .",
    "however , all the simulations just mentioned suffer from the overcooling problem ( balogh et al .",
    "2001 ) , so it is not clear to what extent the large entropy cores in clusters _ in either mesh or sph _ simulations are produced by shock heating , overcooling , or both .",
    "all of these simulations implement different prescriptions for radiative cooling ( e.g. , metal - dependent or not ) , star formation , and feedback , and this may lie at the heart of the different findings",
    ". a new generation of cosmological code comparisons will be essential in sorting out these apparently discrepant findings",
    ". the focus should not only be on understanding the differences in the hot gas properties , but also on the distribution and amount of stellar matter , as the evolution of the cold and hot baryons are obviously intimately linked .",
    "reasonably tight limits on the amount of baryonic mass in the form of stars now exists ( see , e.g. , balogh et al.z 2008 ) and provides a useful target for the next generation of simulations . at present , merger - induced mixing as an explanation for intrinsic scatter in the hot gas properties of groups and clusters remains an open question .    secondly , we have learnt a great deal about the nature of gas accretion and the development of hot gas haloes from sph simulations of the universe . since we now see that these simulations may underestimate the degree of mixing that occurs , which of these results are robust , which need revision ?",
    "for example , keres et al .",
    "( 2005 ) ( among others ) have argued that cold accretion by galaxies plays a dominant role in fuelling the star formation in galaxies .",
    "is it plausible that turbulent eddies could disrupt and mix such cold streams as they try to penetrate through the hot halo ?",
    "we can estimate the significance of the effect by comparing the kelvin - helmholtz timescale , @xmath117 , with the free - fall time , @xmath120 .",
    "the kh timescale is given by ( see , e.g. , nulsen 1982 ; price 2008 )    @xmath121",
    "where    @xmath122    and @xmath123 is the density of the hot halo , @xmath124 is the density of the cold stream , @xmath125 is the wave number of the instability , and @xmath126 the velocity of the stream relative to the hot halo .",
    "if the stream and hot halo are in approximate pressure equilibrium , this implies a large density contrast ( e.g. , a @xmath127 k stream falling into a @xmath60 k hot halo of a milky way - type system would imply a density contrast of @xmath128 ) . in the limit of @xmath129 and recognising that the mode responsible for the destruction of the stream is comparable to the size of the stream ( i.e. , @xmath130 ) , eqns .",
    "( 7 ) and ( 8) reduce to :    @xmath131    adopting @xmath132 , @xmath133 kpc , and @xmath134 km / s ( perhaps typical numbers for a cold stream falling into a milky way - type system ) , we find @xmath135 gyr . the free - fall time , @xmath136 [ where @xmath137 is the virial radius of main system and @xmath138 is the circular velocity of the main system at its virial radius ] , is @xmath118 gyr for a milky way - type system with mass @xmath139 .",
    "on this basis , it seems that the stream would be stable because of the large density contrast in the flows .",
    "it is clear , however , that the universality of these effects need to be treated with caution , as the free - fall and kh timescales are not vastly discrepant .",
    "high resolution mesh simulations ( cosmological or idealised ) of milky way - like systems would provide a valuable check of the sph results .    finally , the sph method has great advantages in terms of computational speed , effective resolution and galilean invariance .",
    "is it therefore possible to keep these advantages and add additional small scale transport processes to the code in order to offset the suppression of mixing ?",
    "wadsley et al .  (",
    "2008 ) and price ( 2008 ) have presented possible approaches based on including a thermal diffusion term in the sph equations .",
    "although the approaches differ in their mathematical details , the overall effect is the same .",
    "however , it is not yet clear how well this approach will work in cosmological simulations that include cooling ( and feedback ) , since the thermal diffusion must be carefully controlled to avoid unphysical suppression of cooling in hydrostatic regions ( e.g. , dolag et al .",
    "one possibility might be to incorporate such terms as a negative surface tension in regions of large entropy contrast ( hu & adams 2006 ) . an alternative approach is to combine the best features of the sph method , such as the way that it continuously adapts to the local gas density and its flow , with the advantage of a riemann based method of solving the fluid dynamic equations ( e.g. , inutsuka 2002 ) .",
    "clearly , there is a great need to find simple problems in which to test these codes : simple shock tube experiments are not sufficient because they do not include the disordered fluid motions that are responsible for generating the entropy core .",
    "idealised mergers represent a step forward , but the problem is still not sufficiently simple that it is possible to use self - similar scaling techniques ( e.g. , bertschinger 1985 , 1989 ) to establish the correct solution .",
    "one possibility is to consider the generation of turbulent eddies in a fluctuating gravitational potential .",
    "we have begun such experiments , but ( although the fluid flow patterns are clearly different ) simply passing a gravitational potential through a uniform plasma at constant velocity does not expose the differences between sph and eulerian mesh based methods that we see in the idealised merger case .",
    "we will tackle the minimum complexity that is needed to generate these differences in a future paper .",
    "the authors thank the referee for a careful reading of the manuscript and suggestions that improved that paper .",
    "they also thank volker springel , mark voit , and michael balogh for very helpful discussions .",
    "nlm and rac acknowledge support from stfc studentships .",
    "igmcc acknowledges support from a nserc postdoctoral fellowship at the icc in durham and a kavli institute fellowship at the kavli institute for cosmology , cambridge .",
    "these simulations were performed and analysed on cosma , the hpc facilities at the icc in durham and we gratefully acknowledge kind support from lydia heck for computing support .",
    "the software used in this work was in part developed by the doe - supported asc / alliance center for astrophysical thermonuclear flashes at the university of chicago ."
  ],
  "abstract_text": [
    "<S> the diffuse plasma that fills galaxy groups and clusters ( the intracluster medium , hereafter icm ) is a by - product of galaxy formation . the present thermal state of this gas results from a competition between gas cooling and heating . </S>",
    "<S> the heating comes from two distinct sources : gravitational heating associated with the collapse of the dark matter halo and additional thermal input from the formation of galaxies and their black holes . </S>",
    "<S> a long term goal of this research is to decode the observed temperature , density and entropy profiles of clusters and to understand the relative roles of these processes . </S>",
    "<S> however , a long standing problem has been that cosmological simulations based on smoothed particle hydrodynamics ( sph ) and eulerian mesh - based codes predict different results even when cooling and galaxy / black hole heating are switched off . </S>",
    "<S> clusters formed in sph simulations show near powerlaw entropy profiles , while those formed in eulerian simulations develop a core and do not allow gas to reach such low entropies . since the cooling rate is closely connected to the minimum entropy of the gas distribution , the differences are of potentially key importance .    in this paper , we investigate the origin of this discrepancy . by comparing simulations </S>",
    "<S> run using the sph code and the adaptive eulerian mesh code , we show that the discrepancy arises during the idealised merger of two clusters , and that the differences are not the result of the lower effective resolution of eulerian cosmological simulations . </S>",
    "<S> the difference is not sensitive to the minimum mesh size ( in eulerian codes ) or the number of particles used ( in sph codes ) . </S>",
    "<S> we investigate whether the difference is the result of the different gravity solvers , the galilean non - invariance of the mesh code or an effect of unsuitable artificial viscosity in the sph code . </S>",
    "<S> instead , we find that the difference is inherent to the treatment of vortices in the two codes . </S>",
    "<S> particles in the sph simulations retain a close connection to their initial entropy , while this connection is much weaker in the mesh simulations . </S>",
    "<S> the origin of this difference lies in the treatment of eddies and fluid instabilities . </S>",
    "<S> these are suppressed in the sph simulations , while the cluster mergers generate strong vortices in the eulerian simulations that very efficiently mix the fluid and erase the low entropy gas . </S>",
    "<S> we discuss the potentially profound implications of these results .    </S>",
    "<S> [ firstpage ]    hydrodynamics  methods : n - body simulations  galaxies : clusters : general  cosmology : theory </S>"
  ]
}