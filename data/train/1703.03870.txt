{
  "article_text": [
    "tumors are often difficult to identify in photon - based imaging due to similarities between normal and tumor tissue . a common approach to improve target visibility is to implant radio - opaque fiducial markers in or near the tumor .",
    "these dense , metal objects serve as easy - to - find landmarks of the tumor position in planar kv / mv imaging , or in cone - beam computed tomography ( cbct ) . in radiation therapy",
    ", a physician will examine these markers in a cbct scan acquired just prior to treatment in order to localize the tumor with the isocenter of the treatment beam.@xcite in some instances , intra - fractional monitoring of these markers can also allow for positional verification of the target during treatment , often to accommodate respiratory gating.@xcite furthermore , offline review of cbct scans can provide valuable data on the motion of fiducial markers , which can inform choices related to margin selection and motion management.@xcite the latter two cases call for automated techniques rather than manual techniques , due to a need for quick reaction time and the high workload involved , respectively .",
    "many methods for locating radio - opaque markers in x - ray images are based on template matching.@xcite simply , template matching attempts to find an object in a sample image using a template image that is representative of that object .",
    "a 2d normalized cross - correlation of the template image and a sample image provides a pixel map of cross - correlation scores ranging between -1 and 1.@xcite a pixel with a score of 1 indicates that the exact object is located at the pixel s location , and a score of -1 is indicative of the exact inverse of the object ( i.e. , a ` negative ' image of the object ) .",
    "essentially , template matching identifies high - contrast regions of an image whose shape resembles that of the template .",
    "when trying to detect fiducial markers used for radiation therapy , the process can be obscured by other high - contrast features of the image , such as bony anatomy , air pockets , or other metallic objects .",
    "marker templates are typically based on the properties of a single marker .",
    "templates can be prepared for spherical and cylindrical markers by knowing their dimensions and the geometry of the imaging setup.@xcite for cylindrical markers , imaging ahead of time can help to determine their position and orientation , allowing for templates to be prepared according to imaging angle .",
    "some markers require that images be taken in advance due to their arbitrary shape and deformation that can occur during implantation ( e.g. , coil markers).@xcite these so called ` coaching ' images can be used to produce templates for subsequent tracking .",
    "however , a cyclical challenge presents itself whenever such coaching images need to be used for a template production technique that is meant to be fully automated .",
    "that is , how does one reliably and in a fully automated manner detect markers in coaching images in order to create templates that will later be used to reliably and in a fully automated manner detect the same markers in clinical images ?",
    "thus far , methods for template generation have either required some form of manual selection by the user , or required that assumptions be made about the shape of markers . in recent years ,",
    "poulsen et al reconstructed templates for arbitrarily shaped markers from cbct projection images , but these images had to be selected manually and required uniform backgrounds.@xcite a method by fledelius et al assumes that markers are cylindrical in shape , and relies on building a constellation model for each individual marker.@xcite regmi et al introduced a semi - automated technique for arbitrarily shaped markers ; however , their technique built templates using planning ct data with relatively poor resolution , required the manual selection of a volume of interest from the planning ct to locate markers , and required manual corrections for variations in inter - marker spacing.@xcite    in this work , we introduce a novel method of template image generation that uses a single cbct scan .",
    "this method is fully automated , requires no input from the user , and makes no assumptions about the shapes of markers . instead of searching for fiducial markers individually ,",
    "this method treats the cluster of markers as a single entity , seeking out the cluster as a whole .",
    "the entire cluster is less likely than individual markers to be confused with other aspects of a patient s anatomy . also , searching for the cluster as a whole eliminates the challenge of needing to differentiate individual markers when they overlap with one another .",
    "cone - beam ct scans were acquired using the on - board imager of a truebeam@xmath1 stx linear accelerator ( varian medical systems ; palo alto , ca ) . in each scan ,",
    "892 projection images ( 768@xmath21024 , 125 kv , 80 mas ) were collected over a full rotation using a half - fan geometry with square pixels 0.388 mm in size ( 0.259 mm projected at the isocenter ) .",
    "images were acquired at a rate of 14.8 images per second . for patient scans ( discussed further in section [ patientdata ] below ) , the real - time position management@xmath1 ( rpm ) system ( varian medical systems ) was used to collect breathing data .",
    "projection images and pertinent metadata were extracted from cbct scan files using matlab ( mathworks ; natick , ma ) and specialized scripts provided by varian .",
    "scans of a heterogeneous thorax phantom ( cirs , inc . ;",
    "norfolk , va ) were acquired to evaluate the accuracy of the template tracking technique .",
    "four fiducial markers ( gold , cylindrical , 5 mm length , 1 mm diameter ) were positioned inside of the phantom , and movement of the phantom was performed using three orthogonal , linear robotic stages ( velmex , inc .",
    "; bloomfield , ny ) .",
    "three scans of the phantom were acquired : one where no motion was imposed ( 0d ) , one where motion was imposed only in the superior - inferior direction ( 1d ) , and one where motion was imposed in all three directions ( 3d ) .",
    "the magnitude of motion imposed on the phantom was chosen to be representative of typical motion observed in the pancreatic cancer patients also evaluated in this work ( left - right , anterior - posterior , and superior - inferior ranges of motion of 5 mm , 5 mm , and 10 mm , respectively).@xcite      seventy - five cbct scans were acquired of 15 patients receiving stereotactic body radiation therapy for pancreatic cancer . these were routine patient alignment scans taken just prior to the delivery of each of their five treatment fractions .",
    "prior to simulation and treatment planning , each patient had 3 to 4 fiducial markers ( titanium - coated carbon , roughly cylindrical , 5 mm length , 1 mm diameter ) implanted in their tumor in order to aid daily 3d target localization .",
    "for the purposes of motion mitigation , abdominal compression was used for all 15 patients . to allow for the collection of breathing data during each scan",
    ", the rpm external marker block was positioned on the patient s upper abdomen , roughly midway between the superior edge of the compression belt and the patient s xiphoid process .",
    "broadly , our method is outlined as follows .",
    "first , cbct projection images are processed to enhance the appearance of markers ( see figure [ figa ] ) . then , a set of static templates ( dependent on gantry angle ) is created from these processed images through an iterative routine that uses filtered back - projection to reconstruct the cluster , forward - projection to create template images , and template tracking to correct for motion seen in projection images .",
    "once this loop converges on a set of static templates , breathing data is incorporated into the same process to construct a set of 4d dynamic templates ( dependent on both gantry angle and breathing motion ) . to aid the more detailed description that follows , figure [ figb ] provides a flowchart illustrating the entire template production process .    to enhance the appearance of fiducial markers , which have an intensity value lower than surrounding pixels , cbct projection images were processed using filtering methods in matlab .",
    "first , median - filtered versions of each projection image ( _ medfilt2 _ , 9@xmath29 ) were calculated .",
    "then , these median - filtered images were subtracted from their respective originals , resulting in marker - enhanced ( me ) images . in me",
    "images , pixels with values greater than zero were set equal to zero , leaving behind the highly radio - opaque markers , some edge features ( e.g. , from bones and gas in the bowels ) , and some random noise .",
    "next , me images were filtered in sinogram space in all three directions using a smoothing filter ( _ sgolayfilt _ , k=3 , f=5).@xcite then , the values of each individual pixel were examined across the entire scan , and for any projections during the scan when a pixel s value rose above its 40^th^ percentile value , its value for that projection was set equal to zero .",
    "this step is based on the assumption that markers are not likely to remain exactly at the isocenter , so markers should pass across any given pixel for only a portion of the scan ( i.e. , no more than 40% of the scan s duration ) .",
    "finally , each projection image was filtered again using a median filter ( _ medfilt2 _ , 3@xmath23 ) and then an adaptive noise - removal filter ( _ wiener2 _ , 3@xmath23).@xcite the resultant filtered marker - enhanced ( fme ) images were used for template production and motion tracking .",
    "figure [ figa ] shows examples of a projection image and its respective me and fme images",
    ".    filtered back - projection was used with fme images to provide a crude , initial reconstruction of the fiducial marker cluster . in the reconstructed volume , voxels with values below a threshold equal to 70% of the maximum value were set equal to zero and gaussian filtering was used to clean up the resultant volume .",
    "the non - zero values that remained were assumed to represent the marker cluster , and these values were shifted so that their 3d center of mass aligned with the center of the volume .",
    "then , forward - projection was used to produce 360 template images as a function of gantry angle ( see figure [ figb]b ) . using this set of template images , the position of the cluster was tracked throughout the scan using normalized cross - correlations of template images and fme images ( tracking is discussed in more detail in section [ tracking ] ) .",
    "once cluster positions were obtained , each fme image was stabilized by centering the cluster in frame . using filtered back - projection with stabilized fme images , the volume that is reconstructed suffers from fewer motion artifacts and better resembles the fiducial marker cluster . by repeating this loop of ( i ) tracking & stabilizing fme images , ( ii ) reconstructing stabilized data , and ( iii ) forward - projecting template images , a set of high quality static templates360 images as a function of gantry angle",
    " could be obtained ( see figure [ figb]c ) .",
    "typically , high quality templates were produced after 3 iterations , but the loop continued until no significant increase in cross - correlation scores was observed .",
    "after static templates were prepared , breathing data could be incorporated into the same iterative routine to produce dynamic templates that are a function of both gantry angle and rpm motion .",
    "using stabilized fme images , 5 different volumes were reconstructed for 5 different ranges of rpm displacement . from each of these 5 volumes , a set of template images based on gantry angle were produced . in order to limit sudden changes in templates during tracking , the 5 ranges of breathing amplitude used for reconstruction were deliberately chosen to include overlap . without overlapping ranges ,",
    "a single template would be used for a given range of rpm positions , and templates would suddenly change when the rpm s position transitioned from one range into another . instead , with overlapping ranges ,",
    "a weighted average of two overlapping templates was used . in this fashion",
    ", templates will not exhibit sudden changes when the position of the rpm transitions between ranges .",
    "based on patient observations , which indicate longer dwell times in the end - exhalation phase , ranges for the 5 breathing amplitude bins were selected to include the following percentiles : 0 - 40 , 25 - 55 , 40 - 70 , 55 - 85 , and 70 - 100 , where 0 indicates end - exhale and 100 indicates end - inhale . with the exception of values below 25 and above 85 , templates selected during tracking were always a weighted - average of two templates , with weightings being dependent on the distance of the current rpm position from the center of the two encompassing ranges . after the loop of ( i ) tracking & stabilizing , ( ii ) reconstructing",
    "stabilized data , and ( iii ) forward - projecting template images was repeated 2 or 3 times , a set of high quality dynamic templates360@xmath25 images as a function of gantry angle and rpm position , respectively  were produced .",
    "tracking with template matching determines the position of the target ( i.e. , the marker cluster ) by locating the correct peak in the normalized cross - correlation of the projection image and the template .",
    "the correct peak , however , is not always the peak with the global maximum .",
    "occasionally during a cbct scan , image features that are not the true target ( e.g. , patient anatomy , foreign objects ) can resemble the target , resulting in an erroneous peak .",
    "almost always , these resemblances are short - lived , only bearing a similarity at certain angles . as such , it is common to only search for peaks in a local window , reducing the likelihood of selecting an erroneous peak .",
    "this window can be chosen based on the expected position of the marker as predicted by a planning ct .",
    "although , a fully automated tracking technique would preferably not depend on this relatively old and possibly unreliable data .    for the automated technique in this work ,",
    "the global maximum was initially located in each cross - correlated image for the entire scan .",
    "next , it was assumed that the longest consecutive chain of global peak positions ( i.e. , without large displacements between frames ) corresponded to the correct peak .",
    "then , from the midpoint in this chain , forward tracking and backward tracking ( i.e. , towards the first and last images in the scan , respectively ) was performed by locating the local peak within a window centered on the previously tracked position . to allow for sub - pixel precision",
    ", the position of each peak was calculated as the center of mass of the 9 pixels within the local tracking window with the highest cross - correlation scores , regardless of whether or not these pixels were adjacent to one another .",
    "figure [ figb]d shows an example of a normalized cross - correlation ( _ normxcorr2 _ ) of a template with an fme image . for this work , a local window of 21@xmath221 pixels ( 5.43@xmath25.43 mm@xmath3 projected at the isocenter ) was used for tracking ( see figure [ figb]e ) .",
    "three factors informed the choice of dimensions for this window : ( i ) pixel dimensions , ( ii ) imaging frequency , and ( iii ) maximum speeds of pancreatic tumors observed during a previous work . for an accumulated set of 97 pancreatic cancer patients ,",
    "the maximum instantaneous tumor speed observed was 3 cm / s.@xcite at this speed , with pixels being 0.259 mm projected at the isocenter and images being acquired every 0.0676 seconds , one could expect the position of a cluster to be displaced up to 8 pixels between frames",
    ". a 17@xmath217 window would be capable of catching such displacements if only single pixel maxima were being used to localize the cluster .",
    "however , in this work , the centroid of the 9 pixels with the highest values within the local window were used to calculate the cluster s position .",
    "thus , in order to allow for the consideration of a cluster of 9 pixels , the local window was expanded to fully encompass 2 pixels beyond the maximum displacement .    to reduce computing time , only a region - of - interest ( roi ) one quarter of the size of the imaging panel ( 384@xmath2512 )",
    "was ever considered in this work .",
    "this roi was centered about the isocenter in the superior - inferior direction . due to the half - fan geometry of each scan , this roi was flush with the edge of the imager in the lateral direction so that as much of the patient near the isocenter could be observed .",
    "cropping of the imaging panel in this manner still allowed for entire fiducial marker clusters to be fully visible for all scans observed in this work , with the exception of incidences when clusters fell outside the field - of - view of the imaging panel due to the half - fan lateral shift .",
    "in addition to automated tracking for all scans , two users manually tracked the positions of fiducial markers in the 3 phantom scans , and one user manually tracked markers for 3 scans from 3 patients .",
    "these measurements were partly assisted by measurements obtained by the automated tracking technique , in that automatically tracked positions were used to show the user a zoomed - in region of each projection image , automatically magnifying the cluster . the matlab function _",
    "ginput _ was used to convert mouse clicks into sub - pixel measurements of the center of each marker , as judged by the user .",
    "one user repeated these measurements so that both inter - observer and intra - observer precision could be evaluated .          in the phantom study ,",
    "inter - observer and intra - observer differences of manually determined marker positions were calculated for each marker in each projection image .",
    "furthermore , the inter - observer and intra - observer differences of the average position of multiple markers were calculated , up to and including all four markers . due to the fact that the automated tracking technique seeks the entire cluster as a whole ,",
    "it is only fair to compare automatically tracked positions against the averaged user - determined positions of all four markers .",
    "known positions were calculated by smoothing the averaged measurements of all four markers and both users . in this way",
    ", sag of the imager was also accounted for .",
    "errors in the phantom study were calculated as the magnitude of the 2d difference between the automatically tracked position and the known position .",
    "the criterion for successfully accurate tracking in the phantom study was an error < 1 mm ( projected at the isocenter ) .    for patient data , in addition to tracking the locations of marker clusters ,",
    "3 cross - correlation metrics were recorded during automated tracking to evaluate the strength of template matches .",
    "the first metric recorded during tracking was the maximum score of any single pixel within the local window , with scores closer to 1 indicating a better match .",
    "the second metric recorded was the global maximum score observed within the entire quarter - sized roi area of the imaging panel . with this metric",
    ", we could monitor the global tracking rate  the rate at which the local maximum was also the global maximum .",
    "whenever the local maximum dropped below the global maximum , we knew that our ability to continuously track the cluster was dependent on the use of a local search window .",
    "finally , the third metric recorded was the number of pixels in the local window with values equal to or greater than half of the maximum value . by multiplying these numbers by the area of a single pixel",
    "as projected at the isocenter , we effectively monitor the full - area - half - max ( fahm ) of the cross - correlation peak ( see mask in figure [ figb]f ) .",
    "akin to the full - width - half - max for point spread and line spread functions , a smaller fahm would denote a sharper peak , indicating a more precise match .",
    "using manually tracked data from three patient scans , a relationship between fahm and error magnitude was established , where error magnitude was calculated as the difference between automatically tracked positions and manually selected positions . with this relationship ,",
    "inferred absolute error values were calculated for all patient data in order to provide an indication of accuracy in real - life clinical scenarios where the ground truth is unknown . for patient data ,",
    "the accuracy of tracked positions was verified by a visual check of stabilized scans , looking for any noticeable displacements during each scan .",
    "for all analysis in the phantom study , 2d differences and 2d errors were calculated relative to the coordinates of the imaging panel in units of micrometers as projected at the isocenter .",
    "figure [ figg]b shows distributions of inter - observer differences for single markers and for the averaged position of 2 , 3 , and 4 markers . the median magnitude of these differences were 183 @xmath0 m , 145 @xmath0 m , 129 @xmath0 m , and 120 @xmath0 m , respectively . for intra - observer differences ,",
    "these values were 149 @xmath0 m , 120 @xmath0 m , 106 @xmath0 m , and 98 @xmath0 m , respectively .    automated tracking in the phantom study was performed using static templates instead of dynamic templates due to the fact that no deformation or rotation of the marker cluster was possible with our experimental setup .",
    "figure [ figg]c shows error distributions for the automated tracking technique in the 0d , 1d , and 3d phantom scans .",
    "median error magnitudes for these scans were 39 @xmath0 m , 53 @xmath0 m , and 93 @xmath0 m , respectively .",
    "errors in all three scans were less than 1 mm ( i.e. , were successfully accurate ) and had 99^th^ percentiles of 152 @xmath0 m , 174 @xmath0 m , and 324 @xmath0 m , respectively .",
    "part of the increase in error magnitudes seen in the 1d and 3d scans was attributed to unavoidable vibrations of the phantom stage that occurred during motion .",
    "normalized probability distributions for the automated tracking technique in the 0d , 1d , and 3d scans are shown in figure [ figg]d , along with the distribution for inter - observer differences of the averaged position of 4 markers .",
    "manually selected marker positions for three patients were used to establish a relationship between full - area - half - max ( fahm ) and error magnitude . using this relationship ,",
    "fahm was used to calculate inferred absolute errors ( iae ) for patient data .",
    "error bars shown are equal to one standard deviation , and broken red lines indicate 5^th^ and 95^th^ percentiles.,width=283 ]    ccccc & * # of markers * & * xcorr score * ( @xmath0 @xmath4 @xmath5 ) & * global tracking rate * [ % ] & * iae * ( @xmath0 , 90% range ) [ @xmath0 m ]   + 1 & 4 & * 0.79 * @xmath4 0.09 & 99.8 & * 214 * , 128283 + 2 & 3 & * 0.86 * @xmath4 0.07 & 100 & * 140 * , 44206 + 3 & 2 & * 0.78 * @xmath4 0.10 & 88.3 & * 140 * , 31210 + 4 * & 3 & * 0.71 * @xmath4 0.09 & 96.5 & * 158 * , 31206 + 5 & 4 & * 0.84 * @xmath4 0.05 & 100 & * 181 * , 89193 + 6 & 3 & * 0.80 * @xmath4 0.10 & 99.9 & * 173 * , 89268 + 7 & 4 & * 0.48 * @xmath4 0.07 & 96.4 & * 371 * , 268459 + 8 & 3 & * 0.88 * @xmath4 0.04 & 100 & * 255 * , 128369 + 9 * & 2 / 1 & * 0.51 * @xmath4 0.10 / * 0.82 * @xmath4",
    "0.15&66.0 / 77.0 & * 118 * , 55184 / * 165 * , 102231 + 10 * & 3 & * 0.76 * @xmath4 0.10 & 99.9 & * 189 * , 102274 + 11 & 3 & * 0.79 * @xmath4 0.12 & 98.9 & * 198 * , 136259 + 12 * & 4 & * 0.57 * @xmath4 0.16 & 91.6 & * 220 * , 65313 + 13 & 4 & * 0.83 * @xmath4 0.05 & 100 & * 102 * , 65136 + 14 * & 3 & * 0.60 * @xmath4 0.12 & 87.9 & * 102 * , 44170 + 15 & 3 / 3 & * 0.91 * @xmath4 0.03 / * 0.87 * @xmath4 0.05 & 100 / 99.1 & * 193 * , 55306 / * 128 * , 44200 +      marker positions were manually tracked in three cbct scans from three patients whose fahm values span the range of values seen in this set of patients .",
    "figure [ fig4 ] illustrates the relationship observed between fahm and error magnitude for all three patients . with this relationship ,",
    "fahm values obtained during the automated tracking of patient data were used to calculate inferred absolute error ( iae ) values .    for all patients ,",
    "the automated technique tracked marker clusters accurately in 100% of projections images",
    "wherein the entire cluster was visible , regardless of whether the templates used were static or dynamic . beyond this tracking rate ,",
    "table [ rtable ] provides a patient - by - patient summary of 4 other noteworthy variables : ( 1 ) the number of markers in the cluster , ( 2 ) local maximum cross - correlation scores obtained during tracking , ( 3 ) global tracking rates , and ( 4 ) inferred absolute error values as calculated by fahm values .",
    "all values shown in table [ rtable ] were based on tracking that used dynamic templates , as they provided higher cross - correlation scores than static templates for select patients ( discussed further in section [ rsvd ] ) .",
    "also , only projection images in which the entire marker cluster was visible in the field - of - view were considered for the data shown in table [ rtable ] .",
    "tracking metrics varied from patient - to - patient , but overall ( @xmath6 ) cross - correlation scores were 0.76 @xmath4 0.12 , global tracking rates were 94.9% @xmath4 7.5% , and inferred absolute errors ( @xmath0 , 90% range ) were 179 @xmath0 m , 87251 @xmath0 m . particularly noteworthy is the global tracking rate , because it provides an indication of the uniqueness of a cluster s appearance amongst the patient s anatomy and any foreign objects .",
    "figure [ fige]a shows the relationship between global tracking rates with respect to the number of markers in the cluster .",
    "as one might expect , increasing the number of markers in a cluster tends to increase the global tracking rate .      for 5 patients , medical procedures",
    "prior to their radiation treatment resulted in other metallic objects being in the same imaging plane as their fiducial markers .",
    "such objects can present serious challenges to tracking techniques that look for radio - opaque markers . in 4 of these patients ( # 4 ,",
    "# 9 , # 12 , and # 14 ) , the non - marker object was a metallic biliary stent used to alleviate a blocked bile duct ( see figure [ fige]b ) . in one patient ( # 10 ) , a large cluster of surgical clips was visible in the treatment plane ( see figure [ fige]c ) . both of these object types pose unique challenges for any marker tracking technique .",
    "metallic stents consist of a collapsible wire mesh that , once re - expanded , appears in projection images as a relatively large area of angled lines .",
    "although , on their own , these stents are not likely to be confused for individual markers , markers can easily be camouflaged by stents whenever they overlap in projection images .",
    "nevertheless , accurate tracking was maintained for all patients with biliary stents .",
    "the staples seen in figure [ fige]c present an even bigger challenge for any technique that intends on tracking cylindrical markers . despite the fact that these clips are quite similar in appearance to the markers being tracked , automated tracking was still successful , and the global tracking rate was an impressive 99.9% .",
    "it is also worth noting that automatic template production performed well with both types of radio - opaque , non - marker objects . for metallic stents ,",
    "remnants of the wire mesh were apparent in the initial crude templates .",
    "however , the more predominant appearance of the marker cluster meant that subsequent iterations of tracking , stabilizing , and reconstructing end up homing in on the target marker cluster , and motion of the stent mesh relative to the cluster s position caused it to be blurred , falling below the ` 70% of maximum density ' threshold .",
    "in the case of the cluster of surgical clips , the cluster of clips was not included because it was too far from the isocenter to be considered in the template reconstruction volume . hypothetically ,",
    "if these clips were situated more closely to the target cluster , manual intervention might have been required to ensure that they were not included in the reconstructed cluster .      in 48 of the 75 cbct scans examined ,",
    "one or more markers moved outside the field - of - view during portions of the scan due to the lateral shift of the on - board imager that is imposed by a half - fan cbct geometry . in some of these instances , tracking accuracy near the edge of the imager",
    "could be maintained by modifying templates based on the last known position of the cluster .",
    "when clusters moved near the edge of the field - of - view , templates were cropped ` on - the - fly ' based on the proximity of the previously tracked position to the edge of the imaging panel ( i.e. , portions of the template occurring off of the imaging panel were set equal to zero ) .",
    "as long as enough of the cluster remained visible",
    " roughly half of the cluster ",
    "tracking could still be sustained .",
    "such cropping allowed for more motion data to be salvaged from these clipped scans .",
    "a visual check of the stabilized scan was performed to verify the validity of tracking measurements in these cases . in 16 scans ,",
    "more than half of the cluster fell outside the field - of - view at some point , and tracking of the cluster became either inaccurate or impossible at these positions . nevertheless , by continuing to follow peaks at the edge of the imager ,",
    "tracking was able to automatically resume accurately once the cluster returned into view in 13 of these 16 scans . in instances where portions of the cluster moved outside of the field - of - view",
    ", tracking could be resumed by once again finding the longest consecutive chain of global peaks in the subsequent set of projection images .",
    "analysis of these events helped to provide some insight into how tracking failures might be recognized when using the current technique .",
    "for these cases , tracking was repeated without implementing the template cropping technique described above .",
    "when clipping occurred , significant drops in cross - correlation scores were observed .",
    "an example of this is shown in figure [ fige]d , with the clipping event corresponding exceptionally well with the portion of the scan where cross - correlation scores dropped more than 5 standard deviations below the mean score observed in another scan from the same patient in which a clipping event did not occur .",
    "due to the range of average cross - correlation scores seen in individual patients , it is likely that a single threshold value would not be suitable for catching detection errors for all patients . instead , statistically significant drops in cross - correlation scores for each patient would be more appropriate .",
    "if one can determine the point at which a cluster has been lost from the field - of - view , one could continue to monitor the last known position of the cluster instead of following peaks at the edge of the imager , potentially improving the technique s ability to resume tracking after such clipping events .",
    "three patients had noticeable marker migration events .",
    "one patient ( # 3 ) had a marker dislodge prior to their first radiation treatment , resulting in 2 markers remaining in place and the dislodged marker visibly loose in the patient s abdominal cavity .",
    "one patient ( # 9 ) had one marker dislodge before the first treatment fraction , and a second marker dislodge after the first fraction , resulting in only 1 marker remaining in place for the last 4 fractions .",
    "one patient ( # 15 ) had 1 of 3 markers noticeably shift its position relative to other markers after 3 treatment fractions .",
    "patients # 9 and # 15 , having had cbct scans before and after a migration event , served as useful cases to evaluate how robust the current technique would be against marker migration .",
    "as such , marker clusters were tracked in post - migration cbct scans using two different sets of dynamic templates : templates produced from images obtained on the treatment day prior to the migration event ( pre - migration templates ) , and templates produced from images obtained on the treatment day after the migration event ( post - migration templates ) . with the assumption that post - migration templates would more accurately track marker clusters in the post - migration scan , the difference between these two motion measurements would be indicative of the magnitude of errors one could expect if new templates were not produced after a migration event .",
    "pre - migration and post - migration templates for patients # 9 and # 15 are shown in figure [ figf ] . in the case where pre - migration templates were used to track motion in the post - migration scan",
    ", tracking was still successfully automated . after correcting for differences in the centroid positions of pre- and post - migration templates ,",
    "the maximum difference between positions tracked by pre- and post - migration templates was 203 @xmath0 m for patient # 9 , and 91 @xmath0 m for patient # 15 .",
    "future work will more precisely examine magnitudes of inter - fraction migration seen for individual markers within a cluster .",
    "two patients had noticeable marker migration events between treatment fractions .",
    "patient # 9 had a marker dislodge , leaving one marker in place .",
    "patient # 15 had one marker shift its position relative to the other two .",
    "pre-/post - migration templates are shown from the same gantry angle.,width=321 ]      most patients saw little difference in their cross - correlation scores when dynamic templates were used instead of static templates .",
    "figure [ figd ] provides a summary of cross - correlation score ratios ( dynamic / static ) , with ratios greater than 1 indicating that higher cross - correlation scores were obtained by dynamic templates .",
    "sample plots of score ratios with respect to relative rpm displacement are shown for patient # 3 and patient # 7 , the patients benefiting the least and the most from dynamic templates , respectively .",
    "end - exhalation , midpoint , and end - inhalation points are plotted for all patients .",
    "patient # 7 and patient # 12 both benefited significantly from dynamic templates , with patient # 7 s cluster exhibiting considerable deformation during their breathing cycle , and patient # 12 s cluster exhibiting considerable rotation .",
    "for these two patients , the highest benefit when using dynamic templates was seen in end - inhalation phases , which is to be expected .",
    "static templates represent an average of the cluster s appearance throughout the breathing cycle . with more time being spent in end - exhalation and mid - range phases ,",
    "static templates tend to be more representative of the cluster during those intervals .",
    "dynamic templates allow for images to be prepared that are more representative of the cluster throughout all phases of the breathing cycle .",
    "although the majority of patients did not exhibit levels of deformation or rotation that necessitated the use of dynamic templates , it should be noted that the use of dynamic templates did not have a detrimental effect on cross - correlation scores for these patients . as such , in a clinical scenario where breathing data were available , dynamic templates could be used by default for all patients .",
    "the field of radiation therapy is trending towards higher dose per fraction delivery ( i.e. , stereotactic body radiation therapy , sbrt ) , as well as increased usage of image guidance ( both pre - treatment and intra - fractional imaging ) .",
    "fiducial markers help increase the accuracy of these high - dose treatments , and automated techniques for marker identification open up new avenues of treatment guidance and monitoring .",
    "related to these trends , this work presents a fully automated workflow for simultaneously achieving two goals : ( 1 ) creating high quality templates of fiducial marker clusters , and ( 2 ) accurately identifying fiducial marker clusters in planar images .",
    "it should be noted that , although marker tracking and template production are coupled in the presented routine , marker tracking can still be performed later , independent from template production .",
    "computationally intensive parts of the routine can be executed in advance by preparing templates beforehand using data from a prior scan .",
    "because of this structure , highly accurate real - time tracking could be accomplished with only a relatively inexpensive cross - correlation calculation .",
    "templates produced using the current technique have the potential to be particularly useful for intra - fractional monitoring during arc therapy techniques .",
    "one common approach to real - time 3d tracking of markers is to use orthogonal kv / mv images acquired during treatment.@xcite with unique templates being produced for all gantry angles , orthogonally tracked 2d positions would be able to pinpoint the target in 3d .",
    "it should be noted that kv images examined in this work were acquired without an active mv beam , which has been known to degrade kv image quality.@xcite it would be worth investigating the performance of this technique in kv images that were acquired while a treatment beam was active , and in mv images acquired by a portal imaging device .",
    "the cropping technique used in this work demonstrated an ability to maintain tracking in many instances where only a portion of the cluster was visible by the imager .",
    "such a technique could prove to be useful for target tracking in portal images of beams that are slightly off target or have been modulated by a multi - leaf collimator .",
    "regarding accuracy , the majority of errors observed in the phantom study were less than 100 @xmath0 m .",
    "maximum errors for the 0d and 1d scans were smaller than the width of a single pixel , and the maximum error for the 3d scan was smaller than the width of two pixels . by demonstrating sub - pixel accuracy ,",
    "we have supported our choice to use the centroid of 9 pixels with the highest cross - correlation scores to determine the position of the cluster .",
    "furthermore , this shows that , moving forward , template matching techniques should be implemented in ways that allow for sub - pixel precision .",
    "had the current work been implemented based on single pixel position measurements , possible positions would have been limited to a grid with 259 @xmath0 m between points , and errors would have been significantly larger as a result .    as for accuracy in patient studies ,",
    "the relationship observed between fahm and inferred absolute error offers a new metric for monitoring accuracy in cases where the ground truth is unknown . in this work",
    ", 14 out of 15 patients had an average inferred absolute error smaller than the width of a single pixel , which is especially impressive when one considers how imprecise human measurements are known to be .",
    "results from the phantom study showed that distributions of inter- and intra - observer differences were wider than error distributions obtained by the automated tracking routine .",
    "previously , harris et al considered fiducial marker positions as determined by three observers , and they found that intra - observer and inter - observer errors were on the order of 1.33 and 1.4 pixels , respectively.@xcite regardless , manual tracking is not an option for intra - fractional marker monitoring . as such , using fahm to monitor the sharpness of cross - correlation peaks offers an intuitive approach for monitoring the accuracy of real - time template matching techniques .",
    "the values observed for global tracking rate highlight the importance of the local tracking window .",
    "an ideal rate of 100% would indicate that the performance of the technique was not reliant on restricting the search to the local window .",
    "otherwise , the size of the local window becomes increasingly important as imaging frequency decreases .",
    "in this work , a 21@xmath221 local window was small enough to maintain accurate tracking for all images , yet large enough to observe the maximum inter - frame shifts observed : 6.72 and 6.91 pixels in lateral and superior - inferior directions , respectively .",
    "if imaging frequency were reduced , these maximum inter - frame shift values would increase , which could require an increase in the size of the local window .",
    "as such , tracking techniques should strive to produce maxima that maintain their maximum status beyond the local window .",
    "high global tracking rates are dependent on the target s appearance being distinct in comparison to other aspects of the projection image",
    ". many parts of a patient s anatomy can easily be confused for a single marker , especially when the marker is spherical or cylindrical .",
    "detection of false markers is a widespread issue when tracking markers individually , which calls for the use of elaborate methods of rejecting false markers.@xcite our approach of seeking the entire cluster as a single entity produces templates that are much more distinct .",
    "compared to other recent template - based tracking techniques , our method compares favorably . a method by poulsen et al had a 99.9% success rate and required that the user manually select certain projection images from the cbct scan that featured large angular separation between them , good marker contrast , and a uniform background.@xcite an approach by fledelius et al that required markers to be cylindrical in shape and used 3d constellation models for each individual marker to aid false marker rejection saw tracking success rates in the liver of 99.9% and 99.8%.@xcite an approach by regmi et al produced templates that were based on simulation ct scans with poor resolution ( 1.25 mm and 2.5 mm slice spacing ) , required manual selection of a volume - of - interest , and required manual corrections for variations in inter - marker spacing saw mean success rates of 100% , 99.1% , and 100% for three tumor sites in cbct images.@xcite our method offered greater simplicity , required no manual steps , did not require 3d constellation models for individual markers , and had a 100% success rate .",
    "the method introduced in this work also compares favorably to automated tracking methods that are not template - based .",
    "wan et al developed an iterative automated technique based on dynamic programming that tracks arbitrarily shaped coil markers in fluoroscopic images.@xcite however , their algorithm minimizes a cost function based on the displacements of local minima observed for a set of multiple images ; as coil markers can have many local minima on each marker , positions determined by their algorithm tend to jump around the marker , resulting in limited accuracy and precision ( 1.5@xmath40.8 mm).@xcite still , the remarkable speed of their approach ( 1 - 2 seconds for a set of cbct projection images ) could be useful for expediting the initial steps of our technique .",
    "the wan et al approach could be used to provide an initial rough tracking of markers , allowing for fme image stabilization before the first crude reconstruction of the marker cluster .",
    "stabilization prior to the first reconstruction would reduce the number of iterations necessary to reach a high quality template .",
    "the current version of the algorithm has not yet been optimized for speed . beginning with raw projection images , automated target tracking and dynamic template production for a single cbct scan",
    "can be performed in 30 minutes to an hour on a desktop personal computer ( 64-bit windows 7 , intel^^ core@xmath1 i7 - 6700 cpu , 3.40 ghz , 16 gb ram ) .",
    "if one sought to use this technique simply to obtain target motion data , this speed is already more than sufficient and could be executed on a computer outside of the clinical workflow . in order to immediately prepare templates for tracking targets in intra - fractional kv images , the speed of the algorithm would need to be improved .",
    "however , if templates are prepared ahead of time , intra - fractional tracking is feasible .",
    "some parameters in the current work were reached empirically . while these parameters would remain stable for a given anatomic site and imaging technique , they may need to be adjusted to accommodate other scenarios .",
    "for projection images with larger amounts of noise , the size of filtering neighborhoods used in the initial image processing step may need to be increased .",
    "for other marker materials , the density threshold used to clean up the reconstructed cluster volume may need to be adjusted .",
    "future work will test the current technique for other treatment sites to evaluate its performance under varying clinical conditions .",
    "a novel , automated method for producing high quality , dynamic templates of fiducial marker clusters from a single cbct scan has been introduced .",
    "this method provides motion tracking data for planar imaging , and demonstrated a 100% success rate for all fully visible marker clusters . by cropping templates ,",
    "tracking was also successful in many instances when portions of the cluster fell outside of the imager s field - of - view .",
    "initial results have shown that this method is remarkably accurate and robust in the face of many challenges commonly seen in fiducial marker tracking ( e.g. , radio - opaque non - marker objects , marker migration , deformation , rotation ) .",
    "while only select patients saw better results when dynamic templates were used instead of static templates , the use of dynamic templates did not have a detrimental effect on tracking for other patients .",
    "in addition to automatically providing clinically valuable motion data , templates produced using this method could potentially improve the reliability of real - time target tracking with intra - fractional kv imaging .",
    "this work was funded in part by the national institutes of health under award number k12ca086913 , the university of colorado cancer center / acs irg # 57 - 001 - 53 from the american cancer society , the boettcher foundation , and varian medical systems .",
    "these funding sources had no involvement in the study design ; in the collection , analysis and interpretation of data ; in the writing of the manuscript ; or in the decision to submit the manuscript for publication .",
    "the authors would also like to thank dr .",
    "tracey schefter , dr .",
    "arya amini , and dr .",
    "karyn a. goodman for their support .",
    "a provisional patent application has been submitted for the technique described in this work on behalf of the authors and the university of colorado .",
    "d. a. jaffray , j. h. siewerdsen , j. w. wong , and a. a. martinez , `` flat - panel cone - beam computed tomography for image - guided radiation therapy , '' int .",
    "j. radiat .",
    ", phys . * 53*(5 ) , 13371349 ( 2002 ) .",
    "d. j. moseley , e. a. white , k. l. wiltshire , t. rosewall , m. b. sharpe , j. h. siewerdsen , j. bissonnette , m. gospodarowicz , p. warde , c. n. catton , and d. a. jaffray , `` comparison of localization performance with implanted fiducial markers and cone - beam computed tomography for on - line image - guided radiotherapy of the prostate , '' int . j. radiat .",
    "67*(3 ) , 942953 ( 2007 ) .",
    "y. seppenwoolde , h. shirato , k. kitamura , s. shimizu , m. van herk , j. v. lebesque , and k. miyasaka , `` precise and real - time measurement of 3d tumor motion in lung due to breathing and heartbeat , measured during radiotherapy , '' int . j. radiat .",
    ", phys . * 53*(4 ) , 822834 ( 2002 ) .",
    "p. r. poulsen , b. cho , b. and p. j. keall , `` a method to estimate mean position , motion magnitude , motion correlation , and trajectory of a tumor from cone - beam ct projections for image - guided radiotherapy , '' int .",
    "j. radiat .",
    "72*(5 ) , 15871596 ( 2008 ) .",
    "k. l. lam , r. k. ten haken , d. l. mcshan , and a. f. thornton , `` automated determination of patient setup errors in radiation therapy using spherical radio - opaque markers , '' med .",
    "phys . * 20*(4 ) , 11451152 ( 1993 ) .",
    "j. m. balter , k. l. lam , h. m. sandler , j. f. littles , r. l. bree , and r. k. ten haken , `` automated localization of the prostate at the time of treatment using implanted radiopaque markers : technical feasibility , '' int .",
    "j. radiat .",
    "* 33*(5 ) , 12811286 ( 1995 ) .    e. j. harris , h. a. mcnair , and p. m. evans , `` feasibility of fully automated detection of fiducial markers implanted into the prostate using electronic portal imaging : a comparison of methods , '' int .",
    "j. radiat .",
    "66*(4 ) , 12631270 ( 2006 ) .",
    "b. cho , p. r. poulsen , a. sloutsky , a. sawant , and p. j. keall , `` first demonstration of combined kv / mv image - guided real - time dynamic multileaf - collimator target tracking , '' int .",
    "j. radiat .",
    ", phys . * 74*(3 ) , 859867 ( 2009 ) .",
    "p. r. poulsen , w. fledelius , p. j. keall , e. weiss , and j. lu , `` a method for robust segmentation of arbitrarily shaped radiopaque structures in cone - beam ct projections , '' med .",
    "38*(4 ) , 21512156 ( 2011 ) .",
    "w. fledelius , e. worm , u. v. elstrm , j. b. petersen , c. grau , m. hyer , and p. r. poulsen , `` robust automatic segmentation of multiple implanted cylindrical gold fiducial markers in cone - beam ct projections , '' med .",
    "phys . * 38*(12 ) , 63516361 ( 2011 ) .",
    "r. regmi , d. m. lovelock , m. hunt , p. zhang , h. pham , j. xiong , e. d. yorke , k. a. goodman , a. rimner , h. mostafavi , and g. s. mageras , `` automatic tracking of arbitrarily shaped implanted markers in kilovoltage projection images : a feasibility study , '' med . phys .",
    "* 41*(7 ) , 071906 ( 12pp . ) ( 2014 ) .",
    "w. fledelius , e. worm , m. hyer , c. grau , and p. r. poulsen , `` real - time segmentation of multiple implanted cylindrical liver markers in kilovoltage and megavoltage x - ray images , '' phys .",
    "biol . * 59*(11 ) , 27872800 ( 2014 ) .",
    "w. liu , r. d. wiersma , w. mao , g. luxton , and l. xing , `` real - time 3d internal marker tracking during arc radiotherapy by the use of combined mv - kv imaging , '' phys .",
    "biol . * 53*(24 ) , 71977213 ( 2008 ) .",
    "s. pouliot , a. zaccarin , and d. laurendeau , `` automatic detection of three radio - opaque markers for prostate targeting using epid during external radiation therapy , '' international conference on image processing * 2 * , 857860 ( 2001 ) .",
    "s. aubin , l. beaulieu , s. pouliot , j. pouliot , and r. roy , `` robustness and precision of an automatic marker detection algorithm for online prostate daily targeting using a standard v - epid , '' med .",
    "phys . * 30*(7 ) , 18251832 ( 2003 ) ."
  ],
  "abstract_text": [
    "<S> * purpose : * implanted fiducial markers are often used in radiotherapy to facilitate accurate visualization and localization of tumors . </S>",
    "<S> typically , such markers are used to aid daily patient positioning and to verify the target s position during treatment . </S>",
    "<S> these markers can also provide a wealth of information regarding tumor motion , yet determining their accurate position in thousands of images is often prohibitive . </S>",
    "<S> this work introduces a novel , automated method for identifying fiducial markers in planar x - ray imaging .    </S>",
    "<S> * methods : * in brief , the method was performed as follows . first , </S>",
    "<S> using processed cbct projection images , an automated routine of reconstruction , forward - projection , tracking , and stabilization generated static templates of the marker cluster at arbitrary viewing angles . </S>",
    "<S> breathing data were then incorporated into the same routine , resulting in dynamic templates dependent on both viewing angle and breathing motion . </S>",
    "<S> finally , marker clusters were tracked using normalized cross correlations between templates ( either static or dynamic ) and cbct projection images . to quantify the accuracy of the technique , </S>",
    "<S> a phantom study was performed and markers were manually tracked by two users to compare the automated technique against human measurements . </S>",
    "<S> then , 75 pre - treatment cbct scans of 15 pancreatic cancer patients were analyzed to test the automated technique under real life conditions , including several challenging scenarios for tracking fiducial markers ( e.g. , extraneous metallic objects , field - of - view limitations , and marker migration ) .    </S>",
    "<S> * results : * in phantom and patient studies , for both static and dynamic templates , the method automatically tracked visible marker clusters in 100% of projection images . </S>",
    "<S> for scans in which a phantom exhibited 0d , 1d , and 3d motion , the automated technique showed median errors of 39 @xmath0 m , 53 @xmath0 m , and 93 @xmath0 m , respectively . </S>",
    "<S> human precision was worse in comparison ; median inter - observer differences for single markers and for the averaged coordinates of 4 markers were 183 @xmath0 m and 120 @xmath0 m , respectively . in patient scans , </S>",
    "<S> the method was robust against a number of confounding factors . </S>",
    "<S> automated tracking was performed accurately despite the presence of radio - opaque , non - marker objects ( e.g. , metallic stents , surgical clips ) in 5 patients . </S>",
    "<S> this success was attributed to the distinct appearance of clusters as a whole compared to individual markers . </S>",
    "<S> dynamic templates produced higher cross - correlation scores than static templates in patients whose fiducial marker clusters exhibited considerable deformation or rotation during the breathing cycle . for other patients , no significant difference was seen between dynamic and static templates . </S>",
    "<S> additionally , transient differences in the cross - correlation score identified instances where markers disappeared from view .    * conclusions : * a novel , automated method for producing dynamic templates of fiducial marker clusters has been developed . </S>",
    "<S> production of these templates automatically provides measurements of tumor motion that occurred during the cbct scan that was used to produce them . additionally , </S>",
    "<S> using these templates with intra - fractional images could potentially allow for more robust real - time target tracking in radiotherapy .    </S>",
    "<S> _ this manuscript was submitted to medical physics _ </S>"
  ]
}