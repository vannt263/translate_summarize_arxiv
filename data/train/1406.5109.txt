{
  "article_text": [
    "the sky brightness is a critical parameter for judging a potential site for direct coronal observation . due to the large difference in the brightness of the solar disk and its nearby sky ( halo ) , it is difficult to achieve the accurate and direct measurement of the sky brightness during the day time .",
    "the corona can only be observed during total solar eclipses until the _ lyot _ coronagraph was invented @xcite .",
    "afterwards , a photometer for measurement of sky brightness near the sun is constructed by @xcite .",
    "evans sky photometer ( esp ) has been used for a long time at various solar observatories @xcite . a modern sky brightness monitor ( sbm )",
    "has been developed for the advanced technology solar telescope ( atst ) site survey project , which can image the solar disk and the nearby sky simultaneously at 450 , 530 , 890 and 940 nm @xcite .",
    "in addition , the sbm data can yield information about the extinction , the aerosols , and the precipitable water vapor content of the atmosphere .    to meet the future development of the chinese giant solar telescope ( cgst ) and large - aperture coronagraphs projects , our sbm is designed and developed following the same idea from @xcite , as one fundamental tool @xcite .",
    "these sbms have been applied at many different candidate sites up to now @xcite .",
    "the optical configuration of one sbm consists of an external occulter , an objective lens , a neutral density filter on the objective lens , and the four bandpass filters @xcite .",
    "generally , the original images acquired by the sbm are not intuitional and concise for a directly further analysis .",
    "moreover , the absence of an auto guide system to serve the equatorial tracking system would result in an indeterminateness of the positions of the solar disk in the sbm s images .",
    "@xcite studied and compared the possible methods for determining the solar disk center in sbm s data .",
    "however , they could not break away from the constraint of some experienced parameters which need personnel intervention .",
    "furthermore , the invalid regions for calculating the sky brightness are excluded manually in former work , too@xcite . with the rapid progress of our site survey project",
    ", the accumulation of huge amounts of data urgently necessitates an efficient , accurate and a fully automated processing approach to deal with the sbm data .    for this purpose",
    ", we have developed a method for automatically processing the sbm data , which allows separating the regions of the sun and the nearby sky as well as permits to automatically recognize the regions of the supporting arms . in the next section ,",
    "we describe the main adopted technologies for our procedure . in section 3 ,",
    "we present the data reduction in detail . in section 4 , we apply our procedure on a set of sbm s data and analyze the scattered light based on the results of our procedure .",
    "our conclusions are presented and highlighted in section 5 .",
    "the sbm instruments can simultaneously image the sun and its nearby sky regions .",
    "the data is useful for directly deducing the normalized sky brightness which is a critical parameter for coronagraph site investigation .",
    "[ fig:1 ] shows a typical sbm image taken at _ gaomeigu _ station . near the center of the image ,",
    "the attenuated solar disk and the projection of the nd4 ( nominal optical density of 4 ) filter are shown .",
    "the bright ring is caused by the diffraction at the edge of the nd4 filter , while the three narrow strips are from the projections of the supporting arms of the nd4 filter .",
    "the brightness of the sky within a few solar radii away from the solar center at a good coronal site is expected to be below @xmath0 , where @xmath1 is the intensity of the solar disk @xcite .",
    "it is convenient to measure the sky brightness with millionths of @xmath1 . in order to extract the regions of the solar disk and the sun s nearby sky ,",
    "it is necessary to accurately determine the solar radius and the position of the solar center in the image .",
    "because the region of the sun s nearby sky on the image contains the projections of the supporting arms which must be excluded in the calculation , the accurate positions of these projections are also needed for each image . in our procedure",
    ", there are mainly three technologies used to achieve the separation of these regions : image binarization with _ otsu _ s method , image matching with cross - correlation , and image fitting with the method of least - squares .    in digital image processing ,",
    "_ otsu _ s method is usually used to automatically perform clustering - based image binarization .",
    "the algorithm assumes that the image contains two classes of pixels corresponding to two peaks on its histogram ( foreground and background ) .",
    "the optimum threshold to separate those two classes is calculated by minimizing their combined spread ( intra - class variance ) @xcite .    in _ otsu",
    "_ s method , the intra - class variance ( the variance within the class ) is defined as a weighted sum of variances of the two classes : @xmath2 where @xmath3 are the probabilities of the two classes separated by a threshold @xmath4 and @xmath5 are variances of these classes .    in this step ,",
    "the image is re - scaled to 8-bit and the normalized histogram is calculated",
    ". then we test all the possible thresholds t from 0 to 255 to calculate the intra - class variances and find the desired t in the 256 thresholds . at last ,",
    "the actual threshold for the origin image is obtained by an inverse scaling mapping .",
    "for example , applying _",
    "_ s method on a white light solar image would locate the boundary with a high accuracy ( fig .",
    "[ fig:2 ] ) . in our procedure ,",
    "_ otsu _ s method is mainly used for the edge detecting of the sbm image .",
    "correlation techniques is predominately used for template matching in image processing @xcite .",
    "if we want to determine whether an image @xmath6 containing a particular object or region of interest , we let @xmath7 be that object or region ( template ) . then",
    ", if there is a match , the correlation of the two functions will be maximum at the location where @xmath7 finds a correspondence in @xmath6 .",
    "cross - correlation of two continuous functions _",
    "f _ and _ h _ is defined as @xmath8 where the asterisk denotes the complex conjugate of @xmath9 . if @xmath9 and @xmath10 are real valued functions , this formula essentially slides the function @xmath10 a displacement to function @xmath9 and calculates the integral of their product at each position .",
    "when the functions match , the value of @xmath11 is maximized .",
    "this is because when peaks ( or troughs ) are aligned , they make a large contribution to the integral . with complex valued functions @xmath9 and @xmath10 , taking the conjugate of @xmath9",
    "ensures that aligned peaks ( or aligned troughs ) with imaginary components will contribute positively to the integral .",
    "therefore , one can use the cross - correlation to find how much @xmath10 must be shifted to make it identical to @xmath9 . an illustrating example",
    "is shown in fig .",
    "[ fig:3 ] . in our procedure ,",
    "cross - correlation is used for edge extracting and to determine the positions of the supporting arms .",
    "the method least - squares ( lsq ) is extensively utilized in data fitting .",
    "it is a standard approach to the approximate solution of over - determined systems , in which the number of measurements is more than that of unknown variables .",
    "least - squares means that it minimizes the sum of the squared residuals . in our procedure , least - squares",
    "is used to fit the circles by the points of the edges of the solar disk and the nd4 filter .    for a circle with the algebraic equation ,",
    "@xmath12 determining the parameters ( @xmath13 $ ] ) of the algebraic equation in the least - squares sense is called algebraic fit , while minimizing the sum of the squares of the distances to the center point @xmath14 is called geometric fit , where @xmath15 is the center coordinate of the circle and @xmath16 is the radius of the circle @xcite .",
    "the sum of the squared residuals of the distance function is obviously a non - linear function .",
    "therefore , we solve this non - linear least - squares problem iteratively with the _ gauss - newton _ method . and the algebraic solution is used as the starting vector for the iteration .",
    "an example is shown in fig .",
    "[ fig:4 ] .",
    "the results of the algebraic and the geometric fits are very different . for fitting analysis of data ,",
    "the algebraic fit only tries to find the curve which minimizes the vertical displacement while the geometric fit tries to minimize the orthogonal distance . on this account ,",
    "geometric fit sometimes is mentioned as `` best fit '' , because it can provide more aesthetic and accurate results .",
    "the positions of the solar disk in a time sequence are crucial parameters for the sky brightness calculations . due to the actual operation on the instrument , the solar image center is usually shifted around the center of the nd4 filter . because the two nd2 filters are fixed on the supporting arms , the position of the center and the projection size of the filters are also important parameters for the calculations .      in actual observations , there may be a lot of data that are mistakenly collected due to the observational constraints . because the sbm is a portable measurement designed for field observations",
    ", the weather condition has a great influence on the acquired images .",
    "moreover , in the absence of a guiding system and high - precision tracking system , the sbm often gathers bad images in which the sun moves out of the field of view .",
    "hence a data selection program must be performed prior to any further calculations .",
    "there are mainly two types of bad data in the observation which are represented in fig .",
    "[ fig:5 ] .",
    "[ fig:5 ] ( a ) represents the bad image covered by the clouds and ( b ) shows the bad image which is saturated .",
    "we use an operation on experiential thresholds to recognize these situations .",
    "binary operations are applied to the images according to the thresholds by _ otsu _ s method and 0.999 maximum , respectively .",
    "then the areas of the binarization images are calculated .",
    "s threshold separates two typical classes of pixels optimally and the clouds attenuation the differences of these two classes , the areas from _ otsu _ s threshold will be very large . and",
    "if the image is saturated , there will be too many pixels with values identical to the maximum .",
    "hence the area from 0.999 maximum threshold will be too large .",
    "we note that these two criteria are not independent .",
    "for example , when the weather is seriously cloudy , the image will be saturated in large area , and the binarization images based on _ otsu _ s threshold and 0.999 maximum threshold are nearly the same .",
    "we also take into account some other ordinary situations such as for the sun totally out of the field of view .",
    "our data selection procedure is very effective to automatically get rid of those data .",
    "this has been verified based on all the sbm s data , collected in 2013 , during the solar site survey .",
    "however the accurate thresholds can not be given because our criteria depend on the experience .",
    "in fact , we adopt a slight strict threshold to ensure the selecting to be sufficient while a very few regular data will be excluded improperly .      the second step in our procedure",
    "is edge detection .",
    "we apply _ sobel operator _ on the enhanced sbm image to get the gradient image and use _ otsu _ s method to threshold the gradient image .",
    "then the edge of the solar disk combined with that of the nd4 filter and some other small structures are obtained ( see fig .  [ fig:6 ] ) . here a morphological erosion with a circular structuring element of @xmath17 pixels is employed to make the edge more distinct .",
    "the subsequent step consists of extracting the edge of the solar disk and of the nd4 filter from the respectively detected edges .",
    "this step is achieved through image - matching based on cross - correlation . for the solar disk",
    ", the angular diameter can be obtained from the recording time of the image . combining with the focal length of the sbm",
    ", we can gain the theoretical size of the solar diameter on the image . by taking into account the size of ccd element",
    ", we finally get the solar diameter in pixels .",
    "then the template for cross - correlation can be constructed .",
    "indeed , a 5-pixels width ring is constructed and adopted as the template instead of a simplified circle template .",
    "the results are shown in fig .",
    "[ fig:7 ] .",
    "the image and template are padded to avoid wraparound error .",
    "the maximum of the resulted correlation - image highlights the displacement with which the template should be shifted . according to this",
    "recovered displacement and the size of the template , the edge of the solar disk can be extracted from the image reported in fig .",
    "[ fig:6 ] .",
    "afterwards , by applying the least - square approach we fit the circle using the edge points of the solar disk to accurately estimate the coordinates of solar center and radius .",
    "similar procedures are performed on the edge of the nd4 filter .",
    "for the solar disk analyses , the cross - correlation technique might give wrong displacement .",
    "in some situations , there is so much scattered light between the solar disk and the inner edge of the nd4 filter ( diffraction ring ) that the thresholding image from _ otsu _ s method might give ambiguous edges therein .",
    "consequently , when the template is shifted to the position where the scattered light is evident , the correlation coefficient is significantly amplified . to overcome this , we proceed by calculating the convolution of the image - of - correlation and the corresponding _ laplacian kernel _ function .",
    "it turns out that the correlation maximum of the defective image - of - correlation is effectively reduced after convolution .",
    "it is noted that in the case of the nd4 filters , there is no similar problem found .",
    "considering the regions of the supporting arms projections could not be used for the sky brightness calculations , one needs hence to get rid of these regions . for this purpose",
    "we test the cross - correlation technique to locate the position of the supporting arms .",
    "however , it can not be applied directly because the template with invariable characteristics is hardly to be constructed . moreover , as long as the supporting arms are fixed on the nd4 filter , we can use the center of the nd4 filter as the pole to expand the image in polar coordinate system .",
    "as shown in fig .",
    "[ fig:10 ] , an annular region out of the diffraction ring is isolated and expanded .",
    "the expanded image reveals a clear distinctive feature , namely , three parallel strips with @xmath18 away from each other .",
    "worthy of note , for convenience we inverse the values of the expanded image .",
    "because the projections of the supporting arms in the expanded images are relatively fixed and parallel , a two - column template can work well enough .",
    "moreover , the sky brightness is not uniform at the angular direction , the template constructed adopting two _ gaussian _ functions is more suitable than using three _ gaussian _",
    "functions . due to",
    "our concerning only the positions of the supporting arms on the angular direction , the template needs not to be designed too high .",
    "on consideration of the efficiency , we eventuality adopt a template consists of two _ gaussian _ functions aligned with their maximums at a distance of @xmath18 and with a width of 32 pixels .",
    "the results are illustrated in fig .",
    "[ fig:11 ] .",
    "the sbm instrument measures the solar disk and sky brightness at four wavelengths , including 450 nm , 530 nm , 890 nm and one at the water vapor absorption band of 940 nm .",
    "the data acquisition system is collecting images at four wave bands in the sequence of wavelengths .",
    "the scattered light of the sky might be found weaker than that of the supporting arms especially in some cases when the sky brightness is too weak .",
    "an example is depicted in fig .",
    "[ fig:12 ] .",
    "in this situation , the images at 890 and 940 nm will present different characteristics from those at 450 and 530 nm .",
    "thus , the above template is not always suitable for all the four wave bands .",
    "the sbm instrument requires approximately a few tens of seconds to acquire a set of data which contains four images at different wavelengths .",
    "the positions of the supporting arms are not significantly changing in a given data set .",
    "for each data set , our procedure consists of computing the positions from 450 nm , adopting cross - correlation method , henceforth apply them on the other different three wavelengths .",
    "the sky brightness is usually measured as follows , @xmath19 where @xmath20 is the average intensity at the region several solar radii away from the solar disk and @xmath21 is the true intensity at the solar disk center before weakened by the nd4 filter .",
    "we note that the scattered light of the sbm is not included in the above formula and the scattered light will be discussed in the next section . in our measurement",
    ", the region corresponding to @xmath20 is between 5.0 to 7.0 solar radii excluding the projections of the supporting arms . for this purpose",
    ", we construct a mask based on the angular coordinates of the positions and the central coordinates of the nd4 filter .",
    "then the mask is multiplied by the image of sbm . next , we get rid of the region out of 7.0 solar radii and in 5.0 solar radii from the masked image according to the fitting position of the solar center and solar radius .",
    "the results are reported in fig .",
    "[ fig:13 ] .",
    "the solar intensity @xmath21 is usually computed in two ways : a central solar intensity is computed within @xmath22 , or a mean solar intensity is computed using all pixels out to @xmath23 @xcite . generally , the first way is adopted in former works @xcite .",
    "however , the solar center in the image does not necessary coincide with the physical center of the sun .",
    "this is mainly because the tube of sbm is not always perfectly parallel to the light ray during observations .",
    "the observers must adjust the position of the sbm after tracking the sun for a period of time , which is about thirty minutes to two hours based on the desired alignment accuracy . here",
    "we stress once again that the portability of the device is of great importance and we should avoid spending too much time with the alignment issue in a site survey . as a consequence , the mean solar intensity near the disk center may seem to `` sharply '' change with time . in order to avoid this possible inconsistency ,",
    "we adopt the intensity at the centroid of the solar disk in the image for the sky brightness calculations .",
    "[ cols=\">,<,^,^,^\",options=\"header \" , ]",
    "in this part we highlight our analysis and approach ; based on the techniques described in the previous sections ; applied to the data set acquired on october 23 , 2013 at _ namco lake _ in tibet .",
    "our procedure takes approximately four hours to automatically process the 10422 data with a normal pc with a dual - core processor ( intel core i3 - 2350 m cpu at 2.30ghz ) .",
    "the results are exported in a table - format output containing : the wave bands , recording time , sky brightness and solar zenith angle , respectively .",
    "these output results can subsequently be used for the evaluation of a series of important physical parameters . a short list sample of the results",
    "is reported in table  [ tab:1 ] .",
    "note that those raw data are not listed sequentially in time . sorting the results by julian date counts , due to the recording time ,",
    "is an effective and necessary step for further calculations .    during the coronagraph site survey , the performance of the sbm instruments in long - time field work may cause unexpected parameter changes , such as increased scattered light levels for different wave bands .",
    "it is hence necessary to calibrate the scattered light levels frequently . according to @xcite ,",
    "the normalized sky brightness including a constant instrumental scattered light can be expressed as follows : @xmath24 where @xmath25 is the atmospheric scattering function , @xmath26 is an instrumental constant which depends on wavelength and @xmath27 is the air mass .",
    "following @xcite , the air mass column can be calculated as a function of zenith angle under the uniform curved atmospheric model : @xmath28 where @xmath29 presents the zenith angle , @xmath30 equals the sum of the altitude and the radius of the earth , and @xmath31 is the thickness of the atmosphere .",
    "then we can get : @xmath32 therefore , we can fit the measured sky brightness @xmath33 as a function of @xmath29 to the above formula , in which @xmath26 , @xmath34 and @xmath31 are three free parameters in the fitting algorithm .",
    "[ fig:14 ] displays the variations of the sky brightness measured with time in all four wavelengths throughout the course of a day .",
    "the fact that the measured sky brightness in the morning and in the afternoon , with the same zenith angles , can not overlap with each other , implies that the atmospheric conditions are not stable throughout the day .",
    "@xcite did not suggest using this kind of data to fit the model .",
    "however , to obtain the fitted sky brightness we decide on adopting only the data during the morning time , _",
    "i.e. _ , the first half of the observations with better sky condition . the calibration parameters of the scattered light are 2.06 , 5.13 , 30.26 and 28.06 millionths for the blue , green , red and water vapor band - passes , respectively , obviously higher than those values reported in @xcite .",
    "the increased scattered - light levels indicate that the black coating material inside the sbm tube should have been seriously got faded after long - term sunshine exposed to high - energy radiation in high altitude environment .",
    "this problem will be resolved soon by coating the sbm tube regularly in the factory .",
    "the coefficients of the nd2 filters show little changes since we have tested them yearly .",
    "the variations of the sky brightness with the local time at _ namco lake _ before and after the calibration of the scattered light are shown in fig .",
    "[ fig:15 ] .",
    "another possible application of our procedure is for guiding and tracking the sun with high precision because our methodology can accurately derive the sun s center coordinates .",
    "usually , a telescope can track an object using an extra guiding system composed by a tube parallel to the main telescope and an individual ccd imager . for field observation such as our site survey ,",
    "the portable sbm instruments were not designed to be equipped with extra guiding system parallel to the main telescope tube . for most guiding systems for solar telescopes with full - disk observing mode ,",
    "the sun s position for tracking is usually derived from the centroid of solar image . in one test with a white - light solar telescope of 100 mm aperture",
    ", we found the centroid of the sun could deviate from that position , based on least - square fitting calculations , for about 50 pixels . in that test , the commercial ccd size is 5202 by 3454 pixels and the data are white - light full - disk solar images with solar diameter of about 3050 pixels .",
    "moreover , our algorithm is more robust compared with the centroid method , because the fitting does nt require all the points of the sun . when the sun is partly covered by clouds",
    ", our algorithm can give the right results while the centroid method would not .",
    "interestingly , all the solar telescopes with the full - disk mode can hence benefit from our algorithm and they can track the sun without an extra guiding system .",
    "for the solar site survey data analysis , we have developed one automatic procedure for the sbm instruments .",
    "a detailed description of the procedure is presented .",
    "the method can calculate the sky brightness , including identifying the solar disk and the sky areas around it as well as the excluded part of the supporting arms .",
    "these processes are implemented on our data acquired by different sbm instruments , including those made in china or lent from usa , during the site survey project in western china .",
    "these results are significant and highly encouraging for further future efforts and investigations , particularly in deriving a variety of important physical parameters such as extinctions , aerosol content and precipitable water vapor content .",
    "furthermore , the sun s accurate center coordinates derived in our procedure can be applied for tracking the sun without an extra guiding system .",
    "indeed , we are in a consulting phase with our engineers for a possible near - future practical realization of the project .    the preliminary analysis applying the results has been performed and discussed for the assessment of the levels of the scattered light .",
    "when we compare the scattered light levels obtained from this work with those taken 2 years ago @xcite , we notice significant increase in every wavelength",
    ". this should be due to the functional degradation of the dark material coating inside the sbm tube which has been used after long - term sunshine exposure in the environment of the tibet plateau .",
    "the new results about the scattered light levels will be reported after the tube is coated again in the near future .",
    "however , the robotization of our method for sbm data analysis has been tested and confirmed with high speed based on large data sample taken in the year of 2013 for various candidate sites , without any artificial intervention such as changing some parameters according to different sbm instruments or weather conditions as before .",
    "we thank dr .",
    "matt penn for his helpful comments to improve the manuscript .",
    "this work was supported by the natural science foundation of china ( nsfc ) under grants 10933003 , 11078004 , 11073050 , 11203072 , 11103041 , 11178005 and u1331113 , the national key research science foundation ( 2011cb811400 ) , and the open research program of key laboratory of solar activity of national astronomical observatories of chinese academy of sciences ( klsa201204 ) .",
    "ae is partly supported by chinese academy of sciences fellowships for young international scientists , grant 2012y1ja0002 .",
    "yl is partly supported by the visiting professor program of king saud university ."
  ],
  "abstract_text": [
    "<S> the sky brightness monitor ( sbm ) is an important instrument to measure the brightness level for the sky condition , which is a critical parameter for judging a site for solar coronal observations . in this paper </S>",
    "<S> we present an automatic method for the processing of sbm data in large quantity , which can separate the regions of the sun and the nearby sky as well as recognize the regions of the supporting arms in the field of view . </S>",
    "<S> these processes are implemented on the data acquired by more than one sbm instruments during our site survey project in western china . </S>",
    "<S> an analysis applying the result from our processes has been done for the assessment of the scattered - light levels by the instrument . </S>",
    "<S> those results are considerably significant for further investigations and studies , notably to derive a series of the other important atmospheric parameters such as extinctions , aerosol content and precipitable water vapor content for candidate sites . </S>",
    "<S> our processes also provide a possible way for full - disk solar telescopes to track the sun without an extra guiding system .    </S>",
    "<S> [ firstpage ]    atmospheric effects  methods : data analysis  site testing  telescopes  surveys  sun : general . </S>"
  ]
}