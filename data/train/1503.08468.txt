{
  "article_text": [
    "[ [ orbit - and - spin - simulation - code - needed - for - electric - storage - rings . ] ] * orbit and spin simulation code needed for electric storage rings . * + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    the u.s .",
    "particle physics community has recently updated its vision of the future and strategy for the next decade in a particle physics project prioritization panel ( p5 ) report .",
    "one of the physics goals endorsed by p5 is measuring the edm of fundamental particles ( in particular proton , deuteron , neutron and electron ) .",
    "since standard model edm predictions are much smaller than current experimental sensitivities , detection of any particle s non - zero edm would signal discovery of new physics . if of sufficient strength , such a source could provide an explanation for the observed matter / antimatter asymmetry of our universe .",
    "a proton edm collaboration@xcite has proposed a storage ring proton edm measurement at the unprecedented level of @xmath1 cm , an advance by nearly 5 orders of magnitude beyond the current indirect bound obtained using hg atoms .",
    "this paper is limited to the theoretical orbit and spin dynamical formulation within eteapot , which is a newly developed code within the universal accelerator libraries ( ual ) simulation environment .",
    "the accompanying paper `` using eteapot to resurrect the ags - analogue ring for edm planning '' describes the practical application of the eteapot code with emphasis on details of simulation requirements for the edm measurement .",
    "[ [ complications - imposed - by - electric - bending . ] ] * complications imposed by electric bending .",
    "* + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    the fundamental complication of an electric ring , as contrasted to a magnetic ring , is the non - constancy of particle speed .",
    "a fast / slow separation into betatron and synchrotron amplitudes has become fundamental to the conventional ( courant - snyder ) magnetic ring formalism .",
    "but , in an electric lattice the mechanical energy ( as quantified by the relativistic factor @xmath2 ) varies on the same time scale as the transverse @xmath3 and @xmath4 amplitudes . on the other hand , changing only in rf cavities , the total energy @xmath5 , which includes also the potential energy @xmath6 , changes on a slow time scale , which makes a similar fast / slow separation valid .    in the magnetic formalism",
    ", since it is only in rf cavities that the mechanical energy varies , the @xmath7 factor is invariant in the rest of the ring .",
    "furthermore one is accustomed to treating energy as constant for times short compared to the synchrotron period . to the extent",
    "the betatron parameters are independent of particle energy , the betatron and synchrotron motions can then be superimposed .",
    "to most closely mimic this treatment in an electric ring , and to continue to regard @xmath7 as the fundamental `` energy - like '' parameter , requires us to evaluate @xmath7 only in regions of zero electric potential , which is to say , not in rf cavities , and not in electric bending elements  in other words , only in field free drift regions .",
    "this leads to a curious , but entirely satisfactory , representation in which the particles spend most of their time inside bend elements where @xmath7 is varying , and little time in short drift regions where @xmath7 is constant .",
    "the reason this is fully satisfactory is that the drift regions are closely spaced , and more or less uniformly spaced around the ring . knowing the lattice functions exactly at those points is operationally equivalent to knowing them everywhere . with this interpretation",
    ", one can again rely on the approximate representation of the motion as a superposition of fast betatron and slow synchrotron motions .",
    "the conventional formulation of accelerator physics is based on a paraxial approximation in which all orbit angles are small relative to a central design orbit . not only is this approximation quite good for small rings",
    ", it becomes progressively better as ring radii increase .",
    "the most important formulas obtained in this approach are based on linearization of the paraxial orbit equations . for sufficiently small amplitudes orbit evolution",
    "can be represented by `` transfer matrices '' multiplying initial displacements , represented in 6d phase space by six component displacement vectors . by introducing nonlinear `` transfer maps ''",
    "this approach can be extended to larger amplitudes by representing each output variable as a ( truncated ) power series of terms each of which is a product of initial components , or their squares , cubes , etc .",
    "this approach can be referred to as _ approximate tracking in an `` exact '' lattice _ where `` exact '' means , for example , that magnetic field profiles , fringe fields etc .",
    ", once represented faithfully by accurate power series , can be subsumed into the previously described truncated power series orbit representations .",
    "the teapot tracking paradigm@xcite is very different .",
    "it is a refinement of the `` kick code '' paradigm , under development when teapot was first introduced , about thirty years ago .",
    "though still based on the paraxial approximation , elements are sliced into sufficiently short segments that they can be represented by delta function `` kicks '' , or kinks , where orbit slopes change discontinuously , but displacements are continuous .",
    "the main virtue of this approach is that it is symplectic ; i.e. particle beams respect liouville s theorem .",
    "teapot took the more extreme approach of jettisoning the paraxial approximation altogether , and insisting that orbits be constructed only from exactly determined , analytic orbits , interupted where appropriate , by kicks .",
    "this can be referred to as _",
    "exact tracking in an approximate lattice_. this approach is restricted by the fact that exact orbits are known only in very special cases ; for example in uniform magnetic fields . however , by introducing thin kick elements it is possible to represent actual elements and actual rings to good accuracy .",
    "these added kicks may be artificial , meaning they model field deviations from the idealized field , or they may represent the total fields of elements physically present in the lattice .",
    "all this is explained in detail in the original schachinger and talman paper@xcite , which remains valid , and in use , to this day . to restrict the length of the present paper ,",
    "only features newly introduced in eteapot , and not covered in the original paper , are described .",
    "one new feature is the requirement to use electric rather than magnetic bending elements , which brings in the complication already mentioned , that , unlike in magnets , particle speeds are not constant in electric elements .",
    "the other new feature is the need to also track the particle spins . to respect the teapot paradigm",
    "this further restricts the list of allowable lattice elements to elements for which the bmt equation , an abbreviation for michel , bargmann , and telegdi@xcite , is exactly solvable .",
    "fortunately it is possible , even straightforward , to meet both of these new restrictions .",
    "the eteapot approach has been developed to address new requirements of the proton edm project .",
    "first is the transition from mgnetic to electric bending .",
    "magnetic tracking codes like teapot and mad implicitly take advantage of the constant speed of particles in magnetic fields .",
    "this seriously complicates the porting of simulation algorithms to electric rings in which the particle speed depends on the local electric potential energy .",
    "thick bending elements are again to be replaced by integrable force fields .",
    "as it happens , inverse square law is the unique force field for which the 3d relativistic equations of motion can be solved exactly .",
    "the second major eteapot extension has been the introduction and tracking of particle spin vectors ( which provides the edm signature of the edm experiment ) .",
    "the differential equation governing spin motion is the bmt equation . in general 3d motion",
    "the bmt equations are computationally challenging .",
    "but in our idealized elements the bmt equations can be solved exactly , as required by the fundamental teapot / eteapot design principle .    by symmetry ,",
    "every orbit in a radial force field lies in a plane , referred to here as `` the bend plane '' .",
    "this plane is always close to but , in general , not quite identical to the horizontal symmetry of the ring . in",
    "spherical @xmath8 coordinates the differential equation governing @xmath9 for a relativistic particle orbit in an inverse square law force field can be solved exactly@xcite .",
    "these are like classical planetary orbits or the orbits in a hydrogen atom treated classically .",
    "even relativistically , every orbit is a precessing ellipse - like ( rosette ) figure , familiar to newton in classical mechanics , and for relativistic motion to einstein , in his general relativistic calculation of the advance of the perihelion of mercury .    using @xmath8 polar coordinates",
    ", it will be shown shortly that orbit evolution in an inverse square law bend plane is described exactly by @xmath10 where @xmath11 is the radial distance from the bend center to the particle position .",
    "then @xmath3 is the ( paraxial ) radial displacement from the design central orbit , which is a circle of radius @xmath12 .",
    "this formula is as simple as it is only because the motion is two dimensional .",
    "the potential energy depends only on @xmath9 , permitting the speed , and hence the momentum components to be expressed analytically as functions of @xmath13 . in correlating this equation with conventional paraxial treatment ,",
    "one notes that the independent variable @xmath13 here differs from the independent longitudinal variable @xmath14 , which is the path length along the design orbit ; but @xmath14 and @xmath13 advance proportionally in bend elements , with the constant of proportionality being the design radius @xmath12 .",
    "each particle being tracked has its own private orbit plane parameters in the orbit equation  though they are all very nearly the same for realistic beams .",
    "the parameters in eq .",
    "( [ eq : munoz.14 m ] ) are interpretable ( approximately ) as follows : @xmath15 is `` average '' radius , @xmath16 is `` eccentricity '' , @xmath17 is the angular deviation from perihelion , and @xmath18 ( interpretable as the `` tune '' in accelerator jargon ) establishes the betatron phase advance per unit angular advance .    for particle tracking",
    "this formulation is simpler than the 3d description of orbits in a uniform magnetic field .",
    "one price to be paid for this simplicity is the need to transform each particle into , and later , out of , its private 2d orbit plane ( with its own basis vectors ) as it enters , and later , leaves a bending element .",
    "these transformations , not shown here , are elementary near - identity rigid rotations ( including spin ) .    a more serious price for this exact , `` global '' coordinate , approach is purely numerical .",
    "though eq .",
    "( [ eq : munoz.14 m ] ) is analytically exact it is numerically treacherous ",
    "the paraxial quantity @xmath3 is a millimeter scale length compared to @xmath11 which is very nearly equal to the @xmath12 which is a large length , such as 40 m .",
    "the special numerical treatment needed to handle this issue is discussed below .",
    "in the horizontal @xmath4=0 bend plane , a radial electric field with index @xmath20 power law dependence on radius @xmath11 is @xmath21 and the electric potential @xmath19 , adjusted to vanish at @xmath22 , is @xmath23 the `` cleanest '' case , shown in figure  [ fig : sphericalelectrodes ] , has @xmath20=1 and is known as the kepler or the coulomb electric field of a point source . one way our case is more general than kepler s is that our treatment has to be exactly relativistic .",
    "this @xmath20=1 case can be referred to as `` spherical '' since the equipotentials are spheres centered on a point charge at the center , and @xmath11 is the radius in @xmath24 spherical coordinates . for @xmath20=1 the kepler problem can be solved in closed form with the same generality as in the relativistic as in the nonrelativistic case",
    ". however the orbits are no longer exactly elliptical , nor restricted to a single plane .",
    "the @xmath20=0 field is referred to as `` cylindrical '' and @xmath11 is the radius in @xmath25 cylindrical coordinates .",
    "this field is the experimentally easiest to produce , using cylindical electrodes having the same central axis .",
    "it has been tacitly assumed that the edm storage ring bends will be constructed this way , even if the optimal electrode shape would be somewhat different . as already explained , ( weak )",
    "thin quadrupoles can be used to tailor the fields to overcome this impediment .",
    "curved - planar electrodes produce the electric field shown in figure  [ fig : cylindricalelectrodes ]     the bold curve shows a particle orbit passing through a _ spherical _ , @xmath26 , electrostatic bending element .",
    "the shaded surfaces are electrodes and the figure is grossly distorted .",
    "the `` @xmath27 '' shown at the origin is the `` effective point charge '' that would give the same idealized electric field as the electrodes . ]",
    "the bold curve shows a particle orbit passing through a curved - planar _ cylindrical _ , @xmath28 , electrostatic bending element .",
    "the electrode spacing is @xmath29 and the design orbit is centered between the electrodes in the @xmath4=0 plane . ]",
    "[ [ solution - of - the - equation - of - motion . ] ] * solution of the equation of motion . * + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    throughout much of this section formulas of muoz and pavic@xcite will be transcribed essentially unchanged , except for bringing symbols into consistency with conventional accelerator notation .",
    "the muoz / pavic formulation , though equivalent to various other formalisms describing relativistic coulomb orbits , is especially appropriate for our relativistic accelerator application .",
    "muoz and pavic show that the `` generalized''-hamilton vector @xmath30 is especially useful for describing 2d relativistic kepler orbits .",
    "our 3d accelerator application can be formulated in such a way as to use only such 2d orbits . except for scale factors , and",
    "a @xmath7-dependent offset , the pair @xmath31 will reduce to the conventional phase space coordinates @xmath32 . )",
    "have been added for our later convenience , when , for our accelerator application , we will rescale the generalized - hamilton vector slightly , for example making it dimensionless rather than a velocity . dividing by a constant characteristic velocity",
    "will bring the formalism more into conformity with standard accelerator terminology . except for these overhead tildes , in this section , quantities and formulas will be largely copied from m & p ; this includes using the abbreviation @xmath33 for @xmath34 .",
    "when the formulas have finally been interpreted in accelerator context , the usual accelerator definition of the prime symbol , with @xmath33 standing for @xmath35 , where @xmath14 is arc length , will be adopted . on the design orbit of radius @xmath12 , where @xmath13 and @xmath14 are both defined , one has @xmath36 , and this rescaling merely introduces constant factors @xmath12 into the formulas . ]    in accelerator context the evolution of @xmath37 for any particular particle will be interpretable as the phase space evolution of that particle .",
    "we will refer to @xmath37 as the `` mp - vector '' since , as far as we know , muoz and pavic intoduced it . in the non - relativistic regime @xmath37",
    "is related to the ( nonrelativistically conserved ) laplace - runge - lenz vector . as generalized by muoz and pavic , though not quite conserved in the relativistic regime",
    ", @xmath37 satisfies a very simple equation of motion , whose exact solutions are sinusoids , even at arbitrarily large `` betatron '' amplitudes .    in geometric mechanics jargon@xcite ,",
    "the lattice is therefore `` integrable '' .",
    "the @xmath38 formalism then makes it possible to define an implicit transfer matrix ( where `` implicit '' implies the matrix elements depend on each particle s own conserved orbit parameters , a.k.a .",
    "`` orbit elements '' ) .",
    "this has the virtue of hiding the strong coupling between kinetic energy and horizontal position in an electric ring .",
    "though @xmath38 is not conserved in general , muoz and pavic show ( and it will soon become obvious ) that _ @xmath38 is conserved if and only if the orbit is circular .",
    "_ for the proton edm lattice the design orbit is circular within bends . also , for weak - focusing lattices , neglecting the effects of lattice quadrupoles situated between the bends , off - momentum closed orbits are also almost circlular .",
    "but @xmath38 also has the numerical disadvantage mentioned earlier  transverse displacements ( the normally significant aspect of accelerator dynamics ) need , at least superficially , to be described by expressions having large cancellations .",
    "this makes it essential to use series approximations very carefully , even when the linearized paraxial approximation is fully valid .",
    "it is important to organize the evolution formulas in such a way as to exploit cancellations analytically , for example arranging for leading terms to cancel analytically , rather than relying on their numerical cancellation .",
    "this can usually be accomplished ( without sacrificing exact expressions ) by simplifying the sum of the approximately cancelling terms and keeping track and restoring any discrepancy .",
    "this recovers numerical precision for small amplitudes comparable to that achieved in conventional courant - snyder formulation .",
    "another inconvenient aspect of the muoz / pavic formalism is the fact that the design , central orbit is _ degenerate _ in the sense that it is , in fact , the arc of a perfect circle .",
    "this is precisely the condition in which the perihelion ( or aphelion ) angular orbit element is undefined because the radius vector length is independent of angular position .",
    "this ambiguity is most important in the time of flight calculations needed for accurate modeling of synchrotron ( longitudinal ) oscillations  a calculation that strains the numerical accuracy because all path lengths are so nearly equal .",
    "these same considerations complicate the derivation of explicit ( meaning the elements are independent of particle coordinates ) transfer matrices and their generalization to truncated power series transfer maps .",
    "this also is only a inconvenience that can be worked around .    with qualitative discussion complete ,",
    "the analytic formulation can begin .",
    "the lorentz force equation in the @xmath20=1 spherical case is @xmath39 where @xmath40 is the customary mks notation for @xmath41 except for implicitly including also the ( point ) charge factor . on the central orbit",
    "the centripetal force equation is @xmath42 where @xmath40 , like @xmath43 , the on - axis electric field , is defined to be positive . in ual , as in the mad simulation code",
    ", energies like @xmath44 are always expressed numerically in gev units , such that their numerical value in the computer is @xmath45 , giving them gv units  an mks unit . from eq .",
    "( [ eq : munoz.2p ] ) , @xmath46=@xmath47 and @xmath40 is always expressed in the computer as @xmath48 , which gives it gv - m units  also an mks unit .",
    "the on - axis electric field @xmath43 is measured in gv / m units . in these units",
    "@xmath49 , numerically , with @xmath12 measured in meters .",
    "a particle s angular momentum is @xmath50 in terms of the design momentum @xmath51 and the design radius @xmath12 , @xmath52 , and @xmath53 like @xmath40 , internally ( i.e. in the computer ) , @xmath54 is expressed numerically as @xmath55 . for internal numerical values",
    "to be most easily substituted into an analytic external documentation formula , factors should be grouped as @xmath56 , @xmath57 , @xmath46 , etc . or , as here , @xmath58 , and factors of @xmath59 ( for",
    "ev to gev conversion ) put in `` by hand '' .",
    "( [ eq : munoz.3pm ] ) is also useful in the form @xmath60 in sxf lattice description files ( discussed further in the accompanying paper@xcite ) the rf parameter @xmath61 actually stands for @xmath62 times the maximum energy change in ev of charge @xmath63 passing through the rf cavity .",
    "one shows easily that both the total energy @xmath64 ( where the `` i '' superscript on @xmath65 re - emphasizes that this relativistic factor has to be evaluated `` inside '' the bend element , where it depends on the local electric potential ) and the angular momentum @xmath66 are constants of the motion .",
    "it has been necessary to distinguish between the muoz potential energy @xmath67 and our potential energy @xmath68 , because our potential vanishes on the design orbit , while theirs vanishes at infinity . for the design orbit , using eqs .",
    "( [ eq : munoz.3pmm ] ) and ( [ eq : munoz.3qm ] ) , one obtains @xmath69 ( the curious presence of @xmath70 in the denominator follows from the definition of potential energy . ) using the obvious unit vector relations ( valid for motion with angle @xmath13 increasing ) @xmath71 where primes stand for @xmath72 , the lorentz equation can be re - expressed as @xmath73 defining covariant velocity @xmath74 , and using eq .",
    "( [ eq : munoz.3q ] ) to express @xmath75 in terms of @xmath76 , the @xmath77 equation of motion is @xmath78 muoz and pavic then introduce the generalized hamilton vector @xmath79 which we refer to as the mp - vector .",
    "it is specially tailored so that the differential equation for @xmath38 reduces to @xmath80 ( the previously mentioned constancy of @xmath37 on circular orbits is evident from this equation , since @xmath65 is constant on , and only on , circular orbits . ) using @xmath81 where the new parameter @xmath18 ( soon to be identified as horizontal betatron `` tune '' ) is defined by @xmath82 on the design orbit @xmath83 ( of course @xmath84 will not be controlled to this accuracy in practice and , in any case , quadrupoles and drifts in the lattice will alter the ring tunes . ) solving eq .",
    "( [ eq : munoz.8p ] ) for @xmath11 , the orbit equation in bend elements can be expressed in terms of @xmath85 ; @xmath86 where @xmath87 the parameter @xmath15 is especially important in the storage ring context , because the second term in the denominator of eq .",
    "( [ eq : munoz.8q ] ) is both small compared to the first , and oscillatory . as a result @xmath15 can be thought of loosely as an average radial position .",
    "( as earlier , the `` constants of motion '' @xmath76 , @xmath18 , @xmath88 , and @xmath15 are to be referred to as `` orbit elements '' . though constant along any single particle orbit",
    ", they are different ( though only very slightly ) for each individual particle . )    in component form eq .",
    "( [ eq : munoz.8 ] ) is @xmath89 the relativistic factor @xmath65 ( equal to @xmath90 ) can be expressed in terms of @xmath85 .",
    "first , eliminate @xmath11 in favor of @xmath91 using the first of eqs .",
    "( [ eq : munoz.8p ] ) , then eliminate @xmath91 if favor of @xmath85 , and , finally , solve for @xmath65 ; @xmath92 needed for simplifying eqs .",
    "( [ eq : munoz.9 ] ) , differentiating this equation yields @xmath93 ( heuristically , this expresses the dependence of mechanical energy accompanying the change in potential energy associated with change in particle position . ) after several lines of algebra , eqs .",
    "( [ eq : munoz.9 ] ) then reduce to @xmath94 these are the equations that justify having introduced the generalized hamilton vector .",
    "their general solution can be written as @xmath95 where @xmath13 is a running angle in the interior of the bend and @xmath17 is an angle to be determined , along with @xmath96 , by matching to the known initial conditions .",
    "these new `` orbit elements '' , @xmath97 and @xmath17 , are expressible in terms of the previously defined orbit elements .",
    "they are now to be used to parameterize the true , particle - by - particle orbits through the bend element .",
    "( as explained elsewhere , the effects of the small deviations of the actual electric field from the coulomb field are to be corrected for by virtual delta function kicks between bend slices . ) concentrating on @xmath85 , and _ defining _ @xmath13 to be zero at the bend entrance , we have @xmath98 these equations determine @xmath96 and @xmath17 to satisfy @xmath99 the initial conditions for @xmath100 need to be determined from the known coordinates of the particle just as it enters the bend region . from its defining eq .",
    "( [ eq : munoz.7 ] ) , @xmath101 note that @xmath7 , like @xmath76 , is a running , particle - specific probe variable . updated on every entry to or exit from a bend element . when inside the bend it is equal to @xmath65 , but @xmath7 varies discontinuously as the particle passes bend edges ( off - axis ) . in eq .",
    "( [ eq : munoz.8p ] ) , for any particular particle , @xmath11 is the only factor which is not a constant of the motion .",
    "we therefore have @xmath102 the second of eqs .",
    "( [ eq : munoz.13pp ] ) can then be used to fix @xmath17 , but this requires resolving the multiple - valued nature of the inverse tangent function .",
    "one hopes this can be done by requiring @xmath11 to be `` smooth '' ( continuous , with continuous slope ) across the bend entrance edge .",
    "even this is tricky since , for non - normal incidence , there is a refractive deflection at the boundary .",
    "this deflection is small , especially near normal incidence , which is always true in our case . to resolve the inverse tangent ambiguity for non - normal incidence it would usually be sufficient to choose the value for which the slope is most nearly continuous . but to be safe one has to account explicitly for the refractive kink .    from eq .",
    "( [ eq : munoz.8q ] ) the radial coordinate @xmath11 is given by @xmath103 this is the orbit equation previously introduced in eq .",
    "( [ eq : munoz.14 m ] ) .",
    "borrowing terminology from solar planetary orbits about the sun , from its structure , one sees that @xmath17 is either the angle at perihelion , or aphelion , depending on the sign of @xmath16 . in multi - million",
    "turn tracking , there are many opportunities to misidentify aphelion and perihelion or to obtain the wrong sign for @xmath16this complication is associated with the degeneracy of the central orbit that was mentioned earlier .",
    "using eqs .",
    "( [ eq : munoz.8r ] ) , ( [ eq : munoz.13pp ] ) , and ( [ eq : munoz.14 ] ) , @xmath104 by expressing the small parameter @xmath16 , proportional to the small hamilton vector value and slope ( or rather their quadrature sum ) , this formula is essential to the implementation of the muoz / pavic approach .",
    "( these `` small '' quantities can even be infinitesimal in the analytic treatment . )    from these equations one has obtained simple analytic parameterizations for @xmath105 and @xmath106 . in particle tracking one knows @xmath107 to high accuracy and wishes to find @xmath108 , also to high accuracy .",
    "their difference is given by @xmath109 this manipulation has suppressed the harmful cancellation exhibited in eq .",
    "( [ eq : munoz.14 ] ) which gives @xmath11 rather that the radial displacement from the design orbit .",
    "eventually , when deviation from @xmath110 electric field dependence is modeled by thin virtual quadrupoles , to improve precision , one will slice the bends finer and finer .    in the context of accelerator physics",
    "one can ask for the similar evolution equations for vertical coordinate @xmath4 . but this question is inappropriate ; the kepler orbit lies , by definition , in a single plane and we always choose the propagation plane to be the plane containing the incident velocity vector .",
    "instead of keeping track of @xmath4 we have to keep track of the orbit plane or , equivalently , the normal to the orbit plane . this vector changes discontinuously ( but only by a tiny angle ) in passing through thin multipole elements .",
    "it is undefined in drift regions and is constant in bend elements . keeping track of the orbit plane",
    "is covered in later sections .",
    "[ [ rescaling - of - the - mp - vector - and - updating - the - horizontal - slope . ] ] * rescaling of the mp - vector and updating the horizontal slope . * + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    for updating the horizontal slope component , we introduce the previously - announced rescaling of the mp - vector ; @xmath111 dividing by the design velocity @xmath112 has rendered @xmath113 dimensionless , and the further factor of @xmath70 in the denominator simplifies matching to conventional lattice function representation . at this time",
    "we also switch definitions of the prime operator notation so that @xmath114 , where @xmath14 is arc length along the design orbit . with this revised notation eqs .",
    "( [ eq : munoz.12 ] ) become @xmath115 finally it is possible to make contact with more familiar accelerator variables , such as @xmath116 and @xmath117 , the radial and longitudinal particle momentum components .    from the definition of @xmath118 in eq .",
    "( [ eq : munoz.7 ] ) , after re - scaling  ( [ eq : betafuncts.1 ] ) , the transverse momentum is given by @xmath119 } = \\frac{p_x}{p_z } = h_r , \\label{eq : betafuncts.1p}\\ ] ] where @xmath120 is the design momentum and p[1 ] is the symbol used for @xmath121 internally in the ual code .",
    "( some components in the chain of equalities in eq .",
    "( [ eq : betafuncts.1p ] ) may assume paraxial approximation , even if for no reason other than that the definition of @xmath3 is unambiguous only in the paraxial limit . )",
    "so @xmath122 is nothing other than the phase space coordinate conjugate to @xmath3 , namely @xmath123 .    when applied at the exit of a bend , the value of @xmath121 given by eq .",
    "( [ eq : betafuncts.1p ] ) would better have been called @xmath124 , since the refractive compensation associated with exiting the bend would still need to be made to produce p[1 ] valid just outside the bend exit .",
    "potential loss of numerical precision is always an issue .",
    "a compact , numerically accurate way to update the 2d phase space coordinates is to work directly from eq .",
    "( [ eq : munoz.14 ] ) . for bend angle @xmath125 ,",
    "the argument @xmath126 is @xmath125 .",
    "the increment in @xmath3 from input to output is @xmath127 differentiating eq .",
    "( [ eq : munoz.14 ] ) produces @xmath128 including the change of independent variable from @xmath13 to @xmath129 , the increment from input to output is @xmath130 these formulas avoid taking the difference of nearly equal terms .    [",
    "[ pseudoharmonic - description - of - the - motion . ] ] * pseudoharmonic description of the motion . * + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    in general the mp plane will be close to , but not exactly identical with the horizontal lattice design plane . in this section , for simplicity in making contact with twiss functions",
    ", these two planes will be treated as equivalent .    at this point",
    "we wish to correlate the dynamic quantities introduced so far with more familiar ( to accelerator scientists ) quantities such as twiss functions , betatron phase advances , transfer maps , and so on .",
    "the relationships are especially simple for a combined function , weak - focusing ring ; this will be described before developing the full twiss function formulation needed for separated function lattices . in general , the definition of lattice functions within electric bend elements will be more complicated , but also not very important for the edm experiment .",
    "( [ eq : munoz.12pp ] ) yields @xmath131 in traditional courant - snyder ( cs ) formalism the betatron phase @xmath132 and the positive - definite lattice function @xmath133 are related by @xmath134 even with @xmath135 , because @xmath133 is not necessarily constant , the angles @xmath132 and @xmath136 , though monotonically related , are not strictly proportional .",
    "the virtue of the beta function formalism is primarily due to its ability to describe each orbits in a complicated lattice as a sinusoidal function of unambiguous phase advance @xmath132 .",
    "shortly we will have to admit that our generalization of the cs formalism to electric lattices will be limited , in principle , to describing orbits _",
    "outside _ bending elements , where the electric potential vanishes . the parameter @xmath137 introduced now will be applied _ inside _ bends , and it is assumed to be independent of @xmath14 .",
    "furthermore it will not match up smoothly with the adjacent _ outside _ @xmath137 functions .",
    "this reflects the small discontinuity in particle kinetic energy at bend edges .    in practice",
    "this issue is largely academic . in any realistic ring",
    "there are many drift spaces , more or less uniformly distributed . especially with the weak focusing expected in edm rings ,",
    "the ranges of @xmath137 function variations will be quite limited .",
    "simply interpolating the ( slightly ambiguous ) beta functions in the bend regions from their ( reliably known ) values in the drifts should be sufficient for most purposes .",
    "as already stated , our electric lattice model admits only uniform , inverse square law bending elements ( though with artificial thin trim elements ) . within such a bend we approximate @xmath138 and horizontal``betatron '' oscillations of amplitude @xmath139 are described by @xmath140 differentiating once more yields @xmath141 substituting this into eq .",
    "( [ eq : munoz.12pp ] ) produces @xmath142 just as @xmath122 and @xmath143 vary `` in quadrature '' , so also do @xmath3 and @xmath121 . the ratios of their maxima are @xmath144 collecting results , we have @xmath145 ( remember that these @xmath3 and @xmath121 values are only the precise frenet - serret laboratory coordinates when the m - p plane coincides with the horizontal laboratory reference frame , which is always a good approximation . ) to summarize , one sees that , to linearized approximation , the components of the mp - vector are , except for scale factors , identical to the betatron phase space components .",
    "the parameter @xmath137 has been used in this section only to produce familiar - looking formulas . for a weak focusing ring",
    "we now see that this @xmath137 need never have been introduced , since it is just an abbreviation for @xmath146 .",
    "it does not depend explicitly on @xmath14 , but through its @xmath18 factor it depends on @xmath7 , @xmath3 and @xmath121 , and is therefore different for different particles .",
    "[ [ revolution - period . ] ] * revolution period . *",
    "+ + + + + + + + + + + + + + + + + + + +    for modeling longitudinal dynamics it is critical to obtain the revolution period @xmath147 to good accuracy for every particle . from eqs .",
    "( [ eq : munoz.3q ] ) , ( [ eq : munoz.11 ] ) , ( [ eq : munoz.13 ] ) , and ( [ eq : munoz.14 ] ) one has @xmath148 to obtain time of flight @xmath149 has to be integrated over @xmath13 .",
    "both integrals can be evaluated in closed form to obtain @xmath150 as a function of @xmath13 .",
    "however the formulas are complicated and their evaluation is numerically treacherous , for reasons discussed below .    for the study of longitudinal dynamics and synchrotron oscillations what is needed is the deviation of the time of flight from the time of flight of the design particle .",
    "this is a very small difference of two large numbers .",
    "( [ eq : revperiod.1 ] ) can be recast as @xmath151 here @xmath152 , the factors @xmath153 and @xmath154 ( both of which deviate little from constancy and can never become `` small '' ) replace the other factors in eq .",
    "( [ eq : revperiod.1 ] ) , and @xmath155 is the values of @xmath153 on the design orbit .",
    "all of the factors @xmath153 , @xmath154 , @xmath155 , @xmath16 , and @xmath18 are constant on any particular orbit being followed , and all have values very close to their values on the design orbit .",
    "the only variable factor is @xmath125 .",
    "the first two terms cancel approximately , which makes the evaluation of the first term critical .",
    "the third term requires no special treatment since the @xmath156 factor is already differentially small .",
    "the cancellation tendency can be ameliorated by adding and subtracting a term @xmath157 to produce @xmath158 here @xmath159 has been obtained using eq .",
    "( [ eq : munoz.14 ] ) . in eq .",
    "( [ eq : revperiod.3 ] ) all terms are differentially small and the small differences of large numbers have been moved outside the integrals . for the proton edm experiment ,",
    "since @xmath160 never exceeds @xmath161 , the integrand can be expanded in powers of @xmath16 before integrating .",
    "a typical leading term in these integrals is @xmath125 multiplied by a constant factor . while using this time of flight formalism eteapot includes this term as well as terms with extra powers of @xmath16 up to @xmath162 and _ does not _ check automatically that this last term is , itself , negligible .",
    "an alternate , seemingly more robust , hybrid time of flight calculation , now used by default in eteapot , is desribed later .",
    "a subtle feature of the time of flight evaluation results from the fact that the ellipticity @xmath16 vanishes on perfectly circular orbits ( of which the design orbit is one ) .",
    "this causes the angle @xmath17 , which is the angle to perigee , to be indeterminate because perigee is indeterminate on a circular orbit .",
    "( [ eq : munoz.14 ] ) , the second of eqs .",
    "( [ eq : munoz.8r ] ) and eq .",
    "( [ eq : munoz.13pp ] ) force @xmath16 to be non - negative . and",
    "yet the major and minor axes can switch from prolate to oblate when an arbitrarily small kink is applied to an orbit for which @xmath16 is close enough to zero .",
    "when this happens the angle @xmath17 advances discontinuously through @xmath163 . when this happens the angle @xmath13 also advances discontinuously through the same angle",
    ".    these changes do not affect the integrals in eq .",
    "( [ eq : revperiod.3 ] ) which depend only on @xmath126 .",
    "they do , however , make the time of flight calculation hyper - sensitive to the determination of @xmath17 , which can change erratically in progressing from one bend element to the next , after passing through a straight section which possibly contains a quadrupole . a discontinuous change in @xmath17 can change the analytic , closed - form indefinite integrals used in applying eq .",
    "( [ eq : revperiod.1 ] ) .",
    "[ [ determination - of - the - mp - bend - plane . ] ] * determination of the mp bend plane . * + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    in order to reserve @xmath3 for radial displacement in the muoz - pavic ( mp ) bend plane we now use overhead bars to designate conventional courant - snyder ( cs ) coordinates . at a location where the longitudinal coordinate has been shifted to be @xmath164 , the particle position @xmath165 is given by @xmath166 scaled momentum components @xmath167 , and @xmath168 , are defined by @xmath169 where terms of fourth order and beyond have been dropped .",
    "( for the edm experiment such terms have numerical values such as @xmath170 . )",
    "this has been arranged so that @xmath171 is a unit vector .",
    "the @xmath172}$ ] and @xmath173}$ ] mad / ual coordinates being tracked in the computer are close to , but not exactly equal to @xmath174 and @xmath175 .",
    "in fact @xmath176}}{1+\\delta p / p_0 } , \\quad\\and\\quad \\tilde p_{\\bar y } = \\frac{{\\tt p[3]}}{1+\\delta p / p_0}. \\label{eq : cstomp.2p}\\ ] ] scaled angular momentum components are then given by @xmath177 the scaled central angular momentum is @xmath178 , and the perpendicular component @xmath179 is @xmath180 which defines two ( small ) angles the tilted bend plane makes with true vertical .",
    "this equation determines the ( small ) rotation angles about transverse axes that rotate the horizontal plane into the mp plane .",
    "the trigonometry is not exact .",
    "but it is accurate enough for the extremely small angles involved .    [",
    "[ merging-2d - mp - tracking - into-3d . ] ] * merging 2d mp - tracking into 3d . * + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    with the orbit geometry being worked out in the 2d mp plane , it remains necessary to transform back and forth to the local 3d frenet frame .",
    "the goal of a tracking calculation is to obtain the output particle radius vector @xmath181 for a given input particle radius vector @xmath182 .",
    "the corresponding unit vector evolution is from @xmath183 to @xmath184 .",
    "we calculate this unit vector evolution first .    on the design orbit",
    "the input and output vectors are @xmath185 and @xmath186 , both lying in the horizontal @xmath187-plane . with the design bend angle defined to be @xmath13",
    ", one has @xmath188 the particle - specific bend angle @xmath189 , in its own bend plane , satisfies @xmath190 where @xmath189 is close to , but not equal to , @xmath13 in general .",
    "letting @xmath139 and @xmath191 be the components of @xmath184 along @xmath192 , one has @xmath193",
    "( for clockwise orbit ) the unit vector normal to the bend plane , @xmath194 is known from calculations based on the particle coordinates at the entrance to the bend element . to determine @xmath139 we require @xmath195 solving for @xmath139 , @xmath196",
    "the angular advance @xmath189 then satisfies @xmath197 the radial coordinate is then given by eq .",
    "( [ eq : munoz.8q ] ) which is repeated here ; @xmath198 where @xmath85 is given by eq .",
    "( [ eq : munoz.13 ] ) .",
    "the output radius vector is then given by @xmath199 in this way the evolution can be completed using just courant snyder coordinates .",
    "[ [ electric - sector - bends - with - field - index - m . ] ] * electric sector bends with field index @xmath20 . * + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    the muoz and pavic , hamilton vector approach described so far , though ideal for fast exact particle tracking , is less well matched to developing the courant - snyder twiss function description conventional in accelerator theory . a more conventional approach is taken in this section .",
    "as well as enabling a truncated power series formalism for electric rings , the results can be used for corroborating results already obtained .",
    "this includes independently confirming the integrable dynamics demonstrated for @xmath20=1 .",
    "though discovered using the muoz / pavic approach , this remarkable integrability property must necessarily be derivable also in the paraxial - based approach .",
    "initially this treatment will be generalized to include field indices other than @xmath26 .    to produce weak vertical focusing the radial electric field has to fall off as @xmath201 , with @xmath202 .",
    "the @xmath28 case is singular , and leads to a logarithmic potential .",
    "to @xmath203 one reconstructs the potential from the electric field  call it @xmath204 .",
    "its value at @xmath203 is @xmath205 the logarithmic potential can be seen to be a degenerate form required for @xmath28 , where @xmath206 .",
    "the electric field corresponding to this potential is @xmath207 .",
    "this shows how @xmath204 approaches the logarithmic potential in the limit of small @xmath208 . ]",
    "introducing design radius @xmath12 and central field @xmath209 the electric field for @xmath4=0 is @xmath210 the electric potential @xmath19 , adjusted to vanish at @xmath22 was given earlier in eq .",
    "( [ eq : weakfoc.2 m ] ) . the independent ( longitudinal )",
    "coordinate @xmath14 is to be replaced by the angular coordinate @xmath13 @xmath211 following standard treatments of relativistic kepler orbits@xcite@xcite@xcite@xcite , we change dependent variable from @xmath212 ( with independent variable @xmath14 ) to a ( dimensionless ) dependent variable @xmath213 ( with independent variable @xmath13 ) ; @xmath214 note that @xmath200 is proportional to @xmath3 for small @xmath3 and that , notationally , @xmath215 and @xmath216 .",
    "the present discussion is limited to planar orbits , in which case the definition of @xmath3 by @xmath217 is the usual frenet - serret definition . for 3d motion",
    "this definition is not quite exact but realistic vertical amplitudes will always be small enough that the effect on @xmath3 of projection onto the horizontal plane will be neglected .",
    "the identity @xmath218 will be prominent in subsequent formulas .",
    "inverse relations are @xmath219 with @xmath200 regarded as a function of @xmath13 and @xmath3 as a function of @xmath14 , the abbreviations @xmath216 and @xmath220 have been used .    for simplicity in describing the approach to be taken",
    ", we temporarily specialize to the @xmath20=0 `` cylindrical '' case .",
    "the electric potential @xmath19 , adjusted to vanish on the design orbit , is @xmath221 the design parameters are related by @xmath222 where @xmath223 , @xmath224 , and @xmath137 are proton momentum , velocity , and @xmath225 .",
    "the momentum vector components are defined by @xmath226 the electric force alters only the radial momentum component @xmath227 for @xmath20=0 the invariance of the system to translation along the @xmath4-axis , causes @xmath228 to be conserved , and to invariance under rotation around the central axis , causes @xmath229 , the vertical component of angular momentum , to be conserved . for a particle in the horizontal plane containing the origin",
    "the angular momentum vector is @xmath230 the design orbit angular momentum is @xmath231 we seek the orbit differential equation giving dependent variable @xmath11 as a function of independent variable @xmath13 .",
    "the ( conserved ) total proton energy @xmath232 is the sum of the mechanical energy and the potential energy @xmath233 squaring this equation yields @xmath234 the terms on the right hand side of this equation can be expressed in terms of @xmath11 , @xmath235 , and conserved quantities . from eqs .",
    "( [ eq : cylinder.3p ] ) and ( [ eq : cylinder.4 ] ) , @xmath236 @xmath237 can be expressed similarly using eq .",
    "( [ eq : cylinder.3p ] ) ; @xmath238 making these substitutions yields @xmath239    when the field index @xmath20 was first introduced it was visualized as being a small number , just large enough ( and positive ) to produce some vertical focusing .",
    "but the subsequent analysis has not relied on @xmath20 being small .",
    "generalizing the previous formulas for arbitrary @xmath20 values , and expressing the in - plane momentum in terms of angular momentum @xmath229 , @xmath200 and @xmath240 , the mechanical ( total minus potential ) energy can be expressed in terms of particle mass and momentum components .",
    "this generalizes eq .",
    "( [ eq : cylinder.8 ] ) for arbitrary @xmath20 ; @xmath241 differentiating this equation with respect to @xmath13 , and simplifying , @xmath242 this equation can be reduced to quadratures but , the subsequent integral can not be performed analytically for non - integer @xmath20 values , and only with difficulty , if at all , for @xmath20 values other than 1 .",
    "[ [ specialization - to - m1-planar - orbits . ] ] * specialization to @xmath26 planar orbits . * + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    the formulas just obtained simplify spectacularly for @xmath20=1 .",
    "for example , the electric potential ( defined to vanish for @xmath243 ) is given by @xmath244 to obtain the orbit equation we can start from eq .",
    "( [ eq : weakfoc.4 ] ) , specialized to the spherical electrode geometry shown in fig .",
    "[ fig : sphericalelectrodes ] .",
    "( [ eq : weakfoc.4 ] ) becomes especially simple for motion in the @xmath245 plane with @xmath20=1 ; @xmath246 the last form implicitly defines abbreviations @xmath247 and @xmath248 .",
    "it also introduces a representation of transverse displacements as the superposition of a `` betatron '' part and an `` off - energy '' part",
    ".    it can hardly be over - emphasized how simple this equation of motion is .",
    "when expressed in terms of @xmath200 the motion is not only simple harmonic , it is simple harmonic for arbitrarily large oscillation amplitudes .",
    "the only reservation is that @xmath200 can not exceed 1 , at which point @xmath11=@xmath249 .    for our application",
    "the coefficient @xmath250 is positive , which means there is horizontal focusing with horizontal tune @xmath247 given by @xmath251 the off - energy central orbit is given by @xmath252 with @xmath229 and @xmath232 allowed to vary , ( especially in rf cavities , but _ not within electric bend elements _ ) the parameters @xmath247 and @xmath253 have to be regarded as locally , rather than globally , defined .",
    "it is important to notice though , that the parameters entering the definitions of both @xmath247 and @xmath248 are invariants of any given particle s motion .",
    "the quantities @xmath254 and @xmath255 are obviously invariant because they are properies of the on - energy central orbit .",
    "the quantities @xmath256 and @xmath257 are invariant by conservation of energy and angular momentum , but they are , in general , ( slightly ) different for different particles .    [",
    "[ particle - specific - transfer - matrices . ] ] * particle - specific transfer matrices .",
    "* + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    in practice there will be drift regions , quadrupoles , rf cavities and other apparatus in the ring , not to mention artificial thin quadrupoles inserted within the bend to compensate for actual field index differing from @xmath20=1 .",
    "( [ eq : weakfoc.5 ] ) will be applied only within individual sector bend elements .",
    "but the simplest possible application of the formulas has a single element bending through @xmath258which is to say , making up the whole ring .",
    "the @xmath3 motion described by linearized treatment is only sinusoidal for small amplitudes .",
    "but , since the denominator is a periodic function of @xmath13 , @xmath105 has the same period . for the frozen spin value @xmath259 , with orbits close enough to circular that @xmath260 , the tune is @xmath261 .",
    "( notice that the parameter @xmath27 and the muoz parameter @xmath18 are identical parameters . )    our equations , being fully relativistic , are valid in the nonrelativistic limit @xmath262 . in the nonrelativistic limit",
    "the orbits are simply keplerian planetary orbits , which are known to form closed ellipses , corresponding to @xmath247=1 .",
    "so one can say that the shift of @xmath247 away from 1 is a relativistic effect .",
    ", yielding , for fixed total energy , @xmath263 . )",
    "mercury s mean orbital velocity is 47.87km / s so @xmath264 and @xmath265 ; this represents a _ negative _ fractional _ advance _ of the perihelion each turn .",
    "( our electrostatic formulation amounts to accounting for the relativistic increase in inertial mass with no corresponding increase in gravitational attraction . ) since its orbital period of 0.241 years , mercury completes 100/0.241=415 revolutions in 100 years .",
    "meanwhile , its einsteinian general relativistic perihelion advance is 43 arc - sec .",
    "expressed as a fractional deviation per revolution , this is @xmath266 .",
    "it appears , therefore , that the perihelion advance is reduced by about 16% by the special relativistic inertial increase .",
    "this is roughly consistent with chandler@xcite . ]",
    "an orbit having initial vertical displacement or slope leaves the horizontal ( design ) plane .",
    "it nevertheless lies in a single plane , and its evolution is the same as if it were in the design plane . from this point of view @xmath267 . on the other hand ,",
    "if one insists on interpreting non - zero @xmath4 values as vertical betatron oscillations , the vertical tune is @xmath268 .",
    "this is an unusual example of `` tune aliasing '' .    for pure horizontal betatron oscillations @xmath269 for propagating the radial displacement @xmath270",
    ", one can introduce cosine - like trajectory @xmath271 satisfying @xmath272 , @xmath273 and sine - like trajectory @xmath274 satisfying @xmath275 , @xmath276 .",
    "they are given by @xmath277 for describing evolution of @xmath278 from its initial values @xmath279 at @xmath280 to its values at @xmath13 one can use the `` transfer matrix '' defined by @xmath281 where @xmath282 and @xmath283 , to give @xmath284 or , spelled out in inhomogeneous form , @xmath285 the subscript @xmath200 on @xmath286 and its components is to serve as a reminder that this matrix is particle - specific , and is therefore not a transfer matrix in the conventional , linearized , particle - independent , sense . in spite of appearing superficially to be linearized , @xmath286 describes nonlinear motion , and is exact for all amplitudes .",
    "( [ eq : full - sp.3p ] ) can be written more compactly as @xmath287    [ [ propagation - through - a - sector - bend ] ] * propagation through a sector bend * + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    starting from known coordinates @xmath288 just preceding the entrance to a sector bend , where the electric potential vanishes , one presumably knows @xmath232 and , therefore , @xmath289 ( in our hard edge approximation ) just past the entrance , @xmath3 , @xmath232 , and @xmath116 are unchanged , but the other dynamic variables have changed . in particular , using conservation of @xmath116 , @xmath290 this has determined @xmath291 .",
    "the last expression has been arranged to give not just the magnitude , but also the sign of @xmath292 .",
    "( the argument of the square root can never change sign . )",
    "notice that this calculation has included the ( very small , because of near - normal incidence ) `` refractive '' bending at the interface . using eq .",
    "( [ eq : weakfoc.2p ] ) , initial coordinates @xmath279 , just inside the sector bend can be obtained ; @xmath293 note also that @xmath229 , which is proportional to @xmath294 changes according to @xmath295 with both numerator and denominator known from earlier formulas . from eqs .",
    "( [ eq : weakfoc.6 ] ) and ( [ eq : weakfoc.7 ] ) it can be seen that @xmath229 is the only variable parameter in the definitions of @xmath27 and @xmath253 ; ( not counting changes in @xmath232 occurring in rf cavities ) . @xmath27 and",
    "@xmath253 can be updated accordingly . with the updated version of @xmath253 one",
    "can determine @xmath296 which is needed as an input for the bend element transfer matrix .",
    "from the known bend angle @xmath125 , cosine and sine factors @xmath297 and @xmath298 can be calculated , and all elements of transfer matrix @xmath286 determined .",
    "then , using eq .",
    "( [ eq : full - sp.3q ] ) , one obtains the components @xmath299 just before the exit from the sector bend .    to get out of the bend element the steps taken at the input have to be reversed .",
    "the treatment of orbits has been based on positions , slopes and momenta , with no need for velocities . to calculate time of flight , velocity is required .",
    "these calculations will proceed in parallel with the orbit calculations but they are described separately here to emphasize the essentially different evolution of position @xmath300 and @xmath301 , which is the arrival time ( expressed as a length ) relative to that of the central particle . with all quadrupoles and multipoles treated as thin in eteapot , the only contributions to time of flight come from drifts and electric bend elements .",
    "the only essential complication comes from the dependence of particle speed on position .    even apart from their different velocities , with all orbits very nearly parallel ,",
    "the path length is very nearly the same for all particles .",
    "yet synchrotron oscillation dynamics depend sensitively of their time of flight differences .",
    "furthermore , the main reason the spin coherence time sct can be long is the strong tendency for excess spin precession to cancel over complete synchrotron oscillation cycles . to the extent",
    "this cancellation depends nonlinearly on synchrotron amplitude the sct is impaired .",
    "these considerations make time of flight calculation difficult , yet important .",
    "as shown previously , in the @xmath26 muoz / pavic treatment the time of flight integrals can be evaluated exactly and in closed form .",
    "but the resulting formulas are quite complicated , and numerically treacherous , because they contain ( multiple - valued ) inverse tangents and cotangents .",
    "formulas are given in the eteapot user manual@xcite .    in the paraxial approach ( in spite of",
    "previously having been shown to be `` integrable '' for @xmath26 ) the time of flight integral can not be expressed in closed form .",
    "but , after power series expansion , the integrals are elementary .",
    "the resulting power series is so rapidly convergent that accuracy to machine precision is quick .",
    "we have found this approach more robust than the muoz pavic approach for analysing longitudinal motion .",
    "this formulation is described next .",
    "[ [ kinematic - variables - within - electric - bend - elements . ] ] * kinematic variables within electric bend elements .",
    "* + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    for the @xmath302 , inverse square law case being emphasized , the electric field and electric potential are given by eqs .",
    "( [ eq : weakfoc.1 m ] ) and ( [ eq : weakfoc.2 m ] ) ; @xmath303 the latter equation , along with eq .",
    "( [ eq : full - sp.3p ] ) , permits the potential energy to be expressed in terms of @xmath13 and initial conditions .",
    "@xmath304 then @xmath305 is obtained from @xmath306 from this formula one can obtain @xmath307 using @xmath308 from the @xmath4-component of eq .",
    "( [ eq : cylinder.4 ] ) we also have , for motion in the horizontal plane , @xmath309 * warning : * note that , with right - handed frenet coordinates , and clockwise orbit ( which we now assume ) @xmath229 is negative .",
    "this accounts for the negative sign in eq .",
    "( [ eq : kinematic.4 ] ) . the right hand side of this equation can now be expressed in terms of @xmath13 , invariants and initial conditions .",
    "the negative sign ( @xmath310 ) is specific to clockwise orbits , with @xmath13 increasing along the orbit .",
    "there seems to be no universally accepted sign convention distinguishing clockwise and counter - clockwise beam evolution in storage rings .",
    "this sign ambiguity causes the tracked time of flight variable @xmath311 to also be ambiguous .",
    "the appropriate rf phase is then , similarly , ambiguous .",
    "[ [ xi - evolution - and - convergence - estimates . ] ] * @xmath200 evolution and convergence estimates . * + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    using eq .",
    "( [ eq : weakfoc.2p ] ) , initial conditions @xmath312 have been expressed in terms of initial @xmath3 conditions ; @xmath313 the evolution of @xmath3 is obtained using eq .",
    "( [ eq : full - sp.3p ] ) , whose upper equation yields @xmath314 this formula can be used to give @xmath200 as a function of @xmath13 , for example when calculating times of flight",
    ". then @xmath315 for the proton edm experiment the value of radius @xmath12 will be , say , 40 m . an initial value @xmath316 m would be unrealistically large .",
    "it is better therefore to use centimeter units .",
    "then @xmath317 cm , and the initial displacement of a cosine - like trajectory is 1 cm . with the electrode spacing being 3 cm , a unit - amplitude",
    ", cosine - like trajectory happens to have something like a maximal amplitude .",
    "dropping terms of one higher order , for example from quadrupole order to sextupole order , therefore amounts to making an error of about one part in 4000 .",
    "an error of this magnitude is likely to be unimportant unless some resonance causes its repeated effect to accumulate constructively over many turns .",
    "[ [ time - of - flight - through - bends . ] ] * time of flight through bends . * + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    a formula for the time of flight has already been given in eq .",
    "( [ eq : revperiod.1 ] ) .",
    "since this form is integrable , it gives the exact flight time in closed analytic form .",
    "however it has the disadvantage that the angle @xmath17 ( which is the angle to `` perihelion '' ) is hard to determine unambiguously , because it is multiple - valued , and because perihelion is indeterminate for circular orbits .",
    "the most important circular orbit is the design central orbit and , depending on elements encountered in the ring , the local angle to perihelion can vary erratically .",
    "it is useful , therefore , to have an alternate , highly accurate , though not necessarily analytically exact , form , to accompany the muoz form developed earlier . from eq .",
    "( [ eq : kinematic.4 ] ) the time of flight @xmath318 , expressed as a distance @xmath319 is given by @xmath320 where @xmath321 note that the variable factor @xmath322 has been replaced using eq .",
    "( [ eq : weakfoc.2pp ] ) and that the parameters @xmath27 and @xmath248 , though invariant , are particle - dependent as in eqs .",
    "( [ eq : weakfoc.6 ] ) and ( [ eq : weakfoc.7 ] ) . ( the proliferation of `` /e '' factors is for convenience in converting electron - volts to mks energy units . )",
    "formula  ( [ eq : timeofflight.1 ] ) can be checked on the design orbit where @xmath243 , using @xmath323 ; @xmath324 which is correct .",
    "the time of flight through an element with angle @xmath125 is given by @xmath325 ( where , for clockwise motion , @xmath310 is positive ) . over the corresponding sector",
    "the time of flight of the design particle is @xmath326 the increment in time relative to the design particle is @xmath327 the integrand can be expanded in a series in @xmath200 ; @xmath328 where @xmath329 all the required integrals ( over the range from 0 to @xmath125 , which is the bend angle ) are elementary  the integrands are integer powers of @xmath330 or @xmath331 , and the series in eq .",
    "( [ eq : timeofflight.3s ] ) is rapidly convergent .",
    "it is important to remember that quantities , in this case @xmath229 , which are discontinuous in the transition from just outside to just inside a bend element , have to be updated to the value _ inside _ before evaluating these @xmath332 coefficients .",
    "because @xmath333 is necessarily positive while @xmath200 can have either sign , the `` quadratic '' term proportional to @xmath333 may compete with the preceding `` linear '' term proportional to @xmath200 , which can have either sign and will tend to cancel on the average . as has been stated repeatedly , since the coefficients are particle - dependent , this formula has to be performed individually for every particle at every bend ,    [ [ time - of - flight - through - straight - sections . ] ] * time of flight through straight sections . * + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    different particles also have different flight times through drift sections or multipole elements of length @xmath334 .",
    "the path length excess is approximately @xmath335 and the off - speed correction is @xmath336 the total effect is @xmath337 or , more directly , @xmath338    [ [ time - of - flight - due - to - vertical - oscillation . ] ] * time of flight due to vertical oscillation . * + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    for bends only the projection of the orbit onto the horizontal plane has been found so far . it remains to evaluate the time of flight ascribable to vertical betatron motion .",
    "we assume there is no direct coupling between @xmath3 and @xmath4 .",
    "we also neglect the effect of the small speed variations accompanying horizontal oscillations . also neglecting the small bending in sufficiently - finely sliced bend elements ,",
    "we treat them as straight . with these approximations",
    "the bend element is treated as a drift as far as vertical oscillations are concerned .",
    "the off - velocity effect has already been included in the horizontal calculation .",
    "copying from eq .",
    "( [ eq : timeofflight.8 ] ) , @xmath339",
    "analytic propagation formulas have been given for @xmath110 radial dependence of the electric field .",
    "the actual radial dependence will deviate from this , with @xmath20 , the deviant field index , having been defined in eq .",
    "( [ eq : weakfoc.1 m ] ) .",
    "@xmath340 , so @xmath26 for the coulomb s law field dependence . for this , the `` spherical '' case , the orbit equations have been solved in closed form .",
    "the eteapot strategy , even for @xmath341 , is to treat sector bends as _ thick _ elements with orbits given by the analytic @xmath26 formulas .",
    "the @xmath341 case is handled by inserting zero thickness `` artificial quadrupoles '' of appropriate strength .",
    "as with teapot , this approximation becomes arbitrarily good in the thin slicing limit .",
    "though the idealized model differs from the physical apparatus , the orbit description within the idealized model is exact , and hence symplectic . for too coarse slicing ,",
    "even though the orbit deviates from the `` true '' orbit , it remains `` exact '' ( for a lattice with that slicing ) .",
    "one blames the inaccuracy on the fact that the lattice model deviates from the true lattice , not on the fact that the equations are being solved approximately . by varying",
    "the slicing one can judge from the limiting behavior what degree of slicing is appropriate .    in a magnetic fields",
    "there is `` geometric '' horizontal focusing even in a uniform field .",
    "( for example a cyclotron orbit with non - vanishing initial slope returns to its starting point after one full turn  its horizontal tune therefore being 1.0 . ) a deviant field index @xmath20 introduces further horizontal and vertical focusing terms of equal magnitude , but of opposite sign , into the focusing equations    the corresponding focusing strength coefficients in electric fields are@xcite @xmath342 note that for @xmath28 ( the `` cylindrical '' case ) there is no vertical focusing . with the electric field being independent of @xmath4 for cylindrical electrodes , this is obviously correct .",
    "( the subscript `` 1 '' indicates `` quadrupole '' order ; a more careful treatment brings in higher order corrections . )",
    "the parentheses segregate the geometric focusing ( which is independent of @xmath20 ) from the gradient focusing ( which vanishes for @xmath343 field variation ) .",
    "re - writing these equations for our spherical @xmath26 case ; @xmath344 with our sign convention , positive @xmath345-value corresponds to _ focusing_. hence , for example , there is already `` one unit '' ( in units of @xmath346 ) of vertical _ focusing _ in the coulomb case . in the eteapot formalism the focusing given by eqs .",
    "( [ eq : lumped.2p ] ) is already implicitly included since the particle orbits are being tracked exactly .    for modeling the focusing for @xmath20 values other than @xmath20=1 the focusing coefficients we need",
    "are given by eqs .",
    "( [ eq : lumped.2 ] ) .",
    "the geometric focusing terms already match but we have to make up the differences in gradient focusing : @xmath347 these are the coefficients of the distributed focusing we have to apply to `` convert '' the coulomb formulas to model the actual @xmath20 value .",
    "the pure @xmath20=1 coulomb field itself provides `` one unit '' of vertical focusing .",
    "the strengths of the quads we insert artificially are therefore the sum of two terms ; one cancels the coulomb defocusing handled by the eteapot formalism ; the other superimposes focusing proportional to @xmath20 , equal but opposite horizontal and vertical .",
    "the artificial quadrupoles have zero length , but their length - strength product has to be matched to the `` field integral '' corresponding to length @xmath348 of the bending slice being compensated .    before continuing with the treatment for @xmath349",
    "it is important to remember the discontinuous increments to @xmath232 as a particle enters or leaves a bending element .",
    "the discontinuity is equal ( in magnitude ) to the change in potential energy . when correcting the focusing by artificial quadrupoles we have to decide whether the artificial quadrupoles are `` inside '' or `` outside '' , since the actual deflections will be different in the two cases .",
    "since the difference is quadratic in transverse displacement , the difference would be called a `` sextupole '' effect . by treating the artificial quad as `` inside '' , which we do ( because we decline to include longitudinal drift at zero potential ) ,",
    "we avoid introducing an artificial sextupole effect .",
    "whatever criteria for slicing quadrupoles that have been used for magnetic rings , the same criteria apply here .",
    "the default slicing in eteapot treats a thick bend as a half bend , a single kick at the center , and then another half bend .",
    "for example , with @xmath350 , the central quad is vertically defocusing with inverse focal length @xmath351 , where @xmath334 is the arc length through the full bend .    numerically , with @xmath352 m and @xmath334 equal to , say , @xmath353 m ,",
    "the ratio of focal length to element length is @xmath354 . with",
    "element length small compared to focal length , this suggests that the compensation will be fairly good even with such coarse slicing . the entire edm ring , with its 8 full cells ,",
    "would then be represented by 16 half - bends . in practice one",
    "will probably choose less coarse slicing .",
    "the transfer matrices for the thin effective quadrupole are @xmath355 for @xmath26 these kick matrices reduce to identity matrices .    with linearized evolution through half bend",
    "formally represented by `` transfer matrix '' @xmath356 , bend / kick / bend evolution through bend angle @xmath125 in an element with field index @xmath20 is then described by the matrix @xmath357",
    "[ [ spin - tracking - through - thick - elements . ] ] * spin tracking through thick elements . *",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    the second main new feature implemented in eteapot is spin evolution . to leading",
    "approximation spin precession occurs in central force , inverse square law , force field regions .",
    "with this assumption the orbit through a bend element of any individual particle lies in a single fixed plane .",
    "to lowest approximation hard edge bends are assumed , though a refractive deflection accompanying the change in electric potential is included . to a next approximation the fringe field electric potential is represented as a linear ramp . in this region , because the particle speed is necessarily non - magic , there is a noticeable difference in precession rates of spin and momentum .",
    "furthermore the precession error at entrance and exit add constructively .",
    "it is assumed that the paths through the entrance and exit fringe fields lie in the same plane as in the bend interior .",
    "quadrupoles , whether real or artificial ( as well as all other multipoles ) are treated as thin .",
    "this includes the approximation that the electric potential is independent of position , both transversely and longitudinally in the element .",
    "because the element thickness is treated as zero , there is no further time of flight error caused by the neglect of speed changes as the particle passes through the multipole .",
    "superimposed multipoles are therefore _ exactly _ superimposed which means that spin precession are modeled by successive rotations , with no dependence on the order in which they are applied .",
    "all such spin rotations are concatenated explicitly into a single ( near - identity ) precession matrix . for improved numerical precision",
    "all such concatenations are performed analytically and the result expressed as the exact sum of an identity matrix and a deviation matrix .",
    "this circumvents the problem of large , approximately canceling precessions and avoids spurious non - commutative geometric precessions .",
    "laboratory frame spin components are @xmath360 .",
    "bend frame spin components @xmath361 , are illustrated on the left in figure  [ fig : precess ] , which projects the spin vector onto the bend plane .",
    "@xmath362 as with the orbit equation , the bmt equation is exactly solvable only because the orbit stays in a single bend plane . for particles in realistic beams",
    "this is very nearly , but not exactly , the local @xmath363 central design plane .     (",
    "a ) in the bend plane the spin vector @xmath364 has precessed through angle @xmath365 away from its nominal direction along the proton s velocity .",
    "( remember that different particles have different bend planes . )",
    "( b ) projection of figure  ( a ) onto the laboratory horizontal plane .",
    "the projected longitudinal axis is shown coinciding with the laboratory longitudinal axis , even if this is not exactly valid .",
    "@xmath3 is the deviation of the ( bold face ) particle orbit from the ( pale face ) design orbit . if the bend plane coincides with the design bend plane ( as is always approximately the case ) @xmath366 and @xmath367 are identical",
    "@xmath13 is the reference particle deviation angle from longitudinal and @xmath368 is the tracked particle deviation angle from longitudinal . on the average @xmath13 and @xmath368 are the same , but betatron oscillations cause them to differ on a turn by turn basis , and also to make the instantaneous bend plane not quite horizontal . ]",
    "[ [ transforming - spin - components - from - lab - frame - to - bend - frame - and - back - again . ] ] * transforming spin components from lab frame to bend frame ( and back again ) . *",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    from orbit tracking to some current location in the ring one knows the laboratory frame position , @xmath369 , and momentum , * p * , and hence the angular momentum @xmath370 .",
    "one also knows the spin vector @xmath364 ; @xmath371 all of these quantities refer to a point infinitesimally past the bend entrance , after refractive correction , but not yet having included any entrance fringe field effect .",
    "any spin precession in the interior ( including fringe fields ) of a bend element occurs in a single bend plane . to exploit this reduction from 3d",
    "to 2d it is first necessary to obtain the spin components in an orthonormal frame having its `` y '' axis perpendicular to the plane and its `` z '' coordinate tangential to the orbit .",
    "the purpose of this section is to document this transformation . in the ( always excellent ) paraxial approximation , and for near - magic particle velocity , this transformation will be close to identity .",
    "we can establish an orthonormal , right - handed basis triad with axis  3 parallel to @xmath372 and axis  2 parallel to @xmath373 ( where the negative sign is appropriate for clockwise orbits ) ; @xmath374 these equations can be re - expressed formally , with all coefficients known , as @xmath375 the vector @xmath364 can be expanded as @xmath376 the final relation can be expressed in matrix form as @xmath377 where @xmath378 is an orthogonal matrix , @xmath379 ( aside : the magnitude @xmath380 of the determinant of @xmath378 is necessarily 1 , but the actual value is @xmath381 .",
    "this sign correlates with the clockwise / counterclockwise orbit ambiguity . )    because @xmath378 is orthogonal , @xmath382 and eq .",
    "( [ eq : spinrot.5 ] ) can be inverted to give @xmath383 this yields the spin components in the bend frame .",
    "their propagation through the bend is described below .",
    "after the bend plane spin components have been updated at the output of the bend element it is necessary to transform them back to the ( local ) laboratory frame .",
    "this entails repeating the preceeding formulas starting with eqs  ( [ eq : spinrot.1 ] ) , but with @xmath369 , @xmath372 and @xmath384 having been evaluated ( in local laboratory coordinates ) just inside the output face of the bend element . in other words",
    "all of the quantities in eqs  ( [ eq : spinrot.1 ] ) will now refer to a point just before the bend exit .",
    "then , following eqs.([eq : spinrot.2 ] ) through ( [ eq : spinrot.6 ] ) produces rotation matrix @xmath378 which is now applicable at the bend output . finally , modifying eq .",
    "( [ eq : spinrot.7 ] ) appropriately , the transformation back to laboratory components        we introduce , at least temporarily , the term ` ' inverse square law bend  to characterize a bend having field index @xmath26 , which is the case being treated in our 2d formalism . in this case",
    "the orbit stays in a single plane .",
    "also , in this frame any precession of the spin is purely around an axis normal to the plane . obtaining the initial values of the spin components in this frame",
    "was described in the previous section .    in the bend plane",
    "the orbit lies in a single plane .",
    "superficially this may suggest we are accounting only for horizontal betatron oscillations and neglecting vertical betatron oscillations .",
    "in fact , however , the eteapot treatment accounts for arbitrary betatron and synchrotron motion by assigning different `` wobbling planes '' to each individual particle . even allowing for vertical betatron motion",
    "these frames are all very nearly parallel to the global horizontal design frame of the ring . for",
    "the 2d evolution through electric bend elements in eteapot , any betatron oscillations actually present for a particular particle are folded into the determination of its particle - specific orbit plane , and the initial coordinates in this plane .",
    "as shown in figure  [ fig : precess ] , the initial spin vector is @xmath386 here @xmath387 is the out - of - plane component of @xmath388 , @xmath389 is the magnitude of the in - plane projection of @xmath388 , and @xmath390 is the angle between the projection of @xmath388 onto the plane and the tangent vector to the orbit .",
    "jacksons@xcite eq .",
    "( 11.171 ) gives the rate of change in an electric field @xmath391 , of the longitudinal spin component as @xmath392 ( note that jackson s @xmath393 is the component perpendicular to the tangent to the orbit _ not _ to the orbit plane . ) substituting from eq .",
    "( [ eq : spinprecess.9 ] ) the equation becomes @xmath394 with the orbit confined to a plane , any precession occurs about the normal to the plane , conserving @xmath395 . since the magnitude of @xmath388",
    "is conserved it follows that the magnitude @xmath389 is also conserved .",
    "this allows @xmath389 to be treated as constant in eq .",
    "( [ eq : spinprecess.1mp ] ) .",
    "then eq .",
    "( [ eq : spinprecess.1mp ] ) reduces to @xmath396 this is undoubtedly a fairly good approximate equation in any more - or - less constant electric field , but it is _ exact only for the @xmath26 keplerian electric field _ , which is the only field in which each orbit stays in its own fixed bend plane .",
    "in fact , the derivation is not quite valid even for our @xmath26 case  though the design orbit is circular , the betatron orbits are slightly elliptical .",
    "this violates our assumption that orbit and electric field are exactly orthogonal . neglecting this error",
    "amounts to dropping a term from the rhs of eq .",
    "( [ eq : spinprecess.1 ] ) .",
    "this term is down by four orders of magnitude compared to the calculated value .",
    "furthermore this term would average to zero ( over many betatron cycles ) except for a possible non - zero ( quadratic in bend angle ) commutation geometric phase error .",
    "such an error would be expected to be down by another four orders of magnitude .",
    "furthermore , the importance of this `` error '' can be investigated , and reduced , by finer slicing of the bend element .",
    "meanwhile the velocity vector itself has precessed by angle @xmath368 relative to a direction fixed in the laboratory . note",
    "that this angle @xmath368 , the angle of the individual particle s orbit is approximately , but not exactly equal to the angle @xmath13 of the design orbit .    in the eteapot treatment",
    "each particle in an electric bend element evolves in its own bend plane .",
    "@xmath397 is the component in this plane of the total spin vector . at every entrance to an electic bend",
    "@xmath397 has to be calculated from the known laboratory frame description of @xmath364 , which also has to be updated as the particle exits the bend .",
    "( ideally , in an edm storage ring experiment any out - of - plane component of @xmath364 would be evidence of non - vanishing electric dipole moment . )    the precession rate of @xmath368 is governed by the equation @xmath398 where the curvature is @xmath399 and ( just in this equation ) @xmath14 temporarily stands for arc length along the orbit .",
    "dividing eq .",
    "( [ eq : spinprecess.2 ] ) by eq .  ( [ eq : spinprecess.3 ] ) and using @xmath400 , @xmath401 in this step we have also surrepticiously made the replacement @xmath402 .",
    "though these angles are not the same , over arbitrarily long times they necessarily advance at the same rate . in any case the error in equating @xmath368 to @xmath13 becomes progressively more valid in the fine - slicing limit , as the orbit is more nearly approximated by straight line segments .",
    "explicitly the bend frame precession advance is the sum of two definite integrals @xmath403 where @xmath404 to account for fringe fields two more terms , @xmath405 and @xmath406 , will later be added directly to the right hand side of eq .",
    "( [ eq : spinprecess.4p ] ) .",
    "this treatment makes the less - than - perfect assumption that the precession axes in the fringe fields are normal to the bend plane , which makes it valid to simply sum the bend field and fringe field precessions .",
    "so far , as a particle enters or exits a bend element , its potential energy has been treated as changing discontinuously with its kinetic energy changing correspondingly . for spin tracking , because there is significant excess spin precession in fringe fields we have to treat this region more carefully . instead of treating the potential as discontinuous",
    ", we now assume the change occurs over a longitudinal distance @xmath407 which , for estimation purposes , we take equal to the separation distance ( symbol @xmath408 ) between the electrodes ; @xmath409 .",
    "( for the `` protonium '' model , introduced later for comparison with with analytic sct calculations , the drift lengths are taken to be negligably small , making the fringe field spin precession negligible . ) for orbit tracking the fringe field region is assumed to be short enough to be treated as `` thin '' .",
    "that is , any change in the particle s radial offset occuring in range @xmath407 is to be neglected and the integrated deflection applied at the center ( i.e. the edge of the bend ) . as a result",
    "the curve @xmath410 is continuous , but its slope @xmath411 is discontinuous .",
    "entrance transitions from outside a bend to inside are described first .    inside the bending element the increase in potential energy from orbit centerline to radial position @xmath3 is @xmath412 . as synchroton oscillations move the particle radially in and out , the sign of @xmath413 , just inside the bend edge oscillates between negative and positive values , and the sign of the deviation from the magic velocity oscillates correspondingly .",
    "this will tend to average away the spin run - out occurring in the fringe field region over times long compared to the synchrotron period . in the long run it is the deviation from zero of this average that has to be determined .",
    "this can be done by pure numerical tracking or theoretically or , possibly , by a theoretically - weighted averaging of the numerical tracking data .",
    "once one is able to determine the spin decoherence the task will shift to designing sextupole distributions capable of increasing the spin coherence time sct .",
    "our approach will be to study the effectiveness of such schemes before attempting to improve the precision of our fringe field treatment .",
    "the deflection angle @xmath414 of the design orbit in the fringe field at one such edge is approximately @xmath415 this is half of the deflection occurring in advancing a distance @xmath408 in the interior of the bend .",
    "( the angle @xmath414 is implicitly assumed to be positive , irrespective of whether the orbit is clockwise or counter - clockwise . ) consider a particle approaching the fringe field region at radial displacement @xmath3 .",
    "at the longitudinal center of the fringe field region the kinetic energy of this particle deviates from its `` proper '' ( i.e. fully - inside value at radial displacement @xmath3 ) by the amount @xmath416 where @xmath417 is the total voltage increase from inner electrode to outer electrode .",
    "( the electric field points radially inward in order for positive particles to bend toward negative @xmath3 but , by convention , @xmath418 is positive . ) here , for simplicity , we are neglecting the fact that the actual electric field will have more complicated @xmath3-dependence depending , for example , on the value of the field index @xmath20 .",
    "our assumed fringe field spatial dependence is also simplistic .",
    "the leading effect of passage through a bend region with @xmath7 deviation from magic @xmath419 , is a rate of change of spin angle @xmath420 per unit deflection angle @xmath13 given by @xmath421 combining equations , the excess angular advance occurring while entering the bend at displacement @xmath3 is @xmath422 ( * aside : * it may be appropriate to keep another term in expansion  ( [ eq : ffsinglepass.1 ] ) in order to include the fact that dispersion introduces a correlation between @xmath7 and @xmath3 which , after averaging , leaves a finite precession , even if @xmath423 vanishes in eq .",
    "( [ eq : ffsinglepass.1p ] ) . )    in our initial treatment of this edge effect we are assuming this precession lies in exactly the same plane as the orbit plane of the particle in the bend element , justifying the notation @xmath424 entrance ( and , later , exit ) values can then simply be added to the main precession through the bend element . meanwhile , in the fringe field region the advance of the tangent to the orbit is @xmath414 as given by eq .",
    "( [ eq : ff.1 ] ) . the + sign on the rhs of eq .",
    "( [ eq : ffsinglepass.1p ] ) reflects the fact that , for a particle displaced radially outward , the particle momentum is completing some of its rotation in the fringe field where its magnitude is more positive than in the bend interior .    though the fringe field precession occurs continuously over the range @xmath408 it is applied discontinuously at the bend edge",
    "this is consistent with our hard edge treatment of the particle s momentum evolution . because @xmath425 is measured relative to the orbit direction , eq .",
    "( [ eq : ffsinglepass.1p ] ) gives the spin angle precession over and above the advance of the tangent to the orbit .",
    "the fact that spin and momentum angular advances do not match has come about because the particle has bent appreciably while its speed deviates from the magic value .",
    "on exiting the bend element the particle bends similarly while its @xmath7 deviation is given by the same formula  ( [ eq : ff.2 ] ) .",
    "( [ eq : ffsinglepass.1p ] ) therefore applies to both entrance and exit .",
    "unfortunately this means that excess input precession and excess output precession combine constructively rather than tending to cancel ( as edge focusing commonly does . )",
    "the largest magnitude @xmath426 can have is @xmath427 for a particle with magic velocity skimming the outer electrode , where the effect is maximum , the angular runout is given by @xmath428 with perhaps 50 edges in the lattice , and revolution frequency of about 1mhz , the maximum spin runout will be about one revolution per second .",
    "this vastly exaggerates the spin decoherence , of course , because it does not account for the averaging effect of synchrotron oscillations .",
    "a challenge for lattice design is to perfect the synchrotron oscillation averaging to zero .      most of the elements in a storage ring cause spin precession which approximately conserves the vertical component of spin @xmath429 .",
    "the leading exceptions to this in a proton edm storage rings are the quadrupoles ( either focusing or defocusing ) present in the lattice to keep @xmath430 much smaller than @xmath431 .",
    "particles having non - vanishing vertical betatron amplitude are deflected vertically which causes @xmath429 to precess .",
    "there is a very strong tendency for this precession to cancel in subsequent quadrupoles and , therefore , probably not contribute significantly to spin decoherence .",
    "nevertheless it is essential for this precession to be modeled correctly to avoid spurious edm - mimicking precession .",
    "all quadrupoles and sextupoles in the lattice cause similar precession to at least some degree .    in eteapot",
    "the only thick elements are bends and drifts .",
    "spin evolution through them has already been discussed .",
    "all other elements are treated as thin element ( position dependent ) kicks .",
    "copying from the treatment in bends , spin evolution through a thin element is described by @xmath432 where the deflection@xmath433 is ( for now ) defined to be positive and @xmath434 is the resulting angular deviation of the `` bend '' plane spin coordinate relative to the orbit ; here `` bend '' is in quotes to emphasize the fact that the bend plane is not , in general , horizontal . by far the most important instance of this is the deflection of vertically offset orbits in lattice quadrupoles . for a particle with transverse position @xmath363 , the magnitude of the angular deviation @xmath433 in a quadrupole of strength @xmath435",
    "is given by @xmath436 where @xmath435 is the inverse focal length of the quadrupole .",
    "the absolute value sign in this equation eventually has to be removed ; it is included here so that the discussion of signs can be deferred .",
    "the magnitude of the angular deflections in sextupoles and higher order multipoles are also functions only of the combination @xmath437 .",
    "( [ eq : thinel.1p ] ) generalizes to @xmath438 where @xmath298 is the conventionally defined sextupole strength and @xmath439 is the conventionally defined octupole strength . , the sextupole parameter is @xmath440 , the octupole parameter is @xmath441 , and so on . ]",
    "a significant complication concerns the sign of @xmath434 . for a particle with no vertical displacement",
    "there is no ambiguity , since the bend plane in the quadrupole is the same as the overall ( horizontal ) lattice design plane . in this case , with @xmath245 , eq .",
    "( [ eq : thinel.1 m ] ) can be made more explicit ; @xmath442 where , by convention , a horizontal _ focusing _ quad has @xmath443 . the sign in eq .",
    "( [ eq : thinel.1q ] ) reflects the fact that , for @xmath444 and @xmath443 , the quadrupole `` helps '' by bending the momentum in the same sense as the bending elements .",
    "this formula makes it clear that reversing the sign of @xmath435 reverses the sign of @xmath434 .    for obtaining the proper sign for general multipoles",
    "it is necessary to handle consistently the transformation from laboratory to bend frame spin coordinates , which is why the sign issue has been deferred .    for a particle incident at @xmath445",
    "the equation of the line of intersection of the deflection plane with the transverse plane is @xmath446 in a quadrupole the roll - angle of the deflection plane ( with counter - clockwise roll taken as positive ) is @xmath447 , irrespective of quadrant and whether the quadrupole is focusing or defocusing .",
    "however the inverse tangent function is , itself , multiple valued . to make it single valued one can determine @xmath448 using @xmath449 .",
    "along with eq .",
    "( [ eq : thinel.1 m ] ) , this establishes both the sign and magnitude of @xmath434 , while preserving the sign reversal when the sign of @xmath435 reverses . including also sextupoles , octupoles and other multipoles , one obtains @xmath450 with roll angles of the bend plane determined this way",
    ", the following formulas apply to all multipoles .",
    "the required spin rotation matrix is @xmath451 to avoid serious loss of numerical precision , it is essential to use trigonometric identities to express the matrix product exactly and explicitly in this way .",
    "this utilizes the fact that the dominant , identity matrix part of the central matrix commutes with the outer matrices , whose product is @xmath452 .",
    "the remaining , exact matrix elements are are explicitly small .",
    "@xmath453 since the common factor @xmath454 is tiny , all matrix elements are small even for angles @xmath189 of order @xmath455 . multiplying this matrix on the right by @xmath456 produces deviations @xmath457",
    "which , added to @xmath360 , give the output spin coordinates ."
  ],
  "abstract_text": [
    "<S> proposed methods for measuring the electric dipole moment ( edm ) of the proton use an intense , polarized proton beam stored in an all - electric storage ring `` trap '' . at the `` magic '' kinetic energy of 232.792 mev , proton spins are `` frozen '' , for example always parallel to the instantaneous particle momentum . </S>",
    "<S> energy deviation from the magic value causes _ in - plane _ precession of the spin relative to the momentum . </S>",
    "<S> any non - zero edm value will cause _ out - of - plane _ precession  measuring this precession is the basis for the edm determination . </S>",
    "<S> a proposed implementation of this measurement shows that a proton edm value of @xmath0e - cm or greater will produce a statistically - significant , measurable precession after multiply - repeated runs , assuming small beam depolarization during 1000 second runs@xcite , with high enough precision to test models of the early universe developed to account for the present day particle / anti - particle population imbalance .    </S>",
    "<S> this paper describes an accelerator simulation code , eteapot , a new component of the unified accelerator libraries ( ual ) , to be used for long term tracking of particle orbits and spins in electric bend accelerators , in order to simulate edm storage ring experiments . </S>",
    "<S> though qualitatively much like magnetic rings , the non - constant particle velocity in electric rings give them significantly different properties , especially in weak focusing rings . like the earlier code teapot ( for magnetic ring simulation ) </S>",
    "<S> this code performs _ exact tracking in an idealized ( approximate ) lattice _ rather than the more conventional approach , which is _ approximate tracking in a more nearly exact lattice . </S>",
    "<S> _ the bmt equation describing the evolution of spin vectors through idealized bend elements is also solved exactly  original to this paper . </S>",
    "<S> furthermore the idealization permits the code to be exactly symplectic ( with no artificial `` symplectification '' ) . </S>",
    "<S> any residual spurious damping or anti - damping is sufficiently small to permit reliable tracking for the long times , such as the 1000 seconds assumed in estimating the achievable edm precision .    </S>",
    "<S> this paper documents in detail the theoretical formulation implemented in eteapot . </S>",
    "<S> the accompanying paper@xcite `` edm planning using eteapot with a resurrected ags electron analogue ring '' describes the practical application of the eteapot code in the ual environment to `` resurrect '' , or reverse - engineer , the `` ags - analogue '' all - electric ring built at brookhaven national laboratory in 1954 . </S>",
    "<S> of the ( very few ) all - electric rings ever commissioned , the ags - analogue ring is the only relativistic one and is the closest to what is needed for measuring proton ( or , even more so , electron ) edm s . </S>",
    "<S> that paper also describes preliminary lattice studies for the planned proton edm storage rings as well as testing the code against analytic calculations . </S>"
  ]
}