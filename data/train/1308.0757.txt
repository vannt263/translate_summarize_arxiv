{
  "article_text": [
    "chemical abundance determination from stellar spectra is largely achieved in one of two ways : synthetic spectra matching or measurement of the equivalent widths of important spectral features .",
    "the calculation of synthetic spectra is complicated due to the physics that goes into the models , from the simplest set of atmospheric parameters to the much more complicated considerations required for effects such as non - local thermodynamic equilibrium .",
    "thus , it is difficult to make direct comparisons between studies , not only due to the different methods of dealing with the physics of stellar atmospheres , but also the inclusion or exclusion of various features ( e.g. , sources of broadening , non - local thermodynamic equilibrium treatments ) that can contribute to the formation and shape of a spectral line .    the alternative to this synthesis is to measure the equivalent width of a set of lines .",
    "the equivalent width is a geometric measure that describes the total flux of a line as a rectangle with the same area as the line . by requiring the rectangle to have the height of the normalized continuum",
    ", the width directly corresponds to the line flux .",
    "the equivalent width can be measured without any prior knowledge of an object or consideration for what input physics will be included in the analysis . however",
    ", once the equivalent width is measured , further analysis with that information will then generally require the same considerations for physics included in the models used for spectral synthesis .",
    "we have written a new equivalent width fitting program , robospect , to provide a consistent way to measure spectral line strengths . by automating these measurements ,",
    "the data from current and future large - scale studies can be quickly processed without concern about changes in fit quality due to individual , manual measurements .",
    "robospect is designed to be modular and open source , using freely available software and library packages , to enable users to quickly adapt the code to their data requirements .",
    "although robospect was originally designed for the study of absorption lines in stellar spectra , the algorithms are general enough to allow it to be used to measure the equivalent widths of lines from emission spectra .",
    "emission lines formed in rarefied gas can be used as diagnostics for temperature , metallicity , density , and ionization structure in astrophysical objects such as planetary nebulae ( e.g.  @xcite ) , active galactic nuclei ( e.g.  @xcite , and hii regions ( e.g.  @xcite ) . in many instances ,",
    "the useful value is not the equivalent width , but rather the total line flux ; however , this is simply a mathematical conversion .    in this paper , we describe robospect , an automated equivalent width measurement program for absorption and emission lines . in section  [ algorithms ] , we outline the fitting algorithm that determines the equivalent widths .",
    "we detail the accuracy and performance of robospect on simulated and real data in section  [ accuracy ] . in section  [ opp ] , we discuss the features of some other publicly available equivalent width measurement programs and summarize our results in section  [ conclusions ] .",
    "the goal of robospect is to generate an accurate model fit to an input spectrum , with a minimum of user interaction .",
    "this helps ensure that all fits are performed identically , regardless of the user or their `` personal fitting equation '' .",
    "to that end , robospect constructs automated fits , with the addition of only a small number of user - defined parameters that control the methods used in fitting . in addition , robospect returns a set of flags for each fit performed , to allow the user to note any quality issues , allowing poorly fit lines to be identified largely from the resulting line catalog .",
    "figure [ fig : flowcharta ] presents a diagram of the program structure to illustrate the order in which spectrum components are measured .",
    "the only required input to robospect is a fits or ascii spectrum file , listing the flux at each wavelength .",
    "uncertainties in the fluxes can be supplied as well , but are not used in the fitting process , as they tend to over - constrain the fits ( see below ) .",
    "multi - order spectra are supported , with each order fit independently .",
    "this prevents discontinuities between the orders of a combined spectrum from inducing errors in the continuum model .",
    "this also allows orders that overlap in wavelength space , such as those obtained with an echelle spectrograph like the high resolution spectrograph on the hobby - eberly telescope , to be fit without merging the spectra .",
    "a linelist of known lines that should be fit can also be specified , providing the expected line center .",
    "these specified lines will always have a line fit attempted , even if there is no obvious feature in the spectrum .",
    "this forced measurement method allows a consistent set of lines to be measured across a large number of spectra , yielding upper limits if the presence of an individual line is not obvious .",
    "robospect models spectra based on the assumption that all spectra are comprised of three components : the continuum level , @xmath0 , the line solution relative to that continuum @xmath1 , and an error component @xmath2 that contains the deviation between the true spectrum and the current model . by iterating the fitting of these components",
    ", we can ensure that the line and continuum solutions are not biased by the other .",
    "these components are combined in different ways to measure line strengths , depending on the type of spectrum to be fit . for a continuum normalized spectrum ( where the mean input continuum is nearly unity ) , we assume that any low spatial frequency deviations from unity are due to a poor normalization correction , and high spatial frequency deviations are a combination of unknown and unfit lines and the @xmath2 component . in this case , we construct a model of the final spectrum,@xmath3 ) , as :    @xmath4    this relation ensures that in a spectrum with the continuum normalization perfectly performed , the line model and noise add directly to modulate the spectrum around unity .",
    "the measured continuum is assumed to represent imperfect normalization , and so is multiplied to the expected final spectrum .",
    "figure [ fig : cartoonnormalized ] demonstrates an example of how these components combine to form the observed spectrum .    using this spectrum model",
    ", we can solve equation 1 for the continuum component , by letting the input spectrum be the expected final spectrum solution .",
    "we can then remove the lines from the data , based on previous iterations of the fitting routine . for the initial iteration",
    ", we have no knowledge of the correct line solution , and so expect the continuum level to be slightly biased by strong lines .",
    "however , as further iterations are performed , this bias decreases , improving the continuum solution .",
    "we ignore the error component when measuring the continuum .",
    "as the errors should cause deviations in both directions from the true continuum , they should therefore not bias the result . by subtracting the current line model from the input spectrum",
    ", we assume that we are simply left with the continuum structure ( modulated by the unknown error component ) . for a continuum normalized spectrum , we must first rescale the individual line measurements to match the possibly imperfect input spectrum continuum normalization :    @xmath5    the function @xmath6 denotes some smoothing operation that returns the continuum model , given the input of a spectrum with all lines removed .",
    "robospect defaults to a simple median boxcar filter for @xmath6 , which can generally fit continuum models that are smooth and do not have discontinuities .",
    "other continuum smoothing functions are supported , including a spline - based method that can be used when the spectrum does have known discontinuities , such as those due to the combination of echelle orders into a single spectrum .",
    "functional models , such as a blackbody or power - law model , can also be chosen for @xmath6 , in which a known analytic function is fit to the line - subtracted spectrum .    with the continuum modeled",
    ", we can start to investigate the effect that the unknown @xmath2 has on the data .",
    "this error is not , in general , drawn from the per - pixel noise value .",
    "as robospect only attempts fits for lines in the linelist , any unknown line will create a deviation between the best model spectrum and the input data .",
    "because of this , robospect estimates a noise for each pixel that represents the observed scatter in the spectrum , which includes the contribution from small , unfit lines .",
    "this measured noise is generally higher than the expected poissonian noise , due to this extra contribution .",
    "this noise is used both in the line fitting stage to determine how well the model matches as well as in the internal line finding stage .",
    "similar to the continuum solution above , we find a noise solution , @xmath2 : @xmath7    this solution removes the current best fitting continuum and line models from the data , leaving only what should be considered the error component . as above in equation 2 , the function",
    "@xmath8 attempts to model the underlying noise that this error component is drawn from .",
    "this is also generally a filtering process , with the default filter using the median absolute deviation statistic ( @xmath9 ) .",
    "this value is then converted to an equivalent gaussian @xmath10 by noting that for a gaussian distribution , the mad is half of the interquartile distance , and therefore this equivalent @xmath10 is equal to @xmath11 . using this statistic instead of a directly measured standard deviation",
    "allows this estimate of the noise to be robust against the influence of outliers , such as those that may be left behind by large unmodeled spectral features .    at this point in the fitting process , robospect can attempt to identify potential lines that are not yet in its linelist .",
    "this is done by looking for local peaks that are more than a fixed user - specified number of @xmath10 deviant from the continuum subtracted level :    @xmath12    we expect that a large fraction of lines specified by the linelist will be significant in this measurement .",
    "therefore , after finding all the local peaks that are above the threshold , we merge this list of peaks with those already in the linelist and remove the duplicates .",
    "the current line model is not subtracted from the data before looking for new lines , as the model residual can introduce significant local peaks that are not necessarily real .",
    "robospect constructs a line solution model using the same methods as when it finds lines , except without normalizing by the spectrum noise : @xmath13    again , @xmath14 is a function that represents the fitting process performed for each line in the current list ( whether supplied by the user or found automatically ) .",
    "this fitting process can use various methods , and can use different models for the line profile shape , as described in section [ sec : line models ] .      for flux calibrated spectra ,",
    "the same three components are used to describe the input spectrum .",
    "however , these components are combined in a different manner than is used for the continuum normalized spectra . for flux calibrated spectra",
    ", we assume that the continuum solution combines with the line solution additively and not multiplicatively as in the case of the continuum normalized spectra .",
    "therefore , the spectrum model for flux calibrated data is :    @xmath15    from this model , we can derive relations for the various components as was done above for the flux normalized spectra . @xmath16",
    "the same fitting and estimation algorithms can be used on both kinds of spectra , as we isolate the component being measured in both cases . due to the large dynamic range possible for flux calibrated spectra",
    ", it is useful to calculate the continuum and noise models using the logarithm of the flux levels .",
    "this prevents a large continuum gradient from being dominated by the very largest values .",
    "figure [ fig : flowchartb ] shows a flow chart of the steps used in fitting individual lines . before doing more complicated fitting , an initial guess for the fit parameters is constructed for each line , under the assumption that the line profile is a gaussian .",
    "the line center is estimated from the centroid around the line peak .",
    "the fwhm is calculated by interpolating the line profile at the half - peak value .",
    "as heavily blended lines may have excessive contribution from other lines at the half - peak value , we check this value with the width calculated from the 75%-max peak value . in the case of large differences in the expected gaussian @xmath10 between these two values",
    ", we take the smaller value to minimize the possible effect of blending .",
    "finally , total line flux , f , is estimated for a simple gaussian model from the peak flux and the fwhm ( @xmath17 ) .",
    "after this initial fit is performed for all lines , a set of deblending groups is determined .",
    "if the line centers are closer than a given number of line widths ( taken by default as six times the gaussian model @xmath10 ) , then they are assigned to the same deblend group .",
    "this deblend group is then simultaneously fit as a single unit , to allow for the contributions of all the lines at a given wavelength .",
    "the full line fitting to find the best fitting set of model parameters is done via non - linear least - squares minimization of @xmath18 for each deblending group , where @xmath19 is the component of the @xmath20th line at wavelength @xmath21 .",
    "different line model choices can made for @xmath22 , as described in section [ subsec : line profile functions ] .",
    "once convergence is reached for all the lines in one deblend group , those values are recorded and the fitting moves to the next deblend group , until all lines over the entire spectrum have been fit .    after fitting all lines , a set of quality checks",
    "are performed to ensure that only valid fits are retained in the final model .",
    "first , any line that did not converge within a fixed number of fitting iterations is flagged and rejected from further consideration .",
    "similarly , lines that have final fit values that are non - finite are flagged and rejected .",
    "finally , the total line solution is calculated by summing only the valid lines , further rejecting any lines that do not reduce the total @xmath23 value .",
    "once the line fitting has been finished and the line solution accumulated , further iterations can be performed starting with these models as an initial set of parameters . as the continuum model is based on the spectrum with lines removed , better line models result in a smaller line residual , allowing for a better continuum model . in turn , with a more accurate continuum model , the line fits are more reliable , with less noise as there are fewer residuals remaining . in figure  [ roboplot ] , we show an example output fit from the s / n@xmath24 star for fe  i line @xmath25 .",
    "the default assumption for all lines is that they have a profile shape consistent with a simple gaussian .",
    "this is appropriate for most lines used in a typical equivalent width - based stellar abundance analysis .",
    "lines that fall on the linear portion of the curve of growth have a 1:1 ratio between the line width and the absorbers , thus a small change in the number of absorbers is easily reflected in the line profile .",
    "however , as the line leaves the linear portion of the curve of growth , this ratio becomes smaller and the assumption of a gaussian profile begins to break down , resulting in wings that are broader and contain a larger fraction of the total flux . to account for these strong lines , we allow the user to select other profile functions that can better model these lines .    in the extreme case of the line shape generated solely by pressure broadening",
    ", we support a lorentzian model .",
    "this is in general not appropriate for most lines included in the typical analysis of a stellar spectrum ; however the gaussian line shape is not appropriate for certain lines from which abundances are derived ( e.g. , mg b ) and for lines that are important in calculating the continuum ( such as the hydrogen lines ) . between the extreme lorentzian and the gaussian is the voigt profile , the result of the convolution of a gaussian and lorentzian models .",
    "this profile is somewhat difficult to directly calculate , and so we utilize the hjerting approximation given by @xcite that describes the voigt profile as a polynomial approximation in @xmath26 , the ratio of the lorentzian width to the gaussian ( doppler ) width .",
    "this function reduces to the simple gaussian form when @xmath27 , allowing this function to be used on all lines , with the degree of non - gaussianity allowed to best match the data .",
    "this function is significantly more complicated than a simple gaussian , however , increasing the computation time required for fitting .",
    "internally , robospect has no a priori knowledge of the quality of the wavelength solution .",
    "if a linelist is supplied , it is assumed that the specified line centers are consistent with the peaks in the spectrum .",
    "if this is not true , then the lines specified may go unfit .",
    "we have implemented some rudimentary ways to prevent this situation , but these algorithms assume any errors in the wavelength solution are small , and are not designed as a replacement for accurate wavelength calibration .    given that the linelist notes where expected lines should be found , robospect can use that information to evaluate the wavelength solution of the supplied data . by finding the local peak most consistent with the input linelist",
    ", robospect can check for systematic offsets between the expected line center and the observed line center , and fit a wavelength correction that makes these match .",
    "this correction can either be linear ( the observed spectrum has an offset from expectations by some small fixed @xmath28 ) or doppler ( the observed spectrum has a velocity offset resulting in an offset @xmath29 ) .",
    "once the correction has been measured , this result is applied to shift the expected line centers to match the data , not to change the wavelength solution of the data .",
    "this choice is made to avoid issues interpolating the data onto a new wavelength grid , and the possible resulting degradation in resolution .",
    "the calculated correction is returned with the final fit , allowing the user to use it to help re - reduce the data .",
    "although robospect returns an error estimate for all measured parameters , this is based on the fit @xmath23 , and does not fully account for the covariance between line parameters and continuum uncertainty . therefore , to confirm the fit quality and measurement accuracy , we compare the results from robospect to a sample of independently measured lines .",
    "we performed our first test using a sample of 100 simulated spectra , designed to be similar to a sample of high resolution , continuum - normalized stellar absorption spectra .",
    "each spectrum covers a range of 4000 centered at 6000 , with 0.1 spaced pixels . a randomly chosen signal - to - noise ratio",
    "was selected logarithmically between @xmath30 and @xmath31 to represent the a range of common data quality .",
    "this s / n value was then used to add random gaussian noise around 1.0 , representing the mean level of the normalized spectra . from this base , we then added 1000 equally spaced gaussian lines to the spectra . the line equivalent widths were again logarithmically sampled , from a range @xmath32 consistent with what is observed in our spectra of real stars .",
    "the fwhm values for these simulated lines was drawn from the narrow range of @xmath33 . as the fwhm is largely a function of the resolution of the data , and dependent on the instrument ,",
    "there is little need to probe a wide range of values .    in order to represent calibration errors that would shift the continuum level",
    ", we multiplied the final spectrum with a spline model .",
    "this spline model was defined by taking twelve equally spaced points along the spectrum , and randomly selecting a value from the noise expected by the signal - to - noise ratio .",
    "these control points were then interpolated using a cubic spline , and the simulated spectra scaled by this curve .",
    "this model assumes that the continuum level is more robust in high signal - to - noise data , a reasonable expectation .",
    "once these simulated spectra were generated , they were processed using robospect , and the measured line parameters were compared with the known simulation inputs . using the fit quality flags generated by robospect , we can exclude lines that were not fit correctly , and use this information to determine the expected completeness of the fitting process .",
    "figure [ fig : spectrumquality ] shows the completeness as a function of signal to noise and line equivalent width . as is expected , the completeness is worse for weak lines in low signal to noise spectra .",
    "one of the main issues with fitting spectral lines is ensuring that the continuum level is estimated correctly .",
    "as we know the input and fit continuum levels , we can determine how much scatter to expect from robospect measurements .",
    "this scatter is shown in figure  [ fig : spectrumquality ] . as expected , as the spectrum signal - to - noise increases , the accuracy to which robospect determines the continuum also increases .",
    "this continuum accuracy best represents a lower limit to the uncertainty that is expected in real data .",
    "our simulated spectra do not include the contribution that small faint lines can have .",
    "the presence of these lines in real data sets a noise threshold in the continuum that exists in even the highest s / n spectra .",
    "the goal of robospect is to accurately measure the equivalent widths of the lines in the spectrum .",
    "therefore , understanding the errors on these measurements is essential . from @xcite",
    ", we expect that the scatter is a function of the line fwhm and the spectrum signal to noise .",
    "the simulated spectra provide a very large sample of 65,000 lines with valid line measurements to estimate the observed scatter in the robospect fits .",
    "these results are displayed in figure [ fig : eqwquality ] , along with the @xcite predictions . as mentioned before , the presence of faint lines in real data is likely to increase the observed fit scatter , but based on this sample , it is clear that the fits produced by robospect are consistent with the expected theoretical accuracy .      to test robospect on a set of real stellar spectra",
    ", we compared the equivalent width measurements made for 5 stars of s / n @xmath24 , @xmath34 , @xmath35 , @xmath36 , and @xmath37 , listed in table  [ teststars ] .",
    "these stars were observed as part of the chemical abundances of stars in the halo ( cash ) project @xcite .",
    "the cash project is a study of 500 stars , observed at mcdonald observatory using the high resolution spectrograph @xcite on the hobby - eberly telescope @xcite .",
    "the goal of this study is to analyze a statistical sample of stellar spectra to determine chemical abundances and abundance trends in a self - consistent manner .",
    "we are using robospect to facilitate the analysis for this large spectroscopic study .",
    "these s / n values were chosen to present an ideal case , a good case , the median s / n of the cash study , a bad , and a very bad case .",
    "observational details of the cash project are given by @xcite .",
    "as these stars are part of a study of the stellar halo , they are of low metallicity , ranging from @xmath38[fe / h]@xmath39 .",
    "these stars were observed at r@xmath40 and have been measured using a semi - automated idl routine @xcite which was also used for the stars of equal resolution by @xcite .",
    "here we examine two of the most common parameter settings used in robospect : standard gaussian line profiles and hjerting line profiles . in both cases",
    ", we use the set of default parameters listed in table  [ defaultparam ] to test the code , which was run for five iterations of the main fitting loop .",
    "the only deviation from the default parameters is for the fits using the hjerting line profile shape .",
    "tables  [ gaussanal ] and [ hjertinganal ] show the results of statistical tests that quantify the difference between the manually measured equivalent width and the robospect measured equivalent width .",
    "we also include the s / n , the iteration of fitting loop presented , as well as the number of lines that had fits considered valid by robospect . to prevent a small number of outliers from skewing the results",
    ", we also list the median and the robust estimate of the standard deviation , @xmath41 .      in the standard case , using the default parameters with a gaussian line fit , we find that robospect matches the manual measurements , with differences between the manually measured result consistent with the expected @xcite estimate .",
    "we show results for the test spectra for five iterations in table  [ gaussanal ] .",
    "we determined a nominal error in the manually measured equivalent widths as calculated from @xcite by basing the wavelength in the region near the mg b lines .",
    "this region was chosen as it was the same one from which the s / n was calculated .",
    "we find the errors in equivalent width to be 1.00 , 3.00 , 4.61 , 6.66 , and 9.99 m for the 300 , 100 , 65 , 45 , and 30 s / n cases respectively . as with the simulated spectra , as the s / n drops the accuracy with which robospect matches the manual equivalent width also drops . in all cases but the 300 s / n case , the standard deviation falls below this value .",
    "furthermore , the @xmath41 value is well below the error in the manually measured equivalent widths , again with the exception of the s / n 300 case .",
    "the likely cause for this exception is the differences in continuum level chosen by the manual and robospect measurements .",
    "the continuum level from robospect passes through the median of the spectra data , which tends to be slightly lower than the manual placement , resulting in a small bias .",
    "increasing the number of iterations generally decreases both the fitting bias ( as measured by the mean and median ) as well as the fit scatter ( based on @xmath10 and @xmath41 ) . usually , three iterations are sufficient , with a minimal improvement in the scatter beyond this limit of @xmath42m .",
    "this improvement is small relative to the expected uncertainty in the manual measurements , suggesting that further iterations are not likely to improve the fit results .",
    "the left panel of figure  [ fig : allres ] shows plots of the residuals between the manually measured equivalent widths from @xcite and the robospect equivalent widths , with each s / n value offset by 50 m .",
    "the left panel of figure  [ fig : compa ] shows the equivalent widths from the manually measured equivalent widths against those of robospect for all s / n values .",
    "although the scatter between the measurements matches the expectations , there is a clear s / n dependence in the bias between the robospect and manual measurements .",
    "the most plausible reason for this is a difference in the way that the continuum level is set between these two methods .",
    "robospect assumes that the true continuum level is `` hidden '' within the scatter in the spectrum data , and places the continuum level to be consistent with the median value of this scatter .",
    "in contrast , a manual measurement is likely to set the local continuum at the peaks to either side of the line , substantially higher than the robospect value ( on the order of @xmath43 , the scatter in the continuum level ) . because of this , the increasing deviation between the manual measurements and the robospect measurements as the signal to noise decreases is not surprising , and represents the covariance between continuum level and line flux .      as some very strong lines ( @xmath44@xmath45 in reduced equivalent width ) may have a significantly non - gaussian line profile shape , we repeated the analysis of these stars with the hjerting line model instead of a gaussian .",
    "the comparison with the manual equivalent width measurements is detailed in table  [ hjertinganal ] over all five iterations .",
    "the right panel of figure  [ fig : allres ] shows plots of the residuals between the manually measured equivalent widths from @xcite and the robospect equivalent widths , with each s / n value offset by 50 m .",
    "the right panel of figure  [ fig : compa ] shows the plot of the equivalent widths from the manually measured equivalent widths against those of robospect for all s / n values . upon inspection of the statistical results , we find that the mean and @xmath10 values are significantly larger than those associated with the standard gaussian fits",
    "; however , when we evaluate the median and @xmath41 values , we find that they are reasonably consistent . as the median and @xmath41 values",
    "are less sensitive to outliers , this suggests that the added parameters of the hjerting model may make the code more susceptible to erroneous fits .",
    "it should also be noted that night sky lines can pollute the stellar spectrum around 6000 , which is where many of these outlier fits exist , as seen in the right panel of figure  [ fig : allres ] .",
    "figures  [ fig:300ocplot]-[fig:30ocplot ] include a visualization of the line model and model continuum plotted against the input spectrum along with the residuals between the spectrum and line model for each s / n value of the cash stars presented for the hjerting line profile fits .",
    "the wavelength region shown spans from 5520 to 5560 , which is also the width of the deblending region .",
    "this region includes a several lines which require deblending , along with some individual features as well .",
    "as the metallicity of each of these stars is different , the line strengths vary as well , as strongly evidenced by the @xmath21 5041.07 and @xmath21 5041.76 lines , two prominent fe features .",
    "these example fits also show that strongly deviant points , such as those caused by cosmic rays , are detected and fit as emission features .",
    "these fits help minimize the influence that these discrepant points have on the continuum model .",
    "we also tested the hjerting line profiles against the published equivalent width measurement values for hd  122563 , the s / n@xmath24 star , from @xcite and for hd  115444 , the s / n@xmath46 star , from @xcite .",
    "we find good agreement with both sets of equivalent widths 0.953@xmath475.796 m and 1.768@xmath472.621 m for hd  122563 and hd  115444 , respectively .      in our tests , we used a linelist that was designed for metal - poor stars",
    "however , not all stars have every line in the list , and artifacts such as cosmic rays and noisy spectral regions often make certain lines that have been measured by robospect undesirable for further analysis . even when using manual programs to measure equivalent widths , there are lines that simply can not be measured well enough for inclusion subsequent analysis such as stellar parameter determination .",
    "the previous set of statistics included all lines that were measured by robospect and not flagged by the code as invalid .",
    "as such , they may include lines with these undesirable features .",
    "we performed a statistical analysis on a subset of these lines which have been deemed suitable for stellar abundance analysis and present the results in table  [ cookedanal ] .",
    "we include only the statistical results from the fifth iteration , as these are the final fit values .    in general , we find the same trend in these improved statistics : high s / n values correspond with smaller mean differences , medians , @xmath10 , and @xmath41 values . by removing spurious lines ,",
    "we find better agreement with the manual equivalent width measurements .",
    "of particular importance is that once the outliers are removed , the hjerting line profile fits match slightly better than the gaussian fits as compared to the manual measurements .",
    "when accepting all lines that robospect deemed valid , the gaussian fits performed better ; hence , the hjerting profile is more susceptible to outliers , but should be used when the user can remove particularly bad fits .",
    "below we highlight some statistics of note .",
    "in the 45 s / n gaussian case , the @xmath10 , mean , and median improve , but the @xmath41 value increases .",
    "this is likely because the line fits that were deemed bad were less discrepant from the manual measurements than some of the lines that were left in the re - analysis of the statistics .",
    "these seemingly `` very bad '' lines were left in because the discrepancy in the measured equivalent widths is a result of the different choices in the continuum level .",
    "it is likely that this creates a problem for the 45 s / n case and not the others because the s / n is low enough to begin to hide weak lines in the noise which would pull down the continuum level to a significant level , but not so low that a large fraction of the lines are lost in the noise .    in the 65 s",
    "/ n hjerting case , we find that the mean increases in the re - run after removing the bad fits . for this run ,",
    "the extreme outliers were on the lower end , bringing the mean down closer to 0 . by removing the highly negative outliers , the mean increased ; however , the median , which is more robust against outliers decreased along with the @xmath41 and @xmath10 values as is expected .      as discussed in section  [ sec : spectrum models ] , the method used for fitting flux calibrated data is slightly different than that used for normalized spectra . to test the accuracy of this fitting mode",
    ", we examined a set of long slit emission spectra of the orion nebula .",
    "these data were taken on the 1.5-meter cassegrain spectrograph at ctio .",
    "three gratings were used , providing a blue , red , and high resolution spectrum for each pointing .",
    "the characteristics of these gratings is provided in table [ tab : orion1.5 m ] .",
    "the spectra were flux calibrated , and apertures defined to bin the spectra to ensure an average signal - to - noise of @xmath48 .",
    "this results in thirty binned spectra for each of the 24 input images .",
    "a manual measurement of the lines was performed using the iraf task splot , with the continuum and center set manually .",
    "robospect was then used to measure each spectrum as well , using a single list of lines and a gaussian line model . the relative flux difference ( @xmath49 ) and",
    "the scatter are listed in table  [ tab : orion1.5 m ] . for the majority of lines , the results agree very well , again illustrating that robospect produces measurements consistent with other methods of spectral line measurement .",
    "figure [ fig : orion_lines ] shows the scatter observed in individual lines for each grating .",
    "it is clear from this that the scatter in the high resolution spectra is much lower than for the other two gratings . for the lines with the largest difference",
    ", a comparison of the splot and robospect measurements shows that robospect fluxes are generally lower than those measured by splot .",
    "this decreased flux is a result of robospect deblending neighboring lines that were fit with a single gaussian in the splot analysis . therefore , this increased scatter is largely a result of the manual measurement incorrectly modeling the data .",
    "the assumption that all lines can be fit by gaussians or the hjerting model is certainly not valid for the strongest lines . for these very broad lines , robospect will underestimate the line flux as the true line shape deviates from the analytic forms .",
    "such lines are not commonly used in the calculation of stellar properties in studies like the cash project , but knowing the point at which the analytic models break down is essential .",
    "this break down point can be calculated with a well - calibrated real spectrum that contains a large number of lines that vary over many orders of magnitude in equivalent width .",
    "furthermore , using a spectrum with a very high signal - to - noise ratio and resolution reduces the possibility that faint lines blended into the wings of strong lines will make those strong lines deviate from the analytic form . the solar spectrum presented by @xcite satisfies all of these requirements , and in addition ,",
    "has a well - calibrated continuum level that we can take as fixed to reduce the influence that the robospect continuum level can have on the line measurements .    from this high quality spectrum ,",
    "we selected the region between 3825 and 4561  to study .",
    "this region contains many lines , with a range of equivalent width values from 1 to 1000 m . to do the comparison",
    ", we first ran robospect with the hjerting line model selected . for each of the well - fit lines in the output catalog",
    ", we attempted to construct an independent non - parametric measurement .",
    "as these lines may still have contaminating blended lines , we constrain the non - parametric model curve in two ways .",
    "first , the line must be symmetric about the central wavelength .",
    "this constraint helps remove these blends , as we can use symmetry to exclude the influence on the line under consideration .",
    "secondly , we demand that a line monotonically approaches the continuum",
    ". this also helps prevent issues with blending , and ensures that the line has a finite total flux .",
    "once each line shape was defined by this non - parametric model , we used a direct integration of the line flux to obtain the total equivalent width .",
    "unsurprisingly , this non - parametric model generally produces larger equivalent widths than the standard hjerting fits , as it can probe further out into the wings of the lines . for weak lines ,",
    "this effect is minimal , as any wings are small and reasonably fit by the analytic model . for lines with non - parametric equivalent widths less than @xmath50 , the residuals between the non - parametric model and hjerting model are largely random , with an average deviation of @xmath51 . above this limit , however , the deviations and scatter increase dramatically , as the lines become increasingly dominated by the wings instead of the core .",
    "this change is poorly modeled by the hjerting function , resulting in a larger average deviation of @xmath52 .",
    "separating out the measurements above @xmath53 , we can fit a line to the deviations and note that the error in the hjerting fits is largely linear with the true equivalent width , such that @xmath54 .",
    "the future of astronomical study is in large collaborations , specifically large surveys , such as those like the sloan digital sky survey ( sdss ) @xcite and the subsequent sloan extension for galactic understanding and exploration ( segue ) @xcite , both of which included a large spectroscopic component . for these surveys , and for any statistical stellar sample , it is necessary to analyze the spectra in a self - consistent manner so that the resultant abundance trends and frequencies are meaningful .",
    "sdss and segue employ the sloan stellar parameter pipeline ( sspp ) @xcite for such analysis of its medium resolution spectra .",
    "however , for studies with higher resolution data , there exist several codes to measure equivalent widths , although are truly fully - automated .",
    "robospect has been written to fill this niche , and perform automated fits to high resolution spectra .",
    "a variety of very good publicly available programs exist , and can largely be divided into three categories : manual , semi - automated , and fully automated methods .",
    "manual programs , such as splot in iraf , require continuous user interaction , and due to this , the measurements can be significantly influenced by the decisions of the user .",
    "this `` personal equation '' includes a variety of factors that can vary from user to user , such as how the continuum level is set , the line width in wavelength space , and considerations for smoothing . in order to obtain a consistent set of measurements ,",
    "all of these factors must be kept the same , usually resulting in a single spectroscopist performing all measurements . for large scale , labor - intensive projects , such as cash",
    ", it can be difficult to remain consistent over hundreds of lines in hundreds of stars .",
    "this problem is somewhat resolved by the semi - automated methods , which reduce the level of user interaction . however , even in these programs , the initial equivalent width can be flawed as the automated continuum placement is rudimentary .",
    "weak lines and noise can be indistinguishable , which can bias the continuum level calculated , requiring user input into the continuum placement , which is generally the largest component of error associated with the measurement . additionally , the line - finding algorithms often have difficulties in detecting and measuring weak lines that are adjacent to large features .",
    "fitline @xcite is an example of a semi - automated equivalent width measurement code .",
    "it utilizes a genetic algorithm to fit gaussian profiles to the lines of a linelist by generating random gaussian parameters , mutating those parameters based on the lines that are best fit , and iterating until convergence to the best fits .",
    "fitline requires some initial user interaction to dictate files .",
    "it can also be used with a post - processing code where the user can flag fit quality .",
    "a detailed description of the code can be found in @xcite .",
    "daospec @xcite is another equivalent width measurement software that is written in fortran , for use with iraf libraries and supermongo for graphical support .",
    "it works over five iterations to determine the equivalent widths and in many ways is similar to robospect , using a line - fitting and continuum - fitting cycle .",
    "daospec is not interactive , although it does require the user to set input values , including a fwhm estimate and the polynomial order used to fit the continuum .",
    "robospect was written with the intent of being deterministic , therefore the inputs required by robospect do not greatly affect the resultant equivalent width measurements .",
    "it was also written to be user - friendly .",
    "it utilizes freely available libraries and graphics support so it is free of cost as well as open source .",
    "additionally , since it is written in c , it is not under any peculiar constraints in terms of the formatting of input files and is easily modified for specific projects .",
    "with the increasing scale of data in astronomical projects , automating the process of measuring features is essential to make use of the corresponding increase in computational power . to support this goal for the cash project ,",
    "we have written robospect , a fully - automated equivalent width measurement code . although robospect was designed for metal poor stars , it is capable of fitting absorption and emission features in a variety of astronomical sources .    based on the results of a large number of simulated spectra with known line parameters , we are confident that the fitting accuracy of robospect is consistent with the expected theoretical accuracy as presented by @xcite .",
    "these results are confirmed by the comparing the robospect results with manual measurements of both a sampling of cash project stars at a variety of s / n , as well as a set of long - slit spectra of the orion nebula .",
    "while robospect can be used to greatly reduce the labor involved in determining the equivalent widths of spectral lines , it is not written with the intention to be a substitute for actually looking at the data .",
    "thus , a re - analysis of a subset of the lines that are visually confirmed to be valid for stellar parameter determination and abundance analysis shows an expected improvement in the scatter relative to the manual measurements .",
    "we found that our statistics improved over all of our s / n values and for both of the robospect parameter settings we investigated . in the case of the hjerting model , we found that extreme outliers , which would not be considered valid for stellar abundance work , can bias the results .",
    "another caveat is that due to the method used to fit the lines and measure the continuum , robospect has difficulty with spectra in which there is no discernible continuum over large wavelength regions . in metal - poor stars , these regions can be found in cool stars with molecular bandheads , often from titanium and also in stars with enhanced carbon abundances .",
    "these features are also difficult to define mathematically , preventing minimization process from finding a single best fitting set of parameters .",
    "thus , robospect should not be used for these stars ; however , most other routines will also have difficulties with these stars .",
    "similarly , in the case of the most carbon - enhanced stars , it is better to skip the equivalent width measurement analysis in favor of a spectral synthesis",
    ".    jkh acknowledges support for this work from nsf grants ast 0708245 and ast 0908978 .",
    "czw acknowledges support for this work through the panstarrs science consortium , which has been made possible through contributions of the institute for astronomy , the university of hawaii , the pan - starrs project office , the max - planck society and its participating institutes , the max planck institute for astronomy , heidelberg and the max planck institute for extraterrestrial physics , garching , the johns hopkins university , durham university , the university of edinburgh , queen s university belfast , the harvard - smithsonian center for astrophysics , and the las cumbres observatory global telescope network , incorporated , the national central university of taiwan , and the national aeronautics and space administration under grant no .",
    "nnx08ar22 g issued through the planetary science division of the nasa science mission directorate .",
    "partial support for this work was provided by national science foundation grant ast-1009749 .",
    "we are very grateful to jack baldwin for supplying the orion nebula spectra used in this paper .",
    "we also appreciate useful conversations with christopher sneden , harriet dinerstein , anna frebel , matthew shetrone , randi ludwig , and eugene magnier .",
    "cayrel , r.  1988 , the impact of very high s / n spectroscopy on stellar physics , 132 , 345 cayrel , r. , depagne , e. , spite , m. , et al .  2004 , , 416 , 1117 franois , p. , depagne , e. , hill , v. , et al .",
    "2003 , , 403 , 1105 fulbright , j.  p.  2000 , , 120 , 1841 harris , d.  l. , iii 1948 , , 108 , 112 hollek , j.  k. , frebel , a. , roederer , i.  u. , et al .",
    "2011 , , 742 , 54 lee , y.  s. , beers , t.  c. , sivarani , t. , et al .",
    "2008 , , 136 , 2022 lemasle , b. , franois , p. , bono , g. , et al .  2007 , , 467 , 283 ludwig , r.  r. , greene , j.  e. , barth , a.  j. , & ho , l.  c.  2012 , , 756 , 51 pellegrini , e.  w. , baldwin , j.  a. , & ferland , g.  j.  2010 , , 191 , 160 roederer , i.  u. , & lawler , j.  e.  2012 , , 750 , 76 shetrone , m. , cornell , m.  e. , fowler , j.  r. , et al .",
    "2007 , , 119 , 556 sterling , n.  c. , dinerstein , h.  l. , bowers , c.  w. , & redfield , s.  2005 , , 625 , 368 stetson , p.  b. , & pancino , e.  2008 , , 120 , 1332 tull , r.  g.  1998 , , 3355 , 387 wallace , l. , hinkle , k.  h. , livingston , w.  c. , & davis , s.  p.  2011",
    ", , 195 , 6 yanny , b. , rockosi , c. , newberg , h.  j. , et al .",
    "2009 , , 137 , 4377 york , d.  g. , adelman , j. , anderson , j.  e. , jr .",
    ", et al .  2000 , , 120 , 1579      ll continuum model & simple boxcar with a width of 40 m + line model & `` best '' estimating lines from fwhm and use deblending + line profile function & gaussian + linelist & specify lines for measurement from linelist + find lines & find additional lines to the fit outside of the linelist + [ defaultparam ]      30 & 1 & 10.66 & 8.573 & 9.1 & -3.7 & 42.0 & 5.4 & 14.6 & 6.822 & 76 + 30 & 2 & 9.411 & 8.458 & 8.0 & -5.5 & 40.0 & 4.1 & 11.7 & 5.635 & 79 + 30 & 3 & 8.962 & 8.249 & 7.5 & -6.6 & 39.0 & 3.8 & 11.6 & 5.784 & 79 + 30 & 4 & 8.799 & 8.264 & 7.5 & -6.8 & 38.7 & 3.6 & 11.6 & 5.932 & 79 + 30 & 5 & 8.701 & 8.234 & 7.4 & -6.8 & 38.4 & 3.6 & 11.6 & 5.932 & 79 + 45 & 1 & 5.544 & 5.198 & 5.5 & -6.2 & 22.6 & 2.0 & 7.6 & 4.152 & 55 + 45 & 2 & 5.086 & 5.212 & 4.7 & -7.4 & 22.9 & 2.0 & 7.5 & 4.078 & 57 + 45 & 3 & 5.141 & 5.110 & 4.4 & -5.3 & 22.9 & 2.1 & 7.5 & 4.004 & 58 + 45 & 4 & 5.119 & 5.088 & 4.3 & -5.8 & 22.9 & 2.2 & 7.4 & 3.856 & 58 + 45 & 5 & 5.095 & 5.024 & 4.4 & -6.0 & 22.8 & 2.3 & 7.4 & 3.782 & 59 + 65 & 1 & 2.797 & 2.598 & 2.6 & -1.9 & 10.8 & 1.2 & 4 & 2.076 & 89 + 65 & 2 & 2.051 & 2.573 & 1.7 & -3.1 & 10.7 & 0.4 & 3.6 & 2.373 & 90 + 65 & 3 & 1.787 & 2.582 & 1.4 & -3.5 & 11.0 & 0.1 & 3.2 & 2.299 & 90 + 65 & 4 & 1.700 & 2.572 & 1.3 & -3.7 & 11.4 & -0.1 & 3.2 & 2.447 & 90 + 65 & 5 & 1.660 & 2.565 & 1.3 & -3.7 & 11.5 & -0.1 & 3.1 & 2.373 & 90 + 100 & 1 & 1.437 & 2.457 & 1.2 & -7.4 & 7.2 & 0.0 & 2.9 & 2.150 & 80 + 100 & 2 & 1.158 & 2.406 & 0.9 & -7.9 & 6.8 & -0.2 & 2.3 & 1.854 & 78 + 100 & 3 & 1.111 & 2.435 & 0.8 & -8.0 & 6.6 & -0.3 & 2.5 & 2.076 & 81 + 100 & 4 & 1.169 & 2.217 & 0.8 & -5.5 & 6.6 & -0.4 & 2.4 & 2.076 & 81 + 100 & 5 & 1.157 & 2.213 & 0.8 & -5.4 & 6.5 & -0.4 & 2.3 & 2.002 & 81 + 300 & 1 & 1.616 & 3.733 & 1.3 & -5.9 & 24.5 & 0.4 & 2.2 & 1.335 & 89 + 300 & 2 & 1.048 & 3.215 & 0.6 & -5.7 & 20.4 & -0.2 & 1.4 & 1.186 & 90 + 300 & 3 & 0.925 & 3.134 & 0.5 & -4.5 & 18.6 & -0.4 & 1.2 & 1.186 & 87 + 300 & 4 & 0.802 & 3.009 & 0.4 & -5.5 & 17.6 & -0.5 & 1.3 & 1.335 & 89 + 300 & 5 & 0.701 & 2.936 & 0.3 & -6.4 & 17.2 & -0.5 & 1.1 & 1.186 & 89 + [ gaussanal ]      30 & 1 & 10.51 & 8.923 & 9.4 & -14.5 & 42.4 & 5.8 & 13.1 & 5.413 & 76 + 30 & 2 & 9.647 & 8.864 & 8.5 & -16.1 & 40.4 & 4.6 & 13.5 & 6.599 & 79 + 30 & 3 & 9.756 & 9.616 & 8.4 & -16.7 & 45.3 & 4.4 & 13.3 & 6.599 & 79 + 30 & 4 & 9.222 & 8.167 & 7.7 & -5.9 & 39.6 & 3.6 & 11.7 & 6.006 & 79 + 30 & 5 & 9.08 & 8.135 & 7.8 & -6.5 & 39 & 4 & 11.7 & 5.71 & 79 + 45 & 1 & 5.236 & 6.029 & 5.3 & -16.2 & 22.7 & 1.9 & 8.1 & 4.597 & 56 + 45 & 2 & 5.095 & 5.46 & 4.8 & -7.7 & 22.8 & 2.1 & 7.5 & 4.004 & 57 + 45 & 3 & 5.128 & 5.604 & 5.2 & -10.4 & 22.9 & 2.5 & 7.7 & 3.856 & 57 + 45 & 4 & 5.65 & 5.849 & 5.2 & -8.9 & 25.7 & 2.6 & 7.7 & 3.782 & 58 + 45 & 5 & 5.268 & 5.826 & 5.1 & -10.3 & 22.8 & 2.5 & 7.7 & 3.856 & 59 + 65 & 1 & 2.862 & 3.164 & 2.8 & -13.1 & 11.6 & 1.3 & 4.3 & 2.224 & 89 + 65 & 2 & 2.309 & 4.496 & 1.8 & -8.8 & 35.1 & 0.3 & 3.7 & 2.521 & 87 + 65 & 3 & 1.8 & 2.502 & 1.5 & -3.4 & 9 & 0.1 & 3.7 & 2.669 & 84 + 65 & 4 & 1.89 & 2.51 & 1.6 & -3.6 & 9.1 & 0.1 & 3.7 & 2.669 & 89 + 65 & 5 & 1.32 & 4.242 & 1.4 & -30.5 & 9 & 0 & 3.5 & 2.595 & 88 + 100 & 1 & 1.575 & 2.595 & 1.2 & -8.1 & 8 & 0.1 & 3.1 & 2.224 & 80 + 100 & 2 & 1.204 & 2.657 & 1 & -8.4 & 8.5 & -0.2 & 2.5 & 2.002 & 80 + 100 & 3 & 1.146 & 2.526 & 1 & -8.1 & 7.6 & -0.2 & 2.6 & 2.076 & 81 + 100 & 4 & 1.068 & 2.524 & 0.9 & -8.5 & 6.6 & -0.2 & 2.4 & 1.928 & 82 + 100 & 5 & 0.989 & 2.618 & 0.8 & -8.5 & 6.6 & -0.4 & 2.4 & 2.076 & 82 + 300 & 1 & -0.004 & 8.456 & 1.3 & -47.9 & 24.6 & 0.4 & 2.1 & 1.261 & 90 + 300 & 2 & 1.147 & 5.64 & 0.6 & -19.3 & 20.6 & -0.1 & 1.6 & 1.261 & 90 + 300 & 3 & 2.414 & 8.438 & 0.6 & -19.6 & 55.7 & -0.3 & 2 & 1.705 & 85 + 300 & 4 & 2.533 & 11.03 & 0.6 & -33.2 & 56.5 & -0.4 & 1.8 & 1.631 & 88 + 300 & 5 & 1.912 & 5.247 & 0.5 & -9.7 & 26.6 & -0.3 & 1.9 & 1.631 & 89 + [ hjertinganal ]    lcccccccccc 300 & gaussian & 0.445 & 2.240 & 0.2 & -6.4 & 8.4 & -0.5 & 1.0 & 1.112 & 82 + 300 & hjerting & 0.654 & 1.900 & 0.3 & -3.6 & 8.3 & -0.3 & 1.2 & 1.112 & 74 + 100 & gaussian & 0.881 & 2.112 & 0.5 & -5.4 & 6.5 & -0.5 & 1.8 & 1.705 & 72 + 100 & hjerting & 0.496 & 2.220 & 0.4 & -8.5 & 6.4 & -0.6 & 1.4 & 1.483 & 68 + 65 & gaussian & 1.421 & 2.273 & 1.2 & -3.7 & 8.7 & -0.2 & 2.7 & 2.150 & 85 + 65 & hjerting & 1.353 & 2.016 & 1.1 & -2.9 & 6.0 & 0.0 & 2.6 & 1.928 & 76 + 45 & gaussian & 4.747 & 4.828 & 4.2 & -6.0 & 22.8 & 2.1 & 7.4 & 3.930 & 55 + 45 & hjerting & 3.808 & 4.817 & 4.1 & -10.3 & 13.1 & 2.0 & 6.8 & 3.559 & 48 + 30 & gaussian & 6.854 & 5.716 & 6.7 & -5.3 & 25.7 & 3.1 & 9.8 & 4.968 & 68 + 30 & hjerting & 6.602 & 5.859 & 6.2 & -6.5 & 26.1 & 3.0 & 9.6 & 4.894 & 63 +"
  ],
  "abstract_text": [
    "<S> we present robospect , a new code to automatically measure and deblend line equivalent widths for both absorption and emission spectra . </S>",
    "<S> we test the accuracy of these measurements against simulated spectra as well as manual equivalent width measurements of five stellar spectra over a range of signal - to - noise values and a set of long slit emission spectra . </S>",
    "<S> we find that robospect accurately matches both the synthetic and manual measurements , with scatter consistent with the expectations based on the data quality and the results of @xcite . </S>"
  ]
}