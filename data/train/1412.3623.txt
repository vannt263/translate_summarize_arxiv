{
  "article_text": [
    "_ counterparty credit risk _ ( ccr ) refers to the risk that a counterparty of a financial contract will default prior to the expiration of the contract , and thus can not make all payments required by the contract .",
    "the management of ccr has caught special attention since the financial crisis which started in 2007 @xcite .",
    "otc ( over - the - counter ) derivative contracts are especially subject to ccr , since trades are made directly between two parties without supervision of a third party .",
    "basel iii issued in 2010 introduced an additional capital charge requirement , called _ credit valuation adjustment _ ( cva ) to cover the risk of losses on a counterparty default event for otc derivatives .",
    "the cva equals the difference between the risk - free value and the market value of a contract with the possibility of counterparty default , which indicates that cva materializes the market value of ccr @xcite .",
    "one difficulty in pricing cva arises from the uncertainty of the losses in the event of default , which is commonly defined as _ exposure_. as the market moves , exposure values of contracts evolve over time , diverting away from the initial book value @xcite",
    ".    the presence of ccr may have significant impact , for example , on the exercise - strategy of a bermudan option , as the holder can decide to exercise the option earlier to reduce the risk of a future default event @xcite . in the present paper",
    "however , we assume independence between default and exposure values , and we further assume that the presence of counterparty default has no influence on the holder s decision of exercising options .    monte carlo simulation is a widely used approach to determine an empirical distribution of the underlying asset , but also other pricing approaches have been adapted to the computation of exposure . in @xcite ,",
    "the cos method is adapted for pricing the exposure of bermudan options under lvy process ; in @xcite , the finite difference method is employed for calculation of the exposure values under the heston model .",
    "one focus of this paper is to develop and understand an adaptive and efficient monte carlo approach , the",
    "_ stochastic grid bundling method _ ( sgbm ) for computation of exposure profiles of european , bermudan , barrier options with a single asset under stochastic volatility and stochastic interest rate dynamics ( heston and heston hull - white model , respectively ) .",
    "we will study the convergence and performance of sgbm for valuing mainly the exposure of bermudan options , determine accurate greeks , and also present the corresponding results for barrier options .",
    "sgbm was proposed for pricing bermudan multiple asset derivative contracts under black - scholes dynamics , by jain and oosterlee in  @xcite .",
    "the method is based on _ simulation _ , _ regression _ and _ bundling_. the idea of using simulation and regression for pricing american options has been used earlier by carriere(1996 ) @xcite , tsitsiklis and van roy(2001 ) @xcite , or longstaff and schwartz(2001 ) @xcite .",
    "all these methods , though different in some aspects , approximate the continuation value at each time point based on regression to determine the _ optimal _ exercise - strategy .",
    "there are several modifications and comparisons of the original pricing techniques , like in @xcite , or broadie , glasserman and ha ( 2000 )  @xcite . in @xcite , glasserman and yu(2002 )",
    "compare the so - called regression later approach with a regression now approach , and conclude the superiority of regression later. sgbm is also based on the regression later approach ; in combination with bundling of grid points at each simulated time step , the regression step is enhanced . an important feature of sgbm is that at each time point the option value ( and thus the exposure value ) is available at each grid point of the stochastic grid , not only for in - the - money points .",
    "this is beneficial within the dynamic programming principle giving accurate direct estimators , and facilitates the accurate computation of greeks at all time points . in section [ secsgbm ] , the framework to apply sgbm for computing exposure profiles for european , bermudan and barrier options is explained ; we will give insight in the approximation of the option and continuation values on a polynomial space , and thus on the choice of basis functions for the regression step ; based on convergence analysis , the need to use bundles can be explained .",
    "computational details and numerical results for heston and the heston hull - white ( hhw ) models are given in sections [ sec : bundles ] , respectively .",
    "the hhw model is a useful model when pricing long - term contracts in which we observe an implied volatility smile in the asset , and we require a stochastic interest rate .",
    "the model is encountered in fx markets , for example , as well as in embedded options or inflation options in the pension and insurance industry .",
    "our sgbm exposure pricing technique for the hhw model is based on approximations of the full - scale dynamics in @xcite .",
    "before we start to focus on sgbm , we will give an overview of the concepts and mathematical formulation of cva and exposure , and provide a backward pricing dynamics of pricing in section [ pricing ] .",
    "basically , there are three key elements in pricing cva : ( 1 ) loss given default ( lgd ) , which is the percentage of loss in a default event , ( 2 ) expected exposure ( ee ) , which quantifies the expectation of the losses at a future time point and ( 3 ) probability of the counterparty default ( pd ) .",
    "it is often assumed that lgd is a fixed ratio based on market information , and we also make the assumption that lgd is constant @xcite .    in a general real - life situation",
    "however these three elements are correlated and not independent , as indicated by the concept _ wrong - way ( or right - way ) risk_. here , we assume independence and focus on the accurate computation of exposure and the corresponding greeks under stochastic volatility / stochastic interest rate asset dynamics . the wrong - way risk concept is left for our future research .",
    "credit _ exposure _ represents the economic loss for the derivatives contract holder in a default event without any recovery .",
    "the contract holder suffers a loss only if the contract has a positive mark - to - market ( mtm ) value when the other party defaults , i.e. the exposure is defined as the maximum of the contract s market value and zero .",
    "we are concerned with unilateral cva in this paper , although ccr is bilateral between two parties in the contract .",
    "the future exposure value is uncertain as the market moves unpredictably .",
    "we can generate an empirical exposure density via simulation by generating a large number of asset paths .",
    "a general framework is presented for calculating exposure distributions on otc derivative products at each future point in @xcite .",
    "there are three basic steps in the valuation of exposure profiles : ( 1 ) monte carlo path generation for a series of simulation dates under some underlying dynamics ; ( 2 ) valuation of mark - to - market values of the contract for each realization at each simulation date , applying some numerical method ; ( 3 ) calculation of exposure for each simulation at each simulation date .    in order to quantify exposure and cva , we need mathematical expressions .",
    "we use an @xmath0-dimensional market state variable , @xmath1^t$ ] , to present the market information , i.e. the log - asset price ( @xmath2 ) , volatility(@xmath3 ) and/or the interest rate(@xmath4 ) ( @xmath5 or @xmath6 ) .",
    "suppose the random variable @xmath7 follows stochastic dynamics given by @xmath8 where @xmath9 is an @xmath10-vector of independent brownian motions in @xmath11 , @xmath12 , @xmath13 .    by definition ,",
    "the option exposure is the positive part of the market value of the contract , i.e. , the maximum of the contract value and zero , @xmath14 where @xmath15 is the option value at time @xmath16 depending on market variable @xmath7 .",
    "it is assumed that the exposure value becomes zero immediately when the option is not active ( either exercised in the case of bermudan options or knocked out in the case of barrier options ) .",
    "some well - known quantities of the exposure distribution are used for measurement . _",
    "expected exposure _ ( ee ) , the expectation of the exposure , provides an estimate of the expected value of loss ; while _ potential future exposure _ ( pfe ) , the quantile of exposure at a certain fixed level , is used to measure the worst loss for risk management purposes .",
    "both ee and pfe are deterministic functions with respect to time @xcite .",
    "the mathematical formulas for the functions ee and pfe , conditioned on @xmath17 , are given by : @xmath18 , \\\\",
    "\\text{pfe}^{\\alpha}(t)&:=\\text{inf}\\left\\{x\\big|\\mathbb{q}\\left\\{\\text{e}(t,\\textbf{x}_t)<x|\\textbf{x}_{0 } \\right\\}>\\alpha \\right\\},\\end{aligned}\\ ] ] where @xmath19 is the risk - neutral measure , and @xmath20 is the confidence level . for calculating pfe , the confidence level @xmath21 is commonly used to measure the worst losses .    there is a discussion about using the real world measure @xmath22 or the risk - neutral measure @xmath19 in @xcite .",
    "the measure @xmath19 is preferred for pricing , but when simulating under measure @xmath22 , one can include the `` correlation '' between the default probability and the underlying asset , that allows modeling the _ wrong way risk_. default probabilities under @xmath19 , inferred from market prices of cds or corporate bonds , are typically larger than those under the measure @xmath22  @xcite . as we will not consider wrong - way risk , and we choose measure @xmath19 here for the pricing purposes .",
    "to calculate cva , we define another quantity to represent the discounted ee at time @xmath16 : @xmath23,\\ ] ] where the discount factor is defined by @xmath24 with the interest rate @xmath25 at time @xmath26 .",
    "the difference between @xmath27 and @xmath28 is that @xmath28 denotes the future exposure , while @xmath27 indicates today s value of the future exposure .",
    "when interest rate is deterministic , we can write @xmath29 . here , however , we will deal with stochastic interest rates under the hull - white model when focusing on the hhw dynamics . in that case @xmath27 in a natural quantity , as we will see .",
    "when exposure values and default events are independent , the expression for cva is given by@xcite @xmath30 where @xmath31 is the recovery rate , generally considered as a constant ; @xmath32 is the default probability function .",
    "the default probability function is modeled as follows here : @xmath33 where @xmath34 is the hazard rate(intensity ) , which we will set constant , @xmath35 , in the numerical results section .",
    "the market value of the contract is observed at a set of discrete times , @xmath36 , with @xmath37 , @xmath38 being the tenor of the contract .",
    "the notation of the variables at time @xmath39 is simplified by @xmath40 . a discrete version of the cva formula in ( [ eq : cvaconti ] )",
    "can be written as @xmath41 in ( [ eq : cvadiscrete ] ) , the key elements to calculate cva are the values of the @xmath27 function and the default probability at the discrete observation dates .",
    "we are also interested in values of the pfe function and the corresponding greeks .",
    "hence it becomes crucial to validate exposure of each realized scenarios at all simulated dates .      in this section , we present the backward pricing dynamics framework for financial derivatives .",
    "when an option is exercised , the holder receives the payoff value , i.e. @xmath42 where @xmath43 is the underlying asset variable at time @xmath39 .",
    "when the option contract is still alive , the discounted option value , the _ continuation value _ w.r.t .",
    "state vector @xmath44 , reads @xmath45 , \\ ] ] where @xmath46 represents the option value at time @xmath47 . at time @xmath48",
    ", @xmath49 .",
    "a filtration satisfies @xmath50 , which describes the information flow .",
    "we establish the backward pricing dynamics framework based on the _ snell envelope _",
    "concept @xcite .",
    "the owner of the american option makes the exercise decision for the option based on the information at time @xmath39 .    for european options ,",
    "the option value equals the continuation value before maturity and the holder receives the payoff value only at time @xmath51 , i.e. @xmath52    for bermudan options , the problem becomes more involved as the option holder has the right to exercise the option at a series of times before maturity .",
    "we make the assumption here that the credit information of the counterparty does not influence the exercise decision of the option holder : the holder makes the exercise decision based on the maximum profit he / she can gain .",
    "so , at each exercise date the holder compares the payoff value with the continuation value of the option , conditioned on the current market information .",
    "once the payoff value is higher , the option will be exercised ; otherwise the holder will hold the option .",
    "suppose that the option holder is allowed to exercise the option at the exercise dates , @xmath53 .",
    "when the option is still active at time @xmath39 , the bermudan option can be computed via @xmath54    we construct the pricing dynamics for barrier options in a similar way .",
    "barrier options become active / knocked out when the underling reaches a predetermined level ( the barrier ) .",
    "there are four main types of barrier options : up - and - out , down - and - out , up - and - in , down - and - in options . here",
    "we focus on down - and - out put barrier options .",
    "a _ down - and - out _ put barrier option is active initially and gets value zero when the underlying reaches the barrier ; if the option is not knocked out during its lifetime , the holder will receive the payoff value at the end of the contract . at time",
    "@xmath39 , when the option is still active , the pricing dynamics are given by , @xmath55 where @xmath56 is the indicator function .",
    "the value of the exposure is defined as the value of the option when the option is still active .",
    "when the option is exercised / knocked out , the exposure value becomes @xmath57 .",
    "the pricing dynamics of the exposure can be put in the following formulas : @xmath58 where @xmath59 represents the exposure at time @xmath39 , @xmath60 .",
    "we define @xmath61 .",
    "once options have been exercised / knocked out at time @xmath39 , the exposure later than time @xmath39 becomes zero .",
    "we present the stochastic grid bundling method ( sgbm ) .",
    "sgbm is based on _ simulation _ , _ bundling _ and _ regression_. a stochastic grid is defined via generation ( simulation ) of a large number of stochastic paths , where we can determine the empirical distribution of the state variable at each future time point . denote the values of the state variables of the @xmath62-th path at time @xmath39 as @xmath63 , @xmath64 , and once we computed the exposure values of these scenarios at times @xmath39 , @xmath65 the values of the ee function can be approximated by @xmath66 where @xmath67 represents the number of paths .",
    "the values of the pfe function can also be approximated by the corresponding quantiles based on the realized exposure values of the generated scenarios .",
    "the exposure profiles presented in formula ( [ eq : ee1 ] ) are values without discount factor .",
    "however , for pricing cva , it is the discounted exposure value that is needed . when the stochastic interest rate is deterministic , the discounted exposure is the product of the discount factor and ee .",
    "when the interest rate is stochastic , we need to discount the realized values of the generated scenarios as follows : @xmath68 where @xmath69 is the realized interest value at time @xmath70 in the @xmath62-th path .",
    "the option values at the paths at each time point are needed for the calculation of the exposure distribution , and thus the continuation values , defined in ( [ eq : thecontinuation ] ) , of all paths at each time point need to be calculated . in the following sections , we discuss how to approximate the continuation values in sgbm .",
    "option function @xmath46 at time @xmath47 is @xmath71-measurable on a bounded domain @xmath72 , and we approximate it by a simpler function @xmath73 , i.e. @xmath74    the approximation is made by projecting the option onto a polynomial space , where the values are linear combinations of @xmath75 basis functions , defined by @xmath76 where @xmath77 is the order of the polynomial subspace , and @xmath75 represents the number of basis functions .",
    "thus , the approximated option value can be written as @xmath78 where the coefficient set @xmath79 can be determined in least - squares sense by regression when option values at time @xmath47 are available , @xmath80    essentially , formula ( [ eq : leastsqureapproximation ] ) gives the _ best _ approximation on polynomial space @xmath81 of the option function in the @xmath71 norm , which is called the _ projection _ on polynomial space @xmath81 .",
    "notice that approximating a function by interpolation and approximating a function in least - squares sense are two different concepts .",
    "by interpolation , the values of the approximation function are exact at discrete nodes , while when approximating in least - squares sense , we study the approximation in average . in the latter case , we find the projection of the function @xmath82 onto some subspace @xmath83 , denoted by @xmath84 , such that the difference @xmath85 is orthogonal to all functions in subspace @xmath83 @xcite .",
    "the @xmath71 projection does not need to be continuous , or have well - defined nodal values , which is convenient in our case , as the grid nodes have been generated via simulation .",
    "when we approximate the option function by a linear combination of basis functions , the continuation function at the earlier time point can be approximated by a linear combination of conditional expectations of the discounted basis functions , i.e. @xmath86\\notag \\\\ & = \\mathbb{e}^{\\mathbb{q}}\\left[\\sum_{k=0}^{h-1 } \\beta(k ) \\psi_k(\\textbf{x}_{m+1})\\cdot d(t_m , t_{m+1})\\bigg|\\textbf{x}_m\\right ] \\notag \\\\ & = \\sum_{k=0}^{h-1 } \\beta(k)\\mathbb{e}^{\\mathbb{q}}\\left [ \\psi_k(\\textbf{x}_{m+1})\\cdot d(t_m , t_{m+1})\\bigg|\\textbf{x}_m\\right ] \\notag \\\\ & = \\sum_{k=0}^{h-1 } \\beta(k ) \\phi_k(\\textbf{x}_m),\\end{aligned}\\ ] ] where we denote the conditional expectations of the discounted basis functions by @xmath87 , \\quad k=0,\\dots , h.\\ ] ]    in fact , it is easy to see that the span of the series @xmath88 forms a closed subspace of functions in @xmath71 space , denoted as : @xmath89    in other words , we approximate the continuation function on space @xmath90 , and the coefficients are obtained via approximation of the option function at a later time point @xmath47 .",
    "when the basis functions are chosen such that analytic formulas of the corresponding conditional expectations of the discounted basis functions are available , the continuation value can be calculated immediately , and the option value at the same point can be calculated applying formulas ( [ eq : euro ] ) , ( [ eq : bermdan ] ) and ( [ eq : barrier ] ) for european , bermudan or barrier options , respectively .",
    "though there are many possibilities for choosing the set of basis functions for a polynomial space of order @xmath77 , we choose _ monomials _ of degree equal or lower than order @xmath77 as the basis functions .",
    "a _ monomial _ is a polynomial with only one term , which can be defined as a product of powers of variables with non - negative integer exponents .",
    "the degree of a monomial is defined as the sum of all exponents of the variables .",
    "considering an @xmath0-dimensional problem with a polynomial space of order @xmath77 , it is easy to see that the set of monomials with degree less or equal to order @xmath77 is a span of polynomials variable with order @xmath91 is @xmath92 . ] , and the total number of these basis functions is equal to @xmath93 .",
    "it is convenient to construct the polynomial subspace with monomials .",
    "moreover , we then have analytic formulas for the expectations of the discounted monomials : when we use monomials as the basis functions , the conditional expectations of the discounted basis functions are _ discounted moments_. for 2-d dynamics these moment are given in definition [ defn : moments ] .",
    "[ defn : moments ] in a time period @xmath94 $ ] , @xmath95 , conditioned on the information at time @xmath16 , the discounted moments of a state variable @xmath96^t$ ] of order @xmath97 is defined as @xmath98 $ ] .",
    "there is a useful link between the discounted moments and the discounted characteristic function ( dchf ) of the dynamics . by derivatives",
    "w.r.t @xmath99 and @xmath100 , respectively , we find @xmath101    = \\frac{1}{(i)^{p+q}}\\cdot \\frac{\\partial ^{p}\\phi}{\\partial u_1^{p } } \\cdot\\frac{\\partial ^{q}\\phi}{\\partial u_2^{q}}(u_1,u_2;\\textbf{y}_t , t , t ) \\bigg |_{u_1=0,u_2=0},\\end{aligned}\\ ] ] where @xmath102 is the dchf .",
    "the higher - dimensional case can be defined in a similar way .    for the constant basis function ( of degree @xmath57 )",
    ", the discounted first moment equals the zero coupon bond in interval @xmath94 $ ] : @xmath103= \\mathbb{e}^{\\mathbb{q}}\\left[e^{-\\int_{t}^{t}r_udu}\\big |\\textbf{x}_t\\right]= : p(t , t).\\ ] ]    once analytic formulas of the discounted moments are derived , multiplication of the coefficient sets determined at time @xmath47 gives us the formula for approximating the continuation value at time @xmath39 .",
    "the state variable @xmath44 must at least contain the underlying asset information , and we always put the log - asset variable as the first element in the vector that @xmath104^t$ ] , where @xmath105 .",
    "here we present the sensitivity w.r.t the initial asset value @xmath106 , which can be applied for all models discussed in this paper .",
    "it is direct to approximate the sensitivities of the exposure profile in sgbm . at time @xmath39 , the sensitivity _ delta _ ( @xmath107 ) of the ee w.r.t the change in the underlying asset price @xmath106 can be derived by @xmath108 where @xmath109^t$ ] is the @xmath62-th realization at time @xmath39 of the state variable ; applying the chain rule and calculating the partial derivative , we get ] it is easy to derive that : @xmath110 where @xmath111 and @xmath112 , are the volatility and interest rate at time @xmath39 respectively . here",
    "the variance variable and interest rate can be either a constant or a stochastic value . ]",
    "@xmath113    the first - derivative of the exposure profile is defined as : @xmath114 with formula ( [ eq : thecon ] ) , the first derivative of the continuation function w.r.t @xmath115 is approximated by @xmath116 where the coefficient set is the same as in ( [ eq : thecon ] ) .",
    "hence @xmath117 further , we can get an easy formula for gamma ( @xmath118 ) , as @xmath119 * comment * : in a similar way , we are able to calculate rho(@xmath120 ) , which is defined as the sensitivity to the interest rate @xmath121 , and vega(@xmath122 ) , which is the sensitive to the volatility @xmath123 .",
    "however , it is a somewhat involved to calculate vega(@xmath122 ) along the whole time horizon as it is nontrivial to calculate @xmath124 .",
    "there are interesting studies on the convergence and bias of monte carlo based regression methods . in @xcite , clement , lamberton and protter prove the almost surely convergence of the longstaff - schwartz algorithm and determine the rate of the convergence .",
    "other available studies show that there is an upward - bias in the direct estimates , and the result based on the obtained _ optimal _ exercise - strategy is a lower bound estimate of the option price @xcite . in @xcite ,",
    "broadie and cao propose to apply a local simulation to improve the lower and upper bound algorithms and reduce the variance .",
    "when approximating the option value , there are two types of errors appearing @xcite :    * type 1 : the error source is the difference between the true and the approximate option values , as the value is approximated by its projection onto a polynomial space .",
    "this error is related to the properties of the polynomial space ; * type 2 : the error source is the noise in estimating the coefficients via regression based on sampled data , which related to the accuracy of the monte carlo simulation and thus to the number of paths .    we need to reduce the errors of type 1 and type 2 . according to central limit theorem ,",
    "the error of type 2 can be diminished by increasing the number of paths to infinity with probability @xmath125 a.s .",
    "some available results show that the error of type 1 goes to zero when the number of basis functions goes to infinity as well @xcite . in this paper",
    ", we will present an accurate upper bound for the error of type 1 related to the properties of the polynomial space , and give a reasoning for the use of bundles .    in @xcite ,",
    "the discussion is on the error of type 2 .",
    "although it is focused on the longstaff - schwartz method , the analysis can be applied to our method as well . as in @xcite , we add the error of type 2 as a noise term : @xmath126 where when the number of paths @xmath67 is sufficiently large , @xmath127 i.i.d , and independent of variable @xmath128 ; @xmath129 is the true value of the option on the polynomial space , whereas @xmath130 is the approximation of the option with the coefficients set @xmath131 .",
    "we futher define the approximation of the continuation function as : @xmath132,\\end{aligned}\\ ] ] hence @xmath133    we first give a proposition regarding the boundedness of the error of the approximating continuation value by the error of the approximating option value in the @xmath71 norm .",
    "[ prop : estimation2 ] assuming that @xmath134 , the conditional density function satisfies @xmath135 where @xmath136 is the density function conditioned on @xmath44 , @xmath137 is a small error generated by the truncation of the integration range .",
    "the error of approximating the continuation function at time @xmath39 can be bounded by the error of approximating the option function at time @xmath47 as : @xmath138 where @xmath139 is the size of the bounded domain @xmath140 .",
    "proof is given in appendix  [ app : proof1 ] .",
    "proposition [ prop : estimation2 ] ensures that , when the approximation of the option function is accurate , the approximation of the continuation function at an earlier stage will be accurate as well .",
    "the boundedness in proposition [ prop : estimation2 ] includes errors of both type 1 and type 2 .    for error of type 1",
    ", we give two well - known insights , from @xcite and @xcite , which gives a bound of the error by projection onto a linear polynomial space in a 1-d and 2-d domain , respectively .    [ theorem : estimation1 ] in a one - dimensional domain @xmath141 , suppose that the function @xmath142 is twice differentiable , and @xmath143 is the linear polynomial space .",
    "the projection onto the space @xmath143 in interval @xmath141 in the @xmath71 norm satisfies the best approximation result , @xmath144 where @xmath145 is the length of the interval @xmath141 and @xmath146 is the second derivative function .",
    "[ theorem : estimation2 ] in a two - dimensional domain @xmath147 , suppose that the function @xmath148 is twice differentiable , and @xmath149 is the linear polynomial space .",
    "the projection onto the space @xmath149 in interval @xmath147 in the @xmath71 norm satisfies the best approximation result @xmath150 where @xmath145 is a representative size of the mesh and @xmath151 is a 2-d differential operator with mixed derivatives .",
    "the details of the construction of the mesh can be found in @xcite .",
    "theorems [ theorem : estimation1 ] and [ theorem : estimation2 ] provide upper bounds of the error by approximating a function by its projection on a linear polynomial space .",
    "though we do not know much about the properties of the function , the error can be reduced by approximating the function on some discrete subdomains @xmath152 , @xmath153 , @xmath154 , such that @xmath155 , the projection of the function in each subdomain @xmath156 is written as @xmath157 in 1-d notation , the error can be bounded by , @xmath158 where @xmath156 is the size of @xmath156 .",
    "it tells us that the error can be reduced efficiently by approximating the function in subdomains .",
    "theorems [ theorem : estimation1 ] and [ theorem : estimation2 ] give upper bounds for projection on a linear polynomial space ( @xmath159 ) .",
    "we generalize the results to a polynomial space of order @xmath77 , in proposition [ prop : estimation ] .",
    "[ prop : estimation ] in a 1-d interval @xmath147 , suppose that the function @xmath142 is @xmath160 times differentiable , and @xmath81 is a polynomial of order @xmath77 on @xmath147 .",
    "the projection on the space @xmath81 on interval @xmath147 in the @xmath71 norm satisfies the best approximation result as follows @xmath161 where @xmath145 is the length of interval @xmath141 .",
    "proof is given in appendix  [ app : proof2 ] .",
    "proposition [ prop : estimation ] provides a rough estimate of the accuracy of the approximation function in the polynomial subspace @xmath81 for a 1-d problem .",
    "the accuracy depends on the length of the interval , the polynomial order and the value of the @xmath160-th derivative .    in practice ,",
    "the determination of subdomains is done in sgbm by _ making bundles _ from the simulated paths .",
    "we define the subdomains at time @xmath47 by clustering paths into bundles at time @xmath39 .",
    "one aim is to satisfy the assumptions in proposition [ prop : estimation2 ] .",
    "the paths at time @xmath39 are clustered based on criteria , so that the values of paths in the same bundle fall into the same subdomain at time @xmath47 .",
    "when all subdomains are of the same size , the 1-d accuracy can be approximated by    @xmath162    where @xmath163 is the number of bundles .",
    "@xmath164 is the exact projection of the function on the polynomial space within the @xmath165-th bundle . in practice , we estimate it by regression , denoted by @xmath166 , based on cross - sectional data , where the error of type 2 plays its role . we need to ensure that there are enough paths within each bundle , so that the error of type 2 is sufficiently small , otherwise it is meaningless to analyze the error of type 1 .",
    "we propose a _ principle for defining the bundles _ : _ cohesive _ in value and _ equal _ in number . in short , within each bundle , the state variable path values should be as close as possible , and the paths should be distributed into each bundle in a way such that there are sufficient paths within each bundle . in section [ sec : bundles ] , methods of making bundles are presented .",
    "we present the procedure for calculating the exposure values in a backward iteration , starting at final time @xmath38 .",
    "suppose the path generation has finished and the realized values of the state variable of @xmath67 paths at all observation dates @xmath167 are available , denoted by @xmath168 . at time @xmath51 , the exposure values are set to @xmath57 as the contract ended .",
    "the option value of the @xmath62-th path is calculated as @xmath169 , for european , bermudan or barrier options , applying formulas ( [ eq : euro ] ) , ( [ eq : bermdan ] ) and ( [ eq : barrier ] ) , respectively .    at time @xmath170 , the paths are clustered into @xmath163 bundles applying some bundling method , and we denote the @xmath165-th bundle at time @xmath170 by @xmath171 . on a polynomial space of order @xmath77 , where there are @xmath75 basis functions in the span , we can find the best coefficients set via ols regression within the same bundle by minimizing the following expression ,    @xmath172    where the @xmath173-th coefficient at time @xmath170 in the @xmath165-th bundle is denoted by @xmath174 , and thus at time @xmath51 , within the @xmath165-th bundle , the option function can be approximated by @xmath175 with ( [ eq : thecon ] ) , the analytic formula of the approximation of the continuation function at time @xmath170 , @xmath176 where @xmath177 defined in ( [ eq : discountedbasis ] ) represents the corresponding discounted moments .",
    "hence for all paths , the continuation values @xmath178 , @xmath179 , can be calculated directly ; the option values at the @xmath62-th path at time @xmath180 , @xmath181 , and the exposure values , @xmath182 , can be determined as well .",
    "then the iteration goes back with one time step to time @xmath183 , repeating the procedures of bundling and regression for the calculation of the continuation , option and exposure values .",
    "we progress in backward direction until we reach initial time @xmath184 where we have the option / exposure values of all paths along the whole time horizon .",
    "the calculation of the sensitivity values can be done at the same time in the iteration as it requires the same set of coefficients .",
    "the backward calculation procedure is basically the same for european , bermudan or barrier options , except that the pricing formulas for option values differ : we apply formulas ( [ eq : euro ] ) , ( [ eq : bermdan ] ) and ( [ eq : barrier ] ) , respectively , for these options .    when computing exposure profiles for bermudan options , we also need to determine the _ optimal _ early - exercise strategy . at time @xmath39 , if the option has not been exercised , both option and exposure values at each path are set to the corresponding continuation value ; for each path , the payoff value is calculated , and compared with the continuation value to determine whether the option should be exercised , conditioned on the available information . for a specified path ,",
    "if the option should be exercised , the exposure at this path from time @xmath185 on will be equal to zero , and the option value at time @xmath185 is equal to the payoff value .",
    "we store the \" optimal  exercise strategy for all paths and the corresponding cash flow , and estimate the corresponding ee value at a time point by taking the mean of the discounted cash - flow as : @xmath186 where @xmath187 is the _ exercise time _ ( or _ stopping time _ ) of the @xmath62-th path , and the cash flow is the payoff value at time @xmath187 , known as    @xmath188    with @xmath189 the value of the stock of the @xmath62-th path at time @xmath187 .",
    "if the option is not exercised for some paths and expiration dates , then the cash flow value is just zero .",
    "notice that the discount factor needs to be incorporated in the realized values along each simulated path when dealing with stochastic interest rates .    in practice",
    ", we call the ee values calculated via formula ( [ eq : ee1 ] ) the _ direct estimators_. and ee values calculated via formula ( [ eq : ee2dd ] ) based another set of simulated scenarios the _ path estimators_. the detailed procedure calculating the path estimator is as follows :    * in the regression procedure of in the backward iteration , at each time point , the coefficient sets of each bundle are saved ; * we simulate another set of paths of twice the size ; * we calculate backward from time @xmath170 till time @xmath184 : * * at time @xmath39 , make bundles , and use the same coefficient set of each bundle obtained in the first simulation to determine the continuation values of the paths ; * * calculate the option value and determine the exercise strategy at each path at time @xmath39 ; save the exercise strategy of each path and the corresponding cash flow values ; * applying formula ( [ eq : ee2dd ] ) to calculate the ee values based on the obtained \" optimal  exercise strategy .",
    "the path estimator is commonly the lower bound while the direct estimator represents the upper bound @xcite , because of the convexity property of the  max  function .",
    "this is a useful result and we can test the convergence of sgbm by comparing the difference between these upper and lower bounds .    for bermudan options ,",
    "the estimation of the exposure heavily depends on the accuracy of the \" optimal  early - exercise strategy .",
    "there is a discontinuity in the exposure function at the early - exercise point , thus at the exercise date , the exposure value jumps immediately to zero for a specific path when the option is exercised ; if the calculated  optimal `` early - exercise strategy is inaccurate , the difference between the true and the calculated exposure values would be as high as the option value at this time point .",
    "pricing an option at each time point is much less sensitive to the accuracy of the ' ' optimal  early - exercise strategy as the option function is smooth .",
    "as we see , the number of basis functions is equal to @xmath190 , where @xmath0 is the dimension and @xmath77 is the order of the polynomial space",
    ". we will apply bundling to enhance the accuracy .",
    "we consider the 2-d state variable @xmath191^t$ ] , with @xmath192 the log - asset variable and @xmath3 represents the variance variable .",
    "the dynamics are given by the heston stochastic volatility model @xmath193 where @xmath194 is the constant interest rate ; @xmath195 and @xmath196 are brownian motions , and @xmath197 ; the constant parameters @xmath198 , @xmath199 represent the speed and the mean level of the reverting in the volatility process , and @xmath200 is called the vol - of - vol parameter .",
    "the option function is a function of the log - asset price and variance . for orders @xmath201 , the set of basis functions",
    "is presented in table [ tab : basisfunction ] .",
    ".the basis functions and order @xmath77 . [ cols=\"^,<\",options=\"header \" , ]",
    "in this paper we have applied the stochastic grid bundling method ( sgbm ) for the computation of exposure profiles and greek values for asset dynamics with stochastic volatility and stochastic interest rate .",
    "sgbm can be applied for the computation of expected exposure and potential full exposure functions for european , bermudan as well as barrier options .",
    "the algorithmic structure as well as the essential method components are very similar , which makes sgbm a suitable cva valuation framework .",
    "we presented arguments for choosing the basis functions , presented two types of bundling algorithms , and showed sgbm convergence of the direct and path estimator with respect to an increasing number of bundles .",
    "numerical experiments demonstrate its convergence and accuracy .",
    "sgbm is based on the availability of analytic formulas for the discounted moments .",
    "when the sde dynamics belong to the affine class , the discounted moments can be derived directly from the discounted chf . under the hhw model ,",
    "these are not available and we have to resume to approximated moments",
    ". the impact of this on the accuracy of the results is checked .",
    "higher - order polynomials as the basis functions are important when accurate greek values are needed ; otherwise , polynomial order @xmath159 is sufficient for option prices and exposure quantities .",
    "the computational efficiency is impacted by the number of bundles used in sgbm .",
    "a parallelized algorithm will be important for reducing the calculation times .",
    "* acknowledgment * we thank lech a. grzelak , shashi jain , kees de graaf and drona kandhai for very helpful discussions , as well as the cva team at ing bank .",
    "financial support by the dutch technology foundation stw ( project 12214 ) is gratefully acknowledged .",
    "10    j.  gregory , _ counterparty credit risk : the new challenge for global financial markets_. the wiley finance series , john wiley & sons , 2010 .",
    "klein and j.  yang , `` counterparty credit risk and american options , '' _ the journal of derivatives _ , vol .  20 , pp .",
    "721 , 2013 .",
    "y.  shen , j.  van der weide , and j.  anderluh , `` a benchmark approach of counterparty credit exposure of bermudan option under lvy process : the monte carlo - cos method , '' _ procedia computer science _",
    "18 , no .  0 , pp .  1163  1171 , 2013 .",
    "2013 international conference on computational science .    c.  s.  l. de  graaf , q.  feng , d.  kandhai , and c.  w. oosterlee , `` efficient computation of exposure profiles for counterparty credit risk , '' _ international journal of theoretical and applied finance _ , vol .",
    "17 , no .  04 , p.  1450024",
    ", 2014 .",
    "s.  jain and c.  w. oosterlee , `` the stochastic grid bundling method : efficient pricing of bermudan options and their greeks , '' papers , ssrn , sept .",
    "j.  f. carriere , `` valuation of the early - exercise price for options using simulations and nonparametric regression , '' _ insurance : mathematics and economics _ ,",
    "19 , no .  1 ,",
    "pp .  1930 , 1996 .",
    "j.  n. tsitsiklis and b.  van roy , `` regression methods for pricing complex american - style options , '' _ trans .",
    "_ , vol .",
    "12 , pp .",
    "694703 , july 2001 .",
    "f.  longstaff and e.  schwartz , `` valuing american options by simulation : a simple least - squares approach , '' _ review of financial studies _ ,",
    "vol .  14 , no .  1 , pp .  113147 , 2001 .",
    "l.  stentoft , `` value function approximation or stopping time approximation : a comparison of two recent numerical methods for american option pricing using simulation and regression , '' _ journal of computational finance _ , vol .",
    "18 , pp .  156 , 2010 .",
    "m.  broadie , p.  glasserman , and z.  ha , `` pricing american options by simulation using a stochastic mesh with optimized weights , '' in _ probabilistic constrained optimization _ ( s.  uryasev , ed . ) , vol .  49 of _ nonconvex optimization and its applications _ , pp .",
    "2644 , springer us , 2000 .",
    "p.  glasserman and b.  yu , `` simulation for american options : regression now or regression later ?",
    ", '' in _ monte carlo and quasi - monte carlo methods 2002 _",
    "( h.  niederreiter , ed . ) , pp .  213226 , springer berlin heidelberg , 2004 .",
    "l.  grzelak and c.  oosterlee , `` on the heston model with stochastic interest rates , '' _ siam journal on financial mathematics _ ,",
    "vol .  2 , no .  1 , pp .  255286 , 2011 .",
    "m.  pykhtin and s.  zhu , `` a guide to modelling counterparty credit risk , '' _ garp risk review _ , pp .  1622 , july / august 2007 .",
    "d.  brigo , `` counterparty risk faq : credit var , pfe , cva , dva , closeout , netting , collateral , re - hypothecation , wwr , basel , funding , ccds and margin lending , '' papers 1111.1331 , arxiv.org , nov .",
    "d.  lamberton and b.  lapeyre , _ introduction to stochastic calculus applied to finance , second edition_. chapman & hall / crc financial mathematics series , taylor & francis , 1996 .",
    "m.  larson and f.  bengzon , `` piecewise polynomial approximation in 1d , '' in _ the finite element method : theory , implementation , and applications _ , vol .",
    "10 of _ texts in computational science and engineering _ , pp .  122 , springer berlin heidelberg , 2013 .",
    "e.  clment , d.  lamberton , and p.  protter , `` an analysis of a least squares regression method for american option pricing , '' _ finance and stochastics _ , p.  2002 .",
    "m.  broadie and m.  cao , `` improved lower and upper bound algorithms for pricing american options by simulation , '' _ quantitative finance _",
    ", vol .  8 , no .  8 , pp .",
    "845861 , 2008 .    m.  larson and f.  bengzon , `` piecewise polynomial approximation in 2d , '' in _ the finite element method : theory , implementation , and applications _ , vol .",
    "10 of _ texts in computational science and engineering _ , pp .  4569 , springer berlin heidelberg , 2013 .",
    "l.  b.  g. andersen , `` simple and efficient simulation of the heston stochastic volatility model , '' _ journal of computational finance _ ,",
    "11 , pp .  148 , 2008 .",
    "f.  fang and c.  oosterlee , `` a fourier - based valuation method for bermudan and barrier options under heston s model , '' _ siam journal on financial mathematics _ , vol .  2 , no .  1 ,",
    "pp .  439463 , 2011 .",
    "here we provide the proof of proposition  1 .",
    "@xmath202-    \\mathbb{e}^\\mathbb{q}\\left [ \\widetilde v_{m+1}\\left(\\textbf{x}_{m+1}\\right)\\cdot d(t_m , t_{m+1})\\bigg|\\textbf{x}_m\\right]\\right)^2 d \\textbf{x}_m \\notag \\\\        & \\leq \\int_{i_{m}}\\left(\\mathbb{e}^\\mathbb{q }    \\left[\\left(v_{m+1}\\left(\\textbf{x}_{m+1}\\right)- \\widetilde v_{m+1}\\left(\\textbf{x}_{m+1}\\right)\\right)^2    \\cdot \\left(d(t_m , t_{m+1})\\right)^2\\bigg|\\textbf{x}_m\\right]\\right ) d \\textbf{x}_m   \\notag \\\\      & \\leq \\int_{i_{m}}\\left(\\mathbb{e}^\\mathbb{q }    \\left[\\left(v_{m+1}\\left(\\textbf{x}_{m+1}\\right)- \\widetilde v_{m+1}\\left(\\textbf{x}_{m+1}\\right)\\right)^2    \\bigg|\\textbf{x}_m\\right]\\right ) d \\textbf{x}_m   \\notag \\\\        & \\leq \\int_{i_{m } } \\int_{i_{m+1 } }    \\left(v_{m+1}\\left(\\textbf{x}_{m+1}\\right)- \\widetilde v_{m+1}\\left(\\textbf{x}_{m+1}\\right)\\right)^2    f\\left(\\textbf{x}_{m+1};\\textbf{x}_m\\right ) d \\textbf{x}_m d \\textbf{x}_{m+1 }   \\notag \\\\          & \\leq \\int_{i_{m+1 } }    \\left(v_{m+1}\\left(\\textbf{x}_{m+1}\\right)- \\widetilde v_{m+1}\\left(\\textbf{x}_{m+1}\\right)\\right)^2    \\left(\\int_{i_{m } } f\\left(\\textbf{x}_{m+1 } ; \\textbf{x}_m\\right ) d \\textbf{x}_m\\right ) d \\textbf{x}_{m+1 }   \\notag \\\\           & \\leq \\left(\\int_{i_{m+1 } }    \\left(v_{m+1}\\left(\\textbf{x}_{m+1}\\right)- \\widetilde v_{m+1}\\left(\\textbf{x}_{m+1}\\right)\\right)^2     d \\textbf{x}_{m+1}\\right)\\cdot\\left(\\int_{i_{m+1 } }   \\left(\\int_{i_{m } }      f\\left(\\textbf{x}_{m+1 } ; \\textbf{x}_m\\right ) d",
    "\\textbf{x}_m\\right)d \\textbf{x}_{m+1 } \\right)\\notag \\\\     & = ( 1-\\epsilon ) \\|v_{m+1}-",
    "\\widetilde v_{m+1}\\|_{l_2(i_{m+1})}^2 \\cdot h(i_m ) ,    \\end{aligned}\\ ] ] where @xmath203 is the size of the domain @xmath204 , as @xmath205      we approximate function @xmath142 by a polynomial @xmath206 of order @xmath77 on interval @xmath141 , where the residual value is defined as    @xmath207    notice that @xmath208 as @xmath209 .    the error of the best estimation in @xmath71 sense can be bounded when @xmath142 is @xmath210 times differentiable .",
    "choose @xmath210 distinct points , @xmath211 , and apply interpolation , @xmath212 , @xmath213 , such that @xmath214 this implies that we can find a polynomial , such that the residual function @xmath215 .",
    "by rolle s theorem , points @xmath216 exist , so that the first derivative @xmath217 . by induction , @xmath218",
    ", there exist @xmath219 points @xmath220 , from the fundamental theorem of calculus,@xmath218 , we have that for any point @xmath221 in @xmath141 , @xmath222 as @xmath223 , we have following @xmath224 when we square both sides , we obtain @xmath225 and as a result , the @xmath71 norm of @xmath226 in interval @xmath141 is given by , @xmath227 by induction , it is easy to find that    @xmath228",
    "in this appendix we provide the reader with known results about characteristic function . based on these , it is easy to determine ( either by hand or by a computer program ) the discounted moments , needed in sgbm .",
    "@xmath233&= \\left(x_t+\\frac{1}{2\\kappa}\\left(\\bar v - v_t\\right)\\left(1-e^{-\\kappa \\tau}\\right)+(r-\\frac{1}{2}\\bar v)\\tau\\right)e^{-r\\tau } , \\\\",
    "\\mathbb{e}^{\\mathbb{q}}\\left[x_{t}^2\\cdot d(t , t)|\\mathbf{x}_t\\right]&=\\bigg(\\left(x_t+\\frac{1}{2\\kappa}\\left(\\bar v - v_t\\right)\\left(1-e^{-\\kappa \\tau}\\right)+\\left(r-\\frac{1}{2}\\bar v\\right)\\tau\\right)^2 \\notag \\\\    & \\quad\\quad + \\frac{\\bar v}{8\\kappa ^3}\\omega_1+\\frac{v_t}{4\\kappa^3}\\omega_2 \\bigg)e^{-r\\tau } , \\\\   \\mathbb{e}^{\\mathbb{q}}\\left[v_{t}\\cdot d(t , t)|\\mathbf{x}_t\\right]&= \\left(\\bar v+\\left(v_t-\\bar v\\right)e^{-\\kappa \\tau}\\right)e^{-r\\tau } , \\\\   \\mathbb{e}^{\\mathbb{q}}\\left[v_{t}^2\\cdot d(t ,",
    "t)|\\mathbf{x}_t\\right]&=\\bigg(\\frac{v_t\\gamma^2}{\\kappa}\\left(e^{-\\kappa \\tau}-e^{-2\\kappa \\tau}\\right )   + \\frac{\\bar v \\gamma^2}{2\\kappa}\\left(1-e^{-\\kappa \\tau}\\right)^2 \\notag \\\\   & \\quad \\quad + \\left(\\bar v+\\left(v_t-\\bar v\\right)e^{-\\kappa \\tau}\\right)^2\\bigg)e^{-r\\tau } , \\\\   \\mathbb{e}^{\\mathbb{q}}\\left[x_{t}\\cdot v_{t}\\cdot d(t , t)|\\mathbf{x}_t\\right]&= \\bigg((\\bar v+\\left(v_t-\\bar v\\right)e^{-\\kappa \\tau } )   \\left(x_t+\\frac{1}{2\\kappa}\\left(\\bar v - v_t\\right)(1-e^{-\\kappa \\tau})+(r-\\frac{1}{2}\\bar v ) \\tau\\right ) \\notag \\\\   & \\quad \\quad +   \\frac{\\bar v \\gamma^2}{4\\kappa^2}\\omega_3+\\frac{v_t\\gamma^2}{2\\kappa^2}\\omega_4\\bigg)e^{-r\\tau},\\end{aligned}\\ ] ]        the expression for discounted chf of the bshw model is given by : @xmath237 with @xmath238 as in [ app : discountedchfheston ] , and @xmath239 and @xmath240 again the discounted moments are obtained by symbolic computations in matlab .      the expression for the discounted chf for the approximate hhw model , called the h1hw model , is given by@xcite : @xmath241 where the coefficients @xmath238 , @xmath242 and @xmath243 are the same in sections [ app : discountedchfheston ] and [ app : discountedchfbshw ] , and @xmath244 where expressions @xmath245 , @xmath246 and @xmath247 are the same one as for the heston model , and @xmath248 the two integrals appearing above are computed numerically as @xmath249\\left(1-e^{-\\lambda s}\\right)ds    \\approx \\sum_{k=0}^{l-1 } \\mathbb{e}\\left[\\sqrt{v_{(t - k\\delta s)}}\\big|v_t\\right]\\left(1-e^{-\\lambda ( k\\delta s)}\\right)\\delta s , \\\\   g_2(\\tau , v_t)&:=\\int_0^{\\tau}\\mathbb{e}\\left[\\sqrt{v_{t - s}}\\big|v_t\\right]e^{-\\lambda s}ds    \\approx \\sum_{k=0}^{l-1 } \\mathbb{e}\\left[\\sqrt{v_{(t - k\\delta s)}}\\big|v_t\\right]\\left(e^{-\\lambda ( k\\delta s)}\\right)\\delta s,\\end{aligned}\\ ] ] where @xmath250 , @xmath251 , @xmath252 is the number of integration intervals and the conditional expectation of the square root of the variance is given by ( [ eq : varianceexpec ] ) ."
  ],
  "abstract_text": [
    "<S> valuation of credit valuation adjustment ( cva ) has become an important field as its calculation is required in basel iii , issued in 2010 , in the wake of the credit crisis . </S>",
    "<S> _ exposure _ , which is defined as the potential future loss of a default event without any recovery , is one of the key elements for pricing cva . </S>",
    "<S> this paper provides a backward dynamics framework for assessing exposure profiles of european , bermudan and barrier options under the heston and heston hull - white asset dynamics . </S>",
    "<S> we discuss the potential of an efficient and adaptive monte carlo approach , the _ stochastic grid bundling method _ ( sgbm ) , which employs the techniques of _ simulation _ , _ regression _ and _ bundling_. greeks of the exposure profiles can be calculated in the same backward iteration with little extra effort . assuming independence between default event and exposure profiles , we give examples of calculating exposure , cva and greeks for bermudan and barrier options .    </S>",
    "<S> credit valuation adjustment ( cva ) , exposure profiles , european , bermudan , barrier options , stochastic grid bundling method , monte carlo simulation , least - squares - polynomial - approximation , greeks , heston model , heston hull - white - model . </S>"
  ]
}