{
  "article_text": [
    "_ kepler s _ primary science objective is to determine the frequency of earth - size planets transiting their sun - like host stars in the habitable zone .",
    "this daunting task demands an instrument capable of measuring the light output from each of over 100,000 stars simultaneously with an unprecedented photometric precision of 20 parts per million ( ppm ) at 6.5-hour intervals .",
    "the large number of stars is required because the probability of the geometrical alignment of planetary orbits that permit observation of transits is the ratio of the size of the star to the size of the planetary orbit . for earth - like planets in 1-astronomical unit ( au ) orbits about sun - like stars",
    ", only @xmath00.5% will exhibit transits . by observing such a large number of stars , _ kepler _",
    "is guaranteed to produce a robust result in the happy event that many earth - size planets are detected in or near the habitable zone .",
    "the kepler data pipeline is divided into several components in order to allow for efficient management and parallel processing of data .",
    "raw pixel data downlinked from the _ kepler _ photometer are calibrated by the calibration module ( cal ) to produce calibrated target and background pixels  @xcite and their associated uncertainties  @xcite .",
    "the calibrated pixels are then processed by the photometric analysis module ( pa ) to fit and remove sky background and extract simple aperture photometry from the background - corrected , calibrated target pixels  @xcite .",
    "pa also measures the centroid locations of each star in each frame .",
    "the final step to produce light curves is performed in the pre - search data conditioning module ( pdc ) , where signatures in the light curves correlated with systematic error sources from the telescope and spacecraft , such as pointing drift , focus changes , and thermal transients are removed .",
    "additionally , pdc identifies and removes sudden pixel sensitivity dropouts ( spsds ) which result in abrupt drops in pixel flux with short recovery periods up to a few hours , but usually not to the same flux level as before .",
    "these step discontinuities are identified separately from those due to operational activities , such as safe modes and pointing tweaks , and are mended using a sophisticated method described in a companion paper @xcite .",
    "pdc also identifies residual isolated outliers and fills data gaps ( such as during intra - quarter downlinks ) so that the data for each quarterly segment is contiguous when presented to later pipeline modules . in a final step , pdc adjusts the light curves to account for excess flux in the optimal apertures due to starfield crowding and the fraction of the target star flux in the aperture to make apparent transit depths uniform from quarter to quarter as the stars move from detector to detector with each roll maneuver .",
    "output data products include raw and calibrated pixels , raw and systematic error - corrected flux time series , and centroids and associated uncertainties for each target star , which are archived to the data management center and made available to the public through the multimission archive at stsci  @xcite .",
    "a companion paper describes the details of overall pdc architecture  @xcite .",
    "data is then passed to the transiting planet search module ( tps )  @xcite where a wavelet - based adaptive matched filter is applied to identify transit - like features with durations in the range of 1 to 16 hours .",
    "light curves with transit - like features whose combined signal - to - noise ratio ( snr ) exceeds 7.1@xmath1 for a specified trial period and epoch are designated as threshold crossing events ( tces ) and subjected to further scrutiny by the data validation module ( dv ) .",
    "dv performs a suite of statistical tests to evaluate the confidence in the transit detection , to reject false positives by background eclipsing binaries , and to extract physical parameters of each system ( along with associated uncertainties and covariance matrices ) for each planet candidate  @xcite .",
    "after the planetary signatures are fitted , dv removes them from the light curves and searches over the residual time series for additional transiting planets .",
    "this process repeats until no further tces are identified .",
    "the dv results and diagnostics are then furnished to the science team to facilitate disposition by the follow - up observing program ( fop )  @xcite .",
    "_ kepler _ is opening up a new vista in astronomy and astrophysics and is operating in a new regime where the instrumental signatures compete with the minuscule signatures of terrestrial planets transiting their host stars .",
    "the dynamic range of the intrinsic stellar variability observed in the _ kepler _ light curves is breathtaking : rr lyrae stars explosively oscillate with periods of approximately 0.5 days , doubling their brightness over a few hours .",
    "some flare stars double their brightness on much shorter time scales at unpredictable intervals . at the same time , some stars exhibit quasi - coherent oscillations with amplitudes of 50 ppm that can be seen by eye in the raw flux time series @xcite .",
    "the richness of _ kepler s _ data lies in the huge dynamic range for the variations in intensity by 4 orders of magnitude and the range of time scales probed by the data , from a few minutes for sc data to weeks , months , and ultimately , to years .",
    "given that _",
    "kepler _ was designed to be capable of resolving small 100-ppm changes in brightness over several hours , it is remarkably rewarding that it is revealing so much more .",
    "the challenge is that an instrument so sensitive to the amount of light from a star striking a small collection of pixels is also very sensitive to small changes in its environment .",
    "the systematic errors observed in _ kepler _",
    "light curves exhibit a range of different time scales , from a few hours to several days to many days and weeks .",
    "such phenomena include , for example , temperature variations of the reaction wheel housing over the 3 day momentum managements cycles and the resultant focus changes of @xmath02.2 @xmath2 m per @xmath3c .",
    "large thermal effects can be observed in the science data for @xmath05 days after recovering from intermittent safe modes , and for @xmath03 days after attitude changes required to downlink the data each month which is due to different sides of the spacecraft being heated during downlinks and subsequent thermal recoveries .",
    "another prominent systematic is differential velocity aberration ( dva ) and the orbital period which results in gradual trends in the data over each quarter .",
    "the principle objective of pdc is to remove these systematic effects by _ _",
    "cotrending__. the fact that most systematics such as these affect all the science data simultaneously , though to differing degrees , provides significant leverage in dealing with these effects .",
    "it is standard practice when removing systematic errors in stellar data to use robust least - squares ( ls ) on a set of basis vectors as is used in methods such as sysrem  @xcite and tfa  @xcite . a robust least - squares approach , as outlined below in section  [ ss : map ] ,",
    "can find a chance linear combination of the systematic error model components that reduces the bulk root mean square ( rms ) at the expense of distorting the intrinsic stellar variations and introducing additional noise on short timescales .",
    "the fundamental problem with this approach is the fact that the implicit model fitted to the data for each star is incomplete .",
    "least - squares cotrending projects the data vector onto the selected basis vectors and removes the components that are parallel to any linear combination of the basis vectors .",
    "this process is guaranteed to reduce the bulk rms residuals , but may do so at the cost of injecting additional noise or distortion into the flux time series . indeed , this occurs frequently for stars with high intrinsic variability , such as rr lyrae stars , eclipsing binaries , and classical pulsators . for example , if one of the model terms is strongly related to focus variations and the long - term trend is for the width of the stellar point spread function ( psf ) to broaden over the observation interval , then the flux for all stars should decrease over time .",
    "a least - squares fit , however , may invert the focus - related model term for a star whose flux increases over the observation interval , thereby removing the signature of intrinsic stellar variability from this light curve because there is a _",
    "correlation between the observed change in flux and the observed change in focus .",
    "given that the star would be expected to dim slightly over time , if anything , due to the focus change , pdc should be correcting the star so that it brightens slightly more than the original flux time series would indicate .",
    "the situation is analogous to opening a jigsaw puzzle box and finding only 30% of the pieces present .",
    "least - squares gamely tries to put the jigsaw pieces together in order to match the picture on the box cover by stretching , rotating , and translating the pieces that were present in the box .",
    "the result is a set of pieces that roughly overlap the picture on the box cover , but one where the details do nt necessary match up well , even though individual pieces may obviously fit . in order to improve the performance of robust ls",
    ", we need to provide the fitter with constraints on the magnitudes and signs of the fit coefficients .",
    "these constraints can be obtained by using the ensemble behavior of the stars to develop an _ empirical _ model of the underlying physics .",
    "for example , the photometric change that can be induced by a pointing change of 0.1 arcsec must be bounded , and this bound can be estimated by looking at how the collection of stars behaves for a pointing change of this magnitude .    as an example of this analysis and to demonstrate systematic trends in the _ kepler _ data ,",
    "take channel 2.1 which is the most thermally sensitive ccd channel in _",
    "kepler s _ focal plane .",
    "nearly all stars on this channel exhibit obvious focus- and pointing - related instrumental signatures in their pixel time series and flux time series . figure [ fig : typicalstarson2.1 ] shows several characteristic light curves for typical targets on channel 2.1 during the _ kepler _ quarter 7 data season normalized by the median flux value .",
    "note the long - term increase for all flux curves over the 90-day interval .",
    "this is due to seasonal changes in the shape of the telescope and therefore its focus as the sun rotates about the barrel of the telescope while the spacecraft orbits the sun and maintains its attitude fixed on the field of view ( fov ) .",
    "all light curves exhibit these long term trends but to differing degrees . also present",
    "are some short - term oscillations evident but mainly obscured in variable targets , which are due to focus changes driven by a heater cycling on and off to condition the temperature of the box containing reaction wheels 3 and 4 on the spacecraft bus .",
    "this component was receiving more and more shade throughout this time interval and the thermostat actuated more frequently over time .",
    "a target that is varying on levels and periods similar to these systematic effects can obscure the systematics making identification difficult .    looking at a single quiet target shown in figure  [ fig : veryquietstar ] ( the same target shown in solid blue in figure  [ fig : typicalstarson2.1 ] )",
    "allows us to more clearly see the systematic trends which are exhibited in all the targets in figure  [ fig : typicalstarson2.1 ] but obscured by variability .",
    "each earth point , one at the beginning of the quarter ( cadence index 0 ) and after each monthly downlink ( cadences  1500 and  2800 ) results in a heating of different sides of the telescope as the spacecrafts reorients the antennae to downlink data .",
    "the earth points themselves are gaps in the data .",
    "they result in periods of local heating and cooling distorting the telescope .",
    "a characteristic recovery time is also evident .",
    "the other trends as described above are also clearly evident .",
    "a final short data gap is also evident at cadence 3950 , but this was not due to a reorientation of the spacecraft so no thermal recovery is present .    as a counter example , figure  [ fig : verynoisystar ] shows the same highly variable target in solid black in figure  [ fig : typicalstarson2.1 ] .",
    "notice how this highly variable star almost completely obscures the long term trend .",
    "the targets shown in figures  [ fig : veryquietstar ] and [ fig : verynoisystar ] will hereby be referred to as the _ quiet target _ and the _ variable target _ and used as canonical example targets in section  [ s : empbayesian ] .",
    "how can we separate intrinsic stellar variability from instrumental signatures ? we do not expect intrinsic stellar variability to be correlated from target to target , except for rare coincidences , and even then one would not expect a high degree of correlation for all time scales .",
    "however , we _ do _ expect instrumental signatures to be highly correlated from target to target and can exploit this observation to provide constraints on the co - trending that pdc performs .",
    "figure [ fig : rawcorrelationhist ] shows a histogram of the absolute value of the correlation coefficient for 1864 targets on channel 2.1 .",
    "the targets light curves are highly correlated as evidenced by the near complete pile - up near an absolute correlation coefficient of 1 .",
    "examination of individual light curves indicates that these light curves are contaminated to a large degree by instrumental signatures , as evidenced in figures [ fig : typicalstarson2.1 ] and [ fig : veryquietstar ] .",
    "but not all the targets are dominated by systematic errors .",
    "the trick is to come up with a method that can distinguish between intrinsic stellar variability and chance correlations with linear combinations of the diagnostic time series used to co - trend out systematic errors .",
    "a bayesian approach called the maximum a posteriori ( map ) method allows us to provide pdc with constraints on the fitted coefficients to help prevent over - fitting and distortion of intrinsic stellar variability . in this exposition",
    "we follow the notation of @xcite .",
    "the pdc - map technique examines the behavior of the robust least - squares fit coefficients across an ensemble of targets on each ccd readout channel in order to develop a description for the `` typical '' value for each model term . this description is a probability density function ( pdf ) that can be used to constrain the coefficients fitted in a second pass . to develop this approach , we build on a maximum likelihood approach .",
    "the maximum likelihood approach models each light curve , @xmath4 , as a linear combination of instrumental systematic vectors , referred to as _ cotrending basis vectors _ or cbvs , arranged as the columns of a design matrix , @xmath5 , plus zero - mean , gaussian observation noise , @xmath6 :    @xmath7    the maximum likelihood estimator ( mle ) seeks to find the solution , @xmath8 , that maximizes the likelihood function , @xmath9 , given by @xmath10 , \\label{eq : mle}\\ ] ] where @xmath11 is the covariance of @xmath12 and @xmath13 is the number of data points . taking the gradient of the log of equation [ eq : mle ] , setting it equal to zero , and solving for @xmath14  yields the familiar least - squares solution ,",
    "@xmath15 this solution assumes the model @xmath16 is a complete model to the data .",
    "we will show that the bayesian model accounts for an incomplete model which is the common case when removing systematics from stellar signals .",
    "adopting the bayesian approach allows us to incorporate side information , such as knowledge of prior constraints on the model , in a natural way .",
    "bayesianists view the underlying model as being drawn from a distribution and the data as being one realization of this process . in this case",
    "we wish to find the maximum a posteriori ( map ) estimator of the model coefficients given the observations ( data ) : @xmath17 where we ve applied bayes rule  @xcite to simplify the expression . in this equation , @xmath18 is the _ prior pdf _ of the model coefficients .",
    "the mathematical form for @xmath19 is the same as for the non - bayesian likelihood function @xmath9 in equation [ eq : mle ] .    for illustration purposes ,",
    "if we adopt a gaussian form for the coefficient distribution , @xmath20 , then @xmath21 takes a closed form solution , @xmath22 , \\label{eq : gaussianprior}\\ ] ] where @xmath23 and @xmath24 are the covariance and mean of @xmath14 , respectively , and we assume that the coefficients are uncorrelated ( which will hold true for orthogonal basis functions ) , we can then maximize equation [ eq : mapdefinition ] , using equation  [ eq : gaussianprior ] , by maximizing its log likelihood , @xmath25 =   \\ln [ p({\\ensuremath{\\mathbf{y}}}|{\\ensuremath{\\boldsymbol{\\theta } } } ) ] + \\ln [ p({\\ensuremath{\\boldsymbol{\\theta } } } ) ]",
    "\\\\ = -\\frac{n}{2 } \\ln \\left ( 2 \\pi \\right ) - \\frac{1}{2 } \\ln \\left| { \\ensuremath{\\mathbf{c}}}_{{\\ensuremath{\\mathbf{w } } } } \\right|    -\\frac{1}{2 } \\left({\\ensuremath{\\mathbf{y}}}- { \\ensuremath{\\mathbf{h}}}{\\ensuremath{\\boldsymbol{\\theta}}}\\right)^t { \\ensuremath{\\mathbf{c}}}_{{\\ensuremath{\\mathbf{w}}}}^{-1 } \\left({\\ensuremath{\\mathbf{y}}}- { \\ensuremath{\\mathbf{h}}}{\\ensuremath{\\boldsymbol{\\theta}}}\\right )",
    "\\\\   -\\frac{m}{2 } \\ln \\left ( 2 \\pi \\right ) - \\frac{1}{2 } \\ln \\left| { \\ensuremath{\\mathbf{c}}}_{{\\ensuremath{\\boldsymbol{\\theta } } } } \\right|    -\\frac{1}{2 } \\left ( { \\ensuremath{\\boldsymbol{\\theta}}}- { \\ensuremath{\\boldsymbol{\\mu}}}_{{\\ensuremath{\\boldsymbol{\\theta } } } } \\right)^t { \\ensuremath{\\mathbf{c}}}_{{\\ensuremath{\\boldsymbol{\\theta}}}}^{-1 }   \\left({\\ensuremath{\\boldsymbol{\\theta}}}- { \\ensuremath{\\boldsymbol{\\mu}}}_{{\\ensuremath{\\boldsymbol{\\theta } } } } \\right ) .",
    "\\label{eq : loglikelihoodmap}\\end{gathered}\\ ] ] taking the gradient of equation  [ eq : loglikelihoodmap ] with respect to @xmath14 , setting it to zero , and solving for @xmath14  yields @xmath26 if the observation noise , @xmath12 , is zero - mean , white gaussian noise with variance @xmath27 , then equation [ eq : fullmapsolution ] can be rewritten as @xmath28    the key to this bayesian technique is to determine when to preference , or weight , the prior pdf over the conditional pdf .",
    "if the variance in the data is large compared to the `` spread '' allowed by the prior pdf for the model , then the map estimator gives more weight to the prior so that @xmath29 as @xmath30 .",
    "this case would correspond , for example , to targets with large stellar variability such as with the target given in figure  [ fig : verynoisystar ] . in this case , the map weighting constrains the fitter from distorting the light curve and introducing noise on a short time scale .",
    "conversely , if the variance in the data is small compared to the degree to which the prior pdf confines the model , the map estimator `` trusts '' the data over the prior knowledge and @xmath31 as @xmath32 .",
    "this case would correspond to targets with small stellar variability such as with the target in figure  [ fig : veryquietstar ] where there is little risk of over - fitting and distortion of the light curves and it is a `` safe '' bet to use the conditional , least - squares fit .",
    "the above analytical solution to the bayesian posterior pdf restricts the prior pdf to a gaussian form .",
    "there is no a - priori reason to make this assumption and in general , since we are developing an _ empirical _ prior pdf , the least number of analytical constraints on the form , the more complete will be the empirical model .",
    "if a gaussian form to the prior is no longer assumed then the prior formalism in equation  [ eq : gaussianprior ] can no longer be used .",
    "we can , however , still take the log form of equation  [ eq : mapdefinition ] to obtain @xmath33 using the maximum likelihood estimator in equation  [ eq : mle ] for @xmath19 , removing the constant terms , inserting a weighting parameter and using normalized light curves , @xmath34 , we obtain @xmath35 , \\label{eq : mapempiricalsoln}\\ ] ] where we assume the observation noise , @xmath6 , is zero - mean , white gaussian noise and has variance @xmath27 . since @xmath21 is no longer in closed form , the `` spread '' in the prior pdf ( i.e. the covariance of @xmath20 , @xmath23 in equation  [ eq : simplifiedmapsolution ] ) can no longer be expressed succinctly . in its stead ,",
    "a _ generalized weighting parameter _ , @xmath36 , is used to characterize the `` spread '' in the prior pdf .",
    "equation  [ eq : mapempiricalsoln ] must now be evaluated numerically .",
    "the overall flow of the algorithm is shown in figure  [ fig : map_flowchart ] .",
    "we start by normalizing the flux light curves and calculating a relative stellar variability .",
    "we then find basis vectors using svd based on a reduced set of flux light curves where cuts are made on target - to - target correlation and stellar variability .",
    "a robust least - squares fit is then performed on each target using the basis vectors just found .",
    "this ensemble of _ robust fit coefficients _ is used to generate the prior pdf .",
    "the conditional pdf is also found based on the same basis vectors .",
    "once both prior and conditional pdfs are found they are combined to generate the posterior pdf where a weighting parameter , based on the stellar variability and the `` goodness '' of the prior fit , is used to weigh the prior relative to the conditional pdf .",
    "details are elucidated in the following subsections .",
    "the cotrending basis vectors are obtained using singular value decomposition . in order to have equal representation for all light curves independent of their absolute magnitude",
    ", we first normalize the targets by their median flux values ( @xmath37 ) .",
    "we then select the 50% most highly correlated targets based on the median absolute pearson correlation .",
    "this cut generates a set that exhibits the strongest trends in the data .",
    "it mostly removes targets with large variability but not completely .",
    "a variable star exhibiting a strong trend can still remain in the reduced list .",
    "we therefore first make a cut on the estimated variability of each target .",
    "an estimate of the intrinsic stellar variability of each target must be found .",
    "herein lies the fundamental chicken - and - egg problem of the cotrending method .",
    "we need to know the stellar variability of each target in order to know how much to rely on the prior .",
    "but if we already knew the stellar variability then we would have no need for the prior  the cotrending solution would simply be the intrinsic stellar variability subtracted from the light curve , minus a gaussian noise estimate .",
    "this issue is not specific to this particular cotrending method either .",
    "whenever a system is characterized with an incomplete model there exists the problem of identifying the components in the system not represented in the model .",
    "we fortunately do not need to absolutely know the variability , we only need an estimated metric in order to weigh the prior . this estimate can be obtained by comparing a third - order polynomial to the light curve .",
    "the polynomial will remove any long term trends leaving behind a _ roughly _ detrended curve .",
    "the standard deviation of this polynomial removed light curve results in a rough calculation of the variability of the target . removing a low - order polynomial is essentially a high - pass filter , we are therefore assuming any long term trends are systematic and short term trends are stellar .",
    "there are numerous counter - examples of short term trends that are actually systematic  reaction wheel zero crossingsn is a good example .",
    "however , short term systematic trends tend to be small in magnitude whereas long term systematics tend to result in large diversions in the flux amplitude .",
    "likewise , there are examples of intrinsic long - term trends but they are generally smaller than the systematic trends . since we are only concerned with the _ relative _ amplitude of stellar versus systematic variability , we are using the low pass filter to distinguish two characteristic realms of influence : long term trends dominated by systematics and short term trends dominated by intrinsic stellar variation .",
    "an example is shown in figure  [ fig : variabilityfit ] . here",
    ", a highly variable target is compounded with a long - term dva and thermal trend . for periods less than @xmath38 cadences the variance in the flux",
    "is dominated by stellar features . the long term variance , and the general trend to higher flux values is due to systematics .",
    "the variance of the residual after removing the polynomial fit , labeled as `` coarsely detrended light curve '' in the figure , gives a _ rough _ estimate of the stellar variability of this target .",
    "note that there are still systematic features in the detrended light curve .",
    "they are however small in magnitude compared to the stellar variability .",
    "the variability , @xmath39 , is measured using @xmath40 where @xmath41 is the standard deviation of the third - order polynomial detrended light curve , @xmath42 is the uncertainty of the flux data as determined by the pa pipeline component  @xcite and @xmath43 is the median variability over all light curves in the sample .",
    "the normalization by the uncertainty is to ensure the noise in the data is not included in the stellar variability .",
    "the normalization by the median variability is so that a variability of 1 is considered typical thereby simplifying the analysis parameterization .",
    "figure  [ fig : variabilityscatter ] shows a histogram of the measured variability for all targets on channel 2.1 .",
    "the median of all of these values is evidently 1 and the distribution is typical for all channels where most are close to typical variability but with a long tail to high variability ( note the log scale for the x - axis ) .",
    "there are two cutoff thresholds plotted as well .",
    "the upper ( in dashed red ) is the threshold to determine if a target is `` highly variable . ''",
    "the lower ( in solid green ) is to determine if a target is `` very quiet . ''",
    "the very quiet targets have such a low amount of variability that using the prior pdf when generating the fit has been found to be problematic .",
    "any targets above the high variability threshold are removed from the reduced list .",
    "the remaining targets are sorted with respect to median absolute correlation and the 50% most highly correlated are used for svd .",
    "due to all targets being normalized by their median , most targets pass through zero amplitude at the midpoint as can be seen as a `` node '' in the light curves at cadence 2200 in figure  [ fig : typicalstarson2.1 ] . if svd was performed on this set , as is , then all the strong cotrending basis vectors would have zero amplitude at the midpoint .",
    "the basis vectors would therefore be unable to remove systematics in the minority of targets that do not pass through zero at the midpoint .",
    "the light curves are therefore _ dithered _ slightly by a zero - mean gaussian dithering magnitude in order to slightly `` spread '' the light curves about the zero flux value . since the dithering is zero mean this has no effect on the resultant basis vectors other than to remove the artificial zero crossing node at the midpoint .",
    "note that the dithering is only used to generate the basis vectors .",
    "the cotrending is performed on the non - dithered , but still median - normalized , light curves .",
    "figure  [ fig : singularvalues ] shows the singular values from the singular value decomposition .",
    "this figure is characteristic of all channels ; 2 or 3 strong singular values , then a slowly tapering region for about another dozen values until finally asymptotically approaching zero ( as is expected with svd ) .",
    "the first several left singular vectors are selected ( typically the first 8) to become the _ cotrending basis vectors_. these first singular vectors exhibit the principle trends in the data due to dva , pointing errors , impulses due to argabrightenings  @xcite , focus errors and reaction wheel zero crossings among other trends .",
    "the number of basis vectors used is generally 8 , however a signal - to - noise ratio test is performed where the snr is determined by @xmath44 @xmath45 and @xmath46 being the root mean square of the light curve and noise floor respectively .",
    "the noise floor is approximated by the first differences between adjacent flux values .",
    "any of the 8 basis vectors with a snr below a threshold of 5 decibels are removed but only a small number of basis vectors over the entire field of view are removed by the snr test .",
    "most have high snr .",
    "there are other sophisticated methods to find the dimensionality of an eigensystem such as bayesian model selection @xcite .",
    "these are not used because they tend to pick too high a dimensionality in this particular situation .",
    "we wish to find only the singular vectors with systematics , the lesser singular vectors do contain light curve signal information , but not necessarily systematics and we have found including them in the map fit adds no value yet slows down the algorithm .    for a minority of basis vectors",
    ", a few target light curves can dominate the signal .",
    "the normalization process attempts to `` equalize '' the strength of all targets , but a small number of light curves can be over - represented in the singular vectors from svd . to eliminate this we calculate an entropy metric for each basis vector using the following entropy calculation @xmath47 where p(x ) is a probability distribution function created from the right singular vectors from svd ( referred to as the _ v - matrix _ ) , @xmath48 the v - matrix contains the contribution of the signal in the basis vector from each target light curve .",
    "we must first normalize the entropy calculation to a gaussian distribution , which has the highest entropy of any continuous distribution with the same 2nd moment .",
    "the entropy of a gaussian is @xmath49 @xmath1 being the 2nd central moment of @xmath50 for fixed @xmath51 .",
    "the resultant relative entropy is therefore @xmath52 if one ( or a few ) targets are domineering then they will have much larger values in the v - matrix then all the other targets .",
    "a negative value of the entropy calculation will identify this condition .",
    "bad entropy is somewhat arbitrary but we have found that a value below @xmath53 is poor . for any basis vectors with identified poor entropy , the v - matrix column for that basis vector is examined for stand - out targets .",
    "the offending targets are removed and svd is re - computed on the remaining targets .",
    "the process is iterated until the entropy of all basis vectors is below @xmath53 . typically , no more than a couple iterations is necessary and fewer than 20 targets are removed ( out of  2500 total targets ) .",
    "figure  [ fig : basisvectors ] shows the first eight cotrending basis vectors generated for channel 2.1 and figure  [ fig : firstbasisvector ] shows just the first basis vector .",
    "trends can be found in all the vectors but it is useful to concentrate on the first , and strongest . here",
    "the most characteristic trends and systematics in the data can be found .",
    "the general trend to higher flux is due to the seasonal change and solar orientation .",
    "the short recovery periods at cadence indices 0 , 1500 and 2800 are due to monthly downlinks .",
    "the short spikes at 700 and 1450 are due to artifacts from correcting cosmic rays near reaction wheel zero crossing periods .",
    "the periodic oscillation is due to heater cycling .",
    "notice how the basis vector in figure  [ fig : firstbasisvector ] closely follows the flux light curve in figure  [ fig : veryquietstar ] .",
    "this signifies that virtually all the features in this flux light curve are due to systematic effects and not intrinsic stellar variability . in theory ,",
    "any features in the light curves in figure  [ fig : typicalstarson2.1 ] that are not represented in the basis vectors in figure  [ fig : basisvectors ] are intrinsic to the target .",
    "however , a simple least - squares projection of the light curves on the basis vectors will not produce desirable results for all targets as will be shown below .    once the cotrending basis vectors are found a robust ls fit is performed on each target .",
    "this creates the empirical data used to generate the prior pdf .",
    "the prior pdf is based on the distribution of robust fit coefficients of the basis vectors for all light curves using the method described in  @xcite .",
    "this method computes a probability density estimate of the sample data based on a normal kernel function using a window that is a function of the number of points in the data sample .",
    "the form of the prior pdf will depend on the parameterization of the robust fit coefficients .",
    "we must thus decide how to parameterize the coefficients to best extract the correlations .",
    "some systematic effects are caused by focal plane irregularities and instrumental vibrations which are stronger near the edges of the ccd frame ( nearer to the spacecraft housing ) .",
    "there are also other issues that are dependent on the physical position of each pixel on the ccd .",
    "therefore , the targets locations in the sky as characterized by right ascension and declination are reasonable parameters to characterize target location with respect to the sources of systematic effects .",
    "the targets influence by systematic effects is also directly related to the stellar magnitude since different magnitude targets result in different saturation levels of the ccd pixels .",
    "for example , the readout electronics for the ccds are sensitive to temperature drift but the sensitivity is non - linear with respect to ccd flux levels .",
    "so brighter targets are affected by instrument temperature differently than dim targets .",
    "we therefore parameterize the prior pdf with three independent variables :    stellar magnitude ( @xmath54 )    right ascension ( ra ) and    declination ( dec )    .",
    "figures  [ fig : coeff2vsk_p ] , [ fig : coeff2vsra ] and [ fig : coeff2vsdec ] show the robust fit coefficients for a basis vector plotted against @xmath54 , ra and dec .",
    "the blue star data is for all targets whereas the red circle data is just for those targets remaining for svd after the cuts discussed in section  [ s : findingbasisvectors ] .",
    "the solid blue and dashed red curves in figures  [ fig : coeff2vsra ] and [ fig : coeff2vsdec ] are the travelling window means of the blue star and red circle data respectively .",
    "the cuts clearly produce a bimodal distribution in @xmath54 for this basis vector .",
    "a simple gaussian fit would not reproduce this and demonstrates that the systematic trends are correlated with @xmath54 but variable targets are masking the true correlation when a simple robust fit is performed .",
    "the correlations in ra and dec are also evident but to a lesser extent .",
    "notice also that the mean ( solid blue curves ) are biased compared to the dashed red .",
    "this is again because the variable targets are masking the true trends in the data .",
    "some basis vectors exhibit stronger trends in @xmath54 , ra or dec but not necessarily all three simultaneously as is expected if the different systematics represented by the basis vectors have different instrumental sources . plotting different basis vectors and/or",
    "channels reveals different trends and correlations .",
    "we want to mainly rely on targets in the neighborhood around the target we are fitting , referred to as the _ target under study _ ( tus ) , in ra , dec and @xmath54 space when generating the prior pdf . if we simply found an evenly weighted pdf then a large cluster of targets with a certain coefficient value , even if non - local to the tus , would always dominate the peak of the prior pdf .",
    "we therefore use a weighted probability density estimate based on the standardized euclidean distance between targets @xmath55 and @xmath4 , @xmath56 where @xmath57 is a diagonal matrix whose diagonal elements give the relative weighting for each dimension .",
    "a straight normalization in each dimension by its standard deviation would result in equal weighting of all three dimensions , but we wish to overemphasize the prior pdf in dimensions that exhibit greater correlations , and in our case , the robust fit coefficients exhibit a stronger correlation in @xmath54 than in ra or dec .",
    "the @xmath57 matrix diagonals are therefore @xmath58 where @xmath59 is the median absolute deviation of the coefficient distribution along dimension @xmath51 and @xmath60 is the scaling factor for dimension @xmath51 , @xmath61 the above weighting results in the @xmath54 dimension weighted twice as much as ra and dec when generating the prior pdf .",
    "that is , targets further away in the @xmath54 dimension are weighted proportionately less than in ra and dec .",
    "this effectively results in taking a tighter cut in @xmath54 space to emphasize the greater correlation in that dimension .",
    "since the pdf is weighted by this distance metric , the pdf will emphasize the correlation in @xmath54 and yet still be sensitive to the trends in ra and dec .",
    "the median absolute deviation is used instead of the standard deviation in order to ignore outliers .",
    "the weighting by equation  [ eq : distancemetric ] and how it affects the prior pdf is illustrated in figures  [ fig : nongausspdf1 ] , [ fig : nongausspdfquiet ] and [ fig : nongausspdfvariable ] .",
    "the later two being the prior pdfs for the same two targets in figures  [ fig : veryquietstar ] and [ fig : verynoisystar ] .",
    "the blue histogram in all three figures is exactly the same since they are generated from the same distribution of coefficients .",
    "however , the prior pdf ( red curve ) is dramatically different . in figure",
    "[ fig : nongausspdf1 ] a bimodal pdf is evident due to targets nearby to the tus containing two clusters , around -1.3 and -0.85 , and suggests that the coefficient value for the tus should be one of these two values .",
    "which value that is actually chosen will be dependent on the form of the conditional pdf and the weighting of the prior pdf as discussed in section  [ ss : findingweighting ] . in figure",
    "[ fig : nongausspdfvariable ] the targets near the tus have coefficients clustered around -0.34 which is far from the peak in the unweighted pdf .",
    "using the unweighted pdf would have completely missed the actual systematic trend in the data near the tus .",
    "the log of the prior pdf is plotted in these figures for direct comparison with equation  [ eq : mapempiricalsoln ] which results in a compression of the pdf near the top .    in summary ,",
    "the prior pdf is developed by generating a 3 dimensional weighted distribution of robust ls fit coefficients in ra , dec and @xmath54 space .",
    "this methodology makes no assumptions on the form of the pdf , gaussian or otherwise , and allows pdc - map to identify and characterize the form of the systematic trends across the full distribution of targets .      for each light curve",
    "the weighting parameter , @xmath36 , in equation  [ eq : mapempiricalsoln ] is an empirical weighting parameter that is principally based on the variability of each target",
    ". the greater the variability the greater we need to constrain the least - squares fit .",
    "however , there is another complication .",
    "a fit to the prior pdf is not always a good fit to the trend in the target .",
    "the reason for this disagreement is currently being investigated .",
    "one factor influencing the `` goodness '' of the prior fit is the sparseness of the targets in certain regions in ra , dec and @xmath54 space .",
    "a sparse distribution will result in poor prior statistics .",
    "there are also other unknown causes resulting in poor priors for some targets and so an additional parameter in the prior weighting is an evaluation of the `` goodness '' of the prior fit .",
    "the goodness is evaluated using a method similar to the variability calculation above .",
    "the prior fit is compared to a 3rd order polynomial fit to the light curve with a soft - wall cutoff using the following equation @xmath62 where @xmath63 is the `` raw '' goodness given by @xmath64 and @xmath65 and @xmath66 are the prior pdf fit and the 3rd order polynomial fit to the data respectively .",
    "normalization by the median absolute deviation ( mad ) of the polynomial fit removed light curve allows for a comparison of the difference between the polynomial fit and the prior fit with respect to the variance of the target .",
    "the soft cutoff is to ensure that small changes in the light curve will not have dramatic changes in the weighting .",
    "the scaling parameter @xmath67 is determined by when the deviation of the prior fit to the polynomial fit becomes too poor to be useful in constraining the posterior fit .",
    "an example of a poor prior fit is given in figure  [ fig : badprior ] .",
    "notice how both the long term trend and the earth - point recoveries are much larger in the prior fit than in the actual data .",
    "examples such as this are in the minority , but frequent enough to require the additional test for prior goodness .",
    "it could be proposed that this target is trending downward cancelling out the upward trend of the prior fit .",
    "this is unfortunately not the case .",
    "examination of kepler season quarters 6 and 8 reveal that this target is not experiencing a general trend in quarter 7 .",
    "the prior fit is indeed poor and should not be used to any large degree .",
    "the unfortunate side effect of the prior goodness test is that _ pdc - map is less sensitive to very long term trends in the data_. a true long term trend in the data that cancels out the systematic trend can confuse the prior goodness metric which would interpret the fit as a bad prior .",
    "the only way to surely know the actual long term trend is to examine multi - quarter data .",
    "future versions of the pdc module may indeed provide this functionality .",
    "the resultant full form to the prior weighting is @xmath68 the parameters @xmath69 and @xmath70 being scaling factors for the variability and prior goodness respectively .",
    "future work includes fully characterizing the conditions where the prior fit is poor and thereby remove the unfortunate need for an empirical prior `` goodness '' metric .    in cases where the prior goodness is near",
    "zero the fit reverts to a reduced robust fit where the number of basis vectors is limited to just the first several ( default is 4 ) . a map fit has the pleasant feature where a large number of basis vectors can be used .",
    "the prior pdf restricts the fit from drifting drastically in function space searching the large set of basis vectors for a combination that reduces the bulk rms at the expense of distorting stellar features .",
    "if the prior can not be used then there is no such restriction and the posterior pdf becomes a least - squares fit , so a more limited number of basis vectors must be used in order to constrain the fit .",
    "the first several basis vectors have very strong trends in most of the data and have low noise components so they are generally safe to use even with an unrestricted least - squares fit .",
    "it is also generally true that a target with a bad prior is so because the target is quiet and any small deviation in the prior from a true trend is very noticeable and the prior is neither necessary or desirable to use .",
    "if the target is below the variability threshold shown in figure  [ fig : variabilityscatter ] then the target is very quiet and in many cases the use of the prior fit only worsens the fit over a least - squares fit and so the prior weighting is zeroed .",
    "this is due to the prior fit never being an exact match to the target trend and even small deviations can `` pull '' the posterior fit away from a good fit . in such cases",
    "there is little risk of a quiet target biasing a least - squares fit away from a proper cotrending fit .",
    "the majority of targets do not fall into either of the above two cases and the prior is used to the degree dictated by the prior weight , and a bayesian map fit is performed .",
    "once the prior weighting is determined the posterior pdf can be assembled using equation  [ eq : mapempiricalsoln ] . due to the empirical , and therefore non - analytical , form of the prior pdf",
    "the posterior must be maximized numerically . in general , a multidimensional maximization is difficult and time consuming due to the risk of only finding local maxima .",
    "fortunately , due to the use of svd , the basis vectors are all orthogonal so the various coefficients @xmath71 can be maximized sequentially .",
    "the process is therefore straightforward .",
    "the strongest singular vector is maximized first and then all subsequent singular vectors are maximized in turn .    following along with the same two examples of a quiet and a variable target ,",
    "figures  [ fig : posteriorquiet ] and [ fig : posteriorvariable ] show the final posterior pdf along with the prior and conditional pdfs .",
    "the black dots and magenta stars are the maxima of the prior and conditional pdfs and the blue circle is the maximum of the posterior pdf . due to the varying scales of the three curves",
    "the prior and conditional curves have been renormalized to the same scale as the posterior for illustration purposes .",
    "the conditional fit has the smooth quadratic form characteristic of a least - squares fit .",
    "the prior appears gaussian on this scale but in general is not .",
    "the title of each plot gives the prior weight .",
    "for the quiet target the variability is low so the prior weight is only 4.65 resulting in a minor correction to the conditional curve and so the conditional and posterior curves are virtually identical .",
    "also , in cases where the width of the prior pdf is large the maximum is low and it makes little contribution to the posterior .",
    "a wide prior is equivalent to saying that the prior information results in little added information to a good fit . the extreme case being a flat prior pdf which provides no additional information .",
    "this is in contrast to the variable target where the conditional maximum is near the prior pdf , meaning the fit almost completely relies on the prior data , due to the high weight on the prior pdf of 976 , resulting in only a slight influence of the conditional fit .    in the case of the variable target in particular ,",
    "if the prior pdf was not determined using a weighted distribution ( in @xmath54 , ra and dec space ) then the maximum of the prior would have been at about 0.6 as shown by the unweighted histogram in figure  [ fig : nongausspdfvariable ] .",
    "this would have resulted in a poor fit to the systematics .",
    "the actual prior fit takes into account the location of the target under study and the systematic trends in targets nearby to the tus .",
    "once the maximum of the posterior pdf is found for each basis vector the map fit is a linear combination of the basis vectors .",
    "the resultant fits are in figure  [ fig : fitquiet ] and [ fig : fitvariable ] . for the quiet target all",
    "three fits roughly overlap the actual trend in the data .",
    "the prior fit is not an exact match and the slight disagreement is to be expected since the prior is purely formulated using targets other than the tus . for a quiet target such as this one highly weighting the prior pdf would result in a degradation of the fit and",
    "so instead the pdf relies mainly on the conditional pdf ( i.e. the red dashed and green solid curves overlap ) .",
    "the resultant light curve after the trend removal is in the bottom figure for both the map fit and the conditional fit , the later being a least - squares fit . for the quiet target notice how the resultant curve is near featureless above the noise floor .",
    "some slight artifacts are not fully removed and methods to correct these are discussed in section  [ s : futureimprovements ] . in the case of the variable target the conditional pdf results in a fit that attempts to remove all features in the light curve , whereas the prior pdf correctly identifies just the systematic trends in the data . in this case",
    "it is beneficial to rely principally on the prior pdf .",
    "the prior can not be well discerned in the figure because it lies under the map fit .",
    "the conditional fit also introduces a considerable amount of noise into the corrected light curve due to it being constructed more from the lesser basis vectors ( shown in figure  [ fig : basisvectors ] ) which contain larger noise components .",
    "propagation of uncertainties is not necessarily straightforward because a covariance matrix is difficult to formulate for an empirical prior pdf . as a first approximation",
    "the propagation can be assumed to be through a least - squares solution  which is close to the solution for most targets .",
    "if @xmath72 and @xmath73 denote the covariance matrices for the temporal samples of the raw and cotrended flux time series for a given target , then the uncertainties may be propagated ( disregarding the uncertainty in the mean level which can be considered to be negligible ) by @xmath74 where the transformation @xmath75 is defined by @xmath76 @xmath77 being the same design matrix as in equation  [ eq : mapempiricalsoln ] .",
    "this is overly conservative since the posterior pdf is more constrained than a simple least - squares fit .",
    "a more accurate propagation of uncertainties would take into account the attenuation of the uncertainties due to the prior pdf .",
    "the algorithm as presented works phenomenally well for the majority of light curves in the kepler fov .",
    "overall pdc performance is discussed in a companion paper  @xcite .",
    "however , problems do arise .",
    "remediations to these problems are discussed in this section .",
    "one of the main issues with the current method is different types of systematic effects are represented in each basis vector shown in figure  [ fig : basisvectors ] .",
    "for example , the long term trends associated with dva and seasonal changes should not be represented by the same basis vectors as heater cycles and earth point thermal recoveries .",
    "given that these different systematics behave on different time - scales a reasonable solution is to band - split the light curves and generate separate basis vectors for each band .",
    "this method is currently in development .",
    "the current method relies solely on singular value decomposition to generate the basis vectors after cuts on quiet and correlated targets .",
    "svd is a reliable and often used tool to generate basis vectors that describe highly correlated trends in data .",
    "however , it does have its detractions . for non - gaussian systematic trends , svd is not ideal .",
    "methods such as independent component analysis as described in  @xcite can potentially better de - convolve independent systematic sources .    occasionally a single target can dominate one or more basis vectors . the resulting basis vectors essentially contain all stellar variability and noise of the offending target making the basis vector impotent in removing systematics .",
    "the entropy cleaning step removes the offending targets , but the source of the problem is partially a result of the normalization by the median value of each light curve . for the small number of dim targets with appreciable noise , the noise is overly represented in the basis vectors .",
    "normalization by the standard deviation or noise floor of the light curves would limit the problem of over - represented targets , however at the expense of not equally normalizing the light curves by flux intensity which can introduce other problems .",
    "we have also discovered that over the channel field of view groups of targets exhibit similar systematics that are distinct from other targets so specific clusters of targets can be identified with similar trends .",
    "using the same basis vectors for all targets is not ideal in this situation .",
    "we are investigating using a hierarchical clustering method such as described in  @xcite to isolate the clusters and develop basis vectors separately for each cluster .",
    "the prior pdf generation is based on correlations in stellar magnitude , right ascension and declination but in some targets the prior is poor .",
    "it is to be expected that systematics are also correlated with other stellar and instrumental parameters .",
    "a full parametric study finding these correlations is to be performed to identify hidden variables that further characterize the systematics .",
    "one strongly suspect hidden variable is sub - pixel centroid motion .",
    "kepler collects both long cadence data at @xmath030 minute intervals and short cadence data at @xmath060 second intervals .",
    "no more than 512 short cadence targets are collected at any time and are spread over the entire field of view so the number of short cadence targets per channel is small and at most about a dozen .",
    "a dozen is too small of a sample for the prior pdf to be properly formulated .",
    "we are investigating ways to extend pdc - map to short cadence data .",
    "options include using the prior pdf from long cadence data and using a single reference ensemble drawn from all 512 targets .",
    "pdc - map dramatically improves kepler s ability to understand the properties of parent stars .",
    "it preserves stellar signals and minimizes the noise while removing the systematic errors that can mask transit signals .",
    "pdc - map therefore ultimately improves kepler s primary mission of detecting earth - like planets .",
    "but pdc - map also improves the kepler data s utility to the broader astrophysical community .",
    "non - planet finding studies such as asteroseismology is greatly benefited by pdc - map s ability to preserve stellar signals in the light curves .",
    "funding for this discovery mission is provided by nasa s science mission directorate .",
    "we thank the thousands of people whose efforts made _ kepler s _ grand voyage of discovery possible .",
    "the kepler science office and science working group work diligently in analyzing data products and have provided great insight into data reduction methods and data processing .",
    "we especially want to thank the _ kepler _ soc staff who helped design , build , and operate the _ kepler _ science pipeline for putting their hearts into this endeavor .",
    "the authors would also like to thank the very productive conversations we have had with the suzanne aigrain group at oxford university , especially stephen reece , stephen roberts and amy mcquillan .",
    "jenkins , j.m . , _",
    "`` planet detection : the kepler mission , '' in advances in machine learning and data mining for astronomy ( eds .",
    "m. way , j. scargle , k. ali , a. srivastava ) , chapman and hall / crc press ( 2011 )"
  ],
  "abstract_text": [
    "<S> with the unprecedented photometric precision of the kepler spacecraft , significant systematic and stochastic errors on transit signal levels are observable in the kepler photometric data  @xcite . these errors , which include discontinuities , outliers , systematic trends and other instrumental signatures , obscure astrophysical signals . </S>",
    "<S> the presearch data conditioning ( pdc ) module of the kepler data analysis pipeline tries to remove these errors while preserving planet transits and other astrophysically interesting signals . </S>",
    "<S> the completely new noise and stellar variability regime observed in kepler data poses a significant problem to standard cotrending methods such as sysrem  @xcite and tfa  @xcite . </S>",
    "<S> variable stars are often of particular astrophysical interest so the preservation of their signals is of significant importance to the astrophysical community . </S>",
    "<S> we present a bayesian maximum a posteriori ( map )  @xcite approach where a subset of highly correlated and quiet stars is used to generate a cotrending basis vector set which is in turn used to establish a range of `` reasonable '' robust fit parameters . </S>",
    "<S> these robust fit parameters are then used to generate a _ </S>",
    "<S> bayesian prior _ and a _ bayesian posterior _ probability distribution function ( pdf ) which when maximized finds the best fit that simultaneously removes systematic effects while reducing the signal distortion and noise injection which commonly afflicts simple least - squares ( ls ) fitting . </S>",
    "<S> a numerical and empirical approach is taken where the bayesian prior pdfs are generated from fits to the light curve distributions themselves . </S>"
  ]
}