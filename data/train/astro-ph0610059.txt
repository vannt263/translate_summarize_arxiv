{
  "article_text": [
    "the polarization of the cosmic microwave background ( cmb ) could provide a unique window into the very early universe if its pattern can decomposed into gradient and curl ( or @xmath4 and @xmath1 ) parts .",
    "the detection of large scale @xmath1-mode polarization would indicate the presence of a stochastic background of gravitational waves left over from the epoch of inflation @xcite .",
    "the amplitude of the background would allow us to directly deduce the energy scale of inflation , dramatically extending our understanding of the history of universe to its very beginnings .",
    "@xmath1-mode polarization on small angular scales is mainly produced by the gravitational lensing of the @xmath4-mode component @xcite .",
    "a detailed measure of these contributions could help us constrain various cosmological parameters such as the equation of state of the dark energy or the mass of the neutrinos .",
    "the clear prospect of studying the birth of our universe and improving constraints on some cosmological parameters using the cmb polarization has led to remarkable progress in detector technology with the promise to deliver the required sensitivity to detect the small @xmath1 polarization signal . in the near future experiments targeting @xmath1-mode",
    "polarization will be performed from the ground or from balloons .",
    "these experiments will cover relatively small fractions of the sky with the aim of producing high fidelity polarization maps that can be decomposed into @xmath4 and @xmath1 .    in a finite patch of sky",
    ", the @xmath4-@xmath1 decomposition framework needs modification .",
    "it is no longer true that any polarization field can be uniquely decomposed into pure @xmath4 and pure @xmath1-modes .",
    "a new set of modes , so - called `` ambiguous '' , needs to be introduced @xcite .",
    "these new modes receive contributions from both @xmath4 and @xmath1-modes . in practice",
    "because the @xmath4 signal is expected to be so much larger than the @xmath1 one , the ambiguous modes will be dominated by @xmath4 signal .",
    "thus all the information about the cosmological @xmath1-modes is contained in the pure @xmath1-modes , which are orthogonal to both pure @xmath4 and ambiguous modes .",
    "the leakage of @xmath4 signal into @xmath1 can be thought of as an additional source of noise on top of that introduced by the detector , but a source of noise that can be eliminated by a suitable choice of variables .",
    "analyzing the data of the next generation of experiments is potentially quite challenging .",
    "measuring the power spectra using a fully optimal likelihood based analysis requires @xmath5 operations and is probably not feasible for this next generation of experiments .",
    "the alternative technique , widely used for cmb temperature experiments , is the pseudo-@xmath0 quadratic method @xcite .",
    "unfortunately in a finite patch of the sky the pseudo-@xmath0 s do not isolate the pure @xmath1-modes before constructing the quadratic estimators . as a result",
    "the quadratic estimator is contamined by the leakage from the ambiguous modes .",
    "this contamination can be removed on average by taking suitable linear combinations of the pseudo-@xmath0 s .",
    "however the leaked power still contributes to the variance of the estimators , significantly degrading their ability to measure the amplitude of the cosmological @xmath1-modes .",
    "recently an improved technique , a pure pseudo-@xmath0 technique was introduced @xcite .",
    "this technique preserves the simplicity of the pseudo-@xmath0 s but at the same time ensures that no @xmath6 mixing occurs .",
    "in @xcite it was also shown that the pure pseudo-@xmath0 s preserve most of the cosmological information in the data .    in this paper",
    "we will look at the pure pseudo-@xmath0 from a new perspective .",
    "our different approach will allow us to understand various features of the pure pseudo-@xmath0 s and also give guidance as to how to choose the weight function that the technique requires .",
    "the main result of the paper , a general ansatz for optimizing the pseudo-@xmath0 weight function given arbitrary signal and noise covariance , is presented in  [ sec : conjecture ] . using this ansatz to generate weight functions in an automated way",
    ", we study several mock surveys , culminating in a realistic simulation of a fiducial experiment , with characteristics based on the upcoming balloon based ebex @xcite .",
    "our simulations have inhomogeneous noise , complicated boundaries and point source masking .",
    "we will argue that the pseudo-@xmath0 estimators give near - optimal power spectrum errors on all angular scales .",
    "this resolves a long - standing practical issue in the pseudo-@xmath0 method : the lack of an algorithm for choosing weight functions in complex situations .",
    "previous studies have had to rely on optimizing weight functions by hand , using expensive monte carlo simulations to compute the estimator variance for each candidate weight function considered . at the same time , we preserve the strong @xmath4-@xmath1 separation of the pure pseudo-@xmath0 method , achieving excellent @xmath1-mode errors even for the low noise levels anticipated for the upcoming generation of cmb polarization experiments @xcite .",
    "first we will introduce our notation .",
    "we will follow closely @xcite .",
    "the ( linear ) polarization of the cmb is described in terms of the stokes parameters @xmath7 and @xmath8 .",
    "the definition of @xmath7 and @xmath8 depends on the coordinate system chosen . in this subsection",
    "we review definitions that are valid for the full sky , so we will use spherical coordinates to define @xmath7 and @xmath8 .    we will follow the notation of @xcite . the stokes parameters can be combined to form a spin-2 combination @xmath9 and a spin-@xmath10 combination @xmath11 . in the full sky",
    "these combinations can be decomposed using spin-2 harmonics , q+iu= _ a _  2 _  & ; &  q - iu= _ a _",
    "2_[decomp ]    it is natural to introduce a scalar ( @xmath4 ) and a pseudoscalar ( @xmath1 ) field to describe polarization .",
    "the expansion coefficients of these two fields in ( ordinary spin-0 ) spherical harmonics are a_= -(a_+a_)/2  & ; &  a_= i(a_-a_)/2 .",
    "[ eb ] these two functions completely characterize any polarization field on the sphere @xcite .",
    "they are important physically because cosmological density perturbations can not create @xmath1-type polarization while gravity waves can @xcite .",
    "the spin-2 harmonics in equation ( [ decomp ] ) can be related to the usual spin-0 spherical harmonics by means of two first - order differential operators , the spin - raising ( @xmath12 ) and spin - lowering ( @xmath13 ) operators @xcite . when applied to the spin - weighted spherical harmonics ,",
    "these operators yield the following identities : 1.0pt-6pt_s_&= & [ ( l - s)(l+s+1)]^1/2  _ s+1 _ + _ s_&= & -[(l+s)(l - s+1)]^1/2  _ s-1_. [ ypym ]    we can show that : [ chidef ] _ e & & [ ( q+iu ) + 1.0pt-6pt1.0pt-6pt(q - iu)]/2 + & = & - _ ^1/2 a _ _ + _ b & & i [ ( q+iu ) - 1.0pt-6pt1.0pt-6pt(q - iu)]/2 + & = & _ ^1/2 a__. [ eq : chib ] thus we can take linear combinations of second derivatives of the stokes parameters and obtain variables that depend only on @xmath4 or on @xmath1 .",
    "we pause to note that the reason why @xmath4 and @xmath1 are the focus of attention instead of @xmath14 , @xmath15 is partly a matter of convention .",
    "perhaps more importantly , @xmath4 and @xmath1 have the same power spectrum on small scales as the stokes parameters , while that of @xmath16 differs by a factor of @xmath17 . as a result",
    "while white noise in @xmath7 and @xmath8 translates into white noise in @xmath4 and @xmath1 , it becomes colored noise for @xmath16 .",
    "if one works over a small patch of sky , one can use the small - angle ( flat - sky ) approximation .",
    "when working in this limit , it is more natural to measure the stokes parameters with respect to a cartesian coordinate system @xmath18 instead of the usual polar coordinate axis . in the flat - sky approximation polarization",
    "is expanded in terms of fourier modes , ( ) & = & e^i , [ fourier ] where @xmath19 and @xmath20 .",
    "the differential operators reduce to simply @xmath21      on a manifold without boundary , any polarization field can be uniquely separated into an @xmath4 part and a @xmath1 part .",
    "but if there is a boundary ( _ i.e. _ , if only some subset @xmath22 of the sky has been observed ) , this decomposition is not unique . in this section",
    "we summarize the results of @xcite .    polarization fields living on @xmath22 form a normed vector space with the inner product [ innerproducteq ] _ ( qq + u u ) d , and we say that two fields @xmath9 and @xmath23 are orthogonal if their inner product vanishes .",
    "we refer to a polarization field as    * @xmath4 if it has vanishing @xmath15 , * @xmath1 if it has vanishing @xmath14 , * pure @xmath4 if it is orthogonal to all @xmath1-fields , and * pure @xmath1 if it is orthogonal to all @xmath4-fields .    on the complete sky , every polarization field can be uniquely represented as a linear combination of an @xmath4 field and a @xmath1 field , and all @xmath4 fields are perpendicular to all @xmath1 fields . in other words ,",
    "the space of all polarization fields is the direct sum of two orthogonal subspaces : the space of all @xmath4 fields and the space of all @xmath1 fields . in this case , there is no distinction between an @xmath4 field and a `` pure @xmath4 '' field .",
    "but if only some subset of the sky has been observed , so that @xmath22 is a manifold with boundary , then this decomposition is not unique",
    ". one way to see this is to note that there are modes that satisfy both the @xmath4-mode and @xmath1-mode conditions simultaneously .",
    "when we split a polarization field into an @xmath4 part and a @xmath1 part , these `` ambiguous '' modes can go into either component . in order to make the @xmath24 decomposition unique",
    ", we must first project out the ambiguous modes .",
    "the existence of ambiguous modes has important implications at the time of measuring the @xmath1-mode power spectrum .",
    "here we concentrate on `` simple '' quadratic methods that make no attempt to filter those ambiguous modes at the level of the map ( such as @xcite ) .",
    "a full likelihood analysis would automatically deal with the ambiguous modes but it will probably be computationally prohibitive",
    ". it might be feasible for low resolution maps , becoming the method of choice for constraining the gravitational wave amplitude @xcite .",
    "it is easiest to understand the issue to focus on the pseudo-@xmath0 method , but the point applies generally . in the pseudo-@xmath0 method one just measures the power spectra of @xmath4 and @xmath1 as one would do in the full sky and simply masks out the unobserved regions . after this procedure",
    "both @xmath25 and @xmath26 spectra are dominated by @xmath4-modes .",
    "an illustrative example is shown in figure [ figleak ] .",
    "we considered a circular region @xmath27 in radius .",
    "the @xmath4 and @xmath1 power spectra were measured by simply masking the unobserved region but otherwise proceeding as if one had a full sky measurement .",
    "the calculation was performed in the flat sky approximation which is adequate for this size region . the input polarization field had @xmath4-modes only . in the figure",
    "we show the measured @xmath1 mode power spectrum spectra , which is produced by leakage of the @xmath4-modes . for comparison",
    "we show the expected @xmath1-mode power spectrum if @xmath28 together with the @xmath1-modes produced by gravitational lensing .",
    "also for reference we plot the detector noise power spectrum for @xmath29 @xmath3k - arcmin and an 8 arcminute beam .",
    "this level of noise is within the range of expected values for the upcoming ebex balloon experiment @xcite .",
    "the pseudo-@xmath0 method then takes linear combinations of the measured @xmath0 s to eliminate the @xmath4-mode contribution in the hopes of revealing the cosmological @xmath1-modes .",
    "the point is that this procedure makes the @xmath1-mode power spectra estimator independent of @xmath4 in the mean , but the variance of the estimator is still dominated by the leaked power .",
    "perhaps an extreme example is helpful to clarify the problem further .",
    "imagine that cosmological parameters were known perfectly so that there is no uncertainty in the @xmath4-mode spectra . then the leaked @xmath1 power is perfectly predicted and can be subtracted from the measured signal to leave an unbiased @xmath30 estimator",
    "this is analogous to what one does with detector noise .",
    "unfortunately just as with noise the variance of the estimator is increased by the leaked power .",
    "the pseudo-@xmath0 technique does even worse than this because it does not assume any knowledge of the @xmath31 so it uses only linear combinations that are on average independent of @xmath4 for any choice of @xmath31 .",
    "( in reality for a small patch this is not possible and some assumptions such as constancy of the @xmath4 power spectrum in bands must be used .",
    "these assumptions are expected to be reasonably well satisfied . )",
    "figure [ figleak ] illustrates the severity of the problem for experiments with noise levels comparable to those of our fiducial experiment ( 5.75 @xmath3k - arcmin ) . the leaked power is larger than the detector noise all the way to @xmath32 , so using the pseudo-@xmath0 technique is clearly wasteful .",
    "note that even on scales where the lensing signal dominates there would be significant degradation .",
    "when trying to measure the @xmath1-mode power spectrum in a finite patch there is a simple way to avoid unwanted leakage from @xmath4-modes : estimate the power spectrum starting from the @xmath15 map . in the next section we will show that this is mathematically equivalent to the pure pseudo-@xmath0 technique . it is important to realize that in practice no information is being lost by doing this . by construction @xmath15",
    "has no contribution from either pure @xmath4-modes or ambiguous modes .",
    "although in principle there is some information on the amplitude of @xmath1-modes in the ambiguous modes , in practice that signal is completely swamped by the contribution of the @xmath4-modes so there is no real loss of information by working with @xmath15 .",
    "perhaps an analogy helps at this point .",
    "one could consider a scalar field , like the cmb temperature , and wonder whether there is any loss of information if one were to compute the laplacian of the map and extract the power spectrum from that . in the full sky",
    "there would be no loss of information but in a small patch one would lose . in the full sky",
    "there is a one to one relation between the laplacian map and the underlying temperature map ( except for the monopole and dipole which are lost when one takes the laplacian , but they do not carry cosmological information ) ; the only difference is that both signal and noise power spectra will be multiplied by @xmath33 which does not alter how well one can constrain each multipole . in a finite patch",
    "the situation is different because there are non - zero temperature fields on the finite patch that can have zero laplacian .",
    "those modes are filtered out by the `` laplacian - technique '' with the resulting loss of information . in our case",
    "the analogue of the modes that are being filtered out are the ambiguous modes which we want to remove anyway .",
    "thus for constraining the @xmath1-mode amplitude , starting with the @xmath15 field is sufficient .",
    "of course the fact that the @xmath15 map contains for practical purposes all the cosmological information does not mean that if we extract its power spectrum in a non - optimal way we will still conserve all the information in the data .",
    "if in practice ( as we will do in later sections ) we use a pseudo-@xmath0 technique to extract power spectra , it may be that allowing some leakage is still advantageous .",
    "as long as the leaked power is small compared to the detector noise it is most certainly harmless .",
    "we will see that it is indeed the case that small amounts of leakage are preferred by our technique .",
    "we will postpone discussion of this point to later .    once we conclude that measuring the power spectrum starting from @xmath15 avoids the unwanted leakage there are various technical issues one needs to address to implement such a method in practice .",
    "moreover , we will show that this technique is mathematically equivalent to the pure pseudo-@xmath0 technique and we will find it easier to implement our algorithms using that perspective .",
    "we do want to comment on two aspects ; first , in practice one needs to take the derivatives by finite differencing which will introduce some error and residual leakage .",
    "this residual leakage will constrain the choice of pixelization .",
    "we discuss this in more detail in appendix  [ finite ] .",
    "second , the @xmath15 field has a very blue spectrum which will affect standard estimation techniques .",
    "we will discuss this second issue here because it will illuminate our discussions down the line .",
    "the additional derivatives needed to construct @xmath15 make its power spectrum very blue .",
    "we will show in this section that this induces high levels of aliasing unless appropriate apodizations are used .",
    "thus apodization will be an integral part of any technique that starts with @xmath15 .    to understand the issue it is best to write down the formulas in the flat sky approximation .",
    "we assume that the stokes parameters have been measured in a certain region of the sky and that @xmath15 was calculated by finite differencing",
    ". then the @xmath15 field is multiplied by a window function @xmath34 ( in real space ) and the fourier components of @xmath35 are measured and squared to estimate the power spectrum . the weight @xmath34 is zero outside the observed patch .",
    "if derivatives are taken using nearest neighbors , one also loses an additional pixel around the edge of the map .",
    "note that this loss is directly related to the counting of ambiguous modes as described in @xcite .",
    "the resulting power estimates are the convolution of the @xmath15 power spectrum and the fourier transform of the window , c_^_b = || ( - ^)||^2  c_l^^_b .",
    "[ cl ] the @xmath15 power spectrum is now so blue that unless the window function decreases fast with @xmath36 , all estimates of power will be dominated by the small scale modes .    one way of seeing why this is a problem is to consider normalizing the window such that @xmath37 .",
    "the estimator in equation ( [ cl ] ) estimates the power at @xmath38 but has aliasing from other modes .",
    "even if one considered the idealized situation in which the higher @xmath36 power spectra were known so that the aliasing could be calculated and subtracted , the aliased power would still contribute to the noise of the estimator . if the aliased power dominates the integral in eq .",
    "( [ cl ] ) , the additional variance is large compared to the signal one is after with the resulting loss of information .",
    "thus one would want to avoid having such aliasing if possible .",
    "the high @xmath36 behavior of @xmath39 is directly related to the number of normal derivatives of @xmath34 that vanish at the boundary of the patch .",
    "l || ( )||^2 l^-2(n+2 ) , [ eq : nderivs ] where @xmath40 is the number of derivatives of the window that vanish at the boundary with @xmath41 meaning that the window itself is continuous . thus requiring that equation ( [ cl ] ) converges requires using a window that is smoother at the boundary .",
    "for example if we compare measuring the power spectra of the stokes parameters without apodization to measuring the power spectrum of @xmath15 , compensating the additional @xmath42 factor in the @xmath15 spectrum requires having both the window and its first derivative vanish .",
    "reducing the aliasing requires considering weights that decrease continuously to zero as one gets to the border ; on the other hand , if too much apodization is used , then one is effectively using a smaller patch of sky thus decreasing the signal to noise .",
    "we will use an improved version of this argument to find an optimal choice of @xmath34 in section [ sec : conjecture ] .",
    "here we just want to mention that when dealing with @xmath15 , because of its very blue nature , we are forced to confront the issue of apodization straight on .    at this point",
    "the reader may wonder if using @xmath15 is such a good idea as one has to take derivatives of the data , deal with extremely blue spectra , etc . in the next section",
    "we will show that our technique is equivalent to the `` pure '' pseudo-@xmath0 technique .",
    "thus all the intuition we gain focusing on @xmath15 will be directly translated to that other method .",
    "the pure pseudo-@xmath0 formalism also clarifies the issue of statistical weight ; we will see that , even though the apodized window may suggest that the edges of the survey are downweighted , the statistical weight is in fact roughly uniformly distributed for the optimal choice of apodization .",
    "we have now seen that the problem of estimating the @xmath1-mode power spectrum ( without contamination from @xmath4-modes ) can be reduced to estimating the power spectrum of a scalar field , by passing to the curl @xmath15 . in principle , any method for power spectrum estimation can be applied to @xmath15 , to obtain @xmath1-mode estimators which do not suffer from @xmath43 mixing .",
    "we will consider a special case which will be the focus of the rest of the paper : estimating the power spectrum of @xmath15 using pseudo-@xmath0 estimators .",
    "let us recall how pseudo-@xmath0 power spectrum estimators are defined for the scalar field @xmath15 .",
    "first , one computes multipoles of the weighted field ( or `` pseudo multipoles '' ) : ^_m d^2x _",
    "b(x ) w(x ) y_m^*(x ) [ eq : talm ] where @xmath44 is a heuristically chosen weight function .",
    "the issue of choosing @xmath44 will be studied in detail in subsequent sections . in  ( [ eq : talm ] )",
    ", we have included the prefactor @xmath45 so that the normalization will match the @xmath1-mode power spectrum @xmath46 .",
    "we briefly describe the construction of unbiased bandpower estimators from the pseudo multipoles  ( [ eq : talm ] ) ; for more details see @xcite .",
    "first we sum the multipoles in bins , obtaining pseudo bandpowers _ _",
    "b _ m=-^_m^ _ m^ [ eq : pseudoc ] where the index @xmath47 runs over @xmath48 bands .",
    "then we define unbiased estimators by _ = k_^-1 ( _  - n_ ) [ eq : transfer ] where @xmath49 is the ( additive ) noise bias of each @xmath50 , and @xmath51 is the transfer matrix between pseudo bandpowers  ( [ eq : pseudoc ] ) and signal bandpowers @xmath52 .",
    "( more precisely , @xmath53 and @xmath54 are defined by @xmath55 . )",
    "the preceding construction defines a power spectrum estimator for polarization which eliminates @xmath43 mixing in the strongest possible sense : the estimated @xmath1-mode power acquires no contribution from @xmath4-modes . in @xcite , `` pure pseudo-@xmath0 estimators '' for polarization , which also eliminate @xmath43 mixing in this strong sense , were defined .",
    "we now prove that the two estimators are mathematically equivalent .    substituting the definition  ( [ eq : chib ] ) of @xmath15 into the definition of the multipole  ( [ eq : talm ] ) and integrating by parts ,",
    "one obtains : ^_m & = & d^2x ( q(x)+iu(x ) ) + + & = & d^2x ( q(x)+iu(x ) ) + [ eq : talm2 ] where we have defined the spin-1 and spin-2 quantities w_1(x ) = 1.0pt-6ptw(x ) w_2(x ) = 1.0pt-6pt1.0pt-6ptw(x ) .",
    "[ eq : spin12 ] in the form  ( [ eq : talm2 ] ) , it is seen that @xmath56 agrees with the pure multipole defined in @xcite , after changing from tensor notation to the spin-@xmath57 notation used here .",
    "this shows that the pseudo multipoles in the two constructions are equal ; since the rest of the pseudo-@xmath0 construction ( eqs .",
    "( [ eq : pseudoc ] ) ,  ( [ eq : transfer ] ) ) is also the same in both cases , this completes the proof that the @xmath15 estimator and the pure pseudo-@xmath0 estimator are equal .    since the estimators are mathematically equivalent , it is a matter of preference which to use , and we will switch between the two formalisms in the rest of this paper depending on which is more convenient . using",
    "the @xmath15 estimator has the advantage that pure @xmath1-mode power spectrum estimation is equivalent to power spectrum estimation of a scalar field with a very blue spectrum . as we will see",
    "shortly , this will allow us to formulate a unified procedure for optimizing the weight function @xmath44 , which applies to both pure and ordinary pseudo-@xmath0 estimators .    in the pure pseudo-@xmath0 formalism",
    ", the terms have been organized ( eq .  ( [ eq : talm2 ] ) ) so that the derivatives act only the weight function , rather than the spherical harmonic or the noisy polarization map . provided that the weight function varies slowly compared to the pixel scale",
    ", this can make it easier to take derivatives numerically ; one only has to compute @xmath58 . the first term in eq .",
    "( [ eq : talm2 ] ) is the usual pseudo-@xmath0 estimator for @xmath1-modes ; the remaining two terms are interpreted as higher - spin counterterms which cancel the @xmath43 mixing .",
    "we will see that this form of the estimator is convenient when optimizing the weight function numerically given a noise map  (  [ sec : numerical ] ) .",
    "we conclude this section by discussing a general property of the estimator : the weight function must be apodized so that both @xmath44 and its derivative vanish at the boundary .",
    "it is illuminating to see how this requirement arises from both ways of defining the estimator .    for the pure pseudo-@xmath0 estimator , it is seen ( from the mode in brackets in eq .",
    "( [ eq : talm2 ] ) , which multiplies the stokes parameters in a pixel ) that the statistical weight of a pixel is given by a combination of @xmath44 and its first two derivatives . therefore ,",
    "if either @xmath44 or its derivative have nonzero boundary values , the statistical weight will contain a delta function on the boundary , which leads to a divergent estimator .",
    "( one might try to cure this divergence by defining @xmath59 with the delta function terms omitted from the derivatives ; the estimator will then be finite , but since the relations  ( [ eq : spin12 ] ) do not hold strictly , the estimator will mix @xmath43 . )",
    "this reasoning also shows that even though @xmath44 is apodized near the boundary , the statistical weight of pixels near the boundary need not be small , since the counterterms @xmath60 and @xmath61 will be largest there .",
    "in fact , for the optimized weight functions that we will consider in subsequent sections , we have found that the statistical weight is roughly uniformly distributed .    for the @xmath15 estimator ,",
    "the divergence arises in a different way .",
    "although the estimator appears not to involve derivatives of @xmath44 , the field @xmath15 has a noise power spectrum on small scales which grows as @xmath62 . if either @xmath44 or its derivative is nonzero on the boundary , then @xmath63 decays as @xmath64 or slower for large @xmath36 ( eq .  ( [ eq : nderivs ] ) ) which causes the integral  ( [ cl ] ) to diverge . from this perspective , the need to apodize is understood as a consequence of small - scale noise fluctuations in @xmath15 with a very blue power spectrum .",
    "in pseudo-@xmath0 power spectrum estimation , an important practical issue is choosing the pixel weight function @xmath44 to minimize the variance of the estimator .",
    "although no general procedure has been proposed , several rules of thumb for optimizing @xmath44 under different limiting conditions have appeared . in the noise - dominated limit ,",
    "inverse noise weighting ( @xmath65 ) is optimal ; in the signal - dominated limit , uniform weighting is best possible @xcite .",
    "if the power spectrum is being estimated on scales smaller than fluctuations in the noise level , the fkp ansatz @xcite has become the industry standard for galaxy surveys .",
    "the preceding rules of thumb implicitly assume that the signal + noise power spectrum is white on small scales .",
    "however , we have seen that when choosing the weight function for pure @xmath1-mode estimation , one includes an extra factor @xmath62 in the power spectrum .",
    "this qualitatively affects the optimization and invalidates the rules of thumb .",
    "for example , @xmath44 and its first derivative must vanish on survey boundaries , in contrast to the white noise case .    in this section",
    ", we will describe a general ansatz for the optimal weight function , which makes sense for an arbitrary @xmath66-by-@xmath66 matrix @xmath67 representing the total covariance ( signal plus noise ) .",
    "in particular , it can be applied to a noise power spectrum which grows as any power of @xmath48 , and so provides a uniform framework for both pure and ordinary pseudo-@xmath0 power spectrum estimation .",
    "we will see that our ansatz reproduces the above rules of thumb in the appropriate limits , and correctly apodizes @xmath44 if the power spectrum is blue on small scales .",
    "first we introduce some notation .",
    "the @xmath66-by-@xmath66 signal covariance in the bandpower we are estimating will be denoted @xmath68 , where @xmath47 is an index ranging over @xmath48 bands , and we normalize it so that @xmath69 .",
    "if @xmath70 and @xmath71 are two @xmath66-by-@xmath66 matrices , then @xmath72 $ ] denotes the @xmath66-by-@xmath66 matrix obtained by _",
    "elementwise _ multiplication : _ ij = ( m_1)_ij ( m_2)_ij .",
    "[ eq : star ] the multiplication is always performed in a basis where each row or column corresponds to one pixel ; otherwise the operation defined by ( [ eq : star ] ) would be basis - dependent .",
    "now we can state the ansatz for optimizing the pseudo-@xmath0 weight function which will be the main result of this paper : the optimal weight function @xmath73 ( thought of as a length-@xmath66 vector ) is given by = [ ] ^-1 [ eq : wopt ] where @xmath74 deontes the length-@xmath66 vector consisting of all 1 s .",
    "it may seem strange that the ansatz  ( [ eq : wopt ] ) includes the * operation  ( [ eq : star ] ) which is specific to the pixel - space basis .",
    "loosely speaking , in pseudo-@xmath0 power spectrum estimation , we are constrained to use a filter ( multiplying by the mask ) which is diagonal in pixel space , and so the pixel basis is given special significance . before giving the derivation of the ansatz , we note some general properties . without using the * operation , it seems to be impossible to achieve all of the following at once :    1 .",
    "if the noise is uncorrelated between pixels , and the noise dominates , then @xmath73 corresponds to inverse noise weighting .",
    "this follows from eq .",
    "( [ eq : wopt ] ) upon noting that @xmath67 is diagonal in the pixel basis , say @xmath75 , so that @xmath76 and @xmath77 . note that in this case , pseudo-@xmath0 power spectrum estimation is optimal , in the sense that the cramer - rao inequality is saturated .",
    "2 .   if the signal + noise power spectrum grows as a power law @xmath78 on small scales , and @xmath79 , then @xmath73 is apodized near the boundary .",
    "the number of derivatives which vanish at the boundary is given by @xmath80 , in accord with the discussion at the end of  [ ssec : apodization ] .",
    "as the wavenumber @xmath81 where one is estimating the power spectrum increases , the apodization length decreases .",
    "these statements will be proved in  [ sec : mz ] .",
    "3 .   eq .",
    "( [ eq : wopt ] ) reduces to the fkp prescription in the regime where fkp applies .",
    "this is shown in appendix  [ sec : fkp ] .",
    "the matrix form of the ansatz  ( [ eq : wopt ] ) may suggest that @xmath66-by-@xmath66 matrix operations are needed to compute the optimal weight function , which would be problematic since such operations are computationally prohibitive in situations where pseudo-@xmath0 estimators are used .",
    "( if they were feasible , then one could do a maximum likelihood analysis instead .",
    ") however , in appendix [ app : cg ] , we will see that a conjugate gradient approach may be used to compute the rhs of eq .",
    "( [ eq : wopt ] ) even in surveys where the pixel count is large .",
    "now we give a heuristic derivation of the ansatz  ( [ eq : wopt ] ) .",
    "the idea is to find the weight function @xmath34 such that the pseudo-@xmath0 estimator ( defined in eq .",
    "( [ eq : pseudoc ] ) ) _ = _ ij _",
    "i w_i _ ij w_j _ j [ eq : kms0 ] is as close as possible to the optimal estimator _ _ ij _ i ( ^-1 ^-1)_ij _ j. [ eq : kms0b ] in eqs .",
    "( [ eq : kms0 ] ) ,  ( [ eq : kms0b ] ) we have denoted the data vector ( a length-@xmath66 vector whose covariance matrix is @xmath67 ) by @xmath82 .    how should `` close '' be defined ?",
    "we first note that both estimators can be written as monte carlo averages _ &",
    "= & ( _ i _ i w_i _ i ) ^2 _ + _ & = & ( _ ij _ i ^-1_ij _ j ) ^2 _ [ eq : kms1 ] where the notation @xmath83 means that an expectation value is taken over an auxiliary field @xmath84 with covariance @xmath68 . from the expressions  ( [ eq : kms1 ] ) , a natural definition of `` close '' is that the expectation value e ( _ i _ i w_i _ i - _ ij _",
    "i ^-1_ij _ j ) ^2 _ , [ eq : kms3 ] be minimized .",
    "here , the expectation value is taken over both the auxiliary field @xmath84 with covariance @xmath68 and the data vector @xmath82 with covariance @xmath67 .",
    "we minimize @xmath4 by setting its derivative with respect to the weight function to zero : 0 = & = & _ k _ k ( _ i _ i w_i _ i - _ ij _",
    "i ^-1_ij _ j ) _ , + & = & _ i _ ik _ ik w_i - _ ij _",
    "ik ^-1_ij _ jk + & = & _ i _ ik _ ik w_i - 1 i.e. , @xmath85 .",
    "this completes the derivation of  ( [ eq : wopt ] ) .      in eq .",
    "( [ eq : wopt ] ) , we have written the ansatz for the optimal weight function @xmath73 as a matrix equation .",
    "there is an equivalent formulation as a variational principle which connects to the discussion in ",
    "[ ssec : apodization ] and will also be directly useful in later sections : @xmath73 is the weight function which minimizes the expectation value of the pseudo bandpower @xmath50 _ & = & _ ij _",
    "i w_i _ ij w_j _ j + & = & _ ij w_i w_j _ ij _ ij [ eq : mz1 ] subject to the normalization condition _",
    "i w_i = [ eq : mz2 ] , this is shown by differentiating eq .",
    "( [ eq : mz1 ] ) with respect to @xmath86 , obtaining _",
    "j _ ij _ ij w_j = 1 [ ansatzeq ] i.e. , @xmath85 .",
    "( strictly speaking , the rhs in eq .",
    "( [ ansatzeq ] ) should be equal to a lagrange multiplier @xmath87 , but the overall normalization of the weight function is arbitrary . )    in the previous subsection we showed that @xmath73 is the weight function which makes the pseudo-@xmath0 estimator approximate the optimal estimator as closely as possible .",
    "the variational principle gives another interpretation of @xmath73 which matches the discussion from  [ ssec : apodization ] : @xmath73 is the weight function which minimizes the total aliasing from both signal outside the bandpower and noise .",
    "even if known perfectly on average , say because the power spectrum on other scales was given , this aliasing will contribute to the noise in the estimator thus degrading the signal to noise .",
    "the variational principle also gives a simple proof of property # 2 at the end of  [ sec : conjecture ] , that @xmath80 derivatives of @xmath73 vanish at the boundary if the power spectrum is a power law @xmath78 on small scales . from eq .",
    "( [ eq : nderivs ] ) , if @xmath40 is the number of derivatives which vanish , then the contribution to the expectation value @xmath88 from small scales ( large @xmath36 ) is given by _ l^- 2n - 4 therefore , @xmath89 is a necessary condition for the integral to converge , and so @xmath73 must satisfy this condition , since it is chosen to minimize the expectation value .",
    "to build intuition for the ansatz  ( [ eq : wopt ] ) , we give some analytic solutions in the case where the survey region is a circle of radius @xmath90 and the covariance @xmath67 is given by a power - law power spectrum @xmath78 , where @xmath91 or 4 .",
    "we assume uniform noise throughout the survey region , so that the covariance is completely described by a power spectrum , but statistical isotropy is broken by the survey boundary .",
    "more realistic surveys and power spectra will be considered in subsequent sections .",
    "we use the flat sky approximation throughout .",
    "let us first consider the case where the power spectrum is proportional to @xmath92 , so that the operator @xmath67 is equal to @xmath93 .",
    "computing the operator @xmath94 involves some subtleties , so we show the details explicitly . in the position space basis ,",
    "the matrix elements of @xmath67 and @xmath95 are given by ( ) _ xy & = & -^2 ^2(x - y ) + ( _ ) _ xy & = & j_0(_0|x - y| ) .",
    "where @xmath81 denotes the wavenumber where we are estimating the power spectrum . from the definition  ( [ eq : star ] ) , the matrix elements of @xmath94 are ( _ ) _ xy & = & j_0(_0|x - y| ) + & = & -^2 ^ 2(x - y ) + _ 0 ^ 2 ^ 2(x - y ) [ eq : l2op ] + where we have used @xmath96 , @xmath97 , @xmath98 .",
    "this calculation shows that the operator @xmath94 is equal to @xmath99 .",
    "= 7.0truein    combining eqs .",
    "( [ eq : wopt ] ) ,  ( [ eq : l2op ] ) , the optimal weight function satisfies the differential equation ( -^2 + _ 0 ^ 2 ) w_opt(x ) = [ eq : l2de ] with dirichlet boundary conditions ( as proved in ",
    "[ sec : mz ] ) .",
    "the solution to  ( [ eq : l2de ] ) is given by w_opt(r ) = 1 - .",
    "[ eq : l2sol ] the solutions to  ( [ eq : l2sol ] ) are shown in the left panel of fig .",
    "[ fig : analytic ] . for the @xmath91 power spectrum",
    ", the weight functions are apodized near the boundaries with an apodization length which decreases with increasing @xmath81 .",
    "this is in contrast to the white noise case where the weight function would be uniform , independently of @xmath81 , if the noise is homogeneous throughout the survey .",
    "we next consider the case of a signal + noise power spectrum which is proportional to @xmath62 .",
    "this case corresponds to pure @xmath1-mode estimation in the noise - dominated limit .    a calculation similar to  ( [ eq : l2op ] )",
    "shows that the differential equation for the weight function is ( -^4 + 4 _ 0 ^ 2 ^2 - _ 0 ^ 4 ) w = [ eq : l4de ] with dirichlet + neumann boundary conditions .",
    "the solution to  ( [ eq : l4de ] ) is w_opt(r ) = 1 - [ eq : l4sol ] this solution is shown in the right panel of fig .",
    "[ fig : analytic ] .",
    "relative to the @xmath91 case ( left panel ) , the apodization length is larger , and the apodization is such that both @xmath44 and its derivative vanish on the boundary .",
    "let us summarize our results so far . we have shown that @xmath43 mixing in pseudo-@xmath0 power spectrum estimation can be eliminated by taking the curl of the map , then estimating the power spectrum of the resulting scalar field . because the curl operation results in a noise power spectrum which grows as @xmath100 , the weight function must be smoothly apodized near boundaries in order to control contamination from small - scale power .",
    "this technique is mathematically equivalent to the pure pseudo-@xmath0 formalism from @xcite , in which `` counterterms '' involving spin-1 and spin-2 weights are added to the ordinary pseudo-@xmath0 estimator to cancel @xmath43 mixing .",
    "we have proposed a general ansatz  ( [ eq : wopt ] ) for optimizing pseudo-@xmath0 weight functions in the presence of arbitrary signal and noise covariance , and constructed analytic solutions in special cases .    for practical application , one needs a method for solving the ansatz numerically , giving a specification of the noise .",
    "the most general noise model we will consider is uncorrelated between pixels , isotropic in each pixel , but with an arbitrary pixel - dependent amplitude : (    cc q(x ) q(x ) & q(x ) u(x ) + u(x ) q(x ) & u(x ) u(x )    ) = (    cc ^2(x ) & 0 + 0 & ^2(x )    ) _ xx [ eq : uncorr ] for this noise model , we have implemented a `` black - box '' procedure which starts from the noise rms @xmath101 in each pixel and outputs @xmath4-mode and @xmath1-mode weight functions in each @xmath48 band .",
    "the procedure uses the variational principle from  [ sec : mz ] , finding weight functions which minimize the quantity @xmath88 . in this and the next section",
    ", we will describe qualitative features of the solutions and study estimator performance , deferring implementational details of the method to appendix  [ app : cg ] .",
    "we work in the pure pseudo-@xmath0 formalism , with one minor modification . as we have described it in  [ sec : purecl ] , the spin-1 and spin-2 weights are always given in terms of the spin-0 piece by : w_1(x ) = 1.0pt-6ptw(x ) w_2(x ) = 1.0pt-6pt1.0pt-6ptw(x ) , [ eq : constraints ] in our numerical optimization procedure , we do not impose eqs .",
    "( [ eq : constraints ] ) as constraints ; each @xmath1-mode `` weight function '' actually consists of three independent pieces : a spin-0 ( scalar ) function @xmath102 , a spin-1 ( vector ) field @xmath103 , and a spin-2 ( tensor ) field @xmath104 .",
    "note that for ee power spectrum estimation , we do not include higher - spin counterterms , and so each @xmath4-mode weight function is simply a scalar @xmath44 .",
    "= 6.2truein    in order to differentiate between different flavors of estimators , we will use the following terminology in the rest of the paper .",
    "if both counterterms are absent ( i.e. , @xmath105 ) , we will refer to the @xmath1-mode estimator as `` ordinary pseudo-@xmath0 '' .",
    "we will reserve the term `` pure pseudo-@xmath0 '' for the situation where the relations  ( [ eq : constraints ] ) hold exactly , e.g. because @xmath44 is of known analytical form and @xmath59 are obtained by simply evaluating derivatives in each pixel . in this case",
    "the @xmath1-mode estimator will have zero @xmath43 leakage ( except perhaps from aliasing artifacts in a finite pixelization ) .",
    "finally , in a case where the relations  ( [ eq : constraints ] ) hold approximately , we will refer to the @xmath1-mode estimator as `` pseudo-@xmath0 with counterterms '' .",
    "this will be the situation for the weight functions produced by our numerical optimization procedure ; since the relations  ( [ eq : constraints ] ) are not imposed as constraints , they do not hold strictly , and so there will be some nonzero mixing in the estimator .",
    "however , we will see shortly that the relations will hold approximately , and the level of @xmath43 mixing for optimized weight functions is small in practice .",
    "this is because reducing the mixing helps minimize the quantity @xmath88 , so our optimization procedure prefers weight functions which satisfy eqs .",
    "( [ eq : constraints ] ) to a good approximation .",
    "in fact , this is the main reason why we have found it convenient to work in the counterterm formalism , rather than passing to the curl @xmath15 ( which we showed was equivalent in  [ sec : purecl ] ) : the variational optimization procedure sidesteps implementational issues associated with taking derivatives in an irregular spherical pixelization such as healpix .    in fig .",
    "[ fig : noiselevels ] , we show the result of our optimization procedure for @xmath106 , a spherical cap shaped survey with radius @xmath27 , and three choices of noise level : 100 , 20 , and 5 @xmath3k - arcmin . for the largest noise level ,",
    "both higher - spin counterterms are small and the weighting is roughly uniform . in this regime",
    ", our optimization procedure reduces to ordinary pseudo-@xmath0 power spectrum estimation with tophat weighting . for the smallest noise level",
    ", the weight function is apodized , both counterterms are present , and all components of the weight function have nearly converged to the analytic solution  ( [ eq : l4sol ] ) , which represents the limit @xmath107 . here our procedure reduces to pure pseudo-@xmath0 with weighting that can be understood by solving the differential equation  ( [ eq : l4de ] ) . our optimization procedure therefore smoothly interpolates between ordinary and pure pseudo-@xmath0 as the noise level is improved , `` turning on '' the higher - spin counterterms as they are needed to reduce @xmath43 mixing below the noise floor .",
    "( we will illustrate this in a different way in the next section . )",
    "= 7.0truein    next we consider power spectrum errors from our estimators for a spherical cap shaped mock survey with radius @xmath27 , homogeneous noise level 5.75 @xmath3k - arcmin and gaussian beam @xmath108 arcmin .",
    "these values have been chosen to roughly model the fiducial realistic survey which will be treated in more detail in the next section .",
    "we have used an azimuthally symmetric mock survey so that optimal , or maximum likelihood , power spectrum estimation will be computationally feasible , even though the pixel count is large enough that this would normally be impossible .",
    "the computational speedup is obtained because both signal and noise covariance matrices are diagonal in @xmath109 ; for details see appendix  f of @xcite .",
    "this allows us to compare our estimators to optimal in a baseline survey which approximates our fiducial realistic experiment (  [ sec : ebex ] ) within the constraint of azimuthal symmetry .    in fig .",
    "[ fig : stcerr ] , we show power spectrum errors for the mock survey using both pseudo-@xmath0 with weight functions produced by our optimization procedure , and optimal power spectrum estimators .",
    "it is seen that our method is slightly suboptimal at very low @xmath48 but rapidly becomes optimal .",
    "for example , the @xmath1-mode bandpower rms is 72% optimal in the lowest band , 88% optimal in the second - lowest , and 91% optimal in the third lowest .",
    "we emphasize that this level of performance for @xmath1-modes is much better than could be obtained at this noise level using ordinary pseudo-@xmath0 estimators @xcite , and that we have obtained it using a completely automated procedure for generating weight functions from the noise distribution .",
    "= 4.5truein    = 4.5truein    in the preceding section we considered a homogeneous , azimuthally symmetric mock survey whose noise distribution was much simpler than a real cmb experiment .",
    "we conclude this paper by considering a more realistic example",
    ". we will use noise maps made from preliminary simulations of the ebex experiment @xcite .",
    "the noise map is shown in fig .  [",
    "fig : ebex_hitcount ] .",
    "the simulation used the scan strategy proposed by ebex and a realistic focal plane configuration to estimate the number of hits for every 1 arcminute square pixel after a 14 day long duration balloon flight .",
    "the details of the scan , focal plane configuration , number of detectors and ultimate sensitivity are not of particular interest here and are probably subject to change before the flight takes place .",
    "however the simulations give a good illustration of the level of complexity of the noise maps and sky coverage for upcoming ground and balloon based experiments .",
    "thus they serve as a nice test bed for our methods .",
    "since the map is not azimuthally symmetric , computing optimal power spectrum errors is computationally prohibitive and we will not be able to compare our method to optimal .",
    "instead we will compare pseudo-@xmath0 power spectrum errors for the fiducial realistic experiment to those obtained for the azimuthally symmetric mock survey in the preceding section , which roughly approximates the sky coverage and noise distribution .    in fig .",
    "[ fig : ebex_hitcount ] , we have generated randomly - positioned point sources with average number density 0.04 deg@xmath110 , and masked each point source to radius 17 arcmin , corresponding to the @xmath111 level of the beam ( assumed gaussian with @xmath112 arcmin ) . with these parameters ,",
    "1% of the survey area is excluded by the point source mask . the area that will need to be cut out to sufficiently mask point sources to measure",
    "@xmath1-mode polarization is at this point rather uncertain .",
    "we have based our choice of 1% on point source simulations conducted at sissa for the planck satellite reference sky @xcite .",
    "our choice should thus be seen as an illustrative example to help us understand how our method would deal with the resulting holes .",
    "we will analyze the map with and without the mask , to isolate the impact of point sources when measuring @xmath1-modes .",
    "= 7.0truein    = 6.5truein    for analyzing a very inhomogeneous map such as this , with noise fluctuations on large and small scales , an automated procedure for optimizing weight functions is a practical necessity . using the optimization procedure described in  [ sec : numerical ] , we generated weight functions for both @xmath4-mode and @xmath1-mode power spectrum estimation ; some representative weight functions are shown in fig .",
    "[ fig : ebex_weights ] .",
    "considering @xmath4-mode weight functions first , our method generates weight functions which are more inhomogeneous than those given by the fkp ansatz ( appendix  [ sec : fkp ] ) but similar in performance .",
    "there is a slight improvement at low @xmath48 ; e.g. for the lowest @xmath4-mode bandpower , the the bandpower rms given by our estimator is @xmath113 better than fkp .",
    "note that in  [ sec : numerical ] , we did not discuss @xmath4-mode weight functions , since they are very simple for the homogeneous mock survey .",
    "turning now to @xmath1-mode weight functions , one qualitative feature is that their statistical weight is concentrated near the center of the survey ( compared to the @xmath4-mode weight functions ) .",
    "this is for signal - to - noise reasons , since the @xmath1-mode signal is weak and the center of the survey is least noisy .",
    "another feature of the @xmath1-mode weight functions is that the higher - spin counterterms are relatively smooth across the map , even though the scalar piece of the weight function has structure on small scales matching similar structure in the noise .",
    "instead , our numerical optimization procedure prefers to associate counterterms with `` large scale '' features such as survey boundaries or point sources , but not with small - scale features in the noise . from fig .",
    "[ fig : ebex_weights ] , one sees that the counterterms are sourced mainly by boundaries at low @xmath48 and by point sources at intermediate to high @xmath48 .",
    "a zoomed - in view of the @xmath1-mode weight function near point sources is shown in fig .  [ fig : ebex_zoom ] .",
    "the behavior of the weight function near the `` internal '' boundaries of point sources is similar to the behavior near external survey boundaries seen in fig .",
    "[ fig : noiselevels ] : the scalar piece of the weight function is apodized , and the counterterms are large near the boundary .",
    "= 7.0truein    one consequence of the counterterms being smooth , even though the scalar piece of the @xmath1-mode weight functions have small - scale structure , is that the relations  ( [ eq : constraints ] ) are not strictly satisfied .",
    "therefore , the estimator is not completely pure ; there is some nonzero level of @xmath43 mixing .",
    "this is quantified in fig .",
    "[ fig : sbias ] , where we show the mean contribution of aliased @xmath4-modes to the pseudo power spectrum @xmath114 . in the pseudo-@xmath0 construction ,",
    "this contribution is always removed in the mean by the debiasing step , but acts as a source of extra variance .",
    "it is seen that our optimization procedure produces counterterms which reduce @xmath43 mixing well below the level of the noise , even though strictly speaking , the mixing is nonzero , i.e. the estimator is not pure .",
    "( in fig .",
    "[ fig : sbias ] , some `` stair - step '' features can be seen which arise because we do not generate a separate set of weight functions in every band , e.g. we use the same weight function between @xmath115 and @xmath116 to save cpu time . )",
    "= 7.0truein    next we study the power spectrum errors which are obtained using these weight functions . in fig .",
    "[ fig : ebex_err ] , three sets of power spectrum errors are compared .",
    "considering the leftmost set of error bars first ( i.e. pseudo-@xmath0 with counterterms and without the point source mask ) , we would like to know , how do these errors compare to optimal ?",
    "as previously remarked , we are unable to make this comparison directly since the fiducial experiment lacks azimuthal symmetry .",
    "however , the pseudo-@xmath0 errors for the fiducial realistic experiment can be compared to the pseudo-@xmath0 errors which were obtained previously ( fig .",
    "[ fig : stcerr ] ) for an azimuthally symmetric mock survey with roughly the same sky coverage and noise level .",
    "we find that the two are roughly equal ; the rms bandpower errors for the fiducial realistic experiment for both ee and bb are @xmath113 worse than the mock survey at low @xmath48 and @xmath113 better at high @xmath48 .",
    "it seems plausible that this difference is simply due to inhomogeneity in the noise , and that our method remains near - optimal for the fiducial realistic experiment , although we can not say this with absolute certainty since direct computation of the optimal errors is not feasible .",
    "now let us compare the errors with and without the point source mask , for pseudo-@xmath0 estimators with counterterms ( i.e. , the left and middle error bars in fig .  [",
    "fig : ebex_err ] ) .",
    "we find that the point source mask degrades the errors on bb by @xmath117 for @xmath118 but the effect becomes small for large @xmath48 , or for ee on all angular scales . even though a tiny fraction of sky area is masked , we find that the impact on @xmath1-mode errors is not negligible .",
    "this is to be expected since the point source mask does decrease the number of pure @xmath1-modes in the survey region .",
    "however , even taking a conservative estimate for the number density of point sources , we have found that this effect is not large .    finally , we compare pseudo-@xmath0 with counterterms to ordinary pseudo-@xmath0 ( i.e. , the middle and right error bars in fig .  [",
    "fig : ebex_err ] ) .",
    "it is seen that at this noise level , including counterterms in the estimator is essential for @xmath4-@xmath1 separation .",
    "if ordinary pseudo-@xmath0 estimators are used instead , the rms @xmath1-mode errors are worse by a factor @xmath22 - 3 at intermediate to high @xmath48 , and a factor @xmath119 at low @xmath48 .",
    "if this comparison is repeated without the point source mask , we find that the two become equal at high @xmath48 but remain drastically different at low @xmath48 .",
    "this suggests that the suboptimality of ordinary pseudo-@xmath0 is mainly due to @xmath43 mixing from survey boundaries at low @xmath48 and point sources at high @xmath48 .",
    "we have given a general treatment of @xmath43 mixing and argued that when estimating @xmath1-mode power , no information is lost by passing to the curl @xmath15 .",
    "the analogue for a scalar field , passing to the laplacian , would lose the largest - scale modes on a cut sky , but for a spin-2 field it is the ambiguous modes which are lost in this way .",
    "this presents a general approach to constructing estimators which are pure , i.e. which filter out contributions from ambiguous modes .",
    "we considered the estimator defined by applying pseudo-@xmath0 estimation to the scalar field @xmath15 , and proved that it is mathematically equivalent to the pure pseudo-@xmath0 estimator from @xcite .",
    "the equivalence sheds light on properties of the estimator , e.g. the requirement of a smoothly apodized weight function can be understood as arising from colored noise in @xmath15 .",
    "perhaps most importantly , it allows us to consider ordinary and pure pseudo-@xmath0 estimators in a unified way when studying the problem of optimizing the weight function .",
    "the central result of this paper is a general ansatz for optimizing the pseudo-@xmath0 weight function .",
    "the ansatz can be expressed either in matrix form ( eq .  ( [ eq : wopt ] ) ) , or as a variational principle : the optimized weight function minimizes the total expectation value @xmath120 of the estimator , subject to the constraint @xmath121 .",
    "although our emphasis has been on next - generation ground - based polarization experiments , and we have only considered noise which is uncorrelated between pixels ( eq .  ( [ eq : uncorr ] ) ) , the ansatz is much more general : in principle it applies to arbitrary signal and noise covariance . in particular",
    ", it should be useful for the temperature power spectrum , but we have not pursued this here .",
    ".forecasts for the @xmath122 upper limit on @xmath123 and the fractional error on the amplitude @xmath124 of the lensing @xmath1-mode , for various levels of approximation to the fiducial realistic experiment . [ cols=\"^,^,^\",options=\"header \" , ]     [ tablew ]",
    "in this appendix we prove the assertion , stated without proof at the end of  [ sec : conjecture ] , that our ansatz for the optimal weight function reduces to the fkp @xcite approximation under appropriate conditions .",
    "the fkp approximation is used to incorporate the effect of inhomogeous noise when estimating the amplitude of modes that are much shorter than the size of the survey and also of the typical variation scale of the noise .",
    "fkp propose a weight w^fkp_i , where @xmath125 is the wavenumber where the power spectrum is being estimated , @xmath22 is the solid angle of each pixel , and @xmath126 the noise variance in pixel @xmath127 .",
    "working in the flat sky approximation , we will now show that under the fkp assumptions , @xmath128 satisfies eq .",
    "( [ ansatzeq ] ) .    assuming that we are estimating power in a narrow band @xmath47 near @xmath125 we have , _ ij & = & ^2_i _ ij + c_l e^-i(_i-_j ) .",
    "+ _ ij & = & e^-i_0(_i-_j ) where @xmath129 . plugging this into eq .",
    "( [ ansatzeq ] ) we get , _ j _ ij _ ij w_j^fkp = _ j ( ^2_i _ ij + c_l e^-i(_i-_j ) ) ( e^-i_0(_i-_j ) ) [ eq : fkp1 ] the first term , coming from the noise contribution to the covariance , simply gives : .",
    "[ neq ] to make progress on the second term we need to use some of the fkp assumptions .",
    "first we will use that we are interested in a situation in which the noise varies slowly and write ,",
    "f(_j ) = f(_i ) +",
    "f ( _ i ) ( _ j - _ i)+ , so that the second term in  ( [ eq : fkp1 ] ) becomes _ j c_l e^-i(+_0)(_i-_j ) ( f(_i ) + f ( _ i ) ( _ j - _ i)+ ) [ feq ] for the first of these terms we get : c_l f(r_i ) _ j e^-i(+_0)(_i-_j ) & = & c_l f(r_i ) ^-1 + & = & + ( 1/l_0 r ) where @xmath90 is the size scale of the patch . now let us check what happens with the additional terms in eq .",
    "( [ feq ] ) describing anisotropy of the noise .",
    "the additional contribution is proportional to : _ f _ _0 c_l_0 , which is suppressed by @xmath130 with respect to the leading term where @xmath131 gives the scale of variation of the noise .    putting all of this together",
    ", we see that _ j _ ij _ ij w_j^fkp = 1 + ( 1/l_0 r ) + ( 1/l_0 r_n ) i.e. , for diagonal inhomogenous noise when considering modes much shorter than both the scale of variation of the noise and the patch , our ansatz  ( [ eq : wopt ] ) for the pseudo-@xmath0 weight function reduces to fkp .",
    "in this appendix we supply the details of our procedure , described briefly in  [ sec : numerical ] , for numerically optimizing pseudo-@xmath0 weight functions given the noise rms @xmath101 in each pixel .",
    "we first treat the more difficult case of optimizing the @xmath1-mode weight function ; as we will then see , optimizing the @xmath4-mode weight function can be obtained as a special case . as described in ",
    "[ sec : numerical ] , the @xmath1-mode `` weight function '' really consists of three functions @xmath44 , @xmath103 , @xmath104 with spins 0 , 1 , 2 respectively .",
    "these are varied independently in order to minimize the total expectation value @xmath120 of the pseudo-@xmath0 estimator ( with contributions from signal and noise ) , subject to the normalization constraint _",
    "x w(x ) = 1 .",
    "[ eq : appnc ]    to solve this minimization problem , we first rewrite the expectation value @xmath120 to be minimized in a form which makes the dependence on the weight functions easier to understand . considering first the noise contribution to @xmath120 , a short calculation shows that = _ x w _ ^2(x ) ( w(x)^2 + 4 + ) [ eq : een ] where @xmath132 denotes the @xmath48 weighting within the bandpower under consideration .",
    "( throughout this paper we have taken this to be @xmath133 inside the band and zero outside the band , as in eq .",
    "( [ eq : pseudoc ] ) . )",
    "the signal contribution to @xmath120 is more difficult to compute , but follows from the results of appendix  d in @xcite . in order to write it down",
    ", we decompose the pieces of the weight function in spherical harmonics : a^w_m & = & _ x w(x ) y^*_m(x ) + a^g_m = -_x",
    "w_1(x ) ( ) & & a^c_m = i _ x w_1(x ) ( ) [ eq : wtgc ] + a^e_m = -_x w_2(x ) ( ) & & a^b_m = i _ x w_2(x ) ( ) [ eq : wteb ] ( the spin-2 piece  ( [ eq : wteb ] ) is the e / b decomposition from eq .",
    "( [ eb ] ) , whereas the spin-1 piece  ( [ eq : wtgc ] ) is the gradient / curl decomposition of a vector field . )                            ) [ eq : ees ] here , the power spectra which appear depend on the bandpower weighting @xmath132 and signal power spectra . for the latter ,",
    "it is convenient to introduce the notation @xmath134 .",
    "the power spectra in eq .",
    "( [ eq : ees ] ) are then given by : c_^ww & = & _ -1 ^ 1 dz _   ( ) w _ ",
    "d_00^(z ) [ eq : appcl ] + c_^wg & = & _ -1 ^ 1 dz _   ( ) d_01^(z ) + c_^we & = & _ -1 ^ 1 dz _   ( ) d_02^(z ) + c_^gg & = & _ -1 ^ 1 dz _   ( ) + c_^cc & = & _ -1 ^ 1 dz _   ( ) + c_^ge & = & _ -1 ^ 1 dz _   ( ) d_01^(z ) + c_^cb & = & _ -1 ^ 1 dz _   ( ) d_01^(z ) + c_^ee & = & _ -1 ^ 1 dz _   ( ) d_00^(z ) + c_^bb & = & _ -1 ^ 1 dz _   ( ) d_00^(z ) where @xmath135 is the reduced wigner rotation matrix element @xcite ; note that @xmath136 is just the legendre polynomial @xmath137 .",
    "we have written the power spectra as position - space integrals following @xcite ; if convenient these expressions can be converted to harmonic space using the identity _",
    "-1 ^ 1 dz d_s , s^(z ) d_2,2^(z ) d_2-s,2 s^(z ) = 2    armed with the expressions  ( [ eq : een ] ) and  ( [ eq : ees ] ) for the noise and signal contributions to @xmath120 , a procedure for minimizing @xmath138 subject to the constraint  ( [ eq : appnc ] ) is not difficult to come by .",
    "representing the three components of the @xmath1-mode weight function by a single length-@xmath139 vector @xmath140 , both @xmath141 and @xmath142 are quadratic in @xmath140 , so we can write them compactly as = + = w^t q_s w + w^t q_n w where @xmath143 and @xmath144 are @xmath139-by-@xmath139 matrices . in this notation , the constraint  ( [ eq : appnc ] ) can be written @xmath145 , where @xmath146 is a vector with @xmath66 entries equal to 1 ( corresponding to the spin-0 piece of the weight function ) and @xmath147 entries equal to 0 ( corresponding to the higher - spin pieces ) . the solution to this minimization problem is simply w_opt = [ eq : appsol ] since dense inversion of a @xmath139-by-@xmath139 matrix is computationally infeasible , our approach is to compute @xmath148 using conjugate gradient inversion  @xcite .",
    "in order to use conjugate gradient inversion , two ingredients are needed .",
    "first , one needs an efficient way to multiply a vector by @xmath149 , even though this matrix will be too large to store in dense form .",
    "this is easily obtained from eqs .",
    "( [ eq : ees ] ) and  ( [ eq : een ] ) ; note that multiplying by @xmath143 requires transforming from pixel to harmonic space and back .",
    "the second ingredient is a preconditioner , or approximate inverse of @xmath149 , used to speed convergence ; the better the preconditioner approximates @xmath150 , the more rapidly the conjugate gradient search will converge .",
    "we use the following simple preconditioner , obtained by keeping only the diagonal of @xmath149 , then inverting : ( w_0(x ) w_1(x ) w_2(x ) ) ( ) [ eq : apppc ] where we have defined _ 0 ^ 2 & = & _ ( ) c_^ww + _ 1 ^ 2 & = & _ ( ) ( c_^gg + c_^cc ) + _ 2 ^ 2 & = & _ ( ) ( c_^ee + c_^bb ) .",
    "the performance of this preconditioner depends mainly on the noise level . for noise levels @xmath151 @xmath3k - arcmin ,",
    "only a few cg iterations are needed ; for the noise levels of our fiducial experiment ( @xmath152 @xmath3k - arcmin ) , around 100 iterations are needed ; and for noise levels @xmath153 @xmath3k - arcmin , the cg search does not converge . a better preconditioner may accelerate weight function optimization , but we have not attempted to find one in this paper .    in summary , we have now arrived at a method for numerically optimizing the @xmath1-mode weight function , given the bandpower ( specified by the @xmath48 weighting @xmath132 ) and noise rms @xmath101 .",
    "one precomputes the power spectra in eqs .",
    "( [ eq : appcl ] ) , then computes @xmath154 by conjugate gradient inversion , using the preconditioner  ( [ eq : apppc ] ) , to obtain the optimized weight function given by  ( [ eq : appsol ] ) .",
    "finally , let us discuss the completely analagous but simpler problem of optimizing the @xmath4-mode weight function . in this case",
    ", the weight function is just a scalar @xmath44 .",
    "the noise and signal contributions to @xmath120 are given ( in analogy to eqs .",
    "( [ eq : een ] ) ,  ( [ eq : ees ] ) above ) by & = & _ x w _ ^2(x ) w(x)^2 + & = & _ m a^w*_m c_^ww a^w_m where c_^ww _ -1 ^ 1 dz _   ( ) w _ ",
    "d_00^(z ) interpreting these as an @xmath66-by-@xmath66 matrix equation = + = w^t q_n w",
    "+ w^t q_s w the optimized @xmath4-mode weight function is given by w_opt = .",
    "[ eq : appsole ] where @xmath146 is a length-@xmath66 vector consisting of all 1 s .",
    "( [ eq : appsole ] ) is evaluated using conjugate gradient inversion with preconditioner given by @xmath155 ."
  ],
  "abstract_text": [
    "<S> we derive a general ansatz for optimizing pseudo-@xmath0 estimators used to measure cmb anisotropy power spectra , and apply it to the recently - proposed pure pseudo-@xmath0 formalism , to obtain an estimator which achieves near - optimal @xmath1-mode power spectrum errors for any specified noise distribution while minimizing leakage from ambiguous modes </S>",
    "<S> . our technique should be relevant for upcoming cmb polarization experiments searching for @xmath1-mode polarization . </S>",
    "<S> we compare our technique both to the theoretical limits based on a full fisher matrix calculation and to the standard pseudo-@xmath0 technique . </S>",
    "<S> we demonstrate it by applying it to a fiducial survey with realistic inhomogeneous noise , complex boundaries , point source masking , and noise level comparable to what is expected for next generation experiments ( @xmath25.75 @xmath3k - arcmin ) . </S>",
    "<S> for such an experiment our technique could improve the constraints on the amplitude of a gravity wave background by over a factor of ten compared to what could be obtained using ordinary pseudo-@xmath0 , coming quite close to saturating the theoretical limit . </S>",
    "<S> constraints on the amplitude of the lensing @xmath1-modes are improved by about a factor of 3 .    5_5 * v * 2_-2y 2_2y *p * *l * # 1#1 # 1equation  ( [ # 1 ] ) # 1equation  ( [ # 1 ] ) # 1  ( [ # 1 ] ) # 1section  [ # 1 ] # 1section  [ # 1 ] # 1subsection  [ # 1 ] # 1subsection  [ # 1 ]    # 1#2#3#4#5#6    (    ccc # 1 & # 2 & # 3 + # 4 & # 5 & # 6    ) </S>"
  ]
}