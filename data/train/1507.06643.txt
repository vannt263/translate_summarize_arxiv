{
  "article_text": [
    "molecular dynamics ( md ) nowadays easily allows the simulation of systems composed of several millions of atoms for molecular systems .",
    "this is however still insufficient when interesting phenomena occur on space and time scales spanning several orders of magnitude .",
    "one such example is the simulation of shock waves in molecular materials , where the resolution of atomic vibrations limits the timestep to fractions of picoseconds when covalent bonds are present .",
    "coarse - grained models , which reduce the complexity of md simulations with full atomistic details by representing some degrees of freedom in an average manner , are therefore of primary interest in this context , they allow to extend the spatial scale by reducing the number of degrees of freedom , and also the temporal scales by increasing the admissible timesteps since mesoparticles interact via smoother potentials .    the dissipative particle dynamics ( dpd)@xcite is a particle - based coarse - grained model in which atoms , molecules or even groups of molecules are represented by a single mesoscale dpd particle .",
    "the time evolution of the mesoscale particles is governed by a stochastic differential equation .",
    "dissipative and random forces allow to take into account some effect of the missing degrees of freedom .",
    "dpd was put on a firm theoretical ground in ref .  , and was applied to study the properties of various systems@xcite .",
    "however , dpd intrinsically is an equilibrium model , with a prescribed temperature .",
    "the temperature is fixed through a fluctuation / dissipation relation between the magnitudes of the friction and the fluctuation parameters .",
    "dpd can not be used as such to study nonequilibrium systems .",
    "it should be replaced by a dynamics where the fluctuation - dissipation relation is based on variables which evolve in time .",
    "dpd with conserved energy ( dpde ) is such a model@xcite .    in the dpde framework , mesoparticles have an additional degree of freedom , namely an internal energy , which accounts for the energy of the missing degrees of freedom . the dynamics on the internal energies is constructed in order for the total energy of the system to remain constant .",
    "dpde was for instance used to simulate shock and detonation waves@xcite .",
    "however , the efficient numerical integration of dpde still requires some effort .",
    "numerous efficient schemes were developed for dpd@xcite ( see in particular ref .   for a careful comparison ) .",
    "however , their adaption to dpde leads to numerical schemes for which errors on average properties may be large even for timesteps standardly used to integrate hamiltonian dynamics@xcite .",
    "this may therefore require the use of extremely small timesteps@xcite .    among the currently known schemes for dpde , one of them turns out to enjoy very nice properties in terms of energy conservation .",
    "it is a splitting scheme inspired from shardlow s splitting scheme for dpd@xcite , and adapted to the dpde framework@xcite .",
    "the resulting scheme , called ssa in this work ( shardlow splitting algorithm ) , is so far considered as the reference scheme for the numerical integration of dpde@xcite .",
    "the main issue with ssa is that particle pairs have to be updated sequentially .",
    "the parallelization of ssa is therefore not an easy task@xcite .",
    "in addition , ssa is not threadable , and thus incompatible with the architectures of future supercomputers .",
    "the aim of our work is to propose and test new schemes to integrate dpde .",
    "we pay a particular attention to ( i ) the preservation of energy , ( ii ) the size of the errors on average properties arising from the use of finite timesteps , and ( iii ) the possibility to easily parallelize the method .",
    "more precisely , our aim is to construct easily parallelizable schemes for which the systematic errors ( _ i.e. _ the remaining errors in the limit of infinite sampling precision ) are as small as possible .",
    "let us also emphasize that the schemes we develop for dpde may be of direct interest for other dynamics with similar structures such as the smoothed dissipative particle dynamics ( sdpd)@xcite .",
    "this stochastic dynamics also preserves the energy of the system .",
    "it can also be seen as the superposition of two elementary energy preserving dynamics , a conservative part and a fluctuation / dissipation part .",
    "it is therefore not a surprise that the numerical methods we develop here can be readily applied for large scale simulations of sdpd on parallel architectures@xcite .",
    "this article is organized as follows .",
    "we first briefly recall the dpde model and its properties in section  [ section : model_presentation ] .",
    "we next present the numerical schemes we consider in section  [ section : numerical_schemes ] : some reference schemes in the literature are recalled in section  [ subsection : existing_schemes ] , while new schemes are proposed in section  [ subsection : new_schemes ] .",
    "we then perform sequential and parallel equilibrium simulations to evaluate the quality of the energy conservation and the errors on average properties as a function of the timestep ( see section  [ section : equilibrium_simulations ] ) . finally , in order to test the dynamical relevance of the newly introduced schemes , we present parallel simulations of shock waves in section  [ section : shock_simulations ] .",
    "we consider a system of @xmath0 identical particles in dimension @xmath1 , with positions @xmath2 and momenta @xmath3 .",
    "their velocities are @xmath4 , where @xmath5 is the mass of the particles ( masses are taken to be identical to simplify the presentation ; the extension to particles with different masses is straightforward ) .",
    "we rely on the dpde model@xcite although alternative deterministic models have also been proposed@xcite . in the dpde framework ,",
    "each particle represents a ( group of ) molecule(s ) , @xmath2 and @xmath3 being the position and momentum of the center of mass of this collection of atoms .",
    "these external degrees of freedom are coupled with some internal energies @xmath6 describing in an average manner the missing degrees of freedom lost in the coarse - graining process .",
    "each pair of particles interacts through ( i ) conservative forces deriving from a potential energy function @xmath7 , ( ii ) friction forces proportional to the relative velocity between the two particles and ( iii ) random fluctuation forces . in this article",
    ", we consider a variant of the original dpde model introduced in ref .  , where friction and random forces are not projected along the line joining two particles .",
    "however , the numerical schemes presented in section  [ section : numerical_schemes ] can be straightforwardly modified for the original dpde model .",
    "the time evolution of the configuration @xmath8 of the @xmath9th dpde particle is given by the following set of equations : @xmath10 ,    \\end{aligned }    \\right.\\ ] ] where @xmath11 are standard @xmath1-dimensional brownian motions , and @xmath12 for @xmath13 . in the above equations ,",
    "we have introduced the relative velocity @xmath14 between particles @xmath9 and @xmath15 and their distance @xmath16 .",
    "the function @xmath17 is a cut - off function , limiting the range of the random and dissipative interactions .",
    "we consider here @xmath18 note that , by construction , the total momentum @xmath19 and the total energy @xmath20 are preserved .",
    "the parameters @xmath21 and @xmath22 respectively control the friction and fluctuation strengths .",
    "they are chosen in order to ensure the correct statistical behavior of the system .",
    "an important point is that the invariant measure should be consistent with the preservation of total energy and momentum .",
    "more precisely , @xmath21 and @xmath22 are chosen in order for measures @xmath23 to be invariant under the dynamics   for arbitrary functions  @xmath24 and  @xmath25 . in this expression",
    ", @xmath26 is the total internal entropy of the system , @xmath27 being the internal entropy of the @xmath9th particle .",
    "the internal entropy function satisfies @xmath28 where @xmath29 is the internal temperature implicitly defined via the relation @xmath30 here , @xmath31 is the internal heat capacity at constant volume .",
    "therefore , the internal heat capacity fully determines the internal energies and the internal entropies .",
    "the relation   is the internal equation of state of the dpde particle .    in order for measures of the form   to be invariant by the dynamics  , the parameters @xmath21 and @xmath22 should satisfy the following fluctuation / dissipation relation@xcite : @xmath32 where @xmath33 is the internal temperature of the @xmath9th particle . in order to highlight the similarity with the standard fluctuation / dissipation relation for langevin dynamics",
    "( see for instance section  2.2.3 in ref .  ) , we find it convenient to rewrite the definition of @xmath34 and @xmath22 as @xmath35 with @xmath36 @xmath37 being boltzmann s constant .",
    "this amounts to introducing a reference friction parameter  @xmath38 and a reference temperature  @xmath39 , with associated inverse energy @xmath40 .      in order to compute the average value of a physical observable @xmath41",
    ", we assume that the dynamics   is ergodic for some invariant measure  @xmath42 of the form  .",
    "note indeed that there are no mathematical results ensuring the ergodicity of the stochastic dynamics   since the fluctuation part may be degenerate ( contrarily to , say , langevin dynamics ) .",
    "ergodicity is even not known to hold for dpd , except in the very specific case of one - dimensional systems@xcite .",
    "since the total energy and the total momentum are preserved by the dynamics , the only reasonable assumption is that ergodicity holds with respect to the probability measure @xmath43 where @xmath44 is a normalization constant . under this assumption ,",
    "average properties can be computed as @xmath45 where @xmath46 is the solution at time  @xmath47 of   starting from a given configuration @xmath48 .",
    "this initial configuration is such that @xmath49 and @xmath50 .",
    "the measure @xmath51 can be interpreted as some microcanonical measure . in order to obtain estimates of thermodynamic properties such as temperature , it is convenient to introduce a canonical equivalent of the measure  @xmath51 .",
    "in fact , the measure @xmath52 ( corresponding to a system with total momentum set to  0 ) should be equivalent in the limit of large systems to the canonical probability measure @xmath53 where @xmath54 is a normalization constant .",
    "the parameter  @xmath55 is chosen in order for the average energy under   to be equal to  @xmath56 : @xmath57 this equivalence is very similar to the standard equivalence between microcanonical and canonical measures for systems described only by their positions and momenta .",
    "we focus in the numerical tests we present on various estimators of the temperature , each one involving only one type of the three categories of degrees of freedom of the system : the positions @xmath2 , the momenta @xmath3 and the internal energies @xmath6 .",
    "the interest of these estimators is that they should all predict the same temperature ( provided the system is sufficiently large , which , in our experience , is already the case for moderately large systems of several hundreds of particles ) .",
    "this therefore allows to assess the quality of the sampling for each group of degrees of freedom .",
    "the first estimator of the temperature is the standard kinetic temperature @xmath58 where @xmath59 refers to averages with respect to the measure  @xmath60 introduced in  , and @xmath61 represents the effective number of external degrees of freedom of the system .",
    "it is a priori equal to @xmath62 but since we fix the total momentum to @xmath63 , we reduce it to @xmath64 .",
    "this correction is anyway unimportant for sufficiently large systems .",
    "the second estimator@xcite depends only on the positions of the particles : @xmath65 finally , the last estimator is determined by the internal energies : @xmath66 a simple computation shows that @xmath67 ( the second equality is proved in ref .  ) .",
    "let us emphasize that the internal temperature is estimated by a harmonic average rather than an arithmetic one .",
    "in order to estimate in practice average properties by the ergodic limit  , the dynamics needs to be numerically integrated .",
    "we therefore introduce a timestep @xmath68 , and denote by @xmath69 an approximation of the solution @xmath70 of   obtained by iterating a numerical scheme .",
    "average properties are then estimated by simulations over @xmath71 timesteps as @xmath72 standard results from the numerical analysis of stochastic differential equations ( see for instance section  2.3.1 in ref .  ) allow to quantify the errors produced by the approximation   as follows : @xmath73 this equality highlights two sources of error in the computation of average properties :    * a _ statistical error _",
    "@xmath74 , which arises from the finiteness of the number of iterations .",
    "typically , a central limit theorem holds , so that @xmath75 follows some gaussian distribution with a variance  @xmath76 close to the variance of the time averages estimated with the underlying continuous dynamics .",
    "the important point is that the statistical error decreases as the inverse of the square - root of the physical simulation time . * a _ systematic bias _",
    "@xmath77 , which is the residual error persisting in the limit of infinite sampling accuracy .",
    "this error arises from the use of finite timesteps .",
    "the statistical error only mildly depends on the numerical scheme at hand since the variance  @xmath76 is at first order in  @xmath78 the variance of the continuous process@xcite . as in ref .",
    ", our focus in this work is therefore rather on the systematic bias , which may be quite different for various numerical schemes .",
    "our aim is to construct schemes for which the systematic bias is as small as possible . for a given maximal number of step @xmath79 , this allows to integrate the dynamics with larger timesteps , and hence reduce faster the statistical error .",
    "the numerical schemes we consider in this section are based on splitting techniques as presented in the dpd context@xcite .",
    "the idea of splitting algorithms is to decompose the dynamics into several elementary subdynamics , which are sequentially integrated .",
    "splitting schemes are interesting when the elementary dynamics are simple to numerically integrate .",
    "although splitting schemes for stochastic dynamics are nowadays quite popular , some standard integration schemes for dpd do not fall into this class .",
    "for instance , some integrators were obtained by an ad - hoc modification of the verlet scheme@xcite for the integration of hamiltonian dynamics@xcite . for completeness , we also consider in our numerical experiments the adaption of the velocity - verlet scheme to the dpde context .",
    "this scheme is abbreviated svv in the sequel for stochastic velocity - verlet , and is made precise in appendix  [ sec : svv ] .",
    "let us also immediately emphasize that a complication of dpde compared to other stochastic dynamics such as dpd arises from the presence of two invariants of the dynamics , namely the total momentum and the total energy .",
    "ideally , numerical schemes should preserve these invariants over very long times , at least approximately ( as the energy is approximately preserved by appropriate discretizations of hamiltonian dynamics ) .",
    "we first briefly present in section  [ subsection : existing_schemes ] two splitting schemes already known by the community : a simple splitting scheme based on a euler - maruyama discretization of the dissipative part of   ( termed sem in the sequel ) and the adaption to the dpde context of the splitting proposed by shardlow in the dpd context@xcite ( termed ssa in the sequel ) .",
    "the simple splitting scheme is very easy to parallelize but leads to very large errors in the estimated properties ; while ssa is quite accurate but somewhat cumbersome to parallelize@xcite .",
    "this motivates the introduction of two new straightforwardly parallelizable schemes in sections  [ subsubsection : ser ] and  [ subsubsection : hybrid ] .",
    "the dpde dynamics   can be decomposed into a hamiltonian evolution @xmath80 and a fluctuation / dissipation part @xmath81 . \\end{aligned}\\right.\\ ] ] all splitting schemes first integrate the hamiltonian part with a standard velocity - verlet discretization@xcite .",
    "the difference therefore solely arises from the subsequent treatment of the fluctuation / dissipation part .",
    "the sem scheme integrates the fluctuation / dissipation with a simple euler - maruyama discretization : @xmath82 where ( here and in the sequel ) @xmath83 are identically and independently distributed standard @xmath1-dimensional gaussian random variables , and @xmath84 .",
    "note that no particular care is taken to make sure that the energy is preserved by the discretization of the fluctuation / dissipation part .",
    "unsurprisingly , it turns out that the total energy drifts in time ( see section  [ subsection : energy_conservation ] ) .    as svv",
    ", sem turns out not to be a very accurate scheme .",
    "it can be shown to be of weak order one . under appropriate ergodicity conditions ,",
    "the bias on average properties is therefore of order  @xmath78 ( @xmath85 in ) .",
    "we refer to appendix  [ sec : scheme_consistency ] for more precisions .",
    "the reason why we consider svv and sem in our numerical tests is that they can be efficiently parallelized in a straightforward manner , and are therefore appealing alternatives to ssa for large scale simulations on massively parallel architectures .",
    "ssa , in opposition to sem , further decomposes the fluctuation / dissipation dynamics   into elementary pairwise fluctuation / dissipation dynamics involving only two dpde particles  @xmath9 and  @xmath15 . taking advantage of the energy and momentum conservations , these elementary fluctuation / dissipation equations",
    "can in fact be rewritten as follows : @xmath86 as noted in ref .   for dpd ,",
    "the dynamics on the momenta can be analytically integrated when @xmath87 is fixed ( _ i.e _ for fixed @xmath6 , @xmath88 ) , instead of using a modified bbk algorithm@xcite as done in ref .  .",
    "for the extension of ssa to dpde we consider in this work , we rely on the strategy introduced in ref .  , where momenta are updated first ( here with an analytical integration at fixed  @xmath87 ) , and internal energies are then updated to ensure the overall energy conservation . introducing @xmath89 the scheme we use to integrate the elementary pairwise fluctuation / dissipation   reads @xmath90 , \\\\",
    "p_j^{n+1 } = {    p_j^n } & - \\frac12\\bigg [ \\left({\\mathrm}{e}^{-a^n_{ij,{\\delta}t}}-1\\right ) {    p_{ij}^n}\\\\                     & \\quad + \\left . { \\sigma}\\sqrt { \\frac{m\\left(1-{\\mathrm}{e}^{-2a^n_{ij,{\\delta}t}}\\right ) } { { { \\gamma}_{ij}^n } } } {    g_{ij}^n}\\right ] , \\\\",
    "{ \\varepsilon}_i^{n+1 } = { { \\varepsilon}_i^n } & - \\frac12{\\delta}k^n_{ij } , \\\\      { \\varepsilon}_j^{n+1 } = { { \\varepsilon}_j^n } & - \\frac12{\\delta}k^n_{ij } , \\end{aligned}\\right.\\ ] ] where we introduced the kinetic energy variation @xmath91\\ ] ] in order to update the internal energies .",
    "particle couples which are sufficiently close to interact are then sequentially updated with the scheme  .",
    "it is precisely this sequentiality which prevents a simple parallelization of the scheme . as a side remark ,",
    "note that when linear scaling techniques are used ( such as decomposing the system into cells of size @xmath92 ) , the order in which the particles are updated may change from one iteration to the other .",
    "the two new parallelizable schemes we propose rely on the splitting between hamiltonian and fluctuation / dissipation parts mentioned at the beginning of section  [ subsection : existing_schemes ] , but with new strategies to discretize the fluctuation / dissipation part :    * the first scheme we present in section  [ subsubsection : ser ] is called `` splitting with energy reinjection '' ( termed ser in the sequel ) .",
    "its discretization of the dissipative part   is similar to sem but uses a global symmetric reinjection of the kinetic energy variation into the internal energies , instead of directly discretizing the dynamics of the internal energies .",
    "this allows to automatically preserve the total energy during the fluctuation / dissipation part .",
    "* the second scheme is a mix between ssa and ser , and is therefore termed `` hybrid '' in the sequel ( see section  [ subsubsection : hybrid ] ) . as parallel simulations are performed using a spatial repartition of the simulation box between the processors ,",
    "the bottleneck for the parallelization of ssa arises from particles located in different domains @xcite .",
    "therefore , the idea of the hybrid scheme is to integrate the elementary fluctuation / dissipations interactions involving particles located on the same processor by a pass of the ssa algorithm , while the remaining interactions are taken care of by a ser discretization .",
    "the ser integration of the fluctuation / dissipation   is performed in two steps .",
    "first , momenta are integrated using a simple euler - maruyama discretization as @xmath93 with @xmath94 .",
    "the internal energies @xmath6 are then updated in order to compensate for the energy variation during the update of the momenta . in order to implement this idea ,",
    "we need to identify in the global kinetic energy variation of each particle the contribution of every single pairwise interaction , in order to redistribute the associated elementary energy variations .",
    "in fact , a simple computation shows that @xmath95 where @xmath96 represents the contribution of particle @xmath15 to the kinetic energy variation of particle @xmath9 .",
    "the internal energies are then updated by reinjecting the elementary variations @xmath97 in a symmetric manner : @xmath98 the discretization of equation can therefore be summarized as @xmath99 it can be shown that this numerical scheme is consistent .",
    "in fact , it has a weak order  1 , so that the bias on average properties is of order  @xmath100 .",
    "this can be checked by some straightforward but lengthy calculus , see appendix  [ sec : consistency_ser ] .",
    "let us emphasize that , by construction , ser automatically ensures the exact conservation of the total energy during the numerical integration of the fluctuation / dissipation part  .",
    "this very nice feature was only enjoyed by ssa among the previously known schemes to integrate dpde . on the other hand , in opposition to ssa , ser does no rely on a further splitting of the fluctuation / dissipation into elementary pairwise interactions , and is therefore straightforward to parallelize .",
    "however , the presence of both @xmath101 and @xmath102 in   requires two sweeps on the system , a first one to compute @xmath101 and sum it into  @xmath102 , and a second one to compute the products @xmath103 .",
    "this seemingly requires to store all increments @xmath101 ( or at least the gaussian increments @xmath104 ) , which is somewhat prohibitive .",
    "this can however be avoided if the gaussian increments @xmath104 can be exactly regenerated to the value they had on the first pass of the algorithm when the particle pairs are revisited .",
    "the saru pseudo - random generator@xcite precisely allows such an easy recomputation since the gaussian increments @xmath104 are completely determined by the integers @xmath105 and @xmath106 .",
    "the hybrid scheme can be seen as a blending of ser and ssa , where the elementary fluctuation / dissipation interactions involving particles on the same processor are integrated by a pass of the ssa algorithm , while the remaining interactions are integrated with the ser scheme .",
    "let us describe more precisely this algorithm .",
    "we denote by @xmath107 the result of a hybrid discretization of , with timestep @xmath78 , applied to the configuration @xmath108 of the system , i.e @xmath109 the variable @xmath110 refers to the gaussian increments used for the discretization .",
    "we also denote by @xmath111 the result of a ssa discretization   of the elementary dynamics   with timestep @xmath78 .",
    "note that only the components @xmath112 of  @xmath108 are changed by @xmath111 .",
    "let us denote by @xmath113 the set of particle couples where both particles are in the same processor , and @xmath114 the remaining couples .",
    "the elements of @xmath113 are denoted by @xmath115 , @xmath116 , @xmath117 , @xmath118 , where @xmath119 is the number of elements in @xmath113 .",
    "finally , we denote by @xmath120 the one - step iteration corresponding to a ser discretization of all the interactions involving the particle couples in @xmath121 .",
    "the expression of @xmath107 is obtained from @xmath111 and @xmath120 as @xmath122 with @xmath123 where @xmath124 denotes the mathematical composition .",
    "the hybrid scheme , in opposition to all the other schemes , does not depend only on the timestep but also depends on the space repartition of the simulation box between processors used for the simulations .",
    "this dependence is studied in section  [ subsection : parallelization_influence ] .",
    "in this section , we perform sequential and parallel equilibrium simulations using all the schemes presented in section  [ section : numerical_schemes ] .",
    "however , the hybrid scheme can only be tested in parallel simulations , otherwise it reduces to ssa .",
    "therefore , no hybrid scheme is used in the sequential simulations of section  [ subsection : energy_conservation ] and  [ subsubsection : sequential_simulations ] .",
    "we consider a system of @xmath0 particles , with pairwise conservative interactions described by a shifted , splined and truncated lennard - jones potential : @xmath125 the parameters @xmath126 and @xmath127 are chosen so that @xmath128 and @xmath129 .",
    "the total potential energy of the system reads @xmath130 in all the simulations presented below , the heat capacity is supposed constant .",
    "equation   then simply reduces to @xmath131 .",
    "all results are given in reduced units and , unless otherwise mentioned , the fluctuation strength is set to @xmath132 . the physical dimension @xmath1 is set to  3 with the particle number set to respectively @xmath133 , @xmath134 and @xmath135 in sections  [ subsection : energy_conservation ] ,  [ subsubsection : sequential_simulations ] and  [ subsubsection : parallel_simulations ] .",
    "we fix @xmath136 for the sequential simulations of section  [ subsection : energy_conservation ] and  [ subsubsection : sequential_simulations ] and @xmath137 for the parallel simulations of section  [ subsubsection : parallel_simulations ] .",
    "initial conditions are obtained in sections  [ subsection : energy_conservation ] and  [ subsubsection : sequential_simulations ] by melting a simple cubic crystal using a ssa scheme for @xmath138 with a timestep @xmath139 . the initial condition for the parallel simulations of section  [ subsubsection : parallel_simulations ]",
    "is obtained by melting a cubic face centered crystal using a ser scheme for @xmath140 with a timestep @xmath139 .",
    "the density is @xmath141 in all cases except in section  [ subsection : energy_conservation ] where @xmath142 .",
    "the first task of an appropriate numerical scheme for dpde is to preserve ( at least approximately ) the invariants of the dynamics , namely the energy and the total momentum .",
    "while the total momentum conservation is easily ensured , the energy conservation on the other hand is much more demanding .",
    "in fact , the numerical schemes we consider are obtained by a composition of a verlet scheme , which approximately preserves the energy , and a discretization of the fluctuation / dissipation dynamics , which may or may not preserve the energy .",
    "the interaction between these two integrators may lead to drifts in the total energy , even when the integration of the fluctuation / dissipation part exactly preserves the energy , as already observed in ref .  .",
    "in order to precisely quantify the possible energy drifts and determine in particular the influence of the timestep @xmath78 on the drift rate , we compute the average evolution of the energy in time by performing @xmath143 trajectories of time @xmath144 each .",
    "the initial conditions of each trajectory are sampled according to the canonical measure  @xmath60 , obtained by sampling independently the internal energies according to the measure @xmath145 , and the positions and momenta according to the canonical measure @xmath146 .",
    "we denote by @xmath147 the value of an observable @xmath41 at time @xmath148 , obtained by averaging over all the possible trajectories . in practice ,",
    "@xmath149 is approximated by @xmath150 where @xmath151 is the @xmath106-th configuration of the @xmath5-th trajectory .",
    "figure  [ fig : e_t ] shows the behavior of the time - dependent energy drift averaged over trajectories , as a function of time , for various schemes and @xmath152 .",
    "time - dependent energy drift averaged over trajectories , as a function of time when @xmath152 . ]    note that no scheme manages to keep the total energy constant .",
    "linear drifts in time are observed in all cases , svv being substantially worse than all the other schemes in terms of energy conservation .",
    "we study more precisely the drift rates in the remainder of this section , in order to determine the maximal timesteps which can be used in practice before average properties are corrupted .      in order to decide whether the drift is acceptable , we quantify in this section the rate of variation of the energy as a function of the timestep @xmath78 .",
    "figure  [ fig : e_t ] suggests a linear fit of the time - dependent average energies as @xmath153 which allows to identify the relative energy drift rate @xmath154 .",
    "figure [ fig : de_dt ] presents the dependence of @xmath154 as a function of the timestep .",
    "average energy drift rate @xmath154 , as a function of the timestep .",
    "a fit @xmath155 is superimposed to the data .",
    "]    the ser scheme has energy drift rates of the same order than ssa , whereas the drift rates for svv are substantially larger in absolute value .",
    "in addition , we notice that the drift rates of ssa and ser schemes remain lower than @xmath156 , except for ser at @xmath157 .",
    "this means that the energy variation would be less than @xmath158 for simulation times lower than @xmath159 .",
    "such simulation times may be long enough to estimate equilibrium properties , but they may prove somewhat short to estimate transport properties .    moreover , the results of figure [ fig : de_dt ] suggest that the drift rate @xmath154 has a polynomial behavior with respect to  @xmath78 : @xmath160 a least - square fit in a log - log diagram gives @xmath161 for svv , and @xmath162 for the other schemes . this fast increase of the drift rate places a severe limitation on the use of larger timesteps in dpde simulations .",
    "we studied in section  [ subsubsection : energy_drifts ] total energy drifts .",
    "let us now have a more precise look at the drifts of individual energy components ( kinetic , potential and internal ) , for which the drift rates as a function of the timestep are plotted in figure  [ fig : dobs_dt ] . as expected , the drift rates for svv are large for all energy components , and small for all components for ssa .",
    "ser on the other hand exhibits a non - trivial behavior : its drift rates are quite large for individual components of the energy , although these large drifts compensate each other in order for the total energy to drift only slowly .",
    "in fact , we even observed in some situations that the drift of some energy components was not linear as a function of time .",
    "the very notion of drift rate for ser is therefore dubious ( see ref .   for further precisions on this specific issue ) .",
    "drift rates per unit time of the kinetic ( top ) , potential ( middle ) and internal ( bottom ) energies . ]      in order to remove the energy drift , a natural approach , already suggested in ref .  , is to enforce the energy conservation by an appropriate projection on a surface of constant energy .",
    "there are several possible projection procedures .",
    "one possible option is to resort to some lagrange multiplier .",
    "a configuration @xmath163 such that @xmath164 is replaced by @xmath165 , with @xmath166 chosen such that @xmath167 or more explicitly @xmath168 where @xmath169 is the @xmath0-dimensional vector whose components are all equal to  1 . however , the numerical computation of the parameter @xmath166 satisfying   is a computationally expensive task typically requiring several iterations of a newton procedure , and hence several evaluations of the energy per timestep .",
    "note also that the total momentum is not preserved , so that this extra conservation law should be subsequently enforced in an appropriate manner .",
    "it is therefore much more convenient from a practical viewpoint to play on the internal energies only to adjust the total energy  as was also already suggested in ref .  .",
    "more precisely , at the end of one iteration of the numerical scheme , the resulting internal energies are replaced by @xmath170 , where @xmath171 is the unconstrained update of the configuration @xmath172 .",
    "note that this allows to remove energy variations due to the discretization of both the hamiltonian and fluctuation / dissipation parts . in practice",
    ", one has to be careful that internal energies should however remain positive .",
    "enforcing the total energy conservation allows us to obtain a well - defined steady state , for which average properties can be safely computed . for the equilibrium simulations presented in the remainder of section  [ section : equilibrium_simulations ]",
    ", we use the sem , ssa , ser and hybrid schemes presented in section  [ section : numerical_schemes ] , but corrected by the projection procedure on the internal energies .",
    "the results presented in this section are obtained by computing averages over one long trajectory of physical time @xmath173 .",
    "figure  [ fig : obs_dt_proj_big ] shows the average temperatures obtained from the estimators  , and   for @xmath174 , while results for the smaller fluctuation strength @xmath175 are reported in figure  [ fig : obs_dt_proj_small ] .",
    "numerical estimations of the equilibrium temperature as a function of the timestep for @xmath174 .",
    "top : kinetic temperature   and potential temperature  .",
    "bottom : internal temperature  . ]     numerical estimations of the equilibrium temperature as a function of the timestep for @xmath176 .",
    "top : kinetic temperature   and potential temperature  .",
    "bottom : internal temperature  . ]",
    "as expected , all the estimations of the temperature extrapolate to the same value as @xmath177 , for all schemes and for all components of the energy .",
    "the second point is that the systematic biases depend on the timestep @xmath78 as expected , but also on the value of  @xmath22 : larger values of @xmath178 lead to much larger errors .",
    "the third point is that , in opposition to the biases of ssa which remain very small even for large values of @xmath78 and @xmath22 , those of sem and ser are much larger e.g , the bias on the estimation of the kinetic temperature for ser and sem at @xmath179 and @xmath174 is around 30% of the extrapolated reference value .",
    "moreover , in the case of large @xmath78 and large @xmath22 ( typically @xmath174 and @xmath180 ) , ser and sem biases are larger than the linear increase in  @xmath78 observed for smaller timesteps .",
    "in addition , for internal temperatures estimations , the biases between ser and sem deviate at larger timesteps .",
    "thermodynamics averages in this section are computed over a single trajectory of total time @xmath181 .",
    "the system was decomposed on @xmath182 processors .",
    "figure  [ fig : obs_dt_proj_parallel ] presents the temperature estimations as a function of the timestep for @xmath183 , compared to reference values computed by a sequential ssa simulation of a system of @xmath184 particles .",
    "simulation results for @xmath174 are quite similar to sequential results ( although with larger biases ) , except for ser .",
    "indeed , the scheme is not stable even for small timesteps since the energy reinjection procedure may lead to negative internal energies .",
    "this is related to the lower value of @xmath185 used for parallel simulations .",
    "numerical estimations of the equilibrium properties as a function of the timestep for @xmath176 obtained with parallel simulations .",
    "top : kinetic temperature estimates  . middle : average potential energy @xmath186 .",
    "bottom : internal temperature estimates  .",
    "ssa estimates have been computed on a system of @xmath184 particles on a single processor . ]",
    "cpu timings are reported in the second column of table  [ table : benchmarks ] . for the comparison to be fair ,",
    "all the timings have been measured on a single core .",
    "we also compare these timings to reference timings from a sequential ssa simulation ( third column of table  [ table : benchmarks ] ) .",
    "the last column of table  [ table : benchmarks ] gives the required cpu time of a simulation of the same system as in figure  [ fig : obs_dt_proj_parallel ] , using a timestep chosen in order to obtain a given accuracy on the estimation of the kinetic temperature .",
    "for each scheme , this timestep , denoted @xmath187 , is taken such that the bias of the kinetic temperature estimation is equal to @xmath188 , where @xmath188 is defined as the largest bias of the hybrid kinetic temperature estimations of figure  [ fig : obs_dt_proj_parallel ] .",
    "the biases are computed as @xmath189 , where @xmath190 is obtained by extrapolating the results of figure  [ fig : obs_dt_proj_parallel ] to @xmath191 .",
    "the timings of the last column of table  [ table : benchmarks ] , denoted @xmath192 , are then obtained by multiplying the timings of the second column of table  [ table : benchmarks ] with the number of iterations necessary to reach @xmath193 when using the timesteps @xmath187 .",
    "the choice of the kinetic temperature is arbitrary ( as is the choice of @xmath188 ) .",
    "however , timings related to other observables show qualitatively similar results .",
    "the conclusion is that the hybrid scheme allows to achieve an accuracy comparable to ssa for a given cpu cost , while being easily parallelizable . on the other hand , the ser scheme on its own , or sem ,",
    "are not sufficiently accurate to provide interesting alternatives .",
    ".[table : benchmarks ] column 2 : average cpu time per particle per timestep and per processor .",
    "column 3 : timings of column 2 divided by the ssa timing .",
    "column 4 : required cpu time corresponding to simulations with timesteps such that the kinetic temperature estimation has a given bias .",
    "this bias is chosen to be the largest bias of the hybrid kinetic temperature estimations of figure  [ fig : obs_dt_proj_parallel ] . [ cols=\"^,^,^,<\",options=\"header \" , ]     we notice in figure  [ fig : nproc_ratio_influence ] that , as expected , hybrid estimations go from those of ser towards those of ssa as @xmath194 increases . in the particular situation",
    "considered here , ser and ssa estimations have biases of opposite signs that compensate in the hybrid scheme , thus leading to biases smaller than those of ssa .",
    "averages of the internal temperature exhibit similar behaviors as in figure  [ fig : nproc_ratio_influence ] .",
    "ssa and hybrid biases on the potential energy are almost null whatever the ratio @xmath194 .",
    "we study in this section the dynamical properties of systems out of equilibrium , using the schemes presented in section  [ section : numerical_schemes ] .",
    "the system we consider is composed of @xmath195 dpde particles . in order for the numerical values to be easier to interpret from a physical viewpoint",
    ", we work in this section in physical units .",
    "the lennard - jones parameters in   are those of argon : @xmath196  j and @xmath197  m , while the masses of the particles are set to @xmath198  kg .",
    "the initial condition is obtained by melting a face centered cubic crystal composed of @xmath199 unit cells , at density @xmath200  kg.m@xmath201 , with periodic boundary conditions .",
    "we use @xmath202 cores for the simulations , and various timesteps ranging from @xmath203  s to @xmath204  s ( the value @xmath203  s corresponds to @xmath205 in reduced units ) .",
    "a timestep of @xmath203 is similar to the one used to integrate hamiltonian dynamics of shock waves in argon , but is already one order of magnitude larger than for full atom simulations of molecular systems .",
    "finally , we set @xmath206  j.k@xmath207 .    an important point in this section",
    "is that we no longer correct the schemes by the projection of section  [ subsection : drift_correction ] since we consider a nonequilibrium system which is inhomogeneous in space .",
    "this makes indeed the global energy reinjection procedure dubious .",
    "we equilibrate the system at a given temperature @xmath208  k by superimposing to the dpde equations a langevin thermostat on the momenta . with the notation introduced in  ,",
    "we set the friction to @xmath209  kg.s@xmath207 ( which corresponds to @xmath210  kg.m.s@xmath211 or @xmath212 in reduced units ) .",
    "once equilibration is performed , we remove the periodic boundary conditions in the @xmath213 direction , and put two walls of fixed lennard - jones particles of infinite masses on the sides of the simulation box to confine the system .",
    "we next set the system in motion towards the left wall by adding a velocity equal to @xmath214  m.s@xmath207 to all the particles and to the right wall .",
    "the velocity of the right wall is maintained at @xmath215 throughout the simulation .",
    "this leads to the apparition of a shock wave propagating from the left to the right of the simulation box , with an average null velocity in the shocked state .",
    "figure  [ fig : shock_sem ] displays simulation results obtained with the sem scheme with a small timestep @xmath203  s. note that no stationary profile is obtained as the internal temperature increases in time .",
    "a similar increase is observed for the kinetic temperature .",
    "this increase is an artifact of the numerical scheme : we indeed confirmed by additional simulations ( not reported here ) that the increase in the temperature is more pronounced for larger timesteps .",
    "instantaneous internal temperature profiles on the slabs of the cross - section @xmath216 for the sem scheme integrated with a timestep @xmath203  s. ]    on the other hand , for shock simulations performed with the ser or hybrid scheme , no such drift is observed .",
    "figure  [ fig : shock_new ] presents hybrid internal temperature profiles for various times , for a simulation performed with the same timestep @xmath203  s. let us also mention that results obtained with ser ( not reported here ) are completely comparable to the ones presented in figure  [ fig : shock_new ] .     instantaneous internal temperature profiles on the slabs of the cross - section @xmath216 for the hybrid scheme integrated with a timestep @xmath203  s. ]    finally , the results are very similar for hybrid simulations with timesteps up to @xmath217 , as reported in figure  [ fig : shock_hybrid_alldt ] .     instantaneous internal temperature profiles on the slabs of the cross - section @xmath216 for the hybrid scheme integrated with timesteps ranging from @xmath203  s to @xmath218  s at time @xmath219  @xmath220 .",
    "]    this shows that the schemes we developed for equilibrium simulations , in particular the hybrid scheme , can be used without any projection procedure to simulate dynamical evolutions out of equilibrium , with timesteps which are even larger than the ones used for standard deterministic dynamics .",
    "we presented two new numerical schemes for the integration of dpde , based on a splitting strategy between the hamiltonian part of the dynamics and the fluctuation / dissipation .",
    "the first scheme , ser , is constructed by decomposing the kinetic energy variations into elementary contributions related to each particle .",
    "this allows to adjust the internal energies in order for the total energy to be constant .",
    "the decomposition into elementary contributions can be seen as a discrete counterpart to the it calculus used for the derivation of the dynamics in the internal energies .",
    "the other scheme , namely hybrid , is a blending of ssa and ser scheme , where a ser discretization is applied to particle couples belonging to different processors .",
    "we carefully compared the ability of these new schemes to compute equilibrium properties .",
    "all schemes exhibit some spurious energy drift over time , which can however be straightforwardly corrected by an appropriate projection ( performed here by adjusting the internal energies@xcite ) .",
    "the scheme obtained by applying a projection to hybrid has an accuracy quite comparable to the reference accuracy provided by ssa .",
    "therefore , hybrid is a realistic option for a massively parallel dpde simulation  in contrast to other straightforwardly parallelizable schemes where the fluctuation / dissipation is integrated with a simple euler discretization .",
    "the ser was found to be less satisfactory since the individual components of the energy show quite large biases .",
    "in addition , ser was found to be less stable than sem or ssa when corrected schemes are considered . however , its blending into the hybrid scheme cures this somewhat degraded accuracy and stability .",
    "moreover , ser , in opposition to ssa or hybrid , is threadable , thus compatible with the future architectures of supercomputers .",
    "we finally validated the dynamical behavior of our schemes on a non - equilibrium simulation of a shocked lennard - jones material performed on hundreds of processors , a simulation impossible with a naive discretization of dpde . in our opinion , this represents the strongest contribution of this work since it shows that the schemes we introduced , in particular the hybrid scheme , allow to easily simulate dynamical evolutions of large scale systems on massively parallel architectures while at the same time being very accurate on the prediction of equilibrium properties .",
    "this work is supported by the european research council under the european union s seventh framework program ( fp/2007 - 2013 ) / erc grant agreement number 614492 .",
    "the stochastic velocity - verlet algorithm , denoted svv , is an adaption to the dpde setting of the well - known velocity - verlet algorithm to integrate hamiltonian dynamics@xcite .",
    "it consists in using a strang splitting of dpde , where the positions @xmath2 are updated once with a timestep @xmath78 , and the momenta @xmath3 and internal energies @xmath6 are updated twice , both before and after the position update , with a timestep @xmath221 : @xmath222 note that the same random number is used in the first and second updates of the momenta .",
    "however , the fluctuation / dissipation part has to be computed twice per step .",
    "there are several notions of consistency for stochastic differential equations ( sdes ) , see for instance ref .  .",
    "in this work , we consider the consistency of numerical schemes in the sense of weak errors . as a corollary , this allows to estimate errors on average properties when the schemes are ergodic .    in order to be more precise ,",
    "we define the evolution operator associated with the sde  : @xmath223,\\ ] ] where @xmath163 and @xmath224 denotes the average over all realizations of the brownian motions in  . in words , the evolution operators give the average value at time  @xmath148 of an observable  @xmath41 , for a system started in a given configuration  @xmath225 at time  0 .",
    "the operator @xmath226 is called the infinitesimal generator , and is the adjoint of the fokker - planck operator associated with the dynamics . for dpde , it writes@xcite @xmath227 where @xmath228    the numerical schemes we consider in this work can be represented by a mapping @xmath229 as @xmath230 .",
    "the evolution operator @xmath231 associated to a numerical scheme is defined as @xmath232,\\ ] ] where @xmath224 now is an average over all the random variables involved in the computation of @xmath233 .",
    "the weak error of a numerical scheme is the maximum error between the time averages of the exact solution and the ones predicted with the numerical scheme .",
    "a method is of weak order  @xmath234 if , for any observable @xmath41 and for any simulation time @xmath235 , there exists @xmath236 such that , for @xmath78 sufficiently small , @xmath237 - { \\mathbb e}\\left[a(x^n)\\right ] \\big| \\leq k{\\delta}t^\\eta,\\ ] ] where averages are taken for a given initial condition  @xmath238 . in order to be of weak error  @xmath234",
    ", a numerical scheme should satisfy@xcite @xmath239 in fact , when this condition holds , it can be proved that , provided the numerical scheme and the continuous dynamics are ergodic , the invariant measure of the numerical scheme is correct up to errors at most @xmath240 ( and sometimes less , see for instance ref .   for a discussion in the context of langevin dynamics ) .",
    "therefore , the exponent  @xmath234 in   is determined by expansions such as  .",
    "we prove below that   holds with @xmath85 for ser ( see section  [ sec : consistency_ser ] ) .",
    "this result is obtained by a general approximation result for splitting schemes , recalled in section  [ sec : general_consistency ] .",
    "we recall in this section the general strategy for proving   with @xmath85 for splitting schemes .",
    "we assume that the dynamics can be decomposed into @xmath5 elementary dynamics .",
    "this induces a decomposition of the generator as @xmath241 let @xmath242 be the evolution operator associated with the numerical integration of the elementary subdynamics with generators @xmath243 . if the splitting is done according to the trotter formula@xcite @xmath244 and if   holds for every subdynamics with @xmath85 , then   holds for the complete numerical scheme  @xmath231 ( see for instance the discussion in ref .  ) .",
    "the hamiltonian part of dpde is integrated with a velocity - verlet algorithm@xcite , and the corresponding evolution operator turns out to be correct at second order .",
    "therefore , in order to prove the weak consistency of order  1 for the schemes under consideration , it suffices to prove that the fluctuation / dissipation is integrated with a scheme of weak order  1 .",
    "a simple computation shows that   implies @xmath245 where @xmath246 in this expression , we introduced @xmath247 with @xmath248 the random variables @xmath249 involve only terms containing one gaussian random variable .",
    "therefore , they vanish in average : @xmath250 = 0 $ ] . the random variables @xmath251 involve terms containing products of gaussian variables , but their averages can be easily computed as @xmath252 = d \\ , { \\delta}_{ik}{\\delta}_{jl}$ ] .",
    "a simple computation then shows that @xmath253 = d{\\sigma}^2\\chi ( {    r_{ij}^n})/m$ ] .",
    "let @xmath254 be the result of an euler - maruyama discretization of the fluctuation / dissipation dynamics   ( _ i.e. _ the scheme  ) .",
    "the previous computations show that ser can be seen as a perturbation of the euler - maruyama scheme : @xmath255 and @xmath256 since the euler - maruyama scheme is weakly consistent of order  1 , and since the two dominant terms in the above expansion vanish in average , a simple taylor expansion then shows that the integration of the fluctuation / dissipation part in ser is also weakly consistent of order  1 ."
  ],
  "abstract_text": [
    "<S> this work presents new parallelizable numerical schemes for the integration of dissipative particle dynamics with energy conservation ( dpde ) . </S>",
    "<S> so far , no numerical scheme introduced in the literature is able to correctly preserve the energy over long times and give rise to small errors on average properties for moderately small timesteps , while being straightforwardly parallelizable . </S>",
    "<S> we present in this article two new methods , both straightforwardly parallelizable , allowing to correctly preserve the total energy of the system . </S>",
    "<S> we illustrate the accuracy and performance of these new schemes both on equilibrium and nonequilibrium parallel simulations . </S>"
  ]
}