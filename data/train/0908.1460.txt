{
  "article_text": [
    "the number of particles used in simulations of galaxy formation with @xmath0-body / smoothed particle hydrodynamics ( sph ) method has not increased much since the early days of @xcite and @xcite , though the number of particles used in pure @xmath0-body cosmological simulations has increased drastically . for @xmath0-body simulations ,",
    "the largest run in 1991 used @xmath1 particles @xcite and the largest run recently performed used @xmath2 particles @xcite .",
    "the number of particles has grown by nearly four orders of magnitudes in two decades . on the other hand , for @xmath0-body / sph simulations of galaxy formation , the first simulations used @xmath3 sph particles for a single halo @xcite and the largest simulation which is performed recently used @xmath4 sph particles for a single halo @xcite .   the scale up factor is only @xmath5 in two decades .",
    "this is because time - steps become quite short in dense and compact self - gravitating gas clouds of star - forming regions .",
    "this problem is severer in simulations with higher resolution , since these simulations resolve denser gas . in general , supernova ( sn ) explosion in dense regions leads the shortest time - step . here",
    "we roughly estimate the decrease of the time - steps due to sne .",
    "we consider a compact region of the interstellar medium ( ism ) with the temperature of @xmath6 , where the sound speed is @xmath7 , as a potential site of the star formation and that the region is rapidly heated to @xmath8 , where the sound speed is @xmath9 , by sn with the energy of @xmath10 . the contraction factor between the time - step of the ism after the sn , @xmath11 , and before the sn",
    ", @xmath12 , in the compact region is @xmath13 where @xmath10 is the energy of the single sn and @xmath14 is the mass of the heated region or the mass resolution in lagrange schemes such as sph , respectively , and we use @xmath15 . from this equation",
    ", we can easily find that the contraction factor becomes smaller when ( i ) mass resolution becomes higher and ( ii ) the temperature of the ism becomes lower ( see also section [ sec : estimation ] for more detailed discussion ) .",
    "thus high - resolution simulations which model the ism with low temperature ( @xmath16 ) require much shorter time - steps than conventional simulations of galaxy formation with a cooling cut off at @xmath17 .",
    "the individual time - step method @xcite reduces the total calculation cost significantly in simulations which cover a wide range of timescales , by assigning different time - steps to different particles and integrating only a small fraction of particles with small time - steps . here , we extend this idea for the time integration of self - gravitating fluid particles in order to achieve a further reduction of the total calculation cost .",
    "our new method allows an individual fluid particle to have different time - steps for gravitational and hydrodynamical interactions and integrates these interactions asynchronously . as stated earlier , the smallest time - steps are associated with particles heated by sne feedback .",
    "these particles have the thermal and kinetic energy many orders of magnitudes larger than the gravitational potential energy . therefore ,",
    "if we assign different time - steps to gravitational and hydrodynamical forces , we should be able to use much longer time - step for gravity , thereby accelerating simulations by a large factor .",
    "we named this time - integration scheme for self - gravitating fluid as fast ( * f*ully * a*synchronous * s*plit * t*ime - integrator ) .",
    "there are two main advantages of the fast method over the traditional individual time - step method for self - gravitating fluid simulations .",
    "first , fast reduces unnecessary gravitational force evaluations in small time - steps induced by sne .",
    "since the number of dark matter and stellar particles is usually larger than that of sph particles in typical simulations of galaxy formation , the calculation cost of gravity is larger than that of hydrodynamics .",
    "this reduction of unnecessary evaluation of gravity is quite efficient for the acceleration of simulations .",
    "simulations with hardware accelerators , such as grapes @xcite , receive further benefit from fast , since hardware accelerators are inefficient in calculations with small number of particles , because of small bandwidth and large latency of the bus between the host computer and the accelerator .",
    "the second advantage appears when we combine the individual time - steps and the tree method @xcite .",
    "since the cost of the tree construction is independent of the number of active particles , it dominates the total calculation cost when the number of particles with small time - steps is small .",
    "consequently , the total performance of simulation is not much improved by the use of individual time - steps .",
    "table 1 of @xcite showed such a bad case .",
    "we can see that a half of the cost of smallest steps is that of the `` tree building '' part . by adopting fast ,",
    "the number of tree construction is reduced and hence simulations with the individual time - step and tree methods are accelerated significantly .",
    "there are several other ways to reduce the cost of simulations with the individual time - steps and tree methods .",
    "@xcite applied the local update to the tree structure around particles which were updated , instead of reconstructing the whole tree structure at each step .",
    "this technique was used in gadget-1/2 @xcite . in vine",
    "@xcite , the construction frequency of tree structure was reduced by skipping several continuous time - steps and reusing old tree structure for force calculation .",
    "they updated the tree structure at every @xmath18 steps for the problem they showed in their paper .",
    "fast method can be combined with these schemes to further reduce the cost of tree construction , if necessary .",
    "our approach is similar to the multiple time - step method used in molecular dynamics , in which the long - range coulomb force is updated less frequently than short - range van del waals force @xcite .",
    "the main difference is that we combine the force splitting with individual time - steps .",
    "the structure of this paper is as follows . in section [ sec :",
    "estimation ] , we estimate and compare the time - steps of particles in the hot region of star - forming galaxies . in section",
    "[ sec : idea ] , we describe our new integration method for self - gravitating fluid , fast .",
    "we briefly explain its implementation in  [ sec : implimentation ] .",
    "we present the results of test calculations and timing results in section [ sec : tests ] . a discussion on the maximum acceleration factor by fast appears in section [ sec : discussion ] . in section",
    "[ sec : summary ] , we provide summary .",
    "in this section , we estimate typical time - steps of an sph particle in star forming regions of actively star forming galaxies in @xmath0-body / sph simulations of galaxy formation .",
    "this estimation allows us to estimate the maximum gain in the performance due to the use of the fast scheme .",
    "we compare the typical courant time - step of an sph particle heated by sne with the typical gravitational time - step of the particle .    here",
    "we estimate the typical courant time - step of an sph particle heated by sne . for simplicity",
    ", we adopt following four assumptions .",
    "first , we adopt a single stellar population ( ssp ) approximation for a star particle with salpeter initial mass function ( imf ) @xcite and the range of this imf is set to be @xmath19 to @xmath20 . for this imf ,",
    "the specific sn rate is @xmath21 , where we assume @xmath22 or heavier stars become sne at the final phase of their evolutions .",
    "second , we assume that each sn injects the thermal energy of @xmath23 to the surrounding ism ( the nearest @xmath24 particles ) .",
    "third , we assume that the whole energy from sne in a star particle discharges in a single event ( this is one of sn feedback implementations proposed by @xcite ) .",
    "finally , we assume that the masses of the stellar and gas particles are the same .",
    "the mean additional internal energy for @xmath24 sph particles due to sne of a single stellar particle is given by @xmath25 , \\nonumber \\\\",
    "& \\simeq & \\frac{3.7 \\times 10^{15}}{n_{\\rm nb } } [ { \\rm ergs~g^{-1 } } ] , \\end{aligned}\\ ] ] where @xmath26 and @xmath27 are the masses of stellar and gas particles , respectively , and we use the relation @xmath28 .",
    "the sound speed , @xmath9 , of the heated gas region is @xmath29 , \\label{eq : soundspeed}\\end{aligned}\\ ] ] where we assume an ideal gas with the adiabatic index of @xmath30 .",
    "the original internal energy of the ism before sne , @xmath31 , is quite small , therefore we neglected @xmath31 in the estimation of @xmath32 .",
    "the corresponding temperature of the heated region is @xmath33}$ ] .",
    "note that this temperature implies very short cooling timescale of @xmath34 . in real star - forming region , initially the sn ejecta have much high temperature , and the cooling time is much longer . in order to model sn feedback in a physically correct way ,",
    "therefore , some tricks which prevent the quick radiative cooling @xcite is necessary .",
    "we here assume some of these tricks are used .",
    "the size of an sph particle , @xmath35 , is @xmath36 where @xmath37 is the density of the sph particle . combining equations ( [ eq : soundspeed ] ) and ( [ eq : size ] )",
    ", we obtain the sound crossing time , @xmath38 , in the heated region as follows : @xmath39 , \\label{eq : t_sn}\\end{aligned}\\ ] ] where we adopt @xmath40 and @xmath41 is the hydrogen number density of the heated region . the typical courant time - step in the region",
    "is @xmath42 .",
    "this equation tells us that the smallest time - step in simulations involving the low temperature ism and sne becomes shorter when mass resolution becomes higher and injected region becomes denser .    by comparing equation ( [ eq : soundspeed ] ) with the typical velocity of the ambient ism",
    ", we can obtain the contraction factor of the time - steps caused by a sn explosion . although the typical temperature of giant molecular clouds ( gmcs ) is low ( @xmath43 ) and the corresponding sound speed in gmcs is small ( @xmath44 ) ,",
    "the linewidth of gmcs is higher than that expected by the sound speed of the ism and predicts that gmcs are supported by supersonic turbulence .",
    "thus we use empirical relations for the estimate of the timescale , instead of the local sound speed .",
    "the linewidth - size relation , which is often referred as larson s law @xcite , gives us the typical velocity at the size of cloud .",
    "larson s law is as follows : @xmath45 , \\label{eq : larson}\\ ] ] where @xmath46 and @xmath47 are the linewidth and size of a cloud , respectively , and the applicable range of this relation is @xmath48 . combining the virial theorem and this relation , we obtain cloud mass - linewidth relation @xcite that @xmath49 where @xmath50 is a cloud mass .",
    "when we substitute @xmath51 into @xmath50 , we obtain the mass resolution - linewidth relation : @xmath52}.   \\label{eq : resolution - linewidth}\\ ] ] this equation leads the velocity of the smallest cloud which can be expressed with the resolution of the simulation .",
    "the contraction factor of the time - step in the ism by a sn explosion , @xmath53 , is @xmath54 where we adopted @xmath40 .",
    "this equation clearly shows that the courant condition becomes quite tight in ism heated by a sn explosion .",
    "when we use @xmath55 , which is the sound speed of the ism at @xmath56 , as the typical velocity of the ism , the contraction factor is @xmath57 .",
    "we again adopted @xmath40 .",
    "the contraction factor for simulations with the multiphase ism and turbulence motions is smaller than that in conventional simulations of galaxy formation with a cooling cut off at @xmath56 .    in conventional simulations of galaxy formation , where the typical mass resolution is @xmath58 and",
    "the highest density of the ism is @xmath59 , the typical time - step for the heated region is @xmath60 .",
    "the typical gravitational time - step , one - tenth of the local free - fall time at @xmath61 , is @xmath62 .",
    "the difference between the courant and gravity time - steps is @xmath18 . on the other hand , in state - of - the - art simulations involving the multiphase ism , where @xmath63 and @xmath64 , the typical time - step is @xmath65 , whereas the the typical gravitational time - step at @xmath66 is @xmath67 .",
    "the difference between two time - steps is @xmath68 and this difference is larger than that in conventional simulations .",
    "these simple estimates tell us that fast can reduce gravity steps by a factor of @xmath69 .",
    "fast is more efficient in simulations with high resolution .",
    "thanks to the rapid increase of the computational power and the advance of numerical techniques , the mass resolution in current high resolution simulations of the galactic scale ism has been quite high ( @xmath70 ) .",
    "it will be soon reach the point than the mass resolution at where the number of sn events in an ssp particle is less than unity .",
    ", which is obtained by @xmath71 , the number of sne events in an ssp particle is lower than unity . if we use @xmath72 , @xmath73 . ] in such simulations , sn events are necessary to be treated as not an association of sne in every ssp particle but discrete events in a fraction of ssp particles so that the global sn event rate is consistent with the adopted imf . otherwise , we would introduce `` fractional '' sne , which clearly would give wrong results for sne feedback . by this modification in the treatment of sne ,",
    "the sound speed of the ism in heated regions becomes much higher than that in equation ( [ eq : soundspeed ] ) and the crossing time in these regions becomes much shorter than that in equation ( [ eq : t_sn ] ) .",
    "we show here a simple estimate of time - steps in the case where sn explosions are discrete events in ssp particles . when we consider a sn explosion takes place in discrete manner , the received energy of the surrounding ism of a compact region",
    "is modified as follows : @xmath74 , \\nonumber \\\\ & \\simeq & \\frac{5.0 \\times 10^{17}}{n_{\\rm nb } }       \\bigl ( \\frac{1~\\mo}{m_{\\rm sph } } \\bigl ) ~[{\\rm ergs~g^{-1 } } ] , \\end{aligned}\\ ] ] where we again neglected the original internal energy because the value is sufficiently low compared with this value .",
    "the sound speed of the hot region is @xmath75 .",
    "\\label{eq : soundspeed , d}\\end{aligned}\\ ] ] the contraction factor is @xmath76 note that the mass dependency in this equation is much stronger than that in equation ( [ eq : r_cont ] ) .",
    "combining equations ( [ eq : soundspeed , d ] ) and ( [ eq : size ] ) , the sound crossing time in the heated region , @xmath77 , is @xmath78 , \\label{eq : t_sn , d}\\ ] ] where we adopt @xmath40 .",
    "we find that the mass resolution dependence in the equation ( [ eq : t_sn , d ] ) is stronger than that in the equation ( [ eq : t_sn ] ) .",
    "thus high resolution simulations of near future will be much harder than those of present .",
    "for efficient simulations , we have to introduce efficient numerical techniques which can handle a very wide range of time - steps .",
    "we believe that our new scheme will play an important role not only in current simulations but also in new simulations of galaxy formation in the near future .",
    "the basic idea of our new scheme is as follows .",
    "we allow gas ( sph ) particles to have different time - steps for gravitational and hydrodynamical integrations .",
    "thus , we extend the idea of individual time - steps , which allows different particles to have different time - steps , to allow single particle to have different time - steps for different interactions . we then asynchronously integrate gravity and hydrodynamics with these different time - steps .",
    "this is the essence of our fast method .",
    "since the problem we have to solve is the time - integration of very hot gas particles formed by sne , we allow time - steps for gravity to be longer than those for hydrodynamics . to allow different time - steps for gravity and hydrodynamics",
    ", we use the technique of constructing multi - timestep symplectic integrator .",
    "we divide the hamiltonian of a self - gravitating fluid system into a gravitational potential term and others , and integrate each part with its own time - step .",
    "the hamiltonian of a self - gravitating fluid system of @xmath0 gas particles is expressed as @xmath79 where @xmath80 and @xmath81 are conjugate variables of the canonical equation for particle @xmath82 , @xmath83 is the mass of particle @xmath82 , @xmath84 is the internal energy of fluid , which is a function of @xmath85 , density , @xmath86 , and entropy , @xmath87 . here ,",
    "@xmath85 , @xmath88 , and @xmath87 denote @xmath89 , @xmath90 , and @xmath91 , respectively .",
    "since we take into account arbitrary forms of hydrodynamical interactions , we express the internal energy for fluid as @xmath92 .",
    "the first , second , and third terms in the right hand side of equation ( [ eq : hamiltonian_hydro ] ) are the kinetic , internal , and gravitational potential energy of the system , respectively .",
    "the actual equations for @xmath93 and @xmath94 contain the contributions of non - conservative terms like artificial viscosity and radiative cooling / heating . for simplicity , we here regard the system as adiabatic ( i.e. , @xmath95 are treated as constants ) .",
    "hence the internal energy term becomes the function of ( @xmath96 ) and can be regarded as a potential term in the hamiltonian .",
    "we split the hamiltonian into the gravitational potential term and others ( see appendix [ sec : symplecticschemes ] ) : @xmath97 we then obtain the following expression of a symplectic integrator with the second - order accuracy , @xmath98 where `` @xmath99 '' is a poisson bracket and @xmath100 is a time - step .",
    "the equation ( [ eq : gravity_hydro_integral ] ) can schematically rewrite as follows : @xmath101 where @xmath102 , @xmath103 , @xmath104 , and @xmath105 indicate the position , the velocity , the half - step advanced velocity , and the acceleration of gravitational force , respectively",
    ". subscripts @xmath106 and @xmath107 indicate epochs of time - integration at @xmath108 and @xmath109 , respectively .",
    "there are many ways to integrate the hydrodynamical part of equation ( [ eq : gravity_hydro_integral ] ) , we here choose the second - order symplectic method ( e.g. , @xcite ) .",
    "we divide equation ( [ eq : hydro ] ) again into the following two parts : @xmath110 consider the case that @xmath111 , where @xmath112 is a natural number .",
    "we obtain a new expression of equation ( [ eq : gravity_hydro_integral ] ) as @xmath113^l \\nonumber \\\\ & & e^{\\frac{\\delta t_g}{2 } \\{,h_{\\rm grav}\\ } } f(t ) .",
    "\\label{eq : gravity_hydro_integral_subcycle}\\end{aligned}\\ ] ] this equation tells us that we can reduce the computational cost of gravity if @xmath114 ( @xmath115 ) .",
    "if we adopt @xmath116 , the integrator is the same as the standard `` leap - frog '' method for self - gravitating fluid .    in figure",
    "[ fig : schematicpicture ] , we show schematic pictures of the usual leap - frog and fast methods . for fast , we consider the case that @xmath117 .",
    "the computational cost of gravitational force in fast becomes half of the leap - frog method in this case . in practice ,",
    "the time - step ratio , @xmath112 , adaptively changes .",
    "it should be noted that , even though we borrowed the formalism of symplectic integrators to describe our fast method , the fast method itself is not symplectic .",
    "this is because we change the time - steps for gravitational and hydrodynamical interactions , after we split the hamiltonian . in addition , we use different time - steps for different particles .",
    "however , this issue is not as crucial as that is for pure @xmath0-body simulations , since the usual hydrodynamical simulations introduce a dissipation term .",
    "the time - integration of hydrodynamic simulations is usually time irreversible and is breaking the symplectic nature inherently .",
    "there have been several proposed methods which can retain either symplecticness @xcite or time symmetry @xcite when used with the individual time - step method",
    ". however , these schemes are computationally expensive and it is not clear if the use of these schemes is worthwhile or not . in this paper",
    ", we concentrate on the traditional , non - symplectic implementation of individual time - step algorithm and its extension .",
    "the code used in this paper is a parallel tree sph code , asura , which utilizes the special purpose hardware grape ( saitoh in prep . ) .",
    "gravitational force was solved by tree with grape @xcite . in this paper",
    ", we used the phantom grape library for calculations of gravity , which is a software emulator of grape pipelines ( kindly provided by kohji yoshikawa ) .",
    "we used an opening angle of 0.5 and only monopole moments for force calculations .",
    "hydrodynamics was followed by the standard sph method ( e.g. , @xcite ) .",
    "we used the `` gather '' formulation of sph for the density estimation , whereas the `` gather and scatter '' formulation of sph for the pressure gradient and the time derivation of internal energy @xcite .",
    "we adopted the asymmetric form energy equation ( e.g. , @xcite ) .",
    "we iteratively determined the kernel radius of each sph particle in every step in order to keep the number of neighbor particles , @xmath118 .",
    "we used an artificial viscosity term , of which form is the same as that proposed by @xcite , in order to handle shocks .",
    "the value of the viscosity parameter , @xmath119 , was set to be unity .",
    "asura adopts the variable and individual time - step method @xcite .",
    "following @xcite , asura adopts an extended version of the individual time - step method , _",
    "i.e. _ , the `` hierarchical '' time - step method where time - steps are quantized by the power of two of a baseline time - step in order to improve the simulation performance with individual time - steps .",
    "we also implemented the time - step limiter for hydrodynamical interactions in order to maintain the difference of time - steps among neighbor particles small enough @xcite .",
    "here we adopted the factor of the time - step difference in neighbors , @xmath120 .",
    "the current version of asura implements two time integrators , namely the ordinary leap - frog and fast methods .",
    "the time - steps were determined as follows .",
    "the gravity time - step of an @xmath82-th particle was estimated by @xmath121 where @xmath122 is a gravitational softening length , @xmath123 is a parameter which controls the accuracy ( we here adopt 0.1 ) , and @xmath124 is the time derivation of the acceleration , respectively .",
    "following @xcite , the hydrodynamical time - step of the @xmath82-th sph particle was determined by @xmath125 where @xmath126 is the kernel size of the sph particle ( the interaction scale is @xmath127 ) , @xmath128 , and @xmath129 is the local maximum signal - velocity of @xmath82-th particle defined by @xmath130 where @xmath131 indicates the indices of neighbor particles , @xmath132 and @xmath133 is the sound speed of @xmath82-th and @xmath131-th sph particles and @xmath134 is a projected relative velocity between the sph particles .",
    "we set @xmath135 if @xmath136 .",
    "when we use the fast method , we asynchronously integrate gravity and hydrodynamics by the leap - frog method with different time - steps for gravity ( eq .",
    "[ eq : dtgrav ] ) and hydrodynamics ( eq . [ eq : dthydro ] ) .",
    "if @xmath137 where @xmath138 is an integer number of @xmath139 , we change the gravitational time - step so that it satisfies the above criterion in the following way : we reduce the time - step of gravity to @xmath140 , where @xmath141 , and @xmath138 is the maximum integer number that satisfies this relation . if @xmath142 , we reduce @xmath143 to the same value as @xmath144 .",
    "when we used the ordinary leap - frog method , we picked up the smaller one of the two time - steps as the time - step of an sph particle , @xmath145 and synchronously integrated both gravity and hydrodynamics . in general , the acceleration and its differential terms in equation ( [ eq : dtgrav ] ) should be measured relative to the total acceleration ( _ i.e. _ , the sum of the gravitational and hydrodynamical accelerations ) . however , in the hydrodynamical simulations , the courant condition leads the smaller time - step compared with the time - step obtained by the total acceleration .",
    "therefore the simple determination by equation ( [ eq : dts ] ) worked sufficiently .",
    "we performed three tests .",
    "the first test was the collapse of a gas cloud and the second test was the point - like explosion of a self - gravitating gas cloud .",
    "the third test was a more realistic simulation .",
    "we performed simulations of galaxy - galaxy collisions , where galaxies consist of dark matter , star and gas particles .",
    "these tests incorporated both gravity and hydrodynamics and were representative of the evolution of self - gravitating fluid in galaxy formation simulation or other astrophysical simulations .",
    "we , hereafter , denote the results with the ordinary individual time - step method as `` ind '' and the results with the individual time - step with the fast method as `` fast '' , in tables and figures .",
    "the first two tests were designed as simple tests for the validity of the fast method , while in the third test we investigated the actual gain in the calculation speed as well as the accuracy of the result .",
    "the first and second tests were done on a system with a @xmath146 ghz opteron @xmath147 processor ( italy core ) , while the third test was done on @xmath148 ghz quad - core opteron processors ( barcelona core ) of cray xt4 system at center for computational astrophysics of national astronomical observatory of japan .",
    "we used one cpu core for the first and second tests , whereas we used @xmath149 cpu cores for the third test .",
    "we performed the integration of three - dimensional spherical collapse of adiabatic gas ( e.g. , @xcite ) .",
    "this test is one of standard tests for sph method which involves self - gravity .",
    "we prepared a gas sphere with the total mass and the radius both unity .",
    "the gravitational constant was also set to be unity .",
    "the initial profile of the gas sphere was @xmath150 , where @xmath151 is the distance from the center of coordinates .",
    "the adiabatic index and the specific internal energy of the gas were set to be @xmath30 and @xmath152 , respectively .",
    "the gas sphere had a negative value of the total energy , @xmath153 .",
    "when the evolution starts , the sphere begins to collapse .",
    "the shock takes place in the central region and it propagates outward .",
    "finally , the system reaches the state of virial equilibrium . in this test",
    ", we used @xmath154 particles for the sphere and we followed the evolution of the gas sphere to @xmath155 .",
    "we adopted @xmath156 for the gravitational softening length .",
    "figure [ fig:3dcollapse ] shows radial profiles of density , pressure , and radial velocity in three different epochs , @xmath157 , @xmath158 and @xmath146 , for both the ordinary individual time - step and fast methods . in this figure , we plotted mean physical quantities of every 300 particles .",
    "it is obvious that the results of two methods are identical .",
    "we also confirmed that these results agree well with the result obtained using global time - steps .",
    "therefore we can conclude our new method is accurate enough .",
    "figure [ fig : dts ] shows the values of time - steps for gravity and hydrodynamics for the run with the fast method as a function of the distance from the center at @xmath157 .",
    "time - steps for gravity and hydrodynamics are different in the post - shock region and the same in the ambient , pre - shocked region .",
    "the transient region clearly matches with the shock front at the radius of @xmath159 ( see the top - left panel of figure [ fig:3dcollapse ] ) .",
    "the values of @xmath143 and @xmath144 in the post - shock region differ by a factor up to four .",
    "figure [ fig : dts_fraction ] shows cumulative fractions of @xmath143 and @xmath144 for the simulation with the individual time - step with fast .",
    "we can see that almost half of the particles have hydro time - steps smaller than the minimum time - step for the gravity .",
    "the errors of the total energy , the difference between the values of the total energy at the initial ( @xmath160 ) and final ( @xmath155 ) states , for the ind and fast methods are shown in table [ tab:3dcollapseerrors ] .",
    "@xmath161 and @xmath162 represent the initial ( @xmath163 ) total energy and the final ( @xmath164 ) total energy , respectively .",
    "these values are acceptably small . in our test runs ,",
    "the absolute value of the energy error for the time integration with fast is smaller than that for the time integration without fast even though the time - step for gravity is larger .",
    "the errors caused by the gravitational and hydrodynamical integrations had the opposite signs and partially canceled each other .",
    ".total energy errors for the spherical collapse test .",
    "[ cols=\"<,^\",options=\"header \" , ]      +",
    "in this section , we estimate the maximum acceleration factor due to the introduction of the fast method using a simple calculation cost model . by comparing the calculation costs of the runs with / without fast , we obtain the acceleration factor due to the fast method .",
    "we here model the calculation cost of a simulation as follow : @xmath165 where @xmath166 and @xmath167 are the number of steps for gravity and hydrodynamics , @xmath168 and @xmath169 are the calculation times of tree construction for gravity and hydrodynamics , @xmath170 and @xmath171 are the mean number of updated particles for gravity and hydrodynamics in each step , @xmath172 and @xmath173 are the mean evaluation time of gravity and hydrodynamical interactions for a single particle , respectively , and @xmath174 and @xmath175 are the mean calculation times in a single step for gravity and hydrodynamics , respectively . in this model , we neglected the calculation cost of miscellaneous operations , such as domain decomposition , time - integration , evaluations of time - steps .    in traditional individual time - steps ,",
    "the number of gravity steps is the same as that of hydrodynamical steps .",
    "therefore the total calculation cost with traditional individual time - steps is @xmath176 on the other hand , in fast , the number of gravity steps is different from that of hydrodynamical steps . according to the argument in section [ sec : estimation ] , the number of hydrodynamical steps is about ten times larger than the gravity steps .",
    "it means @xmath177 in equation ( [ eq : tall_simple ] ) .",
    "thus , the total calculation cost with fast expresses as @xmath178    the acceleration factor is defined as @xmath179 . if we assume that the number of hydrodynamical steps in the calculation without fast is the same as that with fast and that calculation times between with / without fast are the same , the acceleration factor is @xmath180 in this equation , we removed suffixes @xmath181 and @xmath182 of calculation costs . here",
    "we consider three typical cases that @xmath183 , @xmath184 , and @xmath185 .",
    "the first case corresponds to usual @xmath0-body / sph simulations . in this case",
    ", the acceleration factor is @xmath186 , and is quite large .",
    "the second case corresponds to the case that ( a ) the calculation time of the gravitational force reduces significantly by adopting hardware / software accelerators , such as grape or phantom - grape , and/or ( b ) the calculation cost of hydrodynamics is rather expensive because of the treatment of complex baryon physics , for instance star formation , sne , and chemical evolution .",
    "the acceleration factor in this case is @xmath187 .",
    "our simulations are close to the second case .",
    "the final case is the ideal case that the calculation cost for gravity is negligible . in this case , the acceleration factor becomes unity and the gain due to fast is zero .",
    "we do not think this hypothetical situation can occur .",
    "in this paper , we describe a fast integrated method , `` fast '' for self - gravitating fluid .",
    "the fast method assigns different time - steps for gravitational and hydrodynamical interactions and integrates them asynchronously .",
    "the formulation of the fast method is similar to the multi time - step method @xcite and also regarded as an extension of `` multi - step '' symplectic integrators , such as mixed variable symplectic @xcite , multiple stepsize @xcite , and the bridge @xcite methods .",
    "the approach of the fast method is qualitatively different from other reduction techniques of the tree construction in gravity part .",
    "thus the fast method eliminates unnecessary tree constructions and gravity calculations by adopting longer time - steps for gravitational evolution than that for hydrodynamics .",
    "we found that the evolution of collapsing and exploding self - gravitating fluid by the fast method are identical to these by the usual unsplit method which integrates gravity and hydrodynamics synchronously .",
    "as a realistic test , we applied the fast method to merger simulations including self - gravity , hydrodynamics , radiative cooling , far - ultraviolet heating , and sn @xcite . in this test",
    ", we found that simulations with and without the fast method showed quite similar evolution .",
    "the calculation with fast was nearly a factor of two faster .",
    "this large gain was due to the reduction in the gravity steps with small number of particles .",
    "the fast method is very effective in accelerating simulations of self - gravitating fluid .",
    "we thank the anonymous referee for his / her insightful comments and suggestions , which helped us to greatly improve our manuscript .",
    "we also thank takashi ito , keiichi wada , michiko fujii and tomoaki ishiyama for useful discussion and kohji yoshikawa , who kindly provided us with a custom version of the phantom - grape library .",
    "a part of numerical tests were carried out on cray xt4 and grape system at center for computational astrophysics of national astronomical observatory of japan .",
    "this project is supported by grant - in - aid for scientific research ( 17340059 ) of jsps , mext japan the special coordination fund for promoting science and technology , `` grape - dr project '' , and molecular - based new computational science program of nins .",
    "trs is financially supported by a research fellowship from the japan society for the promotion of science for young scientists .",
    "in this appendix , we explain the symplectic integration method briefly .",
    "then we explain sophisticated versions of symplectic integration methods , _",
    "i.e. _ , mixed variable symplectic method @xcite , multiple stepsize method @xcite , and the bridge @xcite methods .",
    "symplectic integration methods ( e.g. , @xcite ) are now widely used in the simulations of gravitating @xmath0-body systems .",
    "these methods preserve the symplectic form of the canonical equation of motions when calculating the time variation of the system .",
    "this character leads to the very good conservation of system s total energy on the course of numerical calculation .",
    "when we express @xmath188 as the hamiltonian of the system , and @xmath93 and @xmath189 as six - dimension coordinates , canonical equations are @xmath190 we can summarize above two equations as @xmath191 where @xmath192 is @xmath93 or @xmath189 , respectively , and @xmath193 is a poisson bracket .",
    "we define an operator that @xmath194 we can write a generalized canonical equation ( [ eq : poisson ] ) as @xmath195 when we integrate equation ( [ eq : poisson3 ] ) from @xmath108 to @xmath109 , the formal solution of the equation ( [ eq : poisson3 ] ) is written as @xmath196      applying barker - champbell - hausdorff formula @xcite to equation ( [ eq : integral2 ] ) , we obtain a first order integrator @xmath200 and a second order integrator @xmath201 this second order integrator is well known as the _ leap - frog _ integrator .",
    "it is widely known that symplectic integration methods can achieve high - accuracy once we split hamiltonians into several components .",
    "mixed variable symplectic ( mvs ) method @xcite splits the hamiltonian into an unperturbed part with an analytic solution ( i.e. , keplerian motion when we traced planetary motion ) and a perturbation part ( i.e. , mutual gravitational perturbation among planets ) .",
    "when the system is nearly integrable , the hamiltonian for the unperturbed part becomes much larger than that of the perturbed part , which enables the method to accomplish a very high accuracy in integrating the equations of motion , compared with conventional symplectic integrators .",
    "the multiple stepsize ( mss ) method @xcite splits a potential into the sum of potentials of a short - range and a long - range forces and gives different time - steps for different ranges of forces .",
    "the mss method accomplishes the similar accuracy compared with the usual symplectic method applied with small time - step .",
    "the use of different time - steps for different interactions was proposed for the integration of molecular dynamics @xcite .",
    "gadget-2 @xcite , which employs a treepm method for gravitational force calculation , adopts different time - steps for the long - range force derived from a particle - mesh method @xcite and the short - range force derived from a tree method @xcite .",
    "bridge @xcite was developed in order to solve galaxy - star cluster systems self - consistently .",
    "bridge divides a hamiltonian of a galaxy - star cluster system into a star cluster and a galaxy parts , and applies different time - steps and integrators . in bridge ,",
    "the integration of star cluster particles is performed by a forth - order integration method , namely hermit method @xcite .",
    "force calculations among star clusters are performed by direct method with grape @xcite .",
    "the integration of galaxy particles is performed by the leap - frog method with the tree method for the force estimation .",
    "forces between star cluster particles and galaxy particles are also calculated by the tree method with constant time - step .",
    "therefore this method can deal with coevolution of collisionless and collisional systems self - consistently ."
  ],
  "abstract_text": [
    "<S> we describe a new algorithm for the integration of self - gravitating fluid systems using sph method . </S>",
    "<S> we split the hamiltonian of a self - gravitating fluid system to the gravitational potential and others ( kinetic and internal energies ) and use different time - steps for their integrations . </S>",
    "<S> the time integration is done in the way similar to that used in the mixed variable or multiple stepsize symplectic schemes . </S>",
    "<S> we performed three test calculations . </S>",
    "<S> one was the spherical collapse and the other was an explosion . </S>",
    "<S> we also performed a realistic test , in which the initial model was taken from a simulation of merging galaxies . in all test calculations </S>",
    "<S> , we found that the number of time - steps for gravitational interaction were reduced by nearly an order of magnitude when we adopted our integration method . in the case of the realistic test , </S>",
    "<S> in which the dark matter potential dominates the total system , the total calculation time was significantly reduced . </S>",
    "<S> simulation results were almost the same with those of simulations with the ordinary individual time - step method . </S>",
    "<S> our new method achieves good performance without sacrificing the accuracy of the time integration . </S>"
  ]
}