{
  "article_text": [
    "in particle physics one often encounters the general problem of estimating physical parameters such as particle masses or cross sections from the spectra of observables calculated in each event . in the case of a known , well - established signal process",
    ", the dominant technique by far is to use a binned likelihood assuming a poisson distribution in each bin  @xcite , and find the parameters which maximize the likelihood .    in the case of a search for a new particle or effect resulting in either a discovery or null result ,",
    "binned likelihoods have also been employed successfully to quote statistical significance or exclusion bounds , respectively . from a certain point of view",
    "there is a desirable consistency in utilizing the same basic statistical method for searches , discoveries , and measurements .    a key requirement here , however , is that the likelihood somehow incorporate the effects of all systematic uncertainties present in the analysis . in frequentist methods",
    "this is almost always achieved by generating distributions of many pseudoexperiments , where from one pseudoexperiment to the next the values of all parameters are varied within their assumed distributions . in a formal bayesian treatment ,",
    "the nuisance parameters are removed by marginalization : integrating them out , assuming some prior pdf . both of these approaches are computationally very expensive .    in measuring parameters using binned poisson likelihoods , as mentioned above ,",
    "one simply maximizes the likelihood ( in practice one minimizes the negative log of the likelihood ) with respect to all @xmath0 free parameters , and then constructs the standard error ellipsoid in @xmath0-dimensional space .",
    "the fit values of the nuisance parameters are typically of no interest , leaving one to interpret the intervals for just the parameters of interest in a straightforward way  @xcite .",
    "we define in this paper three main types of nuisance parameters representing systematic uncertainties on the source distributions , and describe how to incorporate them into a binned poisson likelihood .",
    "we further argue in this paper that this maximum likelihood method , also called the profile likelihood , can be applied to searches and discoveries as well , either by a pseudo - bayesian interpretation of the profile likelihood as representing a posterior density in the parameter(s ) of interest , or by likelihood ratio methods .",
    "the profile likelihood requires significantly less computer time , often a much as two orders of magnitude less , than frequentist or frequentist - inspired methods such as cl@xmath1  @xcite .",
    "that in turn allows much more detailed study of the properties of the fit results .",
    "suppose we observe in a set of @xmath2 events an observable or in general a set of observables @xmath3 .",
    "if we define a set of @xmath4 bins ( which can be of literally any shape we choose ) in the space of the observables , then the number of events @xmath5 in each bin @xmath6 , is assumed to be poisson - distributed according to @xmath7 where @xmath8 is the number of expected events in the bin .",
    "typically we can write @xmath9 for integrated luminosity l , cross section @xmath10 for source @xmath11 , and efficiency @xmath12 for source @xmath11 in bin @xmath6 , often obtained from mc simulation of the process .",
    "the sources here include the signal process of interest and all background processes .",
    "again , since we are dealing with a possibly multidimensional space of observables , the index @xmath6 can actually label the bins in multiple dimensions .",
    "the poisson likelihood for the full observed spectrum is simply the product of the poisson probabilities : @xmath13 in the absence of any systematic uncertainties one can simply minimize @xmath14 with respect to all unknown parameters in the problem and interpret the resulting standard error ellipsoid in the normal way to obtain estimates of the unknown parameters and associated confidence intervals .",
    "multiplicative uncertainties provide the simplest example of systematic uncertainties that can be represented by nuisance parameters in profile likelihoods . as an example , let us assume that the integrated luminosity is measured in some auxiliary study , and results in a 2% uncertainty .",
    "we would rewrite the likelihood as @xmath15 for the measured value @xmath16 .",
    "the function @xmath17 is a normalized gaussian of mean @xmath18 and width @xmath19 , which serves to constrain the value of the new nuisance parameter @xmath20 to its measured value .",
    "note that it is @xmath20 and not @xmath18 that is used to calculate the @xmath8 .",
    "the negative log likelihood is thus @xmath21 + \\frac{(l-\\tilde{l})^2}{2\\sigma_l^2 } \\end{aligned}\\ ] ] and thus the remnant of the gaussian term can be regarded as a penalty on the negative log likelihood .",
    "it is in principle possible to use functions other than gaussians to constrain the values of the nuisance parameters .",
    "in bayesian terms the constraint functions are simply the prior probability densities of the nuisance parameters .",
    "any multiplicative uncertainty can be represented in the likelihood this way , including uncertainties on cross sections , overall efficiencies , and the like .",
    "one can also introduce multiplicative nuisance parameters into eq .",
    "2 as needed , for any or all sources .    in many cases , however , the allowed physical bound on a multiplicative nuisance parameter is that it remain positive .",
    "if we are representing the constraint by a gaussian , then when the uncertainty in the nuisance parameter is large the gaussian is truncated and an appropriate normalization factor should be included . in such cases",
    "one might also consider constraining the parameter with a log normal or other probability density which does not allow the parameter to vbecome negative .",
    "many systematic uncertainties result in an overall distortion in the shape of the observed spectrum .",
    "a good example is an energy scale uncertainty which affects all jet energies in an event in the same direction . if there are energy thresholds in the event selection , changes in not only the shape but the overall normalization of the efficiency ( represented here by the @xmath12 for source j in bin i ) as a function of the observables can result .",
    "such spectral distortions can be modeled by altering parameters ( like the energy scale ) in the mc simulation and recalculating the `` shifted '' set of efficiencies .",
    "if we were , for example , to raise and lower the energy scale by one standard deviation , recalculating the efficiencies , we would then have three measures of the shape ( and normalization ) of the bin efficiency distribution , which we can call @xmath22 , @xmath23 , and @xmath24 . clearly one can obtain more measures from other alterations of the energy scale , though this can often be computationally very expensive .",
    "we then face the question of how to turn our three measures of the spectral shape into a continuous estimate in each bin as a function of the energy scale factor . to do this we introduce a `` morphing '' parameter which we will call @xmath25 , and which is nominally zero ( in the case of no scale shift ) , and which has some uncertainty ( usually gaussian ) @xmath26=1 .",
    "in this general technique , usually called `` vertical morphing '' , we might write the efficiency in a bin as a function of the morphing parameter as @xmath27 in this expression we see that we are treating the difference in the shifted efficiencies in the bin as if they represent a measurement of the first - order taylor expansion around the nominal value .",
    "this may or may not be a reliable indicator of how the efficiency spectrum changes with energy scale . also note that for @xmath28 the above expression does not actually yield @xmath29 !    to provide a better estimate of the true behavior of the spectral distortions we have introduced a technique whereby we interpolate quadratically for @xmath30 and extrapolate linearly beyond that range .",
    "this does result in the exact measured behavior of the spectrum at @xmath28 but avoids large deviations from linear behavior outside the range .",
    "the value of the efficiency at any @xmath30 can be determined by lagrange interpolation : @xmath31 calculation of the linear extrapolation beyond this range is a straightforward exercise for the reader .",
    "clearly if a more accurate representation of the morphing behavior is required , one can , at the expense of computation and bookkeeping time obtain additional shifted efficiency spectra and interpolate using a higher order polynomial . a good measure of whether this is a worthwhile exercise is to examine the behavior of one s morphing parameters as a function of the parameter of interest ;",
    "if they tend to go far from the sampled region ( corresponding to one standard deviation in the uncertainty ) then it may be desirable to obtain more measurements there , and parametrize the measured region with a higher order polynomial .",
    "we also note that there are somewhat more sophisticated methods such as alex read s `` horizontal morphing ''  @xcite method . these are more computationally intensive , but could be advantageous",
    ". however they are not straightforwardly defined in more than one dimension .    the morphing method presented here",
    "can be extended to several morphing parameters for different systematic effects simply by adding linearly the deviations from the nominal efficiency due to each effect .",
    "typically one estimates the efficiency of each source in each bin using a monte carlo simulation , and hence the statistical accuracy of the estimate of the efficiency in each bin depends on the number of mc events falling there .",
    "likewise , in other , possibly data - driven methods for estimating the expected number of events from some source in some bin , there may be some known statistical uncertainty in each bin .",
    "barlow and beeston  @xcite proposed a method for representing such systematic uncertainties wherein one introduces a separate nuisance parameter multiplying the expected number of events from each source in each bin .",
    "nominally the value of these parameters is 1 , and one can then constrain the parameters , which we call @xmath32 , according to the prior pdf assumed for the number of mc events in the efficiency calculation .",
    "barlow and beeston assumed a poisson distribution ( though one might argue a binomial is the most correct form to assume ) ; other choices such as log normal avoid the parameters possibly tending to zero .",
    "though this method introduces a very large number of new free parameters in the likelihood , the problem can be seen to be tractable in the profile likelihood case since the values of the @xmath32 which maximize the likelihood within a bin can be found independently of those in all the other bins .    assuming a gaussian constraint on the @xmath32 , we can write the contribution to the negative log likelihood in a particular bin as @xmath33 this contribution can be extremized with respect to the @xmath32 by setting the derivative with respect to each to zero .",
    "dropping the bin index @xmath6 for clarity we write @xmath34 + \\frac{\\beta_j-1}{\\sigma_j^2 } = 0 \\ \\",
    "\\ .\\end{aligned}\\ ] ] we thus arrive at a set of nonlinear equations for the @xmath35 in a bin .",
    "these can be approximately solved by iterative newton - type methods , or by more sophisticated methods .    in the context of performing the profile likelihood using minuit minimization",
    ", one can implement this barlow - beeston type method by solving for the @xmath32 within the `` objective '' function which provides to minuit the value of @xmath36 given the values of all the parameters in the fit , and include the contribution of the deviations of the @xmath32 from unity to @xmath36 .",
    "however , a problem arises in this approach .",
    "any minimization algorithm can only approximate the values of the parameters and , hence , the true minimum of a function .",
    "there is always some last step which meets the convergence criterion , and somewhere in the space of the input @xmath37 to the minimization for the @xmath32 , one will find the place where that last step is not taken .",
    "near such points the values of the resulting @xmath32 and their associated contribution to @xmath36 undergo a small discontinuous jump .",
    "such jumps can ( and do ) dramatically confuse minuit s migrad minimizer , which attempts to measure the hessian matrix by finite differences .",
    "these jumps cause the resulting parameter covariance matrix to become non - positive - definite .",
    "when minuit detects such a situation it attempts to circumvent it by adding to the offending diagonal element of the matrix an amount necessary to restore positive - definiteness . sometimes this works but in many cases all is lost : minuit is now dealing with a false measure of the hessian matrix and it tends to send the free parameters in the fit to wild values .",
    "we have found no solution to this behavior short of rewriting minuit .    the full - blown barlow - beeston method for dealing with bin statistical uncertainties is not absolutely required to represent them properly in the likelihood .",
    "what matters , in a bin , is the _ overall _ statistical uncertainty of the predicted number of events from all sources .",
    "the statistical uncertainties for each source in each bin are independent , and can be readily combined , particularly if they are gaussian or poisson in nature .",
    "thus , a single barlow - beeston type parameter is sufficient to represent the statistical uncertainty .",
    "the value of this parameter , and its contribution to @xmath36 , can be calculated exactly by solving a quadratic equation .",
    "using a simplified notation for a single bin , we write @xmath38 where here @xmath39 is the total number of expected events in the bin , given the values of all the other parameters , and @xmath40 is the relative ( statistical ) uncertainty in the prediction . setting the derivative to zero we find the quadratic equation @xmath41 which can be solved readily and the correct root taken .",
    "the extension to other constraint functions is straightforward though may result in transcendental equations to solve .",
    "care must be taken in using the approach described in this paper to avoid a number of potential pitfalls which we discuss here .    *",
    "sparsely populated bins *    in multi - bin spectra ( particularly multi - dimensional spectra ) one can encounter situations where the number of events per bin varies by orders of magnitude .",
    "this can sometimes lead to situations where    * there can be regions of zero - content bins , surrounded by bins populated by single mc events ; * such single mc - event - bins can migrate under the influence of the morphing systematic effects , spoiling the vertical morphing method ; * single data events can appear in bins where there is no predicted rate .",
    "all of these situations must be avoided .",
    "the most straightforward is to generate sufficient monte carlo in all bins , but this may not be practical or even possible . the best alternative is to combine bins according to some algorithm ( which does not use the observed data distribution ! ) which ensures some minimum statistical threshold in every bin in the fit .    * bins entering / leaving the likelihood *    it is also necessary to ensure that no bin enters or leaves the likelihood as the parameters change .",
    "it is not impossible for minuit to drive parameters to regions where the contribution from a source , or even all sources , vanishes in a bin .",
    "for example , when studying the profile likelihood as a function of some new particle signal , also , one in general wants to evaluate the likelihood for the case of zero signal .",
    "but if there are bins populated by signal only , this can cause the contribution to go to zero , the logarithm of which is of course @xmath42 .    simply excluding bins from the likelihood when there are no expected events",
    "is not a sufficient solution to this problem , as a moment s reflection will make clear . to avoid bins entering / leaving the fit , therefore , the bins to be used or not used must be established _ a priori _ by finding all bins where some contribution is expected , and making sure there are no bins with data but no expected contribution .",
    "once determined , this set must remain fixed for the duration of the calculation .",
    "one way to ensure that no bin leaves the calculation is to always have it contribute at least some tiny amount .",
    "for example to circumvent the zero - signal issue , we always ensure that the signal cross section is no less than @xmath43 pb , and that no source in any bin used in the fit ever contributes less than @xmath43 expected events .",
    "though this is a somewhat inelegant solution to a nevertheless important problem , we note that our final results do not depend on these minimum values in practice .",
    "for measuring physical parameters , the profile likelihood can be directly interpreted using the usual @xmath44 approach to derive confidence intervals in multi - dimensional parameter space .    to extend this treatment to setting exclusion bounds on parameters such as a hypothetical new particle s cross section @xmath45 , we can simply derive a posterior density by treating the profile likelihood , which we shall denote @xmath46 as one would any likelihood using bayes theorem : @xmath47 where here @xmath48 is the assumed prior pdf in @xmath45 .",
    "but does the profile method really result in a posterior density that can be interpreted in this way ?",
    "the most proper bayesian treatment would not maximize the likelihood with respect to the parameters not of interest , but marginalize instead , resulting in what we might denote as @xmath49 to highlight the fact that the marginalized likelihood is in a sense averaged over the prior - weighted values of the nuisance parameters .",
    "we have performed both calculations , profiling and marginalization , in a variety of complex spectrum fits , and it is our experience that the posterior density derived either way is nearly identical , though the marginalized one takes orders of magnitude more compute time . due to this practical consideration alone",
    "we employ the profile method and consider it to be a near - perfect representation of a full and proper bayesian marginalization treatment .",
    "we present in this paper the basic mathematical and numerical approach to fitting multi - source spectra using a profile likelihood in which various types of systematic uncertainties are incorporated by representing them by nuisance parameters .",
    "this method , we believe , offers a unified approach to setting exclusion bounds , making discoveries , and ultimately performing measurements on a wide range of particle physics data analyses .",
    "i wish to thank my cdf @xmath50 colleagues andrew ivanov , robin erbacher , alison lister , david cox , will johnson , and thomas schwarz for their insights and ideas in developing these methods .",
    "this work was supported by the us department of energy office of science ."
  ],
  "abstract_text": [
    "<S> we describe here the general mathematical approach to constructing likelihoods for fitting observed spectra in one or more dimensions with multiple sources , including the effects of systematic uncertainties represented as nuisance parameters , when the likelihood is to be maximized with respect to these parameters . </S>",
    "<S> we consider three types of nuisance parameters : simple multiplicative factors , source spectra `` morphing '' parameters , and parameters representing statistical uncertainties in the predicted source spectra . </S>"
  ]
}