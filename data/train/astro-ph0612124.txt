{
  "article_text": [
    "the solar corona is dominated by the coronal magnetic field because the magnetic pressure is several orders of magnitude higher than the plasma pressure .",
    "knowledge regarding the coronal magnetic field is therefore important to understand the structure of the coronal plasma and to get insights regarding dynamical processes like flares and coronal mass ejections .",
    "the direct measurement of magnetic fields is very difficult and such measurements are only occasional available , see , e.g. , .",
    "well established are measurements of the photospheric magnetic field with the help of line - of - sight magnetographs ( e.g. , soho / mdi , nso / kitt peak ) or vector magnetographs ( e.g. , currently with the solar flare telescope / naoj , imaging vector magnetograph / mees observatory , and in near future with solis / nso , hinode , sdo / hmi ) . these photospheric fields can be extrapolated into the solar corona by making suitable model assumptions .",
    "the simplest approach is to assume current - free potential fields , which can be computed from the photospheric line - of - sight magnetic field alone .",
    "such source surface potential field models @xcite give already some insights about the coronal magnetic field structure , e.g. , regarding the location of coronal holes and active regions .",
    "they can not , however , be used to estimate the magnetic energy and helicity of the corona , in particular not the free energy available for eruptive phenomena . for reliable estimates of these quantities currents",
    "have to be included .",
    "to lowest order the effects of plasma pressure and gravity can be neglected and we can assume that the currents are parallel to the magnetic field , the force - free assumption .",
    "a popular simplification of force - free fields are linear force - free fields @xcite where the electric current flow is parallel to the magnetic field with a global constant of proportionality @xmath1 .",
    "this approach is in particular popular because linear force - free models require only line - of - sight magnetograms as input and contain only a single free parameter @xmath1 , which can be specified by comparing magnetic field line plots with coronal images @xcite . in general @xmath1 changes in space and taking this into account requires the use of nonlinear force - free models .",
    "a comparison of observationally inferred 3d magnetic field structures in a newly developed active regions @xcite with different extrapolated field models by revealed that linear force - free fields are better than potential fields , but nonlinear force - free models are even more accurate .",
    "the computation of nonlinear force - free fields is more challenging , however for several reasons .",
    "mathematically problems regarding the existence and uniqueness for various boundary value problems dealing with nonlinear force - free fields are still open , see for details .",
    "another issue is the numerical analysis for a given boundary value problem .",
    "an additional complication is to derived the required boundary data from photospheric vector magnetic field measurements .",
    "high noise in the transversal components of the measured field vector , ambiguities regarding the field direction and nonmagnetic forces in the photosphere complicate the task to derive suitable boundary conditions from measured data .",
    "different approaches have been proposed for the nonlinear force - free extrapolation of vector magnetograms :    * upward integration method , ( e.g. , , , , ) . * grad - rubin - like method , ( e.g. , , , , , , ) . * different mhd relaxation methods , ( e.g. , , , ) .",
    "* green s function like method , ( e.g. , , ) . * optimization method , ( e.g. , , ) .    for a more complete review on existing methods for computing nonlinear force - free coronal magnetic fields",
    "see the review papers by and .",
    "the grad - rubin method as described in and has been applied to investigate particular active regions in and a comparison of the extrapolated field with 2d projections of plasma structures as seen in h@xmath1 , euv and x - ray has been done in and .",
    "the optimization code in the implementation of has been applied to an active region in and compared with h@xmath1 images .",
    "investigated the possibility to use magnetic field extrapolations to improve the stereoscopic 3d reconstruction from coronal images observed from two viewpoints .",
    "recently compared the performance of six different cartesian nonlinear force - free extrapolation codes in a blind algorithm test .",
    "all algorithms yield nonlinear force - free fields that agree well with the reference field in the deep interior of the volume , where the field and electrical currents are strongest .",
    "the optimization approach successfully reproduced also the weak field regions and compute the magnetic energy content correctly with an accuracy of @xmath2 . in a coordinated study obtained an accuracy of somewhat better than @xmath2 .",
    "the good performance of the optimization method encourages us to develop a spherical version of the optimization code .",
    "the required full disk vectormagnetograms will become available soon ( e.g. , from solis ) .",
    "the heritage of the newly developed code is a cartesian force - free optimization method as implemented by .",
    "we outline the paper as follows . in section [ magnetic_modelling ]",
    "we describe our newly developed algorithm .",
    "section [ tests ] contains a semi - analytic test case and the setup of computations to check the accuracy and performance of our code .",
    "we introduce figures of merit to rate the quality of our reconstruction in section [ merit ] and present the results of our test runs in section [ results ] .",
    "finally we draw conclusions in section [ conclusions ] and give an outlook for future work .",
    "force - free magnetic fields have to obey the equations @xmath3    we solve equations ( [ forcefree ] ) and ( [ solenoidal - ff ] ) with the help of an optimization principle as proposed by and generalized by .",
    "until now the method has been implemented in cartesian geometry .    here",
    "we define a functional in spherical geometry : @xmath4 \\ , r^2 \\ , \\sin \\theta \\ , dr \\ , d \\theta \\ , d \\phi \\label{defl1},\\ ] ] it is obvious that the force - free equations ( [ forcefree]-[solenoidal - ff ] ) are fulfilled when @xmath5 equals zero .",
    "we normalize the magnetic field with the average radial magnetic field on the photosphere and the length scale with a solar radius .",
    "the functional ( [ defl1 ] ) can be numerically minimized with the help of the iteration equations : @xmath6 where @xmath7 is a positive constant and @xmath8 with @xmath9 \\\\",
    "{ \\bf \\omega}_b & = & b^{-2 } \\;\\left[(\\nabla \\cdot { \\bf b } ) \\ ; { \\bf b } \\right ] .",
    "\\label{defomega}\\end{aligned}\\ ] ] the theoretical deviation of the iterative equation ( [ iterateb ] ) as outlined by does not depend on the use of a specific coordinate system .",
    "previous numerical implementations of this method have been done to our knowledge only in cartesian geometry , however . here",
    "we describe a newly developed implementation in spherical geometry .",
    "we use a spherical grid @xmath10 with @xmath11 grid points in radial direction , latitude corresponds to the co - latitude , with @xmath12 and @xmath13 at the south and north poles , respectively . ] and longitude , respectively .",
    "here we intend to compute the whole sphere @xmath14 , @xmath15 , @xmath16 , but in principle one could limit the method also to parts of a sphere . to avoid the mathematical singularities at the poles , we do not use grid points exactly at the south and north pole , but half a grid point apart @xmath17 and @xmath18 .",
    "the method works as follows :    1 .",
    "we compute the initial source surface potential field in the computational domain from @xmath19 on the photosphere at @xmath20 .",
    "we replace @xmath21 and @xmath22 at the bottom photospheric boundary at @xmath20 by the measured vector magnetogram . and @xmath23 direction ) and to restrict the nonlinear force - free computation onto this region .",
    "this is in particular necessary if the observed photospheric vector magnetogram is only available for parts of the photosphere . in such cases",
    "the global magnetic field is basically a potential field and only locally ( say in active regions ) a nonlinear force - free field . for such limited regions in @xmath24 and @xmath23",
    "we encounter the same problem as in cartesian codes , that the lateral boundary conditions are unknown .",
    "one possibility is to describe the lateral boundaries with the help of a global potential field .",
    "the assumption of a potential field outside the computational domain restricts currents to the active region , but non current carrying field lines can leave the computational box . at the interface between the potential and non - potential field , a boundary layer as described in for the cartesian implementation of our code can be used .",
    "full spherical force - free fields certainly do not have lateral boundaries and if one is interested in the details of interaction of two far apart active regions , it might be better to compute first a global low resolution force - free field ( e.g. , in future with solis data ) and then compute the field in the active regions with higher resolution ( e.g. , with hinode data ) . such an approach would allow also current carrying field lines to connect the two active regions , which might be important for the initiation of cmes . ] the outer radial boundary is unchanged from the initial potential field model . for the purpose of code testing",
    "we try additional other boundary conditions , see section [ boundary ] .",
    "we iterate for a force - free magnetic field in the computational box by minimizing the functional @xmath5 of equation ( [ defl1 ] ) by applying equation ( [ iterateb ] ) .",
    "4 .   the continuous form of equation ( [ iterateb ] ) ensures a monotonically decreasing functional @xmath5 . for finite time steps ,",
    "this is also ensured if the iteration time step @xmath25 is sufficiently small . if @xmath26 this step is rejected and we repeat this step with @xmath25 reduced by a factor of two .",
    "5 .   after each successful iteration step",
    "we increase @xmath25 by a factor of @xmath27 to ensure a time step as large as possible within the stability criteria .",
    "this ensures an iteration time step close to its optimum .",
    "the iteration stops if @xmath25 becomes too small . as stopping criteria we use @xmath28 .",
    "on the photosphere .",
    "we project the map onto the solar surface in figure [ fig2 ] with the disk center at carrington longitude @xmath29.,width=453,height=226 ]     ( as defined in [ defl1 ] ) during the optimization process .",
    "the solid line corresponds to case 1 , the dotted line to case 2 , the dashed line to case 3 and the dash - dotted line to case 4 .",
    "the horizontal dash - double - dotted line marks the discretization error of the original semi analytic solution .",
    "the top panel corresponds to the low resolution @xmath30 and the bottom panel to the high resolution @xmath31 computation.,title=\"fig:\",width=453,height=377 ]   ( as defined in [ defl1 ] ) during the optimization process .",
    "the solid line corresponds to case 1 , the dotted line to case 2 , the dashed line to case 3 and the dash - dotted line to case 4 .",
    "the horizontal dash - double - dotted line marks the discretization error of the original semi analytic solution .",
    "the top panel corresponds to the low resolution @xmath30 and the bottom panel to the high resolution @xmath31 computation.,title=\"fig:\",width=453,height=377 ]      we test our newly developed code with the help of a known nonlinear force - free field model developed by .",
    "the authors solved the grad - shafranov equation for axisymmetric force - free fields in spherical coordinates @xmath32 , @xmath24 , @xmath23 .",
    "the magnetic field can be written in the form @xmath33 where @xmath34 is the flux function , and @xmath35 represents the @xmath23-component of @xmath36 , depending only on @xmath34 .",
    "the flux function @xmath34 satisfies the grad - shafranov equation @xmath37 where @xmath38 .",
    "derive solutions for @xmath39 by looking for separable solutions of the form @xmath40 the solutions are axisymmetric in spherical coordinates with a point source at the origin .",
    "they have become a kind of standard test for nonlinear force - free extrapolation codes @xcite in cartesian geometry because the symmetry in the solution is no longer obvious after a translation which places the point source outside the computational domain and a rotation of the symmetry axis with respect to the cartesian coordinate axis .    here",
    "we use the low and lou solution in spherical coordinates .",
    "the original equilibrium is invariant in @xmath23 , but we can produce a 3-d looking configuration by placing the origin of the solution with @xmath41 solar radius offset to the sun center .",
    "the corresponding configuration is not symmetric in @xmath23 anymore with respect to the solar surface as seen in the synoptic map in figure [ fig1 ] which shows @xmath19 on the photosphere .",
    "let us remark that we use the solution for the purpose of testing our code only and the equilibrium is not assumed to be a realistic model for the global coronal magnetic field .",
    "we do the test runs on spherical grids @xmath42 of @xmath43 and @xmath44 grid points .      * case 1 : boundary specified on the photosphere , source surface and in co - latitude at @xmath45 and @xmath46 .",
    "optimization restricted in co - latitude to @xmath47 .",
    "* case 2 : boundary specified on photosphere , the source surface and in co - latitude at @xmath48 and @xmath49 .",
    "* case 3 : boundary specified on photosphere and on the source surface . * case 4 : boundary specified only on the photosphere .",
    "this is the realistic case for real data , where measurements are only available on the photosphere . on the source surface",
    "the magnetic field is chosen from the initial potential field .",
    "for the computations done here we use a grid resolution of @xmath50 for the low and @xmath51 for the high resolution test case . for the test cases .",
    "the code allows , however , also the use of @xmath52 . ]",
    "this means that the full spherical extrapolation cases ( case 2- case 4 ) are limited in co - latitude by @xmath53 and @xmath54 for the low and high resolution computations , respectively .",
    "as the initial state we compute a source surface potential field in our computational domain . the source surface is a spherical shell where all field lines are assumed to become radial @xcite .",
    "we locate the source surface at @xmath55 which is the outer radial boundary of our physical domain .",
    "the finite differences in @xmath23 are cyclic . for case 1 and 2 boundary values in @xmath24",
    "are specified and for case 3 and 4 we interpolate the values at the poles .",
    "in table [ table1 ] we provide some quantitative measures to rate the quality of our reconstruction .",
    "column 1 names the corresponding test case . column 2 - 4",
    "show , how well the force and solenoidal condition are fulfilled , where column 1 contains the value of the functional @xmath5 as defined in equation ( [ defl1 ] ) and @xmath56 and @xmath57 in column 3 and 4 correspond to the first ( force - free ) and second ( solenoidal free ) part of @xmath5 .",
    "the evolution of the functional @xmath5 during the optimization process is shown in figure [ fig3 ] .",
    "column 5 contains the @xmath58 norm of the divergence of the magnetic field @xmath59 and column 6 the @xmath58 norm of the lorentz force of the magnetic field @xmath60    the next five columns of table [ table1 ] contain different measures which compare our reconstructed field with the semi - analytic reference field .",
    "these measures have been introduced by to compare a vector field @xmath61 with a reference field @xmath62 .",
    "* column 7 : vector correlation : @xmath63 where @xmath64 is the number of vectors in the field . *",
    "column 9 : normalized vector error @xmath65 * column 10 : mean relative vector error @xmath66 * column 11 : total magnetic energy of the reconstructed field normalized with the energy of the input field @xmath67    the two vector fields agree perfectly if @xmath68 and @xmath69 are unity and if @xmath70 and @xmath71 are zero .",
    "column 12 contains the number of iteration steps until convergence and column 13 shows the computing time on 4 processors .",
    "the table rates the quality of our reconstructions with several figures of merit as explained + in section [ merit ] .",
    "we compute the figures for the whole sphere . for case 1 , where the + computations have been limited in latitude ,",
    "the reference field was specified in the cones + @xmath72 and @xmath73 . + [ table1 ]    [ cols=\"<,<,<,<,^,^,<,<,<,<,<,>,>\",options=\"header \" , ]",
    "in figure [ fig2 ] we compare magnetic field line plots of the original model field ( original ) with a corresponding potential field ( potential ) and nonlinear force - free reconstructions with different boundary conditions ( case 1 - case 4 ) .",
    "the colour coding shows the radial magnetic field on the photosphere , as also shown in the synoptic map in figure [ fig1 ] .",
    "carrington longitude @xmath29 corresponds to the disk center in figure [ fig2 ] .",
    "the images show the results of the computation on the @xmath43 grid .",
    "a comparison of the original reference field ( original in figure [ fig1 ] ) with our nonlinear force - free reconstructions ( cases 1 - 4 ) shows that the magnetic field line plots agree with the original for case 1 - 3 within the plotting precision .",
    "case 4 shows some deviations from the original , but the reconstructed field lines are much closer to the reference field than to the initial potential field ( potential ) . we can not expect a perfect agreement with the reference field for case 4 , because here the outer radial boundary conditions are taken from the initial potential field model , which are different from the outer boundary of the reference field .",
    "it is well known from computations in cartesian geometry that the lateral and top boundaries influence the solution in the box .",
    "the visual inspection of figure [ fig2 ] is supported by the quantitative criteria shown in table [ table1 ] . for cases 1 and 2 ( where the boundary conditions have been specified on the photosphere , the source surface and in latitude ) the formal force - free criteria @xmath74 are smaller than the discretization error of the analytic solution and",
    "the comparison metrics show an almost perfect agreement with the reference field . for case 3",
    "we still find a very good agreement between the reference field and our reconstruction and for case 4 the agreement is still reasonable .",
    "we are in particular able to compute the magnetic energy content of the coronal magnetic field approximately correct .",
    "a potential field reconstruction does obviously not agree with the reference field .",
    "the figures of merit show that the potential field is far away from the true solutions and contains only @xmath75 of the magnetic energy .    for a practical use of any numerical scheme the computing time certainly matters .",
    "as seen in the last column of table [ table1 ] the computing time is quite fast if we restrict the computational domain to low co - latitudes ( @xmath76 case 1 ) but increases significantly for full sphere computations .",
    "the time needed for one iteration time step is approximately constant ( @xmath77 on the low and @xmath78 on the high resolution grid . ) , but the number of iteration steps needed until convergence increases by more than one order of magnitude if high co - latitude regions are included in the optimization .",
    "the reason is that the iteration time step @xmath25 , which adjusts automatically in our code , becomes much smaller and consequently the convergence speed becomes slow .",
    "this is well visible in figure [ fig3 ] which shows the evolution of the functional @xmath5 with the number of iteration steps .",
    "for the low latitude computations ( case 1 , solid line in figure [ fig3 ] ) the functional @xmath5 is much steeper than for the full sphere computations ( cases 2 - 4 , dotted , dashed , dash - dotted lines ) .",
    "the slow convergence of the full sun computations is directly related to the smaller time step and the time step itself is restricted by the physical grid resolution , which becomes very small close to the poles .",
    "we will address this point in the discussion ( section [ conclusions ] ) and outline possible solutions to overcome these difficulties .",
    "some insights regarding the performance of our newly developed code might be given by a comparison of the figures in table [ table1 ] with the results of computations in cartesian coordinates , as shown in table i , where row ( b ) contains the results of our cartesian optimization code .",
    "the upper part of schrijver s table i corresponds to a test case where all six boundaries of a cartesian box have been specified ( schrijver s case i , which is somewhat similar to our cases 1 - 3 ) and the lower part of table i corresponds to a case where only the bottom boundary of a cartesian box has been specified ( schrijver s case ii , which is equivalent to our case 4 in spherical geometry ) . both for cartesian and spherical computations the correspondence with the original field",
    "is reduced if the boundary conditions are only specified on the photosphere . for real observed vector magnetograms we certainly have only photospheric data and it is therefore important to get a reasonable nonlinear force - free magnetic field reconstruction for this case .",
    "the errors of the different comparison metrics are still small and in a comparable range for cartesian and spherical computations .",
    "the vector correlation is better than @xmath79 and we got the magnetic energy correct within a few percent for all examples investigated in this paper .",
    "within this work we developed a code for the nonlinear force - free computation of coronal magnetic fields in spherical geometry .",
    "the method is based on an optimization principle .",
    "we tested the performance of the newly developed code with the help of a semi - analytic reference field .",
    "we find that the spherical optimization method works well and the accuracy of the reconstructed magnetic field configuration is comparable with the performance of a corresponding code in cartesian geometry .",
    "the computation is reasonably fast if we limit the computation to low latitude regions , but becomes significantly slower if polar regions are included .",
    "such a behaviour is well known for computations in spherical coordinates , see e.g. .",
    "the reason is that the physical grid converges to the poles .",
    "a fair approximation for the iteration time step is @xmath80 , where @xmath81 is the physical grid resolution .",
    "as the finest grid resolution restricts the time step , it becomes much smaller if high altitude regions ( where @xmath81 becomes very small ) are included in the optimization .",
    "our code has an automatic step size control and we find that @xmath25 automatically adjusts to much smaller values for full sphere computations .    a possible solution is the use of the so called yin - yang grid , as developed by and as used , e.g. , for earth mantle convection by .",
    "the yin - yang grid is composed of two identical complimentary grids , which partly overlap and together cover the solar surface with a quasi - uniform grid spacing ( see for details ) .",
    "naturally the yin - yang grid has no poles at all and a considerably large iteration step can be used .",
    "there is certainly a numerical overhead for transformations between the complimentary grids , but the limitations regarding the time step in polar regions for traditional spherical grids are more time demanding",
    ". for solar applications one has to consider , however , that photospheric magnetic field measurements are currently less accurate close to the poles .",
    "it might therefore be acceptable to restrict a nonlinear force - free computations onto equatorial regions , say between about @xmath82 and @xmath83 latitude .",
    "for these low latitude regions the spherical optimization code as described here is reasonably fast . for application to observed vector magnetograms",
    "one has to consider , that the measured magnetic field is not necessary force - free in the photosphere and in particular the transverse components of the magnetic field vector contain much noise .",
    "these problems are , however , also present for force - free extrapolations in cartesian geometry and a preprocessing of the photospheric vector magnetograms as described in helps to overcome these difficulties .",
    "the code solves the nonlinear force - free equations in the bounded domain between @xmath84 and the source surface at @xmath85 .",
    "the outer boundary is kept fixed from the initial potential field .",
    "all current carrying field lines have to close inside the volume .",
    "the domain outside @xmath85 is not included in the model , because the force - free approach is not justified anymore here . a further step towards a consistent modelling of the solar corona would be the inclusion of non - magnetic forces , like plasma pressure , gravity and the dynamic pressure of the solar wind .",
    "this is in particular useful for several solar radii long structures like helmet streamer , where the plasma @xmath86 becomes finite ( see e.g. , and )",
    ". found a special class of magnetohydrostatic solutions which are separable in spherical coordinates .",
    "extended the linear force - free green s function methods towards the inclusion of non - magnetic forces in cartesian geometry .",
    "both approaches assume a kind of global linear force - free parameter @xmath1 for the parallel part of the electric currents .",
    "this is certainly a too restrictive condition to include the detailed information provided by measured vector magnetograms .",
    "the optimization method has been generalized for this aim in and implemented in cartesian geometry .",
    "a corresponding implementation into spherical geometry is straightforward , but does certainly require additional observational constraints , e.g. , the tomographically reconstructed 3d coronal density distribution .",
    "this work was supported by dlr - grant 50 oc 0501 .",
    "the author thanks bernd inhester for useful comments and acknowledge inspiriting discussions on three workshops organized by karel schrijver ( nlfff - consortium ) in palo alto between 2004 and 2006 .",
    "we thank the referee , tahar amari , for useful remarks to improve this paper ."
  ],
  "abstract_text": [
    "<S> we describe a newly developed code for the extrapolation of nonlinear force - free coronal magnetic fields in spherical coordinates . </S>",
    "<S> the program uses measured vector magnetograms on the solar photosphere as input and solves the force - free equations in the solar corona . </S>",
    "<S> the method is based on an optimization principle and the heritage of the newly developed code is a corresponding method in cartesian geometry . </S>",
    "<S> we test the newly developed code with the help of a semi - analytic solution and rate the quality of our reconstruction qualitatively by magnetic field line plots and quantitatively with a number of comparison metrics . </S>",
    "<S> we find that we can reconstruct the original test field with high accuracy . </S>",
    "<S> the method is fast if the computation is limited to low co - latitudes ( say @xmath0 ) , but becomes significantly slower if the polar regions are included . </S>"
  ]
}