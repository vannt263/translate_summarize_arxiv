{
  "article_text": [
    "galaxies were first identified over a century ago , yet the physical processes that shape their observable characteristics and evolution remain poorly understood . with the growth of large - scale structure now well specified within the concordance",
    "lambda cold dark matter ( @xmath11cdm ) paradigm , the least understood issues surround how the baryonic components behave once the dark matter s gravity is no longer the dominant driver . in particular , much of the uncertainty lies in the nature and physics of _ feedback _ processes , i.e. the energy return from processes of star and black hole formation within galaxies that self - regulates their growth . as observations of the galaxy population from the present day back to the epoch of reionisation continue to improve , it is an increasingly demanding challenge for models to reproduce such observations using well - motivated and comprehensive input physics , while giving insights into the physical processes responsible for feedback and galaxy assembly .",
    "successful modern galaxy formation models generally rely on the following basic ingredients  @xcite : ( i ) fueling of star formation via gravitationally - driven gas accretion from the intergalactic medium ( igm ) ; ( ii ) feedback from massive , young stars that drives large - scale galactic outflows ; and ( iii ) feedback from supermassive black hole accretion that suppresses star formation in massive galaxies .",
    "the goal of galaxy formation models is thus to understand and constrain the physics driving these various feedback processes , and particularly how they work in concert to shape galaxies as we observe them via multi - wavelength surveys across cosmic time .",
    "cosmological hydrodynamic simulations have played a major role in the progress towards understanding galaxy formation .",
    "the past decade has seen significant advances in both the size and dynamic range of simulations thanks to advancing computing power , as well as the scope and accuracy of the input physics thanks to an improved understanding of the key physical drivers .",
    "such simulations are now able to broadly reproduce primary demographic features of the galaxy population today , along with their evolution to early epochs , to reasonable levels of success ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "however , all cosmological - volume models still require  sub - resolution \" recipes for feedback processes , because despite heroic computational efforts it remains infeasible to simultaneously resolve the physics driving feedback at sub - parsec scales within a megaparsec - scale structure formation context . while current models are typically tuned to reproduce key observations such as a galaxy stellar mass function to within a factor of several , they accomplish this using widely differing input physics and numerical implementations , making it difficult to draw robust conclusions regarding the detailed physical processes driving feedback .",
    "one way forward in order to hone in on viable sub - resolution recipes for feedback is to utilise the results of very high - resolution simulations of individual galaxies that examine specific feedback processes in detail .",
    "this has recently been greatly enabled by the  zoom \" simulation technique in which a particular galaxy and its surroundings are extracted from a larger volume and re - simulated at much higher resolution . in this way ,",
    "feedback processes are generated more self - consistently and tracked more directly  ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "it is not straightforward to predict population statistics from individual zoom simulations , but their predictions can serve as inputs for the recipes used in cosmological - scale simulations that model many thousands of galaxies .",
    "a particularly comprehensive set of physical processes was included in the feedback in realistic environments ( fire ) zoom simulations  @xcite . using the fire simulations , @xcite derived scaling relations for the mass loss rate and velocity distribution of outflowing gas , which are key aspects of star formation - driven feedback .",
    "detailed models for self - shielding  ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) , black hole growth  ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) , and quenching  @xcite have been investigated to study their emergent trends with a similar strategy in mind .",
    "these trends can then be implemented into large - scale , lower - resolution simulations to provide more physically motivated recipes for feedback .",
    "such a multi - scale approach offers a promising avenue to assemble robust and well - constrained recipes for feedback processes within cosmological - scale galaxy formation models .",
    "another important area of progress has been towards increasing the robustness of hydrodynamics solvers .",
    "early simulations were predominantly done using the smoothed particle hydrodynamics ( sph ) technique  @xcite .",
    "however , this method requires substantial artificial viscosity that compromises the handling of surface instabilities , contact discontinuities , and strong shocks .",
    "a reformulation of the sph equations to explicitly conserve entropy provides some advantages  @xcite , but still resulted in numerical surface tension that e.g. strongly supresses kelvin - hemholtz instabilities  @xcite .",
    "further reformulations such as sph - s  @xcite and pressure - sph  @xcite have partially but not fully mitigated these issues .",
    "adaptive mesh refinement ( amr ) galaxy formation codes have also made substantial gains  ( e.g. * ? ? ?",
    "* ) , but their intrinsically cartesian nature can result in numerical artifacts when applied to the arbitrary 3-d geometry and motions associated with galaxy formation .",
    "the voronoi tesselation - based moving mesh code arepo  @xcite eliminates the cartesian restrictions , and shows great promise at handling surface instabilities and shocks with arbitrary geometries while retaining galilean invariance .",
    "a downside is that arepo advects mass across cell boundaries and occasionally must  re - mesh \" to prevent highly deformed cells .",
    "this necessitates the additional complication of tracer particles in order to track the motion of gas into and out of galaxies  @xcite .",
    "recently , @xcite developed a new  meshless \" hydrodynamics method that marries many advantages of sph and moving mesh approaches .",
    "gizmo is fundamentally a moving mesh - like godunov code , but the  mesh \" is defined by a deformable kernel moving in such a way as to keep the mass within each cell constant .",
    "hence operationally it allows for the advantages of mass tracking and being fully adaptive without re - meshing .",
    "@xcite showed that gizmo s  meshless finite mass \" ( mfm ) approach shows desirable behavior compared to modern sph and amr codes in many relevant idealised test problems .",
    "in this paper we present a new suite of cosmological hydrodynamic simulations of galaxy formation using gizmo , called the mufasa  simulations .",
    "we describe our new recipes for sub - resolution processes (  [ sec : code ] ) based on , wherever possible , the results from zoom simulations or analytic models .",
    "these include @xmath0-based star formation , minimal ism pressurization , non - equilibrium cooling and ionisation , supernova - heated two - phase kinetic winds , evolving halo mass - based quenching , and nine - metal chemical enrichment from type ia+ii supernovae and stellar evolution .",
    "our highest resolution mufasa  run resolves essentially all hydrogen cooling halos , while our fiducial @xmath12 volume produces a substantial population of quenched massive galaxies by @xmath2 .",
    "all are run with exactly the same feedback parameters , and show reasonable resolution convergence . as a basic test of our model ,",
    "we present predictions for the galaxy stellar mass function across cosmic time , and compare to recent observations and simulations (  [ sec : gsmf ] ) .",
    "we further compare to observations of the star formation histories , both globally and for individual galaxies (  [ sec : sfr ] ) .",
    "we also examine the how the choice of hydrodynamics solver and key feedback parameters impact our results (  [ sec : codevar ] ) .",
    "finally , we summarize our findings (  [ sec : summary ] ) .",
    "we employ a modified version of the gravity plus hydrodynamics solver gizmo  @xcite , which is built upon the framework of the gadget-3  galaxy formation code  @xcite . for hydrodynamics ,",
    "we employ gizmo s meshless finite mass ( mfm ) method , which uses a riemann solver to evolve the fluid in a manner that conserves mass within each fluid element .",
    "each fluid element may then be regarded as a  particle \" , though it actually represent a mesh node ; we will refer to these as  gas elements . \" like arepo , gizmo offers advantages over sph in terms of handling a wide range of fluid problems related to shocks and contact discontinuities , and over amr codes in terms of avoiding cartesian artifacts and strictly preserving galilean invariance .",
    "we employ a cubic spline kernel with 64 neighbors in mfm .",
    "@xcite used 32 neighbors for their detailed mhd simulations , but we discovered that 64 is better for suppressing occasional instabilities in very diffuse hot gas such as that appearing in the shocked igm at late epochs .",
    "the kernel is used to determine the volume partition between gas elements , thereby defining the effective faces at which the riemann problem is solved .    in order to test the sensitivity to hydrodynamics methodology",
    ", we will also use the modern pressure - sph  ( p - sph ; * ? ? ? * ) and the traditional ( entropy - conserving ) sph  ( t - sph ; * ? ? ?",
    "* ) solvers in gizmo , with all subgrid physics options held fixed .",
    "sph requires an artificial viscosity , for which we use the gizmo default @xcite viscosity as described in @xcite . to isolate the impact of the hydro solver",
    ", we use the same cubic spline kernel with 64 neighbors , even though a quintic spline gives better results in some circumstances .",
    "the gravity is evolved using a tree - particle - mesh approach that is based on gadget-3  @xcite .",
    "we use adaptive gravitational softening throughout for all particles  @xcite , enclosing 64 particles with a minimum ( plummer - equivalent ) softening length set to 0.5% of the mean interparticle spacing . for more details on gizmo ,",
    "including other choices such as the timestep limiter  @xcite and the implementation of adaptive softening , see @xcite .",
    "we use the grackle-2.1 chemistry and cooling library  @xcite , which includes primordial and metal line cooling , evolved isochorically on the cooling timescale in an operator - split way over the system timestep . in other words , we do the non - radiative cooling / heating first over the system timestep , then apply radiative cooling using grackle , where the radiative part is sub - stepped isochorically on the cooling timescale .",
    "we employ grackle in non - equilibrium mode for primordial elements , thereby tracking e.g. the input of latent heat during reionisation .",
    "metal - line cooling is computed using cloudy  @xcite tables self - consistently including the impact of photoionisation , in this case assuming ionisation equilibrium .",
    "a spatially - uniform photo - ionising background is assumed , for which we employ the determination by @xcite , updated in 2011 .",
    "we do not employ the more recent @xcite determination owing to concerns regarding its low ionisation rate at @xmath2 which has spurred the so - called photon underproduction crisis  @xcite .",
    "in any case , galaxy properties that we consider here are insensitive to reasonable choices of the photo - ionising background .      to form star particles out of gas , we employ a molecular gas - based star formation prescription following ( * ? ? ?",
    "* hereafter kmt ) .",
    "a fuller description is available in @xcite and @xcite ; here we briefly summarise the approach .",
    "kmt provides an approximate solver for @xmath0 formation at the ( relatively ) coarse resolution available to us in cosmological volumes . with well - motivated approximations , this yields @xmath13 where @xmath14 where @xmath15 is the metallicity in solar units , @xmath16 is a function of metallicity given in kmt , and @xmath17 is the column density calculated using the sobolev approximation ; see below .",
    "we impose a minimum metallicity of @xmath18 solely for the purposes of this computation .",
    "we further require a minimum density for star formation of @xmath19  @xmath20 ; gas above this density will hereafter be referred to as  ism gas \" . in most cases ,",
    "the densities at which @xmath0 dominates is higher than this ( e.g. @xmath21  @xmath20 for solar metallicity ) but for individual high metallicity gas elements the kmt formula can yield @xmath0 formation , and hence star formation , below our ism density threshold ; we explicitly do not allow this .",
    "we make two minor adjustments to the kmt algorithm regarding sub - grid clumping .",
    "first , kmt assumed a constant sub - resolution clumping factor in the ism of @xmath22 .",
    "this factor appears in the rate coefficient for forming @xmath0 on dust grains  ( see  2.2 of * ? ? ?",
    "it is clear that a higher resolution simulation should assume less clumping  in the limiting case of infinite resolution , the clumping should be fully resolved and hence @xmath23 should be unity . thus it makes physical sense to reduce @xmath23 in higher resolution simulations . in our case , we assume that @xmath22 in our fiducial simulation with @xmath24 ( see  [ sec : runs ] ) , where @xmath25 is our minimum comoving gravitational softening length , but we further scale @xmath26 in our other runs ( see table  [ tab : sims ] ) . by this scaling ,",
    "a simulation with @xmath27  pc would have @xmath28 ; our cosmological runs here do not reach this limit .",
    "the net effect of scaling @xmath23 is to make star formation slightly less efficient in higher resolution simulations , leaving them slightly more gas rich .",
    "our second adjustment involves the calculation of @xmath17 .",
    "kmt assumes that self - shielding against @xmath0 dissociating radiation within the ism is governed by the local column density @xmath17 as calculated using the sobolev approximation , namely @xmath29 where @xmath30 is the gas density .",
    "we compute these quantities in the usual way from the gas elements , but we must further account for sub - resolution clumping .",
    "if the clumping factor @xmath23 represents the typical density contrast of the sub - resolution clumps , then the column density increase within these clumps is approximately , by dimensional arguments , @xmath31 .",
    "we thus increase @xmath17 by a factor of @xmath32 to account for this varies , but owing to an oversight this was not implemented for the higher - resolution runs .",
    "we subsequently ran test simulations to determine that the results are not significantly different if we scale @xmath33 , though it does lower star formation very slightly .",
    "future runs will use this scaling . ] .",
    "given an @xmath0 fraction from kmt , the star formation rate for a given eligible gas element is given by a @xcite law , namely @xmath34 where @xmath35 is the molecular fraction for a given gas element , and @xmath36 is the local dynamical time .",
    "we set the efficiency of star formation to be @xmath37  @xcite .",
    "star particles are spawned from gas elements stochastically .",
    "each mfm fluid element spawns a single star particle of the same mass .",
    "previous simulations  ( e.g. * ? ? ?",
    "* ) often spawn multiple star particles , reducing the gas mass by a fraction each time . however , large instantaneous changes to an element s gas mass can cause instabilities in mfm , so we avoid this by converting the gas element fully into a collisionless star particle all at once , conserving mass and momentum .      as the density increases and the cooling rate becomes large , the jeans mass can become smaller than the resolved mass in the simulation . if cooling is allowed to proceed at these high densities , the fragmentation that should proceed to small scales ( and thus be captured by our star formation law ) is instead  bottlenecked \" at large scales , producing artificially coherent clumping  @xcite .    to avoid this",
    ", we apply an artificial pressure above a density threshold @xmath38 that explicitly suppresses fragmentation below the scale of the smoothing volume , namely : @xmath39 where @xmath40 is the molecular weight calculated assuming fully neutral gas , @xmath41 is the mass per gas element in our simulation , and @xmath42 is the number of neighbors .",
    "we assume that the temperature at the density threshold is @xmath43k . above this density",
    ", we then set the gas element temperature to the _ jeans minimum temperature : _",
    "@xmath44 if @xmath38 is below our nominal star formation density threshold , we set it to this value ; this occurs in our largest volume .",
    "meanwhile , our smallest volume has @xmath45  @xmath20 , while our intermediate volume has @xmath46  @xmath20 .",
    "this prescription is quite similar to the @xmath47 equation of state imposed by @xcite , except that we vary the threshold density with the simulation resolution such that at higher resolution , we do not artifically pressurise the ism as strongly . hence our approach automatically takes advantage of high numerical resolution , when present , as much as possible  ( e.g. * ? ? ?",
    "as necessitated by our cosmological resolution , we employ a sub - resolution approach to modeling feedback from massive stars .",
    "the basic approach is to use kinetic feedback  @xcite , as this has generally been shown to provide stable and well - converged results for cosmological galaxy formation simulations , and allows more explicit control over the numerical experiments regarding feedback .    in our feedback prescription",
    ", we assume that massive stars launch winds that drive material out of galaxies through a combination of type  ii supernovae ( snii ) , radiation pressure , and stellar winds .",
    "we do not track these phenomena in the code owing to a lack of resolution , but rather characterise the net effect using two free parameters , namely the mass loading factor @xmath48 defined as the mass outflow rate relative to the star formation rate , and the wind speed @xmath49 representing the velocity with which the wind is launched .",
    "both parameters can in principle scale with galaxy properties and redshift .",
    "outflow fluid elements are launched in the direction of @xmath50*v*@xmath51*a * , in order to have a broadly collimated outflow perpendicular to the disk , and the sign is chosen such that it is launched in the hemisphere pointing away from the host galaxy .",
    "later we will show that this choice has no discernible impact versus ejecting gas isotropically .",
    "our general strategy is to directly employ outflow scalings derived from the fire simulations  @xcite , which self - consistently drive winds from galaxies using supernova feedback , radiation from massive stars , and stellar winds , and have been successful at reproducing a range of observed galaxy properties in individual galaxy zoom simulations .",
    "@xcite found in the fire simulations that the outflow rate was most tightly correlated with stellar mass , and this scaling was essentially independent of redshift .",
    "their best - fit relation of the mass outflow rate at @xmath52 is given by @xmath53 where @xmath54 is the galaxy stellar mass .",
    "we implement this relation directly into our code .",
    "we compute @xmath54 using an on - the - fly galaxy finder , which we describe in  [ sec : fofrad ] . to account for the very early evolution of galaxies when",
    "little or no stellar mass has yet formed , we place a floor on the stellar mass used in the above equation of 8  gas element masses .    for the wind speed , we likewise take the scaling of @xmath49 with galaxy properties from the fire simulations .",
    "their best - fit formula is @xmath55 , where @xmath56 is the galaxy s circular velocity .",
    "we will describe how we obtain @xmath56 from our on - the - fly galaxy finder in  [ sec : fofrad ] . in fire , this formula reflects the mean velocities across a shell at @xmath52 . to account for the fact that our wind launches are typically at a much smaller radius well within the ism , we add an extra velocity kick @xmath57 corresponding to the gravitational potential difference between the wind launch radius and @xmath52  @xcite .",
    "we assume a @xcite profile with a concentration @xmath58 , where we compute the halo mass as the galaxy baryonic mass times @xmath59 .",
    "this typically increases the wind velocity by up to @xmath60 in small galaxies , and by significantly less in large galaxies .    still , @xmath61 only accounts for gravitational slowing , while hydrodynamic slowing is likely to be dominant  @xcite .",
    "hence we further increase the multiplier of the outflow velocity , by around a factor of two above the @xcite value , comparable to their 95th percentile wind velocity , and also comparable to the outflow velocities measured leaving the disk in the zoom simulations of @xcite . we choose to normalize this multiplier to the fire scaling at @xmath62 .",
    "hence the velocity formula used in mufasa  is @xmath63 finally , we add a random tophat scatter of @xmath64 to @xmath49 .",
    "the resulting wind launch velocities are typically @xmath65 , which is comparable to the observed maximum outflow speeds in low - redshift  @xcite and high - redshift  @xcite galaxies .",
    "winds are often observed to be flowing out of nearby galaxies ( e.g. m82 ) partly in hot gas , putatively heated by supernova explosions and the resulting shocks .",
    "previous kinetic wind models  @xcite have generally not included this form of energy injection , even though their simulations lack the resolution to properly capture sne shock heating in the ism .",
    "winds are also seen in cool form , mainly via low - ionisation absorption lines .",
    "hence it is clear that there are at least two phases for outflowing gas .    in mufasa , we model two - phase winds by randomly selecting outflowing gas to be  cool \" or  hot \" .",
    "cool gas is ejected at @xmath66  k , although they quickly heat to @xmath67  k via photo - ionisation once they are outside the ism .",
    "for the hot wind , we directly employ a fraction of the supernova energy not used for kinetic ejection into thermal heating of the wind . for a chabrier initial mass function ( imf )",
    ", each solar mass of stars produces 0.01028 stars with masses above @xmath68 .",
    "we assume each of these becomes a supernova which produces @xmath69  ergs , hence the specific energy production from sne is @xmath70  erg  g@xmath71 .",
    "the kinetic energy used by the wind is @xmath72 , where we assume that the total wind mass ejected owing to a gas mass of @xmath41 forming into stars is @xmath73 .",
    "if each wind fluid element has mass @xmath41 , then the specific energy utilised by the wind is @xmath74 .",
    "the specific thermal energy added to each hot wind gas element is then @xmath75 if @xmath76 we add no heat ; physically , this can represent a situation where other wind mechanisms such as radiation pressure are primarily responsible for driving winds .",
    "we have found that so long as the heating raises the typical temperature above a few times @xmath77k to get it past the helium and cooling peaks ( which @xmath78 almost always does ) , then the impact on galaxies is relatively insensitive to the exact amount of heating .",
    "we define a free parameter @xmath79 that determines the fraction of the wind that is ejected hot .",
    "each wind element is then randomly chosen to be either hot or cool , based on the probability @xmath80 . in mufasa , we choose @xmath81 , motivated by ism - scale simulations of supernova - driven winds that suggest roughly 30% of the material is ejected in hot form ( t. naab , priv . comm . ) .",
    "hence our two - phase wind is assumed to be majority cool , but containing a substantial component of hot gas .",
    "no hydrodynamics code is able to properly evolve a single fluid element ( cell or particle ) moving with a high mach number @xmath82 through its surroundings .",
    "this is simply a limitation of resolution , and is not mitigated by the use of an improved hydrodynamics solver in mfm : a single fluid element will never be able to capture the sub - element mixing and dissipation with its surrounding gas .",
    "for this reason , it is necessary to make some approximation regarding the interactions of the outflowing gas when passing through the ism .",
    "ideally , one would like to follow the detailed evolution of gas mixing with its surroundings via surface instabilities , but this is non - trivial , since the kelvin - hemholtz mixing time is generally very short .",
    "instead , we follow early works by @xcite and @xcite , along with recent simulations such as illustris  @xcite , and employ _ decoupled _ winds .",
    "that is , we turn off hydrodynamic forces on outflowing gas until such time as it ",
    "recouples \" back to its surrounding gas . the physical motivation is that winds are often seen to blow channels through the ism that likely allow the relatively unfettered escape of a coherent flow .",
    "moreover , this makes physical sense since our outflow scalings are taken from fire simulations who measured their wind properties well outside the ism .",
    "the criteria for recoupling has historically been chosen via a density threshold , e.g. 10% of the ism density threshold , and a time limit , e.g. enough to free - stream for tens of kpc  ( e.g. * ? ? ?",
    "* ) . here , we add a new recoupling criterion : that the velocity of the outflowing gas element be similar to its surroundings .",
    "this criterion additionally allows recoupling when the gas has a velocity that can be properly handled by the hydrodynamics solver .",
    "specifically , our recoupling criterion requires that the wind gas element has a velocity difference with respect to surrounding gas of less than 50% of the local sound speed ( @xmath83 ) .",
    "the sound speed is calculated from the kernel - weighted temperature of surrounding gas at the wind element s position , and the velocity difference is summed over all neighbors with kernel weighting .",
    "we exclude all other decoupled wind gas when computing quantities for the surrounding gas . using 20% or 100% rather than 50% did not yield appreciably different results .",
    "we further turn off radiative cooling while the wind is decoupled , in order to allow hot gas in the wind to deposit their thermal energy into the circum - galactic medium ( cgm ) .",
    "gas elements satisfying the mach number criterion are recoupled regardless of surrounding density or time , so long as they have a density that is less than the ism density .",
    "but there are cases where this recoupling criterion is not satisfied for a long while or until far away , particularly in low - mass halos where the outflows are typically ejected into very low density gas .",
    "hence we also employ a density limit of 1% of the ism threshold density , and a time limit of 2% of the hubble time at launch which is comparable to a disk dynamical time ; reaching either of these criteria automatically triggers recoupling as well . in the end , the total fraction of decoupled gas is always well below 1% , reaching a maximum of around @xmath84% at @xmath9 .",
    "equation  [ eq : eta ] requires @xmath54 to determine @xmath48 , and equation  [ eq : vw ] requires @xmath56 to determine the outflow velocity . to determine @xmath54 and @xmath56",
    ", we employ a fast approximate friends - of - friend ( fof ) galaxy finder on the fly during the simulation run .",
    "this fof finder groups stars and ism gas into baryonic galaxies .",
    "it is approximate because it finds neighbours within a cube of side @xmath85 , where @xmath86 is the linking length , rather than a sphere of radius @xmath86 .",
    "this greatly improves computation speed while having minimal impact on the identified galaxies , thus enabling the code to run this fof finder at essentially every timestep .",
    "we calibrate @xmath87 times the mean interparticle spacing in order to obtain the same mass function as that obtained by using the spline kernel interpolative denmax  ( skid ; e.g. * ? ? ?",
    "* ) galaxy finder .",
    "our results are insensitive to variations in @xmath86 by a factor of a few around our chosen value , but we choose this value since it is the minimum hydrodynamic kernel size , which is 40% of the minimum softening length , multiplied by 2.8 which is the conversion from plummer equivalent softening to the actual smoothing kernel radius .",
    "hence we link particles that are within one ( minimum ) kernel length of each other .",
    "this fof finder yields groupings of star particles and gas elements , from which we compute the baryonic mass @xmath88 and @xmath54 .",
    "given @xmath88 , we then determine @xmath56 for use in our outflow scalings by employing the observed baryonic tully - fisher relation  @xcite with a redshift evolution as expected from @xcite , namely @xmath89 where @xmath90 is hubble s constant at redshift @xmath91 .",
    "type ia supernovae ( snia ) and asymptotic giant branch ( agb ) stars provide additional energetic feedback .",
    "these components provide feedback that is substantially delayed relative to the time of star formation , hence are not represented by our kinetic outflows and must be included separately .",
    "typically , delayed feedback is energetically sub - dominant relative to the processes that drive winds , but they may be important in particular circumstances , hence we include their contributions for completeness .",
    "the snia rate is modeled following @xcite as a prompt component that is concurrent with snii , and a delayed component that emerges from stars and begins after an age of 0.7  gyr .",
    "the rates are taken from @xcite , namely @xmath92 snia  @xmath93yr@xmath94 for the prompt component , and @xmath95 snia  @xmath96 for the delayed component  ( see * ? ? ?",
    "* for further details ) .",
    "each snia is assumed to add @xmath69  erg of energy to the surrounding gas .",
    "the prompt component energy is added at each timestep to each star - forming gas element , and the delayed component is added to the 16 nearest gas elements to the given star , in a kernel - weighted fashion . to save computation time , we do the delayed feedback for stars only at specific intervals , with the interval scaling roughly inversely with the age of the star , from a minimum of every timestep for ages under 200  myr to a maximum of every 10 timesteps for stars 2  gyr and older .",
    "agb star feedback also adds energy to surrounding gas .",
    "we implement the model of @xcite in which agb stellar winds are assumed to thermalise with the ambient gas .",
    "first , we compute the stellar mass loss rate assuming a @xcite initial mass function using a lookup table based on @xcite models .",
    "we then calculate the energy deposition rate based on the mass loss rate and the velocity difference of the star relative to each neighboring gas element .",
    "we again use the 16 nearest neighbors , in a kernel - weighted fashion .",
    "we add the velocity of the stellar wind to this , which we assume to be 100  km / s  @xcite . in practice ,",
    "even this large wind stellar velocity that is on the upper end of plausibility makes a negligible difference for most galaxies .",
    "this is because if the energy is added to star - forming gas it will quickly radiate away .",
    "however , such energy could potentially accumulate into making a substantial impact if the stars are embedded primarily in hot gas , such as in a cluster environment ; we will examine this in more detail in future work .",
    "delayed feedback mechanisms also deposit heavy elements into the surrounding gas .",
    "we track the evolution of 11 elements , including hydrogen , helium , and 9 metals : c , n , o , ne , mg , si , s , ca , and fe .",
    "these elements comprise over 90% of metal mass in the universe .    for snii yields , we use @xcite ,",
    "parameterised as a function of metallicity ; we interpolate the yields to the metallicity of the given gas element being enriched .",
    "we are using essentially the same yield tables used in @xcite , which in ( * ? ? ? * and other studies ) was found to result in metallicities that are too high by a factor of @xmath97 compared to the observed mass - metallicity relation . in previous studies  ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) we have simply rescaled metallicities in post - processing , arguing that such changes do not greatly impact the dynamics , and that the predicted yields are uncertain at this level",
    ". however , given that cooling and @xmath0-based star formation rates depend on metallicity , it is more accurate to reduce the yields during the simulation run .",
    "for this reason , we multiply all type  ii sn yields by a factor of 0.5 .",
    "we add all snii energy to the star - forming gas element itself , in the instantaneous self - enrichment approximation .",
    "on cosmological timescales , and with sufficient star - forming gas within a given galaxy , this yields a well - converged metallicity distribution .    for snia yields , we employ @xcite , assuming each snia yields @xmath98 of metals .",
    "the prompt snia component , like typeii enrichment , is done in the instantaneous self - enrichment approximation , while the delayed feedback components are added to the 16 nearest gas element surrounding the given star in a kernel - weighted manner .    for agb stars , we follow @xcite and employ a lookup table as a function of age and metallicity in order to obtain the yields ; these yields come from several sources , as described in @xcite .",
    "we additionally assume 36% helium fraction and a nitrogen yield of 0.00118 .",
    "the enrichment , like the energy , is added from stars to the nearest 16 gas elements , kernel - weighted , following the mass loss rate as computed assuming a @xcite imf .    for the kmt model",
    ", we need to provide a total metallicity in solar units , for which we assume a solar abundance taken from @xcite .",
    "we do not include metal diffusion or mixing in these models to avoid an extra free parameters , since it is unclear how much metal mixing should be occuring  @xcite .",
    "lccccccccccc name & @xmath99 & @xmath25 & @xmath100 & @xmath101 & @xmath102 & @xmath103 & @xmath104 & @xmath105 & @xmath106 & @xmath107 & @xmath108 +   + m50n512 & 50 & 0.5 & @xmath109 & @xmath110 & @xmath111 & 0.20 & 0.98 & 1.11 & 0.23 & 1.32 & 1.97 + m25n512 & 25 & 0.25 & @xmath112 & @xmath113 & @xmath114 &  & - & 1.04 & 0.08 & 1.24 & 1.00 + m12.5n512 & 12.5 & 0.125 & @xmath115 & @xmath116 & @xmath117 &  & - & 0.19 & 0.02 & 0.38 & 0.26 +     + @xmath99 is the box size in comoving @xmath118 .",
    "+ @xmath25 is the minimum gravitational softening length in comoving @xmath119 ( equivalent plummer ) .",
    "+ @xmath102 is the galaxy stellar mass resolution limit in @xmath120 ( 32 star particle masses ) .",
    "+ [ tab : sims ]      with only stellar feedback as described above , massive galaxies still form stars too rapidly and the stellar mass function is not truncated at the high mass end  ( e.g. * ? ? ?",
    "hence an additional  maintenance mode \" source of energetic feedback is required to fully quench massive galaxies  ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "here we follow the model in @xcite , who argued that keeping gas hot in massive halos is sufficient to yield quenched massive galaxies in agreement with mass function and red sequence observations .",
    "we quench galaxies by heating all gas in massive halos _ except _ gas that is self - shielded .",
    "we compute the self - shielded cold gas fraction for each gas element using the prescription described in @xcite , which parameterises the effective strength of the photo - ionising background impinging on gas as a function of density and redshift .",
    "this ionising background strength is then used to compute the cold gas fraction ( which includes both neutral and molecular gas ) using a rate balance equation as described in @xcite .",
    "gas is considered self - shielded if its cold gas fraction after applying self - shielding is above 10% . by only heating non - self - shielded gas , most of the neutral and molecular hydrogen within hot halos is unaffected , ensuring that these cold gaseous components are only directly affected by physical processes such as stripping rather than our quenching prescription .",
    "we apply this quenching heating in massive halos with a mass that exceeds the quenching mass given by @xmath121 this formula is obtained from the analytic equilibrium model of @xcite as the best - fit parameterization of @xmath122 required to match various observational constraints from @xmath123 .",
    "gas in halos above @xmath122 that is not self - shielded and is below the virial temperature @xmath124 is heated to 20% above virial temperature @xmath124 at each timestep .",
    "we calculate @xmath125k  @xcite , where we obtain the halo mass @xmath126 using a friends - of - friends algorithm with a linking length of 0.16 times the mean interparticle spacing .",
    "this fof algorithm is different than the one used to compute @xmath54 and @xmath56 , and is only run every 0.5% of a hubble time only on dark matter particles since it has substantial computational cost ; gas and star particles are linked to halos via their nearest dark matter particle .",
    "we stress that this is a phenomenological model intended to capture the most important effects of whatever microphysics actually drive quenching .",
    "specifically , we are _ not _ saying that halos simply `` self - quench '' in the simulations ( owing to e.g.  virial shocks or simple cooling physics ) . quite the opposite : if we only include hydrodynamics , cooling , star formation , and stellar feedback physics , we see far too much star formation at high masses , as noted above .",
    "this model directly requires some additional feedback mechanism to be the source of ( considerable ) additional energy to maintain the virial temperatures of halo gas .",
    "the physical mechanisms of this feedback remain uncertain , however  hence the empirical model adopted here .",
    "the most likely candidate is feedback from a super - massive black hole , which many groups have shown can plausibly inject sufficient energy far out in the halo and resolve the cooling flow problem  @xcite . in future work , we will explore what the empirical model here requires in terms of energetic input , and how this compares to e.g. the kinetic luminosity function of agn jets . in these simulations",
    "( with @xmath127kpc resolution ) , however , any model for black hole formation / seeding , dynamical evolution , merging , fueling / growth , and feedback would be necessarily sub - resolution .",
    "as such , we would in any case simply adjust the sub - resolution parameters until they produced the same effects as our quenching model here .",
    "our method here thus allows us to more directly isolate what needs to occur on _ resolved _ scales in the simulation , in order to match massive galaxy observations .",
    "all simulations assume a cosmology consistent with @xcite  full likelihood \" constraints : @xmath128 , @xmath129 , @xmath130 , @xmath131 , @xmath132 , and @xmath133 .",
    "we generate initial conditions with these parameters using music  @xcite .",
    "each runs begins at @xmath134 in the linear regime .",
    "our fiducial simulation consists of a @xmath12 randomly - selected cubical cosmological volume , with additional simulations used to examine early galaxy evolution having @xmath6 and @xmath7 box sizes ( these are separate runs , not sub - volumes extracted from the larger run ) .",
    "each run evolves @xmath135 gas fluid elements ( i.e. mass - conserving cells ) and @xmath135 dark matter particles . with these choices ,",
    "the @xmath7 volume s halo mass resolution ( i.e. 64 dark matter plus 64 gas elements ) is @xmath136 , which means that this run resolves essentially all hydrogen cooling halos back to the earliest epochs .",
    "we will also show results from @xmath6 , @xmath137 element runs to examine variations in hydrodynamics methodology .",
    "table  1 lists our main mufasa  run parameters .",
    "the 50@xmath118 boxes is evolved to a final redshift of @xmath138 , while the 25@xmath118 and @xmath7 volumes down to @xmath139 owing to both computation expense and the fact that these volumes are too small to be representative at later epochs .",
    "we also list the galaxy stellar mass resolution limit @xmath140 in each run , taken to be 32 star particle ( or equivalently , gas element ) masses .",
    "we have found that stellar mass functions are generally well - converged to this limit , but other quantities such as star formation histories can require a higher mass threshold for convergence  ( e.g. * ? ? ?",
    "we output 135 snapshots down to @xmath2 ( 85 to @xmath8 ) for each run .",
    "we analyse the snapshots using sphgr @xcite , which identifies galaxies using skid and halos using rockstar  @xcite , and then links them via their positions .",
    "sphgr goes on to calculate many basic properties of the galaxies and halos such as @xmath54 and sfr , and finally outputs a python  pickle \" file for each snapshot that contains all this information , including member particle lists .",
    "all plots in this paper are produced directly from these sphgr pickle files .",
    "-0.1 in -0.1 in -0.1 in    the primary observational benchmark for testing galaxy formation models is the galaxy stellar mass function ( gsmf ) .",
    "the gsmf has now been measured robustly out to @xmath141 , covering about 90% of cosmic stellar mass buildup , thanks in particular to improving deep near - infrared surveys such as the cosmic assembly near - ir deep extragalactic legacy survey  ( candels ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) and the fourstar galaxy evolution survey  ( zfourge ; * ? ? ?",
    "measurements at higher redshifts are also improving rapidly  ( e.g. * ? ? ? * ; * ? ? ? * ) , though they typically rely on less certain conversions between ultraviolet luminosity and stellar mass . matching the gsmf and",
    "its evolution is thus a key test of whether a model reproduces the bulk of galaxy growth over cosmic time .",
    "it remains a significant challenge for galaxy formation models , be they semi - analytic ( sams ) or hydrodynamic , to match the gsmf to within uncertainties at all redshifts  @xcite .",
    "sams can reproduce the @xmath2 gsmf quite well , typically because they are tuned to do so , while hydrodynamic simulations have recently achieved improved levels of success with @xmath142 discrepancies at @xmath2 . moving to higher redshifts ,",
    "most models overproduce the gsmf below the knee at @xmath143 , and some underproduce the gsmf at @xmath144 .",
    "these differences show up prominently when considering the star formation histories of galaxies , where models characteristically deviate from that inferred for real galaxies particularly at lower masses in the sense of having overly early stellar growth in low - mass galaxies  @xcite . in this section",
    ", we will test the mufasa  simulations against observations using the evolution of the gsmf from @xmath145 .",
    "figure  [ fig : mfres ] shows the gsmf from our mufasa  simulations at @xmath146 .",
    "the three box sizes are colour - coded as navy blue ( @xmath7 ) , cyan ( @xmath6 ) , and crimson red ( @xmath12 ) .",
    "only galaxies with stellar masses above the galaxy mass resolution limit listed in table  [ tab : sims ] are included in each case .",
    "we compare to observations ( black circles , with poisson errors ) at @xmath2 from the galaxy and mass assembly ( gama ) survey by @xcite and from @xcite , at @xmath147 to combined candels and zfourge data from @xcite , and at @xmath148 to candels data from @xcite . for @xcite , to obtain the gsmf at @xmath149 we average the quoted values at @xmath150 and @xmath151 weighted by the number of galaxies in each bin , and analogously we compute a weighted average of @xmath152 and @xmath153 to obtain the @xmath8 points shown ; for @xmath154 , we quote the @xmath155 results , which is likely a slight overestimate . while we only choose to compare to one data set so we can more easily engage in quantitative statistical comparisons ,",
    "various current gsmf observations do not differ significantly at @xmath156 ( e.g. * ? ? ?",
    "* ) .    in table  1",
    ", we quote a reduced @xmath157 value comparing the simulation data to observational data at each redshift , for each run . to obtain this ,",
    "we compute error bars on the simulation values as the variance in the gsmf over eight sub - octants of each simulation volume .",
    "this approximately accounts for both cosmic variance and poisson errors , though generally the poisson errors are sub - dominant .",
    "this then produces error bars ( asymmetric in log space ) , which are displayed in figure  [ fig : mfres ] .",
    "we then compute @xmath157 from these error bars in log ( not linear ) space , so that a gsmf that is e.g. low by a factor of 2 will have the same @xmath157 as one that is high by a factor of 2 .",
    "we sum @xmath157 over the range of overlapping masses between the simulation and the data , using the upper error bar if the data is higher than the simulation , otherwise the lower error bar .",
    "to get a reduced @xmath158 we divide by the number of observed data points .",
    "these @xmath159 values provide a quantitative assessment of the level of agreement between mufasa  runs and the observed gsmf .",
    "we note that this value of @xmath157 does not take into account uncertainties in the observations themselves , but as can be seen in figure  [ fig : mfres ] from the statistical error bars shown on the observed points , these uncertainties are generally sub - dominant to cosmic variance uncertainties .",
    "there are additional systematic errors in observed gsmf determinations which can be quite significant particularly at high redshifts , but we also ignore these since these are difficult to quantify accurately  ( see e.g. * ? ? ?",
    "* for more discussion ) .",
    "we also note that we are comparing skid - derived masses in simulations to ( typically ) aperture - based masses from various observational samples , which may introduce a significant bias particularly at high masses ( @xmath160 ) where high - sercic profiles create extended wings in the surface brightness distribution  @xcite .",
    "hence the comparisons at the highest masses should be regarded with some additional observational uncertainty , but our values for @xmath159 are generally driven by low-@xmath54 where our cosmic variance errors are smaller .",
    "finally , we note that our cosmic variance errors may still be underestimated owing to our smaller volume , as @xcite found somewhat larger uncertainties from 25@xmath118 sub - volumes in illustris .",
    "all of these additional aspects would go towards lowering our quoted @xmath158 values .",
    "we now examine how well the mass functions agree with observations at various redshifts . at @xmath2 ,",
    "our @xmath12 fiducial mufasarun is in remarkably good agreement with the @xcite gsmf .",
    "it faithfully reproduces the observed low - mass slope down to our galaxy mass resolution limit , showing that our star formation feedback algorithm does very well at properly suppressing the low - mass end . at high masses",
    ", there is a sharp turnover towards an exponential that has been difficult to achieve in previous models , and highlights the success of translating the evolving quenching mass determined from the equilibium model of @xcite into full hydrodynamic simulations",
    ". there may be a very slight overproduction of the highest mass galaxies , albeit well within cosmic variance uncertainties , but we note that there is some uncertainty in the masses of massive ellipticals owing to how the galaxy is separated from intracluster light  @xcite .",
    "as listed in table  [ tab : sims ] , the reduced @xmath161 at this redshift relative to @xcite , which quantifies the excellent agreement with observations .",
    "the agreement is slightly less good veresus @xcite , with @xmath162 , driven mostly by the reduced high - mass gsmf in this determination .    at @xmath149 ,",
    "the mufasa  mass function is in good agreement with the @xcite observations , with @xmath163 .",
    "there is a slight excess in the sub-@xmath164 range ; this becomes more prominent at @xmath8 , which has a comparable @xmath165 .",
    "the disagreement is driven most strongly by the lowest observed point , which may also be the most uncertain owing to incompleteness in the observations .",
    "in contrast , @xcite determined a steeper faint - end slope of @xmath166 from rest - uv observations , in much better agreement with mufasa .",
    "upcoming observations with the _ james webb space telescope _ should definitively settle this issue .    at @xmath8",
    "we see , in both the observations and the @xmath12 simulation , a turn - down at the highest masses where our quenching model starts to suppress massive galaxy growth . at this redshift , @xmath167 , which means that galaxies with @xmath160 can begin to be affected .",
    "the onset of quenched massive galaxies between @xmath168 is in general agreement with observations  ( e.g. * ? ? ?",
    "interestingly , the most actively star - forming galaxies in the universe at @xmath169 have halo masses of @xmath170  @xcite , which corroborates our value of @xmath122 at these epochs .",
    "since our smaller volumes are evolved to @xmath8 , we can here examine the resolution convergence among all three volumes .",
    "broadly , the three runs lie within cosmic variance uncertainties of each other .",
    "however , in detail we see that there is a systematic trend that higher resolution simulations produce slightly higher mass functions in the overlapping mass range . over a factor of 64 in mass resolution between the @xmath12 and @xmath7 volumes , the mass function at @xmath171 is increased by about a factor of two . at higher masses ,",
    "the gsmf in the smallest volume start to drop low because it can not form enough massive galaxies .",
    "the @xmath6 interpolates this trend , being slightly higher at low-@xmath54 compared to the fiducial volume , and slightly lower at high-@xmath54 .",
    "we note that the @xmath158 values for the smaller volumes are still close to unity , so the agreement with data is still satisfactory , although in part this owes to our smaller volumes having larger cosmic variance uncertainties .    at @xmath154 ,",
    "all the volumes gsmfs are essentially power laws over the modeled mass range .",
    "the agreement is excellent with all three simulations , with @xmath172 .",
    "however , we note that the data used is actually from galaxies at @xmath155 , so at @xmath154 it is possible that the data should be slightly lower than indicated . hence as a check we analyzed a @xmath173 simulation output and compared with this data , and still found very good agreement with @xmath174 . the resolution convergence among the three volumes here , as well as at all higher redshifts , is excellent .    at higher redshifts ( @xmath148 )",
    ", we begin to see slight discrepancies at the high - mass end , in the sense that the mufasa  runs do not produce enough high - mass galaxies .",
    "it is already slightly evident at @xmath175  while the smallest volume has @xmath176 , the larger volumes show @xmath177 .",
    "the discrepancy becomes somewhat more significant at @xmath178 , particularly in the @xmath12 volume , where @xmath179 .",
    "the other volumes , probing only lower masses , are not as strongly discrepant , having @xmath180 at @xmath178 .",
    "this discrepancy could be the result of the very high bias of early massive galaxies , which reside in large halos that are not properly represented even in the @xmath12 volume .",
    "alternatively , it could be that the limited resolution does not capture very early star formation in the largest density perturbations .",
    "hence both resolution and volume effects go towards underproducing early stellar mass .",
    "we note that another high-@xmath91 gsmf determination from candels by @xcite yields generally higher values , which would be further discrepant ; the determination from @xcite , on the other hand , are comparable to that of @xcite . nonetheless , it is worth noting that are at present substantial systematic uncertainties in deriving stellar masses at these redshifts .",
    "we note that at @xmath181 , and particularly at @xmath144 , the observational gsmf determinations are subject to significant systematic uncertainties , and various determinations often lie significantly outside each others formal statistical uncertainties  @xcite . for this reason",
    ", one should use caution in interpreting the agreement or lack therefore with models at these redshifts , as improving observations may shift these values non - trivially . nonetheless , much of the disagreement between data sets occurs at high-@xmath54 , whereas our @xmath158 is driven by our agreement at low-@xmath54 where our cosmic variance errors are small . for now , we claim that our agreement is comparably good against most recent data sets at these redshifts , but that future observational determinations may yet alter this .    in summary ,",
    "mufasa  does an excellent job of matching the observed gsmf from @xmath3 , in all cases to within @xmath4 in simulation cosmic variance .",
    "this agreement is unprecedented , and suggest that mufasa  achieves an impressive level of realism in modeling galaxy stellar growth across cosmic time .",
    "the agreement at the massive end owes to our evolving halo quenching mass , and suggests that this simple description provides a good match to the truncation of star formation across cosmic time  ( as argued e.g. in * ? ? ?",
    "* ; * ? ? ?",
    ". it also illustrates the synergy between constraints derived from the analytic equilibrium model and detailed hydrodynamic simulations . at high redshifts ,",
    "the data are still subject to significant systematic uncertainties , hence we await upcoming deeper observations particularly using the _ james webb space telescope _ to more robustly constrain these models .",
    "nonetheless , our high - resolution simulations agree quite well with currently available reionisation - epoch gsmf observations , suggesting that simulations that resolve all h - cooling halos are robust for such studies .",
    "our runs also show reasonable resolution convergence , albeit with a noticeable trend for higher - resolution simulations to produce slightly higher gsmfs at the low - mass end .",
    "-0.2 in -0.1 in    recently , major cosmological galaxy formation simulation projects have set new standards for the number of fluid elements and input physics .",
    "illustris  @xcite , eagle  @xcite , and massiveblack - ii  ( mb - ii ; * ? ? ?",
    "* ) each model around @xmath182 fluid elements , making them the ( computationally ) largest cosmological hydrodynamic simulations of galaxy formation evolved to @xmath2 to date .",
    "illustris employs arepo , eagle uses a modern sph variant , and mb - ii uses gadget-3  with entropy - conserving sph  @xcite . while the dynamic range of these simulations is a remarkable computational achievement , it is still insufficient to directly model the feedback processes that regulate galaxy evolution .",
    "hence like mufasa , they utilize subgrid representations for star formation and black hole feedback in order to suppress galaxy growth .",
    "the differences in their gsmf predictions are likely driven primarily by variations in feedback recipes , as opposed to variations in hydrodynamic methodology  .",
    "illustris and massiveblack - ii employ decoupled winds , phenomenologically similar to mufasa .",
    "illustris uses scalings for energy - driven winds , namely @xmath183 ; this is similar to that predicted from high - resolution zooms by @xcite , although the amplitude assumed in illustris is many times higher .",
    "mb - ii uses a constant mass loading factor and wind speed similar to the original @xcite recipe .",
    "such a  constant wind \" model gives roughly the correct global stellar mass density , but does not fare as well at reproducing gsmfs  ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "eagle , in contrast , does not decouple winds , but rather assumes that ism gas particles accumulate sn energy until they can be instantaneously heated to a high temperature , typically @xmath184k where cooling times are long and hence the thermal pressure can drive an outflow .",
    "while hydrodynamics remain turned on , cooling is effectively turned off as the particle accumulates sn energy , which occurs for tens of dynamical times , and hence this model is also phenomenological . in this way , the approach has similarities to the blast wave cooling shutoff model of e.g. @xcite and @xcite .",
    "nonetheless by tuning this presciption , it is possible to nicely reproduce the @xmath2 stellar mass function , with a key aspect being that the given amount of supernova energy from star formation is preferentially injected into higher density gas  @xcite .",
    "while differing in approach , all these simulations have claimed to be in broad agreement with observations of the gsmf .    in figure  [ fig : mfsim ]",
    "we compare the gsmf of the mufasafiducial @xmath12 run to the illustris simulation  ( * ? ? ?",
    "* orange dashed line ; ) , the eagle reference model  ( * ? ? ?",
    "* dark blue dashed line ; ) , and the massiveblack - ii simulation  ( magenta dashed line ; * ? ? ?",
    "* ) at @xmath185 and 4 .",
    "the first two are reproduced from @xcite , while the latter data was kindly provided by a. tenneti and t. dimatteo .",
    "we omit error bars that were shown in figure  [ fig : mfres ] to better see the differences , but we include the same observations as were shown in that figure for reference .    at @xmath2 ,",
    "the mufasa  and eagle simulations both do an excellent job of reproducing the observed gsmf , with mufasa  doing somewhat better at capturing the sharp knee of the mass function .",
    "@xcite describes the process of tuning eagle s input physics in order to obtain this agreement , though it is worth noting that their mass function mostly emerged rather naturally , and much of the tuning was done to match galaxy sizes . in our case , we mostly constrained our input physics using higher - resolution simulations or analytic models , but we still had to mildly tune some parameters such as the outflow velocity",
    ". meanwhile , illustris clearly overproduces galaxies at both low and high masses , and only agrees well around @xmath164 ( i.e. the knee ) .",
    "massiveblack - ii shows the characteristic steep mass function that their  constant wind \" feedback model is known to produce , which greatly overpredicts small galaxies and underpredicts the gsmf around @xmath164  ( see also * ? ? ?",
    "* ) .    at @xmath149 ,",
    "the discrepancies between simulations and data starts to grow , particularly below @xmath164 .",
    "all the simulations overpredict the low - mass end to varying levels .",
    "illustris and mb - ii are quite high , and eagle is mildly high compared to observations .",
    "mufasaalso overpredicts the low - mass end , but to a lesser extent than any other model , making it clearly the best fit to the intermediate - redshift gsmf .    at @xmath8 ,",
    "the discrepancies seen at @xmath149 for low mass galaxies persist ; generally , the simulations are signficantly higher than observations here , with mufasa  providing the closest match . at the massive end , illustris and mb - ii",
    "nicely reproduce the turnover , but eagle cuts off the gsmf at too low a mass .",
    "mufasa  also truncates the gsmf slightly early , albeit less so than eagle .",
    "part of this may owe to the smaller @xmath12 box size of mufasa , relative to the other simulations which have @xmath186 box sizes .    at @xmath175 , illustris and eagle do somewhat better than mufasa , as our fiducial mufasa  run produces too low a gsmf .",
    "our @xmath6 volume which has comparable resolution to those runs , as well as our @xmath7 run , show better agreement as seen in figure  [ fig : mfres ] . as mentioned previously",
    ", the deficit in the @xmath12 run may owe to the lack of resolution to start galaxy growth early enough , combined with the lack of volume required to include growth of the largest halos .",
    "nonetheless , mufasa  is still within @xmath187 of cosmic variance , so it is possible that the chosen initial conditions unluckily do not produce enough early massive galaxies .",
    "while the mufasa  runs presented here lack a dynamic range comparable to these larger simulations , they do offer several modeling advantages .",
    "compared to massiveblack - ii , mufasa  employs a hydro solver that has been shown to yield better results for key test problems  @xcite , and additionally our outflow scalings better reproduce the observed gsmfs at the low - mass end .",
    "compared to illustris , mufasa  reproduces observed gsmfs significantly more closely over most of cosmic time . generally , eagle and mufasayield comparably good mass functions , with mufasa  slightly better from cosmic noon until today , and eagle slightly better at @xmath175 .",
    "mufasa  has some disadvantages as well .",
    "besides less dynamic range , we also do not yet explicitly track central black hole growth and feedback as the other simulations do ( this is in progress ; see e.g. @xcite ) .",
    "nevertheless , compared to recent state - of - the - art galaxy formation simulations , mufasa  generally is as good or better at reproducing the observed stellar mass buildup in galaxies across the majority of cosmic time as traced by the gsmf .",
    "the growth of galaxy stellar mass is reflected in the star formation rates of galaxies across cosmic time . a key barometer of this is the evolution of the cosmic star formation rate density ( sfrd ) , commonly known as a lilly - madau plot .",
    "we note that the cosmic sfrd is not an ideal test of models , because it is an integrated quantity that can be sensitive to observational integration limits , and individual simulations only cover a limited range of the total cosmic star formation .",
    "hence discrepancies compared to observations may reflect limitations of volume or resolution rather than intrinsic model failings .",
    "nonetheless , the sfrd evolution is a oft - used benchmark and highlights some important points about the characteristics of galaxy growth .    figure  [ fig : madau ] shows the cosmic star formation rate density ( @xmath188 ) evolution as a function of @xmath189 .",
    "our three volumes ( @xmath190 ) are shown as the crimson , cyan , and navy blue lines respectively . here , we have plotted the sfr directly output during the simulation run as the stellar mass formed per unit time , which displays small - timescale fluctuations owing to the stochastic nature of our star formation algorithm ; this employs no selection criterion , and even includes star formation in unresolved galaxies . for comparison ,",
    "data from a recent compilation by @xcite is shown in black , including a line for their global best - fit relation along with the individual compiled data points ; these have been divided by 1.7 in order to correct from their assumed salpeter imf to a chabrier imf .",
    "the fiducial @xmath12 simulation qualitatively follows the observed trend faithfully : there is a rapid rise of @xmath188 from @xmath191 , then it is relatively constant until @xmath192 , and then it falls rapidly towards the present day . the evolution since @xmath192 generally follows the power - law expectation from cosmological accretion , as has been noted by many previous works  ( e.g. * ?",
    "in detail , mufasa  underpredicts the global sfr during cosmic noon ( which we will discuss in  [ sec : ssfr ] ) , and overpredicts the sfr at lower redshifts ( @xmath193 ) by about 50% .",
    "this is particularly curious in light of the good agreement with the evolution of the gsmf .",
    "it is also opposite to the discrepancy versus the recent models such as illustris , eagle , and the sam of @xcite , which tend to _ underpredict _ the sfrd at low-@xmath91 while still generally agreeing with gsmf evolution .",
    "the sfrd peak at @xmath194 is also broader in mufasa  than in the data , which likewise mimics the trend in other current models .",
    "it is not obvious how one reconciles all these models and observations ; in part it may reflect systematic uncertainties in star formation rate measures , or suggest that a more careful comparison should be done to account for observational selection effects .",
    "we will break this down versus @xmath54 in  [ sec : ssfr ] to gain more insights into the differences .",
    "the @xmath6 run matches the @xmath12 quite well over the redshift range probed .",
    "this is a bit of a coincidence , as we have seen in the gsmf that the low - mass end is slight overproduced in this run , which appears to compensate for the lack of high - mass star - forming galaxies owing to the smaller volume . for the @xmath7 run , this coincidental balance fails , as the lack of high - mass star forming galaxies dominates over the mild excess production at low masses . as a result , @xmath188 begins to lie significantly below that of the larger volumes at @xmath195 .",
    "there is also significant stochasticity over long timescales at @xmath196 ( in addition to the short stochasticity ) because the global star formation is dominated by a handful of the most massive galaxies whose star formation rates can vary substantially .",
    "overall , the small - volume results are seen to be not cosmologically representative at @xmath195 in terms of large galaxy growth , but the evolution of dwarf galaxies should still be robust . at @xmath144 , all our volumes sfrd values agree with each other , and are within the uncertainties of the @xcite data .    in summary , the sfrd evolution from @xmath145 is broadly reproduced in our mufasa  runs .",
    "this is not surprising given the fact that the gsmf matches reasonably well at all redshifts @xmath197 .",
    "the deviations at @xmath195 in the @xmath7 volume highlight incompleteness at the massive end owing to its small volume ; deviations at lower redshifts will be discussed ",
    "[ sec : ssfr ] .",
    "a key characteristic of the galaxy population is known as  downsizing \" , first coined by @xcite , in which star formation shifts from more massive galaxies to lower - mass galaxies over time .",
    "this results in more massive galaxies having older stellar populations , which has been dubbed  archaeological downsizing \"  @xcite .",
    "while downsizing has been referred to as anti - hierarchical , the qualitative trend is a natural outcome of hierarchical structure formation , since the largest galaxies arise in the largest density perturbations which are able to collapse and start forming stars first  @xcite .",
    "nonetheless , quantitatively reproducing the observed growth rates of galaxies as a function of mass has proved challenging for models .    since the fiducial mufasa  simulation well reproduces the observed stellar mass function covering over 90% of cosmic star formation",
    ", it provides a quantitative picture of downsizing as a function of galaxy mass .",
    "figure  [ fig : sfhist_ms ] illustrates this . here",
    ", we show the star formation history of galaxies subdivided into five bins of @xmath2 stellar mass , from @xmath198 to @xmath199 .",
    "the time at which half the present - day stellar mass was formed is indicated by the colour - coded upward arrows along the bottom of the plot , for each mass bin . note that this is computed by examining the formation times of the _ remaining _ stellar mass at @xmath2 , which is different than the star formation rate in those galaxies at any particular epoch , owing to the effects of stellar mass loss ; in general , the median star formation rate will be shifted to slightly earlier times .",
    "this also makes no distinction between stellar mass that was formed in the main progenitor versus accreted satellite galaxies . in this sense ,",
    "our depiction here is most closely related to archaeological downsizing .",
    "downsizing is clearly evident here  higher mass galaxies have earlier formation epochs .",
    "galaxies with @xmath200 , which are predominantly quenched today , have median stellar formation times around @xmath201  gyr , or close to @xmath9 .",
    "galaxies with @xmath202 in contrast have formation times of @xmath203  gyr , i.e. @xmath204 .",
    "galaxies around the knee of the mass function today dominate the global stellar mass , and have a median formation time of around 6  gyr , or @xmath5 .",
    "hence our simulations naturally predict that more massive galaxies will host older stellar populations .",
    "the smallest galaxies have a global star formation rate that steadily increases with time all the way to the present day , which is qualitatively different than galaxies that end up around the knee of the gsmf .",
    "such star formation histories in dwarfs are qualitatively what is required to solve the so - called dwarf galaxy conundrum , in which current models generically predict dwarf galaxy star formation histories that peak at too early epochs  @xcite .",
    "we will examine this so - called dwarf galaxy conundrum using mufasa  in more detail in future work .      a complementary view of galaxy growth is provided by the evolution of the cosmic stellar mass density . in principle",
    ", this should be equivalent to an integral of the lilly - madau plot , accounting for stellar evolution .",
    "some discrepancies between these two approaches have been claimed in the past  ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) , but these have been contradicted by more recent data  @xcite ; the issue remains unsettled .",
    "figure  [ fig : rhostar ] shows the evolution of the cosmic stellar mass density in our three simulations ; solid , dashed , and dotted lines correspond to our @xmath205 , and @xmath7 runs respectively .",
    "we also show the breakdown in three ranges of stellar mass , the dwarf ( @xmath206 ) , @xmath164 ( @xmath207 ) , and massive ( @xmath208 ) galaxy regimes , colour - coded as indicated in the legend . finally , the cyan points show some recent ( post-2010 ) data from the compilation of observations by @xcite , namely @xcite at low redshifts , @xcite , @xcite , and @xcite out to @xmath141 , and @xcite , @xcite , and @xcite to higher redshifts .",
    "the total stellar mass density evolution is generally in good agreement with observations . at @xmath209",
    "the @xmath12 box falls slightly below the data , potentially owing to observed galaxies extending to masses below the resolution limit of this simulation .",
    "the discrepancy is never more than 30% , nonetheless it is interesting that this contrasts with the predictions for the lilly - madau plot , which show an _ overprediction _ of the observed sfrd at these redshifts .",
    "this hints at some mismatch between the observed global growth of stars versus the observed global star formation rates . at high redshifts",
    "the agreement is very good , although the data shows more scatter there .",
    "breaking @xmath210 down by mass , at early epochs the total mass density is dominated by relatively small galaxies , since larger galaxies have not yet formed . by @xmath211 ,",
    "galaxies above @xmath212 begin to dominate the mass density , which continues all the way until the present day .",
    "larger galaxies do not dominate at early times since few have formed , and do not dominate at late times since their growth is suppressed by quenching .",
    "examining the various box sizes by comparing lines of the same colour , we see that there is generally good convergence even when broken down by mass , though there are variations of up to about 50% .",
    "overall , mufasa  simulations do a good job of reproducing the cosmic stellar mass density evolution , and the variations between the different resolution boxes is not large . together",
    "with the good match to the lilly - madau plot , this demonstrates that mufasaprovides a viable suite of models with which to examine global stellar mass growth .",
    "-0.2 in -0.1 in    -0.1 in    a key test of how galaxies grow is the evolution of the star formation rate ",
    "stellar mass relation , often called the star - forming galaxy  main sequence \"  @xcite . now measured out to @xmath213 and beyond",
    ", its evolution has proved to be challenging for models to reproduce particularly during cosmic noon ( @xmath214 ) , with both sams and simulations typically predicting specific star formation rates ( ssfrs ) at @xmath9 that are too low by @xmath215  @xcite .",
    "many of these same models , however , also tend to overpredict the gsmf during cosmic noon by roughly the same factor , so it has been conjectured that a model that matches the gsmf at @xmath194 ( and keeps the sfrs the same ) would also match the main sequence . since the mufasa  simulations provide a reasonable fit to the gsmf at @xmath216 , it is interesting to examine whether they likewise matches the main sequence at these epochs .",
    "figure  [ fig : ssfr ] shows ssfr vs. @xmath54 at @xmath217 in our fiducial @xmath12 mufasa  simulation . along the bottom are depicted galaxies with very low ( typically zero ) ssfr , with some artificial spread to enhance visibility .",
    "the red solid line shows the running median ssfr as a function of @xmath54 , for star - forming galaxies defined as those above the cyan dashed line lying just above the quenched galaxies .",
    "the stars indicate a binned median for all galaxies , including the quenched ones .",
    "observations are shown in black : at @xmath2 , we show a schechter - form fit from ( * ? ? ? *",
    "solid black ) based data from the sloan digital sky survey ( sdss ) and the galaxy evolution explorer ( galex ) , as well as h@xmath218-based star formation rate determinations from the galaxy mass and assembly ( gama ) survey by ( * ? ?",
    "* gray points ) .",
    "we also show a fit to the recent sdss+wide infrared survey explorer ( wise ) determination by ( * ? ? ?",
    "* dashed black ) . at @xmath219",
    "we show data from 3d - hst with _ spitzer _",
    "24@xmath40 m information by @xcite , and at @xmath175 from candels by @xcite .",
    "finally , for comparison we show results from the illustris ( orange dashed ) and eagle ( dark red dashed ) simulations .    at @xmath2 ,",
    "mufasa  star - forming galaxies show a flat low - mass end and a turn - down at @xmath220 as the general population starts to be quenched ( but is still regarded as star - forming by our cut ) .",
    "the predictions are in very good agreement with recent h@xmath218-based sfr s from gama ( * ? ? ? * grey circles ) , and in reasonable agreement with the sdss+galex data from @xcite , however , they are higher than the ssfr s inferred from full @xmath221 m sed fitting including wise data @xcite .",
    "it is beyond the scope of this paper to assess the various differences in observations , but we note that even the present - day sfrs are somewhat controversial .    for comparison ,",
    "we show results from illustris ( orange ; @xmath2 ) and eagle ( dark red ; @xmath222 ) simulations , which like mufasa  show a flat ssfr(@xmath54 ) at low masses  ( see also * ? ? ?",
    "* ) , but with an amplitude that is lower by @xmath223 .",
    "these are generally in better agreement with the @xcite data .",
    "hence even simulations that nicely match the gsmf such as mufasa  and eagle can have substantially different @xmath2 ssfr values for star - forming galaxies . as mentioned earlier ,",
    "the global sfrd in these other simulations tend to be lower than that in mufasa , and from the ssfr@xmath224 comparison this is likewise seen to be the case for individual galaxies with @xmath225 .",
    "there are also a handful of massive mufasa  galaxies that are still star - forming as well , which contribute non - trivially to the global sfrd",
    ". we will examine the massive galaxy population and its colours in an upcoming paper .",
    "the stars show the binned median values from mufasa  now including the quenched galaxies .",
    "such galaxies dominate by number at low and high masses  the median values ( stars ) at @xmath226 and @xmath160 are actually in the quenched population . at low masses these",
    "are typically stripped satellites , while at high masses they are quenched centrals .",
    "observations generally do not suggest quite such a dominant population of low - mass quenched satellites , but such satellites are also difficult to observe , so selection effects may be important .",
    "we leave a more thorough investigation of central vs. satellite populations for future work .    moving to @xmath149 , the mufasa  predictions clearly lie below the data , typically by a factor of up to 2 relative to the @xcite data across the resolved mass range .",
    "illustris and eagle are comparable .",
    "indeed , such a discrepancy is generically seen among models of all types  @xcite .",
    "the number of quenched galaxies is markedly less , so that the medians are now generally within the star - forming population .    at @xmath8 ,",
    "the agreement gets even worse  the deficit of mufasaversus the @xcite data is now @xmath227 across most of the mass range .",
    "this is comparable to or even lower than the predictions from illustris  @xcite and eagle  @xcite .",
    "there are very few quenched galaxies by this epoch , so one can not easily appeal to burstiness to explain the discrepancy  besides the fact that the observed tight main sequence scatter limits the contribution of starbursts  @xcite .",
    "this discrepancy at @xmath9 remains a major puzzle , and it starkly contrast with the fact that mufasa  nicely reproduces the evolution of the gsmf around this redshift range .",
    "if the universe is producing stars at a rate @xmath228 times higher than mufasa  at @xmath9 , and the gsmf agrees at @xmath9 , then where do all those stars end up ?",
    "they do nt appear to produce an excess in the observed gsmf relative to mufasa  at @xmath5 ; if anything , mufasa  lies slightly _ above _ the observed gsmf at @xmath149 .",
    "hence it seems that the rate of stellar growth as tracked by the gsmf is not straightforward to reconcile with that measured directly via star formation rates .",
    "it could be that the observed star formation rates are simply too high owing to calibration issues , but the uncertainties in uv+24@xmath40 m star formation rates are generally thought to be significantly smaller than the discrepancy . as the conjecture in @xcite states , any problem in galaxy formation can be resolved with a suitable choice of imf , and in this case a top - heavy or bottom - light imf remains a viable if unpopular solution  @xcite .",
    "the discrepancy could also be solved by raising @xmath54 values at @xmath9 by @xmath229 via some unforeseen systematic errors .",
    "given that current gsmf data at this epoch is now based on deep near - ir data that probes well beyond the 4000  break , it would be quite surprising if the stellar mass estimates were so far off ; current methods for estimating @xmath54 typically do not differ systematically by such large amounts  @xcite .",
    "furthermore , this would shift the gsmf to quite high values , and would result in their being more massive galaxies at @xmath8 than today .",
    "hence this solution seems untenable .",
    "finally , at @xmath175 the dynamic range spanned by observations is relatively small , but the disagreements versus the data are clearly less , particularly for larger star - forming galaxies .",
    "mufasa  shows little trend with mass at this redshift , and perhaps even has a positive slope at @xmath230 .",
    "the @xcite data plotted shows a rise towards the lowest masses that at face value is divergent from the model predictions , but incompleteness in identifying low - sfr galaxies via lyman break selection at these redshifts may mitigate this disagreement .",
    "the discrepancy in ssfr(@xmath54 ) versus models thus seems to be primarily restricted to cosmic noon ( @xmath194 ) , as has long been noted  ( e.g. * ? ? ?",
    "* ) .    in summary ,",
    "mufasa  shows similar trends to previous models in matching observations at low and high redshifts , but falling low throughout cosmic noon . at @xmath2",
    "there are substantial differences versus recent simulations at the low - mass end , with mufasa  showing higher levels of present - day star formation in star - forming dwarfs , although quenched dwarfs dominate by number . at intermediate redshifts ,",
    "mufasa  mimics the shape if not amplitude of ssfr(@xmath54 ) , with a positive ssfr(@xmath54 ) slope at low masses and a negative one at high masses .",
    "the high observed ssfr values across all masses at @xmath194 remain a persistent quandary for modern galaxy formation models , even ones that match the observed gsmf evolution through that epoch .",
    "a major advantage of gizmo  is that it has the ability to trivially switch between four hydrodynamic solvers while holding all other input physics fixed .",
    "hence it provides an ideal platform for testing the sensitivity of results such as the gsmf to hydrodynamic methodology . to contextualise the differences resulting from numerical methodology",
    ", we explore how key input physics choices change the gsmf .",
    "gizmo  contains four hydrodynamics solvers : mfm , which is our fiducial choice ; meshless finite volume ( mfv ) , which is a mass - advecting moving mesh - like scheme ; pressure - sph  ( p - sph ; * ? ? ?",
    "* ) , which is a pressure - energy formulation of sph that improves surface instability handling ; and traditional sph ( t - sph ) , which is a density - energy formulation of sph .",
    "these are described in more detail in ( * ? ? ?",
    "* appendix f ) .",
    "we note that t - sph employs some new features in gizmo relative to older sph codes , such as an improved artificial viscosity and artificial conduction ; see @xcite for details .",
    "since mfv does not strictly conserve mass within fluid elements ( though it does so approximately ) , it is not obvious how reliably it will function with the kinetic outflows , stellar mass loss , etc .",
    ", hence we will not consider this scheme here .",
    "instead , we will focus on comparing the mass - conserving schemes mfm , p - sph , and t - sph .",
    "figure  [ fig : mfhydro ] shows the gsmf at @xmath2 ( left ) and @xmath8 ( right ) in runs with mfm , p - sph , and t - sph .",
    "these runs have a box size of @xmath6 and @xmath137 particles , but in every other way are identical to our fiducial @xmath12 mufasa  run , excepting the hydro solver which is only identical for the mfm case .",
    "observations are shown as described in figure  [ fig : mfres ] for reference , although the focus here is on comparing among the hydro solvers rather than comparing to data .",
    "error bars are again computed as cosmic variance over eight sub - octants within each simulation volume ( only shown for the mfm case ; the others are similar but omitted for clarity ) , and they are larger than in the full @xmath12 mufasarun owing to the smaller volume .",
    "we first note that the @xmath6 mfm run produces a gsmf that is statistically identical to the @xmath12 run .",
    "this is not surprising , as they have identical numerical resolution and input physics , but it is reassuring that these simulations display good gsmf convergence with volume , even though there are many fewer galaxies in the smaller volume .    comparing amongst the various hydro solvers , at early epochs ( @xmath8 ) the gsmfs are very similar . in other words",
    ", kinetic outflows are suppressing early galaxy formation in a manner that is essentially independent of the hydro solver .",
    "indeed , the differences at @xmath231 ( not shown ) are even smaller .    by @xmath2 , the three hydro solvers diverge non - trivially in their predictions .",
    "as discussed in @xcite , the contribution from wind recycling ( i.e. the re - accretion of previously ejected material ) to stellar mass growth starts to be significant at @xmath232 , and becomes dominant by @xmath2 .",
    "our preliminarily interpretation is thus that the differences between hydro solvers owe primarily to differences in the way that galactic outflows interact with the surrounding medium and rejoin the accretion flow .",
    "this is consistent with the idea that the main improvement in mfm over sph is handling two - phase instabilities and shocks , which are important mechanisms for how winds interact with circum - galactic gas .",
    "t - sph tends to produce about @xmath233 more galaxies at any given @xmath54 compared to p - sph .",
    "meanwhile , both sph codes produce a steeper gsmf than mfm . in @xcite",
    ", it was noted that the flattening of the gsmf in the sub-@xmath164 regime is achieved in simulations by wind recycling .",
    "if this is likewise the case in these simulations ( as we expect ) , then we can infer that winds recycle more effectively in mfm than in sph .",
    "the detailed reasons for these variations are not entirely obvious .",
    "our preliminary interpretation for difference between p - sph and t - sph is as follows . in flows with large variations of internal energy @xmath234 from particle - to - particle , p - sph , because it kernel - averages the pressure over all neighbors @xmath234 as opposed to just using the particle s @xmath234 times density , a single very high-@xmath234 particle can raise the pressure of all its neighbors .",
    "this means that all of them together can do more pdv work than a single hot particle could .",
    "while this is done in an energy - conserving way , it can effectively enhance the ability of lone , hot particles to add substantial pressure . in our case , the thermal heating of the winds results in such lone hot particles , which then increases the pressure in cgm gas upon recoupling , moreso in p - sph than t - sph .",
    "this can then expand the cgm gas and lower the amount of wind re - accretion , which results in a lower gsmf for p - sph .",
    "while we have not confirmed this effect in detail , we believe this is a plausible interpretation for the origin of the discrepancy between p - sph and t - sph .",
    "meanwhile , mfm generally increases the amount of mixing , which increases the amount of recycling relative sph , and hence flattens the gsmf .",
    "this highlights a key point that , although we have left all the feedback physics and numerical parameters fixed in the code between the three methods , there are inherent differences between the methods that can interact with feedback in ways that depend on methodology . for instance , @xcite points out that the effective resolution in discontinuities and shocks is higher in mfm versus sph owing to less smoothing , which could play a role in more accurately modeling the hot wind interactions .",
    "we also note that the details of sph scheme can matter , and differences can arise when injecting energy using sph owing to the manner in which energy or entropy is smoothed among neighbors  @xcite . the sensitivity to methodology presented here therefore",
    "should be regarded as specific to both the hydro scheme and the feedback implementation , and not a generic result .",
    "nonetheless , it gives some idea as to the level of variations that can occur among modern methods .",
    "it is of course not immediately evident which hydro solver yields a more correct answer .",
    "nonetheless , in idealised test cases , mfm handles discontinuities and shear flows in a more realistic manner than sph  @xcite , which is consistent with results in more realistic circumstances  @xcite .",
    "we expect that issues of hydrodynamics will be more important in massive galaxies that contain hot gaseous halos , where two - phase discontinuities are stronger ; hence our @xmath6 volume is perhaps not ideal for these tests . for",
    "now , we preliminarily conclude that there are differences of up to @xmath10 for @xmath209 gsmf predictions based purely on which hydrodynamics solver is used , while at higher @xmath91 the predictions are less sensitive to this .",
    "mufasa  includes new implementations of feedback prescriptions , so it is interesting to investigate how some of these novel aspects impact the predicted gsmfs .",
    "here we examine two aspects , namely two - phase winds and the wind ejection direction , and determine how large of an impact they make on the resulting gsmfs .",
    "figure  [ fig : mfwind ] shows the gsmf at @xmath2 ( left ) and @xmath8 ( right ) in simulations where we turn off two - phase winds and eject all winds cool ( i.e. at @xmath235k ) , shown in navy blue , while the cyan curve shows the result of ejecting winds isotropically rather than outwards in the * v*@xmath51*a * direction .",
    "it is clear that the choice of wind direction has a very minimal impact on the resulting gsmf , though we might expect that it could have signatures in the enrichment of the cgm .",
    "in contrast , turning off the hot wind component has a large impact , somewhat more so at later epochs ; at @xmath144 ( not shown ) the differences are fairly small .",
    "evidently , the hot component of outflows adds significant preventive feedback , thereby suppressing galaxy growth .",
    "number densities are lowered by @xmath236 , with a somewhat greater impact for more massive galaxies .",
    "ejecting some fraction of winds hot is therefore an important aspect of how mufasa  obtains good agreement with the gsmf .    besides indirectly impacting the gsmf , two - phase outflows are also likely to significantly impact the thermal state of the cgm .",
    "hence observations of quasar absorption lines around galaxies such as the cos - halos project  @xcite can in principle provide constraints on outflow temperatures .",
    "previous simulations that ejected winds purely cold tended to underpredict the amount of absorption from ions tracing warmer gas such as  @xcite . in future work",
    "we will examine whether the new two - phase outflow model produces better agreement .    in summary",
    ", the thermal state of the outflows adds an important component of preventive feedback that helps suppress galaxy formation in accord with observations .",
    "the choice of wind direction , in contrast , has minimal impact .",
    "zoom simulations that self - consistently drive outflows via supernova heating can in principle directly predict the temperature distribution of outflowing gas , and we hope that future such efforts will aim to quantify predictions for the thermal state of outflowing gas , in addition to the mass loss rate and velocity .",
    "we note that the differences in the gsmf owing to two - phase winds exceed the differences owing to choice of hydrodynamics methodology discussed in the last section ; this is consistent with previous investigations  ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "we present a new set of cosmological hydrodynamic simulations called mufasa  run using the meshless godunov finite mass hydrodynamics method in the new gizmo code  @xcite .",
    "we include updated recipes for star formation and feedback , including molecular hydrogen based star formation following  @xcite , two - phase kinetic outflows with scalings based on the fire zoom simulations of @xcite , and halo mass based quenching with an evolving quenching mass scale taken from analytic equilibrium model constraints by @xcite .",
    "our feedback prescriptions are still phenomenological , but the parameters are mostly taken from high - resolution simulations or independently - constrained analytic models rather than tuned by directly matching our simulations to observations .",
    "we run simulations with @xmath12 , @xmath6 , and @xmath7 , the large fiducial volume to @xmath2 , and the latter two to @xmath8 to study the high - redshift population in more detail , each having @xmath237 particles and sub - kpc resolution .",
    "we test our models against measures of galaxy growth from @xmath145 , particularly the galaxy stellar mass function , the global evolution of stellar mass density and star formation rate , and the stellar mass  star formation rate relation .",
    "we briefly investigate how much choices of hydrodynamics methodology and outflow modeling impact the predicted gsmf .",
    "our main results are summarised as follows :    * the fiducial @xmath12 mufasa  simulation agrees very well with the observed evolution of the gsmf from @xmath145 , usually matching data to @xmath187 in cosmic variance uncertainty or better , and providing unprecedented agreement to this key barometer for galaxy formation models .",
    "the resolution convergence between the three volumes at @xmath238 is reasonable good , with a systematic increase of @xmath239 in galaxy number density over a factor of 64 in mass resolution . *",
    "compared to recent hydrodynamic simulations illustris , eagle , and massiveblack - ii , mufasa  reproduces the observed gsmf about equally well or better at any given redshift .",
    "particularly , it has been challenging for models to match the gsmf at @xmath194 , which mufasa  does quite well .",
    "this suggests that the cosmic growth rate of stellar mass in galaxies can now be viably modeled by cosmological hydrodynamic simulations . *",
    "the cosmic star formation rate density evolution is in general agreement with observations , albeit too low during cosmic noon and too high at @xmath193 .",
    "the cosmic stellar mass density growth shows a strong trend of archaeological downsizing across the full range of @xmath240 , namely that more massive galaxies contain stars that on average formed earlier .",
    "the most massive galaxies have a median stellar age of @xmath241  gyr ( @xmath9 ) , while small dwarfs show a more protracted , constant or increasing star formation history with a median stellar age of @xmath242  gyr ( @xmath204 ) . * the predicted star formation rate  stellar mass relation ( main sequence ) is in general agreement with recent h@xmath218 and uv - based sfr data at @xmath243 .",
    "but as with previous models , mufasahas difficulty matching observations at @xmath194 , falling short in specific star formation rates at @xmath8 by @xmath229 .",
    "it remains a perplexing mystery how the overall gsmf evolution can be so well reproduced , while a direct measure of growth rates in individual galaxies suggests a significant discrepancy through the peak epoch of galaxy growth .",
    "* comparing gsmfs between identical runs using mfm , p - sph , and t - sph shows that hydrodynamics methodology plays a small but non - negligible role in determining the gsmf .",
    "it is increasingly influential at late times and in more massive galaxies , presumably because this is where the interactions between outflows and accreting gas become more important for galaxy growth .",
    "nonetheless , such variations are sub - dominant compared to variations in the gsmf owing to choices in feedback . for instance , our two - phase winds including a 30% supernova - heated component adds substantial preventive feedback that suppresses the gsmf by @xmath236 by today .",
    "the mufasa  simulations represent a continued shift in the approach towards incorporating subgrid physics into cosmological - scale simulations of galaxy formation .",
    "mufasa  relies increasingly on the results from very high - resolution zoom simulations and well - constrained analytic models to constrain subgrid prescriptions , rather than simple but highly tuned parameterizations . in this way it takes advantage of the true multi - scale nature of simulations today , marrying models spanning far greater dynamic range than can be represented in any single simulation .",
    "mufasa s success at reproducing key galaxy observables over most of cosmic time demonstrates that this is a fruitful approach .    despite being substantially less",
    "fine - tuned than many previous galaxy formation simulations , we still have free parameters in our outflow modeling that could be more tightly constrained from external models , such as the outflow velocity and thermal state . furthermore ,",
    "our current prescription for quenching massive galaxies remains purely heuristic , so must be transitioned to a more physically - based model that includes the self - consistent growth of and energy release from central black holes . as our ability to model the physics driving feedback owing to star formation and active galactic nuclei grows , the goal is to replace ad hoc subgrid prescriptions with direct characterisations from more physically - based models .",
    "the mufasa  simulations presented here offer an important step in this direction , while providing a state - of - the - art platform to investigate the physical processes driving galaxy evolution across a wide range of mass scales and cosmic epochs .",
    "the authors thank d. angls - alczar , f. durier , s. huang , n. katz , t. naab , b. oppenheimer , m. rafieferantsoa , and j. schaye for helpful conversations .",
    "the authors thank paul torrey for providing us with the illustris data , rob crain and joop schaye for the eagle data , and ananth tenneti and tiziani dimatteo for the massiveblack - ii data .",
    "rd and rjt acknowledge support from the south african research chairs initiative and the south african national research foundation .",
    "support for rd was also provided by nasa atp grant nnx12ah86 g to the university of arizona . supported for rjt",
    "was provided in part by the gordon and betty moore foundation s data - driven discovery initiative through grant gbmf4561 to matthew turk , and by the national science foundation under grant # aci-1535651 .",
    "support for pfh was provided by an alfred p. sloan research fellowship , nasa atp grant nnx14ah35 g , and nsf collaborative research grant # 1411920 and career grant # 1455342 .",
    "the simulations were run on the pumbaa astrophysics computing cluster hosted at the university of the western cape , which was generously funded by uwc s office of the deputy vice chancellor .",
    "these mufasa  simulations were run with revision e77f814 of gizmo hosted at https://bitbucket.org/rthompson/gizmo .    1 agertz , o. et al .",
    "2007 , mnras , 380 , 963 angls - alczar , d. , zel , f. , dav , r. , katz , n. , kollmeier , j. a. , oppenheimer , b. d. 2015 , 800 , 127 angls - alczar , d. , dav , r. , faucher - giguere , c.a . , zel , f. , hopkins , p.f .",
    "2016 , mnras , submitted , arxiv:1603.08007 asplund , m. , grevesse , n. , sauval , a. j. , scott , p. 2009",
    ", ara&a , 47 , 481 baldry , i. k. et al .",
    "2012 , mnras , 421 , 621 bastian , n. , covey , k. r. , meyer , m. r. 2010 , ara&a , 48 , 339 bauer , a.e . ,",
    "hopkins , a.m. , gunawardhana , m. et al .",
    "2013 , mnras , 434 , 209 behroozi , p. s. , wechsler , r. h. , conroy , c. 2013 , apj , 770 , 57 bell , e. f. , mcintosh , d. h. , katz , n. , weinberg , m. d. 2003 , apjs , 149 , 289 bruzual , g. , charlot , s. 2003 , mnras , 344 , 1000 caputi , k. i. , cirasuolo , m. , dunlop , j. s. , mclure , r. j. , farrah , d. , almaini , o. 2011 , mnras , 413 , 162 chabrier g. , 2003 , pasp , 115 , 763 chang , y .- y .",
    ", van der wel , a. , da cunha , e. , rix , h .- w .",
    "2015 , apjs , 219 , 8 christensen , c. dav , r. , governato , f. , pontzen , a. , brooks , a. , munshi , f. , quinn , t. , wadsley , j. 2015 , mnras , submitted , arxiv:1508.00007 conroy , c. , van dokkum , p.g . ,",
    "kravtsov , a. 2015 , apj 803 , 77 cowie , l. l. , songaila , a. , hu , e. m. , cohen , j. g. 1996 , aj , 112 , 839 crain , r. a. 2015 , mnras , 450 , 1937 croton , d.  j. , et al . 2006 , mnras , 365 , 11 cullen , l. , dehnen , w. 2010 , mnras , 408 , 669 daddi , e. , et al .",
    "2007 , apj , 670 , 156 dav , r. 2008 , mnras , 385 , 147 dav , r. , oppenheimer , b. d. , finlator , k. m. 2011 , mnras , 415 , 11 dav , r. , finlator , k. m. , oppenheimer , b. d. 2011 , mnras , 416 , 1354 dav , r. , katz , n. , oppenheimer , b. d. , kollmeier , j. a. , weinberg , d. h. 2013 , mnras , 434 , 2645 dehnen , w. , aly , h. 2012 , mnras , 425 , 1068 dekel , a. & silk , j. 1986 , apj , 303 , 39 duncan , k. 2014 , mnras , 444 , 2960 durier , f. , dalla vecchia , c. 2012 , mnras , 419 , 465 the enzo collaboration , bryan , g. l. , norman , m. l. , et al .",
    "2014 , apjs , 211 , 19 duffy , a.r .",
    ", schaye , j. , kay , s.t . , dalla vecchia , c. 2008 , mnras , 390 , l64 faucher - giguere , c. a. , lidz , a. , zaldarriaga , m. , hernquist , l. 2009 , apj , 703 , 1416 faucher - giguere , c. a. , kere , d. , dijkstra , m. , hernquist , l. , zaldarriaga , m. 2010 , apj , 725 , 633 ferland , g. j. 2004 , bull . of the aas , 36 , 1574 ford , a.b . ,",
    "werk , j.k . ,",
    "dav , r. et al .",
    "2016 , mnras , accepted , arxiv:1503.02084 gabor , j. m. , dav , r. 2010 , mnras , 407 , 749 gabor , j. m. , dav , r. , oppenheimer , b. d. , finlator , k. m. 2011 , mnras , 417 , 2676 gabor , j. m. & dav , r. 2012 , mnras , 427 , 1816 gabor , j. m. & dav , r. 2015 , mnras , 447 , 374 genel , s. et al .",
    "2014 , mnras , 445 , 175 gonzlez , v. , labb , i. , bouwens , r.j . ,",
    "et al . 2011 , apjl , 735 , l34 governato , f. , willman , b. , mayer , l. 2007 , mnras , 374 , 1479 grazian , a. et al .",
    "2015 , a&a , 575 , 96 grogin , n. a. et al .",
    "2011 , apjs , 197 , 35 haardt , f. , madau , p. 2012",
    ", apj , 746 , 125 hahn , o. , abel , t. 2011 , mnras , 415 , 2101 henriques , b. m. b. , white , s. d. m. , thomas , p. a. , angulo , r. , guo , q. , lemson , g. , springel , v. , overzier , r. 2015 , mnras , 451 , 2633 hernquist , l. & katz , n. 1989 , apjs , 70 , 419 hopkins , p.f .",
    "2013 , mnras , 428 , 2840 hopkins , p.f . , kere , d. , oorbe , j. , faucher - giguere , c. a.,quataert , e. , murray , n. , bullock , j. s. 2014 , mnras , 445 , 581 hopkins , p.f .",
    "2015 , mnras , 450 , 53 hopkins , p.f . ,",
    "raives , m.j .",
    "2015 , arxiv:1505.02783 ilbert , o. et al .",
    "2013 , a&a , 556 , 55 iwamoto , k. , brachwitz , f. , nomoto , k. , kishimoto , n. , umeda , h. , hix , w. r. , thielemann , f .- k .",
    "1999 , apjs , 125 , 439 kennicutt , r. c. 1998 , apj , 498 , 541 kere , d. , katz , n. , weinberg , d. h. , & dav , r. 2005 , mnras , 363 , 2 khandai , n. , di matteo , t. , croft , r. , wilkins , s. , feng , y. , tucker , e. , degraf , c. , liu , m .- s .",
    "2015 , mnras , 450 , 1349 kim , j .- h . , abel , t. , agertz , o. , et al .",
    "2014 , apjs , 210 , 14 koekemoer , a. m. et al .",
    "2011 , apjs , 197 , 36 kollmeier , j. a. et al .",
    "2014 , apj , 789 , l32 kravtsov , a. , vikhlinin , a. , meshscheryakov , a. 2014 , apj , submitted , arxiv:1401.7329 kriek , m. , van dokkum , p. g. , franx , m. , illingworth , g. d. , magee , d. k. 2009 , apj , 705 , 71 krumholz , m. r. , mckee , c. f. , tumlinson , j. t. 2008 , apj , 693 , 216 krumholz , m. r. , mckee , c. f. , tumlinson , j. t. 2011 , apj , 729 , 36 okas , e.l . ,",
    "mamon , g.a .",
    "2001 , mnras , 321 , 155 lee , k .- s .",
    "2012 , apj , 752 , 66 li , c. , white , s.d.m .",
    "2009 , mnras , 398 , 2177 liang , l. , durier , f. , babul , a. , dav , r. , oppenheimer , b. d. , katz , n. , fardal , m. , quinn , t. 2016 , mnras , 456 , 4266 madau , p. , dickinson , m. 2014 , ara&a , 52 , 415 martin , c. l. 2005 , apj , 621 , 227 mcalpine , s. , helly , j.c . , schaller , m. et al .",
    "2015 , arxiv:1510.01320 mcgaugh , s.s .",
    "2012 , aj , 143 , 40 mitra , s. , dav , r. , finlator , k. 2015 , mnras , 452 , 1184 mo , h.j . ,",
    "mao , s. , white , s.d.m .",
    "1998 , mnras , 295 , 319 mobasher , b. 2015 , apj , 808 , 101 monaghan , j. j. 1992 , ara&a , 30 , 543 moustakas , j. et al .",
    "2013 , apj , 767 , 50 muratov , a.l .",
    ", kere , d. , faucher - giguere , c. a. , hopkins , p. f. , quataert , e. , murray , n. 2015 , mnras , submitted , arxiv:1501.03155 muzzin , a. et al .",
    "2013 , apj , 777 , 18 navarro , j. , frenk , c.s . , white , s.d.m .",
    "1997 , apj , 490 , 493 neistein , e. , van den bosch , f. c. , dekel , a. 2006 , mnras , 372 , 933 noeske , k. g. , et al . 2007a , apjl , 660 , l43 nomoto , k. , tominaga , n. , umeda , h. , kobayashi , c. , maeda , k. 2006 , nupha , 777 , 424 oppenheimer , b. d. & dav , r. 2006 , mnras , 373 , 1265 oppenheimer , b. d. & dav , r. 2008 , mnras , 387 , 577 oppenheimer , b.d . ,",
    "dav , r. , kere , d. , katz , n. , kollmeier , j.a . ,",
    "weinberg , d.h .",
    "2010 , mnras , 406 , 2325 planck collaboration , ade , p. a. r. , aghanim , n. , et al .",
    "2015 , arxiv:1502.01589 popping , a. , dav , r. , braun , r. , oppenheimer , b. d. 2009 , a&a , 504 , 15 rahmati , a. , pawlik , a. h. , raievi , m. , schaye , j. read , j. i. , hayfield , t. 2012 , mnras , 422 , 3037 reddy n.a . ,",
    "steidel , c.c .",
    "2009 , apj , 692 , 778 reddy n.a . ,",
    "et al . 2012 .",
    "apj 744 , 154 rodighiero , g. , daddi , e. , baronchelli , i. 2011 , apj , 739 , l40 salim , s. et al .",
    "2007 , apjs , 207 , 173 , 267 salmon , b. , papovich , c. , finkelstein , s.l .",
    "2015 , apj , 799 , 183 scannapieco , e. & bildsten , l. 2005 apj , 629 , l85 schaller , m. , dalla vecchia , c. , schaye , j. , bower , r. g. , theuns , t. , crain , r. a. , furlong , m. , mccarthy , i. g. 2015 , mnras , 454 , 2277 schaye , j. , carswell , r.f .",
    ", kim , t .- s .",
    "2007 , mnras , 379 , 1169 schaye , j. & dalla vecchia , c. 2008 , mnras , 383 , 1210 schaye , j. , dalla vecchia , c. , booth , c.m .",
    "2010 , mnras , 402 , 1536 schaye , j. et al .",
    "2015 , mnras , 446 , 521 schmidt , m.  1959 , apj , 129 , 243 sijacki , d. springel , v. , di matteo , t. , hernquist , l. 2007 , mnras , 380 , 877 somerville , r. s. , hopkins , p. f. , cox , t. j. , robertson , b. e. , hernquist , l. 2008 , mnras , 391 , 481 somerville , r. s. , dav , r. 2015 , ara&a , 53 , 51 song , m. et al .",
    "2015 , apj , 791 , 3 sparre , m. et al .",
    "2015 , mnras , 447 , 3548 speagle , j. s. , steinhardt , c. l. , capak , p. l. , silverman , j. d. 2014 , apjs , 214 , 15 springel , v. & hernquist , l. 2002 , mnras , 333 , 649 springel , v. & hernquist , l. 2003 , mnras , 339 , 289 springel , v. & hernquist , l. 2003 , mnras , 339 , 312 springel , v. 2005 , mnras , 364 , 1105 springel , v. 2010 , mnras , 401 , 791 stark , d. p. , schenker , m. a. , ellis , r. , robertson , b. , mclure , r. , dunlop , j. 2013 , apj , 763 , 129 steidel , c. c. et al .",
    "2010 , apj , 717 , 298 stinson , g. s. , brook , c. , maccio , a. v. , wadsley , j. , quinn , t. r. , couchman , h. m. p. 2013",
    ", mnras , 428 , 129 sullivan , m. et al . 20016 , apj , 648 , 868 thomas , d. , maraston , c. , bender , r. , mendes de oliveira , c. 2005 , apj , 621 , 673 thompson , r. , nagamine , k. , jaacks , j. , choi , j .- h .",
    "2014 , apj , 780 , 145 thompson , r. 2015 , ascl , 1502 , 12 thompson , r. , dav , r. , huang , s. , katz , n. , mnras , submitted , arxiv:1508.01851 tomczak , a. r. 2014 , apj , 783 , 85 tumlinson , j. , thom , c. , werk , j.k .",
    "2013 , apj , 777 , 59 vogelsberger , m. , genel , s. , springel , v. , torrey , p. , sijacki , d. , xu , d. , snyder , g. , nelson , d. , hernquist , l. 2014 , mnras , 444 , 1518 voit , g.m . 2005 , adspr , 36 , 701 voit , g. m. , donahue , m. , bryan , g. l. , mcdonald , m. 2015 , nature , 519 , 203 voit , g. m. , donahue , m. 2015 , apjl , 799 , l1 wetzel , a. r. , hopkins , p. f. , kim , j .- h . , faucher - giguere , c .- a . , keres , d. , quataert , e. 2016 , apjl , submitted , arxiv:1602.05957 white , c. e. , somerville , r. s. , ferguson , h. c. 2015 , apj , 799 , 201 whitaker , k.e .",
    "2014 , apj , 795 , 104 wilkins , s. m. , trentham , n. , hopkins , a. m. 2008 , mnras , 385 , 687 wilkinson , a. , almaini , o. , chen , c .- c .",
    "2016 , mnras , submitted , arxiv:1604.00018"
  ],
  "abstract_text": [
    "<S> we present the mufasa  suite of cosmological hydrodynamic simulations , which employs the gizmo meshless finite mass ( mfm ) code including @xmath0-based star formation , nine - element chemical evolution , two - phase kinetic outflows following scalings from the feedback in realistic environments zoom simulations , and evolving halo mass - based quenching . our fiducial @xmath1 volume is evolved to @xmath2 with a quarter billion elements . </S>",
    "<S> the predicted galaxy stellar mass functions ( gsmf ) reproduces observations from @xmath3 to @xmath4 in cosmic variance , providing an unprecedented match to this key diagnostic . </S>",
    "<S> the cosmic star formation history and stellar mass growth show general agreement with data , with a strong archaeological downsizing trend such that dwarf galaxies form the majority of their stars after @xmath5 . </S>",
    "<S> we run @xmath6 and @xmath7 volumes to @xmath8 with identical feedback prescriptions , the latter resolving all hydrogen - cooling halos , and the three runs display fair resolution convergence . </S>",
    "<S> the specific star formation rates broadly agree with data at @xmath2 , but are underpredicted at @xmath9 by a factor of three , re - emphasizing a longstanding puzzle in galaxy evolution models . </S>",
    "<S> we compare runs using mfm and two flavours of smoothed particle hydrodynamics , and show that the gsmf is sensitive to hydrodynamics methodology at the @xmath10 level , which is sub - dominant to choices for parameterising feedback .    </S>",
    "<S> galaxies : formation , galaxies : evolution , methods : n - body simulations , galaxies : mass function </S>"
  ]
}