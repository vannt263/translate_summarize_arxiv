{
  "article_text": [
    "financial markets are complex systems where many heterogeneous agents interact .",
    "most financial markets are continuous double auction markets where market members are allowed to trade by submitting limit and market orders .",
    "when a limit order is submitted , an order indicating the willingness to buy ( or sell ) a given volume of a financial asset at a given price is placed inside the order book .",
    "the order book is essentially a list of unexecuted orders waiting for a matching order .",
    "market members can also send market orders which result in immediate transactions at the best available price .",
    "market members channel all orders to be processed in the market .",
    "they may act on behalf of a third party or on their own interest .",
    "market members are heterogeneous with respect to many characteristics .",
    "examples are their size ( in volume transacted ) , their trading time horizons ( ranging from less than a second to months ) and their portfolio of clients ( institutional , individuals , companies , foreign investors , etc ) .    a large body of financial literature has investigated the statistical regularities observed around trades of different classes of investors such as institutional investors @xcite , individual investors @xcite or foreign investors @xcite . in the investigation of the trading profile of institutional investors",
    "it has been recognized the necessity institutional investors have to split large orders into many smaller transactions @xcite . in this paper , as already done in previous studies @xcite , we address these large orders as _ hidden orders _ to emphasize that their true size is typically not public information .",
    "the strategic reasons for incremental execution of hidden orders were originally analyzed by kyle @xcite , who developed a model for an insider trader who has information about future prices .",
    "typically traders of large orders attempt to keep the true size of their orders secret in order to minimize the execution cost of the orders .",
    "consider for example a trader who wishes to buy a large number of shares of a company because she is expecting future price increase .",
    "she of course wishes to buy shares at the lowest price possible . on the other hand ,",
    "as she demands a large amount of shares she will push the price up . by executing her order incrementally she should be able to buy at least part of the order at a price not significantly affected by her action , therefore minimizing her impact on the price dynamics of the stock of interest and lowering her overall execution cost @xcite .",
    "some earlier works have provided empirical evidence of statistical regularities of hidden orders @xcite .",
    "the empirical part of these works usually rely on specialized databases providing information about the coded identity of a set of investors .",
    "information about the class of investors to whom each investor belong to is typically also provided to the researchers .",
    "these specialized databases are often confidential and proprietary and therefore quite difficult to access for research purposes .",
    "more recently another approach to this kind of investigations has been proposed in the econophysics literature . in this approach",
    "the trading dynamics of the most active market members of a large financial market has been investigated to statistically detect the strategic behavior in the execution of large orders @xcite , specialization in the trading strategies @xcite , herding profile @xcite , and price impact of large orders broken up into many small trades @xcite .",
    "these studies have successfully detected heterogeneity of market members with respect to their size , trade horizon and trading profile specialization both at the spanish stock market and at the london stock exchange . in ref .",
    "@xcite large trades broken up into many smaller orders have been statistically reconstructed and their statistical properties characterized whereas in ref .",
    "@xcite the price impact of large orders characterized by a large fraction of market orders was found concave and approximately increasing as the square root of order size .",
    "the statistical reconstruction of hidden orders is not unique .",
    "references @xcite adapted an algorithm @xcite originally designed to investigate biomedical time series to the segmentation of the inventory profile of market members .",
    "this algorithm is quite robust against small local fluctuations which are distinct from the overall global trend .",
    "this choice was motivated by the assumption that , at a given time , a market member could not be considered acting only for a specific client and therefore small deviations from the major trend should be expected at any time and taken into account by the algorithm in the process of segmentation .",
    "a corollary of this assumption is that the detected hidden order refers to the hidden order of the most important client of the investigated market member .    in the present work",
    "we take a different perspective . here",
    "we propose a statistical method for the detection of hidden orders which is more sensitive to the local persistence of the trading profile of market members than the one used in refs @xcite .",
    "we achieve this goal by implementing a segmentation procedure based on hidden markov models ( hmm ) .",
    "hidden markov models @xcite have been introduced in the late 1960s and studied since then .",
    "they are very rich and flexible in their mathematical structure and are used in several fields ranging from speech and image recognition to the detection of biologically relevant nucleotide subsequences .",
    "hidden markov models @xcite have also been used in econometrics and finance .",
    "some examples are in refs @xcite . to the best of our knowledge",
    "this article presents the first application of hmm to the inventory time series of market members in an equity market .    in this paper",
    "we use hmm we also consider one of the most used extension of hmms called hidden semi markov models @xcite . ] to detect large trading orders that are split into pieces and executed incrementally .",
    "this method is used to identify periods of time when the tick by tick inventory variation sign is in the same underlying states according to the fitted model .",
    "we call the detected periods _ patches_. since market members act simultaneously as brokers for many clients , it may be frequent that in a patch not all the transactions have the same sign . in the present study , we are mainly interested in directional patches , i.e. patches where the trader consistently buys or sells a large amount of shares .",
    "our working hypothesis is that each of these patches contains at least one hidden order .",
    "the patches detected are analyzed with respect to their characteristics ( time duration , number of transactions and volume exchanged ) , their liquidity profile ( relative composition of limit and market orders ) and their size compared to the total volume exchanged ( participation rate of the patch transactions with respect to all transactions occurring in the market during the same time interval ) .",
    "the analysis is done separately for buying and selling directional patches . by keeping this two kind of orders",
    "separate we are able to detect that the statistical properties of patches detected by the hmm are showing a buy - sell asymmetry which depends on the state of the market .",
    "we also compare the results obtained with hmm with previous results obtained with the more global segmentation algorithm of ref.s @xcite .",
    "the paper is organized as follows . in section 2",
    "we recall the main properties of hmms .",
    "section 3 discusses the data investigated and the kind of methodology used to detect patches . in section 4",
    "we present the results obtained when extracting the most likely hmm whereas in section 5 we investigate the statistical properties of detected patches .",
    "section 6 discusses the asymmetry observed in buy and sell patches detected in time periods characterized by a different market state and section 7 discusses the comparison of the hmm methodology with the methodology based on a different segmentation algorithm recently used @xcite .",
    "section 8 concludes . in [ appendix ]",
    "we discuss how patches characterized by a length with a power - law distribution are reconstructed by an hmm and we present a comparison of the results obtained by hmm and hidden semi markov models .",
    "the identification of hidden orders is a typical problem of regime switching with hidden states . in regime switching models , the parameters of the model change abruptly from time to time and the time series is organized in consecutive patches ( regimes ) each one characterized by a set of model parameters .",
    "there is a vast amount of literature of regime switching models @xcite and hmms are among the most used ones . even if one considers the time series of the trading activity of a single investor , it is not immediate to identify the set of consecutive transactions that originated from a unique trading decision and the boundary between different regimes .",
    "this problem is even more serious if , as in the analysis presented in this paper , we do not have the inventory variation of an individual investor but rather we have the one of a market member or a broker whose trading activity is generated by many investors . in this last case",
    "the identification of different regimes must be performed with statistical methods , such as the hmm .",
    "an hmm is a generalization of a markov chain in which the states of the chain are not observable .",
    "more specifically , consider a system described by a discrete time series and where the system can be in one of @xmath0 states .",
    "when the system is in a given state , it emits a signal with a given probability distribution of possible observations .",
    "the transition of the system from a state to another is described by a markov chain .",
    "it is often the case that only the observations of the signal are observable while the underlying states are hidden .",
    "such a system is described by an hmm .",
    "more formally , the elements that completely characterize an hmm are the following @xcite :    1 .",
    "@xmath0 , the number of states in the model , @xmath1 .",
    "@xmath2 , the number of distinct observation symbols in each state .",
    "the observations correspond to the output of the signal .",
    "we denote the individual symbols as @xmath3 .",
    "the state transition probability matrix @xmath4 where @xmath5 , \\hskip2 cm 1\\leq i , j \\leq n\\ ] ] where @xmath6 and @xmath7 are the state of the system at time @xmath8 and @xmath9 , respectively .",
    "4 .   the observation symbol probability distribution in state @xmath10 , @xmath11 , called emission probabilities , where + @xmath12 , \\hskip1.3 cm 1\\leq j \\leq n \\hskip1.2 cm     1\\leq k \\leq m \\label{bpar }       \\end{aligned}\\ ] ] 5 .",
    "the initial state distribution @xmath13 where @xmath14 , \\hskip3.2 cm 1\\leq i \\leq n      \\end{aligned}\\ ] ]    the specification of the parameters @xmath0 and @xmath15 and the specification of the three probability measures @xmath16 , @xmath17 and @xmath18 completely define a given hmm ( that we address simply as @xmath19 as in @xcite ) .",
    "given an empirical time series of observed symbols @xmath20 one can ask for the best hmm able to explain it . to this end",
    "one has to compute @xmath21 , the probability of observations time series @xmath22 given a specific hmm @xmath23 .",
    "then one finds the optimal hmm parameters by maximizing this probability .",
    "this maximum likelihood estimation can be done either through an iterative procedure ( baum - welch reestimation procedure ) or by using gradient techniques @xcite .",
    "after having found the best model @xmath23 able to fit the data , one can ask for the  optimal \" sequence of hidden states @xmath24 which best explains the observation sequence @xmath22 given the model @xmath23 . while the solution of the first problem ( i.e. to find the best model @xmath23 ) is unique , for the second problem there are several optimality criteria . for example , one possibility is to ask for the sequence of states @xmath25 which are individually most likely ( this optimality criterion maximizes the expected number of correct individual states ) or one can ask for the state sequence that maximizes the expected number of correct pairs of states or triplets and so on .",
    "one can also ask for the single best state sequence . an algorithm exists to solve this last problem and",
    "it is called the viterbi algorithm @xcite . in the following",
    "we will search for the best sequence of states which are individually most likely .",
    "hmms are parametric models and therefore assume a given structure of the data .",
    "one of the most important structure is the markovian assumption of the transition between states .",
    "as shown in [ appendix ] , in an hmm the distribution of patch length is exponential .",
    "therefore the hmm poses a serious constraint to the shape of the distribution of patch length .",
    "the distribution of real hidden order size is not known but there are indications that it might be characterized by long tails .",
    "recently , by using a non parametric segmentation algorithm , it has been suggested that the tail of the distribution of hidden order size is described by a power law @xcite .",
    "thus it seems that fitting the inventory variation with an hmm might pose an unrealistic structure to the patch size distribution . to verify the nature and degree of the constraints imposed by our methodology to the detection of patches characterized by a long tailed distribution we have performed extensive numerical simulations which are discussed in the [ appendix ] .",
    "as detailed in [ appendix ] the patches detected with the hmm are quite close to the ones obtained with the more computationally intensive method called hidden semi markov model ( hsmm ) which in numerical simulations and in real data is detecting patches distributions having approximately the same distribution as the one detected with hmm .",
    "therefore it seems that the use of the more sophisticated ( and probably more appropriate ) hsmm does not change significantly the conclusions we draw by using the hmm .",
    "given the intense computational work needed to apply the hsmm to the whole dataset and the requirement of long time series for the input sequence of this method , in the present study we have chosen to use hmm .",
    "our database of the electronic market sibe ( sistema de interconexin burstil electrnico ) allows us to follow each on - book transaction performed by all the market members registered at spanish stock exchange ( bme , bolsas y mercados espaoles ) . in 2004",
    "the bme was the eighth in the world in market capitalization .",
    "we consider market members transactions for four highly capitalized stocks , specifically banco bilbao vizcaya argentaria ( bbva ) , repsol ( rep ) , banco santander central hispano ( san ) , and telefnica ( tef ) .",
    "our database covers the time period 2001 - 2006 .",
    "however in most of the following analysis we will restrict our attention to the period 2003 - 2006 .",
    "the reason of this choice is that in 2001 - 2002 we observe a behavior which is markedly different from the one observed in 2003 - 2006 .",
    "since we show results pooled across different years , we restrict our attention to the years 2003 - 2006 which are more homogeneous .",
    "however in section [ 20012002 ] we discuss a buy - sell asymmetry providing a justification of the observation that some results change when we investigate the years 2001 - 2002 .    at bme market members are local and foreign credit entities and investment firms which are members of the stock exchange and are the only firms entitled to trade .",
    "in fact , orders to buy and sell are entered into the market only through members of the stock market . approximately ,",
    "75% of them are major financial institutions and 25% are established security dealers .",
    "both kind of members may trade on their own behalf and/or on behalf of other individuals and institutions which are not members of the market .",
    "it is important to stress that market members are not necessarily quoted companies ( stocks ) but rather are the only institutions entitled to trade stocks directly . in this paper",
    "we consider only the most active market members defined by the criterion that each market member makes at least @xmath26 transactions per year and is active at least @xmath27 days per year in each of the six investigated years .",
    "the number of investigated market members is @xmath28 for bbva , @xmath29 for rep , @xmath30 for san , and @xmath31 for tef .",
    "these market members perform approximately @xmath32 of the on - book transactions and are responsible of approximately @xmath33 of the on - book volume ( see table [ summary ] for the precise values for each investigated stock ) .",
    "we fit an hmm to the time series of the sign of the transactions rather than to the signed volume as in ref.s @xcite .",
    "the reason of this choice is that in this way we can fit an hmm without making any parametric assumption on the transaction volume distribution .",
    "the sign of a transaction is @xmath34 if the investigated member buys and @xmath35 if she sells . in the fit , performed by using a r software package named _",
    "hmm.discnp_ , we set the number of hidden states of hmm equal to @xmath36 having in mind that they could correspond to a buy state , a sell state , and a state without a well defined trading direction .",
    "as we will see below , in most cases the fitted emission probabilities for these states confirm this interpretation .",
    "therefore we fit each time series of the sign of the transactions of a market member with an hmm with @xmath36 and @xmath37 .",
    "since the detected patches are rather short and in order to detect possible slow time dependencies of the model parameters , we decide to fit the hmm and to apply the state reconstruction algorithm to each year separately .",
    "since we can not present the result of all the @xmath38 fitted models , in the following we will show the results obtained for the 4 stocks and 4 years lumped together . as an example of the single asset behavior we also show the result for one specific year and stock , which is tef in 2004 .",
    "we use the expected maximization algorithm to perform the maximum likelihood fit of an hmm to the time series of transaction sign for each market member .",
    "specifically , for each market member trading a stock in a year , we extract the most likely hmm .",
    "since the observed variable is binary ( @xmath39 ) , the emission probabilities are characterized by assigning , for example , the buy probability ( + 1 ) for each hmm state .",
    "we label the three states as states 1 , 2 , and 3 . in the three states the average ( across market members ) buy emission probability is @xmath40 for tef in 2004 , while for the pooled sample it is @xmath41 , where errors are standard deviations .",
    "these values show that state 1 is characterized by a buy probability very close to one , while state 3 is characterized by a buy probability very close to zero .",
    "transaction in state 1 are therefore preferentially buy transactions whereas in state 3 transactions are preferentially sell transactions .",
    "state 2 is characterized by an approximately balanced number of buy and sell transactions .",
    "therefore we call state 1 _ buy state _ and state 3 _ sell state_. these two states are collectively termed _",
    "directional states_. in contrast the buy probability in state 2 is centered at @xmath42 and we call state 2 _ neutral state _ , i.e. a state describing a prolonged activity of the market member without a specified direction to buy or sell . it is worth noting that the standard deviation of the buy probability in state 2 is quite large .",
    "this shows that for some market members the state 2 is associated with a buy probability significantly different from @xmath42 . in other words",
    "these market members lack a proper neutral state .",
    "we do not have an interpretation of this fact .",
    "it is finally worth noting that this effect is more evident in 2001 and 2002 .",
    "we then consider the transition probability matrices @xmath16 of the fitted hmm for each market member trading a stock in one year .",
    "the average ( across market members ) transition probability matrix for tef in 2004 is @xmath43 while for the whole sample of 4 stocks and 4 years is @xmath44 where again errors are standard deviations .",
    "the analysis of the transition probability matrix shows that the diagonal elements , i.e. the conditional probabilities that the market member remains in the same state are quite large , indicating the presence of long periods in which the market member persists in the same state .",
    "moreover the off diagonal elements are on average very similar indicating that when the system is in a given state , it has a high probability to remain in its state but , if it changes state , it has almost equal probability to jump to either one of the other two states . finally the fitted transition probability matrices are quite consistent across the four stocks and the four years .",
    "after the fitting of the hmm to the transaction sign time series , we calculate the most probable hidden state underlying each transaction for all the investigated market members .",
    "we call these intervals of transactions patches of sequential buying or selling and interpret them as proxies of the traded hidden orders . to give an example of this reconstruction , in the top panel of figure  [ 9409 ] we show the cumulative sum of a sequence of @xmath26 transaction signs made by market member interdin bolsa , barcelona ( code @xmath45 ) when trading tef",
    ". the cumulative sum of the transaction sign shows the presence of ramps corresponding to time periods when the market member was preferentially buying or selling .",
    "the identified hmm states in the bottom panel confirm our interpretation of the model states .",
    "transactions of the market member interdin bolsa , barcelona ( code @xmath45 ) when trading tef .",
    "clear trends or ramps are seen .",
    "bottom panel . corresponding most probable state according to the fitted hmm .",
    "state 1 , 2 , and 3 are the buy , neutral , and sell state , respectively . ]",
    "we summarize some statistical properties of the detected hmm patches in table [ summary ] .",
    "we first observe that the number of patches is very large being more than @xmath46 per year and per stock . the unconditional mean length of the directional patches is around @xmath47 transactions , but the standard deviation is significantly larger suggesting a non exponential length distribution . for neutral patches",
    "the mean length is a bit smaller but the standard deviation is again much larger than the mean .",
    "the distributional properties of the length of the patches will be investigated in more detail in section [ statprop ] . around @xmath48 of the patches",
    "are longer than @xmath47 transactions and this subsample will be investigated in depth in the following .",
    "this threshold was also used in ref .",
    "the mean length of these long patches is between 20 and 30 transactions .",
    "the typical number of patches of a market member in a year is @xmath26 .    [ summary ]    our results",
    "are based on the investigation of the time series of the signs of the transactions of each market member . in this way",
    "we discard any information concerning the volume ( in shares or euros ) of the transactions . since volume is an highly fluctuating quantity @xcite , it is important to verify that there is consistency between the interpretation of states 1 and 3 as directional states and the sign of the net volume exchanged in these states .",
    "each patch is characterized by the total volume purchased @xmath49 and the total volume sold @xmath50 .",
    "we also define @xmath51 and we use euro to measure volume .",
    "analogously we also define @xmath52 where @xmath53 is the number of buy transaction and @xmath54 is the number of sell transactions present in the patch .    for each patch",
    "we compute the ratio @xmath55 , and , in order to avoid discretization errors due to small number of transactions , we consider only patches with at least @xmath47 transactions .",
    "the average ratio for these patches is @xmath56 , @xmath57 , and @xmath58 for patches in state buy , neutral , and sell , respectively . in the left panel of figure [ vfrac ]",
    "we show the pdf of the ratio for the patches in the three states .",
    "the figure shows that the buy and sell state display a distribution of the ratio @xmath55 which is very narrowly peaked close to 1 and zero , respectively . on the other hand",
    "this ratio is more broadly distributed for the neutral state .",
    "this result confirms the interpretation of state 1 and 3 as directional states , not only in number of transactions but also in volume .",
    "the left panel of figure [ vfrac ] considers all the patches with at least 10 transactions .",
    "the relation between our interpretation of the states and the ratio @xmath55 holds also if one measures the ratio conditional to the patch length .",
    "the right panel of fig .",
    "[ vfrac ] shows the mean ratio @xmath55 conditional to the patch length measured in total number of transactions .",
    "long directional states tend to be slightly less pure , i.e. roughly @xmath59 of the volume in a long buy patch is associated to sell transactions .",
    "however this fluctuation is relatively small and we conclude that our interpretation of states 1 and 3 as buy and sell states respectively , remains valid even when one considers the amount of volume exchanged .",
    "for the patches in the buy ( black ) , neutral ( red ) , and sell ( green ) state .",
    "we consider only patches with at least @xmath47 transactions for the pooled sample .",
    "right panel . expected value of the ratio @xmath55 conditional to the patch length @xmath0 ( in transactions ) for the patches of tef in 2004 ( dashed lines ) and for the pooled sample ( solid lines).,title=\"fig : \" ]   for the patches in the buy ( black ) , neutral ( red ) , and sell ( green ) state .",
    "we consider only patches with at least @xmath47 transactions for the pooled sample .",
    "right panel . expected value of the ratio @xmath55 conditional to the patch length @xmath0 ( in transactions ) for the patches of tef in 2004 ( dashed lines ) and for the pooled sample ( solid lines).,title=\"fig : \" ]       transactions.,title=\"fig : \" ]   transactions.,title=\"fig : \" ]    our working hypothesis is that hmm patches are related to the strategic behavior of traders , to provide empirical support to our hypothesis it is important to investigate the properties of the patches concerning the liquidity properties and the participation rate of the patch .",
    "each transaction in a electronic double auction market happens between a limit order and an market order .",
    "the use of limit and market orders usually indicates different trading strategies .",
    "market orders are placed by more impatient traders who want their orders to be executed as soon as possible , while traders using limit orders are more patient and are willing to wait for a transaction in order to get a better price . in our database",
    "we do not have direct information on who initiated the transaction , and therefore we use the lee and ready algorithm @xcite to infer if the initiator of the transaction , i.e. the agent who placed the market order , was the buyer or the seller .",
    "we investigate the fraction of market orders in the detected hmm patches .",
    "figure [ mopdf ] shows the probability density function of the fraction of market orders in a patch for the three states detected by the hmm . as done before , to avoid discretization problems we consider only patches made of at least @xmath47 transactions .",
    "the patches in state 2 show a fraction of market orders which is broadly distributed and the density function is roughly centered around @xmath60 . on the contrary ,",
    "directional patches show a clear preference for a low fraction of market orders .",
    "moreover the figure shows that there is a difference between patches in buy and sell state .",
    "buy patches tend to have a smaller proportion of market orders than sell patches .",
    "patches in 2001 - 2002 show the opposite behavior .",
    "the above result considers all the patches independently of their length . to investigate the dependency of the fraction of market orders from the patch length ,",
    "we show the mean fraction of market orders conditional to the length of the patch in figure [ length - mo ] .",
    "the figure shows that for a given length , neutral patches are richer in market orders than patches in the sell state , which in turn are richer in market orders than patches in the buy state , confirming the unconditional result shown in figure [ mopdf ] .",
    "again , the patches in 2001 - 2002 display the opposite buy - sell behavior .",
    "a possible explanation for the difference between the neutral and the directional states is market impact .",
    "it has been recently shown that an hidden order made of market orders has typically a positive impact , while an _ executed _ hidden order made of limit orders has typically a negative market impact @xcite .",
    "thus if a trader wants to execute a buy or a sell hidden order , the use of limit orders will lower the impact when compared to the use of market order ( of course , the use of limit orders does not give certainty of execution because the price could move in opposite direction ) .",
    "therefore the low fraction of market orders in directional patches could be the consequence of a strategic choice of minimizing price impact .",
    "the asymmetry of behavior between buy and sell patches will be discussed in more detail in section [ 20012002 ] . finally , figure [ length - mo ] shows that the fraction of market orders in a patch increases with the patch length .",
    "the other parameter characterizing the strategy behind hidden order placement is the participation rate .",
    "we define the participation rate of a patch as @xmath61 , where @xmath62 is the total volume exchanged by the patch measured in euros and @xmath63 is the total volume also measured in euros exchanged in the traded stock during the execution of the patch . in figure [ aggressiveness - pdf ] we show the probability density function of the participation rate for the three states .",
    "again we find a different behavior for the neutral and for the directional states .",
    "the neutral patches have a smaller participation rate than the directional patches .",
    "this result also holds when conditioning on the order length .",
    "figure [ aggressiveness ] shows the mean value of the participation rate conditional to the patch length .",
    "we see that for a given patch length buy patches have on average a larger participation rate than sell patches , which in turn have a larger participation rate than neutral patches . as before in 2001 - 2002 the buy - sell asymmetry of behavior of directional patches is inverted .",
    "the participation rate decreases with the length of the patch and this is expected given that a large order is typically executed with a smaller participation rate in order to avoid detection by other traders and in order to decrease the impact cost . in figure [ aggressivenessmo ]",
    "we consider the mean participation rate conditional to the fraction of market orders in a patch .",
    "there we find that this is a decreasing function , in contrast with what found in ref .",
    "@xcite where patches detected with the more global segmentation algorithm were investigated .    in summary",
    ", we conclude that large directional patches are made mainly of market orders and have a small participation rate , while small directional patches have a larger fraction of limit orders and a larger participation rate .",
    "the buy - sell asymmetry conforms to this pattern .",
    "in fact in the period 2003 - 2006 buy patches have a smaller fraction of market orders and a larger participation rate than sell patches . in section [ 20012002 ]",
    "we show that this asymmetry may be associated to the trend of the price of the traded stock .",
    "elapsed between the first and the last transaction in an hmm patch .",
    "middle panel .",
    "distribution of the total number of transactions @xmath64 in an hmm patch .",
    "bottom panel .",
    "distribution of total total volume @xmath62 exchanged in an hmm patch .",
    "the solid lines refer to directional patches and the circles to the neutral patches .",
    "the squares show the distribution of the @xmath65 , @xmath64 , and @xmath62 variables for patches detected with the algorithm of ref .",
    "the investigated years are 2003 - 2006.,title=\"fig:\",width=302 ]   elapsed between the first and the last transaction in an hmm patch .",
    "middle panel .",
    "distribution of the total number of transactions @xmath64 in an hmm patch .",
    "bottom panel .",
    "distribution of total total volume @xmath62 exchanged in an hmm patch .",
    "the solid lines refer to directional patches and the circles to the neutral patches .",
    "the squares show the distribution of the @xmath65 , @xmath64 , and @xmath62 variables for patches detected with the algorithm of ref .",
    "the investigated years are 2003 - 2006.,title=\"fig:\",width=302 ]   elapsed between the first and the last transaction in an hmm patch .",
    "middle panel .",
    "distribution of the total number of transactions @xmath64 in an hmm patch .",
    "bottom panel .",
    "distribution of total total volume @xmath62 exchanged in an hmm patch .",
    "the solid lines refer to directional patches and the circles to the neutral patches .",
    "the squares show the distribution of the @xmath65 , @xmath64 , and @xmath62 variables for patches detected with the algorithm of ref .",
    "the investigated years are 2003 - 2006.,title=\"fig:\",width=302 ]    three variables characterize the size of patches : @xmath65 , @xmath64 , and @xmath62 .",
    "the time @xmath65 measured in seconds is the time elapsed from the first to the last transaction of the patch .",
    "we use trading time , i.e. we remove the overnight , the holidays , and in general any time when the market is closed .",
    "the total number of transactions composing the patch is given by @xmath52 and the total volume traded in the patch is @xmath51 .",
    "these variables are different from the one used in ref .",
    "@xcite where only the most frequent type of transactions ( buy or sell ) in a directional patch were considered in the definition of @xmath0 and @xmath66 . however , as we have seen above , in hmm directional patches the most frequent type of transactions is responsible of almost all the volume exchanged in the patch and in fact we observe very little difference in the distributions obtained by considering all the transactions or only the ones of most frequent type .",
    "the motivation for the slight change in variables is that our present choice allows to investigate the distributional properties both of the directional and of the neutral patches with the same set of variables .    .",
    "[ cols=\">,^,^,^,^\",options=\"header \" , ]     figure [ distribhmm ] shows the cumulative distribution for @xmath65 , @xmath64 , and @xmath62 for the four considered stocks pooling together the four different years .",
    "we pool together the directional patches because in this case we find a negligible difference of behavior between buy and sell patches .",
    "this is true also when we investigate the 2001 - 2002 period .",
    "we observe that for neutral patches , the distributions of @xmath64 and @xmath62 have a thinner tail than the corresponding directional patch distributions .",
    "for @xmath65 the distributions for the three states are very similar .",
    "the cumulative distribution shows that approximately @xmath67 of the detected patches are characterized by a time duration of less than an hour .",
    "therefore the largest fraction of detected patches seems to be proxies of intraday hidden orders .",
    "this might indicate a preference of the traders to close daily the position taken or might be related to a specific aspect of our approach which is monitoring market members and not single investors .",
    "in fact it is realistic to hypothesize that market members are most of the time performing multiple , although heterogeneous , strategies and the interference of multiple strategies might end up into a local fragmentation of trading strategies planned over longer time horizons by a limited number of large investors .",
    "fragmentation which is revealed by the hmm approach .",
    "however in spite of this limitation , from the figure [ distribhmm ] we can see that also in the case of hmm , patch size has a fat tail distribution .",
    "we performed a jarque - bera test of the hypothesis that the above distributions are lognormal and in all the cases we reject the null hypothesis @xmath68 confidence level .",
    "it is difficult to assess if the tail of the distributions is power law given the small extension of the tail . in order to compare the tail of the distributions with those obtained in ref .",
    "@xcite we estimate the tail exponent by using the hill estimator .",
    "table [ hill - hmm5 ] gives the hill estimation for the tail exponent for all the analyzed sets and variables when the estimation is applied to the top @xmath69 percentile .",
    "we also compare the size distribution of the hmm patches with those found by applying the segmentation method used in ref .",
    "@xcite to the signed volume time series .",
    "we therefore run the segmentation algorithm to the inventory time series and we consider as size variables @xmath65 , @xmath64 , and @xmath62 .",
    "the figure shows that these patches are much longer than the one identified by the hmm .",
    "table [ hill - segment ] shows the hill estimator of the tail exponent of the directional patches identified by the segmentation algorithm on the top @xmath69 quantile . by comparing the exponents in this table and in table [ hill - hmm5 ]",
    "we observe that the values are not very different suggesting a relation between the small hmm patches and the larger patches detected by the segmentation algorithm . in section 7",
    "we will make this comparison more quantitative .",
    "for directional patches with at least 10 transactions . the symbol @xmath70 indicates the difference of the quantity in parenthesis between buy and sell patches .",
    "specifically , panel ( a ) shows the difference of the number of buy and sell patches , panel ( b ) shows the difference of the average length ( in transactions ) between buy and sell patches , panel ( c ) shows the difference of the average fraction of market orders between buy and sell patches , and finally panel ( d ) shows the difference of the average participation rate between buy and sell patches .",
    "bottom 4 panels .",
    "closing price time series for the four investigated stocks in the period 2001 - 2006 .",
    "each color refers to a different calendar year.,title=\"fig : \" ]   for directional patches with at least 10 transactions .",
    "the symbol @xmath70 indicates the difference of the quantity in parenthesis between buy and sell patches .",
    "specifically , panel ( a ) shows the difference of the number of buy and sell patches , panel ( b ) shows the difference of the average length ( in transactions ) between buy and sell patches , panel ( c ) shows the difference of the average fraction of market orders between buy and sell patches , and finally panel ( d ) shows the difference of the average participation rate between buy and sell patches .",
    "bottom 4 panels .",
    "closing price time series for the four investigated stocks in the period 2001 - 2006 .",
    "each color refers to a different calendar year.,title=\"fig : \" ]    we have seen in the previous sections that several properties of hmm patches show a significant behavior asymmetry between buy and sell patches .",
    "this may be due to two possible reasons .",
    "the first possible explanation is that there is an intrinsic asymmetry between the buy and sell strategy of hidden order splitting",
    ". this may be due to behavioral biases , margin calls , short selling restriction , etc .",
    "the second possible explanation is related to the presence of a different behavior in the buy - sell order splitting strategy which is _ conditional _ to the market state , for example the fact that the price is trending up or down . in this second case",
    "there is a buy - sell asymmetry when the market is , for example , trending up , but the asymmetry is reverted when the market trends down .    in order to investigate which hypothesis explains better the data , we consider telefonica stock and we divide our six year period ( 2001 - 2006 ) in 72 one month sub - periods . for each of them",
    "we compute the ratio @xmath71 between the average daily price return in the month and the volatility @xmath72 , here computed as the standard deviation of daily returns in the month .",
    "this ratio gives a measure of the price trend in the month .",
    "then we consider the hmm directional patches detected in the considered month with at least 10 transactions and we compare the statistical properties of the buy and sell patches as a function of @xmath73 .",
    "the top part of figure [ price ] shows the results .",
    "specifically , panel ( a ) shows the difference of the number of buy and sell patches as a function of @xmath73 .",
    "panel ( b ) shows the difference of the average length measured in transactions between buy and sell patches as a function of @xmath73 .",
    "panel ( c ) shows the difference of the average fraction of market orders between buy and sell patches as a function of @xmath73 , and finally panel ( d ) shows the difference of the average participation rate between buy and sell patches as a function of @xmath73 .",
    "in each panel we observe a highly significant linear relation between the plotted variables .",
    "the correlation coefficient is -0.42 , -0.42 , -0.61 , and 0.64 , respectively .",
    "this result indicates that when the price increases there are more sell patches , which are typically longer , richer of market order , and with a lower participation rate when compared to buy patches .",
    "the opposite happens when the price decreases .",
    "the intercept of the regressions is significantly different from zero for the number and the fraction of market orders suggesting also an overall buy - sell asymmetry even in the absence of a price trend ( @xmath74 ) .",
    "however the dependence of the four quantities from @xmath73 is much stronger , indicating that the second hypothesis stated above is probably the most relevant one in explaining the buy - sell asymmetry . finally , for the neutral patches we do not observe any significant dependence of the statistical properties as a function of @xmath73 .",
    "a full explanation of these asymmetries is beyond the scope of this paper and will be considered in a future paper .",
    "these asymmetries help to explain why we investigate the market in 2003 - 2006 and leave out the period 2001 - 2002 .",
    "the bottom part of figure [ price ] shows the closing price of the four stocks in the period 2001 - 2006 .",
    "we see that the market was in a bear phase ( i.e. decreasing price ) in 2001 - 2002 , while it was in a bullish phase ( i.e. increasing price ) in 2003 - 2006 . by investigating each year",
    "separately we find that some properties of the hmm patches are similar in all years , while others have a different behavior in 2001 - 2002 and in 2003 - 2006 .",
    "the main difference we find in 2001 - 2002 are :    * sell patches have typically a smaller fraction of market orders than buy patches , i.e. the contrary of what observed in 2003 - 2006 where sell patches have a higher fraction of market orders than sell patches .",
    "( figures [ mopdf ] and [ length - mo ] ) * sell patches have a higher participation rate than buy patches , i.e. the contrary of what observed in 2003 - 2006 where sell patches have an smaller participation rate than buy patches ( figures [ aggressiveness - pdf ] and [ aggressiveness ] ) .",
    "these differences are consistent with the dependence of the buy - sell asymmetry from the price trend investigated above on the monthly scale .",
    "we observe that this explanation seems to work even when one considers longer time scales such as the yearly time scale .",
    "while this explains our choice of investigating only the four year period 2003 - 2006 , a full understanding of the dependence between long scale price trends and short scale hmm buy - sell asymmetries requires further investigations .",
    "in this section we compare the patches detected with the hmms and the ones detected with the algorithm of ref .",
    "@xcite in more detail .",
    "as we have described in section 6 , the two types of patches describe regimes at very different scales .",
    "hmm patches are typically short , while the the patches of ref .",
    "@xcite ( hereafter addressed as _ segment patches _ ) are very long . in order to compare the two segmentations",
    ", we divide the segment patches in three groups of type buy , sell , and neutral according to the criterion used in ref .",
    "we therefore compute the number of hmm patches in the three hmm states contained in a segment patch of a given type .",
    "the left panel of figure [ comparison ] shows the average number of hmm patches in the three hmm states for segment patches of the three types as a function of @xmath75 , which is the number of transactions present in the segment patch .",
    "neutral segment patches contain roughly the same number of neutral hmm patches as the sum of the number of buy and sell hmm patches .",
    "the middle and bottom panels of the left part of figure [ comparison ] show that a buy ( sell ) segment patch contains typically an equal number of buy ( sell ) and neutral hmm patches and a much smaller number of sell ( buy ) hmm patches .",
    "therefore directional segment patches are typically a mixture of neutral and directional ( with the same sign ) hmm patches .",
    "the comparison is even clearer if one considers the number of transactions in a segment patch , which are assigned by the hmm to a specific type of state ( see the right panel of fig .",
    "[ comparison ] ) .",
    "neutral segment patches have on average an equal number of transactions in the three hmm states ( see the top right panel ) .",
    "taken together with the top left panel , this result indicates that neutral segment patches are composed by relatively short neutral hmm patches and an equal mixture of longer buy and sell hmm patches .",
    "by contrast buy ( sell ) segment patches are composed by a large fraction of transactions in the buy ( sell ) hmm state , a smaller fraction of transactions in the hmm neutral state , and a much smaller fraction of transaction in the opposite directional hmm state .",
    "we therefore conclude that directional segment patches are mainly composed by an equal mixture of short neutral hmm patches and long hmm directional patches with the same direction as the segment patches .    , which is the length of the segment patch .",
    "right panel .",
    "average number of transactions in hmm patches in the three hmm states found inside a segment patch of type neutral ( top ) , buy ( middle ) and sell ( bottom ) as a function of @xmath75.,title=\"fig : \" ] , which is the length of the segment patch .",
    "right panel .",
    "average number of transactions in hmm patches in the three hmm states found inside a segment patch of type neutral ( top ) , buy ( middle ) and sell ( bottom ) as a function of @xmath75.,title=\"fig : \" ]",
    "in this paper we have shown that hmms can be used to detect patches in the series of transaction signs performed by market members .",
    "we interpret the directional patches as possible hidden orders submitted by the market members . by analyzing the statistical properties of these patches we observe that the time distribution of these patches is fat tailed . unconditionally ,",
    "long patches are characterized by an high fraction of market orders and a low participation rate , while short patches have a large fraction of limit orders and an high participation rate .",
    "we also observe an interesting buy - sell asymmetry which is depending on the trend of the stock price .",
    "when the price goes up , we detect more sell patches , which are longer , with more market orders , and less aggressive compared to the buy patches detected in the same period . when the price decreases the opposite behavior is observed .",
    "these results may be considered a contribution in the identification of stylized facts in the strategic behavior of the investors .",
    "the comparison of the hmm patches and those obtained with the segmentation algorithm used in @xcite can shed light on the their interpretation .",
    "the two segmentation methods perform a coarse graining of the inventory time series on two different time scales .",
    "the hmm is able to detect short patches with a well defined drift , while the segmentation algorithm detects large scale patches composed by many smaller hmm directional patches with the same sign interspersed by even smaller hmm neutral patches .",
    "a possible interpretation is that the segment patches represent trading decision of the portfolio managers that are executed on time scales that can go up to several days , while hmm patches represent trader s executions of usually intraday smaller packages , which might be part of the larger portfolio manager orders .",
    "there are many interesting points raised by the present study that might deserve future investigations .",
    "first , it is important to build a stronger relation between the stylized facts observed in hmm patches and the possible strategies adopted by the investors .",
    "second , the buy - sell asymmetry deserves a more in depth analysis to understand ( i ) how it depends on the considered time scale , and ( ii ) a possible causal relation between the asymmetry and the price trend .",
    "specifically , is the price going up or down because of the asymmetry or is the order flow adapting to the price drift ?",
    "third , it is interesting , both from a theoretical and from an applied point of view , to compute the market impact of the hmm patches , in a way similar to what has been done in ref .",
    "@xcite for patches detected with the segmentation algorithm .",
    "finally , in our study we have pooled together all the market members without considering possible differences in the order splitting strategies across market participants .",
    "the understanding of the heterogeneity and mutual relationship in the order splitting strategies of market participants might help in understanding the fascinating process of price formation .",
    "authors acknowledge financial support from the prin project 2007tkltsr  indagine di fatti stilizzati e delle strategie risultanti di agenti e istituzioni osservate in mercati finanziari reali ed artificiali \" .",
    "in this paper we have used hmms to model hidden orders .",
    "however hmms are parametric models and therefore assume a given structure of the data .",
    "a known property of hmms is that patch length are exponentially distributed . in fact , if a system described by an hmm , which is initially in a given state @xmath76 , the probability @xmath77 that the system stays in that state for exactly @xmath78 steps , i.e. that @xmath79 is @xmath80    since we do not have any prior on the length distribution , we test numerically whether hmms are able to detect non - exponential distributed patch lengths . more specifically ,",
    "we perform two in - depth simulation studies . in the first we simulate an artificial time series with patch length taken from a pareto ( i.e. power law ) distribution .",
    "then we fit an hmm and we reconstruct the hidden states of the process by looking for the best sequence of states , which are individually most likely .",
    "the second simulation study consists in considering a generalization of hmms , namely the hidden semi markov model ( hsmm ) in which the patch length distribution is not fixed by the model but it is fitted from the data .",
    "both studies show that our procedure is able to detect non exponential distributed patch lengths .      here",
    "we show the results of a simulation study of the reconstruction with hmm of the hidden states of an artificial time series generated with power law distributed patch length .",
    "specifically , we simulate time series composed by patches of variable length and characterized by different composition of the symbols @xmath34 and @xmath35 .",
    "the length of each patch is extracted from a pareto distribution @xmath81 .",
    "we assign to each patch a dominant sign ( @xmath34 or @xmath35 ) , and then for each patch we simulate a time series of length @xmath78 as a binary time series with a bias in favor of the dominant sign .",
    "consecutive patches have alternate dominant signs . in",
    "the following we show results obtained for a surrogate time series composed by 5,000 patches with length extracted from a pareto distribution with exponent @xmath82 . in figure [ paretohmm ]",
    "we compare the distribution of the simulated patch length with the distribution of the hmm reconstructed patch length .",
    "figure [ paretohmm ] shows that the tail behavior of the two distributions is quite similar , a part from a global factor which is due to the fact that the hmm is unable to detect very short patches due to statistical fluctuations .",
    "this result suggests that hmms are able to reproduce the power law behavior of the distributional properties of the patches in a time series , despite the exponential structure of the patch length expected in an hmm",
    ".           performed by hill estimation on the top 5% quantile . ]",
    "the problem of the exponential distribution of the patch length is well known in the hmm literature .",
    "the most used extension of hmms to cope with the problem of exponential distribution of patch length is the hsmm @xcite . in an hsmm",
    "the diagonal elements of the transition probability are set to zero and the model is specified by assigning also the patch length distribution ( sometimes called sojourn time distribution , or runlength distribution ) associated with each state and defined as @xmath83 in other words in an hsmm the patch length distribution of each hidden state is assigned explicitly in the specification of the model and is not therefore necessarily exponential . there exist algorithms that allows to fit an hsmm with a given sojourn time distribution to a time series .",
    "however if one has no prior about the functional form of the sojourn time distribution , it is possible to fit a non parametric hsmm to a time series . in this case",
    "the distributions of sojourn time are fitted from the data .",
    "hsmms with nonparametric state sojourn time distributions were first proposed by ferguson in 1980 @xcite in the field of speech recognition and an efficient algorithm for the model fit has been recently proposed @xcite . in the hsmm investigation",
    "we use a non parametric fitting , i.e. we fit also the distribution of sojourn time .",
    "this estimation requires long computational time and can be only applied to long time series .    for the estimation of the model parameters of the hsmm and the subsequent reconstruction of the underlying state sequence we use of the @xmath84 library _ hsmm _ @xcite .",
    "the algorithms for maximum likelihood parameter estimation in this library are based on a method introduced in @xcite .",
    "the non parametric estimation of the sojourn time distribution requires a high number of observations . for this reason we choose to analyze only time series with at least 20,000 records .",
    "accordingly we select 28 market members trading tef in the 2006 .",
    "the mean buy probability computed across market members in the three hidden states of the fitted hsmm is @xmath85 , @xmath86 , and @xmath87 , which supports the interpretation of the three states as sell state , neutral state , and buy state , respectively .",
    "the mean transition probability matrix is @xmath88    after the model parameter estimation , we compute the hidden state sequence for each of the 28 inventory variation sign time series . in figure [ distribhsmm ]",
    "we compare the cumulative probability of patch length obtained with the hmm and the hsmm .",
    "for the directional states the distribution of patch length obtained with the two methods are quite similar",
    ". the most pronounce difference is observed in the tail of the distribution of length of neutral patches .",
    "we also estimate the tail exponents with the hill estimator on the 5% quantile and we observe similar tail exponent values for hmm and hsmm patches .",
    "the parameter estimations for the hsmm requires much more computational resources than the hmm .",
    "the fitting and reconstruction the time series for one year of transactions of 28 participants with hsmm required about 6 days of computing time against a few minutes required for the hmm modeling .",
    "the complexity of the algorithm is linear in the sequence length , and we estimated that the modeling of 6 years of transactions for the participants trading the stock telefonica would have required roughly one month of computations . even if hsmm is a more realistic choice than hmm in modeling inventory time series , the small differences in the distributions observed in fig .",
    "[ distribhsmm ] convinced us to use the hmm to model our data ."
  ],
  "abstract_text": [
    "<S> large trades in a financial market are usually split into smaller parts and traded incrementally over extended periods of time . </S>",
    "<S> we address these large trades as hidden orders . in order to identify and characterize hidden orders we fit hidden markov models to the time series of the sign of the tick by tick inventory variation of market members of the spanish stock exchange . </S>",
    "<S> our methodology probabilistically detects trading sequences , which are characterized by a net majority of buy or sell transactions . </S>",
    "<S> we interpret these patches of sequential buying or selling transactions as proxies of the traded hidden orders . </S>",
    "<S> we find that the time , volume and number of transactions size distributions of these patches are fat tailed . </S>",
    "<S> long patches are characterized by a high fraction of market orders and a low participation rate , while short patches have a large fraction of limit orders and a high participation rate . </S>",
    "<S> we observe the existence of a buy - sell asymmetry in the number , average length , average fraction of market orders and average participation rate of the detected patches . </S>",
    "<S> the detected asymmetry is clearly depending on the local market trend . </S>",
    "<S> we also compare the hidden markov models patches with those obtained with the segmentation method used in vaglica _ </S>",
    "<S> et al . _ </S>",
    "<S> ( 2008 ) and we conclude that the former ones can be interpreted as a partition of the latter ones . </S>"
  ]
}