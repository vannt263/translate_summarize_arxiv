{
  "article_text": [
    "adaptive time integration schemes for odes are well established and perform extremely well for many applications . however , for applications involving the integration of hamiltonian systems , there are good reasons for using symplectic integrators@xcite .",
    "this is particularly true in applications such as accelerators , in which very long orbits must be integrated .",
    "symplectic integrators are also used in particle - in - cell ( pic ) codes for plasma applications , where for economy integrators with lower order of accuracy must be used , but it is important that the hamiltonian phase space structure be preserved .",
    "the same is true for molecular dynamics codes@xcite , which are of use for dense plasmas as well as other applications .",
    "similarly , for tracing magnetic field lines ( e.g. , in tokamaks or reversed field pinches ) or doing rf ( radio frequency ) ray tracing , symplectic integrators can be very useful .",
    "to our knowledge , the symplectic integrators in use for plasma and particle beam applications all have uniform time - stepping .",
    "however , for these applications there are situations in which variable or adaptive time stepping could increase efficiency greatly .",
    "for example , in accelerators , particles can experience fields that vary over a wide range of length scales .",
    "the same is true for for pic and md codes , for example for particles moving in and out of shocks or magnetic reconnection layers , or undergoing close collisions .",
    "there have been studies of symplectic integrators with variable time steps , but the early results were not promising @xcite . among these studies ,",
    "there have been two types of variation of time steps . in the first set of studies ,",
    "the time step varies with time explicitly , and in some cases varies from @xmath6 to @xmath7 on alternate blocks of time steps . in these studies problems",
    "were observed to arise . in the second set of studies ,",
    "the time step was chosen with @xmath8 , where @xmath9 are the dynamical variables .",
    "for any adaptive scheme for an autonomous system of equations , the time step is of this form . for the @xmath10 case ,",
    "the equations are no longer in canonical hamiltonian form ( but may be hamiltonian in non - canonical variables ; see below ) and indeed unfavorable results are found .",
    "the disappointing results for both of these cases have contributed to the general impression that if you need an adaptive time step integrator , you are better served using a high order non - symplectic integration method .    in this paper we take a new look at symplectic integrators with adaptive time stepping .",
    "our focus is not on developing the most efficient or accurate symplectic integrators , but to understand and solve the problems that have been encountered in using symplectic integrators with variable time steps , and to outline a method of obtaining an optimal time - step adaptation scheme .    in sec .",
    "[ sec : h_t ] we start by considering time steps depending explicitly on time alone as @xmath11 . in sec .  [",
    "sec : h_t_analytic ] we consider several examples of first and second order symplectic integrators applied to the harmonic oscillator , and apply _ modified equation analysis _ or _ backward error analysis_@xcite .",
    "this allows us to find the modified hamiltonian system which the integration scheme , including the effect of numerical errors , actually solves . from this analysis",
    "we find that resonances between @xmath12 and the oscillator frequency @xmath13 drive parametric instabilities .",
    "the resonances have @xmath14 , the lowest order resonance having @xmath15 . for",
    "first order schemes the resonance width scales as @xmath16 , while second order schemes have width @xmath17 .",
    "these parametric instabilities explain the problematic results obtained in the papers dealing with @xmath0@xcite . in the context of the harmonic oscillator",
    ", these problems were identified as arising from parametric instabilities by pich@xcite .",
    "we continue in sec .",
    "[ sec : h_t_numerical ] by numerically investigating time step variations @xmath18 , by integrating the harmonic oscillator with a symplectic method .",
    "we find parametric instabilities with resonance widths as predicted by the modified equation analysis .",
    "we show results of numerical integrations of a cubic oscillator with the nonlinear potential @xmath19 , in which the frequency varies with respect to the action variable , @xmath20 .",
    "the parametric instabilities seen globally for the harmonic oscillator show up as nonlinear resonances or islands , where @xmath21 , with @xmath22 depending on the integration method and the hamiltonian being integrated .",
    "we observed @xmath23 islands for the cubic oscillator , integrated with the crank - nicolson ( cn ) method .",
    "the calculations of this section illustrate the point that , when considering @xmath0 , problems arise because the equations being solved become unstable ( but still hamiltonian ) , and not because the integration scheme fails to be symplectic .    in sec .  [",
    "sec : d_qp ] we study time step variations @xmath24 . with @xmath25 , the straightforward substitution @xmath26 leads to equations ( having @xmath3 as the independent variable ) that are not hamiltonian equations in canonical form .",
    "symplectic integrators therefore should not be expected to give stable results in this case , and again it has been observed that they do not . in sec .",
    "[ sec : hairer ] we review one approach to solving this problem , by extending the phase space @xmath27 , where @xmath28 and @xmath29 is its conjugate momentum . after this transformation to an extended phase space , it is easily shown that the resulting equations are hamiltonian in canonical form and can be integrated by any fixed time step ( @xmath30 ) symplectic integrator in this extended phase space .",
    "this is a well - known method , and has been used to obtain symplectic integration schemes with variable time steps by hairer@xcite , and also reich@xcite .",
    "hairer described this approach as a `` meta - algorithm '' because any symplectic integrator can be used in the extended phase space .",
    "we then present numerical results in sec .",
    "[ sec : ext_num ] for the cubic oscillator ( with two different symplectic integrators ) which show that , even with a step size variation that appears to have an @xmath23 resonance , evidence of non - symplectic behavior occurs and no resonant islands form .    in sec .",
    "[ sec : noncan ] we introduce a second method for dealing with the problems that arise when @xmath2 .",
    "the point of introducing a second method is to illustrate that the main problem with @xmath10 is that the equations are no longer hamiltonian , and that there are potentially many ways to address this problem . the extended phase space method `` fixes '' the equations by embedding them in a higher dimensional hamiltonian system",
    "this alternative approach does not extend the dimension of the phase space , but rather recognizes the fact that , with @xmath3 as the independent variable and @xmath31 , the equations are hamiltonian equations in _ _ non - canonical variables__@xcite .",
    "( this is true only for one degree of freedom , i.  e.   2d phase space . )",
    "that is , the equations can be expressed in terms of a non - canonical bracket@xcite .",
    "we write the non - canonical variables as @xmath32 with the numerical scheme giving the mapping @xmath33 .",
    "equivalent to the non - canonical bracket , the fundamental two - form is @xmath34 rather than the canonical form @xmath35 .",
    "we describe a method for constructing a non - canonical generating function @xmath36 which gives a map @xmath37 which is a first order accurate integrator that preserves the two - form , and discuss its relation with transforming to canonical variables ( guaranteed to be possible by the darboux theorem@xcite . )",
    "we then find a complementary non - canonical generating function @xmath38 which leads to another non - canonical map @xmath39 , which is also first order accurate and preserves the two - form .",
    "maps preserving the two - form @xmath40 are called _ poisson integrators _ @xcite and conserve the measure @xmath41 rather than the area @xmath42 .",
    "we show that @xmath43 and vice - versa , so that the composition @xmath44 is time symmetric ( @xmath45 ) and therefore second order accurate .",
    "finally , we show numerical results in sec .  [",
    "sec : nslf_num ] using the composed map @xmath46 , applied to the cubic oscillator .",
    "as with the extended phase space method , this method is stable , with errors in the energy remaining bounded .    in sec .",
    "[ sec : h_qp_error_est ] we study the choice of time step variation @xmath47 .",
    "we begin by using backward error analysis for a slightly different purpose than in sec .",
    "[ sec : h_t ] , namely to estimate the form of the error of an integrator , and then devise a scheme to minimize the total error .",
    "this scheme takes the form of an _ equidistribution principle _",
    ", of the form @xmath48 , with uniform steps in @xmath3 .",
    "we then compare the error in numerical integration using @xmath49 to the error obtained for fixed time steps , to the error obtained for time steps designed to give equal arc length per step , and to time - stepping using a weighted average of @xmath49 and @xmath50 .",
    "we show numerical results showing that , among these options for time step variation , @xmath49 does indeed minimize the error .    in sec .",
    "[ sec : summary ] we summarize our work . in [ sec : pert ] we consider the relationship between the cases with @xmath1 and @xmath10 .",
    "we show that , while a simple argument motivates the use of @xmath1 , this is only valid for short times .",
    "we explain how this is analogous to the problems which arise in perturbation theory , where a perturbation causes a frequency shift , but at lowest order it appears a secularity or an instability . in [ sec : app_a ] we review non - canonical variables , brackets , and forms , material necessary for sec .",
    "[ sec : noncan ] .",
    "in this section we will investigate symplectic integrators with a variable time step @xmath0 , in order to understand better the results that have been obtained in the literature .",
    "using modified equation analysis , we will see that the problems that have been reported are best understood as a parametric instability due to resonance between the system dynamics and the time dependence of @xmath1 .",
    "we first look at the harmonic oscillator @xmath51 . with the change of variables @xmath52 and @xmath53",
    "we obtain @xmath54 .",
    "the leapfrog ( lf ) method , which is first order accurate when @xmath55 and @xmath56 are not taken to be staggered ) , with @xmath0 gives @xmath57 modified equation analysis begins by expanding @xmath58 and similarly for @xmath59 .",
    "we obtain @xmath60 ( terms proportional to @xmath61 appear at the next order for first order leapfrog . for other integration schemes , the @xmath62 terms will similarly appear at one order higher than the order of the method . )",
    "this system of equations arises from the hamiltonian @xmath63 as expected , the modified equations are in hamiltonian form @xcite . with the action - angle transformation @xmath64 and setting @xmath65",
    "we obtain @xmath66.\\ ] ] keeping only the resonant @xmath67 term @xmath68 , we obtain @xmath69 the canonical transformation @xmath70 ( @xmath71 unchanged ) transforms to a rotating frame in phase space and gives @xmath72 we conclude from this backward error analysis that the harmonic oscillator with time step @xmath65 is unstable if @xmath73 since @xmath74 is hyperbolic in this case . this instability is a parametric instability associated with the resonance @xmath75 .",
    "figure  [ fig : lf_stab ] shows this predicted region of instability as a function of @xmath12 and @xmath76 .",
    "numerical results for comparison are shown in the next section .",
    "carrying out this analysis to one higher order in @xmath77 gives an @xmath78 correction to the @xmath79- and time - independent terms in @xmath74 , which gives rise to a positive @xmath78 shift in the resonant frequency independent of @xmath76 , discussed in the next section .",
    "another integration scheme is symmetrized leapfrog , which is second order accurate , and takes the form @xmath80 this leads to a modified equation@xmath81 with modified hamiltonian@xmath82 a similar analysis to that above for first order lf leads to @xmath83 note that for this method , the frequency shift enters at the same order as the resonant term .",
    "we conclude that parametric instability occurs for @xmath84 this instability is centered around @xmath85 , again with @xmath15 , but in a narrower range @xmath86 .",
    "( resonances with other values of @xmath22 enter at higher order in @xmath77 and @xmath76 . )",
    "also note that , because the frequency shift enters at the same order as the resonant term , the shift is comparable to the resonance width for @xmath87 .    as another second order accurate example , we consider crank - nicolson ( cn ) , @xmath88 for which the modified equation analysis gives @xmath89 or@xmath90 here , @xmath91 is independent of @xmath79 and the action @xmath92 is an invariant to order @xmath93 , and the errors are all in the phase @xmath79 : the frequency @xmath94 is downshifted for this case .",
    "we conclude that parametric instabilities can not occur to this order for cn .",
    "it is easily seen that cn preserves the action @xmath71 _ exactly _ for the harmonic oscillator ; this shows that we have @xmath95 _ to all orders_. further , the explicit time dependence disappears if we introduce @xmath3 such that @xmath96 .",
    "the parametric resonances described for the harmonic oscillator in the previous section were studied numerically , and the results are shown in figs .",
    "[ fig : lf_stab ] and [ fig : ellipse ] .",
    "figure [ fig : lf_stab ] shows the numerical results , using the first order lf method , again with time steps given by @xmath97 .",
    "the red lines show the boundaries of the unstable region in @xmath12 , @xmath76 parameter space , as predicted in eq .",
    "( [ eq : lf_stab_1 ] ) .",
    "the colors show the logarithm of the value of the hamiltonian at the end ( @xmath98 ) of a numerically computed orbit . for unstable parameter values ,",
    "the orbit spirals outward , and the final value of the hamiltonian becomes exponentially large .",
    "the numerically computed region of instability agrees well with the prediction of eq .",
    "( [ eq : lf_stab_1 ] ) , and also shows the @xmath78 offset in frequency .",
    "numerical results showing a region of instability for a range of values of the parameters @xmath76 and @xmath12 , for first order lf .",
    "the red lines show the predicted stability limits given in eq .",
    "( [ eq : lf_stab_1 ] ) .",
    "the colors show the logarithm of the hamiltonian function @xmath99 evaluated on the orbit after integrating the equations to @xmath98 .",
    "this value should be approximately constant along the orbits , but it becomes large on orbits that spiral out to large values of @xmath55 and @xmath56 .",
    "parameters used : @xmath100 , @xmath101 .",
    "initial conditions : @xmath102 , @xmath103 .",
    "the small upward shift in @xmath12 comes in at second order in @xmath77 .",
    ", width=302 ]    in fig .",
    "[ fig : ellipse ] we examine how , for parameters where the integration is unstable , a circle of initial conditions is stretched out into a long thin ellipse . since the lf method is still symplectic , the area of the ellipses is preserved .     numerical results illustrating that , while the first order lf method is area preserving , variable time steps can cause a parametric instability .",
    "the black ellipses are generated by taking a set of points , and propagating them forward in time using first order lf .",
    "the black dots show one of these points , which is plotted for various times ( as labeled ) .",
    "the grey curve shows the coordinates @xmath104 of this point , for each of the computed time steps .",
    "parameters : @xmath105 , @xmath106 , @xmath107 , @xmath101 .",
    ", width=264 ]    as described above , first order lf integration of the harmonic oscillator with variable time step @xmath108 was found to be unstable near the resonance @xmath109 . for a nonlinear oscillator , the oscillation frequency @xmath13",
    "depends on the amplitude .",
    "we thus expect that the numerical integration of a nonlinear oscillator would exhibit resonant islands , rather than exhibiting global parametric instability",
    ".    for example , consider a hamiltonian with a cubic potential @xmath110 this hamiltonian has an o - point at @xmath111 and an at @xmath112 .",
    "inside the separatrix of the x - point , this system exhibits nonlinear oscillations . for this system and first order lf",
    ", the time step variation @xmath113 introduces an @xmath23 resonance ( @xmath114 ) , which is readily understood by backward error analysis .",
    "specifically , this analysis gives a term in the modified hamiltonian which is proportional to @xmath115 , which leads to the @xmath23 resonance .",
    "surface of section plot for the cubic hamiltonian of eq .",
    "( [ eq : cub_ham ] ) , with variable time step @xmath108 .",
    "the resonance with the time - step variation causes an @xmath23 island to open .",
    "parameters used : @xmath116 , @xmath117 , @xmath118 .",
    "the dots are points in the surface of section ( computed using cn ) , and the thin line is the separatrix of the x - point at @xmath119 .",
    ", width=264 ]    figure  [ fig : cn_cub_island ] shows the results of integrating this system with the cn method , and the same time steps variation .",
    "the frequency @xmath12 , @xmath120 , was chosen so that it would resonate with an orbit inside the separatrix .",
    "( the frequency varies with amplitude from the o - point from a maximum @xmath121 at the o - point to @xmath122 at the separatrix . ) the dots in fig .",
    "[ fig : cn_cub_island ] show the poincar surface of section for a time@xmath123 map , with @xmath124 . the elliptic point ( o - point ) of a resonant @xmath23 island is clearly seen near @xmath125 .",
    "we see that indeed the time dependent step size variations lead to an unphysical parametric resonance for the hamiltonian system in eq .",
    "( [ eq : cub_ham ] ) .",
    "we now turn from considering the time step variation @xmath1 to variations of the form @xmath10 .",
    "this form of variation is perhaps more natural , since it arises when trying to optimize the time step to reduce errors in the integration method applied to an autonomous system .",
    "( we will return to this issue in sec .",
    "[ sec : h_qp_error_est ] . ) in this section , we first discuss the problems that arise with this variation , and then we describe two methods by which these problems can be resolved .    previous attempts to apply this type of time step variation to symplectic integrators have suffered from one main , although sometimes unrecognized , problem : the equations are no longer hamiltonian . as has been pointed out@xcite , integration of hamiltonian s equations @xmath126 with variable time steps satisfying @xmath31",
    "is equivalent to changing the time variable @xmath127 to @xmath3 , and integrating the following equations with fixed size steps in @xmath3 ; @xmath128 : @xmath129 where @xmath130 ( summation assumed ) . here , @xmath131 .",
    "as they stand , these equations are not in canonical hamiltonian form . because of this",
    ", the application of a symplectic integrator should not be expected to give results that are symplectic , since eq .",
    "( [ eq : non - canonical ] ) is not a canonical hamiltonian flow .",
    "once this problem has been identified , there are various approaches that can be used to find an integrator which preserves the hamiltonian nature of eq .",
    "( [ eq : canonical ] ) , even with time steps given by @xmath132 . in the remainder of this section , we review and discuss two methods for integrating eqs .",
    "( [ eq : non - canonical ] ) in such a way that the symplectic nature of the original equations [ eq .",
    "( [ eq : canonical ] ) ] is preserved .",
    "the first method is to embed these equations into a larger phase space , considering @xmath127 to be another coordinate .",
    "this extended phase space approach goes back to the work of sundman @xcite , and has more recently been applied to numerical methods , both non - symplectic @xcite and symplectic @xcite . in the extended phase space , the new equations can again be written in canonical hamiltonian form , and thus integrated with any ( fixed @xmath3 step ) symplectic integrator .",
    "this extended phase space method is not the only way to integrate eqs .",
    "( [ eq : non - canonical ] ) symplectically , however . a second method which we consider in this section ( which only applies to one degree of freedom problems ) is to recognize the the equations can be written in terms of a non - canonical bracket .",
    "any method which preserves this bracket will then have all the nice properties of a symplectic integrator for a canonical system .",
    "we present a novel generating function approach for constructing such a method .    for the numerical results presented in this section , we will consider the hamiltonian with a cubic potential given in eq .",
    "( [ eq : cub_ham ] ) , integrated with the two different methods .",
    "the variable time steps @xmath24 are chosen so they might appear to have an @xmath23 resonance , since that is what is expected to give islands similar to the previous results of fig .  [",
    "fig : cn_cub_island ] .",
    "let @xmath133 for the simulations reported in this paper , @xmath134 and @xmath135 . for @xmath136 , i.e.  @xmath8 and @xmath137 , we have @xmath138 the step size @xmath139 was held fixed , and @xmath77 was adjusted so that after a given number @xmath140 periods of the orbit , @xmath141 equals @xmath142 .",
    "this is done so that the differences between the original and extended phase space results are due to the step size variation , rather than a change in the average step size . integrating the original hamilton equations ( [ eq : canonical ] ) with fixed step size cn ( i.e. , with @xmath143 ) gives a result with bounded errors in energy [ see fig .",
    "[ fig : compare_cn_nonuniform ] ] , as is expected for symplectic integrators . however , integrating eqs .",
    "( [ eq : canonical ] ) using cn with step size given by eq .",
    "( [ eq : varstep_ex ] ) gives errors in energy with linear growth , as also seen in fig .",
    "[ fig : compare_cn_nonuniform ] .",
    "this lack of boundedness of the energy is to be expected , since varying the step size in this way is equivalent to integrating eqs .",
    "( [ eq : non - canonical ] ) with fixed step size , and ( [ eq : non - canonical ] ) is not a hamiltonian system .",
    "thus there is no reason that using a symplectic method such as cn would give results with bounded errors in energy .",
    "( note that the hamiltonian is just a useful diagnostic ; the underlying problem is that phase space area is not conserved . )",
    "cn integration of the cubic hamiltonian [ eqs .",
    "( [ eq : cub_ham ] ) and ( [ eq : canonical ] ) ] is shown in gray , and the time transformed version of the cubic hamiltonian [ eqs .",
    "( [ eq : cub_ham ] ) and ( [ eq : non - canonical ] ) , with @xmath144 as given in eq .",
    "( [ eq : varstep_ex ] ) ] is shown in black .",
    "parameters : @xmath145 , @xmath146 , @xmath134 , @xmath147 .",
    "initial conditions : @xmath148 .",
    ", width=264 ]      by a well - known procedure @xcite , we introduce @xmath149 and its canonically conjugate momentum @xmath150 and consider the hamiltonian in extended phase space : @xmath151 again with @xmath131 .",
    "the canonical equations of motion are @xmath152 the last of these equations implies that if we choose @xmath153 , then @xmath154 and @xmath155 remains zero . in this case ,",
    "( [ eq : extended - canonical - ham ] ) are identical to eqs .",
    "( [ eq : non - canonical ] ) .",
    "so , with this choice of initial condition for @xmath29 , the actual orbit is followed and @xmath156 .",
    "note that , for this value of @xmath29 , the other contours of @xmath157 are not orbits of the original system .    with the equations of motion in the form ( [ eq : extended - canonical - ham ] ) , we can then use a canonical symplectic integrator such as modified lf ( ml ) ( a semi - implicit , symmetrized version of lf ; see @xcite ) or cn with fixed time step @xmath158 .",
    "this is the method used in refs .",
    "@xcite to integrate hamiltonian equations of motion with variable time steps for the special case @xmath159 , for which @xmath99 and @xmath150 are separately constants of motion .",
    "it should be noted that in a symplectic integration of eqs .",
    "( [ eq : extended - canonical - ham ] ) , @xmath155 will be only approximately invariant , so that the results of numerically integrating eqs .",
    "( [ eq : extended - canonical - ham ] ) will have small errors relative to the numerical results of integrating eqs .",
    "( [ eq : non - canonical ] ) .",
    "note that if @xmath99 is independent of @xmath127 , then one needs only to integrate the equations for @xmath55 and @xmath56 , since @xmath29 is exactly constant , and @xmath28 can be found by post - processing .",
    "so , even though this method `` extends '' phase space , the dimension of the system effectively remains unchanged .",
    "therefore , there is no possibility of parametric instability if the time step is small enough .      in this section",
    "we report numerical results using the extended phase space method [ eq .",
    "( [ eq : extended - canonical - ham ] ) ] to integrate the equations from the cubic hamiltonian [ eq .  ( [ eq : cub_ham ] ) ] , using @xmath47 as given in eq .",
    "( [ eq : varstep_ex ] ) . in fig .",
    "[ fig : compare_cn_ext ] the energy errors are compared for ( a ) cn integration and ( b ) ml integration . in both cases ,",
    "the black curve gives the extended phase space results , while the gray curve gives the result obtained by applying the same method with fixed step size to the original hamiltonian equations .",
    "as for fig .",
    "[ fig : compare_cn_nonuniform ] , the @xmath3 step @xmath160 was chosen to make @xmath142 equal to @xmath141 after @xmath140 periods of the orbit .",
    "we conclude that there is no secular change in the value of the hamiltonian @xmath161 .",
    "the time step in eq .",
    "[ eq : varstep_ex ] was chosen because it appears at first to have to potential for an @xmath23 resonance ; in sec .",
    "[ sec : h_qp_error_est ] we will describe a method to minimize the integration errors .    in fig .",
    "[ fig : ext_cub_island ] is shown a surface of section plot for the extended phase space cn integration .",
    "in contrast to fig .  [",
    "fig : cn_cub_island ] , there is no resonant island caused by the time step variation .",
    "this is consistent with the comment at the end of sec .",
    "[ sec : hairer ] .     extended phase space method .",
    "comparison of ( a ) cn and ( b ) ml . shown in black is the error in energy @xmath161 for the two methods . for comparison , in gray",
    "is shown the error in energy for the same method , but applied to the original uniform time step discretization of the hamiltonian equations .",
    "parameters : @xmath145 , @xmath162 , @xmath148 , @xmath163 , @xmath135 . , title=\"fig:\",width=264 ]   extended phase space method .",
    "comparison of ( a ) cn and ( b ) ml . shown in black is the error in energy @xmath161 for the two methods . for comparison , in gray",
    "is shown the error in energy for the same method , but applied to the original uniform time step discretization of the hamiltonian equations .",
    "parameters : @xmath145 , @xmath162 , @xmath148 , @xmath163 , @xmath135 .",
    ", title=\"fig:\",width=264 ]     surface of section plot , strobed at an arbitrary period @xmath123 , for the extended phase space method ( computed using cn ) . parameters : @xmath163 , @xmath135 , @xmath164 .",
    "expansion of the scale for results from longer runs show no islands anywhere inside the separatrix for any period @xmath123 .",
    ", width=264 ]    as a final check of the extended phase space method , a comparison was made between integrating eqs .",
    "( [ eq : non - canonical ] ) where the step size is determined by the position in phase space as @xmath25 , and integrating eq .",
    "( [ eq : canonical ] ) where the step size is a function of time as determined by a reference orbit @xmath165 .",
    "the reference orbit was obtained by solving the extended phase space equations [ eqs .",
    "( [ eq : non - canonical ] ) ] , for some initial conditions @xmath166 for which the period is @xmath167 . time-@xmath123 surface of section plots for several cases give a results qualitatively similar to fig .",
    "[ fig : cn_cub_island ] , with the time dependent step size @xmath168 giving a resonant island centered at the location of the reference orbit .",
    "this behavior is similar to the secular and unstable cases of perturbation theories discussed in [ sec : pert ] .      in this section",
    "we discuss a second method which can be used to integrate eqs .",
    "( [ eq : non - canonical ] ) , which works for one degree of freedom systems ( 2d phase space ) . in this section ,",
    "we change the notation for a point in phase space from @xmath169 to @xmath170 .",
    "this is done to emphasize the fact that eqs .",
    "( [ eq : non - canonical ] ) are not in canonical hamiltonian form",
    ".    equations  ( [ eq : non - canonical ] ) are of the form @xmath171 , where @xmath172 is the velocity , with @xmath173 .",
    "the measure @xmath174 is preserved over any phase space volume @xmath175 advected with the flow .",
    "equivalently , for the time@xmath127 map @xmath176 we have@xmath177 this measure preservation suggests that a measure preserving integrator applied to this system would have the same nice properties of a symplectic integrator applied to a canonical hamiltonian system .",
    "the equations of motion in the form in eq .",
    "( [ eq : non - canonical ] ) are not canonical hamiltonian equations . however , in one degree of freedom , eq .",
    "( [ eq : non - canonical ] ) is a hamiltonian system in non - canonical variables and can be written in the form@xmath178_{z},\\,\\,\\,\\,\\,{\\rm where}\\,\\,\\,\\,\\,[f , g]_{z}=\\frac{1}{\\rho(\\mathbf{z})}\\epsilon_{ij}\\frac{\\partial f}{\\partial z_{i}}\\frac{\\partial g}{\\partial z_{j}}\\ ] ] is a non - canonical bracket .",
    "that is , it is antisymmetric and direct calculation shows that it satisfies the jacobi identity @xmath179_{z}]_{z}+[g,[h , f]_{z}]_{z}+[h,[f , g]_{z}]_{z}=0 $ ] .    a method of constructing a symplectic non - canonical integrator in terms of generating functions@xcite starts with the condition that must hold for the time@xmath127 map , which is that it must preserve the two - form @xmath180 see [ sec : app_a ] for more details regarding this condition .",
    "first , we define @xmath181 and @xmath182 with these definitions , we can write @xmath183 and therefore eq .  ( [ eq : preserve ] ) becomes @xmath184 we can consider @xmath185 to be functions of @xmath32 , and then define @xmath186 and @xmath187 .",
    "these definitions , together with eq .",
    "( [ eq : preserve2 ] ) , imply that the one - form @xmath188 is exact , i.e.  @xmath189 .",
    "this in turn implies @xmath190 at least locally .",
    "we are led to the relations @xmath191 given the generating function @xmath36 , we solve eq .",
    "( [ eq : f2-eq-1 ] ) for @xmath192 and then substitute into eq .",
    "( [ eq : f2-eq-2 ] ) to obtain @xmath193 .    in essence",
    ", what is going on is this : we are transforming to canonical variables @xmath194 and @xmath195 , where @xmath186 and @xmath187 .",
    "then we are performing a canonical transformation @xmath196 in terms of a generating function @xmath36 , with @xmath197 and @xmath198 , and expressing the results in terms of @xmath32 , and @xmath185 .",
    "the identity transformation has @xmath199 and @xmath200 so that eqs .",
    "( [ eq : f2-eq-1 ] ) , ( [ eq : f2-eq-2 ] ) take the form @xmath201 these relations ensure that @xmath202 ; by eqs .",
    "( [ eq : canonical - p ] ) , ( [ eq : canonical - q ] ) , these both equal @xmath203 , which is nonzero .",
    "this nondegeneracy is necessary for the inversions in eqs .",
    "( [ eq : f2-eq-1 ] ) , ( [ eq : f2-eq-2 ] ) to work .",
    "we now wish to construct an @xmath204 approximation to @xmath36 in order to find a time@xmath160 map ( @xmath205 for the system given by eq .",
    "( [ eq : non - canonical ] ) .",
    "let us try the generating function @xmath206 from eqs .",
    "( [ eq : f2-eq-1 ] ) and ( [ eq : f2-eq-2 ] ) we find @xmath207 where @xmath208 and @xmath209 . substituting eqs .",
    "( [ eq : f2-eq-1-identity ] ) and ( [ eq : f2-eq-2-identity ] ) into these equations gives @xmath210 this is the form of our integrator : we integrate @xmath144 to give @xmath211 and @xmath212 as in eqs .",
    "( [ eq : canonical - p ] ) and ( [ eq : canonical - q ] ) , iterate the first of ( [ eq : ml - form-1 ] ) to solve for @xmath213 and , after substituting for @xmath213 , iterate the second of ( [ eq : ml - form-1 ] ) to solve for @xmath214",
    ". we do not need the explicit form for @xmath215 or the hamiltonian @xmath99 .    in order to see that eqs .",
    "( [ eq : ml - form-1 ] ) are a first order accurate integrator for the system in eq .",
    "( [ eq : non - canonical ] ) , we expand to first order in @xmath160 , and find @xmath216 with eqs .",
    "( [ eq : canonical - p ] ) , ( [ eq : canonical - q ] ) , this leads to @xmath217 this implies that eqs .",
    "( [ eq : ml - form-1 ] ) do constitute a first order accurate integrator for eqs .",
    "( [ eq : non - canonical ] ) .",
    "it is clear that the scheme in eqs .",
    "( [ eq : ml - form-1 ] ) is the non - canonical form of the ml integrator.@xcite note , however , that the system in eqs .",
    "( [ eq : ml - form-1 ] ) is implicit in both @xmath214 and @xmath213 .    for the complementary generating function @xmath38 we follow the same procedure , defining @xmath212 and @xmath211 exactly as in eqs .",
    "( [ eq : canonical - p ] ) and ( [ eq : canonical - q ] ) . we can now write eq .",
    "( [ eq : preserve ] ) as @xmath218 which , together with the definitions @xmath219 and @xmath220 , implies that @xmath221 is exact ( @xmath222 ) .",
    "therefore @xmath223 and @xmath224 the identity is given by @xmath225 , where @xmath226 with @xmath227 .",
    "we try @xmath228 which leads to @xmath229 as in the case with eqs .",
    "( [ eq : ml - form-1 ] ) , this is the form we use as an integration scheme , and it is not necessary to obtain @xmath230 explicitly . finally , a first order expansion in @xmath160 again gives eqs .",
    "( [ eq : first - order - form ] ) , showing that eqs .",
    "( [ eq : ml - form-2 ] ) are also a first order accurate integrator for eqs .",
    "( [ eq : non - canonical ] ) .",
    "the first order maps @xmath231 defined by eqs .",
    "( [ eq : ml - form-1 ] ) and eqs .",
    "( [ eq : ml - form-2 ] ) involve integration of a one - degree of freedom hamiltonian system with no explicit time dependence , and thus do not exhibit a parametric instability for small enough time steps .",
    "we have shown that both schemes in eq .",
    "( [ eq : ml - form-1 ] ) and in eq .",
    "( [ eq : ml - form-2 ] ) are first order accurate integrators for eq .",
    "( [ eq : non - canonical ] ) .",
    "what remains is to show that if they are applied sequentially one obtains second order accuracy .",
    "the first point is that if the maps based on @xmath36 and @xmath38 are written as @xmath37 and @xmath39 , respectively , one can show that@xmath232 and of course @xmath233 .",
    "this follows from inspection of eqs .",
    "( [ eq : ml - form-1 ] ) and ( [ eq : ml - form-2 ] ) .",
    "the composed map is @xmath234 and we find @xmath235 thus , @xmath46 is reversible and is therefore second order accurate .",
    "we call @xmath236 _ non - canonical symmetrized leapfrog _ ( nsl ) .    the methods outlined in this section",
    "preserve the non - canonical bracket , as does the actual time evolution of the non - canonical system .",
    "integrators with this property are often called _ _ poisson integrators__@xcite .",
    "it is interesting to note in this context that ( fixed step size ) cn can be written as @xmath237 , where @xmath238 is forward ( explicit ) euler and @xmath239 is backward ( implicit ) euler .",
    "further , the implicit midpoint method @xmath240 can be written as @xmath241 .",
    "this shows that @xmath242 , so that the implicit midpoint method is related to cn by a non - canonical change of variables .",
    "this implies that the implicit midpoint method is equivalent to a symplectic method under a ( non - symplectic ) change of variables , so it is a poisson integrator .",
    "therefore it can be used to integrate a canonical hamiltonian system with all the advantages of a symplectic integrator .      in this section",
    "we report numerical results where the non - canonical symmetrized leapfrog ( nsl ) integration scheme is applied to the cubic hamiltonian [ eq .  ( [ eq : cub_ham ] ) ] , with @xmath243 , as given in eq .  ( [ eq : varstep_ex ] ) . integrating @xmath203 yields @xmath244 and @xmath245 , and thus eq .",
    "( [ eq : ml - form-1 ] ) with this hamiltonian and time step variation becomes @xmath246 where @xmath247 and @xmath248 .",
    "the first of these can be solved for @xmath249 and then the second for @xmath250 , giving a non - canonical leapfrog integrator .",
    "the second non - canonical generating function method , given in eq .",
    "( [ eq : ml - form-2 ] ) , can similarly be written in terms of logarithms .",
    "as described in the last section , the composition of these two methods results in a symmetrized integrator , which can be written as : @xmath251/a_2 , \\\\ x ' & = \\left [ ( 1+a_1 x + a_2 y^ * ) e^{\\delta_0 a_1 u(y^ * ) } - a_2 y^ * -1\\right]/a_1,\\nonumber\\\\ y ' & = \\left [ ( 1+a_1 x'+ a_2 y^ * ) e^{\\delta_0 a_2 v(x')/2 } - a_1 x ' -1\\right]/a_2 , \\nonumber\\end{aligned}\\ ] ] figure  [ fig : compare_poisson ] shows numerical results from integrating the cubic oscillator using the nsl method of eqs .",
    "( [ eq : non - can_lf ] ) ( shown in black ) and fixed step size symmetrized lf ( shown in gray ) . as for the extended phase space method , we find that the nsl method with this @xmath203 gives results with bounded errors in the energy .",
    "again , this choice of @xmath203 was chosen because it suggests @xmath23 resonance and leads to tractible equations ; in sec .",
    "[ sec : num_opt ] we show results with an optimized @xmath203 that minimizes the time - stepping error .",
    "the surface of section for this method looks qualitatively like fig .",
    "[ fig : ext_cub_island ] , again with no resonant islands .",
    "the nsl method applied to the cubic oscillator , with time step variations as given in eq .",
    "( [ eq : varstep_ex ] ) . shown in black",
    "is the error in energy . for comparison , in gray",
    "is shown the error in energy for fixed step size symmetrized lf .",
    "parameters : @xmath252 , @xmath253 , @xmath148 , @xmath134 , @xmath147 .",
    ", width=264 ]",
    "we next turn our attention to the choice of step size variation @xmath2 , based on an error estimator .",
    "basing the choice of @xmath5 on an error estimate will give step size variations which are optimized to reduce errors , in a manner to be defined .",
    "as an example of an error estimate we consider cn integration of @xmath254 , where again @xmath255 .",
    "namely , we define a map @xmath256 given by @xmath257 where @xmath258 and @xmath259 , where @xmath260 can vary as a function of @xmath261 . if @xmath172 comes from a hamiltonian system , cn is symplectic , but that property is not important for these considerations .",
    "we can thus let @xmath262 , where @xmath263 and @xmath264 are the exact orbits.as mentioned in sec .",
    "[ sec : h_t_analytic ] , there will be terms proportional to @xmath265 , but they will appear at the next order in @xmath5 .    the error estimate is found by expanding @xmath266 in @xmath5 , and performing backward error analysis to obtain a local error estimate .",
    "this is a very different objective than that in the backwards error analysis in sec .",
    "[ sec : h_t ] . in index notation",
    "we obtain @xmath267 this leads to @xmath268 which can be written in vector notation as @xmath269 where @xmath270 .",
    "writing the error per time step as @xmath271 , where @xmath272 , the total error in an integration is@xmath273 now if we write the variable time step @xmath274 as @xmath275 , where @xmath276 is the constant step size in @xmath3 , this error takes the form @xmath277    we proceed to minimize the total error @xmath278 by writing @xmath279 . ignoring the constant factor @xmath280 , the lagrangian @xmath281 is given by @xmath282 where @xmath3 is the time , and we wish to find @xmath283 that minimizes @xmath278 .",
    "this is done by forming the euler - lagrange equations , or equivalently by doing a legendre transform to a hamiltonian : @xmath284 we obtain @xmath285 .",
    "notice that the hamiltonian @xmath286 is independent of the time @xmath3 and is therefore a constant of motion . also , the hamiltonian @xmath286 is proportional to the lagrangian @xmath287 , implying that @xmath281 is also a constant .",
    "since @xmath288 , we obtain an expression for the optimized time steps : @xmath289 this condition says that the lagrangian , the integrand in eq .",
    "( [ eq : local - global - error ] ) , is constant with respect to @xmath3 .",
    "( but the local error @xmath290 in eq .",
    "( [ eq : local - total - error - physical ] ) is not constant with respect to @xmath127 . )",
    "a condition of this form is called an _ _ equidistribution principle__@xcite .      in order to test the optimized time step , we compare numerical results using constant time step [ @xmath291 , the optimized time step @xmath292 and time steps designed to give equal arc length : @xmath293^{-1/2}.\\end{aligned}\\ ] ] with @xmath294 , the magnitude of the phase space velocity @xmath295 is constant .",
    "numerical results for these three choices of @xmath5 are shown in fig .",
    "[ fig : errors ] , using the cn integrator in extended phase space . for each of these methods , fixed steps in @xmath3 of size @xmath128 were used .",
    "the constant of proportionality @xmath296 in @xmath297 was then chosen so that , after @xmath140 periods of the orbit , @xmath142 equals @xmath141 .",
    "this is done in order to distinguish the effect of varying the step size as a function of @xmath169 from the effect of reducing the overall average step size .",
    "two diagnostics of the numerical integrations related to the local error are shown in fig .",
    "[ fig : errors ] , for @xmath298 ( light gray ) , @xmath294 ( dark gray ) , and @xmath299 ( black ) .",
    "they are the local error @xmath300 as a function of time and @xmath301 , proportional to the integrand in eq .",
    "( [ eq : local - global - error ] ) , as a function of @xmath3 , respectively",
    ". variations in step size given by @xmath294 reduce the error compared to the fixed step size integration , at almost all points along the orbit .",
    "variations given by @xmath299 further reduce the local error in some places , while allowing the local error to increase in others . as seen in fig .",
    "[ fig : errors]b , this variation has the effect of spreading the local error along the orbit , so that @xmath302 is constant as a function of @xmath3 , as required by the equidistribution principle .",
    "comparison of the errors for the extended phase space cn method , for three time - step variations , @xmath303 ( light gray ) , @xmath294 ( dark gray ) , and @xmath299 ( black ) .",
    "( a )  the local error as a function of time @xmath127 [ integrand of eq .",
    "( [ eq : local - total - error - physical ] ) ] , and ( b )  the local error as a function of  @xmath3 [ @xmath304  times the integrand of eq .",
    "( [ eq : local - global - error ] ) ] .",
    "parameters : @xmath305 , @xmath306 , @xmath307 , @xmath308 , @xmath309 , title=\"fig : \" ]   comparison of the errors for the extended phase space cn method , for three time - step variations , @xmath303 ( light gray ) , @xmath294 ( dark gray ) , and @xmath299 ( black ) .",
    "( a )  the local error as a function of time @xmath127 [ integrand of eq .",
    "( [ eq : local - total - error - physical ] ) ] , and ( b )  the local error as a function of  @xmath3 [ @xmath304  times the integrand of eq .  ( [ eq : local - global - error ] ) ] .",
    "parameters : @xmath305 , @xmath306 , @xmath307 , @xmath308 , @xmath309 , title=\"fig : \" ]    as a further test to check if @xmath299 really minimizes @xmath278 [ as defined in eq .",
    "( [ eq : local - global - error ] ) ] , we also show numerical results where @xmath278 is computed for @xmath310,\\\\ & \\propto & \\left [ ( 1-\\beta)\\delta_0 + \\beta\\delta_{opt}\\right],\\end{aligned}\\ ] ] where @xmath311 is chosen as above for each @xmath312 , for a range of @xmath312 . when @xmath313 , the time steps are uniform , and when @xmath314 the time steps are given by @xmath299 .",
    "the results are shown in fig .",
    "[ fig : opt1 ] . as seen in the inset in fig .",
    "[ fig : opt1 ] , the error is indeed a minimum for @xmath314 , with @xmath315 . for comparison",
    ", using @xmath316 gives @xmath317 , and @xmath318 gives @xmath319     the global error [ eq .",
    "( [ eq : local - global - error ] ) ] , over the time @xmath320 , for the time step variation @xmath321 [ eq .  ( [ eq : opt_scan ] ) ] .",
    "as seen in the inset , the error is minimized with @xmath322 for @xmath314 , for which @xmath323 . for comparison",
    ", using @xmath316 gives @xmath317 , and @xmath298 gives @xmath319 . ]",
    "in this paper we have studied variable and adaptive time stepping for symplectic integrators , of importance for particle - in - cell codes , for accelerators , for tracing magnetic field lines , and for ray tracing .",
    "we have shown that problems observed in the literature for symplectic integrators with variable time steps fall into two categories . in the first , with time step @xmath0 , the integrators are still symplectic but results can exhibit parametric instabilities associated with resonances between the time step variation and the orbital motion .",
    "we have characterized these instabilities by means of backward error analysis and numerical integrations . in the second category",
    ", the time steps depend on position in phase space , @xmath2 , and integrators which are symplectic for @xmath324 are no longer symplectic .",
    "we have discussed symplectic integrators for @xmath2 of two basic varieties . in both , we start by modifying the time variable @xmath325 such that @xmath26 and @xmath326 and we do uniform time stepping in @xmath3 . in the first method , one extends the phase space @xmath327 , with @xmath149 and @xmath150 its canonical conjugate . in this extended phase space with @xmath3 taking the place of time and @xmath328 , any numerical integrator can be used and we investigate modified leapfrog@xcite , symmetrized to be of second order , and crank - nicolson . in the second variety of integrator , we start by noticing that the equations to be solved , written as functions of @xmath3 , are in hamiltonian form with non - canonical variables for one degree of freedom problems .",
    "we then construct a poisson integrator ( the analog of a symplectic integrator but for non - canonical variables ) in terms of a generating function of mixed variables , which is a generalization of the mixed variable generating functions for canonical variables@xcite .",
    "we also show how to symmetrize this integrator to obtain second order accuracy , obtaining the non - canonical symmetrized leapfrog integrator .    we have investigated these integrators for a model hamiltonian system ( the cubic oscillator ) and found no parametric instabilities or growth or decay due to lack of phase space conservation .",
    "we have also investigated adaptive time - stepping , focusing on minimizing the norm of the error obtained by backward error analysis .",
    "we have applied this optimal time - stepping to the model hamiltonian system and found that indeed the error is minimized while the advantages of symplectic integration are preserved .",
    "we wish to thank a.  dragt , p.  morrison , and k.  rasmussen for enlightening discussions , and r.  pich for sharing a copy of his unpublished report  @xcite .",
    "this work was funded by the laboratory directed research and development program ( ldrd ) , under the auspices of the u. s. department of energy by los alamos national laboratory , operated by los alamos national security llc under contract de - ac52 - 06na25396 .",
    "two main time step variations are considered in the literature : @xmath329 and @xmath24 .",
    "the phase space dependent variation @xmath10 is natural because the errors in an integration method of an autonomous system depend only on phase space position .",
    "indeed , we found that error analysis ( as in sec .",
    "[ sec : h_qp_error_est ] ) for the integration method gives errors which depend on location in phase space @xmath169 .",
    "the second kind of variation @xmath1 comes from a type of perturbation analysis .",
    "the logic is as follows : orbits @xmath330 of a hamiltonian system are often periodic , and because of this , time step variations @xmath10 on the orbit should also be periodic .",
    "that is , we can substitute @xmath331 and @xmath332 to arrive at @xmath333 , giving periodic time dependence .",
    "this argument ignores the stability issue : if an orbit is perturbed , the period of @xmath334 will vary , but this will not occur for a prescribed @xmath1 .",
    "it has been observed@xcite that such a @xmath1 is not a stable method for varying the time step of a symplectic integrator . some analysis ( see ref .",
    "@xcite and sec .",
    "[ sec : h_t ] ) shows that this does not work because it introduces parametric resonances into the system . as we have shown in sec .",
    "[ sec : h_t ] , the integrator is still symplectic in this case , but the problem is that the modified equations ( in the case of a harmonic oscillator ) take the form of the mathieu equation , which is still hamiltonian but can be unstable .",
    "we here review how such parametric instabilities and secularities arise in perturbation theory , to help us understand the parametric instabilities of sec .",
    "[ sec : h_t_analytic ] .",
    "secularities show up in perturbation theories in the following manner .",
    "take the system @xmath335 a straightforward perturbation method involves iterating @xmath336 for @xmath337 , we obtain @xmath338 the last term on the right is resonant and leads to a secularity , @xmath339 however , it is clear from eq .",
    "( [ eq : x - cubed - system ] ) that the exact solution is bounded : the energy is @xmath340 .",
    "the @xmath341 term represents the frequency shift that occurs in eq .",
    "( [ eq : x - cubed - system ] ) because of the term proportional to @xmath76 , and is accurate for short time , but clearly wrong for long time .",
    "for an example of a perturbation approach with a parametric instability , we consider instead @xmath342 with the perturbation method @xmath343 ( we choose a different model in order to obtain again results at first order in the perturbation theory . ) from @xmath337 we obtain @xmath344 using @xmath345 , this is the mathieu equation @xmath346 , with @xmath347 and @xmath348 , for which a parametric instability occurs . as in the secular example",
    "above , the exponential growth represents the correct frequency shift for small time , but is wrong for longer time .",
    "indeed , the energy is @xmath349 , and for initial conditions near @xmath350 the solution can not grow indefinitely . as we have seen in sec .",
    "[ sec : h_t_analytic ] , parametric instabilities for @xmath351 have a very similar character .",
    "in this appendix we first describe the conditions that change of variables must satisfy so that the form of a set of equations defined with a non - canonical bracket is preserved .",
    "we then show that the flow of a hamiltonian system written in non - canonical variables , such as eq .",
    "( [ eq : non - canonical ] ) ( one degree of freedom ) , generates a change of variables satisfying these conditions .",
    "first define the non - canonical bracket @xmath352_z \\doteq \\frac{1}{\\rho({\\bf z } ) } \\epsilon_{ij } \\frac{\\partial f({\\bf z})}{\\partial z_{i } } \\frac{\\partial g({\\bf z})}{\\partial z_{j}}.\\end{aligned}\\ ] ] in one degree of freedom , @xmath353_z$ ] is indeed a non - canonical bracket , which can be verified by proving the jacobi identity . in more that one degree of freedom , this does not define a legitimate non - canonical bracket , since it does not satisfy the jacobi identity .",
    "we now ask what change of variables @xmath354 preserves the form , i.e. , what conditions must this change of variables satisfy so that @xmath355_z = [ f({\\bf z}),g({\\bf z})]_z,\\end{aligned}\\ ] ] where @xmath356_z \\doteq   \\frac{1}{\\rho({\\bf z } ) } \\epsilon_{mn } \\frac{\\partial f({\\bf z})}{\\partial z_{m } } \\frac{\\partial g({\\bf z})}{\\partial z_{n}}.\\end{aligned}\\ ] ] using the definitions of these brackets and the chain rule , eq .",
    "( [ eq : pres_req ] ) becomes @xmath357 in order for this to be true , we require that @xmath358 or , written in matrix form , that @xmath359 if this condition is satisfied , then the transformation @xmath360 preserves this specific non - canonical symplectic structure .    the next issue is to show that the time evolution operator for eq .",
    "( [ eq : non - canonical ] ) generates a map with this property . since eq .",
    "( [ eq : non - canonical ] ) can be written in terms of the non - canonical bracket as @xmath361_z,\\end{aligned}\\ ] ] then , for infinitesimal @xmath160 , if we define @xmath362 and @xmath363 we have @xmath364_{z}.\\ ] ] taking the bracket of @xmath365 and @xmath366 therefore gives @xmath367_{z}&=[z_{i},z_{j}]_{z}+h[[z_{i},h]_{z},z_{j}]_{z}+h[z_{i},[z_{j},h]_{z}]_{z } \\\\ & = [ z_{i},z_{j}]_{z}+h[[z_{i},h]_{z},z_{j}]_{z}+h[[h , z_{j}]_{z},z_{i}]_{z } \\\\ & = [ z_{i},z_{j}]_{z}+h[[z_{i},z_{j}]_{z},h]_{z}.\\end{aligned}\\ ] ] the last equality follows from the jacobi identity .",
    "this equals @xmath367_{z}&=\\epsilon_{ij}\\left(\\frac{1}{\\rho(\\mathbf{z})}+h[{1}/{\\rho},h]_{z}\\right ) \\\\ & = \\epsilon_{ij}\\left(\\frac{1}{\\rho(\\mathbf{z})}+(z_{k}-z_{k})\\frac{\\partial}{\\partial z_{k}}\\left(\\frac{1}{\\rho(\\mathbf{z})}\\right)\\right ) \\\\ & = \\frac{\\epsilon_{ij}}{\\rho(\\mathbf{z})}=[z_{i},z_{j}]_{z}.\\end{aligned}\\ ] ] thus , the time evolution operator for an infinitesimal time step @xmath160 preserves the non - canonical symplectic structure .",
    "this fact is the basis for finding a non - canonical generating function in sec .",
    "[ sec : noncan ] that gives a first order accurate integrator for the non - canonical hamiltonian system .    finally , we express these ideas in terms of differential forms .",
    "( [ eq : pres_req2 ] ) can be written @xmath368 from this , we obtain the expression @xmath369 or @xmath370 since we are considering only 2d phase space , this can be expressed as @xmath371 eq .",
    "( [ eq : non - canonical - two - form ] ) is the two - form used in sec .",
    "[ sec : noncan ] .",
    "10      b.  j. leimkuhler , s.  reich , and r.  d. skeel .",
    "integration methods for molecular dynamics . in j.",
    "p. mesirov , k.  schulten , and d.  sumners , editors , _ mathematical approaches to biomolecular structure and dynamics _ , volume  82 of _ i m a volumes math . appl .",
    "_ , page 161 .",
    "springer , 1996 .",
    "lee , m.j .",
    "duncan , and h.f . levison .",
    "variable timestep integrators for long - term orbital integrations . in d.  a. clarke and m.  j. west , editors , _ computational astrophysics _ , volume  32 of _ proc .",
    "12th kingston meeting _ , san franscisco , 1997 .",
    "astronmical society of the pacific .",
    "hamiltonian fluid dynamics ( and references therein ) . in jean - pierre franoise ,",
    "gregory  l. naber , and tsou  sheung tsun , editors , _ encyclopedia of mathematical physics _ ,",
    "pages 593  600 . academic press , oxford , 2006 .",
    "mp  calvo , a.  murua , and jm  sanz - serna . modified equations for odes . in _",
    "chaotic numerics : an international workshop on the approximation and computation of complicated dynamical behavior , deakin university , geelong , australia , july 12 - 16 , 1993 _ , volume 172 of _ contemp .",
    "_ , pages 6374 .",
    "amer mathematical society , 1994 ."
  ],
  "abstract_text": [
    "<S> in recent decades , there have been many attempts to construct symplectic integrators with variable time steps , with rather disappointing results . in this paper </S>",
    "<S> we identify the causes for this lack of performance , and find that they fall into two categories . in the first , the time step is considered a function of time alone , @xmath0 . in this case , backwards error analysis shows that while the algorithms remain symplectic , parametric instabilities arise because of resonance between oscillations of @xmath1 and the orbital motion . in the second category </S>",
    "<S> the time step is a function of phase space variables @xmath2 . in this case , the system of equations to be solved is analyzed by introducing a new time variable @xmath3 with @xmath4 . </S>",
    "<S> the transformed equations are no longer in hamiltonian form , and thus are not guaranteed to be stable even when integrated using a method which is symplectic for constant @xmath5 . </S>",
    "<S> we analyze two methods for integrating the transformed equations which do , however , preserve the structure of the original equations . </S>",
    "<S> the first is an extended phase space method , which has been successfully used in previous studies of adaptive time step symplectic integrators . </S>",
    "<S> the second , novel , method is based on a non - canonical mixed - variable generating function . </S>",
    "<S> numerical trials for both of these methods show good results , without parametric instabilities or spurious growth or damping . </S>",
    "<S> it is then shown how to adapt the time step to an error estimate found by backward error analysis , in order to optimize the time - stepping scheme . </S>",
    "<S> numerical results are obtained using this formulation and compared with other time - stepping schemes for the extended phase space symplectic method . </S>"
  ]
}