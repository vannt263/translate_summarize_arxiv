{
  "article_text": [
    "in many areas of stellar astrophysics , the effects of magnetic fields are small and may be safely ignored",
    ". however , certain classes of stars ( ap stars , flare stars , active m dwarfs , young stellar objects , etc  ) have non - negligible magnetic fields .",
    "observationally , these strong magnetic fields can significantly affect the equivalent widths of many spectral features normally used to determine stellar physical properties . a model spectrum with physical parameters @xmath1 } \\right)$ ] but which omits the effect of the magnetic field",
    "will not match the observed spectrum of a magnetic star with the same physical parameters .",
    "more perniciously , a non - magnetic synthetic spectrum with different physical parameters will likely provide a better fit to the observed data , injecting a bias into any study of these parameters or quantities derived from these parameters ( spectral type , age , mass etc  ) .",
    "the increasing sensitivity of current and future infrared spectrographs ( crires @xcite , triplespec @xcite , spex @xcite xshooter @xcite , igrins @xcite , gmtnirs @xcite , etc  ) permit observations of cooler , more embedded objects . unfortunately , magnetic fields affect infrared spectra more than visible spectra ( the magnitude of the magnetic broadening grows as @xmath2 , whereas doppler broadening scales with @xmath3 ) .",
    "magnetic fields affect line shapes in high resolution spectra , and affect equivalent widths of strong lines visisble in low resolution spectra , potentially biasing studies of objects only accessible at infrared wavelengths .",
    "therefore , accurate studies of magnetic stars require a spectral synthesis code which can handle magnetic effects .",
    "@xcite qualitatively described the splitting ( in wavelength and polarization ) of a spectral line under the influence of an external magnetic field .",
    "@xcite developed the quantum mechanical formulas to describe the zeeman effect on the spectrum of a parcel of emitting / absorbing material under the influence of a uniform magnetic field as a function of magnetic field strength , geometry , quantum mechanical properties of the transition , and stokes ( @xmath4 , @xmath5 , @xmath6 , and @xmath7 ) polarizations .",
    "in a stellar photosphere , the picture is not so simple .",
    "the observed spectrum of a star with a magnetic field is a complicated combination of light produced at different depths of the photosphere , in various polarizations , from different locations across the stellar disk , and at different orientations to the magnetic field . to complicate matters further",
    ", the propagation of polarized light in a magnetic medium requires careful attention to the stokes parameters .",
    "the evolution through the stellar atmosphere of each stokes parameter depends on the other stokes parameters as well as on polarized opacities , requiring any code hoping to solve this system of coupled differential equations to treat each of the stokes parameters as vector quantities .",
    "radiative transfer codes developed for the synthesis of large spectral regions ( moog @xcite , spectrum @xcite , synspec @xcite , synth @xcite , etc  ) , use various algorithms @xcite to solve the equation of radiative transfer and calculate only the emergent intensity ( stokes @xmath4 ) , and do not account for the interplay between the stokes vectors .    motivated by the study of magnetic fields in sunspots",
    ", @xcite offered a solution to the stokes vector equation of radiative transfer through a stellar atmosphere for a normal zeeman triplet .",
    "@xcite amended these basic equations to include magneto - optical effects with the addition of the faraday - voigt anomalous dispersion profile .",
    "@xcite then generalized the theory to anomalous zeeman patterns .",
    "further investigations into the radiative transfer of polarized radiation through a magnetic medium largely focused on improving computation speed via mathematically complex matrix calculations @xcite , calculating effects due to deviations from local thermodynamic equilibrium ( lte ) @xcite , and determining a quantum mechanical basis @xcite for the basic equations @xcite .",
    "many of these early formulations of the radiative transfer were useful primarily for detailed studies of single ( or small numbers of ) absorption lines .",
    "building on this early work , there are several more recent codes that account for the effects of magnetic fields and polarized radiative transfer ( cossam @xcite , zeeman2 @xcite , and synthmag @xcite ) which have been used to study stars with magnetic fields @xcite .",
    "moog @xcite is a widely used one - dimensional lte radiative transfer code with a suite of drivers often used to analyze stellar spectra .",
    "the moog driver ` synth ` uses stellar atmosphere models together with atomic and molecular line parameters to produce high resolution synthetic emergent spectra . in this paper ,",
    "i present a customization of moog called moogstokes , which permits moog to account for the major effects of zeeman splitting of spectral lines .",
    "moogstokes traces the polarized stokes components though a magnetic stellar photosphere with a uniform magnetic field , producing a disk - averaged spectrum suitable for comparison with observed spectra .",
    "building the vector radiative transfer package into the familiar framework of moog lowers the potential barrier into studies of magnetic fields to an existing broad community of stellar spectroscopists .",
    "additionally , while zeeman broadening of absorption lines in infrared spectra can make accurate determinations of @xmath8 and @xmath9 impossible for scalar codes ( codes which do not solve the stokes vector equation of radiative transfer ) , armed with a polarized radiative transfer zeeman code , the same data can not only constrain temperature and surface gravity more accurately , but also provide a measure of magnetic field strength .",
    "finally , all spectral synthesis codes make certain assumptions ( e.g. their chosen analytic approximation for solving the equation of radiative transfer ) and a code which makes different assumptions from other polarized radiative transfer codes , or calculates relevant quantities in different manners can serve as a foil to help elucidate the consequences of those assumptions and the robustness of results @xcite . in the subsequent paper",
    "i give a brief introduction to the theoretical concepts involve in polarized radiative transfer in  [ sec : theory ] . in ",
    "[ sec : procedure ] , i describe the algorithmic structure of the moogstokes suite of software .",
    " [ sec : verification ] describes the results of various verification tests and benchmarks , and in  [ sec : discussion ] , i discuss possible applications of moogstokes , including an illustration of @xmath8 bias caused by neglecting the effects of magnetic fields .",
    "before describing the moogstokes algorithm in detail , i summarize the relevant theoretical concepts and formulas involved in accounting for the effects of magnetic fields in a synthetic spectrum .",
    "this summary is not intended to be an exhaustive theoretical introduction , but should be sufficient to allow discussion of the algorithms in moogstokes .",
    "there are excellent and thorough discussions of this material in @xcite , @xcite , and @xcite ( hereafterward referred to as pk02 ) .",
    "the zeeman effect describes the behavior of spectral absorption or emission lines under the influence of an external magnetic field . in the absence of a magnetic field ,",
    "the states associated with different magnetic quantum numbers ( @xmath10 ) of an atomic state ( corresponding to the eigenvalues of the angular momentum vector @xmath11 projected along the @xmath12 axis ) are degenerate in energy .",
    "an external magnetic field breaks the degeneracy between the eigenstates into @xmath13 sublevels ( denoted by @xmath14 ",
    "@xmath15 ) . for a transition between two atomic states , the total number of zeeman components into which a spectral line will split depends on the @xmath11 of the upper state , @xmath11 of the lower state , and the electric dipole selection rules ( @xmath16 , @xmath17 if @xmath18 , @xmath19 , @xmath20 ) . the shift in energy for a given eigenvalue @xmath10 is given by @xmath21 , where @xmath22 is the land factor , @xmath23 is the bohr magneton , and @xmath24 is the strength of the magnetic field .",
    "the shift in energy for a photon emitted between state @xmath25 and @xmath26 is therefore @xmath27 .",
    "zeeman components with @xmath28 are known as @xmath29 components , and correspond classically to a charge oscillating along the axis of the magnetic field .",
    "@xmath29 components emit radiation linearly polarized the direction of the magnetic field .",
    "zeeman components with @xmath30 are known as @xmath31 components , and correspond classically to a charge in a right ( left ) hand circular orbit around the magnetic field vector ( according to the iau definition of stokes v ) .",
    "@xmath31 components emit right ( left ) hand circularly polarized radiation along the field lines as well as linearly polarized radiation in transverse directions . in the following discussion , quantities related to @xmath29 components are denoted by a @xmath32 subscript , while quantities related to @xmath33 components are denoted by @xmath34lue and @xmath35ed , signifying the direction of wavelength shift .",
    "equation [ eq : normalizations ] ( adapted from equations 1 - 3 in section @xmath36 of condon & shortley ( 1935 ) ) describes the relative intensities @xmath37 of zeeman components as a function of @xmath38 and @xmath39 @xcite of the initial ( lower ) state .",
    "while the zeeman effect describes the effect of a magnetic field on electric dipole transitions and the resultant radiation , still more theory is required to describe the transfer of that radiation through a magnetized stellar photosphere . in the following discussion , i adopt the geometrical convention described in figure [ fig : angles ] ( derived from figure 2 of pk02 ) , where @xmath41 is the angle the local magnetic field makes with the observer s line of sight , where @xmath42 is the clocking angle of the magnetic field projected onto the plane of the sky as measured from the @xmath43 direction , and where @xmath44 is the viewing angle measured between the line - of - sight and the local normal to the stellar surface .",
    "the different polarizations of the zeeman component require the use of the stokes vector @xmath45 , where @xmath46 , @xmath47 , @xmath48 , and @xmath49 describe respectively the total intensity , two orthogonal linear polarization intensities , and one circular polarization intensity .",
    "the @xmath50 emphasizes that @xmath51 is a column vector .",
    "the equation of radiative transfer now takes vector form :     is defined as the angle between the line - of - sight and the magnetic field @xmath52 , while @xmath42 is the clocking angle of the magnetic field projected onto the plane of the sky , as measured from the @xmath43 direction .",
    "the coordinate system is usually defined so that @xmath53 points toward north and @xmath54 points toward the observer .",
    "the viewing angle @xmath44 is measured between the line - of - sight and the local surface normal.,width=340 ]    @xmath55    where @xmath56 , @xmath57 is the optical depth , @xmath58 is the opacity matrix , and @xmath11 is the emission vector , each computed at the wavelength of interest . the opacity matrix @xmath58 ( equation [ eq : opacitymatrix ] , first introduced by @xcite and later modified by @xcite ) describes the interaction between the intensities of different stokes components .    @xmath59    where @xmath60 is the continuum opacity , @xmath61 is the line opacity due to non - hydrogen absorbers / emitters , and @xmath62 is the total opacity .",
    "the @xmath63 matrix is comprised of @xmath63 ( equation [ eq : phi_opacity ] ) and @xmath64 ( equation [ eq : psi_opacity ] ) matrix elements :    @xmath65    @xmath66    the @xmath63 matrix elements ( equations [ eq : phi_opacity ] ) are comprised of absorption profiles ( @xmath67 , equation [ eq : phi_bpr ] ) , while the @xmath64 matrix elements ( equations [ eq : psi_opacity ] ) are composed of anomalous dispersion profiles ( @xmath68 , equation [ eq : psi_bpr ] ) resulting from magneto - optical effects .",
    "synstokes calculates @xmath69 and @xmath70 profiles for all zeeman components that contribute significantly at the current wavelength .",
    "all @xmath71 , @xmath72 , @xmath73 , @xmath67 , and @xmath68 implicitly depend upon the current wavelength of interest .",
    "@xmath74    @xmath75    the @xmath76 coefficients reflect the relative strengths of different zeeman components ( equation [ eq : normalizations ] ) , and are normalized so that :    @xmath77    in the nonmagnetic case , there are no wavelength shifts , meaning @xmath78 ( the absorption profile of the unsplit line ) , and all @xmath79 and @xmath73 are zero due to the opposite signs of the @xmath29 and @xmath31 components . in @xmath80 , however , the @xmath29 and @xmath31 components add , giving @xmath81 , and the opacity matrix @xmath82 collapses to the non - magnetic scalar case ( @xmath83 )    @xmath84 and @xmath85 are respectively the voigt and faraday - voigt functions which describe the absorption and anomalous dispersion profiles as a function of line damping coefficients @xmath86 and distance from the absorption line center @xmath87 in terms of the doppler width for the current absorber species .",
    "the @xmath63 matrix is also used to calculate the emission vector @xmath11 , given by equation [ eq : emissionvector ] , assumes both the continuum and line emission are in local thermodynamic equilibrium , and calculates @xmath88 , where @xmath52 is the planck function , and @xmath89 is the temperature of the @xmath90 layer of the atmosphere .",
    "@xmath91    where @xmath92 is a column vector .",
    "as described in the subesquent section , moogstokes now uses the quantities and variables discussed here to solve the stokes vector equation of radiative transfer ( equation [ eq : radtran ] ) and calculate the emergent spectrum , tracing the stokes vectors from the base of the photosphere to the top using the diagonal lambda element operator ( delo ) method .",
    "moogstokes contains three packages .",
    "a absorption line pre - processor , a moog driver , and a disk - integration post - processor .",
    "the pre - processor ( named counterpoint , see section [ sec : counterpoint ] ) calculates the number , polarization , and wavelength shift of zeeman components into which each line splits , given a magnetic field strength .",
    "the moog driver ( named synstokes , see section [ sec : moogstokes ] ) takes the zeeman - split line list together with a model atmosphere and magnetic field geometry , and calculates the emergent spectrum at many different locations across the stellar disk .",
    "the post - processing algorithm ( named diskoball , see section [ sec : diskoball ] ) then weights the emergent spectrum of each location on the disk by its projected area and limb darkening , applies a doppler shift due to stellar rotation , and calculates the disk - averaged spectrum as seen by an observer .",
    "algorithm [ alg : moogstokes ] shows a pseudocode representation of the suite of three programs .",
    "i have developed a python code called counterpoint to pre - process absorption lines and account for the zeeman effect prior to input into moog . given a magnetic field strength and quantum mechanical constants for the transition ( @xmath93 ) , the program calculates the number and polarization into which the line will split , the relative intensities of the components , and the component energy ( wavelength ) shifts . from an initial linelist retrieved from vald @xcite counterpoint produces an entry in a moog - readable line list for each zeeman component , containing the following information : central wavelength , relative oscillator strength , atomic species and ionization state , excitation potential , damping factors if known ( i.e. @xmath94 ) , and change in magnetic quantum number @xmath95 . because the intensity of a spectral line is directly proportional to the oscillator strength , i change the @xmath96 value of each zeeman component to match the relative intensities predicted by quantum mechanics @xcite , similar to common practices in studies of hyperfine structure .",
    "i perform the normalization ( see equation [ eq : normalization ] ) here so that the sum of the oscillator strengths of all like - polarized components for a line equals the oscillator strength of the unsplit line .",
    "the first part of algorithm [ alg : moogstokes ] describes the logic of the counterpoint program .    as an example",
    ", counterpoint calculates the zeeman splitting of a singly ionized iron line under the influence of a @xmath97 kg magnetic field in the following manner : the @xmath98 fe line is a dipole transition between a @xmath99 lower state ( @xmath100 ) and a @xmath101 upper state ( @xmath102 ) , with an oscillator strength of @xmath103 and a lower state energy of @xmath104 ev .",
    "the land @xmath22 factors of the lower and upper states are @xmath105 and @xmath106 , respectively .",
    "the magnetic field will split the lower state into @xmath107 levels , and the upper state into @xmath108 levels .",
    "application of the electric dipole selection rules determines that there will be four @xmath29 components , and eight @xmath31 components .",
    "the relative intensities and relative oscillator strengths of the @xmath29 and @xmath31 components are given in table [ tab : zeeman_example ] .",
    "@xmath109 & 1 & -2.621 + @xmath110 & 4923.8025 & 2.891 & @xmath111 & 3 & -2.144 + @xmath110 & 4923.8251 & 2.891 & @xmath112 & 6 & -1.843 + @xmath110 & 4923.8478 & 2.891 & @xmath113 & 10 & -1.621 + @xmath29 & 4923.8930 & 2.891 & @xmath114 & 4 & -2.019 + @xmath29 & 4923.9157 & 2.891 & @xmath115 & 6 & -1.843 + @xmath29 & 4923.9383 & 2.891 & @xmath116 & 6 & -1.843 + @xmath29 & 4923.9610 & 2.891 & @xmath117 & 4 & -2.019 + @xmath118 & 4924.0062 & 2.891 & @xmath119 & 10 & -1.621 + @xmath118 & 4924.0289 & 2.891 & @xmath120 & 6 & -1.843 + @xmath118 & 4924.0515 & 2.891 & @xmath121 & 3 & -2.144 + @xmath118 & 4924.0741&2.891 & @xmath122 & 1 & -2.621 +      i describe here the general framework of synstokes , the fortran driver i added to the moog spectral synthesis programs .",
    "the second part of algorithm [ alg : moogstokes ] describes in pseudocode the algorithm for the moog driver ` synstokes ' : synstokes ( synstokes.f ) begins by reading in a parameter file ( params.f ) .",
    "the parameter file describes ( among other common moog inputs ) the number of regions into which the stellar surface will be divided , the desired starting and ending synthesis wavelength , the desired model atmosphere file , and the location of the linelists .",
    "moogstokes then reads in the model atmosphere ( inmodel.f ) and list of absorption lines ( inlines.f ) . after calculating the absorber number density ( eqlib.f ) ,",
    "it calculates the populations of absorbers at each layer of the atmosphere , line center opacities ( nearly.f ) , and polarized opacities ( calcopacities.f ) .",
    "synstokes then creates a list of lines which contribute significantly to the opacity ( wavegrid.f ) , neglecting lines which are too weak due to insufficient opacity in the supplied model atmosphere ( e.g. an o ii line will not contribute significant opacity in a cool atmosphere , as negligible amounts of oxygen will be ionized ) .",
    "synstokes will finely sample the region around strong lines to resolve their shapes , and coarsely sample regions with no strong lines .",
    "then the program divides the stellar surface into different regions . for each region ,",
    "the program calculates the local orientation of the magnetic field relative to the observer ( calcgeom.f ) , and calculates the emergent spectrum ( complexvoigt.fspline.f , splinedriver.f , curfit.f , deloquad.f ) , one wavelength point at a time , writing the each spectrum to the output file .",
    "the program then moves on to the next region . to keep track of the additional variables required by polarzied radiative transfer ,",
    "moogstokes adds or modifies the following common blocks to the existing moog : angles.com , atmos.com , linex.com , and stokes.com .    in the current implementation",
    ", synstokes adopts a uniform radial geometry for the magnetic field , primarily for its simplicity . in future versions of the code",
    ", the user will be able to specify other magnetic field geometries , as well as multi - temperature atmospheres ( as in the case of a stellar spot ) .",
    "@xmath123 read in magnetic field strength @xmath124 , @xmath125 read in vald line list write zeeman split lines to moog - readable line list @xmath126 read in parameter file ( @xmath127 , @xmath125 ) read in model atmosphere (  [ sec : atmosphere ] ) read in line list (  [ sec : inlines ] ) solve boltzmann / saha eqns for each species , layer (  [ sec : eqlib ] ) calculate line center opacities for each transition layer divide stellar surface into regions (  [ sec : tiles ] )    @xmath128 read in spectra , @xmath127 , @xmath44 , @xmath41 , @xmath42 save composite spectrum      the model atmosphere gives synstokes the temperature , pressure , and density profiles of the photospheric region as functions of the optical depth .",
    "i opt not to include the effects of magnetic pressure on the atmospheric structure .",
    "future versions of the code may explicitly address the issue of magnetic pressure .      the original scalar version of moog , using a routine in inlines.f ,",
    "reads information regarding absorption lines from a file , where each line of the file contains the following information : wavelength of the transition @xmath3 ( in @xmath129 or @xmath130 m ) , atomic ( or molecular ) species , energy of the lower state ( in electron volts ) , oscillator strength of the transition , van der waals damping coefficient , and molecular dissociation energy ( only for molecular lines ) .",
    "i modified the inlines routine to accept three additional paramters : @xmath131 , @xmath132 , and @xmath133 .",
    "the change in angular momentum @xmath131 as calculated by counterpoint , allows synstokes to identify @xmath29 and @xmath134 zeeman components . @xmath132 and @xmath133 are damping constants related to radiative and stark broadening , respectively .",
    "synstokes then uses the existing machinery of moog to solve the classical boltzmann and saha equations to calculate the number of absorbers of each species and lower energy state at each layer of the atmosphere , assuming lte .",
    "the number of absorbers in turn allows the calculation of the line - center opacity @xmath61 for each line in the line list",
    ". a non - lte calculation would include radiative and density effects @xcite , and would slightly affect the line opacity and source function , but the lte approximation is frequently made by other stellar radiative transfer codes @xcite .",
    "the emergent spectrum of a magnetic star is a function of the geometry of the magnetic field , the stellar photosphere , and the observing angle .",
    "synstokes provides the user two strategies for synthesizing disk - averaged spectra .",
    "the first strategy ( described in pk02 ) divides the stellar surface into a number of approximately equal - area tiles .",
    "the user can specify the inclination and clocking angle of the stellar rotation axis , and can control the tile size by specifying in the moog parameter file the number of total tiles and number of latitude belts .",
    "for each tile , synstokes calculates the angles @xmath41 and @xmath42 for the center of the tile , as well as the viewing angle @xmath44 ( see figure [ fig : angles ] ) . @xmath41 and @xmath42 are calculated using the orientation of the local magnetic field ( assumed to be uniform and radial , and hence @xmath135 ) relative to the observer .",
    "if the viewing angle @xmath44 implies that the center of the tile is visible to the observer ( @xmath136 ) , synstokes calculates the emergent spectrum .",
    "this first strategy produces emergent spectra for all four stokes parameters , but due to the large number of tiles necessary for calculation of an accurate average flux , can be quite slow .",
    "the second strategy available to the user is to divide the stellar disk into a number of annuli , and calculate the emergent stokes i and v spectra for each annulus at the stellar equator . while significantly faster , this strategy only produces disk - averaged spectra for stokes i and v ( due to the azimuthal dependence of stokes q and u ) .      in order to calculate @xmath58 for a wavelength @xmath3 and atmospheric layer @xmath137 , synstokes first calculates the total @xmath67 ( equations [ eq : phi_opacity ] ) and @xmath68 opacities ( equations [ eq : psi_opacity ] ) summed over all lines in the line list which contribute significant opacity at @xmath3 . as the original scalar version of moog contained only a formula for the voigt profile @xcite",
    ", i include in synstokes the algorithm from @xcite to calculate both the voigt and faraday - voigt profiles .",
    "equipped with the individual polarized opacities and the geometry of the magnetic field , synstokes calculates the individual elements of the opacity matrix @xmath58 ( see equation [ eq : opacitymatrix ] ) and of the emission vector @xmath11 ( see equation [ eq : emissionvector ] ) .",
    "synstokes then constructs a sequence of opacity matrices and emission vectors calculated at each layer of the atmosphere .",
    "synstokes must also keep track of the line and continuum optical depths to calculate an emergent spectrum .",
    "the optical depth given in the model atmosphere file is a reference optical depth ( often measured at either a reference wavelength , or a rosseland mean opacity ) .",
    "moog converts this reference optical depth to an optical depth at the current wavelength @xmath3 and atmospheric layer @xmath137 using @xmath60 and @xmath138",
    ". however , moog does not calculate the physical depth through the atmosphere ( a quantity required by the delo algorithm in  [ sec : delo_int ] ) , so synstokes must caclculate this quantity . adopting @xmath139 for the line optical depth and @xmath140 for the continuum optical depth at the current wavelength @xmath3 ,",
    "synstokes converts the reference optical depth given in the model atmosphere to a physical depth into the photosphere by integrating the equivalent equation for the reference optical depth @xmath141 .",
    "calculation of @xmath142 and @xmath60 then allows synstokes to calculate line and continuum optical depths at the current atmospheric layer and wavelength @xmath3 .      the scalar version of moog employes a formal integrative methodology to obtain contribution functions which are subsequently used to calculate the emergent intensity at a given wavelength @xcite .",
    "to account for the exchange of light between different stokes vectors , it becomes necessary to solve the stokes vector equation of radiative transfer ( equation [ eq : radtran ] ) through the atmosphere of the star .",
    "the most straight - forward method of solving this system of differential equations is a brute - force runge - kutta algorithm @xcite .",
    "however , while accurate , runge - kutta algorithms are quite computationally intensive . even given the numerous folding - length times of moore s law between the computers available to @xcite and the computers of today , the time required to synthesize all but the smallest of wavelength intervals becomes prohibitively long .",
    "for this reason , i adopt the diagonal element lambda operator ( delo ) method of @xcite .",
    "this method slightly modifies equation [ eq : radtran ] , allowing the propagation of the stokes @xmath51 vector to be treated as a linear relation between adjacent points in the stellar atmosphere ( see equations [ eq : delo ] ) . to improve the accuracy of this algorithm , i use the quadratic formula @xmath143 for the emission vector @xmath144 employed by @xcite , @xcite , @xcite , and pk02 . for a more detailed discussion of the delo algorithm and definitions of the constants contained in equations [ eq : delo ] , i refer the reader to the excellent treatments in @xcite , @xcite , and in pk02 .",
    "synstokes sub - samples each decade of @xmath145 by steps of @xmath146 dex , to trace each stokes vector from the base ( @xmath147 ) to the top ( @xmath148 ) .",
    "i assume the radiation originating at the base of the photosphere to be initially unpolarized and in lte ( @xmath149 ) .",
    "i then calculate the emergent continuum by setting all non - continuum sources of opacity to zero and performing the same delo integration .",
    "the moogstokes implementation of the delo algorithm uses the atlas and lapack linear algebra packages @xcite , as well as the numerical recipes implementation of cubic splines @xcite .",
    "@xmath150      synstokes calculates an emergent spectrum for each tile of stellar surface visible to the observer .",
    "synstokes saves each individual spectrum ( in stokes i , q , u , v , and continuum ) , along with a description of its geometry ( @xmath151 ) for post - processing ( as described in the subsequent section ) .",
    "once synstokes has calculated emergent spectra from the stellar tiles visible to the observer , the individual spectra must then be averaged together to produce the final disk - averaged spectrum . for this purpose ,",
    "i have created a python post - processing script called diskoball .",
    "diskoball reads emergent spectra from the output files created by synstokes , and combines them into a single disk - averaged spectrum .",
    "if the spectra correspond to tiles covering the entire stellar surface , diskoball calculates the disk - averaged spectrum by weighting the flux of each tile by the limb darkening (  [ sec : limbdarkening ] ) and projected area of the tile (  [ sec : projarea ] ) , and shifting the wavelength by the appropriate doppler velocity (  [ sec : doppshift ] ) , given the source geometry ( inclination and clocking angle ) .",
    "diskoball then saves a composite spectrum for each stokes parameter .",
    "if instead , the spectra correspond to annuli , diskoball produces a composite spectrum by convolving the spectrum of each annulus with a rotation kernel and weighting by annular area and limb darkening ( [ sec : limbdarkening])@xcite .",
    "i use the simple power - law limb darkening prescription from @xcite , primarily for its simplicity . as",
    "the limb darkening effect is wavelength dependent , diskoball calculates the limb darkening coefficient for the mean wavelength , and applies it to the entire spectrum .",
    "while newer limb darkening laws can produce more accurate results , the @xcite law provides sufficient accuracy for the initial release of the program .",
    "diskoball weights the emergent spectrum coming from each one of the surface tiles by the projected area , as seen by the observer .",
    "the projected area is the surface area ( @xmath152 ) multiplied by the cosine of the viewing angle ( @xmath56 ) .",
    "diskoball allows the user to provide a rotational velocity @xmath153 for the requested composite spectrum .",
    "together with the source geometry , diskoball calculates the appropriate @xmath154 for the spectrum from each element on the stellar disk and applies the corresponding red or blue shift , before coadding with the other spectra .",
    "this feature allows the user to re - process a single output of synstokes with any number of arbitrary stellar rotational velocities .",
    "before trusting the predictions of any spectral synthesis code , the code must reproduce to high accuracy the calculations of other well - tested spectral synthesis codes under identical input conditions . to verify that the code can accurately synthesize spectra when no magnetic fields are present , i check the emergent stokes i calculated by moogstokes against that of its predecessor , moog . after successfully proving moogstokes",
    "introduces no major deviations , i then check the code against the magnetic profiles provided in @xcite .",
    "moogstokes uses the existing software framework of moog to support a completely different spectral synthesis engine . to verify that the chassis of moog is properly connected to its new engine",
    ", i have tested that moogstokes produces the same result as the original moog in the non - magnetic limit . for this test ,",
    "i synthesize emergent central intensity ( figure [ fig : diff_mu_1 ] , @xmath155 ) produced by the fe ii line described in table [ tab : zeeman_example ] with an atlas9 model atmosphere @xcite .",
    "there are small differences on the order of @xmath156 of the continuum .",
    "these differences are likely due to small numerical differences between the delo and contribution function algorithms , both approximate analytical solutions to the radiation transport equation .",
    "the profiles produced by the two codes agree to a level where errors in the spectrum will be dominated by uncertainties in the parameters of the transitions being modeled .    ) by the @xmath157 fe ii line in an atlas9 model atmosphere ( @xmath158 ) with the magnetic field set to zero .",
    "the top portion shows the difference between the profile produced by moogstokes and that produced by moog , in units of the continuum.,width=340 ]      the most important test of a polarized radiative transfer code is a synthesis of a transition under the influence of a strong magnetic field .",
    "figure 4 of @xcite shows stokes iquv profiles produced by the fe ii line described in table [ tab : zeeman_example ] under the influence a magnetic fields of strength @xmath159 , @xmath97 , and @xmath160 , as calculated by the invers10 polarized radiative transfer code .",
    "invers10 makes use of the more accurate feautrier algorithm @xcite , while moogstokes uses the quadratic delo algorithm @xcite .",
    "figure [ fig : wade_comp ] shows a comparison of the predictions of moogstokes with the profiles provided in @xcite . while the differences between moogstokes and invers10 ( @xmath161 ) are larger than those between moog and moogstokes ( @xmath162 ) , they are still small enough that other uncertainties in the creation of synthetic spectra ( model atmospheres , oscillator strengths , etc  ) will dominate the errors in any comparisons to real observations .    ) produced under identical input conditions ( atlas9 model atmosphere : @xmath158 ) by moogstokes and invers10 .",
    "each of the four panels shows the percentage difference ( in units of the continuum ) between the predictions of moogstokes and the profiles shown in figure 4 of @xcite .",
    "the different lines correspond to different magnetic field strengths ( red dotted@xmath163 , black dashed@xmath164 , blue solid@xmath160).,width=340 ]",
    "i have described the necessary steps to modify an existing scalar spectral synthesis code to account for the major effects produced by zeeman splitting and polarized radiative transfer .",
    "the result of these modifications , moogstokes , is sufficient for the study of the behavior of absorption line shapes and equivalent widths under the influence of changes in the physical parameters of the photosphere ( @xmath8 , @xmath165 , and @xmath24 ) .",
    "i have attempted to make the interface of moogstokes similar and complementary to that of the original moog program , allowing observers and stellar spectroscopists already familiar with moog to make the transition to studying magnetic fields .    as intimated in the introduction ,",
    "neglecting the effects on spectra of strong magnetic fields can affect conclusions drawn from the spectra .",
    "the damping wings and widths of certain absorption lines are frequently used to determine certain physical parameters ( surface gravity , microturbulence , @xmath154 , etc  ) .",
    "the equivalent widths of other lines are often used to constrain other parameters ( effective temperature , metallicity , etc  ) .",
    "weak optically thin lines , which are in the linear portion of the curve of growth change their shapes under the influence of a magnetic field , but do not change appreciably in equivalent width .",
    "strong optically thick lines change shape as well , but also increase in equivalent width , due to the saturation of the individual zeeman components in the logarithmic portion of the curve of growth . while changes in line shape only become noticeable at high spectral resolution , changes in equivalent widths of strong lines affect spectra of all resolutions ( and hence the aforementioned properties derived from them ) .    as an illustration of the magnitude of the effect that strong magnetic fields can have on the appearance of the emergent spectrum of a star",
    "as observed by a normal spectrograph ( stokes i ) , figure [ fig : beffect ] shows a comparison between three synthetic spectra of the sodium doublet at @xmath166 m convolved to @xmath167 . for late - type stars , the equivalent width of the sodium doublet is often used in determining spectral type and veiling ( excess continuum emission due to hot circumstellar dust ) . the first spectrum ( black solid line )",
    "is a spectrum generated with parameters appropriate for a low mass young stellar object ( @xmath168 , @xmath169 , and average magnetic field strength of @xmath170 ) .",
    "converting effective temperature to spectral type , this corresponds to a spectral type of roughly k7 @xcite .",
    "the second spectrum ( red dashed line ) shows a spectrum generated with parameters appropriate for a young non - magnetic k7 star ( @xmath171 , @xmath169 , and no magnetic field ) .",
    "the third spectrum ( blue dotted line ) is a spectrum of a young non - magnetic m1.5 star ( @xmath172 , @xmath169 , no magnetic field ) .",
    "the equivalent width of the sodium doublet in the m1.5 star matches the equivalent width of the magnetic young star better than the k7 star , even though its effective temperature is @xmath173 cooler .",
    "astronomers often determine ages and masses of young stellar objects by comparing their locations on the hr diagram to evolutionary models @xcite .",
    "an error in effective temperature of the magnitude displayed in this example can result in errors in the derived age of several million years and errors several tenths of @xmath174 in the derived stellar mass , introducing biases into studies of young stellar object properties ( i.e. lifetimes of circumstellar disks , initial mass functions , etc  ) .",
    "while magnetic fields can make determining stellar parameters from individual or small numbers of absorption lines difficult , not all lines are affected equally by the zeeman effect . in subsequent investigations ,",
    "i will use moogstokes , along with this fact , as tools to determine physical parameters ( @xmath175 magnetic field strength ) of stars with magnetic fields .    ) and two non - magnetic spectra .",
    "the spectra are shown in the bottom of the figure , and have been convolved down to spectral typing resolution ( @xmath176 ) .",
    "the top portion of the figure shows the differences between the magnetic spectrum and the two non - magnetic ones in percentage of continuum .",
    "the spectrum with the same effective temperature ( blue dashed line ) provides a worse fit to the magnetic spectrum , width=340 ]        during the development of this code , i became indebted to many experts in radiative transfer , polarized or otherwise .",
    "chris sneden , rob robinson , dan jaffe , john lacy , christopher johns - krull , cornelis dullemond , oleg kochukhov , and juan manuel borrero all provided invaluable advice and suggestions .",
    "i wish to also thank the anonymous referee , whose comments and suggestions improved the manuscript .",
    "this work was begun under a nasa usra sofia grant .",
    "all portions of the moogstokes package ( counterpoint , synstokes , and diskoball ) are available upon request from the author or from the author s http://www.mpia.de/~deen/[website ] .                                , h .- u . , ballester , p. , biereichel , p. , et  al .",
    "2004 , in society of photo - optical instrumentation engineers ( spie ) conference series , vol . 5492 , society of photo - optical instrumentation engineers ( spie ) conference series , ed .",
    "a.  f.  m. moorwood & m.  iye , 12181227                  , s. , yuk , i .- s . , lee , h. , et  al .",
    "2010 , in society of photo - optical instrumentation engineers ( spie ) conference series , vol . 7735 , society of photo - optical instrumentation engineers ( spie ) conference series                                      , m.  j. , & alecian , g. 2001 , in astronomical society of the pacific conference series , vol .",
    "248 , magnetic fields across the hertzsprung - russell diagram , ed .",
    "g.  mathys , s.  k. solanki , & d.  t. wickramasinghe , 377      , j.  a. , & johns - krull , c. 2001 , in astronomical society of the pacific conference series , vol .",
    "248 , magnetic fields across the hertzsprung - russell diagram , ed .",
    "g.  mathys , s.  k.  solanki , & d.  t.  wickramasinghe , 179+          , w.  w. , ryabchikova , t.  a. , kupka , f. , et  al .",
    "2000 , in astronomical society of the pacific conference series , vol .",
    "203 , iau colloq . 176 : the impact of large - scale surveys on pulsating star research , ed .",
    "l.  szabados & d.  kurtz , 487488      , j.  c. , henderson , c.  p. , herter , t.  l. , et  al .",
    "2004 , in society of photo - optical instrumentation engineers ( spie ) conference series , vol .",
    "5492 , society of photo - optical instrumentation engineers ( spie ) conference series , ed .",
    "a.  f.  m. moorwood & m.  iye , 12951305"
  ],
  "abstract_text": [
    "<S> in an attempt to widen access to the study of magnetic fields in stellar astronomy , i present moogstokes , a version of the moog one - dimensional lte radiative transfer code , overhauled to incorporate a stokes vector treatment of polarized radiation through a magnetic medium . </S>",
    "<S> moogstokes is a suite of three complementary programs , which together can synthesize the disk - averaged emergent spectrum of a star with a magnetic field . </S>",
    "<S> the first element ( a pre - processing script called counterpoint ) calculates for a given magnetic field strength , wavelength shifts and polarizations for the components of zeeman sensitive lines . </S>",
    "<S> the second element ( a moog driver called synstokes derived from the existing moog driver synth ) uses the list of zeeman shifted absorption lines together with the existing machinery of moog to synthesize the emergent spectrum at numerous locations across the stellar disk , accounting for stellar and magnetic field geometry . </S>",
    "<S> the third and final element ( a post - processing script called diskoball ) calculates the disk - averaged spectrum by weighting the individual emergent spectra by limb darkening and projected area , and applying the effects of doppler broadening . all together , the moogstokes package allows users to synthesize emergent spectra of stars with magnetic fields in a familiar computational framework . </S>",
    "<S> moogstokes produces disk - averaged spectra for all stokes vectors ( @xmath0 ) , normalized by the continuum . </S>",
    "<S> moogstokes agrees well with the predictions of invers10 a polarized radiative transfer code with a long history of use in the study of stellar magnetic fields . in the non - magnetic limit </S>",
    "<S> , moogstokes also agrees with the predictions of the scalar version of moog . </S>"
  ]
}