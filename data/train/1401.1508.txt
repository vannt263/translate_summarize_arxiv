{
  "article_text": [
    "a long - standing goal of astronomy has been to understand the structure and formation of galaxies .",
    "studies of external galaxies have begun to paint a detailed , global picture of the forces at work in shaping galaxies , but lack the resolution and sensitivity to probe individual stars . in the milky way , meanwhile , measurements of the positions and types of millions of stars have been assembled , though these stars probe only a fraction of our galaxy s volume . moreover , the positions of these stars are especially uncertain in the galactic disk , where the bulk of the stars reside , owing to the presence of dust , which obscures and reddens the light from these stars .    accordingly , wide - field surveys like the sloan digital sky survey ( sdss ; * ? ? ?",
    "* ) , which observed millions of stars , have focused on the structure of the stars at high galactic latitudes , mostly outside the galactic disk ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "these studies have revealed an abundance of substructure in the galactic halo @xcite , and have led to new constraints on the structure of the galaxy s halo ( e.g. , * ? ? ? * ) and the identification of challenges to the standard picture of galaxy formation ( e.g. , the missing satellites problem , * ? ? ?",
    "still , the bulk of the galaxy s stars reside and formed in the disk , and it is unclear how much the galaxy s halo can inform the processes at work there . @xcite",
    "derive smooth models for the galactic disk , using sub - populations observed in the sloan extension for galactic understanding and exploration ( segue ; * ? ? ?",
    "better photometric distance estimates for large , magnitude - limited samples of heavily dust - obscured stars will aid investigation into the smooth structure of the disk , as well as possible disk substructure .",
    "this paper presents a technique to simultaneously infer the distances and reddenings to stars embedded in dust , to enable study of the properties and structure of our galaxy s disk from optical surveys of resolved stars .",
    "we exploit prior knowledge of the types and distribution of stars in the galaxy in a bayesian framework to deliver the full probability density function of distance and reddening and stellar type for each star .",
    "we derive a principled bayesian technique to infer reddening as a function of distance , using stars as tracers of the dust column .",
    "we are not the first in this area .",
    "@xcite produced a 3d extinction map of the galactic plane by comparing the 2mass @xmath4 stellar colors to those of simulated catalogs based on the besanon model of the galaxy @xcite .",
    "our work is most similar to that of @xcite , who presents related techniques and applies them to simulated iphas data @xcite .",
    "the method presented here for obtaining stellar reddenings and distances is also related to that of @xcite , who highlight the large amount of 3d structure in the galaxy s dust using data from sdss .",
    "the work of @xcite , likewise , presents a similar technique using broad - band photometry and hipparcos parallaxes @xcite . @xcite and @xcite map out the 3d distribution of clouds in the local bubble by measuring absorption lines imprinted by the interstellar medium on the spectra of stars with hipparcos parallaxes .",
    "@xcite uses @xmath5 stellar parallaxes and reddening estimates from a number of sources to infer the 3d distribution of dust opacity out to @xmath6 - @xmath7 in the plane of the galaxy , and @xmath8 out of the plane .",
    "our work differentiates itself from these primarily in that it is adapted to studying the approximately one billion stars with high - quality pan - starrs 1 ( ps1 ) photometry , which cover three quarters of the sky and two thirds of the galactic plane , representing an unprecedented resource for studies of the galaxy s disk .",
    "the paper is organized as follows .",
    "[ sec : ps1 ] describes the pan - starrs 1 survey",
    ". section ",
    "[ sec : los - formalism ] develops the bayesian formalism required to produce a three - dimensional reddening map",
    ". sections  [ sec : likelihoods ] and  [ sec : priors ] describe the stellar and galactic models we employ .",
    "[ sec : sampling ] describes the practical implementation of our model to produce a 3d map .",
    "then , in section ",
    "[ sec : tests ] , we conduct tests of our method with mock photometry , and in section  [ sec : comparison - with - data ] , we validate our model with real photometry .",
    "in this work we derive the distances and reddenings to stars observed by pan - starrs 1 .",
    "pan - starrs 1 is a 1.8-meter optical and near - infrared telescope located on mount haleakala , hawaii @xcite .",
    "the telescope is equipped with the gigapixel camera 1 ( gpc1 ) , consisting of an array of 60 ccd detectors , each 4800 pixels on a side @xcite .",
    "the majority of the observing time is dedicated to a multi - epoch @xmath0 steradian survey of the sky north of @xmath9 ( chambers in prep . ) .",
    "the @xmath0 survey observes in five passbands @xmath10 , @xmath11 , @xmath12 , @xmath13 , and @xmath14 , which together span 4001000  nm @xcite .",
    "the images are processed by the pan - starrs 1 image processing pipeline ( ipp ) @xcite , which performs automatic astrometry @xcite and photometry @xcite .",
    "the data is photometrically calibrated to better than 1% accuracy @xcite .",
    "the resulting homogeneous optical and near - infrared coverage of three quarters of the sky makes the pan - starrs1 data ideal for studies of the distribution of the galaxy s dust .",
    "here , we describe the basic assumptions that we make in order to produce a three dimensional dust map .",
    "we show that the problem can be decomposed into two steps . in the first step ,",
    "we determine the probability density function of distance and reddening for each star ( see  [ sec : indiv - stars ] ) . in the second step , we use information from stars on the same small patch of sky to infer reddening as a function of distance in the given direction .",
    "we make the assumption that stars which are close to one another in 3d space are behind the same column of dust . by grouping together stars which are close - by on the sky , we are able to use the stars as tracers of the total dust column at different distances in a particular direction on the sky .",
    "so long as the dust column does not vary significantly over small angular scales , then this is a valid assumption .",
    "let us denote the reddening profile along a particular line of sight by @xmath15 where @xmath16 , the color excess in some pair of passbands ( e.g. , @xmath2 ) , is a function of distance modulus @xmath17 , and @xmath18 denotes any fitting parameters defining the reddening profile .",
    "these parameters could be , for example , the dust density in each distance bin , and could in principle include the value of @xmath19 , which parameterizes the wavelength dependence of the extinction law @xcite .",
    "the extinction @xmath20 in any set of passbands is then assumed to be a function of the reddening @xmath16 : @xmath21    along one line of sight , denote the photometry of star @xmath22 by @xmath23 , and the set of all observed stellar magnitudes as @xmath24 .",
    "we wish to determine how the model parameters @xmath18 for the line - of - sight reddening profile depend on the stellar photometry @xmath24 .",
    "that is , we wish to determine @xmath25 using bayes rule , @xmath26 the likelihood @xmath27 is the probability density of obtaining the set of observed magnitudes @xmath24 , given the reddening profile defined by @xmath18 .",
    "the likelihood of the entire set of stellar observations is just the product of the individual likelihoods , i.e. @xmath28 this is just a statement that the photometry of one star does not influence the photometry of any other star . plugging this into eq . , and dropping the normalizing factor @xmath29 , @xmath30    we now introduce nuisance parameters describing the distance to and intrinsic type of each star , and then marginalize over these parameters to obtain the likelihood .",
    "we denote the distance modulus to star @xmath22 by @xmath31 , and the parameters describing the stellar type by @xmath32 . for an individual star , @xmath33 in the last step",
    ", we have assumed that the joint prior on the distance and intrinsic stellar type are independent of the reddening profile .",
    "up to a normalizing constant , the above integrand is equivalent to the posterior density @xmath34 for an individual star , where the prior on @xmath16 is flat . intuitively , this is because the prior on reddening is on the fitting parameters @xmath18 , rather than the reddening of an individual star .",
    "after marginalizing over the stellar type @xmath35 , @xmath36 plugging the above into eq .",
    ", we find that the full posterior density for @xmath18 is given by @xmath37 where we have defined the function @xmath38 which is equivalent to the posterior probability density of finding a single star at distance @xmath31 and reddening @xmath39 , where the prior on reddening is flat . here , @xmath40 is a normalizing constant .",
    "effectively , it is the bayesian evidence for star @xmath22 , a measure of how likely the star is to be drawn from the model .",
    "a higher evidence indicates that the data is more consistent with the model , while a low value for @xmath40 indicates that the model does not well describe the object @xmath22 .",
    "our strategy for sampling from a posterior of the form given by eq .",
    "is to pre - compute eq .",
    "for each star by markov - chain monte carlo ( mcmc ) sampling , and then to sample from @xmath41 .",
    "this approach has two advantages .",
    "first , it factorizes the full problem into a series of smaller problems of lower dimension , potentially speeding up the computation .",
    "the second advantage of this two - step approach is that it allows outlier rejection on the basis of the bayesian evidence for each star before proceeding to the second step .",
    "point sources which do not fit the chosen stellar model ( e.g. , blue stragglers , white dwarfs and galaxies mistakenly classified as stars ) can be filtered out by imposing a cut on the evidence @xmath40 ( see  [ sec : evidence - outliers ] ) .",
    "more principled approaches to reducing the influence of outliers exist ( e.g. , * ? ? ?",
    "* ) , though in the context of our problem they are significantly more computationally expensive to implement .",
    "a more general limitation to the approach taken here is that it does not allow the simultaneous fitting of parameters describing the stars and the spatial variation in dust properties .",
    "one could imagine simultaneously constraining stellar types and distances , as well as the dust density and @xmath19 parameter throughout space . by fitting the dust properties in many voxels simultaneously",
    ", one would be able to place priors on the density power spectrum of the dust , and to infer @xmath19 as a function of position in the galaxy . by fitting dust properties throughout the entire volume of the galaxy simultaneously , one could even attempt to constrain global parameters , such as the dust scale height and scale length .",
    "this would represent a hierarchical approach to the problem of creating a 3d dust map ( see , for example , * ? ? ? * for a discussion of hierarchical bayesian models ) . at the highest level in the hierarchy",
    ", one has global parameters , which describe the overall dust distribution and density power spectrum .",
    "one level below in the hierarchy , one would have parameters describing the dust properties in each voxel in the galaxy . at the lowest level",
    ", one could have the type and distance for each star .",
    "such a hierarchical approach is appealing because it takes into account spatial correlations in dust properties , and because it directly fits the global structure of the galaxy s dust component .",
    "however , this hierarchical approach potentially requires much greater computational power than the approach we take in this paper , as it does not allow one to process each star individually and treat each line of sight separately , greatly increasing the dimensionality of parameter space .",
    "this paper therefore confines itself to fitting each star independently , and then combining the information from each star along any given line of sight to determine the reddening profile as a function of distance .",
    "now that we have factorized the problem of determining the line - of - sight reddening profile into one of determining @xmath42 for each star , we need to determine the individual stellar likelihoods and priors . in the following , we will drop the subscript @xmath22 , as it is assumed that we are dealing with one star .",
    "using bayes rule , @xmath43 the likelihood , @xmath44 , is the probability density of a star having apparent magnitudes @xmath45 , given a distance , reddening and stellar type .",
    "the likelihood is thus dependent on our model of intrinsic stellar colors , which we discuss below ( in  [ sec : likelihoods ] ) .",
    "the priors , @xmath46 , are dependent on our model of the distribution of stars of different types throughout the galaxy .",
    "we discuss our galactic model in ",
    "[ sec : priors ] .      in our model ,",
    "each star is described by two intrinsic parameters , its absolute magnitude @xmath47 in the ps1 @xmath48 band and its metallicity @xmath49}}$ ] . in terms of our previous notation , @xmath50}}\\right)$ ] .",
    "given a set of stellar templates , @xmath51}}\\right)}}$ ] , which map intrinsic stellar type to a set of absolute magnitudes , one obtains theoretical apparent magnitudes @xmath52}}\\right ) } } + \\vec{a } { \\ensuremath{\\ ! \\left ( e , r_{v } \\right ) } } + \\mu \\ , .\\end{aligned}\\ ] ] the extinction vector @xmath53 used in this work follows a @xcite reddening law with @xmath54 , adapted to the ps1 @xmath55 filter set by @xcite .",
    "the likelihood of observing apparent magnitudes @xmath45 with gaussian uncertainties @xmath56 is then given by @xmath57 } } , e \\right ) } }          & = \\mathcal{n } { \\ensuremath{\\ !",
    "\\left ( \\vec{m }   \\ , | \\ , \\vec{m}_{\\mathrm{mod } } \\ , , \\vec{\\sigma } \\right ) } } \\ , .\\end{aligned}\\ ] ] in this paper , we use the notation @xmath58 to denote the probability density of a multivariate normal with mean @xmath59 and standard deviations @xmath56 , evaluated at @xmath60 .",
    "we adopt a set of empirical stellar templates based on stellar observations in ps1 , with photometric parallaxes and metallicities derived from the work of @xcite .",
    "that work determines the absolute magnitude of a star as a function of its intrinsic color and metallicity using observations of globular clusters in sdss .",
    "these globular clusters are uniformly old , and as a result our stellar templates are appropriate only for old populations and do not include age as a parameter .",
    "this means that young blue stars are not included , and that the morphology of the subgiant and giant branches is only approximate .",
    "accordingly , our giant branch distances are less reliable than our main sequence distances .",
    "nevertheless , we include the giant branches in our models because any given star may indeed be a distant giant rather than a nearby dwarf .    in detail",
    ", we fit a spline to the colors of stars ( in 4-color space ) near the north galactic pole to derive the shape of the stellar locus .",
    "all main - sequence stars are required to have intrinsic colors lying along this one - dimensional curve .",
    "we then associate each position along the main sequence with an absolute magnitude and a metallicity using the relations of @xcite , which give absolute magnitude as a function of color and metallicity .",
    "models for the giants are obtained from linear fits of absolute magnitude to color and metallicity by ivezi ( private communication ) , based on observations of globular clusters .",
    "these giant branch fits are joined to the main sequence via a cubic interpolating polynomial for @xmath61 .",
    "we are able to use relations derived from sdss because of the close similarity between the ps1 and sdss filter sets ; we transform from the ps1 to sdss colors using the color transformations of finkbeiner et al .",
    "( in prep . ) , which have residuals of less than about 1% across the full range of stellar types considered in this work .",
    "the resulting stellar templates are shown in figure  [ fig : mr - vs - color ] , which gives the templates colors as a function of their absolute magnitude and metallicity .",
    "our empirical approach produces a close match to the observed colors of stars , and comparison with globular and open clusters indicates that the absolute magnitudes are accurate along the main sequence ( see  [ sec : distance - comparison ] ) . an alternative approach would have been to adopt template colors from a library of synthetic spectra , such as the padova & trieste stellar evolution code ( parsec ; * ? ? ?",
    "* ) , giving us access to age as an additional stellar parameter .",
    "however , the synthetic libraries have difficulty reproducing the colors of m - dwarfs in detail .",
    "we choose therefore to adopt a set of empirical models that match the colors of most stars well , though in future work a hybrid approach may be best suited to the problem .",
    "we now present the priors that we place on the intrinsic and extrinsic parameters describing each star .",
    "we factorize the priors as follows : @xmath62}}\\right ) } } & = p { \\ensuremath{\\ ! \\left ( \\mu \\right ) } } p { \\ensuremath{\\ ! \\left ( { \\ensuremath{\\left [ \\nicefrac{\\mathrm{fe}}{\\mathrm{h } } \\right]}}| \\ , \\mu \\right ) } } p { \\ensuremath{\\ ! \\left ( m_{r } \\right ) } } \\ , .\\end{aligned}\\ ] ] we describe the distance prior in  [ sec : dist - prior ] , the metallicity prior in  [ sec : metallicity - prior ] and the prior on absolute magnitude in  [ sec : luminosity - prior ] .      for a given line of sight ,",
    "the prior probability of finding a star in a small range @xmath63 in distance modulus is proportional to the number of stars per unit distance modulus per unit solid angle in the direction of the pixel : @xmath64 here , @xmath48 denotes physical distance from the sun , and @xmath65 is the stellar number density at distance modulus @xmath17 along the chosen line of sight .",
    "the distance prior is thus controlled by the line - of - sight number density of stars , as well as a volume factor , @xmath66 , which grows with distance .",
    "this latter term takes into account that the volume represented by a beam of constant , small width in distance modulus grows with distance . for a typical line of sight ,",
    "the prior is driven upwards by the volume factor at small distances , while farther out it is suppressed by the decline in density in the outer reaches of the galaxy . for constant density , @xmath65 , eq .",
    "simply reduces to the euclidean counts equation .",
    "the distance prior thus requires us to calculate the stellar number density at arbitrary locations in the galaxy .",
    "we employ the three - component galactic model developed in @xcite , which comprises a thin disk , a thick disk and an oblate halo . in cylindrical coordinates",
    "centered on the galactic center , and with the galactic plane defining @xmath67 , each disk component has number density of the form @xmath68 where @xmath69 and @xmath70 are the scale radius and height respectively , of each disk component , and @xmath71 is the stellar number density of each component at the galactic center . in the solar neighborhood ,",
    "@xmath72 we can thus write the number density of each disk component in terms of locally defined quantities , which are more readily measurable than quantities defined at the galactic center : @xmath73 } \\ , .\\end{aligned}\\ ] ] where @xmath74 and @xmath75 are the galactocentric solar radius and height in cylindrical coordinates , respectively . from this point",
    "onwards , we will denote @xmath76 as @xmath77 , and write @xmath78 the halo is assumed to have stellar number density @xmath79 with @xmath80 here , @xmath81 controls the oblateness of the halo and @xmath82 controls the steepness of the power law .",
    "following @xcite , the power law breaks at @xmath83 , becoming steeper .",
    "we therefore define @xmath84 and @xmath85 , corresponding to the halo steepness inside and outside of the break .",
    "we introduce the distance scale @xmath86 over which the inner region of the halo is smoothed , in order to remove the singularity at the galactic center .",
    "we choose @xmath86 to be @xmath87 ; at this scale , it has a negligible effect on the halo density in the regions which @xcite studied , but it prevents the halo from dominating over the disk at the galactic center and is the same scale adopted by @xcite .",
    "we employ the parameters given in table 10 of @xcite and @xcite .",
    "these are listed in table [ tab : density - params ] .",
    "the adopted value of @xmath88 , on the low end of the possible range inferred in @xcite , is chosen to better match observed ps1 color - magnitude diagrams at high galactic latitudes . throughout , we use @xmath89 and @xmath90 .",
    "the shape of the distance prior for a line of sight centered on @xmath91 and @xmath92 is shown in fig .",
    "[ fig : mu - prior ] .",
    "c l || c l || c l @xmath93 & @xmath94 & @xmath95 & @xmath96 & @xmath97 & @xmath98 + @xmath99 & @xmath100 & @xmath101 & @xmath102 & @xmath81 & @xmath103 + & & @xmath104 & @xmath105 & @xmath88 & @xmath106 + & & & & @xmath84 & @xmath107 + & & & & @xmath85 & @xmath108      we adopt the model of galactic metallicity developed in @xcite and @xcite , assigning separate metallicity distributions to the disk and halo . the metallicity distribution of the disk varies with height above the galactic plane , and is thus dependent on line - of - sight distance . the metallicity prior takes the form @xmath109}}| \\ , \\mu \\right ) } } & = p { \\ensuremath{\\ ! \\left ( { \\ensuremath{\\left [ \\nicefrac{\\mathrm{fe}}{\\mathrm{h } } \\right]}}| \\ , \\mu , \\ , \\mathrm{disk } \\right ) } } p { \\ensuremath{\\ ! \\left ( \\mathrm{disk } \\ , | \\ , \\mu \\right ) } } \\notag \\\\          & \\hspace{1 cm } + p { \\ensuremath{\\ ! \\left ( { \\ensuremath{\\left [ \\nicefrac{\\mathrm{fe}}{\\mathrm{h } } \\right]}}| \\ , \\mathrm{halo } \\right ) } } p { \\ensuremath{\\ ! \\left ( \\mathrm{halo } \\ , | \\ , \\mu \\right ) } } \\ , .\\end{aligned}\\ ] ] the membership probabilities are simply @xmath110 which can be calculated on the basis of the preceding discussion (  [ sec : dist - prior ] ) .    for the disk , stellar metallicity is distributed as a sum of gaussians .",
    "the mean of each gaussian varies with height above the galactic plane , so that the prior is best written in terms of cylindrical coordinates : @xmath109}}| \\ , z , \\ , \\mathrm{disk }",
    "\\right ) } } & = c \\ \\mathcal{n } { \\ensuremath{\\",
    "! \\left ( { \\ensuremath{\\left [ \\nicefrac{\\mathrm{fe}}{\\mathrm{h } } \\right]}}| \\ , a { \\ensuremath{\\ ! \\left ( z \\right ) } } \\ ! , \\sigma_{d } \\right ) } } \\notag \\\\          & \\hspace{-0.5 cm } + ( 1 \\ ! - \\ !",
    "c ) \\ \\mathcal{n } { \\ensuremath{\\ ! \\left ( { \\ensuremath{\\left [ \\nicefrac{\\mathrm{fe}}{\\mathrm{h } } \\right]}}| \\ , a { \\ensuremath{\\ ! \\left ( z \\right ) } } \\ ! + \\ ! \\delta a , \\sigma_{d } \\right ) } } , \\end{aligned}\\ ] ] where @xmath111 the parameters @xmath112 , controlling the central disk metallicity , and @xmath113 and @xmath114 , describing the vertical metallicity gradient in the disk , are defined in table [ tab : metallicity - params ] .",
    "we assume the halo metallicity to be spatially invariant , and distributed as @xmath109}}| \\ ,",
    "\\mathrm{halo } \\right ) } } = \\mathcal{n } { \\ensuremath{\\ ! \\left ( { \\ensuremath{\\left [ \\nicefrac{\\mathrm{fe}}{\\mathrm{h } } \\right]}}| \\ , a_{h } , \\sigma_{h } \\right ) } } \\ , .\\end{aligned}\\ ] ] the parameters , @xmath115 and @xmath116 , describing the halo metallicity , are given in table [ tab : metallicity - params ] .",
    "the metallicity is plotted in fig .",
    "[ fig : feh - prior ] as a function of height above the galactic midplane in the solar neighborhood .",
    "c r || c r @xmath112 & @xmath117 & @xmath115 & @xmath118 + @xmath119 & @xmath120 & @xmath116 & @xmath121 + @xmath122 & @xmath123 & & + @xmath124 & @xmath125 & & + @xmath113 & @xmath126 & & + @xmath114 & @xmath127 & &      we use the @xmath48-band absolute magnitude to parameterize the luminosity of each star .",
    "the joint prior on luminosity and distance is @xmath128 the luminosity function is assumed to be same in the halo and both disk components , and furthermore independent of position .",
    "the priors on distance and luminosity are then separable , so that @xmath129 with @xmath130 .",
    "we adapt the ps1 luminosity functions provided by the padova & triese stellar evolution code ( * ? ? ?",
    "* parsec ) , assuming a @xcite log - normal initial mass function .",
    "we average over luminosity functions for populations with ages of @xmath131 and metallicities @xmath49}}= -0.5 \\pm 0.5 \\ , \\mathrm{dex}$ ] .",
    "denote the luminosity function for a population of age @xmath132 and metallicity @xmath49}}$ ] as @xmath133}}\\right)}}$ ] .",
    "the luminosity function we adopt is then @xmath134}}\\,\\ ,          \\mathrm{lf } { \\ensuremath{\\ ! \\left ( m_{r } \\ , | \\ , \\tau , \\ , { \\ensuremath{\\left [ \\nicefrac{\\mathrm{fe}}{\\mathrm{h } } \\right]}}\\right ) } } \\notag \\\\          & \\hspace{0.5 cm } \\times \\exp \\ ! \\left [ - \\frac{\\left ( \\tau - \\tau_{0 } \\right)^{2}}{2 \\sigma_{\\tau}^{2 } } - \\frac{\\left ( { \\ensuremath{\\left [ \\nicefrac{\\mathrm{fe}}{\\mathrm{h } } \\right]}}- { \\ensuremath{\\left [ \\nicefrac{\\mathrm{fe}}{\\mathrm{h } } \\right]}}_{0 } \\right)^{2}}{2 \\sigma_{{\\ensuremath{\\left [ \\nicefrac{\\mathrm{fe}}{\\mathrm{h } } \\right]}}}^{2 } } \\right ] \\ , ,          \\label{eqn : lf - averaging}\\end{aligned}\\ ] ] with @xmath135 , @xmath136 , @xmath49}}_{0 } = -0.5 \\ , \\mathrm{dex}$ ] and @xmath137 } } } = 0.5 \\ , \\mathrm{dex}$ ] . in principle",
    ", it is possible to make the luminosity function depend on metallicity , by not averaging over @xmath49}}$ ] in eq . .",
    "for simplicity , we assume here that the luminosity function is universal .      as indicated in  [ sec : los - formalism ] , the manner in which we have factorized the line - of - sight reddening problem requires us to place a flat prior on the color excess , @xmath16 , for each star .",
    "the priors on the reddening profile are imposed on the parameters which control the line - of - sight reddening , rather than on individual stellar reddenings .",
    "for example , if one divides each line of sight into @xmath138 distance bins and assigns a different dust density @xmath139 to each bin , then the reddening prior would take the form @xmath140 .",
    "the distance prior developed above only asks how many stars are in a thin shell at each distance .",
    "however , for a magnitude - limited survey , we would like instead to know the number of observable stars at a given distance .",
    "we should assign zero prior probability to the possibility of a star being observed which our instrument can not detect .",
    "the fact that a star has been observed by a given instrument therefore tells us something about its stellar type , distance and extinction . using the notation from @xcite",
    ", we define the vector @xmath141 for each star , where @xmath142 is true if a star has been observed in passband @xmath22 , and false if the star is not detected in that passband .",
    "the ps1 dataset used in this paper is not based on forced photometry , so there is a separate probability of a source being detected in each passband .",
    "if forced photometry were conducted , there would be one single probability @xmath143 , equal to the probability of detecting the source in at least one of the passbands . including this information in the single - star posterior , eq . , we get @xmath144 but the prior is now just @xmath145 so in full , @xmath146 the first term is simply the likelihood we found earlier , since the knowledge that the star has been detected has no effect on the apparent magnitudes the model predicts , assuming the stellar type , distance and reddening are known . that is to say , @xmath147 and @xmath148 the only element of the calculation which changes when we take into account malmquist bias is therefore the prior , which picks up an extra factor of @xmath149 this is the survey selection function .",
    "if forced photometry were used instead , then we would have a single detection parameter @xmath150 , denoting that the source was detected in at least one passband , and the survey selection function would be @xmath151 in place of the expression in eq . .",
    "we therefore require an estimate of the completeness of the survey in each band , as a function of apparent magnitude . we determine completeness by comparison with point - source detections in the @xmath152 sdss stripe 82 survey @xcite .",
    "the co - added stripe 82 images go more than a magnitude deeper than the individual ps1 @xmath0 images , allowing us to use stripe 82 detections as a complete catalog of point sources past the detection limits of the ps1 @xmath0 survey . for each stripe",
    "82 source , we deteremine whether there is a pan - starrs 1 detection within @xmath153 .",
    "the completeness fraction of the ps1 @xmath0 survey is the percentage of stripe-82 detections with a ps1 match .",
    "we determine the completeness fraction of the ps1 @xmath0 survey as a function of @xmath154 where @xmath155 is the ps1 magnitude , and @xmath156 is an estimate of the local ps1 @xmath157 magnitude limit , based on the point - spread function of nearby ps1 detections and local sky and read noise .",
    "we divide the sdss stripe 82 footprint into healpix @xmath158 pixels ( with @xmath159 scale ) . in each pixel",
    ", we select all stripe-82 detections classified as stars , and transform their @xmath160 magnitudes to @xmath55 , using color transformations derived by finkbeiner ( in prep . ) , based on standard - star catalogs . in each pixel",
    ", we determine the ps1 limiting @xmath55 magnitudes from the median limiting magnitudes estimated for individual ps1 detections . for each stripe 82 detection in the pixel",
    ", we obtain @xmath161 in each band by subtracting the local limiting magnitude from the transformed detection magnitude . in each passband ,",
    "we bin stripe 82 detections by @xmath161 , obtaining an empirical estimate of the completeness in each bin from the number of ps1 matches .",
    "we find that the completeness fraction is reasonably well fit by @xmath162^{-1 } ,          \\label{eqn : completeness - fraction}\\end{aligned}\\ ] ] where @xmath163 is a limiting magnitude calculated for each point - source detection in the ps1 @xmath0 survey , equal to the magnitude of a source that would be detected at @xmath157 in one exposure , given the sky and read noise . @xmath164 and @xmath165 are fitting parameters .",
    "the positive value of @xmath166 indicates that the ps1 pipeline goes somewhat deeper than our naive estimate @xmath156 .",
    "the same fitting parameter values reproduce the completeness curve in all five ps1 passbands reasonably well , reflecting the consistency of the ps1 optics and pipeline across the entire filter set .",
    "the empirically measured completness fraction and our fit are plotted for each passband in fig .",
    "[ fig : completeness ] .",
    "we use markov chain monte carlo sampling to explore the parameter space for individual stars .",
    "the sampling must be performed with great care , owing to two features of the distributions @xmath167 .",
    "first , the distributions are invariably highly elongated , and second they are often multimodal .",
    "the elongation stems from the close alignment between the reddening vector and the stellar locus in the ps1 bands , as shown in fig .",
    "[ fig : reddening - vector ] .",
    "the multimodality has two causes .",
    "first , the reddening vector in general intersects the @xmath168 stellar locus in two locations , creating a degeneracy between blue and red main - sequence stars .",
    "second , the ps1 bands do not distinguish dwarfs from giants , leading to the possibility that a star can be either a faraway red giant or a nearby red dwarf .",
    "these degeneracies are easier to visualize if we consider only three passbands , as shown in figure  [ fig : reddening - vector ] . in this reduced space ,",
    "stellar photometry is fully described by a single overall observed magnitude and two colors .",
    "if we observe a star at a given location in color - color space , we can then move backwards along the reddening vector until we intersect the stellar locus .",
    "one can then compare the observed apparent magnitude with the absolute magnitude of the stellar locus at the point of intersection .",
    "one thus obtains both a reddening and distance for the star .",
    "if there are multiple intersections , then the observed star could be of different intrinsic types , and thus have different reddening and distance combinations .",
    "the relative probability of each mode is in practice given by the space of stellar types lying close to the gray line , as well as the priors applied to the problem .",
    "we perform a markov chain monte carlo sampling of these surfaces using a custom c++ implementation of the affine - invariant sampler introduced in @xcite and recently given in a python implementation by @xcite .",
    "we employ both short - range `` stretch '' and long - range `` replacement '' moves @xcite .",
    "the long - range moves allow mixing between widely separated modes in parameter space , but are more computationally expensive than the short - range `` stretch '' steps .",
    "the replacement moves are closely related to the normal kernel coupler of @xcite .",
    "we have found that with the addition of long - range `` replacement '' steps , the affine - invariant sampler is capable of handling the multimodality of the problem , and that it is well suited to the strong degeneracies in parameter space . for each star , we sample from each stellar posterior density in four independent runs and check convergence with the gelman - rubin diagnostic @xcite .",
    "the gelman - rubin diagnostic essentially verifies that the variance between the means of separate chains is small compared with the variance within the chains .",
    "if independent mcmc runs produce significantly different estimates of the parameter means , one or more of the runs must not have converged .",
    "each run employs 20 samplers , with a mix of 80% stretch steps and 20% replacement steps , and 2000 steps per sampler .",
    "the first 1000 steps from each sampler are discarded as burn - in .",
    "thus , excluding the burn - in phase , a total of 80000 samples are drawn for each star across the four chains , with the number of independent samples being lower . on four cores of a 2.67 ghz intel xeon x5650 with 12 mb of l3 cache , our run time per star is typically 0.15 seconds per run per core , or 0.8 cpu seconds for four independent runs .",
    "when an observed object does not match our stellar model , the inferences we draw on its distance , reddening and stellar type are unreliable .",
    "one means of quantifying the reliability of our inferences for an individual star is to compute the evidence @xmath169 which is the probability density of drawing the observed magnitudes @xmath45 from the stellar model and observing the star in the ps1 survey .",
    "a low evidence indicates that the observed point source is a member of a stellar population not included in our model ( e.g. , a young blue giant or an unresolved binary system with colors that do not match any stellar template ) , is not a star ( e.g. , a white dwarf or galaxy ) , that the errors in the photometry have been underestimated , or that the reddening vector is inaccurate . here",
    ", our approach is similar to @xcite , which identifies objects which do not fit the stellar model by a threshold @xmath170 statistic .",
    "there is no direct analogue for the @xmath170 statistic in a bayesian framework , but evidence may serve a similar purpose in model comparison .",
    "note that as we do not include priors on the extinction to individual stars , but rather on the line - of - sight reddening profile , we do not strictly calculate the evidence .",
    "instead , we calculate the evidence of a model with a prior on @xmath16 with wide support ( i.e. a prior which allows @xmath16 to take on a wide range of values ) , such that the prior is nearly constant across all relevant reddennings : @xmath171 where @xmath172 is some integrable function whose precise behavior is unimportant , @xmath173 is a normalizing constant , and @xmath174 is some large extinction .",
    "we thus effectively calculate the evidence @xmath175 for a model of this form , up to a constant factor @xmath173 , which is the same for every star .",
    "this allows for outlier rejection , based on comparisons between the evidence for different stars .",
    "we employ a modified harmonic mean estimate , which is obtained directly from the markov chain produced in sampling the posterior density , and thus requires little additional computation @xcite .",
    "this method is presented in more detail in appendix [ sec : app - harmonic - mean ] .",
    "we choose the healpix pixelization scheme @xcite as our method of dividing the sky into individual lines of sight .",
    "once we have determined @xmath176 for each star in a given healpix pixel and rejected stars which fall below the evidence cut , we can apply eq . to determine the posterior probability of the parameters @xmath18 describing the reddening profile .",
    "we parameterize the reddening profile as a piecewise - linear function in distance modulus , with @xmath177 describing the rise in @xmath48-band reddening in distance segment @xmath22 .",
    "we split up each line of sight into 30 distance segments of equal width in @xmath17 , with the closest distance being at @xmath178 , corresponding to @xmath179 , and the furthest distance being at @xmath180 , corresponding to @xmath181 .",
    "it must be cautioned that , in general , our method does not tightly constrain reddening at this latter distance , where ps1 observes very few stars .",
    "in addition to requiring that reddening increase monotonically with distance , we apply a wide log - normal prior on the differential reddening in each distance bin , @xmath182 .",
    "we use the affine - invariant sampler to draw a representative sample of possible reddening profiles .",
    "we sample from the posterior density given by eq . .",
    "we can thus produce a three - dimensional reddening map which includes the uncertainty in reddening as a function of distance .",
    "the first and most straightforward test of our method is to generate mock photometry for stars of varying stellar type , distance and extinction , and to see how well we can recover those parameters .",
    "this is less of a test of the particular stellar model used than a demonstration that photometry alone is capable of sufficiently constraining stellar parameters .",
    "we find that our method is capable of accurately recovering both single - star parameters and the line - of - sight reddening profile .      in order to generate a mock photometric catalog for a particular region on the sky ,",
    "we begin by drawing intrinsic stellar types ( metallicities and absolute @xmath11 magnitudes ) and distances from our priors .",
    "we assign a reddening to each star , either according to an assumed distance  reddening relationship , or from a reddening distribution we define , depending on the purpose of the mock catalog . for each star in the catalog ,",
    "we generate model magnitudes , as described in ",
    "[ sec : likelihoods ] .",
    "we determine which passbands each star is detected in , according to our probabilistic ps1 completeness model , eq . .",
    "in the remainder of the paper , we reject simulated stars which do not have 5-band detections .",
    "we then apply magnitude - dependent gaussian photometric errors to each simulated star to obtain observed magnitudes .",
    "the error we apply to each star in each passband is a function of the model apparent magnitude :    @xmath183 \\ , .",
    "\\label{eqn : ps1-error - model}\\end{aligned}\\ ] ]    as before , @xmath156 is the @xmath157 limiting magnitude in the given passband .",
    "we set the error floor to @xmath184 . for ps1 passbands , we find that @xmath185 and @xmath186 give a reasonable fit to the photometric uncertainties .",
    "our final catalog thus contains noisy observed magnitudes of each star , along with the photometric uncertainty in each passband . as a final step , we plug the observed magnitudes back into eq . to obtain a new estimate of the photometric uncertainties for each star .",
    "the final catalog that we pass to our pipeline thus reports inexact photometric uncertainties , much as a realistic catalog would .",
    "the usefulness of these mock catalogs is that they allow us to generate a large amount of photometry for stars whose ` true' distances and reddenings are known .",
    "we illustrate the typical appearance of single - star posterior distributions in distance and reddening in fig .",
    "[ fig : mock - indiv ] . for each of the four simulated stars in fig .",
    "[ fig : mock - indiv ] , the `` true '' distance and reddening are indicated by a dot , while the background heat map shows the probability density inferred by our pipeline .    in order to determine how far off our estimates are on average , we define the centered probability density @xmath187 where @xmath188 and @xmath189 are the true distance modulus and reddening , respectively , for star @xmath22 .",
    "for a simulated line - of - sight , this function gives the average probability density of our inference being offset from the true stellar parameters by @xmath190 .",
    "we plot @xmath191 for a typical line of sight in fig .",
    "[ fig : mock - stack ] . the typical spread of in @xmath192 and @xmath193 varies across different lines of sight , but the centered probability density generally peaks at the origin , as should be expected . in the bottom two panels of [ fig : mock - stack ] , we show the effect of applying flat priors to the stellar parameters , in place of the priors developed in  [ sec : indiv - stars ] .",
    "the effect is to widen and bias the inferred probability density functions . due to the near - alignment of the reddening vector with the ps1 stellar locus for much of the main sequence ,",
    "this bias remains even for stars with low observational uncertainties .",
    "the stellar priors are thus important in correctly inferring stellar parameters from pan - starrs 1 photometry . in the right two panels of [ fig : mock - stack ] , we only use inferences for stars with low signal - to - noise detections .",
    "the low signal - to - noise population is generated using an inflated error model that applies @xmath194 the normal observational uncertainty to the mock photometry .",
    "as expected , the inferred parameters for such stars are less constrained , but they are nonetheless unbiased .    in table",
    "[ tab : mock - comparison ] , we present typical uncertainties in the inferred distance and reddening of individual stars . to do this ,",
    "we generate mock catalogs along two different lines of sight . for our high - galactic - latitude target ,",
    "we choose the north galactic pole , where the stellar population is dominated by the halo .",
    "here , we apply reddenings of @xmath195 to the simulated stars . for the low galactic latitude target ,",
    "we choose @xmath196 , @xmath197 , and draw reddening uniformly from the range @xmath198 .",
    "we run the two mock catalogs through our pipeline , and compare the inferred distances and reddenings , drawn from the posterior probability density @xmath199 , to the true values . for this test ,",
    "we allow our inferred reddenings to go slightly negative ( @xmath200 ) , to avoid introducing a bias into the inferred values .",
    "we give the median , and 15.87th and 84.13th percentiles of @xmath201 and @xmath202 , equivalent to the one - standard - deviation range for a gaussian distribution .",
    "uncertainties in distance modulus can be transformed to uncertainties in distance by making use of the relation @xmath203 let @xmath204 .",
    "then , @xmath205 similarly , we define @xmath202 as @xmath206 .",
    "our distance and reddening estimates are unbiased . however ,",
    "if one selects a subsample of stars of a certain known type , a bias in distance is introduced .",
    "thus , distance estimates for mock dwarf stars are biased low , as the model assigns some probability to the possibility of them being giants .",
    "inversely , distances to giants are biased high .",
    "a star drawn at random , however , has an unbiased distance estimate .",
    "distance and reddening constraints depend upon the quality of the photometry and direction on the sky , and therefore vary significantly on a star - per - star basis .",
    "it is , in general , more informative to look at the detailed shape of the posterior distribution for a given star in distance and reddening space ( see fig . [",
    "fig : mock - indiv ] ) .",
    "c c c c c    @xmath207 & @xmath208 & @xmath209 & @xmath210 & @xmath211 +   + @xmath212 & @xmath213 & @xmath214 & @xmath215 & @xmath216 +   + @xmath217 & @xmath218 & @xmath219 & @xmath220 & @xmath221 +   + @xmath222 & @xmath223 & @xmath224 & @xmath225 & @xmath226 +   + @xmath227 & @xmath228 & @xmath229 & @xmath230 & @xmath231 +   + dwarfs@xmath232 & @xmath233 & @xmath234 & @xmath235 & @xmath236 +   + all stars & @xmath237 & @xmath238 & @xmath239 & @xmath240    next , we test that the true stellar parameters are drawn from the probability density functions we calculate . for each simulated star , we derive the posterior density @xmath241 , based on the simulated photometry .",
    "since we know the true distance modulus @xmath242 and reddening @xmath243 of the star , a natural question is whether @xmath242 and @xmath244 are drawn from @xmath241 .",
    "this can not be answered for a single star , but we can test this hypothesis for a large number of stars . assign a percentile to a given star as follows : @xmath245 where @xmath246 .",
    "this represents the probability that the true stellar parameters would be found at a point in ( @xmath17 , @xmath16)-space of lower posterior density . if ( @xmath242 , @xmath244 ) lies at the point of maximum posterior density , then @xmath247",
    "conversely , if ( @xmath242 , @xmath244 ) lies in a region of vanishing probability density , then @xmath248 .",
    "this percentile is therefore similar to a cumulative distribution function , and is uniformly distributed between @xmath249 and @xmath250",
    ". a straightforward test of whether @xmath251 is to generate mock photometry for a large number of stars , to calculate the percentile for each simulated star , and to then bin the results . each bin is expected to contain the same number of stars , with the precise number of stars in the bins determined by a multinomial distribution .",
    "we can therefore derive approximate confidence intervals for the number of stars that should fall into any given bin .",
    "[ fig : percentiles ] shows this test for a set of 1000 simulated stars along a line of sight with galactic coordinates @xmath91 , @xmath92 .",
    "the results are consistent with our expectations , indicating that our method recovers correct posterior densities for the simulated photometry .      finally , we demonstrate that we are able to recover line - of - sight reddening profiles for simulated photometry .",
    "we first invent an arbitrary relationship @xmath252 between distance and reddening .",
    "we add in low - level scatter to the distance - reddening relationship , as the reddening relation across one healpix pixel may vary .",
    "we then generate mock photometry for 150 stars along the line of sight . following the procedure outlined in ",
    "[ sec : los - formalism ] , we use the simulated photometry to determine a posterior density in distance and reddening space for each star , and then combine the information from all of the stars to find the range of allowable reddening profiles .",
    "our final product is thus a set of reddening profiles , drawn from the probability density over reddening profiles ( eq . ) .",
    "we parameterize the reddening as a piecewise - linear function in distance , and apply a weak log - normal prior to the differential reddening in each distance segment , as described in  [ sec : los - fitting ] . the results for one simulated line of sight , shown in fig .",
    "[ fig : mock - los ] , demonstrate that we are able to correctly infer the reddening profile for mock data .",
    "the method produces the best results at distances where there are many stars .",
    "nearby and at large distances , where there are comparatively few stars to constrain the reddening profile , the uncertainties in reddening can become very large .",
    "however , at intermediate distances ( @xmath253 to @xmath254 for typical lines of sight , corresponding to @xmath250 to @xmath255 ) , the fit produces uncertainties on the order of @xmath256 , consistent with the intrinsic scatter in reddening which we introduce into the simulated photometry .",
    "we compare our model colors to ps1 stellar photometry from low - extinction regions at high galactic latitudes .",
    "it is important to choose low - extinction regions , so that assumptions about the reddening law and what percentage of the total dust column is in front of each star play only a minor role .",
    "this allows us to obtain a comparison between the intrinsic colors in our model and of real stars .",
    "we de - redden the stellar colors assuming that they are behind the full dust column predicted by ( * ? ? ?",
    "* sfd ) .",
    "the results for the north galactic pole are shown in fig .",
    "[ fig : color - color - comparison ] .",
    "we compute an evidence for each star , as described in  [ sec : evidence - outliers ] .",
    "as expected , objects which lie far from the stellar locus in color - color space tend to have lower evidence .",
    "this helps us to reject objects that are either not stars , are not included in our stellar model ( e.g. , young and bhb stars ) , or that have particularly bad photometry . in the window shown here , 15% of the detected objects would fail an evidence cut of @xmath257 .",
    "these objects tend to have problematic photometry for which the ps1 pipeline may have produced inaccurate results , though some are variables , quasars , and unrecognized galaxies , which our technique is not designed to handle .",
    "our line - of - sight reddening inferences are not strongly dependent on the choice of the evidence threshold .",
    "correct distance determination requires not only correct model colors , but correct absolute magnitudes .",
    "we therefore compare our stellar models to globular and open clusters . in fig .",
    "[ fig : clusters ] , we compare our model magnitudes to photometry from four globular and open clusters .",
    "we find that the model absolute magnitudes match the main sequence .",
    "the model magnitudes are unreliable past the main sequence turnoff , particularly for younger clusters .",
    "our model magnitudes trace the giant branch of intermediate - age clusters  typical of the age of most stars in the galaxy  somewhat better .",
    "nevertheless , we expect that most of the information in our dust maps will come from the main sequence , where distance and reddening estimates are better constrained .",
    "massive young blue stars and blue horizontal branch stars , which are not included in the stellar templates , are found to have low evidence , allowing them to be identified and excluded from the line - of - sight dust inference .",
    "inclusion of age - dependent stellar models , and therefore more reliable distance and reddening determinations for the most massive stars , could potentially increase the distance to which our dust maps are reliable , and is an important direction for future work .      in order to test the accuracy of our reddening inferences for individual stars , we compare our photometric reddenings to independently measured reddenings for a sample of stars .",
    "the sloan extension for galactic understanding and exploration ( segue ) @xcite , part of sdss - ii , provides a convenient set of stars for which one can independently determine reddening .",
    "the segue survey obtained moderate - resolution spectroscopy for 240,000 stars with sdss photometry . whereas most of the sdss footprint is at low reddening , some of the segue targets are at moderate reddening , up to @xmath258 in @xmath2 .",
    "the segue stellar parameter pipeline ( sspp ) fits an atmospheric model to each star to derive the temperature , metallicity , and gravity of the star , as well as other parameters @xcite .",
    "these stellar parameters were used by @xcite to predict the intrinsic colors of stars , and to study the effect of reddening by attributing the differences between the observed and intrinsic colors to dust .",
    "we use the reddening estimates of @xcite in the four independent sdss colors , in concert with their recommended @xmath259 reddening vector @xcite , to estimate @xmath2 to each star .",
    "the details of deriving the reddening based on segue - determined intrinsic colors and sdss photometric colors are described in appendix [ sec : app - segue - reddenings ] .",
    "we use the same sample of segue targets as @xcite .",
    "this sample excludes objects targeted as white dwarfs , and also removes m dwarfs , for which the stellar parameters are less reliable .",
    "we also require that each segue target have a ps1 counterpart .",
    "distances and reddenings to each star are then inferred as described in  [ sec : likelihoods ] , and compared to the segue - determined reddenings . for this comparison , we allow our photometric reddening estimates to be negative , for consistency with the segue - derived reddenings .",
    "we save 100 reddening samples from the markov chain for each star , as well as the maximum - posterior density reddening . in the left panel of fig .",
    "[ fig : segue - comp ] , we compare the maximum - posterior density bayesian reddening estimate with the segue - derived reddening for 200,000 stars .",
    "we bin the stars by the reddening expected from the dust maps of ( * ? ? ?",
    "* sfd ) , and plot a histogram of the difference in the two reddening measures in each bin .",
    "we place the sfd reddening on the @xmath260-axis because it is a good proxy for reddening and is independent of both of the two reddening estimates we wish to compare , while placing either the segue - derived reddening or the bayesian reddening along the @xmath260-axis can introduce spurious trends in the resulting comparison .",
    "we find that the mode of our reddening estimates is unbiased over a range of @xmath261 to @xmath250 , above which there are too few stars in the segue sample to extend the comparison .",
    "the scatter in the difference between the two reddening estimates is approximately @xmath262 in @xmath263 , with the overall estimate being unbiased to within @xmath264 .",
    "our bayesian reddening and distance estimates assume that stars are drawn at random from the observable stars on each line of sight .",
    "the segue survey , however , does not target stars at random , but instead targets only subsets of stars of particular interest .",
    "moreover , the subset of segue - observed stars for which we have reliable reddening estimates does not extend to the m - dwarfs , meaning that our sample of segue - derived reddening estimates use only intrinsically blue stars .",
    "we consider intrinsically redder stars  and therefore less reddened stars  in our analysis than are actually present in our sample of segue - observed stars . in order to simulate the effect of excluding m - dwarfs , we modify the luminosity function prior to assign zero probability for @xmath265 . when we account for this effect",
    ", the distribution of the difference between our and the segue reddening estimates is unbiased . to illustrate this , instead of presenting single reddening difference for each star",
    ", we show 100 samples of the distribution of reddening differences between our bayesian reddening estimate and the segue - derived reddening estimate .",
    "the resulting residuals are shown as a function of sfd reddening in the right panel of fig .",
    "[ fig : segue - comp ] .",
    "the residuals are unbiased at the @xmath266 level , with a scatter of @xmath267 .",
    "this result is indicative of the accuracy we achieve for high - signal - to - noise detections , as most segue targets are well above the detection limit in ps1 .",
    "we have presented a general method for deriving a three - dimensional map of galactic reddening from stellar photometry .",
    "our technique is based on grouping stars into pixels , determining the joint posterior of distance and reddening for each star , and then determining the most probable reddening - distance relation in each pixel .",
    "we have shown that this method correctly recovers the distance ",
    "reddening relationship for simulated lines of sight .",
    "we have additionally shown by comparison with segue - derived reddenings that for high - snr detections , our bayesian reddening estimates are unbiased at the @xmath266 level , with a scatter of @xmath1 in @xmath2 . based on comparisons with mock catalogs , in highly - reddened regions of the galaxy ,",
    "our distance inferences have typical uncertainties of @xmath26847% on the high end , and @xmath26921% on the low end . in high - galactic latitude regions with low reddening ,",
    "our distances have typical uncertainties of @xmath26852% on the high end , and @xmath26938% on the low end .",
    "these uncertainties may be reduced by feeding back information on reddening as a function of distance , derived from all the stars along the line of sight .",
    "a subsequent paper will present the results of applying the techniques developed here to construct a 3d reddening map covering the @xmath270 sky .",
    "in addition to determining the dust density in the nearby galaxy , our method can be used to determine the distribution of stars in the galactic plane .",
    "earlier optical studies of the distribution of stars in the galaxy traditionally consider only high - latitude stars , where the correction for dust extinction is straightforward ( e.g. , * ? ? ? * ) .",
    "infrared surveys of the plane are less sensitive to dust extinction , but their wavelength coverage also makes them less sensitive to intrinsic stellar type , rendering photometric distances uncertain .",
    "our technique provides distances to stars throughout the galactic plane , enabling future studies of the distribution of stars in the disk .",
    "the technique described in this paper is not limited to ps1 photometry .",
    "inclusion of information from the 2mass @xmath271 , @xmath272 and @xmath273 bands , wise bands , as well as sdss @xmath274-band photometry will improve our distance and reddening estimates .",
    "in addition , kinematic information , such as proper motion , may be incorporated into our framework in order to allow a more precise determination of stellar distances .",
    "upcoming surveys will also dramatically enhance our ability to measure the distances and reddenings to stars in the galaxy .",
    "the lsst @xcite will provide deeper photometry spanning a similar set of filters as those used in sdss and pan - starrs 1 , providing photometry for the sky south of @xmath275 .",
    "in the nearer future , the dark energy survey ( des ) will survey a complementary @xmath276 of sky to pan - starrs 1 , in a similar filter set @xcite .",
    "the gaia mission @xcite , meanwhile , will provide multiband photometry and low - resolution spectroscopy alongside parallax distance measurements and proper motions for one billion stars .",
    "gaia s parallax distances , in particular , will break many of the degeneracies in our model for @xmath277 stars , while its proper motions will aid in inferring the population each star belongs to .",
    "these new datasets will increase the power of our method to determine galactic reddening and structure .",
    "the pan - starrs1 surveys ( ps1 ) have been made possible through contributions of the institute for astronomy , the university of hawaii , the pan - starrs project office , the max - planck society and its participating institutes , the max planck institute for astronomy , heidelberg and the max planck institute for extraterrestrial physics , garching , the johns hopkins university , durham university , the university of edinburgh , queen s university belfast , the harvard - smithsonian center for astrophysics , the las cumbres observatory global telescope network incorporated , the national central university of taiwan , the space telescope science institute , the national aeronautics and space administration under grant no .",
    "nnx08ar22 g issued through the planetary science division of the nasa science mission directorate , the national science foundation under grant no .",
    "ast-1238877 , the university of maryland , and eotvos lorand university ( elte ) .",
    "gregory m. green and douglas p. finkbeiner are partially supported by nsf grant ast-1312891 .",
    "the computations in this paper were run on the odyssey cluster supported by the fas science division research computing group at harvard university .",
    "the harmonic mean approximation , developed in @xcite , allows one to compute the bayesian evidence using samples returned from a markov chain monte carlo simulation . for a model with parameters @xmath278 and data @xmath279 ,",
    "bayes rule tells us that @xmath280 we wish to compute the evidence @xmath281 , often denoted by @xmath175 .",
    "multiplying each side of the above by an arbitrary function @xmath282 , rearranging terms and taking the integral over all @xmath278 , @xmath283 the r.h.s .",
    "is simply the expectation value of @xmath284 for samples drawn from the posterior density @xmath285 .",
    "this is convenient , since mcmc methods draw a set of samples from the distribution @xmath285 .",
    "if the integral of @xmath282 is normalized to unity , then @xmath286 this estimate has finite variance as long as @xmath287 has steeper wings than @xmath285 @xcite .",
    "we choose @xmath287 to be constant within an ellipse centered on a point of high density within the chain , and zero outside @xcite .",
    "the ellipse is aligned with the principle axes of the covariance matrix , in order to ensure that it contains only well sampled regions of parameter space .",
    "we find a point of high density by first centering an ellipse on a random point in the chain .",
    "because the points in the chain are sampled proportionately to the posterior probability density , this point is already likely to lie in a well - sampled region of parameter space .",
    "we then find the mean of the points in the chain falling in the ellipse , and move the center of the ellipse to that position in parameter space .",
    "one can iterate this procedure several times to settle into a densely sampled region of parameter space .",
    "the size of the ellipse we use to define @xmath282 is chosen such that a preset fraction of samples in the chain are enclosed . for our calculations",
    ", we iterate five times to find a dense region of parameter space , and scale the ellipse such that it contains 5% of samples .",
    "here , we review a method for calculating stellar reddenings on the basis of sdss photometry and segue predicted intrinsic stellar colors . as explained in @xcite , since the extinction in an individual band @xmath288",
    "is given by @xmath289 colors transform as @xmath290 if we have only one color , @xmath291 , we can therefore estimate reddening as @xmath292    our goal is to extend this formula to allow the use of multiple colors , possibly with strong covariance .",
    "since @xcite only predict the colors of stars , and not their overall magnitudes , we work in color space . denote the intrinsic stellar colors as @xmath293 , and the reddened colors as @xmath294 .    in a multidimensional color space ,",
    ". becomes @xmath295 where @xmath296 has one component per color @xmath291 , given by @xmath297 .",
    "the estimated intrinsic colors and observed reddened colors are gaussian random variables , with covariances @xmath298 and @xmath299 , respectively . denote the estimated intrinsic colors as @xmath300 , and the observed reddened colors as @xmath301 .",
    "the likelihood of these two quantities taking on a particular set of values is given by @xmath302 in the second step , we have replaced @xmath293 using eq . .",
    "using the symmetry of the gaussian distribution , @xmath303 if we assume a flat prior on @xmath2 and @xmath294 , then the above is proportional to the posterior probability density @xmath304 .",
    "we could , in practice , frame the question in terms of the intrinsic colors @xmath293 , and put priors on them based on our galactic and stellar model , but we wish to avoid tying our segue - derived reddenings in any way to our bayesian photometric reddening estimates .",
    "now , integrating over @xmath294 , we obtain a convolution of two gaussians , which is itself a gaussian distribution : @xmath305 the probability density function of @xmath2 is thus a ray taken through a multivariate gaussian .",
    "it can be shown that the above is also gaussian , with mean and standard deviation given by @xmath306^{-1 } \\ , .\\end{aligned}\\ ] ] we plug intrinsic stellar colors appropriate for the sspp stellar parameters into @xmath301 , and use the observed sdss colors for @xmath307 .",
    "one final note is that @xcite used the sspp stellar types to derive estimates of the mean and covariance of the magnitudes , rather than the colors .",
    "we will now show how to obtain the covariance of the colors from the covariance matrix of the magnitudes .",
    "denote the covariance matrix of the magnitudes as @xmath308 , where @xmath22 and @xmath309 label passbands .",
    "label the color @xmath310 as @xmath311 .",
    "we then call the covariance matrix of the colors @xmath311 and @xmath312 @xmath313 . by expanding out @xmath314 in terms of magnitudes ,",
    "one obtains @xmath315 the common choice of colors is to set the @xmath316 color to @xmath317 . plugging @xmath318 and @xmath319 into the above",
    ", we find that the covariance of the @xmath316 color with the @xmath320 color is given by @xmath321                                                      , n. , burgett , w. , chambers , k. , et  al .",
    "2010 , in society of photo - optical instrumentation engineers ( spie ) conference series , vol .",
    "7733 , society of photo - optical instrumentation engineers ( spie ) conference series                          , p. , tonry , j.  l. , isani , s. , et  al .",
    "2008 , in society of photo - optical instrumentation engineers ( spie ) conference series , vol . 7014 , society of photo - optical instrumentation engineers ( spie ) conference series                                warnes , g. 2001 , the normal kernel coupler : an adaptive markov chain monte carlo method for efficiently sampling from multi - modal distributions , tech .",
    "395 , department of statistics , university of washington"
  ],
  "abstract_text": [
    "<S> we present a method to infer reddenings and distances to stars , based only on their broad - band photometry , and show how this method can be used to produce a three - dimensional dust map of the galaxy . </S>",
    "<S> our method samples from the full probability density function of distance , reddening and stellar type for individual stars , as well as the full uncertainty in reddening as a function of distance in the 3d dust map . </S>",
    "<S> we incorporate prior knowledge of the distribution of stars in the galaxy and the detection limits of the survey . for stars in the pan - starrs 1 ( ps1 ) @xmath0 survey , </S>",
    "<S> we demonstrate that our reddening estimates are unbiased , and accurate to @xmath1 in @xmath2 for the typical star . based on comparisons with mock catalogs , </S>",
    "<S> we expect distances for main - sequence stars to be constrained to within @xmath320% - 60% , although this range can vary , depending on the reddening of the star , the precise stellar type and its position on the sky . a further paper will present a 3d map of dust over the three quarters of the sky surveyed by ps1 . </S>",
    "<S> both the individual stellar inferences and the 3d dust map will enable a wealth of galactic science in the plane . </S>",
    "<S> the method we present is not limited to the passbands of the ps1 survey , but may be extended to incorporate photometry from other surveys , such as 2mass , sdss ( where available ) , and in the future , lsst and gaia . </S>"
  ]
}