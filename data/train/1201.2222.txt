{
  "article_text": [
    "radiation is of fundamental importance for the thermodynamics of most astrophysical systems",
    ". it can be the dominant source of heating and cooling of astrophysical plasmas . even in those systems where it plays a minor role in energy transport ,",
    "it is the dominant mechanism through which we perceive and explore the universe .",
    "nevertheless , it has often proven difficult to directly model the effects of radiation accurately in modern multidimensional astrophysical ( magneto)hydrodynamic ( mhd ) codes due to both computational expense and conceptual complexity .",
    "most approaches to adding radiative transfer to dynamical simulations are based on adopting restrictive assumptions or approximations .",
    "for example , often the flow is assumed to be optically thin to radiation everywhere and for all time , or the radiation field is assumed to originate in a small number of point sources , with the diffuse emission from scattered or reradiated photons ignored ( such as in cosmological reionization problems e.g.@xcite ) .    for problems in which the diffuse emission can not be ignored , the dynamics of the radiation field",
    "is often treated by solving the radiation moment equations using ad hoc closure prescriptions to handle the transition from optically thick to optically thin regimes , such as flux - limited diffusion ( e.g. * ? ? ?",
    "* hereafter fld ) .",
    "this includes applications such as accretion flows , star formation , neutrino transport in supernovae , stellar atmospheres and winds , cosmological reionization , and many others .",
    "indeed , there is a large and growing list of astrophysical mhd codes that utilize fld or a similar prescribed closure relation ( including e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "? * ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "numerical methods for directly solving radiative transfer ( rt ) have been implemented ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) , but their application to astrophysical problems has been somewhat limited , especially in full 3d .",
    "a notable exception is the progress made in simulating the atmospheres of the sun and other cool stars . in the solar physics community",
    ", multidimensional mhd simulations of convection with realistic rt have been performed for decades with increasing sophistication .",
    "( see e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* )    encouraged by recent work modeling the departure of the radiation field from local thermodynamic equilibrium ( lte ) due to the presence of electron scattering in three - dimensional mhd simulations ( see e.g. * ? ? ?",
    "* ) , we have implemented a general - purpose rt solver in athena @xcite , based on the methods widely used in the stellar atmospheres community .",
    "athena is a general purpose astrophysical mhd code , which is being actively developed and already includes several modules for handling a variety of physical processes .",
    "effectively , we have combined athena with a modern stellar atmospheres code . in fact",
    ", athena already has a rt module that computes the effects of ionization radiation from a single point source on the surrounding gas @xcite .",
    "however , this module is not well - suited for modeling the radiation from diffuse continuum emission .",
    "the addition of a rt solver to athena enables three goals : ( 1 ) it can be used as a diagnostic tool to compute self - consistently spectra and images from time - dependent mhd simulations for direct comparison to astronomical observations ; ( 2 ) it allows us to compute a variable eddington tensor ( vet ) for the integration of the coupled mhd and radiation moment equations ( @xcite ; jiang et al .",
    ", submitted to apjs , hereafter jsd12 ) for full radiation mhd simulations in regimes where both energy and momentum transport by photons is important ; and ( 3 ) it allows us to compute the radiation source terms in the energy equations and directly couple them to the mhd integrator to compute the dynamics of flows where radiation pressure can be ignored .",
    "this paper focuses on describing our implementation of methods to solve the rt equation , and the coupling of the solver with the mhd integrator to compute the radiation source term in the energy equation .",
    "the computation of the vet and solution of the radiation moment equations is described in jsd12 .",
    "the plan of this work is as follows : in section [ equations ] we summarize the equations that are solved . in section [ radtrans ]",
    "we describe the detailed implementation of our solver and the iterative methods used model deviations from lte and handle certain ( e.g. periodic ) boundary conditions . in section [ interface ]",
    "we describe how we compute the radiation source terms in the energy equation and incorporate them into the mhd integration . in section [ tests ] we present the results of several test problems not only to assess the accuracy of the rt solver , but also to evaluate the performance of the mhd integrator when the energy source terms are included .",
    "we summarize our results in section [ summary ] .",
    "in this work we solve the usual equations of compressible mhd , including the source term in the energy equation to account for heating and cooling due to radiation .",
    "these source terms are computed directly from a formal solution of the time - independent rt equation .",
    "thus , the basic equations are continuity @xmath0 momentum conservation @xmath1 the induction equation @xmath2 and energy conservation @xmath3    in the above , @xmath4 is the gas density , @xmath5 , @xmath6 is the fluid velocity , and @xmath7 is the magnetic field .",
    "the total stress tensor @xmath8 is defined as @xmath9 and @xmath10 is the total ( fluid ) energy @xmath11 where @xmath5 is the gas pressure and @xmath12 is identity matrix .",
    "the source term on the right hand side of equation ( [ eq : energy ] ) is the net gain or loss of energy due to radiative heating and cooling and is given ( for a static medium ) by @xmath13 this is an integral over frequency @xmath14 of the difference between mean intensity @xmath15 and the total source function @xmath16 , weighted by the total opacity has units of [ @xmath17 . throughout this work",
    "we will use @xmath18 for quantities with these dimensions and @xmath19 for quantities with dimensions of [ @xmath20/g ] , but will refer to these interchangeably as opacities .",
    "] we do not attempt to add the corresponding radiation source term to the momentum equation .",
    "this limits us to applications in which radiation pressure is at most a modest fraction of gas pressure .",
    "an integrator for the coupled mhd and radiation moment equations based on the one - dimensional algorithms discussed in @xcite has been implemented in athena and extended to multidimensions by jsd12 .",
    "these more advanced techniques are needed to handle the stiff source terms and modified dynamics in radiation pressure dominated flows .    in order to compute the energy source term due to radiation",
    ", the mhd equations must be supplemented by the time - independent equation for rt @xmath21 where @xmath22 is the specific intensity for an angle defined by the unit vector @xmath23 . in this work ,",
    "we consider opacities due to scattering @xmath24 and true absorption @xmath25 , with @xmath26 .",
    "it is convenient to define the photon destruction probability @xmath27 .",
    "the source function is then given by @xmath28 where @xmath29 is thermal source function .",
    "the mean intensity @xmath15 is the `` zeroth '' moment , or average , of @xmath22 over solid angle @xmath30    when absorption dominates @xmath31 and @xmath32 , but when scattering dominates @xmath33 and @xmath34 .",
    "note that this expression assumes that scattering is isotropic .",
    "although this is not strictly true for many scattering processes ( e.g. electron scattering ) , it will generally be a good approximation for problems of interest .",
    "in addition to @xmath15 we will also use @xmath35 and @xmath36 , the first and second moments , respectively .",
    "their components are given by @xmath37 where @xmath38 is the differential of solid angle , and @xmath39 .",
    "these moments are related to the radiation energy density @xmath40 , radiation flux @xmath41 , and radiation pressure @xmath42 via the standard definitions @xmath43    integration of equation ( [ eq : radtrans ] ) over solid angle yields @xmath44 and provides an alternative ( differential ) form for the radiation source term in equation ( [ eq : energy ] ) .",
    "the differential form tends to perform better in regions where optical depths across a gridzone are large , while the integral form is preferable in regions of low optical depth .",
    "hence , we will use both expressions , as discussed in section [ interface ] .",
    "we have not been forced to make distinctions between the eulerian and comoving frame for radiation variables as we have dropped all velocity dependent terms in equations ( [ eq : radsource ] ) , ( [ eq : radtrans ] ) , and ( [ eq : rade ] ) .",
    "we neglect these terms because they are negligible for the tests considered in this paper .",
    "however , we anticipate solving problems where the velocity dependent terms may be important and can implement terms that are first order in @xmath45 in our rt solver , where necessary . for consistency with the vet solver ( jsd12 ) , we will adopt the mix frame approach where @xmath22 , its moments , @xmath14 , and @xmath23 are eulerian frame variables , while opacities and emissivities are defined in the comoving frame .",
    "derivations of the mixed frame equations can be found in @xcite , @xcite , @xcite , and @xcite .    since we neglect the time derivative of @xmath22 and terms that are first order in @xmath45 in equation ( [ eq : radtrans ] ) , our method is only formally reliable in the static diffusion and free streaming - limits .",
    "specifically , the timescale for fluid flow @xmath46 across a characteristic length scale @xmath47 in the simulation domain must be longer than the time it takes for radiation to diffuse @xmath48 or free - stream @xmath49 across the domain ( see e.g. * ? ? ? * ) ) .",
    "this is sufficient for the test problems considered here and should be adequate for many of the problems of primary interest to us .",
    "when necessary , we can retain terms first order in @xmath45 in equations ( [ eq : radsource ] ) and ( [ eq : radtrans ] ) and the code will be formally accurate in the dynamic diffusion limit ( @xmath50 ) as well .    throughout this work @xmath29",
    "is assumed to correspond to the planck function and is a function only of @xmath14 and gas temperature @xmath51 .",
    "we assume an ideal equation of state with @xmath52 and gas thermal energy density @xmath53 . here",
    "@xmath54 is the gas constant and @xmath55 is the adiabatic index .",
    "the adiabatic sound speed is @xmath56 .",
    "the methods for solving the mhd equations without the radiation source term are described in detail in previous publications @xcite and are unchanged by the solution of radiation transfer . the computation of rt is described in section [ radtrans ] and the interface of the rt solver and mhd integrator is described in section [ interface ] .",
    "the sequence for a single timestep can summarized as follows :    \\1 ) using the hydrodynamic variables ( typically @xmath51 and @xmath4 ) from the previous timestep as inputs , we compute @xmath57 , @xmath58 , and @xmath29 , or each frequency in each grid zone .",
    "\\2 ) we solve equation ( [ eq : radtrans ] ) using the methods described in section [ radtrans ] , yielding @xmath16 and @xmath15 everywhere in the domain .",
    "\\3 ) using @xmath16 and @xmath15 ( or @xmath59 ) , we compute the radiation source term @xmath60 and update equation ( [ eq : energy ] ) as described in section [ interface ] .",
    "\\4 ) we advance the mhd variables using the standard athena integrators .",
    "an extensive literature on the solution of rt for astrophysical problems in multidimensions exists and there are numerous monographs and review articles on the topic ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) . with this literature to draw from ,",
    "we have largely adopted a strategy of implementing existing , well - developed algorithms .",
    "since there are many different methods with different strengths and weaknesses , the major challenge is finding a method which best suits our particular needs . our most salient constraints include :    \\1 ) the method needs to be amenable to domain decomposition since this is the primary algorithm for parallelizing the solution of the mhd equations in athena .",
    "\\2 ) the method must be able to handle the explicit dependence of the source term on @xmath15 in equation ( [ eq : sourcefunc ] ) for problems in which scattering is important ( i.e. we must be able solve non - lte problems ) .",
    "\\3 ) the method needs to be able to handle ( shearing ) periodic boundary conditions .",
    "\\4 ) the method must be robust and capable of handling discontinuities in temperature and density which arise when shocks are present in the flow .",
    "\\5 ) ideally , the method should be efficient enough that for simple problems ( e.g. lte with grey or mean opacities ) , neither the memory constraints nor the total computational time is dominated by the solution of rt .    with these considerations in mind ,",
    "we have implemented a short - characteristics based solver @xcite . in this method",
    "the specific intensity is discretized on a set of rays at each cell center in the simulation domain .",
    "equation ( [ eq : radtrans ] ) is integrated along each ray using initial intensities interpolated from neighboring grid zones . since",
    "only neighboring grid zones are used for this integration , the total computational cost ( per iteration ) scales linearly with the number of gridzones in the domain .",
    "this is also simple to parallelize with domain decomposition as only information from cells on the faces of the neighboring sub - domains need to be passed .",
    "this is in contrast to a long characteristics method ( e.g. * ? ? ?",
    "* ) , which would integrate the rt equation along each ray through all gridzones intersected by the ray until the edges of the simulation domain are reached .",
    "such a method is generally more computationally expensive since computation of the specific intensity in each gridzone typically requires integrating equation ( [ eq : radtrans ] ) through @xmath61 gridzones ( where @xmath62 is the total number of gridzone in the domain ) .",
    "it is also more cumbersome to use with domain decomposition ( see , however , * ? ? ?",
    "* ) since it may require the passing of larger blocks of data , including information from non - neighboring subdomains .",
    "although short characteristic methods are computationally more expedient , they suffer from greater numerical diffusion due to the interpolation that is required to compute the intensity in neighboring gridzones @xcite . for problems where a few gridzones ( or point sources ) dominate the total emissivity ,",
    "a short characteristics solver may require very high angular resolution to accurately resolve the radiation field far from the dominant source . if the angular resolution is too low , anomalous structure ( e.g. spokes ) in the heating and cooling rates will emanate from the dominant sources ( see e.g. * ? ? ? * ) .",
    "( in this case the numerical diffusion introduced by interpolation can be beneficial . ) instead , the emission from point sources is better handled by suitably designed long characteristics methods ( @xcite , although see also @xcite ) . for the applications of interest in this work ( e.g. accretion flows ) , the diffuse radiation field dominates .",
    "moreover , even when point sources are present , the diffuse radiation field due to scattering or re - emission ( e.g. hii regions ) can not generally be ignored , and therefore we anticipate such problems may be accommodated in the future by a hybrid scheme which uses short characteristics for the diffuse emission , and long characteristics for bright point sources .",
    "non - lte problems are handled via iteration . for each time",
    "step the formal solution of the whole domain is repeated , updating @xmath15 and @xmath16 during each iteration , until some formal convergence criterion is met .",
    "as discussed below , we implement an accelerated ( or approximate ) lambda iteration ( hereafter ali ) algorithm based on the gauss - seidel method of @xcite ( hereafter tf95 ) .",
    "the tf95 method is efficient for solving non - lte problems because it significantly increases the convergence rate without significantly increasing the computational cost ( or memory footprint ) per iteration .",
    "iteration is also used in lte problems to handle boundary conditions at the interface of subdomains and for physical periodic boundary conditions at domain edges . on each iteration the incoming intensity from the neighboring subdomain",
    "is fixed from the previous iteration ( or timestep for the first iteration ) .",
    "the outgoing intensity , which corresponds to the incoming intensity in the neighboring subdomain , is then updated and the formal solution is iterated to convergence . for lte problems ,",
    "this is not the most efficient method for handling the subdomain boundaries ( see e.g. * ? ? ?",
    "for the moment , we are primarily interested in non - lte problems where iteration is required regardless .",
    "we generally find fairly rapid convergence ( requiring only a few iterations ) for most of our lte test problems when iterations is used , so this is not a significant limitation .",
    "in many respects our short - characteristics rt solver is similar to those of @xcite and @xcite in that both implement ali to handle deviations from lte and both utilize domain decomposition for parallelization .",
    "@xcite used their code to solve the rt equation including scattering , in mhd simulations of stellar atmospheres on three - dimensional cartesian grids .",
    "hence , the effectiveness of several key aspects of our module have already been demonstrated in a sophisticated mhd code and applied to realistic astrophysical applications .",
    "the scheme we have implemented allows for the computation of frequency dependent , grey , or monochromatic rt .",
    "radiation variables ( moments and specific intensities ) and radiative properties of the fluid such as the opacities , thermal source function , and photon destruction parameter are tabulated on a grid of @xmath63 discrete frequencies or frequency groups . for flexibility , the functional form of opacities and emissivities can be specified via user - defined functions .",
    "in general , the computational cost and memory footprint of problems scale linearly with @xmath64 .",
    "these frequency bins can simply be discrete frequencies when rt is used to generate diagnostic outputs such as images and spectra .",
    "group mean opacities and emissivities ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) and corresponding quadrature weights must be specified when the rt solver is used to compute the radiation source terms or vet . in the simplest case , @xmath65 and an appropriate frequency integrated mean opacity is specified .",
    "unless otherwise noted , we will drop subscripts denoting the frequency dependence of radiation variables and only describe the monochromatic problem hereafter . for the problems under present consideration",
    ", there is no explicit coupling of the specific intensity at different frequencies so the frequency dependent calculation is a trivial generalization of the monochromatic problem .",
    "we discretize the specific intensity on both angular and spatial grids . for one - dimensional problems ,",
    "the discretization is chosen so that polar angles correspond to the abscissas for gaussian quadrature . in multidimensions ,",
    "discretization of the angles proceeds according to the algorithm described in appendix b of @xcite , which is based on the principles of type a quadrature described in @xcite .",
    "this method attempts to distribute the rays as evenly as possible over the unit sphere , subject to the constraint that each octant of the unit sphere is discretized identically .",
    "hence the angle discretization is invariant for 90@xmath66 rotations about the coordinate axes .",
    "this is desirable because athena is designed to be a general purpose code , and there is often no preferred direction with which to align the angular grid ( as in some atmosphere calculations ) . without this constraint ,",
    "the result would generally depend on the orientation of boundary and initial conditions relative to the coordinate axes .",
    "the user specifies the number of polar angles @xmath67 , and the code generates an array of @xmath68 rays covering the unit sphere . in one dimension",
    ", this corresponds to @xmath69 rays because of axisymmetry . for multidimensional domains @xmath70 rays .",
    "however , in two - dimension only half of these are unique due to the implied invariance of physical quantities in the third dimension and @xmath71 .",
    "setting @xmath72 in a one - dimensional calculation is analogous to invoking the two - stream approximation , in which the radiation field of each hemisphere is approximated by transfer along a single ray .",
    "this assumption is commonly used to derive analytic solutions , and allows the ratio of @xmath73 to vary but keeps the ratio of @xmath74 fixed at 1/3 , consistent with the eddington approximation . in two",
    "( three ) dimensional calculations , choosing @xmath75 approximates each quadrant ( octant ) with a single ray and also yields @xmath76 .",
    "the algorithm is well - defined and unique only for @xmath77 @xcite , corresponding to @xmath78 ( 84 in two dimensions ) .",
    "this should not be prohibitive for the problems of interest .",
    ", and @xmath79 are known at e , and @xmath80 is to be computed .",
    "@xmath80 is computed along a each ray using equation ( [ eq : rtdisc ] ) .",
    "since quantities @xmath81 , @xmath82 , and @xmath83 do not correspond to vertices of the grid , they must be computed via interpolation from neighboring grid zones .",
    "the red ray intersects rows between vertices a and b ( upwind ) or h and i ( downwind ) .",
    "hence the values of @xmath84 , @xmath18 and @xmath85 at these vertices are used to interpolate @xmath82 , @xmath83 , and @xmath81 .",
    "vertices c and g are also used with quadratic interpolation .",
    "a similar case holds for the blue ray , but with interpolation performed on columns a - d - g and c - f - i .",
    "the open and closed circles denote vertices which are used for the interpolation of @xmath81 .",
    "the dashed curve is an extension of the blue ray which intersects a - b - c row .",
    "[ f : zone],scaledwidth=47.0% ]    for each ray @xmath86 , we compute a vector of direction cosines @xmath87 with @xmath88 and quadrature weights @xmath89 . then equations ( [ eq : j])-([eq : k ] ) become @xmath90 where @xmath91 .      the short characteristic method @xcite has been discussed previously by several authors . the basic computation step for a single gridzone in both lte and non - lte problems is illustrated in figure [ f : zone ] for the two - dimensional case .",
    "fluid radiative properties and radiation variables ( e.g. @xmath92 , @xmath93 , @xmath94 , @xmath95 , @xmath96 , @xmath84 ) are defined on a radiation grid .",
    "the vertices of this grid correspond to the cell centers of the mhd domain so that fluid radiative properties are computed directly from the cell centered mhd fluid variables .",
    "generalizing to three dimensional domains is straight - forward .    at each vertex ,",
    "the specific intensity @xmath97 at @xmath98 is computed along each ray @xmath86 from @xmath99 to @xmath100 . for second - order interpolation",
    "the intensity is given by @xmath101 where @xmath102 , @xmath103 , and @xmath104 denote interpolation coefficients which depend on the opacities @xmath105 , @xmath79 , and @xmath106 through the optical depth intervals @xmath107 and @xmath108 .",
    "the form of the interpolation coefficients @xmath102 , @xmath103 , and @xmath104 depends on the interpolation method used .",
    "the standard expressions for second order interpolation are listed in equations ( 7a)-(9c ) of @xcite .",
    "one drawback of these expression is that they are subject to overshoot where gradients in @xmath109 and @xmath110 are steep .",
    "fortunately , these cases can be handled with bzier - type interpolation as described in @xcite and @xcite .",
    "with bzier - type interpolation schemes , one can utilize a control point @xmath111 to determine if overshoots are present in the standard second - order expressions .",
    "if @xmath112 or @xmath113 overshoots are present and alternative expressions are utilized .",
    "suitable choices follow from setting @xmath114 or @xmath115 . @xcite",
    "provide the corresponding expressions for @xmath116 and @xmath103 in their appendix a. similar methods are also used to compute intervals @xmath117 ( see e.g. equation a.3 of @xcite ) .    for one - dimensional problems ,",
    "@xmath99 and @xmath100 correspond to neighboring grid vertices @xmath118 and @xmath119 .",
    "hence , @xmath120 , which was just computed in the neighboring zone while @xmath109 , and @xmath110 can be computed directly from hydrodynamics variables at @xmath121 . in multidimensional problems , @xmath99 and @xmath100 no longer correspond to vertices of the radiation grid and variables @xmath122 , @xmath109 , and @xmath110 must be interpolated .",
    "we implement and test both first - order ( linear ) and monotonic second order ( quadratic ) interpolation schemes @xcite .",
    "both methods prevent overshoots and enforce positivity of the interpolants .",
    "the choice is particularly relevant for @xmath95 , as second - order methods generally produce much less diffusion of the radiation beam .",
    "a drawback of second order interpolation is that it places additional constraints on the order in which one sweeps through gridzones and the stencil used for the evaluation of @xmath95 .",
    "consider the two rays depicted in figure [ f : zone ] .",
    "we compute interpolants @xmath109 and @xmath110 using known quantities at vertices of the radiation grid .",
    "if row a - b - c or column a - d - g correspond to ghost ( boundary ) zones , @xmath123 can be computed from the ( prescribed ) boundary intensities .",
    "if they are not ghost zones , interpolation can only be performed on zones in which @xmath95 has already been computed .",
    "if we first sweep along rows of fixed @xmath124 ( as in figure [ f : sweep ] ) , @xmath95 has only been computed at vertices a , b , c , and d. this means that @xmath95 is known for all vertices used in the linear interpolation of @xmath122 as well as for quadratic interpolation ( and any higher order interpolation ) of rays which intersect row a - b - c .    , computing rt only for upward pointing rays ( @xmath125 ) . for each row ( fixed @xmath124 )",
    ", one first sweeps parallel to @xmath126 , computing rt along rays with @xmath127 until reaching the grid edge @xmath128 , then reverses direction and computes along rays with @xmath129 until reaching the grid edge @xmath130 .",
    "this continues until one reaches gridzone @xmath131 .",
    "the backward sweep ( blue curves ) inverts the forward sweep , computing rt only for downward pointing rays ( @xmath132 ) . in the gauss - seidel method , updated values of @xmath133",
    "are incorporated into the backward sweep , beginning with @xmath134 .",
    "the three - dimensional case is a straightforward generalization .",
    "[ f : sweep],scaledwidth=47.0% ]    we refer to rays that intersect the column a - d - g , such as the blue one in figure [ f : zone ] , as `` shallow '' rays .",
    "shallow rays are a potential problem for quadratic ( and higher order ) interpolation , since @xmath95 at g has not been computed .",
    "when quadratic or higher order interpolation is desired , such rays can be handled in a number of ways .",
    "one possibility is to switch the order of the sweep for shallow rays so that it first proceeds in the y direction along columns of fixed @xmath135 . in this case @xmath95 for shallow rays will be known at vertices a , b , d , and g. the main drawback ( discussed further in section [ nonlte ] below ) is that one is unable to implement a gauss - seidel iteration for non - lte problems",
    ".    one can also construct alternatives by extending the stencil beyond vertices a - i .",
    "for example , one can extend shallow rays until they intersect row a - b - c as shown by the dashed curve in figure [ f : zone ] .",
    "a drawback of this solution is that it requires modest additional effort for computing @xmath102 , although this can be alleviated by computing only on the first iteration and reusing it for subsequent iterations ( e.g. * ? ? ?",
    "alternatively quadratic interpolation could be preformed using a , d , and the vertex directly below a @xcite .",
    "these two solutions share common drawbacks .",
    "for parallelization with domain decomposition , only one ghost zone is needed per grid zone on a subdomain face , when only vertices a - i are used .",
    "extension of shallow rays beyond this stencil requires the passing of additional data and associated bookkeeping .",
    "more philosophically , we feel it is desirable to treat all rays as consistently as possible . in either of these schemes ,",
    "rt along some rays will be computed using only neighboring grid zones , while other rays will not .",
    "our preference is to treat all rays on the same footing .    for this reason",
    ", we have decided to switch the order of the sweep for shallow rays .",
    "athena is implemented so that each sub - grid of the domains has regular spacing and therefore gridzones with fixed aspect ratio .",
    "this means that the distinction between rays that are shallow and those that are not is equivalent for each grid zone",
    ". however , our definition of a shallow ray depends upon the direction of the sweep .",
    "the blue ray in figure [ f : zone ] is shallow because we first traverse the grid along rows of fixed @xmath124 , only moving to @xmath136 when intensity has been computed for all gridzones in the row @xmath124 , as depicted in figure [ f : sweep ] .",
    "if we reverse the sweep so that we first traverse columns of fixed @xmath135 , the blue ray will no longer be shallow , as the intensity at g will be computed before it is needed for the computation of the intensity at e. in this case the red ray is now a shallow ray as the intensity at c will not have been computed before it is needed to compute the intensity at e. hence , by varying the sweep direction , we can handle all rays and accommodate a quadratic interpolation scheme which computes all intensities in a gridzone @xmath137 only using intensities from neighboring gridzones @xmath138 .",
    "we now describe how we handle non - lte problems iteratively . following common convention",
    "we denote the angle averaged formal solution of the rt equation ( hereafter , simply the formal solution ) in operator notation as @xmath139 here , @xmath140 is a linear operator representing the ( discretized ) formal solution , and @xmath96 and @xmath84 are vectors spanning each gridzone in the simulation domain . using equation ( [ eq : sourcefunc ] ) to eliminate @xmath96 ,",
    "one obtains an equation for @xmath84 in terms of @xmath93 @xmath141+\\epsilon b. \\label{eq : sourcefunc2}\\ ] ] since @xmath140 is a linear operator we can solve for @xmath84 @xmath142^{-1}[\\epsilon b ] .",
    "\\label{eq : sourcefunc3}\\ ] ]    if one can invert @xmath140 a formal solution of the non - lte problem follows from solving ( [ eq : sourcefunc3 ] ) and obtaining @xmath96 from ( [ eq : formalsol ] ) .",
    "however , for three - dimensional problems @xmath140 is a very large matrix and not sparsely populated when systems are far from lte so its direct inversion is impractical .",
    "therefore , equation ( [ eq : sourcefunc2 ] ) is usually solved via iteration .",
    "a simple iterative scheme for solving equation ( [ eq : sourcefunc2 ] ) begins with an initial guess for the source function @xmath143 , which is then used to compute an improved estimate @xmath144+\\epsilon b$ ] .",
    "however , this method ( often referred to as lambda iteration ) has very poor convergence properties . for practical problems , ali methods",
    "@xcite are commonly used .",
    "@xcite , @xcite and tf95 provide useful reviews of ali methods and we refer the reader to these works for a more in - depth discussion .",
    "here we just summarize the basic concepts involved .    in ali methods",
    "one solves equation ( [ eq : sourcefunc3 ] ) directly , but using an approximate form @xmath145 which is easier to invert then the full @xmath140 operator . since only the approximate @xmath145",
    "is used , iteration is still necessary .",
    "numerous choices for @xmath145 have been proposed , but it has been argued that simply taking the diagonal elements of the full @xmath140 matrix represents a near - optimal choice @xcite .",
    "@xcite provide expressions for diagonal elements of @xmath140 when short characteristics are used . in each grid zone the change in the source functions @xmath146 can be written as @xmath147 where the subscript @xmath148 enumerates all gridzones in the domain .",
    "as tf95 discuss , when @xmath149 is exclusively used in equation ( [ eq : dsjacobi ] ) , the ali scheme is equivalent to the jacobi iterative method for solving linear systems .",
    "tf95 show that one can construct a gauss - seidel algorithm by incorporating the new values of @xmath150 in equation ( [ eq : dsjacobi ] ) as these become available .",
    "here @xmath151 refers to gridzones where @xmath96 has already been updated .",
    "the complexity of devising a gauss - seidel algorithm for rt comes from the fact that the computation of specific intensity @xmath152 for some subset of the rays @xmath86 need to be computed using @xmath153 rather than @xmath154 ( i.e. old rather than new values of the source function ) .",
    "therefore the contribution from these particular rays to @xmath150 must be corrected as the updated values @xmath154 become available .",
    "tf95 give a detailed description of how to implement such an algorithm on a one - dimensional domain .",
    "the algorithm requires storing a modest amount of data in each gridzone , but very little additional computation .",
    "the convergence rate is improved by a factor of two , so problems requiring several iterations gain nearly a factor of two decrease in computational effort for only a minor increase in code complexity .",
    "when linear interpolation is used , the generalization of their one - dimensional method to two and three - dimensional domains is straight - forward .",
    "the two - dimensional sweep proceeds as depicted in figure [ f : sweep ] .",
    "the vertices in the radiation grid correspond to cell centers @xmath137 .",
    "the sweep generally proceeds with @xmath148 as the more rapidly varying index .",
    "consider a domain with @xmath155 for simplicity . in each gridzone @xmath137 ,",
    "we first compute the intensity @xmath95 for all upward directed rays @xmath156 in the forward sweep and then for all downward directed rays @xmath157 on the reverse sweep .    on the reverse sweep ,",
    "the upper right gridzone @xmath158 is the first in which the computation of all new intensities @xmath159 is completed . at this point",
    "@xmath160 is completely specified and we compute @xmath161 . from here on ,",
    "all subsequent rt computations use @xmath161 rather than @xmath162",
    ". however , this alone is not sufficient to make it a gauss - seidel scheme , because the contributions to @xmath163 , @xmath164 , and @xmath165 from upward directed rays on the forward sweep used @xmath162 .",
    "these must also be updated using @xmath166 and weights which were saved on the forward sweep .",
    "we also update the outgoing intensities @xmath159 ( since they were also computed using @xmath162 ) as they correspond to the incoming intensities in neighboring gridzones .",
    "since the corresponding weights have already been computed as part of the forward sweep , the additional computational cost is very modest .",
    "following the discussion in section [ shortchar ] , we note that feasibility of performing a gauss - seidel iteration with quadratic interpolation is dependent on the way shallow rays are handled . reorienting the sweep for shallow rays so that @xmath167 is more rapidly varying index , but keeping @xmath148 as the rapidly varying index for remaining rays does not allow for an efficient gauss - seidel scheme because some of the necessary @xmath168 ( and therefore @xmath169 ) are not available when the backward sweep begins .",
    "in the light of this issue , we have implemented gauss - seidel routines only with linear interpolation . for problems where",
    "quadratic interpolation is preferable , we default to the jacobi method ( i.e. standard ali ) .",
    "we continue the iteration until some convergence criterion is met .",
    "consistent with previous work , we stop iterating when the maximum relative change in the source function over the whole domain is less than some prescribed threshold @xmath170 @xmath171 for lte problems that use iteration to handle boundary conditions , @xmath84 does not change from one iteration to the next and we replace @xmath172 with @xmath173 in equation ( [ eq : conv ] ) .",
    "the choice of @xmath170 is clearly an important input to the method , but there is no firmly established criterion and the optimal choice depends on a number of considerations that may be problem dependent . since the computational cost of the method generally scales linearly with the number of iterations performed and a lower threshold leads to more iterations , there is a tradeoff between accuracy and computational expediency . with the exception of the uniform temperature non - lte atmosphere",
    ", the tests presented in section [ tests ] were performed using @xmath174 .",
    "increasing @xmath170 to @xmath175 had a negligible impact on the linear wave tests .",
    "our expectations based on the tests we have performed so far are that for the problems of primary interest to us ( e.g. shearing box simulations of accretion disks ) @xmath176 will be sufficient , consistent with studies using similar methods ( e.g. * ? ? ?",
    "* ) . however , we emphasize that the appropriate choice will be problem dependent and must be assessed on a case - by - case basis .",
    "we view the choice of @xmath170 in roughly the same terms as we view the choice of grid resolution .",
    "one can adopt a threshold based on previous results and experience , but ultimately one needs to compute the problem using a range of @xmath170 and choose a sufficiently small value such that the results are insensitive to the choice .",
    "boundary conditions and domain decomposition in athena are both implemented for mhd via the use of ghost zones , and we implement rt boundary conditions in an analogous way .",
    "the solver computes rt in gridzones on a boundary ( domain or subdomain ) in the same way as an interior gridzone , but using the intensities and source functions from the ghost zones to compute the relevant integration weights and interpolants .",
    "the intensities and source functions in the ghost zones are determined according to prescribed boundary conditions .    in general , boundary conditions for the mhd integrator will not translate directly to boundary conditions for the rt solver .",
    "different problems with the same mhd boundary conditions may require different boundaries for the radiation field .",
    "hence separate boundary conditions must be prescribed when using the rt solver . for the code test problems presented in section [ tests ] ,",
    "we have implemented two types of boundary conditions specifying either fixed incident intensity or periodic intensities on the boundaries .",
    "other boundary conditions can be specified via user defined functions .",
    "athena runs on parallel machines using domain decomposition implemented through mpi calls .",
    "the mhd integrator passes all conserved variables and passive scalars from faces of neighboring subdomains to ghost zones .",
    "the mhd integrator requires either four or five ghost zones for each gridzone on the subdomain face .",
    "the rt solver operates analogously , passing intensities and source functions , but only requires one ghost zone for each gridzone on a subdomain face .",
    "the main differences between the rt solver and the mhd integrator are the frequency and quantity of data that must be passed . for each frequency bin in every ghost zone @xmath85",
    "must be passed for all @xmath177 rays with quadratic interpolation or , alternatively , @xmath178 incoming rays with linear interpolation . for non - lte problems",
    "@xmath84 and @xmath179 must also be passed .",
    "hence for quadratic interpolation , the code passes a total of @xmath180 floating point variables per face gridzone per _ iteration _ , where @xmath181 is the number of dimensions in the domain .",
    "in contrast , the mhd integrator typically passes @xmath182 floating point variables per face gridzone per _",
    "timestep_. for problems where @xmath177 and @xmath183 are small and few iterations are required ( e.g. an lte grey problem ) , the volume of rt data is therefore comparable to and may even be less than the amount of data passed by the mhd integrator .",
    "we note that the use of iteration to handle subdomain boundary conditions may lead to some dependence on the number of subdomains that are used .",
    "we have considered the sensitivity of our results to this issue by performing most of the tests described in section [ tests ] both with and without domain decomposition . in practice ,",
    "the converged mean intensities do not differ ( relative to the non decomposed domain ) by more than @xmath184 .",
    "the sensitivity is highest for problems where the optical depth across an individual subdomain is of order unity or smaller , problems with optically thick subdomains generally lead to smaller discrepancies . since we already choose our convergence criterion to be at a level that minimizes the impact on our results , this sensitivity to the domain decomposition should not lead to significant errors",
    "there are two regimes in which the effect of radiation on the mhd is important .",
    "the first is when the radiation field is a significant contribution to both the energy and momentum fluxes in the flow . in this regime , the radiation source terms in the mhd equations can be very stiff , and the equations contain wave modes which propagate at close to the speed of light . both of these properties require significant modification to the underlying mhd integrators in order to enable accurate and stable integration . in jsd12",
    "we describe a method for this regime based on an extension of the modified godunov method of ss10 to multidimensions , with a vet ( defined as @xmath185 ) computed from a formal solution of the rt equation using the module described in this paper . at each time step , the rt solver computes the radiation field as described in section [ radtrans ] , evaluating @xmath186 and @xmath96 via equations ( [ eq : jsum ] ) and ( [ eq : ksum ] ) .",
    "we the compute the vet using @xmath187 as described in section 3.4 of jsd12 .",
    "the second regime is when the radiation pressure can be ignored , and the effect of radiation is only through the heating and cooling source terms in the energy equations . in principle , the modified godunov method adopted in jsd12 would be an attractive approach for handling the stiff energy source term that can arise in this regime as well .",
    "however , the modified godunov method requires that one compute the gradient of radiation source terms on the plane of primitive variables .",
    "this in turn requires analytic expression for the radiation sources in terms of the fluid variables .",
    "hence , it is generally not a viable method for problems where the radiation properties are complicated functions of frequency and fluid variables , as may be the case with bound - free and bound - bound atomic opacities or compton scattering .",
    "these limitations motivate us to implement an alternative method to directly compute the radiation source term in the fluid energy equation ( [ eq : energy ] ) and couple it to the standard mhd integrators . when operating in this mode , we perform the formal solution at the beginning of each timestep .",
    "we first compute fluid radiation properties in each gridzone @xmath188 of the domain .",
    "this includes the variables @xmath189 , @xmath190 , and @xmath191 , which are computed via user - defined functions of the conserved mhd variables and passive scalars from the previous timesteps .",
    "we use these , along with @xmath173 from the previous time - step , to initialize @xmath172 .",
    "once the formal solution is completed , we account for the source function on the right hand side of equation ( [ eq : energy ] ) via an operator split update of @xmath10 .",
    "we first compute the radiative source function in each zone and then update the total energy @xmath192 the standard mhd integration algorithm then proceeds using this `` new '' value for @xmath193 .",
    "we compute @xmath60 in one of two ways , depending on the characteristic optical depth .",
    "we either use the integral form @xmath194 or the differential form @xmath195 previous work ( * ? ? ?",
    "* and references therein ) has demonstrated that the integral form is inaccurate when the optical depth per gridzone is large . in this case @xmath196 while @xmath197 is large so round - off errors can be greatly amplified .",
    "the integral form , however , is more accurate when @xmath198 @xcite .",
    "therefore , we have designed our rt solver to compute either form of @xmath60 , depending on the regime of the computation . in most applications of interest , there is a transition from optically thick to optically thin regions , so we must specify a criterion for switching between the differential and integral forms in the same domain . for the test problems considered here",
    ", we find a simple switch @xmath199 to be sufficient .",
    "this has the advantage that it is a purely local criterion . using a method which more smoothly interpolates between the two regimes ( see e.g. * ? ? ?",
    "* ) did not improve performance in a measurable way , but may be preferable for more sophisticated applications .    due to the explicit update , we must take care in choosing a time step . in the absence of radiation",
    "the mhd integrator chooses a time step @xmath200 based on the cfl constraint . in principle , this time step can be much larger than the radiative cooling time , which could lead to obvious errors , such as the energy density becoming negative . as we elaborate upon in section [ linwave ] , one can derive a generalized cfl condition for a radiating fluid based on the need to resolve the damping time for a non - equilibrium radiation diffusion mode .",
    "this time scale @xmath201 is generally most restrictive when the optical depth per gridzone @xmath202 , in which case @xmath203 assuming the adiabatic sound speed @xmath204 ( rather than the alfvn speed ) sets the cfl condition . this generalized cfl constraint can be quite stringent , requiring short time steps and increasing computational costs if either @xmath205 or @xmath206 .",
    "hence , many problems will require the use of the vet method described in jsd12 , which uses timesteps determined by the standard ( non - radiative ) cfl constraint .",
    "in practice , we are almost always limited to problems with @xmath207 , so we do not attempt to include the radiation momentum source term in equation ( [ eq : mom ] ) as it is generally small for problems that are computationally feasible with operator splitting .    the algorithm described above",
    "will , in general , only be first order convergent .",
    "note that we could construct a second - order scheme when using athena s vl+ct integrator @xcite , by performing the operator split update before the corrector step in the predictor - corrector scheme .",
    "however , some of the advantages of the second order convergence will be lost due to the increased diffusivity of the vl+ct relative to the ctu+ct scheme @xcite .",
    "hence , we have not yet pursued the possibility although it may prove to be a useful avenue for future work .",
    "our test problems fall into roughly two categories : stand - alone tests of the rt solver on fixed domains and tests of the coupled mhd integrator and rt solver in fully time dependent calculations .",
    "the former are particularly useful for evaluating the rt solvers performance on multidimensional and non - lte problems . for the latter , we focus primarily on simpler lte problems ,",
    "so we can compare the simulations result directly to precise analytic or semi - analytic solutions .",
    "further tests of the rt solver as part of the vet method are presented in jsd12 .    .",
    "the curves show the maximum relative difference between the numerically computed @xmath84 and the analytic solutions implied by equation ( [ eq : jana ] ) for the jacobi ( solid ) and gauss - seidel ( dotted ) methods .",
    "we compute the numerical solutions using a one - dimensional domain with 9 gridzones per decade in optical depth .",
    "[ f : conv_comp],scaledwidth=47.0% ]      we begin by solving the monochromatic rt problem in a uniform temperature , one - dimensional scattering dominated atmosphere .",
    "this test is particularly useful for evaluating the rt solver s performance on a non - lte systems and evaluating the convergence properties of jacobi and gauss - seidel iterative schemes .",
    "we adopt the two - stream approximation for the rt solver so we can compare directly with analytic solutions based on the eddington approximation . since we assume a uniform opacity @xmath208 and temperature @xmath51 ,",
    "the analytic solution is only a function of optical depth @xmath209 , the thermal source function @xmath93 and photon destruction probability @xmath94 . with these assumptions the mean intensity @xmath96",
    "is given by @xmath210 we assume that @xmath211 and @xmath4 increases exponentially ( but keep @xmath94 constant ) with distance from the upper boundary , which has no incoming intensity .",
    "this provides an exponential variation in @xmath212 which is well - suited for resolving the transition from lte to non - lte within the atmosphere .",
    "figure [ f : conv_comp ] shows the convergence of the true error of the numerically derived solutions .",
    "this is evaluated as the maximum relative difference @xmath213 , with @xmath214 the difference of the numerically derived @xmath84 from the analytic solution .",
    "we first consider a one - dimensional domain with @xmath215 , as this gives a highly non - lte atmosphere and facilitates direct comparison with figure 3 in tf95 .",
    "we initialize the radiation field to be in lte everywhere ( @xmath216 ) .",
    "we consider two different iterative schemes : jacobi and gauss - seidel .",
    "as expected , the convergence rate of the gauss - seidel methods is nearly a factor of two better than jacobi .",
    "we assume nine gridzones per decade in @xmath212 to match tf95 and our convergence rates agree reasonably well with those shown their figure 3 .",
    "to @xmath217 from top to bottom .",
    "we compute the numerical solutions simulations using cubic three - dimensional domains with @xmath218 gridzones , distributed over 64 mpi subdomains .",
    "the optical depth variation is aligned with the @xmath219-axis of the simulation domain and the solution is uniform in the horizontal directions . [",
    "f : eps_comp],scaledwidth=47.0% ]    we have also implemented the successive over - relaxation ( sor ) method of tf95 , and find rapid convergence , consistent with that shown in figure 3 of tf95 .",
    "we have tested sor on both one - dimensional and two - dimensional domains and find that it is an effective method as long as all boundary intensities are fixed during iteration . however , if the intensities on one of the boundaries vary from one iteration step to the next , the method is generally not stable .",
    "for example , instability occurred when we used periodic boundary conditions or when we employed subdomain decomposition .",
    "since most of our primary science goals involve problems that require the use of periodic boundary conditions or domain decomposition , we do not consider sor a generally viable method for our work .",
    "nevertheless , it may be an effective method for a modest sized problem that can be run serially with fixed boundary intensities .",
    "we next consider the same test problem , but use a cubic three - dimensional domain with @xmath75 .",
    "we align the variation of density with the @xmath219 axis of the domain and use periodic boundaries in the horizontal directions . figure [ f : eps_comp ]",
    "shows a comparison of the numerical and analytical solutions for various choices of @xmath94 .",
    "the agreement between the numeric and analytic solutions is quite good overall , but tends to be poorest at low optical depths . for fixed resolution",
    ", the discrepancies with the analytic solution tends to increase as @xmath94 decreases and the domain deviates more strongly from lte .",
    "the accuracy of the numerical solution improves with increasing resolution , but the number of iterations needed for convergence increases roughly linearly with resolution .",
    "the number of iterations required for convergence also increases as @xmath94 decreases .",
    "hence , greater deviations from lte require a greater number of iterations for convergence , as one would expect .",
    "0.10 , 0.28 , 0.46 , 0.62 , 0.76 , and 0.99 .",
    "the atmospheres have constant temperature ( @xmath220 k ) and density which varies exponentially with distance , rising from @xmath221 g/@xmath222 at the upper ( surface ) boundary to @xmath175 g/@xmath222 and lower boundary . for comparison , we plot the corresponding blackbody at @xmath220 k as a dashed curve . [",
    "f : spec],scaledwidth=47.0% ]    although some rt problems do require explicit frequency coupling ( e.g. compton scattering , partial redistribution ) , many problems can be treated in the approximation that frequencies are not explicitly coupled .",
    "multifrequency problems are then just a series of single frequency calculations and , hence , a straightforward generalization of the monochromatic problem .",
    "figure [ f : spec ] shows the intensity spectrum from a multifrequency calculation done with athena for a uniform temperature atmosphere .",
    "we again assume @xmath4 varies exponentially with distance , rising from @xmath221 g/@xmath222 at the upper boundary to @xmath175 g/@xmath222 and lower boundary .",
    "the results plotted here are for @xmath223 .",
    "incoming intensity at the upper boundary is assumed to be zero and @xmath224 at the lower boundary .",
    "we include isotropic electron scattering opacity and free - free ( bremsstrahlung ) emission and absorption .",
    "the electron scattering is modeled as isotropic and the cross - section is the thomson cross - section . for simplicity free - free processes are computed assuming a gaunt factor of unity .",
    "the plasma is assumed to be completely ionized hydrogen .",
    "hence , @xmath58 , @xmath29 , and @xmath225 are all functions of frequency . however , for an individual frequency the calculations are very similar to those described above .",
    "the only difference is that @xmath58 is now a function of depth as well , due to the different dependence of scattering and absorption opacity on @xmath4 .",
    "figure [ f : spec ] also shows the results of a feautrier calculation for the same atmosphere using the same angular grid .",
    "the two calculations generally agree quite well , although there is a tendency for the athena solver to give slightly higher intensities for frequencies where the spectrum deviates from blackbody .",
    "the discrepancy between the results is a function of spatial resolution with agreement between the two codes improves as the @xmath226 is increased in the athena calculation .",
    "calculations on two and three dimensional domains ( but with density varying only in one dimension ) yield similar results .",
    "we now consider the propagation of crossing beams of radiation , incident on the boundary of a rarefied ( @xmath227 , @xmath228 ) , periodic domain .",
    "this test is particularly useful for evaluating the amount of diffusion associated with the interpolation schemes for the specific intensity .",
    "it is also useful testing the performance of periodic and subdomain boundary conditions .",
    "the results for a two - dimensional domain with periodic boundary condition in the horizontal direction are shown in figure [ f : beam2d ] .",
    "the figure compares a computation with linear interpolation to one with quadratic monotonic interpolation .",
    "our implementation of these methods is described in section [ shortchar ] .",
    "it is clear from figure [ f : beam2d ] that linear interpolation leads to substantially greater diffusion of the radiation beam .",
    "depending upon the application , the additional diffusion in the linear interpolation scheme can be either advantageous or problematic .",
    "on one hand , a less diffusive scheme allows one to model important effects , such as shadowing by optically thick material , with greater fidelity .",
    "indeed , the ability to more accurately capture such effects is an important motivation for using rt instead of more ad hoc closure prescriptions , such as fld .",
    "however , computational expedience limits the angular resolution we can achieve .",
    "when only a modest number of rays are used with a less diffusive scheme , fan - shaped `` spokes '' can appear in the mean intensities and eddington factors , if the emission in a small number of grid zones significantly exceed that of surrounding zones .",
    "indeed , our short characteristics based method is not well suited to problems with bright point sources for this reason , but even in applications with distributed emission regions , there can be relatively confined regions with larger than averaged emission ( e.g. due to magnetic dissipation ) . in such cases , a greater degree of diffusion in the intensity can mitigate unphysical effects which would otherwise arise due to the limited angular resolution .    a related test of an rt routine is its ability to cast a shadow when an optically thick obstruction is present in the domain .",
    "we present such a calculation in section 5.5 of jsd12 , where the ablation of an optically thick cloud is studied . in this case",
    "the rt solver was used to compute the radiation field using linear interpolation for the intensity field of neighboring zones .",
    "figure 14 of jsd12 demonstrates that our rt solver can produce sharply defined umbra and penumbra under such conditions .",
    "fld and other approximate moment methods generally fail this test ( see e.g. * ? ? ?",
    "* ) .",
    "we now focus on comparing the performance of our short characteristics solver ( referenced throughout this section as the sc method ) with two alternative methods : fld and monte carlo ( mc ) .",
    "our motivation is two - fold : in part , we want to evaluate the performance on a fully three dimensional domain , but impose as few restrictive assumptions ( e.g. the eddington approximation ) on the radiation field as possible . since there is a paucity of such truly three dimensional problems with analytic solutions , comparison with alternative rt solution methods",
    "is the best alternative .",
    "in addition , fld and mc methods are , in principle , some of the most computationally efficient alternatives to short characteristics solvers , so direct comparison may allow us to assess the relative merits of different methods .",
    "for this comparison we use a three dimensional snapshot from a stratified shearing box simulation , corresponding to a gas pressure dominated patch of an accretion disk @xcite .",
    "this simulation was computed with the zeus mhd code , using the fld solver developed by @xcite and subsequently modified by @xcite .",
    "they solved the radiation moment equations using a flux limiter of the type described in @xcite .",
    "further details about the particular snapshot used here can be found in @xcite . from the @xmath40 dump , we compute @xmath229 and the eddington factor @xmath230 , using finite differences and flux limiters consistent with those employed in the numerical simulation .",
    "we solve the rt equation on this snapshot using both our sc solver and the mc code described in @xcite .",
    "for both calculations , we assume isotropic electron scattering and monochromatic rt ( i.e. a single frequency bin ) with mean opacities equal to those used in the zeus simulation ( @xmath231 and @xmath232 , both in cgs units ) .",
    "we assume no incoming intensity at the surface boundaries and periodicity in the horizontal directions .",
    "the latter assumption is inconsistent with the use of shearing periodic boundaries in the radial direction in the numerical simulation , but this does not contribute significantly to the discrepancy between the sc and fld methods    we compare the radiation moments ( @xmath42 , @xmath230 , @xmath233 , and @xmath40 ) output by the sc / mc solvers with those determined by the fld method .",
    "independent of the variable used for comparison , we find reasonable agreement between the sc and mc solvers , but discrepancies with the fld approximation . for brevity we will focus on a single scalar quantity , @xmath234 , since it characterizes the variation of angular distribution of the radiation field across methods .",
    "figure [ f : fldmc ] shows a comparison of @xmath234 among the various methods for a representative two - dimensional slice near the top boundary of the simulation domain . in the top row ,",
    "the left and middle panels show results from the sc solver , using 24 and 168 angles , respectively .",
    "the top right panel shows the mc results and the bottom left panel shows the eddington values computed with the fld approximation .",
    "the bottom right panel shows @xmath4 for the same two - dimensional slice .",
    "we first compare the sc and mc calculations which provide similar results .",
    "the consistency of the solution computed by these two very different numerical methods strongly suggests that they are providing accurate results .",
    "as can be seen for @xmath234 in figure [ f : fldmc ] the agreement between the radiation moments improves as the angular resolution in the sc solver is increased ( i.e. between the top left and top right panels ) . however , even with higher angular resolution there are some modest discrepancies in the @xmath234 near the surface . this in part due to the statistical noise in the mc calculation , for which s / n generally decreases as @xmath219 increases .",
    "this mc calculation was run with @xmath235 billion photon packets with a total computation time that exceeded the sc solver by a factor of @xmath236 .    since the improvement in s / n only increases as roughly @xmath237 , where @xmath62 is the number of photon packets , further improving s / n involves a substantial increase in the computational time . even for this rather large number of photon packets ,",
    "substantial noise remains in the radiation field .",
    "such a high level of statistical noise could lead to numerous problems when coupled to the mhd integrator .",
    "hence , schemes which use mc methods to solve rt will generally require a large number of packets .",
    "our results suggest that standard mc methods need to be much more efficient or parallelized with effective load balancing between the mhd integrator and the mc rt solver to be competitive with sc methods when the simulation domain is far from lte .",
    "alternatively , it may be possible to significantly improve on this performance by implementing some sort of hybrid mc scheme to handle optically thick regions more efficiently ( e.g. * ? ? ?",
    "* ) since a significant fraction of the time in our mc computation is spent solving rt in regions that are very optically thick to scattering ( so @xmath238 ) but still optically thin to absorption .",
    "there are several discrepancies between the sc / mc and fld calculations .",
    "the most obvious is that with fld , @xmath234 approaches unity by construction in the optically thin limit .",
    "obtaining @xmath239 , requires the radiation field to be concentrated in a pencil beam of negligible solid angle around the @xmath219 axis , and is only achieved on the @xmath219 axis at very large distances from a finite source .",
    "therefore , it is not appropriate for the upper boundary of a patch of an accretion disk where the radiation field is still rather broadly distributed over solid angle .",
    "indeed , @xmath240 is consistent with estimates for a scattering dominated semi - infinite atmosphere @xcite . in principle",
    ", one could tailor the flux - limiter to approach an alternative , problem dependent value , although one can imagine applications where the appropriate limit will be difficult to estimate a priori .",
    "furthermore , the fld results yield @xmath241 everywhere , but in both the mc and sc calculations @xmath242 is frequently obtained in localized regions , consistent with a more horizontally directed radiation field .",
    "it is also clear that the fld eddington factors correlate with @xmath4 to a much higher degree that in the sc or mc calculations .",
    "although some correlation is present in the mc and sc calculations as well , it is more prevalent in the optically thick regions and becomes much weaker in the optically thin regions where the radiation field should be more diffuse and more sensitive non - local variations in @xmath51 and @xmath4 .",
    "further discrepancies between the vet and fld approaches are discussed in jsd12 .",
    "the level at which these differences affect the overall dynamics and thermodynamics remains unclear and ultimately requires comparison with full numerical simulations using the sc / vet methods .",
    "we note that the horizontally averaged flux in the sc and fld methods differs by @xmath243 at the top of the domain .",
    "hence the global thermodynamic properties of the simulations may not be greatly modified even though local properties of the radiation field differ . since simulations of accretion disk dynamics in the shearing box approximation",
    "is one of our primary applications , we expect to be able to make direct comparison with fld - based results ( e.g. * ? ? ?",
    "* ) in the near future .    .",
    "we plot three sets of curves and symbols corresponding to different boltzmann numbers bo = 0.01 ( black ) , 1 ( red ) , 10 , and 100 ( blue ) .",
    "the curves correspond to radiation modified acoustic modes ( solid ) and a non - equilibrium radiation diffusion mode ( dashed ) .",
    "we normalize @xmath244 and @xmath245 by the product of the wave number @xmath246 and the adiabatic sound speed @xmath204 .",
    "the real part of @xmath247 is zero for the radiative diffusion mode .",
    "[ f : disp_ana],scaledwidth=47.0% ]      we now turn to tests of the rt solver when coupled to the mhd integrator .",
    "we first compute the radiative damping rate of linear ( acoustic ) waves @xcite .",
    "the closely related problem of the spatial damping of driven harmonic disturbances is covered in @xcite .",
    "we briefly review the derivation of the dispersion relation for such wave and refer the reader to these references for further discussion .",
    "we consider an ideal gas with a static , uniform background state in lte , with a grey absorption opacity @xmath18 and frequency integrated thermal source function @xmath248 .",
    "adopting the notation of @xcite , we define background and perturbed quantities with subscripts `` 0 '' and `` 1 '' respectively .",
    "the background states has @xmath249 with @xmath250 and @xmath251 constant everywhere .    with these assumptions and some algebra the linearly perturbed versions of equations ( [ eq : mass])-([eq : energy ] )",
    "reduce to @xmath252 and @xmath253 where we @xmath254 is the isothermal sound speed .",
    "similarly , equation ( [ eq : radtrans ] ) becomes @xmath255    .",
    "the curves are analytic solutions to eq .",
    "( [ eq : disp ] ) and the symbols are estimates derived from simulations .",
    "we plot four sets of curves and symbols corresponding to different boltzmann numbers bo = 0.1 ( dot - dashed , squares ) , 1 ( dashed , triangles ) , 10 ( dotted , crosses ) , and 100 ( solid , diamonds ) .",
    "we normalize @xmath244 by the product of the wave number @xmath246 and the adiabatic sound speed @xmath204 .",
    "[ f : disp],scaledwidth=47.0% ]    to linear order we can assume @xmath256 and solve equation ( [ eq : linrt ] ) directly to evaluate @xmath257 in equation ( [ eq : t1 ] ) .",
    "we have @xmath258 where is @xmath259 is a displacement parallel to @xmath260 .",
    "we consider plane wave solutions of the form @xmath261 .",
    "defining @xmath262 and integrating over solid angle , we obtain @xcite @xmath263 the integral evaluates to @xmath264    we can now solve for the dispersion relation using equations ( [ eq : t1 ] ) , ( [ eq : rho1 ] ) , and ( [ eq : j1 ] ) @xmath265 in agreement with equation ( 16 ) of @xcite .",
    "we have defined @xmath266 and @xmath267 and the `` 0 '' subscript denotes that quantities are evaluated using the background values . to order unity",
    "@xmath268 is the reciprocal of the radiative relaxation time in the background flow .",
    "( crosses ) ; bo=100 , @xmath269 ( squares ) ; and bo=0.1 , @xmath270 ( diamonds ) .",
    "the bottom panels shows the error norm for waves in the isothermal regime corresponding to bo=0.01 , @xmath271 ( crosses ) and bo=1 , @xmath272 ( diamonds ) .",
    "the dashed curves show the expected trends for first - order ( @xmath273 ) and second order ( @xmath274 ) convergence . [",
    "f : conv_1d],scaledwidth=47.0% ]    figure [ f : disp_ana ] shows the solutions to equation ( [ eq : disp ] ) for various @xmath275 ( approximately the optical depth per wavelength ) and boltzmann number @xmath276 here @xmath277 is the specific heat at constant pressure , so bo is the ratio of the enthalpy flux ( evaluated for @xmath278 ) to radiative flux .",
    "there are two types of modes : radiatively damped acoustic waves ( solid and dashed curves ) with phase velocity @xmath279 varying between @xmath280 and @xmath281 and a purely damped ( @xmath282 ) non - equilibrium radiation diffusion mode ( dotted curve ) .",
    "the dimensionless ratio @xmath283 determines the importance of radiation .",
    "when this ratio is small equation ( [ eq : disp ] ) reduces to the standard adiabatic dispersion relation with sound speed @xmath204 and the damping rate is approximately @xmath284 . for @xmath285",
    "the phase speed @xmath286 decreases , approaching the @xmath287 when @xmath288 and @xmath289 , and the damping rate is again small compared to @xmath290 .    for acoustic waves , the damping rate @xmath291 for all bo and @xmath292 . however , this is not true for radiation diffusion mode . for @xmath293 , @xmath294 and transitions to @xmath295 for @xmath296 or @xmath297 .",
    "near @xmath298 , @xmath299 , so the maximum decay rate has @xmath300 .",
    "if @xmath301 then spurious , small - amplitude oscillations may grow due to our failure to adequately resolve the radiative diffusion mode .    ) and the diamonds in the adiabatic regime ( bo=100 , @xmath271 ) . as in the one - dimensional case ,",
    "waves in the adiabatic regime converge at nearly second order , but the isothermal waves are nearly second order at low @xmath62 , then plateau , and finally transition to a regime of first - order convergence .",
    "the waves are computed on a @xmath302 domain , as described in the text .",
    "[ f : conv_3d],scaledwidth=47.0% ]    indeed , we find exactly this type of numerical instability for a range of @xmath292 if @xmath303 . the unstable range of @xmath292 corresponds to values for which @xmath304 for modes with wavelengths comparable to the minimum grid spacing ( @xmath305 ) . since we have an exact analytic solution for the radiation source term from equation ( [ eq : j1 ] ) , we can check this result by turning off the rt solver and updating the total energy using the exact expression for @xmath60 .",
    "even when the exact expression is used the code is numerically unstable , as expected from the argument above . limiting the time step to be less than or equal to @xmath306^{-1 }",
    "\\right),\\ ] ] stabilizes the solution when either the exact analytic expression or the full numerical rt solution is used to compute @xmath60 .    since @xmath307 this constraint is most stringent where @xmath308 in which case @xmath309 .",
    "assuming @xmath310 , this implies that @xmath311 hence , whenever the bo number in any gridzone of the domain is less than unity , the maximum allowed time step will be determined by the radiation constraint , unless some other physics ( e.g. microphysical dissipation or magnetic fields ) enforces a shorter time scale .",
    "we now use these solutions to evaluate the convergence properties of the mhd integrator when our rt solver is used .",
    "we simulate periodic domains with different combinations of @xmath292 and bo .",
    "we initialize the background with @xmath249 , @xmath312 and @xmath313 .",
    "the initial perturbation is an eigenfunction with dimensionless amplitude @xmath314 .",
    "we simulate for one adiabatic crossing time @xmath315 and fit for the decay rate and phase velocity .",
    "figure [ f : disp ] shows a comparison of the numerically derived dispersion relation with solutions of equation ( [ eq : disp ] ) .",
    "each symbol corresponds to fits to a simulation of a one - dimensional domain with @xmath316 .",
    "each curve corresponds to a different choice of bo .",
    "we find good agreement with theory for the phase velocities @xmath317 and properly capture the transition from adiabatic to isothermal and back to adiabatic as @xmath292 increases .",
    "the agreement for decay rates @xmath318 is also good except for very low or very high @xmath292 and high bo . in this case",
    ", the damping rate @xmath319 is very long compared to a wave period and higher resolution is required to reduce the damping from numerical diffusion .",
    "we now examine convergence properties in the characteristic regimes .",
    "figure [ f : conv_1d ] shows the convergence of the norm of the l1 error vector , defined as @xmath320 where @xmath321 is the eigenfunction used to initialize the domain at @xmath322 , but evaluated at @xmath323 .",
    "each curve in figure [ f : conv_1d ] corresponds to a set of simulations with different combination of bo and @xmath292 .",
    "the plotted simulations were run on one - dimensional domains with @xmath324 , but we obtain nearly identical results for grid aligned waves in two - dimensional ( @xmath325 ) and three dimensional ( @xmath326 domains",
    ".    comparison with figure [ f : disp ] shows that all of the simulations in the top panel are in the nearly adiabatic regime and those in the bottom panel are in the nearly isothermal regime .",
    "since radiation has only a small damping effect in the adiabatic regime , convergence is nearly second order , as when radiation is entirely absent . in the isothermal regime , convergence is closer to second order at lower resolution , but transitions to first order as resolution increases .",
    "since we use an operator split update of the energy equation , first order convergence is expected when rt has a significant effect on the thermodynamics . indeed ,",
    "convergence is consistent with first order when the time step is set solely by the cfl condition ( @xmath327 ) . for @xmath328 , @xmath329 and",
    "the radiation diffusion constraint sets the timestep . in this case @xmath330",
    "is only very weakly dependent on @xmath62 .",
    "we also considered the convergence of non - grid - aligned waves in two and three dimensions .",
    "the three - dimensional case is nearly identical to the test presented in @xcite .",
    "we use a @xmath302 periodic domain , initialized with with a one - dimensional wave that has been rotated with @xmath331 and @xmath332 ( see @xcite , for further details ) . as in the one - dimensional case ,",
    "the initial wave is an eigenmode with amplitude @xmath314 and we use @xmath333 .",
    "we again evolve the domain for one adiabatic sound crossing time and evaluate the l1-error norm via @xmath334    the convergence of the l1 error as a function of @xmath62 is shown for two waves in figure [ f : conv_3d ] .",
    "the solid and dotted curves show the convergence for waves in the isothermal ( bo=1 , @xmath272 ) and adiabatic regimes ( bo=100 , @xmath271 ) , respectively .",
    "comparison with figure [ f : conv_1d ] , shows that the convergence properties are consistent with the one - dimensional / grid - aligned calculations .",
    "further linear wave tests are presented in jsd12 , although these assume the eddington approximation and do not make use of the rt solver employed here . since they solve the mixed frame moment equations , the character of their numerically and analytically derived dispersion relations differs from those presented here , although they agree qualitatively in the appropriate limit .",
    "we now consider the ability of the rt solver to model shocks in the presence of radiation .",
    "the physics of radiative shocks has been explored by a number of authors ( see * ? ? ? * and references therein ) and is generally well understood . however , radiating shocks are sufficiently complicated that simple analytic solutions for radiative shocks are generally not available .",
    "fortunately , @xcite ( hereafter le08 ) have developed fairly simple , semi - analytic methods for constructing one dimensional planar solutions of radiating shocks , which are suitable for our purposes .",
    "le08 construct their solutions using a grey non - equilibrium diffusion model of radiation hydrodynamics .",
    "their treatment differs from ours in a few important ways . rather than solving the rt equation ( [ eq : radtrans ] ) directly ,",
    "they solve the radiation moment equations with eddington approximation and assuming a diffusion relation for the radiative flux .",
    "they retain a number of velocity dependent terms which are absent in our treatment and include the radiation source term in the material momentum equation ( our eq .",
    "[ eq : mom ] ) .",
    "this allows them to explore the radiation pressure dominated , which is not accessible with the methods discussed here ( see , however , jsd12 ) .",
    "hence , our comparisons will be restricted to shock solutions with a low ratio of radiation to gas pressure and modest mach numbers .",
    "le08 solve a non - dimensionalized systems of equations with solutions that can be uniquely specified in terms of @xmath55 , @xmath335 , @xmath336 , @xmath208 , and @xmath337 using their notation . here",
    "@xmath335 is the non - dimensional absorption cross section , @xmath338 is roughly the ratio of radiation to gas thermal energy in the upstream flow , @xmath208 is non - dimensional photon diffusivity , and @xmath339 is the upstream mach number .",
    "the subscript `` 0 '' refers to upstream values in their notation .",
    "following le08 , we examine solutions with @xmath313 , @xmath340 , @xmath341 , and @xmath342 . in our notation , these parameters correspond to @xmath343 , @xmath344 , and @xmath345 . here , @xmath47 is an arbitrary reference length scale and all variables are evaluated using their asymptotic upstream values .",
    "we construct one - dimensional planar shock solutions following the procedures outlined in le08 and use the resulting profiles of @xmath4 , @xmath346 , and @xmath347 to initialize our one - dimensional simulation domains .",
    "since @xmath348 , we only simulate the region within a few photon mean - free - paths ( @xmath349 ) of the shock front .",
    "since the semi - analytic solutions rely on the eddington approximation , we set @xmath72 ( i.e. two - stream approximation ) for consistency . the radiation field at the boundaries is fixed and assumes that the incoming radiation is in thermodynamic equilibrium with appropriate upstream and downstream asymptotic temperature .",
    "we evolve the simulations for a time @xmath350 , which is typically a factor of hundred ( @xmath351 ) larger than the sound crossing time of the simulation domain .",
    "figures [ f : m1.2 ] and [ f : m5 ] show characteristic results for @xmath352 and 5 , respectively .",
    "we use 128 and 1024 gridzones for the simulation with @xmath352 and 5 , respectively .",
    "we use a larger number for the @xmath353 simulation to resolve the narrow zeldovich spike @xcite .",
    "we plot the gas temperature @xmath354 , radiation temperature @xmath355 , and @xmath4 using the non - dimensional units of le08 . here ,",
    "@xmath356 is the standard radiation constant and @xmath40 is computed using the rt solver .",
    "the fact that @xmath357 computed using the rt solver in the initial shock profile agrees well with the semi - analytic solutions is already an important test of our method .",
    "sufficiently far upstream or downstream of the shock , the gas and radiation are in thermodynamic equilibrium with @xmath358 . near the shock front ,",
    "the temperatures deviate , with a radiation precursor upstream of the shock and zeldovich spikes appearing downstream of the shock for the higher mach number solutions .    for each plot , we show two sets of curves corresponding to the initial and final profiles .",
    "since we have initialized the simulation with stationary solutions computed in the shock rest frame , the material properties should not evolve with time .",
    "however , since our system of equations differ from those used by le08 to derive their solutions ( in particular , we ignore the radiation pressure ) , our numerical solutions are only approximately stationary .",
    "the effects of the terms we have neglected are small for the chosen parameters .",
    "nevertheless , there is a slow but steady drift of the shock location in the downstream direction due to the neglect of the radiation force in the upstream direction . as the mach number of the flow increases , the radiation force becomes increasingly important and the shock front moves more rapidly in this frame . even though the position of the shock drifts , the profile changes very little as the radiation source term in the energy equation is still well approximated .",
    "further tests of radiative shocks are presented in sections 5.2 and 5.3 of jsd12 , including calculations that use the rt solver to compute the vet .",
    "the added computational cost of using the rt solver is determined by a number of factors and will generally be problem dependent .",
    "a useful starting point is a comparison of the computational cost to integrate the mhd equations for one timestep with the cost to perform a single iteration of the rt solver for a single frequency when run on a single processor . for a three dimensional domain with @xmath359 ( i.e. 24 total rays ) the rt solver requires @xmath360% as many operations as the ctu integrator",
    "this is essentially the simplest type of problem that is of practical importance : an lte grey problem with fixed intensity on the boundaries and an angular discretization that can yield a result beyond the eddington approximation .",
    "many problems of interest will be more costly than this because we will need multiple iterations , multiple frequency bins , or higher angular resolution .",
    "the total cost of the rt solution scales approximately linearly with the number of frequency groups , total number of angles , or number of iterations , all of which are problem dependent . even for",
    "lte problems , periodic boundaries or domain decomposition may require multiple iterations .",
    "for most problems iteration will continue until the relative change in @xmath84 ( or @xmath96 ) is below some prescribed threshold @xmath170 and the total number of iterations may fluctuate from one timestep to the next , depending on conditions .    for the code tests considered here , which used @xmath361 , the number of iterations per timestep was @xmath362 , depending on the problem , with 1 - 3 iterations being typical .",
    "most of the tests were lte and iteration was only used to handle boundary conditions .",
    "an exception is the uniform non - lte atmosphere tests that were run with @xmath363 iterations in order to obtain convergence of the absolute error .",
    "we emphasize that figure [ f : conv_comp ] is not indicative of the typical number of iterations that need to be performed per timestep , even in highly non - lte domains .",
    "the key point is that this calculation starts from an initial condition that assumes an lte radiation field everywhere , even though the solution at the surface is far from lte . as discussed in tf95 ,",
    "the main problem with the ali methods used here is that they have a rather small spectral radius .",
    "effectively , this means that it takes a rather large number of iterations for errors in the initial condition that span many gridzones to diminish .",
    "since we are computing rt on each timestep , we already have an initial guess that is a reasonable approximation to the correct non - lte solution .",
    "in particular , large ( i.e. domain scale ) variations in the radiation field are usually already well accounted for by the solution from the previous timestep .    we anticipate that our initial solution of the radiation field before the first timestep may require hundreds to thousands of iterations for highly non - lte problems ( i.e. those with a significant fraction of zones having @xmath364 ) , but that subsequent timesteps will only require a modest number ( @xmath365 ) of iterations to obtain relative convergence @xmath366 .",
    "our initial work on shearing box simulations ( not reported here ) supports this expectation , although the number of iterations depends somewhat on just how non - lte the radiation field becomes .",
    "@xcite report similar numbers of iterations ( see their figure 2 ) as being typical of their scattering dominated calculations .    a second consideration affecting performance is the maximum timestep that can be used with the operator split update of the total energy described in section [ interface ] . the generalized cfl conditions derived in section [ linwave ] may reduce the timestep when @xmath367 is a significant fraction of @xmath347 or @xmath368 . for such problems",
    "it will be more efficient to use the vet method of jsd12 when feasible .",
    "a third consideration is scalability . since scaling efficiency",
    "will be somewhat machine dependent , we are primarily concerned with assessing how the code performs with rt relative to the ( m)hd configuration with no solution of rt . to make the comparison concrete",
    ", we study the weak scaling for @xmath369 gridzones per core on the scinet general purpose cluster , which consists of eight core nodes made from two 2.53 ghz quad - core intel xeon 5500 nehalem processors .",
    "tests were performed using the infiniband interconnect .",
    "we use a grid aligned radiating linear wave on a three - dimensional domain with @xmath324 , @xmath272 , and bo=1 in the radiating case and a slow magnetosonic wave for mhd only calculation .",
    "both tests were performed using the full mhd ctu integrator . we initialize the radiating wave as described in section [ linwave ] , but we only allow a single iteration of the rt solver per timestep .",
    "we compute the efficiency by dividing the number of zone cycles / second obtained for a problem run with multiple cores by the number of zone cycles / second for a single core .",
    "the resulting scaling with number of cores is nearly identical in the radiating and non - radiating cases , falling to about 75% at 512 cores ( 64 nodes ) .",
    "we also find the same scaling efficiency for @xmath370 , which is notable because this correspond to a factor of seven increase in the number of specific intensity bins that need to be passed on each iteration . in this case",
    ", the increase in communication demands is balanced by the roughly factor of seven increase in the cost of computing the rt solution with more angle bins .",
    "these results suggest that the scaling efficiency with the rt solver will tend to follow the non - radiative scaling when they are run on the same platform , as long as the number of iterations remains constant .",
    "the assumption that number of iterations stays fixed is an important caveat .",
    "in fact , this assumption will not generally hold since we use iteration to handle subdomain boundaries . to understand this , it is useful to consider two lte problems : one in which the optical depth across each subdomain is very large and one for which the whole domain is optically thin . in first problem , the radiation field is determined entirely locally and propagation of changes in the radiation field from neighboring subdomains will require only a single iteration . in the second problem , variations in the emissivity on one side of the domain can modify the radiation field on the other . for a cubic array of @xmath62 subdomains",
    ", it could take @xmath61 iterations to propagate the radiation across the entire domain .",
    "this means that scaling efficiency can , in principle , be very problem dependent . for most of the applications of primary interest",
    ", the majority of subdomains will be optically thick so increasing the number of subdomains should not significantly increase the number of iterations required .",
    "therefore , scaling efficiency should reasonably consistent with the non - radiating case .",
    "performance and scaling of the overall vet scheme is discussed in section 7.2 of jsd12 .",
    "we have described our implementation of an rt solver in the athena mhd code .",
    "our module implements a short characteristic method for computing rt on cartesian , multidimensional simulation domains .",
    "the rt equation is solved once each simulation timestep for a computational cost comparable to or less than a single timestep of the mhd integrator for simple ( e.g. lte grey ) problems .",
    "since we are focused on astrophysical problems where velocities are slow compared with the speed of light , we drop the time derivative of intensity and the system becomes an integrodifferential equation with no explicit time dependence for the radiation field .",
    "the material properties of the flow are evolved using the standard athena mhd integrators , but with radiative heating and cooling source terms computed from the rt solver .",
    "the code solves the rt equation for frequency dependent , absorption and scattering opacities .",
    "non - lte effects arising from scattering processes are handled with ali methods .",
    "the resulting code is well - suited for non - relativistic astrophysical problems where diffuse emission , rather than bright point sources , constitutes the dominant source of radiation .",
    "we provide a detailed summary of the short characteristics and ali implementations .",
    "we also describe our implementation of an operator split update of the energy equation using a radiation source term computed directly by the rt solver .",
    "alternatively , the rt solver can be used to compute a vet , which can then be input into the integration of the coupled mhd and radiation moment equations .",
    "the use of the rt module for this purpose is discussed in a companion paper ( jsd12 ) .",
    "we also present results from several test problems , which roughly fall into two classes : tests of the rt solver on static simulation domains , and tests of the coupled rt solver and mhd integrator for time - dependent hydrodynamics simulations .",
    "these tests demonstrate the accuracy of the rt solver for multidimensional problems , assess its convergence properties for applications where scattering leads to significant deviations from lte .",
    "they indicate that substantial improvements in accuracy and efficiency may be obtained over alternative methods , such as flux - limited diffusion and monte carlo based rt solvers .",
    "the tests also evaluate the accuracy and stability of the mhd integrator when coupled to the rt solver via operator splitting .",
    "they verify that the code is generally only first - order accurate for problems where heating or cooling of the fluid by the radiation field is significant .",
    "they also illuminate important time step constraints and are useful for assessing the efficiency and accuracy of the code for solving various astrophysical problems .",
    "in particular , we derive a generalized cfl condition , predicated on the need to resolve the non - equilibrium radiation diffusion mode . the requirement to place some limits on timesteps due to rapid radiative relaxation ( see e.g. * ? ? ?",
    "* ) are generally acknowledged and implemented in previous work .",
    "however , we have not seen any explicit reference to resolving the damping rate of the radiation diffusion mode , which provides a a practical and precise guideline for ensuring numerical stability .",
    "the focus in this work has been on modeling the fluid dynamics and thermodynamics with a self - consistent computation of the radiation field .",
    "however , we expect that the ability of the rt solver to provide detailed outputs of the emergent radiation field , such as images , lightcurves , and spectra , may be equally important .",
    "indeed , for some applications the production of such outputs may be the primary motivation for including radiation in the simulation . in principle",
    ", the rt solver can be used _",
    "solely _ to generate diagnostic outputs , even in simulations without self - consistent feedback of radiation on the material flow , either in real time or via post - processing .",
    "in addition to the simple test problems described here , we are beginning a research program to simulate the local structure of accretion flows ( i.e. stratified shearing boxes ) with radiative heating and cooling .",
    "applications to radiation dominated environments using the vet method ( jsd12 ) are also underway , and include studies of radiation dominated accretion disks , radiative rayleigh - taylor instability , and the radiative driving of cold gas .",
    "applications to extrasolar planets , star forming environments , boundary layers , galactic and accretion disk outflow are also under consideration for future work .",
    "a significant limitation of the rt solver described here is the short - characteristics method s inability to accurately handle bright points sources .",
    "we plan to address this in future work using a hybrid scheme that computes the direct radiation from point sources using the algorithms described in @xcite and models the diffuse emission with rt solver described here .",
    "the source code for our rt solver , test problems and associated documentation will be included in the publicly available version of athena in the near future .",
    "we have endeavored to make the code as user friendly as possible and strongly encourage interested parties to use the code in their own research ."
  ],
  "abstract_text": [
    "<S> we describe the implementation of a module for the athena magnetohydrodynamics ( mhd ) code which solves the time - independent , multi - frequency radiative transfer ( rt ) equation on multidimensional cartesian simulation domains , including scattering and non - lte effects . </S>",
    "<S> the module is based on well - known and well - tested algorithms developed for modeling stellar atmospheres , including the method of short characteristics to solve the rt equation , accelerated lambda iteration to handle scattering and non - lte effects , and parallelization via domain decomposition . </S>",
    "<S> the module serves several purposes : it can be used to generate spectra and images , to compute a variable eddington tensor ( vet ) for full radiation mhd simulations , and to calculate the heating and cooling source terms in the mhd equations in flows where radiation pressure is small compared with gas pressure . for the latter case , </S>",
    "<S> the module is combined with the standard mhd integrators using operator - splitting : we describe this approach in detail , including a new constraint on the time step for stability due to radiation diffusion modes . </S>",
    "<S> implementation of the vet method for radiation pressure dominated flows is described in a companion paper . </S>",
    "<S> we present results from a suite of test problems for both the rt solver itself , and for dynamical problems that include radiative heating and cooling . </S>",
    "<S> these tests demonstrate that the radiative transfer solution is accurate , and confirm that the operator split method is stable , convergent , and efficient for problems of interest . </S>",
    "<S> we demonstrate there is no need to adopt ad - hoc assumptions of questionable accuracy to solve rt problems in concert with mhd : the computational cost for our general - purpose module for simple ( e.g. lte grey ) problems can be comparable to or less than a single timestep of athena s mhd integrators , and only few times more expensive than that for more general ( non - lte ) problems . </S>"
  ]
}