{
  "article_text": [
    "a phylogeny ( or evolutionary tree ) can explain the ancestral relationships among species based on similarities in their genetic sequences ( e.g. , dna ) .",
    "a phylogenetic model will typically be parametrized by rates which can correspond to genetic mutations that occur within populations as they evolve over time . in many applications ,",
    "it is reasonable to assume that genetic sequences share a common phylogenetic structure across all of their sites .",
    "however , to allow for greater modelling flexibility , it is often times desirable to allow for the evolutionary rate parameters to change across the length of the sequences .",
    "the main focus of this paper is estimating that rate variation across the sites .",
    "we consider a model that allows for neighbouring blocks of sites to be parametrized by different evolutionary rates ( i.e. , a change - point model ) , and we propose a novel computational scheme that enables a practitioner to fit this model to genetic sequences when the true number of change - points is unknown .",
    "thus , our contribution is a methodology that infers both the number of distinct blocks along the length of the sequence and the values of the rates themselves .",
    "we empirically demonstrate the potential of our algorithm to outperform competing computational methods .",
    "a phylogeny ( or evolutionary tree ) is the most common structure employed to explain the evolutionary relationships among species ( ` taxa ' ) based on similarities in their physical or ( more usually ) genetic characteristics . the branching pattern of the tree is usually referred to as its topology , and describes shared and independent periods of evolution of different taxa .",
    "the leaves of the tree correspond to observations on the taxa . in a rooted phylogenetic tree ( figure [ fig : appliedinputtree ] of appendix [ sec : figures ] ) , each internal node corresponds to a speciation event and represents the most recent common ancestor of all the taxa descended from that node .",
    "the length of the edges connecting the nodes ( ` branches ' ) can be interpreted as the time between speciation events .",
    "the evolutionary analysis of molecular sequence variation is statistically challenging .",
    "parsimony methods were among the first approaches for inferring phylogenies , but in recent years , great research effort has been devoted to likelihood - based methods , both in the frequentist @xcite and bayesian framework .",
    "dna sequences occupy one of four states ( a , c , g , t ) at each site , and so specifying the likelihood function requires a model for how these change over time at each site .",
    "the simplest such model is the jukes - cantor , in which each state is substituted by any other state at the points of a homogeneous poisson process .",
    "the kimura model has a rate for transitions ( a @xmath5 g or c @xmath5 t ) that can differ from the rate for transversions ( all other substitutions ) , see ( * ? ? ?",
    "* chapter 13 ) .",
    "objects of inference can include the topology of the phylogenetic tree ( here regarded as known ) , the relative branch lengths on the tree , and the substitution rates .",
    "likelihood - based approaches usually assume that substitution rates are the same at all sites , so that the likelihood is obtained as a product across sites .",
    "however , variation in substitution rates along dna sequences is well established @xcite .",
    "this variation can be explained by variation in functional constraint across the genes encoded in the sequences .",
    "if the dna sequence is from a coding region , natural selection may constrain variability at some sites more than others and therefore sites might exhibit different rates of evolution . therefore , it is important to accommodate rate variation across sites in phylogenetic inference @xcite .",
    "one possibility is to estimate a different rate for each site @xcite but this is computationally demanding because of the large number of parameters , and the limited information per parameter leads to poor inferences .",
    "a better alternative is to assume that the rates at different sites are independent draws from a distribution , typically either a gamma @xcite or a log - normal distribution @xcite .",
    "a more realistic model would assume that the rates are auto - correlated along the sequence .",
    "one possible solution is offered by phylogenetic hidden markov ( phylo - hmm ) models , which allow for correlated rates between nearby sites @xcite : the rate of evolution is modelled as a markov process operating along the sequence and site specific rates are drawn from a finite set of values .",
    "the discrete number of rate categories represents one limitation of the phylo - hmm approach @xcite , while another is the small number of taxa that can be accommodated with reasonable computational resources @xcite .",
    "alternatively , @xcite have developed a bayesian multiple change - point model of rate variation along the dna sequence , which assumes that sites are grouped into an unknown number of contiguous segments , each with possibly a different tree topology , as well different substitution rates and branch lengths .",
    "several recent proposals involve finite mixtures of distributions to model heterogeneity across sites . in this case , the distribution of each site on the sequence is a mixture of multiple processes , each of which may have its own tree topology , branch lengths and substitution rates ( e.g.  @xcite ) .",
    "@xcite extend these ideas to infinite mixtures assuming a dirichlet process prior .",
    "the main focus of this paper is estimating evolutionary rate variation across sites assuming that the tree topology and branch lengths are known and the same at every site under analysis .",
    "the latter assumption is not very restrictive in most applications , which involve taxa that are separated by enough time that within - taxon coalescent variation is unimportant .",
    "although substitution rates can vary along the sequence , they are assumed to be the same across all taxa at each site .",
    "our proposed time - machine pmmh model is able to account for quantitative differences in rates of substitutions ( e.g. sites with high rates versus sites with low rates ) , and can also allow different rates for different types of substitution ( such as transitions and transversions ) .",
    "recently there has been a revival of interest in models which allow for variation in evolutionary rates due to an explosion in the availability of comparative sequence data , and consequent interest in comparative methods for the detection of functional elements ( e.g. , @xcite ) .",
    "the model proposed in this paper is similar in spirit to early work on spatial variation of evolutionary rates ( e.g. @xcite ) , which maintains a single consistent topology along the sequence but allows changes in evolutionary rates . in this framework ,",
    "given the rate at each site , each site is then assumed to evolve independently along the true phylogeny with that rate and the correlation between sites arises from the clustering of high and low rates at adjacent sites .",
    "however , most of these models allow for a small discrete number of rate categories into which sections of the sequences are sorted ( @xcite ) and many methods are limited to two - species comparisons as they become increasingly computationally expensive when more species are included .",
    "our proposed model overcomes both these difficulties , as the model for evolutionary rates , based on a multiple change point model , is structurally simple and flexible so that the rates are not restricted to a finite set but estimated on - line .",
    "moreover , the use of the `` time machine '' significantly speeds up computations .",
    "several negative mathematical results exist in the literature ( e.g.  @xcite ) for markov chain monte carlo ( mcmc ) inference when the tree topology ( and branch lengths ) is unknown , and these have spurred the development of highly sophisticated monte carlo - based algorithms @xcite . here , the tree topology and branch lengths are assumed to be known , but the position and number of change - points for the rates are unknown . in addition , as we will explain later , the cost of evaluating the likelihood will be an @xmath6 operation ( @xmath7 is the number of states at each site , @xmath1 the number of sites and @xmath0 the number of sequences ) .",
    "it follows that parameter inference requires expectations w.r.t .  a probability on a trans - dimensional state - space .",
    "contructing efficient mcmc algorithms on trans - dimensional spaces is a notoriously challenging problem and the standard approach is to use reversible jump mcmc ( rjmcmc ) @xcite . typically , and especially for our model , it is difficult to develop moves on the trans - dimensional state - space that are likely to be accepted , which is important here because likelihood computations are expensive .    to deal with some of these inferential and computational issues ,",
    "we propose :    * to reduce the cost of computing the likelihood and assist the mixing of mcmc , through a likelihood approximation based on the time - machine principle @xcite . * to improve mixing compared to standard rjmcmc , by adapting an idea in @xcite , developing a particle marginal metropolis - hastings ( pmmh ) algorithm @xcite , based on the sequential monte carlo ( smc ) samplers method in @xcite .",
    "this approach can benefit from the time - machine approach .    in the time - machine approach , the unobserved sequence at the root , and possibly also other top - most nodes of the tree ,",
    "are replaced with the stationary distribution of the substitution process .",
    "this can reduce the cost of computing the likelihood by a linear factor in @xmath0 ; this can allow larger datasets than would otherwise be manageable .",
    "the resulting estimates are biased , but in the examples below we find the bias to be smaller than for competitive methods .",
    "indeed , we conjecture ( and this is supported by empirical results ) that our approach is competitive with other approximate methods , in particular approximate bayesian computation ( abc ) ; this latter method is often not appropriate for model selection problems as we describe in section [ sec : abc ] .",
    "an important point here is that the time - machine performs a ` principled ' approximation of the mathematical model .",
    "this is based on the general understanding that most of the information in the data is at the lower part of the tree , thus contrasting with an often ad - hoc selection of summary statistics in abc approaches .",
    "our pmmh algorithm extends the idea in @xcite , both with regard to the methodology and the context of phylogenetic trees with change - points",
    ". the mcmc method will often generate ( as we will explain in section [ sec : computationalmethods ] ) trans - dimensional proposals which are more likely to be accepted than standard rjmcmc algorithms .",
    "this is further aided by using the time - machine , which results in a less complex posterior with a faster likelihood evaluations .",
    "the combination of the above factors can lead to reliable , but biased , inference from moderate sized data - sets . as mentioned above",
    ", we expect the bias to be minimal relative to abc methods .",
    "this article is structured as follows . in section [",
    "sec : modelsandmethods ] the model and methods are described ; this includes our mathematical result on the bias . in section [ sec : results ] our empirical results are given . in section [ sec : disc ]",
    "we conclude the article with a discussion .",
    "the appendix provides further details of the methods .",
    "we first describe our change - point model and the associated bayesian inference problem , then the time machine approximation , and the pmmh algorithm .",
    "the end of this section then briefly discusses some competing abc methods that can also be used to perform bayesian inference , but we make a case against using such algorithms in this context . throughout the article , given a vector @xmath8 we define @xmath9 , @xmath10",
    "; also , we use the notation @xmath11=\\{1,2,\\ldots , k\\}$ ] .",
    "we observe @xmath0 sequences of length @xmath1 , such that each observation is @xmath12 with @xmath13 , @xmath14 .",
    "similar to as in @xcite , it is assumed that the data originate from a rooted binary tree ( * ? ? ?",
    "* chapter 1 ) of known topology and branch lengths with the @xmath0 leaves being the observed sequences .",
    "the sequences at the other @xmath15 nodes are unobserved .",
    "nodes are numbered backwards in time , starting from the observed leaves ( numbered 1 to @xmath0 ) to the root @xmath16 .",
    "let @xmath17\\rightarrow\\{n{+}1,\\ldots,2n-1\\}$ ] map nodes other than the root onto their parent node .",
    "it is assumed that we are given a markov model on the tree describing the evolution of states over time on each branch of the tree and at each site ; each site evolves independently given the branch lengths . treating the sequence states at internal nodes as missing data we can write the full - data likelihood as : @xmath18 where @xmath19 is an unknown parameter , @xmath20 a markov transition probability , and @xmath21 a probability distribution on the state space at a site .",
    "note that @xmath22 are unobserved , whereas @xmath23 are observed .",
    "note also that @xmath24 can depend on the ( known ) length of the branch connecting the node @xmath25 with node @xmath26 . for convenience in subsequent formulas we will write @xmath27 in place of @xmath28 , even though @xmath29 is undefined .",
    "the observed - data likelihood can be written as a sum over the missing data : @xmath30^{n-1 } } \\prod_{i=1}^{2n-1 } f_\\theta(x_{ij}|x_{\\nu(i)j})\\right].\\ ] ] using belief propagation @xcite ( also called the sum and products algorithm ) , the cost of computing is @xmath6 .",
    "our model generalises ( [ eq : fullik ] ) to allow @xmath31 to vary along the sequence at a set of change - points @xmath32 .",
    "then the full - data likelihood for the change - point model is : @xmath33 and , as in ( [ eq : obslik ] ) , one can sum over @xmath22 to obtain an observed - data likelihood : @xmath34 where @xmath35^{n-1 } } \\bigg\\{\\prod_{i=1}^{2n-1 } f_{\\theta_j}(x_{il}|x_{\\nu(i)l})\\bigg\\}.\\ ] ]      for @xmath36 , let @xmath37 : 1 < s_1<\\cdots < s_k \\leq m\\}.\\ ] ] then we will define a posterior probability on the space @xmath38 let @xmath39 be any proper prior probability on @xmath40 .",
    "our objective is then to consider the posterior @xmath41 which can be computed pointwise up to a normalizing constant in @xmath6 steps .",
    "we assume that we know how to calculate the priors @xmath42 and @xmath43 .",
    "one way to cut the cost of the @xmath6 calculation of the likelihood , is to remove the top of the tree ( a related idea is used in @xcite for the standard coalescent ) .",
    "suppose we only consider the tree backward in time until the parent of node @xmath44 , @xmath45 .",
    "we propose the model : @xmath46 where @xmath47 denotes the nodes in the cut - off part of the tree @xmath48 that are parents to at least one of the nodes in @xmath49 , and @xmath50 is a joint probability distribution over sequences on these ` boundary ' nodes .",
    "thus , the joint distribution of a number of the upper - most @xmath51 nodes , for the @xmath52 site , is replaced by the approximation @xmath53",
    ". then one can perform inference from the relevant posterior @xmath54 using the pmmh method described below .",
    "the cost of computing the new likelihood is now @xmath55 .      in order to sample from the trans - dimensional state - space of we",
    "first consider an smc sampler which only samples on @xmath56 , for @xmath57 fixed .",
    "we then show how the smc sampler can be embedded within a pmmh algorithm to target .",
    "the smc sampler will be necessary to ensure a good acceptance probability for trans - dimensional moves .",
    "our approach has the advantage over alternative simulation techniques for model selection ( see @xcite ) that the model selection and parameter estimates are simultaneous , which helps to focus computational resources on the important model(s ) .    for @xmath58 , and a user - specified @xmath59 ,",
    "let @xmath60 be a sequence of probabilities on @xmath56 , such that @xmath61 and @xmath62 the remaining sequence of targets @xmath63 interpolate between the ( conditional ) posterior and the prior , e.g. via the tempering procedure : @xmath64 with @xmath65 .",
    "the smc sampler will propagate a collection of @xmath66 particles from the prior @xmath67 all the way to the posterior @xmath68 via the bridging densities @xmath69 by means of importance sampling , resampling and mcmc move steps .",
    "the tempering procedure aims at controlling the variability of the incremental importance weights , for instance providing robust estimates of the normalising constants @xmath70 which is an important attribute for the overall algorithm .",
    "the sampler propagates the particles by using a sequence of mcmc kernels of invariant densities @xmath69 ( which operate on a fixed dimensional space ) .",
    "all the details of the specific steps of the smc sampler are given in the supporting information document .",
    "we write the probability of all the variables associated to the smc sampler ( which resamples @xmath71 ` particles ' at every time except at time @xmath72 ) as @xmath73 where @xmath74 are the resampled indices and @xmath75 with @xmath76 , @xmath77,t\\in\\{0\\}\\cup[t]$ ] , is the collections of the @xmath66 particles as propagated through the sequence @xmath69 .    one can use this smc sampler within a broader pmmh algorithm to sample from the true target of interest .",
    "the specific steps of pmmh are given in the supporting information document , but briefly , a single iteration of the algorithm is as follows .",
    "given the current state of the markov chain , one proposes to change @xmath57 with some proposal kernel @xmath78 .",
    "conditional on this @xmath79 , we run an smc sampler @xmath80 and choose a particle @xmath81 , for some @xmath82 , with probability proportional to a weight .",
    "acceptance of both the model index @xmath79 and of the proposed change - point times and rates @xmath81 happens with probability @xmath83 where @xmath84 is the smc ( unbiased ) estimate of @xmath70 , the normalizing constant of @xmath68 .",
    "the supporting information document presents the formula used to calculate @xmath84 .",
    "note that whilst there are a lot of user set parameters ( namely , the temperatures and tuning parameters for the mcmc kernels ) , their choice can be done adaptively to reduce user involvement ( see @xcite ) . in this article we tune the parameters by trial and error .",
    "the advantages of our procedure is that it mitigates having to construct trans - dimensional proposals which need to mix well ( see @xcite for another recent work that attempts to deal with this issue ) .",
    "we note , however , that the cost of each proposal will be @xmath85 , as @xmath69 must be obtained at each time step of the smc sampler ( see supporting information ) .",
    "in addition , note that tailored methods for change - point models ( e.g.  @xcite ) do not apply here as one does not have a convenient way to integrate the likelihood .",
    "abc is another methodology that avoids exact computation of the likelihood , at the cost of a biased approximation of the posterior ; see for instance @xcite for a review .",
    "the method is based on accepting simulated data sets that are similar to the observed dataset , where ` similar ' is usually assessed using summary statistics sensitive to the parameter(s ) of interest .",
    "abc can be unreliable as a tool for model selection . according to @xcite , the best summary statistics to be used in abc approximation to a bayes factor are ancillary statistics with different mean values under two competing models .",
    "otherwise , the summary statistic must have enough components to prohibit a parameter under a wrong model from generating summary statistics that are plausible under the true model .",
    "however , summary statistics satisfying the conditions of @xcite for model choice in abc is not easy ( or even possible ) to verify in our context .    in the numerical examples of section [",
    "sec : resultscomparison ] , we consider two abc algorithms which approximate the same abc posterior .",
    "the first algorithm is a pmmh that replaces the smc sampler of @xcite with the smc sampler of ( * ? ? ?",
    "* section 3.3 ) ; see supporting information for details .",
    "the second abc algorithm is the abc - smc algorithm for model selection appearing on @xcite .",
    "we compared three algorithms on their performance in bayesian model selection for four simulated dna datasets . within each dataset , the dna sequences shared a common ancestral binary tree with known topology , unknown sequence states at ancestral nodes , and unknown substitution rates and branch lengths .",
    "the first algorithm was our proposed pmmh algorithm outlined in section [ sec : computationalmethods ] , and we employed three versions of the time machine . using the notation of section  [ sec : timemachine ] , these used @xmath86 ( so in effect the time machine was not implemented at all ) , @xmath87 and @xmath88 .",
    "we also used two abc algorithms described in section [ sec : abc ] .",
    "the pmmh algorithms were not run until they converged fully , but were compared on the basis of results achieved after six hours of computation .",
    "other implementation details of the algorithms may be found in the supporting information document .",
    "the base dataset consists of @xmath89 simulated dna sequences ( @xmath90 types of nucleotide ) , each of @xmath91 sites .",
    "the sequences evolved according to a binary tree under a jukes - cantor model of dna evolution with one substitution rate up to site @xmath92 , and a second rate beyond this single change - point ( so @xmath93 , but for inference we assumed only @xmath94 ) . in the standard newick notation ,",
    "the structure of the tree was :    ` ( ( ( taxon0:1.0,taxon1:1.0):1.0,(taxon2:1.0,taxon3:1.0):1.0):1.0 , `    ` ( ( taxon4:1.0,taxon5:1.0):1.0,(taxon6:1.0,taxon7:1.0):1.0):1.0):1.0 `    we ran the three algorithms to infer @xmath57 , location of the change - point , @xmath95 given @xmath96 , and the substitution rate(s ) @xmath97 .",
    "the prior on @xmath57 was uniform on @xmath98 ; the prior on @xmath95 was @xmath99 ( change - points accur immediately before a site so can not occur at site 1 ; finally , all substitution rates had a gamma prior , with shape @xmath100 and scale @xmath101 , and so expected value of @xmath102 mutations per generation per site .    the results in the top quadrants of tables [ tab : modelchoiceex1 ] and [ tab : ciex1 ] in appendix [ sec : tables ] show that our time - machine pmmh algorithm with @xmath87 outperformed all other algorithms .",
    "it sampled from the true model ( i.e. , @xmath93 ) much more frequently than the incorrect @xmath103 model ( table [ tab : modelchoiceex1 ] ) . in comparison",
    "@xmath88 performed poorly , as expected since @xmath89 for this dataset so @xmath88 implies removing all internal nodes and assuming independent evolution of each sequence .",
    "the abc algorithms did not perform well . the pmmh - abc algorithm sampled from the two models almost evenly , while the abc - smc algorithm had a low effective sample sizes ( @xcite,@xcite ) and actually preferred the wrong model .    in table",
    "[ tab : ciex1 ] , we give @xmath104% confidence intervals of estimates of @xmath95 and of the rates given @xmath93 . the time - machine pmmh algorithms again provide the best inferences and were able to find the change - point .",
    "the pmmh - abc was more accurate for the substitution rates but less precise .",
    "the abc - smc algorithm gave unusable output .",
    "we do not present the output for the @xmath86 version of the time machine because it performed very poorly . without removing any nodes from the top of the tree ,",
    "the variability of @xmath105 in the acceptance probability of the pmmh was very high when @xmath106 ( figure [ fig : ml ] in section [ sec : figures ] ) .",
    "thus , the algorithm accepted jumps between models only rarely and the output was very `` sticky '' .",
    "this phenomenon illustrates that the time machine is a cost saving technique by two measures .",
    "first , it reduces the computational complexity of the algorithm .",
    "second , it aids in mixing and facilitates jumping between models .",
    "we repeated the above experiment for three more datasets that differed only slightly from the base dataset .",
    "we found the results to be similar across the datasets ( see tables [ tab : modelchoiceex1 ] and [ tab : ciex1 ] in section [ sec : tables ] ) .",
    "collectively , these results suggest that when doing bayesian model selection under these scenarios , abc approximations should be avoided and instead our pmmh method used instead , with the time machine but removing as few nodes as computational considerations permit .      using the publicly available database of @xcite",
    ", we assembled a dataset consisting of @xmath107 act1 gene dna sequences ( @xmath108 sites ) .",
    "we assumed the tree structure given in figure [ fig : appliedinputtree ] of section [ sec : figures ] , and a jukes - cantor model of dna evolution .",
    "we implemented our time - machine pmmh algorithm to infer @xmath57 , @xmath109 , and @xmath97 for cut - off parameter @xmath87 ( see supporting information for further details ) .",
    "the prior on @xmath57 was a discrete uniform distribution on @xmath110 , the prior on @xmath109 was uniform on @xmath57-subsets of @xmath111 $ ] , and each substitution rate had a gamma prior with shape @xmath112 , scale @xmath113 .",
    "we ran the algorithm for 10,589 iterations ( @xmath114 days ) on a linux workstation that used twelve intel xeon e5 - 1650 3.20 ghz cpus .",
    "we monitored convergence via autocorrelation and trace plots ( figure [ fig : kacftrace ] ) .",
    "we also monitored convergence of each model individually using the diagnostic in @xcite ; that is , we obtained a z - score for each model parameter per each value of @xmath57 to get a sense of the algorithm s ability to fully explore the state space of each model ( only some values are reported below ) .",
    "figure [ fig : kacftrace ] suggests good exploration of the state space of @xmath57 , resulting in an estimated distribution : @xmath115 ( @xmath103 ) , @xmath116 ( @xmath93 ) , and @xmath117 ( @xmath118 ) .    from the 4,946 samples with @xmath93",
    ", we estimated a 95% highest posterior density interval of ( 194,199 ) ( see also the histogram in figure [ fig : ksplots ] ) .",
    "the z - score for @xmath57 was @xmath119 , suggesting that we were still some way off convergence ( values close to @xmath120 imply convergence ) .",
    "for the rates @xmath121 ( before the change - point ) and @xmath122 ( after the change - point ) , the z - scores of @xmath123 and @xmath124 , respectively , give stronger evidence for convergence ( estimated densities of these parameters are shown in figure [ fig : rateplot ] ) .",
    "we considered sequence data that originates from a rooted binary tree ( * ? ? ?",
    "* chapter 1 ) of known topology and branch lengths but unknown sequence states at internal nodes , and we the substitution rates in the dna evolution model allowed to have change - points .",
    "we detailed bayesian parameter inference from such a model with an unknown number of change - points , implying a trans - dimensional posterior density .",
    "computational inference from this model is challenging , and we introduced two novel contributions to facilitate sampling .",
    "firstly , based on the time machine principle of @xcite , we showed how the top - most nodes of the binary tree can be replaced with a probability distribution of the sequence evolution model to reduce the cost of computing the likelihood linearly in @xmath0 ( the number of sequences ) .",
    "this approach introduces a bias , but this is was found in practice to have a small effect on inferences .",
    "secondly , we developed a particle marginal metropolis - hastings ( pmmh ) algorithm ( section [ sec : computationalmethods ] ) which mitigates having to construct trans - dimensional proposals that need to mix well .",
    "we first developed a sequential monte carlo ( smc ) sampler which only samples on a fixed - dimensional subspace of the full trans - dimensional state - space .",
    "we then showed how that smc sampler can be embedded within the pmmh algorithm to target the full posterior . by employing the time machine within this pmmh",
    ", we attained an algorithm that could run with a reduced computational cost and easily jump between models with different numbers of change - points .",
    "we successfully implemented our pmmh to perform inference from the model in a reliable fashion for small to moderately sized datasets .",
    "we empirically demonstrated that our pmmh can outperform approximate bayesian computation ( abc ) techniques @xcite in terms of precision and accuracy , and we showed that our algorithm can successfully be used to carry out reliable inference on real data .",
    "the success of our pmmh algorithm is largely due to the time machine , which , as we witnessed in section [ sec : resultscomparison ] , reduces the variance of the acceptance probability and enables the algorithm to jump easily between models .",
    "however , based on the output of section [ sec : resultscomparison ] , it seems that bias introduced by the time machine reduces the accuracy of the inferred substitution rates .    in a future work",
    ", one might want to extend the methodology to allow for unknown tree topologies , similar to @xcite . also , a future work could attempt to use a more appropriate distribution to approximate the distribution at the top of the tree .",
    "we attempted to find approximations in the point processes and coalescent literature , but we were unable to find a better approximation than that which we employed here .",
    "from the computational point of view , it will certainly be important to further speed up the algorithm and great savings could be made by parallelising calculations within the smc particle method and carefully investigating adaptive procedures for fine - tuning the temperatures and the mcmc kernels .",
    "all such efforts could have a big effect on reducing the variance of the estimate of @xmath70 , thus further improving the mixing of pmmh even with fewer removed nodes . also , there could then be great scope to apply the method for larger number of potential change points compared to the relatively small one we have tried here .",
    "this research was funded by the epsrc grant `` advanced stochastic computation for inference from tree , graph and network models '' ( ref : ep / k01501x/1 ) .",
    "aj was additionally supported by singapore moe grant r-155 - 000 - 119 - 133 and is also affiliated with the risk management institute at the national university of singapore .    1    , j.  ( 1981 ) . evolutionary trees from dna sequences : a maximum likelihood approach . _ j. mol . evol .",
    "_ , * 17 * , 368376 .    , j.  ( 2004 ) .",
    "_ inferring phylogenies_. sinauer , sunderland , ma .    , j. p. & suchard , m. a.  ( 2007 ) . a nonparametric method for accommodating and testing across - site rate variation . _ system . biol . _ , * 56 * , 975 - 987 .",
    ", j. p. & hillis , d. m.  ( 1993 ) .",
    "success of phylogenetic methods in the four taxon case .",
    "_ , * 42 * , 247 - 264 .    ,",
    "j.  ( 1994 ) .",
    "substitution - rate variation among sites and the estimation of transition bias .",
    "_ , * 11 * , 436 - 442 .    ,",
    "d.l . , olsen , g.j . ,",
    "waddell , p. j. , & hillis , d.m .",
    "phylogenetic inference . in _ molecular systematics _ , 2nd edition , chap . 5 , pp . 407 - 514 .",
    "sinauer and associates , sunderland , massachusetts .",
    "t & corbin k.w .",
    "fitting discrete probability distributions to evolutionary events .",
    "_ science _ , * 172 * , 1089 - 96 .",
    "m , chakraborty r , & fuerst p. a.  ( 1976 ) .",
    "infinite allele model with varying mutation rate .",
    "_ , * 73 * , 41644168 .    , g. j.  ( 1987 ) .",
    "earliest phylogenetic branchings : comparing rrna - based evolutionary trees inferred with various techniques .",
    "_ cold spring harbor symp quant .",
    "_ , * 52 * , 825 - 837 .    , z.  ( 1995 ) . a space - time process model for the evolution of dna sequences",
    "_ genetics _ , * 139 * , 9931005 .    , j & churchill , g. a.  ( 1996 ) a hidden markov model approach to variation of evolutionary rates among sites . _",
    "_ , * 13 * , 93 - 104 .    ,",
    "z. , goldman , n. & friday , a.  ( 1994 ) .",
    "comparison for models for nucleotide substitution used in maximum likelihood phylogenetic estimation .",
    "_ , * 11 * , 316324 .",
    "a & haussler d.  ( 2005 ) .",
    "phylogenetic hidden markov models . in r. nielsen , editor , _ statistical methods in molecular evolution _ ,",
    "325 - 351 , springer , new york .    , z.  ( 1993 ) . maximum likelihood estimation of phylogeny from dna sequences when substitution rates differ over sites . _",
    "_ , * 10 * , 13961401 .    ,",
    "m. a , weiss , r. e. , dorman , k. s. & sinsheimer , j. s.  ( 2003 ) . inferring spatial phylogenetic variation along nucleotide sequences : a multiple change - point model .",
    "_ j. amer .",
    "statist . ass .",
    "_ , * 98 * , 427 - 437 .    ,",
    "m. , & meade , a.  ( 2004 ) . a phylogenetic mixture model for detecting pattern - heterogeneity in gene sequence or character - state data .",
    "_ , * 53 * , 571581 .",
    ", e. , hurn , m.a . & robinson a. ( 2014 ) .",
    "classification of molecular sequence data using bayesian phylogenetic mixture models .",
    "data anal .",
    "_ , * 75 * , 81 - 95 .    , c. h. , suchard , m. a. , & drummond , a. j.  ( 2013 ) . bayesian selection of nucleotide substitution models and their site assignments . _",
    "evol . _ , * 3 * , 669688 .    , d. , mcauliffe , j. , ovcharenko , d. , lewis , k. d. , ovcharenko , i. , et .",
    "phylogenetic shadowing of primate sequences to find functional regions of the human genome .",
    "_ _ s__cience , * 299 * , 13911394 .    , r. a. , weinstock , g. m. , metzker , m. l. , muzny , d. m. , sodergren , e. j. , et .",
    "genome sequence of the brown norway rat yields insights into mammalian evolution .",
    "_ nature _ , * 428 * , 493521 .    , a. t. , cook , l. l. , delehaunty , k. d. , fewell , g. a. , fulton , l. a. , et .",
    "initial sequencing and comparative analysis of the mouse genome .",
    "_ nature _ , * 420 * , 520562 .    ,",
    "a. , bejerano , g. , pedersen , j. s. , hinrichs , a. s. , hou , m. , et .",
    "evolutionarily conserved elements in vertebrate , insect , worm , and yeast genomes .",
    "_ genome res . _ , * 15*(8),10341050 .",
    ", e. & vigoda , e.  ( 2006 ) . limitations of markov chain monte carlo algorithms for bayesian inference of phylogeny .",
    "probab _ , * 16 * , 22152234 .    ,",
    "a. , sankararaman , s. & jordan , m. i.  ( 2012 ) .",
    "phylogenetic inference via sequential monte carlo .",
    "_ system . biol._. * 61 * , 579 - 593 .",
    ", p. j.  ( 1995 ) .",
    "reversible jump markov chain monte carlo computation and bayesian model determination .",
    "_ biometrika _ , * 82 * , 711732 .    , a. , de iorio , m. , & chadeau - hyam , m.  ( 2011 ) .",
    "the time machine : a simulation approach for stochastic trees .",
    ", * 467 * , 23502368 .    , g. & andrieu , c.  ( 2013 ) . annealed importance sampling reversible jump mcmc algorithms .",
    "_ j. comp . graph .",
    "_ , * 22 * , 623648 .    , c. , doucet , a. , & holenstein , r.  ( 2010 )",
    "particle markov chain monte carlo methods .",
    "_ j. r. statist .",
    "b _ , * 72 * , 269342 .    , p. , doucet , a. , & jasra , a.  ( 2006 ) . sequential monte carlo samplers . _ j. r. statist .",
    "b _ , * 68 * , 411436 .    , y.  ( 2008 ) .",
    "bayesian and mcmc methods for phylogenetic footprinting .",
    "phd thesis , imperial college london .",
    ", j.  ( 1982 ) .",
    "reverend bayes on inference engines : a distributed hierarchical approach . in : _ proceedings of the second national conference on artificial intelligence .",
    "aaai-82 : pittsburgh , pa .",
    "_ aaai press , menlo park , ca .    , p.  ( 2004 ) . _ feynman - kac formuale_. springer : new york .    , y. , johansen , a. m. & aston , j. a. d.  ( 2013 ) . towards automatic model comparison : an adaptive sequential monte carlo approach .",
    "arxiv preprint .    ,",
    "a. , kantas , n. , & persing , a.  ( 2014 ) .",
    "bayesian inference for partially observed stopped processes .",
    "_ , * 24 * , 1 - 20 .    , p. & liu , z.  ( 2007 )",
    "online inference for multiple changepoint problems .",
    "_ j. r. statist .",
    "b _ , * 69 * , 589605 .",
    "marin , j .-",
    "m . , pudlo , p. , robert , c.p . & ryder , r. ( 2012 ) .",
    "approximate bayesian computational methods .",
    "_ statist .",
    "_ , * 22 * , 11671180 .    , j.  m. , pillai , n.  s. , robert , c.  p. , & rousseau , j.  ( 2013 ) .",
    "relevant statistics for bayesian model choice .",
    "_ j. r. statist .",
    "b _ , doi : 10.1111/rssb.12056 .    , p. , doucet , a. , & jasra , a.  ( 2012 ) .",
    "an adaptive sequential monte carlo method for approximate bayesian computation .",
    "_ statist .",
    "_ , * 22 * , 10091020 .    , t. , welch , d. , strelkowa , n. , ipsen , a. , & stumpf , m.  p.  h.  ( 2009 ) .",
    "approximate bayesian computation scheme for parameter inference and model selection in dynamical systems .",
    "_ j. r. statist .",
    "soc . interface _ ,",
    "* 6 * , 187202 .    , a. , liu , j.  s. , & wong , w.  h.  ( 1994 ) .",
    "sequential imputations and bayesian missing data problems . _ j. amer .",
    "_ , * 89 * , 278288 .",
    ", j.  s.  ( 1996 ) .",
    "metropolized independent sampling with comparison to rejection sampling and importance sampling .",
    "_ statist .",
    "_ , * 6 * , 113119 .    ,",
    "s. , samson , f. , navarro , d. , & casaregola , s.  ( 2013 ) .",
    "yeastip : a database for identification and phylogeny of ascomycetous yeasts .",
    "_ fems yeast res .",
    "_ , * 13 * , 117125 .",
    "http://genome.jouy.inra.fr/yeastip/    , j.  ( 1992 ) . evaluating the accuracy of sampling - based approaches to calculating posterior moments",
    "bayesian statistics 4 _ ( eds .",
    "bernardo , j. m. , berger , j. o. , dawid , a. p. , & smith , a. f. m. ) .",
    "clarendon press , oxford , uk .",
    ", s. , balding , d.  j. , griffiths , r.  c. , & donnelly , p.  ( 1997 ) . inferring coalescence times from dna sequence data .",
    "_ genetics _ , * 145 * , 505518 .",
    ", j.  s. , balding , d. , & beaumont , m.  a.  ( 2009 ) .",
    "popabc : a program to infer historical demographic parameters .",
    "_ bioinformatics _ , * 25 * , 27472749 .    , g. , jacob , b. , et al .",
    "* real data case : phylogeny of a subset of the saccharomycotina subphylum * + [ 1.2ex ]    * sim .",
    "data base dataset : variability of @xmath125 $ ] for @xmath86 versus @xmath87 * +   +    * real data case : autocorrelation and trace plot of sampled @xmath57 * + [ 1.2ex ]    * real data case : histogram of sampled @xmath95 given @xmath93 * +    * real data case : kernel density plots of sampled substitution rates given @xmath93 * +   +",
    "[ cols=\"<,<,^,^,^,^,^,^,^,^,^,^,^,^ \" , ]      +    the leftmost column contains the true parameter values for each example .",
    "we also record the number of samples on which each inference is based ( i.e. , we record how many samples from the true model each algorithm obtained ) .",
    "consider the sequence @xmath60 introduced in section 3.2 of the main paper , which is a sequence of probabilities known up - to a multiplicative constant .",
    "smc samplers of @xcite are designed for sampling from such sequences of distributions .",
    "the specific smc sampler that we employ in this work simulates a collection of @xmath66 samples ( or , ` particles ' ) in parallel and sequentially in time using a ) a sequence of mcmc kernels of invariant densities @xmath69 and b ) a resampling technique .",
    "the algorithm is summarized here as algorithm [ alg : smcsampler ] , with @xmath76 , @xmath77,t\\in\\{0\\}\\cup[t]$ ] and @xmath126 ( note that each @xmath69 will be calculated via belief propagation @xcite ) .",
    "the @xmath66 outputted samples at time step @xmath72 provide an approximation of the target @xmath68 .",
    "according to ( * ? ? ?",
    "* section 3.2.1 ) , the unnormalized weights can be used to obtain an unbiased estimate of the normalizing constant of @xmath68 : @xmath127.\\ ] ]    *   step 1 : for @xmath77 $ ] , sample @xmath128 and set the unnormalized weight : @xmath129 . set @xmath130 . *",
    "step 2 : for @xmath77 $ ] , sample @xmath131 $ ] from a discrete distribution on @xmath132 $ ] with @xmath133 probability @xmath134 .",
    "the sample @xmath135 are the indices of the resampled particles at time step @xmath136 . for each @xmath25 , set the normalized weight @xmath137 . *   step 3 : for @xmath77 $ ] , sample @xmath138 , where @xmath139 is an mcmc kernel of invariant density @xmath69 .",
    "compute the unnormalized weight according to ( * ? ? ?",
    "* equation 31 ) : @xmath140 if @xmath141 , stop .",
    "otherwise , set @xmath142 and return to the start of step 2 .",
    "recall the target ( 3 ) of section 3.1.1 of the main paper : @xmath143 .",
    "particle markov chain monte carlo ( pmcmc ) algorithms @xcite consider an ` extended target ' that yields the true target of interest  in this case , @xmath143  as a marginal .",
    "the extended target is constructed in such a way that an smc algorithm ( e.g. , algorithm [ alg : smcsampler ] ) can be used to sample some of its variables . in the context of this work",
    ", we will follow @xcite and write an extended target as @xmath144 where @xmath145 is the probability of all the variables associated to the smc sampler . a pmmh algorithm",
    "@xcite is a type of pmcmc algorithm that can sample from , and we present the details of the procedure as algorithm [ alg : pmmh ] .    * step 0 : set @xmath146 .",
    "sample @xmath147 .",
    "all remaining random variables can be sampled from their full conditionals defined by the target : + - sample @xmath148 via algorithm [ alg : smcsampler ] .",
    "+ - choose a particle index @xmath149 .",
    "+ finally , calculate @xmath150 via .",
    "* step 1 : set @xmath151 .",
    "sample @xmath152 .",
    "all remaining random variables can be sampled from their full conditionals defined by the target : + - sample @xmath153 via algorithm [ alg : smcsampler ] .",
    "+ - choose a particle index @xmath154 .",
    "+ finally , calculate @xmath155 via .",
    "* step 2 : with acceptance probability @xmath156 set @xmath157 . otherwise , set @xmath158 .",
    "+ return to the beginning of step 1 .",
    "the pmmh algorithms @xcite which employed the time machine all used @xmath159 particles , and the sequential monte carlo ( smc ) sampler @xcite within these algorithms always ran for @xmath160 time steps ( for the `` more sites '' example , we set @xmath161 ) .",
    "the pmmh employing the abc @xcite algorithm of @xcite also used @xmath159 , but @xmath162 copies of the data were simulated for each particle in order to obtain the best results .",
    "thus , this latter pmmh actually completed fewer iterations than the former pmmh within six hours .    in the numerical examples considered in this paper",
    ", we used the following proposals within our pmmh algorithms ; note that these are only suggested proposals and the methodology is still valid with other choices .",
    "the number of change - points was propagated from pmmh iteration @xmath163 to iteration @xmath25 using a discrete uniform distribution which was centered on @xmath164 and had an odd integer width of @xmath165 . in the event",
    "that @xmath166 ( with @xmath167 and @xmath168 being the lower and upper limits of possible values for @xmath57 , respectively ) , then @xmath169 was sampled from a discrete uniform distribution with @xmath170 shortened as needed ( i.e. , any potential values for @xmath169 that would be out of bounds were removed from the support ) .",
    "the smc samplers within the pmmh propagated the change - points @xmath109 and the components of @xmath97 ( i.e. , the unknown substitution rates ) via a metropolis - hastings kernel , and the unnormalised smc sampler weights were calculated according to ( * ? ? ?",
    "* equation 31 ) . within the kernel ,",
    "each individual change - point was propagated via a discrete uniform random walk similar to that which propagated @xmath57 . to avoid selecting the same site twice at smc iteration @xmath25 , the sampling consisted of two steps :    1 .",
    "sample @xmath171 conditional on @xmath172 .",
    "2 .    for @xmath173 ,",
    "sample @xmath174 conditional on @xmath175 , where @xmath176 are removed from the support of the discrete uniform if need be .",
    "finally , each component @xmath177 of @xmath178 was independently propagated via a log normal distribution with mean that depended on the value of @xmath179 .",
    "we also implemented the abc - smc algorithm for model selection on @xcite , with steps labelled ms1-ms3 . within the perturbation kernel , each @xmath180 component of @xmath181",
    "was independently propagated via a log normal distribution with a mean that depended on the value of @xmath182 from the previous iteration of smc .",
    "each individual change - point was propagated via a discrete uniform random walk .",
    "if the site labels range from one to @xmath1 , then any values of the support of the random walk that were less than two or greater than @xmath1 were assigned a zero probability of being chosen .",
    "furthermore , to avoid selecting the same site twice at iteration @xmath25 , the sampling consisted of the same two steps enumerated above for the pmmh algorithms .      in belief propagation @xcite , one first sends messages up from the leaves of a tree to its topmost parent nodes .",
    "when at the topmost nodes , it is required to input the marginal of each individual parent node and then send the messages back down to the leaves ( i.e. , one must input the probability that a parent node is of a particular type at that point in time ) .",
    "we approximated those probabilities with the model s equilibrium frequencies when employing the time machine .",
    "the two abc algorithms simulated datasets given sampled values of @xmath57 , @xmath109 , and @xmath97 .",
    "these model parameters were accepted as output when the simulated data was deemed to be sufficiently close to the actual dataset .",
    "mean pairwise difference is sometimes used in abc algorithms to compare two genetic sequences ( see ( * ? ? ?",
    "* section 2.6 ) ) .",
    "our datasets had @xmath183 genetic sequences each .",
    "when determining if simulated data was `` sufficiently close '' to an actual dataset , we compared each of the @xmath0 genetic sequences from the simulated data to its counterpart in the actual dataset .",
    "if the sum of the sites with different values ( across all @xmath0 genetic sequences ) was less than a specified tolerance level , then the simulated and actual datasets were deemed to be sufficiently close to one another .    in both of the abc algorithms implemented here ,",
    "the terminal tolerance level at step @xmath72 of the smc algorithm was @xmath184 .",
    "this value is as low as we were able to set the tolerance level . when we tried reducing the level further , the pmmh which employed abc accepted almost no mcmc moves and the abc - smc of @xcite was unable to accept any samples at step @xmath72 ( regardless of how high we set @xmath72 or @xmath66 to facilitate jumping between temperatures ) .",
    "however , with the tolerance level set as such , the abc - smc of @xcite was very fast , and it produced 5,000 samples from all of the tested models within a matter of minutes .",
    "we tried increasing @xmath66 so that the algorithm could use the full six hours alloted , but even when we set @xmath66 to be a very high number , the resulting inference did not change at all and was consistently extremely poor .",
    "the algorithms were implemented in c++ , using the openmp 3.0 and eigen @xcite libraries .",
    "the computation of the likelihood was parallelised across @xmath1 in the pmmh algorithms which employed the time machine . in the abc algorithms , simulation of the sites of the sequences",
    "was parallelised across @xmath1 .",
    "our particle marginal metropolis - hastings ( pmmh ) algorithm @xcite which employed the time machine used @xmath185 particles , and the sequential monte carlo ( smc ) sampler @xcite within this algorithm ran for @xmath186 time steps .",
    "the unknown model parameters were propagated from pmmh iteration @xmath163 to iteration @xmath25 using the same schemes as outlined in section [ sec : implementationdetailsex1pmmh ] . for the time machine approximation to the stationary distribution of the tree",
    ", we used the same scheme as stated in section [ sec : implementationdetailsex1tm ] .",
    "finally , the algorithm was implemented in c++ , using the openmp 3.0 and eigen @xcite libraries , and the computation of the likelihood was again parallelised across @xmath1 .",
    "we set @xmath87 , which means that the leftmost three nodes were removed from the tree in figure 1 of the main paper .",
    "we recognize that this is a deep cut for such a small tree and that the accuracy of the algorithm suffered as a result .",
    "however , the goal of this exercise was to get a sense if the algorithm could be used on real data and not necessarily to procure very accurate estimates of the true model parameters .",
    "a deep cut was necessary to facilitate mixing and enable the algorithm to complete a large number of iterations quickly for this test ."
  ],
  "abstract_text": [
    "<S> we observe @xmath0 sequences at each of @xmath1 sites , and assume that they have evolved from an ancestral sequence that forms the root of a binary tree of known topology and branch lengths , but the sequence states at internal nodes are unknown . </S>",
    "<S> the topology of the tree and branch lengths are the same for all sites , but the parameters of the evolutionary model can vary over sites . </S>",
    "<S> we assume a piecewise constant model for these parameters , with an unknown number of change - points and hence a trans - dimensional parameter space over which we seek to perform bayesian inference . </S>",
    "<S> we propose two novel ideas to deal with the computational challenges of such inference . </S>",
    "<S> firstly , we approximate the model based on the time machine principle : the top nodes of the binary tree ( near the root ) are replaced by an approximation of the true distribution ; as more nodes are removed from the top of the tree , the cost of computing the likelihood is reduced linearly in @xmath0 . </S>",
    "<S> the approach introduces a bias , which we investigate empirically . </S>",
    "<S> secondly , we develop a particle marginal metropolis - hastings ( pmmh ) algorithm , that employs a sequential monte carlo ( smc ) sampler and can use the first idea . our time - machine pmmh algorithm copes well with one of the bottle - necks of standard computational algorithms : the trans - dimensional nature of the posterior distribution . </S>",
    "<S> the algorithm is implemented on simulated and real data examples , and we empirically demonstrate its potential to outperform competing methods based on approximate bayesian computation ( abc ) techniques . + * keywords * : binary trees , change - point models , particle marginal metropolis - hastings , sequential monte carlo samplers , time machine , approximate bayesian computation .    * a simulation approach for change - points on phylogenetic trees *    by adam persing@xmath2 , ajay jasra@xmath3 , alexandros beskos@xmath2 , david balding@xmath4 , & maria de iorio@xmath2    @xmath2department of statistical science , university college london , london , wc1e 7hb , uk . </S>",
    "<S> + e-mail:`a.persing@ucl.ac.uk , a.beskos@ucl.ac.uk , m.deiorio@ucl.ac.uk ` + @xmath3department of statistics & applied probability , national university of singapore , singapore , 117546 , sg . </S>",
    "<S> + e-mail:`staja@nus.edu.sg ` + @xmath4genetics institute , university college london , london , wc1e 6bt , uk . </S>",
    "<S> + e-mail:`d.balding@ucl.ac.uk ` </S>"
  ]
}