{
  "article_text": [
    "the liberalised electricity market poses new challenges to power generating companies for the electrical grid .",
    "a key driver to set up economically efficient grids is the capacity to store electricity through hydro storage systems and thereby decouple electricity generation from electricity consumption .",
    "so , the hydro storage system optimization is becoming one of the most challenging task in energy finance , as highlighted in @xcite and in @xcite . while the current standard for hydro optimization covers linear models , recently risk aversion optimizations , which are very common in financial portfolio optimization , have been introduced into the energy sector , see f.i .",
    "@xcite and @xcite .",
    "the aim of the present paper is to set up a concave stochastic dynamic programming to optimize intraday electricity trading under risk aversion and model at the same time water values for hydroassets .",
    "it extends the previous work of the authors ( @xcite ) by presenting the complete algorithm and depicting a numerical example .",
    "starting from the seminal blomvall and lindberg model ( see @xcite , bl02 , @xcite , @xcite and @xcite ) , a stochastic multiperiod optimization problem in discrete time for a generic utility function is discretized in the space dimensions by means of a  bushy  recombining tree ( i.e. a @xmath0-lattice ) , so that we do not have deal with the dimensionality curse nor are we annoyed by heuristic arguments concerning the choice of representative branches in a non recombining tree , as blomvall and lindberg implicitly have to deal with in their original work .",
    "inequality constraints are packed into the objective function by the logarithmic barrier approach and the utility function is approximated by its second order taylor polynomial . the optimal solution for the original problem",
    "is obtained as a diagonal sequence where the first diagonal dimension is the parameter controlling the logarithmic penalty and the second is the parameter for the newton step in the construction of the approximated solution .",
    "the obtained algorithm is implemented in mathematica and applied to optimize intraday electricity trading and model at the same time water values for hydroassets .",
    "these are defined as shadow prices , that is the optimal lagrangian multipliers associated to the basin levels dynamics .",
    "this paper is structured as follows .",
    "section 2 introduces the set up for discrete intertemporal expected utility optimization of portfolio subject to constraints , solved by means of an algorithm developed in section 3 .",
    "section 4 deals with the implementation of the solution method on a lattice , seen as recombing tree .",
    "this is applied in section 5 to the intraday electricity trading to find an optimal strategy and to determine water values of hydroelectric infrastructures to be used for market bids .",
    "section 6 presents a numerical example .",
    "section 7 concludes .",
    "the purpose of this section is to show how the intertemporal expected utility framework can be implemented by means of time and space discretization .",
    "that for we will define a lattice , i.e a particular kind of tree , where each node will host a realization of risk drivers , risk factors and optimal rules .",
    "we first introduce the necessary notation :    * final time horizon : @xmath1 . * time points : @xmath2 . * filtered probability space : @xmath3 . *",
    "statistical expectation : @xmath4 $ ] . * risk drivers : @xmath5 , where @xmath6 is a @xmath7-measurable random variable .",
    "the random variables @xmath8 are assumed to be i.i.d . * external states ( or risk factors ) : @xmath9 , where @xmath10 is a @xmath7-measurable random variable .",
    "we assume that there exists deterministic functions @xmath11 such that @xmath12 .",
    "e.g. : asset values for the different asset classes .",
    "* control rules : @xmath13 , where @xmath14 is a @xmath7-measurable random variable .",
    "e.g. : holdings in the different asset classes . * internal states ( functions of external states and control rules ) : @xmath15 , where @xmath16 is a @xmath7-measurable random variable .",
    "we assume that there exists deterministic functions @xmath17 such that @xmath18 .",
    "e.g. : wealth level for the portfolio . * utility function : a concave , monotone increasing differentiable function @xmath19 * portfolio value : @xmath20 .",
    "if we choose as risk factors @xmath21 the values of base assets , then @xmath22 and @xmath23 .",
    "* constraints @xmath24 : linear equality and inequality constraints in the rules @xmath25 , as the self - financing constraint and lower and upper bounds in the holdings . *",
    "optimization problem : given positive deterministic weights @xmath26 modelling the relative importance assigned to the measurements in the different subintervals , the optimization problem @xmath27 writes @xmath28 . } \\ ] ]    the role of internal states is to simplify the representation of constraints and the recursion formulae , but we could formulate and solve the optimization problem without introducing them",
    ". however , they typically are quantities of interest for the problem at hand .",
    "the structure of the optimization ( [ p ] ) allows for an application of bellman s equation .",
    "this would not work for a generic utility function for the maximization of the expected utility of the cumulated values over the different time subperiods .",
    "to solve the optimization problem @xmath27 formulated in ( [ p ] ) we modify the model of blomvall and lindberg described in @xcite , bl02 , @xcite , @xcite and applied in @xcite by adapting it to our needs .",
    "the constraint set @xmath24 can be decomposed as union of three constraint subsets @xmath29 where we have set    * @xmath30 : equality constraints . in our case",
    "it is the self financing condition , which reads @xmath31 * @xmath32 : inequality constraints . in our case",
    "they are linear inequalities , which reads @xmath33 thereby , @xmath34 , @xmath35 and @xmath36 are processes adapted to the filtration .",
    "* @xmath37 : a special equality constraint given by the stochastic dynamics , which reads @xmath38    the problem can ( but must not ) be further simplified by choosing a linear valuation function and a linear dynamics , that is    * @xmath39 and thus @xmath40 * @xmath41 and thus @xmath42 where @xmath43 , @xmath44 and @xmath45 are processes adapted to the filtration .    subsequently , the optimization problem undergoes the following transformations :    1 .   *",
    "( @xmath46 ) : * original problem with a generic concave utility function @xmath47 and inequality constraints among others . 2 .",
    "* ( @xmath48 ) : * problem with objective function defined as trade - off between the expected utility and the logarithms of the functions defining the inequality constraints @xmath47 .",
    "the trade - off parameter is denoted by @xmath49 .",
    "the optimization problem has equality constraints only .",
    "( @xmath50 ) : * approximation of problem @xmath48 by substituting the objective function with its quadratic taylor polynomial .",
    "more exactly , we mean that :    * we write out the expression for the objective function @xmath51.\\ ] ] * we extend the objective function by packaging in it all the restrictions @xmath24 utilizing the logarithmic barrier approach , which approximates the constraints .",
    "thereby , the approximate solution for @xmath27 is the solution for @xmath52 for @xmath49 small enough .",
    "* we approximate the extended objective function by its quadratic taylor polynomial and the solution of @xmath52 is given by a newton s scheme sequence of solutions of problems of the type @xmath53 . *",
    "we find optimal rules for the approximated problem ( approximated constraints and approximated objective function ) .",
    "* there are two approximations schemes , one for the constraints and one for the extended objective function .",
    "we choose a diagonal sequence to obtain a sequence of rules converging towards the optimal rules of the original problem @xmath27 .",
    "the differences between this approach and the blomvall - lindberg original solution are both formal and substantial :    * blomvall - lindberg formulate directly the optimization problem on the nodes of a non - recombining tree .",
    "we formulate it for a general filtration .",
    "this is a rather a formal distinction , because the formulae are essentially the same . *",
    "the objective function in the blomvall - lindberg approach at time @xmath7 is a function of the risk factors realizations at time @xmath7 .",
    "the objective function in our approach at time @xmath7 can be seen as the expectation at time @xmath7 of the discounted sums of blomvall - lindberg s objective functions at times @xmath54 .",
    "the problem @xmath48 is an approximation of problem @xmath27 by means of the logarithmic approach , and reads as @xmath55,\\ ] ] where @xmath56^{\\dagger}\\in\\mathbf{r}^{l\\times1}$ ] and @xmath57 is a real parameter.if we choose a linear dynamic and a convex utility function , then , by convex optimization theory ( @xcite,@xcite and @xcite ) , the problem @xmath58 , } \\ ] ] has always a unique solution . as a matter of fact a convex function over a convex closed domain has always a global minimum .",
    "note that @xmath59 denotes the deterministic allocation just before the reallocation at time @xmath60 .",
    "the problem @xmath52 in ( [ p_mu2 ] ) has solely linear restrictions , and can therefore be solved by a closed expression by utilizing lagrange multipliers method .",
    "the lagrange principal function reads for the lagrange multiplicator @xmath61 @xmath62 , \\end{split}\\ ] ] and the corresponding lagrange equation in the unknown process @xmath63 @xmath64      equation ( [ lag ] ) can be solved pathwise in @xmath65 by means of newton s method .",
    "that for , we consider the quadratic taylor polynomial of the objective function @xmath66,\\ ] ] and to express its gradient with respect to the variables @xmath67 and @xmath68 we introduce @xmath69,\\\\\\\\ r^\\dagger_t(y_{\\ge t},u_{\\ge t } ) & : = \\nabla_{u_{\\ge t}}h_t(y , u)=\\\\ & = \\mathbb{e}_t\\left[\\sum_{s = t+1}^{t}\\beta_s\\nabla_{u_{\\ge t}}u(v_s(x_s , u_{s-1}))-\\mu\\sum_{s = t}^{t-1 } \\left(\\frac{1}{e_ty_t+f_tu_t - e_t}\\right)^\\dagger f_t\\right ] , \\end{split } } \\ ] ] where the vector divisions are made componentwise .",
    "the hessian of the objective function reads @xmath70,\\\\\\\\ p_t(y_{\\ge t},u_{\\ge t})&:=\\nabla_{u_{\\ge t}}\\nabla_{y_{\\ge t}}h_t(y , u)=\\mathbb{e}_t\\left[\\sum_{s = t+1}^{t}\\beta_s\\nabla_{u_{\\ge t}}\\nabla_{y_{\\ge t}}u(v_s(x_s , u_{s-1}))+\\right.\\\\ & \\qquad\\qquad\\qquad\\qquad\\qquad\\left.+\\mu \\sum_{s = t}^{t-1}e_t^\\dagger\\operatorname{diag}\\left(\\frac{1}{e_ty_t+f_tu_t - e_t}\\right)^2 f_t\\right],\\\\\\\\ r(y_{\\ge t},u_{\\ge t})&:=\\nabla_{u_{\\ge t}}^2h_t(y , u)=\\mathbb{e}_t\\left[\\sum_{s = t+1}^{t}\\beta_s\\nabla_{u_{\\ge t}}^2u(v_s(x_s , u_{s-1}))+\\right.\\\\ & \\qquad\\qquad\\qquad\\qquad\\qquad\\left.+\\mu \\sum_{s = t}^{t-1}f_t^\\dagger\\operatorname{diag}\\left(\\frac{1}{e_ty_t+f_tu_t - e_t}\\right)^2 f_t\\right ] .",
    "\\end{split } } \\ ] ] the second order approximation of @xmath71 can be described as a function of the increment in the variables @xmath72 and the matrix @xmath73\\ ] ] is positive definite for all @xmath74 and @xmath75 , an so are the matrices @xmath76 and @xmath77 .",
    "the second order expansion of @xmath52 in ( p_mu1 ) denoted as @xmath78 is the following quadratic optimization on @xmath79 @xmath80 that is @xmath81      we solve @xmath78 by dynamic programming and , to this end , we introduce value functions @xmath82 , \\end{split}\\ ] ] which allow to formulate bellman s backward recursion as @xmath83\\right\\ } , \\end{split}\\ ] ] where @xmath84,\\\\\\\\ \\overline{r}_t^\\dagger(y_t , u_t ) & : = \\nabla_{u_t}h_t(y , u)=\\mathbb{e}_t\\left[\\beta_{t+1}\\nabla_{u_t}u(v_{t+1}(x_{t+1},u_{t}))-\\mu \\left(\\frac{1}{e_ty_t+f_tu_t - e_t}\\right)^\\dagger f_t\\right],\\\\\\\\ \\overline{q}_t(y_t , u_t)&:=\\nabla_{y_t}^2h_t(y , u)=\\mathbb{e}_t\\left[\\beta_{t+1}\\nabla_{y_t}^2u(v_{t+1}(x_{t+1},u_{t})))\\right.\\\\ & \\left.\\quad\\qquad\\qquad\\qquad\\qquad+\\mu e_t^\\dagger\\operatorname{diag}\\left(\\frac{1}{e_ty_t+f_tu_t - e_t}\\right)^2 e_t\\right],\\\\\\\\ \\overline{p}_t(y_t , u_t ) & : = \\nabla_{u_t}\\nabla_{y_t}h_t(y , u)=\\mathbb{e}_t\\left[\\beta_{t+1}\\nabla_{u_t}\\nabla_{x_t}u(v_{t+1}(x_{t+1},u_{t})))\\right.+\\\\ & \\quad\\qquad\\qquad\\qquad\\qquad\\left.+\\mu e_t^\\dagger\\operatorname{diag}\\left(\\frac{1}{e_ty_t+f_tu_t - e_t}\\right)^2 f_t\\right],\\\\\\\\ \\overline{r}(y_t , u_t ) & : = \\nabla_{u_t}^2h_t(y , u)=\\mathbb{e}_t\\left[\\beta_t\\nabla_{u_t}^2u(v_t(x_t , u_{t})))\\right.+\\\\ & \\quad\\qquad\\qquad\\qquad\\qquad\\left.+\\mu f_s^\\dagger\\operatorname{diag}\\left(\\frac{1}{e_ty_t+f_tu_t - e_t}\\right)^2 f_t\\right ] , \\end{split } } \\ ] ] assuming that the matrices @xmath85 and @xmath86 have the form @xmath87 \\qquad&q_t=\\left [ \\begin{array}{cc } \\overline{q}_t & 0 \\\\ 0 & q_{t+1 } \\\\ \\end{array } \\right ] .",
    "\\end{aligned}\\ ] ] this is equivalent with the**inductive assumption : * * @xmath88 is a quadratic function in @xmath89 : @xmath90 where @xmath91 is an adapted , definite matrix valued process and @xmath92 , @xmath93 are adapted processes.using the dynamics @xmath94 we can rewrite the value function ( [ ind ] ) as @xmath95 with the definitions @xmath96 expression([ind ] ) for the value function becomes @xmath97.\\ ] ]      the optimum can be found by differentiating the expression maximized in ( ind2 ) with respect to @xmath98 : @xmath99= \\\\ & = \\widetilde{r}_t^\\dagger+{\\delta y_{t}}^\\dagger \\widetilde{p}_t+ { \\delta u_{t}}^\\dagger \\widetilde{r}_t , \\end{split}\\ ] ] which means , being @xmath85 symmetric , @xmath100 inserting this optimal @xmath101 in ( [ ind2 ] ) , the value function becomes @xmath102 where @xmath103 the expression for @xmath104 in the third equation of ( [ r2 ] ) together with ( [ r1 ] ) is known as the * discrete time riccati equation * in control theory .",
    "if @xmath105 is positive definite , if @xmath106 is positive semidefinite for all @xmath54 .",
    "newton s step determination problem @xmath78 in ( [ pbar ] ) for the barrier subproblem @xmath52 is solved by ( [ ustar ] ) , where matrices , vectors and constants are defined recursively by ( [ r1 ] ) and ( [ r2 ] ) .",
    "when it comes to implementing models from discrete time stochastic programming there are basically two possibilities :    * * * the ( semi-)closed formula solution:**in some ( seldom ) cases one can find a set of ( semi-)closed formulae representing the optimal control rules as a functional of conditional expectations of functions of risk factors .",
    "the optimal rules can be therefore explicitly determined given a probability model for the risk factors .",
    "but , in most of the cases , the computation can be only numerical , and we therefore have to switch to * * * the graph solution:**there are several possibilities to choose a graph , and for all the nodes of the graph will have to correspond to the atoms of the sigma algebras of the filtration @xmath107 : * * * * the full non - recombining tree:**this is the most generic solution , which has the disadvantage of being implementable in its fully fledged version on high performing computer only , because the number of nodes in a time layer increases exponentially with time .",
    "the alternative is to reduce drastically the number of branches from every node when time increases .",
    "to do so , one has to develop criteria to generate representative branches .",
    "those criteria are mostly heuristic . * * * * the grid:**parallel paths for simulated external states are stored in the nodes . if we have a ( semi- ) closed formula for the optimal rules , these can be computed on every node . if not , then the optimal rule is computed on the node by solving the bellman s backward optimization step by simulating jumps from that node to all nodes in the following time layer .",
    "this method is computationally effective and is therefore widespread . * * * * the lattice:**we see a lattice with many branches as a totally recombining tree .",
    "therefore , being the number of nodes in a time layer a linear function of time , the full fledged model is implementable even on standard computers .",
    "of course , the main challenge is to fill the nodes with state realizations in such a way that these are compatible with their dynamics on one hand , and with the full recombining property of the graph , on the other . to our knowledge",
    "this method is new , an is a generalization of binomial and trinomial trees construction utilized for option pricing .",
    "this is the way we choose here .",
    "it has the advantage of being extendible to the case where no ( semi-)closed solution on the nodes exists , and is thus a viable implementation method for a numerical solution of bellman s backward recursion .    1 .",
    "we construct the lattice with @xmath108 branches for every node and final horizon @xmath1 .",
    "for @xmath109 we set @xmath110 where the number of nodes at time @xmath7 is @xmath111 and the total number of nodes is @xmath112 2 .",
    "we introduce the probability space @xmath113 , where the cartesian product @xmath114 corresponds to all possibilities of traveling across the lattice from left to right as times goes by , @xmath115 is the sigma algebra of all measurable events , and , the sigma algebra generated by the lattice nodes in the time layer @xmath7 , ( that is having the nodes as basis ) leads to a filtration @xmath116 , where @xmath117 the probability of every node event is recursively defined as : @xmath118&:= \\sum_{n_{t-1}\\in\\,\\text{parents}(n_t)}\\frac{p[n_{t-1}]}{k}\\\\ p[n_0]&:=1 , \\end{split } } \\ ] ] and that for the elementary event @xmath119 is @xmath120:= \\frac{1}{k^t } , } \\ ] ] 3 .   by means of simulations",
    "we fill the lattice nodes with realizations of the risk drivers @xmath121 . since these are multivariate i.i.d .",
    "over time , these simulations are straightforward : for every @xmath122 1 .",
    "simulate @xmath123 values @xmath124 values with all the same probability .",
    "2 .   set @xmath125 for all nodes in @xmath126 , the layer at time @xmath7 .",
    "+ these are simulated values for the risk drivers on the nodes .",
    "we compute the corresponding realizations of the external states ( risk factors ) @xmath127 , by translating the dynamics at elementary event level @xmath128 to the nodes as @xmath129 5 .",
    "we pick a @xmath130 and a positive sequence @xmath131 such that @xmath132 and @xmath133 @xmath134 .",
    "we pick initial values for the control variables @xmath25 and the internal states @xmath135 .",
    "7 .   for the value",
    "@xmath136 we compute all the realization of the processes in ( [ r1 ] ) and ( [ r2 ] ) by inserting the realizations of all control rules and both internal and external states .",
    "we compute @xmath101 and check if it is approximatively very small . if not then , for @xmath137 and do the increase step @xmath138 update @xmath136 according to the sequence in ( 5 ) and jump to point @xmath139 . if @xmath101 is too big , so that @xmath140 and @xmath141 lie outside the feasible set , then @xmath101 has to be substituted by @xmath142 for an appropriate @xmath1430,1[$ ] small enough .",
    "typically , @xmath144 depends on the node where it is computed .    why does the implementation on the lattice work ?",
    "when implementing the dynamics , there is a fundamental difference between the non recombing tree and the lattice .",
    "the value of a process on a node depends on the values of the process on the parent nodes . in the non recombing tree case",
    "a node has only one parent , while in the lattice case a node can have several parents .",
    "but in both cases the process values on the nodes are expressed by conditional expectations .",
    "more exactly , we have the following situation :    * the space of all elementary events @xmath79 corresponds to all possibilities of travelling through the lattice from left to right . *",
    "a node @xmath145 in the lattice corresponds to an atom @xmath146 of the @xmath147-algebra for the time layer @xmath7 containing that node . *",
    "the value on the node @xmath148 of any random variable @xmath149 is _ its conditional expectation on that atom @xmath150 of @xmath147-algebra _ : @xmath151\\neq y(\\omega)\\quad\\text { for } \\omega\\in n.\\ ] ] * the external state variables : @xmath152 $ ] . *",
    "the optimization variables : @xmath153 $ ] . * an internal state variable defined as @xmath154 for deterministic functions @xmath155 for @xmath122 , typically utilized to define constraints . on the nodes it",
    "is represented by @xmath156 $ ] , and at elementary event level it has the dynamics @xmath157 which becomes the external state variable dynamics at node level @xmath158=\\sum_{n\\in\\text{parents}(\\bar{n})}\\frac{p(n)}{p(\\bar{n})}\\mathbb{e}[y_{t+1}|\\mathcal{b}(n)]=\\\\       & = \\sum_{n\\in\\text{parents}(\\bar{n})}\\frac{p(n)}{\\sum_{n\\in\\text{parents}(\\bar{n})}p(n)}g_{t+1}(y_{t}(n),u_t(n),x_{t+1}(n ) ) .",
    "\\end{split}\\ ] ] this holds for a generic dynamics of the internal states and hence for the implemented linear dynamics @xmath159 .",
    "the algorithm presented in the preceding section can be utilized to optimize intraday electricity trading and model at the same time water values for hydroassets .",
    "everyday by 11:00 cest all the participants to the swiss electricity spot market have to submit to the energy exchange their aggregated bids for the day - ahead both demand and supply .",
    "these , in the ",
    "ask-case specify for every hour of the following day , from 00:00 till 24:00@xmath160 cest the quantity of energy @xmath161 in mwh that one participant is willing to deliver during that hour @xmath162 if the electricity price @xmath163 then is greater than or equal to a certain value @xmath164 , called _ generation water value_. in the ",
    "bid-case the electric market participants specify for every hour of the following day the quantity of energy @xmath165 in mwh that the participant is willing to buy during that hour @xmath162 if the electricity price @xmath163 then is smaller than or equal to a certain value @xmath166 , called _ delivery water value_. for every hour the energy exchange aggregates all asks and all bids two monotone step functions , the ask curve and the bid curve , representing the quantity of energy deliverable ( ask ) or requested ( bid ) as a function of the price . the intersection point of the two curves , i.e. the market clearing price at time @xmath7 is the spot price which will hold for the hour @xmath7 of the next day .",
    "the @xmath167 spot prices for the day - ahead are published at around 11:15 cest of the current day .",
    "note that all of the market participants are due to deliver or to buy the quantities of energy specified during the bidding process , but at the market clearing price determined by the energy exchange for the day - ahead spot prices .",
    "however , the auction is not physically binding , that is , energy must not necessarily be produced but can be bought and delivered .",
    "all the trades for the day ahead settled between 11:15 and 23:59 cest , where energy quantities @xmath168 and @xmath169 will be sold and respectively bought at hour @xmath7 of the next day at price @xmath163 have to be taken into account by the trading strategy of the intraday - given what the spot desk has done .",
    "the relevant optimization problem at 23:59 cest of the day before @xmath170 ) reads for @xmath171 and @xmath172 @xmath173\\ ] ] and we make the choices needed to model the intraday - spot @xmath174 :    * @xmath175 for all @xmath7 , * @xmath21 the intraday price holding during @xmath176t-1,t]$ ] , * we assume that we have @xmath177 basins , labelled with @xmath178 .",
    "basin @xmath179 is connected with @xmath180 turbines / pumps .",
    "turbine / pump @xmath181 processes @xmath182 energy at time @xmath7 .",
    "the aggregated processed energy quantity at time @xmath7 for basin @xmath179 is given by @xmath183 and for the whole hydro infrastructure by @xmath184 .",
    "* @xmath185):=u_{t-1}x_t+(\\xi_t^{\\text{spot , sell}}-\\xi_t^{\\text{spot , buy}})s_t$ ] is the portfolio profit and loss for both spot and intraday desks . *",
    "@xmath186))$ ] , where @xmath187 is an increasing concave function defined as @xmath188 , where @xmath189 is an increasing concave function , @xmath190 is an increasing convex function and @xmath191 the risk aversion parameter .",
    "the function @xmath192 can be seen as a utility function .",
    "the optimization problem reads after these choices @xmath193.\\ ] ] the restrictions are given by :    * the intraday price stochastic dynamics , given by f.i .",
    "@xmath194,\\ ] ] where @xmath195 and @xmath196 with appropriate regularity and @xmath197 a @xmath198-dimensional standard brownian motion with respect to the statistical measure @xmath46 .",
    "we assume that , for the short future period , the intraday price dynamics is approximatively driftless , i.e. @xmath199",
    ". we can assume one risk driver ( i.e. @xmath200 ) and a deterministic volatility , that is @xmath201 a better way to model intraday prices @xmath21 is by modelling their spreads @xmath202 to spot prices @xmath163 @xmath203,\\ ] ] where @xmath204 and @xmath205 with appropriate regularity .",
    "again , the spread dynamics is approximatively driftless , i.e. @xmath206 and we assume a deterministic volatility , that is @xmath207 where @xmath208 denotes the instantaneous volatility for the log return of spot prices , and @xmath209 the correlation between log return of spot and intraday prices .",
    "note that to model intraday prices via their spread to spot one needs a spot price model first .",
    "in particular one has to model the expected spot prices in the day ahead market . * the dynamics of the hydro - infrastructure connecting : * * the basins volumes , * * the water inflows , * * the water outflows ( turbined water , overspills ) . + the basin @xmath179 level dynamics @xmath210 is given for all @xmath211 by @xmath212 where the process @xmath213 denotes the exogenous dynamics of basin @xmath179 inflow , and the level lower and upper constraints are given for all @xmath211 by @xmath214\\le y^{b,\\text{max}},\\ ] ] for specified constants @xmath215 which are ( flexible ) basin characteristics .",
    "remark , that , being the basins inflows uncertain , we can not express ( [ basinconstr ] ) as a predictable constraint for the water turbined or pumped , but the consequences on the optimal solution are typically not material , because the inflow volatility is small and we can assume for most applications that the inflow is deterministic and given as a table characterizing the basins system .",
    "+ in contrasts to financial applications we do not have here the self financing constraint , because we can decide to turbine / pump or not in a certain period independently of what has been done before or what will be done afterwards , as long as the basin constraints are not binding . *",
    "lower and upper bounds for the energy produced by each turbine every hour .",
    "note that negative lower bounds account for _ pumping_. these bounds capture expected potential market liquidity restrictions in the day ahead market and , for all @xmath211 , @xmath181 , @xmath178 , read as : @xmath216    before 11:00 cest we can utilize ( [ opt2 ] ) to determine the generation water values @xmath164 for @xmath162 for the day ahead for the hydro - infrastructure , whose bids we will aggregate in our bid for the energy exchange .",
    "we exclude for the moment the spot desk whose trades for the day ahead have not been established yet from ( [ opt2 ] ) .",
    "we define the water values as the shadow prices associated to the basin levels dynamics ( [ level ] ) , that is the value of the lagrangian multipliers associated to ( [ level ] ) for the optimal solution : they represents the instantaneous change per unit of constraints ( [ level ] ) , in [ mwh ] , in the objective function value of ( [ opt2 ] ) , in [ eur ] , for a variation of the constraints , i.e. the marginal utility of relaxing the basin level constraints . therefore , after having expressed the basin level dynamics ( level ) with the equivalent expression @xmath217=0,\\ ] ] for all @xmath122 and @xmath218 , we obtain a lagrangian principal function for the basin constraints @xmath219,\\ ] ] where @xmath220 is the energy corresponding to the water turbined or pumped and @xmath221 is the set of lagrangian multipliers for the basin levels .",
    "the optimal solution satisfies the equations @xmath222=0 &   \\\\",
    "\\frac{\\partial \\phi(u,\\lambda)}{\\partial \\lambda_t^b(\\omega)}=-(y^b_{t+1}(\\omega)-y^b_{t}(\\omega)+u^b_t(\\omega)-i^b_t(\\omega))=0 , & \\end{array } \\right.\\ ] ] which leads to @xmath223 the choice of the reformulation ( [ weightedlevel ] ) takes the probability for the constraint to be binding into account and leads to the meaningful definition for the shadow price .",
    "therefore , the stochastic water values are the same for all basins in the hydroinfrastructure and read @xmath224 where @xmath225 is the solution of the optimization problem ( [ opt2 ] ) satisfying _ all constraints , both equality and inequality ones_. we can use these stochastic water values to define production water values for the bid , by taking as possible definition @xmath226 . } \\ ] ] if the initial basin levels are distant enough from the lower and upper bounds , then we can assume that during the 24 hours of the optimization interval the basin level constraints are not binding and thus @xmath227 to our knowledge the expression `` water value '' was introduced for the first time by larsson and stage in @xcite . for a treatment of water values defined by means of lagrangian multipliers in a cost minimization problem",
    "see @xcite and an approach consisting in a time dependent shadow pricing of water in profit maximization problem can be found in @xcite .",
    "we can consider the joint intraday and spot desks in the determination of water values .",
    "the joint optimization problem at a certain hour before 11:00 cest ( t=0 ) reads for @xmath228 and @xmath229 @xmath230,\\ ] ] where @xmath231 denote the ( till 11:15 cest ) stochastic spot prices for the day ahead , and @xmath232 the stochastic quantities of energy turbined for the spot market .",
    "the restrictions are those of ( [ opt2 ] ) , where @xmath25 is substituted by @xmath233 .",
    "a computation analogous to the one for ( [ stochgp1 ] ) leads to the following stochastic and deterministic water values for all basins in the hydro power plant : @xmath234 , \\end{split } } \\ ] ] where @xmath235 is the solution of the optimization problem ( [ opt3 ] ) satisfying _ all contraints , both equality and inequality ones_. as in the intraday case",
    ", if the initial basin levels are distant enough from the lower and upper bounds , then we can assume that during the 24 hours of the optimization interval the basin level constraints are not binding and thus @xmath236 for all basins and turbines .",
    "the models ( [ opt2 ] ) and ( [ opt3 ] ) can be utilized at any hour @xmath237 of the current day to find stochastic and deterministic water values for the hours @xmath238 of the day ahead .",
    "immediately after 11:15 cest the day ahead spot prices are known . at any hour @xmath239 it is possible to initiate forward transactions with one hour in @xmath240 as delivery period .",
    "this means , at time @xmath7 of the day ahead the ( deterministic ) energy quantity @xmath241 will be delivered for the price @xmath242 established when the transaction was closed . in order for the allocation strategy to take this aspect into account ,",
    "we choose @xmath228 and @xmath229 and modify the optimization model ( [ opt2 ] ) to @xmath243,\\ ] ] where @xmath244 denote the deterministic forward prices for the day ahead , and @xmath245 the deterministic quantities of energy turbined for the forward market , established at a certain hour ( @xmath246 ) of the day before .",
    "of course one can add @xmath247 to the optimization variables and run the at time @xmath248 the algorithm solving ( [ opt4 ] ) is to find both optimal rules for the turbined quantities in the intraday market in the day ahead and deterministic optimal forwards for the day ahead . from the equality @xmath249",
    "one reads off the energy quantity @xmath250 to be hedged with the new forward transaction at time @xmath251 with delivery period @xmath252 $ ] .",
    "model ( [ opt4 ] ) can be further extended to account for intraday , forward _ and _ spot transactions , as well .",
    "the model proposed is intrinsically _ balance - energy neutral _ for the balance group which the hydro - infrastructure belongs to .",
    "a _ balance group _ is a set of electricity meters measuring @xmath253 min consumption and production for net users .",
    "the _ transmission system operator _ makes sure that every balance group is in an equilibrium state , by adding or subtracting electric energy in such a way that the total sum of energies vanishes for every quarter of an hour .",
    "of course this comes at a certain expensive price with which the tso charges the balance group owner , which can be ( but not necessarily is ) the hydro - infrastructure owner as well .",
    "thus , there is an incentive not to generate or at least to reduce balance energy , in order to minimize costs .",
    "the optimization problems analyzed so far can be rewritten in terms of risk - reward optimization , as it is customary in financial portfolio theory .",
    "the functional    * @xmath254 $ ] is termed as * reward measure * , * @xmath255 $ ] is termed as * risk measure*.    the optimization problem ( [ opt2 ] ) reads then as a trade - off between total risk and total reward @xmath256-\\frac{w}{2}\\left[\\sum_{t=1}^{t}\\beta_t\\text{risk}(u_{t-1}x_t)\\right],\\ ] ]",
    "we utilize the weighted averaged september 2015 data from epex spot intraday continuous for the ch market , downloaded from _",
    "www.epexspot.com / en / market - data / intradaycontinuous / intraday - table/2015 - 09 - 30/ch_. these weighted averaged intraday are depicted in figure [ plotintraday ] and have descriptive statistics as in table [ stat ] :        .intraday prices statistics [ cols=\"<,<\",options=\"header \" , ]     we construct a simple hydroinfrastructure :    * basin with a @xmath257 turbine and @xmath258 maximal capacity . * two possible starting basin levels : @xmath259 and @xmath260 .",
    "* constraints for the hourly quantity of water turbined : @xmath261 $ ] . * constraints for basin levels : @xmath262 $ ] .",
    "* no inflow during the optimization interval .",
    "we consider two possible the intraday dynamics :    * a driftless geometric brownian motion , whose volatility is given by table [ stat ] .",
    "* a spread to spot dynamics , where the intraday price is given by the expected spot for the hour in question plus a gaussian term accounting for the spread between intraday and spot , whose volatility is @xmath263 eur / mwh . for the expected spots , in absence of a sofisticated spot model , we use the monthly expectations for september 2015 .    for every day in the sample we compute the optimal dynamic strategy and the water values for the day ahead market using the weighted average electricity price between 08:00 and 09:00 for the current day .",
    "more precisely , we make the following choices for the lattice :    * valuation time : @xmath264 corresponding to 08:00 .",
    "* intraday price starting value : @xmath265 weighted average electricity price between 08:00 and 09:00 . *",
    "initial time day ahead : @xmath229 . * final time day ahead : @xmath228 . *",
    "number of branches out of a leaf in the lattice : @xmath266 .",
    "we test different utility functions :    * linear : @xmath267 . *",
    "exponential : @xmath268 , @xmath269 is the arrow - pratt relative risk aversion coefficient .",
    "* logarithmic @xmath270 .",
    "* hyperbolic @xmath271 , for a parameter @xmath2720,1[$ ] .",
    "as expected , when the basin level constraints is not binding , the optimal strategy is the same for all utility functions and reads @xmath273    to back test the results for the optimal strategy we apply it to the historical realizations of the intraday prices .",
    "more exactly , we express the discretized optimal rules as function of the discretized intraday price of the preceding period and compute the optimal rule with the realized price by linear interpolation . then , for every day in the back test , we pass through the different hours choosing the optimal quantity of water to be turbined according to the dynamic control rule established before .",
    "the wealth generated for every hour for all days is depicted in figure [ wealth ] .",
    ", height=944 ]    if we set the initial basin level constraint near to the lower bound , the optimal strategy looks different : it becomes truly stochastic , tries to exploit the price dynamics and , of course , depends on the the utility function chosen . in the following toy examples with @xmath274",
    "we depict the realizations of prices , optimal turbined quantities and basin level with the hyperbolic utility function with @xmath275 , once with the driftless geometric brownian motion and once with the spread to spot dynamics .",
    "a stochastic multiperiod portfolio optimization problem in discrete time for a generic utility function is discretized in the space dimensions by means of a lattice .",
    "inequality constraints are packed into the objective function by means of a logarithmic penalty and the utility function is approximated by its second order taylor polynomial .",
    "a converging sequence of solutions of the approximated problem converging to the optimal solution of the original problem is implemented in an algorithm coded in mathematica . as an application we model optimal intraday electricity trading and time water values for hydroassets . in a next work",
    "we will :    * compare the lattice implementation with the grid implementation , for both the semi - closed formula and the generic case .",
    "* investigate the specific case of a quadratic utility function which needs no newton - scheme , being its second order taylor polynomial the utility function itself , and , in particular , the dynamic mean variance case , for which in @xcite a semi - closed solution was already provided . *",
    "analyze the case of the maximization of the expected utility of the cumulated values over the different time subperiods , when the utility function is a trade - off between expectation and a dynamic risk measure , thus allowing for the bellman s recursive approach .",
    "we would like to thank sai anand and rmi janner for their hints and their very valuable feedbacks .",
    "j. blomvall and p. o. lindberg , _ a multistage stochastic programming algorithm suitable for parallel computing _ , journal of parallel computing - special issue : parallel computing in numerical optimization , volume 29 issue 4 , ( 431 - 445 ) , 2003 .",
    "j. blomvall and p. o. lindberg , _ back - testing the performance of an actively managed option portfolio at the swedish stock market , 1990 - 1999 _ , journal of economic dynamics and control , vol .",
    "27 , no . 6 , ( 1099 - 1112 ) , 2003 .",
    "j. egerer , r. scharff and l. sder , _ a description of the operative decision - making process of a power generating company on the nordic electricity market _ , energy systems , vol . 5 , issue 2 , 349 - 369 , 2014 .",
    "s. farinelli and l. tibiletti , _ portfolio management and stochastic optimization in discretetime : an application to intraday electricity trading and water values for hydroassets _ , operations research proceedings 2015 selected papers of the international conference of the german , austrian and swiss operations research societies ( gor , gor , svor / asro ) , university of vienna , austria , september 1 - 4 , 2015 , drner , k.f . , ljubic , i. , pflug , g. , tragler , g. ( eds . ) , springer verlag .",
    "isbn 978 - 3 - 319 - 42901 - 4 .",
    "forthcoming 2017 .",
    "a. horsley and a. wrobel , _ profit - maximizing operation and valuation of hydroelectric plant : a new solution to the koopmans problem _ , journal of economic dynamics and control , vol .",
    "3 , ( 938 - 970 ) , march 2007 .",
    "n. lhndorf , s. minner and d. wozabal , _ optimizing trading decisions for hydro storage systems using approximate dual dynamic programming _ , operations research , 61 ( 4 ) , 2013 , issn 1526 - 5463 forthcoming .",
    "f. paraschiv , r. m. kovacevic and m. schrle , _ optimization of hydro storage systems and indifference pricing of power contracts _ , presentation at energy finance conference 2015 , london , cass business school , 2015 ."
  ],
  "abstract_text": [
    "<S> hydro storage system optimization is becoming one of the most challenging task in energy finance . following the blomvall and lindberg ( 2002 ) interior point model , we set up a stochastic multiperiod optimization procedure by means of a bushy  recombining tree that provides fast computational results . </S>",
    "<S> inequality constraints are packed into the objective function by the logarithmic barrier approach and the utility function is approximated by its second order taylor polynomial . </S>",
    "<S> the optimal solution for the original problem is obtained as a diagonal sequence where the first diagonal dimension is the parameter controlling the logarithmic penalty and the second is the parameter for the newton step in the construction of the approximated solution . </S>",
    "<S> optimal intraday electricity trading and water values for hydroassets as shadow prices are computed . </S>",
    "<S> the algorithm is implemented in mathematica._keywords : _ stochastic multiperiod optimization ; stochastic market ; blomvall and lindberg interior point model ; logarithmic barrier approach ; energy markets ; spot and intraday prices._jel classification : _ </S>",
    "<S> c06 ; g13 ; g17 ; g11__msc2010 classification : _ _ 49m15 ; 49m37 ; 90c15 ; 90c30 ; 90c39 ; 90c51 ; 91g10 ; 91g80    [ section ] [ theorem]proposition [ theorem]lemma [ theorem]corollary [ section ] [ section ] </S>"
  ]
}