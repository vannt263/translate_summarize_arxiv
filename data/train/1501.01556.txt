{
  "article_text": [
    "the _ hubble space telescope _ ( _ hst _ ) has spent much of its operational lifetime staring into deep space , surveying galaxies in their infancy and youth .",
    "the motivation for these deep surveys ( the hubble deep field and its successors ) was to obtain time - lapse images that would reveal how galaxies formed and evolved . while we have made great progress in interpreting the deep _ hst _ surveys",
    ", this program remains challenging and far from complete ( * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* and references therein ) .",
    "there are two major reasons for this .",
    "first , the samples of high - redshift galaxies have been severely edited by selection effects , primarily limits on flux and surface brightness , effectively biasing the observable universe toward bright , compact galaxies .",
    "second , on the theoretical side , there are still many significant gaps in our understanding of the physical processes that affect the baryonic components of galaxies ( stars , gas , and dust ) and the radiation they emit .",
    "these uncertainties are reflected in the many free parameters of the semi - analytical models and in the analogous sub - grid physics of the hydrodynamical models . in this paper",
    ", we present a new approach to the analysis and interpretation of deep galaxy surveys that addresses both of these issues .    to account for selection effects ,",
    "we create simulated _ hst _ images of model galaxy populations , and we then analyze these images in the same way as real _ hst _ images , extracting catalogs from the simulated images to detect and measure the fluxes , sizes , and other properties of the galaxies .",
    "our simulated images include both cosmological effects ( projection along pencil beams , redshifting of passbands , dimming of flux and surface brightness ) and instrumental effects ( point - spread function [ psf ] , pixelation , noise , sky backgrounds ) for any given _",
    "hst _ camera , filter , and exposure time .",
    "we then extract catalogs of objects in the images with the widely used sextractor software @xcite .",
    "thus , our procedure automatically takes into account all relevant selection effects , allowing us to make unbiased comparisons between the predicted and observed distributions of luminosities , sizes , and other properties of galaxies .",
    "this is the approach recommended by textbooks on statistical inference : map the predictions all the way into the observational domain and make the comparisons there , often called `` forward modeling . ''",
    "the forward modeling method in not sensitive to small errors in the luminosities , sizes , and other properties of galaxies , or even to the exact definitions of these quantities , because such errors affect measurements of both the simulated and real images in the same way .",
    "in other words , these errors cancel out of the comparisons of the simulated and real distributions of luminosity , size , and so forth .",
    "this is one of the main advantages of the forward modeling approach .",
    "in contrast , nearly all work in this field is based on the opposite , but simpler , approach of comparing predictions with observations in the theoretical domain ( `` backward modeling '' ) .",
    "some exceptions are the reconstruction of mock images or data starting from semi - analytical models , ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) or hydrodynamical simulations ( e.g * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) , although the latter suffer from unrealistic star formation histories and too rapid growth of stellar masses at early times @xcite . in this paper , we go beyond the creation of mock galaxy images by deriving simulated distributions of galaxy properties and comparing them with the corresponding observated distributions .    to limit the number of assumptions and parameters in our models ,",
    "we adopt a semi - empirical description of galaxy evolution .",
    "this description is based on the evolution of dark matter halos in cosmological @xmath0-body simulations , which is now well understood , in contrast to the evolution of the baryonic parts of galaxies .",
    "the main assumption of the semi - empirical description is that most of the information needed for simulating a population of galaxies is already encoded in the merger trees of their dark halos .",
    "each halo is assumed to host one model galaxy , and the properties of that galaxy are then uniquely determined by those of its halo , including its mass and size .",
    "the advantage of this method is that it sidesteps much of the complex and uncertain baryonic processes in galaxy formation ; the disadvantage is that it likely oversimplifies some aspects of these processes .",
    "this semi - empirical description has been developed in numerous studies over the past decade ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "we derive the radiative spectrum of each simulated galaxy from its star formation history using stellar population synthesis models .",
    "the star formation history in turn follows from the growth of its halo mass , including both smooth accretion and discrete mergers with other halos .",
    "the radiative spectrum also depends on the metallicity of the stellar population and the absorption by gas and dust in the galaxy and by gas in the intergalactic medium .    in our implementation of this method",
    ", we use cutout images of real galaxies in the sloan digital sky survey ( sdss ) as templates for the visual appearance of our model galaxies , with their fluxes and sizes rescaled to reflect galaxy evolution according to our models .",
    "this generates much more realistic morphologies than the smooth srsic bulge+disk light profiles commonly used in previous semi - empirical or semi - analytical models and improves modeling of the detection incompleteness effects that arise from the internal clumpiness of real galaxies .",
    "our approach gives us a valuable science tool for comparing models of galaxy evolution .",
    "in this paper we build a reference model using plausible choices of parameters , and explore other models by changing one parameter at a time .",
    "thus , we can test the sensitivity of the simulated universe to each of these parameters by comparing the statistics derived from their respective simulated images to those from reference model and real _ hst _ images .",
    "moreover , since the _ input _ properties of each model galaxy on the simulated images are known , we are able to quantify the model - dependent _ output _ galaxy detection efficiency by comparing the input and output distributions of galaxy properties ( such as luminosity or size ) .",
    "our approach can be used to inform the design of future surveys ( e.g. , choice of filters and exposure times ) by addressing directly the question of which data are most useful to discriminate between different theoretical models .",
    "this will be especially valuable in planning the deepest surveys with the _ james webb space telescope _ ( _ jwst _ ) .",
    "we emphasize that the main purpose of this paper is to demonstrate the validity and utility of a general method for analyzing and interpreting deep galaxy surveys .",
    "this is an initial , exploratory study .",
    "we regard our specific implementation of the method and the first results obtained from it and presented here as being illustrative rather than definitive .",
    "there is scope for further development of the method and refinement of the results .",
    "nevertheless , the overall agreement we find between our simulations and observations  with no fine - tuning of parameters  is remarkable and encouraging .",
    "this paper is arranged as follows . ",
    "[ sec : makingsimuniverse ] explains the method for modeling and building simulated universes , from the selection of semi - empirical models and the dark matter simulation to the building of simulated _ hst _ images .",
    "the main results , presented in  [ sec : results ] , include the implementation of stellar mass - halo mass relations (  [ sec : halo - stellmassresults ] ) , present - day mass and luminosity distributions derived from the semi - empirical models of a simulated universe (  [ sec : comparingz0 ] ) , and a comparison of the luminosity , size and surface brightness distributions extracted from the simulated images with measurements from real _ hst _ images (  [ sec : simimageandstatistics ] ) .",
    "we devote  4 to an analysis of the cosmic star formation rate density .",
    "[ sec : conclusion ] discusses the results and summarizes our conclusions .",
    "in this section we describe in detail the steps required to build a self - consistent simulated universe and associated _ hst _ images .",
    "we also describe the parameters chosen for our _ reference model _ for the universe , as well as variations on those parameters explored in the other models .      following standard practice",
    ", we use a @xmath1cdm simulation as the three - dimensional ( 3-d ) skeleton of our simulated universes , placing a _ model galaxy _ at the center of each dark ( sub)halo . that defines the spatial distribution and number density of galaxies as a function of redshift .",
    "most of the information needed in our method is in fact provided by the halo mass and size evolution along halo merger trees , which does not involve any fitting of free parameters ( see  [ sec : halo - stellmassrelation ] and  [ sec : galsizefromhalosize ] ) .    for the merger trees",
    ", we use the milli - millennium cosmological dark matter simulation ( mms ) @xcite . its smaller size compared to the full millennium or millennium ii simulations @xcite makes it easier to use for this exploratory work ; we show below that the coarser mass resolution in the mms is adequate for our simulations (  [ sec : resultsfromstandardmodel ] ) .",
    "halos are defined using friends - of - friends groups as explained in @xcite .",
    "bound dark matter structures or ( sub)halos are composed of the most massive main ( or central ) sub - halo surrounded by satellite sub - halos .",
    "the mms has the same cosmology and particle mass ( @xmath2 ) as the much larger millennium simulation , but with both a smaller box size ( 85.62 mpc ) and a reduced number of particles ( @xmath3 ) .",
    "the cosmological parameters used are the ones obtained by _ _",
    "wmap__1 @xcite , i.e. , @xmath4 , @xmath5 , @xmath6 and @xmath7 . as explained by @xcite , the difference between the _",
    "_ wmap__1 and the standard _ _",
    "wmap__7 @xcite cosmologies does not affect significantly the relevant aspects of dark matter structure .",
    "in fact , a smaller _ _",
    "wmap__7 @xmath8 is counterbalanced by a greater @xmath9 , which results , for example , in the _",
    "_ wmap__1 and _ _ wmap__7-derived halo mass functions being very similar at @xmath10 .",
    "we obtain the stellar mass of model galaxies in the simulation using semi - empirical modeling .",
    "this approach defines the stellar mass @xmath11 of the galaxy as a function of the dark matter mass of the halo , @xmath12 , with the function @xmath13 defined to be the stellar mass - halo mass ( smhm ) relation .",
    "although this is a simple one - to - one relation , it can be readily modified to include statistical scatter or redshift dependence ( e.g. , * ? ? ?",
    "* ) . in this paper",
    "we adopt several smhm relations from the literature , and use them for building our simulated images .",
    "we introduce a novel , self - consistent approach that naturally adds scatter to the smhm mass relation .    as a measure of the halo mass",
    ", we use the virial mass @xmath14 ( mass enclosed inside the maximum radius within which the mean density is 200 times the critical value ) , which is obtained from the value - added catalog of @xcite based on the milli - millennium simulation . in this catalog ,",
    "the mass of a central halo is given by @xmath14 , whereas for a satellite halo it is the maximum @xmath14 ever attained before becoming a satellite . in the semi - empirical approach , this preserves the stellar mass of satellite galaxies even while the outer parts of their dark halos are being tidally stripped as they orbit within a central halo .",
    "figure  [ fig : halomassvsstellarmass ] shows some of the smhm relations found in the literature . our reference model ( or model 1 ) for simulating the universe uses the redshift - independent smhm relation from @xcite .",
    "they computed this relation using a halo abundance matching technique that equates quantiles of the low redshift stellar mass function from sdss @xcite to those of the present - day halo virial mass function from the millennium simulations .",
    "the quantile matching is made over a range of masses around the typical value @xmath15 ( i.e. , the  knee \" in the smhm relation as well as in the mass function ) , with extrapolations to the very low and high mass regimes , where both the stellar and halo mass distributions are not well constrained .",
    "another option is the redshift - evolving smhm relation of @xcite .",
    "this relation is based on stellar mass functions and cosmic star formation rates up to @xmath16 . for our non - evolving model 2",
    ", we adopt the @xcite smhm relation evaluated at @xmath10 , while for our evolving model 3 , we adopt the full redshift dependence of the @xcite smhm relation .",
    "our model 4 does not involve halo abundance matching , but is a simple linear relation given by @xmath17 , where the slope has been chosen by eye to coincide with the other relations in the vicinity of @xmath15 .",
    "we include this last model not because it is realistic but to study the sensitivity of our results to a smhm relation that is very different from those of our first three models ( based on the results of @xcite and @xcite )    in this paper , we do not explicitly impose random scatter in the smhm relation .",
    "instead we explore the scatter that emerges naturally from the dark matter simulation as a consequence of one basic assumption : _ we assume that the stellar mass along merger trees is a monotonically increasing function of time_. this is physically plausible because the stellar mass is concentrated in the center of halos due to dissipation in the baryons , and as a result it tends to be retained during mergers .",
    "this is the simplest physically motivated rule we have found for creating consistent galaxy stellar masses from dark matter simulations .",
    "the alternative is to assume that galaxies lose and gain mass willy - nilly as halo masses decrease and increase and as sub - halos merge ; that appears much less plausible based on our current understanding of galaxy formation and dynamics .",
    "another alternative is to impose scatter on the smhm relation in a predetermined manner ( as in the approach adopted by @xcite )    our assumption of monotonically increasing stellar mass naturally leads to scatter in the smhm relation as a consequence of the following three related effects :    1 .   in dark matter simulations",
    ", individual halos can decrease in mass from one time step to the next , for example in events of tidal stripping . in that case , we follow the approach of @xcite and do _ not _ reduce the stellar mass accordingly , but retain the stellar mass present before the decrease in @xmath18 .",
    "2 .   in halo mergers ,",
    "the dark matter mass of a descendant @xmath19 can be smaller than the sum of the progenitor dark matter masses @xmath20 as some particles become unbound during the collision .",
    "this is not a rare occurrence in the simulations . in order to conserve the stellar mass content",
    ", we must break with the one - to - one fixed smhm relation .",
    "3 .   observed smhm relations are intrinsically non - linear ( see figure  [ fig : halomassvsstellarmass ] ) .",
    "that leads to a conflict with the assumed monotonic growth of @xmath11 in halo mergers . consider the case when two halos with @xmath21 merge to create a new halo with @xmath22",
    "the smhm relation increases more slowly than linearly above @xmath23 , which means that @xmath11 for the new halo is supposed to be smaller than the sum of the stellar masses for the merging halos . that conflicts with the assumption that the stellar mass along the merger tree must increase monotonically .    to eliminate these conflicts",
    "we adjust stellar masses retroactively as follows .",
    "if a halo is found to have a stellar mass ( according to the imposed smhm relation ) that decreases with time , we decrease the stellar masses of its immediate progenitors to enforce a monotonic increase in the stellar mass content of dark matter halos across their merger trees .",
    "this adjustment is applied recursively to all the progenitors of halos with modified stellar masses .",
    "note that we are not assuming reverse causality with this scheme !",
    "our assumption is that lower mass halos in denser environments ( which are going to merge in the future ) have their star formation rates suppressed by these environments .",
    "this procedure is described in more detail in appendix [ sec : appendix1 ] .",
    "one natural consequence of this procedure is that , at a given halo mass , there is a scatter in the stellar masses that tends to fall slightly below the one - to - one smhm relation at some points in the merger history .",
    "the results with the modified smhm relations will be shown in  [ sec : halo - stellmassresults ] .",
    "the luminosity and spectrum of a model galaxy at any time are determined by its star formation history computed along the past merger history of its host dark matter halo .",
    "star formation is implied when the stellar mass of a descendant halo is greater than the total stellar mass of its progenitors in consecutive simulation time steps , or when a single halo increases its dark matter mass ( and hence its stellar mass ) due to accretion of surrounding dark matter particles .",
    "the stellar mass increase between simulation time steps implies a star formation rate , which is used in stellar population synthesis models to compute the emitted spectrum of the galaxy .",
    "we assume that the star formation rate between time steps is uniform , so that the star formation history is completely determined by the stellar mass history of a halo .",
    "note that since we have forced the stellar mass to increase monotonically with time , negative star formation rates are automatically excluded .",
    "we thus simply reconstruct the spectrum of the model galaxy ( and derived photometry ) as the sum of a series of uniform starbursts between each of the time steps in the simulation . when a galaxy is placed in a simulated image at a particular redshift @xmath24 ( implying an age @xmath25 ) , its rest - frame luminosity as a function of wavelength",
    "is computed using the star - formation history up to time @xmath25 using the evolutionary stellar synthesis code galaxev by @xcite .",
    "note that the redshift @xmath24 is not required to be at one of the discrete simulation time steps , since we can integrate the star formation rate from the previous time step to the actual time @xmath25 .",
    "( the need of similar interpolation schemes has also been noticed by * ? ? ?",
    "* ) . in our reference model",
    ", we adopt the chabrier initial mass function , with a fixed solar metallicity ( @xmath26 ) and the standard dust model from @xcite ( @xmath27 and @xmath28 ) .",
    "our modeling of galaxy spectra is flexible , as we can in principle elaborate this model with additional variables , such as a redshift - dependent metallicity .",
    "we adjust the size of a model galaxy so that it is always a fixed fraction of the evolving size of its dark matter halo ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "we determine the constant of proportionality between the galaxy size and the halo size by comparing their respective @xmath10 distributions , as in the halo abundance matching method .",
    "however , we match only their medians instead of the full distributions , which suffer from incompleteness in the tails . it is well known that size distributions for halos and galaxies are close to being log - normal ( e.g. , * ? ? ?",
    "since we choose to make galaxy size linearly proportional to halo size , the scale parameter and the median subtracted logarithmic distributions of both distributions should be the same .",
    "figure  [ fig : haloradiusvsgalradius ] shows the distributions of halo virial radii from millennium and @xmath29-band half petrosian flux radii @xmath30 for our main sample of sdss galaxies from  [ sec : galaxiesfromsdss ] .",
    "the latter has been corrected for incompleteness using the @xmath31 method @xcite , as shown with a similar galaxy sample by @xcite .",
    "we find the relation @xmath32 .",
    "the dispersions are different ( indicating that our assumption is not completely accurate ) but are similar enough for our purposes . as in the case of the spectra ,",
    "we interpolate the galaxy size between discrete time steps to the redshift @xmath33 of the model galaxy .",
    "lp0.7    model 1 + ( _ reference model _ )    &    * stellar mass - halo mass relation from @xcite * dust model from @xcite * fixed solar metallicity ( @xmath26 ) at all redshifts * apparent sizes of sdss galaxy cutouts on image are scaled to the theoretical size predicted by the dark matter halo size * sdss galaxy cutouts are chosen to be the closest match to the theoretically predicted model galaxy @xmath34 color and stellar mass .",
    "+ & + model 2 & same as model 1 , but using the @xcite smhm relation evaluated at @xmath10 .",
    "+ & + model 3 & same as model 1 , but using the @xcite redshift dependent smhm relation . + & + model 4 & same as model 1 , but using the a linear smhm relation @xmath17 .",
    "+ & + model 5 & same as model 1 , but using no dust model for galaxies .",
    "+ & + model 6 & same as model 1 , but using a fixed very low metallicity ( @xmath35 ) at all redshift .",
    "+ & + model 7 & same as model 1 , but without rescaling the intrinsic size of sdss galaxy cutouts ( except for the angular diameter distance scaling , also applied in the reference model ) .",
    "+ & + model 8 & same as model 1 , but the petror50 radius as well as @xmath34 and @xmath11 are used for matching sdss to model galaxies .",
    "+      our method places cutouts of real galaxy observations onto our simulated image , which has advantages over using smooth analytic galaxy light profiles .",
    "galaxies often have a clumpy internal structure , which affects source detections .",
    "a real galaxy could be detected as two or more separate objects , especially if its surface brightness approaches the image noise level .",
    "real galaxy cutouts recreate this effect and are more realistic than smooth bulge and disk light profiles adopted in previous semi - empirical and semi - analytical models .",
    "of course , this effect is not as important when the apparent galaxy sizes are comparable to the width of the point spread function , as may happen in the high redshift limit .",
    "a database of sdss galaxy images is used for the cutouts .",
    "we select from the sdss image database the real galaxy that is the closest neighbor to the model galaxy in a multi - dimensional space of galaxy properties .",
    "once the closest matching sdss galaxy is found , we rescale its flux and size in order to make them equal to those of the model galaxy .",
    "no free parameters are fitted or required in this step .",
    "the full details of the sdss data and the selection procedure is described in appendix  [ sec : appendix2 ] .",
    "one might wonder whether sdss galaxies are clumpy enough to be accurate models of high - redshift galaxies , since galaxies at higher redshifts tend to be more irregular than local galaxies .",
    "the changes in morphology are due both to the shift of optical band filters into the rest - frame ultraviolet for distant objects and also to a higher merger rate and dynamically less - relaxed structures in the early universe .    while these effects are worthy of further exploration in the future , for this paper the sdss images are a good basis for simulations .",
    "our analysis of galaxy counts and detection efficiencies relies on observations and simulations in the _ hst _",
    "wfc3/ir f160w filter ( @xmath36 m ) ; this implies that objects with redshifts less than 3 have an sdss filter ( from @xmath37 ) that is at the appropriate rest - frame wavelength , and the different morphologies in the ultraviolet are irrelevant .",
    "moreover , galaxies at redshifts beyond 3 tend to be sufficiently compact that their internal clumpiness has little impact on their detectability .",
    "the median fwhm size of detected galaxies with @xmath38 in our simulations is 0.3 arcsec , which is only twice the fwhm of the @xmath39 m wfc3 psf .",
    "while there is room for improvement in modeling the internal structure of galaxies , particularly for bluer filters in the @xmath40 redshift range , the sdss cutout images are certainly an improvement over models that use smooth analytical profiles .",
    "once model galaxy properties are calculated , we generate pencil - beams through our simulated volume and project them onto the plane of the sky .",
    "we then simulate acs / wfc camera images , with their visible filters , as well as corresponding wfc3/ir images ( sampled to the acs / wfc pixel size ) , with their infrared filters .",
    "we include realistic psfs for both cameras .",
    "to determine the 3-d structure within these pencil beams , we use a monte carlo method .",
    "this approach is much simpler and faster than other alternatives , such as the replication of a simulation box much smaller than the depth spanned by the simulated image .",
    "we first sample a random redshifts @xmath33 from a distribution that gives constant comoving volume per redshift interval",
    ". then we randomly select a dark matter halo at @xmath10 , choose all of its progenitors found at @xmath33 , and place them in the simulated image ( at redshift @xmath33 ) according to their relative 3-d spatial positions in the simulation box ( interpolating between time steps ) .",
    "although the large - scale correlations are discarded , we still preserve the short - range correlations between progenitors , while reducing considerably the computation time .",
    "the visual appearance of the model galaxy on the simulated image is given by the best matching sdss galaxy cutout ( appendix [ sec : appendix2 ] ) .",
    "we select the sdss band whose redshifted central wavelength @xmath41 ( to redshift @xmath33 ) is the closest to the band of the simulated image . due to the redshift of wavelengths",
    ", we end up using the bluest visible sdss bands to represent most high - redshift simulated galaxies in the visible and infrared _ hst _ filters , since sdss lacks the uv and far uv bands that would be more suitable for this redshift regime .",
    "since the @xmath42 band is noisy in sdss , we use the @xmath43 band as the bluest bandpass .",
    "in fact , all model galaxies placed on the simulated image are represented by a @xmath43-band cutout at @xmath44 for acs / wfc images or @xmath38 for wfc3/ir images .",
    "we rescale the flux of the image cutout to match that of the model galaxy .",
    "we apply to the model spectrum the effects of redshift , cosmological distance dimming and intergalactic absorption ( as in * ? ? ?",
    "* ) , before applying the photometric filter response .",
    "we rescale the sizes of the galaxy cutouts placed on the simulated image according to one of the following rules :    1 .   _",
    "no size scaling : _ the proper size of the original sdss physical galaxy is left intact , irrespective of the model galaxy size and hence the size of its halo .",
    "the physical size is scaled to the apparent size on the image using the angular diameter distance @xmath45 .",
    "size scaling : _ the proper size of the sdss galaxy is scaled to match the physical size of the model galaxy , which in turn is a fixed fraction of the halo size ( as described above ) .",
    "the apparent size is then computed from @xmath45 .    in the first model ,",
    "the @xmath46 size - mass relation of galaxies is preserved at all redshifts , whereas in the second model , the size - mass relation evolves with redshift , driven by the growth of the dark halos .",
    "galaxy sizes tend to be smaller at higher redshifts in the second model due to evolution in the halo sizes .    to add instrumental effects , we convolve with the _ hst _ point spread function , apply the _ hst _ instrument efficiency and pixelation , and add noise .",
    "instrument modeling uses the same software ( pysynphot , tiny tim ) , instrumental parameters and sky background as used in the standard _ hst _",
    "exposure time calculators , providing a high fidelity model of the real _ hst _ performance .",
    "the detection , extraction , and photometry of galaxies are performed by running sextractor @xcite on the simulated images . here",
    "we directly follow the method and parameters described in @xcite and designed for the analysis of real _ hst _ images .",
    "the complete output catalog merges sextractor runs using two different detection modes .",
    "the cold mode is used for detecting bright and extended sources , while the hot mode is optimized for extracting faint and small objects .",
    "after extraction , detected or _ output _",
    "galaxies on the final simulated image are matched ( using the detected position and luminosities ) to the _ input _ galaxies on the same image before adding the instrumental effects .",
    "this provides a direct measure of the detection completeness by comparing what sextractor detects to what was originally placed on the image .    to compare our simulated galaxies to those from real galaxy surveys we use auto magnitudes and petrosian radii @xmath47 , as calculated by sextractor .",
    "the petrosian radii of our input galaxy cutouts , as given by the sdss pipeline , differ from those returned by sextractor on the already simulated images , probably due to different definitions for the radius in the sdss pipeline and in sextractor .",
    "since we observe a linear offset between the distributions of these radii , we change the input sdss values to match those from sextractor by using @xmath48=@xmath49 .    [",
    "cols=\"^,^ \" , ]     cccc & & &   + & & &   +    cccc & & &   + & & &   +    _ luminosity and size distributions _",
    " the luminosity and size distributions for all galaxies detected on simulated images from the reference model are shown in figure  [ fig : lumandradfunsm ] , together with the respective distribution of model input values and sextractor - measured output values . when compared to the observed luminosities and sizes derived from the candels goods - s multi - wavelength catalog @xcite",
    ", the sextractor output values from the reference model ( red ) agree surprisingly well . for the luminosity distribution , a good fit",
    "is found at intermediate magnitudes , but the model predicts slightly too few galaxies at the bright end ( possibly affected by sample variance due to the small simulated image area ) .",
    "the drop in the input luminosity distribution at @xmath50 is an artifact of the finite mass resolution in the dark matter simulation .",
    "since the detection limit of the hudf - depth image ( @xmath51 ) is 2 mag brighter , we are safe from this artificial incompleteness .",
    "the sextractor size distribution also agrees with the observations , although the model seems to be slightly shifted toward smaller sizes .",
    "the bias between the input and output distributions of detected galaxies is also visible in this figure .",
    "the hudf - depth image shows that the peak value of the output @xmath52 distribution is shifted toward bigger radii by @xmath53  dex with respect to the input distribution .",
    "since this bias is not as strong in the goods - depth image , we conclude that the amplitude of the bias depends on the properties of galaxies near the detection limit , which differs in the goods and hudf - depth images .",
    "another interesting feature is that the output size distribution departs from the input size distribution at small values of @xmath47 ( down to the psf size ) , where measured sizes for small galaxies are much less than their true sizes .",
    "this effect was also discussed above ( fig .",
    "[ fig : outputmagvsoutputrad ] ) .",
    "the statistics derived from simulated images built with other models are qualitatively similar to those of the reference model and follow similar trends . however , the simulated universe is sensitive to changes in the model parameters , and we can easily distinguish variations among the derived statistics for different models .",
    "figure  [ fig : imagesallmodels ] shows the simulated images from all models . at first glance",
    "it is easy to recognize differences between the reference model and the others .",
    "for example , some images show a deficit of small galaxies ( e.g. , models 2 and 3 ) or an excess of them ( e.g. , model 4 ) .",
    "models 5 and 6 with no dust and low metallicity look brighter , and model 7 with no size scaling has much larger galaxies .",
    "figure  [ fig : apmagvspetroradallmodels ] shows the size versus apparent magnitude for two models that stand out from the others .",
    "model 4 , with the linear smhm relation , predicts higher stellar masses in small - mass halos than the reference model 1 , especially in the high - redshift universe where halos are just starting to assemble . the net effect is to make compact galaxies brighter .",
    "compared with the reference model in figure  [ fig : apmagvspetrorad ] , a much higher fraction of the galaxies are detected by sextractor , especially in the @xmath54 redshift range , since most of the galaxies on the image are brighter than the magnitude detection limit .",
    "model 7 , with a non - evolving size - mass relation , has a very different distribution of apparent sizes compared with that of the reference model 1 and the observed distribution .",
    "this is a powerful demonstration that galaxies were smaller in the past , even at fixed mass .",
    "the median apparent magnitudes at the mass completeness limit have different redshift dependences among the models . in figure",
    "[ fig : medianmagat20massallmodels ] , most of the models follow the same behavior as model 1 , with the exception of models 4 and 5 . model 4 has median magnitudes at the mass completeness limit 1.53 mag brighter than those of model 1 , since the linear smhm relation assigns more stellar mass content per unit halo dark matter mass .",
    "model 5 , with no dust , brightens at @xmath55 in comparison with model 1 , indicating that dust typically dims galaxies about by @xmath56  mag in the redshifted filter bandpass .",
    "all the models , however , flatten at high redshift as discussed for the reference model .",
    "figure  [ fig : efficiencyallmodels ] shows detection efficiencies for all models as a function of both magnitude and size .",
    "the number count efficiency as a function of magnitude varies for all models similarly to that of the reference model , declining slowly to 80% just above the magnitude detection limit and then dropping dramatically , irrespective of redshift . the light detection efficiency as a function of magnitude also shows a close similarity among the models , dropping to 60%70% just above the magnitude detection limit .",
    "regarding the number count detection efficiency as a function of size , most models have high efficiency ( 80%90% ) for larger objects with a sharp drop at input radii of @xmath57 .",
    "the drop is due to smaller objects also having smaller fluxes so that they are closer to the detection limit .",
    "there are , however , two models that stand apart .",
    "the linear smhm relation in model 4 makes compact , low - mass galaxies that are more massive and brighter than those in model 1 , and this greatly enhances the detectability of smaller objects . as a consequence ,",
    "the detection efficiency stays above 50% at input sizes down even to 0.1  for @xmath58 . at the other extreme , model 7 ( with the non - evolving size - mass distribution )",
    "has larger sizes and much lower detection efficiency at high redshift compared to the other models .",
    "the larger size distribution is seen because galaxy sizes are not scaled in proportional to the halo sizes .",
    "consequently high redshift galaxies are large fuzzy objects that are strongly suppressed in the images by the @xmath59 cosmological surface brightness dimming , and very few of them ( 10%20% ) are detected .",
    "the smaller sizes of galaxies at high redshift in most of the models are essential to making them detectable . the light detection efficiency as a function of size shows similar effects , although the differences for models 4 and 7 are less dramatic .",
    "the detection efficiencies as a function of redshift in figure  [ fig : efficiencyredshiftallmodels ] are only upper limits to the real values , since we are missing halos smaller than the mass completeness limit in the dark matter simulation .",
    "we calculate these efficiencies using only galaxies that are above the median magnitude set by the simulation mass resolution .",
    "the distributions for different models are qualitatively similar although there are some significant variations .",
    "the efficiency amplitudes depend strongly on the model and on how compact and luminous the galaxies are , especially in the case of the number count efficiency .",
    "for example , model 4 , with its more compact galaxies , shows by far the highest number count detection efficiencies , @xmath60% at all redshifts .",
    "the light detection efficiency is higher than the number count efficiency for all models .",
    "it is noteworthy that model 5 , with no dust , shows the highest light detection efficiencies at @xmath58 .",
    "these experiments show that the efficiencies depend on details of the models and that understanding them is key to inferring the physics of galaxy formation from observations .",
    "figure  [ fig : lumfunallmodels ] shows luminosity functions , which are especially suitable for exploring the effects of our different models on the simulated images .",
    "changing the smhm relation modifies the stellar mass distribution across redshift , which can be seen directly as a change in the apparent luminosity functions .",
    "according to figure  [ fig : halomassvsstellarmassandmassfunatz0 ] , the linear smhm relation ( model 4 ) predicts a much higher @xmath11 at a given @xmath18 than the guo et al .",
    "relation , especially for halos with @xmath61 .",
    "that shifts the peak of the luminosity function toward brighter magnitudes compared with the reference model .",
    "since the galaxies are brighter , more of them are detected by sextractor or seen by eye ( e.g. , figs .",
    "[ fig : imagesallmodels ] or  [ fig : apmagvspetroradallmodels ] ) . with the behroozi et al .",
    "smhm relation , @xmath11 is higher than with the guo et al .",
    "smhm relation at small values of @xmath18 , but lower at high @xmath18 ( for any redshift ) .",
    "the net effect is a shift of the peak to brighter magnitudes , but at the expense of fewer galaxies just brighter than the peak . at @xmath10 , the behroozi et al .",
    "smhm relation is similar to that of guo et al .",
    ", so the luminosity function of model 2 is closer in shape to that of model 1 .",
    "galaxies in model 5 ( with no dust ) are , as expected , more luminous than in the reference model , in some cases @xmath62 magnitudes brighter in the range @xmath63 . model 6 ( with low metallicity )",
    "behaves similarly to model 5 , but the magnitude shift is not as large .",
    "these 2 models also give good fits to the observations .",
    "the last 2 models share the same input @xmath10 luminosity function as the reference model , since only the size of galaxies are modified .",
    "therefore , model 8 , which uses @xmath30 in the matching between model and sdss galaxies , has a luminosity function at @xmath10 similar to that of model 1 . however , model 7 is slightly different at the onset of incompleteness , since here galaxy sizes are not scaled and are therefore larger than in the reference model .",
    "the galaxy sizes affect the surface brightnesses and so are influential in determining the detectability of faint galaxies .",
    "the size distributions in figure  [ fig : radfunallmodels ] mostly behave in the same way as in the reference model , except for models 4 and 7 . for model 4 ( linear smhm relation )",
    ", the peak of the output size distribution shows a larger bias toward bigger sizes ( by @xmath64  dex ) compared to the input distribution .",
    "note also that the output size distribution for smaller detected galaxies always falls below that of the input distribution .",
    "the input sizes of the smallest detected galaxies extend well below the fwhm of the psf ( 0.151 ) , but those bright enough to be detected have sextractor sizes comparable to the fwhm .",
    "( we have not modified the sextractor sizes to remove the effects of the psf . )",
    "the size distribution for model 7 is , not surprisingly , very different from the other distributions , since its galaxies lie on a non - evolving size - mass relation rather than having their sizes rescaled by the evolving sizes of their halos .",
    "that results in many large , faint galaxies at high redshift that are difficult to detect .",
    "the cosmic star formation rate density ( sfrd , the mass of stars formed per unit time and per unit comoving volume ) and its evolution with redshift have played a key role in studies of galaxy formation ( see * ? ? ? * and references therein ) .",
    "we have postponed consideration of the sfrd until now because , although this relation is derived from observations and is often portrayed as an `` observed '' relation , it is unsuitable for direct comparison with our models . in previous studies ( e.g. , @xcite ) ,",
    "predictions of the sfrd are compared with observations in the theoretical domain , i.e. , by combining observed galaxy counts and colors with corrections for dust absorption but without corrections for missing light at low luminosity and surface brightness .",
    "we argue instead that it is better to project theoretical models into the observational domain by creating simulated data and making comparisons directly with the observed quantities ( `` forward modeling '' ) .",
    "however , a complete study using that approach is beyond the scope of this paper .    nonetheless , a comparison between our model properties and sfrd values from the literature is illuminating .",
    "figure  [ fig : sfrd](a ) shows the sfrd in our reference model using the smhm relation from @xcite .",
    "the solid red line is the sfrd that results from our approach of enforcing a monotonically increasing stellar mass in halo merger trees by retroactively suppressing star formation ( see  [ sec : halo - stellmassrelation ] and appendix [ sec : appendix1 ] ) .",
    "observations from the compilation of @xcite are also shown .",
    "the model sfrd lies above the data points at high redshift ( @xmath58 ) but below them at low redshifts ( @xmath54 ) .",
    "figure  [ fig : sfrd](b ) shows the sfrd in our model using the redshift - dependent smhm function from @xcite .",
    "since @xcite forced their model to match the observed sfrd , one might expect that this smhm function would also be consistent with the observations .",
    "however , while our model sfrd ( solid red line ) is similar to the observations at high redshift ( @xmath65 ) , it is still too low at lower redshifts .    we have identified two significant effects that can raise the sfrds in our models .",
    "first , additional star formation is required to replace the stellar mass that is lost as massive stars reach the end of their lifetimes and die .",
    "we compute the additional star formation from the simple approximation given in eqn .",
    "( 14 ) of @xcite for the fraction of mass lost from a single starburst as a function of age ; this function is integrated over time to determine the ongoing star formation rate with recycled material .",
    "the resulting enhanced sfrd , shown in figure  [ fig : sfrd ] as the dashed blue line , is increased by factors ranging from 1.5 at @xmath66 to 2.5 at @xmath67 .",
    "this recycling effect is important and should be incorporated into future models , but it does not fully explain the difference between the computed sfrds and the observations .",
    "the second potentially important effect is the ejection of stars from galaxies during merging .",
    "this is a crucial feature of the @xcite calculation : the fraction of stars that escape from galaxies is an adjustable parameter .",
    "those stars are then subsequently replaced by additional star formation .",
    "this parameter enables fitting both the observed sfrd and the galaxy masses in massive cluster - scale halos .",
    "most of the intergalactic stars end up in clusters of galaxies and hence contribute to the diffuse intracluster light ( icl ) .    to include the possibility of star formation enhancement through icl",
    ", we adopt a more conservative procedure . our standard approach with star formation suppression",
    "reduces the star formation rates in merger trees to ensure that the stellar mass of galaxies never decreases .",
    "an alternative model is to allow all galaxies to form the stars required by the smhm relation , and then to eject the excess mass ( if any ) to the icl .",
    "the dot - dashed green lines in figure  [ fig : sfrd ] show the enhanced sfrds that result from this procedure . with this addition",
    ", the model sfrd for the @xcite smhm relation has been increased by another factor of 2 and agrees reasonably well with the observations at all redshifts .",
    "does this agreement imply that there _ must _ be a large fraction of stellar mass ejected to the icl in order to match the observed sfrd ? probably not . in the @xcite computations ,",
    "30% of the stellar mass in the universe lies outside galaxies , with the icl mass fraction being higher in clusters ( p.  behroozi , private communication ) .",
    "such a large fraction of extragalactic stars may be in conflict with observations of the icl , which suggest icl stellar mass fractions closer to 10% ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) . a model that relies on hiding much of the stellar mass outside of galaxies in order to enhance the sfrd may conflict as strongly with the observations as one that does not generate much intracluster light but has a lower sfrd .    instead of treating the inferred sfrd and icl as known quantities",
    ", a better approach would be to apply the forward modeling methodology discussed in this paper : from simple theoretical models of galaxy masses and star formation rates , create simulated observations , including the sfrd and the icl .",
    "then the comparison between the models and the observations should be carried out entirely in the observational domain .",
    "it seems quite plausible that a consistent model can be created that fits the observed galaxy masses , observed sfrd indicators , and measured icl properties ; such a model will not necessarily demand a very large stellar mass in the icl .",
    "this paper demonstrates that a credible simulated universe , consistent with deep _ hst _ images , can be constructed using only a few basic assumptions and a small number of parameters .",
    "the simplicity of our model , in contrast with the complexity of most other models of galaxy evolution , enables robust comparisons with the observed universe .",
    "a key element of this comparison is to project our models of evolving galaxy populations into the observational domain and to extract measurements from the simulations using the same tools as used to analyze the real images ( `` forward modeling '' ) . since our simulated _ hst _",
    "images include all relevant cosmological , instrumental , and selection effects , they can be compared directly with real _ hst _ images . in order to simulate the clumpiness and internal structure of galaxies , we cut out images of sdss galaxies as templates for our model galaxies ( instead of the commonly used smooth srsic profiles ) , with their fluxes and sizes rescaled to reflect the properties of model galaxies in our simulations .",
    "the key assumption of our theoretical modeling is that most of the information needed for a first order match between the simulated and observed universes is already encoded in the gravitational dynamics of dark matter halos , as derived from cosmological @xmath0-body simulations . in this semi - empirical approach",
    ", we express the stellar mass and size of a model galaxy as a function of the mass and size of its host halo .",
    "this effectively avoids any detailed modeling of complex baryonic physical processes , in contrast to semi - analytical and hydrodynamical simulations , with their larger number of assumptions and parameters .",
    "our semi - empirical models are based on statistical matching between the distribution of halo mass and size measured in the @xmath0-body simulation to the distribution of stellar mass and size for real galaxies at @xmath10 , thus guaranteeing a good match between the present - day simulated and observed galaxy populations . for the evolution of galaxy populations ,",
    "we adopt several simple models for the redshift dependence of the stellar mass - halo mass ( smhm ) relation .",
    "we also show that the evolution of the luminosities and spectra of galaxies can be modeled , to good approximation , using the star formation histories implied by the growth of the stellar mass of each galaxy along the merger tree of its host halo .",
    "the galaxy spectra are determined by convolving the star formation histories with stellar population synthesis models .",
    "the analysis of simulated _ hst _ images is a powerful tool for comparing the predictions from different models of galaxy evolution . by comparing directly in the observational domain ,",
    "we can decide which choices of parameters make an observable difference and which do not .",
    "our reference model assumes a non - evolving smhm relation and non - evolving solar metallicity and dust content . despite these simple assumptions , it provides a good match to real _ hst _ images , particularly when comparing the luminosity and size distributions . including plausible redshift - dependence in the smhm relation",
    "does not radically alter the simulated _ hst _ images .",
    "in contrast , a much less plausible , linear smhm relation , with the stellar mass proportional to the halo mass , leads to a far greater abundance of compact , high - luminosity galaxies in low - mass halos at high redshift . from this and our other models ,",
    "we conclude that the stellar mass efficiency per unit halo mass should indeed peak at stellar masses around @xmath68 and decrease for smaller and higher masses .",
    "metallicity and , especially , dust have a strong effect on the observed galaxy properties , with their luminosities increasing by up to 0.7  mag when removing dust or metals from the galaxies . from the analysis of galaxy sizes , we conclude that galaxies must be smaller in the past .",
    "a simple linear scaling between galaxy and halo sizes provides a good match between the size distributions of simulated and real _ hst _ images .",
    "if there were no evolution in the sizes of galaxies , the deep _ hst _ images would appear almost empty .",
    "we also find that the measured values of size and luminosity of galaxies in the simulated images are strongly biased .",
    "sextractor underestimates the luminosities and sizes of simulated galaxies especially around the magnitude detection limit , as the extended low surface brightness components of galaxies are lost in the image background noise .",
    "these biases vary among the models , depending primarily on the size - luminosity relation of galaxies .",
    "for example , our model with a linear smhm relation predicts more light for small , faint galaxies , which makes them easier to detect compared with our reference model .",
    "the detection efficiency of galaxies , measured by comparing the number and luminosities of detected galaxies in the simulated images to those for all model galaxies , also reveals some interesting results . for the reference model ,",
    "the number detection efficiency declines slowly with magnitude as objects get fainter to @xmath69% just above the detection limit and it then drops more rapidly .",
    "this behavior is similar at low and high redshifts , since it depends only on whether galaxies are bright enough to pass the magnitude cut .",
    "the fraction of light recovered from galaxies , on the other hand , falls considerably faster with magnitude ; it is @xmath7060 - 70% right above the detection limit and then drops sharply .",
    "the reason for this is that sextractor not only fails to detect faint galaxies but also underestimates the fluxes of the ones it does detect .",
    "note that although the model with a linear smhm relation behaves similarly as a function of magnitude ; it has a much higher detection efficiency at small sizes , since it assigns more luminosity to the small , high - redshift galaxies , making them easier to detect .",
    "the fraction of missing light may be underestimated in our simulations because they truncate the luminosity profiles of galaxies at two petrosian radii .",
    "the redshift dependence of the detection efficiencies is also interesting but requires some additional considerations .",
    "the numerator of the efficiency ( i.e. , the number of detected galaxies or the total light detected ) is measured with reasonable accuracy . however , the denominator ( the total number or luminosity of galaxies ) is not well determined because our images are missing galaxies with masses below the resolution of the milli - millennium simulation .",
    "we address this issue by fitting the power - law tail of the luminosity function , and estimate the missing light by extrapolating the fitting function toward zero luminosity .",
    "our measurements for the reference model show that the fitted power - law slope becomes steeper at higher redshift , changing from @xmath71 at @xmath72 to @xmath73 at @xmath74 .",
    "since the slopes are shallower than the divergence value @xmath75 , the extrapolated missing light is always finite and the fraction of missing light is modest in our case .",
    "indeed , the light detection efficiency drops from @xmath7090% at small redshifts to only @xmath7050% at @xmath74 .",
    "these values depend sensitively on the slope of the luminosity function , which in turn depends on the dark matter halo mass distribution . since the power - law tail of this mass distribution has a slope of @xmath75 ( confirmed both by theory and simulations )",
    ", it would not be difficult to find models with suitable combinations of smhm relations and mass - to - light ratios that predict a power - law slope of the luminosity function closer to @xmath75 or even steeper , resulting in very small detection efficiencies .",
    "we demonstrated this by our model with a linear smhm relation , which presents a lower light efficiency than models with more plausible smhm relations .",
    "the total number of galaxies , on the other hand , diverges for slopes steeper than the limit @xmath76 .",
    "since our simulated universe presents steeper slopes , we conclude that the number counts detection efficiency as a function of redshift can not be accurately measured using the milli - millennium simulation at most redshift .",
    "the main goal of this paper was to develop some first - generation simulations of deep _ hst _ images using semi - empirical models of evolving galaxy populations . in this spirit , we have tried to strike a balance between models that are realistic enough for meaningful conclusions and models that are simple enough for computational efficiency and ease of interpretation .",
    "indeed , we regard the simplicity of our models , with relatively few assumptions and parameters , as a definite virtue in a preliminary exploration such as this .",
    "now that this initial analysis has been successfully concluded , it is appropriate to consider how our approach can be enhanced for greater physical realism and accuracy . in the remainder of this section , we outline several directions for future studies of this type .",
    "a relatively straightforward enhancement of our models would be to base them on dark - matter simulations with larger comoving volumes and smaller particle masses , such as the millennium ii @xcite or bolshoi @xcite simulations .",
    "the larger volume would permit a more accurate simulation of both the small and large - scale distribution of galaxies in deep images than is possible with the milli - millennium simulation .",
    "in particular , it should be possible to lay down light cones through the simulation volume to compute galaxy distributions rather than relying on sampling the halo distribution as we do in this paper .",
    "such simulations , in addition to providing direct estimates of correlation functions and other clustering statistics on large scales , will provide estimates of the variance in counts and other properties of galaxies in smaller fields .",
    "the higher mass resolution of larger dark matter simulations will enable the modeling of galaxy populations to lower masses and luminosities .",
    "this is especially important for the simulation of _ jwst _ images , which will reach much fainter magnitudes than the _ hst _ images considered here .",
    "the extension of model galaxy populations to lower masses will also improve estimates of detection efficiencies for the counts and light of galaxies , which depend on extrapolations of luminosity functions below the detection thresholds",
    ".    it would be also worthwhile to make simulations with a larger suite of smhm relations .",
    "the resulting simulated _ hst _ images could then be compared with observed images and a goodness of fit assigned to each of these smhm relations ( by e.g. maximum likelihood ) .",
    "the requirement that the models satisfy constraints on the sfrd and icl (  4 ) could be added to the procedure at this stage . in this way",
    ", the  best \" smhm relation and confidence regions around it could be determined . as a byproduct",
    ", such statistical tests would indicate how much useful information _ hst _ images really contain about galaxy formation and evolution .",
    "in particular , we would like to know whether the evolution of the smhm relation can be pinned down uniquely or whether substantially different smhm relations lead to similarly good fits in comparison with _ hst _ observations .",
    "this issue has important theoretical implications ; different smhm relations presumably reflect differences in the physical processes in galaxy formation and evolution .",
    "this issue also has practical implications , because simulations like those presented here could be used to guide future observing strategies , with different telescopes , cameras , and filters , to determine the smhm relation most efficiently and robustly and to resolve ambiguities in the models .",
    "another improvement would be to allow the metal and dust content of model galaxies to evolve with redshift .",
    "our results , based on non - evolving metal and dust content , show that differences in these quantities are readily apparent in simulated _ hst _ images .",
    "a physically plausible scheme for evolving the metal and dust content should be based on the star formation and thus the metal enrichment history of each galaxy in the model .",
    "unfortunately , the stellar metallicity and ism dust optical depth also depend on the evolution of the ism of each galaxy , including inflows and outflows , and these can not be specified without introducing additional assumptions and parameters .",
    "this is why we have neglected the evolution of the metal and dust content in the present exploratory study .",
    "nevertheless , such effects could and probably should be included in future studies , provided one is willing to pay the price of extra assumptions and complexity .",
    "we are grateful for support of this project by the stsci director s discretionary research fund .",
    "we thank henry ferguson and michael peth for help on running sextractor , ching - wa yip for help on running galaxev and victor paul for helping with data - scope maintenance .",
    "we thank massimo stiavelli and jason tumlinson for helpful discussions in the early phases of this project and peter behroozi for helpful input in the later phases .",
    "we have developed a self - consistent and recursive method that ensures a monotonic increase in the stellar mass content of dark matter halos across their merger trees .",
    "this retroactive suppression mechanism functions in the following way : when a halo is measured to decrease its current @xmath11 value , we suppress accordingly the value of @xmath11 in its progenitor halos located in the closest previous time steps , which consequently causes scatter away from the one - to - one smhm relation .",
    "first , we start with a root halo picked from the collection @xmath77 of all @xmath0 halos found in the last ( @xmath78th ) time step in the simulation ( most likely to be at @xmath10 ) , and compute @xmath79 for all halos in its merger tree using the one - to - one smhm relation",
    ". then we pick its progenitors located in the previous @xmath80th time step and verify that @xmath81 .",
    "if not , we reduce the stellar masses of these progenitors ( proportionally to their masses ) , so that @xmath82 holds .",
    "we continue decreasing the @xmath11 values in halos of all the closest previous time steps until reaching the @xmath83th time step ( @xmath84 ) , where @xmath81 holds for all progenitor halos located at the @xmath85th time step .",
    "this process is repeated recursively and backward in time throughout the merger tree of the root halo , with each one of its progenitors playing the role of the root halo , that is , each progenitor goes later under the same process that modifies @xmath11 values along its own ( smaller ) merger tree .",
    "all the previous steps are then repeated for the next root halo in @xmath77 until the whole dark matter simulation is traversed .",
    "evidently , the optimal case would be to have the @xmath78th time step located ( if available ) at sometime far enough in the future , so that all values of @xmath11 at @xmath10 are modified and stabilized .",
    "this appendix describes the procedure used to select sdss galaxy image cutouts that represent model galaxies on our simulated _ hst",
    "_ images .    as a repository of galaxy images",
    ", we use the sdss data release 10 @xcite . this data archive ( a ms - sql server database available online via casjobs ) is suitable for our needs , as it provides imaging and spectroscopy of @xmath86 galaxies as well as many other derived physical properties .",
    "we use in particular the main galaxy sample ( mgs , * ? ? ?",
    "* ) , which spans a rich variety of galaxy types over a sky area of 7930 deg@xmath87 .",
    "these galaxies form a flux - limited sample , with an @xmath29-band petrosian apparent magnitude limit of @xmath88 .",
    "we define our sample in the redshift range of @xmath89=[0.01,0.2]$ ] , with the peak of the redshift distribution located at @xmath90 .",
    "we consider clean science primary galaxies only on calibrated images having the photometric status flag .",
    "we discard suspicious detections and objects with deblending and interpolation problems , as well as objects whose spectral line measurements and properties are labeled as unreliable .",
    "our main sample contains @xmath70400,000 galaxies .",
    "the properties available for the mgs that we use in this paper are the photometry in the @xmath91 bands , in particular model magnitudes for computing the colors @xcite .",
    "a measure of the galaxy size is given by the ( redshift insensitive ) @xmath29-band petrosian radius @xmath47 @xcite and its less noisy proxy @xmath30 ( the radius encircling 50% of the petrosian flux ) .",
    "the galaxy stellar mass @xmath11 is also available ; it was obtained from spectral analysis at mpa and jhu , as detailed by @xcite .",
    "we extract the galaxy cutouts from 50  tb of 5-band , 2048@xmath921489 pixel sdss image frames using parallel processing in the data - scope , a computing facility designed specifically for data - intensive applications @xcite . as a first step , we denoise the images using the anisotropic diffusion method @xcite , which is particularly useful for the more noisy @xmath42 and @xmath93 bands .",
    "this leaves the galaxy outline and internal structure intact , since the smoothing is done in the direction locally parallel to the edges or borders .",
    "multi - band images are registered to the same reference frame using cubic spline interpolation .",
    "we extract individual galaxy cutouts from the original images , considering only what is included inside an aperture of radius 2@xmath52 centered at each galaxy . to avoid the influence of neighboring objects , we do not use galaxies where the sum of fluxes from all neighbors that overlap the aperture exceeds 1% of the galaxy flux .",
    "this leaves us with a total of @xmath70270,000 galaxies in the repository .",
    "we select from the sdss image database the galaxy that is the closest neighbor to the model galaxy in the multi - dimensional space of galaxy properties .",
    "for this paper , we use two sets of parameters to select matching sdss galaxies :      other schemes using additional parameters were tried with very similar results .",
    "each property is mean - subtracted and normalized by the standard deviation before doing the matching .",
    "the @xmath34 color tracks the flux difference before and after the @xmath96 break , and is a good indicator of age . to compare photometry ,",
    "the ( evolved ) rest - frame spectrum of the model galaxy is redshifted to the median of the sdss redshift distribution ( @xmath97 ) , and then convolved with the @xmath42 and @xmath29 filters . using the properties from a simulated universe based on our reference model (  [ sec : results ] ) , we find that the median of the rms error over all properties derived from the second matching scheme ( @xmath98 ) is bigger than that of the first scheme ( @xmath99 ) , since there is one more variable to match ( @xmath95 ) . however , the individual median rms error for @xmath95 in the second matching scheme is @xmath56  dex smaller than that of the first .",
    "a good compromise is to use the first matching scheme to get a smaller overall rms error , but then to manually rescale the sdss galaxy size to match the model galaxy size as described in ",
    "[ sec : creatingsimimage ] .",
    "this approach is used as part of our reference model as well .",
    "ahn , c.  p. , alexandroff , r. , allende prieto , c. , et al .",
    "2014 , , 211 , 17 baldry , i. k. , et al .",
    ", 2008 , mnras , 388 , 945 behroozi , p. s. , conroy , c. , & wechsler , r. h. 2010 , apj , 717 , 379 behroozi , p. , wechsler , r. h. , conroy , c. 2013 , apj , 770 , 57 bell , e. f. , mcintosh , d. h. , katz , n. , & weinberg , m. d. 2003 , apjs , 149 , 289 bertin , e. & arnouts , s. 1996 , a&as , 117 , 393 blanton m. r. , lupton r. h. , schlegel d. j. , et al .",
    ", 2005 , apj , 631 , 208 blaizot , j. , wadadekar , y. , guiderdoni , b. , et al . , 2005 , mnras , 360 , 159b bouche , n . ,",
    "dekel , a. , genzel , r. et al .",
    "2010 , apj , 718 , 1001 bouwens , r. j. , illingworth , g. d. , oesch , p.a . , et al . , 2014 , arxiv:1403.4295v1 boylan - kolchin , m. , springel , v. , white , s.  d.  m. , jenkins , a. , & lemson , g.  2009 , , 398 , 1150 bruzual a.,g .",
    "& charlot , s. , 2003 , mnras 344 , 1000 charlot , s , & fall , s. m. , 2000 , apj , 539 , 718 conroy c. , wechsler r. h. , kravtsov a. v. , 2006 , apj , 647 , 201 conroy , c. , & wechsler , r. h. 2009 , apj , 696 , 620 devriendt , j . ,",
    "rimes , c. , pichon , c. , et al .",
    "2010 , mnras , 403 , l84 fall , s.m , efstathiou , g. , 1980 , mnras , 193,189 galametz , a. , grazian , a. , fontana , a. et al .",
    "2013 , apjs , 206 , 10 gonzalez , a.  h. , zaritsky , d. , & zabludoff , a.  i.  2007 , , 666 , 147 guo , q. , white , s. , li , c. , boylan - kolchin , m. 2010 , mnras , 404 , 1111 guo , q. , white , s. , angulo , r. e. , henriques , b. , et al .",
    "2013a , mnras , 413 , 101 guo , y. , et al .",
    "2013b , apjs , 207 , 24 guo , q. , & white , s.  2014 , , 437 , 3228 kauffmann , g. et al . , 2003 ,",
    "mnras , 341 , 33 krick , j.  e. , & bernstein , r.  a.  2007 , , 134 , 466 klypin , a. a. , trujillo - gomez , s. , & primack , j. , 2011 , apj , 740 , 102 komatsu , e. , smith , k. m. , dunkley , j. et al .",
    ", 2011 , apjs , 192 , 18k kravtsov , a. v. , 2013 , apjl , 764 , l31 lemson , g. , springel , v. , 2006 , in asp conf .",
    "351 , astronomical data analysis software and systems xv , ed .",
    "c. gabriel , c. arviset , d. ponz & e. solano ( san francisco , ca : asp ) , 212 li c. , white s. d. m. , 2009 , mnras , 398 , 2177 lotz , j. , jonsson , p. , cox , t. j. , & primack , j. r. 2008 , mnras , 391 , 1137l madau , p. 1995 , apj , 441 , 18 madau , p. , & dickinson , m. 2014 , , 52 , 415 mihos , j.  c. , harding , p. , feldmeier , j. , & morrison , h.  2005 , , 631 , l41 montes , m. , & trujillo , i.  2014 , , 794 , 137 moster , b. p. , et al , 2010 , apj , 710 , 903 moster , b. p. , naab , t. , & white , s. d. m. 2013 , mnras , 428 , 3121 mozena , m. w. , 2013 , phd thesis univ .",
    "california , santa cruz , ca overzier , r. , lemson , g. , angulo , r. e. , et al .",
    "2013 , mnras , 428 , 778 perona , p. & malik , j. 1990 , ieee transactions on pattern analysis and machine intelligence , 12(7):629 - 639 petrosian , v. 1976 , apj , 209 , l1 presotto , v. , girardi , m. , nonino , m. , et al .",
    "2014 , , 565 , aa126 reddick , r. , et al .",
    "2013 , apj , 771 , 30 schmidt , m. 1968 , apj , 151 , 393 spergel , d.  n. , verde , l. , peiris , h.  v. , et al .",
    "2003 , , 148 , 175 springel , v. , white , s. d. m. , jenkins , a. et al .",
    "2005 , nature , 435 , 629 stoughton , c. , lupton , r.  h. , bernardi , m. , et al . , 2002 , aj , 123 , 485 shen , s. , mo , h. j. , white , s. d. m. , et al .",
    "2003 , mnras , 343 , 978 strauss , m.  a. , weinberg , d.  h. , lupton , r.  h. , et al .",
    "2002 , , 124 , 1810 szalay , a. s. , church , k , meneveau , c. , terzis , a. , zeger , s. , 2012 , mri : the development of data - scope - a multi - petabyte generic data analysis environment for science , available at wiki.pha.jhu.edu/escience_wiki/images/7/7f/datascope.pdf taghizadeh - popp , m. , heinis , s. , szalay , a. s. , 2012 , apj , 755 143 vale a. , ostriker j. p. , 2004 ,",
    "mnras , 353 , 189 yip , c .- w .",
    "2010 , , 139 , 342 york , d. g. , adelman , j. , anderson , j. e. , jr . , et al . ,",
    "2000 , apj , 120 , 1579 zibetti , s. , white , s.  d.  m. , schneider , d.  p. , & brinkmann , j.  2005 , , 358 , 949"
  ],
  "abstract_text": [
    "<S> we simulate deep images from the _ hubble space telescope _ ( _ hst _ ) using semi - empirical models of galaxy formation with only a few basic assumptions and parameters . </S>",
    "<S> we project our simulations all the way to the observational domain , adding cosmological and instrumental effects to the images , and analyze them in the same way as real _ hst _ images ( `` forward modeling '' ) . </S>",
    "<S> this is a powerful tool for testing and comparing galaxy evolution models , since it allows us to make unbiased comparisons between the predicted and observed distributions of galaxy properties , while automatically taking into account all relevant selection effects .    </S>",
    "<S> our semi - empirical models populate each dark matter halo with a galaxy of determined stellar mass and scale radius . </S>",
    "<S> we compute the luminosity and spectrum of each simulated galaxy from its evolving stellar mass using stellar population synthesis models . </S>",
    "<S> we calculate the intrinsic scatter in the stellar mass - halo mass relation that naturally results from enforcing a monotonically increasing stellar mass along the merger history of each halo . </S>",
    "<S> the simulated galaxy images are drawn from cutouts of real galaxies from the sloan digital sky survey , with sizes and fluxes rescaled to match those of the model galaxies .    </S>",
    "<S> the distributions of galaxy luminosities , sizes , and surface brightnesses depend on the adjustable parameters in the models , and they agree well with observations for reasonable values of those parameters . measured galaxy magnitudes and sizes have significant magnitude - dependent biases , with both being underestimated near the magnitude detection limit . </S>",
    "<S> the fraction of galaxies detected and fraction of light detected also depend sensitively on the details of the model . </S>"
  ]
}