{
  "article_text": [
    "the age , chemical and kinematic distributions of galactic stellar populations provide powerful constraints on models of the formation and evolution of the milky way .",
    "the galactic globular clusters ( ggc ) constitute an especially useful case because the stars within individual clusters are coeval and spatially distinct . but",
    "uncertainties in the determination of distances to ggcs , along with uncertainties in the determination of their physical characteristics such as age or metallicity can result when the reddenig produced by interstellar dust is not properly taken into account @xcite . in this context ,",
    "differential reddening across the field of the cluster has proven to be difficult to map , and the properties of ggcs that suffer high and patchy extinction , especially those in the direction of the inner galaxy , have not been accurately measured @xcite .",
    "several authors have used different methods to try to map differential extinction in ggcs before : @xcite have used colors of variable rrlyrae stars to create the reddening maps ; @xcite and @xcite have used photometric studies of the stars in the horizontal branch ( hb ) ; @xcite and @xcite have used photometric studies of main sequence ( ms ) , subgiant branch ( sgb ) , and red giant branch ( rgb ) stars .    in this paper",
    "we describe a new dereddening technique , based on this last approach , but with the improvement of calculating the extinction not on a predetermined grid but on a star by star basis . in section 2",
    "we extensively explain this dereddening method and in section 3 we apply it to an example cluster , m62 . in the next papers of this series we plan to apply this dereddening method to a sample of clusters in the direction of the inner galaxy that in principle can be affected by this effect , and analyze the obtained results . in paper",
    "ii we will present a new photometric database consisting of a sample of 25 inner ggcs observed using the magellan 6.5 m telescope and the _ hubble space telescope _",
    "( _ hst _ ) , describe the processes we follow to obtain an accurate astrometric and photometric calibration of the stars in these clusters , and , after applying the dereddening technique , give the extinction maps along the field of the clusters in the sample , along with new cleaner , differentially dereddened color - magnitude diagrams ( cmd ) of these ggcs . in paper iii we will provide an analysis of the stellar populations of these clusters based on their dereddened cmds . finally , in paper iv",
    ", we will characterize the interstellar medium along the low - latitude lines of sight were the clusters lie , based on the properties of the extinction maps we derived .",
    "our dereddening technique is composed of five iterative steps ( see figure [ figflowchart ] ) :    * we assign a probability to the stars in our observed regions to belong to the cluster or to the galactic field depending on their positions in the sky and in the cmd ( see section [ sectprob ] ) .",
    "* we build a ridgeline for the stellar population of the observed cluster .",
    "the ridgeline represents the evolutionary path that a given star is going to follow in the cmd ( see section [ sectridge ] ) . *",
    "we assign an individual extinction value to every star , based on its displacement from the ridgeline along the reddening vector ( see section [ sectext ] ) . *",
    "we smooth the different individual color excesses over the observed field to generate an extinction map ( see section [ sectmap ] ) . *",
    "we apply the extinction values from the map to the stars in our observations to construct a dereddened cmd ( see section [ sectcmd ] ) .",
    "we repeat these steps iteratively .",
    "every iteration the ridgeline is more accurately defined , and therefore the extinction map and the dereddened cmd are also more precise .",
    "we end up the process when there is a convergence in the calculated ridgeline .",
    "this technique is based on work by @xcite and @xcite , and pioneered by @xcite , but unlike them , we do not divide the field in a grid of well established subregions a priori , but use a non - parametric approximation to smooth the information about the reddening in the field provided by every star , without such hard edges .",
    "the success of this analysis depends critically on the assumption that the stellar populations are uniform within individual gcs .",
    "recent studies tend to suggest that this is not strictly true , especially in the most massive ggcs and ggcs with an extreme blue horizontal branch ( ebhb ) @xcite .",
    "in the cases discovered , it is conjectured that the spread in helium content between stars in the cluster is important , but the spread in age and metallicity seems to be small @xcite , making the spread of the stars in the sgb and upper rgb regions of the cmd also small .",
    "since most of the information in our method comes from stars in these regions of the cmds , our technique should not be significantly affected .",
    "what is more , in our method variations in the reddening must be spatially related , which should not be the case if there are multiple helium enriched populations within the cluster .",
    "because of these reasons and since our sample only includes a few massive and ebhb clusters , we expect the differential populations effects to be comparatively minor and not significantly affect our dereddening approach .",
    "also it is important to realize that our dereddening method does not establish the absolute extinction toward a target cluster , so to estimate the absolute extinction in each case we need to use other methods , e.g. , comparison of our differentially dereddened cmds with isochrone models , or use of reddening estimates from rr lyr stars in our fields .      from our photometric studies we can assign probabilities to the stars in our observations to belong to the clusters , based on @xmath0 , their position in the sky with respect to the center of the cluster , and also on ( @xmath1 ) , their color and magnitude position on the cmd .",
    "these probabilities will be used in the next steps of our technique to give higher weight to the information provided by stars with high probabilities of being cluster members .    before going any further ,",
    "it is convenient to explain the notation that we are going to use , and to remember the basic rules of probability calculation .",
    "the marginal or unconditional probability of an event a happening is expressed @xmath2 .",
    "the joint probability of an event a and an event b happening at the same time is expressed @xmath3 .",
    "finally , the conditional probability of an event a happening given the occurrence of some other event b is expressed @xmath4 , and can be written as @xmath5 or , using bayes theorem , as @xmath6 also , notice that in many parts of our analysis it is going to be more convenient to use probability density functions , @xmath7 , to express the probability .",
    "these functions describe the relative likelihood for a random variable x to occur at a given point in the sampled space @xmath8 and satisfy @xmath9 @xmath10 @xmath11 whenever needed in this work , the probability density functions are calculated non - parametrically using _ locfit_. _",
    "@xcite is a local likelihood estimation software implemented in the r statistical programming language ( see appendix ) .",
    "_ locfit _ does not constrain the probability density functions globally , i.e. , it is non - parametric , but assumes that locally , in a local window around a certain point in the sample space , the functions can be well approximated by a polynomial . hence the main inputs that _",
    "locfit _ requires are the positions of the observed elements in the sample space , and a parameter to define the local window where the function is approximated parametrically , i.e. , a smoothing factor given by the maximum of two elements : a bandwidth generated by a nearest neighbor fraction , and a constant bandwidth .",
    "now , if we suppose the variable @xmath12 indicates membership to the cluster ( @xmath13 indicates observation of a member , and @xmath14 indicates observation of a non - member ) , in the next paragraphs we calculate @xmath15 , the conditional probability of the stars being members of the cluster , given their position in the sky and in the cmd . actually , it is more convenient for us to calculate first @xmath16 and @xmath17 , the conditional probabilities of the stars to belong to the cluster given _ just _ their position in the sky , and _ just _ their position in the cmd , and only after attempt to calculate @xmath15 .    the conditional probability of the stars being members of the cluster , given _",
    "just _ their position in the sky as a function of the distance to the center of the cluster , @xmath16 , can be written , using bayes theorem , as @xmath18 for any given cluster , both @xmath19 and @xmath20 are unknown .",
    "but since @xmath20 is the ratio of the observed cluster stars to the total observed stars , we can rewrite @xmath21 as @xmath22 where @xmath23 is the number of observed member stars as a function of the distance to the cluster center , and @xmath24 is the total number of observed stars as a function of the distance to the cluster center . we still do not know @xmath23 , but if we divide both numerator and denominator in @xmath25 by @xmath26 , the area coverage at a given @xmath0 of the field of view ( fov ) in our observation of the cluster , we can rewrite @xmath25 as @xmath27 where @xmath28 is the surface density of observed member stars as a function of the distance to the cluster center , and @xmath29 is the total surface density of observed stars as a function of the distance to the cluster center .",
    "now , if we assume an empirical king profile @xcite for the cluster , we can write the surface density of member stars as @xmath30^{1/2}}-\\frac{1}{[1+(r_t / r_c)^2]^{1/2}}\\right)^2 & \\mbox{if } & r \\leq r_t \\\\        0 & \\mbox{if } & r > r_t \\end{array } \\right.\\ ] ] where @xmath31 and @xmath32 are the core radius and the tidal radius of the cluster .",
    "if we make another assumption and consider a constant surface density of stars for the non - member population , which is reasonable due to the small size of our field , then @xmath33 and we have the following functional form for the total surface density distribution of stars observed in our fov @xmath34 and , according to @xmath35 , we can write the conditional probability of the stars being members of the cluster , given their position in the sky , as @xmath36 or , alternatively , @xmath37 therefore to calculate @xmath16 we need to find the coefficients @xmath38 and @xmath39 , since @xmath40 can be obtained taking the values for @xmath31 and @xmath32 for every cluster in our sample provided in the harris catalog @xcite . these two remaining coefficients , @xmath38 and @xmath39 , can be easily found by a least squares fit of @xmath40 to the observed surface density of stars @xmath29 ( see @xmath41 , figure [ figprobdis ] , and table [ tabking ] ) . to find the observed @xmath29 , we need to first calculate the number of stars @xmath24 , and then divide it by the area coverage @xmath26 .",
    "as we mentioned when passing from @xmath21 to @xmath25 , the number of stars @xmath24 is just the probability density @xmath42 of stars in our observation , multiplied by the total number of observed stars .",
    "we calculated the probability density @xmath42 of stars by feeding _ locfit _ with the radial positions of the stars and a smoothing factor with a constant bandwidth of 0.25 arcmin .",
    "the surface coverage @xmath26 in our observation is not trivial to find , since our fov is a square not centered in the cluster center . in order to quickly calculate this area",
    ", we create a grid of points equally spaced over our fov , calculate the probability density @xmath42 of points , and then multiply by the area of the fov .",
    "we calculated the probability density @xmath42 of points by feeding _ locfit _ with the radial positions of the points in the grid and a smoothing factor with a constant bandwidth of 0.25 arcmin .",
    "the conditional probability of the stars being members of the cluster , given _",
    "just _ their position in the color magnitude diagram , @xmath17 , can be written , using bayes theorem , as @xmath43 for any given cluster , we do not know the true distribution in magnitude and color in our observations of genuine gc members , but we can model the distribution of the field , non - member stars .",
    "we use the model of the galaxy described in @xcite , from now on referred as the besanon model , to obtain @xmath44 .",
    "we can now rewrite @xmath45 as @xmath46 where @xmath44 is obtained feeding _ locfit _ with the position in the cmd of the galactic field stars provided by the besanon model and a smoothing factor with a nearest neighbor ratio of 0.01 , @xmath47 is obtained feeding _ locfit _ with the position in the cmd of the stars in our observations and a smoothing factor with a nearest neighbor ratio of 0.01 , and",
    "@xmath48 is just the ratio of the total number of modeled non - member stars for an area equal to the fov of the observation , to the total number of observed stars , which include field and cluster stars . to take care of the different variation ranges in color and in magnitude for the stars in the cmd a scale ( see appendix ) of 1 in color to 5 in magnitude",
    "is also provided to _",
    "locfit _ as an input parameter to calculate @xmath44 and @xmath47 . in figure [ figprobdcm ]",
    "we can see the different @xmath17 for the stars in m62 , one of the clusters in our sample .",
    "similar methods to calculate @xmath17 have been employed by @xcite based on calculations by @xcite and @xcite , and also by @xcite based on calculations by @xcite and @xcite .",
    "in contrast to these other studies we do not eliminate stars from our analysis based on these probabilities , but downweight them . also , as we show at the end of this section , we do not just use @xmath17 , but @xmath15 in our following analysis .",
    "given the importance of the besanon model ( and the cmds it provides ) in analyzing the galactic field component of our observations and calculating @xmath49 , we describe here in more detail the input parameters that we use in the web interface of the besanon group to model the non - member stellar populations in the vicinity of the sampled clusters .    * *",
    "field of view .",
    "* we use the small field option from the web interface , in which the modeled stars are all supposed to be at the same coordinates ( see table [ tabbesancon ] ) , implicitly assuming that the field star density gradient across the fov is negligible .",
    "the same assumption was made in the calculation of @xmath50 ( see @xmath51 ) . to obtain higher statistical significance in the models",
    ", we can increase the selection area to obtain a larger number of stars in the model .",
    "@xmath44 is independent of the area and the number of stars used , since it is normalized ( see @xmath52 ) . in practice , we set this parameter to select @xmath53 stars ( see table [ tabbesancon ] ) .",
    "we have to notice though , that when calculating @xmath48 in @xmath54 we need to normalize the number of stars in the model to the fov .",
    "* * extinction law .",
    "* we apply _ locfit _ to map @xmath47 as a function of @xmath39 and @xmath55 using the cmds from our observations . from the modeled stars",
    ", we can also use _ locfit _ to map @xmath44 as a function of @xmath39 and @xmath55 , realizing that this map changes depending on what extinction @xmath56 we assumed for our modeled data .",
    "so if we define @xmath57 as @xmath58\\ ] ] we need to realize that this function depends also on the extinction assumed for the modeled cmds , i.e. , @xmath59 . for the fields studied , we choose the modeled stars to simulate no interstellar extinction in the beginning",
    ". then we move the density maps of the models along the reddening vector in increments of extinction @xmath60 , calculating @xmath57 for every increment .",
    "the value of @xmath56 where @xmath57 is a maximum is the value we choose for the absolute extinction of our observation .",
    "this @xmath56 is generally equal or within a few hundredths of a magnitude to the one provided in @xcite .",
    "the extinction is then simulated in the model as a cloud with an extinction equal to this @xmath56 at distance of 0 pc ( see table [ tabbesancon ] ) . * * characteristics of the stars used in the model . *",
    "we allow all ages , galactic components , and spectral types provided by the besanon model .",
    "we provide a limit only in the intervals of magnitudes , equal to the ones of our observations ( table [ tabbesancon ] ) .",
    "we also model our observational errors @xmath61 with an exponential function of the apparent magnitude _",
    "m _ in each band : @xmath62",
    "so the models will take the photometric error into account providing a more realistic approximation ( see table [ tabbesancon ] ) .",
    "certain problems arise in this procedure of calculating the conditional probabilities @xmath16 and @xmath17 , including :    * we have to take into account the completeness factor of our photometric observations . in general",
    ", completeness decreases with magnitude somewhat smoothly at the faint end , but suddenly at the saturation limit .",
    "because of this , and since we are trying to calculate the probabilities comparing our observations with models ( king profile and besanon model ) we need to find where the completeness factor starts to decrease at the faint end . usually this is done with artificial - star tests , injecting stars in the cmd and analyzing the amount and magnitudes of the ones recovered @xcite .",
    "but our large sample and large cluster star density gradients within individual fields make artificial star tests highly inefficient , so we explore another method that is well - suited to our specific fields , and also much more efficient to implement . from the besanon model",
    "we can calculate the number of non - member stars per area in the field that we have in a given magnitude range , and from our data we can also find the number of non - member stars per area in the field in a given magnitude range just by fitting @xmath63 in that magnitude range .",
    "so we iteratively calculate both numbers making the magnitude range smaller taking away stars in the 0.1 mag fainter end every time we do the calculation , repeating the process until we are able to get the cumulative luminosity functions ( lf ) for the seven fainter magnitudes for the non - member stars from every one of our pointings .",
    "then we can compare the modeled and observed lfs to see where the functions deviate one from the other .",
    "but this approximation proves to be not very accurate , especially in cases in which the number of non - member stars in the field is small .",
    "instead we explore yet another approximation .",
    "we notice that the lf in the besanon model is always a concave function , while the observed lf of the non - member stars in the field becomes a convex function at the faint end .",
    "we can then identify the limit where the completeness factor starts to decrease as the inflection point where the observational cumulative lf changes from concave to convex .",
    "the inflection point is the point where the derivative of the lf has a extreme , a minimum in our cases . and the derivative is easily found using _ locfit _ to calculate non - parametrically the lf and its derivative ( see appendix ) .",
    "the completeness limit is usually located in our observations at @xmath64 magnitudes from the faint end in @xmath65 ( see table [ tabclimit ] ) . in the next steps of our dereddening method",
    "we only use stars brighter than this limit .",
    "* the completeness factor also depends on the distance to the center of the cluster , strongly so for the more crowded cases .",
    "close to the cluster center we are not only missing stars at the faint end of the magnitude distribution , but at all magnitudes , since the lower completeness factor in this region is mostly caused by masking saturated regions by dophot @xcite , the program used to do the photometric analysis of the images . from the calculation of the @xmath16 , we can see that this reduced completeness factor reveals itself as a deviation from the model fit shown in @xmath66 at distances close to the center of the cluster ( see figure [ figprobdis ] ) .",
    "if we assume that we are missing an equal percentage of stars from the cluster and from the field , we can calculate its effect as the ratio between the observed and modeled @xmath29 . in the cmd",
    ", this lower completeness factor can lead to a miscalculation of @xmath17 if the fov is small .",
    "however , since the area of the regions whose extinction we are able to map are much bigger than the areas where the reduced completeness factor is an issue , the comparison of our observations with the besanon model is not significantly affected .",
    "the only appreciable consequence is that the calculated @xmath48 is a little higher than the actual @xmath48 . but",
    "this high value for @xmath48 can be corrected if when we calculate the number of stars , we take into account the deviation of the observation from the model fit as a function of the distance to the center of the cluster , as we mentioned before .",
    "* @xmath16 is obtained using the values for the core and tidal radii provided in the harris catalog @xcite , for every cluster in our sample .",
    "notice that these values are not all of equal accuracy .",
    "small variations in the initially adopted @xmath31 and @xmath32 could produce small changes in the individual @xmath16 values , but they will not alter the general trend ( stars closer to the center of the cluster have higher @xmath67 than stars located further away ) , and therefore they will not significantly affect the result of our dereddening technique .",
    "* @xmath17 is obtained comparing a real observation with a model , where photometric errors are incorporated by mimicking the real photometric errors by the exponential function described above . in general",
    ", we observe that stars from the models tend to be a little more concentrated along the different field evolutionary sequences in the cmds than stars from real observations .",
    "therefore , for a given magnitude , @xmath49 peaks higher and decreases faster in the model than in the real observation , producing two main errors in our calculations of @xmath17 .",
    "the first error is that we mistakenly assign a probability of being in the field which is too low , and therefore a probability of being cluster members which is too high , to stars in the regions where the observed color is an extreme for a given magnitude ( see figure [ figprobdcm ] ) .",
    "but since there are not many stars in these regions and they usually have higher photometric errors in color than our functions describe , they are downweighted or removed from our calculations later on ( see section [ sectmap ] ) .",
    "more important is the second error , the case were @xmath49 peaks higher in the model than in reality , making the probability of the star to be a non - member in the field too high , and @xmath17 too low , lower than 0 . in order to avoid these non - physical cases , and even too extreme cases that can give too low a weight value to the information coming from those stars",
    ", we put the hard limit @xmath68 ( see figure [ figprobdcm ] ) .",
    "now we are in conditions to calculate @xmath15 , the conditional probability of the stars being members of the cluster given both their position in the sky and in the cmd . according to bayes theorem , @xmath69 and",
    "since the positions in the sky and in the cmd for non - member stars are independent , the variables are not independent , i.e. , the position in the cmd for a star in our observation is related to its spatial position in the sky , due to the mixture of cluster and field populations . hence @xmath70 . ]",
    "@xmath71 and using bayes theorem again ( see @xmath21 ) we can write @xmath72 @xmath73 , @xmath42 , and @xmath44 , the three elements in the numerator have been calculated previously , so now we just need to find the denominator @xmath74 , the probability density of stars in our observation as a function of both position in the sky and in the cmd . to calculate it we feed",
    "_ locfit _ with the position in the sky and in the cmd of the stars in our observations and a smoothing factor with a nearest neighbor ratio of 0.1 .",
    "since the units of the three physical magnitudes @xmath75 are different , we need to feed _ locfit _ with a scale factor ( see appendix ) to calculate the distance between neighbors in the @xmath75 space .",
    "experimentally we found that a scale of 1 magnitude in color to 5 magnitudes in brightness and 10 arcmin in distance to the the gc center provides good results , and it is the one we used as an input parameter of _ locfit _ to calculate @xmath74 .",
    "the results of the @xmath15 calculation are shown in figure [ figprob ] .",
    "we can observe that the same problems that were previously mentioned affecting the calculation of @xmath16 and @xmath17 are present here .",
    "but for most of the stars observed , this formalism allows a more precise way to discriminate between field and cluster stars than looking to just @xmath16 or just @xmath17 .",
    "stars that are still alive in globular clusters evolve along the cmd following a well determined path .",
    "they spend most of their lives in the ms burning hydrogen in their core .",
    "they leave the ms at the turn - off point ( to ) growing in size and burning hydrogen in a shell as they move across the sgb and the rgb .",
    "then they move to the hb where they burn helium in the core and hydrogen in a shell .",
    "they leave the hb moving across the asymptotic giant branch ( agb ) burning helium and hydrogen in a shell , then moving rapidly across the post agb phases to finish their lives as white dwarfs ( wd ) .",
    "the path of this standard evolutionary sequence in the cmd of a globular cluster is shown in figure [ figridge ] .",
    "we try to model the first stages ( ms , sgb and rgb ) of the evolutionary path followed by the stars in a gc building the ridgeline for the cmds of the ggcs , using _",
    "locfit _ to construct a univariate non - parametric regression of the color of the stars as a function of the magnitude .",
    "this process is composed of three iterations .    in the first iteration",
    ", we carry out a non - parametric regression in the whole cmd to obtain a first estimation of the cluster ridgeline as a function of magnitude .",
    "we feed _ locfit _ with the magnitudes and colors of the stars and a smoothing parameter with a constant bandwidth of 0.2 magnitudes .",
    "also , we give _ locfit _ preliminary weights for the stars @xmath76 where @xmath15 is the membership probability calculated in the previous subsection and @xmath77 is a photometric weight equal to the inverse of the square of the poisson error of the photometric magnitude @xmath78 .",
    "these preliminary weights @xmath79 are calculated to favor the magnitude and color information provided by stars with more accurate photometry and higher probability of being cluster members according to both their position in the sky and in the cmd .",
    "the smoothing parameter values used have proven experimentally to be adequate for describing the ms and part of the rgb , but the regression fails to describe the sgb , and the stars in the hb create problems when trying to model the whole rgb .",
    "still , they produce a reasonable first approximation ( see upper left plot in figure [ figridge ] ) and let us identify the to point , which we define as the bluest point of our ridgeline .",
    "we should note here that the ms is defined not to the faintest magnitude limit of the data , but to the completeness limit defined in section [ sectprob ] .    in the second iteration",
    "we try to get a less noisy whole ridgeline , along with a better defined rgb ridgeline . as a first step we divide the initial ridgeline in three regions : the ms region , where the ridgeline magnitudes are @xmath80 , the sgb region , where the ridgeline magnitudes are @xmath81 , and the rgb region , where the ridgeline magnitudes are @xmath82 . to smooth out the approximation for the ridgeline",
    ", we take the points from the ridgeline from the first iteration for every region and smooth them using _ locfit _ with a nearest neighbor ratio of 0.7 ( _ locfit _ default ) , no preliminary weights or constant bandwidth requirements .",
    "the rgb ridgeline is still not well defined , because of the effects of stars in the hb . to calculate a better ridgeline for the rgb getting rid of the effects of the blue part of the hb , we take only stars in the magnitude range @xmath82 and in the color range @xmath83 .",
    "we feed _ locfit _ with their magnitudes and colors , and a constant bandwidth of 0.2 mag and a nearest neighbor ratio of 0.1 to calculate the smoothing parameter .",
    "we use the nearest neighbor ratio because if not , the upper part of the rgb , usually scarcely populated , can become very noisy .",
    "still , the red part of the hb , whenever present , is going to deviate the calculated rgb ridgeline . to eliminate its effect we have to locate first where the hb is .",
    "we look for a change in the sign of the slope of the rgb .",
    "the bluest point brighter than the point where the slope sign change is , shows where the hb is . and the difference between these two points provides information about the thickness of the hb , @xmath84 .",
    "once the hb is located , we repeat the analysis done before for the rgb , with the same smoothing parameter and weights , but now omitting points in the interval @xmath85 . that way we have a better ridgeline for the upper and lower regions of the rgb . to get a ridgeline for the whole rgb ,",
    "smoothing any noisy part , we follow a similar process to what we do in the beginning of this second iteration .",
    "we take the points in the description of the upper and lower rgb ridgeline , and use _ locfit _ again , but now with a nearest neighbor ratio of 0.7 , no preliminary weights or constant bandwidth requirements .",
    "the ridgeline is much better now , but still we are a little off in the description of the sgb ( see upper right plot in figure [ figridge ] ) .    in the final iteration",
    ", we try to calculate a better ridgeline for the sgb . in order to do that we follow @xcite , where they use rotated histograms to recalculate the ridgeline for the gc in their sample , using only stars perpendicular to the ridgeline in the calculation .",
    "although our approximation is similar , the implementation is a little different .",
    "we calculate the slope of the curve at every point of the previously calculated ridgeline using _ locfit _ to get the derivative of the slope at a given point of the ridgeline .",
    "once we have this , we rotate the coordinate system of every star at every magnitude with the angle @xmath86 of the slope of the ridgeline at that magnitude , and centered at the ridgeline .",
    "once this is done , we can get a ridgeline in the new coordinate system using _ locfit _ again .",
    "this new ridgeline should be a straight line along the y coordinate with a value of 0 in the x coordinate .",
    "any deviation from that means that the ridgeline in the original color - magnitude coordinate system requires a more accurate calculation .",
    "notice that in order for the new coordinate system to consistently show these deviations , we need the range of both coordinates to be similar in the old coordinate system .",
    "this is not the case for the range of colors and magnitudes presented in a cmd . to try to get them to a similar scale",
    "we multiply the color by a factor of 5 before doing the rotation . in the calculation of the ridgeline in the new coordinate system the preliminary weights and smoothing factor used for _ locfit",
    "_ are the same as in the first iteration .",
    "we observe that the x coordinate of the ridgeline in the new reference system does not deviate significantly from 0 in the region of the ms stars , but does so in the sgb and upper rgb region . in the rgb region",
    "it is expected due to the scarcity of the population there .",
    "we took care of that in the previous iteration , so we concentrate our attention in the sgb region .",
    "we derotate the ridgeline in that region ( the part where the original magnitudes are in the range @xmath87 ) to get their coordinates in the color - magnitude coordinate system , and after smoothing out any noise using _ locfit _ with a nearest neighbor ratio of 0.7 , we put together the different parts of the ridgeline ( see lower left plot in figure [ figridge ] ) .",
    "the new ridgeline seems to follow accurately the different evolutionary sequences present in the gcs , and serves as the basis of our subsequent analysis .    in section [ sectmap ]",
    "we discuss how we can use stars in the hb to test the accuracy of our method . to carry this test , we need to model a ridgeline for this region too . the process to find",
    "the ridgeline here is a little more interactive than for the other regions of the cmd .",
    "first , we have to decide by visual inspection of the cmd if we are dealing with a cluster that has only blue , only red or both sections of the hb .",
    "if the cluster shows only a blue hb , we carry out a non - parametric regression on the stars bluer than the to to obtain an estimation of the cluster hb ridgeline as a function of magnitude .",
    "we feed _ locfit _ with the magnitudes and colors of the hb , and a constant bandwidth of 0.2 mag and a nearest neighbor ratio of 0.1 to calculate the smoothing parameter .",
    "if only a red hb is present instead , the non - parametric regression is performed on stars in the interval @xmath85 to obtain an estimation of the cluster hb ridgeline as a function of color .",
    "the smoothing parameter is calculated by _ locfit _ with the same parameters as for the blue hb . finally ,",
    "if the hb shows red and blue sections , we calculate both independently following the methods previously described , and then we smooth the result as a function of color , feeding _ locfit _ with the magnitudes and colors of the points in the description of the blue and red hb ridgeline , and a nearest neighbor ratio of 0.25 , no preliminary weights or constant bandwidth requirements ( see lower right plot in figure [ figridge ] ) .      to calculate an extinction for every star we move the stars along the reddening vector until they intersect the ridgeline at an astrophysically reasonable location ( see figure [ figredvector ] ) .",
    "the reddening vectors are described by the equations @xmath88 and @xmath89 as given in @xcite , which are evaluated using the @xmath90 extinction laws of @xcite and @xcite .",
    "the hb ridgeline , and therefore also stars in the range @xmath91 , are not used in this calculation , since we want to use them as an independent test of the accuracy of our method ( see section [ sectmap ] ) .",
    "we do not use stars dimmer than the completeness limit defined in section [ sectprob ] either .",
    "these stars and stars that do not intersect with the ridgeline are given a weight 0 in the calculation of the extinction map described in next section .",
    "to calculate the error of these shifts we follow the analysis in @xcite :    * we created an error ellipse for every star defined by the poisson error in its color , @xmath92 , and magnitude , @xmath93 . *",
    "since the color and magnitude errors are correlated , the error ellipse is tilted .",
    "the tilt angle and the length of the semi - major and semi - minor axes of the error ellipse are functions of the error in color and in magnitude .",
    "@xmath94 @xmath95^{1/2}\\ ] ] @xmath96^{1/2}\\ ] ] where @xmath97 is the tilt angle of the error ellipse , @xmath98 and @xmath99 are the semi - major and semi - minor axis of the tilted ellipse , and @xmath100 is the covariance of the color and magnitude .",
    "* for every star , we move the error ellipse along the reddening vector .",
    "the point of first contact ( pfc ) , i.e. , the point where the ellipse touches the ridgeline for the first time , and the point of last contact ( plc ) , where the ellipse touches the ridgeline for the last time , represent the one - sigma - deviation points ( see figure [ figredvector ] ) . * although these two contact points are not necessarily symmetric about the reddening value of the star , i.e. , the center of the error ellipse , we are going to define the error in the shift as : @xmath101      we now take all the color excesses for the individual stars and smooth them using _ locfit _ to build a bivariate non - parametric regression of the extinction as a function of the spatial coordinates right ascension and declination , up to a distance from the center of the cluster equal to where @xmath102 or the limit of our observations , whichever comes first ( see table [ tabclimit ] ) .",
    "this limit is adopted after preliminary application of our method to the clusters in our sample with looser restrictions , and not observing an improvement in the dereddened cmds ( see section [ sectcmd ] ) for stars located beyond these ranges .",
    "stars that were given zero weight in the previous subsections ( stars in the hb region , stars dimmer than the completeness limit , stars that do not intersect with the ridgeline after being moved along the reddening vector ) are not taken into account for the calculation of the map , although after the map is built a reddening correction is applied to all of them .",
    "preliminary weights are assigned in _ locfit _ to all stars as they were calculated in previous subsections , but now @xmath103 .",
    "the spatial smoothing kernel in this case has a constant bandwidth of @xmath104 or a nearest neighbor ratio of 0.03 , whichever is bigger .",
    "these values for the smoothing parameter are used after experimentally checking in a few of our clusters which kernel provides us with a tighter hb , in the sense of a smaller standard deviation of the stars from the ridgeline of this region ( see section [ sectridge ] ) , after generating the dereddened cmd ( see section [ sectcmd ] ) .",
    "this is an independent test to assess the quality of our dereddening method , since our technique does not use stars in the hb to calculate the extinction map .",
    "the tests gave similar results for a range of parameters .",
    "since the tests were not highly conclusive on choosing a particular set of parameters , the set used is an average of the best values obtained for the different clusters tested .    along with the extinction map ,",
    "an extinction precision map is also calculated .",
    "this is done assuming that the precision of the extinction map is a function of the spatial coordinates .",
    "hence , we can write @xmath105 where @xmath106 is the calculated extinction for the @xmath107-th star and @xmath108 is the value for the extinction provided by the regression function at the coordinates @xmath109 of the @xmath107-th star . therefore",
    ", regressing directly the square residuals @xmath110 provides us with an estimate @xmath111 of the variance , and its square root allows us to plot a map of the standard deviation @xmath112 as a function of the spatial coordinates .",
    "this precision map provides us with a tool to improve our extinction map .",
    "we iteratively repeat the whole process of the calculation of extinction maps , but every time using only stars that have extinctions that are no more than @xmath113 away from the value that our previous extinction map gives for those coordinates .",
    "preliminary weights and smoothing parameters are the same in every calculation .",
    "we repeat the process until it converges , i.e. , until the number of stars used in the calculation of the extinction maps changes by less than @xmath114 with respect to the previous iteration . this way for every cluster we are able to provide an extinction map ( see top plot of figure [ figextinc ] ) , a precision map for this extinction map ( see bottom plot of figure [ figextinc ] ) , and a resolution map with the bandwidth that we have use in a certain region to calculate the extinction map there ( see central plot of figure [ figextinc ] ) .",
    "all the observed stars are given a reddening correction from the extinction map and a dereddened cmd is constructed ( see figure [ figcmd ] ) .",
    "this dereddened photometry is the input on the next iteration to calculate the cluster membership probabilities , and to build a new improved ridgeline ( see figure [ figflowchart ] ) .",
    "notice though that the input on the calculation of the individual reddenings to generate the extinction maps is the original photometry in every iteration ( see figure [ figflowchart ] ) .",
    "we iteratively repeat this process until there is a convergence in the calculated ridgeline ( see figure [ figflowchart ] ) , which results in good convergence of the reddening values of the extinction map . for our dataset",
    ", convergence usually occurs after just two or three iterations .",
    "the method will be extensively applied to a sample of 25 globular clusters in following papers . here , as an example , we applied the method to one of those clusters , m62 .",
    "m 62 ( ngc 6266 ) is a moderately reddened , @xmath115 cluster , located only @xmath116 from the galactic center @xcite , with a patchy extinction @xcite .",
    "the observation , reduction and calibration processes will be explain in detail in paper ii .",
    "suffice it to say here that @xmath117 , @xmath65 , and @xmath118 data for this cluster where obtained with the imacs camera in the magellan 6.5 m telescope , and , in @xmath65 and @xmath118 for the inner part of the cluster with the wfpc2 camera on the hst .",
    "after applying fairly standard reduction and calibration processes to these data , we merged the databases from the two telescopes to obtain accurate astrometry ( @xmath119 dispersion ) and accurate photometry ( @xmath120 magnitude dispersion ) in b , v and i for the stars in a field of @xmath121 centered in the cluster . in figure [ figcmd ]",
    "we can see the resulting cmds of this cluster .",
    "the first step of our dereddening method is to calculate the probabilities @xmath15 for the observed stars to belong to the cluster . to do that",
    ", we use the probability densities of the stars as functions of distance to the center of the cluster and of color and magnitude , a king profile plus constant field model , and a besanon model for the field , as explained in section [ sectprob ] ( see figures [ figprobdis ] , [ figprobdcm ] , and [ figprob ] ) .",
    "the different parameters used to build the king and besanon models for this calculation are shown in tables [ tabking ] and [ tabbesancon ] .",
    "notice that we restrict our analysis to stars in the limits shown in table [ tabclimit ] , because of the reasons mentioned in the previous sections .",
    "once the probabilities to belong to the cluster have been calculated , we need to build the ridgeline .",
    "following the the three step recipe explained in section [ sectridge ] , we get the ridgelines in the two available colors ( see figure [ figridge ] ) . after that , we move the stars along the reddening vector until they intersect the ridgeline ( see figure [ figredvector ] ) and smooth the resulting individual color excesses , as explained in sections [ sectext ] and [ sectmap ] .",
    "we obtain the extinction map shown in figure [ figextinc ] . from this map ,",
    "we take the relative extinction that corresponds to every star observed .",
    "we then plot the cmd of the stars in our observation after having been corrected for the differential reddening and use it as the input for the next iteration .",
    "the process converges for both colors after 3 iterations and we generate the dereddened cmds that we can see in figure [ figcmd ] .",
    "we leave the detailed examination and analysis of the physical characteristics of the cluster to paper iii , but we mention here how much better the definition of the different parts of the cluster is .",
    "the width of the ms narrows by a factor of 2 after being dereddened ( see figure [ figgauss ] ) .",
    "this improvement will help us to obtain better constraints on the cluster age and distance when compared to theoretical isochrone models .",
    "the rgb is also narrowed by a factor of 2 ( see figure [ figgauss ] ) , which will help when trying to better constrain the metallicities .    as a reference",
    ", we compare the final reddening map obtained using our technique with maps and extinction values within the covered region available in the literature ( see figure [ figextincomp ] ) .",
    "we found a general agreement in the identification of regions of high and low extinction , although our map shows sharper features than the one presented by @xcite , perhaps the result of their mapping the interstellar extinction in the foreground and also in the background of the cluster ( upper plots in figure [ figextincomp ] ) , and smoother values than those by @xcite , result of our spatial smoothing of the extinction values ( lower plots in figure [ figextincomp ] ) .",
    "as we have already mentioned , the technique explained in the paper does not calculate the absolute extinction toward a target cluster . comparisons like the ones shown in figure [ figextincomp ] will allow to find the extinction of the adopted reddening zero point in our dereddening method .",
    "this work was supported by grants 0206081 from nsf and go10573.01-a from stsci .",
    "stsci is operated by aura under nasa contract nas5 - 26555 .",
    "support for j.a .",
    "was also provided by mideplan s programa inicativa cientfica milenio through grant p07 - 021-f , awarded to the milky way millennium nucleus .",
    "in our work we have extensively used non - parametric statistics to estimate probability density and regression functions directly , without reference to a specific form .",
    "this differs from other approaches in which probability density and regression functions are expressed in a parametric way , where the function used to describe them can be written as a mathematical formula which is fully described by a finite set of parameters that we have to find .    in our analysis",
    "we have used _ locfit _ , a local likelihood estimation software implemented in the r statistical programming language . _ locfit _ is extensively explained in @xcite , so here we just want to give a general idea of how it works and the main tuning parameters that we have chosen in our analysis .",
    "_ locfit _ does not constrain the functions globally , i.e. , it is non - parametric , but assumes that locally , around a certain point x , the function can be well approximated by a member of a simple class of parametric functions .",
    "_ locfit _ defines a local window around a point , weighting the observations according to their distance to that point @xmath122 and inside this local window , the function is approximated by a polynomial , using not the usual local least square criterion but a local log likelihood criterion .",
    "we have to choose the weighting function and the order of the polynomial .",
    "for both cases we take the default given by the program : a polynomial of order 2 with a tricube weight function @xmath123 .",
    "still we are left with one last argument to choose , the smoothing parameter that controls the bandwidth @xmath124 .",
    "this smoothing parameter is defined by the maximum of two elements : a bandwidth generated by a nearest neighbor fraction @xmath125 , and a constant bandwidth .",
    "the nearest neighbor bandwidth is computed in two steps , first computing the distances @xmath126 for all the data points and then choosing @xmath124 to be the _",
    "k_th smallest distance , where @xmath127 $ ] .",
    "also the likelihood criterion can be chosen , and we choose for the regression the family _ qrgauss _ , which is equivalent to a local robust least squares criterion where outliers are iteratively identified and downweighted , similar to the _ lowess _ method @xcite .",
    "a scale factor can be applied to the different variables in multivariate fitting , when variables are measured in non - comparable units , or when we want to give more importance to one of them like in the determination of the densities of stars in our cmd , where the range in color for the stars is smaller than the range in magnitudes .",
    "finally , a word is in order about the evaluation structures in _ locfit_. _",
    "locfit _ does not perform local regression directly in every point , but selects a set of evaluation points obtaining the fit there and interpolating later elsewhere .",
    "this is done for efficiency : it is much faster to evaluate the structure in a small number of points and then interpolate for the rest .",
    "but we should make sure that we do not lose information on the process . in order to achieve this , _ locfit _ uses , by default , a growing adaptive tree , which is the evaluation structure that we use in our analysis .",
    "a growing adaptive tree is a grid of points .",
    "one begins by bounding the data in a rectangular box and evaluating the fit at the vertices of the box .",
    "one then recursively splits the box into two pieces , then each subbox into two pieces and so on . for this kind of structure ,",
    "an edge is always split at the midpoint and the decision to split an edge is based solely on the bandwidths at the two ends of the edge , depending on the score @xmath128 where @xmath129 is the distance between the two vertices of an edge , and @xmath130 and @xmath131 are the bandwidths used at the vertices .",
    "any edge whose score exceeds a critical value c ( @xmath132 by default ) is split .",
    "bedin , l. r. , piotto , g. , anderson , j. , cassisi , s. , king , i. r. , momany , y. , & carraro , g. 2004 , 605 , l125 calamida , a. , et al .",
    "2005 , , 634 , 69 cardelli , j. a. , clayton , g. c. & mathis , j. s. 1989 , , 345 , 245 cleveland , w. s. 1979 , j. amer . statist .",
    ", 74 , 829 contreras , r. , catelan , m. , smith , h. a. , pritzl , b. j. , & borissova , j. 2005 , , 623 , l117 contreras , r. , catelan , m. , smith , h. a. , pritzl , b. j. , borissova , j. & kuehn , c. a. 2010 , , 140 , 1766 dantona , f. , & caloi , v. 2008 , , 390 , 693 grillmair , c. j. , freeman , k. c. , irwin , m. , & quinn , p. j. 1995 , , 109 , 2553 harris , w. e. 1996 , , 112 , 1487 heitsch , f. , & richtler , t. 1999 , , 347 , 455 hughes , j. , & wallerstein , g. 2000 , , 119 , 1225 hughes , j. , wallerstein , g. , covarrubias , r. , & hays , n. 2007 , , 134 , 229 kaluzny , j. , & krzeminski , w. 1993 , , 264 , 785 king , i. 1962 , , 67 , 471 law , d. r. , majewski , s. r. , skrutskie , m. f. , carpenter , j. m. , & ayub , h. f. 2003 , , 126 , 1871 loader , c. 1999 , local regression and likelihood , ( new york : springer ) marn - franch , a. , et al .",
    "2009 , , 694 , 1498 melbourne , j. & guhathakurta , p. 2004",
    ", , 128 , 271 mighell , k. j. , sarajedini , a. , & french , r. s. 1998 , , 116,2395 odenkirchen , m. , et al .",
    "2001 , , 548 , 165 odonnell , j. e. 1994 , , 422 , 1580 piersimoni , a. m. , bono , g. , & ripepi , v. 2002 , , 124 , 1528 piotto , g. , zoccali , m. , king , i. r. , djorgovski , s. g. , sosin , c. , dorman , b. , rich , r. m. & meylan , g. 1999 , , 117 , 264 piotto , g. , zoccali , m. , king , i. r. , djorgovski , s. g. , sosin , c. , rich , r. m. & meylan , g. 1999 , , 118 , 1727 piotto , g. , bedin , l. r. , anderson , j. , king , i. r. , cassisi , s. , milone , a. p. , villanova , s. , pietrinferni , a. , & renzini , a. 2007 , , 661 , l53 robin , a. c. , reyl , c. , derrire , s. , & picaud , s. 2003 , , 409 , 523 schechter , p. , mateo , m. , & saha , a. 1993 , , 105 , 1342 schlegel , d. , finkbeiner , d. , & davis , m. 1998 , , 500 , 525 valenti , e. , ferraro , f. r. , & origlia , l. 2007 , , 133 , 1287 von braun , k. & mateo , m. 2001 , 121 , 1522    cc core radius ( according to most updated harris catalog)&0.18 arcmin + tidal radius ( according to most updated harris catalog)&8.97 arcmin + @xmath38 constant from the king profile ( see @xmath41)&12264.7 stars arcmin@xmath133 + surface density of non - member field stars from the fit ( see @xmath41)&226.4 stars arcmin@xmath133 + surface density of non - member field stars according to besanon model&216.6 stars arcmin@xmath133 +    cc field&small field + & l=@xmath134 ; b=@xmath135 + & solid angle=0.190 square degree + diffuse extinction & 0.0 mag / kpc + discrete clouds & @xmath136=1.36 ; distance=0pc + intervals of magnitude & @xmath137 + & @xmath138 + & @xmath139 + photometric errors & error function : exponential + & band=@xmath117 ; a=0.006 , b=22.68 , c=0.866 + & band=@xmath65 ; a=0.005 , b=23.22 , c=0.899 + & band=@xmath118 ; a=0.009 , b=30.12 , c=1.238 +      @xmath65 magnitude where the completeness limit is reached&21.51 + @xmath140 between the completeness limit and the dimmest star in our ground observation&2.2 + distance where the ratio of gc stars to total number of stars drops to 0.1&6.20 arcmin +"
  ],
  "abstract_text": [
    "<S> a serious limitation in the study of many globular clusters  especially those located near the galactic center  has been the existence of large and differential extinction by foreground dust . in a series of papers we intend to map the differential extinction and </S>",
    "<S> remove its effects , using a new dereddening technique , in a sample of clusters in the direction of the inner galaxy , observed using the magellan 6.5 m telescope and the _ hubble space telescope_. these observations and their analysis will let us produce high quality color - magnitude diagrams of these poorly studied clusters that will allow us to determine these clusters relative ages , distances and chemistry and to address important questions about the formation and the evolution of the inner galaxy . </S>",
    "<S> we also intend to use the maps of the differential extinction to sample and characterize the interstellar medium along the numerous low latitude lines of sight where the clusters in our sample lie . in this first paper </S>",
    "<S> we describe in detail our dereddening method along with the powerful statistics tools that allow us to apply it , and we show the kind of results that we can expect , applying the method to m62 , one of the clusters in our sample . </S>",
    "<S> the width of the main sequence and lower red giant branch narrows by a factor of 2 after applying our dereddening technique , which will significantly help to constrain the age , distance , and metallicity of the cluster . </S>"
  ]
}