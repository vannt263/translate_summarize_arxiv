{
  "article_text": [
    "in this paper , we describe the pseudo - particle multipole method ( p@xmath0m@xmath0 , @xcite ) , a new method to express multipole expansion in fast multipole method(fmm , @xcite ) and treecode(@xcite ) .",
    "the basic idea of p@xmath0m@xmath0  is to use a small number of pseudo - particles to express the multipole expansion . in other words",
    ", this method approximates the potential field of physical particles by the field generated by a small number of pseudo - particles .",
    "the distribution of pseudo - particles is determined so that it correctly describes the coefficients of multipole expansion .",
    "p@xmath0m@xmath0  offers two advantages over standard fmm which uses the multipole expansion directly .",
    "one advantage is its simplicity .",
    "as will be seen , the translation formulae used in p@xmath0m@xmath0  are much simpler than their counterpart in standard fmm .",
    "although the calculation cost is roughly the same for the same level of the accuracy , the simplicity implies that performance tuning and parallelization are easier .",
    "another advantage is that p@xmath0m@xmath0can take full advantage of special - purpose computers(grape , @xcite ; @xcite ) .",
    "grape is a pipelined processor specialized to direct force calculation between particles .",
    "it offers the price - performance 100 - 1000 times better than that of general - purpose computers , for direct force calculation . though treecode has been used on grape(@xcite ; @xcite ; @xcite ) , it was difficult to go to high accuracy since only monopole can be calculated on grape .",
    "with p@xmath0m@xmath0  we can evaluate high - order terms using grape , since these terms are expressed by distribution of pseudo - particles .",
    "this paper is organized as follows . in section [ sec : treefmm ] we briefly describe the treecode and the fmm . in section",
    "[ sec : am ] we give the description of anderson s method ( @xcite ) , to which our method is closely related . in section [ sec : ppmm ] we describe the mathematics of p@xmath0m@xmath0 . in section",
    "[ sec : accppmm ] we present the result of numerical tests on the accuracy and the calculation cost for our implementation of treecode with p@xmath0m@xmath0 . in section [ sec : grape ] we discuss the implementation of treecode with p@xmath0m@xmath0  on grape . in section",
    "[ sec : ppmmam ] we compare p@xmath0m@xmath0  with anderson s method . in section [ sec : summary ]",
    "we summarize this paper .",
    "here we give brief description of treecode and fmm .",
    "the treecode is described in section [ sec : tree ] and the fmm is described in section [ sec : fmm ] .      in treecode ,",
    "the forces from a group of distant particles are approximated by multipole expansions .",
    "hierarchical tree structure is used for grouping of the particles .    here",
    "we summarize the calculation procedure following @xcite ; @xcite .",
    "first we construct an oct - tree structure by hierarchical subdivision of the space .",
    "the division procedure starts from the root node(root cell ) of the tree which corresponds to a cube covering the entire system .",
    "the procedure is repeated until all leaf cells contain only one or zero particles .    in the next step",
    "we calculate the multipole expansions for all non - leaf cells .",
    "the calculation begins from the parents of the leaf cells and continued to the root cells ascending the tree structure .",
    "for a cell whose children are all leaves , the multipole expansion at its center is directly calculated from the distribution of the particles(leaves ) in it .",
    "the expansion of a higher level cell is calculated from the expansions of its children . for each child cell ,",
    "the center of the expansion is shifted to the center of the parent(m2 m shift ) .",
    "all shifted expansions are then summed up at the center of the parent cell .",
    "note that in most of existing implementation of treecode only up to quadrupole term is retained , and the center of mass is used as the center of expansion .",
    "then we calculate the total force on each particle . starting from the root cell ,",
    "we recursively traverse the tree structure collecting the force from cells(@xcite ) .",
    "we examine whether the cell in question is well separated from the particle or not .",
    "if the cell is well separated , the multipole expansion of the cell is evaluated at the position of the particle and added to the total force on the particle . in the case of a leaf cell ,",
    "the force from the particle in it is used instead of the multipole expansion .",
    "if the cell is not well separated , we descend the tree to resolve the current cell into child cells , an then recursively examine each child in the same way . the condition that a cell is well separated is expressed as @xmath1 . here",
    "@xmath2 is the side length of the cell , @xmath3 is the distance between the cell and the particle , and @xmath4 is the opening angle that controls the accuracy .",
    "leaf cells are always considered to be well separated .",
    "the calculation cost of treecode is @xmath5 , since the particle sees larger cell as distance becomes larger .",
    "treecode is widely used in astrophysics , in particular where accuracy requirement is modest .",
    "most of existing implementations of treecode use only up to quadrupole moment and calculation cost rises quickly when high accuracy is required .",
    "the implementation detail is given in @xcite ; @xcite . for the implementation on distributed - memory parallel computers , see @xcite .",
    "figure [ fig : treefmm ] shows the conceptual difference between treecode and fmm . in treecode , the forces from a cell to different particles are evaluated independently . in fmm , on the other hand , to calculate forces from cell @xmath6 to particles in cell @xmath7 , we first calculate the spherical harmonics expansion(local expansion ) of the potential field at the center of cell @xmath7 and then evaluate that expansion at the position of particles in cell @xmath7 .",
    "fmm was first presented in @xcite for two dimensional case and was extended to three dimension in @xcite . the implementation detail for the three dimensional case",
    "is given in @xcite ; @xcite ; @xcite ; @xcite ; @xcite .    in the following we describe the non - adaptive version of fmm for three dimensional case .",
    "first we construct an oct - tree structure by hierarchical subdivision of the space .",
    "the division procedure starts from the root cell at refinement level @xmath8 , which covers the entire system .",
    "here we define the refinement level @xmath9 as the depth of the tree .",
    "we repeat the procedure until a given refinement level @xmath10 is reached .",
    "the level @xmath10 is chosen so that the average number of particles in one leaf cell roughly equals the prescribed number which is determined to optimize the calculation speed .    in the next step , we calculate the multipole expansions for all cells . this part is the same as that for treecode described in section [ sec : tree ] .",
    "then , for each cell , we calculate the local expansion due to its interaction cells .",
    "figure [ fig : fmmrange ] shows the relation between a cell and its interaction cells .",
    "interaction cells of a cell are defined as the children of its parent s neighbor cells which are not its own neighbors . here ,",
    "neighbor cells are the cells at the same level which are in contact with the cell .",
    "the contribution from the interaction cells are calculated by converting their multipole expansion to the local expansions at the center of the objective cell(m2l conversion ) , and then summing them up .    in the next step ,",
    "we add up the local expansions at different levels to obtain the total potential field at the leaf cells .",
    "we start calculation at @xmath11 . for all cells in @xmath11",
    ", we shift the center of the local expansion of its parent(l2l shift ) , and then add it to the local expansion of the cell . by this procedure",
    ", all cells in @xmath11 will have the local expansion of the total potential field except for the contribution of the neighbor cells . by repeating this procedure for all levels",
    ", we obtain the potential field for all leaf cells .",
    "finally , we calculate the total force on each particle .",
    "the total force is calculated as a sum of the distant and the neighbor contributions .",
    "the distant part is calculated by evaluating the local expansion of the leaf cell at the position of the particle .",
    "the neighbor part is directly calculated by evaluating the particle - particle forces .    in the following ,",
    "we summarize the mathematics used in fmm .",
    "fmm requires two types of expansion of the potential and three transformations of them .",
    "one of the two expansions is the multipole expansion and the other is the local expansion . the multipole expansion of the potential @xmath12 up to @xmath13-th order is expressed as @xmath14 in spherical coordinates @xmath15 . here",
    "@xmath16 is the spherical harmonics and @xmath17 are the expansion coefficients . in order to approximate the potential field due to the distribution of particles ,",
    "the coefficients should satisfy @xmath18 where @xmath19 is the number of particles to be approximated , @xmath20 and @xmath21 are the masses and positions of the particles , and * denotes the complex conjugate .",
    "the local expansion @xmath22 up to @xmath13-th order is given by @xmath23 where @xmath24 is the expansion coefficients .",
    "the three transformation required for fmm are the m2 m shift , the m2l conversion , and the l2l shift .",
    "these transformation are expressed as follows : @xmath25 using @xmath26^{1/2}},\\ ] ] the transformation matrices are expressed as @xmath27a_{l'm ' } } , \\\\",
    "\\label{eq : tml }    t^{lm}_{l'm',lm } & = &    4 \\pi \\frac{(-1)^{l+m}y^{(m'-m)*}_{l'+l}(\\theta_t,\\phi_t )                 a_{lm } a_{l'm ' } }               { r_t^{l'+l+1}(2l+1)(2l'+1)a_{l'+l , m'-m } } , \\\\",
    "\\label{eq : tll }    t^{ll}_{l'm',lm } & = &    4 \\pi \\frac{r_{t}^{l - l'}y^{(m - m')*}_{l - l'}(\\theta_t,\\phi_t )                a_{l'm ' } a_{l - l',m - m ' } }               { a_{lm } ( 2l'+1)[2(l - l')+1]}. \\ ] ] here , @xmath28 is the position of the new origin relative to the old one .",
    "the calculation cost of fmm is @xmath29 .",
    "therefore the scaling of fmm is better than that of treecode .",
    "however , at least in three dimension , comparisons indicate that treecode is faster for realistic number of particles ( @xcite ) .",
    "anderson ( @xcite ) proposed a simple formulation of fmm based on poisson s formula .",
    "poisson s formula gives the solution of the boundary value problem of the laplace equation .",
    "when potential on the surface of a sphere of radius @xmath30 is given , the potential @xmath31 at position @xmath32 is expressed as @xmath33 for @xmath34 , and @xmath35 for @xmath36 . here",
    "@xmath37 is the given potential on the sphere surface .",
    "the range @xmath38 of the integration covers the surface of a unit sphere centered at the origin . the function @xmath39 denotes the @xmath40-th legendre polynomial .    in anderson s method the value of @xmath37 is used to express the multipole / local expansion , while the original fmm uses the coefficients of the expansion terms .",
    "the advantage of anderson s method over the original fmm is its simplicity .",
    "the translation operators described in section [ sec : fmm ] are all realized by evaluating the potential on points of the target sphere due to the source sphere .",
    "all such evaluations are performed using equation([eq : amo ] ) and ( [ eq : ami ] ) .",
    "these are by far simpler to implement the original fmm using equation([eq : m2m])-([eq : tll ] ) .    in order to evaluate the integral in equation([eq : amo ] ) and ( [ eq : ami ] ) numerically , we need to sample the values of @xmath37 on the surface of the sphere .",
    "the number of sample points required and the optimal positions of such points are given in @xcite .",
    "p@xmath0m@xmath0  is quite similar to anderson s method .",
    "the difference is that in p@xmath0m@xmath0  we use the mass distribution on the surface of a sphere instead of the potential .",
    "the continuous mass distribution is again approximated by finite number of pseudo - particles , and the potential exerted by these pseudo - particles are calculated in the same way as that exerted by physical particles .",
    "conceptually , physical particles are converted to pseudo - particles in the following two steps .",
    "first we calculate multipole expansion .",
    "then we assign mass to pseudo - particles so that they have the same multipole expansion as physical particles .",
    "calculation procedure of these two steps are as follows : in the first step we expand the potential with spherical harmonics .",
    "as we have seen in section [ sec : fmm ] , the multipole expansion and its coefficients are given by equation([eq : mpe ] ) and ( [ eq : coeff ] ) .",
    "in the second step we find a continuous mass distribution @xmath41 on a sphere of radius @xmath30 , which approximate the potential field .",
    "then we approximate that distribution by pseudo - particles .",
    "the mass distribution should satisfy @xmath42 for @xmath43 . here",
    "@xmath13 is the highest order of multipole expansion to express and @xmath38 denotes the surface of the unit sphere . because the spherical harmonics comprise an orthonormal system , @xmath44 is expressed as @xmath45 following @xcite , we place @xmath46 points on the sphere so that they satisfy @xmath47 , where @xmath48 is any polynomial of degree at most @xmath49$](order @xmath49 $ ] is necessary to guarantee orthogonality of spherical harmonics of up to order @xmath13 ) , and @xmath50 are the positions of the distributed points .",
    "thus equation([eq : contmass ] ) is replaced by @xmath51 where @xmath52 are the masses of pseudo - particles located at @xmath53 . in practice , the masses @xmath52 of pseudo - particles",
    "are calculated directly from the positions @xmath54 and masses @xmath20 of physical particles .",
    "combining equation([eq : coeff ] ) and ( [ eq : ppm ] ) , @xmath52 is expressed as @xmath55 applying the addition theorem of spherical harmonics to equation([eq : ppm2 ] ) , we obtain : @xmath56 where @xmath57 is the angle between @xmath58 and @xmath50 .",
    "here we present the result of numerical tests for our implementation of treecode with p@xmath0m@xmath0 . in section [ sec : acc ] we compare the accuracy of p@xmath0m@xmath0  and the original fmm for single particle . in section [ sec",
    ": acc - cost ] we present the relation between the accuracy and the calculation cost for our implementation of treecode with p@xmath0m@xmath0 .",
    "we measured the accuracy of the potential calculated with p@xmath0m@xmath0  and the original multipole expansion .",
    "a point mass located at @xmath59 in spherical coordinate is used as the source of the potential . in figure",
    "[ fig : onecell ] the error of the potential evaluated at point @xmath60 is plotted as a function of @xmath61 for both p@xmath0m@xmath0  and the original multipole expansion .",
    "we can see that their agreement is quite good .",
    "we measured the accuracy of the force calculated by the treecode with p@xmath0m@xmath0 .",
    "we used 262144 equal - mass particles uniformly distributed in a sphere .",
    "we measured the relative error @xmath62 of the force averaged over all the particles , and the calculation cost @xmath63 for @xmath13 = 1 , 2 , and 4 .",
    "the average error @xmath62 is defined as @xmath64 where @xmath65 is the force calculated with treecode and @xmath66 is the force calculated with direct summation method .",
    "we define the cost @xmath63 as the average number of ( pseudo)-particle - particle interactions evaluated for one particle .",
    "figure [ fig : total ] shows the results .",
    "we can see that p@xmath0m@xmath0  version with high - order terms is faster than the original version with monopole term , when high accuracy ( @xmath67 ) is required .",
    "we implemented the treecode with p@xmath0m@xmath0  on grape ( @xcite ; @xcite ) .",
    "grape is a special - purpose computer for gravitational @xmath19-body problem(figure [ fig : grape ] ) .",
    "it consists of general - purpose host and special - purpose backend which calculates particle - particle interaction .    with p@xmath0m@xmath0 , high - order terms of multipole expansion",
    "are expressed as particles .",
    "therefore we can implement fmm and treecode with arbitrary order of multipole expansion on grape systems .",
    "previously , we could use grape only to evaluate monopole terms .",
    "figure [ fig : g4 ] shows the timing results of our treecode .",
    "the cpu time per timestep is measured on dec alphaserver 8400 5/300 ( dec 21164 , 300mhz , one processor ) with and without grape-4(@xcite ) .",
    "we used a uniform distribution of 262144 particles in a sphere .",
    "the calculation with grape-4 is 10100 times faster than that without grape-4 . the gain becomes larger as we increase @xmath13 or decrease @xmath4 . thus we can conclude that the combination of p@xmath0m@xmath0  and grape is quite attractive if high accuracy is required .",
    "p@xmath0m@xmath0  and anderson s method are quite similar .",
    "both approximate the multipole expansion by discrete values on points on a sphere .",
    "the difference is that p@xmath0m@xmath0  assigns mass to points while anderson s method assigns potential .",
    "p@xmath0m@xmath0  has two advantages over anderson s method .",
    "one is that the calculation of m2l part is significantly simpler for p@xmath0m@xmath0  since the expanded potential @xmath31 is evaluated as the summation of the potential due to pseudo - particles .",
    "the expression of @xmath31 in p@xmath0m@xmath0  is given by @xmath68 while the expression for anderson s method is given by equation([eq : amo ] ) .",
    "since m2l is dominant part in fmm calculation , total calculation speed for the same expansion order would be faster for p@xmath0m@xmath0 . as we have seen in section [ sec : grape ] , p@xmath0m@xmath0  has an additional advantage that it can make use of special - purpose computers to achieve further speed up .",
    "the other advantage is that the accuracy of the force calculated with p@xmath0m@xmath0  is higher than that with anderson s method for the same expansion order . in anderson s method ,",
    "the potential due to particles are converted to the potential on the sphere surface .",
    "the potential evaluated during this conversion is expressed as @xmath69 and not truncated to the @xmath13-th order .",
    "therefore `` aliasing error '' is introduced into the potential during this conversion .",
    "this error tends to degrade the accuracy . in p@xmath0m@xmath0 , this aliasing error is completely suppressed .",
    "of course , it is easy to modify anderson s method to use the truncated form .",
    "such a modification would significantly improve the overall accuracy .",
    "in this paper , we present p@xmath0m@xmath0 , a new method to express multipole expansion used in fmm and treecode . in p@xmath0m@xmath0 , multipole expansion is expressed by pseudo - particles on a sphere .",
    "p@xmath0m@xmath0  has two advantages over the original multipole expansion .",
    "one is its simplicity and the other is that it can effectively use special - purpose computers .",
    "we implemented treecode with p@xmath0m@xmath0  and evaluated its performance with and without grape-4 .",
    "we found that grape-4 accelerates the calculation by a factor of 10 - 100 .",
    "we conclude that p@xmath0m@xmath0  is a quite attractive method to implement fmm and treecode .",
    "e.  athanassoula , a.  bosma , j .- c .",
    "lambert , and j.  makino , _ performance and accuracy of a grape-3 system for collisionless @xmath19-body simulations _ , monthly notices of the royal astronomical society , 293 ( 1998 ) , pp .",
    "369380 .",
    "j.  a.  board , jr .",
    ", z.  s.  hakura , w.  d.  elliott , and w.  t.  rankin , _ scalable variants of multipole - based algorithms for molecular dynamics applications _ , proceedings of the seventh siam conference on parallel processing for scientific computing(edited by bailey et al . ) , siam , philadelphia , 1995 , pp .",
    "295300 .",
    "t.  fukushige , t.  ito , j.  makino , t.  ebisuzaki , d.  sugimoto , and m.  umemura , _ grape-1a : special - purpose computer for n - body simulation with a tree code _ , publication of the astronomical society of japan , 43 ( 1991 ) , pp .",
    "841858 .",
    "l.  greengard and v.  rokhlin , _ rapid evaluation of potential fields in three dimensions _ ,",
    "vortex methods(edited by c.  anderson and c.  greengard ) , number 1360 in lecture notes in mathematics ( 1988 ) , springer - verlag , berlin , pp .",
    "121141 .            y.  hu , s.  l.  jonsson , and s .- h .",
    "teng , _ a data - parallel adaptive @xmath19-body method _ , proceedings of the eighth siam conference on parallel processing for scientific computing , siam , 1997 , ( cd - rom ) .",
    "j.  makino , m.  taiji , t.  ebisuzaki , and d.  sugimoto , _",
    "grape-4 : a massively parallel special - purpose computer for collisional @xmath19-body simulations _ , astrophysical journal , 480 ( 1997 ) , pp .",
    "432446 .",
    "j.  k.  salmon , g.  s.  winckelmans , and m.  s.  warren , _ fast parallel treecodes for gravitational and fluid dynamical @xmath19-body problems _ , international journal of supercomputer applications , 8 ( 1994 ) , pp ."
  ],
  "abstract_text": [
    "<S> we present the pseudo - particle multipole method ( p@xmath0m@xmath0 ) , a new method to handle multipole expansion in fast multipole method and treecode . </S>",
    "<S> this method uses a small number of pseudo - particles to express multipole expansion . with this method , </S>",
    "<S> the implementation of fmm and treecode with high - order multipole terms is greatly simplified . </S>",
    "<S> we applied p@xmath0m@xmath0  to treecode and combined it with special - purpose computer grape . </S>",
    "<S> extensive tests on the accuracy and calculation cost demonstrate that the new method is quite attractive . </S>"
  ]
}