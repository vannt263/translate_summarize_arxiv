{
  "article_text": [
    "galaxy modelling can be broadly separated into two categories : light profile fitting and kinematic dynamical modelling . in dynamical modelling ,",
    "part or all of the 6-dimensional phase space structure is constrained by kinematic data and dynamical constraints such as the poisson and/or jeans equations . by contrast , profile fitting ( or profiling ) quantifies the _ projected _ structure of a galaxy on the sky , usually by fitting radially - varying density profiles to one - dimensional , azimuthally - averaged profiles or two - dimensional images .",
    "both methods have been used to infer the presence of distinct structural components in galaxies , such as discs , bulges , bars and spiral arms ( so - called decomposition ) .",
    "@xcite is credited as the first to develop a galaxy classification scheme including distinct features or components , including spiral arms and a concentrated central component .",
    "as early as @xcite it had been quantitatively demonstrated , using photoelectric measurements along the major and minor axes , that m31 comprised of a distinct bulge and disc component . in the modern era",
    ", large samples of thousands of galaxies have been decomposed quantitatively into distinct components @xcite .",
    "such datasets have been used to infer distinct evolutionary pathways and mechanisms @xcite for galaxies of different types and compositions and to develop galaxy formation models @xcite . improving these theories",
    "requires both better data ( by volume , depth and quality ) and analysis methods .",
    "this paper offers a new route to reliably divide galaxies into their constituent parts by way of a new publicly released library and interface ( ` libprofit`and profitrespectively ) for galaxy profile modelling and decomposition .",
    "these will be used by the authors for near future large - scale studies , and are being made available to the wider community along with the prospect of practical support and future updates .",
    "the earliest efforts of galaxy structural characterisation concentrated on simple one - dimensional intensity profile fitting , leading to the early discovery of the de - vaucouleurs profile @xcite for describing early - type galaxies and the realisation that disc galaxies had close to exponential profiles @xcite .",
    "@xcite generalised these profiles into the @xmath2 law that remains widely popular today , commonly referred to as the srsicprofile @xcite .",
    "increasingly complicated one - dimensional component fitting came in work by @xcite and @xcite , where galaxies were decomposed into distinct components rather than treated as having a single light profile .",
    "the earliest efforts at two - dimensional galaxy profiling came with the work of @xcite , @xcite , @xcite , @xcite and @xcite .",
    "the latter four approaches are broadly similar in application , and are recognisably similar to modern two - dimensional galaxy fitting efforts .",
    "the basic philosophy was the same as for previous one - dimensional work , the aim being to find the distinct light components of galaxies , but here the analysis was made using image pixels directly rather than by fitting azimuthally averaged ellipses of light .",
    "a large number of key insights into galaxy properties have been uncovered through both one - dimensional and two - dimensional structural analysis .",
    "early work found that the disc component of galaxies is very well represented by an exponential drop - off in light ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "of recent interest in the astronomy literature is the relationship between galaxy mass and size , both globally @xcite and for individual components @xcite .",
    "there is also a large body of work investigating the luminosity - surface brightness relation for different classes of galaxy ( see reviews by * ? ? ?",
    "* ; * ? ? ?",
    "* ) , as well as investigating the distribution of mass for different types of structure ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) .    such global morphological properties of galaxies are finally being utilised and predicted by the newest theoretical work , both in the regime of semi - analytic models @xcite and cosmological hydrodynamic simulations @xcite",
    ". given the constraints that galaxy morphology can offer theory , it will be increasingly important that well quantified structural measurements for galaxy properties are extracted from current and future large - area , deep , high - resolution photometric surveys ( e.g. kilo degree survey ( kids ) , dark energy survey ( des ) , hyper suprime camera ( hsc ) and large synoptic survey telescope ( lsst ) : * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* respectively ) .    there remains some debate regarding the relative merits of one - dimensional and two - dimensional image analysis ( e.g. * ? ? ?",
    ". this introduction will not serve as a thorough discussion of the various issues , but we will discuss a few key points .",
    "one - dimensional fitting relies heavily on an additional step in the analysis : the galaxy must be collapsed into a one - dimensional profile in some manner , usually using software such as iraf s ellipse task .",
    "it is impossible to do this in an entirely model independent manner when the galaxy is anything other than smoothly changing isophotes ; however , such an approach can easily cope with a smoothly varying orientation in the isophotes .",
    "a caveat to this is that it is unclear formally how the atmospheric point - spread function ( psf ) should be treated when one - dimensional fitting ( note that there are analytic solutions for the specific case of face - on convolution , see * ? ? ?",
    "even a galaxy constructed from perfect concentric ellipses will become artificially circular towards the profile centre when convolved with a circular psf . whilst this effect is captured from the one - dimensional profile information ,",
    "it is non - trivial to properly propagate this information such that you measure the intrinsic two - dimensional profile properties of the galaxy . collapsing two - dimensional information into a one - dimensional form is almost always a lossy process ( it can be no better than lossless ) , and real azimuthal profile fluctuations may be lost entirely .",
    "correctly propagating errors is also non - trivial , and in practice these are often not used at all ( an approach advocated in * ? ? ?",
    "there are two other critical aspects of this collapsing process that can have a dramatic effect on galaxy profiling : the centre of the galaxy must be fixed exactly a - priori and the components must share the same centre . the freedom to fit for the galaxy centre is often important for capturing the steepest inner parts of a galaxy properly ( especially if the centre is sub - pixel ) and galaxy components sometimes do not share exactly the same centres @xcite .",
    "two - dimensional fitting is closer in spirit to bayesian generative model fitting , e.g.  creating a two - dimensional distribution of flux that is then propagated through the atmospheric psf . as such it is an attractive approach to quantifying image components",
    "however , the isophotes of popular galaxy profile functions are poorly behaved when integrating over two - dimensional pixels , requiring relatively expensive numerical estimation , while complex geometry ( like rotating isophotes ) is more difficult to capture fully , with most codes ignoring this issue entirely . in the regime where the true galaxy is well represented by the two - dimensional model being used a two - dimensional fit _",
    "should _ be preferable . in principle , effects like twisting isophotes can be incorporated into a two - dimensional generative model technique ( see * ? ? ?",
    "* ) , but this is rarely attempted in practice .    because of these relative advantages and disadvantages between one - dimensional and two - dimensional approaches , their application to galaxy profiling has pragmatically diverged .",
    "one - dimensional codes are more popular in the regime of highly resolved galaxies where complex geometric effects ( like twisting isophotes ) are clearly visible and the issue of psf convolution is less significant . because of the more automated nature of two - dimensional codes ( they do not require a carefully controlled collapse of the data to one - dimensional ) , they have tended to be more popular for large samples of galaxies where the fitting is made with little user interaction ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "our long - term ambition is to decompose galaxy structures from a large number of imaging data sources for many millions of galaxies , so our use - case is squarely in the highly - automated regime .",
    "for this reason in particular , we focussed our efforts on two - dimensional decomposition codes .",
    "current publicly - available two - dimensional galaxy profile fitting codes include budda @xcite , galfit@xcite , galmorph @xcite , gim2d @xcite , and imfit @xcite - all of which support the commonly - used srsicprofile .",
    "these codes share their origins in the early two - dimensional profiling efforts of @xcite and @xcite and have been utilised in a number of notable large - scale galaxy studies : @xcite .",
    "notable alternatives include gasphot @xcite , which is a one - dimensional fitting code , and mge @xcite , which abandons traditional srsicprofile bulge - disc decomposition for more flexible ( but arguably less physical ) concentric gaussians . in all of the other codes ,",
    "the model is treated generatively by numerically integrating a radially - varying profile over a rectangular pixel grid ; in practice , most codes improve integration accuracy by oversampling the native pixel grid , particularly near the centre of the galaxy .",
    "once this idealised model is integrated , it can be convolved with a target psf , either via brute - force or fast fourier transform ( fft ) techniques .",
    "these codes all have their positive features and weaknesses , and differ in fine aspects such as how the likelihood is computed and maximised .",
    "however , no existing code achieves the desired design requirements that our new code , profit , aims to address , namely that it :    * be legally open source under a gpl , bsd , mit license or similar , * be practically collaborative and hosted in a publicly available location such as github or bitbucket , * be written in a low - level modern object - oriented language , aiding modularity , extensions and robustness for complex software , * have the core image generation code clearly separated from the optimisation code , available as a shared library , and accessible via an easy - to - use api , * offer a useful range of built - in models and have a well documented mechanism for adding more , * support sub @xmath31% flux weighted error model image generation for built - in models , and be testable in this regard , * be fast at generating these model images , * have a range of options to define likelihoods , i.e.  normal , poisson , chi - squared and student - t statistics , * be able to fit a large number of components in a flexible manner , e.g.  components being fixed , free or locked together with other components , * be untied to a specific optimiser , i.e.  able to use a range of ( user - selectable ) optimisation engines , * be able to accept prior distributions of an arbitrary type for model parameters ( vital for bayesian model evaluation ) , and * have the ability to fit parameters in linear or log space as deemed appropriate by the user for the problem ( vital for bayesian model evaluation ) , * be able to handle parameter limits and constraints in flexible manner ( e.g.  prevent some parameters getting larger than other etc ) , * have a core interface that does not require the use of text file inputs , i.e.  there is a completely functional interactive interface to the software ( though scripting with files should be allowable ) , * simple to parallelise .    the reasons for desiring the above features are multi - faceted , but broadly it is to aid the structural analysis of large amounts of data obtained from new and future imaging surveys such as kids , des , hsc and lsst . also , the addition of optional priors and log or linear parameter scaling is paramount for proper bayesian model evaluation .",
    "automating historic code is a complicated affair @xcite , and there are in practice many subtle issues with trying to bootstrap new code from legacy software .",
    "starting from scratch with a new code offers full flexibility in language choice , design flexibility and low - level choice regarding pixel integration and likelihood calculations .",
    "our estimation was it would be at least as much effort to adapt any available open - source code to meet the above requirements that profitdelivers .",
    "this paper discusses the development and application of the core image generation code ( ` libprofit ` , section [ sec : imgen ] ) and the fitting code ( profit , section [ sec : fit ] ) .",
    "the profitcode is then applied to various examples ( section [ sec : examples ] ) , spanning a detailed case - study ( section [ sec : example1 ] ) and the analysis of 10 exemplar bulge - disc galaxies that are included with the profitpackage ( section [ sec : example2 ] ) .",
    "estimations of decomposition fidelity is then made for current and future datasets ( section [ sec : future ] ) .",
    "finally , we discuss and summarise the results of this paper ( section [ sec : discuss ] ) .",
    "the image generation code is contained in a shared library written in c++ called ` libprofit ` . `",
    "libprofit ` enables the user to construct a _ model _ to which _ profiles _ are appended .",
    "each profile can be fine - tuned , and fully describes a component of the resulting image .",
    "after profiles are appended the model is evaluated , and the resulting image can be retrieved . ` libprofit ` cycles through each of the profiles generating individual images for each of them , which are optionally convolved and finally added .",
    "hence it is trivial to describe a one- , two- or multi - component system .",
    "this external interface , internal organisation and execution of the ` libprofit`library is depicted in figure [ fig : libprofit ] using the unified modelling language .",
    "` libprofit ` includes a default set of popular profiles : srsic , core - srsic , broken - exponential , moffat , ferrer , modified empirical king , point spread function ( psf ) and sky ( see figure [ fig : profiles ] ) .",
    "the first six share some key similarities : they can be fully described by an analytic radial profile which is then evaluated in two - dimensions over pseudo - elliptical isophotes .",
    "they also share similarities in terms of how they must be evaluated in a given pixel : if the gradient of the model image is varying rapidly over the scale of a pixel then using a simple trapezoidal integration scheme ( effectively taking the flux value predicted at the centre and assuming this to reflect the average for the pixel ) can be error prone .    for this reason",
    "the srsic , core - srsic , broken - exponential , moffat , ferrer and king profiles all share the same core c++ code that evaluates the flux in a pixel and determines whether more accuracy is required .",
    "this means new profiles can be defined quite simply within ` libprofit ` , effectively reducing to the one - dimensional form of the radial profile and a scheme to calculate the total flux within the profile . for the srsic , moffat and ferrer the total integration are known ( or have been calculated by the authors ) analytically , so this makes them particularly simple cases .",
    "all eight profiles are discussed in more detail below , with the caveat that the detail of the integration scheme discussed with respect to the srsicprofile also applies to the core - srsic , broken - exponential , moffat , ferrer and king .          for galaxy fitting purposes",
    "the srsicprofile @xcite is a modern day work - horse , having enough flexibility in profile characteristics to fit a large variety of galaxy types ( see e.g. * ? ? ?",
    "the intensity profile is usually parameterised as :    @xmath4 \\right\\},\\ ] ]    where @xmath5 is the intensity of the profile at @xmath6 ( the radius containing half of the flux ) , @xmath0 is the srsicindex ( which has special cases of normal / gaussian with @xmath7 , exponential with @xmath8 and de - vaucouleurs with @xmath9 ) and @xmath10 is a derived parameter that ensures the correct integration properties at @xmath6 and is the quantile at which the gamma probability distribution function integrates to 0.5 given a shape parameter of @xmath11 .",
    "this can be computed directly using high - level interfaces to statical distribution libraries ( e.g.  in r@xmath12 qgamma(0.5 , 2*n ) ) .",
    "@xmath13 is the modified radius where we want to make the evaluation , which in one dimension is simply the radius from the profile centre . in two dimensions",
    "@xmath13 has a more complex form :    @xmath14    where @xmath15 is the two - dimensional location where we wish to make the evaluation and @xmath16 is the location of the profile centre .",
    "when the two - dimensional profile is non - circular the isophotal contours become elliptical annuli , so calculating @xmath13 becomes a series of computations that rotate and circularise the annuli .",
    "when the major - axis angle @xmath17 is defined such that it is 0 degrees vertically and increases positively as the galaxy is rotated counter - clockwise ( as per galfit ) these steps become :    @xmath18    where @xmath19 is the minor to major axis ratio ( so always a number between 0 and 1 , where 0 is an infinitely thin line and 1 is a circle or disc ) . the final modifier to the standard one - dimensional srsicprofile intensity is to allow for apparent ` boxiness ' .",
    "boxiness is often used to create the more rectangular visual appearance of galaxy bulges or elliptical galaxies .",
    "it effectively modifies the unit circle ( or ellipse ) away from the standard @xmath20 norm and either towards a diamond / kite appearance ( @xmath21 norm ) or a boxy appearance ( @xmath22 norm ) .",
    "this is achieved though a small manipulation of the final @xmath13 calculation above :    @xmath23^\\frac{1}{2+b},\\ ] ]    where @xmath24 is the boxiness , which for practical ( as opposed to mathematical ) purposes is usually allowed to vary between -1 and 1 ( thus covering the full range of apparent visual boxiness ) .",
    "figure [ fig : boxiness ] shows the effect of different negative and positive values of boxiness .",
    "a consideration for the user is the relative expense of computing the boxiness .",
    "powers that differ from the @xmath20 norm are much more expensive to compute , in particular non - integer values might be a factor of a couple slower when computing a model image . in most standard c math libraries ( libm )",
    "it is faster to make successive calls to sqrt and csqrt rather than a single call to pow . `",
    "libprofit ` acknowledges this fact and calls the most efficient set of functions as appropriate for certain exponents .    whilst the above is an accurate description of the computations that need to be made to calculate an arbitrary two - dimensional srsicprofile , they are not optimal . ` libprofit ` uses rotation matrix arithmetic internally to achieve the above steps efficiently",
    ", projecting pixel coordinates onto the major and minor axes of the ellipse .",
    "this can be a factor of a few faster than explicitly computing rotations with expensive calls to trigonometric functions .",
    "it is not necessary to parameterise the profile using @xmath5 to define the normalisation , as this is rarely intuitive . instead",
    ", the user can specify the total flux contained within a profile in magnitudes ( @xmath25 ) given a magnitude zero - point ( @xmath26 ) , and calculations are made internally to convert this to the correct value of @xmath5 .",
    "these include appropriate modifications for the axis ratio ( @xmath19 ) and boxiness ( @xmath24 ) :    @xmath27    where @xmath28 is the beta function defined as @xmath29 , and @xmath30 is the standard gamma function .",
    "if the profile has no boxiness then the above is simplified by noting that @xmath31 and therefore the denominator term for @xmath32 disappears . to aid flexibility",
    "it is also possible in ` libprofit ` to define the profile normalisation using the mean surface brightness within @xmath6 ( @xmath33 ) , where :    @xmath34    ` libprofit ` follows the convention that @xmath33 is determined for an elliptical radius containing half of the objects flux , i.e.  it is not modified for boxiness .",
    "this can be useful when parameterising a galaxy where the galaxy magnitude is entirely unknown since galaxies span a much smaller dynamic range in surface brightness than total magnitude @xcite .    in conclusion ,",
    "the srsicprofile is specified fully through the provision of eight parameters that are parsed into the ` libprofit ` image building routine as a list structure of equal length vectors .",
    "below is an example specification of a two - component srsicmodel in the rimplementation of profitthat directly calls the ` libprofit`api to generate model images , where @xmath35xcen , @xmath36ycen , @xmath37mag , @xmath38re , @xmath39nser , @xmath40ang , @xmath41axrat and @xmath42box :    this model is shown in figure [ fig : examplesersicmodel ] . as expected , the high srsicindex bulge component dominates the flux near the galaxy centre as well as at very large radii , due to the shallow slope of an @xmath43 srsicprofile .",
    "this is visible as side lobes in the surface brightness contours jutting out from the visually dominant disc component running diagonally across the image .",
    "closely related to the srsicprofile is the core - srsicprofile introduced by @xcite .",
    "this was designed to parameterise the strong inner core ( i.e.  suppression compared to pure srsic ) profile of well - resolved elliptical galaxies .",
    "the inner components of such galaxies had previously been parameterised well with the nuker profile @xcite , at least in the inner parts of the profile .",
    "however , the nuker profile fits poorly at large radii and does not have a well behaved integral to infinite radius for typical parameters .",
    "the core - srsicaddresses these issue by allowing the inner component to behave in a nuker - like manner , with the outer parts being described by a standard srsicprofile .",
    "the intensity profile can be parameterised as :    @xmath44^\\frac{b}{a } \\exp \\left[-b_n \\left(\\frac{r_m^a+r_b^a}{r_e^a}\\right)^\\frac{1}{n a}\\right],\\ ] ]    where @xmath45 is the intensity at a parameter dependent reference point ( the centre if @xmath46 ) , @xmath47 is the break radius that controls the point where the outer srsic - like profile transitions to become an inner nuker - like profile , @xmath6 is the standard srsichalf light radius ( and @xmath10 has the same meaning as for the pure srsicprofile ) and @xmath48 controls the strength of transition ( large value is a sharper transition ) and @xmath49 controls the inner power - law .",
    "@xmath13 is the modified radius where we want to make the evaluation , which in one dimension is simply the radius from the profile centre . in two dimensions",
    "@xmath13 has a more complex form where , as with the srsicprofile , we can use this basic form and compute annuli that are modified from pure circular ellipses by introducing geometric transformations that compute an effective @xmath13 , as per equation [ eq : rmod ] .",
    "accounting for the allowed geometric distortions of axial ratio and boxiness , the value of @xmath45 for a given magnitude can be calculated numerically with :    @xmath50    the integral above has no simple analytic solution , so it is instead calculated numerically inside ` libprofit ` using either the ror gsl implementation of the quadpack library ( specifically adaptive gauss - kronrod quadrature integration ) .",
    "this is a much better solution than attempting to re - normalise the generated image since much of the flux could exist beyond the confines of the image pixels , especially for large values of @xmath0 .",
    "below is an example of a core - srsicmodel in the rimplementation of profitthat directly calls the ` libprofit`api to generate model images , where @xmath35xcen , @xmath36ycen , @xmath37mag , @xmath51rb , @xmath52re , @xmath39nser , @xmath53a , @xmath54b , @xmath40ang , @xmath41axrat and @xmath42box :      the broken - exponential profile is a popular means to parameterise rolling or sharp truncations in the surface profiles of discs , which are usually close to exponential in profile until they enter the moderate- to low - surface brightness regime .",
    "@xcite introduced a simple modification to the standard exponential profile ( which is itself a subset of possible srsicprofiles ) in order to capture the range of truncations observed .",
    "the intensity profile can be parameterised as :    @xmath55^{\\frac{1}{a}\\left(\\frac{1}{h_1}-\\frac{1}{h_2}\\right)},\\end{aligned}\\ ] ]    where @xmath56 is the intensity at the centre of the profile , @xmath57 is the scale length of the inner exponential profile , @xmath58 is the scale length of the outer exponential profile , @xmath47 is the radius at which the profile transitions from the inner to outer part and @xmath48 controls the sharpness of this transition .",
    "@xmath13 is the modified radius where we want to make the evaluation , which in one dimension is simply the radius from the profile centre . in two dimensions",
    "@xmath13 has a more complex form where , as with the srsicprofile , we can use this basic form and compute annuli that are modified from pure circular ellipses by introducing geometric transformations that compute an effective @xmath13 , as per equation [ eq : rmod ] .",
    "accounting for the allowed geometric distortions of axial ratio and boxiness , the value of @xmath56 for a given magnitude can be calculated analytically with :    @xmath59    where @xmath25 , @xmath26 and @xmath60 have the same meanings as per equation [ eq : sersnorm ] .",
    "an example specification of a broken exponential model in the rimplementation of profitthat directly calls the ` libprofit`api to generate model images , where @xmath35xcen , @xmath36ycen , @xmath37mag , @xmath61h1 , @xmath62h2 , @xmath63rb , @xmath53a , @xmath40ang , @xmath41axrat and @xmath42box , is :      the moffat function was designed as a means to parameterise a telescope point spread function @xcite , and is often used on occasions when the psf is predicable and when you might not have many point sources within the field - of - view to estimate it empirically ( e.g.  for space telescopes with small fields - of - view like the hubble space telescope ) . whilst this was the purpose behind its design , in practice in modern applications it rare to see analytic approximations of the psf ( such as the moffat ) used , the modern preference being for empirically derived estimates .",
    "regardless , for reasons of flexibility it is included as a profile option in ` libprofit ` .",
    "the moffat is a re - parameterisation of the bivariate student - t distribution , meaning it creates a normal - like core with lorentzian - like wings .",
    "the intensity profile can be parameterised as :    @xmath64^{-c},\\ ] ]    where    @xmath65    where @xmath56 is the intensity at the centre of the profile , @xmath66 is the profile concentration ( @xmath67 is pure lorentzian , @xmath68 is pure normal ) and @xmath69 is the full - width half max of the profile across the major - axis of the intensity profile .",
    "@xmath13 is the modified radius where we want to make the evaluation , which in one dimension is simply the radius from the profile centre . in two dimensions @xmath13 has a more complex form where , as with the srsicprofile",
    ", we can use this basic form and compute annuli that are modified from pure circular ellipses by introducing geometric transformations that compute an effective @xmath13 , as per equation [ eq : rmod ] .",
    "thus in ` libprofit ` the moffat function need not be circular , which is often the case for the psf of a wide - field telescope where corner distortions tend to be radial or tangentially aligned with respect to the field centre .",
    "accounting for the allowed geometric distortions of axial ratio and boxiness , the value of @xmath56 for a given magnitude can be calculated analytically with :    @xmath70    where @xmath25 , @xmath26 and @xmath60 have the same meanings as per equation [ eq : sersnorm ] .",
    "an example specification of three moffat models in the rimplementation of profitthat directly calls the ` libprofit`api to generate model images , where @xmath35xcen , @xmath36ycen , @xmath37mag , @xmath71fwhm , @xmath72con , @xmath40ang , @xmath41axrat and @xmath42box , is :    since the moffat profile is almost exclusively used to model the image psf , ` libprofit ` is hard - coded to never convolve the profile with another psf , even if this is provided .",
    "this is to help eliminate potential user error .",
    "the modified ferrer profile ( a type of projected potential derived from ferrers functions , as discussed in @xcite ) is a useful parameterisation of galaxy features that have very strong drop - offs , most typically bar structures . whilst it should formally be called the ferrers profile",
    ", it is very common for it to be written as ferrer ( the assumption is that authors have erroneously attributed the final ` s ' as possessive , but the name derives from norman macleod ferrers ) . for convenience",
    ", the profile can be named as ferrer or ferrers in ` libprofit`and in higher - level interfaces .",
    "the intensity can be parameterised as :    @xmath73^{a},\\ ] ]    where @xmath56 is the intensity at the centre of the profile , @xmath74 is the outer truncation radius ( the profile is 0 beyond this radius ) , @xmath48 controls the global power - law slope to the profile centre , and @xmath49 controls the strength of truncation as @xmath75 approaches @xmath74 .",
    "@xmath13 is the modified radius where we want to make the evaluation , which in one dimension is simply the radius from the profile centre . in two dimensions",
    "@xmath13 has a more complex form where , as with the srsicprofile , we can use this basic form and compute annuli that are modified from pure circular ellipses by introducing geometric transformations that compute an effective @xmath13 , as per equation [ eq : rmod ] . for the ferrer profile it is common to introduce some positive boxiness to reflect the visually rectangular isophotes of galaxy bars .",
    "accounting for the allowed geometric distortions of axial ratio and boxiness , the value of @xmath56 for a given magnitude can be calculated analytically with :    @xmath76    below is a sample specification of a ferrer model in the rimplementation of profitthat directly calls the ` libprofit`api to generate model images , where @xmath35xcen , @xmath36ycen , @xmath37mag , @xmath77rout , @xmath53a , @xmath54b , @xmath40ang , @xmath41axrat and @xmath42box :      the modified king profile in ` libprofit ` shares its origins with the empirically motivated two - dimensional profile presented in @xcite , and remains a popular function for parameterising globular cluster light profiles .",
    "it should be emphasised that it is _ not _ the same as the equally popular profile presented in @xcite , the latter being parameterised in three - dimensions , theoretical in origin and non - trivial to project . ` libprofit ` uses the same basic modification to the @xcite as used in galfit , where the intensity can be parameterised as :    @xmath78^\\frac{1}{a}}-\\frac{1}{\\left[1+\\left(\\frac{r_t}{r_c}\\right)^2\\right]^\\frac{1}{a}}\\right\\}^a,\\ ] ]    where @xmath45 is the intensity at a parameter dependent reference point ( the centre if @xmath79 ) , @xmath80 is the core radius , @xmath81 is the outer truncation radius ( the profile is 0 beyond this radius ) and @xmath48 controls the global power - law . when @xmath82 , this parameterisation is identical to the one presented originally in @xcite .",
    "@xmath13 is the modified radius where we want to make the evaluation , which in one dimension is simply the radius from the profile centre . in two dimensions",
    "@xmath13 has a more complex form where , as with the srsicprofile , we can use this basic form and compute annuli that are modified from pure circular ellipses by introducing geometric transformations that compute an effective @xmath13 , as per equation [ eq : rmod ] .",
    "accounting for the allowed geometric distortions of axial ratio and boxiness , the value of @xmath56 for a given magnitude can be calculated analytically with :    @xmath83    an example specification of a modified king profile in the rimplementation of profitthat directly calls the ` libprofit`api to generate model images , where @xmath35xcen , @xmath36ycen , @xmath37mag , @xmath84rc , @xmath85rt @xmath53a , @xmath40ang , @xmath41axrat and @xmath42box , is :      the point spread function profile for an unresolved point source ( referred to as a pointsource within ` libprofit`and profitto distinguish it from the psf ) is a simple prescription requiring the @xmath16 location of the desired point source , the total flux contained in magnitudes @xmath25 and either an empirical psf image or analytic psf model . in the former case ,",
    "the psf image is linearly interpolated onto the specified location in the image ( thus fractional pixel values can be provided ) and is renormalised to ensure the flux contained is correct given the magnitude zero - point ( @xmath26 ) ; otherwise , the point source is accurately integrated with the specified psf model using an analytic profile ( e.g.  the moffat , as discussed in section [ subsubsec : moffat ] ) .",
    "an example of a model containing three point sources in the rimplementation of profit , where @xmath35xcen , @xmath36ycen and @xmath37mag , is :    numerical integration of an analytic psf is considerably more accurate than interpolation of an empirical psf image , so we generally recommend using the former approach if it is at all possible . as mentioned in section [ subsubsec : moffat ] , it is more typical to see astronomers make use of empirical psfs . since the intrinsic psf is unknown , using such a description will result in a simple linear interpolation to fractional pixel locations . to accommodate this fact ,",
    "` libprofit ` and profitallow for the specification of an oversampled empirical psf .",
    "if psf modelling is required , this offers both a pragmatic and accurate solution .",
    "the simplest profile of all is the sky . in ` libprofit",
    "` this is specified as the flux per pixel without any adjustment made for the magnitude zero - point ( @xmath26 ) , i.e. it is the flat sky level pedestal directly measured from the image in its native flux units ( any subsequent conversions must be made explicitly by the user ) . an example sky model in the rimplementation of profitrequires only the background level bg :    currently only flat sky profiles are available in ` libprofit ` and profit , with the assumption that in typical profituse cases the sky is a pedestal term , with no gradient of curvature .",
    "depending on community feedback additional complexity for the sky profile could be added in the future .",
    "however , it is clear that the majority of modern survey image processing involves an explicit sky - subtraction stage which reduces the data to a pedestal - only sky profile ( e.g.  see * ? ? ? * ) . like any other profile type it is possible to fit for the sky profile background within ` libprofit ` , however in many use cases the background will be known a - priori and should not be fit .",
    "a common issue with the leaving the sky as a fitted parameter is how degenerately it behaves with srsic - index outer profiles , which also appear close to flat at many multiples of @xmath6 . to guard against this effect",
    "it is wise to fit using pixels which are dominated by galaxy flux .",
    "combining models in ` libprofit ` is simple given the nested list nature of object specification .",
    "a structure containing the srsic , ferrer bar , point - source and sky models is given by :    this is the list structure used in r profitto specify models , and in principle an unlimited number of profiles can be provided to create complex model images . in practice , for galaxy image fitting simple models are made of the region of direct interest .",
    "this structure is also the mechanism for providing initial conditions for galaxy image fitting .",
    "this structure can be easily manipulated from outside of the renvironment , or directly within r.    figure [ fig : examplecombmodel ] shows the image generated by the example model above .",
    "this is very similar to figure [ fig : examplesersicmodel ] but with the addition of a ferrer bar profile , three bright point sources and a sky background ( which is not visible due to the image scaling ) .",
    "more details on how ` libprofit ` generates these images is provided in the following section .    , but with the addition of a ferrer bar profile , three psfs and a sky background . ]      the main focus of development effort in ` libprofit ` was optimizing model image generation for speed _ and _ accuracy , particularly for the srsicprofile ( since this is by some margin the most popular general purpose profile for galaxy modelling ) . the first requirement to achieve rapid image generation was that the core code should be written in a fast low - level language . c++",
    "was chosen for these purposes , with the idea that ` libprofit ` should provide a generic low - level library that higher level languages ( e.g.  rand python ) can access easily .    with c++ chosen as the implementation language , the main considerations left were how to best approach the problem of model image generation algorithmically .",
    "two - dimensional modelling routines are circumspect in how they achieve pixel integration , with most published references stating that inner pixels are ` oversampled ' in order to achieve reasonable accuracy in the pixel flux ( note this is different to the type of oversampling required to ensure accurate image convolution , as discussed in section [ subsec : convolution ] ) . depending on the profile being created the degree of oversampling can vary by many orders of magnitude . getting accurate solutions for the flux in a pixel containing the peak of a steep ( high @xmath0 )",
    "srsicprofile is clearly a very different prospect to estimating the flux of a pixel a large distance from the centre , where the profile is very flat . to combat this problem , ` libprofit ` uses a unified oversampling scheme ( inspired by adaptive quadrature ) for all profiles that have an analytic radial intensity profile - initially the srsic , core - srsic , broken - exponential , moffat , ferrer and king profiles discussed above .",
    "here we concentrate on the evaluation of the srsicprofile , but the basic principles hold true for all radially - varying profiles . in ` libprofit ` all such profiles inherit from a generic class of radial type profiles ( see figure [ fig : profiles ] ) , where the pixel integration scheme is shared in a common method .",
    "the profiles are specified by their radial intensity and total luminosity ( as per section [ sec : profiles ] ) .",
    "this minimises code duplication and simplifies the addition of new profiles to ` libprofit ` , where the user only needs to be able to express the one - dimensional form of the profile shape and a method to integrate it to get the total luminosity ( which can simply be a numerical integration if there is no convenient analytic solution ) .",
    "the qualitative version of the pixel integration scheme is that an oversampling resolution , a recursion depth and an accuracy level is specified for a given pixel .",
    "the grid is initially oversampled by the integer factor provided , for each sub - pixel the gradient along the minor axis ( this being the steepest descent ) is computed and when it is over a tolerance specified by the accuracy value this pixel is selected for recursive oversampling . in this situation the sub - pixel becomes redefined as the parent pixel and the scheme above is repeated .",
    "figure [ fig : pixint ] is a simple schematic of the central @xmath86 pixels being recursively over - sampled by a factor @xmath87 to achieve an accurate numerical integration in the regime where the profile is rising steeply in the core of the galaxy .",
    "the default allowed maximum depth for sub - pixel recursion is 2 , but it can be user - specified .",
    "the default oversampling factor is 8 , meaning at most sub - regions of pixels would be oversampled by a factor @xmath88 .",
    "a special case is made for the central pixel in the srsicprofile ( containing the flux peak ) . to ensure accurate results even for extreme examples of very steep profiles of barely - resolve galaxies , the maximum recursion depth",
    "is increased to 10 , giving potential oversampling of @xmath89 . in extreme cases , where deep recursion is triggered on the very central pixel of each layer",
    ", the practical worst case scenario is that @xmath90 calculations are actually required because only the sub - pixels containing the profile peak require deeper recursion .",
    "this combination of accuracy and speed means ` libprofit ` performs well in model image generation bench - marking whilst maintaining user - definable accuracy with sensible defaults .",
    "detailed comparisons were made with reference to galfit , where the target was to achieve similar or better pixel level accuracy whilst ensuring the model image computation time was no longer for typical values of the srsicindex ( @xmath0 ) .",
    "for these comparisons a modified build of galfitwas used that did not read or write to disk and instead took arguments and produced outputs in memory ( ensuring this relatively large i / o bottleneck was not a factor ) .",
    "the exact pixel fluxes were computed using the r2cuba rpackage that is an interface to the cuba c++ library that offer deterministic algorithms for multidimensional numerical integration . the algorithm used was cuhre , which offers a user definable level of integration accuracy .",
    "for these tests it was set to be better than 0.1% pixel accuracy ( in practice achieving an order of magnitude better accuracy in most pixels ) , so at most this amount of inaccuracy may come from the reference _ exact _ pixel fluxes .",
    "it is worth highlighting why this approach can not be used in general : to create a typical @xmath91 pixel image ( a very small image by galaxy fitting standards ) with this level of accuracy takes @xmath33 seconds ( and much longer for some profiles ) . in comparison ` libprofit ` and galfitcan both create similar image in less than 0.01 seconds , i.e.  they are both at least 300 times faster than using a multidimensional integration library , even a fast one written in c++ .",
    "it is not clear why using this specialised library is so slow , but it ruled out using it within ` libprofit`for general application .",
    "figure [ fig : fluxweighterror ] compares the flux - weighted pixel error of ` libprofit ` and galfitas a function of srsicindex for srsicprofiles ( again , srsicprofiles have been high - lighted due to their popularity in the galaxy profiling community ) with @xmath92pixels , @xmath93 degrees and @xmath94 .",
    "two things are immediately clear : ` libprofit ` has a lower flux - weighted error per pixel ( typically 0.1% ) , and this error does not vary significantly with srsicindex . galfitachieves a flux weighted error per pixel of 0.3% for low values of the srsicindex , but this inflates to > 1% for larger values of @xmath0 .",
    "pixels , @xmath93 degrees and @xmath94 in a @xmath95 pixel image .",
    "a subset of these results ( for @xmath96 ) are shown in detail in figure [ fig : pixelaccuracy ] . ]",
    "the image generation is shown in more detail for these example profiles in figure [ fig : pixelaccuracy ] .",
    "this shows the actual error as a function of pixel location on the two - dimensional image for the target model for both ` libprofit ` and galfit .",
    "figure [ fig : pixelaccuracydiag ] shows the one - dimensional pixel error across the central portion of pixels that incorporate the peak pixel ( which is usually the hardest to integrate accurately for the srsicprofile )",
    ". there are specific regions of pixels where galfithas smaller errors , but the general trend is that ` libprofit ` is more accurate over a large range of pixels , and never experiences large integration error in pixels that contain significant fractions of the profile flux . in the case of both",
    "` libprofit ` and galfitouter pixels might often have large relative error , but in these cases the pixels contain almost no flux and do not drive the overall model image to a large flux - weighted error .    exact image generated with cubic quadrature routine via cuba +         + error in approximate ` libprofit",
    "` image +         + error in approximate galfitimage +         +    error across central diagonal pixels +     +     +    as established in the design goals of ` libprofit ` , generating images accurately is important , but there is a trade - off to be made with the required computation time .",
    "it is unavoidable that some pixels will be harder to evaluate due to the rapid change in flux within a pixel ( especially true for the central pixel containing the peak of the srsicprofile flux ) , and more computing time will need to be spent on correctly evaluating the pixel flux . `",
    "libprofit ` uses adaptive recursion to adjust the integration resources as required in order to maintain a relatively constant level of pixel integration accuracy .",
    "this is evident from figure [ fig : imagetime ] , which compares the image generation times for ` libprofit ` and galfitfor the same srsicprofiles as presented in figure [ fig : fluxweighterror ] .",
    "it is clear that ` libprofit ` varies the integration time ( which is akin to more resources spent evaluating _ hard _ pixels ) more in order to maintain relatively constant flux weighted errors ( see figure [ fig : fluxweighterror ] ) , whereas galfitmaintains nearly constant integration times .",
    "pixels , @xmath93 degrees and @xmath94 in a @xmath97 pixel image . ]",
    "the computation times of ` libprofit ` and galfitfor srsicprofiles are investigated in more detail in figure [ fig : timevtime ] and figure [ fig : paramtime ] .",
    "for all of these tests the same macbook pro running el - capitan with 2.6 ghz i7 processors and 16 gb of ram was used . in figure",
    "[ fig : timevtime ] we see that ` libprofit ` is factors of a few faster compared to galfitfor most combinations of model parameters . in figure",
    "[ fig : paramtime ] we see there is weak dependence of computation time on @xmath6 and @xmath0 , and a strong dependence on axial ratio ( in all three cases larger means longer computation time for ` libprofit ` ) . for reasons not immediately clear galfitactually takes longer to compute compact models - perhaps because its integration scheme is not sufficiently adaptive .",
    "in general we find a wide range of potential computation times , spanning a factor of @xmath310 for ` libprofit ` versus @xmath33 for galfiteven though the target image is @xmath98 pixels in all cases .",
    "this makes it hard to predict in general how long a particular fit might take given the image size . in a pathological situation of the target galaxy having large @xmath6 , large @xmath0 and being circular in projection the computation could be a factor 10 longer than for the case of a compact galaxy with low @xmath0 and fairly elongated projection .",
    "pixel images .",
    "galaxy size ( 10 @xmath6 ) , srsicindex ( 11 @xmath0 ) , rotation angle ( 10 @xmath17 ) and axial ratio ( 10 @xmath99 ) were sampled on a grid , with 11,000 model images generated in total .",
    "the red lines show 1:1 , 1:2 , 1:3 , 1:4 and 1:5 relative speeds for the same target model image , ` libprofit ` being substantially faster in almost all situations . ]",
    "time to create @xmath100 pixel images +     +     +    it is possible to configure ` libprofit ` to exceed @xmath30.1% flux weighted image accuracy .",
    "this default was deemed appropriate for typical ( and certainly our ) uses of ` libprofit ` since it equates to 0.001 mag accuracy , which in practice far exceeds the systematic and random measurement uncertainties for even relatively high fidelity photometric images .",
    "it also allows for rapid image fitting since small gains in accuracy begin to take factors longer to compute .",
    "however , a combination of increasing the oversampling and recursion depth allows for arbitrarily high levels of integration accuracy should this be required by the user . by including a simple interface to the cuba library in the rprofitpackage for all six radial profile types , it is possible to tune these parameters in order to achieve the desired level of accuracy and speed .",
    "profit supports both brute - force convolution and fft - based convolution using the fftw library . in the rimplementation ,",
    "both methods are benchmarked and the optimal method for the given image and psf size is chosen .",
    "brute - force convolution is often significantly faster than fft - based methods but scales directly with image _ and _ psf size , being @xmath101 , whereas fft convolution is @xmath102 , accounting for necessary zero - padding .",
    "testing shows that both methods give nearly identical answers , with fractional differences of less than @xmath103 .",
    "one important consideration is that the accuracy of convolution depends on the resolution of the psf relative to the pixel scale .",
    "a poorly - resolved psf with a fwhm @xmath104 pixels may give flux errors on the order of a few percent for the innermost pixels .",
    "profitallows for model and psf oversampling for more accurate convolution , whereby the model pixel grid is subdivided by an integer factor ( preferably odd ) .",
    "this is independent of the oversampling for the purposes of accurate model convolution , and requires either an analytic psf or prior interpolation of the empirical psf .",
    "interpolating a noisy empirical psf offers a limited gain in accuracy , so for this reason ( and as mentioned in [ subsubsec : psf ] ) , analytic psfs are generally preferred . when this process is attempted",
    "empirically it is usually via stacking or drizzling of the data ( e.g.  with the use of a program like multidrizzle ) .",
    "accounting for pixel covariance when drizzling is a complex problem , and best handled by fitting the native resolution images simultaneously rather than attempting to combine them in an information - lossy process .",
    "simultaneous image fitting of multi - exposure data and covariance likelihoods are high on the list of future extensions to profit , but are not present in v1.0 ( although experimental covariance likelihoods are already being tested ) .",
    "having demonstrated that ` libprofit ` integrates and convolves analytic profiles quickly and accurately , the remaining ingredients for model fitting are the likelihood function and optimisation and/or likelihood sampling method . this logic is implemented in the profit rpackage .",
    "ris becoming increasingly widely used in astronomy and other fields of advanced data analysis , and since it features a large number of statistics packages and optimisation methods ( maximum - likelihood and bayesian ) , it is ideally suited for the purpose of bayesian galaxy image fitting .    having easy access to a wealth of optimisers was a key design goal of profit .",
    "a large subdivision of statistical data science and computer science has invested huge efforts into describing and implementing a multitude of optimisers that have a range of strengths and weaknesses . depending on the specific problem at hand",
    ", one optimiser might be preferred over another for reasons that are very hard for us to intuit .",
    "since this is such a key component of galaxy modelling , where a typical use case might involve fitting dozens of partly degenerate parameters , giving the user flexibility to experiment with optimisation engines was deemed critical .    in practice",
    "an initial global parameter search might be made using a fast but biased downhill gradient optimiser , or one which is known to get easily trapped in local minima . from this point a more expensive but robust markov chain mote carlo ( mcmc ) optimiser",
    "could be used to accurately refine the parameter posteriors ( this is the typical mode of operation recommended by the authors and described in detailed vignettes included with the rpackage version of profit ) . in the rimplementation alone",
    "the user has easy plug - and - play access to hundreds of optimisers accessible though the central r archive network ( cran ) with hundreds more served from online repositories ( e.g.  github ) .",
    "we do not wish to be overly prescriptive in how samplers are used to model data , but some typical applications will be discussed in the following sections .      a number of inputs are required to meaningfully fit a profile to a target galaxy observation . for good quality data where the whole image is to be used for fitting , the bare minimum is strictly an image where pixels contain integer photo - electron counts and an analytical description of the point spread function .    in practice ,",
    "a more complete set of inputs can include the flux image ( @xmath105 , in whatever linear units are appropriate ) , a segmentation map ( that is pixel matched to @xmath105 , where distinct integer values represent different detected structures in the image as per sextractor ) , a binary mask ( that is pixel matched to @xmath105 , where true means mask out and ignore for analysis , and false means do not mask ) and the @xmath106 image ( @xmath106 , that is pixel matched to @xmath105 , where values represent normal errors in the same units as for @xmath105 ) .",
    "the point spread function can be specified in two main ways : either via an analytical description using any of the available radial profiles ( in practice the moffat function is a good profile for this task ) , or with an image of the psf that is on the same pixel scale as @xmath105 .",
    "profithas a high - level setup function ( profitsetupdata ) that can take these basic inputs and create an internal object that is appropriate for fitting a profitmodel .",
    "there are a wealth of routes to compute meaningful image versus model likelihoods , depending on the data regime .",
    "if many ( i.e.  hundreds of ) photo - electrons are registered in pixels for the observed galaxy then the data is likely to be operating in the normal statistics regime , where profitlikelihoods can be computed with :    @xmath107    here @xmath108 represents the observed pixel data at pixel @xmath109 , @xmath110 represents a computed profitmodel at pixel @xmath111 and @xmath112 represents the estimated normal uncertainty at pixel @xmath113 .",
    "an alternative view is that cumulative sum of squared residuals should follow a @xmath114 distribution , with a profitlikelihood computed by :    @xmath115    here @xmath116 represents the degrees of freedom of the @xmath114 distribution . for fitting of this type",
    "this will usually be determined by the number of pixels containing galaxy flux ( here @xmath117 ) minus the number of parameters being used to fit the model to the data ( up to 8 in the case of a single component srsicmodel ) . in the regime of the statistics being truly normal and the model fitting well ( i.e. a reduced @xmath114 near unity ) , the normal and @xmath114 distribution likelihoods converge to similar results .",
    "the chief distinction is that the @xmath114 statistic penalises overfitting , since extremely small residuals across all pixels are highly unlikely .",
    "both statistics are sensitive to residuals significantly above the shot noise ( @xmath118 somewhat more so ) , such as non - axisymmetric features like bars , spiral arms and dust lanes .",
    "nonetheless , if the dominant source of uncertainty in the image is truly shot noise rather than systematics , and the signal - to - noise is high , the @xmath114 statistic is appropriate .",
    "however , if the count rates are relatively low , then the poisson statistics must be used . in this case , profitlikelihoods are computed with :    @xmath119    here @xmath120 is the expectation for the number of photo - electrons counted in at pixel @xmath113 , and @xmath108 is the integer number of photo - electrons recorded . dropping the @xmath121 term ( since it depends only on the data ) applies a global offset to log - likelihood , which makes no difference to any posterior inference since this is all computed in a relative manner .",
    "expressed in this form and multiplied by a factor of -2 we recover the `` cash '' statistic @xmath122 @xcite , which is similar to @xmath114 but for poisson statistics . in the same manner that @xmath123 for normal statistics , @xmath124 for poisson statistics .",
    "it is worth highlighting that returning images to true photo - electron counts is non - trivial and in our experience many published data sets do not produce enough ancillary information to return the images to true counts to better than an accuracy of a few factors .",
    "a particularly pernicious issue is that counts must be known within the ccd itself , not for photons at the top of the atmosphere .",
    "the latter is relatively trivial to compute after the fact if we know intrinsic properties of the source spectral energy distribution ; however , the former requires estimates of atmospheric transmission , instrumental losses , detector gain and quantum efficiency , etc .",
    "sometimes this information is easy to obtain at least approximately ( e.g.  for the sloan digital sky survey , sdss : * ? ? ?",
    "* ) , but this level of ancillary meta - data is in general rare",
    ". added to this is the fact that optical survey data generally has copious counts per pixel : typically thousands of photo - electric counts .",
    "for these reasons , poisson likelihoods should seldom be used for optical survey data , even if quite shallow .",
    "it is more appropriate for fitting x - ray data , where the counts are low and have the required meaning for poisson statistics .",
    "indeed , x - ray astronomy is the main subdivision that uses poisson ( usually in the guise of cash ) statistics .",
    "if the data is nominally in the normal statistics regime ( i.e.  many photo - electron counts per pixel ) , but in practice have a significant number of data points that are poorly represented by our attempted model ( typical when trying to fit smooth two - dimensional srsicprofiles to well - resolved galaxies with asymmetries ) then more robust student - t distribution statistics might be appropriate .",
    "these distributions are approximately normal in the core but have broad lorentzian wings that puts more likelihood mass at large distances from the normal core .",
    "this behaviour is controlled by the ` degrees - of - freedom ' , which in practice is not free and is instead estimated via maximum - likelihood from the data directly .",
    "the profitstudent - t likelihoods is be computed by :    @xmath125    profitgives the users easy access to all four types of commonly used likelihood statistics , and it is for the user to decide the most appropriate given the quality and type of data at hand . for high @xmath126 images of galaxies",
    "the student - t statistic behaves well over a broad regime given its robustness to outlier flux values . for this reason it is selected as the default option when setting profitup for fitting . in the future",
    "we will add covariance likelihoods ( more appropriate for for data that exhibits large amounts of pixel correlation , e.g. nir , see * ? ? ? * ) , but these are not present in v1.0 .",
    "once the observational data has been correctly assembled and the most appropriate type of likelihood statistic has been chosen , the user is free to fit a model image .",
    "profitrequires the user to suggest an initial parameterisation of the model , which need not be close to the optimal parameters with robust optimisers .",
    "the user is free to fix some components and fit others ( e.g.  they might wish to fix the disc srsicindex to 1 ) .",
    "they are also free to provide prior distributions for each parameter ( important for formal bayesian analysis ) , hard limits and/or constraints on the allowed fitting region , to specify whether parameters are optimised in log or linear space and to specify additional constraints between parameters ( e.g.  pair parameters together ) .",
    "the detailed process for specifying these options is provided in the profitmanual and example vignettes , so we will not repeat the full description here .",
    "once the fitting structure has been specified within profit(profitsetupdata , as mentioned above ) the user can interface with a number of popular optimisation routines .",
    "the r profitpackage provides examples of using the base optim function , the open source laplacesdemon package which gives access to gradient optimisers via laplaceapproximation and a large suite of markov chain monte carlo ( mcmc ) samplers via laplacesdemon , and the genetic algorithm cma - es package .",
    "these four routes to optimisation offer over a hundred distinct optimisers .",
    "the central r archive network ( cran ) collates packages that tackle particular problems types : optimisation and bayesian analysis task views suggest over a hundred additional packages which themselves potentially contain multiple algorithms .",
    "to the uninitiated this can seem daunting , but the reality is that a core few packages and optimisers give the user a solid foundation for a diverse range of fitting problems .",
    "sample vignettes provided in the rprofitpackage goes through some example fitting problems in detail , but we will summarise the approach here . the basic strategy for preparing the inputs for galaxy",
    "fitting is :    * required : read in an * image * of an observed galaxy ( in principle any format , but e.g.  fits ) , * optional : read in a * mask * with the same size , pixel scale and astrometry as the * image * , * optional : read in a * sigma * image with the same size , pixel scale and astrometry as the * image * , * optional : read in a * segmentation * map with the same size , pixel scale and astrometry as the * image * , * optional : read in a * psf * image with the same pixel scale as * image * , * required : read in an * initial * model list ( as detailed above ) , * optional : read in a list with the same structure as * initial * detailing which parameters profitwill * fit * ( the others will be fixed at their * initial * values ) , * optional : read in a list with the same structure as * initial * detailing which parameters profitwill fit in * log * space ( the others will be fitted in linear space ) , * optional : read in a function detailing the calculation of the * prior * log - likelihood , * optional : read in a list with the same structure as * initial * detailing the allowed * limits * for each parameter when fitting , * optional : read in a function detailing the calculation of additional * constraints * to apply to parameters , e.g.  pairing parameters together or making them scale relative to each other in a fixed manner , * required : all of the above two - dimensional matrix images , list structures and functions are provided to the high level profitsetupdata function that organises the information into an object of class * profit.data * ready for fitting with third party optimisation engines .",
    "once the user has created the * profit.data * object , which includes some additional options for choosing the type of likelihood and setting the verbosity of the fitting process , a basic strategy for fitting might look like :    * initially find a maximum likelihood galaxy model solution using the base r optim function using the broyden , fletcher , goldfarb and shanno ( bfgs : * ? ? ?",
    "* ) algorithm ( which is fairly robust to spurious minima ) , * take the solution from the bfgs optimisation as a starting point and use laplacesdemon component - wise hit - and - run metropolis ( charm ) to make mcmc samples of the likelihood space ( this is very robust to local minima , and can move large distances from poor solutions ; hence hit - and - run ) , * use diagnostic tools provided with the laplacesdemon package to test for the quality and convergence of the model fit , including tests for auto - correlation between parameters , the number of effective stationary samples and traditional parameter triangle plots , * assuming the fit is flagged as being well converged and well behaved the log marginal likelihood ( lml ) can be computed to aid comparisons between models .",
    "the above fitting process can be carried out for models of varying complexity .",
    "if they are well - converged then the lml computed can be used to calculate bayes factors between simpler and more complex models , offering an objective route for deciding how complex the model needs to be .",
    "the profitpackage includes 10 example data sets with all the required inputs for fitting .",
    "these examples use public sloan digital sky survey ( sdss ; * ? ? ?",
    "* ) and the kilo degree survey ( kids ; * ? ? ?",
    "* ) data for galaxies selected from the galaxy and mass assembly ( gama ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) survey that are at reasonably low redshift and are deemed to have multiple components ( as found in * ? ? ?",
    "the vignettes included with the software give examples of fitting this data using high - level rand pythoninterfaces .",
    "bulge component of galaxy fit : +   + disc component of galaxy fit : +   + bulge+disc components of galaxy fit : +   +    as a case study , figure [ fig : modelfit ] shows the quality of mcmc fit and residuals that are possible using profitfor g266033 .",
    "a qualitative assessment of the residuals shows that we are able to remove the major bulge and disc structural components , but that non - axisymmetric components remain ( the spiral arms in particular ) .",
    "the three rows of panels show the bulge ( top ) , disc ( middle ) and combined ( bottom ) components .",
    "the outputs of the charm mcmc sampling are shown in figure [ fig : modeltriangle ] . here",
    "only stationary samples are shown ( i.e.  there is no ` burn - in ' of the sampling ) , and whilst there is evidence of some weak covariance between some parameters ( e.g.  disc magnitude ( dmag ) and effective radius ( dre ) ) , in general the posteriors look well sampled and consistent with multivariate normal distributions .",
    "this latter characteristic is useful when estimating marginalised parameter errors .    using the rinterface to profit ,",
    "more quantitative information can be extracted from the fit .",
    "figure [ fig : modelfitchisq ] shows the output of the profitmakeplots function , which as well as producing the standard residuals , also outputs how they compare to a reference normal and student - t distribution .",
    "the @xmath114 excess is also demonstrated with respect to a @xmath114 distribution with one degree - of - freedom .",
    "finally , a residual image scaled by the pixel error @xmath106 is provided .",
    "this shows that there are some significant residual spiral arm structures that are highly unlikely from the point of view of the idealised generative model we are fitting .    as discussed in the introduction",
    ", it is common in the field of galaxy modelling to collapse two - dimensional data into a one - dimensional form . whilst profitdoes not evaluate likelihood using this one - dimensional form ,",
    "it does provide a functions for producing such isophotal data and the associated plots ( profitellipse and profitellipseplot ) .",
    "in brief these functions use the geometric parameters of the disk and bulge components of a simple two - component model to extract isophotal annuli , allowing for the standard geometric distortions such as ellipticity and boxiness ( if present ) . the one - dimensional profile of g266033 with overlaid model fits is shown in figure [ fig : modelfitoned ] .",
    "error region for the data pixels , and ideally the total model ( green line ) should sum to follow this distribution quite closely . at a few radii",
    "the data and model are in some tension ( at the 0.1 mag level in surface brightness ) , but for the majority of the profile they agree very well . ]    given the residual flux not replicated by the model , the question remains how representative any posterior error distributions might be . to estimate the impact an imperfect model can have on the returned posterior error estimates ,",
    "the residual is subtracted from the initial image .",
    "figure [ fig : modelfitchisqmod ] shows the effect of fitting such an input where the image noise has been added back in via poisson sampling of the convolved model image .",
    "the residuals almost entirely disappear , and the @xmath106 scaled residuals show no radial structure at all . comparing the posteriors to the original input data and the residual - removed input data ,",
    "the former has typical marginalised posterior errors for each parameter that are a factor of @xmath32 _ larger _ ( spanning the range 1.33 ) with best fit values that agree to within 1% .",
    "this is encouraging , since it suggests in this particular case , where profitis correctly identifying the major structural components , the presence of non - axisymmetric components creates posteriors with larger errors .",
    "how such fitting behaves will depend on the data at hand ( i.e.  this should not be assumed to be true in general ) , but such a test is easy to implement , and should be part of a standard profitworkflow .",
    "as mentioned above , the r profitpackage comes with 10 fairly isolated example galaxies included that have imaging from sdss and kids .",
    "all of these are well resolved galaxies taken from the gama survey where we already have well converged bulge and disc fits from @xcite . to create this sample 40 galaxies from @xcite",
    "were randomly sampled and these were ranked in terms if fit - ability ( removing galaxies with more complex backgrounds and nearby sources ) .",
    "of these the 10 largest were chosen as example galaxies .",
    "as such this sample , whilst small , is broadly representative of how common different classes of bulge - disc systems are ( e.g.  we are dominated by lower @xmath127 systems ) .",
    "consistent sky subtractions were made using lambdar @xcite , and segmentation maps and psfs were created using an updated version of sigma @xcite .",
    "we then proceeded to fit these 10 galaxies using both sdss and kids inputs , and using profitand galfit .",
    "the free parameters used throughout were @xmath128 and @xmath129 centres , bulge mag , @xmath6 and @xmath0 ( @xmath99 for the bulge was fixed to be 1 ) , and disc mag , @xmath6 , @xmath99 and @xmath17 ( @xmath0 for the disc was fixed to be 1 , i.e.  exponential ) .",
    "the input parameters were taken from the fits in @xcite , although it should be noted that profit(used in full mcmc mode ) is largely insensitive to the inputs used , as long as the total input magnitude is approximately correct ( i.e.  within a couple of magnitudes of the correct value ) . used in pure downhill gradient mode profitsuffers from similar local minima issue to galfit(see the discussion of galfitconvergence in * ? ? ?",
    "the full range of comparison figures are included in appendix [ app : consist ] . here",
    "we compare how well these different combinations of decomposition codes and data sources affect the returned values for bulge and disc magnitudes .",
    "figure [ fig : compmagb ] compares the agreement between estimated bulge magnitudes .",
    "the one major disagreement between codes is the faintest bulge measured . in profitthe decomposition preferred removing the bulge entirely , often hitting our specified lower limit of 30 mag . using galfit",
    ", the code does not allow the solution to move huge distances from the initial estimates unless the likelihood terrain is very smooth , which occurs only when the model reproduces the data with no clear residuals .",
    "figure [ fig : sdssdecomp ] shows the fit and residuals for the profitfit for this galaxy , suggesting there is little need for any bulge at all .",
    "otherwise the main conclusion that can be drawn is that the codes correlate tightly , and so do the data sets , but in all cases the scatter is much larger than the errors suggested by galfitor profit . although the errors returned by profitwere consistently larger for these galaxies , they are still smaller than the points in the panels .",
    "a general remark is that we find more consistency between codes than between data sets .",
    "removing the outlier galaxy g266035 , we measured the intrinsic scatter using the hyper - fitcode of @xcite and find it to be reduced by more than a factor of two .",
    "it is at a minimum for the sdss data ( 0.14 dex versus 0.20 dex scatter orthogonal to the 11 line ) , suggesting that some aspect of our data processing is more internally consistent for sdss data",
    ". this might be the background subtraction or the psf determination .",
    "figure [ fig : compmagd ] compares the agreement between estimated disc magnitudes . in general",
    "we find more self - consistent fits for discs both between codes and between data . whilst the smallest intrinsic scatter is again found for sdss using profitand galfit , the results for profitusing sdss and kids are not far behind",
    ". the intrinsic scatter for kids using profitand galfit , and galfitusing sdss and kids are notably worse ( the latter showing the most scatter ) .",
    "for all these fits we find that the profitmcmc solution provides a _ more likely _",
    "fit both when forcing the profitparameters through galfit , and when forcing the galfitparameters through profit . usually the increases in likelihood when using profitare substantial , suggesting the difference is due to local convergence issues with the levenberg - marquardt @xcite algorithm built into galfit , rather than issues to do with model accuracy that we explored in section [ sec : profit - acc ] .",
    "a general conclusion is that we appear to be able to recover more self - consistent results for disc properties compared to bulge properties .",
    "further evidence for this is shown in appendix [ app : consist ] , where disc @xmath6 is found to be more reliably measured than bulge @xmath6 .",
    "bulge @xmath0 is notably the hardest property to measure consistently , a finding in agreement with recent work by @xcite .",
    "we investigate in more detail how well we expect to be able to recover various bulge - disc properties for different quality and depth data in the next section .",
    "having described and tested our new profitdecomposition code in some detail , we finally investigate how it performs on data of different depth and quality . for the purposes of these tests we create and fit bulge - disc systems in @xmath130 arc - second image stamps .",
    "we investigate three sources of survey imaging that are indicative of the types of data that profitwill be used on en - masse in the future : sdss , kids and lsst . since these results are purely indicative we make some simplifying assumptions for the three surveys .",
    "table [ tab : surveys ] presents the assumptions made when simulating and fitting the galaxies .",
    "these are not precisely the values advertised for the various surveys , but are indicative given the inevitable variations in data quality .",
    "for lsst these estimates are for the stacked five - year survey .",
    "since we know the precise psf used to convolve the model and the images themselves are precisely background subtracted , the following results are the upper - limits on the decomposition performance we can hope to expect .    the simulations themselves sample 10,000 profiles from a uniform grid of total magnitude ( @xmath131 ) , bulge fraction ( @xmath132 ) , logarithmic bulge effective radius ( @xmath133 ) , logarithmic disc effective radius ( @xmath133 ) , logarithmic bulge srsicindex ( @xmath134 ) and disc axial ratio ( @xmath135 ) .",
    "the bulge axial ratio was assumed to have @xmath136 and the disc srsicindex was fixed to @xmath8 .",
    "profitnever appears to struggle to find the correct disc angle @xmath17 , so we only simulated galaxies with the minor axis varying on the @xmath128-axis of the image .",
    "note we do not impose internal correlations between parameters , so these results span an overly generous range of structural parameter space .",
    ".assumed image quality parameters for different surveys .",
    "[ cols=\"<,<,<,<\",options=\"header \" , ]     [ tab : surveys ]     rather than magnitude , i.e.  @xmath137 ) .",
    "the solid lines show the median of the results , and the dotted show the @xmath138 and @xmath139 percentile ranges ( akin to the @xmath140 range if the distributions are normal ) . in simple terms , larger value are better in the top panel and lower values are better in the bottom panel . ]",
    "figure [ fig : converge_frac ] shows the results of these simulations in a compact manner , comparing the fraction of fits that are found to converge ( which means they find solutions that are not hard limits imposed within profit ) and the typical average separation between all input and output parameters in log - space .",
    "these properties are plotted for all major observables in appendix [ app : sims ] , but here we show the results versus the most observable input parameter : the total magnitude of the galaxy . unsurprisingly , all the results are best when the galaxy is intrinsically bright and the source signal dominates over the sky background . of perhaps more surprise",
    "is that we see a large improvement in decomposition performance when moving from sdss to kids quality data , but a relatively minor improvement when we move from kids to lsst .",
    "this appears to be due to the major improvement being limited to surface brightness depth , the pixel scale and the typical psf fwhm is not expected to be much ( if at all ) improved between kids and lsst ( one caveat being the latter has a much larger field - of - view , so further un - simulated sky - subtraction gains could be expected ) .    to briefly summarise the other trends presented in the appendix : lower bulge and disc @xmath6 , lower disc @xmath99 , lower bulge @xmath0 and a moderate @xmath141 all lead to improved fitting results . for @xmath6",
    "this is simply because lower @xmath6 means high surface brightness for a given magnitude , and the components become easier to distinguish against the background .",
    "we start our simulations at an @xmath6 of 1 arc second , so the caveat to make is that much below this ( @xmath6 less than half the psf fwhm ) , and the parameters become indistinguishable structurally . even in this regime",
    "we can still expect the component magnitude to be well recovered , it is just hard to resolve structure inside the psf scale .",
    "it is clear from these results that only in the most favourable regimes can we expect complete _ and _ robust bulge - disc decompositions , even using the best current and next generation deep survey data .",
    "this is true even when we are operating in the regime of moderately low redshift galaxies extracted from surveys such as gama .",
    "a future low - redshift focussed waves - wide survey @xcite , being inherently lower redshift due to its photo-@xmath142 pre - selection ( with typical redshift likely to be similar to sdss dr10 ) is the best prospect for such future studies given the target of high redshift completeness , and a guarantee it will have deep good quality imaging data ( since kids will act as the primary input source for targets ) .",
    "in this paper we have presented our new publicly available galaxy modelling and decomposition code profit .",
    "the core code comes in a standalone c++ library ( ` libprofit ` ) that allows for easy access to higher level languages ( e.g. rand python ) through a simple api .",
    "the core advances that profitoffers over currently available software are that it :    * is fully open - source with multiple active developers , * offers a standalone library ( ` libprofit ` ) for accurate and fast pixel integrations when generating a model , * can be extended with new profiles in a simple well - documented manner , * allows for simple or complex priors on parameters ( an important aspect of bayesian analysis ) , * offers a range of likelihood calculations , * is untied to any specific optimisers but has easy access to downhill minimisation , genetic algorithm and mcmc routines , * can fit parameters in log or linear space , * allows for simple or complex additional constraints between parameters , * offers brute - force and fft psf convolution options , with automatic benchmarking to select the fastest strategy .",
    "initially profitcomes in three varieties : an fully featured rpackage ( profit , discussed in detail in this paper ) , a basic python wrapper ( pyprofit ) and a command line terminal interface ( profit - cli ) .",
    "the rpackage is the most advanced in terms of features , and we have a longer term aim to bring the pythonpackage up to the same level of sophistication .",
    "the command line interface only exists for the easy generation of model images via calling the underlying ` libprofit`library , so it does not provide any built - in optimisation . by separating the model image generation ( which should be an objective black - box task achieved through an api ) into a separate ` libprofit`library",
    ", users are not tied to our high - level solution for the much more subjective problem of galaxy fitting ( with many caveats over masking , convolution , likelihoods etc ) .",
    "we are aware of at least one community fork of ` libprofit`already that makes use of diffusive nested sampling ( dnest ; * ? ? ?",
    "* ) in order to overcome sampling of highly multi - modal data ( huijser et al .",
    ", in prep . ) .",
    "extensions to other languages using the library api are encouraged , but simpler workarounds using the command line interface are also possible for less programming - savvy users . to avoid community confusion we request that any forks that are released append the name in some manner ( e.g.  profit_stan ) .",
    "the aim would be to pull any substantial and useful changes into the main profitbranch in the longer - term .",
    "the first versions of the profitcode stemmed from preliminary work by asgr . following this ,",
    "dst and rt have added many new features and have heavily modified and expanded the functionality of the software . from the early stages",
    "profithas been designed in a highly modular manner .",
    "this is important to prevent the user becoming limited to our default choice of profile , likelihood evaluation or optimisation method .",
    "the core ` libprofit`library is designed to be fast and accurate at integrating and convolving target model images , where the likelihood function to compute , and optimisation engine to use , are largely choices for the user via higher level interfaces .",
    "the rpackage version of profitcontains a large number of examples using simple downhill gradient schemes , more complex genetic algorithms and more computationally expensive mcmc techniques .",
    "users are encourages to build from these examples to use more or less sophisticated engines as appropriate .",
    "the various libraries and higher level interfaces are all available on github , and future support and functionality will be added through these repositories .",
    "this paper necessarily refers to a static v1.0 of profit , as such specifics regarding operation and options should be derived from the public repositories and documentation found there , rather than this text .",
    "the most reliable longterm location for the base ` libprofit`library is https://github.com/icrar/libprofit .",
    "the higher - level rimplementation of profitis available at https://github.com/icrar/profit and the python variant is maintained at https://github.com/icrar/pyprofit .",
    "this paper was written using the rimplementation exclusively .",
    "community use and feedback is encouraged , especially via raising _ issues _ and _ pull _ requests through github .",
    "in particular , the requirements outlined in section [ section_introduction ] are not an exhaustive list , so users are encouraged to submit feature proposals and requests .",
    "currently planned extensions include built - in support for monte carlo image generation , simultaneous fitting of multiple images ( in the same band ) and/or multiple bands , zero - point calibration , covariance likelihoods and psf fitting .",
    "indeed , the rpackage already includes a vignette with psf fitting examples , a full description of which is omitted here for brevity .",
    "in this paper we have investigated the application of profitto both sdss and kids data , using galfitreference runs as a comparison . in pragmatic terms , profitand galfitachieve consistent results",
    "given the same input data , with at least as much scatter being produced by changes between data source ( in this case sdss versus kids ) .",
    "this is encouraging in that it validates the broad findings of recent work that made exclusive use of galfit , and lends credibility to our future applications of profitto a number of different data sources .",
    "the main difference is a large degree of intervention was required when running galfit via running on a large grid of initial conditions and post - processing the results ( see * ? ? ?",
    "* ) , whereas profitwas run by am with just a basic wrapper using one of the many available mcmc routines in rand converged to reasonable global solutions with little user intervention .",
    "much of the work presented here was made possible by the free and open rsoftware environment @xcite .",
    "all figures in this paper were made using the r magicaxis package @xcite .",
    "data from the kids @xcite and sdss @xcite surveys were used for this work .",
    "funding for sdss - iii has been provided by the alfred p. sloan foundation , the participating institutions , the national science foundation , and the u.s .",
    "department of energy office of science .",
    "the sdss - iii web site is http://www.sdss3.org/. parts of this research were conducted by the australian research council centre of excellence for all - sky astrophysics ( caastro ) , through project number ce110001020 .",
    "credit to e. mannering for figure [ fig : pixint ] , she was inspired by the lamentable initial efforts of asgr . thank you to the anonymous referee , whose comments particularly assisted in clarifying complex parts of the paper .    1",
    "to supplement figures [ fig : compmagb ] and [ fig : compmagd ] , below are the various other profit , galfit , sdss and kids comparisons for the 10 galaxies that are included in the standard rprofitinstallation for demonstration and testing purposes .",
    "for the 10 well resolved galaxies included with the rprofitpackage .",
    "see figure [ fig : compmagb ] for details . ]     for the 10 well resolved galaxies included with the rprofitpackage .",
    "see figure [ fig : compmagb ] for details . ]     for the 10 well resolved galaxies included with the rprofitpackage .",
    "see figure [ fig : compmagb ] for details . ]     for the 10 well resolved galaxies included with the rprofitpackage .",
    "see figure [ fig : compmagb ] for details . ]     for the 10 well resolved galaxies included with the rprofitpackage .",
    "see figure [ fig : compmagb ] for details . ]     for the 10 well resolved galaxies included with the rprofitpackage .",
    "see figure [ fig : compmagb ] for details . ]",
    "but for bulge magnitude on the x - axis . ]"
  ],
  "abstract_text": [
    "<S> we present profit , a new code for bayesian two - dimensional photometric galaxy profile modelling . </S>",
    "<S> profitconsists of a low - level c++ library ( ` libprofit ` ) , accessible via a command - line interface and documented api , along with high - level r(profit ) and python(pyprofit ) interfaces ( available at github.com/icrar/libprofit , github.com/icrar/profit , and github.com/icrar/pyprofit respectively ) . </S>",
    "<S> r profitis also available pre - built from cran , however this version will be slightly behind the latest github version . ` </S>",
    "<S> libprofit`offers fast and accurate two - dimensional integration for a useful number of profiles , including srsic , core - srsic , broken - exponential , ferrer , moffat , empirical king , point - source and sky , with a simple mechanism for adding new profiles . </S>",
    "<S> we show detailed comparisons between ` libprofit ` and galfit . ` </S>",
    "<S> libprofit`is both faster and more accurate than galfitat integrating the ubiquitous srsicprofile for the most common values of the srsicindex @xmath0 ( @xmath1 ) .    </S>",
    "<S> the high - level fitting code profitis tested on a sample of galaxies with both sdss and deeper kids imaging . </S>",
    "<S> we find good agreement in the fit parameters , with larger scatter in best - fit parameters from fitting images from different sources ( sdss vs kids ) than from using different codes ( profit vs galfit ) . </S>",
    "<S> a large suite of monte carlo - simulated images are used to assess prospects for automated bulge - disc decomposition with profit on sdss , kids and future lsst imaging . </S>",
    "<S> we find that the biggest increases in fit quality come from moving from sdss- to kids - quality data , with less significant gains moving from kids to lsst .    </S>",
    "<S> [ firstpage ]    galaxies : statistics  galaxies : structure  methods : statistical  techniques : photometric  galaxies : fundamental parameters  methods : data analysis </S>"
  ]
}