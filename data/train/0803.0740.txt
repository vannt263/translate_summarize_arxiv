{
  "article_text": [
    "ngc 6397 and m4 are by far the two closest globular clusters , and thus the places where we can hope to study the faintest old stars . in go-5461 and go-8679 ,",
    "richer et al .  (",
    "1997 ) used the wfpc2 camera on board the _ hubble space telescope _ ( _ hst _ ) to study the faint population of m4 . in 2005 , our program go-10424 used a similarly large number of orbits with a much more sensitive detector ( the advanced camera s wide field channel ) to probe the faintest red dwarfs and white dwarfs in ngc 6397 .",
    "the program , and its initial results , are described by richer et al .",
    "( 2006 ) .    here",
    "we present , in support of the detailed papers that have already been published ( richer et al .",
    "2006 , hansen et al .",
    "2007 , kalirai et al .  2007 ) and others that will follow , the reduction procedures that we used for this massive data set .",
    "the goals of this reduction are simple :  find and measure the faintest stars in the field , and assess the completeness of our list .",
    "nonetheless , there are many complications that arise . for instance",
    ", when searching for faint stars among stars that can be 20 magnitudes brighter , it can be very hard to separate the plentiful psf artifacts from the relatively few faint stellar sources .",
    "also , at these faint magnitudes ( @xmath0 ) , there is a large population of barely resolved background galaxies which must be distinguished from the true stars",
    ".    our general approach here will be first to identify everything that could possibly be a faint star , then to subject this list to careful selection criteria that leave a list of objects that seem to be truly stellar .",
    "although our reduction here is specific to this particular data set , we believe that our procedures will also be useful for other large _ hst _",
    "data sets where the aim is to find the faintest objects possible .",
    "ground - based projects that have similar large data sets may also benefit from this approach .",
    "the paper is organized along the lines of the reduction procedure itself . in section [ sec.obs ]",
    "we describe the observations , and in   [ sec.prelim ]",
    "we describe a number of preliminary reduction steps .",
    "section [ sec.find ] describes the finding procedure , leading to a list of sources to be measured .",
    "the measurement of magnitudes and positions is described in   [ sec.phot ] , and",
    "  [ sec.weed ] describes several successive procedures for eliminating non - stellar objects .",
    "section ",
    "[ sec.finallist ] covers the construction of the final stellar sample . in   [ sec.compl ]",
    "we use our measurement of artificial stars to estimate completeness . then ",
    "[ sec.pms ] is devoted to the derivation of proper motions and their use .",
    "a final section summarizes the reductions and the many scientific applications .",
    "_ hst _  program go-10424 ( p.i .",
    "richer ) was taken during 126 orbits between 13 march and 8 april 2005 .",
    "we observed a single field , 317 e and 393 s of the cluster center .",
    "we wanted a field whose density was high enough to give us a good number of white dwarfs , but not so high that the background from the bright stars would prevent us from finding the faintest stars .",
    "this particular field has deep archival observations from 1994 and 1997 , with which we can measure proper motions , and use them to remove field stars .    in order to go as faint as possible , we chose the wide - band filters f606w and f814w .",
    "previous work had indicated that the faintest cluster stars would be white dwarfs , so we balanced the exposure lengths so as to be an optimum at the color of faint white dwarfs . in each orbit we took two long exposures in f814w and one in f606w . because the color of scattered earth light is such that the f606w band is more vulnerable to it , the f606w exposure was always in the middle of the dark side of the orbit , when the sky is darkest",
    "there were 126 exposures in f606w , of length 616 to 769 seconds , totaling 93,442 sec ; in f814w there were 252 exposures , whose lengths ranged from 616 to 804 sec , with a total of 179,704 sec .",
    "the individual exposures were dithered , by integral pixels plus fractions of a pixel .",
    "we also took in each filter six short exposures , of lengths 1 , 5 , and 40 sec ( two of each ) . for each image the _ hst _  pipeline provides a bias - corrected and flat - fielded flt image , along with a drizzled drz image ( as explained in the _ acs data handbook _ ) .",
    "we carried out our final measurements on the flt images only , but we used the first drz image to provide a reference frame , and the first pair of drz images for photometric zero points .",
    "in this section we describe a number of procedures that we had to go through before carrying out our full reduction :  the mapping of warm pixels , the construction of psfs , the determination of the transformations from each exposure into the reference frame , the creation of image stacks , and the preparation of an additional set of images that have artificial stars added into them .      because the accuracy at which we were aiming required that we correct many more warm pixels than are flagged by the reduction pipeline , we constructed and applied our own warm - pixel mask .",
    "( our dithering made this possible , by causing a warm pixel to fall successively in different parts of the scene . ) to identify warm pixels , we compared each pixel in each exposure against the local background .",
    "any detector pixel that was more than 4-sigmas bright ( or dim ) in at least half of the exposures was flagged as bad .",
    "our warm - pixel list had 84,846 pixels , amounting to 0.5% of the detector .",
    "since the number and characteristics of warm pixels change with time , we are not including the list here , nor describing it in detail , although it is available from the first author by request .",
    "all of our measurements of star images were made by least - squares fitting of a psf .",
    "for this we used an effective psf , as originally defined by anderson & king ( 2000 , ak00 ) , and generalized for the wfc ( anderson & king 2006 , ak06 ) .",
    "briefly , the effective psf is a continuous two - dimensional function , @xmath1 , which tells us what fraction of a star s light will fall within a pixel that is offset from the star s center by @xmath2 .",
    "we tabulate our effective psf model on a grid in @xmath2 space , and evaluate the psf in between these points by bi - cubic interpolation .",
    "a complication of the wfc psf is that it varies with position on the detector .",
    "a small part of the variation is caused by optical aberrations , but most of it comes from charge diffusion , whose amount depends on the local thickness of the detector ( krist 2003 ) .",
    "we found in ak06 that we could model the wfc psf quite well with an array of 9@xmath35 fiducial psfs over each of the two 4096@xmath32048-pixel chips .",
    "we used the procedures in ak00 to construct such a time - average psf for each filter , using the 252 dithered f814w images and the 126 dithered f606w images .",
    "in addition to its spatial variation , we found in ak06 ( which was based partly on these data ) that the psf also varies by a small amount from exposure to exposure , most likely due to thermal breathing or pointing instabilities .",
    "this temporal variation of the psf is typically such that the fraction of light in the central pixel of a star which is centered on a pixel can range from 18% to 22% in f814w , and by similar amounts in f606w .",
    "fortunately , the variation across the chip seems to be largely constant with time , so that one can construct for each individual exposure a single `` perturbation '' psf that can be added to the spatially variable psf described above , to provide more accurate psfs for that image .",
    "there is a fundamental difference between bright stars and faint stars .",
    "bright stars can be easily identified in almost every exposure , whereas in some images faint stars may not stand out above the noise . to find and measure the faint stars , we will need to analyze all the exposures together .",
    "we therefore need a way to transform from positions in each exposure into the adopted reference frame , and vice versa .",
    "so in this section we will first analyze the relatively bright stars to establish the astrometric and photometric transformations from each exposure into a reference frame .",
    "we chose the first drizzled image ( j97101bbq_drz.fits ) as the astrometric basis for the reference frame , since drz images have been corrected for distortion .",
    "its image header also allows us to map pixel coordinates into ra and dec .",
    "our psf model is appropriate for flt images , but not for drz images , so we measured simple centroid positions for a few hundred bright but unsaturated stars in this image .",
    "these positions will serve to specify the orientation , scale and zero point of the reference frame .",
    "next , we needed to measure positions for the bright stars in each exposure , so that we could relate each exposure to the reference frame .",
    "for this , we use the psfs described above and the fortran program img2xym_wfc.09x10 ( which is described in ak06 ) to measure positions and fluxes for the sources with more than 100 counts in each exposure .",
    "we then found the common stars between each image list and the reference list above , and used their coordinates in the two systems to define a general 6-parameter linear transformation from the distortion - corrected frame of each exposure into the reference frame .",
    "the centroid positions that originally defined the reference frame were not very accurate .",
    "so , in order to replace them with more accurate measurements , we used the above transformations to collate the individual star lists in the reference frame , identifying a star wherever 180 out of 252 f814w lists found a source .",
    "we found 7,840 such bright stars and determined for each an average position in the reference frame .",
    "these positions are much more accurate ( in a relative sense ) than the centroid positions from the drz image , so we adopted these average positions as the new reference frame .",
    "we then constructed new transformations from each exposure into the improved reference frame . with these new transformations",
    ", we again found improved average reference - frame positions for each star .",
    "the rms residuals about these average positions were now less than 0.01 pixel in each coordinate , and the photometric residuals were about 0.01 magnitude for the bright stars ( s / n@xmath4100 ) .",
    "these small residuals confirm that we now can transform transparently from the individual exposures into the reference frame , and vice versa .    now",
    "that we had an accurate reference frame , we repeated the above bright - star finding for the f606w exposures , and constructed average f606w magnitudes for the stars as well .",
    "the instrumental photometric zero points were set to correspond to the first exposure of each filter .",
    "since the photometry routine automatically measures saturated stars , we include the saturated stars in this list , but we keep in mind that only the stars fainter than @xmath5 ( instrumental magnitudes , @xmath6 ) are reliably measured .",
    "( for most of this paper , we will keep our photometry in the instrumental system , since it is a more natural system for evaluating photometric quality in terms of signal - to - noise .",
    "we will calibrate the phtometry in ",
    "[ ssec.zp ] . for convenience ,",
    "we provide the calibrated scale on many of the plots . )",
    "figure  [ fig.bright ] shows the cmd for the stars found this way .",
    "the photometry and astrometry in this list are essentially the best that can be done for the brighter stars , since we can fit for both their position and flux in each individual exposure .",
    "the rest of this paper will focus on how best to measure the fainter stars , making use of the transformations established by the brighter stars .",
    "although all our final measurements were made on the individual exposures , it was useful to construct stacks so that we could examine the images of stars and galaxies that were hard to see clearly in individual images .",
    "the stacks were invaluable in helping us discriminate between objects the computer should classify as a star , and objects that should be rejected as a galaxy or psf artifact .    since the raw flt images were undersampled , we decided to supersample the stack by a factor of two in each coordinate .",
    "( to avoid confusion between pixels of a stack and pixels of an image , we will refer to the pixels of the stack as subpixels . )",
    "the average number of image pixels contributing to the evaluation of each subpixel of the f814w stack was 252/4 = 63 ; for the f606w stack the number was of course half as large . to cover the reference frame fully ,",
    "the stack was 8500@xmath38500 subpixels .",
    "there is no unique way to combine many exposures into one stacked image .",
    "drizzle ( fruchter & hook 2002 ) provides one approach , lauer ( 1999 ) another .",
    "different approaches preserve different properties ( e.g. , sampling , flux , etc . ) .",
    "since we use the stack in a qualitative rather than a quantitative way , the details of how we constructed the stack are not terribly important .",
    "briefly , we used the transformations found in the previous section to determine where each pixel in each exposure mapped into the stack frame .",
    "the photometric component of the transformations scaled each exposure to match the first exposure .",
    "as an initial estimate of the stack , we took the @xmath7 f814w and @xmath8 f606w pixels that mapped into each subpixel and assigned that subpixel the sigma - clipped average value .",
    "this is akin to using drizzle with @xmath9=0 .",
    "this initial guess could suffer from sampling biases if the dither does not cover each pixel evenly .",
    "so we iterated the procedure once .",
    "we used the transformations to resample the stack into the frame of each exposure . the difference between the actual exposure and this simulated image is an indication of how this image would influence the stack to change .",
    "we then adjusted each subpixel in the stack by the sigma - clipped average of the f814w and f606w residuals that mapped into it .",
    "these stacks served as approximate mean images that made it easy to examine any region in the field .",
    "even though the stack - construction procedure was flux - conserving and the final resolution is nearly nyquist sampled , we found that photometry on the stacks was not as accurate as simultaneous photometry using all the individual images together .",
    "this is probably due to the fact that we have an exquisitely accurate psf model for the flt images , but no appropriate psf for the stack ( such a psf would be complicated by the resampling process inherent in the creation of the stack ) .",
    "figure  [ fig.stack.comp ] compares a portion of the stack with a single exposure .",
    "it is clear from this image that there are many non - stellar features in the field , such as galaxies , psf artifacts , and diffraction spikes , which an automated searching routine could easily confuse with stars .",
    "one tends to think of the addition of artificial stars ( ass ) primarily in conjunction with completeness tests .",
    "we did indeed use as tests for that purpose , but they also played a crucial role in helping us develop our finding and measuring strategy .",
    "in addition , the large number of as tests we performed allowed us to model the distribution of observed stars in the wd region in terms of the input distribution ( see hansen et al .",
    "2007 ) .",
    "we wanted to insert as many artificial stars as possible in a single run , so as to minimize the number of runs necessary .",
    "the main considerations in performing as tests are ( 1 ) that they be treated in an identical manner to the real stars and ( 2 ) that they not interfere with each other , thereby affecting the crowding conditions they are intended to measure .",
    "so , we constructed a grid of positions in the reference frame , with a separation between nearby stars of 10 pixels in each direction . since the faint stars we are considering affect only a handful of pixels , there is no way they will interfere with each other .",
    "we inserted the stars with a flat luminosity function in f814w between magnitudes @xmath10 and @xmath11 , and with an f606w magnitude that placed the star on the white dwarf cooling sequence ( wdcs ) .",
    "as it turned out , we used only the f814w images for finding and for image discrimination , so that the choice of as colors did not not affect our completeness estimates .",
    "we tilted the grid by 5 degrees , in order to avoid alignment with rows and columns of the detector .",
    "finally , to ensure that the artificial stars were reduced the same way as the real stars we added each artificial star to each of the 252 + 126 flt individual exposures as follows : we transformed the location and flux of each artificial star into each exposure , and added a scaled version of the psf with the appropriate noise .",
    "the total number of artificial stars in the pattern was 176,644 .",
    "we also made a stack image from the as images in each filter .",
    "we were thus able to carry out on the as images every procedure that we used on the real - star images .",
    "figure  [ fig.artstack ] shows a portion of one of the stacks of as images .",
    "the goal of this reduction is to arrive at the most complete possible list of positions and fluxes for stars in the field , along with an estimate of the incompleteness of the sample .",
    "the need to assess incompleteness means that we must have an automated finding algorithm which can be applied to the artificial stars in a fashion identical to the way we handle the real stars .",
    "this automated finding algorithm must be able to identify the faintest possible stars , while at the same time ensuring that non - stellar objects will not find their way into the sample .",
    "we therefore divide the list - construction task into three steps : finding , measuring , and weeding .",
    "our first step is to go through the data set and find all features that could possibly be stars .",
    "we then measure positions , fluxes , and other properties for each of these objects .",
    "finally , in the weeding stage , we examine the surroundings and shape of each in order to remove those that are likely not to be genuine stars . the present section covers the initial finding .",
    "the first task is to find all of the features that could possibly be stars . at this point , it is worthwhile to consider what effect a barely detectable star will have on this data set . since the wfc images are slightly undersampled , a large fraction of each star s flux will be concentrated in its centermost pixel . in a single exposure , a faint star may or may not be able to push its central pixel above the noise . if the star is so faint as almost never to do so , then there is no way we will detect it .",
    "however , if it can a generate a local maximum in a statistically significant number of images , then we have some chance of detecting it .",
    "we therefore begin by defining a local maximum as any pixel that is higher than any of its eight neighbors .",
    "such pixels are very numerous  on average , one pixel in nine , in any region that is mostly background noise  but if a local maximum occurs in the same place in many exposures , it is an indication of the presence of a faint star .",
    "the challenge in finding the faintest stars , then , is to search for places in the field where there are significantly more local maxima than we would expect from random noise alone . as we have said , with a low detection threshold we will catalog a large number of spurious peaks , but we are willing to accept them and then weed out the spurious ones , thereby reaching deep into the noise to detect stars that we can find only because we have so many exposures of the same region .",
    "to identify these candidate stars , we construct what we call a `` peak map . ''",
    "this is a map of how often a local maximum occurred at a particular place in the field . to construct this map",
    ", we go through each of the 252 f814w exposures pixel - by - pixel .",
    "each time we find a pixel to be a local maximum , we use the transformations to calculate the corresponding location in the reference frame , and add one count to the closest peak - map pixel .",
    "we sampled the peak map in the same way as the stack , with pixels that are half the linear size of the image pixels so that the peak - map pixelization would not affect our resolution .",
    "( as an example of how we used our list of warm pixels , we did not allow any of them to contribute to this peak count . )    a faint star",
    "does not make a local peak in every image , and random peaks add a background level of @xmath12 ( the division by 4 because of the supersampling ) ; but even with this background , faint stars stand out in a statistically significant way .",
    "a non - stellar object such as a galaxy with a sharp center is also likely to show up in the peak map ; we admit it at this stage but count on eliminating it later .",
    "the middle panel of figure  [ fig.pkmap ] shows this raw peak map , alongside the f814w stack .      at this point we needed a way of analyzing the peak map that would allow us to collect nearly all of the genuine stars , but very few of the random or artifact - related peaks .",
    "we explored many ways of extracting a source list from the peak map .",
    "in particular , the peak map that was made from the images that contained artificial stars proved particularly useful for telling us what signature stars of different brightness would have on the peak map .",
    "we found that by overbinning the peak map by 3@xmath33 ( in other words , just like 3@xmath33 boxcar smoothing , but without dividing the sum by 9 ) we were able to optimally highlight the signal from the faintest stars .",
    "this overbinning was necessary because stars do not always fall at the centers of pixels , either in the individual exposures or in the peak map , and we want to consider all of the peaks that each star generates in order to maximize its signal .",
    "we adopted a two - parameter finding algorithm . in order to be included in our initial list , a source had to ( 1 ) generate a peak in at least 90 out of 252 f814w images , and ( 2 ) be at least 15 subpixels ( 7.5 wfc pixels ) away from any more significant source .",
    "these parameters represent a balance between including as many genuine stars as possible , without including too many non - stellar features . from the artificial - star tests",
    ", we found that many stars with about 90 peaks were recovered with positions and fluxes that were close to the input values . with a background of 63 in the overbinned map , this represents a 3.4-@xmath13 detection , so lowering the threshold below this would dramatically increase the noise contribution to our sample .",
    "the second condition naturally rejects the psf artifacts found around the bright stars .",
    "since the typical separation between stars in this field is about 25 pixels , this excludes many non - stellar objects without excluding many of the detectable stars .",
    "the above strategy resulted in a list of 48,785 sources . for each source",
    ", we have a position in the reference frame , based on the centroid of the found peaks .",
    "the artificial - star tests indicate that this position is good to about 0.1 pixel even for the faintest stars .",
    "all of these peaks went forward to the photometry stage ; 8,399 of them would survive the later weeding - out processes that we will describe in   [ sec.weed ] .",
    "finally , we note that we explored many different ways of constructing the above source list .",
    "we first thought to derive it from the stack image , but the peak - map approach seemed more `` democratic '' in its selection , in that the individual - exposure peaks that are higher above the background ( perhaps due to just - undetected crs ) would have a disproportionate influence on a stack , but not on the peak map , where each image gets one vote .",
    "also , we initially included the f606w images in the peak - map analysis , but found from the artificial stars that using the f606w images did not add a significant number of stars .",
    "we initially tried doing photometry on the stacked images , but the resulting color - magnitude diagram indicated that the faint stars were nearly lost among objects that were not real .",
    "we therefore made all our final measurements on the individual flt images .    to measure stars that were too faint to see in a single exposure , we collected all of the information for a given star , in each of the two filter bands , as follows .",
    "we used the positional transformations and the distortion corrections to calculate the position of the star in each individual exposure , and extracted a 7@xmath37 array of pixels around that center .",
    "since exposure times differed slightly , we normalized each pixel array to the same exposure time .",
    "of the 49 pixels from each exposure , we used the sigma - clipped average of the 28 pixels between @xmath14 and @xmath15 pixels of the central pixel as the sky level , and subtracted this value from each of the innermost 9 pixel values .",
    "these @xmath16 pixel values ( for f814w , or @xmath17 for f606w ) were the data that we used to find the flux of the star .",
    "as we indicated earlier , our effective psf tells us the fraction of a star s light that is expected to fall in a pixel centered at an offset ( @xmath18 , @xmath19 ) from its center . the flux in each pixel in each exposure",
    "@xmath20 should be described by : @xmath21 where @xmath22 is the star s flux , @xmath23 is the sky value ( found above ) , and @xmath24 is the fraction of light that should fall in that pixel .",
    "this is the equation for a straight line with a slope of @xmath22 and an intercept of @xmath23 .",
    "figure  [ fig.starfit ] shows how the set of pixels for a star is fit by the psf model .",
    "the tight linear relation for the bright star on the left shows that our psf model is extremely accurate and also that our astrometric and photometric transformations are able to properly relate each pixel in each exposure to the model .",
    "this demonstrably good fit for the bright stars means that we can trust our model to measure accurate fluxes for the fainter stars .",
    "the star on the right is one of the faintest white dwarfs in the field .",
    "we fit the flux @xmath22 for each star ( the slope in figure  [ fig.starfit ] ) by a least - squares fit to all the pixels , taking into account the expected noise in each pixel .",
    "we iteratively rejected the points that are more than 4-@xmath13 discordant with the best - fitting model .",
    "in addition to fitting for the flux , we also look at residuals from the fit to construct some shape parameters that we will use to differentiate stars from galaxies in   [ sec.weed ] .",
    "figure  [ fig.rawcmd ] shows the raw cmd for all 48,795 of our sources .",
    "the wd sequence shows up distinctly , but there are many cluttering sources as well .",
    "the following section will show how we winnowed out the non - stellar objects .",
    "in order to include the faintest stars in our list , we had to cast our net so wide that we necessarily included many objects that are not stars :  galaxies , psf artifacts , features on diffraction spikes , etc .",
    "as a first step toward eliminating these , we used the stacked images to examine many of the 48,785 objects that our procedures had found .",
    "first , we saw that our list did include almost all of the stars that could have been found by eye , except for those with very close neighbors .",
    "but in addition , our selection criteria had admitted a large number of artifacts around bright stars , and also many bumps along diffraction spikes .",
    "finally , many of the clearly real objects were galaxies rather than stars . on the basis of this examination , we developed three tests to separate true stars from artifacts and galaxies . to eliminate artifacts we used the bright - star - proximity and the spike test ; we eliminated galaxies with the shape test .",
    "faint detections found close to bright ones pose two kinds of problem :   ( a ) many of them are not stars but instead are artifacts in the outer part of the psf of the bright star , and ( b ) a faint star that is too close to a bright one can not possibly be measured well , and should be discarded for this reason .    to address these problems , we took the stars that were brighter than f814w magnitude @xmath25 ( 10,000 @xmath26 ) and tabulated all the fainter objects in our list that were within 50 pixels of one of these `` bright '' stars . when the magnitude differences are plotted against separation , in the upper part of figure  [ fig.proxweed ] , many distinct clumps show up , indicating that artifacts tend to occur at specific combinations of separation and magnitude difference .",
    "the upper set of clumps correspond to radial features in the psf , and the lower set to features along diffraction spikes .",
    "we drew the separator line in such a way as to exclude the radial features . removing things along",
    "the diffraction spikes with a purely radial discriminating function would be unnecessarily harsh and would disqualify many valid , measurable sources .",
    "we will remove the features along the spikes in the next section , with a more targeted procedure .",
    "the bottom - right plot shows that this discrimination removes all psf artifacts , except those along the diffraction spikes . of the 48,785 objects with which we started",
    ", 27,222 survived this first weeding stage .",
    "a generic property of the artifacts that lie on the diffraction spikes of bright stars is that they are elongated along the direction of rows or columns , which are the directions in which the spikes run .",
    "we therefore devised a statistic that measures the tendency of the light around an object to be extended along the rows and columns .    for this we took the f814w stacked image and binned it 2 by 2 to get a @xmath27 image",
    "for each of the remaining 27,222 objects , we analyzed the 21@xmath321 surrounding pixels to determine the likelihood that it is on a row - like or column - like diffraction spike . to estimate the row - oriented spike contribution",
    ", we found the sigma - clipped average value for the 18 pixels with @xmath28 and @xmath29 ( where @xmath30 is the column that the pixel is in and @xmath31 is its row ) , and subtracted the sigma - clipped average value of the 324 background pixels ( @xmath28 and @xmath32 ) .",
    "we computed a similar column - oriented spike contribution , and added the two to get a combined spike estimate .",
    "when these estimates are plotted against magnitude , the spike - like objects stand out well , except at the very faint end .",
    "we drew the separator line shown in figure  [ fig.spikeweed ] in an effort to include everything that was consistent with the bulk of the stellar distribution .",
    "we inspected the remaining sources in the images and found that this did an excellent job removing features on spikes .",
    "this step eliminated 11,773 of the remaining 27,222 objects .",
    "the spike and bright - star - proximity tests thus reduced our list of objects to 15,449 .",
    "examination of the stacks showed that some of these were clearly galaxies .",
    "the image of a galaxy differs from that of a star in two ways that are easily tested :  it has more light in its envelope , relative to the core , than does the psf of a star , and it may be elongated .",
    "we therefore devised criteria of sharpness and roundness ; to avoid confusion with the sharp and round parameters that daophot produces ( stetson 1987 ) , we called ours cenxs and elong .",
    "as the first step in calculating the value of the sharpness parameter cenxs for a star , we located in each of the images all the pixels whose centers were within 0.5 pixel of the calculated center of the star in that image , and subtracted from each of them the value of the fitted psf .",
    "we then took a sigma - clipped mean of these residuals ; cenxs is this mean divided by the total flux of the star .",
    "it is zero for an object that agrees perfectly with the psf , and is negative for an extended object .    to calculate our roundness parameter elong , we located in each image those pixels , on opposite sides of the center of the star , whose centers fell within a pair of pixel - size squares centered 1 pixel away , and again took a sigma - clipped mean of these pixels over all of the images .",
    "we did this at position angles 0 , 45 , 90 , and 135 degrees ; the value of elong is the largest of the four , less their mean , divided by the total flux of the star . for an object that is round ,",
    "it is close to zero , while its value increases with the elongation of the object .",
    "figure  [ fig.shapeweed ] shows the distributions of cenxs and elong for the objects that survived up to this stage , along with their distributions for the artificial stars . in the artificial - star diagrams",
    ", we drew in subjectively chosen lines that would include nearly the entire point - source distribution , and we used these lines as criteria that would discriminate between stars and galaxies , among the real objects .",
    "of the 15,449 objects that entered this stage , 8,768 survived this final test .",
    "( in this test , cenxs was very much the more effective of the two criteria . )",
    "figure  [ fig.cmdweed ] summarizes the weeding procedure .",
    "our final cut was to crop off the outer parts of the field , where coverage was only partial because of our dithering ; this excluded only a small fraction of the sample .",
    "we retained the quadrilateral region defined by the points whose coordinates are ( 25,25 ) , ( 4050,175 ) , ( 4150,4200 ) , and ( 275,4000 ) ; this insured that the entire remaining area had coverage by at least 242 of the 252 f814w images .",
    "this left 8,399 stars .",
    "the charge - transfer efficiency ( cte ) of the wfc has most recently been explored by riess & mack ( 2004 , rm04 ) .",
    "they evaluated the impact of charge - transfer inefficiency on a range of apertures , fluxes , and sky backgrounds .",
    "it was not possible , though , for them to explore the situation posed by our large data set , where the background is high and the target stars are only marginally above the background .",
    "rm04 make the point that a high background can significantly mitigate cte for faint stars .",
    "this would make sense if faint stars are not much more likely to fill the charge traps than are the background pixels .",
    "if this is the case , then cte might not pose a significant problem .",
    "this data set is not well devised to do a self - calibration of cte contamination , since we have only one pointing at one orientation .",
    "the only way we have to evaluate whether cte is affecting our faint stars is to see if the wd sequence appears brighter when there are fewer pixel transfers .",
    "so , we divided the sample in two : stars close to the readout registers ( @xmath33 or @xmath34 ) and stars far from the registers ( @xmath35 and @xmath36 ) .",
    "we compared the two wd sequences and noticed that the truncation appeared at the same f814w magnitude and color in both samples .",
    "thus , we conclude that charge - transfer inefficiency does not significantly impact our faint - star photometry .",
    "the procedures that we have described were optimized for finding and measuring the faintest stars , which are the main focus of this investigation . for brighter stars these procedures are not optimal , however . in this section",
    ", we will construct a single list that includes both the faint stars and the bright stars .",
    "we will also calibrate the photometry .      those stars that are bright enough to stand out clearly in each exposure",
    "are actually better measured by using psf fitting in the individual exposures , rather than by simultaneous fitting . in   [ subsec.trans ]",
    "we measured average positions and fluxes for the bright stars .",
    "these positions define the reference frame , and the photometry is zero - pointed to correspond to the instrumental system of the first exposure , the same system as used in   [ sec.phot ] .",
    "many stars in the field were bright enough to be saturated in the deep exposures , so we measured accurate fluxes for them in the short exposures .",
    "although the background in the deep exposures was high enough to make cte concerns negligible ( see   [ ssec.cte ] ) , we would not expect this to be the case for the shorter exposures .",
    "our measurements came from psf fitting rather than aperture photometry , so none of the apertures evaluated by rm04 was appropriate to correct the cte in our short exposures .",
    "we thus had to develop our own specialized procedure for cte corrections .",
    "what we did was to adopt the form of their eq .",
    "( 1 ) , but to find an empirical value for the constants .",
    "since the sky in our images is always near the same value , we did not need to solve for a dependence on sky value , and thus had a dependence on only two unknowns , @xmath37 and @xmath38 : @xmath39 where @xmath37 is a scaling factor and @xmath38 desrcibes the dependence on magnitude . here",
    "@xmath40 is the flux of the star in the short exposures , in units of 1000 dn , and @xmath41 is the number of vertical pixel transfers .",
    "the quantity @xmath37 corresponds to the cte suffered by a source at the far edge of the chip with a flux of 1000 dn . for the 40-s short exposures , which had a background of 6 dn , we found @xmath42 and @xmath43 .",
    "the dependence on magnitude ( @xmath38 ) is the same as given in rm04 , but the scaling ( @xmath37 ) is about twice what they would predict for an aperture of 3 pixels radius ( after a correction is made for the linear increase of cte over time ) .",
    "since our aperture has an effective radius of much less than 3 pixels , it does make sense that we would suffer more cte losses . in a similar way",
    ", we fitted curves to the difference between the photometry of the 40-s exposures and the 5-s exposures , and found @xmath44 and @xmath43 .",
    "this allowed us to correct the 5-s exposures for cte .",
    "finally , we corrected the 1-s - exposure photometry to the 5s - exposure photometry , finding @xmath45 and @xmath46 .",
    "once we had corrected the photometry in all the short exposures for cte , we then generated a single photometry list for the bright stars , taking the photometry for each star from the deepest image where it was found to be unsaturated .",
    "only one star was bright enough to be saturated even in the 1-s exposures . in this way",
    ", we arrived at a catalog of bright stars with the most accurate possible f606w and f814w instrumental magnitudes .",
    "we now had two lists of stars .",
    "one list , which we will call the `` faint '' list , came from the peak - based finding method , which found only the stars that were unsaturated in the deep exposures .",
    "this list measures the faint stars accurately , but its photometry is not optimized for the stars with high signal - to - noise ratio .",
    "this list is also the product of a carefully designed finding algorithm , which allows us to evaluate its completeness accurately ( see  [ sec.compl ] ) .",
    "the other list ( the `` bright '' list ) has more accurate photometry for the bright stars , and contains all the stars brighter than about f814w magnitude @xmath47 ( 1000 @xmath26 ) , including all the stars that are saturated in the deep exposures .    in order to arrive at a single list that combined the best qualities of both lists",
    ", we needed to merge the bright and faint lists , which overlap in the range of instrumental magnitudes brighter than @xmath47 and fainter than @xmath48 ( where saturation in the deep images sets in ) .",
    "we did the merging as follows : we entered all of the stars from the faint - star list into the final list .",
    "then for stars brighter than magnitude @xmath49 , where the magnitudes from the bright - star lists are more accurate , we substituted those in every case where they were available .",
    "finally , since the faint - star list does not include saturated stars , we added stars from the bright list that were brighter than @xmath50 and were not already in the list .",
    "this way , the membership in the list below @xmath50 is entirely consistent with the faint - star finding criteria , so that a luminosity function constructed from the list can be corrected for incompleteness by means of the artificial - star tests .",
    "brighter than @xmath50 , the list is essentially 100% complete , so no completeness corrections will be necessary .",
    "thus far we have kept all of our photometry in the instrumental system , since this system gives us an immediate handle on the signal - to - noise for each source .",
    "it is necessary , however , to determine the zero - point corrections that will convert these to actual astronomical magnitudes .",
    "sirianni et al .",
    "( 2005 ) find that for acs , 1 count per second in a 55 aperture corresponds to magnitude 26.398  in f606w and 25.501  in f814w , in the vegamag system ( from their table 10 ) .",
    "recognizing , however , that 55 is an impractically large aperture to use for actual measurements , they give corrections that convert to that aperture from the more practical aperture of 05 ; their table 5 gives for our two filters the additive quantities 0.088 and 0.087 , respectively .",
    "sirianni s calibrations were performed for the drz images , so we used images j97101bdq_drz and j97101bbq_drz to construct calibrated magnitudes for isolated stars for f606w and f814w . in figure",
    "[ fig.zp ] , we compare the photometry for these calibrated stars against our instrumental photometry , to determine our zero point . even though this is a relatively sparse field , the 05 aperture ( 10 pixels ) often includes more than the target star ( i.e. , other faint stars or cosmic rays ) , so we identified stars that had inconsistent fluxes in the @xmath51 and @xmath52 apertures and excluded them from the fit .",
    "after this exclusion , we constructed a sigma - clipped average zero point for each filter .",
    "we found our zero points to be 33.321 and 32.414 for f606w and f814w , respectively .",
    "the histograms indicate that these should be good to about 0.01 magnitude .",
    "our goal in this study is to measure as many of the stars in the field as we can , as accurately as possible , and also to determine what fraction of them we were able to measure .",
    "artificial stars helped with the finding and measuring approach , but for assessing the completeness they are crucial .",
    "section [ subssec.as ] describes how we set up our large grid of artificial - star tests , which covered the stars fainter than an f814w instrumental magnitude of @xmath10 . to extend the completeness values to brighter magnitudes",
    ", we generated another set of images for the brighter stars , and joined the results of finding and measuring these with the previous results for fainter stars , so as to have completeness figures over our whole range of magnitudes .",
    "the completeness of a catalog is a function both of the data set and of the finding algorithm . in   [ subssec.as ]",
    "we carefully inserted the artificial stars into each individual exposure at the appropriate position and with the appropriate flux , along with the proper noise .",
    "the only difference between the real and artificial stars is that we know the psf and transformations exactly for the artificial stars , whereas for the real stars we have good , yet still imperfect , models .",
    "these small , unavoidable differences should have a negligible impact on our completeness assessment , however .",
    "we subjected the as images to the same finding and measuring procedure as the real stars .",
    "this naturally includes all of the weeding - out operations that we performed on the actual images .",
    "figure  [ fig.art ] shows the cmd of the artificial stars that were inserted and that of the ass that were recovered , along with plots showing the recovered magnitudes .",
    "even though the faintest stars were barely above the noise in individual exposures , our algorithm is able to measure fluxes for them that are systematically accurate .",
    "the difference between the dashed line and the solid line in the right panel shows that there were clearly some stars that were found in the initial step , but did not pass the weeding scrutiny .",
    "one might be tempted to relax the weeding criteria to include these stars , but any change in the weeding criteria would allow unreal artifacts to enter the real - star list .    to determine whether a particular artificial star was recovered ,",
    "we cross - identified the input list with the output list and recorded the closest star in the output list to the input - list position . if this star was within 0.75 pixel in @xmath53 and in @xmath41 , and within 0.75 magnitude in f814w , we considered it found .",
    "hansen et al .",
    "( 2007 ) provide detailed tables of the artificial - star - recovery statistics .",
    "it is worth noting that even though the formal completeness is 50% at f814w @xmath54 28 , we are still able to recover stars almost down to f814w = 29 , where the completeness is below 20% .",
    "the reason for this is a paradoxical property of the usual definition of completeness , ( as recovered)/(as inserted ) .",
    "this definition is quite valid ; if we use it , we correctly derive the completeness figures by which the observed numbers of stars need to be divided .",
    "the paradox ( if that is the right term for it ) is that completeness figures are often used as a criterion of reliability too . here , however , that would not be appropriate .",
    "the reason is that in many parts of our field we fail to recover ass not because their faintness puts them near the limit of detection , but rather because they fell in regions  such as the surroundings of bright stars  where the background is just too noisy to give a faint star a fair chance .",
    "thus we actually have reliable measurements of many stars that are much fainter than the 50%-completeness level .",
    "fortunately this distinction is not an issue for us in the present paper , because all the sequences of interest terminate above the 50%-completeness level . in a different study in which some of us are involved , however",
    ", it plays a crucial role , and it is discussed in greater detail there ( bedin et al .",
    "( we note that in bedin et al 2008 , for ngc 6791 , the wdcs does not terminate above the global 50% completeness line , and we take care to show that by restricting our searches for the faint stars only where the image is locally flat , we can maintain a completeness of greater than 50% to a fainter magnitude .",
    "this technique is not necessary for the present data set , but may be of benefit if we get a second acs epoch for proper motions . )",
    "our original plan for this project included a set of second - epoch observations in the spring of 2007 , which would give us a 2-year baseline for proper motions , allowing us to separate the cluster stars from field stars .",
    "we had also chosen our present field to overlap existing archival images , so as to get some preliminary proper motions before the second acs epoch . with the failure of acs in january 2007 , however , we were restricted to using these archival images , taken from 1994 to 1997 , as our sole source of images from which to derive proper motions .",
    "they do not go nearly as deep as we would wish , nor do they give uniform and complete coverage of our acs field .",
    "the archival data come from programs go-5138 , go-5092 , and go-6797 , with the exposure time divided about evenly between 1994 and 1997 . in total",
    ", there are 52 deep exposures , 35 in f814w ( 33,000 s ) and 17 in f606w or f555w ( 16,500 s ) .",
    "figure  [ fig.archive_depth ] shows the coverage depth .",
    "we have a different limiting archival magnitude in different parts of the field , making each star a special circumstance and making completeness an impossible question to answer for the archival data .",
    "worse , even where it exists , our archival coverage is pitifully shallow .",
    "our acs exposures total 180,000 sec in f814w and 93,000 sec in f606w . when the @xmath34 greater sensitivity of acs is a",
    "also taken into consideration , the total exposure with the acs wfc is much more than an order of magnitude longer than the deepest archival coverage .",
    "we do have one advantage , however , that partly offsets the lack of depth in the archival material :  our acs star list tells us where to look for stars in the earlier wfpc2 images .",
    "unfortunately this advantage comes with a limitation .",
    "the cluster stars all have the same motion ( except for the very small differences caused by internal motions ) , so that once we have established the transformations , we know exactly where to look for each cluster star .",
    "the field stars , by contrast , have a considerable scatter about their mean proper motion , so finding them is less certain .",
    "our first step in dealing with the archival images was to establish transformations between each chip in each of the archival exposures and our acs wfc reference frame .",
    "for this purpose we identified in the wfc lists 3,510 bright stars that fall along the cluster sequence in the cmd and also fell in the regions covered by the archival images .",
    "we derived the transformations much as we had done for our wfc images (  [ subsec.trans ] ) , except that for the archival images we naturally used the distortion corrections appropriate for wfpc2 .    in deriving the transformations from cluster stars alone",
    ", we had guaranteed that all cluster members would be found in the positions that the transformations predicted for them , since they have the same motion as the stars from which the transformations were derived ( again neglecting the internal motions as being too small to matter ) . measuring them is , except for faintness , no worse a problem than was measuring these stars in the acs images .",
    "field stars are a different matter , however . not only",
    "do they have a different mean motion ; they also have a large scatter about the mean .",
    "the difference in motions is shown in figure [ fig.cmdnpm ] .",
    "king et al .",
    "1998 show an analogous figure for the same field , but here we have a much longer baseline for the motions : 10 years versus 3 years .",
    "since we had no way of knowing whether any given faint star was a member of the cluster or the field , we did as follows : we started by making a list of every single peak ( local maximum ) in each of the wfpc2 exposures . for each star",
    "we collected all the peaks that were within 5 pixels of the place where the star would fall if it were a cluster member .",
    "if the star does not have the cluster motion , its 1994 and 1997 peaks should have locations that differ systematically , however . to allow for this , we normalized the displacement of every peak to a 10-year baseline :  each peak in a 1994 image was moved toward the cluster - star position by 1/11th of its displacement , and each peak in a 1997 image was moved away from the cluster - star position by 2/8ths of its displacement .",
    "if there was a significant clumping of peaks , we took its centroid as the 10-year displacement of the star .",
    "( the 8-year/11-year adjustment was made for all stars , including cluster members , for which it of course made almost no difference . )",
    "our measured proper motions are shown in panel ( b ) of fig .",
    "[ fig.cmdnpm ] , in which their distributions are plotted separately for successive intervals of 2 magnitudes .",
    "circles around the cluster and field clumps show our selection criteria for cluster and field .",
    "the other four panels of the figure are cmds :  in ( a ) all the stars , in ( c ) the cluster stars , in ( d ) the field stars , and in ( e ) the stars that did not fall within the circle for either group .",
    "it is clear that in the brighter four magnitude bins our cluster / field separation is fairly good . in the faintest bin , by contrast",
    ", the separation is quite poor .",
    "this inability to make a proper - motion separation for the faintest stars properly has several effects . for the main - sequence stars it hardly matters , since their number has dropped virtually to zero by the time we reach that magnitude . for the white dwarfs , the clear presence of the faint end of their sequence in the `` other '' cmd , and their faint presence in the `` field '' cmd ,",
    "show that proper motions can not be used reliably to establish membership fainter than f814w magnitude 26.5 .",
    "the cmd of the field stars is more complicated . in the brightest part of panel ( d )",
    "is a sharp blue edge , which must come from stars near the main - sequence turn - off , at a range of distances in the bulge / halo population of the background .",
    "the redder stars in that cmd are probably a mixture of the background population and the red - dwarf foreground .",
    "the latter is probably exemplified by most of the magnitude range in panel ( e ) , since the foreground stars can be expected to have larger proper motions . furthermore , the sparseness of stars in panel ( e ) suggests that this population makes only a small contribution to panel ( d ) , whereas it continues in panel ( e ) because inaccuracy of proper motions does not remove stars from this category .",
    "interestingly , the star numbers in the field - star panel , ( d ) , peter out between f814w magnitudes 26 and 27 , and there are almost none of them fainter , but no corresponding star density appears in panel ( e ) , as it would if their dearth in panel ( d ) were due to the increased measurement error for fainter stars . since white dwarfs are plentiful down nearly to magnitude 28 in the sum of panels ( c ) , ( d ) and ( e ) , or what is the same thing , in panel ( a ) , we can only conclude that the background population really is lacking at magnitudes fainter than 27 .",
    "this paper describes how we started with a dithered set of 378 deep exposures taken in the outskirts of the globular cluster ngc 6397 over 126 hst orbits , and produced the most comprehensive possible list of the point sources in the field .",
    "the faintest stars could not be independently identified in every image , so we collated information from all of the images and identified a possible star wherever a statistically significant number of images showed a minimal detection ( a simple peak , or local maximum ) .",
    "this list contained all the identifiable stars , but also contained psf features , diffraction spikes , and galaxies .",
    "( in fact , this list of detections also contained some globular clusters surrounding a distant background galaxy , see kalirai et al .",
    "we measured each of these objects under the presumption that it is a star , determining a position , a flux in f606w and f814w , and some other diagnostics .",
    "we then subjected this list to a set of criteria designed to leave only the point sources .",
    "these criteria were able successfully to reveal a white - dwarf sequence that increases in number toward faint magnitudes , turns to the blue , then appears to truncate at f814w = 27.5 at a color of f606w @xmath55 f814w @xmath54 1.2 .",
    "artificial - star tests showed that our reduction procedures could have easily found stars a magnitude fainter than the observed truncation .",
    "we also made use of data in the archive to measure proper motions for as many stars in the field as possible .",
    "we effected a near - perfect separation for stars down to the end of the main sequence , but the proper motions were useful only in a qualitative sense for the white dwarfs .",
    "we have thus determined a position and a f606w and f814w flux for all stars , and proper motions for most .",
    "in addition , we have also performed artificial - star tests to show the expected photometric errors and completeness .",
    "these data products are the subject of several papers : richer et al .",
    "( 2006 ) presented the initial discovery of the termination of the wd sequence and of the hook to the blue .",
    "kalirai et al .",
    "( 2007 ) have determined the absolute motion of the cluster by studying the relative motions of cluster stars and background galaxies .",
    "hansen et al .",
    "( 2007 ) analyze the white - dwarf population in detail .",
    "davis et al .  ( 2007 ) examine the spatial distribution of the wds in this cluster . in companion papers in this volume , richer et al .",
    "( 2008 ) explore the bottom of ngc397 s main sequence and hurley et al .",
    "( 2008 ) discuss the dynamical state of the cluser .",
    "finally , kalirai et al .  (",
    "2008 ) study the globular cluster system of a background galaxy seen in this field .",
    "the only disappointing aspect of this reduction is the quality of the faint - star proper motions , which is limited by the shallow and inhomogeneous archival images . if acs is restored in servicing mission 4 in 2008 , then with second - epoch observations we will be able to determine membership for all stars , and even measure internal motions for the cluster stars .    all the us co - i s ( j.a.,b.m.s.h , i.r.k . , j.k . , r.m.r",
    ". , and m.s . ) acknowledge the support of hst grant go-10424 .",
    "the research of h.b.r . is supported in part by the natural sciences and engineering research council ( nserc ) of canada ."
  ],
  "abstract_text": [
    "<S> we describe here the reduction methods that we developed to study the faintest red dwarfs and white dwarfs in an outer field of ngc6397 , which was observed by _ hst _  for 126 orbits in 2005 . </S>",
    "<S> the particular challenge of this data set is that the faintest stars are not readily visible in individual exposures , so special care must be taken to combine the information in all the exposures in order to identify and measure them . </S>",
    "<S> unfortunately , it is hard to find the faintest stars without also finding a large number of faint galaxies , so we developed specialized tools to distinguish between the point - like stars and the barely resolved galaxies . </S>",
    "<S> we found that artificial - star tests , while obviously necessary for completeness determination , can also play an important role in helping us optimize our finding and measuring algorithms . </S>",
    "<S> although this paper focuses on this data set specifically , many of the techniques are new and might find application in other work , particularly when a large number of images is available for a single field .    </S>",
    "<S> -0.7truecm    _ astrometry  globular clusters : individual ( ngc 6397 )  stars : low - mass  techniques : image processing , photometric  white dwarfs _ </S>"
  ]
}