{
  "article_text": [
    "many problems of stellar dynamics deal with self - gravitating systems which are in dynamical equilibrium , but slowly evolve due to two - body relaxation or some other factor , such as a massive black hole or the diffusion of chaotic orbits .",
    "the most general method of studying these systems is a direct @xmath0-bodysimulation , however , in many cases it turns out to be too computationally expensive .",
    "alternative methods , such as fokker  planck , gaseous , or monte carlo models , have historically been developed mostly for spherical star clusters . in this paper",
    "we present a formulation of the monte carlo method suitable for non - spherical stellar systems .",
    "the paper is organized as follows .",
    "section  [ sec : overview ] reviews the existing simulation methods and outlines the motivation for the proposed new formulation ; section  [ sec : relaxation ] presents the theoretical background of two - body relaxation theory ; section  [ sec : raga ] discusses the implementation of the non - spherical monte carlo code and section  [ sec : tests ] presents the results of test simulations .",
    "section  [ sec : conclusions ] lists possible applications of the new method and sums up .",
    "the development of monte carlo methods for simulation of star clusters started in early 1970s with two different approaches , pioneered by spitzer and hnon .    in the original formulation of @xcite , the motion of test stars in a spherically symmetric potential",
    "was followed numerically on the dynamical timescale , and perturbations to the velocity was computed assuming a maxwellian distribution of background stars ( scatterers ) , with the mean density and velocity dispersion computed in 25 radial bins by averaging over 40 stars in each bin ; thus , the test stars were also used for determining the smoothed properties of the field stars . to speed up computation , dependence of velocity diffusion coefficients on the velocity of the test star",
    "was ignored ( the values corresponded to the average thermal velocity ) ; this simplification was lifted in @xcite . since perturbations to each star",
    "s velocity are independent of each other , the global conservation of energy is not guaranteed ; thus a correction is applied after each timestep which cancels the residual fluctuations .",
    "this method became known as the `` princeton '' monte carlo code @xcite .    in another variant of this method ,",
    "@xcite turned to using the diffusion coefficients in energy @xmath1 and angular momentum @xmath2 , averaged over the radial period of the test star .",
    "this approach was subsequently developed by @xcite to study the steady - state solution for the distribution of stars around a massive black hole : the potential was assumed to be dominated by the point mass , the diffusion coefficients in @xmath1 and @xmath2 were computed self - consistently from the distribution function @xmath3 , which was then adjusted iteratively until convergence .",
    "the capture of low angular momentum stars by the black hole was also taken into account , which necessitated a rather complex scheme for choosing the timestep : it was determined by the relaxation time but also required not to miss a potentially disruptive periapsis passage near the black hole .",
    "it also had an ingenious scheme for particle cloning ( mass refinement ) to allow for better sampling of phase - space close to the black hole .",
    "subsequent papers extended the method to self - consistent ( rather than point - mass - dominated ) potentials @xcite and to evolutionary simulation including the heating by the black hole , core collapse , and evaporation @xcite .",
    "this approach has been dubbed the `` cornell '' code @xcite .",
    "more recently , @xcite and @xcite have used this formulation to study the dynamics around massive black holes .    at the same time",
    ", @xcite introduced another variant of monte carlo method , in which pairs of stars are interacting directly ( see also * ? ? ? * ) .",
    "unlike the conventional @xmath0-bodysimulations , these pairwise interactions are computed only between particles that are adjacent in radius . for each pair of interacting particles ,",
    "their relative velocity is changed by an amount which reproduces statistically the effect of many individual encounters during the same interval of time .",
    "the timestep is chosen to be a fraction of the relaxation time @xmath4 , instead of a fraction of the dynamical time @xmath5 .",
    "after each timestep , the stars are assigned new positions ( or , rather , radii , since the system is assumed to be spherically symmetric ) .",
    "this method was subsequently improved by @xcite , who included a variable timestep ( proportional to the radius - dependent @xmath4 ) , correction of velocities due to the changes in potential after recomputing new positions of particles , continuous stellar mass spectrum , and shock heating due to passages of the globular cluster through the galactic disc . @xcite introduced many other physical ingredients such as stellar evolution , primordial binaries ( also studied by * ? ? ?",
    "* ) and cross - sections for three- and four - body interactions , and stellar collisions .",
    "all presently used codes follow the hnon s approach . since late 1990s , two groups @xcite have been developing sophisticated codes including much additional physics beyond two - body relaxation : parametrized single and binary stellar evolution @xcite , direct integration of few - body encounters @xcite , accurate treatment of escapers @xcite .",
    "the present versions of these codes are described in @xcite and @xcite . in these codes",
    ", the number of particles in the simulation equals the number of stars in the system under study , which facilitates a correct proportion between various dynamical processes .",
    "a third code of the same family was developed by @xcite for studying dense galactic nuclei , featuring accurate treatment of loss - cone effects ( including a timestep adjustment algorithm similar to that of shapiro ) , and a model for physical collisions based on a large library of smooth particle hydrodynamics ( sph ) simulations .",
    "table  [ tab : compare_mc ] compares the features of various monte carlo methods .    [ cols=\"<,<,<,<,<,<,<\",options=\"header \" , ]     in parallel with the monte carlo codes , the approach based on direct integration of the fokker ",
    "planck equation using finite - difference schemes was developed by @xcite , and later by @xcite and @xcite for spherical systems .",
    "however , it seems to be impractical to extend it beyond two - integral axisymmetric case @xcite , as the method relies on the explicit knowledge of integrals of motion .",
    "another related method is the gaseous model , in which the relaxation is treated using a conductive approximation @xcite , and which can be combined with monte carlo treatment of stellar binaries @xcite .",
    "this approach also was developed in the spherical case only .    with the advent of special - purpose hardware in 1990s",
    ", it became possible to perform direct @xmath0-bodysimulations of globular clusters with more than @xmath6 stars @xcite , and a wide range of physics may be added to the dynamical evolution ( e.g. * ? ? ? * ) .",
    "these simulations are also not restricted to any particular geometry , but are very computationally expensive and , as we will show , still practically unsuitable for some classes of problems , in which collisional relaxation should be rather small compared to collisionless effects arising from non - spherical mass distribution .",
    "a number of more esoteric approaches have been proposed to combine the flexibility of collisional direct @xmath0-bodysimulations with fokker ",
    "planck ( e.g. * ? ? ?",
    "* ) , spherical - harmonic expansion ( e.g. * ? ? ?",
    "* ) , self - similar dynamic renormalization @xcite , or tree - code @xcite , none of which apparently gained substantial popularity .    from the side of collisionless simulations of nearly - equilibrium systems ,",
    "the most relevant for this study are the spherical - harmonic methods aarseth1967,cluttonbrock1973,vanalbada1977,hernquistostriker1992,meironlhbs2014 . in this approach ,",
    "the smooth potential of a stellar system is represented as a sum of angular harmonics , with the radial variation of the expansion coefficients being either an explicit function of radius , or another sum over several basis functions .",
    "the coefficients of expansion are computed from the spatial distribution of particles , and the equations of motion of particles are governed by the gradients of this smooth potential . in all existing implementations , however , the timestep for particle motion , which is necessarily a small fraction of dynamical time , is also used for updating the coefficients of expansion , thereby imposing random fluctuations on them which effectively create numerical noise comparable to that of more direct @xmath0-body methods @xcite . on the other hand , using some sort of temporal smoothing for the expansion coefficients might help to reduce the unwanted relaxation considerably below the discreteness limit , while retaining the ability to follow the slow evolution of a non - spherical system .",
    "a similar idea was recently used by @xcite in the context of evolution of the population of globular clusters in the galaxy .    the idea to marry the benefits of collisionless expansion codes and collisional monte carlo approach has led us to a new formulation of the monte carlo method that avoids the restriction to spherical symmetry while retaining the ability to model the two - body relaxation rather faithfully .",
    "in essence , it is a successor to the spitzer s variant of monte carlo method , with the orbits of test stars followed in real space in a smooth potential represented by a suitable expansion , and perturbations are applied to particle velocities in accordance with local diffusion coefficients .",
    "the new method is dubbed the ragacode , which stands for `` relaxation in arbitrary geometry '' , but also alludes to slowly developing musical themes in the classical indian tradition .",
    "in addition to this method , we have also implemented a variant of spherical isotropic fokker ",
    "planck code , similar to that of @xcite , and an orbit - averaged spherical isotropic monte carlo code , a simplified version of the method of @xcite , mainly for the purpose of testing the main code .",
    "below , we present a complete mathematical description and test simulations .",
    "in this section we review the standard two - body relaxation theory as used in our code , referring to ( * ? ? ? * chapter 5 ) for a more complete description . as in most previous studies ( the notable exception being monte carlo codes based on the hnon s approach ) , we consider scattering of test particles by an isotropic spherically symmetric population of background particles , described by the mass distribution function @xmath7 , where @xmath8 is the energy per unit mass . the scattering is described in terms of local ( position - dependent ) velocity drift and diffusion coefficients ( e.g. * ? ? ?",
    "* equations 5.23 , 5.55 ) :    [ eq : dc_vel ]    vv _ & = -(1 + ) i_1/2 , + v^2 _ & = ( i_0 + i_3/2 ) , + v^2_&= ( 2 i_0 + 3 i_1/2 - i_3/2 ) ,    where @xmath9 and @xmath10 are masses of the test and field stars , correspondingly , and    i_0 & _ e^0",
    "def(e ) , + i_n/2 & _ ( r)^e def(e ) ( ) ^n/2 , + & 16 ^ 2g^2m_= 16 ^ 2 g^2 m _ ( n_^-1 ) .",
    "[ eq : perturbation_term ]    these coefficients represent mean and mean - squared changes in velocity per unit time . in the last equation ,",
    "the term in brackets , or its appropriate generalization for a multimass case , is the only one that depends on @xmath11 ( for a given combination of @xmath12 ) . in the monte carlo code",
    ", we may assign the amplitude of perturbations at will , adjusting this term to a desired number of stars in the target system , which needs not be related to the number of particles in the simulation . in hnon s formulation , the particles were called `` superstars '' , and their masses were a fixed multiple of actual stellar mass ; contemporary codes usually have 1:1 correspondence between the particle and star mass , which facilitates the introduction of additional physical processes such as binary  single star scattering cross - section . in our approach",
    ", we do not require a fixed proportionality coefficient between the particle and star masses ",
    "particles are just mass tracers and not actual stars , and the relaxation is determined by the smooth distribution function and not by discrete encounters .    in the rest of this section , we focus on the isotropic spherically symmetric case , which is used in the auxiliary codes , while the treatment of relaxation in the main ragacode relies only on the velocity diffusion coefficients ( [ eq : dc_vel ] ) , with some secondary routines using the orbit - averaged energy diffusion coefficient . even in the spherical case , it is not necessary that the distribution of stars is isotropic : @xcite worked in a two - dimensional @xmath13 phase - space , but retained the isotropic background approximation .    local drift and diffusion coefficients in energy are    [ eq : dc_energy_local ]    e & = vv _ + v^2",
    "= i_0 - i_1/2 , + e^2 & = v^2 v^2 _ = v^2 ( i_0 + i_3/2 ) .",
    "the isotropic fokker ",
    "planck equation describing the relaxation in energy has two forms .",
    "the first is more convenient for monte carlo simulations , the second ( flux - conservative ) is more suitable for solving the fokker ",
    "planck equation on a grid .",
    "define @xmath14 to be the mass density of stars per unit energy , where the density of states @xmath15 @xmath16 is the apocentre radius of a radial orbit with energy @xmath1 ( so that @xmath17 ) , @xmath18 is the angular momentum of a circular orbit with the given energy , and @xmath19 is the period of a radial orbit ( time needed to complete one oscillation in the radial direction ) . ignoring the time dependence of potential , the fokker ",
    "planck equation reads @xmath20 with @xmath21 being the averaged values of corresponding quantities over the phase volume accessible to the orbit . for the spherical case ,",
    "these averages are given by @xmath22    the calculation of averaged coefficients for energy is made easier by introduction of a few auxiliary functions : @xmath23    [ eq : k ]    k_1(e ) & _",
    "e^0 def(e ) , + k_g(e ) & _ ( 0)^e def(e ) g(e ) , + k_h(e ) & _ ( 0)^e def(e ) h(e ) .    the function",
    "@xmath24 measures the mass of stars having energy below @xmath1 , while @xmath25 does the same for kinetic energy ( up to a factor @xmath26 ) .",
    "these three functions , together with @xmath27 and its derivative @xmath28 , can be tabulated for the given combination of @xmath29 and @xmath30 and cheaply interpolated to obtain the drift and diffusion coefficients :    [ eq : dc_energy_av ]    e _ & = , + e^2 _ & = 2/g(e ) .",
    "having reviewed the theory of two - body relaxation , we now describe the implementation of the new monte carlo code . in the present form ,",
    "it is hardly suitable for realistic dynamical simulations of star clusters , lacking many sophistications found in other existing codes .",
    "we assume a population of identical single stars , neglect the dynamical influence of binaries and stellar evolution , and do not consider external tidal forces that would lead to escape of stars from the systems .",
    "most of these ingredients are not difficult to add ; the purpose of this paper is to show the feasibility and benefits of non - spherical dynamical monte carlo modelling .",
    "the main advantage of position - dependent diffusion coefficients in velocity is that one may apply them to orbits of arbitrary shape , not restricted to spherical symmetry . for a very general and flexible representation of the potential , we use two variants of spherical - harmonic expansions implemented in the publicly available smile software @xcite : basis - set and spline expansions . in both cases , the angular dependence of the potential",
    "is given by spherical harmonics , while for the radial part either a finite sum over a particular set of basis functions with adjustable coefficients is used , or the radial dependence of each spherical harmonic is represented with a spline function .",
    "this representation typically uses @xmath31 radial terms , and the order of the angular expansion @xmath32 is sufficient for moderately flattened systems ( with major to minor axis ratio @xmath33 ) .",
    "we refer to the appendix of the above paper for more details . throughout this section",
    ", we denote the actual non - spherical potential in which the particles move as @xmath34 , and its associated density as @xmath35 , while the quantities from an equivalent spherical system , approximating the actual density profile ( see below ) , are without tildes .",
    "the evolution of the @xmath0-bodysystem is followed through a series of `` episodes ''  intervals of time @xmath36 during which all particles move along their orbits independently from each other ( thus the computation of orbits is trivially parallelized ) . at the end of an episode ,",
    "the global state of the system ( the potential and the diffusion coefficients ) is updated using the orbits of particles during the episode : each orbit is sampled with @xmath37 points ( position and velocity of the given particle at regular intervals of time ) . if @xmath38 , this increases the effective number of particles used in recomputing the potential and distribution function , reducing the discreteness noise .",
    "the motion of particles in the smooth potential of the entire system is computed using one of the ode integrators from smile : a standard eighth - order runge  kutta method dop853 @xcite , or several other methods from the odeint package @xcite .",
    "after each timestep , the perturbations to the velocity are computed as    [ eq : vel_changes ]    v _ & = v _ t + _ 1 , + v_&= _ 2 ,    where @xmath39 are two independent random numbers with standard normal distribution , @xmath40 is the timestep adjusted internally in the ode integrator , and the diffusion coefficients are given by ( [ eq : dc_vel ] ) .",
    "while there are more sophisticated methods for dealing with stochastic differential equations ( e.g. * ? ? ?",
    "* ) , we used the simplest explicit order 0.5 method for the stochastic part in combination with a high - order method for the deterministic part , which enables to follow the unperturbed trajectories with a great accuracy .",
    "we have checked that the choice of the integration method and the timestep criterion for the ode integrator do not affect the statistical properties of accumulated changes in energy and angular momentum after a given interval of time @xmath41 .",
    "typically , the ode integrator places several tens of timesteps and reaches the energy conservation error of better than @xmath42 per @xmath5 for an unperturbed orbit . a similar approach ( interleaving the evolution in the smooth field with the two - body perturbations )",
    "was used by @xcite for studying the effect of noise on the behaviour of near - resonant orbits in spiral galaxies , and by @xcite for simulating the tidal mass - loss from galactic satellites ( they used diffusion coefficient computed under the approximation of locally maxwellian velocity distribution ) .",
    "the treatment of relaxation relies on the local diffusion coefficients ( [ eq : dc_vel ] ) which are computed using an isotropic spherically symmetric equivalent of the system under study .",
    "this approximation ( in particular , assumption of isotropy of velocities of background stars ) is typical in the relaxation theory , however it could break down in a strongly non - spherical or anisotropic system .",
    "a modification of the present approach could be adopted for a rotating stellar system , assuming isotropic velocity distribution in the corotating frame @xcite ; we have not implemented it here .    at the beginning of the simulation ,",
    "the equivalent spherical system is constructed by averaging the density profile @xmath43 of the actual model over angles @xmath44 , retaining only the radial dependence of mass profile @xmath45 .",
    "then the associated spherically symmetric potential @xmath30 is computed , along with the isotropic distribution function @xmath29 from the eddington equation . later",
    "in the course of simulation , both the spherically symmetric mass profile which produces the associated potential , and the distribution function , are updated directly from the particle orbits ( using points sampled during the episode ) .",
    "both the mass profile and the distribution function are constructed using a penalized spline smoothing approach @xcite , similar to the one employed in the mkspherical program from smile . for",
    "the latter , we first compute @xmath46 from the positions and velocities of sample points , using the spherically symmetric potential @xmath30 , then smooth it , and finally @xmath29 is obtained by dividing the smoothed @xmath47 by the density of states @xmath28 ( equation  [ eq : ded ] ) , again from the equivalent spherical system .    after calculating the distribution function @xmath29 , we compute the functions @xmath48 , @xmath49 that enter the definition of diffusion coefficients ( [ eq : dc_vel ] ) .",
    "they depend on the energy of the test star @xmath1 and the ( spherical ) potential at the given position @xmath30 , and we store the pre - computed functions on a grid in @xmath50 space . in the course of orbit integration , the actual values of these functions are efficiently obtained from two - dimensional interpolation . for the given position and velocity of the particle in the actual ( non - spherical ) potential , the value of potential @xmath51 and energy @xmath1 used as the arguments of these functions are taken from the spherically symmetric potential @xmath30 at the given position .",
    "thus , the actual potential @xmath52 , responsible for the regular motion , and the diffusion coefficients for the stochastic perturbations , are computed using slightly different methods ",
    "one for the actual system , the other for its spherical equivalent .",
    "the small incoherence amounts to the approximation of spherical isotropic scattering background , as used in most previous studies , and is believed not to cause substantial distortions to the dynamics .",
    "note that the test stars themselves do not need to be isotropic in velocity  this assumption is only used for the background stars .",
    "in contrast with the hnon s formulation of monte carlo method , in which the energy is conserved by pairwise interactions ( but not by the potential update ; see @xcite for an amendment ) , the spitzer and shapiro s variants do not have this property intrinsically : each particle randomly walks in energy independently from others . to correct for this , at the end of the episode",
    "we compute the accumulated energy error and distribute it between particles , in proportion with their average diffusion coefficient @xmath53 ( [ eq : dc_energy_av ] ) during this episode .",
    "this is slightly different from the correction method employed by @xcite and primarily applies the correction to those particles that have experienced the largest diffusion .",
    "we compensate the energy error by correcting the particle velocity at the end of the episode , changing its magnitude ( but not direction ) by a necessary amount .",
    "the true non - spherical potential used to compute particle motion is also updated at the end of an episode , using the same sampling points ( @xmath37 per orbit ) collected during the episode .",
    "as already mentioned , @xmath38 reduces discreteness noise in the potential expansion coefficients ; furthermore , if @xmath54 for most of the orbits in the system , each particle completes many periods during one episode , thus again smoothing out fluctuations .",
    "this is , in essence , the `` temporal smoothing '' proposed by @xcite but apparently never used before .",
    "( note that there exist simulation methods that rely on `` orbit  orbit '' , as opposed to `` particle  particle '' interactions , which are used for stars on near - keplerian orbits around a massive black hole @xcite ; these approaches hardly can be generalized for arbitrary potentials not dominated by a single point mass ) .",
    "the energies of particles also need to be corrected after reinitialization of the potential , to account for the time dependence of the potential .",
    "we adopt the method used by @xcite and @xcite , which states that the energy correction for a given particle is @xmath55,\\ ] ] where @xmath56 and @xmath57 are particle positions at the beginning and end of the episode , and @xmath58 is the difference between the updated potential and the old one ( used during the episode ) . in these papers , this correction could be applied directly to the particle s energy , while in our case we are again forced to attribute it to the kinetic energy only .",
    "more specifically , the updated velocity after the correction is related to the `` new '' velocity ( at the end of the episode but before the correction ) by    2 + _ ( r_i , ) & = 2 + _ ( r_i , ) + e_i , + v_i,^2-v_i,^2 & = ( r_i , ) - ( r_i , ) .    as shown by @xcite",
    ", this correction ensures the conservation of total energy of the system @xmath59 $ ] in his case . indeed ,    & e_-e _ = + & _ i m_i = + & _ i m_i - [ eq : sumenew ] + & _ i m_i + [ eq : sumeold ] + & _",
    "[ eq : difpot ]    the first two terms ( [ eq : sumenew ] ) and ( [ eq : sumeold ] ) represent the sum of energies of all particles , which is conserved by the relaxation step followed by the cancellation of fluctuations described above . the last term ( [ eq : difpot ] ) also should tend to zero in the continuum limit ( * ? ? ?",
    ". however , his proof is valid only if the updated potential is computed from the positions of particles at the end of the episode ; if we use @xmath60 sampling points , this is no longer true .",
    "therefore , we compute the last term explicitly , and cancel the total energy error @xmath61 by distributing it between all particles .    in all these correction steps , we can only attribute the energy error to the kinetic energy by changing the magnitude of particle velocities .",
    "this might introduce some bias , as the energy excess / deficit is attributed entirely to the kinetic energy ( and furthermore , if the energy needs to be subtracted from a particle happened to be around its turning point , the velocity may be too small to allow it , in which case it remains undercorrected ) , but it is the simplest practical way of cancelling the energy errors . we do not apply a similar correction to angular momentum fluctuations , as they remain small ( @xmath62 ) and do not have a preferred sign ( however , we only considered systems with zero total angular momentum and can not be sure that there will be no secular drift in angular momentum if it was non - zero initially ) .    for the two auxiliary methods used for comparison  spherical isotropic fokker  planck and monte carlo codes  there is no need to follow orbits in space , only the evolution of distribution function @xmath29 and its associated potential ",
    "density pair @xmath63 . in the finite - difference fokker ",
    "planck scheme , @xmath29 is sampled on a non - uniform grid in @xmath1 , and a flux - conservative implicit @xcite scheme is used ( see * ? ? ? * for a comparison of numerical methods ) . in the monte carlo scheme ,",
    "the distribution function is sampled by discrete particles with energies @xmath64 , and during each episode , each particle performs one or more monte carlo steps with timestep @xmath40 , according to @xmath65 with @xmath66 being a random number with standard normal distribution , and the diffusion coefficients given by ( [ eq : dc_energy_av ] ) .",
    "the timestep is assigned so that the expected change in energy does not exceed @xmath67 , with the tolerance parameter @xmath68 .",
    "when all particles have completed the episode , a new distribution function is computed in the same way as in the full ragacode ( i.e. , using penalized spline smoothing ) .",
    "the spherical potential is updated after the new distribution function has been computed , by using the following relation for the density : @xmath69 and then the poisson equation for the potential .",
    "followed by recomputation of the potential , the distribution function must be changed adiabatically , which is easiest to achieve by expressing it in terms of the phase volume @xmath70 ( [ eq : phasevol ] ) instead of @xmath1 , and then transforming back using the updated potential . as the equation ( [ eq : density_from_df ] ) contains the unknown potential itself ,",
    "it should be applied iteratively until convergence , while keeping @xmath71 constant at each iteration while @xmath1 changes . in practice",
    ", we found that for the fokker ",
    "planck method one iteration is sufficient , provided that timestep for the update is small enough ; for the spherical monte carlo code , we perform several iterations to reduce the impact of fluctuations of potential at origin , where the number of particles is small . for a simulation of a deep collapse ,",
    "the accumulated energy error is @xmath72 .",
    "@xmath73    @xmath74    in this section , we describe several test problems for the new monte carlo method .",
    "first , we demonstrate that temporal smoothing does help to reduce energy exchange between particles due to fluctuations of the potential to a negligible level , compared with the typical two - body relaxation rates .",
    "then , we perform two standard tests : the core collapse of a plummer sphere , and the growth of a bahcall  wolf cusp around a massive black hole . finally , we consider the shape evolution of a triaxial model with a black hole .      in this test",
    "we consider the relaxation rate of a spherical plummer model , evolved with different methods : @xmath0-bodysimulation with a direct - summation code , self - consistent field ( scf ) method , and the ragacode with relaxation turned off .",
    "the goal is to demonstrate that temporal smoothing does substantially reduce the energy and angular momentum relaxation rate , compared to more direct simulation methods .",
    "we take an @xmath75 plummer model with total mass and scale radius both equal to 1 @xmath0-bodyunits , and evolve it for @xmath76 time units , or roughly @xmath77 of the half - mass relaxation time . to measure the relaxation rate , we record the changes in energy and angular momentum of individual particles , average them over particles in each of 100 bins sorted in energy , and fit a linear regression to the squared difference between initial and current values of @xmath1 and @xmath2 as functions of time ( see @xcite for a somewhat different method of estimating the relaxation rate ) . the coefficient of this regression represents the diffusion coefficient @xmath78 ( [ eq : dc_energy_av ] ) and a similarly computed coefficient for @xmath2 .",
    "we have checked that the growth of @xmath79 and @xmath80 is indeed close to linear in time , with occasional fluctuations .    for the conventional @xmath0-bodysimulation we use the gpu - accelerated direct - summation code @xmath81grape@xcite with the sapporo library @xcite .",
    "figure  [ fig : energydiff ] demonstrates that the theoretically computed diffusion rates agree very well with the measured values from the direct @xmath0-bodysimulation without softening , using the standard value of the coulomb logarithm @xmath82 @xcite . in collisionless simulations , softening is used to reduce the graininess of the potential ; we have run another simulation with @xmath83 , which is close to the optimal value for this @xmath0 @xcite and reduces the relaxation rate by a factor of few @xcite .",
    "the other , `` indirect '' @xmath0-bodysimulation method that we used was the scf method of @xcite , employed in two regimes : in the first case we used all expansion coefficients ( @xmath84 radial and @xmath85 angular terms ) , in the second  retained only the non - zero terms for a triaxially symmetric model ( that is , cosine terms with even @xmath86 and @xmath9 ) .",
    "figure  [ fig : energydiff ] shows that the scf method demonstrates a several times lower rate of diffusion than a direct @xmath0-bodysimulation , when using all coefficients , and a further factor of few lower rate for a model with imposed triaxial symmetry .",
    "this is not unexpected , given that the potential in the scf method is fairly smooth , but the reduction of relaxation rate is limited by the fluctuations in the potential arising from frequent updates in the coefficients , as the update interval is equal to the timestep of equations of motion ( taken to be a small fraction ( @xmath87 ) of the dynamical time in centre ) , and is comparable to the reduction due to softening in a direct @xmath0-bodysimulation @xcite .",
    "it can further be improved by a factor of few by using a carefully constructed basis set @xcite .    on the other hand ,",
    "if we allow for less frequent updates in the potential while retaining the high accuracy in integrating the equations of motion , then the relaxation rate may be reduced even further , as shown by the simulations of ragacode with longer update intervals ( we checked that running it with the same timestep as the scf code produced identical results to the latter ) . increasing the number of sampling points @xmath37 for each particle per episode reduces the fluctuations even further .",
    "overall , for this model we attained a factor of hundred reduction in the relaxation rate , limited only by the update frequency : if the system needs to be simulated for a time substantially shorter than its relaxation time ( or the time for any other effect to change its structure significantly ) , then the potential update may be switched off altogether , entirely eliminating this source of unwanted fluctuations . on the other hand ,",
    "the necessary level of relaxation is readily restored by adding the stochastic two - body perturbation term to the equations of motion .",
    "we have checked that this produced essentially the same total relaxation as the direct @xmath0-bodysimulation , if the amplitude of perturbation term in equation  ( [ eq : perturbation_term ] ) was assigned accordingly , using the same values of @xmath0 and @xmath88 .",
    "@xmath89    self - gravitating systems are known to have negative specific heat and exhibit the phenomenon of core collapse ( * ? ? ?",
    "* chapter 18 ) . the easiest and probably most studied example is that of a plummer sphere composed of equal - mass particles , for which various studies based on isotropic fokker ",
    "planck method have found the core collapse time to be @xmath90 initial half - mass relaxation times @xmath91 ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "as discussed in the latter paper , a constant value of coulomb logarithm overestimates the relaxation rate in the centre at later stages of core collapse , as the effective number of stars in the core decreases ; anisotropic models also tend to have longer collapse times ( e.g. * ? ? ?",
    "* ) .    for this test",
    ", we set up an @xmath92 plummer model in the virial units ( with the scale radius set to @xmath93 ) . in the calibration @xmath0-bodyrun , performed by the same code @xmath81grape ,",
    "the moment of collapse corresponds to @xmath94 time units , in agreement with other @xmath0-bodystudies @xcite . with the standard choice of coulomb logarithm @xmath95 this corresponds to @xmath96 ; for the purpose of comparison with the isotropic fokker  planck and monte carlo simulations we have used a smaller value @xmath97 , which brings the collapse time in this particular simulation into better agreement with other methods .",
    "next we have run spherical isotropic fokker ",
    "planck and monte carlo codes , as well as the full ragacode .",
    "the fokker ",
    "planck simulation was taken as reference , with the time until core collapse being @xmath98 , in excellent agreement with other studies .",
    "figure  [ fig : core_collapse_comparison ] shows the evolution of various quantities ( lagrangian radii , central density and potential , and velocity anisotropy ) in different simulations .",
    "overall , the agreement between various methods is fairly good , at least until the central density increases by a factor of @xmath99 ; closer to the time of collapse , we do not expect either method to be reliable without taking into account the binary formation and heating and other phenomena beyond two - body relaxation . by the end of the simulation ,",
    "the accumulated energy error was around 2% .",
    "the density profile around a point mass ( massive black hole ) has a steady - state power - law solution of the fokker ",
    "planck equation , known as the @xcite cusp : @xmath100 for a single - component star cluster .",
    "dynamical models starting from different initial conditions tend to develop the cusp at radii smaller than @xmath101 , where the influence radius of the black hole @xmath102 contains the mass in stars equal to twice the black hole mass .",
    "this has been observed both in fokker",
    " planck models ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) and in @xmath0-bodysimulations @xcite .",
    "as the relaxation time in the newtonian potential of the central point mass is proportional to @xmath103 , if the initial density profile was shallower than @xmath104 , then the cusp grows from outside in .",
    "we have set up a spherical @xcite model with @xmath105 , @xmath106 and a central black hole with mass @xmath107 of the total mass in stars , drawing particle positions and velocities from a self - consistent isotropic distribution function ( e.g. * ? ? ?",
    "* ) , computed numerically from the eddington s formula , using the mkspherical program from smile . then , we evolved the model until it developed the steady - state bahcall  wolf profile .",
    "the @xmath0-bodysimulation used a version of code with chain regularization ( @xmath81grapech , * ? ? ? * ) . in the fokker",
    "planck model we adopted a zero - flux boundary condition at the black hole .",
    "figure  [ fig : bahcall_wolf ] shows the gradual evolution of the distribution function towards the @xmath108 solution . the agreement between fokker ",
    "planck , monte carlo and @xmath0-bodysimulations is again quite good .",
    "@xmath109    up to now we have considered spherical systems , to facilitate comparison between various methods .",
    "we now turn to the unique feature of ragacode , namely the ability to simulate systems of arbitrary geometry . for this test , we take a triaxial @xmath105 dehnen model with axis ratio of @xmath110 and a central black hole with mass @xmath111 of the total model mass .",
    "this was one of the test models for the smilecode for @xcite modelling described in ( * ? ? ? * section 7.1 ) .",
    "the simulation was conducted with the @xmath81grapech code using @xmath75 particles .",
    "it was found that the model evolved towards a somewhat less flattened and less triaxial shape over the timescale of simulation ( 100 time units ) .",
    "such evolution is not unexpected in light of previous studies ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) , although later papers suggested that the evolution may be not as rapid as found earlier @xcite .",
    "the driving force behind this shape evolution is thought to be the scattering of chaotic orbits by the central point mass : this would let them more uniformly populate the equipotential surface , which is typically rounder than the equidensity surface .",
    "however , the diffusion of chaotic orbits may be greatly facilitated by the graininess of potential @xcite , and very little has been explored on this topic .",
    "we performed simulations of the same system as studied in @xcite with the monte carlo code , in several regimes , using a combination of two options : ( i ) without two - body relaxation or with the stochastic perturbation equivalent to the relaxation rate of an @xmath75 system , and ( ii ) using a fixed initial potential , or updating the potential every 10 time units ( for a total simulation time of 100 time units ) .",
    "we used the iterative method e1 of @xcite for computing the axis ratios of our models as functions of radius ( the same method was used in the previous paper ) .",
    "figure  [ fig : shape_evolution ] shows the evolution of shape for our four runs , together with the one from the @xmath0-bodysimulation .",
    "clearly , in the absence of relaxation the shape does not substantially evolve , regardless of whether we update the potential or keep it fixed .",
    "on the other hand , inclusion of relaxation dramatically accelerates the shape evolution in the central parts of the model , bringing it in good agreement with the results of @xmath0-bodysimulation .",
    "this experiment suggests that the evolution of shape can be at least partially attributed to the discreteness noise which accelerates the chaotic diffusion .",
    "the substantial reduction of unwanted collisional relaxation offered by the presented monte carlo scheme offers new avenues in exploring the interplay between discreteness and chaos , enabling a more robust study of chaotic diffusion and its effect on the galaxy shape ( e.g. * ? ? ?",
    "we have reviewed the existing methods for simulating the evolution of stellar systems driven by the two - body relaxation , and proposed a new variant of monte carlo method suitable for studying non - spherical systems .",
    "it combines the flexible representation of the smooth average potential in terms of spherical - harmonic expansion ( similar to the scf method of * ? ? ?",
    "* ) with the spitzer s approach to the description of two - body relaxation in terms of local ( position - dependent ) velocity diffusion coefficients .",
    "the orbits of particles are thus evolved on a dynamical timescale , with the two - body interaction between them mediated by the diffusion coefficients computed from a smooth , nearly - stationary distribution function ( in a manner similar to the shapiro s variant of the monte carlo method , but without orbit - averaging ) .",
    "we have shown that the method reproduces some standard evolutionary models , and has a substantially reduced artificial relaxation rate ( related to random fluctuations in the potential expansion coefficients ) compared to the scf method .",
    "the wall - clock computation time of the monte carlo code was within one hour for all simulations discussed in this paper ( using a typical multi - core desktop ) , while some of the @xmath0-bodysimulations took a few days using high - end gpus .",
    "the ragacode is made publicly available at http://td.lpi.ru/~eugvas/raga/ ; additionally , its inclusion into the amuse framework @xcite is underway .",
    "* the monte carlo method ( in this and other variants , with the possible exception of spitzer s original formulation ) is not suitable for systems which are not in dynamical equilibrium . * the fluctuations in velocities ( and , hence , energies ) of particles are simulated independently from each other , which means that at the end of the monte carlo episode the total energy has , in general , a non - zero accumulated deviation .",
    "it is corrected by distributing this energy error between all particles , in proportion to their time - averaged energy diffusion coefficient , but the correction is applied to the magnitudes of velocity only .",
    "this could in principle bias the dynamics somewhat , but at least avoids much larger errors which occur without any such correction . the total angular momentum of the system is not conserved , but its fluctuations due to discreteness noise are rather small for a reasonable particle number . *",
    "the calculations assumed that all stars have the same mass .",
    "this is quite easy to generalize , by allowing each simulation particle to carry a given `` token '' dynamical mass ( which enters the expression ( [ eq : dc_vel]a ) for the drift coefficient ) , and this mass needs not be related to the actual amount of mass that this particle contributes to the total potential . in other words , we generalize hnon s concept of `` superstars '' by completely separating the notions of dynamical and tracer mass . likewise",
    ", stellar evolution may be accounted for by allowing this token mass to change with time .",
    "we note that for all simulations in this paper , we scaled the diffusion coefficients in such a way as to model a system with the number of stars @xmath0 being the same as the number of particles in the model , but this was done only to facilitate comparison with @xmath0-bodysimulations and is not a restriction of the code .",
    "* we ignored primordial and dynamically formed binaries and their contribution to the energy budget of the system , and did not consider the process of escape of stars .",
    "this could be implemented in a similar way to other state - of - the - art codes ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* stellar collisions in dense galactic nuclei may be accounted for by a scheme similar to @xcite and @xcite .",
    "* the discrete nature of mass tracers makes it difficult to simulate a system with high density contrast without resorting to mass refinement schemes .",
    "fortunately , in our implementation , the mass of a particle can be set in an arbitrary way , for instance , creating initial conditions with higher mass resolution where necessary ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) . however , if the evolution time is substantially longer than the central relaxation time , particles will tend to mix in energy , erasing the effect of mass refinement . to combat this , an adaptive `` creation  annihilation scheme '' , such as that employed by @xcite and @xcite , could be added to the algorithm .",
    "however , this mixing would also presumably drive the system towards spherical symmetry , so that the benefits of the arbitrary - geometry code would be irrelevant ; for systems with longer relaxation times ( such as galactic nuclei ) the initial mass refinement should suffice . *",
    "the diffusion coefficients are computed under the approximation of a spherically symmetric isotropic distribution function of background stars .",
    "this is perhaps the most fundamental limitation , and it means that we may reliably simulate only systems that are not too flattened and not too far from isotropy . it is known that in stellar systems that are at least partially rotationally supported , the two - body relaxation proceeds faster as the velocity dispersion is lower ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    ". however , it is possible to adapt the computation of diffusion coefficients for a distribution function that is isotropic in the rotating frame @xcite . * similarly , we did not take into account the processes that are not described by standard two - body relaxation theory , such as resonant relaxation in the vicinity of a massive black hole @xcite or non - gaussian character of energy diffusion at @xmath112 @xcite .",
    "the proper account of these processes is hindered by the fact that they are not simply described by uncorrelated random walk , and require more sophisticated statistical models ( e.g. * ? ? ?",
    "the error introduced by neglecting these effects depends on the question being addressed .",
    "for instance , the total rate of capture of stars by a massive black hole is rather weakly influenced by resonant relaxation , as shown by @xcite as well as by our own comparison of direct @xmath0-bodysimulations with the fokker ",
    "planck models @xcite , because the bulk of captured stars come from larger energies that those for which the resonant relaxation is effective . on the other hand",
    ", it surely is important for stars very close to the black hole , as are relativistic effects ( e.g. * ? ? ?",
    "* ) , also ignored in this study .",
    "the possibility of simulating collisional relaxation for stellar systems with arbitrary shape opens up a number of opportunities , especially for studies of elliptical galaxies and galactic nuclei which are otherwise inaccessible to direct @xmath0-bodysimulations with present - day computers :    * noise is known to enhance the efficiency of chaotic diffusion , especially in systems with a rich population of sticky chaotic orbits @xcite , such as triaxial dehnen models @xcite , and has been proposed to improve the phase - space coverage of chaotic orbits in the construction of schwarzschild models @xcite . however , very little is known of the implications of noise for the secular evolution of triaxial galaxies which may  or may not , depending on their orbital structure  evolve noticeably away from triaxiality during the hubble time @xcite .",
    "* non - spherical galactic nuclei have been proposed as a way to increase the rate of star captures by a supermassive black hole @xcite , if the triaxiality can persist for the hubble time . on the other hand , scattering of chaotic orbits by the black hole",
    "might destroy or reduce the triaxiality @xcite , and the collisional relaxation increases the rate of diffusion of stars into the black hole even in the axisymmetric potential @xcite .",
    "the evolution of non - spherical black hole nuclei , including the loss of stars into the black hole and changes in the galaxy shape , is difficult to follow by conventional @xmath0-bodysimulations because of very low relaxation rates in actual galaxies , compared to what can be achieved in the direct simulations .",
    "this topic is explored with the new monte carlo method in a separate paper @xcite . * likewise , the dynamics of binary supermassive black holes is substantially changed in a non - spherical system @xcite , although an accurate treatment of collisional relaxation in the non - spherical case is even more difficult for a binary black hole @xcite . * after implementing mass - dependent velocity drift coefficient , it becomes possible to study dynamical friction of not too massive objects ( heavier than field stars , but much lighter than the total mass of the model ) in non - spherical galaxies ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) in a more self - consistent way ( including possible feedback on the galaxy shape ) .",
    "a related idea was recently explored by @xcite , although their generic machinery of basis - set expansion was only applied for the spherical case .",
    "likewise , collisional evolution and mass segregation in galactic nuclei has been mostly studied in the spherical case @xcite ; only a few studies have considered non - spherical nuclei , resulting , for instance , from galactic mergers ( e.g. * ? ? ? * ) or globular cluster inspirals ( e.g. * ? ? ?",
    "* accurate treatment of escape of stars from globular clusters in a realistic tidal field of a galaxy is non - trivial @xcite , and it is quite tricky to implement it in a spherical monte carlo code @xcite .",
    "more generally , non - spherical globular clusters may present other interesting phenomena to study ( e.g. * ? ? ?",
    "* ) . * by modifying the expressions for diffusion coefficients using a suitable definition of background distribution function of stars ( for instance , lifting the assumption of isotropy ) , it will be possible to study rotating clusters .",
    "i warmly thank douglas heggie and mirek giersz for detailed comments on the early version of the manuscript , and am grateful to the anonymous referee for helpful remarks that improved the presentation .",
    "this work was partly supported by the national aeronautics and space administration under grant no .",
    "nnx13ag92 g ."
  ],
  "abstract_text": [
    "<S> we have developed a novel monte carlo method for simulating the dynamical evolution of stellar systems in arbitrary geometry . </S>",
    "<S> the orbits of stars are followed in a smooth potential represented by a basis - set expansion and perturbed after each timestep using local velocity diffusion coefficients from the standard two - body relaxation theory . </S>",
    "<S> the potential and diffusion coefficients are updated after an interval of time that is a small fraction of the relaxation time , but may be longer than the dynamical time . thus our approach is a bridge between the spitzer s formulation of the monte carlo method and the temporally smoothed self - consistent field method . </S>",
    "<S> the primary advantages are the ability to follow the secular evolution of shape of the stellar system , and the possibility of scaling the amount of two - body relaxation to the necessary value , unrelated to the actual number of particles in the simulation . </S>",
    "<S> possible future applications of this approach in galaxy dynamics include the problem of consumption of stars by a massive black hole in a non - spherical galactic nucleus , evolution of binary supermassive black holes , and the influence of chaos on the shape of galaxies , while for globular clusters it may be used for studying the influence of rotation .    </S>",
    "<S> [ firstpage ]    galaxies : structure  galaxies : kinematics and dynamics  globular clusters : general  methods : numerical </S>"
  ]
}