{
  "article_text": [
    "the free - electron laser ( fel ) is a proven source of high - power tunable radiation over a wide spectral range into the hard x - ray  @xcite , where its output is transforming our ability to investigate matter and how it functions , in particular in biology  @xcite .",
    "in addition to the atomic spatiotemporal resolution offered by the short wavelengths and pulses , the fel can also generate radiation output from planar through to full circular polarisation using undulators of variable ellipticity such as the apple - iii undulator design , proposed for swissfel  @xcite , and the delta undulator design  @xcite , installed at lcls  @xcite .",
    "this variably polarised output offers another important degree of freedom with which to investigate the behaviour of matter and is of significant interest across a wide range of science  @xcite .",
    "fel user facilities , such as the fermi user facility in italy , are now recognising and addressing this need for elliptically polarised output  @xcite .    in a planar undulator ,",
    "the electrons have a fast axial ` jitter ' motion at twice the undulator period as they propagate along the undulator axis .",
    "in addition to the coupling of the electrons to the fundamental radiation wavelength , the jitter motion allows coupling to odd harmonics of the fundamental , which can also experience gain .",
    "a commonly used model used for simulating the fel interaction is the ` averaged ' model which , as the name suggests , averages the governing maxwell and lorentz equations describing the electron / radiation coupling over an undulator period  @xcite .",
    "the averaging of the jitter motion introduces coupling terms described by a difference of bessel functions which depend upon both the undulator strength and the harmonic  @xcite . for an helical undulator",
    ", there is no electron jitter and the difference of bessel functions coupling terms become a constant for the fundamental and zero for all harmonics , i.e in an helical undulator there is no gain coupling to harmonics .",
    "it is perhaps surprising that the equivalent coupling terms for an elliptically polarised undulator have not been derived previously . in this paper ,",
    "the coupling terms due to electron jitter motion are calculated in a general way for all undulator ellipticities from a planar through to an helical configuration , corresponding to those now available from variably polarised undulators , so enabling more accurate modelling of this important type of fel output .",
    "the resultant derived coupling terms , which are more general form of the difference of bessel functions factors of the planar undulator case , are used to predict the scaling of the fel interaction for a range of undulator ellipticities .",
    "an averaged fel simulation code then uses the general bessel function factors to give solutions of elliptically polarised fel output into the nonlinear , high - gain regime and tested against the scaling .",
    "a further test is also made by comparing the results of the averaged fel simulations with an unaveraged simulation code , puffin  @xcite .",
    "new , perhaps unexpected , results are presented and discussed .",
    "in this section the equations describing the electron beam and radiation evolution in an elliptically polarised undulator are derived in the 1d limit .",
    "the equations are averaged over an undulator period removing any sub - wavelength information or effects such as coherent spontaneous emission .    the undulator magnetic field with variable ellipticity is simply defined as : @xmath0 where @xmath1 describes the undulator ellipticity , @xmath2 the peak undulator magnetic field , and @xmath3 where @xmath4 is the undulator period .",
    "the undulator ellipticity parameter varies in the range @xmath5 , from a planar ( @xmath6 ) through to an helical undulator ( @xmath7 ) to give an rms elliptical undulator parameter of : @xmath8 where the peak undulator parameter is defined as @xmath9 .",
    "the resonant fundamental fel wavelength is then : @xmath10 where the resonant electron energy in units of electron rest mass @xmath11 , the mean of the electron beam .      in the averaged fel model",
    "the electron orbits are first calculated in the absence of any radiation field from the lorentz force equation : @xmath12 where @xmath13 and @xmath14 are the @xmath15 electron s velocity scaled with respect to the speed of light @xmath16 , and the corresponding lorentz factor . substituting for the undulator field  ( [ ufield ] ) , and integrating the lorentz equation  ( [ lorentz ] ) ,",
    "the scaled electron velocity components are obtained : @xmath17^{1/2 } \\label{betaz } \\\\end{aligned}\\ ] ] where @xmath18 is the average longitudinal electron velocity .",
    "the constants @xmath19 and @xmath20 take their usual meanings of rest mass and charge magnitude of the electron . introducing the non - unit vector basis @xmath21 ,",
    "so that @xmath22 and @xmath23 , the perpendicular components may be written : @xmath24 integrating equation  ( [ betaz ] ) , the longitudinal electron trajectory in the presence of the undulator field only is : @xmath25 the oscillatory term in ( [ z oscil ] ) describes the ` figure - of - eight ' longitudinal jitter motion of the electron in a non - helical undulator associated with coupling to harmonics of the radiation field  @xcite .",
    "a co - propagating radiation field is similarly defined using the same non - unit vector basis @xmath26 as the sum over harmonics of the fundamental resonant field , i.e.  @xmath27 , where : @xmath28 the scaled energy evolution of the @xmath29th electron in the transverse plane - wave radiation field of  ( [ e_n ] ) may then be written as : @xmath30 using equations for the electron motion  ( [ betaperp ] , [ z oscil ] ) , the electric field ( [ e_n ] ) and the identity : @xmath31 the equation for the electron energy  ( [ gamma derivative wrt time1 ] ) simplifies to :    @xmath32    where @xmath33 is the pondermotive phase .",
    "resonant , non - oscillatory terms , which do not average to zero over an undulator period occur only for @xmath34 , so that on averaging over an undulator period equation  ( [ e dot beta bessel sum ] ) simplifies further to : @xmath35 where : @xmath36      the 1d wave equation is used to model the plane wave radiation field evolution and is given by : @xmath37 where @xmath38 is the transverse area of the co - propagating planar radiation field and electron beam with transverse current density of @xmath39 .",
    "the transverse components of the electric field and transverse current density are defined by @xmath40 and @xmath41 respectively . in the 1d limit",
    ", the wave equation  ( [ maxwell wave equation ] ) simplifies to : @xmath42 by using the transverse velocity  ( [ betaperp ] ) , the harmonic fields  ( [ e_n ] ) and by neglecting the backward wave as detailed in  @xcite then , using the bessel identity  ( [ jidentity ] ) , the wave equation  ( [ 1d maxwell wave equation ] ) reduces to a wave equation for each harmonic envelope @xmath43 : @xmath44 where @xmath45 is the ponderomotive phase of the fundamental wavelength .",
    "resonant terms are only seen to occur for @xmath46 and , as @xmath19 is integer , the harmonic numbers @xmath47 are therefore odd . applying this resonant condition yields : @xmath48      the scaling of  @xcite is now applied using the fel parameter @xmath49 , where @xmath50 is the peak non - relativistic plasma frequency of the electron beam . the wave equation for field  ( [ uawave ] ) is also averaged over a radiation wavelength by assuming the field envelope does not change in this interval .",
    "the independent variables are the scaled distance through the fel @xmath51 , and scaled position in the electron beam rest - frame @xmath52 , where @xmath53 and @xmath54 are respectively the gain length and cooperation length of the fel interaction at the fundamental ( @xmath55 ) in an helical undulator ( @xmath7 )  @xcite . clearly , and",
    "as shown from the scaling below , these lengths are different for interactions at harmonics and in an elliptical undulator .    introducing the scaled harmonic radiation envelopes : @xmath56 the scaled electron energy @xmath57 and using the definition of the ponderomotive phase @xmath58 , the scaled equations for the 1d fel interaction in an elliptically polarised undulator including harmonic radiation fields are given by : @xmath59 where @xmath60 are ellipticity dependent coupling parameters given by : @xmath61 and @xmath62 is the beam current scaled with respect to its peak value  @xcite .",
    "there is one wave equation of type  ( [ da ] ) for each harmonic considered .",
    "notice from  ( [ a_n ] ) , that the harmonic field envelopes @xmath43 are scaled so that the @xmath63 are proportional to the power of the elliptically polarised harmonic radiation fields over the full range of @xmath1 , from planar to helical polarisation .",
    "the equations for the elliptical model  ( [ dtheta ] - [ da ] ) are now solved for a range of ellipticity parameters @xmath1 .",
    "the solutions are determined by the ellipticity and harmonic dependent coupling parameters @xmath60 which are specified and used in scaling to predict the gain length and saturation powers of the elliptical fel interaction .",
    "numerical solutions of the averaged elliptical fel model of above are also compared with the unaveraged model of ` puffin '  @xcite .",
    "as the equations of this model are unaveraged , no factors such as  ( [ alpha ] ) appear in the model and puffin can simulate the fel interaction for an undulator of any ellipticity and over a broad radiation bandwidth that includes harmonic content .",
    "figure  ( [ fig1 ] ) plots the elliptical coupling parameters @xmath60 as a function of the ellipticity parameter @xmath1 for the resonant odd harmonics @xmath64 and for a range of rms undulator parameters @xmath65 .     plotted as a function of the ellipticity parameter @xmath1 for the first four odd harmonics @xmath66 .",
    "four different rms undulator parameters are shown in each graph : @xmath67 .",
    "the @xmath60 agree with previous analysis in the helical and planar limits , @xmath7 and @xmath6 respectively .",
    "note that for larger undulator parameters @xmath65 , the coupling parameters @xmath60 for harmonics maximise for an elliptical undulator configuration , @xmath68 .",
    "for example , for the third harmonic with @xmath69 , then @xmath70 is maximised for an undulator ellipticity of @xmath71 .",
    "[ fig1],height=453 ]    the coupling parameters agree with previous results in the helical and planar limits .",
    "it is worth noting that for the harmonic fields @xmath72 , and for larger undulator parameters @xmath65 , that the coupling is stronger for elliptically polarised undulators rather than the planar case of @xmath6 .",
    "this result is perhaps somewhat unexpected .",
    "if the equations for the elliptical model  ( [ dtheta]-[da ] ) are written in the absence of any harmonic interactions , i.e. for @xmath55 only , then the elliptical coupling parameter @xmath73 could be incorporated into the scaling to give a system of universally scaled equations with no free parameters  @xcite . in this case",
    "the fel scaling parameter would now depend upon the elliptical coupling parameter for the fundamental as @xmath74 , so that the gain length of the interaction , and so also the saturation length @xmath75 , would scale as @xmath76 .",
    "the scaled saturation power would scale as @xmath77 .    in the simulations which follow , an electron pulse of charge 70 pc",
    "is assumed with a uniform current , @xmath78 , over scaled pulse length of @xmath79 . a mean beam energy @xmath80 with zero energy spread and an fel parameter of @xmath81 is used . unless otherwise stated , the undulator has fixed rms undulator parameter of @xmath82 independent of the undulator ellipticity , to give a fixed resonant radiation wavelength of @xmath83 nm",
    ". a seed laser of scaled amplitude of @xmath84 was used to initiate the fel interaction .",
    "this eliminates shot - to - shot variation of the radiation pulse saturation energy and saturation length which occurs when the interaction starts from noise , simplifying comparison with analysis and the results obtained from the solutions of the different numerical codes .",
    "the total scaled energy of an harmonic of the radiation pulse is defined by : @xmath85 with the total given by the sum over the odd harmonics @xmath86 . as",
    "the electron pulse is many cooperation lengths long ( @xmath87 ) and the interaction is seeded , the interaction will approximate a steady - state interaction where pulse effects are small . in this case",
    ", the scaled pulse energy at saturation , either for a particular harmonic component @xmath47 or for the total , will be @xmath88 . for an helical undulator in the steady - state ,",
    "the scaled saturation power of the fundamental ( @xmath55 ) is @xmath89 . for the case considered here",
    "this gives a scaled pulse energy at saturation of @xmath90 .    in order to test the above scaling for the scaled saturation energy and saturation length , the equations  ( [ dtheta ] - [ da ] )",
    "were solved numerically for the above parameters in the absence of any harmonic interaction for a range of undulator ellipticities .",
    "figure  [ fig2 ] demonstrates that the numerical solutions are in very good agreement with the predicted scaling .",
    "- [ da ] ) in the absence of any harmonic interactions ( red crosses ) and the predicted scaling with respect to the elliptical coupling parameter of the fundamental @xmath73 ( blue line ) for the full range of the ellipticity from planar ( @xmath6 ) to helical ( @xmath7 ) .",
    "the top plot shows the saturated pulse energy @xmath91 and the lower the scaled saturation length @xmath92 .",
    "[ fig2 ] ]      numerical solutions to the averaged elliptical model of equations  ( [ dtheta]-[da ] ) are now compared with the those generated by the unaveraged code puffin  @xcite , which is able to model an fel interaction in an elliptically polarised undulator across a broad bandwidth radiation field that includes harmonic content .",
    "the unaveraged electron motion of the puffin model includes any ` jitter ' motion of equation  ( [ z oscil ] ) due to an elliptically polarised undulator .",
    "as puffin is an unaveraged fel simulator , the effects of self amplified coherent spontaneous emission ( sacse ) can be significant when modelling a ` flat - top ' electron bunch which has discontinuities in the electron beam current .",
    "as these effects can not be modelled in an averaged model , the electron bunch used in the puffin simulations here is modified to have smooth ramp down in current over several radiation wavelengths at the electron bunch edges .",
    "this smooth ramping of the current significantly reduces the generation of any coherent spontaneous emission , enabling a better comparison between the two models .    in what follows",
    ", only the fundamental and third harmonics ( @xmath93 ) are modelled using the above parameters . in the averaged model",
    ", the harmonic radiation content is obtained directly from the individual harmonic components , @xmath94 . in the unaveraged model , however , access to the content of each harmonic",
    "is obtained by fourier filtering the broadband radiation field about a narrow bandwidth of the particular harmonic of interest ( in this case for @xmath95 . )",
    "figure  [ fig3 ] plots the scaled pulse energy of the fundamental @xmath96 , from the averaged and puffin simulations as a function of scaled propagation distance through the interaction @xmath97 , for three different undulator ellipticities , @xmath98 .",
    ", as a function of scaled distance through the undulator for planar ( top , @xmath99 ) , elliptical ( middle , @xmath100 ) and helical ( bottom , @xmath101 ) undulator polarisation .",
    "[ fig3 ] ]    excellent agreement between the simulations is seen for all @xmath1 , well into the saturated , non - linear regime .",
    "the scaled radiation pulse energies @xmath102 of the fundamental and third harmonic for both averaged and unaveraged simulations for the planar undulator ( @xmath6 ) are shown in figure  [ fig4 ] .     for averaged and unaveraged simulations in a planar undulator ( @xmath6 ) , of rms undulator parameter @xmath103 .",
    "good agreement is seen except in the interval @xmath104 .",
    "[ fig4 ] ]    as previously seen in figure  [ fig3 ] , the fundamental pulse energies @xmath96 of the averaged and unaveraged simulations are in excellent agreement .",
    "the third harmonic shows reasonable agreement in the decoupled linear regime until @xmath105 . at this point in the averaged model ,",
    "the electron bunching at the fundamental also begins to drive the third harmonic field with a growth rate @xmath106 times that of the fundamental  @xcite .",
    "while there is evidence of similar enhanced harmonic growth in the unaveraged simulation , the effect is seen to be significantly less pronounced . as the interaction proceeds into the non - linear , saturation regime for @xmath107 ,",
    "both simulations are seen to resume a similar evolution .",
    "it was noted from figure  [ fig1 ] that for larger undulator parameters @xmath65 , the coupling parameters @xmath60 for harmonics maximise for an elliptical undulator configuration , @xmath68 .",
    "this increased coupling can be expected to decrease the gain length and increase the saturation pulse energies of harmonics for these elliptical polarisations . in particular , the gain length for the third harmonic in an undulator with parameter @xmath108 , should be minimised for an elliptical undulator with @xmath71 . from the above scaling ( and writing @xmath109 , etc ) the ratio of the two gain lengths @xmath110 .",
    "both the averaged and unaveraged numerical models were also used to simulate both undulator ellipticities @xmath111 for the same value of @xmath108 .",
    "the results are shown in figure  [ fig5 ] .",
    "the simulations are seen to agree well with each other in the linear regime with the elliptical undulator measured as having the shorter gain length @xmath112 , in good agreement with the value calculated from scaling .",
    "a similar scaling argument for the electron pulse energies at saturation gives @xmath113 which is more difficult to compare with the simulations of figure  [ fig5 ] due to the problem in defining the points of saturation .     in an undulator with @xmath114 for two different undulator ellipticities @xmath99 ( planar undulator ) and @xmath115 ( elliptical undulator )",
    "the third harmonic interaction is see to be stronger for the elliptical undulator , in agreement with the results of figure  [ fig1 ] , which shows that the coupling parameter is maximum for the elliptical undulator case .",
    "the gain lengths of both results agree well with predicted scaling via the elliptical coupling parameter @xmath70 .",
    "[ fig5 ] ]    note again , the difference in the simulation results between the averaged and unaveraged models as saturation is approached and the fundamental interaction drives that of the harmonic .",
    "the divergence between the two models is probably more pronounced in this case where @xmath108 , than that of figure  [ fig4 ] where @xmath82 .",
    "an averaged fel model in the 1d limit for ellipticity polarised undulators including resonant radiation harmonics was presented .",
    "the undulator ellipticity changes the previous difference of bessel functions factor , familiar from planar undulator fel theory , into a more general elliptical bessel function factor , valid for a planar undulator through to an helical undulator .",
    "this new elliptical factor was incorporated into a set of averaged , scaled , differential equations describing the fel interaction .",
    "the scaling of these equations allows important quantities such as the gain length and radiation pulse energy , to be estimated as a function of the undulator ellipticity .",
    "this averaged elliptical fel model of the undulator was also solved numerically and the scaling demonstrated .",
    "one notable result is that the harmonic gain and saturation energy for larger values of the undulator parameter @xmath65 , was greater for elliptically polarised undulators than for the planar equivalent .",
    "the averaged elliptical fel model was also compared with the numerical simulations of an unaveraged fel model using the puffin code which is also able to model elliptically polarised undulators ( also in 3d ) .",
    "overall , there was very good agreement between the two models . however , there were differences noted in the radiation pulse energy evolution of the harmonics as the interactions approached saturation and the harmonics are strongly coupled and driven by the interaction at the fundamental .",
    "this is not directly related to the ellipticity of the polarisation , but is thought to be a more general issue related to the validity of the averaging process in accurately describing the coupling between the fundamental and harmonic interactions .",
    "this topic will require further research .",
    "we gratefully acknowledge support of science and technology facilities council agreement number 4163192 release # 3 ; archie - west hpc , epsrc grant ep / k000586/1 ; epsrc grant ep / m011607/1 ; and john von neumann institute for computing ( nic ) on juropa at jlich supercomputing centre ( jsc ) , under project hhh20",
    "99 m@xmath116neil b w j and thompson n r 2010 nat .",
    "photonics * 4 * 814"
  ],
  "abstract_text": [
    "<S> a model of a free electron laser operating with an elliptically polarised undulator is presented . </S>",
    "<S> the equations describing the fel interaction , including resonant harmonic radiation fields , are averaged over an undulator period and generate a generalised bessel function scaling factor , similar to that of planar undulator fel theory . </S>",
    "<S> comparison between simulations of the averaged model with those of an unaveraged model show very good agreement in the linear regime . </S>",
    "<S> two unexpected results were found . </S>",
    "<S> firstly , an increased coupling to harmonics for elliptical rather than planar polarisarised undulators . secondly , and thought to be unrelated to the undulator polarisation , a significantly different evolution between the averaged and unaveraged simulations of the harmonic radiation evolution approaching fel saturation . </S>"
  ]
}