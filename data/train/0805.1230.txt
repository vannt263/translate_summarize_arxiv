{
  "article_text": [
    "in the hierarchical structure formation scenario , dark matter halos grow by accreting and merging with other halos . statistically modeling halo merger histories",
    "is important for understanding a diverse spectrum of astrophysical processes ranging from galaxy formation , the growth of super - massive black holes , to cosmic reionization .",
    "numerical simulations aside , the most frequently used theoretical framework for studying the build up of dark matter halos is the press - schechter ( ps ) model @xcite .",
    "this framework is further developed in the so - called extended press - schechter ( eps ) model ( @xcite ) . for a descendant halo of a given mass at redshift @xmath3 ,",
    "the eps model predicts the average mass spectrum of its progenitors at a higher redshift @xmath4 ( the _ conditional _ or _ progenitor _ mass function ) .",
    "the eps model provides only statistical information about halo mergers and does not specify how progenitor halos are to be grouped into descendant halos . however , it is often useful , particularly in semi - analytic modeling , to have actual realizations of the merging history for a large set of haloes . a number of monte carlo algorithms have been proposed for this purpose ( see , , @xcite ) .",
    "these algorithms allow one to produce realizations of halo merger trees stretching back to high redshifts in a fraction of the time that is required for performing and analyzing cosmological @xmath5-body simulations of comparable resolution .",
    "thus far , most of the commonly used monte carlo methods are based on the spherical eps theory . in @xcite ( also see @xcite ) , halo mergers at each time step are assumed to be binary : one of the progenitor masses is randomly drawn from the conditional mass function , and the other progenitor mass is defined by the difference between the descendant halo mass and this first progenitor mass . though this seems to be the most natural way to generate halo merger histories , it has been pointed out by several authors that the binary picture does not reproduce the eps progenitor abundance at earlier times ( see , , @xcite ) .",
    "moreover , this problem does not disappear when the time step is greatly reduced .",
    "this fact has led to the investigation of alternative monte carlo algorithms with different recipes for building halo merger trees in the spherical eps framework .",
    "for example , somerville & kolatt ( 1999 ) find that if the binary assumption is relaxed while taking into account the contribution of mass from continuous accretion then the progenitor abundance at large look - back times is better reproduced .",
    "cole et al .",
    "( 2000 ) , on the other hand , include diffuse accretion but preserve the assumption of binary mergers .",
    "more recently , partially due to the rapid advances in n - body simulation , various other algorithms have been proposed that are either designed to fit n - body results ( , @xcite ) or are based on the spherical @xcite or ellipsoidal @xcite excursion set model .",
    "the presence of these numerous monte carlo algorithms suggests that building a monte carlo algorithm that is fully consistent with the underlying eps model is not unique and can be non - trivial .",
    "we were motivated to write this paper for a number of reasons .",
    "first , this is a sequel to our previous work @xcite , which presented an accurate analytic formula for the conditional mass function for small time - steps in the ellipsoidal eps model .",
    "this formula is particularly useful as an input for high - resolution monte carlo simulations of halo merger trees .",
    "earlier formulae ( e.g. @xcite ) were accurate only for larger look - back redshifts ( @xmath6 ) .",
    "taking such a large time - step would limit the dynamic range in both the progenitor mass and redshift that can be covered in a monte carlo simulation .",
    "in addition , until recently , all previous monte carlo algorithms were studied in the framework of the spherical eps model , which is well known to produce inaccurate total ( i.e. unconditional ) halo mass function when compared with simulations .",
    "this paper will investigate the algorithms in the ellipsoidal model using the formula in @xcite .",
    "second , as we began to investigate the various monte carlo algorithms proposed in the literature , we were frustrated by the lack of direct comparison among the different methods , each of which has its own range of validity and own set of assumptions about how to group progenitors into descendants ( e.g. binary vs multiple progenitors ; how the mass in progenitors below mass resolution is treated ) .",
    "moreover , it was not always clear why a given algorithm succeeded or failed . in this paper , we examine closely the four most frequently used algorithms ",
    "@xcite  and compare their predictions for the conditional mass function over a wide range of progenitor masses and look - back redshift ( e.g. , down to @xmath7 of descendant mass and up to redshift 15 , much larger than those studied previously ) .",
    "we find that only @xcite is fully consistent with the eps model at all look - back time steps .",
    "the limitations and causes of discrepancies in the other three methods are discussed .",
    "third , in light of the discrepancies in earlier algorithms , we investigate three new monte carlo algorithms that are all constructed to reproduce accurately the eps predicted conditional mass function at any look - back redshift .",
    "we present a consistency criterion that is useful as a general guide for building monte carlo algorithms : if an algorithm reproduces the eps progenitor mass function for a sequence of simulation time - steps between @xmath8 and @xmath9 ( where @xmath10 ) , then it is guaranteed to reproduce the eps progenitor mass function at any @xmath11 for descendants at any later @xmath12 ( where @xmath13 ) .",
    "this is a necessary and _ sufficient _ condition .",
    "fourth , the eps model is an incomplete theory that predicts only a subset of statistical properties of halo mergers .",
    "it therefore leaves one with much freedom in how to assign progenitors to descendants in a given monte carlo algorithm .",
    "for instance , it is possible to construct different consistent monte carlo algorithms that predict different statistical merger quantities beyond the conditional mass function .",
    "our three new algorithms and kw93 are four examples that are degenerate in the conditional mass function but are different in other progenitor statistics . in this paper",
    "we illustrate the differences among the models with two such statistics : the mass function of the @xmath14 most massive progenitors and the mass function of progenitors for descendant halos with @xmath2 progenitors .",
    "results from @xmath5-body simulations will be needed to constrain these higher - moment statistics . since computing the statistics of progenitor dark matter halos in simulations is by itself a major independent project",
    ", we will focus on the eps theory and monte carlo algorithms in this paper and leave the comparison with @xmath5-body results to a subsequent paper ( zhang , fakhouri & ma 2008 , in prep ) .",
    "the paper is structured as follows . the eps formalism based on both the spherical and ellipsoidal gravitational collapse models",
    "is reviewed in  [ eps ] . in  [ mceps ]",
    "we discuss three ingredients for how to grow an accurate monte carlo merger tree : the consistency criterion for reproducing eps (  [ theorem ] ) , the asymmetry in the eps progenitor mass function and the necessity of non - binary mergers in an algorithm (  3.2 ) , and the role of mass resolution and diffuse accretion for progenitor mass assignment (  3.3 ) .",
    "details of the four old and three new algorithms are discussed in  4 and  5 , respectively .",
    "whenever possible , the resulting progenitor mass functions from different algorithms are shown on the same plots for ease of comparison .",
    " 6 compares the two new progenitor statistics that can be used to discriminate among the monte carlo algorithms that are consistent with eps .",
    "we summarize our findings in  [ summary ] , with a discussion of some recent work in this field .",
    "the calculations in this paper assume a @xmath15cdm model with @xmath16 , @xmath17 , @xmath18 , @xmath19 , @xmath20 , @xmath21 .",
    "this is the same cosmology used in the millennium simulation ( @xcite ) .",
    "in this section we present a brief overview of the eps theory based on both the spherical and ellipsoidal gravitational collapse models .",
    "we often refer to the two models in parallel as the spherical and ellipsoidal eps models , with the understanding that the ellipsoidal version is based on the excursion set formalism of @xcite .",
    "the emphasis here is on the conditional mass function , which is the main statistical quantity used to generate progenitors in merger tree algorithms . for a more complete and pedagogical review of eps ,",
    "see @xcite and references therein .",
    "the press - schechter ( ps ) model provides a framework for identifying virialized dark matter halos .",
    "it is assumed that the seed density perturbations that grow to form these halos are characterized by an initially gaussian random density field with larger fluctuations on smaller spatial scales .",
    "this latter assumption allows one to use @xmath22 , the variance of the linear density fluctuations smoothed over spatial scale @xmath23 , as a proxy for the spatial scale @xmath23 .",
    "moreover , since a given spatial scale is related to a unique mass scale @xmath24 via the mean density of the universe @xmath25 , one can use @xmath23 , @xmath26 , and @xmath27 interchangeably as measures of scale .",
    "the density field smoothed over a given scale @xmath26 is given by @xmath28 where @xmath29 is the average density within the smoothing scale @xmath23 . in the eps model ,",
    "the linear density field centered at a given point in the initial lagrangian space traces out a random walk ( referring to a markovian process ) as the smoothing scale is reduced . starting from a large smoothing scale",
    ", a virialized dark matter halo is assumed to form at the given spatial coordinate when the linear @xmath30 crosses a critical value for the first time ; the mass of the halo is determined by the smoothing scale at first - crossing . in the spherical eps model ,",
    "the critical over - density is given by the spherical collapse model and is a constant @xmath31 independent of mass scale .    in the above description , as",
    "a result of gravitational instability , the density field grows with time as a linear function of its initial value , , @xmath32 , where @xmath33 is the standard cosmology - dependent linear growth factor satisfying @xmath34 . in practice ,",
    "one usually fixes the value of @xmath30 at some reference time ( today : @xmath35 ) and evolves the critical over - density to identify virialized halos at earlier redshifts .",
    "we denote this time - dependent critical over - density by @xmath36 .",
    "note that a lower redshift corresponds to a smaller @xmath37 , implying that larger halos form at later times , in accordance with the hierarchical structure formation scenario .    under the assumption of gaussian statistics ,",
    "the eps framework allows one to compute the first crossing distribution @xmath38 . of the set of random walks that begin at @xmath39 ,",
    "the first crossing distribution is the fraction of these random walks that _ first _ cross the critical over - density @xmath40 at scale @xmath41 , where @xmath42 and @xmath43 ( @xmath44 ) .",
    "it can be shown @xcite that the first crossing distribution in the spherical eps model has the form @xmath45d\\ds \\end{aligned}\\ ] ] where @xmath46 and @xmath47 .",
    "the first crossing distribution can be reinterpreted as the conditional mass function @xmath48 , which is defined to be the mass fraction of a descendant halo of mass @xmath49 at redshift @xmath3 that originates from a progenitor halo of mass @xmath50 at redshift @xmath4 : @xmath51 note , in particular , that @xmath48 is the _ mass - weighted _ conditional mass function as it represents the merging history of a unit of mass .",
    "the average number of progenitors of mass @xmath50 at @xmath4 associated with the formation of _ each _ descendant halo of mass @xmath49 at @xmath3 is given by the _ number - weighted _ conditional mass function @xmath52 , which is simply related to the mass - weighted conditional mass function @xmath48 by @xmath53 for brevity , we often refer to the number - weighted conditional mass function @xmath52 as the _ progenitor _ mass function , and denote it simply as @xmath54 with @xmath3 and @xmath4 specified elsewhere in paper .",
    "this quantity is sometimes denoted as @xmath55 in the literature .",
    "the original press - schechter theory was based on the spherical collapse model . the unconditional mass function in this model",
    "is well known to have an excess of small halos and a deficit of massive halos in comparison with simulation results ( , @xcite ) .",
    "this discrepancy arises because halo collapses are generally triaxial rather than spherical ( @xcite ) . in the spherical collapse picture ,",
    "the virialization of a dark matter halo is purely determined by the density - contrast on the scale of the halo mass .",
    "this assumption is too simplistic because dark matter halos generally have non - zero ellipticity and prolateness , and the condition for virialization should be determined by both the density - contrast and the halo shape parameters .    by assuming that a dark matter halo virializes when its third axis collapses , @xcite find a new criterion for virialization that depends on the ellipticity and prolateness of a dark matter halo in addition to its density contrast . in practice",
    ", this condition can be simplified either by averaging over its dependence on the shape parameters , or by fixing the shape parameters at their most likely values for a given over - density . by doing so",
    ", these authors obtain a fitting formula for the scale-_dependent _ critical over - density , or barrier , in contrast to the scale - independent @xmath56 of the spherical collapse model .",
    "it is parameterized as ( @xcite ) : @xmath57 = \\sqrt{\\gamma}\\delta_c\\left[1+\\beta(\\gamma\\nu)^{-q}\\right]\\ ] ] where @xmath58 , @xmath59 , @xmath60 , @xmath61 , and @xmath26 is the halo mass . in this ellipsoidal collapse model ,",
    "the scale - dependence is such that the formation of small halos is delayed , thereby reducing their abundance and providing closer agreement with the unconditional mass function in simulations than the spherical model .",
    "to compute the _",
    "conditional _ mass function in the ellipsoidal eps model , one would need the equivalent of the first - crossing distribution eq .",
    "( [ firstcrossingdistribution ] ) .",
    "the exact analytical form of eq .",
    "( [ firstcrossingdistribution ] ) , unfortunately , is valid only for the scale - independent constant barrier @xmath56 of the spherical eps model .",
    "@xcite have presented a taylor - series - like approximation for the ellipsoidal model , but @xcite show that this form works well for large @xmath62 but is invalid for small @xmath62 . as the construction of an accurate ellipsoidal monte carlo merger tree algorithm requires accurate knowledge of the ellipsoidal progenitor mass function at small time - steps , it is crucial that this matter be resolved .",
    "this was done in @xcite . using the scale - dependent critical over - density of @xcite and the technique of @xcite",
    ", @xcite derived an accurate form for the progenitor mass function of ellipsoidal eps model for small time steps ( @xmath63 ) , which can be written as : @xmath64\\right.\\\\ \\nonumber        & + & \\left.a_2\\tilde{s}^{3/2}\\exp\\left(-\\frac{a_1 ^ 2}{2}\\tilde{s}\\right )        \\left[1+\\frac{a_1}{\\gamma(3/2)}\\sqrt{\\tilde{s}}\\right]\\right\\ } \\end{aligned}\\ ] ] where @xmath65 , @xmath66 , @xmath67 , @xmath68 , and @xmath69 .",
    "note that unlike eq .",
    "( 15 ) of @xcite , we have not neglected the small @xmath70 term in the exponent because it is important for tracing the massive progenitors ( small @xmath71 ) .",
    "two other features are worth noting .",
    "first , unlike in the spherical eps model , @xmath54 in eq .",
    "( [ dndm_e ] ) depends weakly on the redshift @xmath3 .",
    "second , due to the intersections of barriers at the low mass end , eq .",
    "( [ dndm_e ] ) turns unphysical ( , @xmath72 ) when @xmath73 , , when the descendant mass is much smaller than the typical halo mass at @xmath3 . in our monte carlo simulations discussed below ,",
    "whenever the second feature becomes a problem ( which occurs very rarely ) , we do not generate any progenitors for the halo in the next time step . as we will show in  [ newmethods ] , this procedure only mildly affects the progenitor abundance at the very low mass end .",
    "( [ dndm_e ] ) provides a closer match to the merger rates determined from @xmath5-body simulations @xcite , but the agreement was not perfect , perhaps due to the non - markovian nature of numerical simulations .",
    "as discussed in the introduction , the eps model only provides a subset of _ statistical _ information about dark matter halo merger histories .",
    "for example , the eps progenitor mass function @xmath74 ( eq .  [ dndm ] for spherical and eq .",
    "[ dndm_e ] for ellipsoidal ) gives the _ average _ mass spectrum of the progenitors for the descendant halos .",
    "however , it is often useful , especially in semi - analytical modeling , to have an actual monte carlo realization of the formation history for a large set of halos . of particular interest is the merger tree of individual halos , which provides the hierarchical links among the progenitors and their descendants .",
    "since the eps model itself does not specify explicitly how to group progenitors into descendants , in each time - step in a monte carlo algorithm , assumptions must be made about the number of progenitors and their mass distributions to be assigned to a given descendant .",
    "the earlier monte carlo algorithms ( e.g. , @xcite ) for merger tree constructions share a similar overall structure : a descendant halo of mass @xmath49 at some redshift @xmath3 ( typically @xmath75 ) is chosen .",
    "the eps progenitor mass function , @xmath74 , is then used to generate a set of progenitors at some earlier redshift , using the rules of the given algorithm . in the next time - step , these progenitors become descendants , and each is assigned its own set of progenitors at an earlier redshift using @xmath74 .",
    "this process is repeated out to some early redshift and for a ( typically large ) number of halos of mass @xmath49 at the starting @xmath3 .",
    "the existence of a number of diverse monte carlo algorithms ( see further discussion in  [ methods ] ) in the literature implies that the above process is , in fact , not unique and can be quite subtle .",
    "we now explore some of these subtleties and the key ingredients for constructing a healthy merger tree .",
    "we consider a monte carlo algorithm to be _ consistent _ with eps if the merger trees it produces can reproduce the eps progenitor mass function @xmath52 exactly for _ any _ set of @xmath76 regardless of the number or size of the simulation time - steps between @xmath3 and @xmath4 .",
    "clearly , to be consistent with eps , a monte carlo algorithm must _ necessarily _ reproduce the eps - predicted @xmath74 exactly at _ adjacent _ time steps .",
    "we now show that this is also a _ sufficient _ condition for the monte carlo method to reproduce @xmath74 exactly at _ any _ look - back time regardless of the number , or width , of intervening time - steps .",
    "this condition is important because it simplifies the analysis of monte carlo algorithms : the failure of a given algorithm to reproduce faithfully the eps @xmath74 at a particular redshift or mass range necessarily implies that the algorithm fails to reproduce the progenitor mass function ( in either amplitude or shape or both ) across a single time step .",
    "we start with the first crossing distribution eq .",
    "( [ firstcrossingdistribution ] ) and note that due to the continuous nature of the random walk , it obeys the following identity at different look - back times : @xmath77 for any @xmath78 .",
    "this relationship is true in both spherical and ellipsoidal eps models because both variants are based on barrier crossings of random walks .",
    "note that in the ellipsoidal model , eq .",
    "( [ ff ] ) is a property of only the exact first - crossing distribution , which is well represented by eq .",
    "( [ dndm_e ] ) for small look - back times but not the taylor - series - like approximation of @xcite .",
    "also note that eq .",
    "( [ ff ] ) may not be strictly satisfied at the very low mass end due to the intersections of barriers in the ellipsoidal model . as we will show in  [ newmethods",
    "] , this only causes a minor problem on very small mass scales .    using eqs .",
    "( [ p ] ) and ( [ dndm ] ) to relate @xmath79 to the progenitor mass function @xmath80 , we then obtain @xmath81 setting @xmath82 and @xmath83 , we see that eq .",
    "( [ nf ] ) implies that if a monte carlo method generates progenitors _ exactly _ according to the progenitor mass function of eps at each time step @xmath84 , then the monte carlo progenitor mass function should agree with the eps prediction at any look - back time @xmath85 .",
    "we stress that @xmath74 must be reproduced exactly , that is , in both the overall shape and normalization of @xmath74 .",
    "this consistency condition is both necessary and sufficient .",
    "an additional feature to note is that consistency is possible in the presence of a mass resolution limit @xmath86 ( discussed further in  [ massres ] ) .",
    "( [ nf ] ) shows that @xmath87 does not depend on masses outside of the range @xmath88 $ ] .",
    "thus if a monte carlo algorithm reproduces @xmath74 for all @xmath89 in single time - steps , it will consistently reproduce @xmath74 at @xmath89 for any @xmath85 .",
    "the simplest way to group progenitors into descendants in a monte carlo algorithm is through binary mergers , , each descendant halo of mass @xmath49 is composed of two progenitors of mass @xmath50 and @xmath90 .",
    "this assumption is used in , e.g. , @xcite .",
    "this simple scenario , however , will necessarily fail to reproduce both the spherical and ellipsoidal eps progenitor mass functions .",
    "this is because if all descendants were the products of binary mergers , then @xmath74 would be symmetric about @xmath91 for infinitesimal @xmath84 .",
    "this is simply not the case in eps .",
    "we illustrate the asymmetry of the eps @xmath74 in fig .",
    "[ spherical_shade ] for a descendant halo of mass @xmath92 at @xmath75 and a look - back time of @xmath93 ( which is the typical time - step used in our monte carlo simulations ; see sec .  4 ) .",
    "the solid black curve shows the total @xmath74 , while the red dashed curve shows the symmetric part @xmath94 defined by @xmath95 where the left side ( @xmath96 ) of @xmath94 is defined to be identical to @xmath74 and the right side is defined to be simply the reflection of the left half about the mid point @xmath91 .",
    "the second term @xmath97 is then the residual of @xmath80 after subtracting out @xmath98 .",
    "the figure illustrates that it is not possible for all progenitors with @xmath99 to have binary - paired progenitors of mass @xmath100 .",
    "in particular , we find that for sufficiently small look - back times ( e.g. @xmath93 used in fig .",
    "[ spherical_shade ] ) , @xmath101 when @xmath102 and @xmath103 when @xmath104 ( see the pop - up in fig .  [ spherical_shade ] ) .",
    "that is , there are slightly fewer progenitors with masses below @xmath91 than above , except near the end points ( below @xmath105 and above @xmath106 ) where the trend is flipped .",
    "even though the asymmetry is typically small ( @xmath107 out to @xmath108 ) , an accurate algorithm must include non - binary progenitor events",
    ". these can be descendants with either a single progenitor or multiple ( @xmath109 ) progenitors , as will be seen in the new algorithms discussed in ",
    "[ newmethods ] below .",
    "this fact was emphasized by @xcite .",
    "these authors construct a mass conserving consistent monte carlo algorithm that produces a large number of non - binary descendants .",
    "however , one intuitively expects that more mergers will be binary as @xmath110 .",
    "this intuition is supported by results from the millennium simulation @xcite , which show that the binary assumption becomes increasingly valid down to smaller @xmath86 as @xmath62 is made smaller .",
    "this result suggests that the markovian nature of the standard eps model with a top - hat smoothing window may need to be modified to account for the correlated sequences of mergers occurring in simulations @xcite .     of the spherical eps model for a descendant halo of mass @xmath111 at @xmath75 and a look - back redshift of @xmath112 .",
    "the red dashed curve shows the symmetric part of @xmath74 , @xmath94 , whose right side is simply the reflection of the left side .",
    "the figure indicates that some progenitors of masses larger than @xmath91 do not have companions in the simplest binary scheme .",
    "the pop - up is a zoom - in on the right - most part of the plot and illustrates that the red dashed curve exceeds the solid curve at @xmath113 . ]      in the eps model , all the mass in the universe is assumed to be in dark matter halos . although the mass - integral of the ( unconditional ) mass function in this model is finite , the number - integral is unbounded ; that is , eps predicts a preponderance of very low mass halos .",
    "thus , any practical monte carlo algorithm must necessarily assume a lower mass cutoff , the mass resolution @xmath86 .",
    "for a nonzero @xmath86 , a halo s merger history at each time step can be thought of consisting of mass in the form of resolvable progenitor halos and a reservoir of mass due to `` diffuse '' accretion that is the aggregate contribution from all sub - resolution progenitors .",
    "this technical distinction is introduced for ease of implementing the monte carlo methods .",
    "it will , however , play a more physical role when we compare the results with @xmath5-body simulations , which has its own mass resolution as well as a possibly physical diffuse component consisting of tidally stripped dark matter particles . in this paper",
    "we use @xmath114 to denote this diffuse accretion component , which we define to be @xmath115 where @xmath116 are the masses of the progenitors above @xmath86 and @xmath49 is the mass of the descendant .",
    "we call a monte carlo algorithm _ mass conserving _ if each descendant and its progenitors produced by the algorithm satisfies @xmath117 .",
    "monte carlo algorithms are generally expected to be mass conserving , but we note that this is not a necessary condition for reproducing the eps progenitor mass function because the latter is a statistical measure of merger properties . in two of our new algorithms below ( methods a and b in  [ newmethods ] ) ,",
    "a small fraction of the descendants can have @xmath118 .",
    "we allow this to simplify the description and implementation of our algorithms .",
    "we have experimented with redistributing these excess progenitors among other descendant halos in a mass - conserving manner and found it not to modify significantly the resulting merger statistics .",
    "in addition , it may appear that @xmath119 is unphysical .",
    "we have found , however , that a non - negligible fraction of halos in @xmath5-body simulations in fact have @xmath120 , perhaps as a result of tidal stripping .",
    "this point will be discussed in greater detail in our next paper .",
    "we note that for a monte carlo algorithm that is consistent with eps , the mean value of @xmath114 per descendant halo of mass @xmath49 ( i.e. , averaged over all descendants in a given time - step ) is , by construction , related to the mass resolution by @xmath121 for a given @xmath74 and @xmath86 , @xmath122 is therefore specified .",
    "the _ distribution _ of @xmath114 , however , can differ greatly among different algorithms ; that is , there is much freedom in how to assign the amount of diffuse accretion to individual descendants in a given time - step . for instance",
    ", @xcite assumes a delta - function distribution for @xmath114 ( see  [ sec : c00 ] for details ) , while most of other methods , including our new methods discussed in  [ newmethods ] , have broader distributions .",
    "in this section we examine four existing monte carlo algorithms for generating merger trees : @xcite [ lc93 ] , @xcite [ kw93 ] , @xcite [ sk99 ] , and @xcite [ c00 ] .",
    "this set is by no means complete , but these are four of the most frequently used algorithms in the literature . the purpose here is to compare these well known algorithms side - by - side and to illustrate the mass and redshift ranges for which each method succeeds and fails in matching the spherical eps model .",
    "this not only benefits the current users of the methods , but also prepares us for incorporating the ellipsoidal eps model into the successful method ( kw93 ) , which will be compared with our new methods in sec .  5 .",
    "we review each algorithm in a subsection below and compare the resulting progenitor mass functions @xmath74 with the spherical eps prediction for look - back redshifts ranging from 0.24 to 15 . in figs .",
    "[ pdf_4eps_e2]-[pdf_4eps_e4 ] we plot the progenitor mass functions produced by all four methods , along with the analytical eps prediction , on log - log plots for three descendant masses ( @xmath123 ) and four look - back times ( @xmath124 and @xmath125 ) . to ease comparison",
    ", we also plot the ratio between each monte carlo result and the eps prediction on a linear - log plot . as figs .",
    "[ pdf_4eps_e2]-[pdf_4eps_e4 ] clearly show , of the four algorithms , only kw93 is able to match the spherical eps @xmath74 for _ all _ @xmath85 .",
    "we will explore why each algorithm fails below and discuss the care that must be taken when implementing kw93 .",
    "a summary of the four algorithms , their discrepancies , and the causes of the discrepancies is given in table  [ methodstablesummary ] .",
    "in our monte carlo simulations , we generally keep track of all progenitors down to @xmath126 at each time step for a descendant halo of mass @xmath49 .",
    "this large dynamic range allows us to predict reliably the progenitor abundance even for a very large look - back time ( @xmath127 ) . to speed up the algorithm",
    ", we take each time step to be a constant difference in the barrier height @xmath128 ( where @xmath129 at low @xmath130 ) , which is chosen to be about @xmath131 for lc93 , kw93 , sk99 , and @xmath132 for c00 at @xmath0 . the progenitor mass function of a given descendant halo mass is then identical for each time step and does not have to be recomputed .",
    "numerical convergence is tested by changing the time - steps used in the simulation : our results do not change .",
    "r|p1in|p2.7in|p2.1 in algorithm & overview & discrepancy in progenitor mass function @xmath74 & reasons for discrepancies + & binary and 1-to-1 & & + & @xmath133 & + & multiple mergers & & + & @xmath134 & + & multiple mergers & & + & @xmath134 ( can be bigger or smaller than @xmath86 ) & + & & + & binary and 1-to-1 & & + & @xmath114 is a constant given by equation ( [ c00 dm ] ) . & +                  the algorithm proposed by lc93 makes two important assumptions : all mergers are binary ( before mass resolution is imposed ) , and the descendant mass @xmath49 is the sum of the two progenitor masses @xmath50 and @xmath135 ( where @xmath136 in our convention ) . for each small look - back time step and for each descendant",
    ", a progenitor mass is randomly chosen according to the mass - weighted conditional mass function eq .",
    "( [ p ] ) , and the mass of the other progenitor ( which can be larger or smaller ) is simply set to be the difference between @xmath49 and the first chosen progenitor mass . if the less massive progenitor @xmath135 falls below a chosen mass resolution @xmath86 , or equivalently , @xmath137 , then @xmath50 is kept but @xmath135 , being a sub - resolution progenitor , is discarded .",
    "this results in single - progenitor halos which we label as `` @xmath138 '' events . in this notation ,",
    "binary mergers are `` @xmath139 '' events .",
    "when a smaller time - step is used in lc93 , the ratio of @xmath139 to @xmath138 events decreases .",
    "we find that random progenitor masses can be easily generated using the parameter transformation : @xmath140}\\right\\ } \\,.\\ ] ] the parameter @xmath141 has a uniform probability distribution between 0 and 1 and can be quickly generated using any random - number generator .",
    "a simple inversion then yields progenitors distributed according to the mass - weighted conditional mass function .",
    "the red solid histograms and curves in fig .",
    "[ pdf_4eps_e2 ]  [ pdf_4eps_e4 ] compare the progenitor mass functions generated using the lc93 algorithm with the predictions of the spherical eps model ( solid black curves ) .",
    "for all three descendant halo masses shown ( @xmath142 and @xmath143 ) , we see close agreement for small look - back times such as @xmath144 , but lc93 produces an excess of progenitors at larger look - back times , and the discrepancy worsens , reaching an order of magnitude by @xmath145 .",
    "we believe this discrepancy is due to the binary nature of lc93 : the number of progenitors with mass @xmath26 is equal to the number of binary companions of mass @xmath146 .",
    "thus the lc93 monte carlo algorithm generates a progenitor mass function after one time step that is symmetric in the left and right sides , which will not match the asymmetric nature of the eps @xmath74 discussed in sec .",
    "[ asymmetry ] and shown in fig .",
    "[ spherical_shade ] .",
    "this discrepancy is amplified after many time - steps when the look - back time becomes large .",
    "finally , we note that the authors of lc93 also consider another way of drawing the first progenitor mass from the mass - weighted conditional mass function , which is to draw it from the mass range of @xmath147 $ ] instead of @xmath148 $ ] . in practice , we find that this slightly modified version of lc93 generates very similar results , and our above discussion is valid .      for each time - step in the kw93 algorithm ,",
    "a large number of progenitors are generated across many progenitor mass bins for a fixed number of descendant halos of the same mass .",
    "the number of progenitors in each mass bin is determined by the progenitor mass function of the descendant halo mass , and rounded to the nearest integer value .",
    "these progenitors are then assigned to the descendant halos in order of decreasing progenitor mass .",
    "the target descendant halo is chosen with a probability proportional to its available mass ( i.e. the mass not yet occupied by progenitors ) , and with the restriction that the total mass of the progenitors in a descendant halo can not exceed the descendant mass .",
    "this procedure allows one to work out all the merger configurations and their frequencies for one time step and for different descendant halo masses .",
    "this information is then stored and used repeatedly for determining the progenitors of a halo at each time step .    to speed up the implementation of kw93",
    ", we divide the look - back time into steps with equal spacing in the barrier height @xmath149 as discussed earlier .",
    "the progenitor mass function for a fixed descendant halo mass is then identical for every time step and only has to be calculated once .",
    "we store the ensemble of progenitors and their merger configurations for each descendant halo mass bin . in a monte carlo simulation , we randomly select one merger configuration from the many stored ones for a descendant halo at each time step .    in practice , we find that extreme care must be taken to avoid numerical problems in kw93 .",
    "first of all , this algorithm requires a large number of progenitor mass bins in the neighborhood of @xmath49 because @xmath74 is sharply peaked near @xmath150 for small time - steps .",
    "interestingly , we find that if the mass range of @xmath151 $ ] is simply divided into evenly - spaced logarithmic bins , this method is not accurate even when the number of mass bins is as large as 2000 , which already requires more than @xmath152 descendant halos to guarantee that the integer rounding does not introduce a significant error to the progenitor number in each bin . as a result ,",
    "a large amount of computer memory is necessary to repeat this procedure for descendant halos of different masses .",
    "the improved mass bin configuration that we end up using will be introduced in  [ newmethods ] . using that setup , we find that only 200 bins are required to reproduce accurately the eps progenitor mass function over large look - back times .",
    "the second problem is that kw93 s scheme for assigning progenitors to descendant halos is somewhat ambiguous and does not guarantee that all the progenitors can be assigned .",
    "fortunately , we find that this problem usually does not arise when the ensemble of progenitors is large . for each descendant halo mass",
    ", we use @xmath153 descendant halos to determine the merger configurations of the progenitors .    the orange dash - dotted curves in fig .",
    "[ pdf_4eps_e2 ] - [ pdf_4eps_e4 ] compare the progenitor mass functions generated using the kw93 algorithm with the predictions of the spherical eps model ( black ) .",
    "the results show very good agreement .",
    "since kw93 reproduces the exact eps progenitor mass function at every time - step , it is expected to be consistent with eps at any @xmath62 according to the discussion in  [ theorem ] .",
    "somerville & kolatt ( 1999 ) [ sk99 ] point out that the assumptions of binary mergers and @xmath154 made in lc93 lead to an overestimate of the progenitor abundance at high redshift .",
    "they first attempt to remedy this problem by preserving the binary assumption while allowing the mass below the resolution limit @xmath86 to be counted as diffusely accreted mass @xmath114 ( see  [ massres ] ) .",
    "they show , however , that this `` binary tree with accretion '' method fails in the opposite direction , _ under - producing _ the progenitor mass function relative to the spherical eps prediction .",
    "this discrepancy arises partly because whenever two progenitors are chosen in this method , the remaining mass is assigned to @xmath114 regardless of whether it is above or below @xmath86 .",
    "thus the eps @xmath74 is not faithfully reproduced : the binary tree with accretion method yields an excess of accreted mass and a corresponding shortage of low - mass halos .",
    "sk99 then consider a natural extension of this method , in which both assumptions made in lc93 are relaxed . in this `` n - branch tree with accretion ''",
    "algorithm , each descendant halo is allowed to have more than two progenitors for every simulation time - step . to guarantee that the total mass of the progenitors does not exceed that of the descendant",
    ", each subsequent progenitor mass is randomly chosen from the mass - weighted conditional mass function truncated to the maximally possible progenitor mass .",
    "this procedure is repeated until the descendant halo can not contain any more progenitors with masses above @xmath86 , and the remaining mass deficit is assigned to diffuse accretion @xmath114 .    the parameter transformation of eq .",
    "( [ define_x ] ) is also applicable for sk99 .",
    "the probability distribution of @xmath141 is still uniform , but the upper limit of @xmath141 can now take on any value between 0 and 1 depending on where the conditional mass function is truncated .    the blue dashed curves in fig .",
    "[ pdf_4eps_e2 ] - [ pdf_4eps_e4 ] compare the progenitor mass functions generated using the n - branch tree algorithm of sk99 with the predictions of the spherical eps model ( black ) .",
    "it is interesting to note that the sign of the discrepancy is now opposite to that of lc93 : sk99 produces an excess of low - mass ( @xmath155 ) progenitors by up to a factor of @xmath156 for small look - back times , but it does a better job than lc93 at high redshifts .",
    "however , it is noteworthy that even at high redshifts , discrepancies of up to a factor of @xmath156 are still present for small progenitor masses .",
    "we believe that the use of a truncated progenitor mass function in sk99 is at least a partial cause for the over - prediction of small progenitors .",
    "since the distribution of progenitors ( in particular , the upper limit for the progenitor mass ) depends on the sum of the masses of the progenitors already picked out for the current halo , the _ order _ in which progenitor halos are randomly pulled out matters in this method .",
    "halos more massive than the truncation limit are effectively discarded instead of being randomly selected and placed in , for example , new descendant halos .",
    "this procedure tends to preferentially skew the progenitor mass function at small time steps towards more low mass progenitors and fewer high mass progenitors .",
    "similar to sk99 , @xcite [ c00 ] treats the mass in progenitors smaller than the mass resolution @xmath86 in the monte carlo simulation as accreted mass , but unlike the n - branch tree model in sk99 , only a maximum of two progenitors are allowed per descendant .",
    "the amount of accreted mass gained in one time - step , @xmath157 , is fixed to a single value and is calculated by integrating the mass - weighted conditional mass function from 0 to @xmath86 : @xmath158 where @xmath49 is the descendant mass .",
    "the progenitors are drawn from the _ lower _ half of the progenitor mass function between @xmath86 and @xmath91 according to the average number of progenitors in that range : @xmath159 the simulation time - step is chosen to be small enough so that @xmath160 ( note that it is for this reason that we use @xmath161 when implementing c00 ) .",
    "the c00 merger tree is generated with the following steps : a random number @xmath141 between 0 and 1 determines whether a descendant halo has one progenitor ( if @xmath162 ) or two progenitors ( if @xmath163 ) . in the case of a single progenitor ,",
    "its mass is @xmath164 . in the case of two progenitors",
    ", the mass of the smaller progenitor , @xmath135 , is chosen randomly between @xmath86 and @xmath91 according to the progenitor mass function . the larger progenitor",
    "is then assigned a mass of @xmath165 . since @xmath166",
    ", most descendants form via @xmath138 events rather than @xmath139 events . to improve the speed of this algorithm , we precompute and store the binary merger rates and diffuse accretion mass fractions for a single time step for different descendant mass bins .",
    "the green dotted curves in fig .  [ pdf_4eps_e2 ] - [ pdf_4eps_e4 ]",
    "compare the progenitor mass functions generated using the c00 algorithm with the predictions of the spherical eps model ( black ) .",
    "the agreement is noticeably better than lc93 and sk99 .",
    "the largest discrepancy occurs at the high mass end at large @xmath62 , where c00 _ under - predicts _ the progenitor number at @xmath4 by more than a factor of two for group - to - cluster size descendants at @xmath3 with @xmath167 .",
    "at least two problems contribute to this discrepancy : ( i ) since @xmath114 is fixed to one value ( eq .",
    "[ c00 dm ] ) , the mass of the progenitor for @xmath138 descendants is also a fixed value : @xmath164 .",
    "this is an over - simplification that compresses the high mass end of @xmath74 into a delta function .",
    "( ii ) for descendants with binary progenitors , c00 uses the spherical eps conditional mass function only in the lower mass range @xmath168 $ ] to generate the progenitor abundance . by construction , then , the shape of the progenitor mass function in the upper mass range , @xmath147 $ ] , is symmetric with the lower half and fails to match accurately the asymmetric eps @xmath74 .",
    "in this section , we present three monte carlo algorithms that all satisfy the criterion for consistency discussed in  [ theorem ] and will therefore accurately reproduce the eps progenitor mass function @xmath74 .",
    "we introduce the common setup for our methods in  [ commonsetup ] and discuss in detail how each method assigns the ensemble of progenitors to descendants in  [ methoda ]  [ methodc ] .    to help the reader follow our discussions",
    ", we provide a summary of the breakdown of the merger configurations for the three new algorithms in table  [ newmethodstablesummary ] and the accompanying fig .",
    "[ fig : methodsexplanation ] .",
    "although the standard practice in the community has been to generate merger trees using the spherical eps model , we emphasize that the monte carlo algorithms can be applied to the ellipsoidal eps model as well .",
    "in fact , since the ellipsoidal model matches the unconditional mass function in simulations better than the spherical model , we would expect the ellipsoidal eps to also match better the progenitor statistics in simulations .",
    "we will therefore present our results for both the spherical and ellipsoidal eps models in parallel below .        our monte carlo algorithms for growing consistent merger trees all share the following implementation framework .",
    "we begin at redshift 0 and build the merger tree backwards in cosmic time .",
    "we typically choose a large descendant halo mass range ( @xmath169 $ ] ) and a small simulation time - step ( @xmath170 at low @xmath130 ; see discussion below ) to achieve a high resolution tree and a large dynamic range in the progenitor mass . for a given descendant halo ,",
    "we first compute which mass bin it belongs to , and then obtain its progenitors across a single time - step using the distribution of merger configurations specific to each algorithm ( described in the next three subsections ) .",
    "the progenitors then become descendants in the next time - step , and this process is repeated to build up the higher tree branches .    to be specific , a merger configuration here is defined as a set of progenitor masses that form a descendant halo of a given mass in one time - step .",
    "for example , for a descendant halo of mass @xmath49 , one merger configurations may include only two progenitors of mass @xmath171 and @xmath172 , while another may contain three progenitors of mass @xmath172 , @xmath173 , and @xmath174 .",
    "note that the sum of the progenitor mass in each configuration need not equal the descendant mass , and the deficit , @xmath114 , is implicitly attributed to sub - resolution progenitors ( see  [ massres ] ) .",
    "different monte carlo algorithms have different distributions of merger configurations and progenitor multiplicities for each descendant bin . for convenience",
    ", we call the most massive progenitor in a merger configuration the _ primary _ progenitor , and the rest of the progenitors the _ secondary _ progenitors .",
    "our basic implementation is applicable to both the spherical and ellipsoidal eps models .",
    "we find a particularly efficient choice of time - step to be the one corresponding to a constant difference in the barrier height @xmath175 , as is used in  [ methods ] for the four old algorithms .",
    "for the spherical case , the progenitor mass function eq .",
    "( [ dndm ] ) depends on time only through @xmath176 and",
    "is therefore identical for all redshifts when the same @xmath176 is used .",
    "thus we only have to generate the merger configurations in the spherical case across a single time - step once . for the ellipsoidal case , however , the progenitor mass function eq .",
    "( [ dndm_e ] ) not only is a function of @xmath176 but also depends explicitly on @xmath130 . for each monte carlo algorithm , it is therefore necessary to generate and store the merger configurations and their probabilities for both descendant halos of different masses and several redshift bins . in practice , since the redshift dependence of eq .",
    "( [ dndm_e ] ) is weak , typically fewer than @xmath177 redshift bins are required .",
    "a number of natural mass boundaries play critical roles in the construction of our algorithms .",
    "these mass scales demarcate the regions with different progenitor multiplicities , as illustrated in fig .",
    "[ fig : methodsexplanation ] and discussed in detail in the next three subsections .",
    "\\(i ) the resolution scale @xmath86 and its complement @xmath108 are two obvious boundaries , as is the half descendant mass @xmath91 discussed in the context of binary mergers in sec .",
    "[ asymmetry ] .",
    "we generally choose a small @xmath86 ( typically @xmath178 ) for numerical precision and keep track of all the progenitors down to this limit at each time - step .",
    "\\(ii ) the mass @xmath179 given by @xmath180 defines the range of progenitor mass over which every descendant halo is guaranteed to have one progenitor with @xmath181 $ ] .",
    "table  [ boundarystats ] lists the values of @xmath182 for both the spherical and ellipsoidal progenitor mass functions for three descendant masses ; @xmath182 is seen to range from 0.361 to 0.448 .",
    "\\(iii ) the mass @xmath183 demarcates where the asymmetric progenitor mass function self - intersects : @xmath184 with @xmath185 .",
    "for binary merger configurations of the form @xmath154 , @xmath186 when @xmath187 and @xmath188 when @xmath189 .",
    "this mass scale is illustrated in the pop - up in fig .",
    "[ spherical_shade ] .",
    "table  [ boundarystats ] shows that @xmath190 to 0.977 .",
    "[ alpha_mu ] shows @xmath182 and @xmath191 as functions of the look - back time @xmath192 for three descendant halo masses ( @xmath193 , @xmath92 , @xmath194 ) at redshift zero .",
    "according to the figure , @xmath182 and @xmath191 have well defined constant values when @xmath192 is less than about @xmath195 , a natural upper limit of time step - size for a monte carlo simulation to achieve convergence in both the spherical and ellipsoidal eps models .     and",
    "@xmath191 as functions of the look - back time @xmath192 at redshift zero .",
    "the red solid , blue dotted , and black dashed curves are for descendant halos of @xmath193 , @xmath92 , and @xmath194 respectively .",
    "the label in each plot indicates the quantity ( @xmath182 or @xmath191 ) shown and the eps model ( spherical or ellipsoidal ) used . ]    ) and the mass ranges .",
    "see table  [ newmethodstablesummary ] for a description of each shaded region and the fraction of descendants that belongs to each region .",
    "the numbers quoted in this plot are from the ellipsoidal eps model .",
    "the axes are in arbitrary units , though the horizontal axis is drawn to be symmetric about @xmath91 and the vertical axis is assumed to be logarithmic .",
    "important characteristic progenitor masses are labeled on the horizontal axis ( see  5.1.2 for discussion ) . the dashed line in panel",
    "@xmath196 plots @xmath98 , the reflection of the left side of @xmath74 . ]      to help the reader reproduce our monte carlo algorithms , we discuss our distribution of mass bins .",
    "we divide the descendant mass range @xmath197 into @xmath198 logarithmic descendant bins .",
    "halos that fall into the same descendant bin are assumed to have the same distribution of single - time - step merger configurations that are computed using the central ( in logarithmic scale ) value of the bin as the descendant mass .",
    "the progenitor masses in a merger configuration are recorded in the form of ratios to the descendant halo mass , instead of their absolute masses .",
    "this allows us to correct for the ( small ) difference between the descendant halo in question and the central mass of its bin .    for a given descendant mass @xmath49",
    ", its progenitor mass range @xmath151 $ ] is divided into a certain number of mass bins to facilitate the process of forming merger configurations .",
    "interestingly , we note that simply dividing the whole progenitor mass range into evenly spaced logarithmic bins is not accurate , as discussed in  [ kw93sec ] .",
    "this is because the simplest logarithmic binning assigns very few bins to the mass range of @xmath199 $ ] , which requires many mass bins to sample accurately the shape of the sharply peaked ( at around @xmath49 ) progenitor mass function for a small time - step . to give the peaked region more fine structures",
    ", we find a simple way : the mass range of @xmath200 $ ] is divided into evenly spaced logarithmic bins , and its reflection about the mid point @xmath91 determines the binning on the right side of the mid point .",
    "mathematically , it can be stated as follows : the progenitor mass range @xmath201 $ ] is divided into @xmath202 logarithmic mass bins . the @xmath14 ( @xmath203 ) bin spans @xmath204 $ ] , where @xmath205 is defined as follows : @xmath206 & \\mbox{if $ i \\geq n+1$};\\\\      m_0-m^{2n+2-i } & \\mbox{if $ 1\\leq i\\leq n$}.   \\end{array } \\right.\\ ] ] and @xmath207 .",
    "the average number of progenitors ( per descendant halo ) in the @xmath14 bin is called @xmath208 , which is equal to @xmath209 .",
    "note that @xmath208 is not an integer . for @xmath210 , we choose the mean mass @xmath211 of the @xmath14 bin to be @xmath212 .",
    "the progenitor mass function often changes rapidly across the @xmath213 bin so we do not assign it a mean mass .",
    "instead , whenever a progenitor of the @xmath213 bin is needed , we generate a probabilistic progenitor mass according to the progenitor mass function inside this bin .",
    "r|ccc|ccc & & + @xmath49 ( @xmath214 ) & @xmath215 & @xmath216 & @xmath217 & @xmath215 & @xmath216 & @xmath217 + @xmath182 & 0.421 & 0.448 & 0.435 & 0.361 & 0.384 & 0.372 + @xmath191 & 0.977 & 0.977 & 0.970 & 0.974 & 0.970 & 0.956 +    c|c|c|c|p3.8in|r    method & @xmath2 & @xmath218 desc . & @xmath218 desc . & description & key + & & ( spher . ) & ( ellip . ) & & + a & @xmath219 & 0.3% & 0.4% & descendants with no progenitors because @xmath220 & n / a + & @xmath138 & 60% & 69% & @xmath221 $ ] : binary - turned - singles due to @xmath222 &   + & @xmath138 & 0.8% & 0.4% & @xmath223 $ ] : @xmath224 results in unpaired primary progenitors : @xmath225 &   + & @xmath139 & 21% & 12% & @xmath223 $ ] and @xmath154 : binary pairs generated from @xmath98 &   + & @xmath226 & 18% & 18% & @xmath227 $ ] : @xmath228 results in excess secondary progenitors . @xmath229 &   +    b & @xmath138 & 60% & 69% & @xmath221 $ ] : binary - turned - singles due to @xmath222 &   + & @xmath139 & 20% & 14% & binary paired progenitors generated by the iterative algorithm of  [ methodb ] : @xmath230 &   + & @xmath231 & 20% & 17% & @xmath227 $ ] : identical to @xmath226 configuration in method a &   +    c & @xmath138 & 60% & 69% & @xmath221 $ ] : binary - turned - singles due to @xmath222 &   + & @xmath138 & 35% & 29% & all secondary progenitors have already been assigned to smaller primary progenitors : these remaining primary progenitors have @xmath225 &   + & @xmath232 & 0.1% & 0.01% & merger configurations with 3 progenitors &   + & @xmath233 & 2% & 0.3% & merger configurations with 4 progenitors &   + & @xmath234 & 2.9% & 1.7% & merger configurations with 5 or more progenitors &   +    kw93 & @xmath138 & 60% & 69% & @xmath221 $ ] : binary - turned - singles due to @xmath222 & n / a + & @xmath138 & 15% & 9% & merger configurations with a single progenitor with @xmath235 & n / a + & @xmath139 & 11% & 9% & merger configurations with 2 progenitors &",
    "n / a + & @xmath231 & 14% & 13% & merger configurations with 3 or more progenitors & n / a +              we first attempt to resolve the asymmetry problem in the eps progenitor mass function @xmath74 by assuming that the primary progenitors in the symmetric part @xmath98 in eq .",
    "( [ asym ] ) are paired up with secondary progenitors to form binary mergers such that @xmath154 .",
    "this is done so long as the smaller progenitor is above the mass resolution of the monte carlo simulation , i.e. @xmath236 and @xmath237 . if @xmath238 , then the second progenitor is discarded and @xmath50 is assumed to be a single progenitor ( the darkest grey region marked @xmath239 in fig .",
    "[ fig : methodsexplanation ] @xmath196 ) .",
    "the remaining primary progenitors in the asymmetric part @xmath240 are assumed not to pair up , i.e. each descendant halo has a single progenitor ( the lightest grey region marked @xmath239 in fig .  [",
    "fig : methodsexplanation ] @xmath196 ) .    in practice",
    ", we generate the merger configurations of a descendant halo of mass @xmath49 at each time step by repeating these two simple steps :    \\(i ) draw the primary progenitor mass @xmath50 from the mass range @xmath199 $ ] of the progenitor mass function .",
    "\\(ii ) if @xmath241 , no more progenitors are generated ; if @xmath242 , the probability of having a second progenitor of mass @xmath243 is set to @xmath244 then , drawing a random number @xmath141 between 0 and 1 allows us to determine whether a secondary progenitor should be generated .",
    "if @xmath245 , @xmath135 is assigned as a secondary progenitor ; otherwise @xmath50 is left as the sole progenitor .",
    "we point out two subtleties with this algorithm .",
    "first , @xmath246 is not always @xmath247 .",
    "it is true that @xmath246 is below 1 for _ most _ of the relevant mass range @xmath223 $ ] ( see fig .  [",
    "fig : methodsexplanation ] @xmath196 and table  [ boundarystats ] ) since the left side of @xmath74 is slightly lower than the right side .",
    "but when @xmath248 , we find that @xmath249 , implying that on average more than one secondary progenitors should be generated to couple with the primary progenitor @xmath50 , and we must generate merger configurations with multiple progenitors . to accommodate this feature , for each @xmath50 that satisfies",
    "@xmath250 $ ] , we generate is defined to be the largest integer @xmath251 that satisfies @xmath252 . ]",
    "either @xmath253 or @xmath254 secondary progenitors of mass @xmath90 according to whether a random number between 0 and 1 is larger or smaller than @xmath255 .",
    "note that the resulting merger configurations do not conserve mass exactly because the sum of the progenitor masses is slightly larger than the descendant mass .",
    "typically most of these configurations only end up with 3 or 4 progenitors as @xmath256 for @xmath257 and @xmath258 .    the second subtlety with method",
    "a is that since the total number of progenitors in the mass range of @xmath147 $ ] ( which is equal to @xmath259 ) is always slightly smaller than one ( typically by 0.2% to 0.4% for @xmath260 ; recall from table  [ boundarystats ] that @xmath261 ) , it is possible that we sometimes can not assign any progenitors to a given descendant halo . when this happens , the descendant halo does not have any progenitor halos and is a `` @xmath219 event '' .    for a thorough description of our algorithm",
    "a , we list below all the possible merger configurations and their frequencies of occurrence for descendant halos at @xmath0 over a single simulation time - step @xmath262 and mass resolution @xmath263 .",
    "this information is also summarized in table  [ newmethodstablesummary ] and fig .",
    "[ fig : methodsexplanation ] . in general , the relative frequencies of different merger configurations are insensitive to the descendant mass @xmath49 but do depend on the @xmath192 and @xmath86 used in the monte carlo simulation .",
    "for example , the fraction of @xmath138 events increases as @xmath192 decreases ; and if @xmath86 is chosen to be larger than @xmath264 , then there are no @xmath232 or @xmath233 mergers at each time - step and mass conservation is exactly respected .",
    "i. about 12% in the ellipsoidal model ( 21% for spherical ) of descendant halos have two progenitors each .",
    "these are binary pairs drawn from the symmetric part of the progenitor mass function @xmath98 , where @xmath265 $ ] and @xmath266 ( fig .",
    "[ fig : methodsexplanation ] ) .    \\ii .",
    "about 69% ( 60% ) of descendant halos have only one progenitor each .",
    "the majority ( @xmath267 ) of these descendants originally have binary progenitors but the smaller progenitor is discarded since @xmath268 ( i.e. @xmath269 ) ( fig .",
    "[ fig : methodsexplanation ] ) .",
    "the rest ( @xmath270 ) of these descendant have progenitors with @xmath223 $ ] and originate from the small asymmetric part @xmath240 of the progenitor mass function where @xmath271 ( fig .",
    "[ fig : methodsexplanation ] ) .    \\iii .",
    "about 18% of descendant halos have three or four progenitors each , typically consisting of one massive progenitor and two or three very small secondary progenitors ( @xmath272 ) .",
    "these have @xmath273 $ ] ( fig .",
    "[ fig : methodsexplanation ] ) .    \\iv .",
    "about 0.4% ( 0.3% ) of the descendants have no progenitors due to the sharp cutoff of the primary progenitor mass at @xmath91 discussed above .    the red solid curves in fig .  [ pdf_abc_e3 ]",
    "compare the progenitor mass functions from this monte carlo algorithm with the analytic eq .",
    "( [ dndm ] ) of the spherical eps model .",
    "[ pdf_abc_e3_e ] shows the same thing except everything is for the ellipsoidal eps model , where we use eq .",
    "( [ dndm_e ] ) to compute the progenitor mass function for each small simulation time - step .",
    "both figures show excellent agreement ( @xmath274 deviation ) at @xmath144 , 2.07 , 7 , and 15 for a descendant halo of mass @xmath92 at @xmath75 .",
    "we have tested other descendant masses ( @xmath275 ) and found equally good agreement .",
    "this agreement also provides numerical verification of the criterion introduced in  [ theorem ] .",
    "two features in method a may seem unnatural .",
    "first , as shown in table  [ newmethodstablesummary ] and discussed in the previous section , a small fraction ( @xmath276 to 0.4% ) of the descendant halos in method a are not assigned any progenitors in one time - step because @xmath277 ( for @xmath278 and a large range of @xmath49 ) and is not exactly unity .",
    "it is important to note that though these descendants are rare , one can not remove them from method a by modifying the normalization of @xmath74 in the mass range of @xmath279 $ ] , as such a modification is amplified with iterations and leads to a large error in @xmath74 after many time - steps .",
    "second , due to the asymmetry in the eps @xmath74 , we have assigned a small fraction ( 0.4% to 0.8% for parameters used in table  [ newmethodstablesummary ] ) of the descendant halos to @xmath239 events .",
    "there is therefore a small chance that a progenitor of mass comparable to half of the descendant mass does not have any companions , corresponding to a large deficit between the mass of the descendant halo and the total mass of its progenitors .",
    "the first feature can be avoided by decreasing the lower limit of the mass range from which the primary progenitor is drawn from @xmath91 to @xmath280 , where @xmath182 is defined in eq .",
    "( [ alpha ] ) and ranges from @xmath281 to @xmath282 in table  [ boundarystats ] .",
    "the second feature can be altered by distributing the secondary progenitors in a slightly different way .",
    "these options motivate us to invent method b with the following set up :    * 1 .",
    "* we assume the primary progenitor mass lies in the mass range @xmath283 $ ] .",
    "this condition guarantees that every descendant halo has a primary progenitor of mass @xmath284 due to the definition of @xmath182 .",
    "* we then assign secondary progenitors to primary progenitors from the left side of @xmath179 . for simplicity ,",
    "whenever possible , we make only binary configurations , each of which contains one primary and one secondary progenitor .",
    "we start with the primary and secondary progenitor bins that share the @xmath179 boundary ( i.e. nearly equal - mass pairs ) and work our way outwards to the @xmath285 pairs .",
    "this is a natural decision as this way of pairing the primary and secondary masses minimizes the difference between @xmath49 and @xmath286 .",
    "specifically , for a given @xmath50 bin , we determine its binary companion s mass @xmath135 from @xmath287 which guarantees that we always have an equal number of secondary progenitors to pair up with the primary halos .",
    "note that since @xmath288 it is generally true that @xmath289 .",
    "one caveat with step 2 above is that this simple binary pairing scheme works for a large range of masses but needs to be modified near the end points when @xmath50 is close to @xmath49 and @xmath290 .",
    "this is because the scheme starts out with nearly equal - mass pairs at @xmath291 and @xmath292 , and the asymmetric shape of the progenitor mass function is such that the method produces pairs with increasing @xmath286 as we move outward from @xmath179 .",
    "the equality @xmath293 is reached when @xmath50 is slightly larger than @xmath183 ( typically at @xmath294 ) , beyond which there are more secondary progenitors left to be paired than the primary ones .",
    "we therefore stop the binary pairing when @xmath295 is reached .",
    "from this point on , we instead use the same multiple merger configurations as in method a. for simplicity in the following few paragraphs , we denote this transitional @xmath50 as @xmath296 .    in summary , methods",
    "a and b are closely related and are compared side - by - side in table  [ newmethodstablesummary ] and fig .",
    "[ fig : methodsexplanation ] .",
    "they have identical merger configurations in the following regions :    i. the high-@xmath50 region @xmath221 $ ] , where 60% to 70% of descendant halos belong .",
    "the secondary progenitor is below @xmath86 , so @xmath50 is effectively the sole progenitor ( i.e. @xmath297 ) for these descendants    \\ii .",
    "the region @xmath298 $ ] ( @xmath299 replaced by @xmath191 in method a ) , where 17% to 20% of descendant halos belong .",
    "these descendants all each have 3 or more progenitors ( @xmath300 ) .",
    "methods a and b differ in the following regions :    \\iii .",
    "the binary pairing algorithm used in method b removes the sliver of @xmath138 configurations in the @xmath223 $ ] region in method a ( ) and redistributes the binary merger configurations in this region ( ) to yield a robust set of binary configurations between @xmath301 ( ) .",
    "this affects @xmath302% of the descendant halos .    \\iv .",
    "since the primary progenitor mass range extends down to @xmath179 instead of @xmath91 , method b does not have any of the @xmath219 configurations that are present in method a.    the green dashed curves in figs .",
    "[ pdf_abc_e3 ] and [ pdf_abc_e3_e ] compare the progenitor mass functions from method b with the analytic predictions of the spherical and ellipsoidal eps models , respectively .",
    "the agreement is again excellent ( @xmath274 deviation ) at @xmath144 , 2.07 , 7 , and 15 for a descendant halo of mass @xmath92 at @xmath75 .    finally , we note that mass is not strictly conserved for the multiple merger configurations generated in the @xmath227 $ ] region of method a and the @xmath298 $ ] region of method b ( fig .",
    "[ fig : methodsexplanation ] , ) .",
    "these configurations have more than one companion of mass @xmath90 , making the total mass of the progenitors slightly above the descendant halo mass .",
    "this issue is due to the rapid rise of the progenitor number as the secondary progenitor mass approaches zero . in principle",
    ", the small progenitors ( @xmath303 ) that are causing this problem can be re - distributed and combined , , with progenitors in some of the @xmath239 and @xmath304 merger configurations in method a , or with some binary configurations of total masses smaller than the descendant mass in method b , to form multiple merger configurations that obey mass conservation ( this , in fact , is what happens in method c below , where mass conservation is strictly respected ) .",
    "we have checked that this can be done successfully without violating mass conservation down to very small @xmath86 and find that in practice , these modifications do not introduce significant changes to the statistical properties of the halo merger histories .",
    "we have therefore chosen to present the simpler version of each model .",
    "it is also worth noting that in the eps theory , mass conservation only has to be obeyed statistically and is _ not _ required for individual merger configurations .",
    "as shown in table  [ newmethodstablesummary ] , methods a and b both produce comparable number of descendants with binary ( @xmath305 ) and multiple ( @xmath300 ) progenitors in a single time - step .",
    "the importance of multiple merger configurations have been emphasized by a number of authors ( e.g. , @xcite ) .",
    "it is therefore interesting to explore the relative importance of binary vs multiple mergers by relaxing the binary assumption .",
    "our method c is designed for this purpose .",
    "more specifically , this method does not have any restrictions on the number of progenitors in each merger configuration .",
    "we only require that the total progenitor mass of every merger configuration be smaller than ( or equal to ) the descendant halo mass .",
    "we now describe method c :    * 1 .",
    "* to prevent the formation of @xmath219 merger configurations we mimic the setup of method b and choose to draw primary progenitors from the mass range @xmath306 $ ] .",
    "thus methods b and c share the same distribution of primary and secondary progenitor mass bins .",
    "* 2 . * as with method b , we form merger configurations by assigning secondary progenitors to progenitors in primary bins .",
    "every primary bin starts with one merger configuration : that which contains only the primary progenitor itself , and has a probability @xmath307 equal to the number of primary progenitors in the bin",
    ". the assignment of secondary progenitors to primary bins is done in order of decreasing secondary progenitor mass . for each secondary bin , we scan the primary bins in order of increasing primary progenitor mass to find configurations with room to hold _ at least _ one secondary progenitor from the bin in question ( recall that we require the sum of progenitor masses to never exceed the descendant mass ) .",
    "* 3 . * when a valid configuration is found",
    ", we always assign the _ maximal _",
    "number of secondary progenitors to that configuration .",
    "for example , suppose we start to assign secondary progenitors from a bin with central mass @xmath135 ( say there are @xmath308 such progenitors in this bin ) , and find a valid configuration of probability @xmath307 and total progenitor mass @xmath309 .",
    "the maximum number @xmath310 of secondary progenitors that can be added into each realization of this configuration is equal to @xmath311 $ ] .",
    "therefore , we can maximally assign @xmath312 secondary progenitors to this configuration .",
    "i. if @xmath313 , we break the configuration into two : one contains the original set of progenitors , with a probability equal to @xmath314 ; the other contains the original set of progenitors plus @xmath310 secondary progenitors of mass @xmath135 , with a probability equal to @xmath315 . in this case",
    "all the secondary progenitors of the current secondary bin are assigned .",
    "\\ii . if @xmath316 we simply add the @xmath310 secondary progenitors of mass @xmath135 to the configuration , and update the list of progenitors in the configuration .",
    "@xmath307 , the configuration s probability does not change .",
    "the number of remaining secondary progenitors to be matched is now @xmath317 , and we continue our search across merger configurations ( in order of increasing primary progenitor mass ) until all of them have been assigned .",
    "once a secondary bin is fully assigned , we move on to the next secondary bin ( of a slightly smaller mass ) and repeat the same assignment procedure . as this process goes on all configurations",
    "are gradually filled with secondary progenitors of smaller and smaller mass . for technical convenience ,",
    "the number of configurations in each primary bin and the number of unique progenitor masses in each configuration are both limited to be fewer than 6 . in practice , we find that this setup allows us to successfully assign all secondary progenitors in the mass range @xmath318 $ ] , even when the mass resolution of each time step is as low as @xmath178 .",
    "in fact this dense packing of secondary progenitors into primary bin configurations manages to distribute efficiently _ all _ secondary progenitors in @xmath319 $ ] in only a fraction of the available primary progenitors . as seen in fig .",
    "[ fig : methodsexplanation ] @xmath320 , only @xmath321 ( @xmath322 for spherical ) of the primary progenitors ( at the low mass end ) are grouped with secondary progenitors and the remaining @xmath323 ( @xmath324 ) are @xmath138 events .",
    "we note that even though there are far more secondary progenitors than primary progenitors , this is possible because many secondary progenitors have exceedingly small masses and can be efficiently distributed into the mass reservoirs of relatively few primary progenitors .",
    "the execution of method c is as follows :    \\(i ) generate a primary progenitor @xmath50 from the mass range @xmath325 $ ] of the eps progenitor mass function .",
    "determine which primary bin contains @xmath50 .",
    "\\(ii ) if @xmath241 , no more progenitors are generated ; if @xmath242 , a random number determines which merger configuration to choose according to the probability distribution of all possible configurations associated with the given primary bin .",
    "the progenitors of the chosen configuration are then generated .",
    "for a better understanding of method c , we show in table  [ newmethodstablesummary ] and discuss below all the possible merger configurations and their frequencies of occurrence for descendant halos ( regardless of their masses ) at @xmath0 , assuming time - step @xmath326 and mass resolution @xmath263 :    i. about @xmath323 ( @xmath324 for spherical ) of the descendant halos have only one progenitor each .",
    "\\a ) about @xmath327 of these descendants progenitors are within the resolution limit of the descendant mass ( i.e. @xmath269 , see figure [ fig : methodsexplanation ] ) .",
    "\\b ) the remaining @xmath328 of these descendant halos progenitors have masses below @xmath108 . as discussed above ,",
    "these massive primary progenitors are not assigned any secondary companions because all the available secondary progenitors are maximally assigned to the less massive primary bins .",
    "note that this region extends to masses below @xmath183 ( ) .",
    "\\ii . for the remaining primary progenitor bins ,",
    "there are no configurations having only two progenitors .",
    "all in all , @xmath329 ( @xmath330 for spherical ) of all descendants have three progenitors ( ) ; @xmath331 ( @xmath321 ) have four progenitors ( ) ; @xmath332 ( @xmath333 ) have five or more progenitors ( ) . the progenitor count for a given configuration can be rather large reaching values of more than 100 .    as in methods a and b , the values quoted above depend on @xmath192 and @xmath86 .",
    "they also depend on the maximal number of configurations allowed in each primary bin and the maximal number of unique progenitor masses allowed in each configuration .    the blue dotted curves in figs .",
    "[ pdf_abc_e3 ] and [ pdf_abc_e3_e ] compare the progenitor mass functions from this monte carlo algorithm with the analytic predictions of the spherical and ellipsoidal eps models , respectively .",
    "they again show excellent agreement ( @xmath274 deviation ) at @xmath144 , 2.07 , 7 , and 15 for a descendant halo of mass @xmath92 at @xmath75 .",
    "we have designed monte carlo algorithms a , b , and c for constructing merger trees that can accurately reproduce the eps prediction for the progenitor mass function @xmath74 across each individual time - step . according to the discussion in ",
    "[ theorem ] , these methods should then accurately generate the progenitor mass function at _ any _ look - back time in any number of time - steps . figs .",
    "[ pdf_abc_e3 ] and [ pdf_abc_e3_e ] show that this is indeed the case for both the spherical and ellipsoidal eps models . including kw93",
    ", there are now four methods that are completely consistent with the eps @xmath74 . the results of the ellipsoidal version of kw93 have been shown in fig .",
    "[ pdf_abc_e3_e ] as well .",
    "despite this agreement , we recall that the progenitor mass function is only one of many statistical properties of a halo merger tree .",
    "even though all four algorithms are degenerate in @xmath74 , they are likely to ( and should ) differ in their predictions for other statistical quantities . here",
    "we investigate two such quantities as an illustration : ( i ) @xmath334 , the progenitor mass function for the subset of descendant halos that have @xmath2 progenitors .",
    "the sum of @xmath334 over all @xmath2 is equal to @xmath74 .",
    "( ii ) @xmath335 , the distribution of the @xmath336 most massive progenitor of each descendant halo .",
    "again , the sum of @xmath335 over all @xmath337 is equal to @xmath74 .",
    "these two statistics are two obvious ways of decomposing the total @xmath74 into individual moments : @xmath338 separates flourishing trees from quiescent trees , while @xmath339 compares the individual distributions of the primary , secondary and more minor progenitors , which are relevant for modeling galaxy formation through mergers ( see also @xcite ) .",
    "other statistics such as the distributions of halo formation time and last major merger time ( e.g. , @xcite ) and the factorial moments of the partition function ( e.g. , @xcite ) are also useful .",
    "some of these will be examined in our next paper .",
    "to compute these moments , we set the descendant halo at redshift zero to be @xmath92 , and the mass resolution to be @xmath340 .",
    "the results are plotted at two look - back times ( @xmath341 ) in figs .",
    "[ pdfn_abc_e3_s]-[pdfnth_abc_e3_e ] , where figs .",
    "[ pdfn_abc_e3_s ] and [ pdfn_abc_e3_e ] show @xmath334 for the spherical and ellipsoidal eps models , respectively , while figs .",
    "[ pdfnth_abc_e3_s ] and [ pdfnth_abc_e3_e ] show @xmath335 . in each figure ,",
    "results from our three methods ( red solid for a , green dashed for b , blue dotted for c ) and from our implementation of kw93 ( orange dash - dotted ) are shown for comparison .",
    "these figures clearly indicate that methods a , b , c , and kw93 generate distinct predictions for these specific moments of the progenitor mass distribution .",
    "some of the notable differences are :    * 1 .",
    "* method c produces a much lower amplitude for the @xmath305 and 3 moments than methods a and b. this is because c is designed to be a multiple - merger algorithm that effectively does not generate _ any _ binary configuration in one individual time - step ( note the absence of the @xmath305 entry for method c in table  [ newmethodstablesummary ] ) .",
    "this feature can been seen by the absence of blue short - dashed curves in the @xmath305 and 3 panels in figs .",
    "[ pdfn_abc_e3_s ] and [ pdfn_abc_e3_e ] , i.e. , there are almost no descendant halos having only two or three progenitors in method c at @xmath342 . by contrast , methods a and b have a wealth of descendants with binary progenitors at these redshifts .",
    "the removal of the binary assumption in method c leads to many features in the moments of the progenitor distributions .",
    "by contrast , the predictions from a and b are mostly power - laws , or at least smooth functions , in the progenitor mass .",
    "this difference is due to the fact that the merger configurations in the binary methods are much more regulated than those in the non - binary method : a binary configuration contains only two progenitors , the total mass of which is always quite close ( if not equal ) to the descendant mass , whereas the distribution of progenitor masses in a multiple configuration can have various forms , which can easily affect , , the ranking of the progenitor masses and the number of progenitors .",
    "it is interesting to note that the predictions of kw93 are fairly smooth functions in spite of the fact that it does not assume binary .",
    "this is likely because the way progenitors are assigned in kw93 effectively suppresses the probability of mergers involving multiple progenitors .    * 3 . * the differences between method a and b are more subtle because they are both mostly binary methods .",
    "the main feature that distinguishes a from b is in the distribution of the most massive progenitor ( i.e. @xmath343 ) shown in the first columns of figs .",
    "[ pdfnth_abc_e3_s ] and [ pdfnth_abc_e3_e ] . at the high mass end ,",
    "method b has a slightly broader shape for the primary progenitor mass than method a. this is expected , because it is the case across every time step by construction ( the primary bins in method b extend down to @xmath280 as opposed to @xmath91 for method a ) . at the low mass end , however , there is a long tail in the distribution of primary progenitor masses in method a , which is not present in other methods .",
    "this tail is caused by the fact that in method a , there is a small chance ( @xmath276 ) at every time - step that a primary progenitor completely disappears , transferring the rank of `` primary '' to one of the much smaller secondary progenitors . over several time - steps",
    "this rare occurrence affects more and more branches of the merger tree and can significantly modify the primary progenitor statistics .    in summary ,",
    "we have constructed three monte carlo algorithms that can all reproduce closely the progenitor mass function of the eps model ( both spherical and ellipsoidal ) .",
    "the methods , however , produce significantly different higher moments of the progenitor distributions .",
    "they are also very different from kw93 .",
    "either a theoretical model more complete than the eps or direct @xmath5-body results will be needed to determine which , if any , of the thus - far successful algorithms is the winner .",
    "we will turn to this subject in the next paper ( zhang , fakhouri & ma , in preparation ) .    , the mass function of progenitors for descendant halos that have a total of @xmath2 progenitors .",
    "two look - back redshifts are shown : @xmath344 ( left ) and 2.07 ( right ) .",
    "for each redshift , four representative values of @xmath2 are shown ( from top down ) .",
    "the simulations are for the spherical eps model and assume a descendant halo mass of @xmath92 at @xmath345 and mass resolution of @xmath346 . ]     except the monte carlo results are generated from the ellipsoidal instead of the standard spherical eps model . ]     except for a different progenitor statistic : @xmath347 , the mass function of the @xmath336 most massive progenitor . ]     except the monte carlo results are generated from the ellipsoidal instead of the spherical eps model . ]",
    "monte carlo algorithms based on the spherical eps model have been an essential tool for many studies of galaxy and structure formation .",
    "these algorithms allow one to generate realizations of actual halo merger histories starting from a limited set of statistical information about dark matter halo properties provided by the eps model .",
    "since the eps model does not uniquely determine many statistical quantities of halo mergers beyond the progenitor mass function , there is considerable freedom in how to combine progenitors to form descendant halos in each time step in a monte carlo algorithm .",
    "the emphasis of this paper is on elucidating and quantifying the ability of a monte carlo algorithm to construct merger trees that match the analytic progenitor mass function of the eps model ( both the spherical and ellipsoidal versions ) .",
    "four main conclusions can be drawn :    * 1 . *",
    "we have shown rigorously that to match the eps progenitor mass function accurately at any look - back time , it is necessary and _ sufficient _ for a monte carlo algorithm to reproduce the exact progenitor mass function at each time step .",
    "* we have reviewed and compared the four most frequently used monte carlo algorithms based on the spherical eps model in the literature : @xcite , @xcite , @xcite , and @xcite . as seen in figs .",
    "[ pdf_4eps_e2]-[pdf_4eps_e4 ] , all but kw93 only approximately reproduce the spherical eps progenitor mass function at each time step , resulting in large deviations from the spherical eps predictions after the accumulation of small errors over many time steps .",
    "their problems ( see table  [ methodstablesummary ] for details ) can be summarized as : ( i ) sk99 generally over - estimates the abundances of small progenitors by about a factor of two ; ( ii ) lc93 over - produces progenitors by a factor of a few when the look - back time is large ( @xmath348 ) ; ( iii ) c00 under - predicts the progenitor abundance at the high mass end when the look - back time is large .",
    "the origin of these discrepancies frequently comes from the incompatibility between the binary merger assumption used in the monte carlo algorithm ( e.g. lc93 , c00 ) and the asymmetric progenitor mass function of the eps model .",
    "we have designed three new monte carlo algorithms that all reproduce closely the eps progenitor mass function over a broad range of redshift ( @xmath62 up to at least 15 ) and halo mass .",
    "our methods a and b assign binary pairs to the symmetric part of @xmath74 and non - binaries to the asymmetric part ; the two differ in the mass ranges for the most massive progenitors .",
    "our method c , on the other hand , completely relaxes the binary merger assumption .",
    "the algorithms are tested for both the spherical and ellipsoidal eps models and the results are shown in figs.[pdf_abc_e3 ] and [ pdf_abc_e3_e ] .",
    "we see that all three methods perform equally well at reproducing the respective progenitor mass function at higher redshifts , regardless of whether the spherical progenitor mass function eq .",
    "( [ dndm ] ) or ellipsoidal progenitor mass function eq .",
    "( [ dndm_e ] ) is used as input .",
    "as emphasized throughout the paper , the eps model only provides a partial statistical description of dark matter halo properties ; it does not tell us explicitly how to group progenitors into descendants in a monte carlo realization .",
    "therefore , there are different ways to combine progenitors into descendant halos in consistent monte carlo algorithms .",
    "we have used our three new algorithms to illustrate this exact point . despite their success in generating merger trees that accurately reproduce the eps progenitor mass function , figs .",
    "[ pdfn_abc_e3_s]-[pdfnth_abc_e3_e ] show that the three algorithms make significantly different predictions for quantities such as the distribution of the most ( or the @xmath349 or @xmath350 most ) massive progenitor masses , and the mass function of progenitors in descendant halos with @xmath2 ( @xmath351 ) progenitors .",
    "a theory more complete than eps would be needed to predict these higher - order merger statistics and break the degeneracies in the progenitor mass function .",
    "alternatively , comparisons with @xmath5-body simulations should determine which , if any , of the three new algorithms is viable .",
    "we view the eps models ( spherical or ellipsoidal ) , monte carlo algorithms , and @xmath5-body simulations as three major components in the general study of the formation , growth , and clustering of dark matter halos . in this paper",
    "we have focused on the first two areas , comparing various monte carlo algorithms for generating halo merger trees and quantifying their abilities to consistently match the analytical eps progenitor mass functions over a broad range of mass and redshift . in our next paper ( zhang , fakhouri , ma 2008b )",
    ", we will turn to comparisons with the millennium simulation .",
    "several recent papers have investigated other monte carlo methods ( see , e.g. , @xcite . although a complete review of these methods is beyond the scope of this paper , it is worth pointing out some of their features .",
    "the method of @xcite is essentially equivalent to lc93 but is based on the ellipsoidal collapse model and is discretized in mass instead of redshift .",
    "the two progenitor masses for each time step are assigned using computer - generated random walks and moving barriers .",
    "since the asymmetry problem of the progenitor mass function is also present in the ellipsoidal model , this method does not accurately reproduce the theory - predicted progenitor mass function at each time step .",
    "such a discrepancy is amplified with increasing redshift and is indeed shown in fig .  5 , 6 , and 7 of @xcite .",
    "@xcite have proposed a method that exactly reproduces the progenitor mass function of the spherical eps model at each time step .",
    "this feature alone guarantees it to be consistent with eps at any look - back time according to our discussion in  3.1 .",
    "however , since the method requires solving several differential equations with nontrivial boundary conditions for the progenitor masses , it is technically harder to implement it .",
    "finally , the methods described in @xcite and @xcite are proposed to mimic n - body results .",
    "they are based on fitting to n - body data rather than the eps theory .",
    "it will be interesting to compare the predictions for the various merger statistics discussed in this paper from these methods with those from our ellipsoidal eps - based methods and from n - body simulations .",
    "this will be done in the next paper .",
    "we thank michael boylan - kolchin , lam hui , ravi sheth , and simon white for discussions , and eyal neistein and jorge moreno for useful comments on an earlier version of this paper .",
    "jz is supported by nasa and by the tac fellowship of uc berkeley . of and cpm",
    "are supported in part by nsf grant ast 0407351 ."
  ],
  "abstract_text": [
    "<S> we investigate seven monte carlo algorithms  four old and three new  for constructing merger histories of dark matter halos using the extended press - schechter ( eps ) formalism based on both the spherical and ellipsoidal collapse models . </S>",
    "<S> we compare , side - by - side , the algorithms abilities at reproducing the analytic eps conditional ( or progenitor ) mass function over a broad range of mass and redshift ( @xmath0 to 15 ) . among the four old algorithms ( lacey & cole 1993 , kauffmann & white 1993 , somerville & kolatt 1999 , cole et al 2000 ) , we find that only kw93 produces a progenitor mass function that is consistent with the eps prediction for _ all _ look - back redshifts . </S>",
    "<S> the origins of the discrepancies in the other three algorithms are discussed . </S>",
    "<S> our three new algorithms are designed to generate the correct progenitor mass function at each time - step . </S>",
    "<S> we show that this is a necessary and sufficient condition for consistency with eps at any look - back time . </S>",
    "<S> we illustrate the differences among the three new algorithms and kw93 by investigating two other conditional statistics : the mass function of the @xmath1 most massive progenitors and the mass function for descendants with @xmath2 progenitors .    </S>",
    "<S> [ firstpage ]    cosmology : theory </S>"
  ]
}