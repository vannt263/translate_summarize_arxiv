{
  "article_text": [
    "hidden markov models ( hmm ) have their merits in modeling systems . for the past several decades , they found their applications in the area of speech recognition .",
    "the underlying principle in hmms is that we suppose a system is in a certain state at any time . as time progress",
    ", the system can transit to other states at probabilities that obey the @xmath0 property , which is transitions to another state at time @xmath1 only depends on the state at time @xmath2 .",
    "its history of states before @xmath2 is irrelevant .",
    "the reason why the markov model is hidden is because we can only make guesses as to what state the system is in by looking at its output or observations .",
    "from there , we use techniques known as @xmath3 or @xmath4 to get a best guess of the parameters of the model . knowning the parameters",
    "can then give us the most probable state to which the model will switch enabling us to make predictions of future observations .",
    "following the theory of hmms , research has been made in the formulation of the situation where two different hmms have correlations in their state progressions .",
    "we call this model a coupled hidden markov model ( chmm ) .",
    "now , the switch of one hmm s state will depend on that hmm s own state and the other hmm s state , of which its own progression will also depend on the itself and the other hmm .",
    "as we shall show the specifics later , a rigorous derivation is required to characterize this coupled relationship .",
    "the main benefit of chmms is that now we can model multiple interacting sequences , a situation which is common in real world phenomena .",
    "what we wish to do is to develop a trading strategy which involves modeling the currency and commodity market using a chmm . here",
    ", the hidden states represent the asset s market .",
    "based on how one models the chmm , the observations can either be prices or technical indicators such as sma , rsi or stochastics of the asset .",
    "hmm have already found their place in the quantitative trading literature .",
    "@xcite applies hmm to foreign exchange rates and @xcite uses hmm to analyze financial time series .",
    "it s argued that currency markets , or to a larger extent any financial market , obeys the markov property @xcite .",
    "a common issue persistant in any trading strategy is the problem of lag where the meaning of an indicator at present time holds little value as it is based on price action much further in the past that is no longer relevant in determing future movements .",
    "the markov property in hmms solves this problem by design since state transitions only depend of the state before and not on previous states .",
    "we hope to progress further by analyzing two markets using a chmm allowing us to capitalize on the chmm s feature of factoring the correlation between the two . in currency trading , there s a notion that some currencies are correlated with some commodities .",
    "supposing we could characterized this correlation with a chmm , we hope that in trading the currencies , the information from the commody market will enable us to make better trading decisions . at the same time , we maintain the markov property as was present in the hmm .",
    "our objective is to first formulate a chmm and use it to model the movement of usdchf and of gold and then devise a trading strategy which , by leverging on their coupling , is rooted in accurately predicting future states of both markets .",
    "as there are many good publications on the formulation of a hmm , we shall not write it here . the formulation we will use is taken from the work done by shi zhong and joydeep ghosh@xcite . with permission from the authors ,",
    "i m reproducing important parts their formulation here with some added features of my own",
    ".      there exist several chmm architectures .",
    "the one we will be using is known as the standard fully - coupled hmms which refers to a group of hmm models in which the state of one model at time @xmath2 depends on the states of all models ( including itself ) at time @xmath1 .",
    "while this architecture can be extended to accommodate any number of hmms coupled together , we shall henceforth limit our chmm to containing 2 coupled hmms .",
    "the number of nodes @xmath5 will be the same for both .",
    "transition probabilities of states for either model now depend on the current state of its hmm and the coupled hmm .",
    "so instead of @xmath6 as in hmms , we have @xmath7 . as seen in ( fig  [ fig : chmmfigure ] . ) , each row of white nodes represent the sequence of each hmm and the grey nodes represent the separate observations emitted from each model in its sequence .",
    "we ll have 4 transition matrices labeled as @xmath8 , @xmath9 , @xmath10 , @xmath11 where @xmath12 gives us the probability contribution of transiting to the @xmath13th node in model @xmath14 while in the @xmath15th in @xmath16th model .",
    "clearly , we have the constraint @xmath17 for all @xmath15 , @xmath16 and @xmath14 . the joint transition probability to go to a state in either",
    "hmm @xmath18 is    @xmath19    where @xmath20 is the coupling weight from hmm @xmath21 to hmm @xmath18 , i.e. how much @xmath22 affects @xmath23 by way of the probability @xmath24 .",
    "the observation probabilities and prior probabilities are defined as per the standard hmm formulation , but this time we ll have two sets , one for each model , i.e. @xmath25 , @xmath26 , @xmath27 and @xmath28 .      coupling 2 hmms gives us the following parameter space .",
    "the prior probabilities are @xmath29 where @xmath30 and @xmath31 with @xmath32 .",
    "the transition probabilities are @xmath33 where @xmath34 and @xmath35 with @xmath36 .",
    "the observation probabilities are @xmath37 , @xmath30 and @xmath31 with @xmath38 and @xmath39 .",
    "the coupling coefficients are @xmath40 , @xmath41 with @xmath42 for @xmath30 .",
    "we will be using a discrete probability distribution where the outputs are modelled as a range of values .",
    "lb and ub defines the lower bound and upper bounds of the output .",
    "we will then partition the range into @xmath43 equal gaps .",
    "@xmath44 assigns a probability for each of the gaps .",
    "so , for example , if @xmath45 , @xmath46 and @xmath47 , @xmath44 will assign probabilities to the outcome intervals @xmath48 .      given a sequence of observations",
    ", we might also want to find the most probable hidden path or optimal path that would have output that sequence .",
    "we define the optimal path @xmath49 as the path that maximizes @xmath50 which is equivalent to maximizing @xmath51 . for hmm",
    ", there is the @xmath52 to find such a @xmath49 .",
    "we extend its implementation to solve for chmm .",
    "instead of considering just one optimal path for a hmm , we need to consider two optimal paths for our 2 model chmm given two observation sequences .",
    "so , we wish to find the optimal paths @xmath53 and @xmath54 for given observation sequences @xmath55 and @xmath56 .",
    "define the quantity    @xmath57\\ ] ]    which means the highest probability along hmm @xmath18 at time @xmath2 that output the first @xmath2 observations and ends in state @xmath58 . by inducation",
    "we have ,    @xmath59b_k^{(c)}(o_{t+1}^{(c)})\\ ] ]    to be able to retrieve the optimal paths , we need to keep track of the argument which maximized ( 3 ) for each @xmath2 , @xmath60 pairing and @xmath18 .",
    "we create the array @xmath61 to do this .",
    "the complete procedure for finding the optimal path for hmm @xmath18 is as follows :",
    "initialization :    @xmath62    @xmath63    \\2 .",
    "recursion :    @xmath64b_k^{(c)}(o_{t}^{(c ) } ) , \\;\\;\\;\\;\\;\\ ; 2\\leq t \\leq t , 1 \\leq k \\leq n\\ ] ]    @xmath65 , \\;\\;\\;\\;\\;\\;\\;\\;\\;\\;\\;\\;\\;\\;\\;\\;\\ ; 2\\leq t \\leq t , 1 \\leq k \\leq n\\ ] ]    \\3 .",
    "termination :    @xmath66\\ ] ]    @xmath67\\ ] ]    \\4 .",
    "optimal path backtracking : @xmath68    to get the optimal paths for our chmm , we simply perform the above for hmm 1 and 2 .      as with hmm models ,",
    "we need to devise a way to learn the parameters of our chmm from the observations .",
    "while we could port the em / gem algorithm for hmms over to chmms , doing so will make calculations computationally intractable , at least with the algorithm in its present developed form .",
    "therefore , we ll revert to classical optimization techniques .",
    "the baum - welch method used to trained hmms contains within it theorems which allows us to derive reestimation formulae for the parameters in the chmm .",
    "@xcite has done this nicely to give us the following reesitmation for the model parameters for hmm c :    @xmath69    @xmath70    @xmath71    @xmath72    refer to the appendix for the calculation of partial derivatives .",
    "it may be unclear how does one hmm affect the reesitmation of parameters for the other hmm since all formulae for reestimating @xmath73 , @xmath74 and @xmath75 for hmm @xmath18 does nt take into account the parameters of the other hmm .",
    "the dependance on the other hmm s parameters is present in the calculation of @xmath76 , @xmath77 and @xmath78 as seen in the appendix .    as with learning for hmms , for each iteration",
    ", we use the present hmms parameters to estimate new ones for all @xmath79 , @xmath80 , @xmath81 and @xmath82 and then swap the present parameters with the new ones .",
    "in order for us to capitalize on the predictive powers of a chmm , it is best that we use it to model two separate assets that are either strongly correlated or strongly uncorrelated .",
    "facts of currency and commodity trading will help us choose these two assets .",
    "one , it is believed that during times of economic unrest , investors tend to dump the dollar in favor of gold . that gold maintains its intrinsic value implies a negative correlation between the us dollar and gold .",
    "two , following a gold selling program , the swiss national bank held 1,290 tonnes of gold in reserves which equated to 20% of switzerland s assets@xcite .",
    "therefore , the swiss dollar and gold should move in opposite directions .",
    "( fig  [ fig : usdchfgold ] ) both of these facts would have us believe that usdchf and gold are negatively correlated , the rise in one implies a fall in the other .          usdchf and gold will be our two assets modelled by the chmm .",
    "the word asset used henceforth can either mean a currency asset or a commodity asset . for both assets , we record down their closing prices .",
    "now , we must be careful in how we define the observation sequence .",
    "initially , one may decide to use the closing prices as the observations .",
    "however , we may run into a few problems .",
    "first , we will have a hard time finding the range of the observations since by considering prices , we do not have a definite bound on it . from jan 2013 to apr 2013 , usdchf has a lower bound of 0.9021 and an upper bound of 0.9568 .",
    "for gold , it s 1323 and 1702 .",
    "due to our limitations of a discrete probability distribution , we have to fix a range for our observations .",
    "but we can not say a prior whether the prices of either will break either of their respective bounds past apr 2013 .",
    "second and more importantly , in order for the transition probabilities @xmath9 and @xmath10 to have meaning , the degree to which a single unit change of the observation of an asset in one hmm affects the transition probabilities of a specific hmm model must be the same degree as affected by a single unit change of the observation of an asset in the other hmm . these two problems can be easily solved if we normalize the observations to take values in a certain range .    for reasons which will be clearer later ,",
    "we decide to have our observation sequences be the relative strength index ( rsi ) of the closing price of usdchf and of gold .",
    "this way , we know that observations from either model will be between 0% and 100% and because of that , a percentage change in observations from one hmm will have the same effect as a percentage change in observations from the other hmm . our choice of basing our indicators on 10-min charts will be explained more later .    therefore , we define our observation sequences as follows .",
    "the rsi of usdchf as @xmath83 and the rsi of gold as @xmath84 where @xmath85 .",
    "we ll use @xmath86 to represent usdchf s hmm and @xmath87 gold s hmm .",
    "the main idea in deciding when to enter a trade is as follows . 1 .",
    "at the close of a bar , record down the rsi of the price of the last @xmath88 bars for both assets giving us the observation sequence @xmath89 and @xmath90 .",
    "2 . with the observation sequence @xmath89,@xmath90",
    "find the optimal set of parameters @xmath91 for our chmm .",
    "this may require us iterate the training process more than once until the increment in @xmath92 falls within a certain threshold .",
    "3 . based on how we choose to derive the next most probable state , that is @xmath93 and @xmath94 , find them for both assets .",
    "4 . using the newly learned parameters @xmath80 for our observation probabilities , find the most probable output of the most probable observation for both assets .",
    "5 . define a rule on this observation that will tell us whether to enter a trade .",
    "our trading rule would be the simple 4 period simple moving average ( sma ) of 4 period rsi overbought and oversold levels .",
    "we will go long when sma of rsi crosses over the level 20% and short when sma of rsi crosses under the level 80% .",
    "sma is used to even out the noise , more so for the rsi values predicted by chmm since they would be discretized .",
    "we ll use a simple take profit level at 6 times the 12 period atr into the money and a stop loss of 2 times the12 period atr against the money giving us a 3:1 risk to reward ratio .",
    "entries will be at the open using triggers from the previous bar .",
    "exits are at the atr level .",
    "what follows are four strategies that uses different aspects of the chmm to generate a trading signal .",
    "since the chmm is made of several componenets , our goal is to analyze the model and deduce which componenets give a more accurate signal and which ones do nt .      in finding the most probable state to base our next observation from ,",
    "we use only the transition matrices to find it .",
    "consider one hmm .",
    "we want to find which of the @xmath5 states each hmm ( the destination ) is most likely to transit to . by taking transition probability matrics of this own hmm to itself and the other hmm ( the source ) to this hmm separately , we sum the probabilities of transiting to a particular state on the destination hmm from all the states in the source hmm .",
    "both sums from the two source hmms are then weighted and added together .",
    "the most likeliest state for the target hmm is then the state with the highest sum probabilities .",
    "specifically ,    @xmath95\\ ] ]    @xmath96\\ ] ]    where @xmath97 and @xmath98 is the most likeliest state for usdchf and gold as calculated in this way . from here , we make predictions using @xmath99 and @xmath100 .      here , @xmath101 and @xmath102 are simply the states at time @xmath88 of each viterbi paths . with them",
    ", we again use the transition probabilities to predict the next state .",
    "now , the state at time @xmath2 is fixed but the chmm will evolve to @xmath97 and @xmath98 where for each hmm , they are determined by the weighted contributions of probability given @xmath101 and @xmath102 .",
    "specifically ,    @xmath103\\ ] ]    @xmath104\\ ] ]    as before , predictions are made using @xmath99 and @xmath100 .",
    "now , for each trade , we scale the size of our position based on how probable the next state is as told by the transition probabilities .",
    "regardless of whether we use viterbi or not to get our next most probable state , we can derive a probability measure from the transition probabilities that tells us the probability of reaching this state as compared to the others .",
    "specifically , given @xmath97 , the quantity    @xmath105 } {    \\left [   \\sum_{k}^n\\sum_{i}^n\\sum_{j}^n     \\theta_{(1,1 ) }      a_{i , k}^{(1,1 ) }        + \\theta_{(2,1 ) } a_{j , k}^{(2,1 ) } \\right ]     }   \\;\\ ; \\ ; \\;\\;\\;\\;\\;\\;\\;\\;\\;\\;\\;\\;\\;\\;(=x)\\ ] ]    is a probability measure and it tells us the probability of switching to state @xmath97 if not for the likeliest state at the current time given by viterbi .",
    "we can then use the quantity , a value between 0 and 1 , to determine the size of our position . to keep things simple ,",
    "the scaling is linear .",
    "so if our default size per trade is 1,000,000 , the new size will be @xmath106 multiplied by that amount .",
    "the reasoning here is that the more likely the hmm will switch to @xmath97 , the more capital we want to risk .",
    "we repeat 3.1 to 3.5 but use a strategy based around the cci indicator which when backtested produces fairly profitable results . now , our observation sequence becomes a 4-period cci .",
    "values for the cci indicator in 10 mins range from -133 to 133 so the discretization of the observation bound will be eight evenly space intervals from -140 to 140 .",
    "we long ( short ) at the open if the previous 4-period sma of a 4-period cci crosses under 105 ( over -105 ) .",
    "stop loss is a 4 times a 24-period atr from the trade entry price and take profit is a 10 times a 24-period atr from the trade entry price .",
    "sine this cci is used to detect large moves in price action , we will only allow only one long or short position at a time .",
    "as with the times when anyone deals with trading strategy , there is the decision of what time interval to use .",
    "we are not restricted to a certain time interval , be it 5 , 10 or 60 minutes , when recording down our observations for our chmm . as you shall see later , we ran our strategy using prices in 10 minute intervals .",
    "the time frame of data we will be using is ohlc data for usdchf and gold at 10 minute intervals . just like how technical indicators can be applied to any time frame @xcite , our chmm strategy",
    "can also be applied to any time frame .",
    "however , we must be careful in selecting the appropriate time frame that gels well with the inherit property of our model , that is the markov property . in selecting a time interval",
    ", we are assuming that the state of the market obeys the markov property when it swtiches once every interval .",
    "what we are supposing is that all the information required to predict the next state is captured within that interval .",
    "the implication here is that too long an interval and we might lost some information which would otherwise be meaningful in determining the next state and too short an interval we deal with just random noise .    picking an appropriate time frame",
    "would be a study in itself .",
    "trading enthusiasts even argue that strategies should involve multiple time frames . for now , we ll stick with our choice of ohlc in 10 mins .",
    "the choice of parameters for our chmm are 4 periods for the look back , 5 hidden states and 8 discretization steps given the outcome of observations in steps of @xmath107 .",
    "we chose 4 for the look back to tally with our period of 4 for the rsi strategy we will be using .",
    "essentially , we are looking as far back as does the technical indicator .",
    "the 5 hidden states will represent the states super bear , bear , random , bull and super bull of the economy .",
    "lastly , discretizing the observation range of 0% to 100% into 8 steps allows us to nicely specific levels 20% and 80% for the signals .",
    "a value below 20 for sma of rsi signifies oversold levels and above 80 overbought levels . in learning the parameters of the chmm , we repeat updating parameters @xmath108 three times through each iteration .",
    "we get our 10-min data from the cqg@xcite .",
    "usdchf and gold s open , high , low , close data were taken from 01/01/2013 to 05/01/2013 specificed by symbols x.us.iusdchf and f.us.gce .",
    "time for calculations depends on the lookback , number of hidden states and discretization parameters of the chmm .",
    "our current set up was chosen given the computational power and time we worked with .",
    "all four systems using chmm outperformed their standard version for both the rsi and cci systems .",
    "( fig  [ fig : perfsheet ] and fig  [ fig : perfsheetcci ] ) recall that our strategy setup was taking a tested strategy and use the chmm to predict future values for the indicators used in the system . for rsi ,",
    "the system was making losses but for cci , the system was fairly profitable .",
    "more importantly , for both systems there was an increase in returns upon using the chmm .            [ cols= \" < , < , < , < , < \" , ]     between chmm systems , we see an improvement in the sharpe ratio when we use dynamic allocation .",
    "volatility drops for both systems using dynamic allocation while returns also drop .",
    "( see fig  [ fig : perftable ] ) we feel that this is expected because the probability of the next most probable state is largely concentrated in the 40% to 60% region ( see fig .",
    "[ fig : nextprob ] ) . given that wihtout dynamic allocation , we always allocate 100% of our capital , returns are bound to drop .",
    "our conclusion is that information contained in the chmm in the form probabilities of the next state does have value in optimizing the trading system . in this case , it helps stabilizes the trading system by decreasing volatility , which is usually a good thing as believed by traders .",
    "now , we do a quick analysis on how much different the next probable state is when using viterbi and non - viterbi methods . as the performance for both differs , but only slightly , we expect that the probable states was predicted by both methods will also differ slightly .",
    "one practical use in knowing that the viterbi and non - viterbi methods are quite faithful to each other is that we could abandone the more computational intensive one in favor for the less computational intensive one .",
    "based on the performance of the trading system of rsi overbought oversold where one system uses the actual rsi value and four others use the rsi value as predicted by the chmm , we see that the latter drastically outperforms the former .",
    "the reasons are twofold .",
    "one , our chmm introduced additional data , the dynamics of gold , into our trading strategy .",
    "more importantly , chmm allows a convenient coupling , via the transition matrix , that positively affects trading performance using this new information .",
    "two , implicit in the model is the markov property which is believed to remove the problem of lag pronounced in the rsi strategy .    of course , right now",
    ", it is only a theory that chmms give better indicators for generating trade signals .",
    "further substantiating this theory requires us to look at the myriad of trading systems common in trading literature , i.e. stochastics , macd divergence , ma crossovers , employ a chmm with an appropriate cross market asset and with its observations being the indicators for the system conconcerned , and then compare performance figures .",
    "we hope that by doing so , performance figures will improve based on the beneficial features of the chmm .",
    "the results of this paper has made us to believe the value in chmm used in formulating a profitable trading strategy .",
    "we like its markov feature and its ability to link hmms of different markets giving us a more confident trading signal . due to its merits",
    ", we hope to develop an entire trading engine centered around chmm as seen in fig  [ fig : workplan ] .          for this paper , we used a chmm to predict the next rsi value of the assets and conclude whether the asset is overbought or oversold . in similar fashion , we can use chmm to forecast values of other indicators and use them to generate trading signals .",
    "for example , we might want to forecast stochastic oscillator and use it to filter out false breakout levels .",
    "the use of chmm acts as a complement to improve established breakout systems .    or for example",
    ", we can use the forecasted indicators of the both assets and determine a signal based on how far they diverge or converge in the style of a mean reverting strategy .",
    "the supposed correlation of the two assets is accounted for by the inherit coupling between the states .",
    "our work only dealt with a discrete probability distribution where the range of values is discretized into regularly spaced intervals . having the observations take a continuous distribution introduces a wealth of new problems we need to tackle - what distribution to use , the learning of parameters , weights for mixtures .",
    "one hopeful benefit in working with continuous distributions is the improved accuracy in forecasting as this distribution better represents the distribution of observations .",
    "however , the added cost in using continuous distributions is the computational workload we incur during the learning of parameters of the distribution . and for more complication distributions , how we learn the paramters may not be a trivial task in itself .      a nifty idea , yet",
    "one very far in the workplan , is to explore three coupled hmms modeling triangular currency pairs , i.e. usdjpy , gbpjpy and usdgbp . in currency trading ,",
    "there s opportunities in such triple linked pairs .",
    "one such opportunity is the triangular arbitrage .",
    "while we are nt considering arbitrage style strategies , we can still leverage on the coupling feature of chmms to see whether there are good strategies involving such three currencies .",
    "chmm , if done right , can also be used for multitime frame trading strategies .",
    "we could use the coupling of hmms to investigate a relationship between the macro picture of the charts , say 60 min ohlc , and the micro picture of the charts , say two regions of 5 min ohlc . in formulating a trading strategy , a breakout as seen in 5 min",
    "could be linked to how price action evolved in 60 min or vice versa .",
    "we believe that by carefully studying each area of the chmm starting with the ones listed above , we will reach closer to the goal of developing a very profitable trading system ."
  ],
  "abstract_text": [
    "<S> we devise a usdchf trading strategy using the dynamics of gold as a filter . </S>",
    "<S> our strategy involves modeling both usdchf and gold using a coupled hidden markov model ( chmm ) . </S>",
    "<S> the observations will be indicators , rsi and cci , which will be used as triggers for our trading signals . </S>",
    "<S> upon decoding the modeling in each iteration , we can get the next most probable state and the next most probable observation . </S>",
    "<S> hopefully in taking advantage of intermarket analysis and the markov property implicit in the model , trading with these most probable values will produce profitable results .    </S>",
    "<S> * keywords : * coupled hidden markov model , intermarket analysis , quantitative trading </S>"
  ]
}