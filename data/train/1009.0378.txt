{
  "article_text": [
    "gyrokinetics @xcite has proven a very useful tool to study turbulence in the core of fusion devices , making kinetic simulations of turbulent fluctuations possible in reasonable computational times @xcite .",
    "its main advantage is averaging over the gyrofrequency time scale without losing the effect of the finite size of the gyroradius that is of the order of the typical wavelength of the turbulence . to perform this average , it is necessary to assume certain orderings that in the electrostatic limit can be summarized as @xmath2 where @xmath3 is the electrostatic potential , @xmath4 is the magnetic field , @xmath5 is the characteristic frequency of the turbulent fluctuations , @xmath6 is a characteristic macroscopic scale , @xmath7 , @xmath8 and @xmath9 are the thermal speed , the gyroradius and the gyrofrequency of the species of interest , @xmath10 and @xmath11 are the charge and the mass , and @xmath12 and @xmath13 are the magnitude of the electron charge and the speed of light . since this article is about electrostatic gyrokinetics",
    ", we have assumed that the magnetic field is stationary and its characteristic length of variation is of the order of the macroscopic length @xmath6 .",
    "the ordering in ( [ orderings ] ) implies that the electrostatic potential fluctuates with some characteristic frequency @xmath5 and has a strong gradient perpendicular to the magnetic field , on the order of the inverse of the gyroradius , whereas its gradient parallel to the direction of the magnetic field , @xmath14 , is on the order of the inverse of the larger scale @xmath6 .",
    "the frequency @xmath5 of the turbulence is usually much smaller than the gyrofrequency , making the gyrokinetic average over the gyromotion valid .",
    "we have employed the small parameter @xmath15 to make this explicit . in most fusion experiments ,",
    "the ratio of the gyroradius and the macroscopic length is another small parameter that we also order as @xmath0 .",
    "it is easy to see that in drift wave turbulence , for which the characteristic frequency is @xmath16 , the quantities @xmath17 and @xmath18 are indeed of the same order .",
    "more importantly , to obtain the typical gyrokinetic formalism , it is necessary to order the electrostatic potential as small compared with the characteristic energy of the particles .",
    "this assumption is necessary to prove that the gyromotion of the particles is circular to lowest order .",
    "the most common gyrokinetic ordering assumes that the parameter @xmath19 is comparable to @xmath0 , as is done in ( [ orderings ] ) . in this way",
    ", magnetic geometry effects such as the @xmath20 and curvature drifts , of order @xmath18 , are allowed to be comparable to the turbulent @xmath21 drift , of order @xmath22 . ordering these effects so that they are comparable is very important in , for example , the core of tokamaks , where the curvature of the magnetic field lines is believed to be the most important drive for the turbulence @xcite .",
    "the ordering in ( [ orderings ] ) contains the simplest assumptions that are still interesting , but it can be extended to include components of the potential that have perpendicular gradients of the order of the inverse of the macroscopic length @xmath6 @xcite .",
    "the results that we present in this article can be easily extended to some of these more general orderings , but we leave this for future work .",
    "there are different techniques to obtain gyrokinetics ( and for that matter , drift kinetics @xcite , of which gyrokinetics is a natural extension ) . on the one hand",
    ", it is possible to obtain the gyrokinetic equation by working iteratively on the vlasov equation @xcite .",
    "we will call these _ iterative methods_. on the other hand , it is possible to use phase - space lagrangian / hamiltonian methods that solve order by order for the motion of the particle in a given electromagnetic field , uncoupling the gyromotion from the slower time scales @xcite .",
    "once the motion of the particle is known , the vlasov equation is simply obtained by its characteristics .",
    "we will call these _",
    "lagrangian methods_. both procedures are asymptotic expansions in the parameter @xmath0 , and give equivalent equations order by order , but the lagrangian methods have the advantage of giving the equations in a form that exactly conserves some energy - like quantities",
    ". this property may be very important for the global , full @xmath23 simulations that are being developed @xcite . to have an energy - like invariant and at the same time obtain equations of motion and equations for the electromagnetic fields that are the same to first order in @xmath0 as those obtained with the iterative procedure , it is necessary to carry the expansion in @xmath0 to higher order .",
    "for example , in a slab  @xcite , it is necessary to obtain the hamiltonian to second order in @xmath0 .",
    "the second order piece of the hamiltonian , quadratic in the electrostatic potential @xmath24 , gives second - order corrections to the equations of motion and hence it is in principle negligible to first order .",
    "however , if the lowest - order quasineutrality equation that contains a linear term in @xmath24 is employed , the second - order correction to the hamiltonian must be kept to obtain an energy - like invariant .",
    "the complete calculation to order @xmath1 has not been done for a general static magnetic field in either formalism so far was given in @xcite . ] .",
    "in the most common lagrangian formulation  @xcite , the calculation is done in two steps : first , the turbulent electromagnetic fields are ignored and only the background magnetic field is considered , giving the drift kinetic equation ; in the second step , the turbulent electromagnetic fields are added and the corresponding corrections are calculated . consider the case in which the magnetic field does not vary in time , i.e. electrostatic gyrokinetics . in the first step , the equations are expanded in the small parameter @xmath25 , whereas in the second step , they are expanded in @xmath26 .",
    "the expansion in @xmath0 is only performed to first order because the next order results are very tedious to calculate .",
    "the expansion in @xmath27 is continued to second order because the pieces quadratic in @xmath24 are needed to have an energy - like invariant . in the expansion in @xmath27 ,",
    "the fact that there has been a previous expansion in @xmath0 is ignored , and as a result the terms of order @xmath28 are never calculated .",
    "the missing terms of order @xmath1 and @xmath28 are comparable to the terms of order @xmath29 according to the gyrokinetic ordering in ( 1 ) , making this expansion consistent only when @xmath30 .",
    "in addition , since the cross - terms that contain both the background magnetic field and the turbulent electrostatic potential , of order @xmath28 , are always neglected when the two - step method is presented , it is not obvious how to calculate them following that procedure . in this article",
    ", we present the complete phase - space lagrangian calculation with the standard gyrokinetic ordering ( 1 ) , emphasizing the self - consistent calculation of the terms of order @xmath1 and @xmath28 . in the gyrokinetic equations that result from the new lagrangian , the magnetic geometry effects and the fluctuating potential appear together in the second - order terms , showing that geometry and turbulence can not be separated and dealt with independently .",
    "our main result is the explicit expression for the second - order gyrokinetic hamiltonian given in equations  ( [ hamiltonian_o2_2 ] ) , ( [ psi2_phi ] ) , ( [ psi2_phib ] ) and ( [ psi2_b ] ) .",
    "it clearly exhibits the interplay between geometry and turbulence inherent to gyrokinetic theory , possessing terms of three types : terms quadratic in the electrostatic potential , terms that include both the electrostatic potential and the magnetic geometry , and terms that are purely geometrical .    at this point",
    ", it is fair to wonder about the motivations beyond formal coherence to carry out the expansion consistently to second order in @xmath0 .",
    "keeping the second order piece of the hamiltonian that is quadratic in the electrostatic potential is necessary for the conservation of an energy - like invariant , as already noted above .",
    "when the other second - order terms computed in this article are included , they have two effects : ( i ) the gyrokinetic poisson s equation is modified by the effect of the non - uniform magnetic field on the gyro - orbits , and ( ii ) the equations of motion are modified to second order .",
    "both of these effects are not conventionally kept in gyrokinetic formulations , but they may be crucial for conservation of momentum .",
    "conservation of momentum in full @xmath23 gyrokinetic formulations has been the center of a recent controversy @xcite . by assuming a gyrobohm level of turbulent transport of momentum at long wavelengths , catto and one of us , fip , have argued that to recover with a full @xmath23 model the correct transport of toroidal angular momentum in a tokamak , it is necessary to have gyrokinetic fokker - planck and poisson s equations correct to third order in @xmath0 in the high flow ordering , for which the average velocity of the ions @xmath31 is of the order of the ion thermal speed @xmath32 , and correct to fourth order in the low flow ordering , for which @xmath33 . in the case of slab gyrokinetics , a consistent calculation of the transport of momentum in the low flow ordering",
    "requires the third order hamiltonian @xcite .",
    "the requirements for a system with general geometry are still to be sorted out , and to do",
    "so it is necessary to study the new terms presented here and terms of even higher order .",
    "in addition to the issues raised for full @xmath23 simulations , the formulation presented here will be very useful for @xmath34 approaches to momentum transport in tokamaks in the low flow ordering .",
    "reference @xcite presents a formulation of this problem in the electrostatic limit that requires the minimum number of modifications to existing @xmath34 simulations .",
    "the most important conclusion in @xcite is that the turbulent pieces of the distribution function and the electrostatic potential have to be calculated to an order higher in @xmath0 than usual because the contribution to momentum transport from the lowest order pieces vanishes due to symmetry arguments @xcite .",
    "these symmetry arguments do not hold if the higher order terms of the gyrokinetic equation are considered . to avoid calculating most of the next order corrections to the gyrokinetic vlasov and poisson s equations , reference @xcite has to resort to a subsidiary expansion based on the fact that in many tokamaks the poloidal component of the magnetic field is much smaller than the toroidal component .",
    "the new contribution to the hamiltonian that we calculate here gives the self - consistent higher order contributions to the gyrokinetic vlasov equation for the first time .",
    "only a higher order gyrokinetic poisson s equation is then lacking to obtain a complete @xmath34 formulation in the low flow ordering that does not require a small poloidal magnetic field ; this will be the subject of a future publication .",
    "the rest of this article is organized as follows . in section  [ sect_order ]",
    "we write the non - dimensional phase - space lagrangian of a particle in an electromagnetic field .",
    "the normalization shows explicitly the standard gyrokinetic ordering ( [ orderings ] ) . in the first part of section  [ sect_theory ] we review the phase - space lagrangian approach to gyrokinetics to help the understanding of the calculation that follows . in the second half of this section",
    "we proceed to obtain the gyrokinetic lagrangian to second order in our expansion parameter @xmath0 .",
    "as mentioned above , this is our main result . in section  [ sec :",
    "gyroeqsmotion ] we obtain the vlasov equation from this lagrangian , and in section  [ sec : gyropoissoneq ] we discuss the consequences of this formulation for poisson s equation .",
    "the new vlasov and poisson s equations presented here are correct to second and first order in @xmath0 , respectively .",
    "we should remark that in the limit where the electrostatic potential has a scale of variation much larger than the gyroradius of the species of interest , our gyrokinetic equations provide the highest order guiding - center equations that we are aware of . in section  [ sec : fieldtheory ] we borrow tools from classical field theory to obtain poisson s equation in a different way .",
    "we prove that there is an energy - like invariant and we discuss the stringent conditions on the equations to actually conserve it in a simulation .",
    "we finish with a discussion of our results and the future lines of research in section  [ sec : conclusions ] .",
    "the appendices contain the most cumbersome parts of the calculation as well as some material included for completeness .",
    "finally , we would like to stress that in this article we have given all our results in an explicit form that can be directly implemented in a computer code .",
    "the phase - space lagrangian for the motion of a particle of mass @xmath11 and charge @xmath10 in an electromagnetic field is given by @xmath35 \\cdot \\frac{d { \\mathbf{r}}}{dt } - h^{\\mathbf{x}}({\\mathbf{r } } , { \\mathbf{v } } , t ) , \\label{lagr_orig}\\ ] ] with the hamiltonian @xmath36 here @xmath37 is the vector potential that is defined such that @xmath38 .",
    "notice that the phase - space lagrangian depends on the position of the particle @xmath39 , its velocity @xmath40 , the time derivatives of both the position and the velocity , @xmath41 and @xmath42 , and the time @xmath43 . for convenience",
    ", we will sometimes denote the phase - space coordinates @xmath44 as @xmath45 .",
    "we use the superscript @xmath46 in the lagrangian ( [ lagr_orig ] ) because it is a function of the phase - space coordinates @xmath47 .",
    "the equations of motion are obtained by finding the stationary points of the action @xmath48 = \\int_{t_0}^{t_1 } dt\\ , \\mathcal{l}^{\\mathbf{x}}({\\mathbf{r}}(t ) , { \\mathbf{v}}(t ) , \\dot{{\\mathbf{r}}}(t ) , \\dot{{\\mathbf{v}}}(t ) , t ) $ ] with respect to variations of the functions @xmath49 and @xmath50 subject to the constraints @xmath51 , @xmath52 , @xmath53 and @xmath54 . from this procedure",
    "we obtain six equations of motion , namely @xmath55 and @xmath56 this differs from the standard lagrangian formalism where the lagrangian function depends only on @xmath39 , @xmath57 and @xmath43 .",
    "actually , the phase - space lagrangian formalism can be viewed as a variational formulation of hamilton equations ( see , for example , @xcite ) . in plasma physics , it was first applied by littlejohn to guiding - center dynamics in @xcite .",
    "the lagrangian ( [ lagr_orig ] ) is non - dimensionalized using the characteristic thermal velocity of the species of interest @xmath7 , the characteristic length @xmath58 and the characteristic time @xmath59 .",
    "we assume that @xmath60 is a small parameter , with @xmath8 and @xmath61 the characteristic gyroradius and the characteristic gyrofrequency of the species of interest , and @xmath62 the characteristic magnitude of the magnetic field .",
    "we assume that the characteristic time and length scales in the electrostatic potential are the sound gyroradius @xmath63 and the sound characteristic time @xmath64 , i.e. , @xmath65 , where @xmath24 has derivatives with respect to its arguments of order unity . here",
    "@xmath66 is the sound speed , @xmath67 and @xmath68 are the mass and the gyrofrequency of the dominant ion species , usually singly charged , and @xmath69 is the characteristic electron temperature .",
    "the assumption on the scales of the electrostatic potential can be easily relaxed to account for other time and spatial scales . since the electrostatic potential @xmath24 is a quantity that enters the equations of the different species , it is normalized using parameters that do not depend on the species , in particular the characteristic electron temperature @xmath69 , the magnitude of the electron charge @xmath12 and the mass of the dominant ion species @xmath67 .",
    "this normalization will be useful in poisson s equation , where several species appear .",
    "the new , non - dimensionalized variables are @xmath70 giving @xmath71 \\cdot \\frac{d \\check{{\\mathbf{r}}}}{d\\check{t } } - \\check{h}^{\\check{{\\mathbf{x } } } } ( \\check{{\\mathbf{r } } } , \\check{{\\mathbf{v } } } , \\check{t } ) , \\label{lagrange_non}\\ ] ] with @xmath72 here , @xmath73 is the characteristic temperature of the species of interest , @xmath74 is the ratio between the sound gyroradius and the characteristic scale length , @xmath75 is the ratio between the sound gyroradius and the gyroradius of the species of interest , @xmath76 is the ratio between the thermal speed of the species of interest and the sound speed , and @xmath77    even though the electrostatic potential is small , its perpendicular gradient is not . this assumption has been formally implemented by writing @xmath78 . here and in what follows",
    "we assume @xmath79 .",
    "this is the maximal ordering that contains in it several interesting regimes as subsidiary expansions in @xmath80 , @xmath81 and @xmath82 .",
    "the form @xmath78 is , however , somewhat deceiving because the gradients along the magnetic field lines must be small , that is , @xmath83 , with @xmath84 the unit vector parallel to the magnetic field .",
    "it is possible to formalize this condition by writing the functions in flux coordinates @xmath85 , @xmath86 and @xmath87 such that @xmath88 and @xmath89 . in these variables , the potential is given by @xmath90 to simplify the notation , we will often use @xmath91 instead of the most complete expression in ( [ phi_formal ] ) . where no confusion is possible",
    ", we will write @xmath92 . in any case",
    ", we always assume @xmath93 and @xmath94    note that @xmath0 is species - dependent whereas @xmath95 is not . in sections",
    "[ sect_theory ] and [ sec : gyroeqsmotion ] where we compute the gyrokinetic phase - space lagrangian and the equations of motion of a single species , @xmath0 is the natural expansion parameter .",
    "however , in sections [ sec : gyropoissoneq ] and [ sec : fieldtheory ] , devoted to the gyrokinetic poisson s equation , we need to consider several different species and @xmath96 is the appropriate , species - independent small parameter .    finally , a notational remark is in order . in sections [ sect_theory ] and [ sec : gyroeqsmotion ]",
    "we will be very careful to exhibit the dependence of our results on the mass , charge and temperature of the species through the parameters @xmath80 , @xmath81 and @xmath82 .",
    "although at some places this may seem unnecessary and awkward ( and it would be if our objective were to treat always a single species ) , it is very convenient to write poisson s equation and the gyrokinetic phase - space lagrangian for a mixture of species in sections [ sec : gyropoissoneq ] and [ sec : fieldtheory ] .",
    "from now on we will drop hats @xmath97 in the normalized expressions .",
    "in this section we follow the general strategy of the applications of hamiltonian and phase - space lagrangian techniques to magnetized plasmas  @xcite .",
    "we search order by order in the small parameter @xmath0 for a change of phase - space variables such that only one of the variables has fast time dependence .",
    "the gyrophase @xmath98 is the fast variable that evolves in the gyrofrequency time scale .",
    "the rest of the phase - space variables ( gyrocenter position @xmath99 , parallel velocity @xmath100 and magnetic moment @xmath101 ) evolve with the much slower characteristic time scale @xmath59 . to achieve this , their time derivatives @xmath102 , @xmath103 and @xmath104 will be made independent of the gyrophase to the order of interest . had they depended on @xmath98 , they would necessarily show rapid time fluctuations on top of the more physically interesting slow time evolution . to make the time derivatives @xmath102 , @xmath103 and @xmath104 independent of the gyrophase @xmath98",
    ", we search for a lagrangian that does not depend on @xmath98 ( it will still depend on its time derivative @xmath105 ) .",
    "we first review briefly how to perform a change of variables in a phase - space lagrangian in subsection  [ sub_change ] .",
    "as we have already announced , the objective is the gyrokinetic lagrangian to order @xmath1 in general magnetic geometry .",
    "since the calculation is quite long and complicated , we have sketched the derivation in subsection  [ sub_procedure ] to offer the reader a global perspective of the formalism .",
    "this subsection also contains our own proof that the algorithm to find the gyrokinetic change of variables can be carried out to any order and that there exists an adiabatic invariant @xmath101 to arbitrary order .",
    "finally , in subsections [ sub_drift ] and [ sub_gyro ] we address the calculation of the gyrokinetic lagrangian to second order in detail .",
    "some of the algebra is relegated to [ app_dk ] and [ app_gyro_2 ] .",
    "the results to first order are compared with the iterative method in @xcite in [ app_comp ] .    before proceeding",
    ", we must mention that the phase - space lagrangian ( or hamiltonian ) approach to gyrokinetic theory has been geometrized @xcite .",
    "we have chosen not to use the language of differential geometry to make the paper accessible to a broader audience , without losing mathematical rigor .",
    "the reader familiar with the geometrical tools will realize that every step of our presentation can be translated into that language in an obvious way .      consider a transformation @xmath106 that can be time dependent to a new set of gyrokinetic phase - space coordinates @xmath107 .",
    "we write stands for the inverse of the transformation that we call @xmath106 .",
    "] @xmath108 .",
    "the phase - space lagrangian ( [ lagrange_non ] ) can be easily written in the new set of variables by using the chain rule , giving @xmath109 where @xmath110 \\cdot \\frac{\\partial { \\mathbf{r}}({\\mathbf{z}},t)}{\\partial z^\\alpha}\\ ] ] and @xmath111 \\cdot \\frac{\\partial { \\mathbf{r}}({\\mathbf{z}},t)}{\\partial t}.\\ ] ] by finding the stationary points of the action @xmath112 = \\int_{t_0}^{t_1 } \\mathcal{l}^{\\mathbf{z } } ( { \\mathbf{z}}(t ) , \\dot{\\mathbf{z}}(t ) , t ) d t$ ] with respect to variations of @xmath113 subject to the conditions @xmath114 and @xmath115 , we obtain the new equations of motion @xmath116 note that the specific form in ( [ lagr_change ] ) implies that the equations of motion can be written as @xmath117 with @xmath118 the @xmath119 antisymmetric matrix @xmath120 although our gyrokinetic change of variables has an explicit time dependence due to the contribution of the electrostatic potential , we will show that it is possible to choose the functions @xmath121 such that @xmath122 . in our derivation",
    "we impose then that @xmath123 .",
    "consequently , we drop the last term in ( [ eqmotionwithuglyterm ] ) and write the equations of motion as @xmath124 from expression ( [ eqmotion ] ) we define the poisson bracket @xmath125 with @xmath126 the inverse and [ app : poissonbrackets ] we show that the matrix @xmath118 of our particular problem is indeed invertible . ] of the antisymmetric matrix defined in ( [ lagr_bra ] ) .",
    "then @xmath127 noting that @xmath118 satisfies ( [ eq : closedform ] ) with @xmath128 , the proof in [ app_poissonbracket ] guarantees that ( [ poi_bra ] ) actually defines a poisson bracket , i.e. , that for any three functions @xmath129 , @xmath130 and @xmath131 , the bracket satisfies skew - symmetry @xmath132 the leibniz rule @xmath133 and the jacobi identity @xmath134    in general , it is impossible to find a change of phase - space variables that makes the lagrangian as written in ( [ lagr_change ] ) independent of gyrophase .",
    "however , the time derivatives @xmath135 may be gyrophase independent even if the phase - space lagrangian is not .",
    "this apparent discrepancy is easily solved considering that the equations of motion remain the same if instead of the lagrangian ( [ lagr_change ] ) we employ @xmath136 where the function @xmath137 depends on the phase - space variables @xmath138 and @xmath43 . indeed , finding the stationary points of the action @xmath139 = \\int_{t_0}^{t_1 } \\overline{\\mathcal{l } } ( { \\mathbf{z } } , \\dot{\\mathbf{z } } , t ) d t = \\int_{t_0}^{t_1 } \\mathcal{l}^{\\mathbf{z } } ( { \\mathbf{z } } , \\dot{\\mathbf{z } } , t ) d t+ s({\\mathbf{z}}_{1 } ,",
    "t_1 ) - s({\\mathbf{z}}_{0 } , t_0)\\end{aligned}\\ ] ] with respect to variations of @xmath113 subject to the conditions @xmath114 and @xmath115 gives the same equations of motion as finding the stationary points of the action @xmath112 $ ] because both actions differ only by terms that are held constant .",
    "since the lagrangian is not unique , we are not going to search for new phase - space variables @xmath138 such that the phase - space lagrangian @xmath140 in ( [ lagr_change ] ) is gyrophase independent , but such that there exists a function @xmath141 for which the phase - space lagrangian @xmath142 in ( [ lagr_prime ] ) is gyrophase independent .",
    "this is equivalent to requiring that the time derivatives @xmath135 be gyrophase independent .",
    "thus , we are searching for both the change of variables @xmath138 and the function @xmath141 such that the lagrangian @xmath142 in ( [ lagr_prime ] ) is gyrophase independent .",
    "explicitly , @xmath143 where @xmath144 \\cdot \\frac{\\partial { \\mathbf{r}}({\\mathbf{z}},t)}{\\partial z^\\alpha } + \\frac{\\partial s({\\mathbf{z}},t)}{\\partial z^\\alpha}\\ ] ] and @xmath145 \\cdot \\frac{\\partial { \\mathbf{r}}({\\mathbf{z}},t)}{\\partial t } - \\frac{\\partial s({\\mathbf{z}},t)}{\\partial t}\\ ] ] are gyrophase independent . in what follows , @xmath138 only refers to the gyrokinetic phase - space coordinates .",
    "notice that equations ( [ eqmotionwithuglyterm ] ) , ( [ lagr_bra ] ) , ( [ eqmotion ] ) , ( [ poi_bra ] ) and ( [ ddt_poibra ] ) are valid for the new lagrangian @xmath142 .",
    "simply replace @xmath121 by @xmath146 and @xmath147 by @xmath148 .",
    "as advanced in the introduction , the detailed computation to obtain the final form of the gyrokinetic lagrangian to order @xmath1 is rather involved .",
    "this is why we devote this subsection to schematically show the steps leading to the determination of the change of variables and the function @xmath141 order by order .",
    "we also give an easy proof that the algorithm can be carried out up to arbitrary order ( although in practice the computations would become prohibitively difficult ) . the detailed calculation to second order is done in subsections  [ sub_drift ] and [ sub_gyro ] .",
    "our transformation to new phase - space coordinates will be denoted by @xmath149 , explicitly in @xmath150 because the transformation is in general time dependent . ]",
    "@xmath151 where @xmath99 is the gyrocenter position , @xmath100 is the gyrocenter parallel velocity , @xmath101 is the magnetic moment and @xmath98 is the gyrophase . for convenience",
    ", we have written the transformation @xmath149 as the composition of two other transformations that we call _ non - perturbative transformation _ @xmath152 and _ perturbative transformation _ @xmath153 .",
    "first , we perform a non - perturbative change of coordinates @xmath154 where @xmath155 , @xmath156 , @xmath157 and @xmath158 are lowest order approximations to the gyrocenter position , parallel velocity , magnetic moment and gyrophase .",
    "their detailed definitions can be found in subsection  [ sub_drift ] .",
    "for simplicity , we will sometimes use the notation @xmath159 .",
    "physically , the non - perturbative change of variables in subsection  [ sub_drift ] amounts to saying that to lowest order the gyromotion is circular .",
    "this is a consequence of the smallness of the gyroradius and the fact that the corrections due to the electrostatic potential are of next order . after the change of coordinates we add the total time derivative of a function @xmath160 to the lagrangian .",
    "the details of the calculation are given in subsection  [ sub_drift ] .",
    "the final result is @xmath161 \\cdot \\frac{d{\\mathbf{r}}_g}{dt } \\nonumber \\\\ + \\left ( - \\mu_g + \\epsilon \\gamma_\\theta^{(1 ) } + \\epsilon^2 \\gamma_\\theta^{(2 ) } + \\ldots \\right ) \\frac{d\\theta_g}{d(t/\\epsilon ) } - h^{(0 ) } ( { \\mathbf{r}}_g , v_{||g } , \\mu_g ) - \\epsilon h^{(1 ) } , \\label{lagr_ini}\\end{aligned}\\ ] ] where @xmath162 and the rest of the terms are defined in subsection  [ sub_drift ] .",
    "notice that with the notation in ( [ lagr_ini ] ) we have made explicit the fact that @xmath163 , i.e. , its time variation is of the order of the gyrofrequency time scale and hence much faster than the evolution of the rest of the phase - space variables .",
    "the change of variables is non - perturbative and will give contributions to all orders in @xmath0 .",
    "all the higher order terms @xmath164 , @xmath165 , ... , @xmath166 , @xmath167 , ... and @xmath168 depend on gyrophase . in the lagrangian ( [ lagr_ini ] )",
    ", the hamiltonian has only the first order correction @xmath169 , with the higher order corrections being exactly zero .",
    "this correction @xmath168 is the only term in the lagrangian that has strong perpendicular gradients because it is the only contribution that depends on the electrostatic potential .    the gyrophase dependence in the lagrangian ( [ lagr_ini ] )",
    "must be eliminated with the definition of the gyrokinetic variables order by order .",
    "since we only calculate the gyrokinetic variables to some order , we truncate the expansion in @xmath0 to the order of interest . in general",
    ", we need to keep @xmath170 \\cdot \\frac{d{\\mathbf{r}}_g}{dt } \\nonumber \\\\",
    "+ \\left [ - \\epsilon \\mu_g + \\sum_{i = 1}^n \\epsilon^{i+1 } \\gamma_\\theta^{(i ) } ( { \\mathbf{r}}_g , v_{||g } , \\mu_g , \\theta_g ) \\right ]",
    "\\frac{d\\theta_g}{dt } \\nonumber \\\\ - h^{(0 ) } ( { \\mathbf{r}}_g , v_{||g } , \\mu_g ) - \\epsilon h^{(1 ) } ( { \\mathbf{r}}_{g\\bot}/\\epsilon , r_{g|| } , \\mu_g , \\theta_g , t ) + o(\\epsilon^{n+1 } , \\epsilon^{n+2 } ) . \\label{lagr_n}\\end{aligned}\\ ] ] here , we have not written explicitly @xmath171 . instead , we keep the terms that are multiplying @xmath172 to higher order in @xmath0 . the notation @xmath173 will be extensively used in this paper and indicates that the terms of order @xmath174 that we have neglected are either proportional to @xmath175 or are in the hamiltonian , and that the terms of order @xmath176 that we have neglected are proportional to @xmath177 , @xmath178 and @xmath172 ( the lagrangian ( [ lagr_n ] ) does not contain terms proportional to @xmath177 or @xmath178 ) . when we perform the expansion to obtain the gyrokinetic variables order by order",
    ", it will be apparent that this notation is convenient because we need to keep some terms to @xmath179 and the rest to @xmath180 .    employing expression ( [ lagr_n ] ) , we find the gyrokinetic variables by eliminating the gyrophase dependence order by order .",
    "for now , it is enough to simply write the transformation @xmath181 to the order of interest as @xmath182 in subsection  [ sub_gyro ] we show the connection of this expansion with lie transforms .",
    "sometimes we will use the abbreviated notation @xmath183 .",
    "notice that the variable @xmath99 is found to an order higher than the rest .",
    "the corrections @xmath184 , @xmath185 , @xmath186 and @xmath187 are obtained by imposing that the lagrangian is gyrophase independent up to terms of order @xmath188 , where the terms of order @xmath189 are in the hamiltonian or are terms proportional to @xmath102 , and the terms of order @xmath174 are terms proportional to @xmath103 , @xmath104 and @xmath105 . to demonstrate the procedure ,",
    "we show schematically how to obtain the first corrections @xmath190 , @xmath191 , @xmath192 and @xmath193 .",
    "we then argue that the same formalism can be extended to arbitrary order .",
    "the proof presented here demonstrates that the gyrokinetic variables can be consistently calculated order by order without running into problems .",
    "recently , this has been a controversial issue  @xcite .    to calculate @xmath190 , @xmath191 , @xmath192 and @xmath193",
    ", we need to express the lagrangian ( [ lagr_n ] ) in the new gyrokinetic variables to @xmath194 , giving should be included in @xmath140 ( [ lagr_n1 ] ) .",
    "however , adding the time derivative of @xmath195 eliminates any @xmath196 dependence to this order .",
    "the same can be said about ( [ lagr_ngk ] ) and ( [ lagrangian_gyro_o2_1 ] ) , where the terms @xmath197 and @xmath198 could be added .",
    "it is very easy to show that the algorithm gives , of course , exactly the same results with either choice . ]",
    "@xmath199 \\cdot \\frac{d { \\mathbf{r}}}{dt } \\nonumber \\\\ \\fl & + \\left [ \\epsilon { \\mathbf{a}}({\\mathbf{r } } ) + \\epsilon^2 u { \\hat{\\mathbf{b}}}({\\mathbf{r } } ) \\right ] \\cdot \\frac{d\\tilde{{\\mathbf{r}}}_2}{dt } + \\left [ - \\epsilon \\mu + \\epsilon^2 \\left ( - \\tilde{\\mu}_1 + \\gamma_\\theta^{(1 ) } ( { \\mathbf{r } } , u , \\mu , \\theta ) \\right ) \\right ] \\frac{d \\theta}{dt } - \\epsilon^2 \\mu \\frac{d \\tilde{\\theta}_1}{dt } \\nonumber \\\\ \\fl & - h^{(0 ) } ( { \\mathbf{r } } , u , \\mu ) - \\epsilon \\left [ u \\tilde{u}_1 + \\tilde{\\mu}_1 b({\\mathbf{r } } ) + h^{(1 ) } ( { \\mathbf{r}}_\\bot/\\epsilon , r_{|| } , \\mu , \\theta , t ) \\right ] + o(\\epsilon^2 , \\epsilon^3 ) . \\label{lagr_n1}\\end{aligned}\\ ] ] notice that in the functions @xmath200 , @xmath201 , @xmath202 and @xmath169 the variables @xmath155 , @xmath156 , @xmath157 and @xmath158 are replaced by the gyrokinetic variables @xmath99 , @xmath100 , @xmath101 and @xmath98 .",
    "for example , from the definition of @xmath203 in ( [ ham_ini ] ) , we find @xmath204 the correction @xmath205 to the hamiltonian contains both the correction @xmath206 and the result of taylor expanding @xmath207 around @xmath99 , @xmath100 and @xmath101 , i.e. , @xmath208 in subsection  [ sub_gyro ] we show that the expansion around @xmath99 gives a term that is an order higher and can be ignored to this order .    as indicated in subsection  [ sub_change ]",
    ", we can always add a time derivative to the lagrangian ( [ lagr_n1 ] ) . by doing so",
    ", we will get a form of the lagrangian in which the derivatives of a function @xmath209 enter . by imposing that the lagrangian is of a specific form , we first obtain the corrections @xmath190 , @xmath191 , @xmath192 and @xmath193 as functions of @xmath210 and we then find @xmath210 by integrating a simple differential equation .",
    "we add to the lagrangian ( [ lagr_n1 ] ) the total time derivative @xmath211 , \\label{add_time_derivative}\\ ] ] where we have taken into account that @xmath210 depends on @xmath99 in two different ways : a fast dependence due to the potential that has wavelengths on the order of the gyroradius , and a slow dependence due to the background magnetic field .",
    "notice that adding the time derivative ( [ add_time_derivative ] ) to the lagrangian ( [ lagr_n1 ] ) eliminates all the terms proportional to the time derivatives of the corrections @xmath190 , @xmath191 , @xmath192 and @xmath193 , giving @xmath212 \\cdot \\frac{d{\\mathbf{r}}}{dt } \\nonumber \\\\ \\fl & + \\epsilon^2 \\left ( - { \\hat{\\mathbf{b}}}\\cdot \\tilde{{\\mathbf{r}}}_2 + \\frac{\\partial s^{(2)}_p}{\\partial u } \\right ) \\frac{du}{dt } + \\epsilon^2 \\left ( \\tilde{\\theta}_1 + \\frac{\\partial s^{(2)}_p}{\\partial \\mu } \\right ) \\frac{d\\mu}{dt } \\nonumber \\\\ \\fl & + \\left [ - \\epsilon \\mu + \\epsilon^2 \\left ( - \\tilde{\\mu}_1 + \\gamma_\\theta^{(1 ) } + \\frac{\\partial s^{(2)}_p}{\\partial \\theta } \\right ) \\right ] \\frac{d\\theta}{dt } - h^{(0 ) } \\nonumber \\\\ \\fl & - \\epsilon \\left ( u \\tilde{u}_1 + \\tilde{\\mu}_1 b + h^{(1 ) } \\right ) + o(\\epsilon^2 , \\epsilon^3 ) , \\label{lagr_n1_2}\\end{aligned}\\ ] ] where we have used @xmath213 trivially deduced from the identity @xmath214_{ij } = \\frac{\\partial a_j}{\\partial r_i } - \\frac{\\partial a_i}{\\partial r_j } = \\sum_{k=1}^3\\varepsilon_{ijk}(\\nabla_{\\mathbf{r}}\\times{\\mathbf{a}})_{k}.\\ ] ] here @xmath215 is the levi - civita symbol and the superscript @xmath216 stands for matrix transposition .",
    "notice that in equation ( [ lagr_n1_2 ] ) we have not made explicit the dependence of the functions on the gyrokinetic variables , but it is assumed that all the terms are functions of @xmath99 , @xmath100 , @xmath101 and @xmath98 . by imposing that the lagrangian ( [ lagr_n1_2 ] ) be equal to @xmath217 where @xmath218 , @xmath219 and @xmath220 are gyrophase independent , we obtain the equations @xmath221 , \\label{r2_1}\\ ] ] @xmath222 , \\label{u1_1}\\ ] ] @xmath223 and @xmath224 the corrections @xmath190 , @xmath191 , @xmath192 and @xmath193 can then be found if we obtain @xmath210 .",
    "to do so , we use that @xmath225 first , we take the gyroaverage of this equation to obtain @xmath220 . using the results in equations ( [ u1_1 ] ) and ( [ mu1_1 ] ) ,",
    "the gyroaverage of equation ( [ eq_h1gk ] ) becomes @xmath226 + b({\\mathbf{r } } ) \\left \\langle \\gamma_\\theta^{(1 ) } ( { \\mathbf{r } } , u , \\mu , \\theta ) \\right \\rangle \\nonumber \\\\",
    "+ \\left \\langle h^{(1 ) } ( { \\mathbf{r}}_\\bot/\\epsilon , r_{|| } , \\mu , \\theta , t ) \\right \\rangle , \\label{eq_hbar1gk}\\end{aligned}\\ ] ] where @xmath227 is the gyroaverage holding @xmath99 , @xmath100 , @xmath101 and @xmath43 fixed .",
    "notice that we have been able to obtain @xmath220 without explicitly finding @xmath210 . solving for @xmath210 is easy once @xmath220 is known . combining equations ( [ eq_h1gk ] ) and ( [ eq_hbar1gk ] ) ,",
    "we find @xmath228 \\nonumber \\\\ - \\left [ \\gamma_\\theta^{(1 ) } ( { \\mathbf{r } } , u , \\mu , \\theta ) - \\left \\langle \\gamma_\\theta^{(1 ) } ( { \\mathbf{r } } , u , \\mu , \\theta ) \\right \\rangle \\right ] \\nonumber \\\\ - \\frac{1}{b({\\mathbf{r } } ) } \\left [ h^{(1 ) } ( { \\mathbf{r}}_\\bot/\\epsilon , r_{|| } , \\mu , \\theta , t ) - \\left \\langle h^{(1 ) } ( { \\mathbf{r}}_\\bot/\\epsilon , r_{|| } , \\mu , \\theta , t ) \\right \\rangle \\right ] . \\label{eq_s1gk}\\end{aligned}\\ ] ] it is then straightforward to obtain @xmath210 by integrating in the gyrophase @xmath98 . the specific calculation of the corrections @xmath190 , @xmath191 , @xmath192 , @xmath193 and @xmath220 is done in subsection  [ sub_gyro ] . here",
    "we only want to demonstrate the procedure .",
    "notice that the final solution depends on our choice of @xmath218  and in general on our choice of the final expression for @xmath142 .",
    "however , once the choice is made , @xmath220 is completely determined .",
    "once @xmath190 , @xmath191 , @xmath192 , @xmath193 , @xmath220 and @xmath210 have been determined , we can prove by induction that the procedure gives the corrections to any order .",
    "assume that the corrections @xmath229 , @xmath230 , @xmath231 , @xmath232 and @xmath233 and the functions @xmath234 have been obtained up to @xmath235 in such a way that the lagrangian is of the form @xmath236 \\cdot \\frac{d{\\mathbf{r}}}{dt } - \\epsilon \\mu \\frac{d\\theta}{dt } - \\overline{h}^{(0 ) } - \\sum_{i=1}^{n-1 } \\epsilon^i \\overline{h}^{(i ) } \\nonumber \\\\",
    "+ o(\\epsilon^{n } , \\epsilon^{n+1}).\\end{aligned}\\ ] ] then it is possible to obtain the corrections @xmath184 , @xmath185 , @xmath186 and @xmath187 , the function @xmath237 and the phase - space lagrangian to order @xmath238 . to do so",
    ", the lagrangian is written to @xmath239 .",
    "in general , we can not guess the exact form of the lagrangian to such high order without doing the calculation order by order , but the terms that contain the corrections @xmath184 , @xmath185 , @xmath186 and @xmath187 are very easy to obtain .",
    "we find that @xmath240 \\cdot \\frac{d{\\mathbf{r}}}{dt } \\nonumber \\\\ \\fl & + \\left [ \\epsilon^n { \\mathbf{a}}({\\mathbf{r } } ) + \\epsilon^{n+1 } u { \\hat{\\mathbf{b}}}({\\mathbf{r } } ) \\right ] \\cdot \\frac{d\\tilde{{\\mathbf{r}}}_{n+1}}{dt } + \\epsilon^{n+1 } \\tilde{\\gamma}_u^{(n ) } \\frac{du}{dt}+ \\epsilon^{n+1 } \\tilde{\\gamma}_\\mu^{(n ) } \\frac{d\\mu}{dt } \\nonumber \\\\ \\fl & + \\left [ - \\epsilon \\mu + \\epsilon^{n+1 } \\left ( - \\tilde{\\mu}_n + \\tilde{\\gamma}_\\theta^{(n ) } \\right ) \\right ] \\frac{d\\theta}{dt } - \\epsilon^{n+1 } \\mu \\frac{d\\tilde{\\theta}_n}{dt } - \\overline{h}^{(0 ) } - \\sum_{i=1}^{n-1 } \\epsilon^i \\overline{h}^{(i ) } \\nonumber \\\\ \\fl & - \\epsilon^n \\left [ u \\tilde{u}_n + \\tilde{\\mu}_n b({\\mathbf{r } } ) + \\tilde{h}^{(n ) } \\right ] + o(\\epsilon^{n+1 } , \\epsilon^{n+2 } ) .",
    "\\label{lagr_ngk}\\end{aligned}\\ ] ] here we have just separated the terms of order @xmath188 into those that depend on the corrections @xmath184 , @xmath185 , @xmath186 and @xmath187 , and the rest that we have lumped into the terms @xmath241 , @xmath242 , @xmath243 , @xmath244 and @xmath245 .",
    "the form of the lagrangian ( [ lagr_ngk ] ) is very similar to the lagrangian ( [ lagr_n1 ] ) .",
    "we can then use the same procedure .",
    "we add the time derivative @xmath246\\ ] ] to cancel all the terms that are proportional to the time derivatives of the corrections @xmath184 , @xmath185 , @xmath186 and @xmath187 .",
    "then , by imposing that the lagrangian ( [ lagr_ngk ] ) plus this time derivative be equal to @xmath247 we obtain the equations @xmath248 @xmath249 @xmath250 and @xmath251 the @xmath252-th correction to the hamiltonian becomes @xmath253 and the equation for @xmath237 is @xmath254    in subsections [ sub_drift ] and [ sub_gyro ] we obtain the phase - space lagrangian to @xmath255 .",
    "specifically , in subsection  [ sub_drift ] and [ app_dk ] we derive equation ( [ lagr_ini ] ) . in subsection",
    "[ sub_gyro ] and [ app_gyro_2 ] we use the perturbation procedure explained here to go from equation ( [ lagr_ini ] ) to the final result .",
    "we perform a change of variables @xmath256 defined by @xmath257 and @xmath258 with the gyroradius vector defined as @xmath259.\\ ] ] the unit vectors @xmath260 and @xmath261 are orthogonal to each other and to @xmath14 , and satisfy @xmath262 at every location @xmath39 . physically , @xmath155 is the guiding center position , @xmath156 the velocity parallel to the magnetic field at the guiding center position , @xmath157 the lowest order magnetic moment , and @xmath158 the lowest order gyrophase . for a homogeneous static magnetic field and in the absence of electric field , the change of coordinates defined by ( [ eq : changer ] ) , ( [ eq : changev ] ) and ( [ eq : defrho ] ) exactly eliminates the gyrophase dependence . note in passing that it is a well defined change of coordinates .",
    "these formulae explicitly give @xmath263 as a function of @xmath264 and it is easy to see that the transformation is invertible for small @xmath0 : it is clearly invertible for @xmath265 and the transformation is continuous in @xmath0 .",
    "we substitute the relations @xmath266 , given in ( [ eq : changer ] ) and ( [ eq : changev ] ) , and @xmath267 into the non - dimensionalized lagrangian ( [ lagrange_non ] ) , @xmath268 .",
    "the resulting lagrangian that we denote as @xmath269 differs from the lagrangian @xmath270 in ( [ lagr_ini ] ) and ( [ lagrange_drift_4 ] ) by the time derivative of a function @xmath271 and even though both lagrangians give the same equations of motion , we have decided to stress the difference . the lagrangian @xmath272 is @xmath273 \\cdot \\frac{d}{dt } \\left ( { \\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$}}\\right ) \\nonumber \\\\ - h^{(0 ) } - \\epsilon h^{(1 ) } , \\label{lagrange_drift_1}\\end{aligned}\\ ] ] with @xmath274 defined in ( [ ham_ini ] ) and @xmath275 where @xmath276 is the heaviside step function , with @xmath277 for @xmath278 and @xmath279 for @xmath280 . any magnetic quantity with subindex @xmath281",
    "is evaluated at @xmath155 , e.g. , @xmath282 .",
    "we write @xmath283 when no confusion is possible .",
    "we have defined a new function @xmath284 ( notice the difference in the font between @xmath285 and @xmath24 ) given by @xmath286 then @xmath287 is the gyroaverage of @xmath285 , @xmath288 and @xmath289 the gyrophase dependent piece , @xmath290 we now prove that the notation in ( [ h1 ] ) , @xmath291 is appropriate .",
    "first , we show that @xmath157 is always divided by @xmath292 and that the sign of @xmath81 determines the phase of @xmath158 , and later we demonstrate that if conditions ( [ eq : orderingvarphi_par ] ) and ( [ eq : orderingvarphi_perp ] ) are satisfied , then @xmath293 and @xmath294 are also satisfied . to show that @xmath157 always appears divided by @xmath292 and that we need to add @xmath295 to @xmath158 when @xmath81 is negative , it is enough to realize that @xmath285 depends on @xmath157 and @xmath158 through the dependence of @xmath24 on @xmath296 and that @xmath297 as defined in ( [ eq : defrho ] ) only depends on @xmath157 through the multiplying term @xmath298 .",
    "it is then obvious that @xmath299 . to prove that ( [ eq : orderingvarphi_par ] ) and ( [ eq : orderingvarphi_perp ] )",
    "imply ( [ eq : orderingphi_par ] ) and ( [ eq : orderingphi_perp ] ) , we employ @xmath300 with @xmath301 .",
    "then , using equations ( [ eq : orderingvarphi_par ] ) and ( [ eq : orderingvarphi_perp ] ) , it is easy to see that equations ( [ eq : orderingphi_par ] ) and ( [ eq : orderingphi_perp ] ) are correct .",
    "note that when we write @xmath168 in ( [ h1 ] ) we are emphasizing the dependence on @xmath0 because the asymptotic procedure is based on expanding in @xmath302 .",
    "the dependence on @xmath80 , @xmath81 and @xmath82 is only written explicitly in the function @xmath285 .",
    "we now show how to simplify ( [ lagrange_drift_1 ] ) . employing @xmath303 @xmath304 and @xmath305 we write the lagrangian in ( [ lagrange_drift_1 ] ) as @xmath306 \\cdot \\frac{d { \\mathbf{r}}_g}{dt } + \\frac{1}{2\\mu_g } { \\mathbf{a}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$ } } ) \\cdot { \\mbox{\\boldmath$\\rho$}}\\frac{d\\mu_g}{dt } \\nonumber \\\\ \\fl & + \\left [ { \\mathbf{a}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$ } } ) \\cdot \\frac{\\partial { \\mbox{\\boldmath$\\rho$}}}{\\partial \\theta_g } - 2 \\epsilon \\mu_g \\right ] \\frac{d\\theta_g}{dt } - h^{(0 ) } - \\epsilon h^{(1 ) } .",
    "\\label{lagrange_drift_2}\\end{aligned}\\ ] ] to obtain ( [ gradrho ] ) we have used @xmath307 and @xmath308 . to simplify the lagrangian ( [ lagrange_drift_2 ] ) , we add the time derivative of @xmath309 as a result we find @xmath310 \\cdot \\frac{d { \\mathbf{r}}_g}{dt } \\nonumber \\\\ \\fl & + \\left [ { \\mathbf{a}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$ } } ) \\cdot \\frac{\\partial { \\mbox{\\boldmath$\\rho$}}}{\\partial \\theta_g } - 2 \\epsilon \\mu_g + \\frac{\\partial s_{np}}{\\partial \\theta_g } \\right ] \\frac{d\\theta_g}{dt } - h^{(0 ) } - \\epsilon h^{(1)}. \\label{lagrange_drift_3}\\end{aligned}\\ ] ] in [ app_dk ] we prove that @xmath311 + \\epsilon [ ( { \\mbox{\\boldmath$\\rho$}}^\\prime \\times { \\hat{\\mathbf{b}}}_g ) \\cdot { \\mathbf{b}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$}}^\\prime ) ] \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{b}}}_g \\cdot { \\mbox{\\boldmath$\\rho$}}^\\prime \\nonumber \\\\ \\fl & + \\frac{2\\epsilon \\mu_g^\\prime}{b_g } [ { \\hat{\\mathbf{b}}}_g \\cdot { \\mathbf{b}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$}}^\\prime ) - b_g ] \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{e}}}_{2 g } \\cdot { \\hat{\\mathbf{e}}}_{1 g } \\bigg \\}\\end{aligned}\\ ] ] and @xmath312,\\ ] ] where we use the abbreviated notation @xmath313 . substituting equations ( [ ds_npdr ] ) and ( [ ds_npdtheta ] ) into the lagrangian ( [ lagrange_drift_3 ] ) finally gives @xmath314 with @xmath315 \\nonumber \\\\ \\fl & + [ ( { \\mbox{\\boldmath$\\rho$}}^\\prime \\times { \\hat{\\mathbf{b}}}_g ) \\cdot { \\mathbf{b}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$}}^\\prime ) ] \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{b}}}_g \\cdot { \\mbox{\\boldmath$\\rho$}}^\\prime + \\frac{2 \\mu_g^\\prime}{b_g } [ { \\hat{\\mathbf{b}}}_g \\cdot { \\mathbf{b}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$}}^\\prime ) - b_g ] \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{e}}}_{2 g } \\cdot { \\hat{\\mathbf{e}}}_{1 g } \\bigg \\}\\end{aligned}\\ ] ] and @xmath316.\\ ] ]    it is easy to write the lagrangian ( [ lagrange_drift_4 ] ) order by order",
    ". we use @xmath317 where our double - dot convention is @xmath318 , to obtain @xmath319 where @xmath320 { \\mathbf{b}}_g , \\label{gammar_o1}\\end{aligned}\\ ] ] @xmath321 \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{b}}}_g \\cdot { \\mbox{\\boldmath$\\rho$}}\\nonumber \\\\ - \\frac{2\\mu_g}{3b_g } ( { \\mbox{\\boldmath$\\rho$}}\\cdot \\nabla_{{\\mathbf{r}}_g } b_g ) \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{e}}}_{2 g } \\cdot { \\hat{\\mathbf{e}}}_{1 g } , \\label{gammar_o2}\\end{aligned}\\ ] ] @xmath322 and @xmath323      in this subsection we find a new set of coordinates @xmath324 that makes the lagrangian ( [ lagrangian_drift_5 ] ) gyrophase independent .",
    "we employ the procedure described in subsection  [ sub_procedure ] .",
    "the transformation @xmath325 is customarily written in the form of a lie transform  @xcite , @xmath326 where @xmath327.\\ ] ] instead of this form , we use the form in ( [ newvar ] ) that we find more convenient .",
    "the connection between the two arrangements is trivial .",
    "to first order we find @xmath328 to second order , the relation is @xmath329 @xmath330 @xmath331 and @xmath332    in subsection [ ss_gyro_1 ] , the corrections @xmath333 , @xmath334 , @xmath335 and @xmath336 are calculated following the procedure in subsection  [ sub_procedure ] , and the lagrangian is obtained to @xmath194 . in subsection [ ss_gyro_2 ] the lagrangian",
    "is obtained to next order .",
    "it is possible to do so without explicitly obtaining @xmath337 , @xmath338 , @xmath339 and @xmath340 .",
    "we obtain the first - order gyrokinetic correction to the hamiltonian , @xmath220 , by employing equation ( [ eq_hbar1gk ] ) .",
    "we need to know that @xmath341 , @xmath342 and @xmath343 where we have used that @xmath344 with @xmath345 the unit matrix . for the remainder of the section , whenever we do not write explicitly the arguments of the functions , it will be understood that they are evaluated at @xmath346 , i.e. @xmath347 , @xmath348 , and so on . substituting the values of @xmath349 , @xmath350 and @xmath351 into equation ( [ eq_hbar1gk ] ) , we find @xmath352 notice that we have the freedom to choose @xmath218 as we wish",
    ". our choice will affect the corrections @xmath333 and @xmath334 , and the final form of @xmath220 . to coincide with previous derivations in the literature  @xcite , we choose @xmath353 giving @xmath354 in equation ( [ gammarbar1_final ] ) ,",
    "we have chosen @xmath355 instead of @xmath356 to manifestly show that the equations of motion are independent of the choice of @xmath357 and @xmath358 @xcite .",
    "the function @xmath210 can be obtained by solving equation ( [ eq_s1gk ] ) .",
    "substituting equations ( [ h1 ] ) , ( [ gammar_o1 ] ) and ( [ gammatheta_o1 ] ) into ( [ eq_s1gk ] ) gives @xmath359 : \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b}}}- \\frac{2\\mu}{3b } { \\mbox{\\boldmath$\\rho$}}\\cdot \\nabla_{\\mathbf{r}}b - \\frac{\\lambda { \\widetilde{\\phi}}}{b } , \\label{ds2dtheta}\\end{aligned}\\ ] ] where we have used that @xmath360.\\ ] ] integrating equation ( [ ds2dtheta ] ) in the gyrophase gives @xmath361 : \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b}}}\\nonumber \\\\ - \\frac{2\\mu}{3b } ( { \\mbox{\\boldmath$\\rho$}}\\times { \\hat{\\mathbf{b } } } ) \\cdot \\nabla_{\\mathbf{r}}b   - \\frac{\\lambda { \\widetilde{\\phi}}}{b } , \\label{s2}\\end{aligned}\\ ] ] where the function @xmath362 is the integral @xmath363 such that @xmath364 .",
    "here we have used that @xmath365 and @xmath366/\\partial \\theta$ ] .    using @xmath210 in the expressions ( [ r2_1 ] ) , ( [ u1_1 ] ) , ( [ mu1_1 ] ) and ( [ theta1_1 ] ) , the first order corrections to the gyrokinetic variables",
    "become @xmath367 : \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b}}}- \\frac{u}{b } { \\hat{\\mathbf{b}}}\\times \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b}}}\\cdot { \\mbox{\\boldmath$\\rho$}}\\nonumber \\\\ - \\frac{1}{2b } { \\mbox{\\boldmath$\\rho$}}{\\mbox{\\boldmath$\\rho$}}\\cdot \\nabla_{\\mathbf{r}}b - \\frac{\\lambda}{\\lambda b^2 } { \\hat{\\mathbf{b}}}\\times \\nabla_{({\\mathbf{r}}_\\bot/\\lambda \\epsilon ) } { \\widetilde{\\phi } } , \\label{r2}\\end{aligned}\\ ] ] @xmath368 : \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b } } } , \\label{u1}\\ ] ] @xmath369 : \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b}}}- \\frac{\\lambda { \\widetilde{\\phi}}}{b } \\label{mu1}\\ ] ] and @xmath370 : \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b}}}\\nonumber \\\\ + \\frac{1}{b } ( { \\mbox{\\boldmath$\\rho$}}\\times { \\hat{\\mathbf{b } } } ) \\cdot \\nabla_{\\mathbf{r}}b + \\frac{\\lambda}{\\lambda^2 b } \\frac{\\partial { \\widetilde{\\phi}}}{\\partial ( \\mu/\\lambda^2)}. \\label{theta1}\\end{aligned}\\ ] ] in [ app_comp ] we show that this result is equivalent to the result obtained with the iterative method in @xcite .      in this subsection",
    "we apply the change of variables ( [ newvar ] ) to the lagrangian ( [ lagrangian_drift_5 ] ) to @xmath371 .",
    "the idea is to write an expression similar to ( [ lagr_ngk ] ) with @xmath372 so that we can use the technique demonstrated in subsection  [ sub_procedure ] .    to @xmath255 ,",
    "the lagrangian ( [ lagrangian_drift_5 ] ) becomes @xmath373 \\cdot \\frac{d{\\mathbf{r}}}{dt } \\nonumber \\\\ \\fl & + \\bigg [ \\epsilon { \\mathbf{a}}+ \\epsilon^2 u { \\hat{\\mathbf{b}}}+ \\epsilon^3 \\left ( { \\mbox{\\boldmath$\\gamma$}}_{\\mathbf{r}}^{(1 ) } + { \\mathbf{r}}_2 \\cdot \\nabla_{\\mathbf{r}}{\\mathbf{a}}+ u_1 { \\hat{\\mathbf{b}}}\\right ) \\bigg ] \\cdot \\frac{d{\\mathbf{r}}_2}{dt } + \\bigg ( \\epsilon^2 { \\mathbf{a}}+ \\epsilon^3 u { \\hat{\\mathbf{b}}}\\bigg ) \\cdot \\frac{d\\tilde{{\\mathbf{r}}}_3}{dt } \\nonumber \\\\ \\fl & + \\bigg [ - \\epsilon \\mu + \\epsilon^2 \\left ( - \\mu_1 + \\gamma_\\theta^{(1 ) } \\right ) + \\epsilon^3 \\bigg ( - \\tilde{\\mu}_2 + \\gamma_\\theta^{(2 ) } + \\mu_1 \\frac{\\partial \\gamma_\\theta^{(1)}}{\\partial \\mu } + \\theta_1 \\frac{\\partial \\gamma_\\theta^{(1)}}{\\partial \\theta } \\bigg ) \\bigg ] \\frac{d\\theta}{dt } \\nonumber \\\\ \\fl & + \\bigg [ - \\epsilon^2 \\mu + \\epsilon^3 \\left ( - \\mu_1 + \\gamma_\\theta^{(1 ) } \\right ) \\bigg ] \\frac{d\\theta_1}{dt } - \\epsilon^3 \\mu \\frac{d\\tilde{\\theta}_2}{dt } - h^{(0 ) } - \\epsilon \\left ( u u_1 + \\mu_1 b + h^{(1 ) } \\right ) \\nonumber \\\\ \\fl & - \\epsilon^2 \\bigg ( u \\tilde{u}_2 + \\frac{u_1 ^ 2}{2 } + \\tilde{\\mu}_2 b + \\mu { \\mathbf{r}}_2 \\cdot \\nabla_{\\mathbf{r}}b + { \\mathbf{r}}_2 \\cdot \\nabla_{({\\mathbf{r}}_\\bot/\\epsilon ) } h^{(1 ) } + \\mu_1 \\frac{\\partial h^{(1)}}{\\partial \\mu } + \\theta_1 \\frac{\\partial h^{(1)}}{\\partial \\theta } \\bigg ) \\nonumber \\\\ \\fl & + o(\\epsilon^3 , \\epsilon^4 ) , \\label{lagrangian_gyro_o2_1}\\end{aligned}\\ ] ] where we have used that @xmath374 , that @xmath375 and that @xmath376 and @xmath377 only depend slowly on @xmath99 .",
    "we have seen in subsection [ sub_procedure ] that to first order we need to add to the lagrangian ( [ lagrangian_gyro_o2_1 ] ) the time derivative @xmath378 giving as a result the lagrangian @xmath379 \\cdot \\frac{d{\\mathbf{r}}}{dt } + \\left ( \\epsilon^2 { \\mathbf{a}}+ \\epsilon^3 u { \\hat{\\mathbf{b}}}\\right ) \\cdot \\frac{d\\tilde{{\\mathbf{r}}}_3}{dt } \\nonumber \\\\ \\fl & + \\epsilon^3 \\tilde{\\gamma}_u^{(2 ) } \\frac{du}{dt } + \\epsilon^3 \\tilde{\\gamma}_\\mu^{(2 ) } \\frac{d\\mu}{dt } + \\left [ - \\epsilon \\mu + \\epsilon^3 \\left ( - \\tilde{\\mu}_2 + \\tilde{\\gamma}_\\theta^{(2 ) } \\right ) \\right ] \\frac{d\\theta}{dt } - \\epsilon^3 \\mu \\frac{d\\tilde{\\theta}_2}{dt } - \\overline{h}^{(0 ) } - \\epsilon \\overline{h}^{(1 ) } \\nonumber \\\\ \\fl & - \\epsilon^2 \\left [ u \\tilde{u}_2 + \\tilde{\\mu}_2 b + \\tilde{h}^{(2 ) } \\right ] + o(\\epsilon^3 , \\epsilon^4 ) , \\label{lagrangian_gyro_o2_2}\\end{aligned}\\ ] ] with @xmath380 @xmath381 @xmath382 @xmath383 and @xmath384 notice that in equation ( [ gammat_r_o2 ] ) we are using @xmath385 and we have taken into account that @xmath210 depends on @xmath99 in two different ways .",
    "on the one hand , there is the dependence on @xmath386 , that was the only dependence that was taken into account in subsection  [ ss_gyro_1 ] .",
    "this dependence gives the strong gradient @xmath387 . on the other hand",
    "there is a slow dependence on @xmath99 that gives the gradient @xmath388 + \\frac{\\lambda { \\widetilde{\\phi}}}{b^2 } \\nabla_{\\mathbf{r}}b - \\frac{\\lambda}{b } { \\hat{\\mathbf{b}}}{\\hat{\\mathbf{b}}}\\cdot \\nabla_{\\mathbf{r}}\\tilde\\phi . \\label{nablas2_slow}\\end{aligned}\\ ] ]    in subsection  [ sub_procedure ] we showed that by adding the total time derivative @xmath389 to the lagrangian ( [ lagrangian_gyro_o2_2 ] ) and making the result equal to @xmath390 \\cdot \\frac{d{\\mathbf{r}}}{dt } - \\epsilon \\mu \\frac{d\\theta}{dt } - \\overline{h}^{(0 ) } - \\epsilon \\overline{h}^{(1 ) } - \\epsilon^2 \\overline{h}^{(2 ) } + o(\\epsilon^3 , \\epsilon^4),\\ ] ] where we have explicitly set @xmath391 , we obtain the equations for the corrections @xmath392",
    "@xmath393 @xmath394 and @xmath395 the correction to the hamiltonian is @xmath396 and the equation for @xmath397 is @xmath398 in this article we do not solve for @xmath397 and hence we are not able to write explicitly the corrections @xmath337 , @xmath338 , @xmath339 and @xmath340 .",
    "we only obtain explicitly the correction @xmath399 . in [ app_gyro_2 ]",
    "we evaluate equation ( [ hbar2_1 ] ) in detail .",
    "the final result is @xmath400 with @xmath401 @xmath402 \\cdot \\nabla_{\\mathbf{r}}b \\right \\rangle - \\frac{1}{b } \\nabla_{\\mathbf{r}}b \\cdot \\langle { \\widetilde{\\phi}}\\ , { \\mbox{\\boldmath$\\rho$}}\\rangle \\nonumber \\\\ \\fl &   - \\frac{u^2}{\\lambda^2 b } { \\hat{\\mathbf{b}}}\\cdot \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b}}}\\cdot \\left \\langle \\frac{\\partial { \\widetilde{\\phi}}}{\\partial ( \\mu/\\lambda^2)}\\ , { \\mbox{\\boldmath$\\rho$}}\\right \\rangle - \\frac{u^2}{2 \\mu b } { \\hat{\\mathbf{b}}}\\cdot \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b}}}\\cdot \\langle { \\widetilde{\\phi}}\\ , { \\mbox{\\boldmath$\\rho$}}\\rangle \\nonumber\\\\ \\fl & + \\frac{u}{4 \\lambda^2 } \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b } } } : \\left \\langle \\frac{\\partial { \\widetilde{\\phi}}}{\\partial ( \\mu/\\lambda^2)}\\ , \\left [ { \\mbox{\\boldmath$\\rho$ } } ( { \\mbox{\\boldmath$\\rho$}}\\times { \\hat{\\mathbf{b } } } ) + ( { \\mbox{\\boldmath$\\rho$}}\\times { \\hat{\\mathbf{b } } } ) { \\mbox{\\boldmath$\\rho$}}\\right ] \\right \\rangle \\nonumber \\\\ \\fl & + \\frac{u}{4 \\mu } \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b } } } : \\left \\langle { \\widetilde{\\phi}}\\ , \\left [ { \\mbox{\\boldmath$\\rho$ } } ( { \\mbox{\\boldmath$\\rho$}}\\times { \\hat{\\mathbf{b } } } ) + ( { \\mbox{\\boldmath$\\rho$}}\\times { \\hat{\\mathbf{b } } } ) { \\mbox{\\boldmath$\\rho$}}\\right ] \\right \\rangle \\label{psi2_phib}\\end{aligned}\\ ] ] and @xmath403 where @xmath404 is the transpose of the matrix @xmath405 . the final phase - space lagrangian is given then by ( [ eq : lagrangiangyroorderepsilon2 ] ) .",
    "we can write it explicitly as @xmath406 \\cdot \\frac{d{\\mathbf{r}}}{dt } - \\epsilon \\mu \\frac{d\\theta}{dt } - \\overline{h}+ o(\\epsilon^3 , \\epsilon^4),\\ ] ] where @xmath407 and @xmath408 in previous work @xcite , only the contribution @xmath409 was kept because the terms that contained the function @xmath285 were assumed to be larger . with the more natural ordering ( [ orderings ] ) , we find the new contributions @xmath410 and @xmath411 , demonstrating that magnetic geometry and electrostatic potential appear together and can not be separated . in sections  [ sec :",
    "gyroeqsmotion ] , [ sec : gyropoissoneq ] and [ sec : fieldtheory ] we show that @xmath410 and @xmath411 modify both the equations of motion and poisson s equation .",
    "we end this section pointing out that we chose the final form of the lagrangian ( [ finall ] ) , with @xmath412 , to have the same poisson brackets as previous authors @xcite .",
    "there are other possible choices , e.g. , making the second order correction of the hamiltonian independent of the parallel velocity , condition that can be achieved by defining the appropriate @xmath413 .",
    "the equations of motion are given by ( [ ddt_poibra ] ) . to obtain them explicitly",
    "we need to find the poisson bracket ( [ poi_bra ] ) that corresponds to the lagrangian ( [ finall ] ) . employing [ app : poissonbrackets ] we find the poisson bracket to be @xmath414 where @xmath415 @xmath416 and @xmath417    employing the poisson bracket in ( [ eq : poissonbracket ] ) and the hamiltonian in ( [ finalh ] ) ,",
    "we find @xmath418 @xmath419 \\cdot \\bigg ( \\frac{\\lambda \\epsilon}{\\lambda } \\nabla_{({\\mathbf{r}}_\\bot/\\lambda \\epsilon ) } { \\langle \\phi \\rangle}\\nonumber \\\\ \\fl & + \\frac{\\lambda^2 \\epsilon^2}{\\lambda } \\nabla_{({\\mathbf{r}}_\\bot/\\lambda \\epsilon ) } \\psi^{(2)}_\\phi + \\frac{\\lambda \\epsilon^2}{\\lambda } \\nabla_{({\\mathbf{r}}_\\bot/\\lambda \\epsilon ) } \\psi^{(2)}_{\\phi b } + \\lambda^2 \\epsilon^3 \\nabla_{\\mathbf{r}}\\psi^{(2)}_\\phi + \\lambda \\epsilon^3 \\nabla_{\\mathbf{r}}\\psi^{(2)}_{\\phi b } \\nonumber \\\\ \\fl & + \\epsilon^3 \\nabla_{\\mathbf{r}}\\psi^{(2)}_b \\bigg ) , \\end{aligned}\\ ] ] @xmath420 and @xmath421 note that we have emphasized the fact that the dependence of the functions @xmath287 , @xmath422 and @xmath410 on @xmath99 and @xmath101 ( recall equation ( [ finalh ] ) ) can be fast or slow .",
    "for this reason we distinguish between derivatives with respect to the argument @xmath423 and derivatives with respect to the argument @xmath99 , and between derivatives with respect to the argument @xmath101 and derivatives with respect to the argument @xmath424 .    the new correction to the hamiltonian @xmath410",
    "gives a contribution of order @xmath1 to the perpendicular and parallel motion of the gyrocenter , comparable to the contribution from @xmath409 , the term that is usually kept .",
    "the correction to the hamiltonian @xmath411 gives a negligible contribution to the perpendicular drift , but is needed for the parallel motion .",
    "thus , both corrections must be kept to obtain the equations of motion to order @xmath1 .",
    "it is worth mentioning that equation ( [ drdt ] ) contains the baos drift @xcite in the definition of @xmath100 . to make it clear , instead of choosing the first order lagrangian as in ( [ lagr_n1_2_final ] ) with @xmath425 given in ( [ gammarbar1_final ] ) , we can choose it to have @xmath426 this choice gives a different parallel velocity @xmath427 and a different first order hamiltonian @xmath428 . with this new choice ,",
    "the equation for @xmath429 to first order is @xmath430 note that the baos drift has been made explicit . from here on , we work only with our equations of motion ( [ drdt ] ) , ( [ dudt ] ) , ( [ dmudt ] ) and ( [ dthetadt ] ) that are equivalent to the equations obtained with this alternative choice that makes the baos drift manifest .",
    "the gyrokinetic vlasov equation is readily written for the phase - space distribution @xmath431 in gyrokinetic coordinates , giving @xmath432 or employing the poisson bracket , @xmath433 in the absence of collisions and making use of the fact that @xmath434 , @xmath435 and @xmath436 are independent of gyrophase , the gyrophase independent piece of the distribution function @xmath437 and the gyrophase dependent piece @xmath438 are determined by two decoupled equations  @xcite , namely , @xmath439 and @xmath440 since @xmath441 , it is usually assumed that any dependence on the gyrophase disappears in a very short time and @xmath442 can be neglected . as a result",
    ", we assume that @xmath443 . by zeroing the gyrophase - dependent piece of the distribution function we are eliminating the gyrofrequency time scales , a crucial step to obtain the gyrokinetic equation . in the presence of collisions it is possible to estimate the size of @xmath442 and argue that it is small @xcite .",
    "it is possible to write the gyrokinetic equation in conservative form .",
    "indeed , the equations of motion obtained from a phase - space lagrangian conserve phase - space volume .",
    "therefore , the determinant of the jacobian matrix of the gyrokinetic transformation , @xmath444 , found in [ app : jacobians ] to be @xmath445 , satisfies the condition @xmath446 for completeness , we prove this equation in [ app_consps ] . since @xmath436 and @xmath447 do not depend on @xmath98 , this equation reduces to @xmath448 using this expression and equation ( [ vlasov_ave ] ) , and taking into account that our choice of lagrangian ( [ finall ] ) implies that @xmath449 , we find the vlasov equation in conservative form , i.e. , @xmath450",
    "in sections  [ sect_theory ] and [ sec : gyroeqsmotion ] we have obtained the gyrokinetic equations of motion and the gyrokinetic vlasov equation keeping the electrostatic potential as an unspecified function .",
    "the system of equations of electrostatic gyrokinetic theory is closed by coupling the gyrokinetic vlasov equation to poisson s equation , which is the subject of study of this section .",
    "first , in subsection  [ normalization_poissoneq ] we present the normalization that we employ for poisson s equation . since several species enter in poisson s equation , the normalization given in section  [ sect_order ] must be modified . with this new normalization",
    ", we obtain the gyrokinetic poisson s equation in subsection  [ sec : gyropoissonchangevar ] by simply changing from the coordinates @xmath39 and @xmath40 to their gyrokinetic counterparts @xmath99 , @xmath100 , @xmath101 and @xmath98 . in section  [ sec : fieldtheory ] we provide another way of obtaining poisson s equation that is based on field theory .",
    "poisson s equation in gaussian units reads @xmath451,\\end{aligned}\\ ] ] where @xmath452 is the particle distribution of the dominant ions , @xmath453 and @xmath454 are the charge and the distribution function of the impurity @xmath455 , and @xmath456 is the distribution function of the electrons . using the species - independent normalization @xmath457 for time , space , vector potential and electrostatic potential , and the species - dependent normalization @xmath458 for the velocities and the distribution functions , we get @xmath459 here",
    ", @xmath460 is a characteristic equilibrium value for the electron density and @xmath461 is the electron debye length .",
    "recall that @xmath74 .",
    "this new normalization is somewhat different from the normalization in section  [ sect_order ] .",
    "we have that @xmath462 , @xmath463 , @xmath464 and @xmath465 ( the subindex @xmath466 can take the value @xmath467 , @xmath12 , and any of the values of @xmath455 ) , but the normalization for the time is different , giving @xmath468 . the gyrokinetic variables obtained in the previous sections can be employed here without further changes because both the normalization used in section  [ sect_order ] and the normalization in equations ( [ norm_spindep ] ) and ( [ norm_spdep ] ) give the same normalization for @xmath469 , @xmath470 , @xmath471 and @xmath472 .",
    "this normalization is species - dependent and for this reason we use the subscripts @xmath473 to distinguish the gyrokinetic variables for ions , impurities and electrons . in the results of sections  [ sect_order ] and [ sect_theory ] ,",
    "the constants @xmath0 , @xmath80 , @xmath81 and @xmath82 depend on the species , and it will be useful to use subscripts for them as well . their values for ions , the impurity species @xmath455 and electrons",
    "are given in table  [ table_lambdas ] .",
    "note the sign in the definition of @xmath474 and @xmath475 . in table",
    "[ table_lambdas ] , @xmath476 and @xmath477 are the characteristic temperatures of the ion species and the impurity species @xmath455 , respectively , and @xmath478 is the mass of the impurity species @xmath455 .",
    "the function @xmath285 in ( [ defphi ] ) is now species - dependent and given by @xmath479 later on we will use the the more compact notation @xmath480    [ table_lambdas ]    l l l ions & impurity @xmath455 & electrons + @xmath481 & @xmath482 & @xmath483 + @xmath484 & @xmath485 & @xmath486 + @xmath487 & @xmath488 & @xmath489 + @xmath490 & @xmath491 & @xmath492 +    to write the total lagrangian of the system , it is necessary to normalize all the particle lagrangians and hamiltonians by the same quantity .",
    "we choose that the normalized lagrangian and hamiltonian be @xmath493 and @xmath494 .",
    "the gyrokinetic lagrangian ( [ finall ] ) , dependent on the species , becomes in the new normalization @xmath495 \\cdot \\frac{d\\underline{{\\mathbf{r}}_p}}{d\\underline{t } } - \\frac{t_{p0 } \\epsilon_s}{t_{e0 } \\lambda_p \\tau_p } \\underline{\\mu_p } \\frac{d\\underline{\\theta_p}}{d\\underline{t } } - \\underline{\\overline{h}_p}\\ ] ] where @xmath496 + \\frac{t_{p0 } \\epsilon_s^2}{t_{e0 } \\lambda_p^2 } \\psi^{(2)}_b ( \\underline{{\\mathbf{r}}_p } , \\underline{u_p } , \\underline{\\mu_p } ) + z_p \\epsilon_s \\langle \\underline{\\phi } \\rangle ( \\underline{{\\mathbf{r}}_{p\\bot}}/\\epsilon_s , \\underline{r_{p|| } } , \\underline{\\mu_p}/\\lambda_p^2 , \\underline{t } ) \\nonumber \\\\ \\fl + \\frac{z_p \\lambda_p \\epsilon_s^2}{\\lambda_p } \\psi^{(2)}_\\phi ( \\underline{{\\mathbf{r}}_{p\\bot}}/\\epsilon_s , \\underline{{\\mathbf{r}}_p } , \\underline{\\mu_p}/\\lambda_p^2 , \\underline{t } , \\lambda_p ) + \\frac{z_p \\epsilon_s^2}{\\lambda_p } \\psi^{(2)}_{\\phi b } ( \\underline{{\\mathbf{r}}_{p\\bot}}/\\epsilon_s , \\underline{{\\mathbf{r}}_p } , \\underline{u_p } , \\underline{\\mu_p } , \\underline{\\mu_p}/\\lambda_p^2 , \\underline{t } , \\lambda_p)\\end{aligned}\\ ] ] and @xmath497 here , obviously , @xmath498 and @xmath499 .",
    "analogously to ( [ eq : phip ] ) we define @xmath500 and @xmath501    the equations of motion are those obtained in ( [ drdt ] ) , ( [ dudt ] ) , ( [ dmudt ] ) and ( [ dthetadt ] ) multiplied by @xmath502 . as a result ,",
    "the vlasov equation for each species is @xmath503 in what follows we work in non - dimensional variables but do not underline them .",
    "our objective is to write poisson s equation ( [ eq : poissonnondim ] ) in terms of @xmath504 , i.e. the solution of equation ( [ eq : vlasovbar ] ) .",
    "since depends on the species through the values of @xmath505 , @xmath506 and @xmath507 and denote it by @xmath508 . ]",
    "@xmath509 , @xmath510 using the obvious identity @xmath511 and the change of variables formula we can write poisson s equation as @xmath512 where @xmath513 is the jacobian matrix of the transformation @xmath508 , calculated in [ app : jacobians ] , and @xmath514 is the projection onto the spatial part of the coordinates @xmath515 . from an abstract viewpoint",
    "this is , perhaps , the simplest way of writing ( [ eq : poissonnondim ] ) in terms of @xmath516 .",
    "observe that ( [ eq : poissonpullback2 ] ) is an exact relation .",
    "however , in practical terms , we have only computed the explicit expression of @xmath508 up to a certain order in @xmath505 , or equivalently , in the species - independent parameter @xmath96 .",
    "making use of the results of this paper we can give an explicit expression for the change of variables up to order @xmath517 , namely @xmath518 + o(\\epsilon_s^3),\\end{aligned}\\ ] ] which allows us to write the identity @xmath519 where @xmath520 denotes the gradient of the dirac delta function with respect to its natural arguments and the subscript @xmath473 in the corrections @xmath521 , @xmath522 and @xmath523 indicates that these corrections depend on the species through @xmath506 , @xmath507 and @xmath524 in ( [ eq : phip ] ) . substituting ( [ eq : transdelta ] ) into ( [ eq : poissonpullback2 ] ) finally gives @xmath525 + \\dots\\end{aligned}\\ ] ] here we have used [ app : jacobians ] to write @xmath526 .",
    "we employ the subscripts @xmath473 in the determinant of the jacobian @xmath527 because it depends on the species through its dependence on @xmath528 . expression ( [ eq : poissonpullbackfinal ] ) may seem accurate to order @xmath517 , i.e. , that on the right side of ( [ eq : poissonpullbackfinal ] ) we are dropping only terms which are of order @xmath529 or higher .",
    "however , it is easy to see that this is not true . using @xmath530 @xmath531\\ ] ] and @xmath532,\\ ] ] and integrating by parts so that the delta function does not appear differentiated",
    ", we find that ( [ eq : poissonpullbackfinal ] ) becomes @xmath533 \\bigg \\ } + o(\\epsilon_s^2).\\end{aligned}\\ ] ] note that terms that seemed to be of second order in @xmath96 are in reality first order contributions .",
    "similarly , terms that seem to be of third order and are neglected in ( [ eq : poissonpullbackfinal ] ) are in reality of second order . to obtain a gyrokinetic poisson s equation",
    "correct to order @xmath517 it is necessary to carry ( [ eq : r_asfunctionofgyrokincoor ] ) to an order higher @xmath534 all the terms entering this equation are computable from the results found in section  [ sect_theory ] .",
    "we leave this for future work .    by integrating over the delta function in ( [ eq : gkpoisson_v1 ] )",
    "we make the gyrokinetic poisson s equation more explicit , @xmath535 \\bigg \\}_{{\\mathbf{r}}_p = \\widehat{{\\mathbf{r } } } ( { \\mathbf{r } } , \\mu_p , \\theta_p , \\epsilon_s/\\lambda_p ) } + o(\\epsilon_s^2),\\end{aligned}\\ ] ] where @xmath536 is the the function defined by solving for @xmath469 the equation @xmath537 .",
    "finally , we would like to point out that usually equation ( [ eq : gkpoisson ] ) can be simplified even more .",
    "the following discussion is not meant to be an exhaustive review of all possible orderings and simplifications , but a brief comment on the most typical approach .",
    "usually @xmath538 has contributions with different characteristic scales of variation , ranging from the shortest scale @xmath539 to the background profile variation scale @xmath6 . at the same time",
    "@xmath540 because the saturation amplitude of the short scale fluctuation @xmath541 is sufficiently small , i.e. , @xmath542 , where @xmath543 is a function of order unity with derivatives with respect to its arguments of order unity . for @xmath540",
    ", we can use the approximate expression @xmath544 because @xmath545 .",
    "in addition , the term containing @xmath546 in ( [ eq : gkpoisson ] ) becomes of next order because @xmath547 . to simplify even more , we use @xmath548 . as a result , @xmath549 \\bigg \\}_{{\\mathbf{r}}_p = { \\mathbf{r}}- ( \\epsilon_s/\\lambda_p ) { \\mbox{\\scriptsize\\boldmath$\\rho$}}({\\mathbf{r } } , \\mu_p , \\theta_p ) } + o(\\epsilon_s^2).\\end{aligned}\\ ] ] this is the simplest poisson s equation correct to first order in @xmath96 . as we have already pointed out , it is necessary to include the corrections @xmath550 , @xmath551 and @xmath552 to find the contributions of order @xmath517 .",
    "we finish by checking that the assumption @xmath540 is consistent with the gyrokinetic system of equations .",
    "consider the short scale pieces of the vlasov equation ( [ eq : vlasovbar ] ) and of the gyrokinetic poisson s equation ( [ eq : gkpoissonsimple ] ) .",
    "the result will be a typical @xmath34 formulation @xcite , demonstrating that it is possible to find a closed non - linear system of equations to determine the short scale fluctuations @xmath543 and @xmath24 .",
    "this does not mean that @xmath34 formulations are always valid , but it indicates that the assumption @xmath540 is consistent with the gyrokinetic system of equations .",
    "gyrokinetic field theory is the formulation of gyrokinetics as a classical field theory and is defined by an action functional @xmath553 that depends on the trajectories of the particles and the electromagnetic field .",
    "a closed system of equations coupling the electromagnetic field and the gyrokinetic distribution function is obtained by finding the stationary points of @xmath553 .",
    "the first application of field theory to plasma physics is the work by low in @xcite that was later extended to gyrokinetic theory in the seminal papers by sugama @xcite and brizard @xcite .",
    "the development of gyrokinetic field theory in the last decade has been motivated mostly by the fact that it allows to identify in a systematic way conservation laws from symmetries of the lagrangian . for the sake of completeness we briefly recast now our results in field theory language following the lagrangian formulation of sugama  @xcite .    in subsection  [ sub : variational ]",
    "we show how to obtain the gyrokinetic equations of motion and the gyrokinetic poisson s equation from a variational principle .",
    "the advantage of this procedure is that it ensures that an energy - like invariant is conserved .",
    "we obtain the invariant and prove that it is conserved in subsection  [ sub : noethers ] .      using the abbreviated notation @xmath554 ,",
    "the action functional is @xmath555 = \\frac{\\lambda_{de}^2\\epsilon_s^2}{2l^2 } \\int_{t_0}^{t_1 } dt \\int d^3 r \\,|\\nabla\\varphi({\\mathbf{r}},t)|^2 \\nonumber \\\\ \\fl & + \\sum_p \\int_{t_0}^{t_1 } dt \\int d^6 z_{p0 } \\ , b_{|| , p}^ * ( { \\mathbf{z}}_{p0 } ) f_{p0}({\\mathbf{z}}_{p0 } ) \\ , \\overline{\\mathcal{l}}_p \\big({\\mathbf{z}}_p({\\mathbf{z}}_{p0},t_0;t ) , \\dot{\\mathbf{z}}_p({\\mathbf{z}}_{p0},t_0;t ) , \\varphi(\\bullet , t)\\big),\\end{aligned}\\ ] ] where @xmath556 is the distribution function of species @xmath466 at time @xmath557 , and @xmath558 is the trajectory in phase - space of a particle of species @xmath466 satisfying the initial condition @xmath559 at @xmath560 .",
    "the first term on the right side of ( [ eq : actionfieldtheory ] ) is the action for the electric field ( recall that we are considering a static magnetic field ) and the second term is the sum of the actions of the particles .",
    "the gyrokinetic lagrangian @xmath561 of the species @xmath466 is defined in ( [ eq : lnewnorm ] ) ( recall that we have dropped the underlining for normalized variables ) .",
    "its third argument stresses that @xmath562 depends as a functional on the electrostatic potential .",
    "the euler - lagrange equations for @xmath553 are obtained by finding its stationary points under infinitesimal variations of the maps @xmath558 and @xmath563 .",
    "the allowed infinitesimal perturbations to @xmath563 vanish at the boundary of the spatial domain of interest , and the perturbations to both @xmath558 and @xmath563 must be zero at @xmath560 and @xmath564 .",
    "the calculation of the variation with respect to @xmath558 gives the gyrokinetic equations of motion and is a repetition of that leading to equations ( [ drdt ] ) , ( [ dudt ] ) , ( [ dmudt ] ) and ( [ dthetadt ] ) ( recall the discussion on the phase - space lagrangian methodology in subsection  [ sub_change ] ) .",
    "the distribution function at time @xmath43 is @xmath565 where @xmath566 is the inverse of the map @xmath567 , i.e. , @xmath568 . note that @xmath538 automatically satisfies ( [ eq : vlasovbar ] ) .",
    "observe also that from condition ( [ consps ] ) , which is automatically satisfied by ( [ drdt ] ) , ( [ dudt ] ) , ( [ dmudt ] ) and ( [ dthetadt ] ) , we obtain @xmath569 where @xmath570 is the jacobian matrix of the map @xmath567 , and @xmath571 is its determinant .",
    "this property is proven in [ app : psconserv ] for completeness .",
    "the stationary points of @xmath553 under variations of @xmath563 are given by @xmath572 , with @xmath573 in [ app : poissonvariationalprinciple ] we have evaluated all the terms . the final result is @xmath574 where @xmath575 \\bigg \\}.\\end{aligned}\\ ] ] by imposing that @xmath576 for any @xmath577 , we find that @xmath578 .",
    "this is poisson s equation . by integrating by parts to leave the delta function undifferentiated , and then integrating over the delta function , we recover ( [ eq : gkpoisson ] ) .",
    "note that even though the hamiltonian is obtained to second order in @xmath96 , and hence the vlasov equation is also known to second order , the gyrokinetic poisson s equation that we have found using the variational principle is only correct to first order in @xmath96 .",
    "it coincides to first order with the first order equation that we found independently in subsection  [ sec : gyropoissonchangevar ] .",
    "observe that equation ( [ eq : gyrokinpoissonfieldtheory ] ) keeps some second order terms that could have been neglected , as done in ( [ eq : gkpoissonsimple ] ) .",
    "these terms are important if we want to take advantage of the field theory formulation of gyrokinetics .",
    "the action ( [ eq : actionfieldtheory ] ) is invariant under time translations , so noether s theorem automatically provides a conserved quantity , interpreted as the total energy of the system , which we denote by @xmath579 because it is indeed the field theory hamiltonian .",
    "however , @xmath580 _ on the equations of motion of _ @xmath553 , that is , on solutions of ( [ drdt ] ) , ( [ dudt ] ) , ( [ dmudt ] ) , ( [ dthetadt ] ) and ( [ eq : gyrokinpoissonfieldtheory ] ) , without neglecting any terms .",
    "we show this in the next subsection .      in this subsection we prove that if the equations of motion are obtained via a variational principle of the action ( [ eq : actionfieldtheory ] ) , there is an energy - like invariant @xmath581 .",
    "this is an application of noether s theorem , and it is based on the fact that in the action ( [ eq : actionfieldtheory ] ) the only time dependence is through the functions @xmath582 and @xmath3 . to obtain the energy - like invariant , we use the equations of motion derived from the variational principle in subsection  [ sub : variational ] .    in order to find the conserved quantity we first perform the change of variable @xmath583 in every integral on the right side of ( [ eq : actionfieldtheory ] ) , which , of course , does not change the value of the action , giving @xmath584 = \\int_{t_0 - \\delta t}^{t_1 - \\delta t } dt ' \\bigg [ \\frac{\\lambda_{de}^2\\epsilon_s^2}{2l^2 } \\int d^3 r \\,|\\nabla\\varphi({\\mathbf{r}},t ' + \\delta t)|^2 \\nonumber \\\\",
    "+ \\sum_p \\int d^6 z_{p0 } b_{|| , p}^ * ( { \\mathbf{z}}_{p0 } ) f_{p0}({\\mathbf{z}}_{p0 } ) \\left .",
    "\\overline{\\mathcal{l}}_p \\right |_{t = t^\\prime + \\delta t } \\bigg ] , \\end{aligned}\\ ] ] where @xmath585 we expand the right side of the previous equation up to first order in @xmath586 to find @xmath587 = \\sigma \\big [ { \\mathbf{z}}_p(\\bullet , \\cdot ; \\cdot ) , \\varphi(\\bullet , \\cdot ) \\big ] \\nonumber\\\\ \\fl & + \\delta_\\varphi \\left . \\sigma\\big [ { \\mathbf{z}}_p(\\bullet , \\cdot;\\cdot),\\varphi(\\bullet,\\cdot ) \\big ] \\right    \\sum_p \\delta_{{\\mathbf{z}}_p } \\left . \\sigma\\big [ { \\mathbf{z}}_p(\\bullet , \\cdot;\\cdot),\\varphi(\\bullet,\\cdot ) \\big ] \\right |_{\\delta { \\mathbf{z}}_p = \\delta t \\dot { \\mathbf{z}}_p } \\nonumber\\\\ \\fl & - \\delta t\\bigg [ \\frac{\\lambda_{de}^2\\epsilon_s^2}{2l^2 }   \\int d^3 r \\,|\\nabla\\varphi({\\mathbf{r}},t')|^2 + \\sum_p \\int d^6 z_{p0 } \\ , b_{|| , p}^ * ( { \\mathbf{z}}_{p0 } ) f_{p0}({\\mathbf{z}}_{p0 } ) \\left .",
    "\\overline{\\mathcal{l}}_p \\right |_{t = t ' } \\bigg]_{t'=t_0}^{t'=t_1},\\end{aligned}\\ ] ] where @xmath588 and latexmath:[$\\delta_{{\\mathbf{z}}_p } \\sigma    variations of @xmath553 under perturbations of both @xmath590 and @xmath582 with the specific form @xmath591 and @xmath592 . for the variations with respect to @xmath593",
    ", we obtain @xmath594_{t^\\prime = t_0}^{t^\\prime = t_1},\\end{aligned}\\ ] ] where to obtain this last equality we have integrated by parts in @xmath43 and we have used the equations of motion @xmath595 applying @xmath596 we find @xmath597_{t^\\prime = t_0}^{t^\\prime = t_1}.\\ ] ] for the variations with respect to @xmath598 we obtain that @xmath599 where we have employed ( [ eq : gyrokinpoissonfieldtheory1 ] ) and poisson s equation @xmath578 . to obtain ( [ eq : gyrokinpoissonfieldtheory1 ] ) we assumed that @xmath600 vanishes at the boundaries of the domain , and this is not necessarily the case for @xmath601 .",
    "we avoid this problem by assuming either that the domain extends to infinity , where @xmath602 , or that we are in a periodic box and the contribution from one half of the boundary cancels with the contribution from the other half . in either case",
    ", we are assuming that there is no net energy flux through the boundary .    by substituting ( [ varzpnoethers ] ) and ( [ varvarphinoethers ] ) into ( [ eq : actiontimetrans2 ] ) and observing that the term linear in @xmath586 in ( [ eq : actiontimetrans2 ] ) has to be identically zero ,",
    "that is , the sum of the second , third and fourth terms in the right side must vanish , we find @xmath603_{t'=t_0}^{t'=t_1 } = 0.\\end{aligned}\\ ] ] then , @xmath604_{t'=t_0}^{t'=t_1 } = 0.\\ ] ] for solutions of the equations of motion , where @xmath605 since this must hold for every interval @xmath606 $ ] , we deduce that @xmath607 on the equations of motion . finally , using equations ( [ fpfp0 ] ) and ( [ eq : psconserv ] ) , we can write the integrals over @xmath608 in ( [ eq : actiontimetrans6 ] ) as integrals over @xmath593 , giving @xmath609 the conservation of this energy - like invariant is only satisfied on the equations of motion , that is , the variational equations of motion and the variational poisson s equation obtained in subsection  [ sub : variational ] must be used .",
    "it is important to keep all the given terms , even if they are higher order than first ( the order to which poisson s equation is correct ) .",
    "for example , it is necessary to obtain the _ exact _ function @xmath610 in ( [ eq : gkpoisson ] ) to have exact conservation of @xmath611 .",
    "the gyrokinetic ordering in a static magnetic field consists of the ordering assumptions ( [ orderings ] ) , defined by a single parameter @xmath612 . in this paper",
    "we have strictly implemented the gyrokinetic ordering in the phase - space lagrangian to obtain explicitly the gyrokinetic lagrangian to order @xmath1 for general magnetic geometry .",
    "our approach differs from previous phase - space lagrangian ( or hamiltonian ) derivations of gyrokinetics . in previous work",
    "@xcite the calculation is performed in two steps .",
    "first , with zero fluctuating electrostatic potential , an expansion in powers of @xmath613 is performed and a gyrophase independent guiding - center lagrangian is determined to order @xmath0 .",
    "then , the electrostatic fluctuations , whose size is given by a new expansion parameter @xmath614 , are switched - on , reintroducing a gyrophase dependence that is removed order by order in @xmath27 yielding the final gyrokinetic lagrangian , usually computed up to order @xmath29 .",
    "when the expansion in @xmath27 is performed , the fact that there has been a previous expansion in @xmath0 is ignored and the terms of order @xmath28 are never calculated .",
    "thus , the final lagrangian is missing relevant terms of order @xmath28 and @xmath1",
    ".    the novelty of our work can be easily understood by examining the explicit expression of the second - order gyrokinetic hamiltonian , @xmath399 , given in equations  ( [ hamiltonian_o2_2 ] ) , ( [ psi2_phi ] ) , ( [ psi2_phib ] ) and ( [ psi2_b ] ) .",
    "it shows in a transparent way that gyrokinetic theory ties together geometry and turbulence , so that no splitting between guiding - center and gyrokinetic dynamics is possible . see , for example , @xmath410 in ( [ psi2_phib ] ) where magnetic geometry and electrostatic potential appear together .",
    "this is the first time that the electrostatic gyrokinetic equations in general geometry are fully computed to order @xmath1 and the calculations are pursued to the point of reaching formulae , like the one for @xmath399 , that can be straightforwardly implemented in a computer code .    from the new phase - space lagrangian in ( [ finall ] ) and the new hamiltonian in ( [ finalh ] )",
    "we obtain a new vlasov equation and a new gyrokinetic poisson s equation .",
    "the vlasov equation is correct to second order in the expansion parameter @xmath0 , and it is to our knowledge the highest order full @xmath23 gyrokinetic equation available in the literature for general geometry . in the limit where the electrostatic potential has a scale of variation much larger than the gyroradius of the species of interest , this equation is also the highest order drift kinetic equation that we are aware of .",
    "the gyrokinetic poisson s equation derived from the new lagrangian is , however , only correct to first order in @xmath0 .",
    "we have calculated poisson s equation employing two methods . in section  [ sec : gyropoissoneq ] , in the integrals in velocity space that enter in poisson s equation we have simply changed from the coordinates @xmath44 to the gyrokinetic variables . in section  [ sec : fieldtheory ] we have used a variational formalism . the equation obtained with the variational formalism",
    "is set by the form of the hamiltonian and it is only correct to first order , although it contains terms that are higher order .",
    "these higher order terms do not add accuracy , but they are necessary to have an exact energy - like invariant . by directly changing from @xmath615 to the gyrokinetic variables in the integrals that enter poisson s equation , it is possible to obtain a higher order poisson s equation if the higher order corrections @xmath337 , @xmath339 and @xmath340 are calculated .",
    "it is not necessary to calculate the hamiltonian to next order .",
    "the calculation of @xmath337 , @xmath339 and @xmath340 is however very tedious and is left for future work .",
    "if this procedure is followed and the third order hamiltonian is not obtained , the conservation of the energy - like invariant will not be exact .",
    "some natural steps following the present work are the extension to the electromagnetic case and the introduction of external flows .",
    "we will also investigate the implications of the new terms in the hamiltonian for the transport of toroidal angular momentum in tokamaks .",
    "the authors are indebted to the programme of visits to tj - ii at laboratorio nacional de fusin of ciemat ( spain ) and to the summer programme  gyrokinetics in laboratory and astrophysical plasmas \" at the isaac newton institute for mathematical sciences , without which this work would not have been possible .",
    "this research was partially supported by the post - doctoral programme of the engineering and physical sciences research council of the uk , by the junior research fellowship programme of christ church at university of oxford , and by grant ene2009 - 07247 , ministerio de ciencia e innovacin ( spain ) .",
    "let @xmath616 be an invertible , antisymmetric matrix of dimension @xmath617 whose components are functions defined on a region @xmath618 , and such that @xmath619 denote by @xmath620 the inverse of @xmath616 , @xmath621 .",
    "then , @xmath622 defines a poisson bracket by contraction with the differentials of pairs of functions on @xmath623 , i.e. , @xmath624    we must prove that ( [ poi_braappendix ] ) satisfies skew - symmetry , given in ( [ eq : poissonproperty1 ] ) , the leibniz rule , given in ( [ eq : poissonproperty2 ] ) , and the jacobi identity , given in ( [ eq : poissonproperty3 ] ) . skew - symmetry is satisfied because the inverse of an antisymmetric matrix is antisymmetric , i.e. , @xmath625 .",
    "the leibniz rule is trivial to check . as for the jacobi identity ,",
    "it is immediate to see that it is equivalent to @xmath626 showing that ( [ eq : jacobicomponents ] ) is equivalent to ( [ eq : closedform ] ) is a simple exercise of application of the formula of the derivative of the inverse of a matrix , @xmath627",
    "in this appendix we prove equations ( [ ds_npdr ] ) and ( [ ds_npdtheta ] ) . for equation ( [ ds_npdr ] ) , we use that according to ( [ s_np ] ) @xmath628.\\end{aligned}\\ ] ] recall that the prime @xmath629 here indicates that the function depends on @xmath630 . employing @xmath631 \\nonumber \\\\ = \\frac{1}{\\epsilon } \\frac{\\partial}{\\partial \\mu_g^\\prime } [ { \\mathbf{a}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$}}^\\prime ) ] + \\frac{1}{2 \\mu_g^\\prime } { \\mbox{\\boldmath$\\rho$}}^\\prime \\times { \\mathbf{b}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$}}^\\prime ) , \\end{aligned}\\ ] ] @xmath632 + \\frac{\\epsilon}{2\\mu_g^\\prime } \\nabla_{{\\mathbf{r}}_g } { \\mbox{\\boldmath$\\rho$}}^\\prime \\cdot [ { \\mbox{\\boldmath$\\rho$}}^\\prime \\times { \\mathbf{b}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$}}^\\prime ) ] \\nonumber \\\\",
    "= \\nabla_{{\\mathbf{r}}_g } { \\mbox{\\boldmath$\\rho$}}^\\prime \\cdot \\frac{\\partial}{\\partial \\mu_g^\\prime } [ { \\mathbf{a}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$}}^\\prime ) ] + \\frac{\\epsilon}{2\\mu_g^\\prime } \\nabla_{{\\mathbf{r}}_g } { \\mbox{\\boldmath$\\rho$}}^\\prime \\cdot [ { \\mbox{\\boldmath$\\rho$}}^\\prime \\times { \\mathbf{b}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$}}^\\prime ) ] \\end{aligned}\\ ] ] and @xmath633 equation ( [ dsdr_app1 ] ) becomes @xmath634.\\end{aligned}\\ ] ] to obtain equation ( [ ds_npdr ] ) from this equation we use ( [ drhodmu ] ) to write @xmath635 and we employ ( [ gradrho ] ) to get @xmath636\\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{b}}}_g \\cdot { \\mbox{\\boldmath$\\rho$}}^\\prime \\nonumber \\\\ + \\frac{2\\mu_g^\\prime}{b_g } [ { \\hat{\\mathbf{b}}}_g \\cdot { \\mathbf{b}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$}}^\\prime ) ] \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{e}}}_{2 g } \\cdot { \\hat{\\mathbf{e}}}_{1g}.\\end{aligned}\\ ] ]    for equation ( [ ds_npdtheta ] ) , we use that according to ( [ s_np ] ) @xmath637.\\end{aligned}\\ ] ] employing @xmath638 + \\frac{\\epsilon}{2\\mu_g^\\prime } \\frac{\\partial { \\mbox{\\boldmath$\\rho$}}^\\prime}{\\partial \\theta_g } \\cdot [ { \\mbox{\\boldmath$\\rho$}}^\\prime \\times { \\mathbf{b}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$}}^\\prime ) ] \\nonumber",
    "\\\\ = \\frac{\\partial { \\mbox{\\boldmath$\\rho$}}^\\prime}{\\partial \\theta_g } \\cdot \\frac{\\partial}{\\partial \\mu_g^\\prime } [ { \\mathbf{a}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$}}^\\prime ) ] + \\frac{\\epsilon}{2\\mu_g^\\prime } \\frac{\\partial { \\mbox{\\boldmath$\\rho$}}^\\prime}{\\partial \\theta_g } \\cdot [ { \\mbox{\\boldmath$\\rho$}}^\\prime \\times { \\mathbf{b}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$}}^\\prime ) ] \\end{aligned}\\ ] ] and @xmath639 equation ( [ dsdtheta_app1 ] ) becomes equation ( [ ds_npdtheta ] ) . to obtain the final form of the equation we have also used ( [ drhodtheta ] ) to write @xmath640 = - \\frac{2\\mu_g^\\prime}{b_g } { \\hat{\\mathbf{b}}}_g \\cdot { \\mathbf{b}}({\\mathbf{r}}_g + \\epsilon { \\mbox{\\boldmath$\\rho$}}^\\prime).\\end{aligned}\\ ] ]",
    "in this appendix we compare the gyrokinetic variable transformation obtained in this article with the variables found in @xcite .    to be able to compare with the results in @xcite , given in the form @xmath641 , @xmath642 , @xmath643 and @xmath644 , we will use the transformation @xmath645 to write them as @xmath646 , @xmath647 , @xmath648 and @xmath649 .",
    "after doing so , we will see that the gyrokinetic variables @xmath650 , @xmath651 and @xmath652 in @xcite are gyrophase independent quantities up to the order that they are defined . this is a property that must be satisfied because otherwise the new gyrokinetic variables would have fast time dependence through the gyrophase .",
    "the variable @xmath652 must be a function of @xmath101 only because there is only one adiabatic invariant associated with the gyromotion .",
    "the gyrokinetic variables of @xcite are the gyrocenter position @xmath653 { \\raise 0.65ex\\hbox{${\\scriptstyle { { _ { \\displaystyle \\cdot}}\\atop\\times}}$ } } \\nabla \\left ( \\frac { { \\hat{\\mathbf{b } } } } { b } \\right ) \\nonumber \\\\ \\fl & + \\frac{\\epsilon^2 v_{||}}{b^2 } { \\mathbf{v}}_\\bot \\cdot \\nabla { \\hat{\\mathbf{b}}}+ \\frac{\\epsilon^2 v_{||}}{b^2 } { \\hat{\\mathbf{b}}}{\\hat{\\mathbf{b}}}\\cdot \\nabla { \\hat{\\mathbf{b}}}\\cdot { \\mathbf{v}}_\\bot   + \\frac{\\epsilon^2}{8b^2 } { \\hat{\\mathbf{b } } } [ { \\mathbf{v}}_\\bot { \\mathbf{v}}_\\bot - ( { \\mathbf{v}}\\times { \\hat{\\mathbf{b } } } ) ( { \\mathbf{v}}\\times { \\hat{\\mathbf{b } } } ) ] : \\nabla { \\hat{\\mathbf{b}}}\\nonumber\\\\ \\fl & - \\frac{\\lambda \\epsilon^2}{\\lambda b^2 } \\nabla_{({\\mathbf{r}}_\\bot/\\lambda \\epsilon ) } { \\widetilde{\\phi}}\\times { \\hat{\\mathbf{b}}}+ o(\\epsilon^3),\\end{aligned}\\ ] ] where @xmath654 ; the gyrokinetic kinetic energy @xmath655 the magnetic moment @xmath656 : \\nabla { \\hat{\\mathbf{b}}}+ \\frac{\\lambda \\epsilon}{b } { \\widetilde{\\phi}}+ o(\\epsilon^2);\\end{aligned}\\ ] ] and the gyrophase @xmath657 : \\nabla { \\hat{\\mathbf{b}}}- \\frac{\\lambda \\epsilon}{\\lambda^2 b } \\frac{\\partial { \\widetilde{\\phi}}}{\\partial ( \\mu/\\lambda^2 ) } + o(\\epsilon^2).\\end{aligned}\\ ] ]    to these variables we apply the gyrokinetic transformation .",
    "first we apply the non - perturbative change of variables @xmath658 . for the variable @xmath650",
    "we find @xmath659 { \\raise 0.65ex\\hbox{${\\scriptstyle { { _ { \\displaystyle \\cdot}}\\atop\\times}}$ } } \\nabla_{{\\mathbf{r}}_g } \\left ( \\frac { { \\hat{\\mathbf{b}}}_g } { b_g } \\right ) \\nonumber \\\\ \\fl & + \\frac{\\epsilon^2 v_{||g}}{b_g } { \\hat{\\mathbf{b}}}{\\hat{\\mathbf{b}}}\\cdot \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{b}}}\\cdot ( { \\mbox{\\boldmath$\\rho$}}\\times { \\hat{\\mathbf{b}}}_g ) - \\frac{\\epsilon^2}{8 } { \\hat{\\mathbf{b}}}_g [ { \\mbox{\\boldmath$\\rho$}}{\\mbox{\\boldmath$\\rho$}}- ( { \\mbox{\\boldmath$\\rho$}}\\times { \\hat{\\mathbf{b}}}_g ) ( { \\mbox{\\boldmath$\\rho$}}\\times { \\hat{\\mathbf{b}}}_g ) ] : \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{b}}}_g \\nonumber\\\\ \\fl & - \\frac{\\lambda \\epsilon^2}{\\lambda b_g^2 } \\nabla_{({\\mathbf{r}}_\\bot/\\lambda \\epsilon ) } { \\widetilde{\\phi}}\\times { \\hat{\\mathbf{b}}}_g + o(\\epsilon^3),\\end{aligned}\\ ] ] where we have used @xmath660 , @xmath661 , @xmath662 , @xmath663 , @xmath664 and @xmath665",
    "we then apply the transformation @xmath666 by using @xmath667 , with @xmath333 given in ( [ r2 ] ) , @xmath668 , @xmath669 and @xmath670 . as a result",
    "we find the expression @xmath671 : \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b}}}+ \\frac{\\epsilon^2}{4b } [ { \\mbox{\\boldmath$\\rho$}}{\\mbox{\\boldmath$\\rho$}}+ ( { \\mbox{\\boldmath$\\rho$}}\\times { \\hat{\\mathbf{b } } } ) ( { \\mbox{\\boldmath$\\rho$}}\\times { \\hat{\\mathbf{b } } } ) ] \\cdot \\nabla_{\\mathbf{r}}b \\nonumber \\\\ \\fl & + \\frac{\\epsilon^2 u}{b } ( { \\mbox{\\boldmath$\\rho$}}\\times { \\hat{\\mathbf{b } } } ) \\cdot \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b}}}+ \\epsilon^2 u { \\hat{\\mathbf{b}}}\\cdot \\nabla_{\\mathbf{r}}\\left ( \\frac{{\\hat{\\mathbf{b}}}}{b } \\right ) \\times { \\mbox{\\boldmath$\\rho$}}- \\frac{\\epsilon^2 u}{b } { \\hat{\\mathbf{b}}}{\\hat{\\mathbf{b}}}\\cdot \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b}}}\\cdot ( { \\mbox{\\boldmath$\\rho$}}\\times { \\hat{\\mathbf{b } } } ) \\nonumber \\\\ \\fl & - \\frac{\\epsilon^2 u}{b } { \\hat{\\mathbf{b}}}\\times \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b}}}\\cdot { \\mbox{\\boldmath$\\rho$}}+ o(\\epsilon^3),\\end{aligned}\\ ] ] where @xmath672 and @xmath673 depend on @xmath99 .",
    "to simplify expression ( [ rp_2 ] ) we use @xmath674 and @xmath675 \\times { \\mbox{\\boldmath$\\rho$}}= ( \\nabla_{\\mathbf{r}}\\cdot { \\hat{\\mathbf{b } } } ) ( { \\mbox{\\boldmath$\\rho$}}\\times { \\hat{\\mathbf{b}}}).\\ ] ] we finally obtain @xmath676 to find this result we have used @xmath677 .",
    "applying the non - perturbative change of variables to @xmath651 we find @xmath678 to transform to the variables @xmath99 , @xmath100 , @xmath101 and @xmath98 we use @xmath679 , @xmath680 , with @xmath334 and @xmath335 given in ( [ u1 ] ) and ( [ mu1 ] ) , @xmath681 and @xmath682 , giving @xmath683    for @xmath652 , we find that the transformation @xmath684 gives @xmath685 : \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{b}}}_g + \\frac{\\lambda \\epsilon}{b_g } { \\widetilde{\\phi}}+ o(\\epsilon^2),\\end{aligned}\\ ] ] where we have used @xmath663 , @xmath686 , @xmath687 - \\frac{\\epsilon \\mu_g}{b_g } { \\mbox{\\boldmath$\\rho$}}\\cdot \\nabla_{{\\mathbf{r}}_g } b_g + o(\\epsilon^2)\\end{aligned}\\ ] ] and @xmath688 ^ 2 + o(\\epsilon^2 ) \\nonumber \\\\",
    "= 2\\mu_g b_g - 2 \\epsilon v_{||g } { \\mbox{\\boldmath$\\rho$}}\\cdot \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{b}}}_g \\cdot ( { \\mbox{\\boldmath$\\rho$}}\\times { \\mathbf{b}}_g ) + o(\\epsilon^2).\\end{aligned}\\ ] ] then employing @xmath689 , with @xmath335 given in ( [ mu1 ] ) , @xmath681 , @xmath668 and @xmath670 , we find @xmath690 : \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{b}}}_g + o(\\epsilon^2 ) \\nonumber \\\\ = \\mu + o(\\epsilon^2),\\end{aligned}\\ ] ] where to obtain the final equality we have used ( [ mati ] ) .",
    "finally , for @xmath691 we obtain that the non - perturbative transformation gives @xmath692 : \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{b}}}_g - \\frac{\\lambda \\epsilon}{\\lambda^2 b_g } \\frac{\\partial { \\widetilde{\\phi}}}{\\partial ( \\mu/\\lambda^2 ) } + o(\\epsilon^2),\\end{aligned}\\ ] ] where we have used @xmath693 \\nonumber",
    "\\\\ = \\theta_g + \\frac{\\epsilon}{2\\mu_g b_g } [ ( { \\mbox{\\boldmath$\\rho$}}\\times { \\mathbf{b}}_g ) \\cdot { \\hat{\\mathbf{e}}}_{1 g } ] { \\mbox{\\boldmath$\\rho$}}\\cdot \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{e}}}_{2 g } \\cdot ( v_{||g } { \\hat{\\mathbf{b}}}_g + { \\mbox{\\boldmath$\\rho$}}\\times { \\mathbf{b}}_g ) \\nonumber \\\\ - \\frac{\\epsilon}{2\\mu_g b_g } [ ( { \\mbox{\\boldmath$\\rho$}}\\times { \\mathbf{b}}_g ) \\cdot { \\hat{\\mathbf{e}}}_{2 g } ] { \\mbox{\\boldmath$\\rho$}}\\cdot \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{e}}}_{1 g } \\cdot ( v_{||g } { \\hat{\\mathbf{b}}}_g + { \\mbox{\\boldmath$\\rho$}}\\times { \\mathbf{b}}_g ) + o(\\epsilon^2 ) \\nonumber",
    "\\\\ = \\theta_g - \\frac{\\epsilon v_{||g}}{2\\mu_g } { \\mbox{\\boldmath$\\rho$}}\\cdot \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{b}}}_g \\cdot { \\mbox{\\boldmath$\\rho$}}+ \\epsilon { \\mbox{\\boldmath$\\rho$}}\\cdot \\nabla_{{\\mathbf{r}}_g } { \\hat{\\mathbf{e}}}_{2 g } \\cdot { \\hat{\\mathbf{e}}}_{1 g } + o(\\epsilon^2).\\end{aligned}\\ ] ] here we have employed @xmath694 and @xmath695 to write the last equality . equation ( [ thetap_1 ] ) is now rewritten by using @xmath696 , with @xmath336 given in ( [ theta1 ] ) , @xmath681 , @xmath668 and @xmath697 , giving @xmath698 : \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b}}}+ o(\\epsilon^2 ) = \\theta + \\frac{\\epsilon u}{2b^2 } { \\hat{\\mathbf{b}}}\\cdot \\nabla_{\\mathbf{r}}b + o(\\epsilon^2),\\end{aligned}\\ ] ] where we have employed ( [ mati ] ) and @xmath699 .    from equation ( [ rp_final ] ) , ( [ ep_final ] ) , ( [ mup_final ] ) and ( [ thetap_final ] ) we see that the gyrokinetic variables defined in @xcite are simple functions of the gyrokinetic variables in this article .",
    "notice that @xmath650 and @xmath651 do not depend on the gyrophase and that @xmath652 is equal to @xmath101 to the order of interest , as expected .",
    "in this appendix we show how to obtain ( [ hamiltonian_o2_2 ] ) from equation ( [ hbar2_1 ] ) .",
    "first , by employing equations ( [ gammar_o2 ] ) , ( [ gammatheta_o2 ] ) , ( [ s2 ] ) , ( [ r2 ] ) and ( [ nablas2_slow ] ) , we find that @xmath700 , @xmath701 , @xmath702 , @xmath703 and @xmath704 here we have used equation ( [ rhorhoave ] ) repeatedly .",
    "these results give that equation ( [ hbar2_1 ] ) is equal to @xmath705 where we have used @xmath706 to write @xmath707 = \\frac{\\mu}{2b^2 } [ ( \\nabla_{\\mathbf{r}}\\times { \\hat{\\mathbf{b } } } ) \\times { \\hat{\\mathbf{b } } } ] \\cdot \\nabla_{\\mathbf{r}}b = \\frac{\\mu}{2b^2 } { \\hat{\\mathbf{b}}}\\cdot \\nabla_{\\mathbf{r}}{\\hat{\\mathbf{b}}}\\cdot \\nabla_{\\mathbf{r}}b.\\end{aligned}\\ ] ] the terms @xmath708 , @xmath709 , @xmath710 and @xmath711 in equation ( [ lagrangian_gyro_app1 ] ) are @xmath712 @xmath713 @xmath714 and @xmath715 we proceed to write these terms in more convenient forms .",
    "the term @xmath708 in ( [ t1app2_1 ] ) is rewritten using @xmath716 to obtain @xmath717 employing ( [ r2_1 ] ) , this last result becomes @xmath718 \\right \\ } \\right \\rangle.\\ ] ] realizing that @xmath719 - \\nabla_{({\\mathbf{r}}_\\bot/\\epsilon ) } s_p^{(2 ) } \\cdot \\left [ { \\hat{\\mathbf{b}}}\\times \\frac{\\partial { \\mbox{\\boldmath$\\gamma$}}_{\\mathbf{r}}^{(1)}}{\\partial \\theta } \\right ] \\nonumber",
    "\\\\ = \\frac{\\partial}{\\partial \\theta } \\left [ { \\mbox{\\boldmath$\\gamma$}}_{\\mathbf{r}}^{(1 ) } \\cdot \\left ( { \\hat{\\mathbf{b}}}\\times \\nabla_{({\\mathbf{r}}_\\bot/\\epsilon ) } s_p^{(2 ) } \\right ) \\right ] , \\end{aligned}\\ ] ] we finally obtain @xmath720 \\right \\rangle .",
    "\\label{t1app2_2}\\ ] ] these two terms can be expressed in terms of magnetic and electric field gradients . using equation ( [ gammar_o1 ] ) and @xmath721 from ( [ rhorhoave ] )",
    ", we find latexmath:[\\ ] ] note that we did not need to keep the gyroaverages in ( [ term2variational ] ) and ( [ term3variational ] ) because there is an overall integral in @xmath472 and neither @xmath828 nor @xmath538 depend on @xmath472 .",
    "we have only left to prove that ( [ poisson_app ] ) is equal to ( [ eq : gyrokinpoissonfieldtheory ] ) . using the result in ( [ r2 ] ) and employing ( [ rhorhoave ] ) and ( [ rhorhowig ] ) to write @xmath829 \\cdot \\nabla_{{\\mathbf{r}}_p } b = { \\mbox{\\boldmath$\\rho$}}{\\mbox{\\boldmath$\\rho$}}\\cdot \\nabla_{{\\mathbf{r}}_p } b,\\ ] ] it is clear that @xmath830 is exactly the perpendicular component of @xmath521 . using ( [ mu1 ] ) , we find that @xmath831 .",
    "it only remains to use that @xmath832 , with @xmath833 given in ( [ theta1 ] ) . to obtain this identity we have used @xmath834 , @xmath835/\\partial \\theta_p$ ] and @xmath836 .",
    "using @xmath837 and integrating by parts in @xmath472 in ( [ poisson_app ] ) gives the final form ( [ eq : gyrokinpoissonfieldtheory ] ) ."
  ],
  "abstract_text": [
    "<S> gyrokinetic theory is based on an asymptotic expansion in the small parameter @xmath0 , defined as the ratio of the gyroradius and the characteristic length of variation of the magnetic field . in this article , this ordering is strictly implemented to compute the electrostatic gyrokinetic phase - space lagrangian in general magnetic geometry to order @xmath1 . in particular , a new expression for the complete second - order gyrokinetic hamiltonian is provided , showing that in a rigorous treatment of gyrokinetic theory magnetic geometry and turbulence can not be dealt with independently . the new phase - space gyrokinetic lagrangian gives a vlasov equation accurate to order @xmath1 and a poisson equation accurate to order @xmath0 . </S>",
    "<S> the final expressions are explicit and can be implemented into any simulation without further computations . </S>"
  ]
}