{
  "article_text": [
    "the study of how galaxies form and evolve is one of the most active fields of astrophysical research today .",
    "key in this work is the ability to estimate the stellar masses , star formation rates ( sfrs ) , and dust content of faint galaxies in the distant universe .",
    "one of the most widely - used approaches to determining these quantities has been through the quantitative comparison of observed multi - wavelength spectral energy distributions ( seds ) with theoretical or empirical models .",
    "this approach was first developed for high-@xmath0 galaxies by sawicki & yee ( 1998 ) and has subsequently been adopted and elaborated on by numerous other studies ( e.g. , ouchi , yamada , kawai , & ohta 1999 ; papovich et al .",
    "2001 ; hall et al .",
    "2001 ; shapley et al .  2001 ; and , subsequently , many others ) .",
    "it is fair to say that sed fitting has now become a standard way to estimate stellar masses and other properties of high - redshift galaxies .",
    "a related task is the estimation of redshift from broadband photometry , a technique known as photometric redshifts ( photo-@xmath0 s ) .",
    "when photo-@xmath0 estimation is done by means of the template fitting approach ( gwyn & hartwick 1996 ; sawicki , lin , & yee 1997 ) , it can be regarded as a subset of the information that can be routinely extracted from full sed - fitting .",
    "indeed , photo-@xmath0 estimation by template fitting has led to the subsequent development of sed - fitting as a tool for high - redshift galaxy studies .",
    "this paper gives a description of the ` sedfit `  software tool , which is the first  though continually - evolving  among many software packages now used in sed - fitting work ; it is also the only such package at present to properly treat upper limits  i.e. , observed but undetected photometric data . to date , ` sedfit `  has been used to estimate or simulate photometric redshifts ( sawicki , lin , & yee , 1997 ; hogg et al .",
    "1998 ; sawicki 2002 ; sawicki & malln - ornelas 2003 ; sorba & sawicki 2010 ; sorba & sawicki 2011 ) , to determine the physical properties of distant galaxies such as their stellar mass , starburst age , and reddening ( sawicki & yee 1998 ; sawicki 2001 ; yabe et al .  2009",
    "; yuma et al . 2010 , 2011 ; hashimoto et al .  2010 ; palmer 2010 , 2012 ) , or to do both at the same time ( thompson et al .  1999 ; hall et al . ,  2001 ; sawicki 2012 ) .",
    "it has also been used for simpler , but nevertheless important , tasks such as calculating colors and k - corrections of distant galaxies ( sawicki et al .",
    "2005 ; sawicki & thompson 2006a , 2006b , arcila - osejo , sawicki , & sato 2012 ) .",
    "it continues to be used in these and similar roles .",
    "the paper is organized as follows .",
    "section  [ sec.overview ] presents an overview of ` sedfit ` , while subsequent sections delve into some of the key details :  [ sec.flux-generation ] describes the generation of grids of model seds and  [ sec.fitting ] describes the fitting procedure by means of which the observational data are compared to these sed grids to identify the best - fitting model .",
    "the detailed derivation of the fitting formalism , including the formulae for the case when some of the photometric observations yield only non - detections , is given in the appendix .",
    "section  [ sec.examples ] gives several examples of the application of the ` sedfit `  software and  [ sec.discussion ] discusses several issues associated with sed fitting in general .",
    "given a distant galaxy , the task at hand is to compare a set of photometric observations made through ( usually ) broadband filters with sets of flux densities predicted for a grid of spectral models , in order to identify that model which best matches the data and to establish the degree of confidence in that model .",
    "the task naturally separates into two distinct components : ( 1 ) the generation of model flux densities , and ( 2 ) the quantitative comparison of these model flux densities to the observational data . `",
    "sedfit `  deals with these two components by means of two separate software programs : ` make_sed `  and ` fit_sed `  ( fig .",
    "[ fig.flowchart ] ) .",
    "the program ` make_sed `  carries out the tasks associated with the first of these two major components , namely the generation of a grid of model magnitudes ( or spectra ) .",
    "it starts by taking as input a set of rest - frame model spectra ( from , e.g. , the galexev library of bruzual & charlot 2003 ) and performs the following operations : attenuation by interstellar dust , cosmological dimming and redshifting to the observed frame , and redshift - dependent attenuation by intervening intergalactic gas clouds ( see top half of fig .  [ fig.flowchart ] ) .",
    "the spectra thus adjusted can then be saved , or can be further integrated through desired system transmission curves to produce grids of model magnitudes .",
    "the details of this process are described in  [ sec.flux-generation ] .",
    "the program ` make_sed `  loops over the full specified ranges for all the user - specified parameters ( redshift , reddenning , etc . ) , as well as parameters internal to the input spectral templates ( such as stellar population ages ) to produce grids of models as a function of these parameters .",
    "next , the program ` fit_sed `  takes the grid of model magnitudes generated by ` make_sed `  and compares it to the observed photometry to find the model that best matches the data .",
    "the comparison is done in flux space ( after converting from magnitudes to flux densities ) by means of a maximum likelihood test (  @xmath1 fitting \" ) modified to correctly account for those photometric observations that have only yielded upper limits .",
    "the details of the mathematical formalism that underlies the fitting procedure used by ` fit_sed `  are given in  [ sec.fitting ] .",
    "in addition to identifying the best - fitting model and providing the corresponding parameters and their uncertainties , ` fit_sed `  can optionally also produce @xmath1  maps of the parameter space , monte carlo simulations of the uncertainties , and/or a means to produce the model spectra that correspond to the best - fitting model .",
    "the program can loop over multiple objects in a catalog , fitting each one with the full grid of models or a subset thereof .",
    "the present implementation of the software is in perl and the perl data language ( glazebrook & economou 1997 ) .",
    "while perl itself is a scripting rather than a compiled language , the perl data language module is very efficient at dealing with large arrays because it uses pre - compiled libraries . the computationally - intensive work in `",
    "sedfit `  is done using this perl data language functionality and is therefore quite fast . in particular ,",
    "array operations are very efficient in perl data language , making it possible for sedfit to perform much of the sed generation and fitting very rapidly .    both `",
    "make_sed `  and ` fit_sed `  are operated from the unix command line and are controlled by means of editable parameter files and command - line overrides of those files .",
    "this approach and its syntax is modeled on those adopted by the sextractor photometry package ( bertin & arnouts 1996 ) and will be intuitively familiar to those experienced with sextractor .",
    "this approach allows for fast experimenting with parameter settings and enables efficient scripting .",
    "the process of generating model seds usually begins with unattenuated rest - frame spectra .",
    "these input spectra can be either empirical ( e.g. , coleman , wu , & weedman 1980 ) or synthetic ( e.g. , bruzual & charlot 1993 , 2003 ) and can represent galaxies , agn , individual galactic stars , or other objects . `",
    "sedfit `  does not provide a built - in ability to mix spectra to , e.g. , create more complex star formation histories than those already provided in the spectral libraries or to add emission lines to spectra , such as the bruzual & charlot ( 2003 ) library , that lack them ( but see , e.g. , yabe et al .",
    "it is left up to the user to combine or modify spectra if so desired and then save them in the format readable by ` sedfit ` .",
    "this approach allows maximum flexibility in what models can be fit and ` sedfit ` s only requirements are that the input spectra follow a standardized format and are given in units of power per frequency interval as a function of wavelength in angstroms , @xmath2 .",
    "this system of units reflects the tendency of high-@xmath0 optical / ir astronomy to use ab magnitudes ( which are defined as logarithms of power per frequency interval - 48.60 $ ] ( oke 1974 ) , or @xmath3 . ] ) but to work as a function of wavelength rather than frequency .",
    "then , starting from @xmath2 , several steps are needed to arrive at the spectral energy densities in the observer s frame , @xmath4 .",
    "these steps are performed by the ` sedfit `  program ` make_sed `  as described below .",
    "first , each input spectrum @xmath5 is modified to simulate the effect of attenuation due to interstellar dust in the model galaxy .",
    "this attenuation can be expressed as @xmath6 where @xmath7 and @xmath8 are the attenuated and unattenuated spectral energy distributions , @xmath9 is the color excess whose value controls the overall amount of attenuation , and @xmath10 is the dust law which defines the profile of attenuation as a function of wavelength . at present ` make_sed `  supports the following dust laws : the calzetti ( 1997 ) and calzetti et al .",
    "( 2000 ) starburst dust laws , the fitzpatrick ( 1986 ) milky way , lmc , and 30 doradus dust laws , and the prevot et al .",
    "( 1984 ) smc law .",
    "the user specifies one of the dust laws and one or more @xmath9 value(s ) to be included in the calculation of the model grid .",
    "next , the spectral energy distribution is attenuated further to account for the stochastic effects of absorption due to intergalactic gas lying between the object being simulated and the observer . at present two intergalactic attenuation prescriptions are included in ` make_sed ` : madau ( 1995 ) and inoue et al .",
    "the attenuation operation can be expressed as @xmath11 where @xmath12 is the sed attenuated by intergalactic gas , @xmath7 is the dust - attenuated sed of eq .",
    "[ eq.dust-attenuation ] , and @xmath13 is the effective optical depth as specified by madau ( 1995 ) or inoue et al .",
    "this optical depth , @xmath13 , depends on the redshift of the source because the absorbers column density increases with distance and the absorption wavelengths are subject to the cosmological redshifts of the absorbers .",
    "the user can chose one of the two intergalactic attenuation prescriptions and also specify one or more attenuation strengths .",
    "the default absorption strength represents a typical line of sight through the universe , but sightlines that are less or more crowded can also be simulated .",
    "additionally , since the attenuation is redshift - dependent , one or more redshifts  representing the redshift(s ) of the object(s ) being simulated  need to be specified .",
    "the next step is to apply the effects of cosmological distance to the spectrum and thus transform it into the observed frame flux density distribution .",
    "this operation can be expressed as @xmath14 where @xmath15 is the luminosity distance .",
    "the @xmath16 expression in the numerator indicates that the spectrum s wavelength scale has been redshifted from the original , rest - frame wavelength to one at the desired redshift .",
    "the user can chose a desired cosmology by specifying the values for @xmath17 , @xmath18 , and @xmath19 , while the same single or multiple redshift values are used as for the intergalactic attenuation of eq .",
    "[ eq : intergalactic ] .      as the result of the above steps , ` make_sed `  contais a grid of redshifted and attenuated spectral density distributions .",
    "these seds can be saved to a file as a grid of spectra , or can be further processed to generate broadband seds by averaging ( sometimes called `` convolving '' in the field ) the spectra through system transmission curves , which can be provided by the user and can / should include the filter transmission profile , detector efficiency , and other wavelength - dependent throughput characteristics of the telescope+instrument system .",
    "for photon - counting systems , such as ccds and near - ir arrays , the procedure can be expressed as @xmath20 where @xmath21 is the system transmission curve for the @xmath22 filter and @xmath23 is the model s observer - frame flux density through that filter ( the subscript @xmath24 refers to  model \" as distinct from the observed  data \" flux densities to be encountered in  [ sec.fitting ] ) . the @xmath25 factor in both numerator and denominator accounts for the fact that the number of photons per unit flux varies with wavelength .",
    "the user can specify one or more transmission curves to be used ; a large number of common transmission curves is already supplied with ` make_sed `  and more can be generated by the user as simple ascii files . if the input spectrum @xmath26 is in units of erg / s / hz then the output of ` make_sed `  is in ab magnitudes , @xmath27 ( oke 1974 ) .",
    "the main end product of ` make_sed `  is a file that contains one galaxy model per line , with each model consisting of a number of @xmath28 magnitudes along with associated parameters such as redshift , @xmath9 value , galaxy stellar mass , etc .",
    "the number of models in the grid is @xmath29 , where @xmath30 is the number of color excess steps sampled , @xmath31 is the number of redshift steps , and @xmath32 is the number of input spectra ( the @xmath33 ) that were used .",
    "these input spectra carry with them information such as star formation history , metallicity , etc . , and the user can provide as few or as many input spectra as are desired .",
    "a typical ` make_sed `  output file may include 221 spectra ( the standard number provided for a given metallicity and star formation history by the gissel package of bruzual & charlot 2003 ) , several hundred redshift steps , and several tens of @xmath9 steps .",
    "this grid of models produced by ` make_sed `  can be used for exploring the expected magnitudes and colors of high - redshift objects , but more pertinently here it serves as one of the two ingredients ( the other being the observational data ) in determining the redshifts or physical properties of observed high-@xmath0 galaxies , as described in  [ sec.fitting ] .",
    "in addition to the model magnitudes grid , ` make_sed `  can produce a file that contains the full redshifted and attenuated spectra before the integration through system transmission curves ( i.e. , the end product of  [ sec.redshift_and_dimming ] ) .",
    "such spectra are not used directly in sed fitting (  [ sec.fitting ] ) but are useful for , e.g. , visualizing the seds of distant galaxies , as is illustrated in the left panels of figs .",
    "[ fig.fitexample ] and [ fig.ulfitexample ] (  [ sec.examples ] ) .",
    "` sedfit `  uses a maximum - likelihood approach to determine the best - fitting model and to establish confidence regions in parameter space .",
    "these tasks are performed by the program ` fit_sed ` . as its inputs ` fit_sed `  takes the magnitudes model grid produced by ` make_sed `  (  [ sec.flux-generation ] ) and a catalog file containing the observed magnitudes or flux densities .",
    "the format of the catalog file is flexible as long as it contains one object per line .",
    "operationally , ` fit_sed `  determines the best - fitting model for a given object by comparing the object s flux densities with the model flux densities which are obtained from the model grid file .",
    "the model that is the most likely , in the sense that it gives the lowest @xmath1  value , is deemed to be the best - fitting model .",
    "when fitting an object , ` fit_sed `  properly accounts for both detected and observed but undetected fluxes .",
    "when all the photometric data are detected flux measurements , the ` fit_sed `  compares a model with the observed data and determines the quality of the fit by means of the usual @xmath1  statistic , @xmath34 where @xmath23 is the model flux density through the @xmath22 bandpass , @xmath35 is the observed flux density that same bandpass , and @xmath36 is the uncertainty in the observed flux density .",
    "note that this uncertainty could include both the claimed observational photometric error and an additional term that captures an estimate of systematic uncertainty . `",
    "sedfit `  does in fact allow the user to specify a @xmath37 for each bandpass , in which case @xmath38 .    the quantity @xmath39 in eq .",
    "[ eq.chisq.body ] is the flux scaling between the model and the data which is determined analytically ( sawicki 2002 ) as @xmath40 the derivations of eq .",
    "[ eq.chisq.body ] and  [ eq.s.body ] are reviewed in the appendix .",
    "equation  [ eq.chisq.body ] yields the correct result when the object is detected in all the observed bandpasses but becomes ambiguous when one or more of the observed bandpasses yield such a non - detection",
    ". however , even non - detections can be useful or even critical ( identification of lyman break galaxies provides an obvious example in this respect ) in constraining models or ruling out portions of parameter space .",
    "consequently , rather than ignoring the information offered by such non - detections , or adopting the ad - hoc approach of assigning arbitrary fluxes to the non - detections , the current implementation of ` sedfit `  properly accounts for such data by using a modified version of the @xmath1  method .",
    "the derivation of this modified @xmath1  statistic is given in the appendix and yields @xmath41   df.\\end{aligned}\\ ] ] the first sum on the right - hand side in eq .",
    "[ eq.chisqul.body ] refers to detected bandpasses , indexed with @xmath42 , while the second sum accounts for those bandpasses , indexed with @xmath43 , that yielded upper limits ; here @xmath44 is the 1-@xmath45 flux detection treshold in the @xmath46 such bandpass , which ` fit_sed `  calculates from the @xmath47-@xmath45 values ( where @xmath47=3 , 5 , etc . )",
    "given in the data catalog .",
    "note that when all bandpasses yield detections , the second term in eq .",
    "[ eq.chisqul.body ] drops out and eq .",
    "[ eq.chisqul.body ] reduces to the familiar eq .",
    "[ eq.chisq.body ] , as expected .",
    "whereas the flux scaling @xmath39 could be determined analytically for the case when all bandpasses yielded detections ( eq .  [ eq.s.body ] ) , no such exact analytic expression exists for the case when non - detections are present . for this reason ,",
    "the integral in eq .",
    "[ eq.chisqul.body ] needs to be evaluated numerically , making the fitting of objects with non - detections significantly more computationally expensive than that of objects that are detected in all bandpasses .",
    "nevertheless , non - detections can be critical in ruling out parts of parameter space ( see   [ sec : ex.ulfitting ] for an example ) and thus the additional computational cost is often worthwhile in all situations .",
    "however , it is usually the case in astronomy that only limits are reported when flux measurements are below an assigned threshold , and the approach taken by eq .",
    "[ eq.chisqul.body ] provides a way to include that information in the fit . ] .",
    "the program ` fit_sed `  searches the model grid to find the model that minimizes @xmath1  ( as defined by eq .",
    "[ eq.chisqul.body ] ) .",
    "two search algorithms are implemented in the standard release of ` fit_sed `  and the user is free to choose one or the other .",
    "the simpler and most robust,brute - force \" fitting approach computes @xmath1  for every model in the grid and then unambiguously identifies the one with the lowest @xmath1  value .",
    "this approach is robust but  because of the need to calculate @xmath1  for every model in the grid  not particularly efficient .",
    "however , in many applications it is sufficiently fast while its robustness against effects such as secondary minima as well as its ability to produce complete @xmath1  maps of the model space are its advantages .",
    "the second available option is to perform a downhill search of the model parameter space starting from a random position in the model grid . because the downhill search can become lodged in local minima in parameter space , ` fit_sed `",
    "can repeat the downhill search several times per object , starting with a new random position each time .",
    "the user specifies the number of searches per object ; experiments show that @xmath4810 repeats per object are typically sufficient to ensure that the absolute minimum is found .",
    "because of its speed , this  downhill search with random repeats \" option is preferable when extremely large sets of objects are to be fitted , or  because of the computationally - expensive nature of evaluating non - detections ( eq .  [ eq.chisqul.body ] )  when many objects with upper limits are present .",
    "additional search algorithms ( such as simulated annealing ) have been implemented within ` fit_sed `  but it was found that the two standard approaches ( the brute - force calculation for every model in the grid and the downhill search with random repeats ) are adequate in the vast majority of situations ; consequently at present only these two algorithms are included in the standard distribution of ` sedfit ` .",
    "the model with the lowest @xmath1  value is by definition the most likely to have produced the observed data and is adopted as the `` best - fitting '' model .",
    "the values of the parameters associated with this model ( such as redshift , age , spectral type , etc . )",
    "are then adopted as the best - fitting parameter values .",
    "uncertainties on the values of parameters in the best - fitting model can be established by ` fit_sed `  in one of several ways .",
    "the first way is to make use of the monte carlo simulations feature of ` fit_sed ` . here , ` fit_sed `  refits each object a large , user - specified number of times ( e.g. , 200 or 1000 ) , but with each realization the photometry in each band is randomly perturbed from the actual value by drawing from a gaussian distribution with standard deviation dictated by the object s photometric uncertainty in that band .",
    "note that for operational convenience the perturbation is performed on the model photometry ; this is mathematically equivalent to perturbing the observed data and is consistent with the fundamental principle that underlies the @xmath1 formalism .",
    "the distribution in parameter space of the best fits to the perturbed photometry realizations then defines the uncertainty ranges on the parameters of the true best - fit model . `",
    "sedfit `  reports the uncertainties on each parameter in its tabulated output , and the individual monte carlo results can also be saved to a file for establishing confidence contours (  error contours \" ) in multi - parameter space .",
    "the monte carlo - based uncertainties work when all the photometric bands are detected as well as in the case when some bands are undetected .",
    "an alternative , faster way , that can be used when the full grid of models has been fit ( i.e. , the  brute - force \" fit ,  [ sec.finding-best-fit ] ) is to use the @xmath1  map produced during the fitting process .",
    "the offset between each model s @xmath1  value from the @xmath1  of the best - fitting model , @xmath49@xmath1 , is a measure of probability of the corresponding model .",
    "on the basis of this offset the one - dimensional uncertainties on each parameter as well as full confidence contours in multi - parameter space can be established .",
    "the @xmath49@xmath1  level that corresponds to a desired confidence level for the number of free parameters available can be taken from theory ( e.g. , press et al .",
    "2007 ) or can be established empirically for a given dataset using a representative sample of monte carlo simulations .",
    "the program ` fit_sed `  produces one standard and several optional output files . the standard output file lists , for each object in the input catalog , the best - fitting model and its associated parameters and their one - dimensional uncertainties .",
    "the user can specify which best - fit model parameters to report in the standard output file and also which parameters from the input data catalog to propagate into that file .",
    "the three optional outputs are : a file that contains the fit results for all the monte carlo realizations ; a @xmath1  map for each object in the input file ; and a file that contains the shell - style command - line input which , when supplied to ` make_sed ` , will result in the production of the redshifted and dust - attenuated spectra that correspond to the best - fit models .",
    "all these optional outputs can be used to illustrate the quality of the sed fit ; some examples of the uses of such outputs are given in the figures in  [ sec.examples ] .",
    "this section illustrates the use of ` sedfit `  by means of three examples : ( 1 ) the basic sed fitting of a high-@xmath0 galaxy , ( 2 ) sed fitting that makes use of photometric non - detections , ( 3 ) two - dimensional sed mapping of high-@xmath0 galaxies , and ( 4 ) simulations of photometric redshift performance . of course , ` sedfit `  is not restricted to just these four specific tasks and many additional examples of ` sedfit `  applications may be found in the papers listed in  [ sec.introduction ] .      the determination of quantities such as stellar mass , extinction , age , etc .  constitutes `",
    "sedfit ` s main raison dtre . as an illustration , an example of the results of the fitting of a high-@xmath0 galaxy",
    "is given here .",
    "figure  [ fig.fitexample ] shows the photometric properties of a faint color - selected lyman break galaxy in the hubble deep field and illustrates various aspects of ` sedfit ` s output , including the best - fitting spectral model ( left panel ) and confidence regions in parameter space ( middle and right panels ) determined in two different ways .",
    "although , for simplicity , fig .  [ fig.fitexample ] presents the results for a single galaxy , ` sedfit `  is designed to routinely process not just individual objects but catalogs of galaxies .",
    "further examples of such work can be found in sawicki & yee ( 1998 ) , yabe et al .",
    "( 2009 ) , and sawicki ( 2012 ) .          `",
    "sedfit ` s ability to include non - detections in the fitting process is illustrated in fig .",
    "[ fig.ulfitexample ] . in this example",
    "the issue at stake is constraining the age of a stellar population of a @xmath0=1.5 object .",
    "the left panel of fig .",
    "[ fig.ulfitexample ] shows both observations that yielded detections ( @xmath50 ) and those that resulted only in upper limits ( @xmath51 ) .",
    "when only the detected points are used in the fit , the data altogether fail to constrain the age of the object : the full range of ages between very young ( @xmath52 yr ) and that of the age of the universe at the object s redshift is allowed , as is shown by the gray contour in the right panel of fig .",
    "[ fig.ulfitexample ] .",
    "in contrast , when the non - detections are included in the fit ( using the full eq .  [ eq.chisqul.body ] ) , a more useful constraint on the age is possible : at the 68% confidence level , the age is younger than @xmath53 yr ( black contour ) .",
    "the formal maximum - likelihood fit ( eq .  [ eq.chisqul.body ] ) gives a statistically correct way to incorporate the information contained in the non - detections in a way that a  @xmath54-by - eye \" approach of inspecting the models in the left panel of fig .",
    "[ fig.ulfitexample ] does not allow .",
    "the fact that some permissible models ( black curves ) in the left panel of the figure appear higher than the 1@xmath45 @xmath51 limits is simply because such models are indeed permitted by the data .",
    "the most tempting  @xmath54-by - eye \" analysis here would have missed these older but permissible models to give very low but unrealistic constraints on the age .",
    "in contrast , the proper maximum - likelihood treatment that uses eq .",
    "[ eq.chisqul.body ] gives constraints that are both more accurate , automatic , and reproducible .      `",
    "sedfit `  can also be used to perform spatially - resolved , pixel - by - pixel sed fitting when the target galaxies are sufficiently resolved in the images . operationally , the procedure is a simple modification of the procedure used to fit a catalog of individual objects (  [ sec : ex.single ] ) . in this approach ,",
    "each pixel of a galaxy is fit as if it were an individual object and then the resulting lists of best - fit values are reassembled into parameter maps ( e.g. , abraham et al .",
    "1999 ) .",
    "figure  [ fig.spatially-resolved ] illustrates the results of this procedure applied to two lyman break galaxies in the hubble deep field . here , hst @xmath55  images of spectroscopically - confirmed @xmath0@xmath482.3 galaxies have been smoothed to a common psf to guard against artificial color gradients , their individual pixels fit using ` sedfit ` , and the results reassembled into spatial maps of sfr , stellar mass , color excess @xmath9 , and age ( palmer 2010 ) .",
    "the resulting maps reveal interesting spatial offsets between regions of ongoing star formation and more quiescent regions of older stars .",
    "best - fit parameter maps for two hubble deep field @xmath0@xmath482.3 lyman break galaxies whose individual pixels were fit using ` sedfit ` .",
    "each panel is 30 pixels , or 1.2 , on the side , which corresponds to @xmath4810  kpc at these redshifts .",
    "these maps suggest that in both galaxies unobscured older stars are offset from younger , more dust - obscured regions of recent star formation ( palmer 2010 ) .",
    ", width=302 ]       photometric redshift simulations for the euclid dark energy mission performed using ` sedfit ` .",
    "the intensity of color in the figure corresponds to the number of galaxies in each @xmath56@xmath57 bin , with brighter colors corresponding to more objects .",
    "the numbers in the lower right of the figure indicate ( top to bottom ) number of galaxies per square arcminute , the median redshift , the photometric redshift bias , and the fraction of catastrophic redshift failures , defined here as the fraction of objects outside the dashed lines ( see  [ sec : ex.photz_sim ] and sorba & sawicki 2011 for additional details ) .",
    "analysis of simulations like these provides the ability to fine - tune the design of photometric redshift surveys . ,",
    "width=302 ]    ` sedfit `  can be used to estimate photometric redshifts to distant galaxies ( e.g. , sawicki et al .",
    "1997 ; sawicki & malln - ornelas 2003 ; sorba & sawicki 2010 ) and also to perform simulations of photometric redshift performance ( e.g.  sorba & sawicki 2011 ) .",
    "figure  [ fig.zzsims ] shows an example of such simulations : the specific case here shows the expected fidelity of the photometric redshift performance of the proposed euclid dark energy mission when augmented by the addition of @xmath58-band photometry to the planned euclid filter set .",
    "in this example , photometry for several hundred thousand simulated galaxies was generated using ` make_sed ` , drawn from a range of spectral templates and using a realistic redshift distribution .",
    "these galaxies photometry was then perturbed according to the expected photometric uncertainties . finally , the `` observed '' galaxies were fit using ` fit_sed `  with the same spectral templates as used in their generation .",
    "figure  [ fig.zzsims ] shows the `` observed '' photometric redshift vs.  the input `` spectroscopic '' redshifts ; because the same spectral template set was used to generate the artificial galaxies as to sed - fit them , the scatter in the `` observed '' redshifts from the diagonal line results purely from photometric uncertainties in the data .",
    "analysis of this type can be useful when designing photometric redshift surveys .",
    "given observational photometric data and a set of model spectra , sed fitting can produce useful insight into the properties of distant objects . in this regard ,",
    "the most commonly - sought parameters are photometric redshifts , galaxy stellar masses , amount of interstellar extinction , dust - corrected star formation rates , and ages of stellar populations . the technique has now been widely used and forms a standard part of the toolbox of extragalactic astronomy .    despite the apparent simplicity of sed fitting and the clear usefulness of the physical properties that it purports to derive from pure photometric data , it is important to use the technique with caution since there are a number of issues that can bias the results .",
    "some of these limitations are discussed in the following paragraphs .    first ,",
    "no matter how good the spectral models , the observational data need to be of the right quality .",
    "this means not only a sufficiently large and well - chosen set of photometric bandpasses , but also accurate photometry , since otherwise systematic errors in , e.g. , photometric calibration , will propagate into systematic errors in the estimated parameters such as stellar masses and star formation rates . in this respect",
    "it is crucial to realize that accurate colors ( flux density ratios ) are far more important than the absolute calibration of the overall spectrum : for example , a 10% offset in overall , across - all - bands calibration will result in only a 10% offset in stellar mass and star formation rate , but a 10% offset in _ relative _ photometry between bands can result in far worse and even catastrophic inaccuracies in the fitted quantities .",
    "careful matching of photometric apertures across bandpasses to ensure accurate flux density ratios is thus essential , including procedures to account for psf differences between bands .",
    "a second set of limitations stems from the inability of sed fitting to constrain certain key properties . a well - known limitation ( e.g. , sawicki & yee 1998 ; papovich et al .  2001 )",
    "is the inability to constrain star formation histories from the typical broadband photometry available for distant objects .",
    "the degeneracy in star formation histories propagates into degeneracies in other fit parameters , most notably the star formation rates .",
    "there is no good way around this issue given limited photometric data and thus one simply has to be aware of this limitation when interpreting fitting results . in this respect",
    "it is perhaps wise to perform relative  rather than absolute  measurements , comparing results across similarly - selected samples of galaxies fit with a single set of models rather than trusting the absolute results of the best - fit parameters .",
    "a further limitation is the sed fitting technique s focus on the most luminous stellar population present in the object being fitted .",
    "this limitation most commonly manifests itself in the inability to properly account for an older stellar population when a young population is present .",
    "the limitation stems from the fact that old stellar populations are faint in rest - frame uv compared to young populations that are dominated by luminous high - mass stars .",
    "old stellar populations , if they exist , will thus often be missed in the glare of even a sprinkling of bright young stars .",
    "this effect can be critical since such old , undetected underlying stellar populations can contain significant masses of stars , potentially several times the mass of the young detected populations .",
    "an additional limitation stems from the input spectra used to generate the model templates : the results of the sed fitting will be only as good as these spectra . while a number of excellent stellar population models is now available , significant differences between these models remain and suggest that our understanding of stellar populations is still not perfect .",
    "the resulting estimates of galaxy physical parameters will thus carry associated systematic errors . in light of such differences",
    "it is perhaps wise to again rely on relative comparisons between fit galaxy properties ( masses , star formation rates , etc . ) rather than on the absolute values of these properties .",
    "a related point is that sed fitting will produce a best - fitting model regardless of whether that model is or is not a good match to the observations .",
    "it is therefore wise to inspect the goodness - of - fit parameter , @xmath1 , to ensure that the best - fitting model is indeed a well - fitting model ( the two are not synonymous ! ) .",
    "further , irrespective of how good a @xmath1  is produced , even a well - fitting best - fit model may not be a true reflection of reality since degeneracies in fitting space exist and the sed - fitting procedure may preferentially choose a slightly better - fitting , but ultimately incorrect model over a worse - fitting but correct one .",
    "consideration of such degeneracies should be an important aspect of interpreting sed - fitting results .    despite systemic limitations such as those discussed above , sed",
    "fitting has proven to be a useful and popular technique in extragalactic research .",
    "it provides us with a way to estimate key quantities of interest , such as photometric redshifts , galaxy stellar masses , amount of extinction due to dust , dust - corrected star formation rates , and ages of stellar populations ; and it lets us do so for a large number of objects from a single set of common observations . the technique has served us in this role for over a decade now and will likely continue to be a key tool in our toolbox well into the coming era of ever more powerful observational facilities and ever larger datasets .",
    "i am grateful to huan lin who contributed code to an earlier version of ` sedfit ` , and ikuru iwata , who implement the inoue et al .",
    "( 2005 ) intergalactic opacity function in the present version of the software ; to michael palmer , bobby sorba , kiyo yabe , and suraphong yuma for requests that resulted in extending the capabilities of this software ; to bobby sorba for allowing me to show the results of our euclid photo - z simulations in fig .",
    "[ fig.zzsims ] and to michael palmer for letting me display results from his undergraduate honours thesis in fig .",
    "[ fig.spatially-resolved ] .",
    "i also thank liz arcila - osejo , anneya golob , michael palmer , taro sato , barbara sawicki , jerzy sawicki , bobby sorba , kiyo yabe , and suraphong yuma and the anonymous referee for comments that improved the quality of this manuscript .",
    "finally , this software has evolved over a number of years , and thus funding from several agencies has contributed to its development : i gratefully acknowledge support from the natural sciences and engineering research council ( nserc ) of canada , the canadian space agency ( csa ) , nasa , an international long - term visitorship from the japan society for the promotion of science ( jsps ) , and the atlantic computational excellence network ( acenet ) .",
    "` sedfit ` s model - fitting program , ` fit_sed `  uses a maximum - likelihood approach to identify the best - fitting model and determine confidence regions in parameter space .",
    "this appendix first reviews the derivation of the usual @xmath1  formula as applied to the particular case of sed fitting and then uses a similar approach to derive a variant of @xmath1  that is appropriate when some of the data are non - detections .    the standard way to approach the development of a maximum - likelihood fitting method is to assume that a given model underlies the observed data and the data are drawn from that model but are perturbed by gaussian errors ( see , e.g. , press et al .",
    "in other words , the question one asks is ",
    "what is the probability that the observed data could have occurred if the data were drawn from the model that s being considered ? \"",
    "if the object has been detected in all photometric bands then the approach outlined above produces the well - known @xmath1  formalism , as is shown below ( see , e.g. ,  15.1 of press et al .",
    "2007 , for a general @xmath1  derivation ) . for a single band @xmath42 ,",
    "the probability that a set of observations has been produced from a given model is @xmath59 \\delta f , \\ ] ] where @xmath35 is the observed ( data ) flux density in the @xmath42th band , @xmath36 is its standard deviation ( i.e. , uncertainty ) , and @xmath60 is the model flux density in the same band .",
    "the quantities involved are illustrated in fig .",
    "[ fig.probabilities](a ) .",
    "note that we have separated the model flux density into two components : the quantity @xmath39 is the normalization of the model , which , for a given model , is the same across all the bands @xmath42 , while @xmath23 contains the information about the spectral shape of the model .",
    "this separation allows us to considerably speed up the numerical handling of the calculation , as is shown below ( eq .",
    "[ eq.s ] ) . in practice ,",
    "having @xmath23 distinct from the normalization @xmath39 is also convenient because it is @xmath23 that is produced from the spectral models ( eq .  [ eq.fmi ] ) , while @xmath39 contains the information about the normalization adjustment that best brings such a model into match with the observed data and gives the multiplicative scaling that links the model s scaleable parameters  such as luminosity , stellar mass , and star formation rate  with those in the galaxy under consideration .",
    "the overall probability of the data in _ all _ the observed bandpasses being drawn from the model in question is then proportional to the product of the individual probabilities , @xmath61 next , taking the logarithm of eq .",
    "[ eq.product ] gives @xmath62 the second sum in eq .",
    "[ eq.probabilities_i ] is a constant and thus maximizing the probability is just equivalent to minimizing the first sum , @xmath63 the derivation thus far has followed the standard derivation of the @xmath1  formula as a maximum likelihood estimator with the assumption of normally distributed errors ( e.g. , press et al .",
    "2007 ) .",
    "the normalization factor @xmath39 of the best - fitting model can be derived analytically and doing so can considerably speed up the numerical calculation of @xmath1 .",
    "this analytic solution can be achieved by minimizing the @xmath1  of eq .",
    "[ eq.chisq ] by taking the partial derivative @xmath64 and setting it to zero ( sawicki 2002 ) . doing so yields the expression @xmath65 which exactly gives the appropriate scaling @xmath39 of the model . identifying the model with the smallest @xmath1  from among the model suite",
    "gives the most likely ( i.e. , best - fitting ) model in the case when the object is detected in all the observed bands .",
    "for the case where the object is not detected in one or more of the observed bands we can proceed as above but with replacing detections with upper limits in eq .",
    "[ eq.probability_i][eq.chisq ] . in the case of a non - detection in the band @xmath43 ,",
    "the probability that the observation in that band is drawn from a given model is @xmath66   df,\\ ] ] where @xmath67 is the upper limit ( i.e. , sensitivity ) of the observation in the @xmath43th band . in analogy to eq .",
    "[ eq.product ] , the probability of the data ( detections and non - detections ) across all the observed bandpasses being drawn from the given model is then the product of the individual probabilities , @xmath68 the subscripts @xmath42 indicate those bands which have yielded detections , while the subscripts @xmath43 are for the bands with non - detections .",
    "the equivalent of eq .",
    "[ eq.probabilities_i ] then is @xmath69   df,\\ ] ] and , in analogy with eq .",
    "[ eq.chisq ] , maximizing the likelihood that the observed dataset ( detections and non - detections ) is drawn from the given model is equivalent to minimizing the quantity",
    "@xmath70   df.\\ ] ] note that if all the observed bands yielded detections then the last term drops out and eq .",
    "[ eq.chisqul ] reduces to the form of eq .",
    "[ eq.chisq ] , as one would expect .    for computational convenience , the integral in eq .",
    "[ eq.chisqul ] can be recast in terms of the error function , @xmath71 , so that @xmath72    \\right\\}.\\ ] ] finding the most likely model requires evaluating eq .",
    "[ eq.chisqulerf ] to identify @xmath73 , the smallest value of @xmath1 . in the case when all the bands yield detections finding @xmath73",
    "can be accelerated by optimizing the model scaling factor @xmath39 using eq .",
    "[ eq.s ] . in the present case of non - detections",
    "there is no simple equivalent of eq .",
    "one approach is then to find the @xmath39 that s optimal for a given model by numerically exploring eq .",
    "[ eq.chisqulerf ] .",
    "alternatively , in analogy with eq .",
    "[ eq.s ] , setting @xmath74 gives the condition for the optimal @xmath39 for a given model : @xmath75 ^ 2                 \\right\\ }               }             }          {              { \\sigma_j               \\left\\ {                  1 + { \\rm erf }                      \\left [                                                        ( f_{lim , j } - s f_{m , j } ) / \\sqrt{2 } \\sigma_j                          \\right ]              \\right\\ } }          } = 0.\\ ] ] finding the root of eq .",
    "[ eq.sul ] then gives the optimal @xmath39 for the model .",
    "this root can be obtained numerically using a variety of root - finding methods .",
    "the present implementation of ` sedfit `  uses simply numerically searches for a model s optimal @xmath39 in eq .",
    "[ eq.chisqulerf ] .",
    "bertin , e. , & arnouts , s.  1996 , , 117 , 393 bruzual a. , g. & charlot , s. 1993 , , 405 , 538 bruzual , g.  & charlot , s.  2003 , , 344 , 1000 calzetti , d. 1997 , in aip conf .",
    "408 , the ultraviolet universe at low and high redshift , ed .",
    "waller ( new york : aip ) , 403                                      sawicki , m. , stevenson , m. , barrientos , l.f .",
    ", gladman , b. , malln - ornelas , g. , & van den bergh , s. 2005 , , 627 , 621 sawicki , m.   & thompson , d. 2006a , , 642 , 653 sawicki , m.   & thompson , d. 2006b , , 648 , 299 sawicki , m. 2012 , , 421 , 2187 .",
    "shapley , a.e . ,",
    "steidel , c.c . ,",
    "adelberger , k.l . , & pettini , m. 2001 , , 562 , 95    sorba , r.  & sawicki , m. 2010 , , 721,1056 sorba , r.  & sawicki , m. 2011 , , 123 , 777 thompson , d. , kelly , a.e . ,",
    "sawicki , m. , soifer , b.t . ,",
    "& matthews , k. 1999 , in asp conference series 191 , photometric redshifts and the detection of high redshift galaxies , eds .",
    "r.  weymann , l.  storrie - lombardi , m.  sawicki , and r.  brunner , 291"
  ],
  "abstract_text": [
    "<S> this paper describes ` sedfit ` , the earliest  but continually upgraded  software package for spectral energy distribution fitting ( sed fitting ) of high - redshift photometric data , and the only one to properly treat non - detections . </S>",
    "<S> the principles of maximum - likelihood sed fitting are described , including formulae used for fitting both detected and un - detected ( upper limits ) photometric data . </S>",
    "<S> the internal mechanics of the ` sedfit `  package are presented and several illustrative examples of its use are given . </S>",
    "<S> the paper concludes with a discussion of several issues and caveats applicable to sed - fitting in general . </S>"
  ]
}