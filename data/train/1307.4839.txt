{
  "article_text": [
    "we are interested in overland flow simulations . for this kind of flow simulation ,",
    "several methods are used from empirical models to physically based models .",
    "two physical models are often used to model overland flow kinematic ( kw ) and diffusive wave ( dw ) equations @xcite , @xcite .",
    "but following @xcite , @xcite , @xcite , we choose to use the shallow water ( saint - venant @xcite ) physical model .",
    "indeed kw and dw models may give poor results in terms of water heights and velocities in case of mixed subcritical and supercritical flows . despite the computational cost ,",
    "shallow water model is mandatory .",
    "maccormack scheme is widely used to solve shallow water ( sw ) equations @xcite , @xcite , @xcite .",
    "but it neither guarantees the positivity of water depths at the wet / dry transitions , nor preserves steady states ( not well - balanced @xcite ) as noticed in @xcite . in industrial codes",
    "( isis , canoe , hec - ras , mike11 , ... ) , sw equations are often solved under non - conservative form @xcite with either preissmann scheme or abbott - ionescu scheme .",
    "thus transcritical flows and hydraulic jumps are not solved properly . in order to cope with all these problems",
    ", we have developed fullswof_2d ( full shallow water equations for overland flow ) an object - oriented c++ code ( free software and gpl - compatible license cecill - v2 ) in the framework of the multidisciplinary project methode ( see @xcite and http://www.univ-orleans.fr/mapmo/methode/ ) .",
    "the source code is available at http://www.univ - orleans.fr / mapmo / soft / fullswof/. this software is based on the physical model of shallow water equations ( saint - venant system @xcite ) for the water runoff , coupled with green - ampt s infiltration model @xcite .",
    "the set of shallow water equations is solved thanks to a well - balanced finite volume method .",
    "this enables to catch and to preserve steady states such as puddles and lake at rest .",
    "moreover the method preserves the positivity of the water height .",
    "validations of fullswof_2d have already been performed on analytical benchmarks ( swashes @xcite ) , on experimental data and on real events at small scales ( parcels @xcite ) .",
    "we now aim at simulating at bigger scales such as watershed , river valley or at small scales with fine details .",
    "thus the computing time becomes bigger and the code needs to be parallelized .",
    "we want to compare two approaches : the first one is a `` classical '' approach based on a master - slave architecture using mpi and the second one uses skeletal algorithms ( skelgis , skeletons for geographical information systems , which is under development by hlne coullon , a cifre phd student with go - hyd company ) .",
    "these approaches will be compared both in terms of performance and scalability and the advantages of each choice will be briefly discussed .",
    "as in @xcite , we model overland flow thanks to the 2d shallow water equations ( sw2d ) . shallow water equations ( or saint - venant system )",
    "have been proposed by adhmar barr de saint - venant in 1871 in order to model flows in channels @xcite in one dimension in space .",
    "nowadays , they are used to model flows in various contexts , such as : overland flow @xcite , rivers @xcite , flooding @xcite , dam breaks @xcite , nearshore @xcite , tsunami @xcite .",
    "these equations consist in a nonlinear system of partial differential equations ( pde - s ) , more precisely conservation laws describing the evolution of the height ( @xmath0 [ l ] ) and the horizontal components of the vertically averaged velocity of the fluid ( @xmath1 [ l / t ] ) as illustrated on figure [ sw2d - fig]-a .",
    "this complete set of conservation laws writes @xmath2 where    * @xmath3 is the gravity constant ; * @xmath4 is the topography [ l ] and we denote by @xmath5 ( resp .",
    "@xmath6 ) the opposite of the slope in the @xmath7 ( resp .",
    "@xmath8 ) direction .",
    "erosion is not considered here , so the topography is a fixed function of space .",
    "equations might be added to sw2d model to take erosion effect into account .",
    "we get systems such as saint - venant exner and hairsine & rose models ( for more details see @xcite ) ; * @xmath9 [ l / t ] is the rain intensity ; * @xmath10 [ l / t ] is the infiltration rate .",
    "it is given by another model ( such as green - ampt @xcite , richards @xcite , ... ) ; * and @xmath11 is the friction force vector .",
    "it may take several forms , depending on soil and flow properties . in hydrological and hydraulics models , two families of friction laws are mainly encountered .",
    "they are based on empirical considerations . on one hand",
    ", we have the family of manning - strickler s friction laws @xmath12 @xmath13 ( resp .",
    "@xmath14 ) , where @xmath15 ( resp .",
    "@xmath16 ) is the manning s coefficient [ l@xmath17 t ] ( resp .",
    "strickler s coefficient [ l@xmath17 t ] ) . on the other hand",
    ", we have the law of darcy - weisbach s and chzy s family @xmath18 @xmath19 ( resp .",
    "@xmath20 ) , where @xmath21 ( resp .",
    "@xmath22 ) is the dimensionless darcy - weisbach s coefficient ( resp .",
    "chzy s coefficient [ l@xmath23/t ] ) .",
    "the friction may depend on the space variable , especially on large parcels and watersheds .",
    "values of friction coefficients depend on the considered type of soil and are tabulated in references such as @xcite .",
    "system will be solved on a cartesian grid thanks to a method of lines .",
    "thus the numerical strategy consists in choosing a numerical method adapted to the properties of the shallow water system in 1d ( sw1d ) .",
    "then the generalization to sw2d is straightforward .",
    "so in next sections , we will consider sw1d system .",
    "as previously argumented , we place ourselves in the one - dimensional case .",
    "sw1d system writes @xmath24    the left - hand side of system is a transport operator , corresponding to the flow of an ideal fluid in a flat channel , without friction , rain or infiltration .",
    "this corresponds to the model introduced by saint - venant @xcite which contains several flow properties . to emphasize these properties , we rewrite the one - dimensional homogeneous system under vectors form @xmath25 with @xmath26 the flux of the equation and @xmath27 [ l@xmath28/t ] the discharge by unit of width .",
    "the transport property of system is clearer under the following nonconservative forms @xmath29 where the jacobian matrix @xmath30 is the matrix of transport coefficients . when @xmath31 , matrix @xmath32 is diagonalizable and its eigenvalues are @xmath33 system is strictly hyperbolic .",
    "the eigenvalues are the velocities of the surface waves and thus are basic characteristics of flows .",
    "notice that these eigenvalues collapse in one when @xmath34 ( for dry zones ) . in that case , system is no longer hyperbolic which is difficult to deal with both from theoretical and numerical levels . getting a numerical scheme that preserves",
    "the water height positivity is a necessity .",
    "eigenvalues of system allow to make a classification of flows , based on the relative values of the velocities of the waves @xmath35 and of the fluid @xmath36 .",
    "indeed if @xmath37 , the characteristic velocities have opposite signs and flow informations propagate both upward and downward .",
    "the flow is said to be subcritical or fluvial . when @xmath38 , the flow is supercritical or torrential and all informations propagate downstream .",
    "this has to be taken into account both for the numerical methods ( upwinding ) and the boundary conditions .",
    "numerically , boundary conditions are expected to provide numerical fluxes at the boundaries of domain .",
    "these are required in order to update @xmath39 on the extreme cells to the next time level .",
    "the boundary conditions may result in direct prescription of the numerical fluxes at the boundaries .",
    "alternatively , we may prescribe the values of @xmath39 on the ghost cells . in this way ,",
    "the riemann problems at the boundaries are solved and the corresponding fluxes are computed as done for the interior cells .",
    "the values of @xmath39 on ghost cells can be computed in function of flow regime thanks to the riemann invariants ( which remain constant along the corresponding characteristic line ) . for subcritical flow ,",
    "the characteristic @xmath40 leaves the domain while the characteristic @xmath41 enters the domain .",
    "thus for numerical simulations , we impose one variable ( @xmath42 or @xmath43 ) for fluvial inflow / ouflow . in contrary , both variable must be prescribed in case of supercritical inflow whereas free boundary conditions are considered for supercritical outflow .",
    "we refer to @xcite for more details .    with the presence of the source terms",
    ", an other main property has to be considered : the occurrence of steady states or stationary solutions .",
    "these particular flows are studied in next section .",
    "steady states solutions correspond to stationary flows , _",
    "i.e. _ solutions that satisfy @xmath44 system reduces in @xmath45 to our knowledge there is no scheme designed to preserve these stationary flows . if we consider no rain @xmath46 , no infiltration @xmath47 and no friction @xmath48 , system reduces in @xmath49 we recover bernoulli s law @xmath50 where @xmath51 is the free surface water level .",
    "several schemes have been designed to preserve steady states . in general , these methods are costly in term of implementation and computation because , for example , they lead to solve a third order polynomial and the appropriate root must be selected depending on the type of flow ( see _ e.g. _ @xcite ) . moreover , the preserving of steady states becomes more complicated when we require also the positivity preserving of water depths at numerical level . as the last property is a compulsory property for the applications we are interested in ( overland flow simulations ) , we limit ourselves to numerical schemes that preserve the particular steady state corresponding to equilibrium of lake at rest @xmath52 in that case , we have hydrostatic balance between the hydrostatic pressure and the gravitational acceleration down the inclined bottom @xmath53 .    in 1994 ,",
    "bermdez and vzquez @xcite are the first to identify the difficulty to preserve this steady state .",
    "schemes preserving this equilibrium have the conservation property or c - property ( introduced in @xcite ) .",
    "they obtained such a numerical method by modifying the roe scheme .",
    "the topography source term is upwinded thanks to a projection on the eigenvalues of jacobian matrix of the flux . since @xcite",
    ", schemes which preserve exactly at least the hydrostatic equilibrium at a discrete level are called well - balanced schemes .",
    "we can find a lot of well - balanced schemes for sw1d in the literature @xcite .    in case of rainfall overland flows",
    ", we have the occurrence of wet / dry transitions and small water heights . to simulate that kind of events , we need a robust and positive well - balanced scheme .",
    "thus we have chosen a finite volume scheme based on the hydrostatic reconstruction ( introduced in @xcite and @xcite ) , that we will detail in next section .",
    "as argued in the previous section , the numerical method will be presented in one dimension ( extension to 2d being straightforward on cartesian grids thanks to the method of lines ) .",
    "a finite volume discretization of sw1d , , writes @xmath54\\label{sw1dscheme}\\ ] ] with @xmath55 ( resp .",
    "@xmath56 ) the space ( resp . time ) step and @xmath57 the left and right modifications of the numerical flux @xmath58 for the homogeneous problem ( see section [ sec : flux ] ) @xmath59 the values @xmath60 and @xmath61 are obtained thanks to two consecutive reconstructions .",
    "firstly a muscl reconstruction @xcite is performed on @xmath36 , @xmath42 and @xmath51 in order to get a second order scheme in space ( see section [ sec : muscl ] ) .",
    "this gives us the reconstructed values @xmath62 and @xmath63 .",
    "secondly , we apply the hydrostatic reconstruction @xcite on the water height which allows us to get a positive preserving well - balanced scheme @xmath64 we introduce @xmath65 and a centered source term is added to preserve consistency and well - balancing @xcite @xmath66 we have to insist on the positivity and the robustness of this method .",
    "the rain source term is treated explicitly and the infiltration rate is obtained thanks to the green - ampt model @xcite ( see section [ greenampt ] ) .      in this step ,",
    "the friction term is taken into account with the following system @xmath67 this system is solved thanks to a semi - implicit method ( as in @xcite ) , which writes for the darcy - weisbach s law @xmath68 where @xmath69 , @xmath70 and @xmath71 are the variables from the convective step .",
    "this method allows to preserve stability ( under a classical cfl condition ) and steady states at rest .",
    "finally , these two steps are combined in a second order tvd runge kutta method which is the heun s predictor - corrector method @xcite .",
    "it writes @xmath72 where @xmath73 is the right part of .      about the homogeneous flux @xmath74",
    ", we can use any consistent numerical flux , for example the one of godunov , rusanov , hll , roe or the one obtained by the kinetic or the relaxation methods . in this work",
    ", we adopted the harten lax van leer ( hll ) flux @xcite which is known to be a simple and efficient solver for both accuracy and implementation aspects ( see  @xcite ) @xmath75 with two parameters @xmath76 which are the approximations of slowest and fastest wave speeds respectively .",
    "we refer to @xcite for further discussion on the wave speed estimates . in this paper , we use @xmath77 where @xmath78 and @xmath79 are the eigenvalues of sw1d . in practice",
    ", we use a cfl condition @xmath80 at second order and @xmath81 at first order , with @xmath82 where @xmath83 is the number of space cells . at second order ,",
    "variables @xmath84 in are replaced by the reconstructed values @xmath85 and @xmath86 ( detailed in next section ) .",
    "we define the muscl reconstruction of a scalar function @xmath87 ( monotonic upwind scheme for conservation law , see @xcite ) by @xmath88 with the operator @xmath89 and the minmod limiter @xmath90 as mentioned previously , the muscl reconstruction is performed on @xmath36 , @xmath42 and @xmath51 , then we deduce the reconstruction of @xmath53 . in order to keep the discharge conservation , the reconstruction of the velocity has to be modified as what follows @xcite @xmath91 thus , we recover the following conservation properties @xmath92      infiltration is computed at each cell by using a modified green - ampt model @xcite .",
    "the soil water movement is assumed to be in the form of an advancing front ( located at @xmath93 [ m ] ) that separates a zone still at the initial soil moisture @xmath94 from a saturated zone with soil moisture @xmath95 ( as illustrated on figure [ sw2d - fig]-b . at time @xmath96",
    ", infiltration capacity , @xmath97 [ m / s ] , is calculated thanks to @xmath98 where @xmath99 is the wetting front capillary pressure head , @xmath100 the hydraulic conductivity at saturation , @xmath101 the overland flow water height ( obtained from the sw2d ) and @xmath102 the infiltrated water volume .",
    "thus we have the infiltration rate ( necessary to couple sw2d with green - ampt model ) @xmath103 and the infiltrated volume @xmath104 where @xmath56 is the time step fixed by the cfl stability condition ( see section [ sec : flux ] ) .",
    "the name fullswof_2d stands for `` full shallow water equations for overland flow in two dimensions of space '' .",
    "it is a c++ code ( free open source software under the gpl - compatible license cecill - v2 .",
    "sources can be downloaded from http://www.univ-orleans.fr/mapmo/soft/fullswof/ ) developed in the context of the project anr methode ( see @xcite and http://www.univ-orleans.fr/mapmo/methode/ ) .",
    "fullswof_2d is based on a finite volume method ( described in section [ sect : method ] ) on a structured mesh in two space dimensions .",
    "structured grids have been chosen because on the one hand digital topographic maps are often provided on such meshes , and , on the other hand , it allows to develop numerical schemes in one space dimension ( implemented in fullswof_1d ) , extension to 2d being straightforward .",
    "as argued previously , finite volume scheme ensures by construction the conservation of the water mass , and is coupled with the hydrostatic reconstruction @xcite to deal with the topography source term .",
    "it preserves water height positivity and it is well - balanced ( _ i.e. _ it preserves at least hydrostatic equilibrium : lakes and puddles ) .",
    "several numerical fluxes ( rusanov , hll , kinetic and vfroe - ncv flux ) and second order reconstructions ( muscl , eno and modified eno reconstruction ) are implemented .",
    "currently , we recommend , based on @xcite , to use the second order scheme with muscl reconstruction @xcite and hll flux @xcite detailed in section [ sect : method ] .",
    "fullswof_2d is designed in order to ease implementation of new numerical methods .",
    "fullswof_2d has already been validated on analytical solutions integrated in swashes ( shallow water analytic solutions for hydraulic and environmental studies : a free library of analytical solutions @xcite ) and on real events simulation at small scales @xcite ( on parcels ) . in next section",
    ", fullswof_2d is validated at a bigger scale on the malpasset test case .",
    "position of the different gauges and location of the dam.,width=453,height=207 ]    malpasset dam break is a real life application .",
    "it occured ( because of heavy rains ) on december 2 1959 in the var department in southeastern france , causing 433 casualties .",
    "this dramatic event is very often mentioned in studies dealing with dam breaks and associated risks ( see among others @xcite ) .",
    "because of its varying topography and complex geometry , it is widely used as a benchmark test for numerical methods and hydraulics software @xcite . moreover , this problem allows to test the ability of the scheme to treat the still water ( at the level of the sea downstream , before the wave reaches it ) and the wet - dry interfaces .",
    "the dimensions of the domain are @xmath105 along x - axis with 1000 meshes and @xmath106 along y - axis with 486 meshes , the total time of simulation is @xmath107 and we consider the manning law with @xmath108 as advised in the literature @xcite .",
    "the dam is considered as a straight line ( see figure [ ffglut ] ) , the water level inside the reservoir is set to 100 m above sea level and the computational domain downstream the dam is considered as dry bed .",
    "indeed , the initial discharge in the river before dam failure can be neglected because of the huge amount of flow caused by the dam failure .",
    "propagation of the malpasset dam break for different time 0 s and 500 s.,width=453,height=207 ]    propagation of the malpasset dam break for different time 0 s and 500 s.,width=453,height=207 ]    we run the simulation using fullswof_paral over 16 processors and we get the results in figures [ malpasset_0 ] and [ malpasset_50 ] . in 1964 , a physical model wih a scale of 1:400 was built by laboratoire national dhydraulique to study the dam - break flow . the maximum water level and flood wave arrival time",
    "were recorded at 9 points in the physical model ( named from 6 to 14 ) .",
    "this physical model has been used to calibrate / validate telemac_2d software @xcite and these results are used here to validate fullswof_2d at `` big '' scale .",
    "we can see on figure 5 that the results are very closed to those obtained with telemac . on figures [ malpasset_0 ] and [ malpasset_50 ]",
    "is represented the propagation of the wave due to the dam break ( a video can be visualized on http://www.youtube.com/user/fullswof ) and on figure 6 , the propagation of the water height at the gauges during time ( this will be used in future work ) .",
    "these results show the efficiency of fullswof but at that scale , details such as houses and roads are not represented .",
    "so in case of prevention , the use of these results might be limited .",
    "it might be useful to have more details .",
    "so the mesh would be finer , in that case the code needs to be parallelized .",
    "propagation of the malpasset dam break for different time 1000s , 2000 s and 2500 s.,width=453,height=207 ]    propagation of the malpasset dam break for different time 1000s , 2000 s and 2500 s.,width=453,height=207 ]    propagation of the malpasset dam break for different time 1000s , 2000 s and 2500 s.,width=453,height=207 ]",
    "parallelism  @xcite is an intricate domain of computing science . indeed , in addition to good sequential and parallel programming skills , it requires also a strong knowledge on processors , memory and network use to be able to write optimal programs on modern parallel computers .",
    "writing a parallel program is long and complex , and implementing optimizations to get very good performances is even more difficult . as a consequence ,",
    "giving the opportunity to non - specialists and even to non - computer scientists to use parallelism is a major research area for a long time .",
    "indeed , in lots of domains high performance computing has become a crucial point .",
    "a wide range of solutions exists to give access to parallelism to non - specialists .",
    "most of them require the collaboration of experts in parallelism with the scientists of the targeted domain since classical parallel libraries are too technical .",
    "a good alternative is to propose libraries that clearly separate the parallelism side from the user side .",
    "those tools provide some parallel patterns that hide the technical details of parallelism and are optimized for a class of problems .",
    "such libraries give a restricted access to parallelism but greatly simplify the program development .",
    "the difficulty is to find the good balance between the level of abstraction , to hide the parallelism , and the performance of the program .",
    "skelgis library is presented in this part and takes place in the latter category of libraries .",
    "skelgis is an algorithmic skeleton library and has been used to parallelize fullswof_2d .",
    "algorithmic parallel skeletons were introduced in 1988 by muray cole @xcite .",
    "the domain of algorithmic skeletons aims at providing generalist patterns of parallelization to the user and hide any parallel implementation of the resulting application in the library . as a result",
    "only sequential interfaces of the library ( named skeletons ) are used by scientists and a parallel application is executed without any knowledge on parallel libraries such as mpi , openmp , cuda etc .",
    "we can enumerate lots of algorithmic skeleton libraries , all of them based on muray cole s work @xcite .",
    "some of them are implemented in java , some of them in c++ as for example quaff  @xcite , eskel  @xcite , muesli  @xcite , sketo  @xcite and osl  @xcite .",
    "to explain the concept of algorithmic skeleton , the equation represents the well known _",
    "skeleton where @xmath109 is the set of functions expressed by equation and dstruct the type of elements in the distributed data structure given to the map skeleton .",
    "skeleton takes an input data structure , and a user function in inputs , apply the user function to each element of the data structure and return a new resulting data structure .",
    "parallelism is hidden in the data structure that is distributed transparently , and in the skeleton call . to get a parallel code with a map",
    ", the user simply has to construct a data structure @xmath110 and to define a sequential function @xmath21 that gives the calculation to accomplish on one element of the data structure .",
    "then he or she has to call the skeleton this way : map(@xmath110 , @xmath21 ) .",
    "@xmath111    @xmath112    though , this type of skeletons are not enough expressive .",
    "for example , a classical operation on a two dimensional dataset consists in computing a value in a matrix from the four or eight neighbor values around this point . with skeletons of type _",
    "map _ , it is not possible to directly access this neighborhood since only the current element is available . to sidestep this limitation existing libraries propose communication skeletons , and especially the _ shift _ skeleton that permits to shift the matrix in order to get access to another value in the matrix .",
    "this skeleton has two major issues .",
    "first , the shifted matrix implies a copy of the matrix which is undesirable when dealing with a huge amount of data .",
    "second , the shift skeleton makes difficult the programming of classical algorithms since it must be used in place of a classical matrix element accessors .    to illustrate this ,",
    "an example of an eight neighbors algorithm is used .",
    "geo - scientists are working on the automatic delination of watershed to determine , for example where the water is going to flow , to elaborate irrigation systems , or to determine the impact of a water flooding on a land .",
    "these calculations are performed on topography matrices .",
    "one important and simple step of this calculation is the flow direction computation ( figure [ directions ] ) .",
    "it consists in determining for each point of the dem where the water would flow with the assumption that it should flow in the direction of the nearest lower point .",
    "therefore , the flow direction algorithm is simple , it consists in getting the minimum value for the eight neighbors around the current point and saving the corresponding direction .",
    "eight neighbors algorithms are a good example of algorithm used to solve scientific problems .",
    "indeed , it is a frequent algorithm in mathematics ( finite volumes discretization ) , physics , image processing , geo - sciences and many other domains .",
    "however , it is not easy to make the flow direction calculation parallel with standard skeletons ( map , shift etc . ) .",
    "figure [ sketo ] shows the 24 skeleton calls needed .",
    "height _ shift _",
    "skeletons are needed to get height neighbors values , then nested calls of _ zipwith _ skeletons are needed to get the minimum value , finally _ map _",
    "skeletons are needed to associate the minimum value to a direction .    ....",
    "zipwith(min , zipwith(min , zipwith(min , zipwith(min , map(f , m ) , map(f , shift<1,1>(shift_id , m))),zipwith(min , map(f , shift<1,0>(shift_id , m)),map(f , shift<1,-1>(shift_id , m ) ) ) ) , zipwith(min , zipwith(min , map(f , shift<0,-1>(shift_id , m ) ) , map(f , shift<-1,-1>(shift_id , m))),zipwith(min , map(f , shift<-1,0>(shift_id , m)),map(f , shift<-1,1>(shift_id , m ) ) ) ) ) , map(f , shift<0,1>(shift_id , m ) ) ) ; ....    then , this type of skeleton libraries have few problems :    * the difficulty of getting a parallel code is moved to the difficulty of functional programming with skeletons . *",
    "the code is difficult to write and even more difficult to read .",
    "* performance damages occur because of all the skeleton calls and because of the duplication of matrices with the shift skeleton .",
    "skelgis is a new kind of algorithmic skeleton library .",
    "the objective is to propose a hierarchical skeleton library for very large matrices and to give access to parallelism through sequential adapted interfaces in order to keep a sequential programming style .",
    "skelgis gets out of the functional paradigms in order to stick to the programming habits of non - specialists .",
    "it relies on two concepts and a distributed data structure .",
    "_ the first concept of skelgis is to propose basic skeletons where the user function has a direct access to a matrix .",
    "the user has to define functions of type @xmath113 ( @xmath114 is a skelgis matrix ) .",
    "_    this is a major difference with the classical skeletons ( as map ) where the user functions defines what to do on a single matrix element ( functions of type @xmath115 where @xmath116 is the type of elements of a matrix @xmath117 ) .",
    "the user describes , in the sequential function , what to do on the matrix . as a result ,",
    "the expressiveness of skelgis is very good and no communication skeletons are needed .",
    "skelgis offers a way to stay close to a sequential programming style .",
    "another consequence of the expressiveness of basic skeletons is that a single call of skeleton at a time is needed , and performances of skelgis are better than existing skeletons .",
    "for example , the figure [ perf ] gives the performances of the flow direction calculation , above - cited , with skelgis and sketo .",
    "[ cols=\"^,^,^,^\",options=\"header \" , ]     _ the second concept of skelgis is to propose a hierarchy of skeletons ( figure  [ hie ] ) where every higher abstraction level skeleton uses basic skeletons . _    as a result , skelgis skeletons inherit optimizations and hardware support of basic skeletons . new optimizations or new hardware support only has to be added in basic skeletons to be available in the whole library .",
    "this hierarchy also provide a clear abstraction choice for the user . ensuring the scalability and durability of a library is an important feature to make it live and used .",
    "skeleton libraries are based on parallel libraries depending on hardware , and hardware can completely change quite quickly .",
    "existing libraries propose a set of skeletons that are independent from each others . as a result , taking into account a new hardware ( or a new parallel library ) requires to re - implement all the skeletons of the library .      as every skeleton library ,",
    "skelgis skeletons are applied to a distributed data structure .",
    "the current version of skelgis only proposes a distributed two - dimensional matrix to apply skeletons on .",
    "this distributed matrix named _ dmatrix _ is the basis of every parallel calculation made by skelgis .",
    "the constructor of the dmatrix is responsible for dividing the initial matrix in blocks and distributing the load of each block from the disk on different processors .",
    "this dmatrix is used by skeletons to apply the user functions in parallel on the whole matrix .",
    "as the user can manipulate distributed matrices without being aware of the parallel technical details , some basic tools have been developed to manipulate them .",
    "then , manipulation of the _ dmatrix _ looks like data structure of the _ standard template library",
    "_ ( stl in c++ ) manipulation . the three main tools to manipulate a",
    "_ dmatrix _ are :    * a set of iterators to navigate in the distributed matrix . * a set of neighborhood functions to get the neighbors of the current element . *",
    "get / set to get a value of the distributed matrix or to write a value in the distributed matrix .",
    "the user uses the dmatrix as if it was a common sequential matrix of the stl , and the skeletons are in charge of hiding block division and communication aspects .",
    "figures [ main ] and [ code ] represent the user code needed to get the parallel version of the flow direction calculation above - cited .",
    "the main function is in charge of the initialization of the library skelgis , the construction of matrices and the call of skeletons .",
    "then , user functions have to be programmed , in a sequential programming style , using the _ dmatrix _ tools .",
    ".... # include `` skelgis.h '' int main(int argc , char * * argv ) {      //initialization of the library      initskelgis ;      //creation of matrix m      dmatrix < float > * m = new dmatrix < float>(file,1 ) ;      //call of the skeleton apply with the function      // \" directions \" on the matrix m      dmatrix < int > * m2 = apply < float , int>(directions , m ) ;      //end of the library use      endskelgis ; } ....    .... //begin declaration of the function directions beginapply(directions , input , float , output , int ) {    //initilization of iterators on input    //and output matrices    dmatrix < float>::iterator it = input->begin ( ) ;    dmatrix < int>::iterator itout = output->begin ( ) ;    dmatrix < float>::iterator itend = input->end ( ) ;    //8 neighbors table    dmatrix < float>::neighbors nghb ;    //for each element of the matrix    for ( ; it < = itend ; + + it , + + itout )      {         int index=0 ;         //get the current value of the iterator        float min = input->getvalue(it ) ;        //get the 8 neighbor values        input->get8neighbors(it , nghb ) ;        //get the minimum        for(int i=0;i<8;i++ ) {            if(nghb[i]>0 & & nghb[i]<min ) {                index = i+1 ;                min = nghb[i ] ; }        }        //set the minimum direction in the output matrix        output->setvalue(index , itout ) ;      } } //end declaration of the function end(directions ) ; ....    behind skelgis , the exact same work as in mpi is done , but automatically .",
    "actually , the library proceeds to a domain decomposition of a structured matrix and manages mpi exchanges of ghost cells at the border of the domain decomposition .",
    "then skelgis proposes an easy way to code structured approaches of simulations .",
    "of course , the structured approach is limited regarding the complexity of some simulations , but skelgis is under development and will propose in the future unstructured distributed data structures and also graph and tree distributed data structures . this way , skelgis will be able to manage different types of simulations .",
    "in this section , we will explain the domain decomposition method which we have used to parallelize fullswof_2d ( for more details see @xcite ) .",
    "this method has been applied by using the library of functions mpi ( message passing interface ) .",
    "this method has been chosen in order to be the least intrusive as possible in the fullswof structure to ease future development .",
    "in fact , the domain decomposition method consists in splitting the data into many independent domains . on each domain ,",
    "the code is executed by one anonymous process and when it is necessary the process communicates via calls to mpi communication primitives .",
    "mpi is a standardized and portable message - passing system used to compute on both shared memory and distributed memory machines .",
    "the parallelism with mpi decomposes into four main steps :        at the beginning of the run , we create a group of @xmath15 processes . each process is assigned a rank between @xmath118 and @xmath119 . for us , this linear ranking of processes is not appropriate , because the structure of the computational domain is in two dimensions with communications into the two directions .",
    "so , the processes are arranged in the 2d cartesian topology thanks to mpi topology mechanism .",
    "mpi creates a relationship between ranks and cartesian coordinates and we used these information to know the neighbors of each nodes in order to communicate the values of the interfaces . after this step",
    ", the domain can be represented by a graph where the nodes stand for the processes and the edges connect process that communicate with each other .",
    "so , we can compute the number of points for each node in @xmath7 and @xmath8 and to initialize the local variables .",
    "after the initialization , we exchange the value of the interfaces to compute the value of the variables at the next step of the time . indeed , when we compute the value of the variables according to the order of the scheme .",
    "at order one , we add a line and column of the cells that receive the value necessary to the computation of the scheme and if we are at order two , we add two lines and two columns .",
    "concerning the communication between the nodes , mpi provides message - passing between any pair of processes .",
    "so , having exchanged the values at the interfaces , we compute the next step of the time by applying the algorithm of sequential fullswof .",
    "using skelgis to parallelize the shallow water equations is very different from a standard parallelization .",
    "no parallel knowledge ( domain decomposition , communications etc ) and no parallel code ( mpi use ) are needed at all to get a parallel version of the simulation . however , the simulation has to be thought with skeleton use .",
    "algorithm [ algo ] represents the pseudo code of the shallow water equations simulation and , in red is added the interventions needed to use skelgis with this algorithm .",
    "first , the initialization of matrices has to be made with the _ dmatrix _ object , then each algorithm step has to be executed through a skeleton call ( _ applylist skeleton _ ) .",
    "finally , the sequential code has to be a little modified because accesses to matrices elements have to be done through _ dmatrix _ iterators and accessors .",
    "in addition to the fact that no parallelization knowledge is needed using skelgis , the non - computing scientist is fully independent in parallel developments . the parallel application getting from the use of skelgis is organized and easily upgradeable .",
    "furthermore , an openmp version and the use of sse instructions ( streaming simd extensions ) optimizations are under development in skelgis . as a result with no efforts the code of shallow water equations will work with openmp for shared memory systems as with intel additional processor instructions .      in this part",
    "are presented some comparison results between the mpi implementation and the skelgis implementation of the shallow water equations .",
    "these benchmarks were made on a 5120x5120 domain with 5000 iterations and 20.000 iterations .",
    "figures [ 5000 ] and [ 20000 ] represent the base two logarithm of the execution times .",
    "then , it represents the inverse of the speedup and the ideal execution time is drawn in blue .",
    "both implementations have very good results and are closed to the ideal execution time .",
    "we can notice , however , that skelgis results are linear while the mpi version starts with a bigger execution time with 8 processors .",
    "from 32 to 256 processors the mpi implementation meets skelgis execution times .      as a conclusion ,",
    "both implementations are efficient , but parallelization concepts of these two implementations are very different .",
    "the skeletton strategy requires a more important work to rewrite the code , using skelgis library but it provides a final code with a greater expressivity and the parallelization technics are hidden within the library . on the contrary , the mpi version involves less changes in the software , but it requires to deal with the parallelization concept .",
    "therefore , our first conclusion is that the performances of the two approaches are very close . for an existing code ,",
    "depending on the skills of the developers , each strategy can be preferred .",
    "if the choice is done at the very beginning of the project , skeletons offers a more expressive code and does not require to know about parallelization .",
    "both fullswof_2d and skelgis are still under development , interested readers might contact us for further informations .",
    "m.  esteves , x.  faucher , s.  galle , and m.  vauclin , `` overland flow and infiltration modelling for small plots during unsteady rain : numerical results versus observed values , '' _ journal of hydrology _ , vol .",
    "265282 , 2000 .",
    "r.  f. fiedler and j.  a. ramirez , `` a numerical method for simulating discontinuous shallow flow over an infiltrating surface , '' _ international journal for numerical methods in fluids _",
    "219240 , 2000 .",
    "a.  j .- c .",
    "de  saint venant , `` thorie du mouvement non - permanent des eaux , avec application aux crues des rivires et  lintroduction des mares dans leur lit , '' _ comptes rendus de lacadmie des sciences _ , vol .  73 , pp . 147154 , 1871 .",
    "m.  rousseau , o.  cerdan , o.  delestre , f.  dupros , f.  james , and s.  cordier , `` overland flow modelling with shallow water equation using well balanced numerical scheme : adding efficiency or just more complexity ? '' submitted .",
    "[ online ] .",
    "available : http://hal.archives-ouvertes.fr/hal-00664535    j.  a. cunge and m.  wegner , `` intgration numrique des quations",
    "dcoulement de barr de saint - venant par un schma implicite de diffrences finies , '' _ la houille blanche _ , no .  1 ,",
    "pp . 3339 , 1964 .",
    "[ online ] .",
    "available : http://dx.doi.org/10.1051/lhb/1964002      o.  delestre , `` simulation du ruissellement deau de pluie sur des surfaces agricoles/ rain water overland flow on agricultural fields simulation , '' ph.d .",
    "dissertation , universit dorlans ( in french ) , available from tel : tel.archives-ouvertes.fr/insmi/tel-00531377/fr , jul . 2010 .",
    "o.  delestre , c.  lucas , p .- a .",
    "ksinant , f.  darboux , c.  laguerre , t .-",
    "vo , f.  james , and s.  cordier , `` swashes : a compilation of shallow water analytic solutions for hydraulic and environmental studies , '' _ international journal for numerical methods in fluids _ , vol .  72 , no .  3 , pp .",
    "269300 , 2013 .",
    "[ online ] .",
    "available : http://dx.doi.org/10.1002/fld.3741    o.  delestre , s.  cordier , f.  darboux , m.  du , f.  james , c.  laguerre , c.  lucas , and o.  planchon , `` fullswof : a software for overland flow simulation , '' in _",
    "simhydro 2012  new frontiers of simulation _ ,",
    "springer hydrogeology , p.  gourbesville , j.  cunge , and g.  caignaert , eds.1em plus 0.5em minus 0.4emdvances in hydroinformatics , 2014 , p. 450 .",
    "l.  tatard , o.  planchon , j.  wainwright , g.  nord , d.  favis - mortlock , n.  silvera , o.  ribolzi , m.  esteves , and c .- h .",
    "huang , `` measurement and modelling of high - resolution flow - velocity data under simulated rainfall on a low - slope sandy soil , '' _ journal of hydrology _ , vol .",
    "348 , no . 1 - 2 , pp .",
    "112 , jan 2008 .",
    "j.  burguete and p.  garca - navarro , `` implicit schemes with large time step for non - linear equations : application to river flow hydraulics , '' _ international journal for numerical methods in fluids _ , vol .",
    "46 , pp . 607636 , 2004 .",
    "o.  delestre , s.  cordier , f.  james , and f.  darboux , `` simulation of rain - water overland - flow , '' in _ proceedings of the 12th international conference on hyperbolic problems , university of maryland , college park ( usa ) , 2008 , e. tadmor , j .-",
    "liu and a. tzavaras eds . , proceedings of symposia in applied mathematics 67 , amer .",
    "soc . , 537546 _ , 2009 .",
    "a.  valiani , v.  caleffi , and a.  zanni , `` case study : malpasset dam - break simulation using a two - dimensional finite volume methods , '' _ journal of hydraulic engineering _",
    "128 , no .  5 , pp .",
    "460472 , may 2002 .",
    "f.  marche , `` theoretical and numerical study of shallow water models .",
    "applications to nearshore hydrodynamics , '' ph.d .",
    "dissertation , laboratoire de mathmatiques appliques  universit de bordeaux 1 , dec .",
    "2005 .",
    "kim , y .- s .",
    "cho , and y .- k .",
    "yi , `` propagation and run - up of nearshore tsunamis with hllc approximate riemann solver , '' _ ocean engineering _ , vol .",
    "8 - 9 , pp .",
    "11641173 , 2007 .",
    "[ online ] .",
    "available : http://www.sciencedirect.com / science / article / b6v4f-4m6sgfh-1/2/161a433e%",
    "70388fb34b99c58495ea599f[http://www.sciencedirect.com / science / article / b6v4f-4m6sgfh-1/2/161a433e% 70388fb34b99c58495ea599f ]              m.j .",
    "castro , a.  pardo and c.  pars , `` well - balanced numerical schemes based on a generalized hydrostatic reconstruction technique , '' _ mathematical models and methods in applied sciences _ , vol .",
    "17 , no .  12 , pp . 20652113 , 2007 .",
    "a.  bermdez and m.  e. vzquez , `` upwind methods for hyperbolic conservation laws with source terms , '' _ computers & fluids _ , vol .",
    "23 , no .  8 ,",
    "pp . 10491071 , 1994 .",
    "[ online ] .",
    "available : http://www.sciencedirect.com / science / article / b6v26 - 47ymxjt-16/2/4485b4a% db616198b768daff172258660[http://www.sciencedirect.com / science / article / b6v26 - 47ymxjt-16/2/4485b4a% db616198b768daff172258660 ]    a.  bermdez , a.  dervieux , j .- a .",
    "desideri , and m.  e. vzquez , `` upwind schemes for the two - dimensional shallow water equations with variable depth using unstructured meshes , '' _ computer methods in applied mechanics and engineering _ , vol .",
    "155 , no . 1 - 2 , pp .",
    "4972 , 1998 .",
    "[ online ] .",
    "available : http://www.sciencedirect.com / science / article / b6v29 - 3wn739f-4/2/3120ee07% ea5c43b3318fbfb6c05d2dde[http://www.sciencedirect.com / science / article / b6v29 - 3wn739f-4/2/3120ee07% ea5c43b3318fbfb6c05d2dde ]    r.  j. leveque , `` balancing source terms and flux gradients in high - resolution godunov methods : the quasi - steady wave - propagation algorithm , '' _ journal of computational physics _ , vol .",
    "146 , no .  1 ,",
    "pp . 346365 , 1998 .",
    "[ online ] .",
    "available : http://www.sciencedirect.com / science / article / b6why-45j58tw-22/2/72a8af8% c9e23f63b0df9484475f7e2df[http://www.sciencedirect.com / science / article / b6why-45j58tw-22/2/72a8af8% c9e23f63b0df9484475f7e2df ]    s.  jin , `` a steady - state capturing method for hyperbolic systems with geometrical source terms , '' _ m2an _ , vol .",
    "35 , no .  4 , pp . 631645 , jul",
    "[ online ] .",
    "available : http://dx.doi.org/10.1051/m2an:2001130        e.  audusse , f.  bouchut , m .- o .",
    "bristeau , r.  klein , and b.  perthame , `` a fast and stable well - balanced scheme with hydrostatic reconstruction for shallow water flows , '' _ siam j. sci . comput .",
    "_ , vol .  25 , no .  6 , pp .",
    "20502065 , 2004 .",
    "e.  audusse and m .- o .",
    "bristeau , `` a well - balanced positivity preserving \" second - order \" scheme for shallow water flows on unstructured meshes , '' _ journal of computational physics _ , vol . 206 , pp . 311333 , 2005 .",
    "s.  noelle , y.  xing , and c.  w. shu , `` high - order well - balanced finite volume weno schemes for shallow water equation with moving water , '' _ journal of computational physics _ ,",
    "226 , no .  1 ,",
    "pp . 2958 , 2007 .",
    "[ online ] .",
    "available : http://www.sciencedirect.com / science / article / b6why-4ng3th4 - 3/2/546ff3d2% 47ae9db8ed41e3de935ee892[http://www.sciencedirect.com / science / article / b6why-4ng3th4 - 3/2/546ff3d2% 47ae9db8ed41e3de935ee892 ]    q.  liang and f.  marche , `` numerical resolution of well - balanced shallow water equations with complex source terms , '' _ advances in water resources _ , vol .",
    "32 , no .  6 , pp .",
    "873884 , 2009 .",
    "[ online ] .",
    "available : http://www.sciencedirect.com / science / article / b6vcf-4vr9fht-3/2/5218868d% cfded7d34380666f23000855[http://www.sciencedirect.com / science / article / b6vcf-4vr9fht-3/2/5218868d% cfded7d34380666f23000855 ]      f.  bouchut , _ nonlinear stability of finite volume methods for hyperbolic conservation laws , and well - balanced schemes for sources _ , b.  basel , ed.1em plus 0.5em minus",
    "0.4embirkhuser basel , 2004 , vol .",
    "2/2004 .",
    "b.  van leer , `` towards the ultimate conservative difference scheme .",
    "v. a second - order sequel to godunov s method , '' _ journal of computational physics _ , vol .",
    "32 , no .  1 ,",
    "pp . 101136 , 1979 .",
    "[ online ] .",
    "available : http://www.sciencedirect.com / science / article / b6why-4dd1n8t - c5/2/9b051d1% cfcff715a3d0f4b7b7b0397cc[http://www.sciencedirect.com / science / article / b6why-4dd1n8t - c5/2/9b051d1% cfcff715a3d0f4b7b7b0397cc ]    c .- w .",
    "shu and s.  osher , `` efficient implementation of essentially non - oscillatory shock - capturing schemes , '' _ journal of computational physics _ ,",
    "77 , no .  2 ,",
    "pp . 439471 , 1988 .",
    "[ online ] .",
    "available : http://www.sciencedirect.com / science / article / b6why-4dd1t6w - mm/2/bef99e4% b67bd7132c8af1984c34ce57e[http://www.sciencedirect.com / science / article / b6why-4dd1t6w - mm/2/bef99e4% b67bd7132c8af1984c34ce57e ]      p.  batten , n.  clarke , c.  lambert and d.m .",
    "causon , `` on the choice of wavespeeds for the hllc riemann solver , ''",
    "_ siam j. sci .",
    "_ , vol .  18 , no .  6 , pp .",
    "15531570 , 1997 .",
    "[ online ] .",
    "available : http://dx.doi.org/10.1137/s1064827593260140          a.  gioda , c.  serrano , and a.  forenza , `` les ruptures de barrages dans le monde : un nouveau bilan de potosi ( 1626 , bolivie)/ dam collapses in the world : a new estimation of the potosi disaster ( 1626 , bolivia ) , '' _ la houille blanche _ , vol .",
    "4 - 5 , pp . 165170 , 2002 .",
    "h.  chanson , `` applications of the saint - venant equations and method of characteristics to the dam break wave problem , '' _ report no . ch55/05 _ ,",
    "vol . dept .",
    "of civil engineering , the university of queensland , brisbane , australia , may , p. 135 pages , may 2005 .",
    "t.  mulder , s.  zaragosi , j .-",
    "jouanneau , g.  bellaiche , s.  gurinaud , and j.  querneau , `` deposits related to the failure of the malpasset dam in 1959 an analogue for hyperpycnal deposits from jkulhlaups , '' _ marine geology _ , vol .",
    "260 , pp . 8189 , 2009 .",
    "n.  malleron , f.  zaoui , n.  goutal , and t.  morel , `` on the use of a high - performance framework for efficient model coupling in hydroinformatics , '' _ environmental modelling & software _ , vol .",
    "26 , pp . 17471758 , 2011 .",
    "j.  singh , m.  s. altinakar , and y.  ding , `` two - dimensional numerical modeling of dam - break flows over natural terrain using a central explicit scheme , '' _ advances in water resources _ , vol .",
    "34 , pp . 13661375 , 2011 .",
    "a.  benoit and m.  cole , `` two fundamental concepts in skeletal parallel programming , '' in _ proceedings of the 5th international conference on computational science - volume part ii _ ,",
    "iccs05.1em plus 0.5em minus 0.4emberlin , heidelberg : springer - verlag , 2005 , pp .",
    ".    m.  cole , `` bringing skeletons out of the closet : a pragmatic manifesto for skeletal parallel programming , '' _ parallel comput .",
    "_ , vol .  30 , pp",
    "389406 , march 2004 .",
    "[ online ] .",
    "available : http://dl.acm.org/citation.cfm?id=1007980.1007985              u.  gruber and p.  bartelt , `` snow avalanche hazard modelling of large areas using shallow water numerical methods and \\{gis } , '' _ environmental modelling & software _ , vol .",
    "22 , no .",
    "10 , pp . 14721481 , 2007 .",
    "[ online ] .",
    "available : http://www.sciencedirect.com/science/article/pii/s1364815207000023"
  ],
  "abstract_text": [
    "<S> in this paper , we perform a comparison of two approaches for the parallelization of an existing , free software , fullswof_2d ( http : //www.univ - orleans.fr / mapmo / soft / fullswof/[http : //www.univ - orleans.fr / mapmo / soft / fullswof/ ] that solves shallow water equations for applications in hydrology ) based on a domain decomposition strategy . the first approach is based on the classical mpi library while the second approach uses parallel algorithmic skeletons and more precisely a library named skelgis ( skeletons for geographical information systems ) . </S>",
    "<S> the first results presented in this article show that the two approaches are similar in terms of performance and scalability . </S>",
    "<S> the two implementation strategies are however very different and we discuss the advantages of each one . </S>"
  ]
}