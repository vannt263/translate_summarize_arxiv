{
  "article_text": [
    "quantitative comparisons of theoretical models of black hole accretion flows and jets with observations require radiative transfer calculations . the bulk of the radiation is often produced near the black hole event horizon , where relativistic effects of doppler beaming , gravitational redshift , and light bending become important .",
    "ray tracing is a convenient method for carrying out fully relativistic radiative transfer calculations .",
    "light bending is naturally accounted for by taking the rays to be null geodesics in the kerr metric , and the radiative transfer equation can then be solved along geodesics to calculate observed intensities .",
    "this technique has been used to calculate images ( e.g. , * ? ? ? * ) and spectra ( e.g. , * ? ? ?",
    "* ) of thin black hole accretion discs @xcite , including state of the art methods to fit spectra in order to infer parameters such as the black hole spin @xcite .",
    "ray tracing is also convenient for including general relativistic rotations of the polarisation direction via parallel transport @xcite , and has been applied to the polarised radiative transfer of synchrotron radiation from thick accretion discs , e.g. in order to model the galactic center black hole sgr a * @xcite . with the development of general relativistic mhd simulations of black hole accretion @xcite ,",
    "ray tracing has become popular as a post - processing step to study their variability properties @xcite and radiative efficiency @xcite , as well as for comparison with observations of sgr a * ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) and m87 ( e.g. , * ? ?",
    "* ; * ? ? ?",
    "* ) .    of particular interest",
    "are radiative transfer calculations relevant for current and future event horizon scale interferometric observations of sgr a * and m87 at submillimeter ( the event horizon telescope , * ? ? ?",
    "* ) and near - infrared ( the vlti gravity instrument , * ? ? ?",
    "* ) wavelengths . fully modeling the observed synchrotron radiation",
    "requires polarised radiative transfer .",
    "existing codes for this application are either private @xcite or written as post - processors to specific numerical simulations @xcite .",
    "other public tools ( e.g. , gyoto and kertap , * ? ? ?",
    "* ; * ? ? ?",
    "* ) do not include fully polarised radiative transfer .",
    "we present a publicly available , fully general relativistic code , grtrans , for polarised radiative transfer via ray tracing in the kerr metric .",
    "we describe the methods used for the parallel transport of the polarisation basis into the local frame of the fluid (  [ sec : parallel ] ) and the integration of the polarised radiative transfer equations (  [ sec : integration ] ) using emission , absorption , and rotation coefficients (  [ sec : transf - coeff ] ) calculated based on radiative processes in terms of a background fluid model (  [ sec : fluid - models ] ) . in  [ sec : tests - examples ] , we discuss tests used to validate the code , and comparisons of full example problems to those in the literature .",
    "we also provide fitting functions for polarised synchrotron emission , absorption , and transfer coefficients ( appendix [ sec : farad - coeff - power ] and [ sec : farad - coeff - power ] ) , and show an example polarised image from a model of the submm emission of sgr a * , to demonstrate how all of the transfer coefficients play important roles in the final polarised image .",
    "finally ,  [ sec : code - struct - perf ] gives a summary of the code convergence and performance properties , and an overview of its organisation .",
    "the goal of a ray tracing radiative transfer code is to calculate the observed intensity on locations ( pixels ) of an observer s camera for a given model of emission and absorption .",
    "we calculate the boyer - lindquist coordinates of the photon trajectories from the observer towards the black hole ( trace the rays ) corresponding to each pixel , parallel transport the observed polarisation basis into the fluid frame , calculate the local emission and absorption properties at each location , and then solve the radiative transfer equations for the given emission and abosrption along those rays .",
    "the observer s camera at inclination @xmath0 and orientation @xmath1 has pixels whose coordinates are described by apparent impact parameters @xmath2 , @xmath3 parallel and perpendicular to the black hole spin axis .",
    "the photon trajectories in grtrans are assumed to be geodesics in the kerr metric , in which case their constants of motion are specified for given @xmath2 , @xmath3 @xcite :    @xmath4    where @xmath5 , @xmath6 , and @xmath7 are the dimensionless z - component of the angular momentum , carter s constant , and black hole spin parameters .    the trajectories for each ray given the constants can then be found by solving the geodesic equation .",
    "we do this semi - analytically by reducing the equations of motion to jacobian integrals and jacobi - elliptic functions @xcite as implemented in the code geokerr @xcite .    in this method ,",
    "the independent variable is either the inverse radius @xmath8 or @xmath9 .",
    "the former is used by default , since even steps in @xmath10 naturally concentrate resolution towards the black hole , where most of the radiation is produced . in special cases , for example a thin accretion disc in the equatorial plane ,",
    "the latter method is preferable since then one can solve for the radius where @xmath11 , without needing to integrate the geodesic .",
    "in the default case with @xmath10 as the independent variable , the sampling can become poor near radial turning points ( e.g. sections of the orbit at nearly constant radius ) .",
    "for this reason , near radial turning points @xmath12 is instead used as the independent variable to fill in the geodesic .",
    "the calculation is started at a small , non - zero value of @xmath10 in order to keep the coordinate time and affine parameter finite .",
    "the geodesics are tabulated starting at a value of @xmath10 of interest for the problem ( e.g. the outer radial boundary of a numerical simulation ) and are terminated either just outside the event horizon for bound orbits , or once they again reach the outer radius of interest for the calculation .",
    "the locations to sample ( @xmath13 ) and number of samples ( @xmath14 ) are code parameters .",
    "the assumption made by the code is that the initial intensity is zero at the farthest point sampled along the ray .",
    "the observed polarisation is measured with respect to the horizontal and vertical axes defining the camera , while the polarised emission and transfer coefficients are most naturally given relative to a local direction in the emitting fluid ( e.g. the magnetic field direction for synchrotron radiation ) .",
    "to relate the two , we first parallel transport the observed polarisation basis along the geodesic , and then transform it to the orthonormal frame comoving with the fluid . the angle between the two bases",
    "can then be used to rotate the local coefficients into the observed polarisation basis .",
    "parallel transport of a vector describing the polarisation basis @xmath15 perpendicular to the wave - vector @xmath16 is simplified in the kerr metric by the existence of of a complex constant called the walker - penrose constant @xcite , given in boyer - lindquist coordinates with @xmath17 as @xcite :    @xmath18\\sin{\\theta}\\right\\},\\end{aligned}\\ ] ]    where    @xmath19,\\\\ k^r & = & -\\frac{s_r}{\\rho^2 } r(r),\\\\ k^\\theta & = & -\\frac{s_\\theta}{\\rho^2 } \\sqrt{\\frac{m(\\theta)}{\\sin^2{\\theta}}},\\\\ k^\\phi & = & \\frac{1}{\\rho^2 } \\left[-a +    \\frac{l}{\\sin^2{\\theta}}+\\frac{a}{\\delta } ( r^2+a^2-a l)\\right],\\\\ m(\\theta ) & = & q^2 + \\left(a^2-q^2-l^2\\right ) \\cos^2{\\theta } - a^2 \\cos^4{\\theta},\\\\ r(r ) & = & r^2 + ( a^2-q^2-l^2 ) + 2 \\left[(a - l)^2+q^2\\right ] r^{-1}\\\\ & -&a^2 q^2 r^{-2},\\\\ \\rho^2 & = & r^2+a^2 \\cos^2{\\theta},\\\\ \\delta & = & r^2 - 2 r + a^2,\\\\\\end{aligned}\\ ] ]    is the photon wave vector whose direction is specified by the signs @xmath20 and @xmath21 ( e.g. , * ? ? ? * ) .",
    "the real and imaginary parts of the constant , @xmath22 and @xmath23 , provide two constraints on the transported basis vectors , while the orthogonality condition @xmath24 provides a third .",
    "since the polarisation basis vectors are already only defined up to a multiple of the wave vector , we can set @xmath25 without any loss of generality , which leaves three linear equations for the three remaining components of @xmath15 :    @xmath26    with    @xmath27    the components of @xmath15 can then be calculated as :    @xmath28,\\\\ f^\\theta&=&-\\frac{1}{n}\\left[(\\gamma_1 k_1 - \\delta_1 k_2)(g_{\\phi      \\phi } k^\\phi + g_{\\phi t } k^t ) -",
    "\\right.\\\\&&\\left.(\\gamma_3 k_1 - \\delta_3 k_2 ) g_{r r } k^r   \\right],\\\\ f^\\phi&=&\\frac{1}{n } \\left[(\\gamma_1 k_1 - \\delta_1 k_2 ) g_{\\theta \\theta } k^\\theta -\\right.\\\\&&\\left.(\\gamma_2 k_1 - \\delta_2 k_2)g_{r r } k^r \\right],\\\\ n&=&(\\gamma_2\\delta_1-\\gamma_1\\delta_2)g_{\\phi \\phi } k^\\phi - ( \\gamma_3\\delta_1 - \\gamma_1\\delta_3)g_{\\theta \\theta } k^{\\theta}\\label{partrans2}\\nonumber\\\\&+&(\\gamma_2 \\delta_1 - \\gamma_1 \\delta_2 ) g_{\\phi t } k^t + ( \\gamma_3 \\delta_2 - \\gamma_2 \\delta_2)g_{r r } k^r,\\end{aligned}\\ ] ]    where @xmath29 are the covariant metric components :    @xmath30,\\\\ g_{\\phi t } & = & \\frac{-2 a r \\sin^2{\\theta}}{\\rho^2},\\\\ g_{r r } & = & \\frac{\\rho^2}{\\delta},\\\\ g_{\\theta \\theta } & = & \\rho^2,\\\\ g_{\\phi \\phi } & = & \\frac{\\sigma \\sin^2{\\theta}}{\\rho^2},\\\\ \\sigma & = & ( r^2+a^2)^2 - a^2 \\delta \\sin^2{\\theta}.\\end{aligned}\\ ] ]    the polarisation basis at the camera is defined so that positive stokes q is measured relative to the @xmath31 axis . transforming the linear polarisation basis vectors @xmath31 and @xmath32 at the camera then requires knowledge of @xmath22 and @xmath23 for these vectors .",
    "these can be found from the asymptotic form of equation @xcite .",
    "they are given by @xmath33 , @xmath34 and @xmath35 , @xmath36 respectively , where @xmath37 @xcite .",
    "then equations ( [ partrans]-[partrans2 ] ) allow us to calculate the polarisation basis vectors at any point along the ray .",
    "the emission coefficients and the transfer matrix computed in the fluid frame are defined in a basis aligned with a local reference vector . for the case of synchrotron emission , it is convenient to use the local magnetic field direction and so we use @xmath38 as this vector in grtrans without loss of generality . in the case of electron scattering in a thin accretion disc ,",
    "the polarisation is given relative to the disc normal vector , and so we assign the variable @xmath38 to that vector .    before integrating the radiative transfer equations",
    ", these coefficients must be transformed to the observed polarisation basis .",
    "this transformation requires finding the angle between the transported polarisation basis vectors and the polarisation reference vector @xcite .",
    "we transform into the orthonormal frame comoving with the fluid where the four - velocity is @xmath39 .",
    "the basis four - vectors of the transformation are @xcite :    @xmath40    where the upper ( lower ) indices are lowered ( raised ) with the kerr ( minkowski ) metric and ,    @xmath41    four - vectors in the coordinate frame are transformed as ,    @xmath42    the angle @xmath43 between the projected magnetic field and the polarisation basis is given in terms of ordinary dot products of the magnetic field and parallel - transported basis three - vectors ( denoted by hats ) :    @xmath44    in this frame , the combined redshift and doppler factor @xmath45 and @xmath46 .",
    "the non - relativistic polarised radiative transfer equation can be written in the form ,    @xmath47    where ( @xmath48 , @xmath49 , @xmath50 , @xmath51 ) are the stokes parameters , @xmath52 are the polarised emissivities , @xmath53 are the absorption coefficients , and @xmath54 are the faraday rotation and conversion coefficients .    in the context of synchrotron radiation , the transfer equation can be simplified by aligning the magnetic field with stokes @xmath50 , so that @xmath55",
    ". then @xmath56 , @xmath57 ( @xmath58 , @xmath59 ) correspond to the emission and absorption coefficients for linear ( circular ) polarisation and @xmath60 , @xmath61 are the unpolarised coefficients .",
    "the transfer coefficients @xmath62 describe the effects of faraday conversion and rotation respectively .",
    "all coefficients are computed in the fluid rest frame , where @xmath63 is the emitted frequency , related to the observed frequency through @xmath64 .",
    "then the transfer equation is recast into invariant form : @xmath65 , @xmath66 , and @xmath67 , where @xmath68 , @xmath69 and @xmath70 are the intensity and emissivity vectors and the transfer matrix from equation .",
    "finally , we use the angle @xmath43 to rotate the emissivity and absorption matrix in the fluid frame into that of the observer , such that the radiative transfer equation becomes ,    @xmath71    where @xmath72 is an affine parameter , @xmath73 , @xmath74 , and    @xmath75",
    "this rotation transforms the fluid frame polarisation basis to that at infinity , including the parallel transport of the polarisation four - vector along the ray .",
    "equation [ genrelpolradtrans ] includes all relativistic effects .",
    "the bending of light is accounted for by the calculation of null geodesics @xcite , the gravitational redshifts and doppler shifts due to fluid motions are included in @xmath64 .",
    "this method , developed by @xcite , parallel transports the polarisation basis along the ray and into the fluid frame .",
    "this is similar to the approach of @xcite , who transported a local polarisation vector @xmath15 from the fluid to the observer .",
    "@xcite derived a general formalism for covariant polarised radiative transfer , and mathematically showed the equivalence of the approach used here and alternative methods used by @xcite and @xcite .",
    "we show tests and example problems comparing results from these methods in  [ sec : test - problems ] .",
    "the transfer coefficients in equation depend in general on the physical properties of the radiating particles . here",
    "we focus specifically on the case of synchrotron radiation appropriate for studying accretion flows at the lowest observed luminosities ( e.g. , sgr a * ) . adding different emissivities such as bremsstrahlung to grtrans",
    "would require a straightforward modification of the code .",
    "in addition , the form of the transfer coefficients depends on the underlying electron distribution function .",
    "the appropriate forms for thermal and power law distributions are implemented in the code .",
    "more general distribution functions can be built by combining these components ( e.g. a thermal distribution with a power law `` tail '' or a superposition of thermal distributions , mao et al . in prep . ) . in these special cases ,",
    "the integral over the distribution function can be analytically approximated to high accuracy in the ultra - relativistic synchrotron limit ( e.g. , * ? ? ?",
    "the full forms for the transfer coefficients as used in grtrans and some of their derivations are given in appendix [ cha : polar - synchr - emiss ] .",
    "in addition to synchrotron coefficients , for test problems with optically thick accretion discs the code uses ( color - corrected ) blackbody intensity functions for the disc surface brightness .",
    "the calculation of transfer coefficients for a particular emission model requires knowledge of the fluid state variables of spacetime coordinates .",
    "depending on the model used , this can include the electron density , magnetic field strength and orientation , and the internal energy density in electrons . in grtrans",
    "we implement several fluid models from the literature .",
    "they are described briefly below , and used as code examples and tests in  [ sec : test - problems ] .",
    "the relativistic version @xcite of the standard thin disc solution @xcite for axisymmetric , steady accretion in the equatorial plane is implemented and intended for use with a model for the emergent intensity from the disc ( e.g. , a blackbody ) . in this case , the net polarisation is taken to follow the result of electron scattering in a semi - infinite atmosphere @xcite specified relative to the disc normal vector (  [ sec : parall - transp - tests ] ) .",
    "we have also implemented a numerical version of the thin accretion disc problem which inputs a temperature distribution @xmath76 in the equatorial plane .",
    "one example use of this is for calculating spectra of inhomogeneous ( or  patchy \" ) accretion discs @xcite , as used for the polarisation calculations described in @xcite .",
    "a solution of the general relativistic fluid equations for spherically symmetric inflow in the schwarzschild metric following @xcite is implemented .",
    "the dominant emission in this case comes from synchrotron radiation @xcite .",
    "see @xcite for details .    for polarised emission",
    ", we take the magnetic field to be purely radial .",
    "this is done to check that the resulting linear polarisation sums to zero ( since for a camera centered on the black hole there is no preferred direction ) , and the residual is used as an estimate of the minimum systematic uncertainty in the fractional linear polarisation ( @xmath77 ) .",
    "@xcite presented a semi - analytic jet model based on stream functions found in force - free simulations .",
    "we have implemented this solution numerically on a grid of ( @xmath78,@xmath79 ) in boyer - lindquist coordinates . to generate our numerical solutions , we solve for the magnetic field and velocity structure analytically using their equations 5 - 13 . to get the particle density ,",
    "we tabulate their function @xmath80 numerically using a separate grid of points with roughly constant @xmath81 and varying @xmath82 .",
    "this function can then be used to calculate the particle density ( their equation 13 ) .",
    "the fluid variable solutions from our method appear identical to what is shown in their figure 4 .",
    "we also use another numerical solution , from the public version of the axisymmetric general relativistic mhd code harm @xcite . starting from a gas torus in hydrostatic equlibrium threaded with a weak magnetic field",
    ", the code evolves the equations of ideal mhd in the kerr spacetime .",
    "the magnetorotational instability @xcite drives turbulence in the torus and the resulting stresses transport angular momentum outwards , leading to accretion onto the central black hole .",
    "snapshots from these simulations have been used as models of sgr a * ( e.g. , * ? ? ?",
    "* ) .    the images used here as examples are from a single snapshot of a simulation with black hole spin @xmath83 at @xmath84 used for comparison with 3d simulations in @xcite .",
    "grtrans supports fully time - dependent calculations using a series of such simulation snapshots to e.g. calculate accretion flow movies rather than images .",
    "it would also be straightforward to adapt the code to work with updated harm versions , for example with 3d data or non - ideal mhd .",
    "the fluid variables in these simulations are saved in modified kerr - schild coordinates and with arbitrary units which assume @xmath17 .",
    "calculating radiation from these data in grtrans requires converting to boyer - lindquist coordinates and to cgs units .",
    "the coordinate conversion is done analytically in two steps : from modified to standard kerr - schild coordinates @xcite and then from kerr - schild to boyer - lindquist coordinates ( e.g. , * ? ? ?",
    "scaling to cgs units is done by i ) fixing the black hole mass , which sets the length- and time - scales , and ii ) choosing an average accretion rate ( or equivalently mass of the initial torus ) .",
    "this procedure is discussed in more detail elsewhere @xcite .",
    "once the unit and coordinate conversions are done , we calculate fluid variables at tabulated geodesic coordinates . for all numerical models , we linearly interpolate from the set of nearest neighbors on the grid for the numerical model .",
    "the way this is implemented in the code assumes that the grid is uniformly spaced in some coordinates , and the fluid model must include the transformation from those coordinates to boyer - lindquist .",
    "there are several other models implemented in the code in some form , but which have not been tested .",
    "it is straightforward to add new fluid models to the code , e.g. by using existing ones as templates .      from the previous steps",
    ", we have transfer coefficients specified at tabulated points along a geodesic which are transformed to relativistic invariant form and aligned with the observed stokes parameters of the distant observer , accounting for parallel transport along each ray .",
    "the final step is to solve the polarised radiative transfer ( equation [ genrelpolradtrans ] ) along the geodesic . in grtrans ,",
    "this is done as a separate step following the calculation of the coordinates of the geodesic .",
    "while the ray tracing proceeds backwards from the camera towards the black hole , the integration proceeds outwards .",
    "this is done so that we may safely set the initial intensity to zero at some point either where the optical depth is large , or where the geodesic has left the emitting volume . here",
    "we describe one numerical integration method and two quadrature methods that are implemented in grtrans for integrating the equations .",
    "these methods can be used for relativistic or non - relativistic problems . for consistency with previous literature ,",
    "we write the non - relativistic versions of the intensity , absorption matrix , emissivity , and step size along the ray at index @xmath85 as @xmath86 , @xmath87 , @xmath88 and @xmath89 in what follows . in grtrans ,",
    "the relativistic invariants @xmath90 ,",
    "@xmath91 , @xmath92 , and @xmath93 take the place of these quantities .",
    "the most straightforward method is numerical integration of the radiative transfer equation .",
    "the radiative transfer equations can be stiff : the required step size for a converged solution decreases sharply once @xmath94 , where @xmath95 is the optical depth associated with any transfer coefficient .    in order to get a robust solution",
    ", we use the odepack routine lsoda @xcite to advance the stokes intensities between each step tabulated on the geodesic .",
    "this algorithm adaptively switches between a predictor - corrector ( adams ) method for non - stiff systems , and a bdf method for stiff systems .",
    "we find it necessary to restrict the maximum step size allowed in @xmath72 , since otherwise a large step can miss the region of interest altogether .",
    "regions of large optical depth often contribute negligibly to the observed intensity but require a small step size , and so we terminate the integration at a maximum optical depth , @xmath96 by default .",
    "there are further free parameters in lsoda related to the error tolerance .",
    "the locations sampled by lsoda do not correspond exactly to the points tabulated along the ray .",
    "we linearly interpolate the transfer coefficients between tabulated points , even though they are highly non - linear functions of position along the geodesic .",
    "the fluid variables vary more smoothly along the ray , and it would be straightforward but more computationally expensive to instead re - interpolate the fluid variables to the points used by lsoda and then calculate new transfer coefficients , as was done in the previous version of the code @xcite . given the results from comparing to quadrature integration methods and analytic solutions described below , and from the convergence properties with increasing the number of points along each ray , we find the current approximation adequate for obtaining accurate solutions .",
    "the polarised radiative transfer equations are linear and ordinary , and so admit a formal solution analagous to that of the unpolarised case @xcite .",
    "the solution amounts to finding the matrix operator @xmath97 , defined by @xcite ,    @xmath98    which determines how the intensity is propagated over some part of the ray in the absence of emission . in the unpolarised case",
    "this is a scalar , @xmath99}$ ] .",
    "if the absorption matrix @xmath70 is a constant over the ray , then similarly ,    @xmath100}.\\ ] ]    in terms of @xmath101 , the intensity can be written in terms of an initial value @xmath102 :    @xmath103    @xcite found a closed form solution for @xmath101 ( their equation 10 , reproduced in appendix [ deglinnocentio ] ) .",
    "this solution is valid for regions where the transfer matrix @xmath70 is constant , but not for our situation of interest where they vary arbitrarily along a ray . in order to use this expression",
    ", we assume that the coefficients are constant in between the tabulated locations along a geodesic starting from @xmath104 at the farthest point of interest along the ray ( at the black hole or where the ray leaves the far end of the emitting region ) and integrating towards @xmath105 ( the `` surface '' ) , and write the solution of equation separately for the interval between neighboring points with indices @xmath106 and @xmath85 with positions @xmath107 and @xmath108 :    @xmath109    where @xmath110 . this formula is used recursively going outwards from @xmath111 to @xmath112 to find the intensity everywhere from the initial condition @xmath113 .",
    "the final integration method implemented in grtrans is the diagonal element lambda operator method ( delo , * ? ? ?",
    "* ) , which comes from writing the transfer equations in terms of the unpolarised optical depth , @xmath114 , and the modified absorption matrix @xmath115 and source function @xmath116 :    @xmath117    where @xmath118 .",
    "this equation has a formal solution between neighbouring points @xmath119 , @xmath120 of    @xmath121 \\mathcal{s } d\\tau,\\ ] ]    where @xmath122 and @xmath123 .",
    "the delo method makes a linear approximation for the modified source function ,    @xmath124/\\delta_k,\\ ] ]    so that equation can be integrated analytically between grid points , giving :    @xmath125    where    @xmath126,\\\\ \\mathcal{q}_k & = & \\mathcal{m}_k ( e_k \\mathbf{1}-g_k k'_{k+1}),\\\\ \\mathcal{m}_k & = & [ \\mathbf{1}+(f_k - g_k)k'_k]^{-1},\\\\ f_k & = & 1-e_k,\\\\ g_k & = & \\left[1-\\left(1+\\delta_k\\right)e_k\\right]/\\delta_k,\\end{aligned}\\ ] ]    the difficulty with this method is that @xmath127 is used as the independent variable . for our problems of interest @xmath95",
    "can be nearly constant between grid points over which the fluid quantities and emissivity change significantly , which causes the above solution to fail . in the limit of small @xmath128 , we instead expand the above quantities up to @xmath129 , leading to the following forms :    @xmath130,\\\\ \\mathcal{q}_k & = & \\mathcal{m}_k \\left[\\mathbf{1}\\left(1-\\frac{\\delta s_k \\alpha_{i , k}}{2}+\\frac{\\delta s_k^2        \\alpha_{i , k+1}^2}{6}\\right)\\right.\\\\&-&\\left.\\left(\\frac{\\delta",
    "s_k}{2}-\\frac{\\delta        s_k^2}{3}\\right)k_{k+1}\\right],\\\\ \\mathcal{m}_k & = & \\left[\\left(1-\\frac{\\delta_k}{2}+\\frac{\\delta_k^2}{6}\\right)\\mathbf{1}\\right]^{-1}.\\end{aligned}\\ ] ]    this version of the equations uses @xmath131 as the independent variable , and is used by default when @xmath132 . since the number of steps taken by grtrans is usually @xmath133 , this form of the equations is used unless the optical depth is very large .    in grtrans ,",
    "all integration methods proceed outwards from an initial point back towards the camera . from the recursive forms of the delo and formal solution methods",
    ", we see that it would also be possible to integrate the polarised radiative transfer equations backwards by summing the so - called contribution vectors from each point to the final intensity on the camera , @xmath134 :    @xmath135    where    @xmath136 j_i\\ ] ]    for the formal solution method and    @xmath137 j_i\\ ] ]    for the delo method @xcite .",
    "the equivalent contribution vectors in the unpolarised case are given as    @xmath138 j_i = e^{-\\tau_i } j_i,\\ ] ]    where @xmath139 is the optical depth from the surface to the depth at index @xmath140 .",
    "tracing backwards from the camera , at each step at index @xmath140 one can calculate @xmath141 using the solution for @xmath142 , @xmath143 , and @xmath144 .",
    "solving the polarised radiative transfer equations in this way would be useful in implementations where the geodesic equations and radiative transfer equations are solved simultaneously , e.g. as is done for the unpolarised case in the public code gyoto @xcite . in this method , one can then safely terminate the integration early if the product term in @xmath141 becomes sufficiently small ( e.g. , the optical depth becomes large ) .",
    "the three methods give consistent answers , usually to high accuracy and with similar performance .",
    "the main drawback of our quadrature implementations is the lack of an adaptive step size , so that many steps ( @xmath145 ) are required in order to get a converged result .",
    "in most example problems in the following section , the numerical integrator is used as it is the most robust choice .",
    "the other methods are primarily used for comparison and testing , although they are faster at a fixed number of points @xmath14 and so with some optimisation might prove to be significantly faster than numerical integration .",
    "here we describe tests of the different aspects of grtrans ( unit tests ) , as well as full example problems which are compared with results from the literature .",
    "we do not provide tests of the geokerr code for calculating null geodesics in the kerr metric , which are described in @xcite .      [ cols=\"^,^ \" , ]     as well as the emission and absorption coefficients calculated above ( appendix [ cha : polar - synchr - emiss ] ) , the coefficients @xmath146 and @xmath147 affect the generation and transfer of polarisation in a magnetised plasma .",
    "we use approximate expressions from the literature for these coefficients which as above are modified to i ) be fast to evaluate and ii ) have the correct asymptotic limits .      in the case of a power law distribution",
    ", we use the expressions from @xcite appendix c , written in our notation :    @xmath148,\\\\ \\rho_v & = & 2 \\frac{p+2}{p+1 } \\rho_\\perp\\left(\\frac{\\nu_b}{\\nu}\\right)^2 \\gamma_{\\rm min}^{-(p+1)}\\ln \\gamma_{\\rm min } \\cot{\\theta_b},\\\\ \\rho_\\perp&=&\\frac{n e^2}{m c \\nu_b } ( p-1 )   \\left[\\gamma_{\\rm min}^{1-p}-\\gamma_{\\rm max}^{1-p}\\right]^{-1}.\\end{aligned}\\ ] ]    more accurate expressions @xcite require integration over the distribution function and for this reason are slow to evaluate .",
    "these approximate forms are relatively accurate for @xmath149 ( left panel of fig . 6 in",
    "* ) . in the example",
    "semi - analytic jet problem above , faraday rotation and conversion are negligible @xcite . nonetheless , it should be possible to find accurate fitting functions for these coefficients , which would be consistent with our approach for the other coefficients .",
    "faraday coefficients for thermal distributions of electrons have been calculated in limits of either high frequency @xmath150 ( e.g. , * ? ? ?",
    "* ) , at high temperatures @xmath151 , or both .",
    "in particular , @xcite provided approximate fitting functions for @xmath146 and @xmath147 over a wide temperature range @xmath152 with high accuracy for @xmath153 ( their equations 25 , 26 , 33 , but in our notation ) :    @xmath154\\\\ \\rho_v & = & \\frac{2 n e^2 \\nu_b}{m c \\nu^2 } \\frac{k_0(\\theta_e^{-1})}{k_2 ( \\theta_e^{-1 } ) } \\cos{\\theta_b } g(x),\\end{aligned}\\ ] ]    where    @xmath155    and their parameter @xmath156 is a function of @xmath157 . in the high - frequency limit",
    "@xmath150 , both functions asymptotically reach unity . the cosine term in @xmath158",
    "is used to fit the sign change in @xmath147 near @xmath159 .",
    "while the high frequency and high temperature limit is most relevant for our applications of interest , e.g. modeling the submm emission from sgr a * , ideally we would have expressions that are correct in both asymptotic limits .",
    "for this reason we modify the expressions in @xcite , by comparing them with the expressions for the high temperature synchrotron limit given in @xcite ( their equations 3 - 4 , in our notation ) :    @xmath160    where    @xmath161",
    "+ 1/2\\int_q^\\infty dx \\left(\\pi      gi(x ) - 1/x\\right)\\right ] e^{-y},\\end{aligned}\\ ] ]    and where @xmath162 and @xmath163 is defined in terms of airy functions @xcite .    in the high - frequency , high temperature limit",
    "where @xmath164 , @xmath151 , and where we can replace the bessel functions by their asymptotic limits and @xmath165 , @xmath166 , these expressions agree with the above results from @xcite . from numerically integrating @xmath167 and @xmath168",
    ", we also find good agreement between the two sets of coefficients over their reported ranges of validity .",
    "we adapt the fitting function @xmath158 in @xcite to use the asymptotic limit of @xmath147 at small @xmath169 , where @xmath170 :    @xmath171 1/2 \\left[1+\\tanh{\\left(10 \\ln { x/120}\\right)}\\right].\\end{aligned}\\ ] ]    the added term imposes the correct asymptotic limit at large @xmath156 ( small @xmath169 ) and for this reason maintains good accuracy over all @xmath169 .    for @xmath146",
    ", the term @xmath172 from @xcite separates into a sum of terms which depend on temperature and @xmath173 , and those which only depend on @xmath169 .",
    "this suggests that it would be better to use the factor @xmath174 in @xcite as a difference from the high - frequency limit rather than a multiplication :    @xmath175    where we define our correction factor @xmath176 in a similar spirit to that of @xcite , but modified for higher accuracy :    @xmath177    figure",
    "[ fig : rotcoef ] compares numerical integration of equation @xcite with the fitting functions from equation @xcite and our modified forms .",
    "our approximate versions are fast to compute , while maintaining accuracy over all @xmath169 .",
    "we have compared polarised spectra and maps from harm models of sgr a * computed using the prescriptions from @xcite , @xcite , and the high temperature , high frequency limit . as expected , all expressions are in excellent agreement when @xmath164 , in this case for @xmath178 hz . below that , our modified expressions and those from @xcite are in good agreement , while the degree of circular polarisation can differ between our results and the high - frequency limit . as described in the main text , models of sgr a * in the submm have self - absorption optical depth @xmath179 , @xmath180 , and @xmath181 , so that the faraday optical depths can be very large and have an important effect on the resulting polarisation maps and spectra ( e.g. figure [ harmpol ] ) .",
    "since this result is for the high - frequency , relativistic limit , it does not depend on the fitting function used .",
    "this appendix provides the analytic solutions to the polarised radiative transfer equations used for testing different integration methods for grtrans in  [ sec : integration - tests ] . in all cases ,",
    "the boundary condition used is that the initial intensity is zero for each stokes parameter .",
    "the first case considered is pure emission and absorption in stokes @xmath48 and @xmath49 , in which case equation becomes :    @xmath182    whose solution is ,    @xmath183 + ( j_i \\alpha_q - j_q \\alpha_i ) \\frac{e^{-\\alpha s}}{2 }      ( 1-e^{2 \\alpha_q s})\\right\\},\\\\ q(s ) & = & \\frac{1}{\\alpha ( \\alpha_i - \\alpha_q ) } \\left\\{(j_q \\alpha_i - j_i \\alpha_q)\\left[1-\\frac{e^{-\\alpha      s}}{2}\\left(1+e^{2\\alpha_q s}\\right)\\right ]   + ( j_q \\alpha_q - j_i \\alpha_i ) \\frac{e^{-\\alpha s}}{2 } \\left(1 - e^{2 \\alpha_q s }    \\right)\\right\\},\\end{aligned}\\ ] ]    where @xmath184 .",
    "when @xmath185 , the second group of terms in each equation vanishes while the first reduces to the usual formal solution of the radiative transfer equation , e.g. when stokes @xmath48 and @xmath49 are not coupled .",
    "examples of the solution are shown in figure [ testabs ] .",
    "the second case of interest is pure polarised emission in stokes @xmath186 along with faraday rotation and conversion ( @xmath62 ) . here",
    "the polarised radiative transfer equation is ,    @xmath187    where we have set @xmath188 as is commonly chosen for the stokes basis for synchrotron radiation . from this equation",
    "it is apparent that @xmath146 is responsible for changing the linear polarisation direction ( mixing stokes @xmath49 and @xmath50 , faraday rotation ) while @xmath147 converts between linear and circular polarisation ( mixing stokes @xmath50 and @xmath51 , faraday conversion ) .",
    "the solution is ,    @xmath189    where @xmath190 .",
    "these solutions for a sample case are plotted in figure [ testfar ] .    in the case of only faraday rotation or conversion ( @xmath191 for stokes @xmath49 or @xmath192 for stokes",
    "@xmath51 ) , the solution is purely oscillatory with the maximum linearly polarised intensity restricted to be @xmath193 independent of the total intensity or path length , despite the fact that there is no absorption .",
    "since in this optically thin limit the total intensity grows as @xmath194 , the fractional polarisation decreases as @xmath195 .",
    "when both faraday rotation and conversion are present , the stokes @xmath49 and @xmath51 acquire terms which linearly increase with @xmath131 , while the oscillatory terms still have maximum values that are independent of @xmath131 .",
    "this means that in the limit of large faraday optical depth ( large @xmath131 ) , the fractional polarisation approaches a constant value @xmath196 instead of decreasing as @xmath197 in the pure faraday rotation or conversion case .",
    "since for cases of interest @xmath198 , circular polarisation becomes dominant over linear polarisation in the limit of large faraday optical depth .",
    "this is a different limit than an initial polarised intensity travel through a magnetised medium where faraday rotation occurs . in that case",
    ", the intensity also oscillates between stokes @xmath49 and @xmath50 , but with a constant polarised intensity .",
    "the fractional polarisation only decreases when the faraday rotation is instead occurring in the region where the polarised emission is being produced .",
    "@xcite found a closed form solution for the matrix operator @xmath97 , defined by      which describes the transfer of the stokes parameters from position @xmath131 to @xmath200 in the absence of emission , which is valid under limited conditions including when the absorption matrix @xmath70 is constant over the interval .",
    "we reproduce the solution here in our notation :    @xmath201 \\mathbf{m_1 } / 2 -      \\sin{\\left(\\lambda_2 \\delta s\\right ) } \\mathbf{m_2 } - \\sinh{\\left(\\lambda_1        \\delta s\\right ) } \\mathbf{m_3}+\\left[\\cosh{\\left(\\lambda_1 \\delta          s\\right)}-\\cos{\\left(\\lambda_2 \\delta s\\right)}\\right]\\mathbf{m_4 } / 2\\right\\},\\ ] ]          @xmath203^{1/2},\\\\ \\lambda_{1,2 } & = & \\left\\{\\left[\\left(\\alpha^2-\\rho^2\\right)^2/4 +      \\left(\\mathbf{\\alpha } \\cdot \\mathbf{\\rho}\\right)^2\\right]^{1/2 } \\pm \\left(\\alpha^2 - \\rho^2\\right)/2\\right\\}^{1/2},\\\\   \\sigma & = & \\rm sign \\left(\\mathbf{\\alpha } \\cdot    \\mathbf{\\rho}\\right),\\\\ \\mathbf{\\alpha } \\cdot \\mathbf{\\rho } & = & \\alpha_q \\rho_q + \\alpha_u \\rho_u + \\alpha_v \\rho_v,\\\\ \\rho^2 & = & \\rho_q^2 + \\rho_u^2+\\rho_v^2,\\\\   \\alpha^2 & = & \\alpha_q^2 + \\alpha_u^2 + \\alpha_v^2.\\end{aligned}\\ ] ]"
  ],
  "abstract_text": [
    "<S> ray tracing radiative transfer is a powerful method for comparing theoretical models of black hole accretion flows and jets with observations . </S>",
    "<S> we present a public code , grtrans , for carrying out such calculations in the kerr metric , including the full treatment of polarised radiative transfer and parallel transport along geodesics . </S>",
    "<S> the code is written in fortran 90 and efficiently parallelises with openmp , and the full code and several components have python interfaces . </S>",
    "<S> we describe several tests which are used for verifiying the code , and we compare the results for polarised thin accretion disc and semi - analytic jet problems with those from the literature as examples of its use . along the way , we provide accurate fitting functions for polarised synchrotron emission and transfer coefficients from thermal and power law distribution functions , and compare results from numerical integration and quadrature solutions of the polarised radiative transfer equations . </S>",
    "<S> we also show that all transfer coefficients can play an important role in predicted images and polarisation maps of the galactic center black hole , sgr a * , at submillimetre wavelengths .    </S>",
    "<S> [ firstpage ]    radiative transfer  accretion , accretion discs  black hole physics  galaxy : centre  galaxies : jets  relativistic processes </S>"
  ]
}