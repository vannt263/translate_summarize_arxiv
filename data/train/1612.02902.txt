{
  "article_text": [
    "the massive size of the internet and its de - centralized nature make nearly every facet of its structure and operation complex and often opaque @xcite .",
    "complexity mixed with a lack of visibility is problematic for not only network diagnostics , but also impacts protocol design and operation @xcite . further complicating the modern picture",
    "is the tension between measurability and the privacy and security concerns of network operators , users , and third parties : different parties may view measurability of different parameters of the network either as essential , or as anathema to best practices .",
    "tcp / ip has several built - in diagnostic capabilities , some in common use , e.g. , the icmp echo facility @xcite for assessing reachability and latency , and others no longer commonly supported , e.g. , ip s record route option @xcite and timestamp requests @xcite .",
    "clever hacks such as _ traceroute _ and its variants @xcite leverage tcp / ip s protection against infinitely looping packets to elicit icmp `` time exceeded '' messages from routers to infer the forward data path from a host running _ traceroute _ to a specified target . more convoluted measurements abound ; two such examples are using the ip identification field for alias resolution @xcite and the edns - client - subnet extension to map content distribution network ( cdn ) infrastructure @xcite .",
    "tcp / ip also includes mechanisms for explicit in - band measurement , for example tcp s timestamp option @xcite to assess the feedback time or explicit congestion notification ( ecn ) @xcite to allow routers to signal congestion to end hosts .",
    "however , the diagnostic facilities currently available have proven woefully inadequate for applications , operators , policy makers , and researchers on the modern internet :    * the diagnostics built into tcp / ip are useful for measuring a few specific attributes of the network , but are not germane to the breadth of understanding we now desire .",
    "for instance , there is no ready way to understand the available capacity or packet manipulation along some path , both of which are now more important than when tcp / ip was developed . *",
    "ip addresses are no longer useful as host identifiers for many measurement purposes . today",
    "s internet has both multiple machines sharing an ip address ( e.g. , nats , anycast ) and single machines using multiple ip addresses ( e.g. , routers , load - balancers ) .",
    "an interface may have both ipv4 and ipv6 identifiers , and , in the case of ipv6 privacy extensions , each ipv6 address may be used only once or for a short time @xcite . beyond network layer addresses ,",
    "cdns hide myriad hosts behind a common name . even resolving",
    "a hostname often involves a mysterious chain of resolvers @xcite . *",
    "today s network forwards different types of traffic with different policies .",
    "therefore , a measurement leveraging a diagnostic like the icmp echo mechanism may not be indicative of the experience of a web transfer .",
    "this situation renders even experienced operators at a loss when problems arise .",
    "* protocols and systems are increasingly reactive to network conditions . for instance , mobile devices may prefer wifi networks over cellular networks when both are available . or , cdns attempt to direct clients to the `` best '' content replica . or",
    ", the happy eyeballs technique @xcite is used for assessing the quality of ipv6 versus ipv4 to reach a destination . while it is perfectly reasonable to base operation on network conditions , obtaining",
    "such understanding is an ad hoc and arduous process that is generally performed out - of - band without any unified mechanism .    over the years researchers  ourselves included!have designed increasingly complex and clever methodologies for understanding the operation of the internet .",
    "this large body of work unquestionably provides many insights into current internet reality .",
    "however , we find three issues with the current state - of - the - art :    * often techniques rely on inference and not direct measurement .",
    "that is , we are forced to make assumptions of varying dubiousness about the network , or how traffic is handled by the network @xcite .",
    "for instance , that ip addresses represent unique machines . or , that hosts generate tcp acknowledgments quickly . or , that a vantage point `` close '' to an endpoint is `` good enough '' to well understand the endpoint s perspective . even more problematic , measurements face an increasingly adversarial environment where honeypots and deception pollute our understanding @xcite , while increased deployment of encryption @xcite can remove visibility completely .",
    "* we often use complex post - facto analysis to illuminate various network behaviors .",
    "this leaves us with a general understanding of some phenomenon , but not a way to generate such understanding on - the - fly such that it constitutes actionable information within some system .",
    "* the techniques we employ often exploit unintentional behavior in order to coax information from the network that operators may not wish to divulge .",
    "simultaneously , operators are unable or unwilling to deploy or use many of the techniques developed in the research community .    in this position paper",
    ", we describe the in - protocol internet measurement ( ipim ) facility . rather than the point solutions found in individual protocols or brittle tricks employed by researchers ,",
    "we seek to identify a minimum set of measurement _ primitives _ that generalize across a wide variety of use cases .",
    "ipimis a proposal to take these primitives and promote measurement to a first class citizen within the network architecture .",
    "we posit that by adding explicit measurement primitives into the protocol stack , a broader and more accurate understanding of network behavior will be available to the protocols themselves , applications , operators , developers , and researchers .",
    "further , this understanding will come at a lower cost than attempting to leverage the current accumulation of measurement hacks and assumptions .",
    "as a brief motivating example we consider the difficulty surrounding a seemingly simple task : round - trip time ( rtt ) assessment .",
    "latency is one of the fundamental properties of network paths , having an impact on everything from when to retransmit a packet within a reliable stream @xcite to protocol performance @xcite to determining the magnitude and amount of network congestion @xcite .",
    "indirectly , latency is also used for geolocation and to direct queries among content caches .",
    "rtts can be measured out - of - band using icmp s echo facility .",
    "while in some cases icmp can provide acceptable answers , it also presents three drawbacks : ( @xmath0 ) icmp is often blocked as a matter of policy , rendering this technique useless , ( @xmath1 ) leveraging icmp makes an assumption that the network treats icmp the same as other more user - oriented traffic such as tcp / http and therefore that the rtts from icmp measurements are germane for other traffic types and ( @xmath2 ) when an out - of - band icmp mechanism is used within a larger system or protocol it represents additional complexity to develop and maintain .",
    "an alternative approach is to utilize natural protocol interactions to measure the rtt .",
    "for instance , we could leverage small dns requests and responses or tcp data segments and the corresponding acknowledgments ( acks ) .",
    "the problem is that these interactions often include more than the network latency .",
    "for instance , if a dns request arrives at a resolver that does not have the requested name in local cache , then there will be additional time in iterating through the dns hierarchy ( or some subset thereof ) to obtain the answer to the query .",
    "however , the contents of the dns response will be nearly identical regardless of the state of the cache , leaving the requester blind to whether the rtt reflects the network path to the resolver or not .",
    "of course , the astute internet empiricist will no doubt decide to pile on another hack and send the same dns request twice , using on the second request and its corresponding response as the network rtt on the assumption that the first request will prime the resolver s cache  an assumption which may or may not be true .",
    "however , even in the best case where this second transaction is an accurate assessment of the network path , the process reverts back to out - of - band measurement since the naturally occurring dns transaction is insufficient on its own .",
    "the same ambiguity plagues web - based rtt measurements , where web content is today commonly cached or proxied .",
    "tcp is a canonical example of a protocol whose messages allow it to infer path properties ( including rtt estimation ) .",
    "however , tcp must contend with a variety of complicating factors including delayed acks @xcite , hardware acceleration ( e.g. , offload engines ) , and retransmitted segments .",
    "these can skew rtt estimations by hundreds of milliseconds  an error that can be of the same magnitude as the actual rtt .",
    "tcp s timestamp option @xcite  an explicit timestamp included by the sender in each segment and echoed back by the recipient  helps resolve the retransmission ambiguity , and we utilize a similar mechanism in ipimto decouple host and network latency .    while in - band measurement is powerful , dns and tcp well - illustrate the difficulties and subtleties in obtaining accurate measurements via natural interactions .",
    "ipimintroduces a set of primitives that provide more precise and less inferential measurements , while increasing the space of measurable network properties .",
    "these primitives are designed to generalize across a wide array of protocol , application , and user needs ( rtt estimation is but one use - case ;   [ sec : use ] details additional application of ipim ) .",
    "improvements to ipimcan then benefit a wider range of protocols , and free designers from creating yet more point solutions .",
    "although the original arpanet contained extensive explicit support for measurement and diagnostics @xcite , measurement in the internet has long been viewed as a management function decoupled from protocol design .    in our experience running and measuring networks , creating protocols , and observing the evolution of deployed protocols and systems , several common themes among successful designs have emerged . from these design trends we extract a set of principles to guide our design of ipim :",
    "* measurement should be explicit:*[pr : explicit ]    this principle is not unique to internet measurement  @xcite , but is especially applicable to it .",
    "many of the techniques applied in internet measurement rely on inference that is itself based on assumptions about the reactions of protocol implementations outside the control of the party performing the measurement , assumptions that may or may not hold . for example , stretch acks in tcp  @xcite invalidate basic assumptions in passive latency measurement , and differences between the addresses of interfaces on which a packet is sent and the addresses reported by routers in icmp time exceeded replies complicates the analysis of traceroute results when studying data - plane topology .",
    "the only way to address this problem is with facilities for measurement which state the assumptions on which inferences are to be based explicitly .",
    "measurement facility explicitness also encourages adoption , rather than the wholesale blocking of measurement traffic when administrators do not clearly understand what is being measured and what information is being shared . in [ pr : control ] , we elaborate on providing hooks for user and administrator consent .",
    "* measurement should be in - band:*[pr : inband ]    modern internet paths represent a complex forwarding fabric whose behavior is driven by a multitude of properties , including traffic type and content , policies , load , and the end systems involved .",
    "this makes out - of - band measurements inherently tricky .",
    "often at least one of the properties the path uses to make forwarding decisions will differ between operational transactions and synthetic measurement traffic  leading to the measurement not faithfully capturing the path s true treatment of particular traffic . in turn , this impacts the insights we gain from such measurements in unknown ways .",
    "thus , measurement _ within _ a protocol is not the same as out - of - band measurement .",
    "therefore , faithfully understanding production traffic calls for in - protocol primitives .",
    "* measurement consumer bears cost:*[pr : cost ]    designing protocols to enable measurement and introspection inherently imposes compute and memory requirements .",
    "we strive for designs that minimize state and per - packet processing , especially within the core of the network .",
    "our goal is to collect myriad small and simple bits of information provided by end systems and routers to gain broad understanding about the internet .",
    "we then aim to concentrate the costs of understanding these bits of information with the actor interested in the measurement to the extent possible . as an example",
    ", data collection can be probabilistic such that measurement data is contained within only a subset of packets or flows .",
    "situations requiring more granular , precise , or representative measurements can in turn employ broader or longer data acquisition .",
    "more generally , designing probabilistic behavior into measurement primitives allows them to be deployed with an explicit trade off between accuracy and overhead .",
    "this need not , however , limit the accuracy or coverage of the measurements available , by shifting the balance of effort from the runtime measurement process to a post - runtime analysis process .",
    "* measurement provider retains control:*[pr : control ]    within the tussle space of measurement , operations , and security , external measurements are frequently viewed as intrusive , violations of policy or privacy , or simply unwanted .",
    "application developers , network operators , and end users must have control over how much information is sent to the peer and/or exposed to observers along the path .",
    "control over measurement at the endpoints also allows measurement features to be selectively enabled in order to help diagnose issues for specific traffic flows .",
    "* measurement must be visible:*[pr : visible ]    the widespread deployment of asymmetric routing implies different behavior on the forward and reverse paths , and the opacity of one or another of these paths to one - way measurements limits the insight such measurements can provide .",
    "therefore , the ability of a packet recipient to echo information back to the packet source is crucial to increasing visibility into the path .",
    "the notion of visibility extends to [ pr : control ] , above . and , while integrity over measurements is essential , particularly in a world of network devices that transparently intercede , encryption or data obfuscation should not be relied upon as an enabler of measurements .",
    "more fundamentally , network elements that can not understand what measurements are being made may universally block all such measurements .",
    "* measurement should be cooperative:*[pr : cooperation ]    the internet has diverged from a clean end - to - end model .",
    "routers and middleboxes on path actively manipulate the data plane , and this design pattern can be extended to improve measurement .",
    "routers and middleboxes should participate in measurement not just via their control plane , but also via inspection and marking of the data plane .",
    "having distilled the principles underlying the design of ipim , we now turn to sketching ipim s information model . in this paper",
    "our goal is to sketch ipimat a high level .",
    "therefore , we do not focus on details such as header layout , information granularity , or counter sizes : a full protocol specification is left to future work .",
    "prior proposals , e.g. , @xcite , and standards , e.g. , @xcite , define new out - of - band protocols and mechanisms for path and delay diagnostics akin to a more featureful icmp . instead",
    ", our vision is broader  preferring to not only assess per - hop characteristics , but allow for measurements to be taken as a side - effect of normal protocol interactions , and hence serve as actionable input into protocol , network , and application operation .",
    "while we phrase these primitives in terms of information the sender exposes to the receiver to allow both sides to make measurements , we note that all of this information is available to passive observers as well .",
    "ipimcan thus be used to expose information which can be passively measured in aggregate .",
    "for example , a network border monitor can observe end - to - end timing information (   [ sec : prim : e2e : time ] ) to detect and react to path changes or congestion via analysis of the time series of latency among network pairs .",
    "note also that it is not necessary to provide all the information described in this section in each packet , or even within each flow .",
    "different uses of ipimwill require different types of information at varying granularity .",
    "therefore , ipim s use can be shaped for each specific need .",
    "for example , flows could be selected with a given probability to contain arrival information and hence provide a general characterization of the path without involving all connections .",
    "finally , we do not claim this sketch is complete or optimal . instead ipimis extensible",
    "such that additional information can be included in the future as needs arise .",
    "we start in   [ sec : prim : e2e ] by describing two primitives that operate only end - to - end ; i.e. , that require no interaction with devices along the path and can therefore be implemented and deployed today .",
    "we then describe primitives that require cooperation from devices along the path .",
    "we consider primitives that only require assistance from a subset of the intermediate devices in ",
    "[ sec : prim : hop ] and then move on to primitives that require cooperation of more or less all devices along a given path in ",
    "[ sec : prim : acc ] . while more difficult to deploy , these latter primitives illustrate what is possible when including measurement as a first - class citizen within the protocol stack .",
    "we start with information that can be collected with only the participation of the end systems .",
    "increasingly , ip addresses do not identify hosts .",
    "load balancers , anycast , ipv6 , nat , and the like frequently confound efforts that assume a host - to - address bijection . to calibrate the measurements ipimenables , we aim to understand",
    "precisely which host is involved in some communication by defining a host identification field @xmath3 .",
    "host identifiers have been explored extensively in the past ; see for instance literature on divorcing host identification from location of attachment , e.g. @xcite and references within . whereas this prior work uses such identifiers for discovery and delivery , our use is limited to measurements and not for traffic routing . in many cases",
    "stable host identifiers are not problematic , such as when identifying some replica of a service . however , in other cases they could help track users across time and attachment points . to balance measurement goals with privacy requirements , we offer two techniques to thwart tracking . first , @xmath3 will be modest in size  e.g . , 16  bits  to disambiguate multiple machines behind some common ip address .",
    "that is , @xmath3 is not meant to be globally unique . by the pigeon - hole principle , globally , or even behind large nats , there will be many hosts sharing the same @xmath3 and so a given @xmath3 can not be used to track a given host ( or user ) over time .",
    "second , since this identifier is meant for alias resolution , and not part of the data delivery process , it can be changed often and according to an end host s own policies without external coordination .",
    "for instance , while @xmath3 must be stable across connections and transactions to be useful , @xmath3 could be randomly reset every 30  minutes and/or each time the host joins a new network or obtains a new dynamic ip address .",
    "intentional identifier collisions combined with regular random identifier rotation enables measurements to disambiguate hosts , while still adhering to the security and privacy principle [ pr : control ] . in cases where the population under study is large and induces many identifier collisions , multiple observations over time suffice to probabilistically disambiguate by principle [ pr : cost ] .",
    "tcp s timestamp option @xcite points to a way to leverage information within a protocol to understand latency .",
    "tcp senders include both the current timestamp and the most recent timestamp received from the peer when sending a segment . in this way",
    ", a host can compare the echoed timestamp with the current time to determine the feedback time upon each packet arrival .",
    "beyond tcp , ipimprovides a general mechanism for protocols , applications , and passive observers , to utilize latency information .    as discussed in ",
    "[ sec : ex ] , tcp s mechanism suffices for use in determining the retransmission timeout ( rto ) , but for measuring network properties a key deficiency is that the latency measurements can include a non - trivial amount of non - network induced time introduced by tcp s delayed ack mechanism @xcite .",
    "therefore , simply taking the difference of the current time and the echoed time includes not only network latency , but also host - based delay .",
    "ipimgeneralizes and improves upon tcp s approach by using a timing tuple @xmath4 , where @xmath5 is the time the given segment was transmitted , @xmath6 is the timestamp from the previous packet to arrive in this flow ( connection ) and @xmath7 is the interval between when the previous segment was received and the current segment is being transmitted .",
    "this gives insight into the fraction of the round - trip delay added by the end hosts .",
    "for instance , consider a data segment sent by a host with @xmath8 and a corresponding ack received at time 95 with a timing tuple of @xmath9 .",
    "this tells us ( @xmath0 ) the ack was sent at time 143 according to the receiver s clock , ( @xmath1 ) the full amount of time between sending the data segment and receiving the ack is @xmath10 , and ( @xmath2 ) the amount of network - based delay in this case is @xmath11 .",
    "note that , following principle [ pr : cost ] , this calculation requires only a small amount of state to be kept at either endpoint ( i.e. , the arrival time and @xmath5 from the last packet arrival ) .",
    "finally , in addition to raw latency , this timing tuple can have additional uses  e.g .",
    ", to understand how packets are spread or compressed as they traverse the path for the purposes of capacity assessment @xcite",
    ".      given the internet s `` best effort '' nature , the source of a stream of packets is given no information about their handling by the network .",
    "some reliable protocols like tcp build machinery into the protocol that gives the sender some understanding of how the path is behaving ",
    "some notion of the packet loss rate and/or packet re - ordering .",
    "tcp gives the sender a rough understanding of these path properties by using the acknowledgment stream as a crude form of the echo facility we describe in [ pr : visible ] (   [ sec : prin ] ) .",
    "the acks give the sender a view , albeit limited , into the arrival process at the receiver .",
    "this same viewpoint is not naturally available for unreliable traffic or traffic for which reliability comes from heavy coding of the packet stream such that receiver could fix losses without involving the sender . in these cases ,",
    "the sender remains in the dark about the path s treatment of the packet stream . in ipimwe",
    "seek to better illuminate path behavior _ across _ protocols and applications .",
    "to understand arrival patterns , ipimincludes a nonce tuple + @xmath12 roughly modeled after the `` cumulative nonce '' from @xcite .",
    "the sender populates @xmath13 with a random but increasing value before transmitting the packet .",
    "the receiver simply sums ( modulo the size of the field ) the incoming @xmath13 values and places that value in the @xmath14 field of its outgoing packets . in this way",
    "the sender can reconstruct the arrival stream and pattern .",
    "for instance , consider the case when a sender transmits three segments with @xmath13 values of 5 , 1001 and 5800 and receives two acks in return with tuples ( 45,5800 ) and ( 1376,5805 ) . from the acks",
    "the sender can conclude three things : ( @xmath0 ) the acks were not mis - ordered because the @xmath13 values from the receiver are increasing ( from 45 to 1376 ) , ( @xmath1 ) the second segment sent by the sender ( with @xmath15 ) was lost since it is not included in the @xmath14 .",
    "the sender will have to wait for a long enough period of time to disambiguate loss and reordering . ] and ( @xmath2 ) the first and third packets arrived out of order since the @xmath14 reflects a packet with @xmath16 before including a packet with @xmath17 . we note that this mechanism does require state and processing to understand the path properties .",
    "however , per [ pr : cost ] in   [ sec : prin ] we lay this burden on the endpoint deriving the information .",
    "that is not strictly random , but uses some pattern of the source s choosing then understanding @xmath14 values that reflect loss and reordering may be easier than just using strictly random values and then using brute force to reconstruct the events . ] a recipient need only keep the current nonce sum and perform an add on each packet arrival .",
    "finally , we note that this mechanism also suffices for identifying misbehaving receivers that are trying to coax the sender into transmitting faster than normally allowed , which is the original intent of the cumulative nonce in @xcite .      a final piece of ipim s end - to - end information provides an integrity check over the outgoing packet per principle [ pr : cooperation ] .",
    "we take inspiration from hiccups @xcite and include a basic integrity tuple @xmath18 , where @xmath19 is an indication of which parts of the packet are covered by the integrity check ; @xmath20 is an indication of which mode the integrity check is using ( see below ) ; @xmath21 is a computed hash across the covered fields of the packet ; and @xmath22 is the most recent @xmath21 to arrive .",
    "the integrity check can use several modes .",
    "first , the sender can compute @xmath21 using only a well - known hash function and information within the packet itself .",
    "this allows the receiver to understand packet manipulations , but also would allow a middlebox to trivially re - compute the hash in a manipulated packet .",
    "a second mode calls for including a salt that only the sender knows in the @xmath21 value .",
    "while this mode prevents middleboxes from re - computing the @xmath21 , it also prevents the receiver from directly understanding manipulations .",
    "a final mode calls for computing @xmath21 with a salt known to both endpoints ( and arranged out - of - band ) .",
    "while this allows the receiver to understand manipulations while also preventing trivial @xmath21 replacement by middleboxes , it requires a shared secret between the endpoints .",
    "note that @xmath19 can vary over the course of a transaction .",
    "while @xmath22 can only give a binary indication of whether the given packet fields have changed , across a natural flow of packets with varying coverages , we can determine which parts of the packets are being transformed by the network .      while end hosts can usefully illuminate many aggregate path properties without directly involving the intermediate hops",
    ", we can often get additional or better information by directly engaging these network elements ( principle [ pr : cooperation ] ) . adding a requirement that all routers and in - path devices process all packets to assist with measurements is clearly burdensome .",
    "therefore , before discussing the types of information routers can provide , we introduce two strategies for collecting hop - specific information , as follows .",
    "* probabilistic stamping : * using this strategy , a router first samples a small fraction of the packets it forwards ( principle [ pr : cost ] ) .",
    "if a sampled packet includes an ipimrequest for information , the router fills in the requested information before forwarding the packet ( see below for specifics about the information that can be requested ) .",
    "the information from the router is echoed back to the source by the final recipient .",
    "the router includes the current ip ttl in the stamped information , which allows the sender to understand the relative location of the hop providing the information .",
    "the sampling rate  which could vary depending on the load on the router  allows routers to directly control the burden imposed by these measurements , or opt - out altogether ( principle [ pr : cost ] ) .    * triggered stamping : * we envision probabilistic stamping to be useful in developing a general understanding of the path and its properties . however , we introduce an additional technique to obtain information about a specific hop : triggered stamping . in this scenario a target ttl is given by the packet source and when the ip ttl equals the target ttl a router stamps the packet with the requested information . as",
    "above , the ultimate packet destination would echo the information back to the source .",
    "this closely follows the spirit of the icmp time exceeded message which calls for router action when the ip ttl reaches zero .",
    "ipimsimply extends this to triggering action on a particular ttl value and the information is then included in standard transactions rather than out - of - band in an icmp message .",
    "note , for either the probabilistic or triggered strategy , we follow the `` best effort '' principle and do not require routers to participate .",
    "we aim to make participation fairly low cost , but it will clearly be greater than simply forwarding a packet . when measuring the system under heavy load a tussle arises .",
    "on the one hand , this is a point where understanding and therefore measuring the system is particularly crucial . on the other hand , we do not wish to exacerbate operational problems for users .",
    "therefore , we advocate a system where each router can manage its own resources and decide what to provide and the end systems must cope with incomplete information .",
    "finally we note that while full deployment by all hops is ideal , the design admits incremental deployment and , where deployed , aids understanding of hop - specific details of the network .",
    "the per - hop information ipimstamps in packets can take several forms . here",
    "we sketch two tuples , although more could be added .",
    "topology information : : :    the first set of information routers may stamp relates to topology .",
    "we    define the following topology tuple : @xmath23 ,    where @xmath24 is a unique i d for the given router assigned by    the router owner , the @xmath25 is the autonomous system in    which the router resides and @xmath26 and @xmath27    are the ip addresses of the interface the packet arrives and departs    on , respectively .",
    "performance information : : :    routers may include performance information by encoding the tuple :    @xmath28 where @xmath5 is the    current time , @xmath29 is the queue length expressed as    time , should represent the aggregate queuing    time for the hop .",
    "] @xmath30 is the available    capacity ,    and @xmath31 is the current congestion level  which is meant to    be a finer grained version of ecn s binary feedback .",
    "in addition to the hop - specific information ipimgains each time a router stamps a packet , the information from multiple packets can be combined to form broader understanding . over time",
    ", the ipimstamped traffic will provide the ip- and as - level path over which the communication traverses .",
    "traditional topology ambiguities , such as the as to which a router belongs or the set of interface aliases , become explicit per [ pr : explicit ] .",
    "further , topology can be combined with performance information to more deeply understand how individual hops contribute to overall path properties , as opposed to our current situation of attempting to infer such information from suboptimal and sometimes dubious sources of information @xcite .",
    "a final note is that by providing space in a packet for a single router to populate , we side - step the fragmentation problem that results if routers are permitted to append information to the packet .",
    "that is , if each router were to add topology information ( a la ipmp @xcite ) the packet would grow to the point of requiring fragmentation ( or carry little , if any , actual payload data ) . by allocating fields in the packet for this information at transmission time",
    "we do not fall prey to this problem .",
    "hop - specific measurements (   [ sec : prim : hop ] ) are designed to develop an understanding of the specific hops that make up the path over some period of time ( and traffic ) , not instantaneously .",
    "we now add a third category of information that is not easily developed using either or both of the strategies from the previous two subsections : accumulated path information .",
    "that is , information that spans multiple hops , but can not be understood without help from the routers . as with the rest of ipim , the set of accumulated path properties we measure is extensible , but in this initial work we consider two sets of information , as follows .    path changes : : :    the first set of information aims to give an indication when the path    between two endpoints changes . for instance , this could inform a    congestion control scheme that it s understanding of the network path    is out - of - date and needs to be re - learned . to understand path changes    we introduce an evolution tuple @xmath32 that    works similarly to the ttl .",
    "the sender initializes    @xmath33 to some random value .",
    "each router    @xmath34 chooses some long - lived random offset    @xmath35 and adds @xmath35 to @xmath33    in each packet before forwarding , wrapping around on overflow .",
    "@xmath35 can be positive or negative , and can be large    relative to the range of @xmath36 .",
    "the receiver simply echos    the value back in @xmath37 field .",
    "the difference between    the starting @xmath33 and the received    @xmath37 at either endpoint should be constant    ( regardless of exact starting point for @xmath33 ) for a    path that does not change .",
    "when a path change causes a different set    of participating routers to be seen , their different @xmath35    values will alter the difference the end host observes .",
    "performance information : : :    we revisit the performance information we develop in a hop - specific    manner in   [ sec : prim : hop ] . instead of focusing on a single hop at a    time",
    ", it will sometimes be useful to understand accumulated state of    all hops at about the same time . as an example , previous work in quick",
    "start seeks to have routers validate an initial sending rate for a    flow @xcite .",
    "this means that each router must consider the target    sending rate in a packet and , if the rate is deemed too high , lower    the rate before forwarding the packet . with this in mind",
    "we define a    performance tuple @xmath38 where    @xmath39 is the minimum amount of available capacity at    any hop along the path ( as in the last subsection , this could be    coarsely encoded , a la quick start ) and @xmath40 is the    total amount of queuing delay due to participating routers .",
    "since the accuracy of accumulated path information increases with the proportion of routers participating , there are two additional considerations .",
    "first , it should be ( relatively ) inexpensive for a hop to contribute information .",
    "in particular , the information added to the traffic should remain static over some period of time and not require per - packet analysis .",
    "further , as we sketch above , this should be considered as `` best effort '' information to which the router can choose not to contribute when under high load . finally ,",
    "since we aim eventually to accumulate over all hops in the path , we need some way to understand whether all hops did indeed contribute . for this",
    "we borrow the quick start strategy of using a ttl@xmath41 field which starts at some random value and yields a @xmath42 .",
    "the ttl@xmath41 is decremented by one by each router that considers the accumulated information request .",
    "the destination of the packet echos back the absolute difference between the ttl and ttl@xmath41 .",
    "if the echoed difference is equal to the initial @xmath43 then all routers contributed to the accumulated path information .",
    "this mechanism helps to explicitly calibrate the information that comes back from the network so we do not have to guess how much of the path contributes to the measurement effort .",
    "we next discuss a number of ipimuse cases . these are not meant to be exhaustive , but rather are illustrative of the breadth of the utility provided by the facility .",
    "* protocol adaptation : * applications , systems and the underlying transport protocols often base their activities on some understanding of the network path .",
    "canonical examples include tcp s algorithms for adapting the sending rate to the network path s current congestion level and cdns routing application traffic to the best replica when necessary .",
    "ipimhelps these cases in two important ways : ( @xmath0 ) the assessment of the network becomes a standard facility instead of something that must be designed and built for each use , which reduces the cost of each use of the information and ( @xmath1 ) the granularity and accuracy of the information can be better ( e.g. , congestion control reductions in the sending rate can be tailored to the available capacity reported instead of blindly halving the rate ) .",
    "* network mapping : * in a network in which most routers support ipim , hop - specific information (   [ sec : prim : hop ] ) provides the possibility to replace _ traceroute _ with explicit topology and network structure discovery without _ traceroute _ s perennial drawbacks @xcite : potential differences in treatment between traceroute packets and production traffic , aliasing , and lack of information about the reverse path . in particular , routers that add ipimtopology stamps obviate the current expensive and error - prone requirement to reduce ip interfaces returned by traceroute to routers ( the aliasing problem ) .",
    "such topology information is valuable to enterprises for management and debugging , and invaluable to large providers seeking to optimize content delivery speed and reliability .",
    "* management : * many network management tasks ultimately involve understanding how a network is operating at the current time , determining whether the current performance is problematic and , if so , taking steps to fix the underlying issues .",
    "ipimcan assist the first two steps of this process .",
    "a network that can monitor the performance - related measurements  e.g .",
    ", latency  carried on production traffic can develop a notion of the overall state of the network as perceived by normal traffic .",
    "this can in turn be used to develop both a baseline performance expectation and therefore deviations from this baseline .    * informing policy : * the role of regulation and policy in shaping the internet has steadily increased .",
    "concerns over network neutrality @xcite , reliability @xcite , consumer choice , and competition @xcite have risen to the forefront as the internet as become critical infrastructure . policy and regulation",
    "are best shaped by empirical observation and therefore ipimis particularly apropos in this space as it offers the ability to concretely expose and attribute network structure , behavior , and the treatment of traffic .",
    "* data centers : * large amounts of content and computing are currently handled by data centers , which are often self - contained homogeneous networks in their own right .",
    "these environments may be early adopters of ipimas a data center often has stringent performance requirements and is under a single administrative control structure , allowing ipimto be more easily deployed .",
    "ipimcan expose timing , capacity , and delay information about production traffic flows in order to quickly adapt to real - time network conditions , load , and faults .",
    "while our goal in this work is to explore an architecture that generalizes internet measurements into a cohesive facility , we must be guided in part by eventual deployment constraints .",
    "here , we discuss several practical considerations for ipim .",
    "first , we consider ipim s overhead",
    ". ipim s new functionality comes at an inevitable cost .",
    "we consider two aspects of this cost in this initial work : ( @xmath0 ) transmission overhead ( bits on the wire required in each packet ) and ( @xmath1 ) the processing costs in the devices that provide and process ipiminformation .",
    "* packet overhead : * at first glance , adding measurement information inline would seem to impose a prohibitive per - packet overhead",
    ". however , three aspects of ipim s design reduce this overhead to a modest per - packet cost .",
    "first , not every communication will care about every network property ipimcan assess .",
    "e.g. , an application may wish to understand latency and topology , but not available bandwidth or middlebox interference .",
    "therefore , at most only a subset of ipim s capabilities will be brought to bear within each flow .",
    "second , periodic samples will often suffice , eliminating the requirement to place measurement information on every packet . in line with [ pr : control ] , originators can provide or request information be sampled per packet or per flow , depending on their measurement requirements .",
    "this also means that the measurements can be spread out such that each packet contains a single kind of measurement .",
    "finally , compact encoding of ipiminformation can reduce overhead on those packets containing measurement information while shifting the cost of processing to the measurement consumer , in line with [ pr : cost ] .",
    "for instance , consider the timing tuple we introduce in   [ sec : prim : e2e : time ] : @xmath4 .",
    "this could be encoded in a 32  bit field with each timestamp being allocated ten bits and the two remaining bits being used to indicate the granularity of the timestamps .",
    "this would suffice for the vast majority of latency sampling tasks at a cost of less than 0.3% of the space of a typical 1500  byte packet .    * processing overhead : * as we sketch in [ pr : cost ] in ",
    "[ sec : prin ] , one of our design guidelines is that ( @xmath0 ) most actors in the system should provide simple information that does not require significant new state and ( @xmath1 ) the beneficiary of the information bears the burden of analyzing the measurements to obtain high - level insight .",
    "this is especially important when information is collected from intermediate nodes  switches or routers .",
    "therefore , our design often calls for `` stamping '' packets with already known information instead of computing some new information and including that on the passing traffic .",
    "this packet manipulation is more akin to ecn marking of packets than , for instance , generating an entire new packet (  la icmp echo response or time - exceeded message , which also impose higher transmission costs ) .",
    "further , we explicitly consider the information `` best effort '' in that if a node is resource constrained , ipimwill not pose further cost .",
    "finally , we design for nodes to act on information in a probabilistic fashion so that nodes can ultimately enact policy that bests suits their needs as they balance the load imposed by ipimwith the node s myriad other tasks .",
    "there is a natural question of where to place the ipiminformation within packets .",
    "the principles and primitives we describe stand without regard to where the information is placed .",
    "however , [ pr : visible ] calls for ipiminformation to be visible to passive observation , so it needs to be easy for observers to know whether a given packet contains ipiminformation and where it is located . further , if in - path nodes such as switches and routers are to effectively participate in ipim , this information must appear at a fixed , or at least constant - time computable , location within the packet .",
    "ideally , we would build a thin measurement layer between the network and transport layers .",
    "this is a clean approach that satisfies the above criteria .",
    "however , wedging a new layer into the protocol stack may be too high of a burden for existing stacks and network devices .",
    "another possible location is building ipiminto the network layer , via extension headers within ipv6 ( or ip options within ipv4 ) , though the deployability of such headers is questionable  @xcite .",
    "understanding the pros and cons of these two approaches will be one of the crucial first tasks as we move from a conceptual design to an instantiated system .",
    "regardless of the location of the information , we note that the originator will need to build space into packets to carry any information provided by in - path devices .",
    "this is an important consideration as increasing packet sizes during transit may require fragmentation which would make ipimpractically unworkable .",
    "the current ad - hoc use of inferences to drive the operation of the internet illustrates that measurements are crucial and the effort to obtain information about operational networks is significant .",
    "hence , the benefits of ipim are clear . as detailed in our use cases (   [ sec : use ] ) , ipimbenefits not only network operators , but also researchers , policy makers , applications , and , ultimately , users .",
    "however , ipimstill must overcome not only the inertia facing any new technology , but must present a compelling advantage .    instrumentation and measurement is now common in data centers , among providers , and even within enterprises to increase performance , reliability , and utilization  all of which are driven by strong economic incentives .",
    "ipimwould provide a standard mechanism for all nodes , applications , and users to perform detailed introspection for their own benefits . and",
    "while some parties may be naturally adverse to exposing any information , ipim s design for explicitness and control admit a wide range of policies .",
    "we believe ipim s design offers a promising path for more closely integrating measurement into protocol design .",
    "first , via [ pr : cost ] , ipimis designed so that most of the actors simply provide small bits of information  leaving the consumer to bear the analysis costs .",
    "second , the primitives are independent and therefore can be implemented and deployed without a burdensome amount of unwanted complexity .",
    "for instance , the end - to - end timing primitive (   [ sec : prim : e2e : time ] ) can be adopted without the primitive that provides arrival information (   [ sec : prim : e2e : arr ] ) .",
    "the history of protocol transitions shows that such functional independence is crucial to adoption .",
    "technologies that require coordinated deployment by a multitude of actors to gain any benefit tend to be difficult to deploy ( e.g. , ipv6 @xcite , ecn  @xcite ) .",
    "third , as we argue in   [ sec : practical : overhead ] , ipim s overhead is low enough that it does not present a barrier to entry .",
    "finally , ipimdoes not need ubiquitous deployment to provide benefit .",
    "this manifests in a number of ways : ( @xmath0 ) endpoints can leverage the end - to - end primitives without any assistance from intermediate routers , ( @xmath1 ) endpoints can derive benefits from ipimif only some of their peers support the facility and ( @xmath2 ) incomplete information  such as might come from only some routers along a path supporting ipim  is still better than the current void of information .",
    "we also note that deployment of new technologies is easier within certain subsets of the internet .",
    "for instance , within a homogeneous network under unified administration , such as many data centers , fairly radical changes to the end points , routers , and protocols can be undertaken .",
    "data center networks and virtualized , software - defined networks increasingly rely on measurements to operate efficiently .",
    "uptake within such specialized networks may drive implementation , and in turn , availability of ipimhop - specific and path accumulating primitives on the internet at large .",
    "finally , we note that as new technologies emerge they inevitably change the surrounding ecosystem .",
    "in particular , adoption of a facility like ipimmay be driven by the loss of functionality as our protocols evolve .",
    "for example , the passive timing and arrival inference possible with traditional protocols like tcp are no longer available with protocols that radiate less information by design , such as quic  @xcite , rendering traditional techniques useless .",
    "a final practical consideration involves coping with adversaries that aim to provide bogus information within ipim .",
    "since we piggyback ipimon normal transactions , we get significant protection from blind , off - path attacks by ensuring we do not consider ipiminformation from invalid packets .",
    "that is , if a protocol would naturally discard a segment  e.g . , a tcp segment not within the current window ",
    "the ipiminformation should similarly be discarded .",
    "this leaves adversaries that are either legitimately involved in the communication or that can actively modify packets as they traverse the network .",
    "for instance , an isp providing performance information may decide to report a queue length that is smaller than the actual queue length to hide the presence of bufferbloat in their network . or , consider @xmath44 that wishes to make a competitor , @xmath45 look bad .",
    "@xmath44 can increase the queue length reported by @xmath45 in traffic as it passes through @xmath44 .",
    "one way to deal with this situation is to cryptographically sign and/or encrypt ipiminformation .",
    "encryption runs counter to [ pr : visible ] which dictates visibility into the ipiminformation . while signatures are possible , they are not foolproof and will likely end up burdensome .",
    "first , signatures do not help with the case where a legitimate information source simply provides bogus data .",
    "second , soundly establishing trust in the huge number of keys associated with the peers of a host or network will be a significant undertaking in the best case .",
    "therefore , we intend to deal with adversaries using ipim s data collection , statistics and discrepancy detection . for instance  to continue the example from above ",
    "if we only observe @xmath45 advertising a large queue when the traffic also traverses @xmath44 then we can start to treat these data points with some skepticism .",
    "similarly , finding queue length advertisements along a path that suggest a significantly different end - to - end latency than we measure via the timing tuple we can start to view the information speculatively .",
    "the importance of network measurement continues to grow to cope with the complex and tangled mess that is the modern internet .",
    "researchers and operators cleverly leverage various artifacts in network technologies to assess the network and in turn be more efficient , improve performance , and better understand the internet s behavior and operation .",
    "we assert that the time has come to think about measurement as a first - class piece of the network architecture , rather than embodied in a series of hacks .",
    "we offer ipimas a first step toward this goal .",
    "the primitives we define are intentionally not complicated , and embody a set of principles formed from operational and research experience .",
    "the small bits of _ explicit _ information in ipimcan be combined to form the basis of sound network assessment , which is too often the opposite of the current state of making inferences from whatever information can be gleaned from error - prone and convoluted techniques . while admittedly modest , our hope is to advance a process that we believe needs to be undertaken for the continued evolution of the internet .",
    "we leave protocol definition and implementation details of each primitive as future work . however , we note that work is underway within the ietf  @xcite to define a new layer in the protocol stack into which ipimcan be slotted ."
  ],
  "abstract_text": [
    "<S> measurement has become fundamental to the operation of networks and at - scale services  whether for management , security , diagnostics , optimization , or simply enhancing our collective understanding of the internet as a complex system . </S>",
    "<S> further , measurements are useful across points of view  from end hosts to enterprise networks and data centers to the wide area internet . </S>",
    "<S> we observe that many measurements are decoupled from the protocols and applications they are designed to illuminate . </S>",
    "<S> worse , current measurement practice often involves the exploitation of side - effects and unintended features of the network ; or , in other words , the artful piling of hacks atop one another . </S>",
    "<S> this state of affairs is a direct result of the relative paucity of diagnostic and measurement capabilities built into today s network stack .    </S>",
    "<S> given our modern dependence on ubiquitous measurement , we propose _ measurability _ as an explicit low - level goal of current protocol design , and argue that measurements should be available to all network protocols throughout the stack . </S>",
    "<S> we seek to generalize the idea of measurement _ within _ protocols , e.g. , the way in which tcp relies on measurement to drive its end - to - end behavior . </S>",
    "<S> rhetorically , we pose the question : _ what if the stack had been built with measurability and diagnostic support in mind ? _ we start from a set of principles for explicit measurability , and define primitives that , were they supported by the stack , would not only provide a solid foundation for protocol design going forward , but also reduce the cost and increase the accuracy of measuring the network . </S>"
  ]
}