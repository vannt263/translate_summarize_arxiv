{
  "article_text": [
    "the langevin equation for a particle with position @xmath0 and momentum @xmath1 , subject to a potential @xmath2 , can be written as @xmath3 where @xmath4 represent an uncorrelated , gaussian - distributed random force with unitary variance and zero mean [ @xmath5 , @xmath6 . here and what follows we use mass - scaled coordinates .",
    "furthermore , for consistency , the friction coefficient ( usually denoted by @xmath7 ) is here given the symbol @xmath8 , while @xmath9 is the intensity of the random force .",
    "in this notation , the fluctuation - dissipation theorem ( fdt ) reads @xmath10 . if this relation holds , the dynamics generated by eq .",
    "( [ eq : langevin ] ) will sample the canonical ensemble at temperature @xmath11@xcite .",
    "as explained in the introduction , in order to bypass the complexity of dealing with a non - markovian formulation directly , we supplement the system with @xmath12 additional degrees of freedom @xmath13 which are linearly coupled to the physical momentum and between themselves .",
    "the resulting sde can be cast into the compact form @xmath14 here , @xmath15 is a vector of @xmath16 uncorrelated gaussian random numbers , with @xmath17 .",
    "clearly , eq .  ( [ eq : langevin ] ) is recovered when @xmath18 . for an harmonic potential @xmath19 , eqs .",
    "( [ eq : mark - sde ] ) are linear , and an ornstein - uhlenbeck process is recovered whose time propagation can be evaluated analytically . in the non - linear case one",
    "can use the trotter - decomposition to split the dynamics into a linear part , which evolves the @xmath20 momenta , and a non - linear part , which evolves the hamilton equations@xcite .",
    "this is facilitated by the fact that the dynamics of @xmath20 alone is linear , and its exact finite - time propagator can be analytically evaluated ( see subsection  [ sub : implementation ] ) .    here and",
    "in the rest of the paper , we adopt the same notation introduced in ref .",
    "@xcite to distinguish between matrices acting on the full state vector @xmath21 or on parts of it , as illustrated below :    @xmath22    the markovian dynamical equations  ( [ eq : mark - sde ] ) are equivalent to a non - markovian process for the physical variables only .",
    "this is best seen by first considering the evolution of the @xmath20 variables in the free - particle analogue of eqs .",
    "( [ eq : mark - sde ] ) .",
    "the additional degrees of freedom @xmath23 can be integrated away , and one is left with ( see ref .",
    "@xcite and appendix  [ app : memory ] ) @xmath24 where the memory kernel @xmath25 is related to the elements of @xmath26 by @xmath27 based on the fact that the the free - particle dynamics of @xmath20 is an ou process , one also finds than the relationship between the static covariance matrix @xmath28 , the drift matrix @xmath26 and the diffusion matrix @xmath29 is given by : ) and the equations for the orthogonality constraints in car - parrinello dynamics , see e.g. ref .",
    "@xcite ] @xmath30 in appendix  [ app : memory ] we show that setting @xmath31 is sufficient to satisfy the fdt . in this case , eq .",
    "( [ eq : free - cov ] ) fixes @xmath29 once @xmath26 is given .",
    "fdt also implies that the colored - noise autocorrelation function @xmath32 is equal to @xmath33 , whereas the more complex relation between @xmath25 and @xmath34 , valid in the general case , is reported in eq .",
    "( [ eq : dred - mem - t ] ) .",
    "since there is no explicit coupling between the position @xmath0 and the additional momenta @xmath23 , one can check that exactly the same dimensional reduction can be performed in the case of an arbitrary potential coupling @xmath1 and @xmath0 , and that eqs .",
    "( [ eq : mark - sde ] ) correspond to the non - markovian process @xmath35 in the memory kernel  ( [ eq : kernel - k ] ) , @xmath36 can be chosen to be a general real matrix , and can have complex eigenvalues , provided they have a positive real part .",
    "this results in a @xmath25 that is a linear combination of exponentially damped oscillations .",
    "therefore , a vast class of non - markovian dynamics can be represented by markovian equations such as  ( [ eq : mark - sde ] ) .",
    "the thermostats typically used in md simulations have a few parameters , that are chosen by trial and error .",
    "a thermostat based on eqs .",
    "( [ eq : mark - sde ] ) depends on a much larger number of parameters , and hence the fitting procedure is more complex .",
    "it is therefore important to find ways to compute _ a priori _ analytical estimates so as to guide the tuning of the thermostat .    to this end",
    ", we examine the harmonic oscillator , which is commonly used to model physical and chemical systems . by choosing @xmath19 the force term in  ( [ eq : mark - sde ] ) becomes linear , and",
    "the dynamics of @xmath37 is the ou process @xmath38 . in eqs .",
    "( [ eq : mark - sde ] ) the @xmath23 degrees of freedom are coupled to the momentum only . therefore , most of the additional entries in @xmath39 and @xmath40 are zero , and the equations for @xmath41 read @xmath42    the exact finite - time propagator for eqs .",
    "( [ eq : mark - pq ] ) can be computed , and so it is possible to obtain any ensemble average or time - correlation function analytically .",
    "of course , one is most interested in the expectation values of the physical variables @xmath0 and @xmath1 .",
    "in particular , one can obtain the fluctuations @xmath43 and @xmath44 and correlation functions of the form @xmath45 , which can be used to measure the coupling between the thermostat and the system .",
    "the resulting expressions are simple to evaluate but lengthy , and we refer the reader to appendix  [ app : corr - time ] for their explicit form .",
    "one can envisage , using the estimates computed for an oscillator of frequency @xmath46 , to predict and hence optimize the response of a normal mode of a similar frequency in the system being studied .",
    "furthermore , thanks to the properties of eq .",
    "( [ eq : mark - pq ] ) , one does not need to perform a normal - modes analysis to turn this idea into a practical method .",
    "consider indeed a perfect harmonic crystal , and apply an independent instance of the gle thermostat to the three cartesian coordinates of each atom .",
    "it is easy to see that , since eq .",
    "( [ eq : mark - pq ] ) is linear , and contains gaussian noise , the thermostatted equations of motion are invariant under any orthogonal transformation of the coordinates .",
    "therefore , the resulting dynamics can be described on the basis of the normal modes just as in ordinary hamiltonian lattice dynamics . as a consequence",
    ", each phonon will respond independently as a 1-d oscillator with its own characteristic frequency .",
    "thus , to tune the gle thermostat , one only needs the analytical results in the one - dimensional case , evaluated as a function of @xmath46 .",
    "the parameters can then be optimized for a number of different purposes , based solely on minimal information on the vibrational spectrum of the system under investigation , without any knowledge of the phonons eigenmodes .",
    "the invariance properties of the gle thermostat lead to additional advantages .",
    "for instance , we can contrast its behavior with that of nos - hoover ( nh ) chains , based on equations which are quadratic in @xmath1 ( see appendix  [ app : nose ] ) . as a consequence of the nonlinearity , the efficiency of an nh chains thermostat for a multidimensional oscillator depends on the orientation of the eigenmodes relative to the cartesian axes , an artefact which is absent in our case .",
    "having set the background , we now turn to the description of the various applications of eqs .",
    "( [ eq : mark - sde ] ) .",
    "we first discuss the design of a gle which can optimally sample phase space . in this case",
    ", the target stationary distribution is the canonical ensemble , so the equations of motion need to satisfy the detailed - balance condition .",
    "still , there is a great deal of freedom available in the choice of the autocorrelation kernel or , equivalently , in the choice of @xmath26 and @xmath29 matrices .",
    "these free parameters can be used to optimize the sampling efficiency . to this end",
    ", we must first define an appropriate merit function .",
    "standard choices are the autocorrelation times of the potential and total energy ( @xmath47 and @xmath48 respectively ) : @xmath49 in the harmonic case , these can be readily computed in terms of correlation times of @xmath50 and @xmath51 ( see appendix  [ app : corr - time ] ) , and will depend on @xmath26 and the oscillator s frequency @xmath46 .",
    "for example , one easily finds that in the white - noise limit , with no additional degrees of freedom as in eq .",
    "( [ eq : langevin ] ) , @xmath52 both response times are constant in the high - frequency limit , and increase quadratically in the low - frequency extreme of the spectrum . for",
    "a given frequency one can choose @xmath8 so as to minimize the correlation time - thus enhancing sampling .",
    "it should be noted that eqs .",
    "( [ eq : tauh - wn ] ) contain a `` trivial '' dependence on @xmath46 , as one expects that sampling a normal mode would require at least a time of the order of its vibrational period .",
    "one can thus define a renormalized @xmath53^{-1}$ ] as a measure of the efficiency of the coupling .",
    "in the white - noise case , @xmath54 for the optimally - coupled frequency ( @xmath55 and @xmath56 , respectively ) , and decreases linearly for lower and higher values of @xmath46 .",
    "while this result in itself provides a guide to choose a good value of the friction coefficient in conventional ( white - noise ) langevin dynamics , we can enhance the value of @xmath57 over a broader frequency range , by using a colored - noise sde .",
    "if we want to obtain canonical sampling , the fdt has to hold , so that @xmath31 .",
    "we therefore consider the entries of @xmath26 as the only independent parameters , since @xmath29 is then determined by eq .",
    "( [ eq : free - cov ] ) .    in practice",
    ", we set up a fitting procedure , in which we choose a set of frequencies @xmath58 , distributed over a broad range @xmath59 .",
    "for an initial guess for the thermostat matrix @xmath26 we compute @xmath57 for each of these frequencies .",
    "we then vary @xmath26 , so as to optimize @xmath60 , and aim at a sampling efficiency on the range @xmath59 which is as high and frequency - independent as possible .",
    "we will discuss this fitting procedure in more detail in section  [ sec : fitting ] .",
    "sampling efficiency as estimated from eq .",
    "( [ eq : taus ] ) for an harmonic oscillator , plotted as a function of the frequency @xmath46 .",
    "the @xmath57 curve for a white - noise langevin thermostat optimized for @xmath61 [ black , dotted lines , eq.([eq : tauh - wn ] ) ] is contrasted with those for a set of optimized gle thermostats .",
    "the panels , from bottom to top , contain the results fitted respectively over a frequency range spanning two , four and six orders of magnitudes around @xmath61 .",
    "dark , continuous lines correspond to matrices with @xmath62 , and dashed , lighter lines to @xmath63 .",
    "the gle curves correspond to the sets of parameters kv_4 - 2 , kv_2 - 2 , kv_4 - 4 , kv_2 - 2 , kv_4 - 6 , kv_2 - 6 , which can be downloaded from an on - line repository@xcite . ]    in figure  [ fig : gle - opt ] we compare the optimized @xmath57 for different frequency ranges and number of additional degrees of freedom .",
    "we find empirically that @xmath64 is the best result which can be attained , and that nearly - optimal efficiency can be reached over a very broad range of frequencies .",
    "this constant efficiency decreases slightly as the fitted range is extended , regardless of the number @xmath12 of @xmath65 employed . for a given frequency range , however ,",
    "increasing @xmath12 has the effect of making the response flatter .",
    "clearly this scheme will work optimally in harmonic or quasi - harmonic systems , and anharmonicity will introduce deviations from the predicted behavior . in the extreme case of diffusive systems such as liquids , one has to ask the question of how much diffusion will be affected by the thermostat , especially since in an overdamped le equation the diffusive modes are considerably slowed down ( see e.g.  ref .",
    "@xcite ) . to estimate the impact of the thermostat on the diffusion , we define the free - particle diffusion coefficient @xmath66 as that calculated switching off the physical forces .",
    "its value when a gle thermostat is used is @xmath67_{pp}=\\left(a_{pp } -\\mathbf{a}_p^t\\mathbf{a}^{-1}\\bar{\\mathbf{a}}_p\\right)^{-1}. \\end{split } \\label{eq : diff - coeff}\\ ] ] where we have assumed the fdt to hold . in practical cases ,",
    "if an estimate of the unthermostated ( intrinsic ) diffusion coefficient @xmath68 is available , one should choose the matrix @xmath26 in such a way that @xmath69 , so that the thermostat will not behave as an additional bottleneck for diffusion .",
    "equation   has the interesting consequence that @xmath66 can be enhanced either by reducing the overall strength of the noise , as in white - noise le , but also by carefully balancing the terms in the denominator of eq .",
    "( [ eq : diff - coeff ] ) .",
    "we have found empirically that for an @xmath26 matrix fitted to harmonic modes over the frequency range @xmath59 , the diffusion coefficient computed by  ( [ eq : diff - coeff ] ) is @xmath70 .",
    "this latter expression gives a useful recipe for choosing the minimal frequency to be considered when fitting a gle thermostat for a system whose diffusion coefficient can be roughly estimated .",
    "the ability to control the strength of the thermostat - system coupling as a function of the frequency  demonstrated above ",
    "points quite naturally at more sophisticated applications .",
    "for instance , one can apply two thermostats with distinct target temperatures and different efficiencies @xmath57 ( see figure  [ fig : twothermo ] ) .",
    "obviously , such a simulation is not an equilibrium one , since energy is systematically injected in some modes and removed from others , but leads to a steady state that has useful properties .",
    "indeed , the normal modes will couple differently to the two thermostat , so that the effective temperature of each mode can be controlled as a function of @xmath46 .",
    "this two - thermostats example is just an instance of a broader class of stochastic processes , for whom the fdt is violated . in general",
    ", we can relax the assumption that @xmath31 , and for a given drift matrix we can choose a @xmath29 which is suitable to our purpose .     a cartoon representing a two - thermostat setup , which we take as the simplest example of a stochastic process violating the fluctuation - dissipation theorem .",
    "if the relaxation time versus frequency curves for the two thermostats are different , a steady - state will be reached in which normal modes corresponding to different frequencies will equilibrate at different effective temperatures . ]    returning to the harmonic oscillator case , one can solve exactly the dynamics for a given choice of @xmath26 , @xmath29 and frequency @xmath46 .",
    "the resulting dynamics is performed in the @xmath71-dimensional space defined by the variables @xmath72 , according to eq .",
    "( [ eq : mark - pq ] ) . for a compact notation",
    ", we used the full matrices @xmath39 and @xmath40 .",
    "the full @xmath73 , which defines the stationary distribution in the steady state , can be computed solving an equation analogous to  ( [ eq : free - cov ] ) : @xmath74 one can tune the free parameters ( @xmath26 and @xmath29 ) so as to make the @xmath75 and @xmath76 elements of the extended covariance matrix as close as possible to the desired target functions @xmath77 and @xmath78 .    in a previous paper @xcite we applied this method to obtain @xmath77 and @xmath78 in agreement with the values appropriate for a quantum harmonic oscillator , and obtained a good approximation to the quantum - corrected structural properties in quasi - harmonic systems .",
    "many other applications can be envisaged , which take advantage of frequency - dependent thermostatting .",
    "for instance , one could use this technique in accelerated sampling methods@xcite , which work by artificially heating the low - frequency modes , whilst keeping the other modes at the correct temperature .",
    "the implementation of a gle thermostat in molecular - dynamics simulations is straightforward . here",
    ", we consider the case of a velocity - verlet integrator , which updates positions and momenta by a time step @xmath79 , according to the scheme : @xmath80 eqs .",
    "( [ eq : vv - integrator ] ) can be obtained using trotter splitting in a liouville operator formalism@xcite . in the same spirit",
    "one can introduce our gle thermostat by performing two free - particle steps by @xmath81 on the @xmath20 variables@xcite : @xmath82\\\\    p&\\leftarrow p + v'(q ) \\delta t /2\\\\    q&\\leftarrow q + p \\delta t\\\\    p&\\leftarrow p + v'(q ) \\delta t /2.\\\\",
    "\\left(p,\\mathbf{s}\\right)&\\leftarrow \\mathcal{p}\\left[\\left(p,\\mathbf{s}\\right),\\delta t/2\\right]\\\\   \\end{split } \\label{eq : gle - integrator}\\ ] ]    at variance with thermostats based on second - order equations of motion such as nos - hoover , where a multiple time - step approach is required to obtain accurate trajectories@xcite , this free - particle step can be performed without introducing additional sampling errors .",
    "the exact finite - time propagator for @xmath20 reads : @xmath83^t=",
    "\\mathbf{t}(\\delta t)\\left(p,\\mathbf{s}\\right)^t + \\mathbf{s}(\\delta t)\\boldsymbol{\\xi}^t \\label{eq : fp - integrator}\\ ] ] where @xmath15 is a vector of @xmath16 uncorrelated gaussian numbers , and the matrices @xmath84 and @xmath85 can be computed once , at the beginning of the simulation and for all degrees of freedom@xcite .",
    "the relations between @xmath84 , @xmath85 , @xmath26 , @xmath86 and @xmath79 read @xmath87    it is worth pointing out that when fdt holds , the canonical distribution is invariant under the action of  ( [ eq : fp - integrator ] ) , whatever the size of the time - step .",
    "a useful consequence of this property is that , in the rare cases where applying  ( [ eq : fp - integrator ] ) introduces a significant overhead over the force calculation , the thermostat can be applied every @xmath88 steps of dynamics , using a stride of @xmath89 .",
    "this will change the trajectory , but does not affect the accuracy of sampling .",
    "the velocity - verlet algorithm  ( [ eq : vv - integrator ] ) introduces finite-@xmath79 errors , whose effect needs to be monitored . in microcanonical simulations ,",
    "this is routinely done by checking conservation of the total energy @xmath48 . following the work of bussi  _",
    "et al._@xcite we introduce a conserved quantity @xmath90 , which can be used to the same purpose : @xmath91 where @xmath92 is the change in kinetic energy due to the action of the thermostat at the @xmath93-th time - step , and the sum is extended over the past trajectory . in cases where the fdt holds , such as that described in section  [ sub : canonical ] , the drift of the effective energy quantitatively measures the violation of detailed balance induced by the velocity - verlet step , similarly to refs .",
    "@xcite . in the cases where the fdt does not hold , such as the frequency dependent thermostating described in section  [",
    "sub : quantum ] , the conservation of this quantity just measures the accuracy of the integration , similarly to refs .",
    "a key feature of our approach resides in our ability to optimize the performance of the thermostat based on analytical estimates , making the method effectively parameterless .",
    "such optimization , however , is not trivial , even if computationally inexpensive .",
    "the relationship between @xmath26 , @xmath29 and the correlation properties of the resulting trajectory is highly nonlinear .",
    "furthermore , we found empirically that many local minima exist which greatly hinder the optimization process . with these difficulties in mind ,",
    "we provide a downloadable library of fitted parameters@xcite which can be adapted to most of the foreseeble applications , according to the prescriptions given in section  [ sub : scaling ] .",
    "details about the fitting procedure are given in the following three subsections .",
    "a number of constraints must be enforced on the drift and diffusion matrices in order to guarantee that the resulting sde is well - behaved .",
    "it is therefore important to find a representation of the matrices such that during fitting these conditions are automatically enforced , and that the parameters space is efficiently explored .",
    "a first condition , required to yield a memory kernel with exponential decay , is that all the eigenvalues of @xmath26 must have positive real part .",
    "a second requirement is that the kernel @xmath94 is positive for all real @xmath46 .",
    "this ensures that the stochastic process will be consistent with the second law of thermodynamics@xcite .",
    "finding the general conditions for @xmath26 to satisfy this second constraint is not simple .",
    "however , we can state that a sufficient condition for @xmath95 is that @xmath96 is positive definite . for simplicity we shall assume such a positivity condition to hold , since we found empirically that this modest loss of generality does not significantly affect the accuracy or the flexibility of the fit",
    ". moreover , in the case of canonical sampling , @xmath97 is also required in order to obtain a real diffusion matrix , since @xmath98 according to eq .",
    "( [ eq : free - cov ] ) .",
    "one would like to find a convenient parameterization , which enforces automatically these constraints .",
    "this is best done by writing @xmath99 , the sum of a symmetric and antisymmetric part . since any orthogonal transform of the @xmath23 degrees of freedom would not change the dynamics ( see appendix  [ app : memory ] ) , one can assume without loss of generality that the @xmath100 block in @xmath101 is diagonal ( see eq .",
    "( [ eq : notation ] ) for the naming convention ) . since in the general case",
    "the antisymmetric @xmath102 does not commute with @xmath101 , we will assume it to be full , while @xmath101 can be written in the form @xmath103 in order to enforce the positive - definiteness , one use an analytical cholesky decomposition @xmath104 , with @xmath105 @xmath106 and @xmath107 , @xmath108 , and @xmath109 .",
    "such a parameterization guarantees that @xmath26 will generate a dynamics with a stationary probability distribution , and requires @xmath110 parameters for the symmetric part ( the elements of @xmath105 , eq .",
    "( [ eq : fit - q ] ) ) , and @xmath111 for the antisymmetric part @xmath102 .",
    "if we want the equilibrium distribution to be the canonical , one we must enforce the fdt , and @xmath112 is uniquely determined .",
    "if we aim at a generalized formulation , which allows for frequency - dependent thermalization , there are no constraints on the choice of @xmath29 other than the fact that both @xmath112 and the covariance @xmath86 must be positive - definite .",
    "clearly , a real , lower - triangular @xmath29 is the most general parameterization of a positive - definite @xmath112 , and amounts at introducing @xmath113 extra parameters . together with the assumption that @xmath114 , the condition @xmath115 is sufficient to ensure that the unique symmetric @xmath86 which satisfies  ( [ eq : free - cov ] ) is also positive - definite .",
    "armed with such a robust and fairly general parameterization , one only needs to define a merit function to be optimized .",
    "again , we first consider the simpler case of canonical sampling . here",
    ", we want to obtain a flat response over a wide , physically - relevant frequency range @xmath59 .",
    "we have chosen the form @xmath116^{1/m } , \\label{eq : chi - sampling}\\ ] ] where @xmath58s are equally spaced on a logarithmic scale over the fitted range . if a large value of @xmath88 is chosen , the @xmath58 which yields the lowest efficiency is weighted more , and a flat response curve is obtained .",
    "we found empirically that values of @xmath88 larger than @xmath117 lead to a proliferation of local minima , and hinder efficient optimization . to resolve this",
    ", one can use the optimal parameters for @xmath118 as input for further refinement at larger @xmath88 , until convergence is achieved .     thermostatting efficiency , as estimated from eq .",
    "( [ eq : taus ] ) , for a colored - noise thermostat optimized for car - parrinello dynamics .",
    "sampling efficiency is optimized for @xmath119 , and an abrupt drop in efficiency is enforced for @xmath120 , using the penalty function  ( [ eq : chi - carparrinello ] ) in the fitting .",
    "the continuous ( dark red ) curve corresponds to @xmath121 , the dashed ( orange ) curve to @xmath122 and the dotted ( light orange ) curve to @xmath123 .",
    "the @xmath57 curve for a white - noise thermostat centered on the optimized range is also reported for reference ( dotted black curve ) .",
    "the three curves correspond to the parameters set cp-9_4 - 3 , cp-6_4 - 3 and cp-3_4 - 3@xcite . ]",
    "this procedure can be modified so as to provide an efficient thermostat which can be used in car - parrinello - like dynamics . in this case",
    ", the gle has to act as a low - pass filter in which only the low ionic frequencies are affected , and fast electronic modes are not perturbed . to obtain this effect , we compute  ( [ eq : chi - sampling ] ) only for the @xmath58 s which are smaller than a cutoff frequency @xmath124 , and we introduce an additional term @xmath125\\right|^m   \\right]^{1/m}. \\label{eq : chi - carparrinello}\\ ] ] @xmath126 enforces a steep decrease of @xmath57 above @xmath124 , with a slope @xmath127 on a logarithmic scale .",
    "values of @xmath127 as large as @xmath128 can be used , which guarantee an abrupt drop in thermalization efficiency for the fast modes ( see figure  [ fig : gle - cpmd ] ) .",
    "we now discuss the case in which the thermostat is permitted to violate fdt , in order to achieve frequency - dependent equilibration . for these applications",
    ", one must also fit the fluctuations @xmath76 and @xmath75 to some target function @xmath129 and @xmath130 .",
    "we shall not treat the general case , but rather investigate the example of the quantum thermostat ( ref .",
    "the procedure followed provides a clear guide for future extensions to different applications .    in order to reproduce quantum ions effects",
    ", one must selectively heat high - frequency phonons , for which zero - point energy effects are important , without affecting the low - frequency modes which behave classically .",
    "the required frequency dependence of the variance for this case is that of a quantum oscillator , i.e. @xmath131 the @xmath132 , classical limit can be proved to correspond to two conditions on the elements of the free - particle covariance matrix @xmath86 ; namely , @xmath133 and @xmath134 .",
    "one could enforce such constraints exactly , by considering the entries of @xmath86 as independent fitting parameters , and obtaining the diffusion matrix from eq .",
    "( [ eq : free - cov ] ) .",
    "we found however that this choice makes it difficult to obtain a positive - definite @xmath112 , and that the fitting becomes more complex and inefficient .",
    "as an alternative , we decided to enforce the low - frequency limit with an appropriate penalty function , @xmath135 to be optimized together with the sampling efficiency  ( [ eq : chi - sampling ] ) and a term which measures how well the finite - frequency fluctuations were fitted : @xmath136^{1/m } \\label{eq : chi - fdt}\\ ] ] since the low - frequency limit is already enforced by  ( [ eq : chi - climit ] ) , we compute  ( [ eq : chi - fdt ] ) on a set of points equally spaced between the maximum frequency @xmath137 and one half of the onset frequency for quantum effects @xmath138 .      the scheme described in the previous sections allowed us to obtain matrices suitable for all the applications discussed in previous works .",
    "furthermore , it provides a starting point for obtaining matrices which one might deem useful for novel applications .",
    "however , the reader is advised that the fitting is still far from being a black - box procedure .",
    "it is thus necessary to experiment with a combination of different initial parameters and minimization schemes .",
    "we found the downhill simplex methods@xcite to be particularly effective , but resorted to simulated annealing when the optimization got stuck in a local minimum .",
    "there is a great deal of arbitrariness in the choice of the terms ( [ eq : chi - sampling]-[eq : chi - fdt ] ) , and in their weighted combination @xmath139 . to make the procedure even more delicate",
    ", we observe that in high-@xmath12 cases the parameters tend to collapse into `` degenerate '' minima , where the full dimensionality of the search space is not exploited .",
    "this phenomenon can be successfully circumvented by enforcing an even spacing of the eigenvalues of @xmath36 over the frequency range of interest , and slowly releasing this restraint during the later stages of optimization .",
    "however , the problems mentioned above have no major practical consequences , as the computation of analytical estimates is inexpensive and one can afford a great deal of trial - and - error during the optimization .",
    "moreover , fitted parameters can be reused , since the optimized parameters can be easily transferred to similar problems because of the scaling properties of the dynamics  ( [ eq : mark - pq ] ) .    in fact , one can see that if the drift and covariance matrices @xmath140 lead to the efficiency curves @xmath57 and fluctuations @xmath76 , the scaled matrices @xmath141 will yield @xmath142 , and the fluctuations @xmath143 .",
    "this means that if @xmath26 is optimized for sampling over the range @xmath59 , @xmath144 will be optimal over @xmath145 .",
    "we also remark that if @xmath140 are fitted to the quantum harmonic oscillator fluctuations at temperature @xmath11 , @xmath146 will be suitable for temperature @xmath147 .",
    "care must be taken in this case to ensure that the scaled frequency range still encompasses the whole vibrational spectrum of the system being studied .",
    "as discussed in ref.@xcite , one must pay a great deal of attention when using a `` quantum thermostat '' , because energy is transferred between modes of different frequency , as a consequence of the anharmonic coupling .",
    "this is reminiscent of zero - point energy ( zpe ) leakage which plagues semiclassical approaches to the computation of nuclear quantum effects@xcite . in the cases we explored so far",
    ", empirical evidence suggests that quasi - harmonic solids , can be treated with good accuracy down to temperatures as low as @xmath148% of the debye temperature @xmath149 . clearly , the ultimate test to assess of the accuracy of the method is a comparison with path - integral calculations , to be performed on a similar but computationally cheaper model , such as a smaller - size box or a simpler force field .",
    "one would like however to obtain some qualitative measure of the quality of the fit , and to gauge the transferability of a given set of parameters .",
    "to this end , we first state a couple of empirical rules , and then validate them on two fairly different real systems .",
    "a first observation is that it is useless to push the fitting of the fluctuations @xmath76 and @xmath75 to very high accuracy , if this comes at the expense of the coupling efficiency .",
    "in fact , we would be trading a small , controlled fitting error with a possibly larger , uncontrollable and system - dependent error stemming from anharmonicity .",
    "secondly , we observed that in order to contrast more effectively the flow of energy between different phonons , one should try to reduce the correlation time of the kinetic energy @xmath150 , rather than focus solely on the terms  ( [ eq : taus ] ) , which are better suited to measure sampling efficiency .",
    "in fact , a low @xmath151 corresponds to a slightly overdamped regime , where sampling efficiency is sub - optimal , but zpe is enforced more tightly .",
    "( a ) : @xmath46-dependence of the kinetic energy correlation time @xmath152 ( light , dotted line ) and of the ratio of the fitted fluctuations @xmath76 ( dashed line ) and of @xmath153 ( full line ) with the exact , quantum - mechanical target function .",
    "( b ) : normal - mode - projected kinetic temperature for a few , selected phonons .",
    "the dashed line is the value expected from the fitting @xmath76 , while the full line is the exact , quantum - mechanical expectation value for a harmonic oscillator .",
    "calculations have been performed with the parameters qt-20_6_bad@xcite . ]",
    "( a ) : @xmath46-dependence of the kinetic energy correlation time @xmath151 ( light , dotted line ) and of the ratio of the fitted fluctuations @xmath76 ( dashed line ) and of @xmath153 ( full line ) with the exact , quantum - mechanical target function .",
    "( b ) : normal - mode - projected kinetic temperature for a few , selected phonons .",
    "the dashed line is the value expected from the fitting @xmath76 , while the full line is the exact , quantum - mechanical expectation value for a harmonic oscillator .",
    "calculations have been performed with the parameters qt-20_6@xcite . ]    to demonstrate these concepts in a real system , we performed some calculations with a tersoff model of diamond at a temperature @xmath154  k. at this low temperature , slightly below @xmath155 , quantum effects are very strong , and we therefore expect to have problems maintaining the large difference in temperature between the stiff and soft phonons . using a very harmonic system such as diamond is particularly useful , since one can monitor directly the efficiency of the thermostat by projecting the atomic velocities on a selection of normal modes .",
    "hence , a projected kinetic temperature @xmath156 can be computed , and its value checked against the predictions in the harmonic limit , in the same spirit as in ref.@xcite . in figure",
    "[ fig : qd - bad ] we report the results with a matrix fitted taking into account only the terms  ( [ eq : chi - climit ] ) and  ( [ eq : chi - fdt ] ) . even in a harmonic system such as diamond",
    "there are major errors due to zpe leakage from the high - frequency to the low - frequency modes , which the thermostat compensates only partially .",
    "these poor results should be compared with those of figure  [ fig : qd - good ] . here",
    ", we have also introduced in the fit a term analogous to  ( [ eq : chi - sampling ] ) to reduce the value of @xmath151 .",
    "the projected kinetic temperature now agrees almost perfectly with the analytical predictions @xmath76 for most of the modes .",
    "the only ones displaying significant deviations are the faster ones , for whom the value of @xmath151 is slightly larger .",
    "the @xmath76 curve deviates by nearly @xmath148% from the exact , quantum - mechanical expectation value .",
    "however , thanks to the more efficient coupling , the errors due to anharmonicities are better compensated , and in actuality , the overall error is much smaller than for the parameters presented in figure  [ fig : qd - bad ] .",
    "radial distribution function as computed from fully - converged path - integral calculations@xcite ( black , dotted line ) , and from a quantum - thermostat md trajectory for a lennard - jones model of solid neon at @xmath157  k. distances are in reduced units .",
    "full line corresponds to the parameters set qt-20_6 ( cfr .",
    "figure  [ fig : qd - good ] ) , and lighter , dashed line to the set qt-20_6_bad ( cfr .",
    "figure  [ fig : qd - bad ] ) . ]    to test whether these prescriptions work for less harmonic problems , we now turn to a completely different system ; namely , the structural properties of solid neon at @xmath158  k. at variance with diamond , quantum - ions effects are less pronounced , but the system is close to its melting temperature , and it is significantly anharmonic . as shown in figure  [ fig : qneon ] , the agreement between our results and those of accurate path - integral calculations@xcite is almost perfect if the parameters of figure  [ fig : qd - good ] are used",
    ". as expected , large errors are present if qt-20_6_bad is used .",
    "further improvements on the fitting strategy , and the application to strongly anharmonic systems is currently being investigated , and will be the subject of further work .",
    "in this paper we have discussed in detail the use of colored - noise dynamics , based on ornstein - uhlenbeck processes , as a tool for performing molecular dynamics .",
    "applications range from enhanced sampling , which we demonstrate in the harmonic limit and which will be applied to real systems in forthcoming publications , to thermostats for adiabatically separated problems and frequency - dependent thermalization .",
    "our idea exploits the linear nature of the ou stochastic differential equations , which allows one to use the one - dimensional harmonic oscillator as a simple but physically - motivated reference model . on the basis of the analytical prediction obtained in that case",
    ", we describe a recipe for fitting the thermostat parameters so as to obtain the desired response properties in real systems .",
    "the procedure is not simple , and we are considering different approaches to make it more robust and effective .",
    "fortunately however , fitted matrices can be easily transferred from one system to another . with this in mind",
    "we have provided an extensive library of optimized parameters@xcite , which makes fitting unnecessary for most applications .",
    "we also comment on practical issues concerning the implementation of the generalized - langevin thermostat in a molecular - dynamics program and its use in applications .",
    "in particular , we discuss in detail how one can use colored noise to model nuclear quantum effects@xcite .",
    "we provide some empirical rules to guide the fitting in this difficult case , and we demonstrate that a normal - mode analysis in a quasi - harmonic system is a valuable tool for assessing the quality of a set of parameters .",
    "we believe that further investigation will find many other applications for colored - noise in molecular - dynamics , and in computer simulations of molecular systems in general . as an example",
    ", we are currently investigating using a zero - temperature , optimal - sampling gle thermostat in order to perform structural optimization . on similar lines , and taking inspiration from `` quantum annealing''@xcite",
    ", one can envisage using frequency - dependent thermalization to improve the performance of simulated annealing .",
    "the authors would like to thank david manolopoulos for important suggestions and fruitful discussion , marcella iannuzzi for having implemented the gle thermostat in cp2k@xcite , alessandro curioni for implementation in cpmd@xcite , grigorios pavliotis and michela ottobre for discussion and references on stochastic processes .",
    "we also acknowledge stefano angioletti - uberti , paolo elvati , hagai eshet , kuntal hazra , rustam khaliullin and tom markland for discussion and for having preliminarily tested the thermostat in real applications , providing valuable feedback .",
    "we are especially in debt with gareth tribello , who contibuted to testing and greatly helped us improving the manuscript .",
    "the connection between the markovian  ( [ eq : mark - sde ] ) and non - markovian  ( [ eq : nonmark - sde ] ) formulations of the colored - noise langevin equation can be understood using techniques similar to those adopted in mori - zwanzig theory@xcite .",
    "let us first consider a very general , multidimensional ou process , where we single out some degrees of freedom ( @xmath159 ) that we wish to integrate out , leaving only the variables marked as @xmath41 .",
    "@xmath160    assuming that the dynamics has finite memory , one can safely take @xmath161 , and the ansatz @xmath162 \\mathrm{d}t ' .",
    "\\label{eq : dred - ansatz}\\ ] ] substituting into ( [ eq : dred - mark ] ) , one sees that @xmath159 can be eliminated from the dynamics of @xmath41 , and arrives at @xmath163 one can see that  ( [ eq : dred - nonmark ] ) are invariant under any orthogonal transformation of the @xmath159 dynamical variables , meaning that such a transformation leaves the dynamics of the @xmath41 s unchanged .",
    "the colored noise is better described in terms of its time - correlation function , @xmath164 .",
    "let us first introduce the symmetric matrix @xmath165 , whose parts we shall label using the same scheme used for @xmath36 in eq .  ( [ eq : dred - mark ] ) . we shall also need @xmath166 . with these definitions in mind",
    ", one finds @xmath167   \\quad \\left(t\\ge0\\right ) .",
    "\\label{eq : dred - ht}\\ ] ] note that the value of @xmath168 for @xmath169 is determined by the constraint @xmath170 ; the value of @xmath171 instead , is irrelevant for negative times : we will assume @xmath172 to hold , since this will simplify some algebra below .",
    "let s now switch to the case of the free - particle counterpart of eqs .",
    "( [ eq : mark - sde ] ) , which is relevant to the memory functions entering eqs .",
    "( [ eq : nonmark - sde ] ) . here , we want to integrate away all the @xmath23 degrees of freedom , retaining only the momentum @xmath1 .",
    "hence , we can transform eqs .",
    "( [ eq : dred - nonmark ] ) and  ( [ eq : dred - ht ] ) to the less cumbersome form @xmath173 \\end{split } \\label{eq : dred - mem - t}\\ ] ] this compact notation hides certain relevant property of the memory kernels , which are more apparent when the kernels are written in their fourier representation . if @xmath174 is transformed according to eq .",
    "( [ eq : free - cov ] ) . @xmath94 and @xmath175 read @xmath176 it is seen that the memory functions ( hence the dynamical trajectory ) are independent of the value of @xmath177 , the covariance of the fictitious degrees of freedom .",
    "moreover , a sufficient condition for the fdt to hold is readily found . by setting @xmath178 and @xmath179 ,",
    "one obtains @xmath180 , which is precisely the fdt for a non - markovian langevin equation .",
    "since the value of @xmath177 is irrelevant we can take @xmath31 , which simplifies the algebra and leads to numerically - stable trajectories .",
    "given @xmath36 and @xmath177 matrices ( the drift term and the static covariance for a generic ou process ) , one can find the diffusion matrix @xmath181 by an expression analogous to eq .",
    "( [ eq : free - cov ] ) .",
    "the same relation can be used to obtain the elements of @xmath177 given the drift and diffusion matrices , by solving the linear system .",
    "however , the covariance matrix can be computed more efficiently by finding the eigendecomposition of @xmath182 , and computing @xmath183_{kl}o_{jl } } { \\alpha_k+\\alpha_l}. \\label{eq : cov}\\ ] ]    now , let @xmath41 be the vector describing the trajectory of the ou process .",
    "in order to compute @xmath184 or @xmath185 ( eq .  ( [ eq : taus ] ) )",
    "one needs time correlation functions of the form @xmath186 .",
    "the corresponding , non - normalized integrals @xmath187 \\mathrm{d}t\\ ] ] can be computed in terms of the tensorial quantity @xmath188_{ml}o_{jn}\\left[\\mathbf{o}^{-1}\\mathbf{c}\\right]_{nk}}{\\alpha_m+\\alpha_n } \\label{eq : xijkl}\\ ] ] as @xmath189 .",
    "for example  if we consider the full ou process in the harmonic case ",
    "one computes @xmath190 where we use an obvious notation for the indices in @xmath191 .",
    "the most widespread techniques for canonical sampling in md are probably white - noise langevin and nos - hoover chains ( nhc ) .",
    "white - noise langevin can be considered as a limit case of the thermostatting method we describe in this work , but nhc is based on a redically different philosophy .",
    "it is therefore worth performing a brief comparison between the latter and the gle thermostat .    in the `` massive '' version of the nh thermostat@xcite , each component of the physical momentum",
    "is coupled to an additional degree of freedom with a fictitious mass @xmath192 , by means of a second - order equation of motion .",
    "the resulting dynamics ensures that the physically - relevant degrees of freedom will sample the correct , constant - temperature ensemble , with the advantage of having deterministic equations of motion , and a well - defined conserved quantity .",
    "however , in the harmonic case , trajectories are poorly ergodic .",
    "this problem can be addressed by coupling the fictitious momentum to a second bath variable with a similar equation of motion . by repeating this process further",
    "a `` nos - hoover chain '' can be formed , which ensures that the dynamics is sufficiently chaotic to achieve efficient sampling@xcite .",
    "the drawback of this approach is that the thermostat equations are second - order in momenta .",
    "it is therefore difficult to obtain analytical predictions for the properties of the dynamics , and the integration of the additional degrees of freedom must be performed with a multiple time - step approach , which makes the thermostat more expensive .    to examine the performances of nhc and gle",
    ", one could envisage comparing the sampling efficiency as defined by the correlation times  ( [ eq : taus ] ) .",
    "obtaining such estimates is not straightforward , not only because the the harmonic case can not be treated analytically , but also because in the multidimensional case the properties of the trajectory will not be invariant under an orthogonal transformation of coordinates , as discussed in section  [ sec : gle ] .",
    "the simplest model we can conceive for comparing nhc and gle is therefore a two - dimensional harmonic oscillator , with different vibrational frequencies on the two normal modes and adjustable relative orientations of the eigenvectors with respect to the thermostatted coordinates .",
    "correlation time for the potential energy of a 2-d harmonic oscillator , as a function of the angle between the eigenmodes and the cartesian axes .",
    "@xmath185 is computed for different values of the condition number @xmath193 , from bottom to top 10 , 31.6 and 100 .",
    "thin lines serve as an aid for the eye , connecting the results obtained in the three cases using a massive nh chains thermostat , with four additional degrees of freedom and @xmath194 .",
    "error bars are also shown for individual data points .",
    "thick lines correspond to the ( constant ) result predicted for a gle thermostat , using respectively the thermostat parameters kv_2 - 1 , centered on @xmath195 , kv_4 - 2 , centered on @xmath196 , and kv_4 - 2 centered on @xmath197 .",
    "the values obtained in actual gle simulations agree with the predictions within the statistical errorbar , and are not reported . ]",
    "the resulting @xmath185 is reported in figure  [ fig : rot - nose ] : in the highly anisotropic cases , the efficiency of the nh chains depends dramatically on the orientation of the axes , while for well - conditioned problems is almost constant .",
    "the linear stochastic thermostat , on the other hand , has a predictable response , which is completely independent on orthogonal transforms of the coordinates . in the one - dimensional case  or when eigenvectors are perfectly aligned with axes ",
    "nh chains are very efficient for all modes with frequency @xmath198 .",
    "one should however consider that , in the absence of an exact propagator , choosing a small @xmath192 implies that integration of the trajectory for the chains will become more expensive .",
    "obviously , such a simple toy model does not give quantitative information on the behavior in real - life cases , where modes of different frequencies coexist with anharmonicity and diffusive behavior .",
    "however , it demonstrates that the colored - noise langevin thermostat performs almost as well as the axis - aligned nh chains .",
    "furthermore , unlike the nhc , there are no unpredictable failures for anisotropic potentials ."
  ],
  "abstract_text": [
    "<S> recently , we have shown how a colored - noise langevin equation can be used in the context of molecular dynamics as a tool to obtain dynamical trajectories whose properties are tailored to display desired sampling features . in the present paper , after having reviewed some analytical results for the stochastic differential equations forming the basis of our approach , we describe in detail the implementation of the generalized langevin equation thermostat and the fitting procedure used to obtain optimal parameters . </S>",
    "<S> we discuss in detail the simulation of nuclear quantum effects , and demonstrate that , by carefully choosing parameters , one can successfully model strongly anharmonic solids such as neon . for the reader s convenience , a library of thermostat parameters and some demonstrative code can be downloaded from an on - line repository .    stochastic differential equations ( sde ) </S>",
    "<S> have been used to model the time evolution of processes characterized by random behavior , in fields as diverse as physics and economics . in particular , the langevin equation ( le ) has been regularly applied in the study of brownian motion , and has been used extensively in molecular dynamics ( md ) computer simulations as a convenient and efficient tool to obtain trajectories which sample the constant - temperature , canonical ensemble@xcite .    in its original form , the langevin equation is based on the assumption of instantaneous system - bath interactions , which correspond to the values of the random force being uncorrelated at different times . a non - markovian , generalized version of the le arises in the context of mori - zwanzig theory@xcite . </S>",
    "<S> in this theory , if one considers a harmonic system coupled with a harmonic bath , it is possible to integrate out the degrees of freedom of the bath . </S>",
    "<S> this leaves one with a linear stochastic equation where both the friction and the noise have a finite memory . </S>",
    "<S> the conventional le is recovered in the limit of a clear separation between the characteristic time - scale of the system s dynamics and that of the system - bath interaction .    </S>",
    "<S> this class of non - markovian sdes has been extensively used to model the dynamics of open systems interacting with a physically - relevant bath ( see e.g.  refs .  </S>",
    "<S> @xcite ) . instead </S>",
    "<S> , our recent works@xcite have used colored(correlated)-noise sdes as a device to sample efficiently statistical distributions in molecular - dynamics ( md ) simulations . </S>",
    "<S> these works aimed to show how a stochastic thermostat suitable for car - parrinello - like dynamics@xcite could be constructed , and to include nuclear quantum effects in a large class of problems at a fraction of the cost of path - integrals calculations@xcite . in these applications the real dynamics is lost , and one focuses only on the efficient calculation of static ensemble averages .    in this paper </S>",
    "<S> we discuss the practical implementation of the generalized langevin equation ( gle ) thermostat that we used in the two cases mentioned above . </S>",
    "<S> we also provide the reader with the analytical and numerical tools needed to construct sdes tailored to their own sampling needs . throughout we take advantage of the dimensional reduction scheme , which allows to exploit the equivalence between a non - markovian dynamics and a markovian dynamics in higher dimensionality . in doing this , we supplement the physical coordinates with additional degrees of freedom@xcite , whose equations of motion are taken as linear , so as to simplify the formalism and analytical derivations .    in the appendices we recall some of the properties of multidimensional stochastic processes@xcite , which are useful to our discussion , and present a short comparison of the gle thermostat and the widely used massive nos - hoover chains@xcite . </S>",
    "<S> a simple fortran90 code implementing our method to the dynamics of an harmonic oscillator and a library of optimized thermostat parameters can be downloaded from an on - line repository@xcite . </S>"
  ]
}