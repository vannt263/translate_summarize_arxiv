{
  "article_text": [
    "transcriptome data are fast becoming an important and cost effective component of phylogenetic studies @xcite .",
    "the rapid fall in sequencing prices has contributed to the growing number of phylogenetic studies that integrate data from genomes and transcriptomes , often referred to as `` phylogenomic '' analyses .",
    "there is wide recognition that adding data from a larger number of genes is necessary to address many open phylogenetic questions , though of course additional gene sequences alone will not be sufficient to resolve them all @xcite .",
    "the primary impediments to wider adoption and further improvement of phylogenomic methods are the complexity of the analyses and the lack of integrated tools to conduct them .",
    "each phylogenomic study requires many steps , the vast majority of which concern matrix construction rather than phylogenetic analysis itself .",
    "these steps include raw data filtering , assembly , identification of ribosomal rna , selection of transcript splice variants , translation , identification of homologous sequences , identification of orthologous sequences , sequence alignment , phylogenetic analysis , and summary of results .",
    "implementing a phylogenomic analysis is not just a matter of executing available tools for each of these steps . among other challenges",
    ", results must be summarized across multiple steps , detailed records must be kept of all analysis steps , data files often need to be reformatted between analyses , and computational load must be balanced according to the available resources .    because phylogenomic studies are complex and have been manual or semi - automated , they are difficult to implement and explicitly describe , and require extensive technical effort to reproduce .",
    "these problems can make it difficult to evaluate results , integrate data across studies , expand analyses , or test the impact of alternative analysis approaches .",
    "in addition , manual analyses often include many subjective decisions that may impact the final results .",
    "some higher - level pipelines have addressed subsets of phylogenomic analyses .",
    "these tools include partigene @xcite , a pipeline to aid in the assembly and annotation of sanger transcriptome data collected across a diversity of species , and scafos @xcite , a semi - automated tool for the curation of super matrices from previously assembled transcriptomes .",
    "no existing tool , however , can execute a full phylogenomic analysis of modern sequence data .",
    "we addressed these needs by developing agalma , an automated phylogenomics workflow . using agalma ,",
    "an investigator can conduct complete phylogenomic analyses , from raw sequence reads to preliminary phylogenetic trees , with a small number of high - level commands .",
    "the results are accompanied by detailed reports that integrate diagnostic information across data sets and analysis steps . in a first pass with agalma",
    ", the investigator conducts the analysis under default settings .",
    "the investigator then consults the reports to consider how best to optimize the analyses , and easily re - executes them with updated settings to produce new matrices and preliminary trees .",
    "the investigator can then analyze the optimized matrices with external phylogenetic inference tools not already included within agalma to explore other factors , such as model sensitivity .",
    "we built agalma with biolite  @xcite , a generic bioinformatics pipeline framework .",
    "biolite profiles memory and cpu use , tracks provenance of all data and analyses , and centralizes diagnostic reporting .",
    "agalma is a modular workflow comprised of helper scripts and a series of pipelines .",
    "each pipeline is made up of stages that call internal analysis functions ( many implemented with the help of biopython  @xcite ) and wrappers from the biolite python module .",
    "the wrappers invoke command - line tools , which include external bioinformatics tools such as the bowtie2 aligner @xcite and trinity assembler @xcite , as well as several c++ tools from biolite .",
    "the first step for analyzing each data set , whether it consists of raw reads to be assembled or of previously assembled gene predictions , is to catalog the data .",
    "this creates a database entry that includes sample metadata and the paths to the data files .",
    "agalma has built - in support for transcriptome assembly of pair - end illumina data only . when analyzing public data , raw reads and associated metadata can be imported directly from the ncbi sequence read archives ( sra ) using the command ` sra import ` .",
    "this command downloads the reads for a given sra accession number ( experiment , study , sample , or run ) , converts them into fastq format , and populates the catalog with the corresponding data paths and metadata .",
    "there are several distinct tasks subsequent to cataloging the data  sequence assembly , loading the genes into the database , and phylogenetic analysis .",
    "these tasks are described in detail in the ` readme ` and ` tutorial ` files provided with agalma , and are briefly summarized below .",
    "the pipeline ` transcriptome ` runs an assembly from read filtering through assembly and preliminary annotation . in a typical analysis , ` transcriptome ` would be run once for each species for which raw illumina transcriptome data are available .",
    "the ` transcriptome ` pipeline executes the following sub - pipelines , which can also be run individually :    * ` sanitize ` filters raw paired - end illumina data and randomizes the order of reads ( maintaining read order between paired files ) to facilitate subsequent subsetting .",
    "reads are discarded if they do not meet a specified mean quality threshold , if they contain illumina adapter sequences , or if the base composition is highly skewed ( if any base represents either @xmath0 or @xmath1 of the sequence ) .",
    "this pipeline also generates fastqc  @xcite summaries of read quality . * ` insert_size ` uses subassemblies and mapping to estimate the mean and variance of the insert size ( i.e. , the length of the fragment between the sequencing adapters ) .",
    "this information provides important feedback on the success of sample preparation , and is also used in some downstream analysis steps . * ` remove_rrna ` removes most reads that are derived from ribosomal rna ( rrna ) .",
    "removing rrna in advance of assembly can reduce both the number of chimeric transcripts and the time required for assembly .",
    "this pipeline first assembles multiple subsets of reads .",
    "a range of subset sizes is used since the optimal number of reads for assembling a particular rrna transcript depends upon multiple factors , including the fraction of reads that originate from rrna and the uniformity of coverage across the rrna transcripts ( which can vary greatly , depending on how denatured the samples were prior to fragmentation ) .",
    "rrna transcripts are then identified by blast comparison of these subassemblies to an included dataset of known rrna sequences .",
    "the entire set of reads is then compared to the rrna transcripts that are identified form the subassemblies , and any reads that map to them are removed .",
    "a plot of the distribution of reads across exemplar rrna transcripts is shown to help evaluate rrna assembly success .",
    "the top hit in the ncbi ` nt ` database is also provided as an independent check on sample identity and to help spot potential contaminants .",
    "the fraction of reads that derive from rrna is also reported to aid in improving library preparations .",
    "* ` assemble ` filters the reads at a higher quality threshold and assembles them .",
    "assemblies can be conducted under multiple protocols ( such as multiple assemblers , or the same assembler under different settings ) .",
    "this pipeline can also assemble multiple subsets of different numbers of reads , which provides perspective on how sequencing effort impacts assembly results .",
    "the default assembler is trinity @xcite .",
    "the wrapper we have included in agalma for running trinity makes two improvements over the wrapper script that comes with trinity .",
    "first , we have added a filter in between the chrysalis and butterfly stages to remove components that are smaller than the minimum transcript length parameter passed to butterfly , since running butterfly on these components will not yield a transcript .",
    "for the five assemblies in our test data set , this reduces the number of butterfly commands from roughly 100,000 to 60,000 .",
    "second , we have replaced the parafly utility that is used for concurrent execution of the butterfly commands with the gnu ` parallel ` tool @xcite because it has better parallel efficiency .",
    "parafly executes the commands concurrently , but in blocks , so that the time to execute a block is the runtime of the slowest individual command .",
    "the runtimes can vary greatly because of variance in transcript length and complexity .",
    "in contrast , ` parallel ` load balances the commands across the available processors . * ` postassemble ` uses ` blastn ` against the rrna reference sequences to identify rrna transcripts ( these could include low abundance transcripts , such as parasite contaminants , that were not removed as reads by ` remove_rrna ` ) and screens against the ncbi univec database to identify vector contaminants ( such as protein expression vector contaminants in the sample preparation enzymes , which we have encountered in multiple samples ) .",
    "it selects an exemplar transcript ( i.e. , splice variant ) for each gene based on an assembly confidence score .",
    "it maps the reads to the exemplar transcripts to build a coverage map that helps assess the distribution of sequencing effort across genes . finally , it uses ` blastx ` to compare the transcripts against the ncbi swissprot database to establish which are similar to previously known proteins .",
    "following these steps , the investigator can inspect the assembled data directly or load them into the agalma database to prepare them for phylogenetic analysis .",
    "subsequent phylogenetic analyses require that all gene sequences to be considered are loaded into the local agalma database .",
    "the ` load ` command takes care of this process . in a typical analysis , ` load ` is executed once for each dataset that has been assembled by the ` transcriptome ` pipeline described above , and once for each set of gene predictions from external sources ( e.g. , externally assembled 454 transcriptome data or gene predictions from genome sequencing projects ) .",
    "once assemblies for multiple species are loaded into the local agalma database , the user carries out a phylogenomic analysis by consecutively executing the following pipelines :    * ` homologize ` allows the user to specify which datasets to include in a particular phylogenetic analysis .",
    "it then uses an all - by - all ` tblastx ` search to build a graph with edges representing hits above a stringent threshold , and breaks the graph into connected components corresponding to clusters of homologous sequences with the markov clustering algorithm ( mcl ) tool @xcite .",
    "* ` multalign ` applies sampling and length filters to each cluster of homologous sequences , and uses another all - by - all ` tblastx ` within each cluster to trim sequence ends that have no similarity to other sequences in the cluster ( these could include , for example , chimeric regions ) .",
    "the sequences of each cluster are aligned using macse  @xcite , a translation - aware multiple - sequence aligner that accounts for frameshifts and stop codons .",
    "multiple sequence alignments are then cleaned with gblocks  @xcite .",
    "optionally , the alignments can be concatenated together to form a supermatrix . * ` genetree ` uses raxml  @xcite to build a maximum likelihood phylogenetic tree for each cluster of homologous sequences .",
    "gene trees can be filtered according to mean bootstrap support , which eliminates genes that have little phylogenetic signal @xcite and reduces overall computational burden .",
    "this filter can be applied prior to running ` treeprune ` ( described below ) , which has the added advantage of restricting ortholog selection to only well - supported gene trees .",
    "all options available in raxml can be passed as optional arguments . if the input is a supermatrix consisting of concatenated orthologs , it builds a species tree . * ` treeprune ` identifies orthologs according to the topology of gene phylogenies , using a new implementation of the method introduced in a previous phylogenomic study @xcite .",
    "it uses dendropy  @xcite to prune each gene tree into maximally inclusive subtrees with no more than one sequence per taxon .",
    "each of these subtrees is considered as a set of putative orthologs .",
    "the pruned subtrees are re - entered as clusters into agalma s database .",
    "after ` treeprune ` , the user can build a supermatrix and a preliminary maximum likelihood species tree with raxml .",
    "these steps , which include rerunning ` multalign ` and ` genetree ` on the orthologs , are detailed in the agalma ` tutorial ` file . the user can then proceed with more extensive phylogenetic analyses of the supermatrix using external phylogenetic inference software of their choice ( only raxml is included with agalma at this time ) .",
    "as the alignments for each gene are also provided , the investigator can also apply promising new approaches that simultaneously infer gene trees and species trees @xcite .",
    "a small set of test data is provided with agalma .",
    "it consists of 25,000 100bp illumina read pairs for the siphonophore _ hippopodius hippopus _ , a subset of 72 - 74 gene sequences assembled for each of five siphonophores , and a subset of 40 gene predictions from the _ nematostella vectensis _ genome assembly .",
    "these data were chosen because they run relatively quickly and enable testing of most commonly used features .",
    "these test data serve several purposes .",
    "they allow a user to validate that agalma is working correctly , and users are strongly encouraged to run this test with the command ` agalma test ` right after installation .",
    "the test data also serve as the foundation for the example analysis described in the ` tutorial ` file . for the developer , the ` agalma test ` command serves as a regression test to check if changes break existing features .",
    "we routinely run this test in the course of adding and refactoring code .",
    "the test data also serve as a minimal case study for developing new features without needing to first download and curate data .",
    "in addition to the small test data sets included with agalma , here we present an example analysis of larger data sets from seven species . though most phylogenetic analyses would include more taxa than this simple example case , the size of the dataset for each species is typical for contemporary phylogenomic analyses .",
    "this seven - taxon data set consists of new raw illumina reads for five species of siphonophores , _ abylopsis tetragona _ , _ agalma elegans _ , _",
    "nanomia bijuga_. _ physalia physalis _ ,",
    "_ craseoa sp . _ , and gene predictions for two outgroup taxa , _ nematostella vectensis _ @xcite and _ hydra magnipapillata _",
    "@xcite , produced by previous genome projects .",
    "mrna for the five siphonophore samples was isolated with dynabeads mrna direct ( life technologies ) and prepared for sequencing with the truseq rna sample prep kit ( illumina ) .",
    "the sample preparation was modified by including a size selection step ( agarose gel cut ) prior to pcr amplification .",
    "analyses were conducted with agalma version 0.3.3 .",
    "we deposited the new data in a public archive ( ncbi sequence read archive , bioproject prjna205486 ) prior to running the final analysis . a git repository of the scripts we used to execute the example analyses is available at https://bitbucket.org/caseywdunn/dunnhowisonzapata2013 .",
    "these scripts download the data from the public archives , execute the analyses , and generate the analysis reports .",
    "all of the figures presented here are taken from the analysis reports generated by agalma .",
    "this illustrates how a fully reproducible and open phylogenomic analysis can be implemented and communicated with agalma .",
    "these scripts can be used as they are to repeat the analyses .",
    "they could also be modified to try alternative analysis strategies on these same data , or they could be adapted to run similar analyses on different data .",
    "the tabular assembly report ( ` index.html ` in additional file 1 ) summarizes assembly statistics across samples , and links to more detailed assembly reports for each sample . for the example analysis , this summary indicates , among other things , that the fraction of rrna in each library ranged from @xmath2% to @xmath3% and the insert sizes were on average @xmath4 bp long .",
    "the detailed assembly reports have extensive diagnostics that pertain to sample quality and the success of library preparation . as an example",
    ", figure 1 shows several of the plots from the detailed assembly report for _ agalma elegans _ , the siphonophore after which our tool is named .",
    "the distribution of sequencing effort across genes ( figure 1a ) and the size distribution of transcripts ( figure 1b ) are typical for _ de novo _ illumina transcriptome assemblies .",
    "the agalma phylogeny report includes a plot of the number of genes considered at each stage of the analysis . in the example analysis ,",
    "the step that removed the most genes was cluster refinement in ` multalign ` ( figure 2 ) .",
    "this reduction is largely due to the elimination of clusters that failed the taxon sampling criteria , and reflects uncertainty regarding the homology of some sequences and sparse sampling of some homologs .",
    "the next major reduction in the number of genes occurred in ` treeprune ` .",
    "these reductions are due to both uncertainty regarding orthology and poor sampling of some ortholog groups .",
    "the preliminary species tree for the example analysis ( figure 3 ) is congruent with previous analyses of siphonophore relationships @xcite .",
    "phylogenomic analyses are computationally intensive .",
    "detailed information about resource utilization helps investigators plan resources for projects and balance computational load more efficiently .",
    "it is also critical for the optimization of the analyses , and can help guide design decisions . for each analysis , agalma produces a resource utilization plot that displays the time and maximum memory used by external executables ( figure 4 ) . the peak memory use , and the longest - running step , in the  transcriptome  pipeline was ` assemble ` .",
    "a distinction is sometimes drawn between manual approaches that enable close user inspection of data and results , and automated approaches that isolate the user from their results . this is a false dichotomy  automating analyses and examining the results closely are not mutually exclusive .",
    "automated analyses with detailed diagnostics provide the best of both worlds .",
    "the user has a very detailed perspective on their analysis , and the added efficiencies of automation leave the investigator with far more time to assess these results .",
    "automation also allow improvements made in the context of one study to be applied to other studies much more effectively .    for a study to be fully reproducible ,",
    "both the data and the analysis must be described explicitly and unambiguously .",
    "the best description of an analysis is the code that was used to execute the analysis . by automating phylogenomic analyses from data download through matrix construction and preliminary phylogenetic trees ,",
    "agalma enables fully reproducible phylogenomic studies .",
    "this will allow reviewers and readers to reproduce an entire analysis exactly as it was run by the authors , without needing to re - curate the same dataset or rewrite the analysis code .",
    "there are alternative approaches to many of the steps in a phylogenomic analysis presented here .",
    "there are , for example , multiple tools that identify orthologs according to different methods and criteria @xcite .",
    "agalma is a general framework and can be expanded to include these additional methods , and directly compare them in the context of a complete workflow that is consistent in all other regards .",
    "* project name : * agalma + * project home page : * https://bitbucket.org/caseywdunn/agalma + * operating system(s ) : * linux , mac os x + * programming language : * python + * other requirements : * biolite + * license : * gnu",
    "the authors declare that they have no competing interests .",
    "cwd and mh conceived of the original design of agalma , and together with fz made most design decisions .",
    "mh , cwd , and fz implemented and tested the software and wrote the manuscript .",
    "mh did most of the coding .",
    "mh and fz conducted the computational analyses .",
    "all authors read and approved the final manuscript .",
    "steve haddock provided several of the specimens , and freya goetz prepared all material for sequencing .",
    "thanks to deb goodwin and the students aboard _ ssv robert c. seamans _ for collecting the _ physalia physalis _ specimens , and to erik zettler and the sea education association for facilitating this opportunity .",
    "thanks also to christian sardet for assisting with collecting the _",
    "hippopodius hippopus_. freya goetz prepared the two siphonophore samples for sequencing .",
    "stephen smith and nicholas sinnott - armstrong made important contributions to early planning of agalma .",
    "stefan siebert assisted with curation of the test dataset and provided suggestions on features .",
    "richard nguyen provided html and css styling for the reports .",
    "thanks to steve haddock , warren francis , lingsheng dong , and other early - adopters for feedback on previous versions of agalma .",
    "rebecca helm provided helpful comments on an earlier version of this manuscript .",
    "this research was conducted using computational resources and services at the center for computation and visualization , brown university .",
    "agalma was developed with the support of the us national science foundation ( awards 0844596 , 0844596 , 1004057 , and 1256695 ) .",
    "\\(a ) the distribution of sequencing reads across genes , sorted from the most frequently sequenced genes to the least frequently sequenced genes .",
    "( b ) the size distribution of the assembled genes , for all genes and for only those genes that have a blastx hit to a protein in the swissprot database .",
    "see additional file 1 for further assembly diagnostics .",
    "most gene sequences are eliminated in the first step of homology evaluation ( the first call to the ` refine_clusters ` stage of the ` multalign ` pipeline ) . of the remaining sequences ,",
    "many are eliminated during orthology evaluation ( the ` treeprune ` pipeline ) .",
    "see additional file 2 for further diagnostics regarding matrix construction .",
    "this tree was inferred from the protein supermatrix under the @xmath5 model .",
    "this plot is from the report for the _ agalma elegans _ assembly .",
    "the html report for the assembly of the test data sets from raw reads .",
    "the tabular report ( index.html ) provides an overview across the five assemblies for the ingroup taxa , and includes links ( in the catalog i d column ) to detailed reports for the assembly of each species .",
    "fasta files for the annotated transcripts have been removed from the report to reduce file size .",
    "this report is available as a zipped archive at https://bitbucket.org/caseywdunn/dunnhowisonzapata2013/downloads/tabular.zip .",
    "the html report for the phylogenetic analysis of the sample data .",
    "this report is available as a zipped archive at https://bitbucket.org/caseywdunn/dunnhowisonzapata2013/downloads/agalmaexampletree.zip ."
  ],
  "abstract_text": [
    "<S> * background : * in the past decade , transcriptome data have become an important component of many phylogenetic studies . </S>",
    "<S> they are a cost - effective source of protein - coding gene sequences , and have helped projects grow from a few genes to hundreds or thousands of genes . </S>",
    "<S> phylogenetic studies now regularly include genes from newly sequenced transcriptomes , as well as publicly available transcriptomes and genomes . </S>",
    "<S> implementing such a phylogenomic study , however , is computationally intensive , requires the coordinated use of many complex software tools , and includes multiple steps for which no published tools exist . </S>",
    "<S> phylogenomic studies have therefore been manual or semiautomated . </S>",
    "<S> in addition to taking considerable user time , this makes phylogenomic analyses difficult to reproduce , compare , and extend . </S>",
    "<S> in addition , methodological improvements made in the context of one study often can not be easily applied and evaluated in the context of other studies .    </S>",
    "<S> * results : * we present agalma , an automated tool that conducts phylogenomic analyses . </S>",
    "<S> the user provides raw illumina transcriptome data , and agalma produces annotated assemblies , aligned gene sequence matrices , a preliminary phylogeny , and detailed diagnostics that allow the investigator to make extensive assessments of intermediate analysis steps and the final results . </S>",
    "<S> sequences from other sources , such as externally assembled genomes and transcriptomes , can also be incorporated in the analyses . </S>",
    "<S> agalma is built on the biolite bioinformatics framework , which tracks provenance , profiles processor and memory use , records diagnostics , manages metadata , and enables rich html reports for all stages of the analysis . </S>",
    "<S> agalma includes a small test data set and a built - in test analysis of these data . </S>",
    "<S> in addition to describing agalma , we here present a sample analysis of a larger seven - taxon data set . </S>",
    "<S> agalma is available for download at https://bitbucket.org/caseywdunn/agalma .    </S>",
    "<S> * conclusions : * agalma allows complex phylogenomic analyses to be implemented and described unambiguously as a series of high - level commands . </S>",
    "<S> this will enable phylogenomic studies to be readily reproduced , modified , and extended . </S>",
    "<S> agalma also facilitates methods development by providing a complete modular workflow , bundled with test data , that will allow further optimization of each step in the context of a full phylogenomic analysis .    </S>",
    "<S> * keywords : * transcriptomes , assembly , phylogenetics , homology , workflow , pipeline    [ 1995/12/01 ] </S>"
  ]
}