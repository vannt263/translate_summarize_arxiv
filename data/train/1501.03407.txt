{
  "article_text": [
    "over the past two decades , multiple input multiple output ( mimo ) has evolved from a pure theory to a practical technology , and has greatly enhanced the wireless system capacity by offering many degrees of freedom ( dof ) for wireless transmissions . however , due to the so - called `` smartphone '' revolution , mobile users are demanding increasingly higher data rates for rich multimedia applications . existing and future wireless networks are facing the grand challenge of a 1000-time increase in mobile data in the near future  @xcite .",
    "there have been tremendous efforts made aiming to cater for this demand .",
    "for example , based on mimo and ofdm , lte - advanced targets at a peak rate of @xmath0 gbps , but the average rate is still less than @xmath1 mbps . in the foreseeable future , such rates can hardly be satisfactory for data - hungry wireless users .    to boost wireless capacity ,",
    "two technologies have gained most attention from both industry and academia .",
    "the first one is massive mimo ( a.k.a .",
    ", large - scale mimo , full - dimension mimo , or hyper mimo )  @xcite .",
    "the idea is to equip a base station ( bs ) with hundreds , thousands , or even tens of thousands of antennas , hereby providing an unprecedented level of dof for mobile users .",
    "the massive mimo concept has been successfully demonstrated in recent works  @xcite .",
    "the second technology is small cell .",
    "a great benefit of deploying small cells is that the distance of the user - bs link can be effectively reduced , leading to reduced transmit power , higher data rate , enhanced coverage , and better spatial reuse of spectrum .",
    "both massive mimo and small cells are recognized as key technologies of the future @xmath2 g wireless systems  @xcite .    in this paper , we consider a heterogeneous network ( hetnet ) with massive mimo and small cells , where the macrocell bs ( mbs ) is equipped with a massive mimo and the picocell bs s ( pbs ) are equipped with regular mimos . to fully harvest the benefits promised by these two technologies in an integrated hetnet system ,",
    "it is critical to investigate the user association problem , i.e. , how to assign active users to the bs s such that the system - wide capacity can be maximized and users experience can be enhanced .",
    "there are already several recent works pushing forward in this direction . in  @xcite",
    ", the authors consider the problem of user association in massive mimo systems operated in the frequency - division duplexing ( fdd ) mode .",
    "these papers are focused on a macrocell without small cells . in  @xcite ,",
    "user association in time - division duplexing ( tdd ) massive mimo system is addressed , where factional user association is allowed .",
    "bayat et al . in  @xcite model",
    "the problem of user association in a femtocell hetnet as a dynamic matching game and derive the optimal user association .",
    "however , massive mimo is not considered in the system model . in  @xcite",
    ", the authors investigate the problem of user association with conventional mimo bs s and propose a simple bias based selection criterion to approximate more complex selection rules .",
    "bj@xmath3rnson , et al . in",
    "@xcite consider the problem of improving the energy efficiency without sacrificing the quality of service ( qos ) of users in a massive mimo and small cell hetnet .",
    "motivated by these interesting works , we consider the user association problem in a tdd massive mimo hetnet in this paper , taking into consideration of the practical constraints , such as the limited load capacity at each bs , while without allowing fractional user association .",
    "the main goal is to maximize the system capacity while enhancing user experience .",
    "more specifically , this paper contains two parts : ( i ) centralized user association and ( ii ) distributed user association . for centralized user association",
    ", we investigate the problems of rate maximization , rate maximization with proportional fairness , and joint resource allocation and user association .",
    "we prove the unimodularity of our formulated problem and develop optimal user association algorithms to the problems of rate maximization and rate maximization with proportional fairness .",
    "we then propose a series of primal decomposition and dual decomposition algorithms to solve the problem of joint resource allocation and user association and prove the optimality of the proposed scheme . for distributed user association , we model the behavior and interaction between the service provider , who owns the bs s , and users as repeated games .",
    "we consider two types of operations : ( i ) the service provider sets the price and the users decide which bs to connect to , and ( ii ) the users bid for the opportunity of connection .",
    "we prove that in both cases the the proposed algorithms converge to the respective nash equilibrium ( ne ) . in the reminder of this paper",
    ", section  [ sec : sysmo ] introduces the system model and preliminaries .",
    "optimal centralized and distributed user association schemes are presented in sections  [ sec : central ] and  [ sec : dist ] , respectively .",
    "section  [ sec : sim ] presents the simulation study and section  [ sec : con ] concludes this paper . throughout this paper ,",
    "we use a boldface upper ( lower ) case symbol to denote a matrix ( vector ) , and a normal symbol to denote a scalar .",
    "@xmath4 denotes the hermitian of a matrix .",
    "the system considered in this paper includes @xmath5 users and @xmath6 bs s , including an mbs with a massive mimo and @xmath7 pbs s , each equipped with a conventional mimo .",
    "the channel model is @xmath8 , where @xmath9 is the channel of antenna @xmath10 at bs @xmath11 to user @xmath12 , @xmath13 represents the small scale fading coefficient between antenna @xmath10 of bs @xmath11 and user @xmath12 , and @xmath14 stands for the large scale fading coefficient between bs @xmath11 and user @xmath12  @xcite .",
    "concatenating all the channel coefficients from all the antennas of bs @xmath11 , we obtain the channel vector @xmath15 , as well as the channel coefficient matrix for signals transmitted from bs @xmath11 as @xmath16 $ ] .",
    "let @xmath17 denote the signals received by the users connecting to bs @xmath11 , @xmath18 the precoding matrix of bs @xmath11 , and @xmath19 the data sent from bs @xmath11 .",
    "we have @xmath20 where @xmath21 is the zero mean circulant symmetric complex gaussian noise vector .",
    "each active user has the options to connect to either the mbs or a pbs . for a user @xmath12 ,",
    "define user association index variable @xmath22 as @xmath23 let its achievable rate if connected to bs @xmath11 be @xmath24 , @xmath25 , and its actual data rate be @xmath26 .",
    "we have @xmath27    for users connecting to a massive mimo bs @xmath11 ( i.e. , the mbs ) , their achievable rate can be approximated with the following deterministic rate  @xcite .",
    "@xmath28 where @xmath29 is the number of antennas at the bs , @xmath30 is the prefixed load parameter of the bs indicating how many users it could serve , and @xmath31 is transmit power from the mbs .",
    "note that there is no small scale fading factor in  ( [ eqn : mmhn98 ] ) .",
    "this approximation has been proven to be accurate  @xcite .",
    "for a pbs with a conventional mimo , we assume that the inter - cell interference is negligible among the picocells , due to the small transmission powers and effective inter - cell interference coordination ( icic )  @xcite .",
    "the achievable rate of user @xmath12 connecting to pbs @xmath11 can be represented as follows .",
    "@xmath32 where @xmath33 is the @xmath12-th column of bs @xmath11 s precoding matrix @xmath18 .",
    "there are many precoding designs for conventional mimo bs s , such as matched filter ( mf ) precoding , zero forcing ( zf ) precoding , and regularized zero forcing ( rzf ) precoding  @xcite . without loss of generality ,",
    "we adopt mf precoding in this paper with @xmath34 , where @xmath35 is a power normalization factor .",
    "the signal received by all the users connecting to pbs @xmath11 can be rewritten as follows .",
    "@xmath36 thus , the achievable rate for user @xmath12 regarding to pbs @xmath11 can be obtained as follows .",
    "in this section , we consider the problem of centralized user association .",
    "we assume that the bs s have all the channel state information ( csi ) via uplink training .",
    "we adopt the following utility function for each user @xmath12 with achievable rate @xmath26 .",
    "@xmath38 when @xmath39 , maximizing @xmath40 yields the maximization of the sum rate ( but no fairness ) ; when @xmath41 , it leads to the maximization of the worst - case rate ( i.e , max - min fairness ) ; when @xmath42 , it yields the maximization of the geometric mean rate ( i.e. , proportional fairness ) .",
    "our goal is to maximize the system utility by configuring the user - bs association .",
    "typically , we consider the cases when @xmath39 and @xmath42 . in the case of @xmath43 , we define @xmath44 .",
    "we firstly investigate the problem of maximizing the system sum rate , i.e. , @xmath39 in  ( [ eqn : mmhn96 ] ) and @xmath45 . the problem can be formulated as follows .",
    "@xmath46    note that the second constraint requires the number of users connecting to a bs to be no more than its prefixed load , which should in turn be no more than the number of antennas it has , since theoretically bs @xmath11 can provide at most @xmath29 degrees of freedom ( dof ) . assuming the @xmath30 s are already chosen to satisfy @xmath47",
    ", we drop this constraint in the remainder of this paper .",
    "the third constraint simply claims that each user can connect to at most one bs at a time .",
    "a key observation is that  ( [ eqn : mmhn87 ] ) can be rewritten as @xmath48 thus the @xmath49 in ( [ eqn : mmhn97 ] ) can be redefined as @xmath50    in  ( [ eqn : mmhn79o ] ) , it can be seen that @xmath49 depends on other users choices @xmath51 , for all @xmath52 , as well . to make the problem tractable",
    ", we adopt the worst - case approximation by assuming the users within the coverage of bs @xmath11 ( denoted as @xmath53 ) all connect to bs @xmath11 with perfect channels .",
    "this way ,  ( [ eqn : mmhn79o ] ) can be approximated as @xmath54 where @xmath55 for a set stands for the cardinality of the set .",
    "define auxiliary variables @xmath56 as follows .",
    "@xmath57 the sum rate maximization problem can be reformulated as @xmath58    since the variables @xmath22 s are binary , problem * p1 - 2 * falls into the category of _ multiple knapsack problems _ , which is one of karp s @xmath59 np - complete problems  @xcite .",
    "although a greedy algorithm could be developed to compute sub - optimal solutions , we show that problem * p1 - 2 * can actually be optimally solved by taking advantage of its special structure .",
    "let @xmath60 be a matrix with entries @xmath22 , @xmath61 , @xmath62 .",
    "we could convert @xmath60 to a vector @xmath63 by concatenating the rows of @xmath60 and taking a transpose as @xmath64^t$ ] , and simplify the notation as @xmath65^t$ ] .",
    "we then apply the same conversion to the matrix comprising @xmath56 and obtain vector @xmath66 .",
    "problem * p1 - 2 * can be rewritten as @xmath67    ignoring constraints  ( [ eqn : mmhn95 ] ) and  ( [ eqn : mmhn80 ] ) , define @xmath68 as the constraint matrix of problem * p1 - 3 * , with entries being the coefficients of the first and second constraints .",
    "we next introduce an important definition and derive a key lemma .",
    "a matrix @xmath68 is called totally unimodular if the determinant of every square submatrix of @xmath68 is either @xmath69 , @xmath70 or @xmath71  @xcite .    the constraint matrix @xmath68 of problem * p1 - 3 * is totally unimodular .",
    "[ lem1 ]    inspecting the constraints in problem * p1 - 3 * , we find that @xmath68 is of the following form .",
    "@xmath72 we can divide @xmath68 into blocks as follows .",
    "@xmath73 where each @xmath74 $ ] , is a submatrix of @xmath68 of size @xmath75 ; and each @xmath76 $ ] , is an identity matrix of size @xmath77 .",
    "let @xmath78 denote an arbitrary square submatrix of matrix @xmath68 of size @xmath10 .",
    "for any submatrix of @xmath68 of size @xmath79 , it is trivial to see that the determinant of this submatrix is either @xmath69 or @xmath70 .",
    "so we only need to consider the case where the size of the square submatrix is greater than or equal to @xmath80 .",
    "case 1 : @xmath78 is taken entirely from one of the submatrices @xmath81 or @xmath82 , @xmath83",
    "we can see from the structure that at least one row of @xmath81 is all zero .",
    "so if the square submatrix is entirely taken from @xmath81 , the determinant of the submatrix is zero .",
    "since matrix @xmath82 , for all @xmath11 , is simply an identity matrix , it is straightforward that the determinant of any square submatrix of @xmath82 is either @xmath69 or @xmath70 .",
    "case 2 : @xmath78 is not entirely taken from any one of the submatrices @xmath81 or @xmath82 , @xmath84 $ ] . in this case , the square submatrix must be taken from @xmath85 ( @xmath86 ) submatrices of the submatrix set @xmath87 , @xmath88 .",
    "we next proceed with our proof by applying induction method .    for the base case @xmath79 ,",
    "the square submatrix to be examined is of size @xmath80 .",
    "since the entries can only be @xmath69 or @xmath70 , the determinant can only be @xmath69 , @xmath70 or @xmath71 .    now assuming that any square submatrix of size @xmath89 has determinant @xmath69 , @xmath70 or @xmath71 , we need to check if the same conclusion holds for any square submatrix of size @xmath10 .",
    "we first notice that each column of @xmath68 has exactly two @xmath70s . moreover , exactly one of them is in @xmath81 , and the other in @xmath82 .",
    "let @xmath90 , where @xmath91 is the @xmath92-th entry of @xmath78 .",
    "that is , column @xmath93 has the minimum number of @xmath0s among all the columns of @xmath94 .",
    "let @xmath95 .",
    "@xmath96 can only be @xmath69 , @xmath0 , or @xmath80 .",
    "if @xmath97 , then all the entries of the @xmath93-th column of @xmath94 are @xmath69 , which results in @xmath98 , where @xmath99 is short for determinant .",
    "if @xmath100 , then we could calculate @xmath101 by expanding the @xmath93-th column and obtain @xmath102 .",
    "since @xmath103 is @xmath69 , @xmath0 or @xmath71 by our induction hypothesis , we conclude @xmath101 is @xmath69 , @xmath0 or @xmath71 .",
    "if @xmath104 , we could firstly negate all the entries taken from @xmath82 , and then add all the rows in @xmath82 to any non - zero row in @xmath81 .",
    "after this procedure , if that non - zero row in @xmath81 is still non - zero , add that row to any other non - zero row in @xmath81 . repeat this process until we get a zero row in @xmath81 .",
    "the reason why this process always give us a all - zero row is that we have equal number of @xmath70s in @xmath81 and @xmath82 .",
    "since any basic row operation does not change the determinant and we finally get a all - zero row , we have @xmath105 .",
    "that completes our induction .    for a linear programming problem ,",
    "if its constraint matrix satisfies totally unimodularity , then its has all integral vertex solutions  @xcite .",
    "[ lem2 ]    for a linear programming problem , if it has feasible optimal solutions , then at least one of them occurs at a vertex of the polyhedron define by its constraints  @xcite .",
    "[ lem3 ]    given the facts and lemma  [ lem1 ] , we have the following theorem .",
    "the proof is straightforward and omitted .",
    "the optimal solution of problem  * p1 * can be obtained by solving a relaxed problem where the variables @xmath22 are allowed to take real values between @xmath106 $ ] .",
    "given the above theorem , we could obtain the optimal solution of * p1 * by solving the relaxed problem , termed * np1 * , using common lp solvers  @xcite .      in this section , we take proportional fairness among user achievable rates into consideration .",
    "the problem can be formulated as follows .",
    "@xmath107    problem  * p2 - 1 * is a nonlinear integer programming problem , which is generally np - hard . to get a better understanding of the problem ,",
    "we examine its equivalent problem as follows .",
    "@xmath108    problem * p2 - 2 * is a geometric programming problem , with binary variables .",
    "the objective function is a posynomial function with @xmath109 terms .",
    "conventionally , to solve geometric programming problems we need to introduce new variables such as @xmath110 so that geometric programming can be solved via convex programming .",
    "however , here @xmath22 s are binary .",
    "since @xmath111 , we could not apply these techniques .",
    "another heuristic scheme is to firstly sort these @xmath109 coefficients , and then find @xmath30 maximal coefficients for each bs .",
    "however , even sorting these @xmath109 coefficients could be computationally prohibitive even for a small system , which requires @xmath112 operations .",
    "a key observation about the logarithm function is that @xmath113 , for all @xmath114 . therefore , in practice , is the achievable rate of user @xmath12 connecting to bs @xmath11 .",
    "@xmath115 is generally satisfied in current wireless systems with a sufficiently large bandwidth and high transmission power . ]",
    "the optimal value of problem * p2 - 1 * is upper bounded by that of the following problem .",
    "we have the following results for the transformed problems .    problems  * p2 - 1 * and  * np2 * are equivalent .",
    "[ prop222 ]    recall that if @xmath117 , we define @xmath118 .",
    "the second constraint @xmath119 imposes that each user could only connect to one bs .",
    "consequently , @xmath120 .",
    "furthermore , we have @xmath121 .    comparing problems * np2 * to * p1 - 2 * , we find they are actually equivalent .",
    "thus we can obtain the optimal value of * p2 - 1 * by applying the same technique used to solve problem * p1 - 2*. we then have the following lemma .",
    "sum rate maximization in section [ subsec : cms ] also achieves proportional fairness .",
    "[ coro1 ]    the optimal value of problem * p2 - 1 * is upper bounded by @xmath122 .",
    "[ prop1 ]    denote @xmath123 , we have @xmath124 the first inequality is because @xmath125 .",
    "the second inequality is due to the fact that @xmath126 is the largest one among all the @xmath127 and @xmath128 .    on the other hand",
    ", it follows the constraint @xmath119 that @xmath129 , which is a better bound than ( [ eqn : mmhn73 ] ) .",
    "we thus have @xmath122 .    for comparison purpose ,",
    "we propose two sub - optimal greedy algorithms , i.e. , algorithms  [ alg : gafmm1 ] and  [ alg : gafmm2 ] , as benchmarks .",
    "they can be directly used for comparison with problem * p1 - 1*. to compare with problem * p2 - 1 * , in algorithm  [ alg : gafmm1 ] , we need to change steps @xmath130 and @xmath131 as `` * * while * * @xmath132 @xmath133 * do * '' and `` find @xmath134 , '' respectively . in algorithm [ alg : gafmm2 ] , we need to change step @xmath131 and @xmath135 as `` * * while * * @xmath136 @xmath137 '' and `` find @xmath138 , '' respectively .    [ !",
    "t ] initialize @xmath139 , @xmath140 and @xmath22 to be an all - zero matrix    [ !",
    "t ] initialize @xmath139 , @xmath140 and @xmath22 to be an all - zero matrix      in this section , we take resource allocation into account . consider a massive mimo ofdma hetnet . in ofdma systems , such as lte , the time - frequency resource is divided into resource blocks ( rb ) .",
    "a typical rb consists of @xmath141 subcarriers ( @xmath142khz ) in the frequency domain and @xmath130 ofdma symbols in the time domain ( @xmath143 ms ) .",
    "so the system may have up to several hundreds of rbs .",
    "we normalize it to be a unit number .",
    "a user @xmath12 connecting to a bs @xmath11 gets a portion @xmath144 of the overall resource .",
    "the goal is to maximize the system utility considering both resource allocation and user association .",
    "considering the logarithm rate utility and defining @xmath145 , the problem is formulated as follows .",
    "@xmath146 to solve problem * p3 - 1 * , we need to : ( i ) select users for each bs to serve and ( ii ) allocate resources to the associated users at each bs .",
    "we next propose a series of primal decomposition and dual decomposition to solve the problem optimally .",
    "it is worth noting that the problem can also be formulated in a different way , by substituting constraint @xmath147 with a new constraint @xmath148 .",
    "we call this problem * p3 - 2*. comparing these two formulations , we have the following observations .    1 .",
    "problem * p3 - 1 * does not require that every user must be connected , while problem * p3 - 2 * requires each user be connected , even under unfavorable conditions .",
    "problem * p3 - 2 * has a more stringent requirement than problem * p3 - 1*. therefore the optimal value of problem * p3 - 2 * is upper bounded by that of problem * p3 - 1*. 3 .   since problem",
    "* p3 - 1 * offers more choices of user association , problem * p3 - 1 * is slower in convergence than problem * p3 - 2*.    we focus on the harder problem * p3 - 1*. given the algorithm to solve problem * p3 - 1 * , problem * p3 - 2 * can be readily solved . due to integer variables @xmath22 and real variables @xmath144 , problem * p3 - 1 * is a mixed integer nonlinear programming problem ( minlp ) , which is generally np - hard .",
    "however , next we propose an algorithm to obtain its optimal solution .",
    "since @xmath22 s take binary values and @xmath119 , we have @xmath149 @xmath150 @xmath151@xmath152 . recall that if @xmath153 , the logarithmic utility is @xmath69 .",
    "thus problem * p3 - 1 * can be reformulated as @xmath154    the choices of @xmath144 rely on the values of @xmath22 .",
    "given these coupled variables , we first apply the primal decomposition method  @xcite to decompose problem * p3 - 3 * to the following two levels of problems . fixing variables @xmath22 s",
    ", we have the _ lower level problem _ as @xmath155 when the @xmath144 s are fixed , the _ higher level problem _ ( or , the _ master problem _ ) is given by @xmath156 since there are no couplings among the subproblems , the lower level problem  ( [ eqn : mmhn60 ] ) can be further decomposed into @xmath157 subproblems as follows . @xmath158    defining lagrange multiplier @xmath159 ,",
    "the lagrangian of problem  ( [ eqn : mmhn58 ] ) is defined as @xmath160 applying kkt conditions @xcite , the optimal solution can be obtained as follows . @xmath161    substituting  ( [ eqn : mmhn56 ] ) into the master problem , the objective function becomes @xmath162 note that we have dropped one @xmath22 term in  ( [ eqn : mmhn55 ] ) , since due to the definition  ( [ eqn : mmhn95 ] ) , we have @xmath163 .",
    "since @xmath164 is in the denominator , problem  ( [ eqn : mmhn55 ] ) has coupled objectives .",
    "the main idea of addressing the coupled objective is to introduce auxiliary variables and additional equality constraints so that the coupling in the objective function is transferred to coupling in the constraint  @xcite .",
    "we thus introduce a new variable , which is defined as : @xmath165    to solve the above problem , we relax @xmath22 to a real number in @xmath166 $ ] .",
    "however , we will show later that even if we have relaxed the variables , we could still find the optimal solution to the original problem .",
    "the relaxed problem to be solved is @xmath167    problem  ( [ eqn : mmhn53 ] ) is a convex optimization problem . defining lagrange multipliers for the equality constraints  ( [ eqn : mmhn54 ] ) , problem  ( [ eqn : mmhn53 ] )",
    "can be solved with the dual decomposition method .",
    "alternatively , we propose algorithm  [ alg : tldda ] to obtain the optimal solution of problem ( [ eqn : mmhn53 ] )  @xcite . in algorithm",
    "[ alg : tldda ] , @xmath168 is the step size at the @xmath169-th iteration given by @xmath170 where @xmath171 and @xmath172 are positive numbers .",
    "algorithm [ alg : tldda ] optimally solves problem  ( [ eqn : mmhn53 ] ) .",
    "let @xmath173 denote the solution produced by algorithm  [ alg : tldda ] at step @xmath169 .",
    "let @xmath174 be the subgradient of the objective function in problem  ( [ eqn : mmhn53 ] ) at step @xmath169 .",
    "it can be easily verified that the updated direction in step  [ stepgd ] of algorithm  [ alg : tldda ] is the subgradient direction . since @xmath175 is upper bounded by @xmath30 and @xmath5 , and @xmath164 is upper bounded by @xmath5 , @xmath174 is also bounded .",
    "denote @xmath176 as the final result produced by algorithm [ alg : tldda ] and @xmath177 as the optimal solution of problem ( [ eqn : mmhn53 ] ) .",
    "we prove the theorem by contradiction .",
    "assume that @xmath176 is not optimal .",
    "then there must exist an @xmath178 such that @xmath179 .",
    "then there must be a solution @xmath180 so that @xmath181 let @xmath182 be sufficiently large so that for any @xmath183 we have @xmath184 combining  ( [ eqn : mmhn48 ] ) and  ( [ eqn : mmhn47 ] ) , we have @xmath185 . let @xmath186 be a positive number that satisfies @xmath187 , for all @xmath169 .",
    "it follows that @xmath188 note that the first inequality is due to the property of subgradient .",
    "so we finally have @xmath189 , which can not hold for sufficiently large @xmath169 .",
    "thus algorithm [ alg : tldda ] optimally solves problem ( [ eqn : mmhn53 ] ) .    [ !",
    "t ] @xmath190 , @xmath191    the optimal solution to problem  ( [ eqn : mmhn53 ] ) is also feasible and optimal to problem ( [ eqn : mmhn55 ] ) .",
    "[ themo ]    from problem  ( [ eqn : mmhn53 ] ) to  ( [ eqn : mmhn55 ] ) , we relax the variables from binary to real and introduce an equality constraint .",
    "the equality constraint does not change the problem .",
    "so the optimal value to problem  ( [ eqn : mmhn55 ] ) provides an upper bound to that of problem  ( [ eqn : mmhn53 ] ) .",
    "however , it can be observed from algorithm  [ alg : tldda ] that the solutions to problem  ( [ eqn : mmhn55 ] ) are integers rather than fractions .",
    "so the solutions are also feasible to problem  ( [ eqn : mmhn53 ] ) .",
    "since the solutions to problem  ( [ eqn : mmhn53 ] ) can not result in a higher optimal value than the solutions to problem  ( [ eqn : mmhn55 ] ) , the solutions to problem  ( [ eqn : mmhn55 ] ) are exactly the solutions to problem  ( [ eqn : mmhn53 ] ) as well . henceforth , even though we transform problem  ( [ eqn : mmhn53 ] ) to problem  ( [ eqn : mmhn55 ] ) , the optimal solution is not affected by the transformation .    to sum up , the optimal solution to problem  ( [ eqn : mmhn55 ] )",
    "can be solved with algorithm  [ alg : tldda ] . for comparison purpose",
    ", we also propose two greedy algorithms as benchmarks , which are presented in algorithms  [ alg : gafmm3 ] and  [ alg : gafmm4 ] .",
    "the main idea of the greedy algorithms is to first identify the most desirable user - bs pair , and then to allocate all the resource to that user .",
    "this is repeated until convergence is reached .",
    "t ] initialize @xmath139 and @xmath192 @xmath22 to be an all - zero matrix    [ !",
    "t ] initialize @xmath139 , @xmath192 and @xmath22 to be an all - zero matrix",
    "in the previous section , we assume a central controller that has global information and assigns users to the bs s . in this section , we consider distributed user association .",
    "we still assume that the bs s have all the csi via uplink training .",
    "we further assume that all the bs s , including the massive mimo microcell bs and the small cell bs s , belong to the same service provider .",
    "each user makes its own decision based on the broadcast and local information . throughout this section",
    ", we do not allow fractional connection .",
    "we omit constraint  ( [ eqn : mmhn95 ] ) in the problem formulation , which is , however , enforced when solving the problem .",
    "we model the behavior and interactions among the service provider and users using repeated game theory .",
    "the first key problem is to determine whether the game will converge .",
    "the second key problem is to analyze whether both sides are satisfactory about the outcome of the game , i.e. , existence of the nash equilibrium .",
    "the players of the repeated game include the service provider and the users . during each round of the game",
    ", the service provider determines the price of the connection service .",
    "the users decide whether or not to connect , and if to connect , to which bs .",
    "the strategy of the service provide is to set the price @xmath193 of each bs @xmath11 for each user @xmath12 , while the strategy of each user @xmath12 is to set @xmath22 to either @xmath69 or @xmath0 for @xmath194 .",
    "the utility of the service provider is defined as @xmath195 . since each bs",
    "is constrained by its maximum load capacity @xmath30 , the service provider aims to solve the following problem . @xmath196",
    "the utility of each user is the data rate achieved minus its payment .",
    "so each user aims to solve the following problem . @xmath197 where the logarithmic function represents the satisfaction level of a user @xmath12 towards its achievable rate , and @xmath198 is a weight used to tradeoff rate satisfaction and monetary payment .",
    "we assume that the weight @xmath198 of each user is drawn from a finite set @xmath199 with @xmath200 elements .",
    "this assumption is true in real - world practice .",
    "for instance , @xmath201 for a wireless service with @xmath202 mbps data rate is considered to be cheap ; @xmath203 is considered to be reasonable ; @xmath204 would be acceptable ; @xmath205 would be expensive for most people ; @xmath206 would be too expensive ; and @xmath207 or above would not be an option for most people .",
    "so the weight of the users has generally finite choices of values based on common sense , and is typically in a range @xmath208 , where @xmath209 is the maximum possible value for @xmath198 .",
    "the repeated game is played as follows .",
    "initially , the service provider sets a price for each bs for each user and broadcasts the prices to the users .",
    "knowing the prices , the users will feedback the service provider of their choices based on their own calculations",
    ". then the service provider updates the prices and broadcasts them to the users .",
    "users again inform the service provider of their choices , and so forth .",
    "the process is repeated until both the service provider and users are all satisfied with the price .",
    "given the players , their strategies and utilities , we have the following definition for the ne of the user association game .",
    "a strategy set @xmath210 , for all @xmath12 , @xmath11 , is an ne of the repeated game if @xmath211 , for all @xmath193 and @xmath212 , for all @xmath12 , @xmath22 .    due to the constraint that each user can only connect to one bs , @xmath213 .",
    "therefore the objective function of problem  ( [ eqn : mmhn83 ] ) becomes @xmath214 for the reformulated problem  ( [ eqn : mmhn83n ] ) , the constraint @xmath215 indicates that a user may choose not to connect to any of the bs s . on the other hand ,",
    "if we restrict @xmath216 , then even if the service provider sets the prices to infinity , each user will still connect to a bs , which is clearly unreasonable .",
    "given the utility function  ( [ eqn : mmhn83n ] ) and the constraint in  ( [ eqn : mmhn83 ] ) , the optimal solution for each user can be derived as @xmath217 \\\\      & x_{k_j } = \\begin{cases }              1 , & \\text{if $ j = j^*$ and } \\omega_k \\log ( c_{k_j^ * } ) \\geq p_{j^*_k } \\\\              0 , & \\text{otherwise}.                  \\end{cases } \\label{eqn : mmhn70}\\end{aligned}\\ ] ]    such users decision can be interpreted this way .",
    "a user will choose the best connection based on its own evaluation .",
    "if its evaluation of the connection is greater than or equal to the price , it will connect to this bs .",
    "otherwise , the user will not connect to the bs .",
    "so we readily have the following result .",
    "[ lm : lm5 ] the highest profit the service provider can obtain from a user @xmath12 towards bs @xmath11 , is the user s evaluation .    the service provider aims to solve problem  ( [ eqn : mmhn84 ] ) by tuning variables @xmath193 , @xmath218 , @xmath219 .",
    "however , the constraint @xmath220 is implicitly coupled with all the @xmath193 s , since according to the user s choice , @xmath221 $ ] .",
    "the service provider problem is actually with the following form .",
    "@xmath222    since problem  ( [ eqn : mmhn66 ] ) has coupling constraints , one may try to introduce lagrange multipliers to the constraint and solve the resulting problem using dual decomposition .",
    "however , since @xmath193 is implicitly contained in the constraint , the gradient and subgradient are difficult to find .",
    "next , we propose algorithm  [ alg : disafsp1 ] for the service provider , and then prove that the algorithm achieves optimal utility for the service provider and the users .",
    "[ prop10 ] if the service provider adopts algorithm [ alg : disafsp1 ] , the game converges and the ne can be achieved .",
    "we first notice that the service provider has priority over the users .",
    "the users always make decisions based upon the service provider s price setting .",
    "basically , the service provider controls when the repeated game terminates .    in algorithm",
    "[ alg : disafsp1 ] , the service provider tests out the weight of each user using binary search with @xmath223 steps .",
    "once the service provider obtains @xmath198 , @xmath218 , it then estimates the users price evaluation matrix @xmath224 as follows .",
    "@xmath225 where @xmath226 is the entry of matrix @xmath224 at row @xmath11 and column @xmath12 .",
    "following lemma  [ lm : lm5 ] , the service provider can obtain its optimal price strategy by first selecting users for each bs and solving the following problem .",
    "@xmath227    the optimal solution @xmath228 to the above problem can be solved in a similar way as solving problem  * p1 - 2*. then the optimal prices for the service provider can be obtained as follows .",
    "@xmath229 where @xmath230 is an arbitrary positive number .",
    "therefore , by adopting algorithm [ alg : disafsp1 ] , the optimal utility ( highest ) can be reached for the service provider .",
    "meanwhile , we could see that all the users utility must be @xmath69 due to the optimal price setting ( i.e. , each user s rate satisfaction matches its monetary payment ) .",
    "that means , all the users achieve the optimal utility given the price setting as well .",
    "therefore , the game converges to the ne .    [ !",
    "t ] initialize @xmath231 , @xmath232 , @xmath190    solve ( [ eqn : mmhn68 ] ) and find optimal price as in ( [ eqn : mmhn67 ] )    note that it is possible that the optimal utility of the service provider will be lower than the maximum utility during the game , because the load capacity constraint may be violated due to the distributed operation .",
    "we next consider a bidding approach to the problem . before service starts , users bid to the service provider according to their predicted satisfaction towards each bs .",
    "and service provider determines whether or not to accept a user s bid and feedback the decisions to users .",
    "then the users make another round of bids according to its predicted satisfaction and the service provider s decision history .",
    "the service provider again decides whether or not to accept a user s bid and feedback the decision , and so forth .",
    "assume date - intensive users that strive for as high data rate as possible .",
    "each user solves the following problem . @xmath233 on the other hand , the service provide aims to maximize its utility , i.e. , the total payment made by all the users .",
    "@xmath234 note that the decision variables in these two problems are different from those in problems  ( [ eqn : mmhn84 ] ) and  ( [ eqn : mmhn83 ] ) , respectively .",
    "we assume the general case that @xmath235 ( i.e. , not all the users can be served ) . in order to achieve the greatest level of satisfaction",
    ", each user makes the highest possible payment .",
    "so the optimal solution for each user is @xmath236 the optimal strategy for the service provider is summarized in algorithm  [ alg : distub ] .    [ !",
    "t ]    during the first stage of the game , each user offers a price to its most desirable bs .",
    "algorithm  [ alg : distub ] is used to check if each bs @xmath11 receives more than @xmath30 bids .",
    "the service provider only puts @xmath30 top users on bs @xmath11 s waiting list based on the offered prices ; and rejects all other users .",
    "if bs @xmath11 receives no more than @xmath30 bids , all these users will be put on bs @xmath11 s waiting list .    at the second stage , if a user is in a bs s waiting list , it will keep on bidding the same bs with the same price to guarantee the highest utility .",
    "however , if a user gets rejected in the previous round , as being selfish , it will exclude the bs s that have rejected it and offers a price to its most desirable bs among the remaining ones .",
    "for the service provider , it adopts the same strategy .",
    "if the number of bids received for a bs outnumbers the load capacity of that bs , the service provider only keeps the @xmath30 most desirable users on the waiting list and rejects the others .",
    "it keeps all users on the waiting list if the number of offers received is less than a bs s load capacity .",
    "this two stages repeat until convergence is achieved .",
    "[ lem10 ] the sequence of bids made by a user is non - increasing in the user s preference list .",
    "before a user makes an offer , it computes the satisfaction of all the bs s to obtain a preference list .",
    "since a user aims to maximize its utility , it first proposes to the bs with the highest satisfaction .",
    "if it is rejected by the bs , it will propose to the bs with the second highest satisfaction , and so forth .",
    "note that even if a user may be on the waiting list of a bs , it may be removed from that waiting list at a later stage .",
    "if that happens , this user will start bidding to other bs .",
    "a user will repeat this procedure until it is finally in a bs s serving list or rejected by all bs s .",
    "this concludes the proof .",
    "[ lem9 ] the sequence of bids a bs put on the waiting list is non - decreasing in its preference list .",
    "given the fact any bs has a finite load capacity and @xmath235 , all the base station will have at least one user bidding to it at some stage of the game .",
    "since a bs aims to maximize its utility , it puts all the users who make an offer on the waiting list . on the condition that there are too many users , it will reject the users who it will never served . in the next round of game , the bs will often have more or at least the same amount of bids compared to its current waiting list .",
    "this means that the bs has more choices .",
    "the bs again only keeps the most profitable ones and reject or remove the others from the waiting list .",
    "so the sequence of bids a base station put on the list is non - decreasing in its preference list .",
    "[ thm4 ] the repeated bidding game converges .",
    "based on  lemmas  [ lem10 ] and  [ lem9 ] , we prove this theorem by contradiction .",
    "suppose that this repeated game does converge .",
    "then there must be a stage of the game that ( i ) there is a user @xmath12 and bs @xmath11 pair so that user @xmath12 is connected to another bs @xmath237 or is not connected to any bs ; ( ii ) user @xmath12 prefers bs @xmath11 to bs @xmath237 or prefers to be not connected ; and ( iii ) bs @xmath11 prefers user @xmath12 to a user @xmath238 who is on its serving list .",
    "consider the case where user @xmath12 is served by bs @xmath237 .",
    "since the sequence of bids made by a bs is non - decreasing , it must be the case that user @xmath12 has never bidden to bs @xmath11 during the game .",
    "otherwise , if user @xmath12 has bidden to bs @xmath11 , bs @xmath11 would not have ended up with choosing @xmath238 over @xmath12 . in this case",
    ", user @xmath12 would never have bidden to bs @xmath237 either , since user @xmath12 prefers @xmath11 to @xmath237 and the bids ( see lemma  [ lem10 ] ) .",
    "however , user @xmath12 is now served by bs @xmath237 , user @xmath12 must have bidden to bs @xmath237 , which contradicts that user @xmath12 would never have bidden to bs @xmath237 .",
    "the same reasoning holds for the case when user @xmath12 is not connected to any bs .",
    "if bs @xmath11 prefers @xmath12 to @xmath238 on the serving list , bs @xmath11 would never reject user @xmath12 while keeping user @xmath238 .",
    "therefore , the game converges when every user is either on a waiting list or has been rejected by every bs , and the game will converge .    from the proof",
    ", we can actually see that the game terminates when the least popular bs becomes fully loaded .",
    "[ thm3 ] the outcome of the repeated bidding game is optimal for both the users and service provider .",
    "suppose that the outcome of the game is not optimal for a user @xmath12 , who is connected to bs @xmath11",
    ". then there must be another bs @xmath237 , which has higher ranking than bs @xmath11 in the preference list of user @xmath12 and has a serving list of users @xmath239 .",
    "since bs @xmath237 serves these users , it means that bs @xmath237 prefers them to user @xmath12 and bs @xmath237 is at the top of the preference lists of these users .",
    "if at some stage , user @xmath12 is in the waiting list of bs @xmath11 ( or it is inserted by force ) , the game must have not terminated .",
    "since user @xmath12 is in the waiting list , then one of the final users @xmath240 must be currently off the list , say user @xmath241 . then user @xmath241 will immediately bid for bs @xmath237 , since bs @xmath237 is at the top of its preference list among all the remaining bs s . and bs @xmath237 will remove user @xmath12 from its waiting list , since user @xmath12 has a lowest ranking in the preference list of bs @xmath237 .",
    "thus when the repeated game terminates , the outcomes are optimal for each user .",
    "it is obvious that the outcome is also optimal for the service provider as well .    from theorems  [ thm4 ] and  [ thm3 ]",
    ", we conclude that the game converges to the ne when the game terminates .",
    "we validate the proposed user association schemes with simulations . throughout the simulations , we assume @xmath242 for the path loss between a user and the massive mimo bs , and @xmath243 for the path loss between a user and a small cell bs  @xcite .",
    "we assume that the power of small scale fading follows a uniform distribution from @xmath244 $ ] .",
    "we fix the location of the massive mimo bs at the center of the cell .",
    "the other bs s are randomly placed across in the cell .",
    "users are randomly placed in the area .",
    "the other parameter settings are listed in table  [ tab : sc ] .",
    "the error bars in the plots are 95% confidence intervals .    [ ! t",
    "]    .system configuration [ cols=\"<,<,<,<\",options=\"header \" , ]     table  [ tab : jraua ] presents a comparison of the optimal joint resource allocation and user association algorithm and the two proposed greedy algorithms .",
    "we find that the optimal scheme achieves the highest utility .",
    "moreover , the gap between the optimal scheme and the greedy schemes is quite large .",
    "we also consider the equality constraint problem as a benchmark for the comparison . for a fair comparison",
    ", we set the sum capacity of this system equal to the number of users .",
    "so there are totally @xmath245 active users in the system .",
    "the optimal solution of problem  * p3 - 2 * achieves a network utility of @xmath246 , while the optimal solution of problem  ( [ eqn : mmhn63 ] ) has a network utility of @xmath247 .",
    "we also found that if we connect every user , some edge users will be harmful for the network utility .",
    "[ fig : dist_bsp ] shows the utility of the service provider and all users when the service provider sets the price ( as in section  [ subsec : spdtp ] ) .",
    "it can be seen that the repeated game converges after @xmath131 rounds .",
    "furthermore , the utility of all users is monotonically decreasing .",
    "that is because once a user s evaluation is known to the service provider , the service provider will set prices for the highest profit , which results in @xmath69 utility for that user . as discussed , the utility for the service provider is not monotonically increasing , since during the game , the load capacity constraint may be violated .",
    "[ fig : dist_bsp_comp ] plots the utilities of the service provider and users versus the number of users .",
    "we can see that as the number of user increases , utility of the service provider also increases .",
    "this is mainly due to the effect of multi - user diversity .",
    "we can also observe that the game terminates after about @xmath131 rounds no matter how many users are active .    [ !",
    "t ]    fig .",
    "[ fig : conv ] depicts the process of the game when users bid for bs s ( as in section  [ subsec : ub ] ) .",
    "here we deploy @xmath248 bs s .",
    "the massive mimo bs has @xmath249 antennas .",
    "there are @xmath250 users .",
    "the left - hand - side @xmath251-axis represents the load of the @xmath252 bs s .",
    "the right - hand - side @xmath251-axis represents the utility of the service provider .",
    "we find the game converges in about @xmath253 rounds , and the utility of the service provider is monotonically increasing as the game continues .    [ !",
    "t ]    to encourage offloading from the macro bs , we consider rate bias for the bs s in this experiment .",
    "specifically , we multiple the rate of the massive mimo bs with a factor of @xmath143 to encourage connection to the pbs s .",
    "[ fig : bsut ] shows the result when configuration shown in table  [ tab : sc ] .",
    "it can be observed that the utility with rate bias is higher than the utility without considering rate bias .",
    "this result demonstrates the efficacy of rate bias and offloading .",
    "it can be seen that both games terminate in less than @xmath131 rounds .    [ ! t ]",
    "in this paper , we investigated the user association problem in a massive mimo hetnet from the centralized and distributed perspectives .",
    "particularly , by leveraging totally unimodularity we developed optimal algorithms for rate maximization and rate maximization with proportional fairness problems .",
    "we also developed optimal algorithms to the joint resource allocation and user association problem with primal decomposition and dual decomposition .",
    "modeling the behavior and interaction of the service provider and users with repeated games , we developed effective distributed algorithms with proven convergence to the ne .",
    "simulation results verify the efficacy of the proposed schemes .",
    "this work is supported in part by the us national science foundation ( nsf ) under grants cns-1247955 and cns-1320664 .",
    "any opinions , findings , and conclusions or recommendations expressed in this material are those of the author(s ) and do not necessarily reflect the views of the nsf .",
    "f. rusek , d. persson , b. k. lau , e. g. larsson , t. l. marzetta , o. edfors , and f. tufvesson , `` scaling up mimo opportunities and challenges with very large arrays , '' _ ieee signal process . mag .",
    "_ , vol . 30 , no",
    ". 1 , pp . 4060 , jan .",
    "2013 .",
    "y. xu , g. yue , n. prasad , s. rangarajan , and s. mao , `` user grouping and scheduling for large scale mimo systems with two - stage precoding , '' in _ proc .",
    "ieee icc14 _ ,",
    "sydney , australia , june 2014 , pp .",
    "52085213 .",
    "d. bethanabhotla , o. y. bursalioglu , h. c. papadopoulos , and g. caire , `` user association and load balancing for cellular massive mimo , '' in _ proc .",
    "ieee information theory and applications workshop 2014 _ , san diego , ca , feb .",
    "2014 , pp . 110 .",
    "s. bayat , r.h.y .",
    "louie , z. han , b. vucetic , and y. li , `` distributed user association and femtocell allocation in heterogeneous wireless networks , '' _ ieee trans .",
    "62 , no . 8 , pp . 30273043 , aug .",
    "a. gupta , h. dhillon , s. vishwanath , and j. andrews , `` downlink multi - antenna heterogeneous cellular network with load balancing , '' _ arxiv:1310.6795v2 _ , [ online ] available : http://arxiv.org/abs/1310.6795 .",
    "e. bj@xmath3rnson , m. kountouris , and m. debbah , `` massive mimo and small cells : improving energy efficiency by optimal soft - cell coordination , '' _ arxiv:1304.0553v3 _ ,",
    "[ online ] available : http://arxiv.org/abs/1304.0553 .",
    "q. ye , b. rong , y. chen , m. a .- shalash , c. caramanis , and j. g. andrews , `` user association for load balancing in heterogeneous cellular networks , '' _ ieee trans .",
    "wireless commun .",
    "12 , no . 6 , pp .",
    "27062716 , june 2013 ."
  ],
  "abstract_text": [
    "<S> massive mimo and small cell are both recognized as the key technologies for the future 5 g wireless systems . in this paper , we investigate the problem of user association in a heterogeneous network ( hetnet ) with massive mimo and small cells , where the macro base station ( bs ) is equipped with a massive mimo and the picocell bs s are equipped with regular mimos . </S>",
    "<S> we first develop centralized user association algorithms with proven optimality , considering various objectives such as rate maximization , proportional fairness , and joint user association and resource allocation . </S>",
    "<S> we then model the massive mimo hetnet as a repeated game , which leads to distributed user association algorithms with proven convergence to the nash equilibrium ( ne ) . </S>",
    "<S> we demonstrate the efficacy of these optimal schemes by comparison with several greedy algorithms through simulations .    </S>",
    "<S> [ theorem ]    0=6 = 0.880 .55 -0 = .9 = 0    massive mimo ; small cells ; heterogeneous networks ( hetnet ) ; user association ; unimodularity ; game theory . </S>"
  ]
}