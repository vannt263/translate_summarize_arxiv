{
  "article_text": [
    "since essentially all observed galactic star formation occurs within dense , self - gravitating molecular clouds , developing an understanding of the origin of these clouds is an important goal of research into star formation .",
    "research in this area has typically focused on trying to answer a few basic questions :    1 .   how does the molecular gas form ?",
    "in other words , what are the chemical processes involved ? 2 .   where does the molecular gas form ? does it form before or after the assembly of the gas into dense clouds ?",
    "3 .   how quickly does the molecular gas form ?    by far",
    "the largest constituent of the molecular gas is molecular hydrogen , @xmath0 , with other molecules such as @xmath3 being present only in small amounts , and so in practice the study of the formation of molecular gas is usually simply the study of the formation of @xmath0 .",
    "although the chemistry of @xmath0 formation in space remains an active field of study , the basic principles have been understood for some time .",
    "gas - phase formation of @xmath0 by direct radiative association is highly forbidden and proceeds at a negligible rate , while gas - phase formation via intermediate molecular ions such as @xmath4 or @xmath5 is strongly suppressed by the interstellar radiation field @xcite and in any case can not produce molecular fractions much higher than @xmath6 .",
    "consequently , most galactic @xmath0 can not have formed in the gas phase , leaving grain - surface reactions as the only viable option .",
    "the pioneering work of @xcite and @xcite showed that @xmath0 molecules could form on the surface of idealized dust grains with an effective rate coefficient compatible with that inferred from uv observations of @xmath0 in the local interstellar medium , @xmath7 @xcite .",
    "this remains widely accepted , at least for cold dust , although there is ongoing debate about the efficacy of @xmath0 formation on warm dust ( see e.g. * ? ? ?",
    "* ; * ? ? ?",
    "answers to the other questions remain far more uncertain .",
    "one school of thought argues that @xmath0 forms _ in situ _ , in the locations presently occupied by the observed clouds . according to this picture",
    ", gas accumulates due to the action of large scale flows , which may be driven by large - scale gravitational instability @xcite , magnetic instabilities such as the parker instability ( @xcite  1966 , although see @xcite for a recent view of its importance ) , or may simply be part of the general turbulent velocity field , which itself is probably driven primarily by some combination of energy input from supernovae and from the magnetorotational instability @xcite .",
    "however , others have argued that the @xmath0 forms long before the molecular clouds themselves are assembled , residing in the interstellar medium in a diffuse state or in the form of small cloudlets that eventually coalesce to form observable clouds ( see @xcite and references therein , or @xcite for a more recent version of this model ) .",
    "since coalescence will happen at a much faster rate in regions of converging flow , such as spiral arms , this model can be used to explain the enhanced star formation rates found within spiral arms .    one way to discriminate between these explanations",
    "is by determining the ages of observed molecular clouds .",
    "if most molecular clouds are young , with ages comparable to their dynamical timescales , then this suggests that they are transient objects , and argues for a dynamical origin . on the other hand ,",
    "if clouds are old , with lifetimes that are significantly greater than their dynamical timescale , then this is much easier to explain within a model in which clouds build up slowly and are dispersed slowly .    in recent years ,",
    "evidence that clouds are young has been accumulating .",
    "for instance , @xcite argue that the absence of post - t tauri stars with ages greater than @xmath8 in the taurus - auriga molecular cloud complex implies that the age of this cloud complex can be no more than a few million years .",
    "@xcite elaborate on this idea and show that similarly young ages are implied for most local star - forming regions .",
    "additionally , the age dispersion of stars in open clusters suggests that the molecular cloud complexes that give rise to them must have lifetimes of the order of their dynamical timescales , which are typically no more than a few million years @xcite .",
    "short cloud lifetimes also make it easier to understand the presence of supersonic magnetohydrodynamical turbulence within the molecular gas : in the absence of forcing , this will decay away within a few turbulent crossing times @xcite , and so its presence in long - lived clouds _ requires _ there to be some form of external or internal driving , whereas its presence in short - lived clouds does not .    another key piece of evidence for youthful clouds is discussed by @xcite and @xcite , who show that giant molecular clouds in the large magellanic cloud ( lmc ) are well - correlated with young stellar clusters , but",
    "do not correlate well with older clusters or with supernova remnants .",
    "they find that these very large clouds can only last @xmath9  myr before the onset of ob star formation , although they may last another 20  myr , supported by internal h  ii region expansion ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) or external driving by background supernovae ( e.g. * ? ? ?",
    "* ) , before their final dissolution by the same agents .    however , for a model involving rapid cloud formation to be viable , it must be possible to produce the required quantity of @xmath0 within a few million years . given the relatively slow rate at which @xmath0 forms , it is natural to ask whether it is possible to satisfy this requirement .",
    "simple back - of - the - envelope estimates made using the @xmath0 formation rate quoted above suggest that it is possible , provided that the mean density of the material making up the cloud exceeds @xmath10 @xcite , but we would ideally like to be able to confirm this result with more detailed numerical modeling .",
    "various efforts in this direction have been made by a number of groups @xcite , but to date this modeling has generally been restricted to one or two dimensions , and has assumed an initially ordered , large - scale velocity field , such as a convergent flow , despite the observational evidence that the velocity field of the neutral interstellar medium ( ism ) is dominated by disordered , turbulent motions ( see e.g. * ? ? ? * ) .",
    "on the other hand , existing three - dimensional simulations of the neutral ism , which do properly treat the velocity field and often also include an approximate treatment of the thermal balance of the gas ( e.g.  @xcite ; @xcite ; @xcite ; @xcite  2002a , b ,  2004 ; @xcite ; @xcite ; @xcite ; @xcite ) have not previously included sufficient chemistry to follow the formation of @xmath0 and so have been unable to directly address the questions posed here .    to bridge this gap ,",
    "we have performed simulations of the neutral ism using a hydrodynamical code capable of following both the thermal balance of the gas and the formation and destruction of @xmath0 within it .",
    "our goal is to determine how quickly significant quantities of @xmath0 can form in the dense neutral ism , and to use this information to assess whether models in which cloud formation is assumed to be rapid are likely to work in practice . in this paper ,",
    "we discuss in detail the numerical method used to follow the coupled chemical , thermal and dynamical evolution of the gas , and the tests used to verify the correctness of our implementation .",
    "we also present results from an application of our method to the problem of @xmath0 formation in gas that is gravitationally unstable , but not turbulent . in a companion paper ( @xcite",
    "; hereafter , paper ii ) we present results from a large suite of simulations that include the effects of supersonic turbulence .",
    "although highly simplified , and probably not representative of real clouds , the non - turbulent models examined in the second half of the present paper allow us to place an upper limit on the time required to form a molecular cloud , given neutral atomic gas with the density assumed in our initial conditions . by comparing the results of these simulations with the results from the turbulent models examined in paper ii",
    ", we can more clearly identify the effects of the turbulence , allowing us to demonstrate that supersonic turbulence significantly reduces the time required to form large quantities of @xmath0 .",
    "the structure of the current paper is as follows . in ",
    "[ num_section ] we describe the methods used to solve the equations of fluid flow , with a focus on our treatment of the thermal and chemical evolution of the gas , and in   [ tests ] we present the results of some basic tests of our approach . in",
    "  [ init_conds ] , we describe and motivate the initial conditions used for our simulations . in   [ static_results ] , we present results from simulations of gravitationally unstable gas which is initially at rest , paying particular attention to the rate of @xmath0 formation and the spatial distribution of the resulting molecular gas . finally , in ",
    "[ summary ] we summarize our main results .",
    "the governing equations for the flow of an inviscid , magnetized , self - gravitating gas can be written as @xcite : @xmath11 @xmath12 @xmath13 @xmath14 @xmath15 where @xmath16 @xmath17 , @xmath18 , @xmath19 , @xmath20 and @xmath21 are , respectively , the mass density , internal energy density , pressure , velocity , magnetic field and gravitational potential of the gas , where @xmath22 denotes the comoving derivative @xmath23 and where @xmath24 denotes the net rate at which the gas gains or loses internal energy due to radiative and chemical heating and cooling",
    ". corresponds to a net loss of energy and @xmath25 to a net gain . ] additionally , in a chemically reactive flow , each chemical species satisfies an equation of the form @xmath26 where @xmath27 is the mass density of species @xmath28 , and where @xmath29 and @xmath30 represent its creation and destruction by chemical reactions .",
    "finally , to close the set of equations , it is necessary to specify an equation of state relating the internal energy and the pressure . for an ideal gas",
    "we can write this as @xmath31 where @xmath32 , the ratio of specific heats , depends upon the composition of the gas .",
    "for a gas with a number density @xmath33 of hydrogen nuclei , a number density @xmath34 of helium nuclei , and with a molecular hydrogen abundance @xmath35 and an electron abundance @xmath36 , we can write @xmath32 as @xmath37 where we have assumed that the rotational degrees of freedom of @xmath0 are populated , but that the vibrational degrees of freedom are not . with the definition of @xmath38 that we have adopted here",
    ", a value of @xmath39 corresponds to gas in which all of the hydrogen is in molecular form , in which case @xmath40 .",
    "( note that the more familiar @xmath41 is for a gas which is pure @xmath0 ; the presence of the helium in our simulations causes a slight hardening of the equation of state ) .    to solve this set of equations , we used a modified version of the publicly available zeus - mp hydrodynamical code .",
    "zeus - mp is a multi - physics , massively - parallel , message - passing code for astrophysical fluid dynamics @xcite , developed by the laboratory for computational astrophysics at uc san diego , which solves the equations of self - gravitating magnetohydrodynamics ( mhd ) in three dimensions .",
    "the algorithms used in the zeus family of hydrocodes are described in detail in @xcite  ( 1992a , b ) and @xcite .",
    "their implementation within zeus - mp is discussed in @xcite and @xcite .",
    "the poisson solver used is a fourier space solver that utilizes the fftw library @xcite .",
    "our modified version of zeus - mp is derived from version 1.0b of the code .",
    "( for details of the more recently released version 2 , see @xcite ) .    we have modified zeus - mp in two main respects .",
    "firstly , in order to follow non - equilibrium chemistry within the gas it is necessary to add an extra field variable for each chemical species that we wish to track . a natural choice of variable is the mass density of each species , as in that case in a medium with @xmath42 non - equilibrium chemical species , we will have @xmath42 equations of the form of equation  [ chem_eq ] to solve . as discussed below in   [ chem_sec ] , we follow only two non - equilibrium species in the simulations presented here  @xmath0 and @xmath43  and so have two such equations to solve . to solve these equations , we use operator splitting to separate the effects of advection ( which is treated in the same fashion as advection of the total mass density ; see @xcite ) from those of the chemical creation and destruction terms . in other words , during the reaction step we solve the equations @xmath44 the method of solution that we adopt is implicit finite differencing : we approximate equations  [ chem_eq1 ] & [ chem_eq2 ] as @xmath45 ,     \\label{chem_eq3 } \\\\    \\rho_{{\\rm{h}^{+}}}^{i+1 } & = & \\rho_{{\\rm{h}^{+}}}^{i } + \\delta t     \\left[{\\rm c}_{\\rm { \\rm{h}^{+}}}^{i+1 } - { \\rm d}_{\\rm { \\rm{h}^{+}}}^{i+1 } \\right ] ,     \\label{chem_eq4}\\end{aligned}\\ ] ] where the superscripts indicate values at the beginning and end of the timestep .",
    "the advantage of using a first - order implicit method is that we can guarantee that the abundances will remain non - negative and that the solution will remain stable regardless of the size of the timestep chosen ( although the requirement that we solve equations  [ chem_eq3 ] & [ chem_eq4 ] accurately still places some limits on the size of the timestep ) .",
    "the disadvantage of using an implicit method is that the resulting finite difference equations are coupled and must be solved iteratively .",
    "moreover , the fact that the creation and destruction terms also depend strongly on the internal energy of the gas ( through the temperature @xmath46 ) suggests that we should solve these equations simultaneously with the energy equation .",
    "we therefore defer discussion of the solution of equations  [ chem_eq3 ] & [ chem_eq4 ] until after we have discussed the modifications that we have made to the treatment of the internal energy equation .",
    "this has been modified to include a term representing the combined effects of radiative and chemical heating or cooling , i.e.  the @xmath24 term of equation  [ energy_eq ] .",
    "details of the processes included are given in ",
    "[ cool_sec ] below and are summarized in table  [ cool_model ] .",
    "solution of the resulting equation proceeds much as it does in the unmodified version of zeus - mp : the equation is operator split , with the effects of artificial viscosity , compressional heating and advection treated separately .",
    "our treatment of the artificial viscosity and advection steps mirrors that in the unmodified version of the code , as discussed in detail in @xcite ; we will not discuss it here .",
    "however , during the compressional heating step , instead of solving the equation @xmath47 we solve @xmath48 to solve equation  [ pdvcool ] , we use an algorithm based on a combination of the zeus-3d * pdvcool * algorithm ( originally implemented by m.  norman and subsequently modified by m .- m .  mac  low , j.  stone and d.  clarke ) with the implicit algorithm used by @xcite and further developed by @xcite and @xcite . we construct the following implicit approximation to equation  [ pdvcool ] @xmath49 where @xmath50 represents the time - centered pressure , which we approximate as @xmath51 $ ] , and where @xmath52 is the cooling rate at the end of the timestep .",
    "we rearrange this equation to give @xmath53 where @xmath54 and then solve equation  [ fd_energy ] together with equations  [ chem_eq3 ] & [ chem_eq4 ] using a form of gauss - seidel iteration .",
    "this works as follows :    1 .",
    "update @xmath55 , using old values for @xmath56 and @xmath17 .",
    "update @xmath56 , using new value for @xmath55 but old value for @xmath17 .",
    "3 .   update @xmath17 , using new values for @xmath55 and @xmath56 .",
    "4 .   test for convergence .",
    "if not converged , return to step 1 .    on our first pass through the loop ,",
    "we take the old values for @xmath56 and @xmath17 to be those at the start of the current timestep . on subsequent passes through the loop",
    ", we instead use the values from the previous iteration .",
    "since the internal energy converges more slowly than either of the chemical abundances , we monitor its value to determine when to stop the iteration , halting once the relative difference between updated and old values becomes less than @xmath57 . on rare occasions",
    ", the iteration may fail to converge . in this case , we switch to solving for @xmath17 using a more expensive bisection algorithm that is sure to find a solution . in this case , we lose the benefits of the iteration for refining our initial guesses for @xmath55 and @xmath56 .",
    "fortunately , the abundances of @xmath0 and @xmath43 generally do not vary much during a single timestep and so the error that this introduces is probably not significant , particularly since the iteration almost always succeeds .    to compute the cooling timestep , @xmath58 , we use the same procedure as in @xcite and @xcite : we compute @xmath24 and then require that the timestep be such that the internal energy will not vary by more than 30% given this value of @xmath24 , i.e.@xmath59    to improve the efficiency of the code , we also make use of subcycling .",
    "rather than constraining the global timestep of the simulation @xmath60 to be less than @xmath58 , we instead use the same global timestep as we would within the unmodified version of the code , but solve the chemistry and cooling substeps alone over the shorter cooling timescale , repeating the procedure for as many times as is necessary to make the total elapsed time equal to @xmath60 .",
    "thus , if @xmath61 , we proceed through the chemistry and cooling substep only once per simulation timestep , while if @xmath62 , we do so many times , using the updated values of the chemical abundances and internal energy from the end of one substep as the input to the next .",
    "we subcycle at the level of the individual grid zones , so only zones for which @xmath63 take multiple chemistry and cooling substeps per hydrodynamical timestep .",
    "the gain in computational efficiency from this subcycling procedure is difficult to quantify , as it depends on the physical state of the gas , but tests indicate that it can easily be as much as an order of magnitude .",
    "the chemical composition of the ism is complex .",
    "over 120 different molecular species have been detected in interstellar space @xcite and while many of these are found in detectable amounts only in dense , well - shielded gas , there remain a significant number that have been detected in diffuse , unshielded gas ( see , for instance * ? ? ? * and references therein ) .",
    "a full chemical model of the ism can easily involve several hundred different atomic and molecular species and several thousand different reactions , even if reactions on grain surfaces are neglected ( e.g. * ? ? ?",
    "it is currently impractical to incorporate this amount of chemistry into a 3d hydrodynamical code such as zeus - mp , due to the extreme impact it would have on the code s performance .",
    "fortunately , much of this chemistry is not relevant to our current study , and can be neglected without significantly compromising our results .",
    "recall that the main goals of this paper are to determine the timescale on which molecular clouds form in gravitationally unstable atomic gas , and the fraction of this gas that is converted to molecular form . to achieve these goals , we clearly need to be able to follow the formation and destruction of @xmath0 with a reasonable degree of accuracy . beyond this , however , the only chemistry that we really need to be concerned with is that which plays a role in determining the thermal balance of the gas . in other words , we need only follow the chemistry of @xmath0 , and of a few other major coolants such as @xmath64 or @xmath65 ; the chemistry of other molecules such as @xmath66 , while undeniably of interest , is not central to the task at hand and so can be sacrificed in pursuit of efficiency .",
    "to identify the major coolants in the diffuse ism , we can use the results of @xcite , who studied its thermal evolution in some detail .",
    "they show that in the warm neutral medium ( wnm ) , which has a characteristic temperature @xmath67 , most of the cooling comes from lyman-@xmath68 emission from atomic hydrogen , electron recombination with small grains and polycyclic aromatic hydrocarbons ( pahs ) , and fine structure emission from atomic oxygen . cooling in the cold neutral medium ( cnm ) , which has a characteristic temperature @xmath69 , is dominated by fine structure emission from ionized carbon , @xmath70 , with fine structure emission from oxygen also contributing significantly in the warmer parts of the cnm .",
    "these two coolants also dominate in the thermally unstable temperature regime @xmath71 .",
    "heating in all three regimes is dominated by photoelectric emission from dust grains and pahs ; the heating rate is therefore primarily determined by the strength of the ultraviolet background and by the dust to gas ratio , but it also has a dependence on the electron abundance ( see equation  [ pe_eff ] in   [ cool_sec ] ) .",
    "we also include fine structure cooling from @xmath72 .",
    "although never the dominant coolant , @xmath72 does produce @xmath73 of the total fine structure emission at temperatures @xmath74 at all densities , and can produce as much as 30% of the emission at high densities , owing to the relatively large size of einstein coefficient for the @xmath72 @xmath75 transition @xcite .    in denser gas that is shielded from the ultraviolet background , other coolants such as @xmath3 and @xmath76 become important , as demonstrated by @xcite , @xcite and @xcite .",
    "however , since we are primarily interested in the transition from atomic to molecular gas , and since these coolants will not become important until after the gas is already fully molecular , we have chosen to make another major simplification in the chemistry : we assume that carbon , oxygen and silicon remain primarily in the form of , and respectively , throughout the simulation . by making this assumption",
    ", we essentially reduce the chemistry that must be followed to that of only three species  electrons , neutral hydrogen and @xmath0  at the cost of computing an incorrect cooling rate in dense molecular gas .",
    "the dense gas in our simulations is also typically rather cold , with a temperature of no more than a few tens of kelvin , and so we will probably underestimate the cooling rate within it , since in these conditions molecular coolants such as @xmath3 are more effective than the , and included in our simulations .",
    "this means that we probably overestimate the temperature of this gas , but the fact that the dense gas is so cold shows that we do not overestimate its temperature by a large amount , and we therefore do not expect this approximation to have a significant impact on the @xmath0 formation rate .    having discussed the underlying assumptions , we now present our chemical model",
    "we adopt standard solar abundances of hydrogen and helium , along with abundances of carbon , oxygen and silicon taken from @xcite : @xmath77 , @xmath78 , @xmath79 .",
    "we assume that helium remains neutral and plays no direct role in the chemistry , and that carbon and silicon remain singly ionized throughout the simulation .",
    "the ionization state of oxygen is assumed to track that of hydrogen , due to the influence of the charge transfer reactions @xmath80    as previously noted in ",
    "[ mhd_eq ] , we follow directly the abundances of two chemical species , namely @xmath43 and @xmath0",
    ". the abundances of the other major species  atomic hydrogen and electrons  are computed from the conservation laws : @xmath81 and @xmath82 where @xmath83 is the total abundance of hydrogen nuclei , in all forms , and where @xmath84 and @xmath85 represent the abundances of ionized carbon and silicon respectively .",
    "we neglect the small contributions to @xmath86 made by electrons from other ionized metals , such as @xmath87 or @xmath88 , since these are small compared to the contribution from carbon .",
    "we also neglect any contribution from @xmath89 , as this will be negligible compared to the contribution from hydrogen .",
    "our assumption that carbon and silicon remain ionized throughout the simulation becomes inaccurate in dense , well - shielded gas , where uv photoionization of neutral carbon and silicon becomes ineffective .",
    "we therefore overestimate the fractional ionization of gas in these regions . however , our main motivation for tracking the fractional ionization is to compute the photoelectric heating rate accurately , and since this is unimportant in dense , shielded gas , the inaccuracy in the fractional ionization is likely unimportant there .",
    "the reactions included in our chemical model are summarized in table  [ chem_model ] . in most cases",
    ", we also list the source or sources from which we took the rate coefficient used in our model .",
    "the exception is @xmath0 photodissociation , the treatment of which is discussed in detail in   [ h2_phdis ] below .",
    "two other reactions deserve further comment : the collisional dissociation of @xmath0 by atomic hydrogen @xmath90 and molecular hydrogen @xmath91 the reaction coefficients for both of these reactions are density - dependent , since they are sensitive to the population of the vibrational and rotational levels of @xmath0 . to treat the former",
    ", we use a rate coefficient @xmath92 where @xmath93 is the low density limit of the collisional dissociation rate and is taken from @xcite , while @xmath94 is the high density limit , taken from @xcite .",
    "the critical density , @xmath95 , is given by @xmath96 where @xmath97 and @xmath98 are the critical densities in pure atomic gas with an infinitesimally dilute quantity of @xmath0 and in pure molecular gas respectively .",
    "the first of these values is taken from @xcite , but has been decreased by an order of magnitude , as recommended by @xcite ; the other value comes from @xcite . to treat the collisional dissociation of @xmath0 by @xmath0 we use a similar expression @xmath99 where the low density limit , @xmath100 , is taken from @xcite and the high density limit , @xmath101 ,",
    "is taken from @xcite .",
    "the collisional dissociation rates computed in this way are acceptably accurate when @xmath102 or @xmath103 , but may be less accurate in gas with @xmath104 ; further study of the collisional dissociation of @xmath0 in gas which is a mixture of @xmath105 and @xmath0 would be desirable to help remedy this .",
    "we do not include the gas phase formation of @xmath0 via the @xmath4 or @xmath5 ions , as in the typical conditions of the galactic ism , this is unimportant compared to the formation of @xmath0 on dust grains @xcite .    as can be seen from table  [ chem_model ] ,",
    "our @xmath43 chemistry is straightforward .",
    "however , a couple of reactions are deserving of comment .",
    "one is gas - phase recombination , where we note that we use the case b value for the recombination coefficient , as this is the most appropriate choice in all but the most highly ionized gas .",
    "the other is the cosmic ray ionization of @xmath105 . in the majority of our simulations ,",
    "we use a value of the cosmic ray ionization rate @xmath106 .",
    "this is consistent ( within the error bars ) with recent determinations of the ionization rate in dense cores within molecular clouds @xcite .",
    "however , measurements of the @xmath107 column density along sight - lines passing through diffuse gas are only explained by a much larger value of @xmath108 , within the range @xmath109 @xcite , where the uncertainty is due primarily to the uncertain distribution of gas along the observed lines of sight . the cause of this discrepancy is currently unknown (",
    "although @xcite suggest one possible mechanism ) , and so for simplicity we take @xmath108 to be constant , independent of the gas density .",
    "we briefly examine in ",
    "[ static - temp ] the consequences of adopting a larger value for @xmath108 .      following @xcite",
    ", we can write the photodissociation rate of @xmath0 in optically thin gas as @xmath110 where we have assumed that the ultraviolet field has the same spectral shape as the @xcite field , and where @xmath111 is a dimensionless factor which characterizes the intensity of the field at @xmath112  relative to the @xcite field ; note that for the original @xcite field , @xmath113 .    by balancing this dissociation rate against the rate at which @xmath0 forms on dust grains",
    ", we can easily show that the equilibrium @xmath0 fraction in cold gas is given by @xmath114 which is clearly far less than one unless @xmath115 is very large . since observations indicate that significant molecular gas is present at densities below @xmath116 ( see e.g. * ? ? ?",
    "* ) , it is clear that some shielding of interstellar @xmath0 molecules from the effects of uv photodissociation must occur , and that simulations of molecular cloud formation which do not take this shielding into account are going to be tremendously inaccurate .",
    "@xmath0 can be shielded against photodissociation in two main ways : by line absorption due to other @xmath0 molecules ( i.e.  self - shielding ) , and by continuous absorption due to dust .",
    "the effects of both processes have been treated in some detail by @xcite .",
    "they show that in shielded gas the photodissociation rate can be written approximately as @xmath117 where @xmath118 is a numerical factor accounting for the effects of self - shielding , @xmath119 is the optical depth due to dust at @xmath120 , and @xmath121 is the unshielded photodissociation rate , given by equation  [ kph_thin ] above .",
    "@xcite show that for a static , plane parallel slab of gas , @xmath118 is well approximated by @xmath122 , \\label{fsh}\\ ] ] where @xmath123 with @xmath124 being the @xmath0 column density , and @xmath125 , where @xmath126 is the doppler broadening parameter .",
    "if the gas is not static or in uniform motion , but instead has a spatially varying velocity , then equation  [ fsh ] will overestimate the amount of self - shielding that occurs .",
    "the reason for this is that if the velocity field is non - uniform , then the relative velocity between any two fluid elements will , in general , be non - zero .",
    "consequently , the contribution to the total absorption coming from the first fluid element will be doppler shifted when viewed from the rest frame of the second fluid element .",
    "if this doppler shift is large compared to the line widths of the lyman - werner band transitions , then the effect is to significantly reduce the extent to which the absorption coming from the first fluid element contributes to the self - shielding seen by the second fluid element . for @xmath0 column densities @xmath127 ,",
    "the intrinsic widths of even the strongest lyman - werner band transitions are unimportant and the line profiles are dominated by doppler broadening . in this regime , the neglect of changes in the velocity along the line of sight is justified if the differences in velocity are much smaller than the sound speed of the gas , and equation  [ fsh ] remains a good estimator for @xmath118 . on the other hand ,",
    "if the differences in the velocity are much greater than the sound speed , as will generally be the case in a supersonically turbulent flow , then equation  [ fsh ] will significantly overestimate the degree of self - shielding that will actually occur .    for @xmath128 ,",
    "the line widths of the strongest transitions are dominated by lorentz broadening , and the degree of self - shielding in these lines becomes insensitive to the velocity distribution of the gas , unless the range of velocities is extremely large .",
    "however , the total @xmath0 photodissociation rate remains sensitive to the velocity dispersion , as a large fraction of the total rate is due to absorption in weaker lines , whose widths are still dominated by doppler broadening . only for @xmath129 does the total photodissociation rate become relatively insensitive to the velocity distribution of the gas .",
    "an additional problem with using equation  [ fsh ] to compute the self - shielding factor is that it requires us to compute the @xmath0 column densities along a large number of lines of sight for every zone in our simulation .",
    "unfortunately , the computational cost of doing so is very large : for a simulation with @xmath42 fluid elements , the cost of solving for the column densities scales as @xmath130 ( assuming that we require an angular resolution that is well matched with the spatial resolution of the code ) , compared to scalings of @xmath131 for the hydrodynamical algorithms and @xmath132 for the self - gravity .",
    "consequently , solving for the column densities would quickly come to dominate the cost of the simulation , and would prevent us from performing any high resolution simulations .",
    "moreover , while parallelization of the code would help to some extent , efficient parallelization of the radiative transfer is difficult , owing to the way in which it couples together widely separated regions in the computational volume .",
    "computation of the optical depth due to dust , @xmath119 , is in principle considerably simpler than computation of @xmath118 , since it involves continuous absorption rather than line absorption , and so doppler effects can generally be neglected ( at least for the velocities of interest here ) .",
    "@xcite showed that it is possible to approximate the extinction observed along many lines of sight in the galaxy by a one - parameter family of curves , where the controlling parameter is @xmath133 , defined as @xmath134 where @xmath135 and @xmath136 are the extinctions in the b and v bands respectively . for @xmath137 , which is typical for many lines of sight in the diffuse ism ,",
    "@xcite quote an effective attenuation cross - section for the dust of @xmath138 .",
    "the corresponding dust opacity is given by @xmath139 where @xmath140 is the total column density of hydrogen nuclei between the point of interest and the source of the radiation .",
    "therefore , to compute the effects of the dust shielding , we again need to compute appropriate column densities , although in this case the effect of velocity differences along the line of sight is unimportant . as in the case of self - shielding ,",
    "the cost of solving for the column densities is @xmath130 for a simulation with @xmath42 fluid elements , and so a high resolution treatment of both the fluid flow and the radiation field is not computationally feasible .    to overcome these difficulties ,",
    "we have performed simulations using two different approximations .",
    "our first approximation is very simple .",
    "we assume that the dominant contribution to the shielding of a given fluid element comes from gas in the immediate vicinity of that element . in the case of @xmath0 self - shielding",
    ", this assumption can be justified to some extent by the fact that the relative velocity between this gas and the point of interest will typically be small , whereas gas at larger distances will typically possess a much larger relative velocity , particularly in supersonically turbulent gas . additionally , in gravitationally collapsing regions",
    ", the local gas density will be substantially larger than the density in most regions of the flow , further increasing the importance of the spatially local contribution . in the case of dust shielding , the former justification no longer holds true , although the latter remains valid . to give a quantitative form to this approximation , we note that we continue to use equation  [ fsh ] to compute the self - shielding factor , but use an @xmath0 column density given by @xmath141 where @xmath142 is the @xmath0 number density in the zone of interest and @xmath143 is the width of the zone , measured parallel to one of the coordinate axes .",
    "similarly , we continue to use equation  [ tau_d ] to compute the dust opacity , but replace @xmath144 with the local approximation : @xmath145 where @xmath115 , @xmath146 and @xmath142 are the local number densities of atomic hydrogen , @xmath43 and @xmath0 respectively . in the remainder of this paper",
    ", we refer to this approximation as the local shielding approximation .",
    "the main advantage of the local shielding approximation is that we can be certain that we are _ underestimating _ the true amount of shielding and hence _ overestimating _ the @xmath0 photodissociation rate .",
    "consequently , @xmath0 fractions computed in simulations which use the local shielding approximation will be strong lower limits on the true values , and the corresponding @xmath0 formation timescales will be solid upper limits .",
    "moreover , in paper ii we show that this very simple approximation proves to be surprisingly accurate in supersonically turbulent gas , although it is significantly less effective in the simulations of smooth collapse presented in this paper .",
    "a significant disadvantage of the local shielding approximation is that it makes the photodissociation rate dependent on @xmath143 and hence on the resolution of the simulation .",
    "consequently , the abundance of @xmath0 that we expect to find in gas in our simulations that is in photodissociation equilibrium also becomes resolution - dependent . to see this ,",
    "consider the equation for the equilibrium @xmath0 abundance : @xmath147 where @xmath148 is the formation rate of @xmath0 on dust grain surfaces , taken from @xcite , and @xmath149 .",
    "since @xmath150 depends on @xmath143 but @xmath148 does not , the equilibrium @xmath0 abundance @xmath151 must inevitably depend on @xmath143 .",
    "how significant this is for any given grid zone depends in large part on the total hydrogen column density and the @xmath0 column density for that zone .",
    "if both are sufficiently small that the zone is optically thin to uv radiation , then changing the size of the zone will have little effect on @xmath150 , provided that the zone remains optically thin .",
    "conversely , if either @xmath144 or @xmath124 for that zone are large enough to make the zone highly optically thick to @xmath0 photodissociation , then changing the zone size will have a large effect on @xmath150 , but only a very small effect on @xmath151 , which will remain close to one . however , for zones that lie in the intermediate regime between these two limiting cases , the effect on @xmath151 can be significant and it is here that our results will be least accurate .",
    "the second approximate technique that we have used to compute the photodissociation rate again makes use of equations  [ fsh ] and [ tau_d ] . however , in this approach we compute the @xmath0 and dust column densities seen by each grid zone by averaging over a small number of lines of sight . specifically , we compute column densities in both the positive and negative directions along each of the three coordinate axes of the simulation , compute the associated values of @xmath118 and @xmath119 for each of these lines of sight , and then compute the total photodissociation rate by means of a suitably weighted average of these values .",
    "the main advantage of this approach is that its computational cost should not be very much greater than the cost of solving the hydrodynamic equations , as in both cases the cost of the algorithm is @xmath131 .",
    "moreover , by restricting the lines of sight that are treated to be those parallel to the coordinate axes , we also limit the amount of communication between different processors that is required , and so limit the adverse impact on the scalability of the code .",
    "an approach of this type has previously been used to study the stability and dynamics of low mass molecular clouds and bok globules @xcite , while a very similar approach has been used to study the formation of @xmath0 in early protogalaxies illuminated by an intergalactic uv background @xcite .",
    "we refer to this approximation in the remainder of this paper as the six - ray shielding approximation .",
    "an obvious disadvantage of this approach is the extremely coarse angular resolution of the radiation field that it provides .",
    "this poor angular resolution will cause us to overestimate the amount of shielding in some regions , and underestimate it in others : the precise details will depend on the particular form of the density field , but in general we will tend to underestimate the amount of shielding whenever the volume filling factor of dense gas is small .",
    "another significant problem is that this approach does not take account of velocity structure along any of the lines of sight .",
    "it therefore may significantly overestimate @xmath118 in a supersonic flow , particularly if the gas is turbulent . for the main problem that we are interested in investigating ",
    "the determination of the @xmath0 formation rate in dynamically evolving , cold atomic gas  this is problematic , as it may lead us to derive an artificially short timescale for @xmath0 formation .",
    "nevertheless , in many scenarios ( including the simulations of smooth collapse presented later in this paper ) , the six - ray shielding approximation produces significantly more accurate results than the local shielding approximation .",
    "another possible approach to treating the effects of shielding which we considered but discarded makes use of the fact that the contribution towards the total @xmath0 photodissociation rate made by any individual lyman - werner line is directly proportional to the penetration probability for that line . for a line of sight @xmath152",
    ", this is given by @xmath153 where @xmath154 is the line profile function for the line in question and @xmath155 is the optical depth at frequency @xmath156 in the direction @xmath152 .",
    "this penetration probability is analogous to the more commonly encountered escape probability , and this similarity can be fruitfully exploited . in particular ,",
    "if the gas has a large monotonic velocity gradient in the direction @xmath152 , then the sobolev approximation @xcite can be used to compute @xmath157 given only the local @xmath0 number density and the magnitude of the velocity gradient .",
    "if the velocity gradient is large in all directions , then we can repeat this procedure for many lines of sight , and with suitable averaging can derive a mean penetration probability for the line .",
    "finally , by repeating this for each of the lines which contribute to the total photodissociation rate , we can compute the rate itself , using only local quantities .",
    "there are , however , two major drawbacks to this approach .",
    "first , it can only be relied upon to give accurate answers in conditions where the sobolev approximation applies .",
    "this formally limits the applicability of this method to regions where the velocity gradient is monotonic and where any variations in density , temperature or @xmath0 abundance occur far more slowly than variations in velocity .",
    "these conditions are not satisfied in turbulent molecular clouds , and so although the sobolev approximation can sometime be fruitfully applied ( see , for instance * ? ? ?",
    "* ) , in general it will not give accurate results .",
    "moreover , in contrast to our local shielding approximation , we can not be confident that we know the sense of the inaccuracy , i.e.  whether we produce too much or too little @xmath0 , as this will depend on the physical conditions within a given simulation , and may also change over time within that simulation . therefore , although this approach avoids the resolution dependence of our local shielding approximation , it does so at the cost of producing results that have no clear interpretation , being neither lower nor upper limits .",
    "the other major drawback to this approach is that it can not be used to model dust absorption , as in this case the sobolev approximation simply does not apply .    to sum up",
    ", our local shielding approximation has the advantages of simplicity and a straightforward interpretation , while our six ray shielding approximation will often be more accurate but has a less clear interpretation .",
    "although neither approximation is ideal , by comparing and contrasting the results from both , we can draw important conclusions about the formation timescale of @xmath0 in static and in turbulent gas .      in order to solve equation  [ pdvcool ]",
    ", we need to calculate @xmath24 , the net rate at which the gas gains or loses energy due to radiative and/or chemical heating and cooling .",
    "we can write @xmath24 as the sum of a heating and a cooling term : @xmath158 as discussed in   [ chem_sec ] , a number of different processes contribute to @xmath159 . at high temperatures ( @xmath160 ) , much of the cooling is provided by excitation of the resonance lines of hydrogen , helium or heavier elements . to treat cooling in this temperature range , we adopted a tabulated cooling function from @xcite : specifically , the cooling function listed in table  10 of their paper , which assumes [ fe / h ] = -0.5 .",
    "significant cooling also comes from the recombination of electrons with small dust grains and pahs .",
    "we incorporate this using a cooling rate taken from @xcite , based on an original formulation by @xcite : @xmath161 where @xmath162 , @xmath163 is given by @xmath164 where @xmath165 represents the strength of the uv background in the gas after dust shielding is taken into account ( see * ? ? ?",
    "* ) , and where @xmath166 is an adjustable parameter introduced by @xcite to make the heating rate consistent with the values of the electron attachment and electron recombination rates that are inferred observationally for pahs ; the original @xcite treatment corresponds to @xmath167 .    at lower temperatures ,",
    "the contribution of these coolants becomes negligible , and cooling by and fine structure lines dominates . to compute the cooling from , we used atomic data from @xcite , together with collisional de - excitation rates from @xcite for collisions with @xmath0 , from @xcite for collisions with atomic hydrogen at @xmath168 , from @xcite for collisions with atomic hydrogen at @xmath169 , and from @xcite for collisions with electrons .    for fine structure cooling , we used atomic data from @xcite , together with collisional rates provided by d.  flower ( priv .",
    "comm . ) for collisions with @xmath105 and @xmath0 , as well as rates from @xcite for collisions with electrons and @xcite  ( 1990 ,  1996 ) for collisions with protons .",
    "in addition to cooling from and , we also included contributions from fine structure line emission  which can be more effective than cooling if the temperature and density are both large  and from the rotational and vibrational lines of @xmath0 .",
    "to compute the cooling rate , we again used atomic data from @xcite , and collisional rates from @xcite for collisions with atomic hydrogen and from @xcite for collisions with electrons .",
    "de - excitation rate coefficients for collisions between @xmath170 and @xmath0 were unavailable , and so were arbitrarily set to zero ; however , this is unlikely to introduce a significant error into the computed cooling rate in our simulations as gas with a significant molecular fraction is typically far too cold for cooling to be effective ( see , for instance ,   [ static - temp ] ) .    for cooling due to @xmath0",
    ", we use the cooling function from @xcite , which we have extended to temperatures below @xmath171 by assuming that only the @xmath172 and @xmath173 transitions contribute significantly to the cooling rate . for simplicity",
    ", we also fix the ortho : para ratio at 3:1 .",
    "however , variations in this ratio are unlikely to significantly affect the @xmath0 cooling rate at temperatures at which it contributes significantly to the total cooling rate ( see , for instance , figure  5 in @xcite ) .    in each case",
    ", we assumed that cooling occurs in the optically thin limit .",
    "this is a reasonable assumption in diffuse gas , but breaks down in dense , high column density cores .",
    "however , in these conditions of high density and high optical depth , we would expect all of the hydrogen to already be in molecular form ( and indeed much of the carbon and oxygen to be in the form of @xmath3 , rather than and as assumed here ) and so errors in the gas temperature in these dense cores are unlikely to have any significant effect on our results .",
    "in addition to these processes , we also include the effects of collisional transfer of energy between gas and dust , following the prescription of @xcite .",
    "this acts to cool the gas whenever @xmath174 , and to heat it when @xmath175 .",
    "however , this is not an important process at the gas densities studied here , although it does become increasingly important in higher density gas .",
    "finally , we also allow for the effects of cooling due to the collisional dissociation of @xmath0 and collisional ionization of @xmath105 , although in practice neither process is of much importance in our simulations .",
    "as far as heating is concerned , the most important contribution to @xmath176 comes from the heating produced by photoelectric emission from uv - irradiated dust grains and pahs .",
    "following @xcite and @xcite , we write the photoelectric heating rate as @xmath177 where @xmath178 is the heating efficiency , given by @xmath179 with @xmath163 as given by equation  [ psi_eq ] above .",
    "additional contributions to @xmath176 come from several other processes :    * photodissociation of @xmath0 by far - ultraviolet ( fuv ) radiation + following @xcite , we assume that each photodissociation deposits @xmath180 of heat into the gas , giving us a heating rate @xmath181 where @xmath182 is given by equation  [ h2_kph ] above . *",
    "excitation of @xmath0 by fuv radiation + as well as dissociating some of the @xmath0 , the fuv radiation also produces vibrationally excited @xmath0 via radiative pumping . at high densities , this leads to heating of the gas , as most of the excited molecules undergo collisional de - excitation .",
    "we adopt a radiative pumping rate that is 8.5 times larger than the photodissociation rate @xcite , and assume that each excitation transfers an average of @xmath183 to the gas @xcite , where @xmath95 is the critical density at which collisional de - excitation of vibrationally excited @xmath0 occurs at the same rate as radiative de - excitation . as previously noted , our value for @xmath95 is a weighted harmonic mean of the value for @xmath0-@xmath105 collisions given by @xcite and the value for @xmath0-@xmath0 collisions given by @xcite . *",
    "@xmath0 formation on dust grains + the formation of an @xmath0 molecule from two hydrogen atoms releases approximately @xmath184 of energy . in all likelihood",
    ", some fraction of this energy will go into the rotational and vibrational excitation of the newly - formed @xmath0 molecule , with the remainder going into the translational energy of the molecule or into heating the grain @xcite .",
    "the fraction of the total energy going into rotational and vibrational excitation remains a subject of investigation ( see e.g. * ? ? ?",
    "* ) , but in our simulations we assume that this fraction is close to one . as with fuv pumping ,",
    "most of this energy will be lost through radiative de - excitation of the @xmath0 molecule if @xmath185 , but will be converted to heat if @xmath186 .",
    "we therefore adopt an @xmath0 formation heating rate of @xmath187 where @xmath188 is the rate of @xmath0 formation on dust grains and @xmath95 is the critical density , calculated as described above . *",
    "cosmic ray ionization + following @xcite , we assume that each ionization deposits @xmath189 of energy into the gas , which gives us a heating rate @xmath190    we do not include the effects of heating by soft x - rays , as this is of little importance compared to photoelectric heating in low density gas , and is negligible in high density , optically thick gas .",
    "other potential heat sources , such as the photoionization of carbon or silicon by the uv background , are also insignificant and can be neglected .",
    "a full list of all of the thermal processes included in our model can be found in table  [ cool_model ] .",
    "tests of the hydrodynamical and mhd algorithms used in zeus are presented in @xcite  ( 1992a , b ) and @xcite and therefore are not discussed here . some potential problems relating to the treatment of rarefaction waves and adiabatic mhd shocks in zeus",
    "have been pointed out by @xcite , but we do not anticipate that these problems will invalidate the results presented in this paper . in the case of the rarefaction errors ,",
    "our confidence that they will not significantly affect our results rests on the fact that most of the relevant chemistry for @xmath0 formation occurs in regions of compression while regions of rarefaction are relatively inactive , and so errors in the treatment of the latter will have very little effect . as for the shock errors , these vanish if an isothermal equation of state is used @xcite , and since the effective equation of state in our simulations is much closer to the isothermal case than the adiabatic case ( see   [ static - temp ] below ) , it is reasonable to expect that any errors will be small .    however , it is necessary to ensure that our modifications to the basic zeus code operate as intended . to verify the modified code ,",
    "we have performed tests of the advection of the species mass densities in non - reacting flows ( discussed in   [ advect_test ] below ) and of the solution of the chemistry and cooling substep in static gas ( discussed in   [ static_test ] ) .      in non - reacting flow , equation  [ chem_eq ]",
    "reduces to @xmath191 and so the species mass densities should be advected in precisely the same manner as the physical density of the gas . to verify that this is indeed the case",
    ", we performed a series of tests of the advection algorithm .",
    "our test suite was based on the advection tests used by @xcite to validate the advection algorithms used in zeus-2d , a predecessor of the current zeus - mp code .",
    "these tests include the advection of a square pulse of high density material by a uniform flow , the classic sod shock tube test @xcite , and various tests taken from @xcite that involve the interaction of strong shocks . to use these test problems to verify that our species mass densities are advected correctly , we modified them to include two extra field variables , @xmath192 and @xmath193 , representing arbitrary chemical species , both of which evolve according to equation  [ chem_eq ] . since we wished to simulate non - reacting flow , the chemical creation and destruction terms for these variables ( @xmath194 , @xmath195 , @xmath196 and @xmath197 )",
    "were set to zero .",
    "the fields were initialized such that @xmath198 and @xmath199 , the tests were run , and then the resulting values of @xmath192 and @xmath193 were examined .",
    "correct operation of the code implies that @xmath200 and @xmath201 should be conserved . in our tests",
    ", we found that these ratios were generally conserved to within 0.01% .",
    "our initial tests of the chemistry and cooling substeps focused on verifying that the correct reaction rates and heating and cooling rates were computed by the code , given various different sets of input parameters .",
    "to do this , we constructed a simple test harness , using a mixture of fortran and perl , which allowed us to run the main chemistry and cooling subroutines separately from the remainder of the hydrodynamical code .",
    "we also inserted debugging statements into these subroutines which caused them to write out the values of the various rates into a log file .",
    "the values produced were then compared with those produced for the same set of input parameters by an independent test implementation of the chemical and cooling rates .",
    "disagreements between the two sets of rates could then be easily identified and investigated , and the whole process could be repeated for many different sets of input parameters . by eliminating the overhead of running the full hydrodynamical code , we were able to quickly explore a wide range of input parameters and verify that the code operated correctly in each case .",
    "this approach proved especially useful for catching simple bugs during the code development process , particularly those caused by typographical errors in the software , as these were generally present in either the test implementation or the real implementation , but were very unlikely to be present in both .",
    "we also tested the operation of the chemistry and cooling code at a much higher level by performing several sets of simulations of static gas using the full hydrodynamical code .",
    "in the first set of simulations , we artificially disabled the operation of the cooling subroutines and set @xmath202 , so that the gas would remain at its initial temperature .",
    "we then ran a large number of simulations of static gas with different initial temperatures , densities , uv fields and dust - to - gas ratios . in each case , we ran the simulation for @xmath203 , or almost 100  myr , which even at the lowest densities that we examined greatly exceeded the time required for the chemical abundances to reach equilibrium .",
    "we then compared the value of the @xmath0 and @xmath43 abundances produced by the simulation with the predicted equilibrium values , which are easy to compute for a fixed temperature and density . in every case that we examined , we found good agreement between the predicted and the actual values .    in our second set of simulations",
    ", we performed a similar series of tests of the cooling routines : we artificially disabled the chemistry , equivalent to setting @xmath204 in equation  [ chem_eq ] above , and solved for the equilibrium temperature of the gas for various different initial densities , temperatures , uv fields and @xmath0 fractions .",
    "again , the resulting values could be easily compared with the predicted equilibrium values .",
    "good agreement was again found in every case .    finally , we performed a set of simulations without artificial constraints on either the chemical or the cooling terms .",
    "the aim of this set of simulations was to reproduce the phase diagram for interstellar atomic gas calculated by @xcite . to do this , we ran simulations for a wide range of initial densities , but used the same initial temperature , @xmath205 , in each case .",
    "the other free parameters of our simulations were set up to correspond as closely as possible to those used by @xcite in computing their @xmath206 galactrocentric radius model .",
    "specifically , we adopted gas phase carbon and oxygen abundances of @xmath77 and @xmath78 respectively , a cosmic ray ionization rate @xmath207 and an ultraviolet field strength @xmath113 ( or in other words , the standard @xcite field ) .",
    "the phase diagram we obtained is plotted in figure  [ wolfire_test ] .",
    "we also plot the corresponding values from @xcite , taken from their figure  10 .",
    "although our results do not match those of @xcite precisely , the differences are small and almost certainly result from the fact that we do not include as wide a range of physical processes as @xcite ; for instance , they model the chemistry of the gas in far more detail than we are able to , and so their values for the free electron abundance , and hence for the photoelectric heating rate , will be more accurate than ours .",
    "the largest difference occurs at @xmath208 , near the middle of the thermally unstable regime , and even here our computed temperatures differ from those of @xcite by no more than a factor of two .",
    "given the approximations made in our treatment of the chemistry of the ism , we consider this degree of agreement to be acceptable .",
    "since our aim in this paper is to model the transition from atomic to molecular gas , we have chosen to consider relatively small volumes of gas , which we visualize as being small sub - regions within larger , gravitationally collapsing regions , such as those found in the simulations of @xcite or @xcite .",
    "for simplicity , and also to allow us to use an fft - based gravity solver , we take our simulation volumes to be cubical , with periodic boundary conditions on all sides . for most of our simulations , we used boxes of size @xmath209 or @xmath210 , although in a small number of cases , we used other sizes .",
    "the particular size used for each individual simulation is summarized in table  [ static_runs ] .",
    "this table also lists the values adopted for the other main adjustable parameters , discussed in more detail below .",
    "our choice of box size was guided by two major considerations .",
    "the first of these was the fact that as we reduce the size of the box , we increase the stability of the gas with respect to gravitational collapse .",
    "indeed , if we choose to make the box too small , it will contain less than a jeans mass of gas and so the gas will simply not collapse .",
    "the larger that we make the box , the more gas it will contain , and the more representative it will be of a real gravitationally unstable region . on the other hand , by reducing the size of the box , we increase our physical resolution at any given numerical resolution .",
    "this is important since the physical resolution of our simulations determines the extent to which we can follow the gravitational collapse of the gas ( see   [ truelove ] below ) .",
    "obviously , these two considerations conflict , but in choosing our box sizes we have done our best to find an appropriate balance between them .    within the box , we assume that the gas is initially distributed uniformly , with a number density @xmath2 . in the majority of our simulations , we take @xmath211 , as the inferred mean densities of many observed molecular clouds lie near to this value @xcite .",
    "however , we also explore the effects of reducing @xmath2 , examining values as small as @xmath212 ( see   [ static_n0 ] ) . at a density of @xmath213 ,",
    "the atomic gas lies well within the cnm regime @xcite , and so the initial temperature of the gas has essentially no impact on the results of the simulations , as the gas rapidly cools , reaching thermal equilibrium within 0.05  myr . in most of our simulations ,",
    "we therefore use a rather arbitrary initial temperature @xmath205 , but as we demonstrate in   [ static - temp ] , simulations with @xmath214 produce essentially identical results for times @xmath215 .    finally , we note that in all of the simulations described in   [ static_results ] , we start with the gas at rest .",
    "therefore , in order to trigger gravitational collapse in runs performed using the local shielding approximation , it is necessary to introduce small density perturbations to disrupt the symmetry of the initial conditions ( as this would otherwise artificially prevent gravitational collapse from occurring ) .",
    "these perturbations are not required in runs performed using our six - ray approximation , as the pressure - driven flows in these runs serve the same purpose ( see the discussion in   [ role_of_grav ] below ) , but we include them nevertheless . to produce these perturbations , we select for each grid zone a random number @xmath42 in the interval @xmath216 $ ] , and then perturb the density of that zone by a factor of @xmath217 , where @xmath218 is an adjustable parameter . in most of our simulations ,",
    "we set @xmath219 , although in   [ static - box ] we explore the effects of using larger values of @xmath218 .",
    "since there is considerable observational evidence for the presence of dynamically significant magnetic fields in interstellar gas , much of which is discussed in recent reviews by @xcite and @xcite , it is clearly important to take the effects of magnetic fields into account in our simulations . for this reason ,",
    "most of our simulations involve magnetized gas .    for simplicity , in all of our mhd simulations we assumed that the field was initially uniform and oriented parallel to the @xmath220-axis of the simulation .",
    "the strength of the field was a free parameter , and the values used in our various simulations are summarized in table  [ static_runs ] .",
    "observational determinations of the local magnetic field strength give a typical value of @xmath221 g , and so we ensured that our fiducial value for the initial magnetic field strength , @xmath222 was consistent with this value .",
    "the reason for our slightly odd choice of fiducial value is that we wanted to ensure that in each of our simulations the mass - to - flux ratio of the gas would be some simple multiple of the critical value @xcite @xmath223 at which magnetic pressure balances gravity in an isothermal slab . for a gas cloud",
    "in which all of the hydrogen is already fully molecular , @xcite show that the mass - to - flux ratio of the cloud can be written in units of this critical value as @xmath224 where @xmath124 is the @xmath0 column density of the cloud in units of @xmath225 and @xmath226 is the strength of the magnetic field , in units of @xmath227 . for a fully atomic cloud ,",
    "the equivalent expression is @xmath228 where @xmath229 is column density of atomic hydrogen . for a simulation with an initial atomic hydrogen number density of @xmath213 and a box size of @xmath210",
    ", we have @xmath230 , and hence @xmath231 , where @xmath232 is the initial magnetic field strength .",
    "therefore , in our fiducial example in which @xmath233 , we have @xmath234 . observations of magnetic field strengths in molecular cloud cores , summarized in @xcite and @xcite , find a smaller mean value , @xmath235 , although there is significant scatter around this value .",
    "there are also many sight - lines for which there are only upper limits on @xmath226 and hence lower limits on @xmath236 .    in view of the uncertainty in the appropriate value of @xmath236 , we ran a number of simulations using larger values of the initial field strength , as described in ",
    "[ field - init ] , in order to explore the extent to which the @xmath0 formation rate and morphology depend on the field strength . for completeness",
    ", we also ran a few simulations in which we set @xmath237 .",
    "although unrealistic in the sense that we expect all interstellar gas to be magnetized to some extent , setting @xmath237 does serve as a guide to the behaviour of the gas in the more realistic case that @xmath238 is non - zero but is too small to significantly affect the gas dynamics on the scales of interest to us .        as discussed in ",
    "[ box_size ] , one of the important considerations influencing our choice of box size was the desire to be able to accurately follow the gravitational collapse of gas over as large a range of densities as possible .",
    "@xcite showed that in order to properly resolve collapse and avoid artificial fragmentation , it is necessary to resolve the local jeans length of the gas by at least four grid zones .",
    "in other words , collapse is resolved only while @xmath239 where @xmath143 is the width of a single grid zone , and @xmath240 is the jeans length , given by @xmath241 where @xmath242 is the adiabatic sound speed . in figure",
    "[ jeans_length ] , we plot @xmath240 as a function of density for gas which is in thermal and chemical equilibrium , with the effects of self - shielding and dust shielding calculated using our local shielding approximation and assuming a zone size of @xmath243 .",
    "although somewhat simplified , this model gives a fair representation of how we expect the jeans length to evolve with density in a real simulation .",
    "it is clear from the figure that it becomes increasingly difficult to resolve @xmath240 as we move to higher densities , and so the smaller that we can make @xmath143 , the further we will be able to follow the collapse .",
    "now , for a uniform cubical grid , @xmath244 , where @xmath245 is the box size and @xmath42 is the total number of grid zones , so we can make @xmath143 small either by increasing @xmath42 or by decreasing @xmath245 .",
    "since there are practical limits on how large we can make @xmath42 , dictated by the computational resources required to run the simulation , the easiest way to increase our resolution is by decreasing @xmath245 .",
    "however , as noted previously , if we make @xmath245 too small , then the total mass of gas in the box will fall far below the initial jeans mass , and so the gas will be gravitationally stable and will not collapse .    for any given combination of @xmath42 and @xmath245 , we can use figure  [ jeans_length ] to determine the maximum number density , @xmath246 , at which the truelove criterion is still satisfied .",
    "we have computed @xmath246 for a range of different numerical resolutions between @xmath247 and @xmath248 for boxes of size 20 , 40 and 60 pc , and summarize the results in table  [ resn_table ] .",
    "the values of @xmath246 we obtain vary from @xmath249 for a @xmath250 simulation in a 60 pc box to @xmath251 for a @xmath252 simulation in a 20 pc box .",
    "note , however , that these figures are only exact for gas which is in chemical equilibrium ; if the @xmath0 fraction is out of equilibrium , then this will affect the value of @xmath242 , through its dependence on @xmath32 and on the mean molecular mass , and so these numbers will change slightly .      aside from @xmath240 , there are two other important length scales which we would like to resolve : the cooling length , @xmath253 , and the field length , @xmath254 .",
    "a convenient definition of the cooling length is the product of the cooling time with the sound speed of the gas : @xmath255 to properly resolve the thermal state of the flow , particularly features involving strong thermal gradients ( e.g.   shock fronts ) , we must be able to resolve @xmath253 . in figure  [ cool_length ] , we plot @xmath253 as a function of density , calculated assuming temperatures which are @xmath256 ( dotted line ) , @xmath257 ( dashed line ) and @xmath171 ( solid line ) greater than the thermal equilibrium temperature . and",
    "@xmath253 are both formally infinite . ]",
    "it is clear from the figure that the resolution required to resolve the cooling length of the flow is much greater than that required to resolve the jeans length .",
    "this is not unexpected , since @xmath258 , and @xmath259 for the conditions of interest to us .",
    "however , it does mean that we can not reasonably expect to use zeus - mp to resolve the cooling length in gas with a number density @xmath260 , unless the temperature of the gas is extremely close to its equilibrium value , given the range of values that we use for the box size @xmath245 .",
    "nevertheless , we argue that this does not represent a major problem for the simulations presented in this paper , provided that we are careful about the inferences that we draw from them .",
    "the main consequence of failing to resolve @xmath253 is that we overproduce warm gas , particularly in post - shock regions , since the width of any such region is clearly constrained to be at least one grid zone wide .",
    "therefore , any conclusions that we draw about the temperature distribution of the gas should be treated with caution , as we know at the outset that we will have too much warm gas , and therefore too little cool , dense gas .",
    "the effects on the dynamics of the flow are difficult to assess , but it is reasonable to suppose that gravitational collapse is inhibited to some degree .",
    "similarly , it is likely that less @xmath0 is produced than would be produced in a higher resolution simulation , since the @xmath0 formation rate decreases rapidly with temperature for @xmath261 , and also since the artificially warm gas is less dense than it would be if it were able to cool .",
    "the net effect of this is that our simulations produce less dense gas and less @xmath0 within a given timeframe than would be the case if we could resolve @xmath253 .",
    "however , the mass of warm , shocked gas in our simulations is never large and so we do not expect our failure to resolve @xmath253 to significantly affect our conclusions regarding the timescale of @xmath0 formation .",
    "the other length scale of interest is the field length , which is the length scale on which thermal conduction stabilizes the growth of thermally unstable density perturbations , and which is given by @xcite @xmath262 where @xmath263 is the coefficient of thermal conductivity . in figure",
    "[ field_length ] , we plot the value of @xmath254 as a function of density for temperatures that are 1 , 10 and @xmath171 greater than the thermal equilibrium temperature . to compute these values , we used a value of @xmath264 for the coefficient of thermal conductivity of neutral atomic hydrogen , taken from @xcite , and assumed that @xmath263 would be of a similar order of magnitude in fully molecular hydrogen , and in a mixed gas of atoms and molecules . at the temperatures and densities of interest here , thermal conduction by electrons",
    "is unimportant and can be neglected .    in a recent paper ,",
    "@xcite argue that in order to properly resolve the dynamics of gas in a thermally bistable medium , it is necessary to resolve @xmath254 with at least three grid zones in order to obtain converged results .",
    "now , it is clear from figure  [ field_length ] that it is even harder to resolve @xmath254 than it is to resolve @xmath253 and so even if we were to include the effects of thermal conduction in our simulations , we could not realistically hope to resolve its effects .",
    "however , we argue that this does not represent a major problem given the particular scenario that we are investigating .",
    "the reason is that while gas at the densities studied in our simulations may be thermally _ unstable _ to isobaric perturbations if its temperature is greater than the equilibrium temperature , it is not thermally _ bistable _ : it will all cool rapidly to the cold phase , rather than forming a two phase medium .",
    "moreover , although isobaric thermal instability may operate during this initial cooling phase , amplifying density enhancements on scales @xmath265 , where @xmath266 is the maximum length scale for an isobaric perturbation , the final density will be at most a factor @xmath267 larger than the initial density , where @xmath268 is the initial temperature and @xmath269 the equilibrium temperature of the gas , and the resulting density perturbations will not be gravitationally bound .    to see why ,",
    "consider an isobaric density perturbation with an initial size @xmath270 . before its growth",
    ", this perturbation will be unstable to gravitational collapse only if @xmath271 , which will be possible only if @xmath272 , or in other words if @xmath273 .",
    "however , we know that in fact @xmath259 for the temperatures and densities of interest to us , and so the initial perturbation must be gravitationally stable .",
    "now consider the situation once the gas in the perturbation has cooled from @xmath268 to @xmath269 : its density will have increased by a factor of @xmath267 , while its local jeans length will have decreased by the same factor , since @xmath274 . at the same time",
    ", its linear size will only have decreased by a factor of @xmath275 , assuming an approximately spherical perturbation .",
    "clearly , therefore , the perturbation will be less stable against gravitational collapse than it was initially .",
    "however , for it to become unstable , its initial size must satisfy the following inequality @xmath276 and since @xmath270 , this requires that @xmath277 which in turn will only be satisfied if @xmath278 now , for @xmath205 and @xmath279  the values appropriate for fiducial run ms256 , described in ",
    "[ h2_timescale ] below  we have @xmath280 . however , if the initial number density is @xmath213 , as it is in most of our simulations , then @xmath281",
    ". therefore , isobaric perturbations starting with this temperature and density remain gravitationally stable throughout their evolution .",
    "a similar result can be derived for the other combinations of initial temperature and density examined in this paper .",
    "if the overdensities created by the isobaric thermal instability are not gravitationally unstable and therefore do not collapse further once they have reached @xmath269 , then what actually happens to them ?",
    "as the surrounding gas cools towards @xmath269 , the overdense regions will expand in order to stay in pressure equilibrium with the lower density gas , and so their density will fall until ultimately they become indistinguishable from the surrounding gas .",
    "the net effect will therefore simply be the injection of some additional kinetic energy into the gas ( as in @xcite ) .",
    "the magnitude of the kinetic energy input depends on the fraction of the gas processed through overdense regions , but it will never be larger than the initial thermal energy content of the gas . since the main aim of the simulations presented in this paper is to allow us to determine how quickly @xmath0 forms in the _ absence _ of turbulence , neglecting this energy input is probably justified .",
    "before we began the study of @xmath0 formation in turbulent , self - gravitating gas that is described in paper ii , we first spent some time examining the much simpler case of gas that was initially at rest .",
    "the main aim of these runs was to determine how quickly @xmath0 would form in the absence of turbulence (   [ h2_timescale ] ) , the role that gravity plays in driving this process (   [ role_of_grav ] ) and the morphology of the resulting @xmath0 (   [ static_morph ] ) , primarily so that we could later compare these results with the results of the turbulent runs discussed in paper ii .",
    "these runs also act as more comprehensive , albeit less quantifiable , tests of the code than the tests discussed in   [ tests ] ; thanks to the relative simplicity of the dynamics , unphysical behaviour is much easier to spot here than in the turbulent simulations of paper ii .",
    "we also examined the temperature distribution of the gas and how its maximum and minimum temperatures evolve with time (   [ static - temp ] ) , and determined how sensitive our results are to variations in input parameters such as the box size (   [ static - box ] ) , the amplitude of the initial density perturbations (   [ pert - init ] ) , the magnetic field strength (   [ field - init ] ) and the mean density of the gas in the box (   [ static_n0 ] ) . parameters for the runs discussed here are listed in table  [ static_runs ] .      to quantify the rate at which @xmath0 forms in our simulations , there are various quantities that we might choose to examine . one of the simplest is the volume averaged molecular fraction , @xmath282 , which we can calculate simply by summing up the molecular fraction in every grid zone and dividing by the total number of zones , i.e.@xmath283 where @xmath284 represents the molecular fraction in the zone with coordinates @xmath285 and @xmath42 is the total number of zones .",
    "however , although @xmath282 is very easy to calculate , it is of limited use to us , as in an inhomogeneous gas , the volume average will tend to be dominated by low density regions , while much of the actual gas resides in high density regions .",
    "consequently , a more useful quantity to compute is the mass - weighted mean molecular fraction , @xmath286 , which is given by @xmath287 where @xmath288 is the mass density of @xmath0 in zone @xmath285 , @xmath289 is the volume of zone @xmath285 , @xmath290 is the total mass of hydrogen present in the simulation , and where we sum over all grid zones . finally , we might also look at the total mass of @xmath0 in the simulation , @xmath291 .",
    "however , since this can be written in terms of @xmath286 as @xmath292 there is no real benefit to be gained from studying @xmath291 rather than @xmath286 .",
    "to begin our investigation , we first selected a set of parameters that we could treat as a fiducial example of collapse from static initial conditions . our aim here is to discuss the results of this example in some detail , and then to explore the effects of varying each of the main input parameters by focusing on how the results vary compared to this fiducial case . given the large number of simulations that we have run , this strategy seems to us to be more efficient than discussing in detail the results of each individual simulation .    as mentioned previously , the initial density and temperature used for our fiducial runs were @xmath293 and @xmath294 respectively .",
    "a simple calculation shows that with these parameters , the initial jeans length of the gas is @xmath295 , which means that if we want the gas in our simulation to be gravitationally unstable at @xmath296 , we would need to use a simulation volume of size @xmath297 .",
    "however , since the gas in all of our simulations very rapidly cools from @xmath298 to a value close to the equilibrium temperature of the gas , it is actually sufficient to choose a value for @xmath245 that is greater than the value of @xmath240 in the cool gas . in the simulations which we performed using our local approximation to treat photodissociation and photoheating ,",
    "the equilibrium temperature is initially the same throughout the simulation volume , and for @xmath299 has a value @xmath300 . at @xmath301 and @xmath302",
    ", we have @xmath303 for fully atomic gas , and so in these simulations we require @xmath304 . in practice , we would like to ensure that we have multiple jeans masses of material in our simulation volume , and so for our fiducial runs we chose to set @xmath305 . in the simulations performed using the six - ray approximation ,",
    "the equilibrium temperature is no longer the same everywhere , as the amount of dust shielding , and hence the value of the photoelectric heating rate , varies with position within the simulation volume .",
    "however , even the largest initial value of @xmath269 in these simulations is smaller than the initial value of @xmath269 in the runs performed using the local shielding approximation , and so setting @xmath305 again ensures that multiple jeans masses of gas will be present .",
    "the effect of varying @xmath245 is explored in   [ static - box ] .",
    "the other main parameter that we had to specify for our fiducial runs was the strength of the initial magnetic field .",
    "we chose to set @xmath306 , for the reasons discussed in ",
    "[ init_mag ] . for this combination of @xmath226 , @xmath33 and @xmath245 , our initial mass - to - flux ratio ( in units of the critical value ) is @xmath307 .    in figure  [ h2-ms ] , we plot the evolution with time of @xmath286 for our fiducial parameters for six different runs .",
    "runs ms64 , ms128 and ms256 were performed using the local shielding approximation and differ solely in the numerical resolution used in the runs .",
    "runs ms64-rt , ms128-rt and ms256-rt were performed using the six - ray approximation and again differ from each other only in terms of numerical resolution .",
    "it is immediately apparent from figure  [ h2-ms ] that the choice of shielding approximation makes a significant difference in the outcome of these uniform density simulations .",
    "far more @xmath0 is produced at early times in runs which make use of the six - ray approximation than in those using the local shielding approximation .",
    "in the six - ray runs , the @xmath0 fraction grows steadily with time , with the gas becoming approximately 50% molecular after @xmath308 .",
    "the @xmath0 formation rate is independent of the numerical resolution of the simulation until @xmath309 , following which the fastest rate is found in the highest resolution simulation ( although the difference between the three runs is never great ) . in the runs performed using the local shielding approximation , on the other hand , the growth of the @xmath0 fraction quickly stalls , and the value of @xmath286 remains small for at least @xmath310 , particularly in the higher resolution simulations . at @xmath311 , however , @xmath286 suddenly begins to increase rapidly in these runs , and by the end of the simulations , the values of @xmath286 obtained are starting to become comparable with those found in the six - ray runs .",
    "finally , it is clear from figure  [ h2-ms ] that the results that we obtain when using the local shielding approximation are resolution dependent : the higher the resolution of the simulation , the less @xmath0 is produced .",
    "this resolution dependence is a consequence of the fact that in the local shielding approximation , the self - shielding factor @xmath118 and dust extinction @xmath312 depend explicitly on the physical size of the grid zone , @xmath143 , with the result that the equilibrium @xmath0 fraction , @xmath151 , also explicitly depends on the zone size .    in figure  [ dmax - ms - fid ] , we plot the evolution with time of the maximum gas density , @xmath313 , found in each of these six simulations . we again see that the results depend on the choice of shielding approximation : gas in runs performed using the six - ray approximation collapses roughly 510  myr earlier than gas in runs performed using the local shielding approximation .",
    "moreover , the two sets of runs display a different sensitivity to the numerical resolution used : in the six - ray runs , increasing the resolution causes the collapse to occur slightly earlier , while in the other set of runs , increasing the resolution _ delays _ the collapse .",
    "one obvious question to ask is why collapse occurs so much earlier in the six - ray runs than in the runs performed using the local shielding approximation .",
    "the gas temperatures in the former runs are smaller than in the latter ( see   [ static - temp ] below ) , and so the gas is more gravitationally unstable , but the temperature difference is not great and it would be surprising if this were to be responsible .",
    "in fact , the true culprit is something quite different .",
    "when we use the local shielding approximation , the amount of dust shielding , and hence the magnitude of the photoelectric heating rate , is purely a function of the local gas density .",
    "since the gas starts with a nearly uniform density distribution , this means that the heating rate is the same throughout , meaning that the equilibrium gas temperature is also almost the same throughout . in our six - ray runs , on the other hand , this is not the case .",
    "gas near the edges of the simulation volume is shielded less than gas at the centre and so is heated more .",
    "this means that at early times the equilibrium temperature of the gas near the edges is higher than that of the gas in the centre . since the density is still almost the same throughout , this results in the development of a pressure gradient , acting towards the center of the box .",
    "although the resulting flow velocities are small , as figure  [ vmax - fid ] makes clear , they are large enough to create non - linear overdensities within about @xmath308 , which subsequently merge and collapse on the free - fall timescale of @xmath314 . in comparison , the density inhomogeneities present in runs ms64 , ms128 and ms256 at @xmath315 are very much smaller and so gravitational collapse is delayed for a much longer period .",
    "an interesting consequence of this is that @xmath0 formation can actually occur _",
    "faster _ when an ultraviolet field is present then when one is absent , as we show in figure  [ h2uv ] .",
    "of course , this is not a new discovery : what we are seeing is essentially a form of radiation - driven implosion , which is a phenomena that has been discussed by a number of previous authors , albeit primarily in the context of driving by photoionization , rather than by photoelectric heating ( see e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    ".    given the large disparity between the two sets of results , which set of results should we believe ?",
    "in other words , which of the two approximations that we have used does better at capturing the true behaviour of the gas ?",
    "from our discussion in   [ h2_phdis ] we know that the main disadvantages of the six - ray approximation are its lack of angular resolution and its insensitivity to the effects of velocity differences along the line of sight .",
    "however , at early times in these simulations , the gas distribution is nearly uniform and the velocities are small , and so this approximation should give very accurate results .",
    "on the other hand , we know that the local approximation underestimates the true amount of shielding , and from our results here it is apparent that we underestimate the shielding by quite a large factor , enough to significantly alter the outcome of the simulations .",
    "we can therefore conclude that this approximation does not work well for treating @xmath0 photodissociation in this case .",
    "of course , this does not come as a great surprise , as the physical conditions which best motivate the use of a local approximation  large variations in the gas velocity from zone to zone , and significant density inhomogeneities  are not present at early times in these runs . at late times ,",
    "once a substantial density inhomogeneity has developed , the local shielding approximation does a much better job of modelling the photodissociation .",
    "moreover , as we will see in paper ii , the local shielding approximation works far better for treating @xmath0 photodissociation in supersonically turbulent flow than it does here .    as larger density inhomogeneities develop , and in particular as large flow velocities develop , the accuracy of our six - ray approximation degrades .",
    "however , figures  [ dmax - ms - fid ] and [ vmax - fid ] demonstrate that the flow remains subsonic and the density inhomogeneities remain small at @xmath316 , and so the six - ray approximation should remain accurate throughout this period .",
    "moreover , at later times enough @xmath0 is present to provide effective self - shielding for almost all of the gas , and so we would not expect our results at late times to be particularly sensitive to the growing inaccuracy of our approximation .    it is also clear that when we use the six - ray approximation , we do a much better job of modelling the dynamics of the flow , as we recover the large scale pressure gradient that is missed by the local approximation .",
    "it should be noted , however , that one reason that we find so much difference between the dynamics of the two sets of simulations is our choice of initial conditions .",
    "because the gas is initially at rest , any small velocities , such as those produced by the large - scale pressure gradient , are significant and can have a large effect on the outcome . in simulations where the gas does not start at rest ( such as the turbulent models presented in paper ii ) , we would expect to see far less difference in the dynamics .    in view of the higher accuracy of the results from our six - ray runs",
    ", we will focus on these in particular in the remainder of this paper .",
    "however , for the purposes of comparison we include some discussion of results from runs performed using the local shielding approximation    finally , it should be noted that even in the six - ray runs , it takes roughly @xmath308 to form a significant amount of @xmath0 .",
    "this is the most important result of the simulations reported on in this paper , as this timescale is greater than a gravitational free - fall time and is significantly longer than the timescales derived for the turbulent cloud models studied in paper ii .      from the comparison of figures  [ h2-ms ] and [ dmax - ms - fid ] , it is clear that the growth in @xmath286 at late times in runs ms64 , ms128 and ms256 is being driven by the gravitational collapse of the gas : the increase in density caused by the collapse increases both the @xmath0 formation rate and the amount of shielding , allowing @xmath286 to rise rapidly .",
    "similarly , the growth of @xmath286 at late times in the six - ray runs appears to be accelerated by the collapse of the gas .    to confirm this",
    ", we performed a set of runs in which we did not include the effects of self - gravity .",
    "these runs , designated ms64-ng , ms128-ng , ms256-ng and ms256-rt - ng , used the same input parameters as runs ms64 , ms128 , ms256 and ms256-rt respectively .",
    "the evolution of @xmath286 in runs ms256 , ms256-ng , ms256-rt and ms256-rt - ng is shown in figure  [ h2ng ] . at @xmath317 in runs ms256-rt and ms256-rt - ng , and at @xmath318 in runs ms256 and ms256-ng",
    ", the results of the simulations agree , demonstrating that at early times the effects of self - gravity are unimportant .",
    "however , it is also clear that at later times , the simulation results diverge , with gravitational collapse providing a distinct boost to the @xmath0 formation rate in the self - gravitating simulations .",
    "since gravity plays an important role in the outcome of our simulations , it is also natural to investigate how well we are resolving the gravitational collapse of the gas .",
    "specifically , we would like to know at what point the truelove criterion is first violated and how much of the @xmath0 formation that we see in our runs occurs before this point .    using the results of our simulations , it is relatively easy to determine when the truelove criterion is first violated for any given model , and what the value of @xmath286 is at that time .",
    "the values we obtain for each of our runs are summarized in table  [ xh2_at_end_stat ] . in runs",
    "performed using the local shielding approximation , most @xmath0 formation occurs _",
    "after _ the run has violated the truelove criterion . on the other hand , in runs that use the six - ray approximation , the majority of the @xmath0 forms before the truelove criterion is violated .    of course , the fact that we no longer properly resolve gravitational collapse in dense gas once the truelove criterion is violated does not necessarily invalidate all of the subsequent results from our simulations .",
    "for instance , if only a few percent of the total @xmath0 were found in unresolved regions , then the fact that we are no longer able to resolve these regions properly would be likely to have only a minor effect on @xmath286 .",
    "conversely , if most of the @xmath0 were in unresolved regions , then our results for @xmath286 would be trustworthy only up to the point at which the truelove criterion was violated . in order to quantify how much gas and how much @xmath0 ends up in unresolved regions in our simulations , we examined intermediate output dumps of density , internal energy and @xmath0 fraction from each of our fiducial runs , and for each dump determined which zones , if any , were unresolved .",
    "we then computed @xmath319 , the fraction of the total gas mass in resolved regions , and @xmath320 the fraction of the total @xmath0 mass in the same resolved regions , for each output time .",
    "the resulting values of @xmath319 and @xmath320 are plotted in figures  [ fres - ms - fid]a and [ fres - ms - fid]b respectively .",
    "it is clear from these figures that once the truelove criterion is violated , the majority of the gas and of the @xmath0 soon ends up being located in unresolved regions , suggesting that our simulation results are only trustworthy up to this point .",
    "we obtain similar results if we perform the same analysis for any of the other runs in table  [ static_runs ] which violate the truelove criterion .",
    "we should therefore not place too much weight on results coming from very late times in any of these simulations .",
    "nevertheless , it should be clear that these concerns do not affect the basic timescale for @xmath0 formation that we find from our simulations and so do not undermine our main results .      as noted above , even in our highest resolution fiducial simulations ,",
    "most of the gas is located in unresolved regions at the end of the run .",
    "it is therefore not particularly enlightening to examine the morphology of either the gas or the @xmath0 at the end of the run , as both will be inaccurate in ways not easily quantified . moreover , in a real molecular cloud , we would expect star formation to occur rapidly once gas has collapsed to high densities , and since we do not include any feedback in these simulations from effects such as protostellar outflows , our simulations are missing some of the physics necessary to accurately model the morphology at late times .    on the other hand , what we can do with some degree of confidence is to examine the morphology of the gas at a time shortly before the truelove criterion is first violated , when star formation has presumably yet to occur .",
    "the morphology of the cloud at this time depends upon our choice of shielding approximation . in the runs",
    "performed with the six - ray approximation , a thick slab of gas has formed , oriented perpendicularly to the magnetic field .",
    "the density within most of this slab is only slightly elevated over the initial density of the gas , but the thin layer of gas bounding the slab shows a large overdensity .",
    "plots of the gas density in the x - z and x - y planes in run ms256-rt at time @xmath322 are shown in figure  [ den - ms - rt ] .",
    "the gas in this simulation is gravitationally collapsing in a direction parallel to the magnetic field lines , with the result that shortly after the time of this output dump , the two large overdensities merge as the gas forms a thin dense sheet located at @xmath323 ( see figure  [ den - post - collapse ] ) .",
    "it is reasonable to expect that this sheet would then fragment into a number of filaments and cores @xcite , but by this point in our simulation , the sheet itself was unresolved and so we were unable to follow the further dynamical evolution of the simulated cloud .",
    "the morphology of the gas in run ms256 at an output time shortly before the truelove criterion is violated is also sheet - like , as we can see from figure  [ den - ms - fid ] .",
    "however , the width of the sheet in run ms256 is much smaller , and the density cross - section is rather different , with the maximum density being found at the midplane , rather than at the top and bottom edges .",
    "as we have already discussed , these differences stem from the differing dynamics of the flow : in this run , photoelectric heating by the ultraviolet background is initially uniform , and so there is no large scale temperature or pressure gradient . the fact that in both runs gravitational collapse produces a sheet - like structure is a consequence of the presence of the magnetic field , which strongly suppresses gas flow perpendicular to the field , but which does not affect flow in the @xmath220 direction , parallel to the field .",
    "the spatial distribution of @xmath0 in these simulations is also of interest . in figure  [ h2-slice - rt ]",
    "we show how the @xmath0 fraction varies with position in run ms256-rt .",
    "figure  [ h2-slice ] gives the corresponding results for run ms256 . in both runs",
    ", there is an obvious correlation between the gas density and the @xmath0 fraction , with the largest molecular fractions being found in the densest gas .",
    "however , this correlation is much stronger in run ms256 than in run ms256-rt , because in the former run , the amount of shielding is purely a function of the local gas density , so @xmath0 both forms faster and is photodissociated more slowly in denser gas . in run ms256-rt , the correlation between local gas density and photodissociation rate is much weaker ( although not completely absent ) .    to better quantify the relationship between gas density and @xmath0 fraction",
    ", we examined how the mean @xmath0 fraction varied as a function of @xmath33 in each simulation . to do this",
    ", we computed @xmath38 and @xmath33 for each grid zone , and then binned the data by number density , using bins of width 0.05 dex .",
    "we then computed the mean and standard deviation for @xmath38 for each bin .",
    "the resulting values are plotted is figure  [ xh2vn - rt]a for run ms256-rt and figure  [ xh2vn - rt]b for run ms256 .",
    "although the mean values that we compute here are volume weighted , we would not expect the mass weighted values to differ greatly , since the narrow width of our density bins means that there is little variation in the gas mass from zone to zone within a given bin .",
    "an immediately obvious feature of figure  [ xh2vn - rt]a is the discontinuity at @xmath301 .",
    "this feature is a result of the fact that some of the @xmath0 that forms in the overdense regions bounding the collapsing slab is left behind by the collapse , and so finds itself ultimately in a region with @xmath324 . in other words ,",
    "most of the gas at @xmath324 did not form in situ , but instead formed at higher densities and has been transported to lower densities . on the other hand , gas with @xmath325",
    "resides in the dense slab , and much of this gas has yet to be greatly affected by the collapse ( as is apparent from figure  [ h2-slice - rt ] ) .",
    "we do not see a comparable feature in figure  [ xh2vn - rt]b .",
    "this is not unexpected , as the dynamics of the flow are quite different in this case , with collapse happening far more slowly .",
    "moreover , the local shielding approximation used in run ms256 leads naturally to a tight relationship between density and @xmath0 fraction at low densities , as the gas is close to photodissociation equilibrium .",
    "this can be seen clearly in figure  [ xh2vn - rt]b if one compare the simulation results with the curve indicating how @xmath151 varies with density .",
    "the latter curve was constructed by first computing @xmath151 for each grid zone ( assuming shielding to be described by our local shielding approximation ) and then binning and averaging these values using the same procedure as for @xmath38 .",
    "note that in run ms256-rt we expect @xmath151 to vary with both density _ and _ with position within the simulation volume , and so we have not constructed a similar curve for this run .",
    "it is also of interest to ask how the @xmath0 _ mass _ is distributed as a function of density .",
    "the plots given above show how the @xmath0 _ fraction _ varies with density , but contain no information on how much gas is to be found at any given density .",
    "this information is given by the mass - weighted density probability distribution function ( pdf ) , which we have plotted for runs ms256-rt and ms256 in figures  [ den - pdf]a and [ den - pdf]b respectively .",
    "figure  [ den - pdf ] demonstrates that in both runs , much of the gas remains close to the initial density . in run",
    "ms256-rt there is also a substantial amount of gas at @xmath326 , corresponding to gas associated with the overdensities bounding the collapsing slab . in run ms256 , this feature is absent , but there is nevertheless a high density tail , extending up to @xmath327 . in run",
    "ms256-rt , about 30% of the total @xmath0 mass is associated with the relatively unperturbed gas within the slab , with the other 70% being associated with the overdense , collapsing gas ( see figure  [ cuml - h2 ] ) . on the other hand , in run ms256 ,",
    "most of the @xmath0 is located at densities close to the initial gas density ; indeed , only half of the total amount of @xmath0 is found at @xmath325 .    however , as the gas continues to gravitationally collapse , we expect both the pdf and the cumulative mass distribution of @xmath0 to alter greatly , as we know already that most of the mass and most of the @xmath0 will ultimately be located in dense , unresolved gas .",
    "this is borne out by the results from the end of the simulations which are also plotted in figures  [ den - pdf ] and [ cuml - h2 ] for runs ms256-rt and ms256 .",
    "as we have previously noted , the cooling time of the gas in our simulations is much shorter than the dynamical timescale .",
    "therefore , the gas very quickly cools to the thermal equilibrium temperature ( which for a gas density of @xmath213 is approximately @xmath328 , if we use our local shielding approximation ) regardless of the initial temperature of the cloud .",
    "this is clearly illustrated in figure  [ t - ms - fid ] , where we plot the evolution with time of the minimum and maximum gas temperatures @xmath329 and @xmath330 in run ms256 ( which has an initial gas temperature @xmath205 ) and run ms256-t100 ( which has @xmath331 but is otherwise identical to run ms256 ) .",
    "following an initial period of cooling that lasts for approximately @xmath332 , the behaviour of the two runs becomes essentially identical .",
    "we see a similarly rapid initial phase of cooling in runs performed using the six - ray shielding approximation .    in run",
    "ms256 , the temperature distribution following the initial cooling phase is almost uniform , and remains so until the runaway gravitational collapse of the gas begins at @xmath333 . on the other hand , in run",
    "ms256-rt we see that even at early times there is a temperature difference of approximately 20  k between @xmath329 and @xmath330 .",
    "this temperature differential is a result of the fact that gas at the center of the box is more shielded from photoelectric heating than gas at the edge , and , as we have already discussed , this gives rise to a pressure gradient that drives the subsequent gas flow .    in both runs ,",
    "we find tight correlations between the gas density and the temperature , as we demonstrate in figure  [ tvn - ms - fid ] . in run",
    "ms256-rt , we see that there is a discontinuity at @xmath334 .",
    "gas at densities @xmath325 is located within the collapsing slab , and so is shielded from the ultraviolet background by the gas in the overdense regions that bound the slab . on the other hand , gas at @xmath335 is located either above or below the slab and so only receives the benefit of this shielding in one direction . since the contribution from the lightly shielded direction dominates , the result is that the photoelectric heating rate is considerably higher in this gas than in the dense gas in the slab , and so consequently @xmath269 is also higher .",
    "no comparable effect is seen in run ms256 , as this is a consequence of the non - local nature of the dust shielding and so is not captured by the local shielding approximation .",
    "we have also examined whether one can usefully describe the behaviour of gas in these simulations using a polytropic equation of state . in other words , if we write the gas pressure as a polynomial function of density : @xmath336 then what functional form must @xmath337 have if this relation is to accurately describe the gas ? if @xmath337 is a constant , independent of the density , then the gas is a simple polytrope . even if @xmath337 is not constant",
    ", however , this description can be useful provided that @xmath337 varies smoothly and simply with @xmath16 .    to investigate how @xmath337 varies as a function of density at late times in each run , we computed the thermal pressure @xmath18 for each grid zone and then binned the data with density just as we did for the temperature above .",
    "we then used the resulting curve , together with the fact that @xmath338 to compute @xmath337 as a function of density .",
    "the values we obtained for runs ms256-rt and ms256 are plotted in figures  [ gamma - ms]a and [ gamma - ms]b respectively .",
    "figure  [ gamma - ms]a demonstrates clearly that the gas in run ms256-rt is not well described by a polytropic equation of state .",
    "the prominent feature at @xmath339 is a consequence of the discontinuity in the temperature curve at this density and should perhaps be disregarded ( since one might still hope to use a polytropic description for the gas within and without the slab , even if the polytropic index for one differs from that for the other ) .",
    "however , from the figure it is clear that even at densities @xmath340 and @xmath341 a polytropic equation of state is not really appropriate , as there is considerable variation in @xmath337 with @xmath33 .",
    "nevertheless , it is clear that the equation of state of the gas is softer than isothermal , considerably so at low densities .    in run",
    "ms256 , the polytropic approximation fares much better .",
    "although the gas is not a polytrope , since @xmath337 varies with density , the rate of change of @xmath337 is typically small . for the range of gas densities covered by our simulations , @xmath342@xmath343 , and",
    "so for many applications , treating the gas as a simple polytrope with a constant polytropic exponent that is within this range of values may be a reasonable approximation .",
    "we hypothesize that the polytropic description does much better in this case because when we use the local shielding approximation , all of the heating and cooling terms in the energy equation become smooth functions of density .",
    "this is not the case in the six - ray runs , as the non - local shielding disrupts the simple relationship between density and photoelectric heating rate .",
    "it is also interesting to examine how the values of @xmath337 derived here compare with previous suggestions in the literature .",
    "our values are significantly smaller than those derived by @xcite from their numerical models of solar metallicity gas with this range of densities .",
    "however , the values found in run ms256 are only slightly smaller than the value of @xmath344 derived by @xcite from a synthesis of a variety of observational and theoretical sources . in run",
    "ms256-rt , the value of @xmath337 at low densities is considerably smaller still , but at higher densities there is better agreement .",
    "nevertheless , it is important to bear in mind that our treatment of the gas chemistry remains highly approximate , and that this , plus the crude nature of our shielding approximations , will limit the accuracy with which we can model the gas temperature .",
    "it is therefore unclear how seriously we should take the differences between our results and those of @xcite or @xcite",
    ". it would be interesting to revisit this point in the future with simulations that include far more of the relevant carbon and oxygen chemistry and a better treatment of the photoelectric heating .",
    "finally , we have investigated how the current uncertainty in the value of the cosmic ray ionization rate , discussed previously in ",
    "[ chem_sec ] , affects the temperature evolution of the gas in our simulations . to do this",
    ", we performed a run , designated ms256-cr , with the same input parameters as run ms256 , but taking a large value of @xmath345 for the cosmic ray ionization rate .",
    "this value lies at the high end of current determinations ( see e.g. * ? ? ? * ) and so this run and run ms256 should bracket the true behaviour .",
    "we compare the evolution of @xmath329 and @xmath330 in these two runs in figure  [ t - ms - cr ] .",
    "we see from the figure that prior to the onset of runaway gravitational collapse , the effect of the higher cosmic ray ionization rate is to increase both @xmath329 and @xmath330 by about 20  k. however , once collapse begins , the difference between the runs is quickly erased .",
    "the higher temperatures resulting from the higher ionization rate have some influence on the @xmath0 formation rate . at early times",
    ", the net effect is small : the higher gas temperature leads to a slightly higher rate coefficient for @xmath0 formation , and so to a higher @xmath0 abundance , but the difference is at the level of about 10% . at late times , once gravitational collapse is well underway , the numbers reported in table  [ xh2_at_end_stat ] suggest a rather more substantial difference between the runs . however , most of this difference is illusory , and is a consequence of the fact that the higher temperature of the gas in run ms256-cr is matched by a higher jeans mass , allowing us to resolve the collapse for about 0.5  myr longer .",
    "we therefore resolve more of the @xmath0 formation that occurs during this run .",
    "we also briefly investigated the effects of using a higher value of @xmath108 in combination with our six - ray approximation .",
    "however , low resolution test runs suggested that the differences were no larger than the differences between runs ms256 and ms256-cr , so we did not pursue this line of investigation further .",
    "having explored in some detail the formation and distribution of @xmath0 in our standard runs , and the thermal behaviour of the gas , it is now time to turn our attention to examining what happens when our input parameters are varied from their standard values",
    ". therefore , in   [ static - box][static_n0 ] below , we examine the effects of varying the box size @xmath245 , the initial perturbation amplitude @xmath218 , the initial magnetic field strength @xmath232 and the initial density @xmath2 , while holding the other parameters constant .      by varying the size of the box while keeping the density of gas within it fixed",
    ", we can alter the number of jeans masses of gas which the box contains and so make the gas either more stable against gravitational collapse ( if we decrease @xmath245 ) or less stable against collapse ( if we increase @xmath245 ) . if the results of our fiducial simulations are to be considered to be properly representative of the behaviour of real gas , then we should ensure that they are insensitive to small changes in @xmath245 .",
    "we therefore performed several additional simulations with our standard set of input parameters , but using different values for @xmath245 .",
    "specifically , we performed four additional @xmath346 runs using the local shielding approximation , with @xmath347 , 30 , 50 and @xmath348 respectively , and two additional runs using the six - ray approximation , with @xmath347 and @xmath348 respectively .",
    "the results of these runs are plotted in figure  [ ms - box ] , along with the results from runs ms256 and ms256-rt for comparison .",
    "we see that in the runs using the local shielding approximation , increasing @xmath245 at fixed numerical resolution increases the value of @xmath286 at all times .",
    "this is easy to understand as in these runs , the amount of shielding is proportional to the grid zone size @xmath143 , and if we increase @xmath245 while keeping the numerical resolution fixed , then we increase @xmath143 .",
    "it is also apparent that in these runs the rapid increase in @xmath286 that is caused by the runaway collapse of the gas occurs earlier in runs with a larger value of @xmath245 .",
    "figure  [ ms - box]b demonstrates that this is because runaway gravitational collapse occurs at progressively earlier times as @xmath245 is increased and at later times as @xmath245 is decreased .",
    "this is a straightforward consequence of the presence of an increased number of jeans masses in the larger simulations compared to the smaller ones .",
    "however , it should be noted that the changes to @xmath245 change the collapse time of the gas by no more than 20% .",
    "therefore , while magnetic and thermal pressure are clearly playing some role in retarding the collapse of the gas in our fiducial simulations , the effect is not so large as to render the results of these runs unrepresentative of the general case , particularly given the level of approximation to which we are working .    in the runs using the six - ray approximation",
    ", we see much less sensitivity to the box size , which again is not unexpected , given that the shielding in these runs is not directly dependent on @xmath143 . the main effect that is apparent",
    "is that @xmath0 forms slightly more efficiently at early times and considerably more efficiently at late times in runs with a smaller @xmath245 .",
    "this appears to be a consequence of the pressure - driven dynamics of the flow , which we have already discussed in some detail in previous sections . in runs with a smaller @xmath245",
    "it takes less time for the overdense gas layers to propagate to the center of the box , and so therefore it also takes less time for the gas to reach a state of runaway gravitational collapse , as can be seen clearly in figure  [ ms - box]b .",
    "the more rapid density evolution in runs with smaller @xmath245 leads to a more rapid growth of @xmath0 .",
    "nevertheless , the difference between the runs remains relatively small , suggesting again that our fiducial simulation is adequately representative of the general case .",
    "since we use periodic boundary conditions in our simulations , a perfectly uniform distribution of gas will be in dynamical equilibrium ( albeit an unstable equilibrium on scales larger than the jeans length ) and so will not collapse . to provoke collapse ,",
    "it is necessary to perturb the distribution . in our simulations of turbulent gas ,",
    "described in paper ii , large perturbations are rapidly created by the motion of the gas . similarly , in the runs described here which used the six - ray shielding approximation , the pressure gradient caused by the non - uniform photoelectric heating drives a flow that creates density perturbations large enough to trigger gravitational collapse . however , in the runs we performed that used the local shielding approximation , it was necessary to add some form of initial perturbation by hand",
    ". our technique for doing so has already been described , but it is important to understand to what extent our results depend on our choice of @xmath218 , the maximum amplitude of the initial random perturbations .",
    "specifically , we would like to know whether the long delay before runaway gravitational collapse begins in earnest in our simulations is a consequence of our choice of a small value for @xmath218 .",
    "therefore , we have run several simulations in which we have varied @xmath218 while keeping the other parameters fixed at their fiducial values .",
    "the growth of @xmath286 with time in @xmath346 zone runs with @xmath349 , 0.5 and 1.00 , as well as in run ms256 is shown in figure  [ h2-ms - d ] . clearly , increasing @xmath218 does decrease the time that elapses before runaway collapse occurs , as",
    "can also be seen from the results summarized in table  [ xh2_at_end_stat ] .",
    "nevertheless , the time required to form significant quantities of @xmath0 remains long even in the @xmath350 case , and while we could reduce the timescale even further by considering even larger inhomogeneities , at this point we would essentially be considering a collection of smaller , denser clouds , rather than a single cloud with a well - defined initial density .",
    "therefore , although the timescale for collapse in these runs does depend on the initial density structure of our cloud , we can nevertheless be certain that it is of the order of 20 myr or more for an approximately uniform cloud initially at rest .",
    "we also investigated the sensitivity of runs that use our six - ray approximation to variations in @xmath218 , since these runs are also seeded with small perturbations to the initially uniform density . as expected , these runs show essentially no sensitivity to @xmath218 : the aforementioned pressure - driven effects dominate .      in order to explore how our results depend on the strength of the initial magnetic field",
    ", we performed several sets of runs in which we varied the strength of the field but kept all of the other input parameters the same as in our fiducial runs .",
    "specifically , we performed two additional runs using the six - ray shielding approximation : one with an initial field strength @xmath351 , corresponding to a mass - to - flux ratio of two , in units of the critical value , and one with a field strength of zero , i.e.  a purely hydrodynamical run . the evolution with time of @xmath286 in these runs is plotted in figure  [ h2-ms - mag - comp]a , along with the corresponding values from run ms256-rt .",
    "we see that at @xmath352 , the @xmath0 fraction rises more rapidly in our hydrodynamical run than in our mhd runs , and also that the behaviour of the latter runs is essentially indistinguishable .",
    "figure  [ h2-ms - mag - comp]b , which shows the evolution with time of @xmath313 in these three runs , demonstrates that difference in behaviour between the run with @xmath353 and the runs with @xmath354 is caused by the fact that gravitational collapse occurs more rapidly in the former run than in the latter runs .",
    "this is a simple consequence of the fact that in the absence of the magnetic field , gas can flow freely in every direction , allowing the cloud to collapse along all three of its axes at once , while when a magnetic field is present , the gas flow is channeled primarily along the field lines , leading to collapse along only one axis .",
    "this also explains why our results are not particularly sensitive to the strength of the field , when one is present , as this will have no effect on the velocity of the flow parallel to the field lines .",
    "we also examined the sensitivity of the results from the local shielding approximation simulations to the value of @xmath232 , using values of 0.0 , @xmath355 and @xmath356 , and found very similar results : collapse occurs faster and @xmath0 forms more quickly in the complete absence of a magnetic field , but if a field is present then the timescales for either are not very sensitive to its strength .",
    "a final interesting topic to examine is the sensitivity of our results to the initial density of the gas .",
    "for instance , if we reduce the initial number density @xmath2 from its fiducial value of @xmath213 , which is on the high side for the cnm , to @xmath357 or @xmath212 , what effect will this have on the timescale for @xmath0 formation ? obviously",
    ", if we reduced @xmath2 but kept @xmath245 constant , then we would reduce the amount of gas in our simulation volume and thereby alter how well the gas could resist gravitational collapse , just as we did when we reduced @xmath245 while keeping @xmath2 constant .",
    "therefore , to examine the effect of changing the density without significantly affecting the gravitational stability of the gas , we must increase @xmath245 at the same time that we decrease @xmath2 . similarly ,",
    "if we decrease @xmath2 and increase @xmath245 , we must also alter @xmath232 if we wish to keep the mass - to - flux ratio constant , and hence ensure that the field can not completely prevent the gas from collapsing .",
    "we therefore performed three simulations with lower initial densities than in our fiducial simulations . in run ms256-rt - n10 , we set @xmath358 and used our six - ray shielding approximation . in runs ms256-n10 and ms256-n30 , we set @xmath359 and @xmath357 respectively , and used our local shielding approximation . in all three cases , the box size and magnetic field strength were adjusted so as to keep the number of jeans masses in the simulation volume and the mass - to - flux ratio approximately the same as in our fiducial runs ( see table  [ static_runs ] for the values used ) .",
    "the evolution of @xmath286 in these simulations , as well as in runs ms256 and ms256-rt for comparison , is plotted in figure  [ ms - n0-comp]a . in figure  [ ms - n0-comp]b",
    ", we show a similar plot for @xmath313    comparison of the evolution of @xmath286 in the various runs ( see figure  [ ms - n0-comp]a ) demonstrates that the reduction in @xmath2 has a huge effect on the evolution of @xmath286 at early times in runs performed using the local shielding approximation .",
    "this is a consequence of the dramatic reduction in @xmath151 in these runs , which decreases from @xmath360 in run ms256 to @xmath361 in run ms256-n30 and to @xmath362 in run ms256-n10 .",
    "substantial quantities of @xmath0 are produced in run ms256-n30 only once the gravitational collapse of the gas is well underway and the density in the collapsing gas has become high enough to allow for effective self - shielding on small scales .",
    "since the reduction in @xmath2 from @xmath213 to @xmath357 more than doubles the time required for the gas to collapse , this means that we do not see significant @xmath0 formation before @xmath363 . in run ms256-n10 ,",
    "substantial quantities of @xmath0 are never produced , even after 100  myr ( although we suspect that if we were to run the simulation for considerably longer , we would see significant @xmath0 formation , as the gas in this run has only just begun to collapse at the point when the simulation is ended ) .    in run ms256-rt - n10 ,",
    "the effect of the reduced density is less pronounced , but is significant nonetheless .",
    "the reduction of @xmath2 by an order of magnitude leads to a reduction in @xmath286 by roughly a factor of seven at early times .",
    "the reduction in @xmath2 again leads to an increase in the time required for gravitational collapse to occur , and the gas in run mt256-rt - n10 does not become dominated by @xmath0 until collapse occurs at @xmath364 .    in practice , of course , we do not expect the gravitational collapse of gas clouds with mean densities of 10 or @xmath357 to take quite as long as these simulations suggest , as the use of periodic boundary conditions to treat real clouds with these densities , and with the sizes considered here , is unlikely to be a good approximation ",
    "there is simply too much inhomogeneity in the ism on these scales .",
    "nevertheless , even if we were to disable the periodic boundary conditions and to treat the gas as an isolated cloud in free - fall collapse ( i.e.  if we could ignore its thermal and magnetic energy content ) , then we would still expect gravitational collapse , together with the associated @xmath0 formation , to occur on a timescale of the order of 10  myr or more .",
    "we show in paper ii that the results of turbulent simulations with the same mean density are dramatically different .",
    "in this paper , we have discussed in detail how we have modified the zeus - mp hydrodynamical code to allow us to simulate the formation and destruction of @xmath0 in the ism .",
    "we have used two different approaches for modeling the shielding of @xmath0 against photodissociation .",
    "the first of these is a local shielding approximation , novel to this work , which is computationally efficient and which has the advantage of being biased in a known way : it will always underestimate the amount of shielding , and so we will overestimate the photodissociation rate of @xmath0 . the second approach that we have used",
    "is our so - called six - ray approximation , in which we compute @xmath0 and dust column densities only along the three coordinate axes of the simulation volume .",
    "this approach is similar to one used previously by @xcite and by @xcite , but we believe that this is the first time that it has been applied in grid - based simulations of this scale .",
    "this approximation does a much better job of capturing the shielding due to dust , but will tend to overestimate the amount of @xmath0 self - shielding once the flow velocities become supersonic . for the simulations",
    "presented in this paper , it proves to be the better choice , but for the simulations of turbulent gas presented in paper ii , the local shielding approximation proves to be more useful .",
    "our modifications to zeus - mp also include a detailed treatment of the thermal behaviour of the gas . by computing the effects of the most important heating and cooling processes active in the ism ,",
    "we are able to follow the thermal evolution of the gas with far more accuracy than if we relied upon a description in terms of a simple equation of state , whether isothermal or polytropic . in dense gas ,",
    "our accuracy is limited by our inability to fully resolve the cooling length of the gas , with the result that we will tend to overproduce warm gas .",
    "however , the impact of this on the simulations presented in this paper appears to be small .    in ",
    "[ tests ] , we discussed how the modified code was tested , and presented the results of a test designed to reproduce the @xcite analysis of the thermal equilibrium state of the neutral atomic ism . although we do not reproduce their results exactly  most likely due to the fact that the chemical network used in our simulations is very much simpler than that adopted in their analysis ",
    "we do find qualitatively similar behaviour .",
    "moreover , a quantitative comparison of the two sets of results suggests that at most densities , our value for the equilibrium gas temperature is accurate to within 50% or better ; only for gas at densities @xmath208 , which lies in the middle of the thermally unstable regime , do we find larger errors , and even here we are accurate to within a factor of two .",
    "although our main goal in making these modifications was to study @xmath0 formation in turbulent gas ( with results that we report on in paper ii ) , we also applied our modified hydrodynamical code to the problem of @xmath0 formation in gravitationally collapsing gas without turbulence , starting from initial conditions in which the gas was smoothly distributed and initially at rest .",
    "we showed that with these initial conditions and an assumed mean density @xmath299 , gravitational collapse occurs on a timescale @xmath365 .",
    "the precise value of @xmath366 depends on our choice of shielding approximation ( as this significantly affects the pressure balance of the gas ) , and is also sensitive to the size of the simulation volume , the strength of the magnetic field , and in some circumstances to the size of the initial density inhomogeneities .",
    "our use of periodic boundary conditions probably artificially stabilizes the gas to some extent , but even if these were not used , we would still expect collapse to take _ at least _ one free - fall time ( which for our standard initial density @xmath2 is approximately @xmath367 ) , and in fact probably significantly longer , since the thermal pressure of the gas is never negligible .    in the simulations that we ran",
    "that used the local shielding approximation , we found that @xmath0 formation occurred in two phases . during the first phase , which had a timescale of 5@xmath308 ,",
    "@xmath286 grew slowly until it reached a small limiting value , set by the fact that the gas had reached photodissociation equilibrium .",
    "owing to our approximate treatment of @xmath0 shielding , this limiting value was resolution dependent ( and was smaller in higher resolution simulations ) , but even in our lowest resolution , @xmath250 zone simulations , it corresponded to no more than about 25% of the gas being molecular . the second",
    ", rapid phase of @xmath0 formation was triggered by the runaway gravitational collapse of the gas , as the increased density boosted the @xmath0 formation rate while also increasing the amount of shielding against uv photodissociation . by the end of the simulations , between 50 and 100% of the gas",
    "had become molecular , with most of the @xmath0 having being formed during this collapse phase .",
    "therefore , in these simulations , gravitational collapse drives @xmath0 formation .    in the simulations that we ran that used the six - ray approximation ,",
    "the situation was somewhat different . in these runs ,",
    "the amount of shielding in most of the box was considerably higher , and so the gas generally did not reach photodissociation equilibrium until very late times .",
    "therefore , in these runs @xmath0 formation was reasonably efficient even in the absence of dynamical effects .",
    "however , we have seen that in these runs the fact that the gas in the center is shielded more than the gas at the edges leads to the development of a significant temperature gradient and associated pressure gradient .",
    "this drives a flow of gas towards the center of the box , and the presence of a dynamically significant magnetic field causes this flow to be oriented in a direction parallel to the magnetic field lines .",
    "the resulting pressure - driven compression is ultimately responsible for triggering runaway gravitational collapse .",
    "once this runaway collapse begins , we see a distinct acceleration in the rate of @xmath0 formation , and so even in these simulations it is true to say that gravitational collapse plays an important role in driving @xmath0 formation .",
    "these results should be compared with the results from simulations of supersonically turbulent gas that we present in paper ii .",
    "they demonstrate that once a sufficiently high mean density is reached , whether through gravitational instability or other means , the turbulent compressions alone lead to substantial @xmath0 formation , with gravitational collapse subsequently playing only a minor role .",
    "we have also examined the spatial distribution of the @xmath0 produced in our simulations .",
    "we have shown that by the end of the simulation , most of the @xmath0 is to be found in dense gas , with at least 50% in gas denser than @xmath368 . moreover , since the initial distributions of the gas and the magnetic field are nearly uniform , and since the subsequent dynamical evolution proceeds smoothly , the final spatial distribution is highly ordered .",
    "most of the @xmath0 , and , indeed , most of the gas , are found in a thin , dense sheet oriented perpendicularly to the direction of the magnetic field . visually , this distribution looks quite unlike that of the molecular gas in real molecular clouds , suggesting that more small - scale power is required in either the initial density distribution or velocity distribution ( or both ) in order to produce realistic - looking clouds .",
    "finally , we briefly examined the thermal behaviour of gas in our simulations , and showed that , as expected , most of the gas is in thermal equilibrium , owing to the short cooling times at the simulated gas densities .",
    "however , the gas is _ not _ isothermal , nor is it describable as a simple polytrope : while we can describe the relationship between density and temperature with a function of the form @xmath369 the polytropic exponent @xmath32 is not constant , but varies with density as shown in figure  [ gamma - ms ] . in runs",
    "performed using the local shielding approximation , @xmath342@xmath343 over the range of densities covered by our simulations , but in runs that used the six - ray approximation , we found a much wider range of @xmath337 . we conclude that while there may be some applications for which treating the gas as a simple polytrope with a constant polytropic exponent is a reasonable approximation , this approach is probably not valid in the general case .",
    "obviously , we do not claim that the results of the study presented in this paper are directly applicable to the real ism : we have investigated a rather simplified dynamical situation , which is missing one of the main physical ingredients present in the real ism , namely supersonic turbulence .",
    "however , we believe that this study is interesting for the light it sheds on the rate at which molecular clouds will form in the absence of turbulence : as we have seen , in this case substantial quantities of @xmath0 are formed only on timescales @xmath370 , consistent with a cloud formation timescale of at least 5@xmath308 . as we shall see in paper ii",
    ", the behaviour of supersonically turbulent gas is very different .",
    "the authors would like to thank the anonymous referee for suggesting the use of the six - ray shielding approximation , and for a number of other comments that have helped us to improve the presentation of this paper .",
    "they would also like to acknowledge valuable discussions on various aspects of this work with j.  black , r.  garrod , r.  klessen , c.  lintott , h.  liszt , j.  niemeyer , a.  rosen , w.  schmidt and m.  smith .",
    "comments by f.  shu , r.  klein , and others at a meeting of the berkeley - santa cruz - ames star formation center first inspired this work .",
    "the simulations discussed in this paper were performed on the parallel computing facility of the amnh and on an ultrasparc iii cluster generously donated to the amnh by sun microsystems .",
    "we would like to thank t.  grant , d.  harris , s.  singh , and , in particular , j.  ouellette for their invaluable technical assistance at various points during the simulation runs .",
    "financial support for this work was provided by nasa grant nag5 - 13028 and nsf grant ast-0307793 .",
    "fiedler , r.  a. 1997 , in proceedings of the 1997 acm / ieee conference on supercomputing , conference on high performance networking and computing , ( new york : acm press ) , 1 , http://doi.acm.org/10.1145/509593.509598                                                                                                                                                                                              lc 1 .",
    "@xmath371 & @xcite + & + 2 .",
    "@xmath372 & @xcite ( low density ) , + & @xcite ( high density ) + & + 3 .",
    "@xmath373 & @xcite ( low density ) , + & @xcite ( high density ) + & + 4 .",
    "@xmath374 & see   [ h2_phdis ] + & + 5 .",
    "@xmath375 & see   [ chem_sec ] + & + 6 .",
    "@xmath376 & @xcite + & + 7 .",
    "@xmath377 & @xcite + & + 8 .",
    "@xmath378 & @xcite + & +    ll & + fine structure lines & atomic data  @xcite + & collisional rates ( @xmath0 )",
    " @xcite + & collisional rates ( @xmath105 , @xmath168 ) ",
    "@xcite + & collisional rates ( @xmath105 , @xmath169 )  @xcite + & collisional rates ( @xmath379 )  @xcite + fine structure lines & atomic data",
    " @xcite + & collisional rates ( @xmath105 , @xmath0 )  flower , priv .",
    "comm .   + & collisional rates ( @xmath379 ) ",
    "@xcite + & collisional rates ( @xmath43 )  @xcite + fine structure lines & atomic data  @xcite + & collisional rates ( @xmath105 )",
    " @xcite + & collisional rates ( @xmath379 ) ",
    "@xcite + @xmath0 rovibrational lines & @xcite + gas - grain energy transfer@xmath380 & @xcite + recombination on grains & @xcite + atomic resonance lines & @xcite + @xmath105 collisional ionization & @xcite + @xmath0 collisional dissociation & see table  [ chem_model ] + & + * heating : * & + photoelectric effect & @xcite + @xmath0 photodissociation & @xcite + uv pumping of @xmath0 & @xcite + @xmath0 formation on dust grains & @xcite + cosmic ray ionization & @xcite +    cccc & 20 & 0.31 & @xmath381 + @xmath250 & 40 & 0.62 & @xmath382 + & 60 & 0.94 & @xmath383 + & 20 & 0.16 & @xmath384 + @xmath385 & 40 & 0.31 & @xmath381 + & 60 & 0.47 & @xmath386 + & 20 & 0.078 & @xmath387 + @xmath346 & 40 & 0.16 & @xmath384 + & 60 & 0.23 & @xmath388 + & 20 & 0.039 & @xmath389 + @xmath252 & 40 & 0.078 & @xmath387 + & 60 & 0.12 & @xmath390 +    ccccccc ms64 & 40 & 0.05 & 100 & 1000 & 5.85 + ms128 & 40 & 0.05 & 100 & 1000 & 5.85 + ms256 & 40 & 0.05 & 100 & 1000 & 5.85 + ms64-rt & 40 & 0.05 & 100 & 1000 & 5.85 + ms128-rt & 40 & 0.05 & 100 & 1000 & 5.85 + ms256-rt & 40 & 0.05 & 100 & 1000 & 5.85 + ms64-ng & 40 & 0.05 & 100 & 1000 & 5.85 & 1 + ms128-ng & 40 & 0.05 & 100 & 1000 & 5.85 & 1 + ms256-ng & 40 & 0.05 & 100 & 1000 & 5.85 & 1 + ms256-rt - ng & 40 & 0.05 & 100 & 1000 & 5.85 & 1 + ms64-nr & 40 & 0.05 & 100 & 1000 & 5.85 & 2 + ms128-nr & 40 & 0.05 & 100 & 1000 & 5.85 & 2 + ms256-nr & 40 & 0.05 & 100 & 1000 & 5.85 & 2 + ms256-t100 & 40 & 0.05 & 100 & 100 & 5.85 & + ms256-cr & 40 & 0.05 & 100 & 1000 & 5.85 & 3 + ms256-l20 & 20 & 0.05 & 100 & 1000 & 5.85 & + ms256-rt - l20 & 20 & 0.05 & 100 & 1000 & 5.85 & + ms256-l30 & 30 & 0.05 & 100 & 1000 & 5.85 & + ms256-l50 & 50 & 0.05 & 100 & 1000 & 5.85 & + ms256-l60 & 60 & 0.05 & 100 & 1000 & 5.85 & + ms256-rt - l60 & 60 & 0.05 & 100 & 1000 & 5.85 & + ms256-bx2 & 40 & 0.05 & 100 & 1000 & 11.7 & + ms256-bx4 & 40 & 0.05 & 100 & 1000 & 23.4 & + ms256-rt - bx4 & 40 & 0.05 & 100 & 1000 & 23.4 & + hs256 & 40 & 0.05 & 100 & 1000 & 0.0 & + hs256-rt & 40 & 0.05 & 100 & 1000 & 0.0 & + ms256-d10 & 40 & 0.10 & 100 & 1000 & 5.85 & + ms256-d50 & 40 & 0.50 & 100 & 1000 & 5.85 & + ms256-d100 & 40 & 1.00 & 100 & 1000 & 5.85 & + ms256-rt - d100 & 40 & 1.00 & 100 & 1000 & 5.85 & + ms256-n10 & 85 & 0.05 & 10 & 1000 & 1.24 & + ms256-rt - n10 & 85 & 0.05 & 10 & 1000 & 1.24 & + ms256-n30 & 60 & 0.05 & 30 & 1000 & 2.63 & +    ccccc ms64 & 21.3 & 0.30 & 27.3 & 0.89 + ms128 & 26.5 & 0.34 & 31.1 & 0.93 + ms256 & 29.5 & 0.21 & 31.7 & 0.50 + ms64-rt & 15.0 & 0.65 & 22.1 & 0.99 + ms128-rt & 16.9 & 0.74 & 20.9 & 0.99 + ms256-rt & 18.4 & 0.89 & 20.6 & 0.99 + ms64-ng &  &  & 31.7 & 0.26 + ms128-ng &  &  & 31.7 & 0.13 + ms256-ng &  &  & 31.7 & @xmath391 + ms256-rt - ng &  &  & 19.9 & 0.73 + ms64-nr & 18.3 & 0.70 & 29.6 & 0.99 + ms128-nr & 22.1 & 0.76 & 28.9 & 0.98 + ms256-nr & 26.6 & 0.83 & 31.7 & 0.96 + ms256-t100 & 28.9 & 0.23 & 31.7 & 0.62 + ms256-cr & 30.0 & 0.42 & 31.7 & 0.76 + ms256-l20 &  &  & 31.7 & @xmath392 + ms256-rt - l20 & 17.2 & 0.96 & 20.0 & 0.99 + ms256-l30 & 31.3 & 0.42 & 31.7 & 0.48 + ms256-l50 & 27.7 & 0.20 & 30.8 & 0.71 + ms256-l60 & 26.7 & 0.20 & 29.9 & 0.70 + ms256-rt - l60 & 17.8 & 0.76 & 22.1 & 0.98 + ms256-bx2 & 29.8 & 0.25 & 31.7 & 0.50 + ms256-bx4 & 29.2 & 0.27 & 31.7 & 0.62 + ms256-rt - bx4 & 18.7 & 0.92 & 19.0 & 0.96 + hs256 & 23.9 & 0.10 & 25.2 & 0.21 + hs256-rt & 13.1 & 0.60 & 18.2 & 0.97 + ms256-d10 & 27.1 & 0.22 & 30.5 & 0.68 + ms256-d50 & 22.9 & 0.20 & 25.8 & 0.64 + ms256-d100 & 21.0 & 0.19 & 23.7 & 0.59 + ms256-rt - d100 & 17.1 & 0.80 & 20.2 & 0.99 + ms256-n10 &  &  & 95.1 & @xmath393 + ms256-rt - n10 &  &  & 53.0 & 0.91 + ms256-n30 & 58.1 & 0.26 & 64.1 & 0.70 +"
  ],
  "abstract_text": [
    "<S> we study the formation of @xmath0 in the ism , using a modified version of the astrophysical magnetohydrodynamical code zeus - mp that includes a non - equilibrium treatment of the formation and destruction of @xmath0 . </S>",
    "<S> we examine two different approximations to treat the shielding of @xmath0 against photodissociation : a local approximation , which gives us a solid lower bound on the amount of shielding , and a method based on ray - tracing that is considerably more accurate in some circumstances but that produces results that are harder to clearly interpret . in both cases , </S>",
    "<S> the computational cost of determining @xmath0 photodissociation rates is reduced by enough to make three - dimensional high - resolution simulations of cloud formation feasible with modest computational resources . </S>",
    "<S> our modification to zeus - mp also includes a detailed treatment of the thermal behaviour of the gas .    in this paper , we focus on the problem of molecular cloud formation in gravitationally unstable , initially static gas . </S>",
    "<S> ( in a subsequent paper , we consider turbulent flow ) . we show that in these conditions , and for initial densities consistent with those observed in the cold , neutral atomic phase of the interstellar medium , @xmath0 formation occurs on a timescale @xmath1 , comparable to or longer than the gravitational free - fall timescale of the cloud . </S>",
    "<S> we also show that the collapsing gas very quickly reaches thermal equilibrium and that the equation of state of the thermal equilibrium gas is generally softer than isothermal .    </S>",
    "<S> finally , we demonstrate that although these results show little sensitivity to variations in most of our simulation parameters , they are highly sensitive to the assumed initial density @xmath2 . reducing @xmath2 significantly increases the cloud formation timescale and decreases the amount of hydrogen ultimately converted to @xmath0 . </S>"
  ]
}