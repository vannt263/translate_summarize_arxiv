{
  "article_text": [
    "the art of computing solar magnetic fields has evolved from routine potential field ( pf ) extrapolations to nonlinear force - free field ( nlfff ) computations .",
    "the most important aspect concerning these two types of magnetic field models is the difference of magnetic energy content between them , the so - called _ free energy _ , which represents the maximum energy that can be dissipated during a magnetic instability that is driving solar flares , coronal mass ejections , or other eruptive events . monitoring the magnetic evolution in active regions became an efficient diagnostic to measure the emergence of new magnetic flux on the solar surface , the magnetic storage , the injection of electric currents and helicity , the step - wise dissipation of nonpotential energy during flares , the energy conversion of magnetic energy during a magnetic reconnection process into particle acceleration , etc .",
    "the quantification of the free magnetic energy probably provides the strongest constraint to discriminate cause and consequence in the various energy conversion processes .",
    "it is therefore imperative to develop accurate and efficient tools to measure and monitor the evolution of magnetic energy in solar active regions . in this study",
    "we explore a novel method to calculate an approximate nlfff solution using an automated loop tracing code , which aims to find force - free magnetic field solutions that are most consistent with the observed geometry of coronal loops , such as observed in high - resolution extreme - ultraviolet ( euv ) images from the _ atmospheric imaging assembly ( aia ) _ ( lemen et al .",
    "2012 ) onboard the _ solar dynamics observatory ( sdo ) _ spacecraft ( pesnell et al .  2012 ) .",
    "nlfff modeling has been applied to active regions ( bobra et al .",
    "2008 ; su et al .  2009a",
    "; inoue et al",
    ".  2011 , 2013 ; savcheva et al .",
    "2012a ) , to coronal sigmoids ( savcheva et al .  2012b , 2012c ; inoue et al .",
    "2012 ) , to photospheric magnetic field changes ( liu et al .",
    "2012 ) , to magnetic flux emergence and energy build - up before flares ( su et al .  2009b ; li et al .",
    "2007 ) , to flares ( guo et al .  2008",
    "; schrijver et al .",
    "2008 ) , to confined eruptions ( guo et al .",
    "2010 ) , to coronal mass ejections ( cmes ) ( su et al .  2011",
    "; feng et al .",
    "2013 ) , as well as to mhd simulations ( savcheva et al .",
    "earlier studies compared theoretical models with observed images in a rather qualitative way , but recent studies go into quantitative comparisons of free energies and statistics of misalignment angles between modeled field lines and observed coronal loop geometries .",
    "comparisons of up to 14 different nlfff codes revealed substantial differences in the amount of calculated free magnetic energies , ranging from an ( unphysical ) minumun value @xmath4 below unity , to a maximum of @xmath5 for an x3.4-class flare ( schrijver et al .",
    "an evaluation of current nlfff modeling was conducted in a study of the solar active region noaa 10953 ( 2007 april 30 ) with a dozen of different nlfff codes , which led to three major requirements for successful nlfff modeling : ( 1 ) a sufficiently large field - of - view of the vector magnetic field data and the computation box , ( 2 ) accomodation of uncertainties in the boundary data , and ( 3 ) a realistic model of the transition from the non - forcefree photosphere to the force - free base of the corona ( derosa et al .",
    "2009 ) . a pre - processing step to minimize the net force and torque in the photospheric boundary data was suggested ( wiegelmann et al .",
    "2006 , 2008 ; wheatland and regnier 2009 ) , which improved the extrapolation above the chromosphere , but the field connectivity and free magnetic energy were not well recovered ( metcalf et al .  2008 ; yamamoto et al .",
    "2012 ; jiang and feng 2013 ) .",
    "the latter issue is manifested in a major discrepancy between the computed magnetic field lines and stereoscopically observed geometries of coronal loops ( fig .  1 ) , amounting to 3d misalignment angles of @xmath6 ( derosa et al .",
    "this mismatch angle can be reduced by forward - fitting of parameterized potential field models ( aschwanden and sandman 2010 ; sandman and aschwanden 2011 ) , by forward - fitting using a quasi - grad - rubin nlfff method ( malanushenko et al .",
    "2011 , 2012 ) , and by forward - fitting of analytical nlfff approximations ( aschwanden et al .",
    "2012 , aschwanden 2013a , 2013b , 2013c ; aschwanden and malanushenko 2013 ) .",
    "the latter method has been demonstrated to work equally well for both 3-dimensional ( 3d ) loop coordinates , obtained with stereoscopy , and 2-dimensional ( 2d ) loop projections ( aschwanden 2013c ) .    in this study",
    "we developed our forward - fitting code with analytical nlfff approximations further by ( 1 ) implementing an automated loop tracing code for detection of coronal loops in multi - wavelength euv images , which makes the manual or visual loop tracing unnecessary ( aschwanden 2010 ) , ( 2 ) by optimization of the forward - fitting technique to 2d loop coordinates , which relinquishes 3d reconstruction with stereoscopy ( aschwanden 2013c ) , and ( 3 ) by improved detection and rejection of false loop structures , caused by ccd pixel bleeding , ccd saturation , and diffraction patterns from by the euv telescope entrance filter .",
    "the content of this paper is a brief analytical description of the method ( section 2 ) , a brief description of the numerical code ( section 3 ) , and data analysis of noaa active region 11158 observed with sdo / aia and hmi during the 2011 february 12 - 17 flares ( section 4 ) , discussion and comparison with previous studies on the same active region and x - class flare ( section 5 ) , and conclusions ( section 6 ) .",
    "our _ coronal nonlinear force - free field ( cor - nlfff ) _ forward - fitting code consists of the following three major tasks ( fig .",
    "2 ) : ( 1 ) automated loop tracing in coronal 2d images ; ( 2 ) decomposition of a line - of - sight magnetogram into ( sub - photospheric ) magnetic charges that provide a parameterization of the potential and non - potential field ; and ( 3 ) forward - fitting of the nonlinear force - free field approximation to the observed , automatically traced 2d loop coordinates .",
    "a brief theoretical description of these three modeling steps is provided in the following .",
    "an early version of the automated loop tracing code , called _ oriented coronal curved loop tracing ( occult ) _ , has been quantitatively compared with four other codes ( aschwanden et al .",
    "the method is based on oriented - directivity tracing of curvi - linear features , but in contrast to other general feature - extraction algorithms , it is customized to solar euv and sxr images by taking advantage of the specific property that coronal loops have large curvature radii , compared with their widths .",
    "essentially , an image is highpass - filtered to enhance curvi - linear features with a small width , which are then traced with a guiding criterion that is defined in terms of the local curvature radius within small directional changes along a traced loop segment .",
    "the performance of this code was systematically improved by optimizing the guiding criterion , using the first - order term of the loop direction in the first version ( aschwanden 2010 ) , and using the second - order term of the local curvature radius in the latest version occult-2 ( aschwanden , de pontieu , and katrukha 2013b ) .      for the computation of a potential field , a line - of - sight ( los )",
    "magnetogram that samples one magnetic field vector component @xmath7 is sufficient to calculate a 3d potential field in a given computation box . while standard potential - field codes , such as the widely used _",
    "potential field source surface ( pfss ) _ code , are based on the _ eigen function ( spherical harmonic ) expansion _",
    "method originally developed by altschuler and newkirk ( 1969 ) , we need a parameterization that can also be used for forward - fitting of non - potential 3d magnetic field models .",
    "the simplest method that is suitable for this purpose is the decomposition of a potential field into uni - polar magnetic charges @xmath8 that are buried in sub - photospheric locations ( @xmath9 ) , with the field strength @xmath10 decreasing with the square of the radial distance @xmath11 , which can be superimposed by an arbitrary large number @xmath12 of magnetic charges , @xmath13 where @xmath14^{1/2}$ ] is the distance of an arbitrary coronal location @xmath15 to the subphotospheric charge location @xmath16 , while @xmath17^{1/2}$ ] is the depth of the buried charge , and @xmath18 is the magnetic field strength at the solar surface in vertical direction above the buried charge . the square - dependence of the radial field component @xmath19 warrants that each magnetic charge fulfills maxwell s divergence - free condition , @xmath20 which it is also true for the summed magnetic field according to equation ( 1 ) , because the linear superposition of divergence - free fields is divergence - free too , i.e. , @xmath21 .",
    "the decomposition of a los magnetogram @xmath7 into a finite number @xmath12 of magnetic charges can simply be accomplished by iterative decomposition of local maxima of the field into individual magnetic charges , each one characterized by the four parameters @xmath22 , by iterating subsequent subtractions of decomposed gaussian - like magnetic charges until the residual map reaches some noise threshold .",
    "the procedure is demonstrated in detail in aschwanden and sandman ( 2010 ) .",
    "typically , a number of @xmath23 magnetic sources is sufficient to obtain a realistic potential field model of a solar active region .",
    "a _ nonlinear force - free field ( nlfff ) _ model needs to fulfill both the maxwell s divergence - free ( equation 2 ) , and the force - free condition , @xmath24 where @xmath25 is a scalar function that varies in space , but is constant along a given field line , and the current density @xmath26 is co - aligned and proportional to the magnetic field @xmath27 .",
    "an approximate analytical solution of equations ( 2)-(3 ) was recently calculated for vertically twisted fields ( aschwanden * 2013a * ) that can be expressed by a superposition of an arbitrary number of @xmath12 magnetic field components @xmath28 , @xmath8 , @xmath29 where each magnetic field component @xmath28 can be decomposed into a radial @xmath30 and an azimuthal field component @xmath31 , @xmath32 @xmath33 @xmath34 @xmath35 where ( @xmath36 ) are the spherical coordinates of a magnetic field component system ( @xmath37 with a unipolar magnetic charge @xmath18 that is buried at position ( @xmath38 , has a depth @xmath39 , a vertical twist @xmath40 , and @xmath41^{1/2}$ ] is the distance of an arbitrary coronal position @xmath42 to the subphotospheric location @xmath16 of the buried magnetic charge .",
    "the force - free @xmath43 parameter can be expressed in terms of the parameter @xmath44 ( equation 8) , which quantifies the number @xmath45 of full twist turns over a ( loop ) length @xmath46 , @xmath47 this analytical approximation is divergence - free and force - free to second - order accuracy in the parameter @xmath48 ( aschwanden 2013a ) , which is proportional to the force - free parameter @xmath43 as defined by equation ( 8) . in the limit of vanishing vertical twist ( @xmath49 or @xmath50 ) , the azimuthal component vanishes , @xmath51 , and the radial component degenerates to the potential - field solution of a unipolar magnetic charge , @xmath52 , which is simply a radial field that points away from the buried charge and decreases with the square of the distance . as a caveat , we should be aware that the analytical approximation expressed in equations ( 5)-(6 ) implies a vertical twist axis that produces a horizontal azimuthal non - potential field component @xmath31 , while horizontal twist axes with the corresponding non - potential components @xmath31 can not be represented with this parameterization , such as a horizontally oriented filament ( see also discussion on the gold - hoyle flux rope in appendix a of aschwanden 2013a ) .",
    "we will label the nonpotential magnetic field of our model with a vertical twist axis as @xmath53 , in order to remind about this restriction .",
    "the free energy is generally defined as the difference between the potential and non - potential magnetic energy , integrated over the volume of the computation box . in our case , since we include only vertical twist axes in our nonpotential model , the difference energy @xmath54 will be a lower limit to the total free energy @xmath55 , @xmath56 in order to obtain a first - order correction , we can consider a current in a semi - circular loop or filament .",
    "this current flows in vertical direction at the footpoint of a loop or filament , while it flows in horizontal direction near the apex .",
    "this twist axis of the field - aligned current @xmath57 has thus a relative direction @xmath58 with a cosine - dependence along the loop , which will also enter the resulting nonpotential azimuthal field component @xmath59 and leads to an average underestimate ( as a function of the inclination angle @xmath58 to the vertical ) of @xmath60 the free energy @xmath61 scales with the square of the azimuthal ( nonpotential ) field component @xmath59 by definition ( equation 10 in aschwanden 2013a ) , and thus the average free energy @xmath54 obtained in a model that only includes electric currents associated with a vertical axis is @xmath62 thus we expect that our method underestimates the azimuthal ( non - potential ) field component @xmath59 by a factor of @xmath63 in the average , and thus the free energy by a factor of @xmath64 .",
    "this bias can approximately be corrected with the _ isotropic twist correction factor _ @xmath65 in the determination of the free energy , i.e. , @xmath66 .",
    "the _ coronal nonlinear force - free field ( cor - nlfff ) _ forward - fitting numerical code has evolved from an earlier version ( aschwanden and malanushenko 2013 ) to the present version , achieving now a higher degree of accuracy in the measurement of the nonpotential magnetic energy @xmath67 and the free energy @xmath68 . a flow chart of the latest version is provided in fig .  2 , which can be broken down into three major tasks : ( 1 ) the processing of the magnetic data ; ( 2 ) the processing of the euv data ( including automated loop tracing ) , and ( 3 ) the forward - fitting of the analytical nlfff approximation . in the following",
    "we briefly describe the numerical methods that are employed in the cor - nlfff code , while a parametric study to establish the optimum choice of control parameters ( table 1 ) is documented in appendix a.      the input of magnetic data is a line - of - sight magnetogram @xmath7 , in this case from hmi ( scherrer et al .  2012 ; hoeksema et al .  2014 ) onboard the sdo spacecraft .",
    "we use the 45 s hmi data , which have been processed from 135 s time intervals .",
    "an hmi image covers the full - sun and has a pixel size of @xmath69 , or approximately @xmath70 solar radii .",
    "we are not using any photospheric vector magnetograph data , in contrast to the traditional nlfff codes , because we consider the transverse components @xmath71 and @xmath72 as unreliable for coronal field extrapolations due to the non - forcefreeness of the photosphere ( fig .  1 ) ,",
    "and thus we keep them as free parameters , which will be computed from the constraints of the geometric shapes of observed coronal loops .",
    "we use only the line - of - sight magnetic field component @xmath7 of the hmi data .",
    "the magnetic control parameters of the cor - nlfff code are : the spatial resolution ( @xmath73 ) of ( rebinned ) magnetogram data used in the decomposition of ( gaussian - like ) point sources , and the number of decomposed magnetic source components ( @xmath74 ) .",
    "the numerical algorithm for magnetogram decomposition is described in aschwanden ( 2010 ) and aschwanden et al .",
    "( 2012 , appendix a therein ) .",
    "a modification in the newest version of the code is the fitting of a 2d gaussian function to local maxima of the magnetograms , which are iteraticely subtracted and the residuals within the full width at half mean ( fwhm ) are set to zero , in order to minimize the number of magnetic source components in the model .",
    "in addition , we normalize the fitted gaussian to the same magnetic field strength as the local peak in the magnetogram , in order to conserve the magnetic flux ( @xmath75 ) and magnetic energy ( @xmath76 )",
    ". examples of the gaussian decomposition of the magnetogram are given in the parameteric study described in appendix a ( see also figure 17 ) .",
    "the second major task deals with the extraction of coronal loop coordinates from the euv images .",
    "the optimization of the automated loop tracing code is described in a recent study ( aschwanden et al .",
    "2013b ) , which is controlled by the lowpass filter constant ( @xmath77 ) ( boxcar pixels ) , the highpass filter ( @xmath78 ) , the minimum loop curvature radius ( @xmath79 ) , the minimum loop length ( @xmath80 , and the loop length increment ( @xmath81 ) , which all have been optimized ( appendix a ) and the default values are given in table 1 .",
    "a unique capability of our cor - nlfff code is the synthesized processing of multiple euv images in different wavelength filters , which encompsasses six coronal ( 94 , 131 , 171 , 193 , 211 , 335 ) and one chromospheric ( 304 ) filter from aia / sdo . how do we optimize the selection of loops in the forward - fitting code ?",
    "we set up a number of control parameters that include the selected wavlengths ( @xmath82 ) , the maximum number ( @xmath83 ) of loops extracted per wavelength filter , the minimum loop length ( @xmath84 ) , and the minimum curvature radius ( @xmath79 ) in the loop selection .",
    "we find that selections with an over - proportional contribution of large loops tends to favor potential field solutions ( and thus a small ratio of the non - potential energy @xmath85 , while a selection with a dominant contribution of small loops produces the opposite .",
    "since large loops are found at relatively cool temperatures @xmath86 mk ; i.e. , 171 and 193 ) , while smaller loops in the core of active regions are found at hotter temperatures @xmath87 mk ; i.e. , 94 and 335 ) , the choice of wavelengths ( @xmath82 ) and the limit @xmath88 ) on the extracted loops per wavelength filter play a decisive role .",
    "it is crucial to have a balanced amount of small and large loops in order to obtain a representative value for the free energy . a parametric study of varying the selection parameters ( @xmath82 , @xmath83 , @xmath84 , @xmath79 ) is given in appendix a.    we implemented also criteria to automatically reject false loop structures , i.e. , curvi - linear features that are caused by ccd pixel bleeding , ccd saturation , and diffraction patterns from the euv entrance filter .",
    "the forward - fitting algorithm consists of the task of optimizing the free parameters @xmath89 , associated with each magnetic charge in such a way that the 2d misalignment angle @xmath90 between an observed loop segment and a theoretical field line calculated at the same location is minimized .",
    "forward - fitting with a large number of free parameters requires a customized numerical scheme that makes a reasonable trade - off between numerical accuracy and computational efficiency .",
    "a first numerical code that fits the analytical approximation ( equations 4 - 9 ) to a given analytical 3d magnetic field is described and tested in aschwanden and malanushenko ( 2013 ) , forward - fitting to real solar data in 2d and 3d is conducted in aschwanden ( 2013c ) and computations of the free energies in aschwanden ( 2013b ) .",
    "the multi - parameter optimization scheme used in the original code ( aschwanden and malanushenko 2013 ) employed a hierarchical subidivision of @xmath43-zones in the magnetic map that refines iteratively the @xmath43-values into progressively smaller regions . in the latest version",
    "we use all magnetic source components in the forward - fitting of force - free @xmath40 parameters .",
    "in addition we tested different optimization algorithms : ( 1 ) the powell optimization scheme ( which seeks the local minima of the parameters @xmath40 sequentially during each iteration cycle ) , and ( 2 ) a gradient optimization scheme ( which determines the gradient @xmath91 of the misalignment angle @xmath92 as a function of the free parameter @xmath40 during each iteration cycle .",
    "the powell optimization generally converges to a smaller misaligment angle and is the method of choice in the cor - nlfff code .    the mean misalignment angle @xmath90 , which is minimized in the forward - fitting method , is defined by the root - mean - square ( r.m.s .",
    ") , @xmath93 where @xmath94 is the misalignment angle of loop @xmath95 , which itself is the median of @xmath96 loop segments ( typically @xmath97 ) , @xmath98 thus , the forward - fitting essentially consists of fitting the @xmath43-values @xmath99 to the loop misalignment angles @xmath100 , with @xmath101 and @xmath102 .",
    "the optimization of the forward - fitting control parameters ( @xmath103 ) is quantified in appendix a.    there is also the problem of the missing third dimension in the observations .",
    "the forward - fitting algorithm minimizes the misalignment angle @xmath90 between an observed 2d loop coordinate @xmath104 and a theoretical 3d field line intersecting at @xmath105 .",
    "the line - of - sight coordinate @xmath106 is not known a priori , unless we would employ stereoscopy ( aschwanden 2013c ) , but is a required quantity to select the proper theoretical field line .",
    "one constraint that we can use is the valid range of @xmath107^{1/2}$ ] within a solution space corresponding to an altitude range of @xmath108 at each position @xmath109 .",
    "we assume that each observed loop segment can be approximated with a circular segment as a function of the los - coordinate @xmath106 , @xmath110      \\ , \\ ] ] where the starting angle @xmath111 of the circular segment can be anywhere within the range of @xmath112 , while the end angle @xmath113 can be anywhere within the range of @xmath114 , where @xmath115 is a normalized loop length coordinate , @xmath116 is the curvature radius of the circular segment , and @xmath117 is the center height of the circular segment , adjusted in such a way that the circular segment is always located in the altitude range of the computation box with @xmath118 $ ] .",
    "we choose @xmath119 starting angles @xmath111 ( each @xmath120 apart ) and @xmath121 possible height ranges , which yields @xmath122 different trial geometric shapes to estimate the heights @xmath123 in the @xmath124 loop segments of each loop @xmath95 .    after every iteration cycle of forward - fitting a set of @xmath40-values , we compute the trial geometric shapes ( equation 15 ) with the new @xmath40 values and adjust the heights @xmath125 at the midpoints of each loop , by minimizing the misaligment angles @xmath90 between the loop coordinates ( @xmath126 ) and the theoretical field lines ( @xmath127 ) . in this way we optimize both the force - free parameters @xmath40 and the 3d - coordinate @xmath106 of the loop midpoints .",
    "alternative trial geometries used for magnetic modeling of 3d loops are bezier functions ( gary et al .",
    "2014a , b ) .",
    "sdo data are most suitable for our type of magnetic modeling of active regions , because hmi and aia provide both high - resolution magnetograms and simultaneous multi - wavelength euv images .",
    "an additional requirement for a suitable active region is a location near sun disk center and the appearance of many ( possibly twisted ) coronal loops .",
    "some of such active regions have already been modeled with nlfff codes that allow us to compare results .",
    "the active region noaa 11158 produced one of the most spectacular flares ( goes x2.2 class ) during the first two years of the sdo mission and has been intensively studied since then , documented in over 40 publications so far ( e.g. , sun et al .",
    "2012a ; schrijver et al .",
    "2011 ; wang et al .  2012 ; kosovichev 2011 , aschwanden et al .",
    "see section 5.1 for more details and references .",
    "we study the evolution of active region 11158 over 5 days , from 2011 february 12 , 00 ut , to february 17 , 00 ut , which is the same interval as analyzed in sun et al .",
    "( 2012a ) . a sample set of 7 images , observed with aia / sdo ( lemen et al .",
    "2012 ; boerner et al .",
    "2012 ) on 2011 february 15 , 00:00:00 ut ( about two hours before the goes x2.2-class flare ) , is shown in fig .  3 with the wavelengths of 94 , 131 , 171 , 193 , 211 , 304 , and 335  .",
    "a near - simultaneous magnetogram observed with hmi / sdo within one minute ( 2012 february 14 , 23:58:57 ut ) is shown in fig .  3 also .",
    "the pixel size of aia is @xmath128 ( with a spatial resolution of @xmath129 pixels ) , and the pixel size of hmi is @xmath69 .",
    "these 8 images shown in fig .",
    "3 represent all data input that is needed for our magnetic nlfff modeling .",
    "no vector magnetograph data from hmi are used , because our method needs only the line - of - sight component and treats the transverse magnetic field components as free parameters .",
    "we show the loop structures enhanced in form of bandpass - filtered images in fig .",
    "the bandbass used here consists of a lowpass filter with a boxcar length of @xmath130 pixels , and a highpass filter with a boxcar length of @xmath131 pixels .",
    "thus it enhances most efficiently loops with a cross - sectional width in the range of 5 - 7 pixels , which corresponds to a cross - sectional width of @xmath132 mm .",
    "obviously we see coronal loops in all wavelengths ( fig .  4 ) , but filters with cool coronal temperatures ( 171 , 193 , 211 ; @xmath133 mk ) show more large - scale loops that overarch the active region , while filters sensitive to hotter temperatures ( 94 , 131 ) reveal more highly twisted structures in the core of the active region , similar to the structures seen at chromospheric temperatures ( 304 ; @xmath134 mk ) . loop structures in this active region were analyzed in almost the same set of images two hours before the x - class flare , and have been subjected to automated temperature and emission measure analysis and automated loop tracing ( aschwanden et al .",
    "2013a ) .",
    "the automated loop tracing in this active region is shown separately for each temperature filter in fig  5 , conducted with an improved algorithm ( aschwanden et al .",
    "2013a ) than used previously .",
    "for the particular run shown in fig .  5 we used the following control parameters ( defined in aschwanden et al .",
    "2012 ) : a maximum number of @xmath135 loops per wavelength filter , a minimum curvature radius of @xmath136 pixels , a minimum loop length of @xmath137 pixels , a lowpass filter of @xmath138 pixels , a highpass of @xmath139 pixels , and a flux threshold level that corresponds to [ 5 , 2 , 0 , 0 , 1 , 5 , 5 ] times the noise level ( median ) for the wavelengths [ 94 , 131 , 171 , 193 , 211 , 304 , 335 ] a , evaluated in stripes at each of the four image boundaries . with this particular setup",
    "the code picked up a total of @xmath140 curvi - linear loop structures ( fig .  5 , bottom right ) ,",
    "synthesized from all wavelengths , from a minimum of @xmath141 structures in the 94 filter , and a maximum of @xmath142 structures in the 193  filter .",
    "the automated tracing reveals a large number of bipolar loops and peripheral ( open - field ) fan structures in the 171 , 193 , and 211 filters , while the other filters exhibit shorter structures in the core of the active region surrounding the flare site .",
    "the complementary nature of loop tracing is most conspicuous between 171 and 335  ( fig .  5 ) .",
    "the results of the forward - fitting of the analytical nlfff approximation is shown for each wavelength separately in fig .",
    "the panels in fig .",
    "6 show the automatically traced 2d coordinates of the loop segments ( blue curves ) and their midpoints ( blue diamonds ) , where an intersecting fieldline segment of the nlfff best - fit model with equal length is indicated ( red curve ) , as well as the full field line ( orange curve ) , starting and ending either at the solar surface or at a boundary side of the computation box , which extends over the field - of - view shown in the figures 3 - 6 and a vertical height of @xmath143 solar radii above the solar surface .",
    "the control parameter of these fits are : @xmath144 magnetic sources ; a spatial resolution corresponding to one aia pixel size ; a maximum range of the force - free parameter @xmath145 per iteration step ; a maximum number of @xmath146 loops per wavelength filter ; and a minimum length of @xmath137 pixels for the selected loops . a simultaneous fit to a subset of 238 loops synthsized from the 50 brightest ones in each filter is shown in fig .",
    "6 ( bottom right panel ) .",
    "it is interesting to compare the best - fit nlfff solutions in each wavelength , because they reveal the model sensitivity to the loop selection .",
    "the wavelengths with the largest number of loops are 171 , 193 , and 211 , amounting to @xmath147 .",
    "the other wavelengths , however , have a smaller number of loops ( @xmath148 ) , have smaller loop lengths , are preferentially located in the core of the active region , and have lower altitudes .",
    "it appears that these two groups of loops have also different degrees of non - potentiality : the large - scale loops over - arching the active region are close to the potential field solution with low @xmath43-values , while the small - scale loops in the core of the active region are stronger twisted , including the sigmoid - like filament in the center , and have a higher degree of non - potentiality , with higher @xmath43-values .",
    "the relaxation of a twisted non - potential field to a more dipolar potential field can also be seen visually by inspecting two of the cor - nlfff solutions for ar 11158 before the x2.2 flare ( fig .  7 , top panel : 2011-feb-15 , 01:48 ut ) , and shortly after the flare peak ( fig .  7 , bottom panel : 2011-feb-15 , 02:06 ut ) .",
    "the highly twisted central filament in the northern pair of sunspots of the quadrupolar active region relaxes from a helical twist of about one turn to an almost dipolar geometry with little twist .",
    "a movie of the magnetic field caclulated with cor - nlfff during a time interval of 6 hours is contained in the supplementary electronic material to this paper .",
    "we study now the time evolution of the potential magnetic energy @xmath149 , the non - potential magnetic energy @xmath150 , and the free magnetic energy or difference @xmath151 for ar 11158 .",
    "these energies are integrated over a computation box that is aligned with the spherical solar surface , with a field - of - view of @xmath152 solar radii , and with an altitude range of @xmath153 solar radii , centered at heliographic coordinates @xmath154 $ ] following the solar rotation .",
    "the central meridian passage of ar 11158 was at 2011 feb 14 , 00 ut , and the heliographic latitude is @xmath155 .",
    "the evolution of the potential magnetic energy starts with a low amount of @xmath156 erg on 2011-febr-12 , and then ramps up almost monotonically to a value of @xmath157 erg during the next two days ( fig .",
    "8b ) , so the total magnetic energy increases by a factor of about 8 during the 2 days before the x2.2 flare on 2011-feb-15 .",
    "both our cor - nlfff code and the wiegelmann nlfff code ( sun et al .",
    "2012a ) agree well ( within a few percents ) in the total potential energy during the first 3 days , but deviate by about 30% during the last two days , when the active region was @xmath158 away from the centeral meridian , perhaps due to some side effect of the de - rotation projection to disk center applied in sun et al .",
    "( 2012a ) , or due to center - of - limb effects of the los - component decomposition in our cor - nlfff code .",
    "the time evolution of the nonpotential magnetic energy @xmath159 , obtained from @xmath160 forward - fits with the cor - nlfff code to traced coronal loops , with a 6-min cadence , is shown in fig .",
    "8c ( blue profile ) , and is compared with the wiegelmann nlfff code with 12-min intervals ( red curves ) , calculated previously also wtih 1-hour intervals ( orange curves in fig .  8",
    "; see also fig .  4 in sun et al .",
    "2012a ) .",
    "we show the evolution of the free energy @xmath161 in fig .",
    "there is a rapid increase in the free energy at the beginning of the second day ( 2011-feb-13 ) as calculated with the wiegelmann code , while no such jump is evident as caclulated from the hmi line - of - sight component with the cor - nlfff code , which is interpreted as an episode of rapid magentic flux emergence with strong horizontal field and little vertical field , occurring in the north - western bipole of the active region .",
    "apparently there are no bright loops associated with the emerging field , because we detect no increase in free energy based on the coronal nlfff code .",
    "since the free energy is a small quantity obtained from the difference of two large quantities , the relative uncertainties are larger than the relative uncertainties of the absolute energies .",
    "we do not know _ a priori _ which code produces more reliable values of the free energy , since each code has its own caveats and strengths , and the two codes are using complementary ( photospheric versus coronal ) information . we find the following differences in the results of the free energy obtained with the wiegelmann nlfff code , which uses pre - processed photospheric vector data ( sun et al .",
    "2012a ) , and our cor - nlfff code , based on forward - fitting to ( automatically ) traced coronal loops : ( 1 ) the absolute values of the free energies differ up to a factor of 4 between the two codes ; ( 2 ) the wiegelmann nlfff code yields a relatively smooth evolution of the magnetic energy , while our cor - nlfff reveals more rapid fluctuations in the time evolution of the free energy ( fig .",
    "8d ) ; ( 3 ) there are a number of goes flares where the cor - nlfff code shows substantial changes in the free energy that appear to be correlated with the goes fluxes , while the wiegelmann nlfff code shows only very small fluctuations of the free energy .",
    "we will investigate these differences in more detail in the following .",
    "let us have a look at some fitting parameters in order to see whether they could be responsible for the fluctuations of the obtained free energy .",
    "the number of automatically selected loops in the 1200 forward - fitting runs are shown in fig .",
    "( 8e ) , and has a mean of @xmath162 .",
    "the number of selected loops has a lowest value of @xmath163 during the first day , when the goes flux as well as the total magnetic energy is also low , which reflects the fact that less detectable loops existed during this day . in the overall ,",
    "there is much less fluctuations in the number of loops @xmath164 than in the free energy @xmath165 ( fig .",
    "the goodness - of - fit test of the 1200 forward - fitting runs is given in terms of the median 2d misalignment angle @xmath166 in fig .",
    "( 8f ) , with a mean of @xmath167 , which is to be compared with @xmath168 for potential field models .",
    "the goodness - of - fit @xmath166 is fairly uniform during the 5 days , even during flaring episodes , thanks to the new improvements in the cor - nlfff code that eliminates false loop structures caused by ccd pixel bleeding , ccd saturation ( for too long exposure times ) , and diffraction patterns due to the euv entrance filters .",
    "we show an expanded time profile of the free energy @xmath165 of ar 11158 in fig .",
    "9 , along with the light curves of the goes 1 - 8 flux , which contains 36 flares above the goes c0-class level during the 2011 feb 12 - 17 period .",
    "note that the free energy calculated with the cor - nlfff code exhibits much stronger fluctuations than the phot - nlfff ( wiegelmann ) code in the later days , while both codes show an absence of significant fluctuations during the first day ( 2011 feb 12 ) .",
    "we investigate now changes in the magnetic energy @xmath169 specifically during these 36 flare time intervals . a sample of 9 flare time intervals are shown enlarged in fig .",
    "we determined the flare start time ( @xmath170 ) , peak time ( @xmath171 ) , and end time ( @xmath172 ) of these 36 events ( table 2 ) based on standard noaa flare catalog , where the end time is defined when the goes flux drops to 50% of the peak flux .",
    "we define a decrease of the free energy as follows , @xmath173 where the preflare reference time @xmath174 is identified by the maximum of the free energy during the preflare time interval [ @xmath175 hr , @xmath171 ] , and the postflare reference time @xmath177 is identified by the minimum of the free energy during the time interval @xmath178 hr ] .",
    "the so - determined time intervals [ @xmath179 of maximum energy dissipation during the risetime of the flare ( within a margin of 0.3 hr ) are shown for both the cor - nlfff code ( blue curves in fig .",
    "10 ) and the wiegelmann nlfff code ( red curves in fig .",
    "the uncertainties of the free energy , @xmath180 , are empirically determined from the median daily fluctuations of the free energy , which varied in the range of @xmath181 erg for the cor - nlfff code , and @xmath182 erg for the phot - nlfff code .",
    "the free energies and their uncertainties , as well as the energy decrease ( @xmath3 ) during the 36 flare events are listed in table 2 , for both the cor - nlfff and the ( wiegelmann ) phot - nlfff code .",
    "the main result is that 29 out of the 36 flare events calculated with our cor - nlfff code exhibit a significant decrease in free energy during the flare time interval , while only 7 events show no significant change , either due to the smallness of the energy change or the large uncertainty of the method .",
    "likewise we find a significant energy decrease for most of the flares with the wiegelmann nlfff code , but about a 3 - 10 times smaller amount of energy decreases .",
    "for instance , during the x2.2 flare on 2011-feb-15 , 02 ut ( event # 16 , fig .",
    "10 top right panel ) , we detect an energy decrease of @xmath183 erg with the cor - nlfff code , while about the half amount of @xmath184 erg was detected with the wiegelmann nlfff code ( sun et al .",
    "2012a ) .    in fig .",
    "11 we compare the decreases of free energy @xmath185 with the goes 1 - 8  fluxes and find a weak trend of a correlation between the magnetic energy and the soft x - ray flux for the photospheric nlfff method ( sun et al .  2012 ) , with a linear regression fit of @xmath186 , while the coronal nlfff method shows no significant correlation . in flare models with magnetic reconnection",
    "we would expect that the dissipated magnetic energy is correlated with the radiative output of heated plasma during flares .",
    "the scatterplot in fig .",
    "11 illustrates also that the energy decreases detected with the photospheric nlfff code are about an order of magnitude smaller than those with the coronal nlfff code for small flares , and a factor of three for the largest flares .    in fig .",
    "12 we show the correlation of potential energies ( fig",
    ".  12 left panel ) and nonpotential energies",
    "( fig .  12 right panel ) between the coronal nlfff code and the photospheric nlfff code by wiegelmann for 600 time steps ( 12-min cadence ) during the entire 5-day period .",
    "both the potential and nonpotential energies correlate well during the first 3 days ( when the potential energy was @xmath187 erg ) , but deviate during the last two days . at this time it is not clear whether this discrepancy is due to some systematic center - to - limb effect in the de - rotation of photospheric vector magnetograms ( sun et al .",
    "2012a ) , or due to a center - to - limb effect in the decomposition of los magnetograms ( section 3.1 ) . in principle",
    ", the coronal nlfff code can represent vertically twisted field lines at any longitude , if the magnetic charges are properly decomposed from the magnetogram .    a linear regression fit in fig .",
    "12 shows that the potential energy is recovered by 85% with the coronal nlfff code , while the nonpotential energy is recovered by 74% . since the magnetic energy scales with the square of the magnetic field strength , the potential field",
    "is recovered by 92% , using @xmath144 magnetic source components in our decomposition technique .",
    "this difference causes a reduction of the free energy up to a factor of 4 for the coronal nlfff code , compared with the photospheric ( wiegelmann ) nlfff code ( fig .",
    "8d ) , which could indicate a systematic effect of higher twist in the non - forcefree zones of the photosphere and lower chromosphere .      when we analyze the time evolution of the free energy @xmath165 in the time profiles shown in figs .",
    "9 and 10 ( blue histograms ) , we see that almost none of the flares exhibits the expected behavior of a near - constant high level of free energy before the flare , which then decreases to a lower level during the impulsive flare phase , so that a simple energy difference between the levels before and after the flare could be used as a measure of the dissipated magnetic energy",
    ". instead we observe often a rapid increase of the free energy at the beginning of the impulsive flare phase , which we interpret as an illumination effect of highly twisted loop structures ( sigmoids ) that yield a high contribution of nonpotential energy to the free energy ( time step @xmath188 in fig .",
    "13 ) . in this scenario",
    ", it is still possible to measure the decrease of free energy after the peak ( time step @xmath189 in fig .",
    "13 ) , regardless whether the preflare level is low ( for invisible sigmoids ) or high ( after illumination , say when the flare - associated chromospheric evaporation process fills the sigmoids with dense plasma .",
    "once a sigmoid gets brighter , it will be detected with our automated loop detection scheme and will cause higher amounts of free energy in the cor - nlfff forward - fitting algorithm .",
    "in some cases we see multiple peaks of the free energy during the flare phase ( e.g. , secondary peak in time step @xmath190 in fig .",
    "13 ) , which are likely to be associated with spatially different twisted structures .",
    "we can apply the same interpretation of an illumination effect during intervals of increasing free energy and magnetic dissipation during the time intervals of decreasing free energy ( time step @xmath191 in fig .",
    "13 ) . in order to caclulate",
    "the total dissipated energy , we would have to add each decrease of the free energy during the impulsive flare phase .",
    "if multiple such episodes overlap in time , even the sum of all free energy decreases will be only a lower limit to the total dissipated energy , because the time overlap will partially cancel energy increases ( due to illumination effects ) and energy decreases .    in summary",
    ", we conclude that our method of estimating the dissipated free energy from the difference between the peak of the free energy during the preflare phase and the minimum after the impulsive flare phase will generally yield a lower limit .",
    "this scenario may be tested in future work by measuring the illumination effects and dissipation of free energy in spatially separated regions and with higher time resolution , and this way may yield more accurate estimates of the total dissipated magnetic energy in flares .",
    "the magnetic field of ar 11158 during a few days around the x2.2 flare on 2011-feb-15 , 02 ut , has been the subject of at least 40 different publications for the following reasons : ( 1 ) the x2.2 flare was the first x - class flare observed with sdo ; ( 2 ) the active region has been observed near the central meridian , which is favorable for any magnetic field extrapolation method , and ( 3 ) the hmi / sdo data have been calibrated and released ( hoeksema et al .",
    "2014 ) .",
    "the over 40 publications of this active region and its main x2.2 flare cover : the magnetic evolution as computed with nonlinear force - free codes ( sun et al .",
    "2012a ; jiang and feng 2013 ; inoue et al .",
    "2013 ; tarr et al .",
    "2013 ) and with stereoscopic comparisons ( wang et al .",
    "2014 ) , mhd magnetic flux - rope modeling ( schrijver et al .  2011 ) , the photospheric magnetic response to the flare ( wang et al .",
    "2012 , 2013 ; liu et al .  2012 , 2013 ;",
    "petrie 2012a , b ) , magnetic field collapse and quasi - periodic loop oscillations during the flare ( gosain 2012 ; dolla et al .",
    "2012 ) , coronal waves ( schrijver et al .  2011 ; olmedo et al .",
    "2012 ) , coronal mass ejection and interplanetary kinematics ( schrijver et al .  2011 ; maricic et al .  2013a , 2013b ) , velocity and magnetic transients of the flare ( maurya et al .",
    "2012 ; vemareddy et al .",
    "2012a , b ; petrie 2012a , b ) , horizontal flow motion during the flare ( beauregard et al .  2012 ; liu et al .  2013 ) , the sunquakes and helioseismic response to the flare ( kosovichev 2011 ; zharkov et al .  2011 , 2013 ; alvarado - gomez et al .  2012 ) , rapid sunspot rotation during the flare ( jiang et al .  2012 ; vemareddy et al .",
    "2012a , b ) , the euv continuum evolution during the flare ( milligan et al .  2012 ) , high - speed outflows shortly before the flare ( su et al .  2012 ) , flare - associated radio bursts ( borovik et al .  2012 ; chen et al .  2013 ; yashiro et al .  2014 ) , magnetic modeling and flare trigger of a preceding m - class flare ( kusano et al .  2012 ; toriumi et al .",
    "2013 ) , and spectroscopy of flows in the kernel of a following m - class flare ( young et al .",
    "2013 ) .",
    "studies on ar 11158 , which hosted the x2.2 flare , include the evolution of the nonpotentiality and helicity of the active region ( liu and schuck 2012 ; jing et al .  2012 ;",
    "song et al .",
    "2013 ; inoue et al .  2013 ; tziotziou et al .  2013",
    "; vemareddy 2012a , b ) , the quadrupolar magnetic configuration of the active region ( sun et al .",
    "2012b ) , the magnetic energy distribution of the active region ( shen et al .",
    "2013 ) , the magnetic calibration of photospheric doppler velocities in the active region ( welsch et al .",
    "2013 ) , automated loop tracing , and emission measure and temperature analysis of the active region ( aschwanden et al .",
    "2013a ) .",
    "a primary goal of this study is to establish the amount of energy that is dissipated during solar flares , which we hope to derive from the change of free magnetic energy during the flare time intervals .",
    "the largest flare during the analyzed time interval , the x2.2 flare on 2011 february 15 , 02 ut , is the most suitable event in this context , since we have free energy calculations from multiple nlfff codes : the wiegelmann code ( sun et al .",
    "2012a ) , an mhd relaxation code ( jiang and feng 2013 ) , and our cor - nlfff code based on forward - fitting to coronal loops . in table 3 we compile the different forms of energies that have been calculated for this flare .    the total ( nonpotential ) magnetic energy averaged from the four values listed in table 3 has a mean of @xmath192 erg , which corresponds to a mutual agreement within @xmath193 .",
    "the potential energies have a mean of @xmath194 erg and agree within @xmath195 .",
    "the free magnetic energy has a somewhat larger scatter , within a range of @xmath196 erg for the standard nlfff codes , with or without pre - processing , while we find with the cor - nlfff code a similar value , i.e. , @xmath197 erg .",
    "however , the largest discrepancy is found for the decrease of free energy during the x2.2-class flare , for which a relatively low value of @xmath198 erg has been found with the wiegelmann nlfff code ( sun et al .",
    "2012a ) , a mere @xmath193 of the available free energy , while we find about a double value for the energy decrease of @xmath199 erg with our coronal forward - fitting code , which makes up about 60% of the free available energy .",
    "this is a very intriguing result , because it sets a lower limit on the energy budget of the flare and may invalidate the results of some nlfff codes .",
    "we have some other complementary information on the energy input of this flare , from minimum - current corona modeling and from the virial theorem .",
    "using a magnetic charge topology ( similar to the magnetic source decomposition in our cor - nlfff code , see sections 2.2 and 3.1 ) , together with the minimum current corona model , the amount of reconnecting flux was calculated and a drop in the free magnetic energy of @xmath200 erg was found during the x2.2 flare ( tarr et al .",
    "2013 ) , which agrees within a factor of about two with our cor - nlfff code and the wiegelmann nlfff code ( sun et al .",
    "the nonpotentiality can also be calculated with the virial theorem ( chandrasekhar 1961 ; low 1982 ) , which yields an energy drop of @xmath201 erg ( vemareddy et al .",
    "2012b ) , and a similar amount of @xmath202 erg from an independent other calculation ( tziotziou et al .",
    "both of these values obtained with the virial theorem are comparable with our forward - fitting method , but exceed the value obtained with the wiegelmann code ( using pre - processed data ) by a factor of @xmath203 ( sun et al .",
    "2012a ) .",
    "another test of the plausibility of a free energy calculation is the positive balance after energy losses during a flare .",
    "the major part of the dissipated energy in flares is believed to be converted into acceleration of nonthermal particles and heating of the chromosphere by precipitating particles ( ions and electrons ) .",
    "a calculation of the nonthermal energy spectrum in the range of @xmath204 kev using rhessi data yielded a value of @xmath205 erg ( sun et al .",
    "2012a ) , which exceeds the energy budget caclulated with the wiegelmann code",
    "( @xmath206 erg ) , while it dissipates less than the magnetic energy budget calculated with our forward - fitting code ( @xmath207 erg ) .",
    "on the other hand , the total thermal energy produced in a flare can also be estimated from the differential emission measure ( dem ) distribution obtained in soft and euv wavelengths , for which we find at the flare peak , using aia / sdo data , a total thermal energy of @xmath208 erg ( which makes about 30% of the energy budget ) , with a peak temperature of @xmath209 mk , a peak electron density of @xmath210 @xmath211 ( assuming a filling factor of unity ) , and a flare radius of @xmath212 mm ( aschwanden et al .",
    "other forms of energy losses have been determined in ly@xmath43 , soft x - rays , ly continuum , etc .",
    "( table 3 ) with eve / sdo ( milligan et al .",
    "2012 ) , which are all smaller than @xmath213 of the free magnetic energy .    in summary ,",
    "the decrease in free energy during the x2.2 flare is consistently determined to be @xmath214 erg with our forward - fitting code and with the virial theorem .",
    "the estimated energy losses due to acceleration of nonthermal particles and heating of the thermal plasma do not exceed this energy budget .",
    "the same conclusion holds for the 5 m - class flares that occurred in the same active region during the time period of 2011 febr 12 to 17 , for which we have energy changes calculated with the virial theorem ( vemareddy et al .",
    "2012b ; tziotziou et al .",
    "2013 ) , and for which we have calculations of the total thermal energy ( aschwanden et al .",
    "2013a ) , as compiled in table 4 . for additional comparisons of the energy budget in flares",
    "see also fig .  4 in emslie et al .",
    "( 2012 ) , and emslie et al .",
    "( 2004 , 2013 ) . in the latter studies , however , the free magnetic energy is not determined , but only the total potential field energy is given instead , which is about an order of magnitude larger than the free energy that is available for energy dissipation during flares .",
    "therefore , our study provides much stronger contraints on the upper limit of the flare energy budget .",
    "this is the first study that quantitatively compares the coronal magnetic field computed by photospheric ( extrapolation ) and by coronal ( forward - fitting ) methods . in principle",
    "we aim to calculate the same nonlinear force - free field solution in a given computation box , but the significant differences we find here may provide important information on systematic errors of each magnetic field calculation method , or on the non - forcefreeness in the lower chromosphere .",
    "a recent review on the success and future improvements of nlfff codes is given in regnier ( 2013 ) .      here",
    "we discuss a quantitative comparison between the photospheric nlfff extrapolation code ( wiegelmann ( 2004 ) , as applied in sun et al .",
    "( 2012a ) , and the coronal forward - fitting ( cor - nlfff ) code used in this study . in fig .",
    "8 we show the evolution of the free energy over a time interval of 5 days computed in 1200 time steps ( fig .",
    "8d ) , along with the potential ( fig .",
    "8b ) and nonpotential energy energy ( fig .",
    "we show also the correlation of the potential @xmath1 and nonpotential energy @xmath0 between the two codes in fig .  12 .",
    "we make the following findings : ( 1 ) the potential magnetic energy agrees with good accuracy between the two codes , at least during the first three days when the active region is near disk center .",
    "it is not clear whether the deviations during the last two days is due to a center - to - limb effect or due to a difference in the computation box .",
    "( 2 ) the free energy obtained with the wiegelmann nlfff code exceeds that of the cor - nlfff code up to a factor of 4 ( fig .",
    "8d ) ; ( 3 ) the decrease of the free energy measured with the wiegelmann nlfff code during flares is reduced by an amount of up to an order of magnitude , compared with the cor - nlfff code .",
    "the energy descrease falls short of the nonthermal energy required to accelerate hard x - ray producing electrons during the x2.2 flare . on the other side ,",
    "the free energy decrease during the x2.2 flare obtained with the cor - nlfff code , @xmath215 erg , is consistent with the values obtained with the virial theorem ( vemareddy et al .",
    "2012 ; tziotziou et al .",
    "( 4 ) the time profile of the free energy obtained with the wiegelmann code exhibits about an order of magnitude less variability than with the cor - nlfff code . in the following we discuss different effects that possibly could explain these discrepancies between the two codes .",
    "both codes are using the original hmi data with a pixel size of @xmath69 .",
    "the hmi data used for the wiegelmann nlfff code are averaged down to two pixels ( @xmath216 ) ( sun et al .",
    "2012a ) , while the data used for the cor - nlfff code are rebinned to three hmi pixels ( @xmath217 ) , for which the optimum match in the gaussian decomposition of the line - of - sight magnetograms was established ( fig .",
    "it was speculated ( sun et al .",
    "2012a ) whether small - scale fields with large gradients could cause electric currents that are unresolved with the averaged hmi data , which could lower the resulting free energy .",
    "however , the spatial resolution of hmi data should affect both codes in a similar manner , since both codes used averaging of two or three pixels , and thus the averaging can not explain the discrepancy of the obtained free energy between the two codes .",
    "one constraint of standard nlfff codes is the planar computation box with cartesian geometry , which requires a remapping of an active region at heliographic position @xmath218 to disk center @xmath219 .",
    "the remapping transforms a fraction of the transverse field to the line - of - sight field component , which scales with the sine - function of the center - to - limb distance . in the study of sun",
    "( 2012a ) , re - mapping of the hmi magnetogram using the lambert equal area projection has been used , which is different from the cor - nlfff code , where the full sphericity of the sun is taken into account and no remapping is needed . however , since the x2.2 flare occurred near disk center , this effect should be very small and can not explain the discrepancy in the free energy .      for the forward - fitting to coronal loops we used the hmi 45 s data , which were processed by the hmi team from 135 s time intervals",
    ", so we see variability of the magnetic field down to about 2 minutes .",
    "the time step in modeling of aia data is 6 minutes , but the exposure times of aia are typically @xmath220 s. we ran the wiegelmann nlfff code with a time step of 12 minutes , which was processed by the hmi team from 1350 s ( 22.5 minute ) time intervals .",
    "thus part of the much lower modulation depth of the free energy calculated with the wiegelmann nlfff code could be due to the poorer time resolution",
    ". the data noise in the hmi data with 1350 s would be , compared with the hmi 135 s data used for coronal forward - fitting , a factor of @xmath221 lower . however , since we detect about a factor of 10 less decrease of free energy during flares between the two methods ( fig .",
    "11 ) , there is still a factor of 3 less modulation depth unexplained .      before using the wiegelmann nlfff code ,",
    "the photospheric vector magnetograph data were `` pre - processed '' , a procedure that minimizes the flux , force , and torque of the 3d magnetic field vectors ( wiegelmann et al .",
    "it is suspected that the pro - processing may introduce too much smoothing ( or time averaging ) in the photospheric data , which could reduce the electric currents and this way causes an underestimate of the free energy ( sun et al .",
    "2012a ) . in the study of jiang and",
    "feng ( 2013 ) , the pre - processed data yield about @xmath222 smaller total and potential energies than the raw data , resulting into about @xmath223 less free energy for the x2.2 flare .",
    "this small difference can not explain why we measure a factor of 2 different decrease in the free energy during the x2.2 flare .",
    "the cor - nlfff code performs forward - fitting of an approximate nlfff solution to the shapes of coronal loops .",
    "this code is designed to fit the observed loop geometries , and thus retrieves the helical twist of loops .",
    "the helical twist of magnetic field lines plays a key role before large flares , such as observed here , which was confirmed with a 3d nlfff magnetohydrodynamic ( mhd ) relaxation method ( inoue et al .",
    "the latter method determined one - half to one - full twist before the m6.6 and the x2.2 flare ( inoue et al .",
    "2013 ) , which clearly untwisted after the x2.2 flare , as it can be seen in the northern portion of ar 11158 in fig .  7 , depicted in two forward - fits before and after the flare peak .",
    "the accuracy of the best - fit solutions of the cor - nlfff code is typically a median misalignment angle of @xmath224 ( fig",
    ".  8 bottom ) , which corresponds to a 3d misalignment angle of @xmath225 .",
    "in contrast , standard nlfff codes , which by definition do not use any information of the observed coronal geometry , end up with typical 3d misalignment angles in the range of @xmath226 ( derosa et al .",
    "the misalignment angle @xmath227 is directly related to the force - free parameter @xmath43 , and thus to the free energy . if a misalignment angle @xmath228 increases to the double value in a bad fit , this translates into a doubled azimuthal ( nonpotential ) magnetic field component @xmath229 , an thus to a free energy ratio squared , i.e. , @xmath230 .",
    "for instance , if a nlfff solution is misaligned by @xmath231 , the free energy increases from @xmath232 to a value of @xmath233 , or the total nonpotential energy changes from @xmath234 to @xmath235 , which represents an increase of @xmath236 .",
    "this example may explain part of the discrepancy in free energies , which are about a factor of 4 higher when determined with a photospheric extrapolation code ( such as the wiegelmann nlfff code used in sun et al .",
    "2012a ) , compared with the cor - nlfff code that performs forward - fitting to coronal loops .",
    "the most plausible solution for the observed discrepancy in misalignment angles is that the photospheric magnetic field has about a factor of @xmath237 higher azimuthally twisted field components in the non - forcefree zones than the coronal loops in the forcefree corona , which would produce a factor of 4 higher free energy for extrapolation codes that use the photospheric transverse field ( which mostly contains the azimuthal twisted field component ) .",
    "consequently , the coronal loops do not have a uniform twist all the way down to the photosphere , but increase their twist angle by a factor of about 2 at the photospheric footpoints .",
    "another possible reason for the apparent underestimate of the free energy during the x2.2 flare using the wiegelmann code has been attributed to the dynamics of the eruption , which could possibly produce a strong deviation from a force - free state during the postflare phase ( sun et al .",
    "however , the non - forcefreeness during the eruption should affect both the wiegelmann nlfff code and the cor - nlfff forward - fitting method in a similar way , because both codes calculate the nlfff solution under the assumption of force - freeness , and thus it can not explain the discrepancy in the free energy between the two codes . moreover , the free energy calculated from photospheric data is up to a factor of 4 larger than the values calculated from forward - fitting of coronal data ( fig .",
    "8d ) , measured at 1200 time steps during the entire time period of 5 days , and thus the discrepancy in free energies is persistently present , not just only during times of flaring or cmes .",
    "however , inspecting fig .",
    "12b , there is a saturation apparent when the photospheric nonpotential energy reaches the highest values of @xmath238 erg , while the coronal free energies can exceed this limit , which may indicate a photospheric line - tying effect .",
    "a striking difference is the time evolution of the free energy , as calculated at 1200 time steps over 5 days , is the degree of flucutations in the time profile @xmath165 between the two codes ( fig .  8c , 8d ) .",
    "the time profile of the coronal cor - nlfff code shows about an order of magnitude larger modulation depth than the photospheric wiegelmann nlfff code .",
    "are those fluctuations real ?",
    "the largest peaks and the decreases of the free energy @xmath165 do indeed correlate with flaring events , such as evidenced by the goes light curves ( figs .",
    "8a ) and the expanded time profiles of @xmath165 ( fig .",
    "we compare the evolution of the nonpotentiality and helicity in the active region 11158 ( from fig .",
    "12 and 14 in liu and schuck 2012 ) .",
    "we show a juxtaposition of the time profiles of the free energy ( obtained with the coronal cor - nlfff code ) and the helicity flux ( liu and schuck 2012 ) in fig .",
    "14 , which agree in the general trend of a systmatic increase over the 5 days of observations , while detailed correlations can not be established due to the noise in the helicity flux ( estimated to be 23% by monte - carlo simulations with the dave4vm code of schuck 2008 ) .",
    "in contrast , the photospheric ( wiegelmann ) nlfff code ( fig .",
    "14a ) shows a peak of the free energy at the beginning of the third day ( during the largest flare ) , and then decreases during the next two days , which is different from the evolution of the coronal free energy ( fig .",
    "14b ) and the helicity flux ( fig .",
    "in this study we improved the accuracy and performance of the _ coronal non - linear force - free field ( cor - nlfff ) _ forward - fitting code substantially by ( 1 ) implementing an automated loop tracing code for detection of coronal loops in multi - wavelength euv images , which makes the manual or visual loop tracing unnecessary ( aschwanden 2010 ) , and ( 2 ) by optimization of the forward - fitting technique to 2d loop coordinates , which relinquishes 3d reconstruction with stereoscopy ( aschwanden 2013c ) . in this study",
    "we applied the cor - nlfff code to magnetic field modeling of ar 11158 during the time interval of 2011 feb 12 to 17 , which includes an x2.2 flare plus 35 m and c - class flares .",
    "we calcuated the free magnetic energy over the 5 days with a cadence of 6 minutes and compare the results with standard nlfff calculations using the wiegelmann code with a cadence of 12 minutes .",
    "we compare quantitatively the magnitude and evolution of the free energy during the goes - detected flares , in particular the detected decreases of free energy before and after the flares with both types of codes . the standard nlfff codes ( wiegelmann 2004 ; jiang and feng 2013 ) use extrapolation of photospheric vector magnetograph data ( with or without pre - processing ) , while our forward - fitting cor - nlfff code uses coronal loop constraints .",
    "we compare also calculations with the virial theorem .",
    "the results are the following :    1 .   the total nonpotential magnetic energy measured during the x2.2 flare on 2011 febr 15",
    ", 02 ut , agrees well ( @xmath193 ) between photospheric standard nlfff codes and the coronal forward - fitting code , i.e. , @xmath192 erg .",
    "however , the total energy determinied with the virial theorem is about a factor of two lower , i.e. , @xmath239 erg , probably due to a different computation box .",
    "the potential energy measured during the x2.2 flare agrees also well ( @xmath195 ) between the two types of codes ,",
    "i.e. , @xmath240 erg",
    ". the small difference , which is commensurable with the calibration of hmi and uncertainties among different nlfff codes , corroborates the accuracy of the potential field modeling approach in terms of a a limited number of decomposed magnetic souces . the potential energy calculated with the virial theorem ,",
    "@xmath241 erg , is a factor of 3 smaller , similar to the nonpotential energy , probably due to a different computation box .",
    "the free magnetic energy measured during the x2.2 flare , i.e. , the difference between the nonpotential and potential energy , disagrees by a factor of about two between the two types of codes . for standard nlfff codes",
    "we find a value of in the range of @xmath196 erg , varying by about @xmath223 with or without pre - processing , while we find a similar value of @xmath242 erg with the coronal forward - fitting cor - nlfff code , so there is almost agreement between all codes in this case .",
    "the most critical quantity is the decrease of free magnetic energy before and after the x2.2 flare , which sets an upper limit on the energy budget of flares .",
    "we find a decrease in the free energy by @xmath198 erg with the standard photospheric nlfff code ( sun et al .",
    "2012a ) , which is about half of the decrease measured with the coronal forward - fitting cor - nlfff code , i.e. , @xmath243 erg , which is also consistent with the energy drop calculated with the virial theorem i.e. , @xmath244 erg ( vemareddy et al .",
    "2012 ) , or @xmath245 erg ( tziotziou et al .",
    "the fact that photospheric nlfff codes measure a higher amount of free energy than the coronal nlfff codes , but a too low decrease during flares , could partly be due to a smoothing and time - averaging effect of the pre - preprocessing algorithm .",
    "the time evolution of the free energy , as calculated with a time resolution of 12 minutes over 5 days with both types , exhibits a systematic discrepancy in the amount of free energy obtained with the photospheric nlfff versus the coronal nlfff code .",
    "since the free energy is dominated by the nonpotential transverse photospheric field , which corresponds to the azimuthal field component @xmath59 in helically twisted field lines , it is conceivable that the twist of field lines is not uniform along their length , but could be stronger twisted by about a factor of @xmath246 in the non - forcefree photosphere , and this way could explain why standard nlfff codes produce a factor of @xmath220 higher free energies than coronal - fitting nlfff codes",
    ". 6 .   among the 36 goes c , m , and x - class flares",
    ", we find a significant decrease in the free magnetic energy during the flares in 29 cases with the cor - nlfff code .",
    "similarly we find a significant decrease in many cases with the photospheric nlfff code , however the energy drop is about a factor of @xmath247 smaller for the photospheric nlfff code than for the coronal ( cor - nlfff ) code , and thus confirms statistically the same trend as we found for the x2.2 flare . 7 .",
    "the time evolution of the free energy in time steps of 12 minutes over 5 days exhibits about an order of magnitude stronger modulation depth for the coronal nlfff code than for the photospheric nlfff code , which is likely to be produced by the same effect that produces smaller energy decreases during the 36 flares , which could be partially be attributed to the smoothing effects of the pre - processing algorithm .",
    "this study represents the first comparative test case between photospheric and coronal nlfff codes , which revealed discrepancies resulting from the inconsistency between the photospheric non - forcefree and the coronal force - free field .",
    "it appears that the so far existing preprocessing algorthm that supposedly optimizes the photospheric field into a force - free field , is not consistent with the coronal force - field extrapolated downward to a photospheric altitude level .",
    "therefore we conclude that the coronal field can not be retrieved from photospheric information alone , but requires explicit information from the magnetic field in the force - free corona . while the present cor - nlfff code used here",
    "is based on an analytical approximation that is accurate two second order , more advanced nlfff codes that include the geometry of coronal loops should be developed in future .",
    "one code in this direction , using a quasi - grad - rubin scheme is under current development ( anna malanushenko , private communication ) , using visually traced loops as input .",
    "of course , ultimate objectivity can only be achieved with automated loop recognition algorithms .",
    "the default control parameters of the _ coronal non - linear force - free field ( cor - nlfff ) _ forward - fitting code used here are listed in table 1 .",
    "the accuracy of the forward - fitting results is primarily quantified with the median 2d misalignmen angle @xmath90 between the theoretical and observed ( loop - aligned ) magnetic field , obtained from the best forward - fit ( which should converge to small values in the optimum case ) .",
    "another test quantity is the ratio of the nonpotential to the potential energy , @xmath85 , which should be a slowly - varying function of time during non - flaring episodes , and is expected to display a decrease during flares , the time interval when magnetic energy is dissipated .",
    "therefore , in the following parametric study we demonstrate how these two quantities @xmath90 and @xmath248 vary as a function of the numerical input parameterers ( figs .  15 and 16 ) .",
    "all tests of this parametric study are performed with aia and hmi data from 2011-february-15 in the time interval starting at 00:00:00 ut and ending 12 s later , in a field - of - view of @xmath249 $ ] solar radii in east - west direction and @xmath250 $ ] in south - north direction . since the cor - nlfff code takes the full sphericity of the sun into account , no transformation to sun center is needed , as it would be required for most traditional nlfff codes with a planar boundary of the computation box centered at sun center .    what is the ideal hmi resolution for our code ?",
    "the hmi magnetogram has a full resolution of @xmath251 solar radii .",
    "we rebin the magnetogram by factors of 1 to 10 hmi pixels and show the obtained non - potential energy @xmath67 and potential energy @xmath1 as a function of the rebinned spatial resolution @xmath73 ( fig .",
    "15a ) and their ratio @xmath85 ( fig .",
    "15b ) , respectively .",
    "we see a sharply peaked function @xmath252 that peaks at @xmath253 ( or 3 hmi pixels )",
    ". we can understand this function as a combination of two effects , i.e. , ( i ) the undersampling of overresolved structures in the magnetogram in the case of @xmath254 hmi pixels , and ( ii ) over - smoothing of unresolved structures in the case of @xmath255 hmi pixels .",
    "the undersampling results because of the limited number of modeled magnetic source structures ( typically @xmath256 ) in magnetograms , which cover a full - resolution size of @xmath257 pixels , with a sizable fraction @xmath258 containing a significant magnetic field strength .",
    "the limitation of @xmath259 of the code causes an underestimate of both the potential as well as the nonpotential magnetic energy at high spatial resolution .",
    "if we approximate the area with high magnetic field strengths with a mean value @xmath260 , the total magnetic energy is expected to scale as @xmath261 for @xmath259 , which is a quadratic function of the pixel size and fits the observed function in the range of @xmath262 pixels ( left red curve in fig .",
    "15a ) . on the other side , above the critical limit where the number of model components is sufficient to cover the number of macropixels , i.e.",
    ", @xmath263 , we expect that the rebinning conserves the magnetic flux @xmath264 , but the rebinned field strength @xmath265 scales then reciprocally with the macropixel size , i.e. , @xmath266 , which leads to a quadratic decrease of the magnetic energy as a function of the ( rebinned ) macro pixel size , i.e. , @xmath267 ( right red curve in the range of 3 - 10 hmi pixels in fig .",
    "therefore , the least biased magnetic energy is measured at the critical limit @xmath268 , which turns out to be 3 hmi pixels here ( or @xmath269 km ) . in other words ,",
    "the critical scale of @xmath270 km represents the optimum scale where the number of model sources match the number of significant magnetic sources , so that the side effects of under - resolving and over - resolving dissappear .",
    "hence we are using rebinned magnetograms with @xmath271 hmi pixels throughout this study .",
    "the coverage of the fitted magnetic areas can be seen from the circles displayed in the bottom panels of fig .",
    "17 , for three different resolution scales ( 1 , 3 , and 10 hmi pixels ) .",
    "the spatial resolutions shown in fig .",
    "17 are ( @xmath272 , and 0.005 solar radii ) .",
    "we find a maximum in the detection of nonpotential magnetic energy of @xmath273 erg , a potential energy of @xmath274 erg , a free energy of @xmath275 erg , which corresponds to an energy ratio of @xmath276 ( fig .",
    "15b ) , or a free energy of 13% of the potential energy .",
    "these values agree with other studies using the traditional nlfff method , i.e. , @xmath277 erg ( sun et al .",
    "2012a ; jiang and feng 2013 ) .",
    "the mean misalignment angle of the best - fit non - potential field using our cor - nlfff model is @xmath278 ( fig .",
    "16b ) , while the potential field has a misalignment of @xmath279 ( fig .",
    "what is the optimim number of magnetic sources that is needed for the decomposition of the los magnetogram and construction of the model map ? in the three examples shown in fig .",
    "17 we used @xmath144 magnetic sources , which appears to be sufficient to represent most of the magnetic flux down to a level of a few percent , even for this case of a complex active region two hours before an x - class flare .",
    "we varied the number of decomposed magnetic sources from @xmath280 to @xmath281 and found a quite robust behavior in the best - fit value of the nonpotential energy ratio @xmath282 for @xmath283 ( fig .",
    "15c ) , with a mean misalignment angle of @xmath278 ( fig .",
    "we choose @xmath144 as default value .",
    "the threshold level of automated loop detection in different wavelength filters is empirically determined by visual inspection of false loop detections in noisy image areas .",
    "we find a good discrimination for the following factors of the median flux ( obtained from the boundary areas of the highpass - filtered euv images ) : @xmath284 $ ] for the wavelengths @xmath285 $ ] . in our parametric study",
    "we vary these median levels by a factor of @xmath286 .",
    "the obtained energy ratios @xmath287 ( fig .",
    "15d ) and misalignment angles @xmath90 ( fig .",
    "16d ) show almost invariant values as a function of the flux threshold variation , which corroborates the robustness of our loop detection scheme .",
    "we vary now the parameters that affect the selection of loops ( section 3.2 ) .",
    "let us first consider the different wavelength filters ( @xmath82 ) .",
    "the nonpotential energy ratios @xmath85 retrieved from each single wavelength separatetly are shown in fig .  15e , which obviously demonstrates that not each wavelength contains a representative subset of nonpotential loops .",
    "if we combine the loop tracings from all 7 wavelength filters , we find a value of @xmath288 ( or 13% free energy ) , which is approximately retrieved by those wavelength filters that contain representative subsets of the loops ( fig .",
    "however , some filters yield values that deviate substantially from the mean , and thus seem not to contain a representative sample of loops . investigating the misalignment angles @xmath90 for these seven filters ( fig .",
    "16e ) , we see that the best - fit values in each wavelength converge to a range of @xmath289 , while the synthesized set of loops from all wavelengths yields @xmath290 .",
    "we conclude that a well - balanced sample of loops synthesized from all wavelength filters is required to obtain the correct free energy .",
    "if we combine all seven filters , we obtain about 1000 loop structures .",
    "if we limit the maximum number of loops extracted per wavelength filter to @xmath291 , we obtain @xmath292 loops , which reduces the computation time by a factor of two .",
    "the parametric study shown in fig .",
    "15f shows that we can reduce the number down to @xmath293 without changing the result of the nonpotential energy . only below that limit",
    "we loose too much potential loops ( mostly in the 171 and 193  images ) so that the sample is not representative anymore .",
    "thus we choose @xmath146 as default value .",
    "the misalignment angle is nearly insensitive to the maximum number of selected loops per wavelength ( fig .",
    "16f ) .    besides the minimum loop length criterion defined in the loop tracing algorithm",
    ", we can additionally set a minimum loop length criterion @xmath84 for the subset of loops selected for forward - fitting .",
    "this allows us to balance the relative ratio of short loops ( which occur in the core of active regions and exhibit generally a higher nonpotential energy ) and long loops ( which occur in the outer shells of active regions and exhibit a more potential field characteristics ) .",
    "the parametric study in the range of @xmath294 $ ] pixels exhibits for @xmath295 pixels an overabundance of short loops , producing a relatively high nonpotential energy ratio @xmath296 , and inversely , an overabundance of long loops for @xmath297 pixels , which are mostly potential - like and produce a too low nonpotential energy ratio @xmath298 ( fig .",
    "thus , we choose an intermediate value of @xmath137 as default .",
    "the misalignment angle varies in the range of @xmath299 in this parameter range ( fig .",
    "16 g ) .",
    "the automated loop tracing code picks curvi - linear structures with a minimum curvature radius @xmath79 , while structures with shorter curvature radii often result from `` curved chains '' of moss structure ( berger et al .",
    "tests with curvature radii varied from @xmath300 to 60 pixels reveal no systematic tendency of the best - fit non - potential energy ratio @xmath85 ( fig .",
    "16h ) or misalignment angle .",
    "thus we choose @xmath136 pixels as default value .",
    "the most common false loop structures are : ( 1 ) curved chains of moss features , ( 2 ) saturated pixels during strong flares , ( 3 ) vertical streaks from pixel bleeding in the ccd camera during strong flares , and ( 4 ) diffraction patterns from the entrance mesh filter during intense flares .",
    "features ( 1 ) and ( 4 ) can mostly be filtered out by a minimum loop length requirement ( which is choosen here to be @xmath301 aia pixels ) .",
    "loop structures containing saturated pixels are rejected based on their flux value ( @xmath302 dn / s ) .",
    "vertical streaks from pixel bleeding are also easily detected by their small variation in x - coordinates ( less than one pixel , either in the northern or southern half of the automatically detected structures ) .",
    "the rejection of false loop structures improves the best - fit solution significantly , as we tested in images during flare peaks .    .",
    "forward - fitting is carried out at @xmath303 loop 2d positions @xmath304 , @xmath305 , where @xmath306 is the number of selected loops , and @xmath96 is the number of loop segments per loop , distributed equidistantly along the automatically traced loop segments .",
    "a too small number of loop segments may not be sufficient for a representative fit , and a too large number consumes more computation time .",
    "the parametric study in fig .",
    "15i and 16i shows that the nonpotential energy is robustly retrieved for @xmath307 to 15 .",
    "we choose @xmath308 as default value .",
    "the @xmath43-parameter is varied for each magnetic source within a range of @xmath309 for every magnetic source in each iteration cycle .",
    "if we choose @xmath310 too small , we need a too large number of iterations to converge , requiring too much computation time .",
    "if we choose it too large , the minimization of the misalignment angle per iteration misses the local maximum and will fluctuate erratically instead of converging steadily to the absolute minimum . the parametric study in fig .",
    "15j and 15j show that the nonpotential energy is stably retrieved in the range of @xmath311 [ @xmath312 .",
    "we choose @xmath313 $ ] as default value .",
    "the height of the computation box can possibly affect the forward - fitted loop solutions , because larger heights contain more ambiguities in the reconstruction of the line - of - sight coordinate @xmath106 for each of the fitting points .",
    "in addition , increasing the altitude yields a slightly higher amount of volume - integrated magnetic energy . the parametric study shown in figs .",
    "15k and 15k , however , shows an invariant retrieval of the nonpotential energy for altitude ranges of @xmath314 solar radii .",
    "we choose @xmath143 as default value .",
    "our chosen forward - fitting method is the powell method , which determines the local minimum for each free parameter @xmath40 sequentially per iteration cycle .",
    "an example of the change of misalignment angle @xmath228 and nontpotential energy ratio @xmath85 as a function of the iteration cycle is shown in fig .",
    "15l and 15l , for @xmath315 .",
    "the misalignment angle starts with @xmath316 for the potential - field solution in the first iteration , and converges to a final best - fit value of @xmath317 after the fourth iteration .",
    "thus we choose @xmath318 as default value , since more iterations were found not to improve the goodness - of - fit significantly .",
    "the author appreciates the constructive comments by an anonymous referee and helpful discussions with allen gary , anna malanushenko , marc derosa , and karel schrijver .",
    "part of the work was supported by nasa contract nng 04ea00c of the sdo / aia instrument and the nasa stereo mission under nrl contract n00173 - 02-c-2035 .",
    "lll data selection : & date and time of observation & 2011 feb 15 , 00:00:00 ut + & instruments & aia , hmi ( sdo ) + & east - west field - of - view & [ 0.0268 , 0.3268]@xmath319 + & north - south field - of - view & [ -0.3885,-0.0885]@xmath319 + & aia wavelengths & 94 , 131 , 171 , 193 , 211 , 304 , 335 + & spatial pixel size & @xmath320 + loop tracing : & lowpass filter boxcar & @xmath138 pixels + & highpass filter boxcar & @xmath139 pixels + & image base level / median & @xmath321 + & minimum loop length & @xmath137 pixels + & minimum loop curvature radius & @xmath136 pixels + & field line step & @xmath322 + magnetic sources : & rebinned pixel size & @xmath271 pixel ( 1.5 , 0.0015 @xmath319 ) + & number of magnetic sources & @xmath144 + loop selection : & maximum number per filter & @xmath146 + forward - fitting:&minimization iteration method & powell + & minimum number of iterations & @xmath323 + & maximum number of iterations & @xmath324 + & maximum height & @xmath325 + & number of loop segments & @xmath308 + & @xmath43-parameter increment&@xmath326 +    rlrrrrrrr 1&2011-feb-13 13:43&c4.7 & 26@xmath327 6 & 10@xmath327 6 & -15@xmath327 9 & 129@xmath327 4 & 129@xmath327 4 & 0@xmath327 2 + 2&2011-feb-13 17:27&m6.6 & 65@xmath327 6 & 21@xmath327 6 & -44@xmath327 9 & 164@xmath327 4 & 142@xmath327 4 & -21@xmath327 2 + 3&2011-feb-13 21:16&c1.1 & 76@xmath327 6 & 25@xmath327 6 & -51@xmath327 9 & 167@xmath327 4 & 157@xmath327 4 & -9@xmath327 1 + 4&2011-feb-14 2:35&c1.6 & 46@xmath327 10 & 38@xmath327 10 & -7@xmath327 14 & 190@xmath327 4 & 190@xmath327 4 & 0@xmath327 3 + 5&2011-feb-14 4:29&c8.3 & 52@xmath327 10 & 29@xmath327 10 & -23@xmath327 14 & 196@xmath327 4 & 181@xmath327 4 & -15@xmath327 2 + 6&2011-feb-14 6:50&c6.6 & 75@xmath327 10 & 42@xmath327 10 & -33@xmath327 14 & 201@xmath327 4 & 200@xmath327 4 & 0@xmath327 2 + 7&2011-feb-14 8:38&c1.8 & 95@xmath327 10 & 40@xmath327 10 & -54@xmath327 14 & 209@xmath327 4 & 198@xmath327 4 & -11@xmath327 2 + 8&2011-feb-14 11:50&c1.7 & 44@xmath327 10 & 30@xmath327 10 & -14@xmath327 14 & 213@xmath327 4 & 210@xmath327 4 & -3@xmath327 1 + 9&2011-feb-14 12:40&c9.4 & 70@xmath327 10 & 33@xmath327 10 & -37@xmath327 14 & 219@xmath327 4 & 206@xmath327 4 & -13@xmath327 1 + 10&2011-feb-14 13:46&c7.0 & 70@xmath327 10 & 46@xmath327 10 & -24@xmath327 14 & 217@xmath327 4 & 208@xmath327 4 & -8@xmath327 1 + 11&2011-feb-14 17:20&m2.2 & 60@xmath327 10 & 34@xmath327 10 & -25@xmath327 14 & 244@xmath327 4 & 228@xmath327 4 & -16@xmath327 3 + 12&2011-feb-14 19:23&c6.6 & 52@xmath327 10 & 37@xmath327 10 & -14@xmath327 14 & 250@xmath327 4 & 241@xmath327 4 & -9@xmath327 3 + 13&2011-feb-14 23:14&c1.2 & 77@xmath327 10 & 44@xmath327 10 & -32@xmath327 14 & 264@xmath327 4 & 259@xmath327 4 & -5@xmath327",
    "2 + 14&2011-feb-14 23:39&c2.7 & 62@xmath327 10 & 40@xmath327 10 & -21@xmath327 14 & 265@xmath327 4 & 259@xmath327 4 & -5@xmath327 2 + 15&2011-feb-15 0:31&c2.7 & 92@xmath327 20 & 61@xmath327 20 & -31@xmath327 28 & 259@xmath327 6 & 250@xmath327 6 & -8@xmath327 4 + 16&2011-feb-15 1:43&x2.2 & 98@xmath327 20 & 36@xmath327 20 & -62@xmath327 28 & 256@xmath327 6 & 218@xmath327 6 & -37@xmath327 4 + 17&2011-feb-15 4:26&c4.8 & 61@xmath327 20 & 56@xmath327 20 & -5@xmath327 28 & 241@xmath327 6 & 230@xmath327 6 & -11@xmath327 2 + 18&2011-feb-15 10 : 1&c1.0 & 150@xmath327 20 & 53@xmath327 20 & -97@xmath327 28 & 214@xmath327 6 & 213@xmath327 6 & 0@xmath327 3 + 19&2011-feb-15 14:31&c4.8 & 179@xmath327 20 & 39@xmath327 20&-139@xmath327 28 & 198@xmath327 6 & 193@xmath327 6 & -4@xmath327 1 + 20&2011-feb-15 18 : 6&c1.7 & 147@xmath327 20 & 59@xmath327 20 & -88@xmath327 28 & 222@xmath327 6 & 208@xmath327 6 & -14@xmath327 3 + 21&2011-feb-15 19:30&c6.6 & 122@xmath327 20 & 47@xmath327 20 & -75@xmath327 28 & 223@xmath327 6 & 204@xmath327 6 & -18@xmath327 3 + 22&2011-feb-15 22:48&c1.3 & 87@xmath327 20 & 26@xmath327 20 & -61@xmath327 28 & 222@xmath327 6 & 209@xmath327 6 & -13@xmath327 5 + 23&2011-feb-16 0:57&c2.0 & 103@xmath327 34 & 50@xmath327 34 & -53@xmath327 48 & 214@xmath327 6 & 214@xmath327 6 & 0@xmath327 3 + 24&2011-feb-16 1:31&m1.0 & 207@xmath327 34 & 81@xmath327 34&-126@xmath327 48 & 205@xmath327 6 & 204@xmath327 6 & 0@xmath327 2 + 25&2011-feb-16 1:55&c2.2 & 136@xmath327 34 & 78@xmath327 34 & -58@xmath327 48 & 213@xmath327 6 & 203@xmath327 6 & -9@xmath327 2 + 26&2011-feb-16 5:39&c5.9 & 118@xmath327 34 & 93@xmath327 34 & -25@xmath327 48 & 219@xmath327 6 & 202@xmath327 6 & -16@xmath327 2 + 27&2011-feb-16 6:18&c2.2 & 131@xmath327 34 & 70@xmath327 34 & -61@xmath327 48 & 225@xmath327 6 & 197@xmath327 6 & -28@xmath327 3 + 28&2011-feb-16 7:34&m1.1 & 182@xmath327 34 & 58@xmath327 34&-123@xmath327 48 & 205@xmath327 6 & 205@xmath327 6 & 0@xmath327 4 + 29&2011-feb-16 9 : 1&c9.9 & 131@xmath327 34 & 49@xmath327 34 & -82@xmath327 48 & 224@xmath327 6 & 191@xmath327 6 & -32@xmath327 3 + 30&2011-feb-16 10:25&c3.2 & 61@xmath327 34 & 22@xmath327 34 & -39@xmath327 48 & 202@xmath327 6 & 201@xmath327 6 & 0@xmath327 3 + 31&2011-feb-16 11:58&c1.0 & 83@xmath327 34 & 16@xmath327 34 & -66@xmath327 48 & 199@xmath327 6 & 191@xmath327 6 & -7@xmath327 3 + 32&2011-feb-16 14:18&m1.6 & 192@xmath327 34 & 34@xmath327 34&-157@xmath327 48 & 181@xmath327 6 & 169@xmath327 6 & -11@xmath327 2 + 33&2011-feb-16 15:26&c7.7 & 218@xmath327 34 & 5@xmath327 34&-212@xmath327 48 & 180@xmath327 6 & 163@xmath327 6 & -16@xmath327 5 + 34&2011-feb-16 19:29&c1.3 & 177@xmath327 34 & 135@xmath327 34 & -41@xmath327 48 & 176@xmath327 6 & 170@xmath327 6 & -6@xmath327 3 + 35&2011-feb-16 20:11&c1.1 & 179@xmath327 34 & 89@xmath327 34 & -89@xmath327 48 & 180@xmath327 6 & 180@xmath327 6 & 0@xmath327 3 + 36&2011-feb-16 21 : 6&c4.2 & 248@xmath327 34 & 107@xmath327 34&-141@xmath327 48 & 159@xmath327 6 & 158@xmath327 6 & 0@xmath327 3 +    lll & & + total nonpotential energy @xmath67 & @xmath328 & sun et al .",
    "( 2012a ) + & @xmath329 & jiang and feng ( 2013 ) + & @xmath330 & vemareddy et al .",
    "( 2012b ) + & @xmath331 & ( this study ) + total potential energy @xmath332 & @xmath333 & sun et al .",
    "( 2012a ) + & @xmath334 & jiang and feng ( 2013 ) + & @xmath335 & vemareddy et al .",
    "( 2012b ) + & @xmath336 & ( this study ) + free magnetic energy @xmath68 & @xmath337 & sun et al .",
    "92012a ) + & @xmath338 & jiang and feng ( 2013 ) + & @xmath339 & ( this study ) + decrease of free energy @xmath340 & @xmath341 & sun et al .",
    "( 2012a ) + & @xmath342 & ( this study ) + minimum current corona ( mcc ) energy & @xmath343 & tarr et al.(2013 ) + energy drop from virial theorem & @xmath344 & vemareddy et al .",
    "( 2012b ) + energy drop from virial theorem & @xmath345 & tziotziou et al .",
    "( 2013 ) + & & + nonthermal energy rhessi ( 25 - 50 kev ) & @xmath346 & sun et al .",
    "( 2012a ) + thermal energy aia / sdo & @xmath347 & aschwanden et al .",
    "( 2013a ) + radiated energy in ly alpha & @xmath348 & milligan et al .",
    "( 2012 ) + radiatied in free - free continuum & @xmath349 & milligan et al .",
    "( 2012 ) + radiated in goes x - rays 1 - 8 a & @xmath350 & milligan et al .",
    "( 2012 ) + radiated in lyman continuum & @xmath351 & milligan et al .",
    "( 2012 ) + radiated in he i 304 a & @xmath352 & milligan et al .",
    "( 2012 ) + radiated in he i cont & @xmath353 & milligan et al .",
    "( 2012 ) + radiated in he ii cont & @xmath354 & milligan et al .",
    "( 2012 ) + helioseismic energy in 3 - 4 mhz band & @xmath355 & alvarado - gomez et al .",
    "( 2012 ) +    rrrrrrrrr 2&2011-feb-13 17:27 & m6.6 & -44@xmath327 9 & -21@xmath3272 & -4 & -43@xmath327 17 & -10 & 25 + 11&2011-feb-14 17:20 & m2.2 & -62@xmath327 28 & -16@xmath3273 & -3 & & -49 & + 16&2011-feb-15 1:43 & x2.2 & -68@xmath327 20 & -37@xmath3274 & -168 & -105@xmath327104 & -84 & 20 + 24&2011-feb-16 1:31 & m1.0 & -126@xmath327 48 & 0@xmath3272 & & & & 3 + 28&2011-feb-16 7:34 & m1.1 & -123@xmath327 48 & 0@xmath3274 & & & & 2 + 32&2011-feb-16 14:18 & m1.6 & -157@xmath327 48 & -11@xmath3272 & & & -65 & 5 +"
  ],
  "abstract_text": [
    "<S> we developed a _ coronal non - linear force - free field ( cor - nlfff ) _ forward - fitting code that fits an approximate _ non - linear force - free field ( nlfff ) _ solution to the observed geometry of automatically traced coronal loops . </S>",
    "<S> in contrast to photospheric nlfff codes , which calculate a magnetic field solution from the constraints of the transverse photospheric field , this new code uses coronal constraints instead , and this way provides important information on systematic errors of each magnetic field calculation method , as well as on the non - forcefreeness in the lower chromosphere . in this study we applied the cor - nlfff code to active region noaa 11158 , during the time interval of 2011 feb 12 to 17 , which includes an x2.2 goes - class flare plus 35 m and c - class flares . </S>",
    "<S> we calcuated the free magnetic energy with a 6-minute cadence over 5 days . </S>",
    "<S> we find good agreement between the two types of codes for the total nonpotential @xmath0 and potential energy @xmath1 , but find up to a factor of 4 discrepancy in the free energy @xmath2 , and up to a factor of 10 discrepancy in the decrease of the free energy @xmath3 during flares . </S>",
    "<S> the coronal nlfff code exhibits a larger time variability , and yields a decrease of free energy during the flare that is sufficient to satisfy the flare energy budget , while the photospheric nlfff code shows much less time variability and an order of magnitude less free energy decrease during flares . </S>",
    "<S> the discrepancy may partly be due to the pre - processing of photospheric vector data , but more likely due to the non - forcefreeness in the lower chromosphere . </S>",
    "<S> we conclude that the coronal field can not be correctly calculated based on photospheric data alone , but requires additional information on coronal loop geometries . </S>"
  ]
}