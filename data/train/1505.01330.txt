{
  "article_text": [
    "the fundamental problem of the analysis of beam dynamics is to solve the equation of motion for a multi particle system ( @xmath0 ) in presence of external forces ( caused by magnets , cavities etc . ) and self forces .",
    "a particular difficulty is to determine the self - fields of the dynamic many - particle system .",
    "the coarsest approximation to solve this problem is the space charge or poisson approach .",
    "it assumes that all particles are in uniform motion with identical velocity vector .",
    "therefore the problem is equivalent to an electrostatic problem , and in principle one has to add for each observer particle the one over distance contribution from all other sources .",
    "this point - to - point interaction would allow the slightly better approach of individual uniform motion per particle , but its effort scales as @xmath1 .",
    "this is avoidable by a continualization so that the point particles are represented by a smooth density function .",
    "additionally the continualization solves a second problem that is usually not in the focus of interest : the near scattering of particles that approach much closer than the averaged particle distance . a proper tracking with near scattering",
    "needs not only the point - to - point interaction but also a very fine time step related to the minimal distance between particles .",
    "continuous density functions and fields are numerically represented either by superpositions of basis functions ( finite element methods ) or by mesh methods . in this report",
    "we use a three dimensional equidistant mesh for binning and compute the static potential by a fast convolution with a green s function as described in @xcite .",
    "this green s function fulfills free space ( or open ) boundary conditions .",
    "also the electric field is calculated on the mesh , by numeric differentiation .",
    "the field is interpolated to the particle positions and transformed into a collective force as it appears in the equation of motion .",
    "the numeric integration of the equation of motion is not described here .",
    "the poisson - particle - mesh approach is used widely and successfully in beam dynamics for instance in straight sections with constant energy , but also in particle sources or accelerating sections and even in sections with weak curvature .",
    "sometimes the particle distribution has a fine sub - structure which has to be taken into account , for instance the particles perform plasma oscillations @xcite , a micro modulation builds up ( micro - bunch - instability ) or they interact in an undulator with a laser .",
    "such high resolution computations need very fine meshes and high particle ( or macro - particle ) numbers so that they become numerically very expensive .",
    "this numerical effort can be dramatically reduced when the approach assumes and utilizes periodicity : only the particles of one period have to be tracked and meshed .",
    "we describe such an approach where the periodicity of the source distribution is interchanged with the periodicity of the green s function . except for the calculation of the green s function ,",
    "the established method ( poisson - particle - mesh with equidistant mesh and fast convolution ) can be used completely unchanged .",
    "we consider periodicity into one direction .",
    "the direction is arbitrary and needs not to coincide with a mesh axis .",
    "perpendicular to this direction free space ( or open ) boundary conditions are realized .",
    "the report is organized as follows .",
    "section ii is about general aspects of periodicity . in section iii",
    "we describe the approach , first the standard method ( poisson , particle - mesh , convolution with green s function ) , then its modification with periodic green s function . in section iv we demonstrate the method with examples : the flash seeding section @xcite with different particle densities and modulations , and parasitic heating after the lcls laser heater @xcite . for comparison of field calculation methods",
    ", we did tracking simulations with astra @xcite and the non - periodic and periodic implementation of the method described in this report , called qfield .",
    "some aspects of spatial periodicity and pseudo - periodicity are illustrated in fig .",
    "[ per1 ] . the particles in panel ( a ) are randomly distributed while panel ( b ) shows a periodically repeated set @xmath2 of random particles .",
    "distribution ( a ) is caused by applying a periodic transport map to random particles that are uniformly distributed into the direction of periodicity .",
    "strictly periodic distributions as in ( b ) are used to approximate pseudo - periodic distributions as in ( a ) .    for the strictly periodic approach",
    "we consider only a set @xmath2 of non - repeated particles . as it can be seen in panels ( b - e )",
    "there are many sets @xmath2 that describe the same periodic distribution .",
    "it is easy to manipulate such sets by shifting particles by a multiple of the repetition vector @xmath3 . the sets in ( c ) and ( d ) are chosen so that all particles are in a volume slice , where the front plane corresponds to the back plane shifted by @xmath3 .",
    "these slices might have any orientation ( or shift ) , but there are orientations so that the volume of a box ( or sphere ) that includes all particles is minimal .",
    "the distribution in ( b ) are particles from one volume slice , that have been mapped by a periodic transport map .",
    "( particles with nearly the same spatial coordinates , but with different momenta may be mapped to very different spatial coordinates . ) for numerical reasons it might be advantageous to use sets without sudden change of density , as it can be seen in panel ( e ) .",
    "this set has been composed similar as ( c ) , but some particles close to the left boundary are shifted by @xmath3 ( beyond the right boundary ) and some particles close to the right boundary are shifted into the opposite direction .",
    "the probability of shifting depends on the distance to the boundary .    to keep periodicity , the set @xmath2 has to represent a distribution that is periodic in six dimensional phase space @xmath4 $ ] .",
    "periodically shifted particles are at @xmath5 , with @xmath6 the vector of six dimensional periodicity .",
    "the required property for the transport @xmath7 is @xmath8 .",
    "this is for instance fulfilled if only one spatial component of @xmath6 is non - zero and @xmath9 is a linear function of that component .",
    "real distributions are always pseudo - periodic since they are finite .",
    "sometimes only a small part of a ( long ) bunch behaves periodically , as for instance in figs .",
    "[ cur_250kev_before_after_ch3 ] , [ evz_250kev_189p4_204p2_astra_xyz2 ] .",
    "the phase space volume covered by the beam is usually small and the transport can be linearized , or at least locally ( for one ore few periods ) linearized .",
    "therefore the poisson approach can be used for distributions with finite extension in momenta space , although the uniform motion approach assumes identical momentum of all particles . in the same sense",
    "the periodical poisson approach is applicable to distributions with non - zero momentum components of @xmath6 , although this would mean particles with arbitrarily large momentum .",
    "an example is a bunch with energy chirp and micro modulation .",
    "the coulomb force drops with @xmath10 and the effect of a dipole perturbation drops with @xmath11 .",
    "therefore space charge effects are very localized and non - resonant .",
    "pseudo - periodic behavior can be observed even for distributions with only few periods , as it can be seen in the first example of section iv .",
    "the electro - magnetic field caused by a set @xmath12 of discrete point particles with charge @xmath13 , position @xmath14 and velocity @xmath15 is estimated based on the assumption of collective uniform motion ( of all particles ) with the velocity @xmath16 .",
    "the particle positions are represented by orthonormal coordinates @xmath17 , wherein the @xmath18-axis points in the direction of motion @xmath19 and the directions @xmath20 and @xmath21 are perpendicular .",
    "after lorentz transformation to the rest frame , the coordinates are @xmath22 with @xmath23 and @xmath24 .",
    "the electrostatic field may be computed from point - to - point interaction as @xmath25 with excluded self interaction .",
    "therefore @xmath26 is the subset of all particles without particle @xmath27 .",
    "the continualization replaces the particle distribution @xmath28 by a continuous charge density function @xmath29 and the electrostatic field @xmath30 is the negative gradient of the electrostatic potential @xmath31 finally we transform back to the moving frame @xmath32 and calculate the lorentz force @xmath33      a simple and robust continualization method is to approximate the discrete charges by a continuous distribution that is piecewise constant in the cells of an equidistant mesh .",
    "the mesh points @xmath34 are in the middle of the cells and the charges per cell are @xmath35 . for simplicity we have chosen the direction of motion @xmath36 to coincide with one mesh axis .",
    "this has numerical advantages , as the resolution requirement in longitudinal direction is usually very different from that into transverse directions , but it is not necessary .",
    "the choice of the perpendicular directions @xmath20 , @xmath21 is free .",
    "the electrostatic potential caused by the charge density @xmath37 in the cell which includes the origin , is @xmath38 with the green s function @xmath39 this integral can be solved as @xcite : @xmath40 with the anti - derivative @xmath41 and @xmath42 .",
    "the asymptotic behavior @xmath43 is obvious from eq .",
    "( [ greens_function_integral ] ) .    to compute the potential at all mesh points @xmath44 , caused by all mesh charges",
    ", one has to perform the summation @xmath45 with @xmath46 the green s function at the mesh points @xmath47 .",
    "this can be done efficiently by a three - dimensional fast convolution .",
    "the components of the electric field are determined as difference quotients ( f.i .",
    "@xmath48/h_z$ ] ) .",
    "these components , that are allocated on shifted meshes ( as @xmath49 ) , are interpolated to the lorentz transformed particle positions @xmath50 to find the fields @xmath51 in the rest frame .",
    "for an efficient computation of the green s function on the mesh , one utilizes the asymptotic behavior for points far from the origin and calculates only near points by eq .",
    "( [ greens_function ] ) .",
    "therefore one calculates first the anti derivative @xmath52 h_x,[k-1/2 ] h_y,[l-1/2 ] h_z)$ ] in one octant ( @xmath53 ) of the near - volume and then the green s function itself .",
    "the field in other octants follows from mirror symmetry .",
    "technically , the change to the asymptotic approximation is realized with a smooth switch function @xmath54 as `` switched '' green s function @xmath55 the volume of pure asymptotic behaviour follows from the condition @xmath56    in fig .",
    "[ g_approx ] the green s function is compared with the asymptotic approximation , and the ratios @xmath57 and @xmath58 are plotted for cubic mesh cells ( @xmath59 ) and for mesh cells with large aspect ratio ( @xmath60 ) .",
    "the relative deviation of the asymptotic function is below 0.001 for @xmath61 .",
    "note that the case of infinite aspect ratio ( @xmath62 ) is very similar to the case @xmath60 in the volume @xmath63 .",
    "the switch function is calculated for the parameters @xmath64 .",
    "the relative deviation of the `` switched '' function is below 0.001 for the hole volume .",
    "each particle of the set @xmath2 is infinitely repeated with the spatially periodic shift @xmath3 , see fig .",
    "[ per1]b - c .",
    "the continualization of the particles of the set gives the smooth density function @xmath65 and the periodic extension is @xmath66 the particles in @xmath2 and the continuous function @xmath65 generate the periodic behavior , but they are not restricted to a certain volume , as the volume of one period .",
    "as for two dimensional charge distributions with infinite size into the third dimension , the potential of periodic distributions is usually not limited to a finite range . therefore the poisson integral eq .",
    "( [ poisson_integral ] ) diverges for all observation points of interest !",
    "it is possible to avoid this and to achieve convergence , by normalizing the potential @xmath67 to be zero at a certain point @xmath68 .",
    "the gradient of @xmath69 is identical to that of @xmath70 . in the following",
    "we skip the tilde and write for the potential of the periodic distribution @xmath71 the summation term in the second integral can be interpreted as green s function of a periodically repeated point charge .",
    "the green s function of one mesh cell follows from the integration @xmath72 this can be expressed by the non - periodic green s function as @xmath73    to compute the potential at mesh points @xmath44 , caused by all mesh charges , one has to perform the summation @xmath74 with @xmath75 the integrated charge of density @xmath76 in mesh cell @xmath77 and @xmath78 the periodic green s function at the mesh points . therefore the field calculation for periodic source distributions can be done by the same method as for a non - periodic source , only the green s function and the source distribution have to be replaced by the periodic extension @xmath79 and the non - repeated representation @xmath80 .      for the numerical evaluation we set @xmath81 and split @xmath82 into the terms",
    "@xmath83 the finite sum is computed directly , using eq .",
    "( [ switched_greens_function ] ) .",
    "the number @xmath84 has to be chosen large enough , to fulfill the condition @xmath85 for all points in the computation volume , compare eq .",
    "[ criterion_for_far ] . in order to calculate the infinite sums",
    ", we use the asymptotic eq .",
    "( [ approximated_greens_function ] ) @xmath86 and the auxiliary function @xmath87    the auxiliary function @xmath88 is periodic in @xmath89 and can be written as fourier series @xmath90 the harmonic sum converges well for large values of @xmath91 , due to the @xmath92 behavior of the modified bessel function for large arguments .",
    "function values for positive @xmath84 are calculated by adding the finite sum @xmath93 .    for small values of @xmath94 the auxiliary function",
    "is calculated with help of a taylor expansion @xmath95 and the taylor polynomial @xmath96 with @xmath97 and @xmath98 the polygamma function . to reach the desired accuracy it can be necessary to split @xmath99 into a finite sum @xmath100 and an infinite part @xmath101 that is calculated by the taylor approximation for a sufficiently high number @xmath102 .",
    "the numerically calculated function @xmath88 and the deviation @xmath103 from a `` high precession '' result are plotted in fig .",
    "[ suf ] for @xmath104 $ ] and @xmath105 $ ] .",
    "the `` high precession '' result @xmath106 has been calculated to numerical accuracy by using a fourier series to sufficiently high harmonics or by a sufficiently high @xmath102 for the taylor expansion .",
    "the highest values of @xmath107 appear at @xmath108 where the type of expansion is switched .",
    "the fourier expansion is truncated after 8 terms , the taylor expansion uses @xmath109 .",
    "it is obvious from fig .",
    "[ per1 ] that the choice of @xmath2 is not unique .",
    "nevertheless the convolution of the continualizated density with the periodic green s function might result in the same values @xmath44 of the potential on the mesh .",
    "this happens if the mesh supports the periodicity , which means the vector @xmath3 coincides with a mesh vector @xmath110 as in fig .",
    "[ per2]b .    for practical simulations",
    "it is desirable to use a mesh that supports periodicity , and to shift the particles of the original set by a multiple of @xmath3 so that they fill a one - period - slice as in fig .",
    "[ per1]b and c. it stands to reason , to align the slice with respect to the mesh as in fig .",
    "a small volume of filled mesh cells is preferable .",
    "meshes that do not support periodicity can be favorable to avoid extreme aspect ratios of mesh cells , as it would happen for supported periodicity if the ratio of non - zero components of @xmath3 is extreme .",
    "such a mesh , as in fig .",
    "[ per2]d , gives reasonable results supposed the generating set @xmath2 is sufficiently smooth .",
    "( sudden changes of density have to be resolved by the discretization . )",
    "the potential has to be computed in a volume that overlaps partially with the shifted volume . in overlapping regions",
    "the potential is not quite identical , due to non - periodic discretization errors .",
    "therefore an appropriate interpolation between potentials in overlapping regions ( while entering one region and leaving the other ) helps to avoid discontinuous potentials and infinite fields .",
    "the periodical green s function has point symmetry to the origin @xmath111 .",
    "it is mirror symmetric @xmath112 if @xmath113 , or @xmath114 if @xmath115 , or @xmath116 if @xmath117 .",
    "in the seeding section of the flash free electron laser @xcite an electron bunch is energy modulated by an external laser and send through three chicanes and several undulators as it can be seen in fig .",
    "[ flash_seeding_section ] . to investigate microbunching effects the radiator undulator ( after chicane 1 ) and the sflash undulators ( after chicane 2 )",
    "have been switched off .",
    "the simulation starts directly after the modulator ( longitudinal position 162 m ) and ends 10 m behind after the transverse deflecting structure tds ( at longitudinal position 204.2 m ) .",
    "the initial beam ( after the modulator ) has the following properties : energy @xmath118 = 585 mev , charge 0.3 nc , normalized emittance 1.5 @xmath119 m , peak current 1.5 ka , uncorrelated energy spread @xmath120 = 150 kev and gaussian longitudinal and transverse profiles .",
    "therefore , the rms length is 80 fs .",
    "the beam has been energy modulated in the modulator undulator by a laser with wavelength @xmath121 = 800 nm .",
    "the duration of the laser pulse of minimal 30 fs ( fwhm ) is short compared to bunch length , but long enough to permit pseudo periodic behavior .",
    "as the optical beam in the undulator is much wider than the particle beam , the energy modulation amplitude @xmath122 ( of 250 kev ) is nearly transverse offset independent .",
    "effects in drift - quadrupole - lattices are the modification of particle energies , the modification of transverse optics and plasma oscillations . for the given parameters ,",
    "the energy effect is strongest , transverse defocussing is weak and the length for a full plasma oscillation , in longitudinal phase space , is about @xmath123 = 120 m @xcite .",
    "therefore the longitudinal phase space distribution is nearly not altered on the short distance to the first chicane .",
    "the longitudinal dispersion of the first chicane @xmath124 m couples relative energy deviations @xmath125 to longitudinal displacements @xmath126 , and creates density modulation due to the initial energy modulation .",
    "the effect of the second chicane is weak due to its small dispersion @xmath127 m .",
    "more important is the interchange between density and energy modulation , as it is typical for plasma oscillations , on the distance between chicane 1 and 3 of about @xmath128 .",
    "the bunch current with its modulation is shown in fig  [ cur_250kev_before_after_ch3]a . up to this position ,",
    "the energy modulation has grown by more than a factor of ten to an amplitude of about 4 mev .",
    "this amplification is beyond the linear regime and this will be exacerbated in the last chicane with @xmath129 m .",
    "this longitudinal dispersion is sufficient to shear particles , that were originally ( during modulation ) in one period , over several periods as it can be seen within the longitudinal phase space in fig .",
    "[ evz_250kev_189p4_204p2_astra_xyz2]a . at rollover",
    "`` points '' in longitudinal phase space , where the band with particles is folded back , current spikes appear as can be seen in fig .",
    "[ cur_250kev_before_after_ch3]b .",
    "these spikes cause strong space charge fields and lead to a complicated energy pattern after a further drift of about 15 m , see figs .",
    "[ evz_250kev_189p4_204p2_astra_xyz2]b .",
    "[ evz_250kev_189p4_204p2_astra_xyz2 ] has been calculated by the established space charge code astra @xcite with a three dimensional solver based on the particle mesh method .",
    "for comparison we did non - periodic and periodic simulations with our implementation , called qfield .",
    "the results of full - bunch simulations with 1e6 macro particles with astra and qfield - none - periodic can be seen in figs .",
    "[ evz_250kev_189p4_204p2_astra_xyz2 ] and [ evz_250kev_189p4_204p2_qfield_xyz ] , showing the longitudinal phase space after chicane 3 and 15 m downstream .",
    "the results are in good agreement .    to verify the periodic approach , we did a high resolution full - bunch simulation with 20e6 macro particles with qfield - none - periodic , and a periodic simulation with same macro particle density in only one period .",
    "the full - bunch simulations was done with longer laser modulation ( 60 fs , fwhm ) to increase the length of the pseudo periodic range .",
    "[ fig_189p4_1e6_20e6_per ] and [ fig_204p2_1e6_20e6_per ] show a short part of the longitudinal phase space around the middle of the bunch , directly after the last chicane and 15 m downstream .",
    "particles in gray are periodic repetitions of the simulated particles that are plotted in in blue .",
    "not all simulated particles in the observation range are plotted to avoid large over - painted areas .",
    "( the number of plotted particles is equivalent for the different plots . ) in the sub - panels [ fig_189p4_1e6_20e6_per]a , [ fig_204p2_1e6_20e6_per]a for the full - bunch , the non - periodic behavior due to finite modulation length is clearly observable .",
    "the sub - panels [ fig_189p4_1e6_20e6_per]b , [ fig_204p2_1e6_20e6_per]b for the full - bunch simulation with longer laser modulation show a nice quasi - periodic pattern that is in good agreement with the periodic results in figs .",
    "[ fig_189p4_1e6_20e6_per]c , [ fig_204p2_1e6_20e6_per]c .",
    "this example compares the three - dimensional periodic model with a one - dimensional impedance model , for a periodic distribution that is modulated and compressed to achieve current spikes of maximal amplitude .",
    "significant self effects happen on the drift - quadrupole - lattice after the four magnet compressor chicane .",
    "the one - dimensional impedance model averages the longitudinal field of a round gaussian beam versus the transverse offset , as derived in @xcite , see also @xcite .",
    "a periodic version of the one dimensional model was used for the comparison . ( the periodic repetition can be realized either by a summation of the spatially shifted field , or by a summation of the harmonics of the impedance in frequency domain . )",
    "the setup is the same as before , but with different parameters and only one active chicane : beam energy @xmath118 = 700 mev , bunch charge 0.3 nc , normalized emittance 1.5 @xmath119 m , peak current 45 a , uncorrelated energy spread @xmath120 = 3kev and gaussian profiles .",
    "the particle beam is energy modulated by a laser of wavelength @xmath121 = 267 nm with the modulation amplitude @xmath122 = 0.2 mev .",
    "the dispersion @xmath130 m of the first chicane is adjusted for maximum bunching and maximum current spikes as it can be seen fig .",
    "[ ex2_165p92 ] .",
    "the second and third chicane are switched off .",
    "directly before the first chicane , the phase space distribution is almost not changed by self effects , due to the small beam current , the high particle energy and the short travelled distance to this position .",
    "in contrast to the previous example , the particles are tracked through the magnetic fields of the chicane , but the effect of one- respectively three - dimensional self fields are so small , that fig .",
    "[ ex2_165p92 ] looks identical for both cases , and it is not to distinguish from the corresponding figure for a calculation without self - fields .",
    "the sharpness of the current spikes is not only determined by uncorrelated energy spread and longitudinal dispersion , but also by transverse emittance and second order coupling to the longitudinal direction .",
    "the current spikes are very short and the bunching factor @xmath131 is above ten percent even for spectral lines beyond the 30th harmonic .",
    "the required resolution of the longitudinal mesh has to be much better than than @xmath132 .",
    "it is set to 0.6 nm , which is 450 meshlines per period of the fundamental modulation and thus below the shortest possible rms length of @xmath133 that would appear if the particles are ideally ( linear chirp , no non - linear effects ) compressed to minimal length .",
    "there are about 220000 electrons per period which are directly simulated .",
    "a macro particle number equal ( or higher ) than the number of electrons can be easily handled with the periodical approach .",
    "the particle distribution with sharp density spikes is tracked about 23 m through quadrupoles and drifts to the exit of the ( inactive ) third chicane .",
    "[ ex2_189p30_1d ] , [ ex2_189p30_3d ] show the longitudinal phase space , the bunch current and the bunching for the one- and three - dimensional field model .",
    "the current spikes are diverged and the high harmonic content is significantly reduced , in good agreement of both models .",
    "it can be seen that the slope of the initial saw - tooth - like modulation has been reduced , similar to the reduction of the energy modulation during a plasma oscillation , after a length that is short compared to the period length . in the one - dimensional model all particles in one slice feel the same longitudinal field .",
    "therefore the only mechanism to increase the slice energy spread is individual longitudinal particle motion .",
    "the longitudinal field in the spikes is strongest and causes an energy modulation comparable to the initial laser modulation and a large energy spread .",
    "but the space charge distribution significantly violates the requirements for the one dimensional approach of a long bunch : @xmath134 .",
    "the length of the current spike of few nano - meters times @xmath135 is not large compared to the typical transverse dimension of about 100 @xmath119 m (= emittance @xmath136 , see fig .",
    "[ flash_seeding_section ] with the beta function ) .",
    "the vectorial field of the three dimensional model depends on the transverse offset and is integrated along betatron trajectories .",
    "( for the other extreme of flat bunches @xmath137 the longitudinal field is proportional to the transverse density , as @xmath138 . )",
    "this increases the slice energy spread as it can be seen in fig .",
    "[ ex2_189p30_3d ] .      at lcls a laser heater",
    "is used to increase the uncorrelated energy spread of the electron beam to counteract a microbunch instability @xcite .",
    "therefore the electron beam is energy modulated in an undulator that is in the middle of a short chicane , see fig .",
    "[ lcls_lh ] .",
    "the periodic modulation directly after the undulator is ( in principle ) visible in longitudinal phase space .",
    "this is different after the dogleg comprising of the last two chicane magnets : the angular divergence before the dogleg , due to emittance , causes spatial longitudinal divergence due to the dispersion parameter @xmath139 this @xmath18-divergence is large compared to modulation wavelength so that the periodic behavior is obscured , see @xmath140-diagram in fig .",
    "[ lcls_lh_8kev_11p0 ] . similarly , in spatial space appears no pattern of the harmonic excitation , see @xmath141-diagram in fig .",
    "[ lcls_lh_8kev_11p0 ] .",
    "therefore it was unexpected to measure energy spectra with rms widths that are _ not _ proportional to amplitudes of the exciting laser field .",
    "the position of the spectrometer can be seen in fig .",
    "[ lcls_lh ] .",
    "this effect is a clear indication for self effects and has been discussed , explained and estimated in @xcite .",
    "we give a simplified explanation for this effect .",
    "the transport equation from the exit of the laser heater undulator to an arbitrary position after the dogleg is @xmath142 = \\left[\\begin{array}{cc } r_{11 } & 0 \\\\ 0 & 1   \\end{array}\\right ] \\left[\\begin{array}{c } x_0 \\\\",
    "z_0 \\end{array}\\right ] + \\left[\\begin{array}{c } r_{12 } \\\\",
    "r_{52 } \\end{array}\\right ] x'_0 + \\left[\\begin{array}{c } r_{16 } \\\\",
    "r_{56 } \\end{array}\\right ] \\hat{\\delta } \\cos ( k z_0 ) \\label{transport_equation } \\ : \\ : , \\ ] ] with @xmath143 the phase space coordinates after the undulator and @xmath144 the spatial coordinates ( at the arbitrary position ) after the dogleg and the relative modulation amplitude @xmath145 .",
    "the energy spread before the undulator is neglected and for the beginning we neglect also the contribution of @xmath146 .",
    "[ transformation ] illustrates the transformation by eq .",
    "[ transport_equation ] : an equidistant orthogonal grid in the @xmath147-plane is transformed to the @xmath141 plane .",
    "the chosen numbers are typical for the given setup .",
    "it is obvious that the original area has been sheared and modulated and spatial density oscillations have been created .",
    "also particles with the same initial coordinate @xmath148 but different slope @xmath149 are distributed horizontally , they are still located on lines . to achieve a homogeneous spatial mixing , a horizontal spread of @xmath146",
    "is necessary that is coupled by @xmath150 into the horizontal direction again .",
    "supposed the fluctuation of @xmath151 is sufficiently large ( compared to the horizontal distance between lines with @xmath152 ) , then the density is uniform , as for instance in fig .",
    "[ lcls_lh_8kev_11p0 ] .",
    "this is different in the vicinity of zero crossings of @xmath150 as in fig .",
    "[ lcls_lh_optics_and_r11 ] with @xmath150 and optical functions @xmath153 . at these positions",
    "appear spatial density fluctuations and space charge fields cause an additional energy modulation , which is correlated with the original modulation .    figs .",
    "[ lcls_lh_8kev_11p0 ] , [ lcls_lh_8kev_15p5 ] and [ lcls_lh_8kev_17p5 ] are results of a numerical simulation with the periodic space charge solver of the setup described in @xcite ( @xmath154 = 135 mev , @xmath120 = 2 kev , peak current 37 a , charge 250 pc , normalized emittance 0.4 @xmath119 m , modulation wavelength @xmath121 = 758 nm ) .",
    "the beam is heated to @xmath120 = 8 kev .",
    "the blue particles in the @xmath140- and @xmath141-diagrams are particles that have been in the same longitudinal period during modulation , the gray particles are a periodic repetition .",
    "[ lcls_lh_8kev_11p0 ] refers to a position short after the laser heater chicane .",
    "the particles behave as expected by a theory neglecting self effects : the oscillating behavior is not visible , the particles are longitudinally smeared over a length larger than the period @xmath121 . the spectral density agrees with the predicted double bump structure @xcite .",
    "[ lcls_lh_8kev_15p5 ] refers to the position 15.5 m , close to the zero crossing of @xmath150 . in the spatial diagram the periodic pattern appears as microbunching ,",
    "although the relative longitudinal position of all the particles is not changed .",
    "the space charge fields due to the micro structure changes the particles energy and alters the energy distribution : the spectrum is different and its rms width is increased . at the position 17.5 m shown in fig .",
    "[ lcls_lh_8kev_17p5 ] , no microbunching is obvious but the energy distribution is significantly widened to @xmath155 12 kev .",
    "[ lcls_lh_rms_vs_len ] shows the rms energy spread along the beamline for different heating strengths .",
    "the blue 2 kev curve is calculated without heating , the thick black line refers to a heating ( from initially 2 kev ) to 8 kev as in the previous figures .",
    "the parasitic heating effect can be clearly seen .",
    "the characteristic of this heating described in fig .",
    "[ lcls_lh_rms_out_vs_rms_in ] showing the rms energy spread at the spectrometer entrance versus the initial energy spread .",
    "it is remarkable that parasitic heating changes not only the rms width but also the shape of the spectrum , see sub - panels with spectra in figs .",
    "[ lcls_lh_8kev_11p0 ] , [ lcls_lh_8kev_15p5 ] and [ lcls_lh_8kev_17p5 ] .",
    "this calculation has been performed with 1e6 macro particles per period although the number of electrons per period is 0.55e6 .",
    "the longitudinal resolution is @xmath156 , the transverse resolution is @xmath157 , so that the lorentz transformed mesh has the same resolution in all directions .",
    "the phase space pictures have been computed separately , with a resolution of 20 meshlines per period .",
    "[ lcls_lh_meas_vs_calc ] shows the published measurement @xcite together with a periodic and non - periodic simulation with qfield .",
    "although the shapes agree qualitatively , the results are not in good agreement : ( a ) the measured heating is stronger ( up to 28 kev where 10 kev are expected without additional heating ) , ( b ) the energy values without increased heating are different ( here : @xmath158 11 kev , 20 kev , measured : @xmath158 16 kev , 28 kev ) .",
    "in this paper we developed a method to calculate the potential and electro - magnetic field of a periodic charge distribution that moves in free space with constant velocity .",
    "the charge distribution is three dimensional and periodic in one direction of space .",
    "the numerical technique is a modification of the well known particle - mesh - method with fast convolution of the discretized source with the green s function of one cell .",
    "an efficient method has been described to compute the periodic green s function so that only particles , representing one period , have to be considered for the convolution .",
    "the method has been demonstrated with examples of pure spatial periodicity into the direction of motion . for example ( a ) a comparison with non - periodic simulations",
    "although the quasi - periodic part of the bunch is quite short , a good agreement is achieved .",
    "a non - periodic simulation for example ( b ) was beyond the available computational capacities . for example ( c ) some points of the curve in fig .",
    "[ lcls_lh_meas_vs_calc]b have been verified with large effort by non - periodic simulations with lower spatial resolution .",
    "the cpu time requirement for each point was about 1000 times larger despite the lower resolution .",
    "not all capabilities of the method have been demonstrated by these examples .",
    "for instance a density modulated beam with energy chirp represents a periodicity in geometric- and momentum - space . due to longitudinal and transverse dispersion",
    "the periodicity vector @xmath159 changes its length and direction and deviates from the direction of motion .",
    "this happens in bunch compressor chicanes .",
    "the periodic approach is numerically much more efficient than non - periodic simulations of bunches with quasi - periodicity , as the number of particles and the volume of the problem domain is reduced by orders of magnitude .",
    "we thank winfried decking , christoph lechner , kirsten hacker , evgeny schneidmiller , mikhail yurkov , igor zagorodnov and torsten limberg for their interest and stimulating discussions .",
    "j.  lawson : the physics of charged - particle beams .",
    "clarendon press , oxford 1988 .",
    "g.  geloni , e.  saldin , e.  schneidmiller , m.  yurkov : benchmark of astra with analytical solution for the longitudinal plasma oscillation problem .",
    "proceedings fel conference 2004",
    ". m.  dohlus , e.  schneidmiller , m.  yurkov , c.  henning ; f.  gruener : longitudinal space charge amplifier driven by a laser - plasma accelerator .",
    "spie 8779 87791 t , 2013 .",
    "s.  schreiber : first lasing in the water window with 4.1 nm at flash .",
    "proceedings of fel 2011 , shanghai , china .",
    "k.  hacker et al . :",
    "measurements and simulations of seeded electron microbunches with collective effects . to be published . c.  lechner , et .",
    "al . : experimental verification of controlling fel gain by laser - induced microbunching instability , in preparation .",
    "p. emma et al .",
    ": first lasing of the lcls x - ray fel at 1.5 a. proceedings of the 2009 ieee particle accelerator conference , vancouver , bc , canada , may , 2009",
    ". z.  huang : measurements of the lcls laser heater and its impact on the x - ray fel performance .",
    "phys . rev .",
    "beams 13 , 020703 , february 2010 .",
    "k.  flttmann : `` astra '' , desy , hamburg , |www.desy.de/  mpyflo| , 2000 .",
    "g.  geloni , e.  saldin , e.  schneidmiller and m.  yurkov : longitudinal wake field for an electron beam accelerated through an ultrahigh field gradient .",
    "instrum . and methods , a578 , 2007 .        : ( a ) pseudo - periodic random distribution with periodic behavior ; ( b ) generating set @xmath2 and periodically repeated particles in blue resp .",
    "gray ; ( c ) equivalent generating set in slice volume between two planes shifted by @xmath3 ; ( d ) other equivalent set in different volume slice ; ( e ) equivalent generating set without sharp truncation.,scaledwidth=75.0% ]    , the asymptotic approximation @xmath160 and the `` switched '' approximation @xmath161 for switch parameters @xmath64 : ( a ) and ( c ) comparison of @xmath162 and its asymptotic approximation @xmath82 ; ( b ) and ( d ) ratios @xmath57 and @xmath58 ; ( a ) and ( b ) for cubic mesh cells ; ( c ) and ( d ) for mesh cells with large aspect ratio ( @xmath60 ) .",
    "the green s funtion is only calculated for discrete mesh points ( @xmath163).,scaledwidth=90.0% ]     and absolut error @xmath164 of the numerical calculation . as @xmath165 is singular at the origin ( @xmath166 )",
    ", it truncated for the plot to values below 10 .",
    "the transition from the taylor approximation ( for small @xmath91 ) to the fourier series is at @xmath167 .",
    "the taylor approximation is used for the upper part of the sum from @xmath109 to infinity .",
    "the harmonic expansion is truncated after 8 terms.,scaledwidth=100.0% ]     for the same periodic distribution : ( a ) volume is not limited to a one - period - slice ; ( b ) particles in one - period - slice and mesh that supports periodicity ; ( c ) particles in equivalent one - period - slice ; ( d ) particles without sharp truncation and mesh that does not support periodicity.,scaledwidth=90.0% ]"
  ],
  "abstract_text": [
    "<S> a method is described to solve the poisson problem for a three dimensional source distribution that is periodic into one direction . </S>",
    "<S> perpendicular to the direction of periodicity a free space ( or open ) boundary is realized . in beam physics </S>",
    "<S> , this approach allows to calculate the space charge field of a continualized charged particle distribution with periodic pattern .    </S>",
    "<S> the method is based on a particle mesh approach with equidistant grid and fast convolution with a green s function . </S>",
    "<S> the periodic approach uses only one period of the source distribution , but a periodic extension of the green s function .    </S>",
    "<S> the approach is numerically efficient and allows the investigation of periodic- and pseudo - periodic structures with period lengths that are small compared to the source dimensions , for instance of laser modulated beams or of the evolution of micro bunch structures . </S>",
    "<S> applications for laser modulated beams are given . </S>"
  ]
}