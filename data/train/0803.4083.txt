{
  "article_text": [
    "langevin dynamics was first introduced in molecular simulations to calculate the properties of mesoscopic systems  @xcite . here a dissipative force and a noise were added to the hamilton equations to model a bath of lighter particles .",
    "the formal justification for this model can be obtained using the projection operator techniques @xcite . however",
    ", it was soon realized that langevin dynamics can also be used as a thermostat @xcite , adding the dissipative forces and the noise to the hamiltonian dynamics to allow a molecular dynamics simulation to explore an ensemble at a fixed temperature .",
    "furthermore , it has been used to sample arbitrary distribution , for instance in the case of numerical quantum - chromodynamics @xcite .",
    "several algorithms have been proposed for the numerical integration of the langevin equation , see among others refs .  .",
    "most of them were derived with the aim of producing accurate trajectories , i.e.  dynamical properties , up to a given order .",
    "because of that , they usually break down when a high friction is applied , essentially when the velocities are varying too fast with respect to the chosen time step .",
    "moreover , their design is not focused on the correctness of the ensemble generated",
    ". a notable exception is given by the schemes derived in ref .",
    "@xcite , where the free parameters of the algorithm are chosen so as to minimize the sampling errors .",
    "however , none of the algorithms so far proposed offer any way of checking the accuracy of the sampling during a numerical simulation .",
    "this is at variance with the numerical integration of hamilton s equations , where the conservation of the total energy has been traditionally used to this end @xcite .",
    "the standard approach in molecular dynamics is thus to choose the time step by monitoring the energy conservation in a few microcanonical runs , then to adopt the same time step for the langevin dynamics . to the best of our knowledge , only in a recent paper @xcite scemama _ et al . _",
    "have shown how to correct exactly the discretization errors in the langevin dynamics in the context of variational monte carlo , using a metropolis procedure .",
    "however , the poor scaling of these accept - reject algorithms with respect to the number of degrees of freedom prevents their application to global moves in very large systems @xcite .",
    "in a recent paper @xcite we introduced a constant - temperature molecular - dynamics method . in that context , we discussed the notion of effective energy , as a measure of sampling accuracy . in ref .",
    "@xcite only one variable , the total kinetic energy , was subject to stochastic fluctuations and the response of the thermostat could be modeled so as to have a minimal effect on the dynamics . here",
    "we apply some of the ideas developed in ref .",
    "@xcite to langevin dynamics , where all degrees of freedom can be separately controlled and the time scale over which the thermostat reacts is defined by the friction coefficient . when used as thermostat , langevin dynamics can be more efficient in difficult cases , but it is more disruptive of the dynamics . in an extension of ref .",
    "@xcite , we integrate langevin using a simple algorithm derived from a trotter decomposition .",
    "the effective - energy drift allows the sampling error to be controlled during a simulation , and can be used in a rigorous way to perform reweighting or accept - reject algorithms , in a scheme that turns out to be similar to that discussed by scemama _",
    "et al . _",
    "the advantage of our formulation is that , for large systems , the effective energy can be simply checked against long - term drifts , in the same way as the total energy has traditionally been used to check the accuracy of microcanonical molecular dynamics .",
    "we also show the properties of the effective energy in model harmonic oscillators and in a realistic lennard - jones crystal .",
    "we consider a particle with mass @xmath0 subject to a potential energy @xmath1 .",
    "the generalization to multiple degrees of freedom is straightforward .",
    "the probability density for the canonical ensemble at an inverse temperature @xmath2 is @xmath3 the canonical ensemble can be sampled through the langevin dynamics    [ eq - langevin ] @xmath4    where @xmath5 is the deterministic force , @xmath6 is the friction coefficient , and @xmath7 is a wiener noise in the itoh convention @xcite , normalized as @xmath8 . a description equivalent to the stochastic eq .  ( [ eq - langevin ] ) can be formulated in terms of the probability density , which evolves according to the fokker - planck equation @xcite @xmath9 where @xmath10 the formal solution of eq .",
    "( [ eq - fpe ] ) at a finite time step @xmath11 is @xmath12 which however can not be evaluated explicitly .",
    "notice that for hamiltonian dynamics , @xmath13 , the operator @xmath14 is anti - hermitian and the propagator @xmath15 is unitary .",
    "these properties hold only for a deterministic area - preserving dynamics .",
    "they do not hold in a langevin process .      as was first recognized by tuckerman _",
    "_ @xcite and , independently , by sexton and weingarten @xcite , the trotter formula @xcite allows an approximated propagator to be constructed as @xmath16 where @xmath17 is the number of stages in the integrator and @xmath18 . since in general",
    "the @xmath19 s do not commute among themselves , the order in which the stages are applied is relevant , and the splitting in eq .",
    "( [ eq - trotter ] ) introduces some error into the propagation .",
    "the key point here is that the stages @xmath20 are chosen so that they can be integrated analytically , and the trotter splitting is the only source of errors .",
    "it is natural to write @xmath14 as a sum of three parts : @xmath21 which are defined as    @xmath22    several choices are now available for the trotter splitting .",
    "we notice that the operators @xmath23 and @xmath24 leave the stationary distribution in eq .",
    "( [ eq - canonical ] ) unchanged : @xmath25 this is due to the fact that the canonical distribution is stationary not only with respect to @xmath14 but also with respect to @xmath26 , which corresponds to hamilton propagation , and with respect to @xmath27 , which introduces the combined effect of friction and noise .",
    "thus , even if the commutator @xmath28\\neq 0 $ ] , the following splitting does not introduce sampling errors , @xmath29 since it can be interpreted as a sequence of moves each of which has the correct limiting distribution .",
    "the @xmath23 move provides ergodicity in the momenta subspace only , while the @xmath24 move mixes the momenta and positions subspaces .",
    "an integrator designed to apply the propagator in eq .",
    "( [ eq - first - splitting ] ) would provide an approximate trajectory and an exact sampling , independently of @xmath11 and @xmath6 .",
    "the propagator @xmath23 can be integrated analytically .",
    "unfortunately , the propagator @xmath24 can not be integrated exactly and has to be split further .",
    "we opt here for the simplest choice , which is the same used to obtain the velocity verlet algorithm : @xmath30 in specific cases , different decompositions of @xmath31 could be adopted .",
    "for example , if the forces can be separated into contributions varying on different time scales , a multiple - time - step decomposition is expected to be more efficient  @xcite .    other possible choices for the trotter splitting which are substantially equivalent to eq .",
    "( [ eq - splitting ] ) can be obtained , based on the three operators @xmath32 , @xmath33 and @xmath27 .",
    "it is worthwhile to notice that in principle there is no need to split @xmath33 and @xmath27 , since @xmath34 can be also evolved analytically .",
    "ricci and ciccotti  @xcite derived two integrators using splittings that , in our notation , would read @xmath35 and @xmath36 .",
    "these decompositions involve a single splitting and thus appear more accurate than eq .",
    "( [ eq - splitting ] ) .",
    "however , when @xmath37 is negligible , they do not offer any advantage , and when @xmath37 is not negligible , they do not sample the proper ensemble .",
    "this can be easily verified taking the limit @xmath38 . on the other hand , in our scheme the only ensemble violations arise from the fact that for a finite @xmath11 the evolution of @xmath31 is approximated .",
    "these violations are independent of the choice of the friction .",
    "even the infinite friction limit can be taken safely , as shown in appendix  [ sec - high - friction - limit ] .",
    "thus , when the sampling quality is an issue , our scheme offers significant advantages .",
    "the splitting in eq .",
    "( [ eq - splitting ] ) leads to an explicit integration scheme . in the derivation we use the analytical propagation formula for @xmath27 which can be found in ref .",
    "@xcite . after some manipulation",
    ", the integrator is written as :    [ eq - integrator ] @xmath39    where @xmath40 and @xmath41 are two independent gaussian numbers and the coefficients @xmath42 and @xmath43 are    @xmath44    equation  ( [ eq - c2 ] ) fixes the weight of the rescaling factor @xmath42 and of the amplitude of the gaussian number @xmath43 in such a way that @xmath45 will be distributed in the same way as @xmath46 .",
    "thus , eq .  ( [ eq - c2 ] ) alone guarantees the correctness of the sampling . on the other hand , eq .",
    "( [ eq - c1 ] ) gives the relation between the friction @xmath6 and the rescaling factor @xmath42 .    in equation  ( [ eq - integrator ] ) , the combination of the two inner stages is a velocity verlet step , and corresponds to the approximate propagation of @xmath24 .",
    "the first and last stages represent the action of the thermostat , i.e.  the exact propagation of @xmath47 .",
    "we denote as @xmath48 and @xmath49 the momenta immediately after and immediately before the action of the thermostat .",
    "we also observe that the first and last stages can be merged as @xmath50 so that one gaussian random number per degree of freedom is required at each step .",
    "this allows the simulation to speed up when the calculation of the deterministic forces is particularly cheap and the generation of the gaussian random numbers becomes computationally relevant .",
    "if one is interested in the values of the momenta at time @xmath51 , i.e. synchronized with the positions , they can be reconstructed afterwards .",
    "we now use the concept of effective energy @xmath52 introduced in ref .",
    "@xcite to control the accuracy of the sampling .",
    "for clarity we repeat here some of the notions already presented there .",
    "our goal is to generate a sequence of points @xmath53 in the phase - space , so that a time average can be used in place of the ensemble average  @xcite .",
    "usually , in molecular dynamics simulations this sampling is approximate , due to the finite - time - step errors . on the other hand , in a monte carlo simulation",
    "the moves are accepted or refused in such a way that the exact distribution is enforced . here",
    ", we interpret a stochastic molecular dynamics as a highly efficient monte carlo where all the moves are accepted .",
    "we define @xmath54 the distribution probability of the point @xmath55 to be chosen as the next point , given that the present point is @xmath56 .",
    "we also define the conjugate point @xmath57 , which is obtained by inverting the momentum , and satisfies @xmath58 . if equation  ( [ eq - langevin ] ) was integrated exactly , then the detailed balance @xcite would be satisfied , i.e. , @xmath59",
    ". however , this is not true when a finite time step is used .",
    "thus , we introduce a weight @xmath60 associated to the point @xmath56 , which evolves as @xmath61 the same information can be expressed in terms of an effective energy , defined as @xmath62 , which evolves according to @xmath63 we now proceed into an explicit derivation of the terms needed .    in standard hybrid monte carlo ,",
    "the trial moves are generated using an area - preserving scheme , so that @xmath64 .",
    "thus , the effective energy @xmath52 reduces to the hamiltonian @xmath65 . however , the langevin equation is explicitly non - area - preserving , and an additional contribution due to phase - space compression has to be evaluated .",
    "we now calculate it explicitly for the integrator in eq .",
    "( [ eq - integrator ] ) . in ref .",
    "@xcite we used the fact that the thermostat moves are designed so as to satisfy detailed balance .",
    "we present here a more general way of evaluating this contribution that can be straightforwardly applied to other integrators .",
    "we recall that the random numbers @xmath40 and @xmath41 are drawn from a gaussian distribution , i.e. @xmath66 we notice that given the starting point @xmath53 and the ending point @xmath67 the value of @xmath40 and @xmath41 can be determined solving eqs .",
    "( [ eq - integrator ] ) with respect to @xmath40 and @xmath41 :    @xmath68    where we have identified the sequence index @xmath69 with the time @xmath51 and the sequence index @xmath70 with the time @xmath71 .",
    "now , changing the variables from @xmath72 to @xmath73 one obtains the following expression for the transition probability : @xmath74 at this stage we know the probability for the forward move @xmath75 . with a similar procedure we can find the probability for the backward move , @xmath76 , and , with some further manipulation , the contribution of the phase - space compression to the effective energy : @xmath77    for this derivation it is crucial that the change of variables be well defined . since we have two noise terms @xmath72 and two variables @xmath73 , we have to require the jacobian of the transformation to be different from zero . for integrators using only one noise term , it is not obvious that , given the forward trajectory , the backward trajectory is possible .",
    "if the backward trajectory is possible , then the effective - energy drift depends on the ratio between the forward and backward probabilities and gives a quantitative measure of the violation of detailed balance .",
    "if the backward trajectory is not possible , then the integrator can not satisfy detailed balance . as an example",
    ", the second integrator introduced by ricci and ciccotti  @xcite can not satisfy detailed balance , as was already pointed out by scemama _",
    "et al . _",
    "@xcite . on the other hand , the modification described in ref .",
    "@xcite can satisfy detailed balance .",
    "it is interesting that in ref .  @xcite the authors are using the usual formulation of detailed balance , which leads to the need for an explicit inversion of the sign of the velocities .",
    "we use a more general formulation of detailed balance  @xcite in which velocities are considered as odd variables and their inversion after an accepted step is not required .",
    "one could also object that the condition of detailed balance is not strictly necessary @xcite .",
    "however , it appears to us that detailed balance is the only way to enforce or check a distribution in a local manner , i.e. , using only information about the present point @xmath56 , the next point @xmath55 , and their conjugated points @xmath78 and @xmath79 .",
    "equations  ( [ eq - effective - energy - drift1 ] ) and  ( [ eq - effective - energy - drift2 ] ) can be combined , giving a final expression for the effective - energy increment as @xmath80 from equation  ( [ eq - deltahtilde ] ) it is easy to see that when @xmath11 is small enough the effective energy is approximately constant , since the first and second terms tend to compensate each other and the third term vanishes on the order of @xmath81 .",
    "we also notice that the third term in eq .",
    "( [ eq - deltahtilde ] ) is an exact differential .",
    "thus it contributes to the fluctuations of the effective energy but not to its drift .",
    "we notice that the increment of the effective energy in eq .",
    "( [ eq - deltahtilde ] ) is exactly equal to the difference of the total energy before and after the velocity verlet step , as in the case of the scaling procedure described in ref .",
    "in fact , also here we can think of our dynamics as composed of a combination of two steps : one , described by the operator @xmath23 , which exactly satisfied detailed balance ; the other , which is the velocity verlet step , is symplectic but does not exactly conserve the energy .",
    "only the violations arising from the latter are accumulated into the effective energy .",
    "thus , in practice , @xmath52 can be calculated simply by summing the increments of the total energy due to the verlet , discarding the increments due to the thermostat .",
    "alternatively , it can be obtained by subtracting from the total energy the sum of all its increments due to the thermostat .",
    "the same procedure can be applied directly also in the case of the peters thermostat @xcite , based on dissipative particle dynamics @xcite , where @xmath23 is substituted by a rescaling of the relative velocity of neighboring particles , the only condition being the fact that the rescalings are performed in a way that analytically preserves the target ensemble .",
    "the effective energy can be calculated on the fly and , aside from numerical truncation errors , it gives a quantitative way to assess the accuracy of the calculation . in the spirit of ref .",
    "@xcite , one can obtain exact ensemble averages with @xmath82 .",
    "the variation of @xmath52 on segments of trajectory can also be used in a hybrid monte carlo scheme @xcite , where the acceptance is calculated as @xmath83 . in this latter case ,",
    "our scheme becomes similar to that presented by scemama _",
    "et al . _",
    "@xcite . in a molecular dynamics context , the effective energy @xmath52 is simply monitored during the simulation .",
    "it may fluctuate , but it should not exhibit a large systematic drift .",
    "it is instructive to study the properties of the integrator in eq .",
    "( [ eq - integrator ] ) when it is applied to a harmonic oscillator .",
    "we consider an energy profile @xmath84 we are interested in the time evolution of the effective energy @xmath52 .",
    "it can be easily shown that for a quadratic potential the first two terms in eq .",
    "( [ eq - deltahtilde ] ) cancel exactly , and only the third term survives .",
    "thus , the integral over the trajectory is not necessary and the effective energy @xmath52 is a state function @xmath85 where @xmath86 is an arbitrary constant .",
    "the effective distribution that will be sampled by the langevin dynamics can be obtained analytically and is @xmath87 this solution can be normalized only if @xmath88 . for longer time steps ,",
    "the dynamics is unstable . although the logarithm of the distribution in eq .",
    "( [ eq - harmonic - pe ] ) has an expression similar to that of the so - called shadow hamiltonian for the harmonic oscillator  @xcite , our derivation of eq .",
    "( [ eq - harmonic - pe ] ) is based on the stationary distribution only and does not provide any information on the effective trajectory .",
    "since @xmath52 is a state function , it will not exhibit drifts .",
    "its square fluctuations can be obtained analytically and are equal to @xmath89 for a comparison , the fluctuations of the total energy @xmath65 are @xmath90 .",
    "interestingly , the size of the fluctuations of @xmath52 depends only on the ratio between the time step and the period of the oscillator .",
    "it is completely independent of the value of the friction .",
    "the properties of a @xmath91-dimensional oscillator can be easily obtained by recalling that , when the dynamics is projected on the eigenmodes of the oscillator , the coordinates evolve independently of each other . assuming a spectrum of @xmath91 frequencies @xmath92 , the fluctuations of @xmath52 are @xmath93 the last approximation holds when @xmath11 is much smaller than the period of the fastest mode . in this case , it is interesting to note that to have rigorously the same accuracy , the time step has to be chosen proportional to @xmath94 .      in the harmonic oscillator",
    "the effective energy reduces to a state function and does not exhibit drifts . in this sense",
    ", the harmonic oscillator can not be considered as a prototype of a real molecular system . in this subsection",
    "we discuss the application of langevin sampling and of effective - energy monitoring in the context of atomistic simulations .",
    "we use as a realistic test - case a lennard - jones solid , close to the melting point .",
    "we express all the quantities in reduced units @xcite .",
    "we simulate a cubic box with side 19.06 containing 6912 particles arranged according to an fcc lattice , which corresponds to a density @xmath95=0.998 .",
    "we set the temperature to @xmath96=0.667 .",
    "we calculate the forces using a distance cutoff of 3 .",
    "we compare simulations performed using different values for the time step @xmath11 and the friction @xmath6 .",
    "all the simulations were performed using a modified version of the dl poly code @xcite .",
    "( color online ) effective - energy drifts for different choices of the friction coefficient , respectively @xmath6=1 ( a ) , @xmath6=5 ( b ) and @xmath6=20 ( c ) , and different choices of the time step @xmath11 , as indicated .",
    "the effective energy drifts linearly , and its slope is strongly dependent on the time step .",
    "all the quantities are in lennard - jones reduced units . ,",
    "scaledwidth=45.0% ]     average values of ( a ) the potential energy per particle , ( b ) the instantaneous pressure and ( c ) the slope of the effective energy per particle , plotted as functions of the friction @xmath6 .",
    "the calculations are performed with different time steps : @xmath97 ( @xmath98 ) , @xmath99 ( @xmath100 ) , @xmath101 ( @xmath102 ) , @xmath103 ( @xmath104 ) and @xmath105 ( @xmath106 ) .",
    "all the quantities are in lennard - jones reduced units . , scaledwidth=45.0% ]     average value of ( a ) the potential energy per particle and ( b ) instantaneous pressure , plotted as functions of the slope in the effective energy drift per particle .",
    "the calculations are performed with different time steps : @xmath97 ( @xmath98 ) , @xmath99 ( @xmath100 ) , @xmath101 ( @xmath102 ) , @xmath103 ( @xmath104 ) and @xmath105 ( @xmath106 ) .",
    "all the quantities are in lennard - jones reduced units . ,",
    "scaledwidth=45.0% ]    in fig .",
    "[ fig - lj - drift ] we show a time series for the effective energy @xmath52 per particle .",
    "the effective energy exhibits a regular drift due to the finiteness of the integration time step , similarly to the total energy in a microcanonical simulation .",
    "the drift is strongly dependent on the time step , and is only slightly affected by the choice of the friction . in fig .",
    "[ fig - lj ] we show the values obtained for the average potential energy per particle and the average pressure for different choices of @xmath6 and @xmath11 , obtained from runs of length 2500 time units .",
    "the values are again rather independent of the choice of @xmath6 .",
    "this is remarkable , considering that we are changing the friction over three orders of magnitude and that we are working also in regimes where @xmath107 is not negligible .",
    "this indicates that the errors are essentially coming from the integration of the hamilton equations and not from the friction itself . in the third panel",
    "we show the average slope of the effective energy per particle , obtained with a linear fitting .",
    "the slope is again strongly sensitive to the time step and only slightly dependent on the friction .",
    "to stress the fact that the effective - energy slope is a correct indicator of the integration errors , we show the same data in fig .",
    "[ fig - slope - err ] .",
    "there , we plot the value of the observable quantity as a function of the slope in the effective - energy drift .",
    "the two quantities are highly correlated , indicating that the effective - energy slope gives a realistic estimate of the errors due to the finite time step .     normalized autocorrelation function of ( a ) the potential energy and ( b ) the instantaneous pressure , for different choices of the friction coefficient @xmath6 , as indicated .",
    "the fastest decorrelation is observed when @xmath6 is set to an optimal value of 20 .",
    "all the quantities are in lennard - jones reduced units . , scaledwidth=45.0% ]    up to now we have discussed the sampling accuracy , which measures the systematic errors due to the finite - time - step integration . in practical applications also the sampling efficiency , which measures the statistical error due to the finite length of the simulation , is relevant .",
    "the sampling efficiency depends on which specific observable one wishes to calculate .",
    "in particular , to optimize the efficiency , the autocorrelation time of the quantity of interest has to be as short as possible @xcite . in fig .",
    "[ fig - lj - auto ] we show the autocorrelation function of the total potential energy and of the instantaneous pressure , for different choices of the friction @xmath6 , using a time step @xmath97 .",
    "for both the considered quantities , the optimal choice for @xmath6 is 20 .",
    "this rule is far from general , but illustrates clearly the fact that too high a friction can spoil the quality of the sampling since it hinders particle motion .",
    "in conclusion , we have studied the properties of a very simple integrator for the langevin equation , derived employing the trotter scheme commonly use in the derivation of multiple - time - step integrators . moreover , we have used the concept of effective energy , introduced in a previous paper , to asses on the fly the accuracy of this integrator in practical cases , ranging from simple one - dimensional oscillators to a lennard - jones crystal .",
    "finally , we have shown how to monitor the effective energy in practice .",
    "our formalism can be easily generalized to the description of other stochastic dynamics , such as dissipative - particle dynamics @xcite .",
    "when @xmath108 the integrator in eq .",
    "( [ eq - integrator ] ) can be rewritten in terms of the position only : @xmath109 now , defining @xmath110 this equation becomes @xmath111 which is exactly the euler integrator for the overdamped langevin equation @xmath112 it is worth noting that the increment of @xmath52 as defined in eq .",
    "( [ eq - deltahtilde ] ) does not depend on @xmath6 , and is still valid . in terms of @xmath113",
    "it is @xmath114 which is exactly the one used to calculate the acceptance in the smart monte carlo technique @xcite ."
  ],
  "abstract_text": [
    "<S> we show how to derive a simple integrator for the langevin equation and illustrate how it is possible to check the accuracy of the obtained distribution on the fly , using the concept of effective energy introduced in a recent paper [ j.  chem .  </S>",
    "<S> phys .  * 126 * , 014101 ( 2007 ) ] . </S>",
    "<S> our integrator leads to correct sampling also in the difficult high - friction limit . </S>",
    "<S> we also show how these ideas can be applied in practical simulations , using a lennard - jones crystal as a paradigmatic case . </S>"
  ]
}