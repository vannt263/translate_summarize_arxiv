{
  "article_text": [
    "when relativistic charged particles propagate through a periodically modulated field , they oscillate and emit a radiation with a shorter wavelength due to the doppler effect ( see [ spect_scheme ] ) .",
    "this is the principle of synchrotron radiation ( sr ) sources , where beams of accelerated electrons are deviated by a wiggling magnetic field in order to produce bright x - rays . in state - of - the - art sources ,",
    "the electrons are produced by a linear accelerator and are wiggled in a series of alternating permanent magnets known as an _ undulator_.",
    "a particularly interesting case is that of free electron lasers ( fel ) , where the sr source operates in a coherent regime . in these devices ,",
    "the emitted x - rays have a resonant interaction with the electrons , and they are efficiently amplified via stimulated compton scattering ( see @xcite for recent reviews of fels ) . through this process , x - ray free electron lasers ( xfels ) can currently reach the multi - gw level in peak - power , at the angstrm wavelengths @xcite .    in order to describe the physics of free electron lasers , major theoretical results were obtained both in the quantum and classical approaches @xcite , and appropriate numerical tools were developed @xcite . to simulate the particles - field interaction , one may use an approach similar to the method adopted in the particle - in - cell ( pic ) schemes @xcite . in this approach ,",
    "the maxwell equations are solved on a spatial grid by the finite difference time - domain ( fdtd ) methods .",
    "the electrons are represented by charged macro - particles and the particles - radiation interaction is conveyed by interpolation techniques . in the case of relativistic particles interacting with an x - ray radiation ,",
    "this requires a grid which accurately resolves the wavelength of the amplified radiation @xmath0 as well as the electron beam size @xmath1 . in xfels",
    "the ratio @xmath2 may be as high as @xmath3 , and the direct implementation of such methods results in a large computational load .        in the dedicated fel codes",
    "this problem is overcome by making a few approximations .",
    "one approximation , used in the majority of the mainline fel codes is the _ slowly varying envelope approximation _ ( svea ) , in which the electromagnetic field is regarded as a wave , @xmath4\\}$ ] , where @xmath0 is the anticipated resonant wavelength @xcite and where @xmath5 is assumed to be slowly - varying in space and time @xcite .",
    "often svea is complemented with the _ wiggler - averaged _ formulation which assumes that the trajectories of oscillating electrons follow precisely the sinusoidal field of the undulator .",
    "this approach allows to consider only slow longitudinal displacements of electrons with respect to the electromagnetic field without solving the full three - dimensional equation of motion . both svea and wiggler - averaging",
    "provide a great calculation efficiency for the conventional fel modeling , however , in the cases , where fast variations of the radiation profile are essential the correct description may require non - averaged approach @xcite .    due to the growing interest for the unaveraged fel modeling ,",
    "a number of approaches were developed for one - dimensional simulations @xcite , and three - dimensional simulations @xcite .",
    "one approach consists in using the multi - frequency model , which is a pseudo - spectral time domain ( pstd ) method , where the maxwell equations are integrated in a predefined fourier domain @xcite .",
    "one such model is presented in @xcite , where the author uses a one - dimensional fourier decomposition of the fields along the direction of propagation , centered around the resonant frequency .",
    "the orthogonality of the fourier modes in a finite - length periodic interval allows to write separately the equations for each mode , and to integrate them in time along with the equations motion for the electrons",
    ". similar approach , using fast fourier transform ( fft ) technique , was developed in @xcite for one - dimensional unaveraged modeling .    in three - dimensional simulations besides the purely fdtd methods the spectral techniques are often combined with fdtd approach , for example in @xcite , where the split - step integration accounts for diffraction via fft , and particles - field interaction is resolved with an fdtd galerkin method . alternatively , decomposition of the electromagnetic field into the gauss - hermite or gauss - laguerre modes is also a popular method , which has been used to represent the transverse profile of the radiation @xcite",
    ". the choice of the correct transverse mode can be advantageous in terms of calculation time and accuracy , and it depends on the symmetry of the problem and its boundary conditions .",
    "in this paper we describe a general approach for three - dimensional modeling of fel simulations with a spectral method .",
    "a fully three - dimensional algorithm is based on cartesian fourier series , and for the axisymmetric case we use the cylindrical fourier - bessel series .",
    "the spectral components of the fields are defined on a discrete grid in fourier space , and the particles currents are projected onto this spectral grid .",
    "the maxwell equations are integrated numerically for each spectral component , and the forces are calculated by summing the fourier series at the particles positions .",
    "the structure of the spectral domain may be chosen rather flexibly , which provides a simple way to capture the harmonics of the emitted field ( see [ spect_scheme ] ) .",
    "the required spectral resolution for the field can be rather modest , which in some cases allows to run the simulations on a desktop computer . in this communication",
    "we focus on the numerical recipe itself and its implementation in the context of the basic fel interaction .    in the following ,",
    "we describe the mathematical model ( [ sec1 ] ) and the main aspects of its implementation in the code ` plares ` ( [ implement ] ) , and we discuss the choice of the simulation parameters ( [ mod_param ] ) . in [ sec3 ]",
    "we introduce several fel simulations which were run with ` plares ` , and we compare the results with those obtained by three commonly - used fel codes . summarizes the results and gives prospective applications for ` plares ` .",
    "the interaction between charged particles and electromagnetic fields can be described by the equations for the vector and scalar potentials @xmath6 , @xmath7 written in the lorentz gauge @xcite , @xmath8 along with the equations of motion : @xmath9 and @xmath10 are the electron currents and charge densities , @xmath11 is the speed of light , and @xmath12 and @xmath13 are the mass of the electron and the elementary charge . are written in gaussian units .",
    "the radiation and space - charge fields produced by the particles are defined by [ fld_eq0 ] .",
    "these fields act back on the particles through [ motion_eq1 ] along with the `` external '' fields @xmath14 and @xmath15 produced by the undulator and the complementary devices ( quadruples , chicanes etc ) : @xmath16 in order to simulate the looped interaction of the particles and the fields , [ fld_eq0,motion_eq1,fields ] have to be self - consistently integrated in time .",
    "the first two equations of the system [ fld_eq0 ] are used to calculate the vector and scalar potentials , and they can be integrated by a spectral time - domain method . in the following text we will work in dimensionless units .",
    "the potentials are normalized as @xmath17 and @xmath18 , and the field components are normalized as @xmath19 and @xmath20 .",
    "the velocities , spatial coordinates and time are in units of @xmath11 , @xmath21 and @xmath22 respectively , where @xmath23 is the wavevector of the undulator with a period @xmath24 and @xmath25 .",
    "let us demonstrate the calculation of the radiation field in [ fld_eq0 ] using the fourier decomposition technique . for this",
    "we consider only the component of @xmath26 which is oriented along the electron oscillations .",
    "the other components of @xmath26 , as well as @xmath27 can be calculated with a similar approach .",
    "using the fourier theorem and considering a periodic simulation domain of size @xmath28 , one may write the fields as a fourier series : @xmath29\\,,\\ ] ] where the wavevector @xmath30 is normalized to @xmath31 and belongs to a cartesian grid @xmath32 in fourier space . the resolution of @xmath32 is defined by the size of the simulation domain as : @xmath33 the complex values of @xmath34 define the phases and amplitudes of the fourier modes at time @xmath35 . substituting the decomposition [ spect_decomp ] into the electromagnetic equation [ fields ]",
    "we obtain : @xmath36 = - \\frac{4\\pi e^2   k_u}{m_e c^2 } \\sum_j \\mathbf{v}_{j } \\delta(\\mathbf{r}_j - \\mathbf{r})\\,.\\ ] ]    in free electron laser interaction , the velocity of the electron beam and the group velocity of the radiation are typically very close to @xmath11 , and we may consider the solution to be of the form @xmath37 . using the orthogonality of the fourier modes in [ fld_eq3 ] , one can multiply this equation by a factor @xmath38 , and integrate it over the simulation domain .",
    "this results in a separate equation for each mode : @xmath39 where @xmath12 is the index of the mode , and @xmath40 is the volume of the simulation domain .",
    "note that , considering @xmath41 , we are generally neglecting the backscattered wave , since its correct description would require a very short integration time - step to resolve the oscillations of @xmath42 with a frequency @xmath43 .      in three - dimensional simulations the algorithm based on the cartesian fourier series is able to model the amplification of a radiation having a complex transverse profile ( see [ mod_param ] ) . in this case , even for a moderate spectral resolution , the three - dimensional spectral domain may be very large , and can result in a considerable computational load .",
    "fortunately , in fel simulations it is often possible to assume that the produced radiation has a symmetry with respect to the axis of propagation of the electrons .    to demonstrate how axial symmetry can be used in the calculations , let us write the field equation ( [ fld_eq0 ] ) in",
    "the cylindrical coordinates @xmath44 : @xmath45 the solution to this equation may be constructed with help of cylindrical harmonics , i.e. by decomposing the field in a fourier - bessel series @xcite : @xmath46\\,,\\ ] ] where @xmath47 is an integer number , and @xmath48 is an angular phase .",
    "the discrete transverse wavevectors @xmath49 in the fourier grid @xmath50 are not necessarily regularly spaced . in order to determine these discrete values of @xmath49 we impose dirichlet boundary condition : @xmath51 , where @xmath52 is the outer boundary of simulation domain @xmath53 .",
    "this imposes @xmath54 where the @xmath55 are the roots of the equation @xmath56 , and moreover with these conditions the chosen basis is orthogonal . using this property of orthogonality",
    ", we can find the equation for any given mode : @xmath57 where the volume of the cylindrical simulation domain is @xmath58 .",
    "the most of the typical situations can be modeled with only first two the terms in the @xmath47 sum of [ spect_decomp2 ] .",
    "the term @xmath59 defines fully axisymmetric field profile , which does not depend on the angle @xmath60 , while @xmath61 corresponds to the antisymmetric field profile .",
    "the phase @xmath62 ( @xmath63 may always be assumed to be 0 ) allows to choose the antisymmetry of the modeled field . in the fels",
    "this case is typical for the even harmonics emitted in the linear undulator , which are generated off - axis @xcite .      to model the particle motion , the electric and magnetic fields , @xmath64 and @xmath65 , have to be calculated from the potentials as @xmath66 and @xmath67 respectively . in the case of the cartesian fourier decomposition [ spect_decomp ]",
    "we find the fields acting on the particles as :    [ fld_eq5 ] @xmath68 \\mathrm{e}^ { i|\\mathbf{k}| t-\\mathrm{i } \\mathbf{k\\cdot     r}_j}\\right]\\,,\\ ] ] @xmath69\\,.\\ ] ]    the fields from [ fld_eq5 ] are then used to model in the equations of motion for the particles  : @xmath70    the expression equivalent to [ diffract , fld_eq5 ] for the fourier - bessel representation [ spect_decomp2 ] are more cumbersome but can be easily derived writing explicitly the component of differential operators `` @xmath71 '' and `` @xmath72 '' , acting on the cylindrical functions in the cartesian space .",
    "the role of the space - charge fields associated with the @xmath73 is twofold , and one has to distinguish the effect of the large - scale field of the whole bunch and the small - scale field of the local density modulations .",
    "the large - scale field results in the coulomb repulsion of the beam in all directions ( see @xcite ) . on the other hand ,",
    "the small - scale fields alter the dispersion properties of the electron beam and can either suppress or enhance the amplification of radiation .",
    "for instance , while the stimulated compton scattering is damped by these fields , the stimulated raman scattering takes advantage of the collective electron oscillations in a plasma wave @xcite .    in the present study",
    ", we will neglect both these large - scale and short - scale space - charge phenomena , and thus @xmath73 is assumed to be zero in the rest of this article .",
    "this also allows to use the resulting gauge condition , @xmath74 , to facilitate accounting for the radiation diffraction .",
    "let us write the relation between field components for the cartesian fourier model : @xmath75    in the common case of a linear undulator , the electrons oscillate along the @xmath76-axis , and they produce a radiation which is mainly polarized along @xmath76 , i.e. @xmath77 . moreover , the radiation is emitted mostly along the @xmath78 axis , and thus @xmath79 .",
    "for these reasons , we may neglect the term @xmath80 in [ diffract0 ] , and find the longitudinal component of the field ( which arises as a consequence of diffraction ) as : @xmath81 for two - dimensional electron oscillations , equations ( [ fld_eq4_nosvea ] ) or ( [ fld_eq7_nosvea ] ) should be solved for both @xmath82 components , and @xmath83 can be found directly from [ diffract0 ] as @xmath84 .      in the [ fld_eq4_nosvea , fld_eq7_nosvea , fld_eq5 ] we operate with the envelope @xmath42 , which describes the amplitude of electromagnetic field interacting with relativistic particles . in the most of realistic situations , the oscillations of the x - ray field are much faster than the dynamics of the amplitude  growth or damping  and",
    "one may assume @xmath42 varies slowly in time .",
    "as a consequence , the second order term @xmath85 can be neglected , which corresponds to the svea approach . with this approximation the field equation for the cartesian solver ( [ fld_eq4_nosvea ] ) will read : @xmath86 the one for the cylindrical model ( [ fld_eq7_nosvea ] ) : @xmath87 and the calculation of the field on the particles positions can be simplified by neglecting the slow variations of potential amplitude @xmath88 in the first equation of [ fld_eq5 ] : @xmath89\\,.\\ ] ]    the above equations are similar to those of the fdtd codes that are said to use the slowly - varying approximation ( svea ) .",
    "however , these ftdt codes usually introduce two distinct approximations : neglecting the second - order derivative @xmath90 , and using a spatial step equal to @xmath0 , justified by the fact that the envelope is varying in space slowly . while the former approximation is valid when @xmath91 , the latter turns out to have a narrower range of validity .",
    "indeed , recent studies @xcite showed that , when solving the first order - field equations on a grid having a spatial resolution lower than @xmath0 , one can correctly model the situations where the radiation profile changes rapidly , and where the latter approximation is not applicable .",
    "since our algorithm uses the first - order equation but does not introduce this coarse spatial discretization of @xmath0 , it may have a wider range of applicability than standard ftdt codes .",
    "this is confirmed in the [ sec3.1 ] , where we show that the second - order equation eqs .",
    "( [ fld_eq4_nosvea],[fld_eq7_nosvea ] ) and first - order eqs .",
    "( [ fld_eq4],[fld_eq7 ] ) lead to very similar result , even when the radiation profile dynamics is very rapid .",
    "the methods described in the previous section may describe the x - ray field amplification with account for the three - dimensional effects ( radiation diffraction and electron divergence ) at a moderate computational cost . in the simulations ,",
    "the field and particle equations have to be numerically integrated over time . to integrate the first order differential equations we choose a leapfrog algorithm , since it requires a single computation of the fields at each iteration , while retaining second - order accuracy . in this approach ,",
    "the values of the forces and the particles positions are defined at integer times ( @xmath92 ) , while the `` generating '' terms ( e.g. electron currents ) are defined at half - integer times ( @xmath93 )  where @xmath94 is the integration timestep .",
    "we therefore refer to these variable with a corresponding superscript of the form @xmath95 or @xmath96 in rest of this section .      here",
    "let us detail one full cycle of svea model integration , i.e. how the variables at iteration @xmath95 are deduced from the variables at iteration @xmath97 . in order to do so ,",
    "let us consider that , at the iteration @xmath97 , the known variables are @xmath98 , @xmath99 , @xmath100 and @xmath101 .",
    "going from iteration @xmath97 to iteration @xmath95 involves updating the fields ( a ) , as well as the particles positions and velocities ( b ) .",
    "these successive operations are repeated at each integration timestep .",
    "( 8,0 ) node[below]@xmath35 ; ( 1,0 ) circle(0.07 cm ) ; ( 1,0 ) node[above]@xmath102 ; ( 1,-0 ) node[below]@xmath99 ; ( 3,0 ) circle(0.07 cm ) ; ( 3,0.5 ) node[above]([eq : halfpush_part])@xmath103@xmath104 ; ( 3,0 ) node[below]@xmath105 ; ( 5,0 ) circle(0.07 cm ) ; ( 5,-0.5 ) node[below]([eq : push_field])@xmath103@xmath106 ; ( 7,0 ) circle(0.07 cm ) ; ( 1,0 ) .. controls ( 1.5,0.5 ) and ( 2.5,0.5 ) .. ( 3,0 ) ; ( 1,0 ) .. controls ( 2,-1 ) and ( 4,-1 ) .. ( 5,0 ) ; ( 0,1 ) node*(a ) * ;    ( 0,0 ) ",
    "( 8,0 ) node[below]@xmath35 ; ( 1,0 ) circle(0.07 cm ) ; ( 1,0 ) node[above]@xmath102 ; ( 1,-0 ) node[below]@xmath99 ; ( 3,0 ) circle(0.07 cm ) ; ( 3,0 ) node[below]@xmath107 ; ( 5,0 ) circle(0.07 cm ) ; ( 5,-0 ) node[below]@xmath108 ; ( 7,0 ) circle(0.07 cm ) ; ( 1,0 ) .. controls ( 2,1 ) and ( 4,1 ) .. ( 5,0 ) ; ( 3,0 ) .. controls ( 4,-1 ) and ( 6,-1 ) .. ( 7,0 ) ; ( 5,0.5 ) node[above]([eq : push_part])@xmath103@xmath109 ; ( 7,-0.5 ) node[below]([eq : boris])@xmath110 ; ( 0,1 ) node*(b ) * ;    \\(a ) to calculate the electromagnetic field , we consider the leapfrog discretization of [ fld_eq4 ] or ( [ fld_eq7 ] ) : @xmath111 where @xmath112 for the cartesian algorithm , and @xmath113 for fourier - bessel one .",
    "note that [ eq : push_field ] requires the variables @xmath114 and @xmath115 to be defined at step @xmath116 , whereas @xmath117 is not yet known .",
    "therefore , before applying equation ( [ eq : push_field ] ) , the algorithm first computes the _ auxiliary _ variables @xmath117 by taking a half - timestep : @xmath118 while keeping @xmath98 in the computers memory .",
    "\\(b ) the particles coordinates are updated by a standard leapfrog operation : @xmath119 calculating the particles velocity first involves computing the electric and magnetic fields at @xmath120 , by using equations [ fld_eq5_svea , fld_eq5:2 ] or their counterpart for the fourier - bessel method .",
    "the values of the electromagnetic fields are then used in the equation of motion [ motion01 ] .",
    "this equation is implemented with the boris pusher @xcite , which is an explicit algorithm that extracts @xmath121 from the implicit discretized equation  : @xmath122 these operations are summarized in [ leaps ] .",
    "the procedure of the integration of [ fld_eq4_nosvea , fld_eq7_nosvea ] is rather similar to the one described above , and it may be done with help of leapfrog method .",
    "for this we first define the time derivative of @xmath42 as a new variable @xmath123 and write two first order equations :    [ eq : push_field_nosvea ] @xmath124 @xmath125    where @xmath126 is a left hand side of [ fld_eq4_nosvea ] or [ fld_eq7_nosvea ] .",
    "now , defining @xmath127 and @xmath42 at the integer and half - integer time steps respectively , we can integrate the set [ eq : push_field_nosvea ] numerically with the discretized equations :    [ eq : push_field_nosvea1 ] @xmath128 @xmath129    note that to use the leapfrog scheme for the particle motion , the lorentz force has to be calculated on the particles positions at the integer step with help of [ fld_eq5 ] .",
    "therefore , we have to explicitly calculate the value of @xmath130 .",
    "the other steps are identical to the ones described in [ implement2:1 ] .",
    "since the real number of electrons in the beam is typically very big ( up to @xmath131 ) , in numerical simulations , the electrons are usually replaced by macro - particles .",
    "each macro - particle has the same charge - to - mass ratio as an electron , but represents a large number of electrons .",
    "typically , in simulations of fel amplification , a reasonable modeling accuracy can be reached by using a relatively low number of macro - particles , @xmath132 .",
    "however , the artificially low number of particles and associated shot noise affect the spontaneous emission generated at the beginning of a fel interaction . in practice , this simulated spontaneous emission can be very different from the physical one . in the case of the self - amplified spontaneous emission process ( sase ) , the final x - ray signal origins from this spontaneous noise , and",
    "thus the correct modeling of it is very important .",
    "the control of the shot noise in fel codes have been extensively studied in the last decades @xcite .",
    "the basic principle of this control is to suppress the shot noise for a given wavelength @xmath133 , by placing , for each macro - particle , an identical one with a longitudinal coordinate shifted by @xmath134 , so that it will emit in anti - phase with its counterpart .",
    "the physical shot noise can then be generated via a proper random displacement of these additional particles .",
    "for the first test studies of our algorithm , we will use a simple particle loading algorithm , which provides full noise suppression for a chosen wavelength and its harmonics : @xmath135 where @xmath136 is a set of the particles @xmath78-coordinates , and @xmath47 is a harmonic number .",
    "the algorithms for three - dimensional and axisymmetric simulations presented in this section are implemented in the code ` plares ` ( which stands for `` plasma resonator '' ) .",
    "the code allows to use and combine the different maxwell solvers in the same simulation , where each solver is defined by its own discontinuously composed spectral domain . in the case of solvers combination",
    ", the solvers should be linearly independent ( e.g. axially symmetric and antisymmetric ) , or operate on non - overlapping spectral domains .",
    "the tool is developed using a hybrid programming framework : the initialization of the simulation , the parallelization , the runtime management and the data output are performed by a python object - oriented code , while all the `` expensive '' number - crunching routines are written in fortran 90 and called from python via the * f2py * interface generator @xcite .",
    "parallelization is carried out by distributing the particles among the processing units and summing their contributions to the fields via message passing interface ( mpi ) ( using python s * mpi4py * package @xcite ) . in this way",
    ", the code provides a high flexibility for new external fields setup and for further algorithmic developments .",
    "in order to implement the method of [ sec1,implement ] in practice , one needs to truncate the series in [ spect_decomp , spect_decomp2 ] , and to therefore to specify a finite spectral domain in which the studied fields are localized .",
    "the optimal choice for these parameters is based on the physics of synchrotron radiation and free electron lasers .",
    "the spectral properties of synchrotron radiation are well known , and are described in the literature ( see @xcite ) .",
    "the wavelength of the emitted light by a relativistic charge is doppler - shifted by a factor @xmath137 , where @xmath138 is a unit vector pointing towards the observer . for an oscillating relativistic electron with @xmath139 and @xmath140 ,",
    "the emission is produced in the direction of the particle s velocity , and within a cone of angular size @xmath141 . for a linearly polarized undulator ,",
    "the central wavenumber of the emitted light reads : @xmath142 and its bandwidth is determined by the total number of oscillations performed by the particle , @xmath143 . here",
    "@xmath144 is the undulator parameter and @xmath145 is the angle between the direction of observation and the electron trajectory .",
    "the undulator parameter can be defined as the amplitude of oscillation of the normalized electron momentum @xmath146 . for a magnetic undulator with a field @xmath147 ,",
    "the undulator parameter reads @xcite : @xmath148\\ ; \\lambda_u [ \\text{cm}]\\,.\\ ] ] for large values of @xmath144 , the particles trajectories are significantly non - harmonic . in this case",
    ", the emitted spectrum contains harmonics of @xmath149 and becomes broadband .    during resonant amplification ,",
    "the power of the generated radiation grows exponentially along the undulator @xmath150 , where @xmath151 is the _ gain length_. the spectral bandwidth of the amplified light is typically determined by the spectrum of the light emitted by individual particles over @xmath151 . in the simple one - dimensional case of an ideal electrons beam , the gain length and the corresponding growth rate are determined by the fel parameter @xmath152 @xcite : @xmath153\\ , k_0 \\right)^{2/3}\\,,\\ ] ] where @xmath154 is the peak density of the electron bunch and @xmath155 is defined by @xmath156 . by definition ,",
    "@xmath157 \\equiv j_0(\\xi ) - j_1(\\xi)$ ] , where @xmath158 and @xmath159 are the bessel functions and @xmath160 . in this formulation , the bandwidth of the amplified light estimates as @xmath161 .",
    "it is also important to mention , that according to the sampling theorem the spectral width @xmath162 is directly related to the minimal spatial scale of the modeled radiation .",
    "this may become important , when modeling very short electron currents @xcite , seeding with a pulse produced by high - harmonics generation @xcite , etc . in this case",
    ", the required spectral bandwidth may be much bigger than the one estimated in terms of fel resonance , and should be taken into account .",
    "the transverse size of the spectral region required to describe the shape of the radiation beam and its diffraction can be deduced from [ res_k ] , by considering that the amplified light is emitted around the resonant frequency @xmath163 with a bandwidth @xmath164 . on the whole , the dimensions of the spectral domain required for an fel simulation can be approximately defined by the following formulas : @xmath165 where @xmath166 is a lorentz factor associated with electron longitudinal motion , and in case of a linearly polarized undulator @xmath167 .",
    "it is also important to correctly choose the resolution of this spectral domain , which defines the size of the periodic simulation domain , according to [ period_cond ] .",
    "the longitudinal size of the simulation domain @xmath168 should be larger than both the length of the electron beam @xmath169 and the slippage length of the radiation @xmath170 .",
    "the transverse sizes @xmath171 or @xmath52 have to be larger than the radius of the electron beam @xmath172 and the radiation beam size @xmath173 . in practice ,",
    "the structure of the radiation transverse mode is defined by its diffraction parameter @xmath174 @xcite .",
    "if the diffraction is weak , @xmath175 , the amplification is one - dimensional , and it occurs mainly within the electron beam i.e. @xmath176 . in the opposite case , @xmath177 , diffraction leads to a radiation transverse size , which is much larger than the electron beam .",
    "the parameters of this three - dimensional amplification are significantly different from [ gain1d ] , and the radiation transverse size is related to the gain length as : @xmath178 } \\sqrt{\\cfrac{2\\gamma_b n_c}{n_e}\\ , \\left(1+k_0 ^ 2/2\\right)}\\,.\\ ] ]",
    "in order to test the code ` plares ` , we benchmark it against other existing fel codes . for this",
    "we choose the data of the comparative analysis published by l. giannessi et al in @xcite . in this article , the authors compare three well - known codes medusa @xcite , genesis 1.3 @xcite and perseo @xcite on a test case which involves a coupling of high - order harmonics in a conventional magnetic undulator . in the corresponding simulation",
    ", the electron beam has a 1 ps flat - profile with a current of 110 amperes , a mean energy of 200 mev , 0.01% energy spread , a transverse emittance of 1 mm@xmath179mrad , and a radius of 95.3 @xmath180 m .",
    "the electrons travel through a magnetic undulator with a period of 2.8 cm and an undulator parameter @xmath181 .",
    "the fel process is _ seeded _ by a co - propagating 50 fs gaussian electromagnetic pulse , which is focused to a 183.74  @xmath180 m transverse size , at a distance of 70 cm from the undulator entrance .",
    "the wavelength of the seed pulse is matched to the central wavelength of the undulator radiation @xmath182 nm and its peak power is set at 10 kw .",
    "the shot noise in the simulations is completely suppressed .    in our tests",
    "we use the simple model of an ideal linearly polarized undulator , where the magnetic field oscillates with the longitudinal coordinate , and does not depend on the transverse position .",
    "moreover , no special treatment of the beam s transverse dynamics is performed , so that , after being initiated with a flat transverse density profile and a gaussian distribution in transverse momenta , the beam diverges freely .    in @xcite ,",
    "the authors perform one- and three - dimensional simulations within the steady - state and time - dependent approaches . in the steady - state approach ,",
    "the electron bunch is considered to be infinitely long , and the radiation amplitude is assumed to be independent of the longitudinal coordinate .",
    "this approach is close to the theoretical description of the fel process , and , in addition , it allows to reduce the longitudinal size of the simulation domain to a few radiation wavelengths  thereby drastically decreasing the computational load .",
    "the time - dependent approach allows to include more phenomena into the simulations and to study the impact of the finite lengths of the electron and radiation beams .",
    "for example , time - dependent simulations are able to model the `` slippage '' effect , i.e. the fact that the emitted radiation progressively overtakes the electron bunch and eventually stops being amplified .",
    "slippage typically results in significant modulations of the longitudinal profile of the radiation .",
    "m. ( d ) spectral dynamics of the third harmonics . in ( a , b ,",
    "c ) the results obtained with the code ` plares ` 1d ( colored curves ) is compared with the data produced by medusa1d ( dashed black ) , perseo ( solid black ) @xcite.,scaledwidth=90.0% ]    for the one - dimensional case we calculate the power of the radiation emitted at the first three odd harmonics . in the steady - state simulations",
    "each harmonic is modeled with a single wavenumber , so that the spectral domain is @xmath183 $ ] .",
    "the electron beam is modeled with 2000 macro - particles . in order to capture the fifth harmonic in the electron oscillations we advance each period of the radiation field with 90 iterations , so that the chosen time step @xmath184 .    in [ compare1]a",
    ", we compare the results obtained by ` plares ` ( colored curves ) with the ones obtained by medusa1d ( black dashed curve ) and perseo ( black solid curve ) for steady - state simulations .",
    "the three codes agree almost perfectly in the description of the ( seeded ) first harmonic , even at the saturation .",
    "the third and fifth harmonics are not seeded , and the comparison reveals that our code develops a lower level of spontaneous noise in the third and fifth harmonics during the early interaction .",
    "the agreement is particularly good with the unaveraged medusa1d simulations .    in order to study the longitudinal profile of the radiation",
    ", we have also run time - dependent simulations . in these tests ,",
    "the spectral domain of the fundamental and third fel harmonics have bandwidths of 1.6% @xmath149 and 4% @xmath149 respectively , and the `` time window '' ( i.e. length of the periodic simulation domain ) is @xmath185 ps .",
    "this results into a total of 98 spectral modes . as the chosen duration of the electron beam in @xcite is rather long ( 1 ps ) , this simulation requires a big number of macro - particles : @xmath186 . in [ compare1]b and [ compare1]c",
    "we compare the calculated spectral and spatial profiles of the radiation with those obtained in the medusa1d and perseo simulations .",
    "the agreement between the three codes is found to be remarkably good .",
    "the dynamics of the spectral distribution of the third harmonic is shown in [ compare1]d . in this figure , the formation , growth and saturation of the third harmonic can be clearly seen .    to test the validity of the reduced - order model discussed in [ sec1:5 ] , we perform a test , which is assumed to violate the standard svea approximation , used in the averaged fdtd fel codes . for this",
    "we consider the same time - dependent simulation as before , but with electron current duration of 28 fs , which corresponds to only 31 wavelengths of the amplified fundamental mode .",
    "for such conditions , the slippage becomes important and should be treated without temporal or spatial averaging .",
    "the results of the simulations with [ fld_eq7_nosvea ] and [ fld_eq7 ] are presented in [ nosvea ] . the relative discrepancy in the produced radiation energy between the algorithms",
    "is also presented with a green curve in [ nosvea ] .",
    "the discrepancy grows with the signal amplification , however , it stays reasonably low , and does not exceed 1.5 % .",
    "( solid blue curve ) and reduced [ implement2:1 ] ( dashed blue curve ) algorithms .",
    "dynamics of the relative algorithms discrepancy @xmath187 is shown by a solid green curve.,scaledwidth=45.0% ]    the one - dimensional tests were performed on a desktop computer using the 4-cores cpu intel xeon e5 - 1620 .",
    "the steady - state simulations required only 0.5 minute , while the time - dependent tests needed around 30 minutes due to the high number of modes and macro - particles .",
    "the algorithms described in [ implement2:1,implement2:2 ] demonstrated rather similar performance  the non - svea simulation took only 4% more time than [ implement2:1 ] .",
    "this is due to the fact that the mentioned timing includes also particle pusher , mpi exchange , and writing the diagnostic data to the disk .",
    "an additional series of tests is performed in order to account for three - dimensional effects , such as : diffraction of the amplified waves , focusing of the seed pulse , divergence of electron beam , and transverse structure of the even fel harmonics .",
    "the developed numerical code allows such study via the full three dimensional cartesian solver , or via the axially symmetric and antisymmetric solvers , described in [ sec1:1,sec1:2 ] respectively .",
    "for the first test , we perform a steady state modeling of the first five harmonics , @xmath188 $ ] , with the fully 3d solver .",
    "the transverse size of the modeled domain is @xmath189 mm , and the maximal transverse wavenumbers are fixed to @xmath190 mm@xmath191 .",
    "this results in a transverse spectral grid composed of @xmath192 modes .",
    "the required number of macro - particles for the steady - state simulations can be rather low , and in this test we have used 8000 particles .",
    "the modeled growth of the radiation power is presented in [ 3dss ] ( solid curves ) .",
    "if compared with the data presented in @xcite , the excitation of the third and fifth harmonics in our simulation occurs about 50 cm earlier , but agrees in the dynamics and in saturation power values .",
    "the discrepancy may result from the difference in the undulator implementation , and in the initial transverse distribution of the electrons in the two codes .",
    "the fully three - dimensional simulation took 90 minutes using four 6-core intel xeon x5690 cpus . using the axisymmetric model with the same simulation parameters",
    ", we may use only 42 transverse bessel modes , which would drastically speed - up the calculation .",
    "we performed a test using a combination of three solvers : one axisymmetric solver , and two antisymmetric solvers with respect to the @xmath76-axis ( along electron oscillations ) and @xmath193-axis .",
    "all three solvers are linearly independent , and may be used simultaneously for the same longitudinal modes , which allows to compare the contributions of each solver to the total power of each fel harmonic .",
    "the results of this test are presented by the dashed curves in [ 3dss ] and they have a remarkable agreement with the fully three - dimensional model . in [ tab1 ]",
    "we introduce the fractions of the total power at the exit of the undulator modeled by each solver .",
    "as can be seen , the odd harmonics are almost purely axisymmetric , while the even ones are antisymmetric with respect to the @xmath193-axis . using only these two solvers , and dividing the odd and even harmonics between them ,",
    "this calculation can be performed in 5 minutes .",
    ".fractions of the total emitted power modeled by fourier - bessel solvers for each of first five harmonics [ cols=\"^,^,^,^\",options=\"header \" , ]     in [ tem ] we plot the phase - fronts of the second harmonic on the exit of the undulator modeled by the three - dimensional ( a ) and axisymmetric ( b ) algorithms .",
    "the field distributions almost perfectly agree ( discrepancy of 0.57 % ) except for the central part , where three - dimensional approach demonstrates slightly asymmetric features .",
    "m in the steady - state fully three - dimensional ( a ) and axisymmetric ( b ) simulations . the value of @xmath194 field is described in the colorbar in the units of @xmath195.,scaledwidth=90.0% ]        in the last test , we performed a time - dependent simulation with the axisymmetric algorithms . here",
    ", only the first and third harmonics are modeled .",
    "the spectral domains for each harmonics are chosen to have a relative bandwidth of 1% and in the transverse direction the maximal wavenumber is fixed to @xmath196 mm@xmath191 .",
    "the resulting spectral grid for both harmonics is composed of @xmath197 modes , and the electron beam is represented by @xmath198 macro - particles .",
    "the energy growths for each harmonic are shown in [ compare2]a . in this figure , we compare the results of the ` plares ` simulation ( colored curves ) with the data produced by genesis ( dashed black ) and perseo ( solid black ) .",
    "our results demonstrate a very good agreement with the code genesis , in which the three - dimensional effects are self - consistently taken into account . on the opposite ,",
    "the code perseo is essentially one - dimensional , and three - dimensional effects are taken into account only approximately , by using the analytic model of m. xie @xcite .",
    "to conclude , we have presented a spectral time - domain method for fel simulations , we have detailed its general mathematical and numerical formulation .",
    "this method is used to model the resonant interaction of a short - wavelength electromagnetic field with a relativistic particle beam .",
    "we have shown that , by representing the fields in a discrete fourier space , one can significantly simplify the integration of the electromagnetic equations . in doing so",
    ", we also avoid the approximated interpolation and averaging techniques , that are associated with ftdt schemes .",
    "instead we use the exact projections of the particle currents onto the fourier modes , and integrate field and motion equations resolving the electron oscillations .",
    "the interaction of the particles with the electric and magnetic fields in real space is described via a leapfrog integration scheme .",
    "the reduced - order field equation is derived with assumption of the temporally slow variation of the field amplitude .",
    "the discussed algorithms for three - dimensional and axisymmetric simulations are implemented in the code ` plares ` .",
    "the code is tested , and test results were compared to the ones obtained with the commonly used fel codes . in the test cases involving harmonic amplification in a magnetic undulator , the comparisons have demonstrated an excellent agreement between ` plares ` and other codes .",
    "the comparison of the models with the second order field equation and the reduced - order svea equation have revealed no significant differences in the case of a short beam .",
    "the unaveraged algorithm for the particle motion and the general approach used in its numerical implementation provides flexibility to the code .",
    "this allows for instance to use very realistic models for the undulators with a complex field structure , and to consider electron beams with a complex phase - space structure .",
    "this is paramount for the concepts of coherent radiation sources , based on the alternative drivers and undulators .",
    "for example , it has been proposed to create a new type of x - ray sources by accelerating the electrons with a laser - wakefield accelerator @xcite .",
    "laser - wakefield accelerators can indeed produce high peak current femtosecond beams of relativistic electrons on a millimeter distances @xcite , but the phase - structure of these beams can be very different than that of conventional accelerators . presently the brightness of such sources is rather moderate as a result of the high electron divergence .",
    "this motivates the development of more compact undulators , and a number of the alternative undulator schemes have been proposed and explored recently @xcite . in this context ,",
    "the unaveraged and generic approach of ` plares ` can be beneficial , as it can be flexibility adapted to the various proposed schemes .",
    "this work was partially supported by the european research council through the paris erc project ( contract no .",
    "226424 ) and x - five erc project ( contract no .",
    "authors would like to acknowledge ph .",
    "balcou , v.t .",
    "tikhonchuk and m .- e .",
    "couprie for fruitful discussions ."
  ],
  "abstract_text": [
    "<S> we propose and discuss a numerical method to model electromagnetic emission from the oscillating relativistic charged particles and its coherent amplification . </S>",
    "<S> the developed technique is well suited for free electron laser simulations , but it may also be useful for a wider range of physical problems involving resonant field - particles interactions . </S>",
    "<S> the algorithm integrates the unaveraged coupled equations for the particles and the electromagnetic fields in a discrete spectral domain . using this algorithm , it is possible to perform full three - dimensional or axisymmetric simulations of short - wavelength amplification . in this paper </S>",
    "<S> we describe the method , its implementation , and we present examples of free electron laser simulations comparing the results with the ones provided by commonly known free electron laser codes . </S>"
  ]
}