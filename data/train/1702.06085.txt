{
  "article_text": [
    "the use of patches in image processing can be seen as an instance of the  divide and conquer \" principle : since it is admittedly very difficult to formulate a global prior / model for images , patch - based approaches use priors / models for patches ( rather than whole images ) , the combination of which yields the desired image prior / model . to keep the discussion and formulation at their essential and focus on the image modelling aspects",
    ", we will concentrate on image denoising , arguably the quintessential image processing problem .",
    "nevertheless , much of what will be presented below can be easily extended ( at least in principle ) to more general inverse problems .",
    "there are basically two approaches to patch - based image denoising . in earlier methods",
    "@xcite , @xcite , @xcite , patches are extracted from the noisy image , then processed / denoised independently ( or maybe even collaboratively , as in bm3d @xcite ) , and finally returned to their original locations .",
    "since the patches overlap ( to avoid blocking artifacts ) , there are several estimates of each pixel , which are combined by some form of averaging ( unweighted or weighted ) .",
    "this approach is also used in the nonlocal bayesian method @xcite , and in methods based on gaussian mixtures @xcite . for a comprehensive review of these and related methods ,",
    "see @xcite .",
    "arguably , a conceptual flaw of these methods is that they obtain patch estimates without explicitly taking into account that these will subsequently be combined additively . as a consequence , although some of these methods achieve state - of - the - art results , they do not explicitly provide a global image prior / model .",
    "a more recent class of approaches does build global image models that are based on a function computed from image patches , but does not treat them as independent by explicitly taking into account that they are overlapping patches of the same image ; this approach was initiated with the _ expected patch log - likelihood _ ( epll ) @xcite , and is adopted by most of the recent work @xcite , @xcite .",
    "these methods do not have the conceptual flaw pointed out in the previous paragraph and provide a coherent global image model .",
    "the analysis vs synthesis dichotomy in global image models / priors ( _ e.g. _ , based on wavelet frames , or total variation ) has been first formalized in @xcite , and further studied in @xcite ; more recently , it has been ported to patch - wise models @xcite .",
    "to the best of our knowledge , this dichotomy has not been pointed out before concerning the way in which patch - level models / priors are used to build a global image models ; that is precisely the central contribution of this paper .    in the synthesis vs analysis dichotomy",
    ", the epll - type class of patch - based models can be seen as an analysis method ( as explained below in detail ) .",
    "this paper shows that there exists the synthesis counterpart of epll ; in other words , that the synthesis vs analysis dichotomy is also present in the way the whole image and the patches are related .",
    "we also show that the two formulations are not , in general , equivalent .",
    "the remaining sections of this paper are organized as follows . after reviewing the classical analysis / synthesis dichotomy in section [ sec : a_vs_s ] , we shown in section [ sec : patch_a ] that the classical patch - based methods follow an analysis formulation .",
    "section [ sec : patch_s ] then introduces a synthesis patch - based formulation , and its relationship with the analysis counterpart is established in section [ sec : rel ] . in section [ sec : admm ] , we present an admm algorithm to efficiently perform image denoising under the proposed synthesis formulation .",
    "finally , section [ sec : conclusion ] concludes the paper by referring to future work directions .",
    "[ sec : a_vs_s ] before addressing patch - based models , we briefly review the analysis and synthesis global formulations of image denoising @xcite , where the goal is to estimate an unknown image @xmath0 ( @xmath1 is the total number of pixels in @xmath2 , which is a vectorized version of the corresponding @xmath3 image ) from a noisy version thereof @xmath4 where @xmath5 is a sample of a white gaussian noise field of zero mean and ( known ) variance @xmath6 , that is , @xmath7 .    the classical approach to estimate @xmath2 from @xmath8 is to adopt ( or learn ) a prior @xmath9 for the unknown @xmath2 and seek a maximizer of the posterior density ( a _ maximum a posteriori_map  estimate ) @xmath10 where @xmath11 , up to an irrelevant constant .",
    "the analysis and synthesis formulations build priors for @xmath2 as follows .",
    "analysis : : :    in this formulation , the prior @xmath9 takes the form    @xmath12 where    @xmath13 is a constant and @xmath14 a linear    ( analysis ) operator . in this case , the map estimate takes the form    @xmath15    where map - a stands for _ map - analysis_. synthesis : : :    here , the starting point is to assume that @xmath2 is    linearly synthesized / represented according to    @xmath16 , where @xmath17 is a    vector of coefficients , and the prior is formulated on    @xmath17 rather than directly on @xmath2 ; once    an estimate @xmath18 is obtained , the corresponding    estimate of @xmath2 is simply    @xmath19 . in summary ,",
    "@xmath20    and @xmath21 is a    negative log - prior on @xmath17 .",
    "one of the main distinguishing features of analysis and synthesis formulations is that in the former the object of the estimation procedure is the image itself , whereas in the latter , one estimates a representation from which the image estimate is synthesized .",
    "a central tool in most patch - based approaches is a collection of operators @xmath22 that extracts @xmath23 patches from a given image of size @xmath3 ; each @xmath24 can be seen as a binary matrix with size @xmath25 , where @xmath26 is the total number of pixels in each patch ( assumed square , of size @xmath27 ) .",
    "the standard way of formulating a patch - based prior is by writing @xmath28 where @xmath29 is a function expressing the patch - wise prior distribution and @xmath30 is a normalizing constant .",
    "function @xmath31 may itself be a _ probability density function _",
    "( pdf ) , _",
    "e.g. _ , a gmm , in which case this prior is an instance of a so - called _ product of experts _ ( poe @xcite ) .",
    "however , @xmath31 does not need to be a pdf , as long as it takes non - negative values ; in fact , can also be seen as a _ factor graph _ model , where each factor corresponds to a patch and the all factors have the same function @xmath31 @xcite .",
    "moreover , this prior is also equivalent to the formulation known as epll ( _ expected patch log - likleihood _",
    "@xcite ) , although epll was not originally interpreted as a prior .    given a noisy image @xmath8 , a map estimate of @xmath2 is given by @xmath32      to tackle the large - scale optimization problem in , the so - called _ half quadratic splitting _",
    "strategy replaces it with @xmath33 where @xmath34 , which obviously becomes equivalent to as @xmath35 @xcite .",
    "the optimization problem in is tackled by alternating between minimizing with respect to @xmath36 and @xmath2 , while slowly increasing @xmath37 .",
    "other strategies for setting @xmath37 have also been proposed @xcite .    an obvious alternative ( as recently mentioned in @xcite )",
    "is to reformulate as a constrained problem @xmath38 and tackle it with admm ( _ alternating direction method of multipliers _ ) @xcite .",
    "of course , convergence of admm for this problem can only be guaranteed if the negative log factors @xmath39 are convex ; this is not the case if @xmath31 is a gmm , but it is true if @xmath39 is an @xmath40 norm or the @xmath41-th power thereof , _",
    "e.g. _ , @xmath42 , with @xmath43 .    examining ( with @xmath44 ) or reveals that this formulation seeks a consensus among the patches , in the sense that the several replicates of each pixels that exist in different patches are forced to agree on a common value for that pixel .",
    "in other words , the clean patches are not modelled as additively generating a clean image , and are merely used to write a joint prior @xmath9 that factorizes across overlapping patches .",
    "the estimation criterion in clearly falls in the analysis - type category @xcite , since it considers the image itself as the object to be estimated and as the argument of the prior .",
    "however , as a generative model for clean images , its meaning is not very clear , since it is not a trivial task to obtain samples from this distribution .    to obtain a more compact notation ,",
    "let @xmath45 be the operator ( an @xmath46 matrix ) that extracts the set of @xmath23 patches , _",
    "i.e. _ , @xmath47 the prior @xmath9 may then be written as @xmath48 where @xmath49 denotes a density defined in @xmath50 according to @xmath51 with this notation , the map denoising problem can be written as @xmath52 which clearly reveals the analysis nature of this formulation ( see ) .",
    "we stress that the analysis / synthesis dichotomy addressed in this paper concerns the way in which an image relates to its patches , not the way the patches themselves are modelled .",
    "in fact , the patch - analysis formulation just reviewed is compatible with a synthesis patch model , _",
    "e.g. _ , one that models each patch @xmath53 as linear combination of elements of some dictionary @xmath54 , with coefficients @xmath55 equipped with some prior @xmath56 ( for example , a sparsity - inducing prior , as in @xcite ) .",
    "using the half quadratic splitting approach , the formulation becomes @xmath57 where @xmath58 .",
    "naturally , the patch - analysis formulation is also compatible with an analysis patch model @xcite , by using a patch prior of the form @xmath59 , _",
    "i.e. _ , @xmath60 , for some function @xmath61 and matrix @xmath62 .",
    "to identify the analysis / synthesis dichotomy in terms of how the patches are related to the underlying image , not in terms of how the patches are modelled , we refer to the formulation reviewed in this section as _ patch - analysis _ and to its synthesis counterpart ( to be introduced in the next section ) as _ patch - synthesis_.",
    "we now present the patch - synthesis formulation , which can be summarized as follows : the clean image is generated by additively combining a collection of patches ; the patches themselves follow some probabilistic model , but are a priori mutually independent .",
    "consider a collection of patches @xmath63 and let image @xmath2 be synthesized from these patches by combining them additively according to @xmath64 where matrices @xmath65 are such that they average the values in the several patches that contribute to a given pixel of @xmath2 .",
    "a simple 1d example will help clarify the structure of the @xmath66 matrices .",
    "consider that @xmath67^t$ ] is produced by combining all the consecutive 2-element patches ( with periodic boundary conditions ) , which correspond to the subsets of components @xmath68 , @xmath69 , @xmath70 and @xmath71 .",
    "that is , @xmath72 and @xmath73    stacking all the patches in vector @xmath74 and considering a matrix @xmath75 \\in \\mathbb{r}^{n\\times(mn)}$ ] , the synthesis expression in can be written compactly as @xmath76    with the patches modelled as independent and identically distributed samples of some patch - wise pdf @xmath77 , their joint log - prior is @xmath78    notice that obtaining samples from is as simple as obtaining samples from @xmath77 itself . consequently",
    ", generating image samples under this synthesis model simply corresponds to generating samples from and then multiplying them by @xmath79 .",
    "this is in contrast with the patch - analysis prior , where , even if @xmath31 is a valid pdf , it is not trivial to obtain samples from @xmath9 .",
    "the resulting map denoising criterion can now be written as @xmath80    as the patch - analysis model , the patch - synthesis formulation that we have just presented is compatible with both analysis and synthesis priors for the patches , and of course with any valid pdf for vectors in @xmath81 .",
    "an analysis formulation simply amounts to choosing a patch prior of the form @xmath82 , _",
    "i.e. _ , @xmath83 , for some function @xmath84 and matrix @xmath85 .    in a synthesis formulation",
    ", each patch @xmath86 is synthesized using some dictionary @xmath54 as @xmath87 , and the @xmath55 follow some prior @xmath56 ; stacking all the patch coefficients in vector @xmath88 , we can write @xmath89 ( where @xmath90 is a block - diagonal matrix with @xmath23 replicas of @xmath54 ) , thus the map denoising criterion becomes @xmath91 where @xmath92",
    "leaving aside for now the choice of the patch priors , let us focus on the relationship between formulations and .",
    "the key observation underlying the relationship between these two formulations is that ( assuming the patch structure in both formulations is the same ) @xmath93 where @xmath94 denotes the identity matrix , but in general @xmath95 in other words , @xmath79 is a left pseudo - inverse of @xmath96 . to prove , simply notice that if a collection of patches is extracted from some image and then these patches are used to synthesize an image by averaging the overlapping pixels , an identical image is obtained .",
    "of course , the converse is not true , in general : if an image is synthesized by averaging the overlapping pixels of a collection of patches , and then patches are extracted from the synthesized image , there is no guarantee that these patches are equal to the original ones , thus proving . in the trivial and uninteresting cases where the patches are singletons , or non - overlapping",
    ", we would have @xmath97 .    as shown in @xcite ,",
    "given the analysis formulation , an equivalent synthesis formulation is @xmath98 where the constraint @xmath99 enforces @xmath100 to be in the subspace spanned by the columns of @xmath96 .",
    "notice that this constraint corresponds to having a collection of patches extracted from some image , _",
    "i.e. _ , it forces the patches to agree on the value of each shared pixel . since does not enforce this constraint , it is not , in general , equivalent to the patch - analysis formulation .",
    "in this section , we derive an instance of admm to deal with . the first step is to rewrite it as a constrained problem , @xmath101 where @xmath102 is the negative log - prior , or regularizer .",
    "admm for this problem takes the form @xmath103 the update equation for @xmath104 is a denoising step .",
    "due to the separability of the squared @xmath105 norm and of @xmath106 ( see ) , this can be separately solved with respect to each patch : for @xmath107 , @xmath108 which is simply the proximity operator of @xmath109 @xcite , computed at @xmath110 . in a bayesian viewpoint ,",
    "corresponds to obtaining the map estimate of @xmath111 from observations @xmath110 , assuming additive white gaussian noise of variance @xmath112 and a negative log - prior @xmath113 .",
    "if the @xmath113 are convex , this map estimate is unique , due to the strict convexity of the quadratic term in .",
    "computing @xmath114 corresponds to solving an unconstrained quadratic problem , the solution being @xmath115 the bottleneck in this update equation seems to be the matrix inversion , since @xmath116 is a huge @xmath117 matrix .",
    "however , this inversion can be solved very efficiently by resorting to the sherman - morrison - woodbury matrix inversion formula .",
    "in fact , @xmath118 where matrix @xmath119 is diagonal , thus its inversion is trivial . to prove that @xmath120 is diagonal , recall that @xmath121 , thus @xmath122 the element @xmath123 of matrix @xmath124 is the inner product between the @xmath125-th and the @xmath126-th rows of @xmath66 .",
    "since each pixel in the @xmath127-th patch contributes to one and only one pixel in the synthesized image , the rows of @xmath66 have disjoint support , thus @xmath128 , that is , @xmath129 has no non - zero elements outside of its main diagonal , thus is a diagonal matrix . finally , since @xmath120 is a sum of diagonal matrices , it is a diagonal matrix .",
    "it is also easy to obtain explicitly the elements of the diagonal of @xmath120 .",
    "the diagonal elements @xmath130 are given by @xmath131 if the @xmath127-th patch contributes to pixel @xmath125 , the sum in contains exactly one non - zero term , thus it is equal to the square of the weight with which the @xmath127-th patch contributes to the synthesis of pixel @xmath125 . if the @xmath127-th patch does not contributes to pixel @xmath125 , then @xmath132 .",
    "finally , since the weight with which each patch element contributes to each pixel equals the inverse of the number of patches that contributes to that pixel , @xmath133 is equal to the inverse of the number of patches that contribute to pixel @xmath125 . referring to the example in  ,",
    "we have simply @xmath134 , because each pixel is synthesized from two patches .",
    "finally , letting @xmath135 , and denoting @xmath136 , we can write the update equation as @xmath137 where @xmath138 denotes element - wise product between two vectors . the leading cost of this update is that of the matrix - vector products involving @xmath79 and @xmath139 , which is @xmath140 ; all the other operations in have lower computational cost .",
    "in this paper , we have revisited patch - based image priors under the light of the synthesis vs analysis dichotomy . after showing that the classical patch - based image models ( namely the epll ) corresponds to an analysis formulation",
    ", we have proposed a patch - synthesis formulation , and analyzed its relationship with the analysis formulation , showing that they are , in general , not equivalent .",
    "finally , we have shown how to address image denoising under the proposed formulation , via an admm algorithm .",
    "we stress again that the purpose of this paper is not to introduce a new particular image prior , but a general patch - based synthesis formulation / framework , which ( to the best of our knowledge ) was missing from the literature on patch - based image processing , and which can be instantiated with many different patch models / priors . for this reason ,",
    "we have abstained from presenting experimental results ; these would critically depend on the choice and estimation of a particular patch model , which is not the focus of this paper .",
    "s. boyd1 , n. parikh , e. chu , b. peleato , j. eckstein ,  distributed optimization and statistical learning via the alternating direction method of multipliers \" , _ foundations and trends in machine learning _ , vol .  3 , pp .",
    "1-122 , 2011 ."
  ],
  "abstract_text": [
    "<S> in global models / priors ( for example , using wavelet frames ) , there is a well known analysis vs synthesis dichotomy in the way signal / image priors are formulated . in patch - based image models </S>",
    "<S> / priors , this dichotomy is also present in the choice of how each patch is modeled . </S>",
    "<S> this paper shows that there is another analysis vs synthesis dichotomy , in terms of how the whole image is related to the patches , and that all existing patch - based formulations that provide a global image prior belong to the analysis category . </S>",
    "<S> we then propose a synthesis formulation , where the image is explicitly modeled as being synthesized by additively combining a collection of independent patches . </S>",
    "<S> we formally establish that these analysis and synthesis formulations are not equivalent in general and that both formulations are compatible with analysis and synthesis formulations at the patch level . </S>",
    "<S> finally , we present an instance of the _ alternating direction method of multipliers _ ( admm ) that can be used to perform image denoising under the proposed synthesis formulation , showing its computational feasibility . rather than showing the superiority of the synthesis or analysis formulations , the contributions of this paper is to establish the existence of both alternatives , thus closing the corresponding gap in the field of patch - based image processing . </S>"
  ]
}