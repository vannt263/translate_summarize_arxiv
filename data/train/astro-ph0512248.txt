{
  "article_text": [
    "astrophysical plasma spectroscopy is a fascinating but very complex research field because non - equilibrium physics is required .",
    "first , for given atomic or molecular number densities at each point within the astrophysical plasma under consideration , we have the problem of how to calculate the population numbers of the levels included in the atomic or molecular model .",
    "second , it is also important to remember that the atomic and/or molecular number densities themselves are not always given by the instantaneous values of the physical conditions of the plasma ( e.g. , kinetic temperature , density ) , simply because such conditions may be changing rapidly with time as as result of magneto - hydrodynamical processes .",
    "therefore , for instance , it may be `` dangerous '' to infer chemical abundances in stellar atmospheres by computing the molecular number densities via the approximation of instantaneous chemical equilibrium .",
    "the present keynote article addresses these two aspects of astrophysical plasma spectroscopy , with emphasis on the increasingly attractive topic of non - lte radiative transfer in molecular lines ( e.g. , note that in the very near future the herschell space observatory of esa is expected to be fully operative ) .",
    "the standard multilevel radiative transfer problem requires the joint solution of the radiative transfer ( rt ) equation ( which describes the radiation field ) and the kinetic equations ( ke ) for the atomic or molecular level populations ( which describe the excitation state ) .",
    "the numerical solution of this non - local and non - linear problem requires to discretize the model atmosphere in np points , where the physical properties are assumed to be known .",
    "the standard multilevel rt problem consists in obtaining the population @xmath1 of each of the @xmath2 levels included in the atomic / molecular model that are consistent with the radiation field within the stellar atmosphere .",
    "this radiation field has contributions from possible background sources and from the radiative transitions in the given atomic / molecular model .    making the usual assumption of statistical equilibrium , the rate equation for each level",
    "@xmath3 at each spatial point reduces to ( socas - navarro & trujillo bueno 1997 ) : @xmath4 where @xmath5 is the collisional rate between levels @xmath3 and @xmath6 and @xmath7 is the net radiative rate in the transition from a bound lower level @xmath8 to an upper level @xmath9 : @xmath10 with @xmath11 the radiative rates .",
    "given that eqs .",
    "( [ eq_statis_equil_eq ] ) are not linearly independent , we replace one of them by the particle conservation law : @xmath12 where @xmath13 is the total number density of the species under consideration .",
    "the resulting system can be formally written as : @xmath14 where @xmath15 is a matrix of size nl@xmath16nl whose elements contain the collisional and radiative rates ( except for one of the rows that contains 1 due to the conservation law ) , @xmath17 is a vector of length nl with zeros except for the @xmath18 value of the conservation law , and @xmath19 is a vector containing the population of each level .",
    "the result of grouping together the sets of eqs .",
    "( [ eq_matricial_sys ] ) for all the np grid points of the atmosphere can be symbolically represented as @xmath20 where @xmath21 is a known vector of size np@xmath16nl , @xmath22 is a vector of the same length with the populations of the nl levels for each of the np points and @xmath23 is a _ block - diagonal _ matrix such that each of its np blocks of size nl@xmath16nl is given by the matrix @xmath24 of eq .",
    "( [ eq_matricial_sys ] ) .",
    "the collisional rates are assumed to be known and given by the local physical conditions of the atmosphere . on the other hand , the net radiative rates @xmath7 depend on the radiation field within the stellar atmosphere . for bound - bound transitions @xmath25 where @xmath26 , @xmath27 and @xmath28 are the einstein coefficients .",
    "a key quantity is @xmath29 , which is the frequency averaged mean intensity weighted by the line absorption profile : @xmath30 where @xmath31 and @xmath32 are , respectively , the normalized line profile and the specific intensity at frequency @xmath33 and direction @xmath34 .",
    "the specific intensity is governed by the radiative transfer equation , which can be formally solved if we know the variation of the opacity ( @xmath35 ) and of the source function ( @xmath36 , being @xmath37 the emission coefficient ) in the medium .",
    "once the stellar atmosphere is discretized , the specific intensity can be written formally as @xmath38 + \\mathcal{\\bf t}_{\\nu \\mathbf{\\omega } } , \\nonumber\\ ] ] where @xmath39 is a vector that accounts for the contribution of the boundary conditions to the intensity at each spatial point of the discretized medium , @xmath40 is the source function vector and @xmath41 is an operator whose element @xmath42 gives the response of the radiation field at point `` @xmath3 '' due to a unit - pulse perturbation in the source function at point `` @xmath6 '' .    since the radiative transfer equation couples different parts of the atmosphere and the absorption and emission properties at all the spatial points depend on the level populations , the rt problem is both _ non - local _ and _ non - linear_. therefore , the system of eqs .",
    "( [ eq_matricial_sys ] ) represents a highly non - linear problem ( i.e. , the operator @xmath24 depends implicitly on @xmath22 ) .",
    "this non - linearity makes it necessary to apply suitable iterative methods .",
    "the equation that describes the radiative transfer in a spherically symmetric atmosphere where the physical conditions vary only along the radial direction is ( e.g. , mihalas 1978 ) : @xmath43 where @xmath44 is the radial coordinate and @xmath45 the cosine of the angle between the radial direction and the ray .",
    "this partial differential equation ( pde ) can be reduced to a set of ordinary differential equations ( ode ) if solved along the characteristics of the pde . in this case , the characteristic curves ( parameterized by @xmath46 ) are straight lines with constant impact parameter @xmath47 : @xmath48    in order to solve the rt equation in spherical geometry , we apply the parabolic short - characteristics ( sc ) method ( kunasz & auer 1988 ; auer & paletou 1994 ; auer , fabiani bendicho & trujillo bueno 1994 ) along each ray of constant impact parameter .",
    "as shown by trujillo bueno & fabiani bendicho ( 1995 ) , the sc method allows an efficient implementation of the fast iterative methods based on the gauss ",
    "seidel iterative scheme .",
    "the parabolic sc method assumes that the variation of the source function with the optical depth along the ray under consideration has a parabolic behavior between each three consecutive points .",
    "consider the _",
    "point m , the point o where the intensity is being calculated and the _ downwind _",
    "point p. the source function at each of such consecutive points can be easily calculated from the current values of the level populations .",
    "the intensity @xmath49 at the upwind point m is also known from previous steps .",
    "taking into account that the formal solution of the radiative transfer equation is given by @xmath50 it is easy to obtain the following formula ( kunasz & auer 1988 ) : @xmath51 the quantities @xmath52 are functions of the optical distances @xmath53 between the upwind point m and the point o and of the optical distance @xmath54 between the point o and the downwind point p , while @xmath55 are the values of the source function at points m , o and p , respectively .",
    "we can build a similar formula assuming that the source function varies linearly between points m and o , which is used only at the boundary grid points for rays going out of the boundaries . in this case , the last term of eq .",
    "( [ eq_short_characteristics ] ) disappears and @xmath56 and @xmath57 only depend on @xmath53 .",
    "note that @xmath58 and @xmath59 , with @xmath60 the opacity at point @xmath3 ( which depends on the lower - level population at point @xmath3 ) .      the basic idea behind an iterative method for the solution of a nonlinear problem is to start from an estimation of the solution ( ideally as close to the final solution as possible ) and",
    "then to perform successive corrections to the current estimation until the final solution is found .",
    "iterative methods for multilevel transfer problems obey the same structure .",
    "consider the solution of eqs .",
    "( [ eq_matricial_sys ] ) at each of the np spatial points .",
    "we start from an estimate , @xmath61 , of the atomic or molecular level populations at each point .",
    "if this estimate is not the exact solution of the problem , we have a nonzero residual @xmath62 where the superscript `` old '' indicates that the radiative rates of the operator @xmath63 have to be calculated by solving the rt equation using the previous estimation of the populations ( i.e. , using @xmath61 ) .",
    "this matrix is built , for every point in the atmosphere , by using also the appropriate collisional rates of the chosen atomic / molecular model .",
    "the aim is to find the correction , @xmath64 , such that the estimation : @xmath65 gives a zero residual and , therefore , @xmath66 note that this equation can not be directly solved because it is still nonlinear and similar to the original eq .",
    "( [ eq_matricial_sys ] ) ; hence it is not possible to solve the problem in one single step .",
    "therefore , we have to obtain approximate corrections in order to arrive to the self - consistent solution iteratively .",
    "the different iterative methods applied to the solution of multilevel radiative transfer problems differ in the way one manages to build , at each iterative step , a linear system of equations whose solution gives _ approximate _ corrections to the level populations .",
    "an efficient iterative method should account for the non - locality and the radiative couplings of the problem ( see socas - navarro & trujillo bueno 1997 ) .",
    "this method is the most direct and simple one .",
    "it consists in solving eq .",
    "( [ eq_final_sol ] ) by calculating the radiative rates at each point in the atmosphere using the populations from the previous iterative step ( i.e. , @xmath61 ) .",
    "therefore , the corrections to the estimation of the populations can be obtained from : @xmath67 note that the mean intensity @xmath29 at each spatial point is obtained by solving the rt equation using the @xmath68 values of the populations at all the points of the computational grid . in this way , at each iterative step the nonlinear system is transformed into a linear one , which can be solved easily to obtain the approximate corrections to the populations .",
    "this procedure is iterated until convergence .",
    "although very simple and easy to code , the @xmath0-iteration method has a serious drawback , which is its very poor convergence rate in optically thick media .",
    "this is due to the fact that this method is equivalent to assuming that the radiation field does not react to the perturbations in the populations ( see socas - navarro & trujillo bueno 1997 ) .",
    "for example , for the case of bound - bound transitions such an unrealistic assumption implies that the expression of eq .",
    "( [ net_rate_bound ] ) is taken equal to @xmath69 in fact , when this approximate expression for the net radiative rate is introduced in eq .",
    "( [ eq_statis_equil_eq ] ) we obtain eq .",
    "( [ eq_lambda_iter_scheme ] ) . in any case , we point out that the @xmath0-iteration method is useful for optically thin problems ( e.g. , bernes 1979 , uitenbroek 2000 ) .",
    "mali is a clever modification of the @xmath0-iteration method , which implies a much higher convergence rate ( cannon 1973 ; olson , auer & buchler 1986 ; rybicki & hummer 1991 , 1992 ; auer , fabiani bendicho & trujillo bueno 1994 ) .",
    "there are several methods to achieve the required linearity in the system of eqs .",
    "( [ eq_final_sol ] ) at each iterative step .",
    "the most powerful ones are linearization ( auer & mihalas 1969 ; scharmer & carlsson 1985 ) and preconditioning ( rybicki & hummer 1991 , 1992 ) .",
    "socas - navarro & trujillo bueno ( 1997 ) showed that both schemes are equivalent , but that the preconditioning strategy with a local approximate operator guarantees positive populations .",
    "the preconditioning approach with a local approximate operator is nowadays the most used due to its simplicity and good performance .",
    "it is usually referred to as multilevel - ali ( mali ) .",
    "as pointed out by socas - navarro & trujillo bueno ( 1997 ) this method takes into account the local response of the radiation field to the source function perturbations .",
    "for example , for the case of bound - bound transitions the expression of eq .",
    "( [ net_rate_bound ] ) takes the form @xmath70 where @xmath71 is the line source function computed using @xmath68 .",
    "when this new approximate expression for the net radiative rate is introduced in eq .",
    "( [ eq_statis_equil_eq ] ) the resulting linearized system of equations is @xmath72 which is similar to eq .",
    "( [ eq_lambda_iter_scheme ] ) , but with the crucial difference that the elements of @xmath73 now account for the information provided by the approximate @xmath0-operator through the quantity @xmath74 where @xmath75 is the frequency - dependent line strength given by @xmath76 with @xmath77 the line opacity computed with @xmath78 and @xmath79 the background opacity .",
    "when the approximate operator is chosen equal to the diagonal of the full operator @xmath41 , the computational time per iteration is similar to that of the @xmath0-iteration scheme .    the implementation of the mali method for the solution of rt problems in spherical geometry can be easily carried out with the aid of the short - characteristics formal solver .",
    "we need to evaluate the mean intensity , @xmath29 , and the approximate operator , @xmath80 , for each transition .",
    "the following steps describe the implementation details :    1 .   _",
    "incoming part_. we start the integration of the rt equation from the outer boundary surface along rays with constant impact parameter @xmath47 using the appropriate boundary condition .",
    "if the outer boundary condition has a dependence on the angle @xmath45 , then each characteristics will have a different boundary condition @xmath81 .",
    "the intensity is then propagated inwards along each ray applying the formal solution as established by the parabolic short - characteristics method .",
    "this process is carried out for each ray until the inner boundary surface is reached ( for the rays that intersect the core ) or until tangentially reaching the shell with @xmath82 ( for the rays that do not intersect the core ) .",
    "such calculations give us the information required to obtain the angular dependence of the incoming radiation field and its contribution to the mean intensity : @xmath83 where we have explicitly indicated that it is the contribution of the incoming radiation .",
    "the contribution of the incoming radiation to the approximate @xmath84 operator is also calculated . since for this operator",
    "we have chosen the diagonal of the full operator , it represents the response of the mean intensity to a unit pulse perturbation in the source function at the point o under consideration . for the case of a bound - bound transition with a fixed background continuum",
    ", it can be calculated as : @xmath85   r_{lu}^\\mathrm{old } , \\ ] ] where @xmath57 is one of the coefficients of the short - characteristics formula ( [ eq_short_characteristics ] ) .",
    "although @xmath49 is usually taken equal to zero , in reality it is a small negative contribution which can be easily calculated ( see the shaded area of fig . [ fig_source_im ] ) .",
    "the reason is that the unit pulse perturbation at point o produces a residual intensity at point m coming from the application of the parabolic sc formula to the points l , m and o , as indicated in fig .",
    "[ fig_source_im ] .",
    "+   operator produces a residual intensity at point m. this contribution comes from the application of the parabolic sc formula at points l , m and o , where point l precedes point m along the ray.,width=302 ] 2 .",
    "_ outgoing part_. we apply the inner boundary condition for the rays that intersect the core and continue integrating the rt equation along the outgoing rays until reaching the external boundary surface .",
    "the contribution of the outgoing radiation field to the mean intensity can be obtained as : @xmath86 and similarly for the approximate operator .",
    "when this process is carried out for all the spectral lines of the atomic / molecular model , the mean intensity @xmath29 and the @xmath80 operator are available at each spatial point .",
    "we can then build the system matrix @xmath73 for each point and obtain the approximate corrections to the populations .",
    "this method was developed by trujillo bueno & fabiani bendicho ( 1995 ) .",
    "the paper by fabiani bendicho , trujillo bueno & auer ( 1997 ) gives a suitable summary of its application to the multilevel problem in cartesian coordinates , including a detailed analysis of its convergence rate and performance .",
    "although the computational time per iteration is similar to that of mali , muga has a much better convergence behavior .",
    "the key point of the gauss ",
    "seidel method for rt applications is that one obtains the convergence rate of an upper or lower triangular approximate @xmath0-operator without having to build and/or invert this triangular operator . to this end ,",
    "once the radiation field is known at the atmospheric point being considered , the population correction can be made directly using eqs .",
    "( [ eq_mali_scheme ] ) . then",
    ", if these new populations are taken into account when calculating the radiation field at the next spatial grid point , the resulting scheme turns out to be equivalent to that of the gauss - seidel method , which has a higher convergence rate than jacobi s method ( trujillo bueno & fabiani bendicho 1995 ; trujillo bueno 2003 ) .",
    "it is important to clarify that muga , contrary to what happens with mali , requires an specific order of the loops over transitions , angles ( equivalently , rays with constant impact parameter in the spherically symmetric case ) and spatial points when propagating the radiation . _",
    "the most external loop is the one over directions , first going inwards and then ouwards .",
    "the next one is the loop over spatial points , followed by the loop over transitions .",
    "the most internal ones are the loops over angles and frequencies . _",
    "the reason is that we need to evaluate the mean intensity for _ all _ the radiative transitions in order to be able to perform the population correction before advancing to the following point of the spatial grid .",
    "this ordering is shown in a pseudo - code manner in the following algorithm :    propagate radiation using parabolic sc calculate mean intensity of the given transition carry out population correction    , while the external boundary is the shell @xmath87 .",
    ", title=\"fig:\",width=188 ] , while the external boundary is the shell @xmath87 . , title=\"fig:\",width=188 ] , while the external boundary is the shell @xmath87 . ,",
    "title=\"fig:\",width=188 ] , while the external boundary is the shell @xmath87 .",
    ", title=\"fig:\",width=188 ]    muga can be extended to spherical geometry as follows :    1 .",
    "_ incoming part_. the formal integration of the rt equation along each ray of constant impact parameter @xmath47 is started at the outer boundary .",
    "this process is schematized in the upper left panel of fig .",
    "[ fig_gs_spherical_scheme ] .",
    "note that the intensity can be propagated simultaneously along all the rays .",
    "the integration along each ray is done using short - characteristics , calculating the intensity at each shell until the ray intersects the central core or arrives tangent to the shell @xmath88 .",
    "once the incoming intensity at every intersection point between the shells and the whole set of rays is known , the contribution to the mean intensity of the incoming rays ( @xmath89 ) can be calculated .",
    "_ outgoing part_. when the contribution to the mean intensity from the incoming radiation is known , the boundary condition at the inner core can be applied to get the contribution of the outgoing radiation to the mean intensity in all the radiative transitions , thus allowing us to solve the linear system of eqs .",
    "( [ eq_mali_scheme ] ) to get the population correction at the inner core .",
    "the schematic representation of this step is shown in the upper right panel of fig .",
    "[ fig_gs_spherical_scheme ] . with these improved level populations",
    ", one can propagate the intensity outwards until the next shell and get the mean intensity there for each of the transitions [ what trujillo bueno & fabiani bendicho ( 1995 ) call @xmath90 , which then allows us to solve the linear system of eqs .",
    "( [ eq_mali_scheme ] ) to obtain the new populations corresponding to this shell .",
    "the procedure is repeated until arriving to the outer boundary .",
    "this process is schematized in the lower left and right panels of fig .",
    "[ fig_gs_spherical_scheme ] . the `` old&new '' label of the mean intensity is used to indicate clearly that the value of the mean intensity @xmath29 at shell @xmath91 is obtained by using the new population at the shells with @xmath92 , contrarily to what happens with the mali method , where the mean intensity is calculated always by using the `` old '' population estimation . consequently , the final system to be solved at each shell is : @xmath93 where the coefficients of @xmath94 are similar to those of @xmath95 but calculated one spatial point after the other as summarized above .    as explained in detail by trujillo bueno & fabiani bendicho ( 1995 ) for the plane ",
    "parallel case , two corrections have to be performed in order to obtain a true gs iteration .",
    "let us assume that we have already obtained the new populations at point @xmath3 and that we want to calculate the new populations at point @xmath96 .",
    "the corrections , graphically schematized in figure [ fig_gs_corrections ] , are the following :    1 .",
    "the first one , represented in the left panel of fig .",
    "[ fig_gs_corrections ] , affects the incoming radiation field at point @xmath96 after the population correction is performed at point @xmath3 during the outgoing pass .",
    "since the parabolic sc formal solver is being used , the radiation field at point @xmath96 depends on the absorption and emission properties at points @xmath3 , @xmath96 and @xmath97 .",
    "the incoming radiation field at @xmath96 had been calculated using the `` old '' populations at point @xmath3 .",
    "since we have already a new estimation of the populations at point @xmath3 , we have to correct the incoming radiation field as illustrated in fig [ fig_gs_corrections ] .",
    "we indicate in grey those points for which we have a `` new '' estimation of the populations , while those points with the `` old '' populations are marked in black .",
    "the intensity at point @xmath96 for the incoming ray with impact parameter @xmath47 was calculated according to the formula : @xmath98 which has to be replaced with : @xmath99 since the populations at point @xmath3 have just been corrected .",
    "this correction in the specific intensity is performed for each ray and is then taken into account when calculating the mean intensity at point i+1 .",
    "+   due to the population correction obtained previously at point @xmath3 .",
    "the right panel shows the corrections to the outgoing radiation field at point @xmath96 after performing the population correction at this point @xmath96 .",
    "note that the inner boundary is at point @xmath100 and the outer boundary is at point @xmath87.,width=188 ] 2 .",
    "the second correction , represented in the right panel of fig . [ fig_gs_corrections ] , is necessary once a new estimation of the populations is available for point @xmath96 . since the outgoing radiation field at point",
    "@xmath96 has been obtained with the `` old '' populations at this point , it has to be corrected in order to obtain the true value of the outgoing radiation field at point @xmath96 before moving to the next point @xmath97 .",
    "therefore , the outgoing intensity at point @xmath96 , which had been obtained using : @xmath101 has to be replaced by : @xmath102 since now the populations at point @xmath96 have just been corrected .",
    "these corrections are applied consecutively while computing the outgoing radiation field until reaching the outer boundary surface .",
    "summarizing , when such two corrections are applied to the iterative scheme , a true gauss - seidel iteration is obtained once the specific intensity of the radiation field is propagated from the outer to the inner boundary , and again to the outer one .",
    "this muga scheme leads to a convergence rate a factor 2 higher than that corresponding to the mali method . _",
    "the main advantage of this gs - based iterative scheme is that it has the convergence properties of a triangular @xmath84-operator , but neither the construction nor the inversion of this approximate operator has to be performed_. therefore , it is also suitable for 2d and 3d multilevel radiative transfer ( see fabiani bendicho & trujillo bueno 1999 ) .",
    "as pointed out by trujillo bueno & fabiani bendicho ( 1995 ) and by trujillo bueno ( 2003 ) , the increase in the convergence rate can be enhanced to a factor of 4 if the previous corrections are applied , not only when the radiation field is being propagated outwards , but also when it is being propagated inwards . in this way , each incoming+outgoing pass produces two gs iterations .",
    "some examples of the application of this `` up+down '' strategy to polarized radiative transfer can be found in trujillo bueno & manso sainz ( 1999 ) .",
    "the successive overrelaxation method ( sor ) has been also proposed by trujillo bueno & fabiani bendicho ( 1995 ) for the solution of non - lte rt problems .",
    "the solution process is exactly the same as in muga , since the only difference lies on the level population correction . in the sor method ,",
    "a parameter @xmath103 is introduced to overcorrect the population , thus allowing for some kind of anticipation of the future corrections .",
    "this scheme can be written as @xmath104 where the @xmath103 parameter has a value between 1 and 2 in order to produce the overcorrection .",
    "the muga method is therefore a particular case of the musor scheme ( see trujillo bueno & fabiani bendicho 1995 for understanding how to calculate the optimum value of the parameter @xmath103 ) .",
    "a fundamental consideration of any iterative method is to know how the total computational time scales with the number of spatial grid points , rays , frequencies and radiative transitions in the chosen atomic or molecular model .",
    "let @xmath105 be the number of points in the atmosphere , @xmath106 the number of points of the angular quadrature for computing the mean intensity , @xmath107 the number of frequencies at which the rt equation has to be solved and @xmath108 the number of iterations needed for reaching the convergence in the chosen spatial grid . with the short - characteristics method , the computational time @xmath109 scales linearly with the number of spatial grid points in the atmosphere , the number of frequency points and the number of angles , so that : @xmath110 the dependence of the total computational time on the number of points in the atmosphere scales as @xmath111 for mali , as @xmath112 for muga and as @xmath113 for musor ( trujillo bueno & fabiani bendicho 1995 ) .",
    "this is a direct consequence of the different number of iterations required for obtaining convergence with each of the methods in the chosen spatial grid : it is of the order of @xmath105 for mali , @xmath114 for muga and @xmath115 for musor . as pointed out by trujillo bueno ( 2003 ) the computational time of muga and musor can be reduced further via the application of the above mentioned `` up+down '' strategy .",
    "some interesting examples of the application of the muga method to three - dimensional ( 3d ) multilevel radiative transfer can be seen in fabiani bendicho & trujillo bueno ( 1999 ) .",
    "model calculations of scattering polarization signals in spectral lines can be found in trujillo bueno & landi deglinnocenti ( 1997 ) , trujillo bueno & manso sainz ( 1999 ) , manso sainz & trujillo bueno ( 2003 ) and trujillo bueno ( 2003 ) .",
    "detailed information on the convergence properties of the muga method in one - dimensional plane - parallel atmospheres can be found in fabiani bendicho , trujillo bueno & auer ( 1997 ) .",
    "here we show some illustrative examples of our generalization of the muga and musor methods to multilevel rt in spherical geometry .      in order to show the convergence properties of these methods in spherical symmetry ,",
    "we have selected the multilevel problem treated by avrett & loeser ( 1987 ) , which concerns a simplified three - level hydrogen atomic model without continuum in an isothermal semi - infinite atmosphere with t=5000  k. the atmosphere is @xmath1161500  km thick and the radius of the internal core is 6.95@xmath1610@xmath117 cm .",
    "this may be considered as an isothermal representation of the solar atmosphere in spherical geometry .",
    "the collisional rates among the three levels of the model atom are assumed to be constant .",
    "we define the curvature @xmath118 of a given stellar atmosphere as the ratio between its extension ( @xmath119 ) and the radius of the star ( @xmath120 ) : @xmath121 so that the rt problem should be solved using spherically symmetric geometry when @xmath122 , while using plane  parallel geometry",
    "when @xmath123 .",
    "the case under study has @xmath124 and may be safely solved using the plane ",
    "parallel approximation .    ) using our spherical geometry muga code while the right panel shows the same result but using the plane  parallel version.,title=\"fig:\",scaledwidth=45.0% ] ) using our spherical geometry muga code while the right panel shows the same result but using the plane  parallel version.,title=\"fig:\",scaledwidth=45.0% ]    we have solved this non - lte problem with the following iterative methods : @xmath0-iteration , mali , muga and musor . both the spherical and plane - parallel muga / musor radiative transfer codes have been used . in the left panel of fig .",
    "[ fig_hydrogen_true_error ] we show the convergence behavior for the spherical case . in order to calculate the true error we have obtained first the converged solution in a grid of 150 radial shells with a grid step of @xmath12510 km , sampling the @xmath1161500 km thick atmosphere .",
    "the problem was then solved using a coarser grid with 80 radial shells ( @xmath125 19 km ) .",
    "note that the true error corresponding to this grid is approximately 1  % .",
    "the @xmath0-iteration method , although converging , is not capable of finding the solution in a suitable number of iterations due to the large optical depth of the transitions in the model atmosphere .    concerning the results obtained with our muga codes",
    ", the convergence is reached with half the number of iterations required by the mali method , which leads to approximately half of the total computational time , since the computational time per iteration is approximately the same in both methods . finally , as shown in fig .",
    "[ fig_hydrogen_true_error ] the number of iterations required by the musor method is a factor 10 smaller .",
    "the convergence behavior when the same problem is solved using the plane - parallel approximation is shown in the right panel of fig .",
    "[ fig_hydrogen_true_error ] .",
    "it is interesting to note that , due to the low curvature radius of the atmosphere , both results are very similar .",
    "however , the total computational time is larger when the problem is solved with our spherically symmetric code due to the large number of formal solutions that have to be performed along rays of constant impact parameter .",
    "let us consider now a problem which is very similar to the previous one , but with a more extended atmosphere .",
    "the core radius is still 6.95@xmath1610@xmath117  cm , but the total thickness of the atmosphere is now increased to 6.3@xmath1610@xmath126  km , which implies a curvature of @xmath127 . with this @xmath118value ,",
    "sphericity effects have a great influence on the final result because there are now directions in the atmosphere along which the photons can escape more easily . the temperature of the atmosphere is still t=5000  k. we have chosen a different non - ltemultilevel problem characterized by a simplified 5level ca ii model atom with constant collisional rates ( avrett & loeser 1987 ) .        in order to be able to compute the true error at each iterative step as indicative of the convergence properties , the fully converged solution has been obtained first in an atmosphere sampled at 300 radial shells .",
    "the atmosphere is now @xmath128 times more extended .",
    "therefore , in order to obtain a reasonable precision , the number of radial shells have to be greater than in the quasi plane  parallel case of the previous section .",
    "figure [ fig_calcium_true_error ] shows the true error for the four iterative schemes .",
    "the calculations have been performed using a grid of 150 radial shells .",
    "the convergence behavior is very similar to the previous case , but the true error of the final converged solution is 3  % due to the larger distance between grid points . as expected , the @xmath0-iteration method does not reach convergence in a suitable number of iterations ( the optical depths are well above 10@xmath126 ) .",
    "the convergence properties of the rest of the methods is similar to that of the previous quasi plane  parallel calculation .",
    "if @xmath129 is the number of iterations that mali needs to reach convergence , muga reaches convergence in roughly @xmath130 iterations while with our musor code convergence is reached after only @xmath131 iterations .",
    "finally , we investigate the convergence properties of the mali and muga methods for the solution of a complicated multilevel radiative transfer problem in spherical geometry .",
    "this problem consists in the calculation of the self - consistent populations of the first 14 rotational levels of ortho - water in a warm ( @xmath132 k ) shell .",
    "this scenario tries to model the physical conditions under which many h@xmath133o lines observed with iso are formed ( cernicharo et al .",
    "water introduces some difficulties in the convergence process because of the appearance of maser transitions ( specially the line at 183 ghz ) .",
    "the convergence properties are shown in fig . [ fig_sgrb2 ] when the model atmosphere is discretized with 150 shells . convergence with the muga method is reached with half the number of iterations required by the mali code , similar to the previous illustrative examples .",
    "the efficiency can be improved further via the `` up+down '' strategy proposed by trujillo bueno & fabiani bendicho ( 1995 ) and/or via musor and/or via the application of acceleration techniques .",
    "molecules are usually found in highly dynamic systems ( e.g. , the solar atmosphere , winds of agb stars , etc . ) and their formation is influenced by the time variation of the physical conditions in the medium .",
    "therefore , only when the dynamical timescales are much slower than the timescales of molecular formation , the approximation of instantaneous chemical equilibrium ( ice ) can be used safely . under the ice approximation",
    ", molecules are assumed to be formed instantaneously and their abundances depend on just the local temperature and density .",
    "another consequence of this assumption is that the specific reaction mechanisms that create and destroy a given molecule are irrelevant and only the molecule and its constituents are important .",
    "the ice approximation has been applied to many astrophysical situations ( russell 1934 ; tsuji 1964 ; tsuji 1973 ; mccabe , connon smith & clegg 1979 , etc . ) .      when the dynamical timescales are smaller than the time needed to reach the molecular equilibrium number densities , it is fundamental to consider all the reactions which create and destroy a given species , which requires solving the full chemical evolution ( ce ) problem .",
    "the temporal variation of the abundance of a given species @xmath3 can be modeled with the following set of nonlinear ordinary differential equations ( see , e.g. , bennett 1988 ) : @xmath134 the set of reactions is classified according to the number of species which have to collide to let the reaction take place :    * * three - body reactions*. the reactions are of the type @xmath135 .",
    "they are included in the model by means of the first and the fourth terms of eq .",
    "( [ eq_chem_sys ] ) .",
    "they correspond to reactions which create and destroy species @xmath3 from the reaction of other three components , respectively .",
    "they are characterized by the reaction rates @xmath136 in units of cm@xmath126 s@xmath138 whose value is usually extremely small . they typically give a negligible contribution to the total rate of variation of the abundance of species @xmath3 for low density media . on the other hand , for relatively high density media like the photospheric plasma of solar - like atmospheres",
    "these reactions become extremely important . for example , the catalytic formation of hydrogen by the three body reaction h+h+h @xmath139 h@xmath133+h has a rate of @xmath11610@xmath140 cm@xmath126 s@xmath138 . then , since the typical hydrogen densities in the solar photosphere are of the order of 10@xmath141 - 10@xmath142 @xmath143 , the rate of formation of h@xmath133 turns out to be of the order of 10@xmath141 - 10@xmath144 @xmath143 s@xmath138 . * * two - body reactions*. they are of the form @xmath145 , and are included in the model by means of the second and fifth terms in eq .",
    "( [ eq_chem_sys ] ) .",
    "they correspond to reactions which create and destroy species @xmath3 from the reaction of other two components , respectively .",
    "they are characterized by the reaction rates @xmath146 in units of @xmath147 s@xmath138 and typically represent the most important reactions in almost all the astrophysical media in which chemical reactions take place . *",
    "* one - body reactions*. these reactions are of the form @xmath148 .",
    "they usually represent photodissociation or photoionization in which the species is dissociated by photons of energy greater than the dissociation potential ( this is only valid for molecular species because atomic species do not dissociate ) or ionized by photons higher than the ionization potential ( valid both for atomic or molecular species ) .",
    "therefore , these reactions are often written as @xmath149 , where we have explicitly indicated the necessity of a radiation field for the reaction to take place .",
    "this dependence on the radiation field present in the medium is implicitly taken into account in the reaction rate @xmath150 in units of s@xmath138 .",
    "the model includes such reactions by means of the third and sixth terms in eq .",
    "( [ eq_chem_sys ] ) , corresponding to those which create and destroy species @xmath3 , respectively .    once the physical conditions , the set of species included in the model , and the reaction rates of the reactions which take place among them are known , the system of equations given by eq .",
    "( [ eq_chem_sys ] ) is completely defined .",
    "this set of nonlinear differential equations represents a very _ stiff _ problem because of the different variables and rates having disparate ranges of variation . a suitable method that can cope with this stiffness",
    "has to be used .",
    "for instance , an algorithm based on the backward differentiation formula ( see , e.g. , gear 1971 ) can assure stability and allows us to use large time steps so that the solution for very long evolution times can be obtained .",
    "an interesting application which helped to solve the enigma of co `` clouds '' in the solar atmosphere can be seen in asensio ramos et al .",
    "( 2003 ) .      in a medium of given temperature @xmath151 and hydrogen number density @xmath152 ,",
    "it is of interest to ask for the formation time of a given molecule when the physical conditions are perturbed .",
    "if the temperature and density values permit fast reactions , the time for molecular formation will be short .",
    "if reactions take place very slowly , molecular number densities will adapt to the new conditions after a very long timescale .",
    "therefore , short _ relaxation times _ may be interpreted as an indication that the ice approximation will give a correct description of the molecular number densities , while large relaxation times would indicate that we better take into account the time evolution of the molecular number densities .",
    "the calculation is initialized assuming that at @xmath153 s we only have atomic species .",
    "then , the system evolves until reaching the chemical equilibrium abundances .",
    "these molecular number densities should be similar to those obtained via the ice approximation .",
    "for this to be true , the set of reactions and the chemical species included in the model have to be complete enough .",
    "once such equilibrium abundances are obtained , we introduce a perturbation in the physical conditions and we calculate the time needed to reach the new equilibrium situation compatible with the new physical conditions .",
    "this timescale is called the _",
    "relaxation time_. we assume that the perturbations are small enough to consider that we are in the linear regime ( i.e. , @xmath154 , @xmath155 ) .",
    "s , a reduction of 1% in the temperature has been performed and the evolution until reaching the new equilibrium abundance has been obtained . note the simple behavior of the co abundance , while the rest of molecules have a complicated evolution showing the extremely non - linear character of the chemical evolution problem .",
    "all the molecules reach their new equilibrium concentrations in less than 10 s , except for the points at @xmath116700 km in both semi - empirical models .",
    "since the granular and intergranular models represent only the photospheric conditions of the solar atmosphere , no high relaxation times are found.,title=\"fig:\",scaledwidth=45.0% ] s , a reduction of 1% in the temperature has been performed and the evolution until reaching the new equilibrium abundance has been obtained . note the simple behavior of the co abundance , while the rest of molecules have a complicated evolution showing the extremely non - linear character of the chemical evolution problem .",
    "all the molecules reach their new equilibrium concentrations in less than 10 s , except for the points at @xmath116700 km in both semi - empirical models .",
    "since the granular and intergranular models represent only the photospheric conditions of the solar atmosphere , no high relaxation times are found.,title=\"fig:\",scaledwidth=45.0% ]    we have selected a granular and an intergranular model from the 3d hydrodynamical simulations of solar surface convection carried out by asplund et al .",
    "while the granular model is hotter in the deep regions of the photosphere , it turns out to be cooler above @xmath116200 km .",
    "figure [ fig_evolution_after_perturbation ] shows the molecular number density relative to that at @xmath153 s for some selected species at a height of 453 km . in this calculation , the temperature has been reduced by 1% .",
    "it is clearly seen that almost all the chemical species increase their abundance after the perturbation , once the new equilibrium situation is reached .",
    "the relaxation times in the granular plasma are larger than in the intergranular gas because the temperature and hydrogen number density is smaller at such heights .",
    "both the lower temperature and hydrogen number density produce a lower rate of collisions which results in slower reactions    as seen in fig .",
    "[ fig_evolution_after_perturbation ] , the time evolution of the molecular number densities seems to be quite simple for the co molecule , which follows a smoothed step function . on the other hand , it is more complicated for the majority of the molecules , with episodes in which the abundance is increasing and others in which it is decreasing .",
    "the quite simple time variation of the co abundance can be explained with a very simplified model similar to that used by ayres & rabin ( 1996 ) .",
    "since co is one of the most abundant molecules in the solar atmospheric environment , we can assume that its formation and destruction depends on two processes .",
    "on the one hand , direct association of c and o to form co : @xmath156 where @xmath157 and @xmath158 are the reaction rate for the formation of co by neutral association of its constituents and the reaction rate for the dissociation of co , respectively",
    ". another reaction path which efficiently forms co is : @xmath159 it can be verified that the last pair of chemical reactions are much more efficient in setting the co number density than those given by eqs .",
    "( [ reac_co ] ) . as a first approximation",
    ", we can assume that oh is formed much faster than co and so its abundance can be considered constant during the time interval in which the number density of co molecules is changing .",
    "this fact is reinforced by our chemical evolution calculations , as seen in fig .",
    "[ fig_evolution_after_perturbation ] .",
    "note that oh has almost reached its equilibrium abundance when co starts to change from its value at @xmath153 s. consider now the simplifying condition that the hydrogen number density is constant .",
    "the oh number density can be written in terms of that of hydrogen as @xmath160 ( where @xmath161 is the oh abundance relative to hydrogen ) , while the carbon abundance is given by @xmath162 ( where @xmath163 is the carbon abundance relative to hydrogen ) .",
    "the first assumption introduces a very small error since the hydrogen number density is barely affected by the presence of molecular species unless the temperature is extremely small .",
    "the second assumption can be considered suitable since @xmath164 reaches its equilibrium value much faster than @xmath165 .",
    "the third assumption is applicable because almost all the carbon not in atomic form is indeed in the form of co. therefore , the differential equation that describes the time evolution of the co number density can be rewritten as : @xmath166 the solution to this simple equation is @xmath167 e^{-t/\\tau_\\mathrm{relax}},\\ ] ] where @xmath168 and @xmath169    our calculations show that , if the behavior of the molecular number density can be written in a simple way like for that of the co case , its evolution can be characterized by a timescale which depends on the main reactions which create and destroy the molecule and by its equilibrium abundance ( which also depend on the main reactions ) . note that it is not correct to define timescales for the formation and destruction processes separately , since there is only one global timescale which involves both processes .",
    "this is the reason that explains why one can not know how fast a chemical reaction is going to take place by only taking into account the rate of the individual reaction .",
    "when the whole system of differential equations is solved , many non - linearities arise , making it very difficult to make a simple relaxation time estimation .",
    "the linear analysis of the time evolution of the co number density shows that co is mainly driven by itself as dictated by eq .",
    "( [ eq_soluc_co1 ] ) .",
    "therefore , it is possible to carry out a fit of this temporal evolution behavior and obtain a relaxation time @xmath170 . since a linear analysis is suitable for co , the relaxation time can be calculated for a range of perturbations in the temperature and hydrogen number density .",
    "the results are shown in fig .",
    "[ fig_co_relaxation_time ] .",
    "the general trend is that , _ for a given density , the relaxation time is the larger the cooler the medium where the temperature perturbation is introduced_. similarly , _ for a given temperature of the unperturbed medium , the relaxation time increases rapidly with decreasing density_. short relaxation times are typical of high - temperature and high - density media ( e.g. @xmath171 s for @xmath172 and @xmath173 k ) , while long relaxation times are characteristic of low - temperature and low - density situations ( e.g. @xmath174 s for @xmath175 and @xmath176 k ) .",
    "this behavior can be easily understood in terms of the number of collisions per unit time , which decreases both when the temperature and/or the density decreases . in a realistic situation like in the solar atmosphere , one would find a broad range of relaxation times at a fixed atmospheric height because the existing rarefactions , compressions and temperature fluctuations are continually changing the physical conditions .",
    "obviously , the situation is highly non - linear and the relaxation time concept , although useful , loses its meaning in the real sun .",
    "therefore , any firm conclusion needs to be achieved via detailed numerical simulations ( see asensio ramos et al .",
    "thirty years ago , the total computational work ( @xmath177 ) of the best available multilevel transfer codes scaled approximately as np@xmath178 , with np the number of spatial grid points in a computational domain of fixed dimensions ( e.g. , mihalas 1978 ) .",
    "twenty years ago , operator splitting methods based on jacobi iteration were developed that yielded @xmath179 ( e.g. , olson , auer & buchler 1986 ; rybicki & hummer 1991 , 1992 ; auer , fabiani bendicho & trujillo bueno 1994 ) .",
    "ten years ago , radiative transfer methods based on gauss - seidel and sor iteration were developed for which @xmath180 , which imply an - order - of - magnitude of improvement with respect to the mali method ( trujillo bueno & fabiani bendicho 1995 ; trujillo bueno & manso sainz 1999 ; trujillo bueno 2003 ) .",
    "such methods are also suitable for 2d and 3d radiative transfer applications because they do not require neither the construction nor the inversion of any non - local approximate @xmath0-operator ( see the muga-3d code of fabiani bendicho & trujillo bueno 1999 ) . moreover , muga is the iterative method of choice for the development of the only multilevel rt method for which @xmath181 -that is , the non - linear multigrid method described by fabiani bendicho , trujillo bueno & auer ( 1997 ) .    in this article",
    "we have shown how the multilevel gauss - seidel ( muga ) and multilevel successive overrelaxation ( musor ) methods can be applied for solving multilevel radiative transfer problems in spherical geometry , for both atomic and molecular lines .",
    "our multilevel codes based on the muga and musor methods offer a very powerful tool for the fast solution of realistic rt problems .",
    "we thank philippe stee for his kind invitation to present this keynote paper in a highly interesting workshop .",
    "this research has been funded by the european commission through the solar magnetism network ( contract hprn - ct-2002 - 00313 ) and by the spanish ministerio de educacin y ciencia through project aya2004 - 05792 ."
  ],
  "abstract_text": [
    "<S> the development of fast numerical methods for multilevel radiative transfer ( rt ) applications often leads to important breakthroughs in astrophysics , because they allow the investigation of problems that could not be properly tackled using the methods previously available . </S>",
    "<S> probably , the most familiar example is the so - called multilevel accelerated @xmath0-iteration ( mali ) technique of rybicki & hummer for the case of a local approximate operator , which is based on jacobi iteration . </S>",
    "<S> however , there are superior operator - splitting methods , based on gauss - seidel ( gs ) and successive overrelaxation ( sor ) iteration , which provide a dramatic increase in the speed with which non - lte multilevel transfer problems can be solved in one , two and three - dimensional geometries . </S>",
    "<S> such rt methods , which were introduced by trujillo bueno & fabiani bendicho ten years ago , are the main subject of the first part of this paper . </S>",
    "<S> we show in some detail how they can be applied for solving multilevel rt problems in spherical geometry , for both atomic and molecular line transitions . the second part of the article addresses the issue of the calculation of the molecular number densities when the approximation of instantaneous chemical equilibrium turns out to be inadequate , which happens to be the case whenever the dynamical time scales of the astrophysical plasma under consideration are much shorter than the time needed by the molecules to form . </S>"
  ]
}