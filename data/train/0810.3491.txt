{
  "article_text": [
    "dynamical timescales in the solar system vary widely . for example , mercury s orbital period is 0.24 yr , pluto s is 250 yr , and comets in the oort cloud can have periods of @xmath0 myr , for a difference of over seven orders of magnitude . the disparity in timescale increases if we also consider not merely orbital period but period at periapse , such as in sun - grazing comets which can come within a few solar radii , or the orbits of moons and satellites .",
    "the age of our solar system is @xmath1 gyr , and relevant formation timescales are believed to be on the order of a few million years ( for the accretion of giant planet cores ) to tens of millions of years ( for the formation of the earth ) to hundreds of millions of years ( for possible late - stage rearrangement of the outer solar system , e.g.  @xcite ) .",
    "the enormous number of orbits required presents a considerable challenge for numerical studies of planet formation . in n - body studies of galaxy formation , by contrast , the number of dynamical times is low , and therefore the emphasis has been on increasingly complex modelling of the physics and ever - larger numbers of particles , both of which are amenable to parallelization .",
    "although multiprocessor codes can offer major benefits even for planetary simulations , the large number of timesteps limits the particle number to a regime where latency issues loom large .",
    "the planetary problem is simply , and inescapably , hard .",
    "the difficulties are yet greater for studies of the formation of hot neptunes , giant planets orbiting very close to the parent stars .",
    "these planets are unlikely to have formed in situ , suggesting that gas disc induced migration will play an important role .",
    "for example , gj436b is a hot transiting neptune @xcite whose density is @xmath2 @xcite .",
    "this suggests it is a true neptune analogue ( i.e.  an ice giant , not a small gas giant or a large , rocky super - earth ) , which raises the question of where its ice originated . in the standard models of the minimum - mass solar nebula , the snow line beyond which ices can condense is @xmath3 au . therefore one obvious toy scenario for the history of gj436b",
    "is that the planet started its life in the outer regions of the disc , and then migrated in due to interactions with the gas , possibly growing en route .    at present ,",
    "the most elegantly constructed general integrator for doing late - stage n - body studies of planet formation is symba @xcite , a kepler - adapted symplectic integrator capable of resolving close encounters , which is descended from the original methods of @xcite and @xcite .",
    "there are several implementations of the algorithm and its variants available , including a parallel version which has been useful in studying terrestrial accretion @xcite , and so it would be natural to apply these codes immediately .",
    "unfortunately , a direct treatment of the hot neptune problem is completely beyond the reach of standard methods , at least at the usual resolution . the orbital period at 0.05 au is @xmath4 yr , 30 times smaller than at 0.5 au ( a respectable inner boundary for studies of the formation of the earth ) .",
    "since migration over several au plays a role , we can not concentrate on a narrow region ( e.g.  @xcite ) but must build a more global model , requiring large numbers of particles . furthermore , since the formation and migration timescales will be important and often comparable , some common tricks for speeding up simulations ( such as increasing the collisional radius ) may be dangerous .",
    "these formation scenarios are of considerable interest , and are not easily studied using current numerical and computational technology ; they are messy systems , with many non - hamiltonian forces and events , and not clean celestial mechanics problems ; and there seems to be a promising direction for improvement .",
    "we therefore seek to develop new integrators which will allow us to address these problems . given the difficulties , we are willing to consider approximations which we would hesitate to use in other situations , such as a detailed study of long - term chaos in the outer solar system .",
    "we will instead sacrifice some precision while preserving reliability in the hopes of exploring otherwise inaccessible science : in this situation practicality beats purity .",
    "fortunately , the very feature which makes the problem so challenging  the wide dynamical range  opens up possibilities for new methods .",
    "symba and its cousins use a common timestep for all ( non - encountering ) objects which is set by the minimum pericentric distance .",
    "this limitation can be worked around when objects only occasionally enter the innermost regions @xcite but it reduces to using unacceptably slow bulirsch - stoer integration when there is always an object in the innermost regions , as we expect in our models .",
    "however , we note that for an inner edge of 0.05 au , a timestep of @xmath5 yr would be necessary , but if the inner edge of the problem were 1 au , a timestep of 0.05 yr would suffice .",
    "this suggests that using the common small timestep results in objects beyond 1 au being ` over - integrated ' by roughly a factor of 100 .",
    "if we could somehow use the larger timestep for the outer objects , then since most particles in simulations of oligarchy tend to be in the outer regions ( where formation times are longer ) , we might be able to recover something like the standard run times .",
    "indeed , a decade and a half ago , @xcite were already building mixed - variable integrators with different timesteps associated with each planet , so there is precedent .",
    "therefore we set out to construct a new multizone method using recent numerical technology which allowed for small timesteps in the inner regions and large timesteps in the outer regions .",
    "we had several desired properties :    \\(1 ) symplecticity , or at least near - symplecticity , is highly desirable .",
    "by contrast , time - reversibility ( in the absence of mergers and dissipational forces ) is necessary , as many of the good conservation properties of symplectic integrators are inherited from their reversibility .",
    "\\(2 ) symba s underlying integrator step is very robust , especially at low eccentricities , and has extensive field - testing ( both in duncan and levison s swift and in john chambers s mercury ) . an integrator which reduces to this proven approach for objects which are in the same zone is preferable .",
    "\\(3 ) correct close encounter handling is vital .",
    "although we may be willing to accept a decrease in encounter accuracy in a few locations ( such as at the zone boundaries ) , the vast majority of encounters must be treated using a method known to be reliable .",
    "more generally , force inaccuracies should be limited to distant interactions , as in fast force techniques such as treecodes .",
    "\\(4 ) any discontinuities caused by the existence of distinct timestep zones should be kept to a minimum , and at or below second order if possible .    by using existing techniques in the literature",
    ", we develop integrators which meet the above criteria , choosing at every branch point the simplest scheme which seems likely to work .",
    "we combine the hamiltonian splitting of @xcite with a multistep approach inspired by @xcite , use the transitioning approach of @xcite to preserve symplectic behaviour , and derive new transition functions to make the scheme sufficiently smooth .",
    "in  [ section : sym ] we briefly review the use of symplectic methods in planetary dynamics . in  [ section : mvs ] we introduce the kepler - adapted mixed - variable symplectic integrators ; in  [ section : close_enc ] and  [ section : close_enc_with_sun ] we explain methods for treating close encounters between planets and between a planet and the sun , respectively ; and in  [ section : ind_timestep ] we discuss integrators which allow individual timesteps . in  [ section : naoko1 ] we construct the new integrators , and in  [ section : trans ] we develop appropriate transition functions .",
    "we presents tests of the method in  [ section : tests ] and a discussion in  [ section : disc ] .",
    "we conclude in  [ section : conc ] .",
    "geometric integrators are numerical integration methods which attempt to build the properties of the equations and their solutions into the integrators themselves , properties such as symmetries and their corresponding conserved quantities ( @xcite ) .",
    "this matching of geometry between the problem and the solver can lead to improvements in accuracy and robustness , as well as dramatic increases in speed .",
    "symplectic integrators are geometric integrators where the geometry of interest is hamiltonian , and the conserved quantity is the natural area element , the poincar 2-form @xmath6 , where @xmath7 and @xmath8 are the usual generalized positions and momenta , respectively , with summation over particles @xmath9 with mass @xmath10 . ) a symplectic integrator can be constructed via operator methods or frequency maps ; we restrict ourselves to operators .    for some hamiltonian @xmath11 , if we divide it ( arbitrarily but conveniently ) into a kinetic term @xmath12 and a potential term @xmath13 , @xmath14 we can approximate the evolution under @xmath11 by a second - order time - reversible drift - kick - drift ` leapfrog ' scheme @xmath15 where @xmath16 is the operator generated by the hamiltonian term @xmath17 , and @xmath18 is the timestep .",
    "this integrator solves a nearby ` surrogate ' hamiltonian @xmath19 where @xmath20 , using ` solves ' in the sense of physics and not mathematics .",
    "( @xmath21 is a purely formal series which need not converge in general , and certainly need not converge at the large timesteps used in practice , but is well - approximated by its first few terms . )",
    "the work of @xcite and @xcite sparked a dramatic revolution in planetary integrations by specializing the general techniques of symplectic integration to the unique properties of keplerian dynamics in the solar system .",
    "it is well known that the orbits of a system of small bodies around a large central mass are very nearly conic sections , and this keplerian motion can be advanced ( almost ) analytically .",
    "this suggests that instead of dividing the hamiltonian into kinetic and potential terms as in the standard leapfrog , we should divide it into a keplerian term and a term corresponding to the perturbations between the planets : @xmath22 the difficulty arises in finding a canonical set of coordinates in which the n - body hamiltonian takes this shape .",
    "@xcite discovered that using jacobi coordinates succeeds . in this coordinate system ,",
    "the position and momentum of the @xmath23th object ( of @xmath24 planets , where the masses are given by the @xmath25 , and the sun is @xmath26 ) are given relative to the centre of mass of the inner bodies , i.e.  those with index @xmath27 .",
    "they write @xmath28 and @xmath29 where the primed quantities are jacobi coordinates and @xmath30 . in the absence of close encounters , @xmath31 and the non - keplerian perturbations on the orbits due to mutual interactions are small .",
    "we can construct a second - order integrator as before , where the new @xmath32 drifts are ` rolls ' along the keplerian conic section , and the @xmath33 kicks are the cartesian perturbations between the planets ; hence the name ` mixed - variable symplectic ' ( mvs ; @xcite ) has been used for integrators of this type , as the integrations are in effect carried through in both cartesian and keplerian variables .",
    "this approximation to the orbit is vastly superior to the linear - path kinetic / potential decomposition , and the symplecticity provides robustness and stability . as a result , one can use much larger timesteps than would be otherwise permissible , making planetary simulations running for the age of the solar system feasible ( e.g.  @xcite ) .    for a brief review of the history of various mapping methods in solar system dynamics , see ch .",
    "9 of @xcite .",
    "@xcite also provides a useful review .      despite its many benefits for studies of well - separated planets for long timescales , the use of jacobi coordinates in the mvs approach limits its applicability .",
    "studies of planetesimal accretion , a highly chaotic and stochastic process , require the ability to handle radial reordering of objects and to resolve close encounters",
    ". in the wisdom - holman mapping , the coordinate frame depends upon a fixed ordering of the objects , and can not be updated as the system changes without breaking symplecticity .",
    "there is also no natural way to treat encounters : first , by varying the timestep you lose the symplecticity of the integration as the composition of two symplectic steps need not be symplectic ; and second , even if one could vary the timestep , the coupling between objects in the jacobi scheme means that all external objects are also implicitly involved , so an encounter can not be treated independently .",
    "we would prefer an integrator in which each planet was treated equivalently and which could adapt the timestep when planets strongly interact .    after some early experiments ( e.g.  @xcite ) , a superior solution to the problem was presented in @xcite ( hereafter dll98 ) which used an ingenious choice of coordinates to avoid the coupling between planets , a particular choice of hamiltonian splitting to ensure that all planets were treated equally , and a clever decomposition of the potential into shells to allow effective changes in the timestep .",
    "the authors developed a ` democratic heliocentric ' ( dh ) method , where ` democratic ' means ` symmetric with respect to the labelling of the planets ' , and which avoids the particle entanglement of jacobi coordinates . in these coordinates",
    ", one uses heliocentric positions but barycentric momenta .",
    "( note that the same system is called ` mixed - centre ' by @xcite and ` canonical heliocentric ' by @xcite . ) to be explicit , from @xmath34 and @xmath35 they compute new conjugate coordinates @xmath36 and @xmath37 , such that    @xmath38    and    @xmath39    this results in a new form for the hamiltonian , @xmath40 where @xmath41 @xmath42    @xmath43    @xmath44 generates a linear drift of particles positions ( taking its name from the fact it is determined by the barycentric momentum of the sun ) , @xmath32 corresponds to a pure kepler orbit , and @xmath33 , as before , is the term due to the interaction of the particles .",
    "note that  unlike with the wisdom - holman mapping ( eqs .",
    "[ eq : jacobi_hkep ] and [ eq : jacobi_hint ] )  an encounter between two particles is separable , in that the terms involving the positions and momenta of the two objects can be pulled out of @xmath32 and @xmath33 .",
    "( in contrast , @xmath44 is not separable in this way ; we return to this subject . )    as @xcite notes , the same canonical heliocentric coordinate system was used in previous work @xcite , with different hamiltonian splittings . for example",
    ", @xcite used the alternate splitting @xmath45 @xmath46 where @xmath47 is the reduced mass .",
    "this splitting has the advantage that it preserves kepler s semimajor axis - period relationship .",
    "however , the use of the reduced mass means that two objects with the same position and velocity but different masses will experience different kepler drifts and different linear drifts , which can present difficulties for treating close encounters ( dll98 ,  4 ) . in this sense",
    "the dll98 splitting is more ` democratic ' , at the cost of being slightly less accurate for a given orbit .",
    "accordingly , we will use ` canonical heliocentric ' for the coordinate system itself , and reserve ` democratic heliocentric ' for the specific three - term hamiltonian splitting used in dll98 and described by eq .",
    "[ dh_hamil ] .    from this dh splitting",
    ", they construct a second - order integrator which will be the basic dh step .",
    "following the conventional notation , let @xmath48 be the operator generated by @xmath44 ( l for ` linear drift ' ) , let @xmath49 correspond to @xmath33 ( k for ` kick ' ) , and let @xmath50 correspond to @xmath32 ( d for ` drift ' ) .",
    "using this form , the system is advanced one timestep @xmath18 by applying @xmath51    as naive adaptive timestepping changes the surrogate hamiltonian and thus breaks symplecticity , dll98 develop a technique involving recursive subdivision of the timesteps along with decomposing the force into a series of shells around the particles , and associating each force shell with a different timestep .",
    "similar approaches had been attempted previously in molecular dynamics @xcite with limited success , but dll98 realized that there were relevant smoothness constraints on the transition from shell to shell .",
    "starting from the basic dh step , we relabel @xmath52 as @xmath53 .",
    "we replace the @xmath54 by a sequence of @xmath55 smaller substeps , @xmath56^{m_i}$ ] where @xmath57 is an interaction term to be defined , and then repeat the process indefinitely at higher index : @xmath58^{m_1 } \\ , k_0^{\\tau/2 } \\ , l^{\\tau/2 } \\\\    & \\approx l^{\\tau/2 } \\ , k_0^{\\tau/2 } [ k_1^{\\tau/2m_1 } \\\\ & \\hspace{2.2 cm } [ k_2^{\\tau/2 m_1 m_2 } \\ , d_2^{\\tau / m_1 m_2 } \\ , k_2^{\\tau/2 m_1 m_2 } ] ^{m_2 } \\\\ & \\hspace{1.9 cm } k_1^{\\tau/2m_1 } ] ^{m_1 } \\ , k_0^{\\tau/2 } \\ , l^{\\tau/2 } \\\\ & \\approx \\dots \\end{array}\\end{aligned}\\ ] ] each of the above integrators , as well as the @xmath59 limit , has a fixed surrogate hamiltonian ; the timestep @xmath18 never changes .",
    "since the @xmath60 terms commute with themselves , then if succeeding @xmath57 terms are merely the identity operators the neighbouring @xmath60 terms reduce to one large drift . for example , if @xmath61 for all @xmath62 , then the integrator reduces to the basic dh step with timestep @xmath18 .",
    "however , if @xmath63 were nonzero , then since @xmath60 and @xmath57 do not commute , the reduction would not occur and the integrator would act on the smaller timestep . in this scheme , an infinite number of terms are always active , but need not actually be considered unless the intervening @xmath57 terms are nonzero . the problem becomes finding a decomposition of the potential @xmath33 generating the @xmath49 terms @xmath64 which will ( 1 ) recover the standard dh step when no close encounters are occurring and the larger timestep @xmath18 suffices , i.e. @xmath65 , and @xmath66 for @xmath67 ; ( 2 ) always sum to the correct amount of force , i.e. @xmath68 ; and ( 3 ) do so in a sufficiently smooth fashion . to construct such a decomposition ,",
    "dll98 imagine a decreasing sequence of shell radii @xmath69 with a corresponding decomposition of the potential into @xmath70 where the magnitude of the potential terms @xmath71 smoothly decreases to zero outside the shell range . by studying the error hamiltonian",
    "they find several necessary conditions on the decomposition relating to the smoothness of the transition of the potential from term to term .",
    "the resulting algorithm symba , combining the dh coordinate system with the recursively subdivided smoothly - transitioning zone operators , works remarkably well .",
    "nevertheless , it is challenging to implement and difficult to test .",
    "for example , a correct version of the algorithm will often show worse energy and angular momentum conservation on a given encounter than a subtly incorrect one , requiring large test suites ; and since the solution is very finely tuned to the planetary problem , off - the - shelf routines are of little use .",
    "@xcite developed a much simpler though more expensive approach .",
    "of the three major advances in symba ",
    "dh coordinates , the smoothness conditions on motion between operators , and the recursive subdivision of the hamiltonian  only the first two are strictly necessary to the resulting algorithm .",
    "the major benefit of the recursion is that it pushes the transitions entirely into the kick operators and preserves the ability to apply the drift operator merely by solving kepler s equation , albeit at the cost of considerable complexity .",
    "if we surrender this requirement , however , then we can decompose the hamiltonian into three terms @xmath72 + \\left [ ( 1-f(i , j ) ) \\ , \\hij + \\hkep \\right ] \\end{array}\\ ] ] where @xmath73 is the component of @xmath33 involving objects @xmath9 and @xmath23 , with implied summation over all @xmath74 with @xmath75 .",
    "@xmath76 is a transition function which is 1 when the objects are distant and approaches 0 when they are undergoing an encounter . as in the basic dh step ( eq .",
    "[ eq : dh_basic_5_op ] ) , this decomposition gives rise to a five - operator step , but these are the only five terms to consider , unlike the much larger number of potentially active terms in eq .",
    "[ symba ] .",
    "it is true that whenever an encounter is occurring and @xmath76 could be nonzero then the interaction terms can no longer be advanced analytically , but they can still be numerically integrated to high precision using standard techniques such as bulirsch - stoer .",
    "moreover , and this advantage should not be underestimated , testing that the above algorithm is implemented correctly is far more straightforward than testing symba .",
    "whenever the cost of the numerical integration due to encounters is a small fraction of the computation , the chambers - style approach ( although perhaps not as elegant as symba itself ) is likely preferable on pragmatic grounds .",
    "it should also be noted that despite the use of numerical integration to handle the transition - weighted terms in the hamiltonian , the mapping itself remains symplectic ; or as symplectic as any floating - point implementation of sufficient precision can be .",
    "( see @xcite for a general technique to recover symplecticity when using otherwise non - symplectic approximations . )      in any case , both symba and the chambers variant have been successfully applied to many studies of the later stages of planet formation .",
    "their chief weakness is that neither can easily deal with objects undergoing close encounters not with each other but with the sun , such as high - eccentricity sun - grazing comets . unlike the case of mutual encounters in which the important terms are @xmath33 and @xmath32 , during a close solar passage @xmath44",
    "must be evaluated more frequently .",
    "therefore , to resolve such orbits correctly , one must choose a timestep small enough to resolve the pericentre passage , and that timestep must be fixed for the entire integration , even if such encounters are very rare .",
    "to overcome this limitation , @xcite added a chambers - style splitting on top of symba ( here we suppress the planetary encounter terms , which are handled as described before ) and use @xmath77 @xmath78 where @xmath79 is a transition function which is 0 when no object is near the sun and @xmath80 when _ any _ object is . in this scheme ,",
    "when any object is undergoing a close solar approach , then the work of performing an integration step is pushed into the new kepler step which is must be handled numerically .",
    "the non - separability of @xmath44 ",
    "i.e.  the inability to isolate an individual object as in @xmath32  becomes a serious inconvenience here , as it requires the numerical integration of every object in the system even if only one object enters the inner zone .",
    "nevertheless , as explained by @xcite , this approach provides the speed of symba whenever the inner regions are empty and yet can successfully survive occasional interlopers ( such as objects due to be ejected during violent periods in the formation process ) .",
    "this method can not be directly applied as a solution for the numerical challenge of hot exoplanet formation .",
    "if we set the inner boundary at a typical terrestrial - formation value like 0.5 au , then there will usually be many , and almost always be some , protoplanets and planetesimals in the innermost region .",
    "this means that every particle s @xmath32 will be numerically integrated on every step , and the speed benefits are lost .",
    "moreover , if there are mutually - gravitating objects inside the inner boundary , then the situation is worse : the above integrator will evaluate the interactions between bodies not undergoing close encounters on the outer timestep @xmath18 , which may bear little relation to the dynamical times for the inner objects .",
    "this particular problem could be corrected by bringing @xmath33 under the transition function @xmath79 as well , but then we have merely recovered  in an impressively roundabout fashion  a bulirsch - stoer integrator .      recognizing that in an mvs integration of the solar system , one is taking hundreds of times more steps per pluto orbit than would be necessary if not for the presence of the interior planets , @xcite construct a leapfrog integrator with individual timesteps .",
    "they split @xmath32 and @xmath33 into n terms each , such that @xmath81 where @xmath82 is the kepler term for planet @xmath9 ( with objects labelled in increasing semimajor axis ) , and @xmath83 is the interaction term between planet @xmath9 and planets @xmath84 through @xmath24 .",
    "translating into our notation , we use @xmath60 and @xmath57 to refer to the operators as before , and assign a timestep @xmath85 to each planet , where the largest timestep @xmath86 and @xmath87 for @xmath55 an integer . starting with the hamiltonian only involving the outermost planet ( note that @xmath88 is the identity operator ) : @xmath89 and recursively applying @xmath90^{m_{i-1}}\\ ] ] for @xmath91 , one obtains an n - level integrator . more concretely ,",
    "consider a two - planet case with timestep ratios of 1:3 . the resulting integrator ( after removing the @xmath63 term which does nothing ) @xmath92^{3 }",
    "d_2^ { \\tau_2/2 } \\ ] ] has a timestep of @xmath93 for the inner planet , and @xmath94 for the outer planet , as desired .",
    "note that the integrator is time - reversible even though the objects are not synchronized with respect to @xmath50 when the interaction term @xmath95 is applied .",
    "( also note that in practice one would combine neighbouring @xmath96 terms . )",
    "it is important to recognize that the timesteps associated in this method are individual but not adaptive ; they must be set at the start of the integration , and attach not to spatial zones but directly to objects .",
    "it is therefore unable to handle migrating objects , and as an mvs method inherits the previously mentioned weaknesses of jacobi coordinates for our purposes .",
    "however , it demonstrates that asynchronous multi - stage integration in mvs - like contexts can be constructed .",
    "we now have the necessary ingredients to construct a symplectic integrator , naoko ( `` new adaptive orthochronous kepler orbiter '' ) , which is kepler - adapted , close - encountering , and yet allows for zones with different timesteps . recall the basic dh step : @xmath97    we will seek a generalization of this step for the multiple - zone case .",
    "we will define our timestep zones by dividing the system into radial shells such that an object s instantaneous heliocentric radius determines its zone assignment .",
    "( this definition is mentioned here for concreteness ; other choices are possible .",
    "we motivate this particular choice in  [ section : trans ] . )",
    "we label the zones using integer indices , starting at 0 for the innermost zone , and an integer subscript on an operator corresponds to the operator for that zone , in a sense which will be made explicit later .",
    "for example , @xmath98 advances all objects in zone 0 for a timestep @xmath18 under @xmath32 but does nothing to objects in other zones : the commutator bracket @xmath99 = 0 $ ] .",
    "note that this differs from the @xcite usage of subscripts to refer to planets .    to begin with , we defer consideration of interactions between the planets . under this simplification , and starting with zone @xmath80 , eq .  [ dh_basic ] becomes @xmath100 the @xmath48 terms can not be divided into zones as @xmath44 is not separable .",
    "nevertheless , we can incorporate more zones by applying the individual - leapfrog approach of @xcite and recursively subdividing the @xmath48 steps using this expression .",
    "that is , we can write @xmath101 resulting in @xmath102^{m_0 } \\\\   & d_1^{\\tau } \\\\",
    "& \\big [ l^{\\tau/4 m_0 } \\ , d_0^{\\tau/2 m_0 } \\ , l^{\\tau/4 m_0 } \\big]^{m_0 } \\end{array}\\ ] ] where @xmath103 is an integer setting the number of zone 0 steps per zone 1 step .",
    "this integrator looks promising . in the absence of any objects in zone 1 , this is merely @xmath104 ( kick - free ) dh steps of size @xmath105 next to each other , and in the absence of any objects in zone 0 , the @xmath106 operators do nothing and the @xmath48 operators collapse , reducing to a dh step of size @xmath18",
    ". there are @xmath104 zone 0 drifts per zone 1 drift , so if we assume each drift takes equal time then if @xmath107 , the zone 1 computation dominates .",
    "as long as @xmath108 , then handling objects in the innermost zone  far from requiring a major decrease in system timestep as in the standard approach  is effectively free ; and , importantly , they can be handled independently of the outer objects .    despite appearances ,",
    "the presence of the @xmath48 terms on the smallest timescale does not remove this separability .",
    "although @xmath48 must be formally _ applied _ with the innermost timestep , this does not mean that @xmath48 must be _ computed _ at that frequency . since @xmath106 does not affect objects in zone 1 , and @xmath48 changes their positions but not their velocities , we need only determine their contribution to @xmath48 at the beginning of the zone 0 substep , and we can delay actually moving them until the beginning of the zone 1 substep .",
    "implementing a lazy - evaluation scheme is relatively simple .",
    "( since @xmath48 is so trivial to evaluate and apply , it is seldom a bottleneck , at least in the serial case . for parallel implementations",
    ", we find that lazy evaluation is vital , because otherwise the communication overhead involved produces enormous scaling difficulties .",
    "potential implementors should bear this warning in mind when designing data structures . )",
    "one can easily generalize to more zones .",
    "the three - zone case is the simplest integrator where the transition functions we will develop can be carried through to a larger number of zones , and therefore we will use it as our standard example . in a minor abuse of notation ,",
    "define @xmath109 ( note that unlike with @xmath48 , @xmath50 , and @xmath49 , @xmath110^m \\neq s^{m \\tau}$ ] . )    then we have the two - zone integrator @xmath111^{m_0 }   \\ , d_1^{\\tau } \\ , \\big[s_0^{\\tau/2 m_0}\\big]^{m_0}\\ ] ]    and the three - zone version @xmath112^{m_0 }   \\ , d_1^{\\tau/2 m_1 } \\ , \\big[s_0^{\\tau/4 m_0 m_1}\\big]^{m_0 }   \\big]^{m_1 } \\\\ & d_2^{\\tau } \\\\ & \\big [ \\big[s_0^{\\tau/4 m_0 m_1}\\big]^{m_0 }   \\ , d_1^{\\tau/2 m_1 } \\ , \\big[s_0^{\\tau/4 m_0 m_1}\\big]^{m_0 }   \\big]^{m_1 }   \\end{array}\\end{aligned}\\ ] ] where @xmath55 sets the number of zone @xmath9 substeps per zone @xmath84 step .",
    "after one step , objects in all zones have been advanced the correct total time under each operator . moreover , neglecting the influence of objects in other zones , each zone has experienced what is locally a standard dh step : objects in zone 0 took a timestep of @xmath113 ; objects in zone 1 had a timestep of @xmath114 ; and objects in zone 2 had a timestep of @xmath18 .",
    "we must now choose where to place the force operators . to simplify the discussion , we set @xmath115 , and assume that the zones are separated such that @xmath18 , @xmath116 , and @xmath117 are appropriate dh timesteps for all objects in the respective zones ; recovering the general case is straightforward .",
    "the kick - free three - zone integrator is given by    @xmath118    let @xmath119 be the kick operator between zones @xmath9 and @xmath23 . in order to treat close encounters using the chambers splitting , we must have each @xmath60 surrounded by two @xmath120 . @xmath121",
    "this integrator does not incorporate interzone forces , but intrazone forces are evaluated on the appropriate timescale relative to the drift timescale for objects in that zone .",
    "one can therefore apply the chambers - style encounter handling between the sets of @xmath122 as described in section [ section : close_enc ] and we recover the standard approach .",
    "( in some situations we have found the @xmath123 operator splitting is superior , but for reasons involving implementation details we will restrict ourselves to discussing the @xmath124 version . )    there are many possible arrangements for force communication between zones .",
    "we optimistically choose the scheme requiring the fewest force calculations , and update forces between zones @xmath9 and @xmath23 on the outermost zone s timestep .",
    "this choice results in @xmath125 this approach succeeds in separating the integration of zone @xmath9 objects from zone @xmath23 objects .",
    "objects in zone 2 need only have drifts and kicks involving them evaluated on the timestep @xmath18 ; objects in zone 1 on @xmath116 ; and zone @xmath126 on @xmath117 ; and as already discussed @xmath48 is not a problem .",
    "note that the above integrator was built to minimize the number of force operators , but one could evaluate the cross - zone kicks ( @xmath127 , for example ) more frequently if desired .",
    "the above integration technique obeys newton s third law regarding interparticle forces .",
    "although forces between objects in different zones are computed less frequently than forces within a zone , whenever gravitational accelerations are computed between two bodies the accelerations are equal and opposite ( even for close - encountering objects in a transition zone , to be discussed later ) and they are immediately applied and turned into changes in velocity . no force lag or accumulation",
    "is involved .",
    "we recall that the key insight of dll98 is that to preserve symplectic behaviour while effectively changing the integration step ( and therefore the surrogate hamiltonian ) an object must experience a smooth transition from one integration regime to another . roughly speaking ,",
    "if an object s transition is sufficiently smooth , then instead of suddenly finding itself evolving under a different surrogate hamiltonian , it believes it is merely in a different regime of the original hamiltonian .",
    "accordingly , we now return to the previously - deferred issue of choosing appropriate transition functions , which turns out to be the most challenging part of the problem .",
    "let @xmath128 be a switch function , a real - valued nondecreasing function defined on @xmath129 $ ] with @xmath130 and @xmath131 . we take the extension outside this domain ( equal to 0",
    "below and 1 above ) as given , under which convention @xmath132 is a switch .",
    "the simplest switch is a shifted step function : @xmath133 however , this leads to sudden movement of portions of the hamiltonian from one term to another , and symplecticity is lost .",
    "dll98 suggest @xmath134 as one of their switches , which has @xmath135 at both endpoints , as well as the higher - order @xmath136 @xcite suggests @xmath137 as a useful compromise between smoothness and efficiency of evaluation . @xcite",
    "prefer @xmath138 \\right)\\ ] ] for which all derivatives vanish at the endpoints .",
    "figure [ fig : trans ] shows the various functions .",
    "we will use the cubic polynomial switch @xmath139 , but the construction is independent of this choice .",
    "( this issue is discussed further in  [ section : vary_switch ] . )    to reduce clutter we define a rescaling function on the switch , @xmath140 and build our transition functions from this base .",
    ".,width=321,height=278 ]    as described briefly in  [ section : naoko1 ] , we divide the system into zones based on instantaneous heliocentric radius @xmath141 , and imagine a set of spherical shells around the sun .",
    "each zone has a transition region near the interior and exterior edge of the shell in which operators involving both adjacent zones will act on an object .",
    "let @xmath142 be the locations of the @xmath9 zone boundaries and @xmath143 be the widths of the transition regions , as illustrated in figure [ schem1 ] .",
    ", width=321,height=278 ]    an unfortunate consequence of this choice is that the resulting evolution of transiting objects under @xmath50 is no longer analytically integrable .",
    "it is tempting to construct a transition function based not on @xmath141 but on the osculating semimajor axis @xmath144 , which is constant during @xmath50 and can therefore be used ( along with all other orbital elements save those such as the mean anomaly describing the position along the orbit ) to build a weighted but integrable @xmath50 .",
    "indeed , experiments show that an @xmath144-based function can work for isolated objects in the transition region",
    ". however , doing so vastly complicates the treatment of close encounters , as two encountering objects must have similar instantaneous @xmath141 but can have very different @xmath144 : consider a high-@xmath145 zone 0 object at apocentre meeting a high-@xmath145 zone 1 object at pericentre . under an @xmath141-based weighting scheme , the difference in their effective drift timestep is bounded by their physical radial separation which gets smaller as the encounter gets deeper , whereas under an @xmath144-based scheme the drift timestep experienced by the inner object could remain very different from that of the outer object , which is not a recipe for numerical stability .",
    "a function which smoothly changes dependence from @xmath141 to @xmath144 with changes in the encounter status may be possible , but in our view the potential benefits are outweighed by the resulting complexity .    for the integrators presented here , such as that of eq .",
    "[ eq : alg3 ] , there are three types of transitions we must consider : ( 1 ) those involving drifts ; ( 2 ) those involving distant kicks ; and ( 3 ) those involving close encounters .",
    "each has its own peculiarities , and treating ( 2 ) and ( 3 ) simultaneously is rather awkward .",
    "the drift transitions are the easiest to handle .",
    "we need a function which will yield ( for example ) the full @xmath96 term for an object completely within zone 1 , and likewise with @xmath146 and an object in zone 2 , but which will return smoothly - varying intermediate values for objects inside the transition zones @xmath147 $ ] and @xmath148 $ ] , and generally @xmath149 $ ] where @xmath150 .",
    "( for simplicity we will restrict ourselves to considering symmetric functions , although since objects in inner zones will have higher velocities and different effective timesteps , it is possible that an asymmetric function could yield better results . )",
    "such a function is given by @xmath151 where @xmath141 is the instantaneous heliocentric radius and @xmath9 is the zone index .",
    "this is nothing more than a symba - style transition applied to @xmath141 instead of to the interplanet separation .",
    "although in general each @xmath142 can have an associated transition zone , in practice the boundary ` transitions ' are slightly degenerate .",
    "typically one would set the inner transition region , @xmath152 , and the outer transition region , here @xmath153 , well outside the radii of interest so that the sum of weights over all zones is equal to 1 for all integrated objects regardless of @xmath141 .",
    "in practice we make @xmath154 smaller than our inner edge ( set by the physics of the problem or the numerics of our timestep ) , @xmath155 larger than the outer edge , and let @xmath156 and @xmath157 be some arbitrary small distance .",
    "figure [ schem1 ] sketches the resulting scheme , with three timestep zones and effectively two ( not four ) transition zones .",
    "treating the forces is more difficult , as it involves not only the interacting bodies two distinct orbital radii but the separations between them .",
    "we seek a function which will ensure the objects experience sufficient continuity in their forces as they move from zone to zone .",
    "we will first consider only distant forces ( i.e.  we imagine all forces are ` soft ' , requiring no special attention ) and then correct to handle close encounters .",
    "consider an integrator with three zones , labelled @xmath9 , @xmath23 , and @xmath158 from innermost to outermost , and two planets , with orbital radii @xmath159 and @xmath160 .",
    "let the objects start in the zone @xmath23 .",
    "initially , all the weight should be in @xmath161 .",
    "if we keep @xmath162 and move the pair together both inwards and outwards , we see that we need smooth transitions between @xmath120 and @xmath161 as well as between @xmath161 and @xmath163 .",
    "if we instead keep @xmath159 constant while increasing @xmath160 , then as the second object crosses from @xmath23 to @xmath158 , then the @xmath161 weight must decrease and @xmath164 must increase until @xmath160 is fully within @xmath158 and the @xmath164 weight is 1 . if we decrease @xmath159 and increase @xmath160 , then when both objects are in the centre of the transition zones ( @xmath9-@xmath23 and @xmath23-@xmath158 ) , we will need to spread the force out over four different terms : @xmath119 , @xmath164 , @xmath165 , and @xmath161 .",
    "this can be achieved by symmetrizing @xmath166 : @xmath167      now we must ensure that close encounters are correctly shared .",
    "this requires a transition function @xmath168 which will move the force between two objects from the @xmath120 term to the @xmath60 term as in the chambers methods , resulting in a triplet of terms @xmath169 +   \\left[(1 - w_{\\mathrm{cl } } ) k_{ii } + d_i \\right ] +   \\left[\\frac{1}{2 } w_{\\mathrm{cl } } k_{ii } \\right]\\ ] ] eq .",
    "[ cham_eq ] .",
    "we take @xmath170 where @xmath171 , after dll98 , is several times the sum of the hill radii ( with a possible additional dependence on orbital velocity ; as chambers has noted , what matters is ensuring you integrate through the transition . )",
    "note that unlike the transition function recommended in @xcite , @xmath168 moves all of the encounter into the numerically - integrated term @xmath172 at separation @xmath173 , not at @xmath174 .",
    "each of the three above transition functions  @xmath166 , which applies to the d operators ; @xmath175 , which applies to all @xmath119 operators ; and @xmath168 , which applies between @xmath120 operators  makes sense independently .",
    "the natural way to combine them would give ( for example , suppressing indices on the transition functions ) :    @xmath176 ^{\\tau_3 }   \\\\",
    "( w_{\\mathrm{dist } } w_{\\mathrm{cl } } k_{33})^{\\tau_3/2 } \\ , \\ , ( w_{\\mathrm{dist } } k_{23})^{\\tau_3/2 }   \\end{array}\\ ] ]    the above approach has a minor problem , however . consider two objects undergoing an encounter in a transition zone ( say , the @xmath9-@xmath23 boundary . ) the above functions will attempt to share force across three terms : @xmath120 , @xmath161 , and the cross - term @xmath119 . however , the integrator is only built to treat the encounter using the @xmath177 and @xmath178 substeps .",
    "any force that the @xmath119 operator is assigned is only sampled on the larger timestep , and if the two objects are both in the middle of the transition zone this can be as much as half the total force .",
    "this will result in a highly inaccurate integration .",
    "how can this be repaired ? in the case of an encounter , @xmath120 and @xmath161 should share all the force :    @xmath179    in the absence of encounters , the above method ( eq .  [ eq : default_close ] ) should work . therefore we define yet another transition function , @xmath180 and use it to smoothly interpolate between the no - encounter case when all operators are involved and the encounter case when only the intrazone operators share the force .",
    "( here we will require that objects can not undergo mutual encounters unless they are in neighbouring zones .",
    "removing this limitation is possible but unnecessary for our intended applications . ) combining the above , we write @xmath181 and replace instances of @xmath175 with this encounter - corrected expression .      the final integrator is constructed by applying the drift transition function ( eq .  [ eq : w_d ] ) and the kick transition function ( eq .  [ eq : kick_final ] ) to the multilevel step of eq .",
    "[ eq : alg3 ] .",
    "the order of the substeps and the relationships between the @xmath182 are determined by the recursive subdivision of eq .",
    "[ eq : recur_substep ] ( as in eq .",
    "[ eq : alg3 ] ) . for each substep of level @xmath183",
    ", the algorithm proceeds as follows : +   + ( 1 ) do the linear drift : if @xmath184 , apply @xmath185 for @xmath186 . +",
    "( 2 ) apply the distant forces between @xmath183 and all interior levels : apply @xmath187 for all @xmath188 for @xmath189 .",
    "+ ( 3 ) drift ( including possible encounters ) : apply the distant forces between @xmath183 and all interior levels : apply @xmath190 for @xmath182 .",
    "( note that any implementation would avoid doing this numerically when the kick term was known to be zero because the objects are too well - separated . ) + ( 4 ) apply the distant forces between @xmath183 and all interior levels : apply @xmath187 for all @xmath188 for @xmath189 .",
    "+ ( 5 ) do the linear drift : if @xmath184 , apply @xmath185 for @xmath186 . + a moment",
    "s consideration confirms that as promised in  [ section : intro ] , this is nothing more than the step subdivision of @xcite applied to the hamiltonian of dll98 with the close encounter handling of @xcite , with staggered force calculations , and some new transition functions incorporated to ensure smoothness .    in practice , we do not use the above scheme directly , but instead use a ` lower - level ' scheme ( motivated in part by @xcite ) in which we do not apply the transitions between terms in the hamiltonian but between the resulting @xmath191 and @xmath192 .",
    "that is , given two pieces of the hamiltonian @xmath193 and @xmath194 and a transition function @xmath195 between them , instead of starting with the decomposition @xmath196 + \\,\\",
    ", \\big [ ( 1-f ) h_a + h_b \\big]\\ ] ] which produces @xmath197 as the derivatives to be integrated , we write @xmath198 and apply the transition directly between the derivatives themselves .",
    "this saves some computation ( of the cross - terms @xmath199 , at least ; the @xmath200 terms are all 0 because @xmath201 is not a function of the momenta ) and increases the effective smoothness of the transition for a fixed @xmath201 because one does not lose a degree of smoothness passing from @xmath202 to its derivatives . it might be objected that this means the resulting integration technique is no longer strictly symplectic , but in fact one can construct a hamiltonian ( admittedly somewhat artificial ) for which an obviously symplectic integrator generates exactly this algorithm .",
    "however , even if this were not the case and we were to view the integrator as merely ` near - symplectic ' , it remains time - reversible and works well in practice , which agrees with the results of @xcite who applied the transition functions in their symba - style decomposition to the forces and not the potential .",
    "of course , one may work with the original hamiltonian - level splitting if preferred .",
    "one easily overlooked issue which is only apparent when considering a global simulation is that in the symba scheme the ( effective ) hill radii  the hill radii used in the close encounter criteria  are fixed at the start of the integration .",
    "this is necessary to ensure that the integration remains both symplectic and analytically soluble .",
    "however , in cases where there is considerable inward migration , an object will have an unnecessarily large close encounter criterion when it arrives at the inner portion of the disc .",
    "similarly , an outward migrating object could miss encounters .",
    "the strict solution is to bring the hill radius dependence of the close encounter weight function under the numerical integration ; the lazy not - quite - symplectic solution is to update the effective hill radii on some interval , at the risk of interfering with ongoing encounters .",
    "all things being equal , if the system is messy and the number of updates is low it is unlikely to make a statistically significant difference .",
    "the algorithm was implemented using the existing codebase of miranda @xcite as a framework , and using a standard bulirsch - stoer routine to handle the numerically integrated terms in the hamiltonian . since the method reduces to the well - understood chambers approach in the one - zone limit",
    ", we will concentrate on testing the performance of the multiple - zone aspects of the code .",
    "we have confirmed by comparison with miranda in both symba and bulirsch - stoer modes that the new code behaves as expected in the one - zone case .",
    "unless otherwise specified , the numerical integration tolerances were set at @xmath203 ( which in practice generates errors @xmath204 ) .",
    "the radial - transition detection routine numerically integrates an object if its osculating orbit as determined on the outer step comes within 5% of the transition zone .      here",
    "we consider a two - zone integrator with outer timestep 0.05 yr and inner timestep 0.025 yr . first we set the transition zone from 0.9 to 1.1 au .",
    "we place objects of masses ranging from 1 to 10000 at semimajor axes between 0.8 and 1.2 au , and consider the resulting behaviour of the energy ( in the one - planet case , a measure of the variation in semimajor axis ) . for objects which enter the transition region , the surrogate hamiltonian under which the planet is moving contains terms from both the inner and outer zones .",
    "figure [ singleplanet_relerr ] shows three points for each of the five mass cases ( 1,10,100,1000 , and 10000 ) at each initial semimajor axis : one for the basic dh integrator ( eq .  [ eq : dh_basic_5_op ] ) with a timestep of 0.025 yr , one for naoko , and one for the dh integrator with a timestep of 0.05 yr",
    ". the errors generally decrease with increasing semimajor axis : for a fixed timestep , at larger orbital radius there are more steps per orbit .",
    "as expected , for objects in the transition zone , the new code reports errors which smoothly interpolate between those of the smaller and larger dh runs , and become indistinguishable from the standard algorithm outside the transition region . in the 10000",
    "runs  3% of the mass of the sun  there are some slight deviations apparent at the edges of the transition region .",
    "the clean interpolation also breaks down at very low mass for a different reason : the integration error is dominated by the integration tolerance .",
    "the situation is very similar for the eccentricities , as shown in figure [ singleplanet_maxe ] .",
    "again we see the new code interpolating between the 0.05 and 0.025 yr dh runs .",
    "this shows that at least in a sufficiently smooth case , integrating an isolated object on multiple timesteps need not introduce spurious energy or angular momentum behaviour .",
    "was 0.,width=321,height=278 ]    figure [ conv1 ] shows the relative energy error as a function both of the timestep and the inner : outer timestep ratio , where the largest outer timestep used was 0.05 yr , for a 1 object at 1 au with @xmath205 , with transition zone from 0.95 - 1.05 au",
    ". as expected , the integrator behaves as a second - order algorithm .",
    "increasing the ratio to take more inner steps per outer step improves the energy error very little beyond 4:1 , as the maximum error is controlled by the outer step which is not changing .    , with transition zone from 0.95 - 1.05 au.,width=321,height=321 ]",
    "although this condition is necessary , it is clearly insufficient .",
    "more realistic tests involve objects which repeatedly cross from the inner zone to the outer zone through the transition zone during the same orbit .    without loss of generality we placed a 1 object in the centre of a transition zone at 1 au , and varied both the eccentricity @xmath145 and the relative transition zone half - width @xmath206 , where @xmath206 is defined so that the zone extends from @xmath207 to @xmath208 , in analogy with the eccentricity .",
    "the outer timestep was chosen to be 1/20th of the orbital period , the eccentricities were varied from 0.001 to 0.37 ( the latter chosen because that corresponds to a perihelion for which 0.025 yr is 1/20th of the orbital period at that distance ) , and the half - width was varied from 0.01 to 0.50 au . the resulting maximum relative energy error is shown in figure [ relmaxerr ] as a function of the @xmath209 ratio ; the contours correspond to constant @xmath145 .        at small @xmath209  that is , when the transition zone is larger than or comparable to the radial excursion per orbit  the energy error is well - behaved for a fixed @xmath145 , and is only weakly dependent on @xmath206 . at @xmath210",
    ", there are many integrations which do not converge .",
    "nonconvergence is easily recognized from the evolution of the semimajor axis or the eccentricity : the planet begins to migrate away from its original location until it finds a semistable configuration .",
    "examples are given in figure [ convexam ] for @xmath211 .",
    "not only does the transition need to be sufficiently smooth along an orbit , but for a run with a larger tolerance or a larger timestep , a wider transition zone may be required so that the numerical integrator can detect the transition ( unless the code accepts hints about the location of difficulties in the integrand ) .     at @xmath211 ; the three half - widths below did not converge.,width=321,height=278 ]      we also explored the effects of alternate choices of transition function .",
    "we place a 1 object at 1 au with @xmath212 , and a transition zone extending from 0.95 to 1.05 au with , with outer timestep @xmath213 yr and inner timestep @xmath214 yr .",
    "we then vary the switch over the six functions described in  [ section : trans ] : the step function ; the switch f(x )",
    "= x ; the dll98 cubic ; the dll98 septic ; the chambers switch ; and the rauch & holman switch .",
    "figure [ varyswitch ] shows the resulting relative energy errors : the behaviours for the convergent integrations continue for millions of orbits .",
    "the step function fails immediately : the object migrates outward in semimajor axis to @xmath215 au over the first 2700 years and then stops , corresponding to a maximum relative energy error of @xmath216 . the remaining integrations all succeeded , with @xmath139 showing the smallest energy error and",
    "@xmath217 the largest .",
    "we have found this is typical . that the crude @xmath218 performs better than the smooth @xmath217",
    "can be understood by returning to figure [ fig : trans ] : @xmath217 is the smoothest function , but for a fixed transition width it is also the one with the narrowest effective transition ( extending roughly from x=0.25 to x=0.75 ) .",
    "the execution times for the various switches ( excluding the step function ) were generally comparable  mostly agreeing within the scatter  except that the rauch & holman switch was consistently the slowest , and @xmath218 the fastest .",
    "the slower speed of the rh switch is likely chiefly due to the evaluation of the trigonometric function .",
    "( note that some versions of the common gcc c compiler will occasionally refuse to inline functions for obscure reasons , leading to strange profiling results . )",
    "thus we chose @xmath139 as the best compromise between efficiency of evaluation and energy conservation .",
    "the above results are unsurprising , insofar as the use of smooth transitions to move portions of the hamiltonian from one part of the step to another is familiar . of more concern",
    "is whether the reduction in the number of force evaluations will lead to unacceptable resolution of the angular momentum exchange between planets in different zones .",
    "we will concentrate on the interactions which are likely to be the most sensitive to changes in sampling frequency , namely resonant interactions . recall that we are willing to accept a cruder approximation to the dynamics than we would ordinarily do , as long as there are no clear integration failures .",
    "since one of our interests is studying migration scenarios , in which resonances play a significant role , it is important to verify that such behaviour is not lost when using the multizone methods .",
    "we will verify that resonant behaviour can persist when the objects are in different zones , when one object is in a transition zone , and when the objects migrate across a zone in resonance ( coorbital or otherwise ) . in each simulation",
    "we have used the two - zone 0.05/0.025 yr 0.9 - 1.1 au transition . to make comparisons with the behaviour of the dh integrator clearer",
    "we have disabled the encounter treatment for the following sections ( until  [ sect : closeenc ] ) .",
    "we place two 2 objects on cold @xmath219 orbits in the 2:1 mean motion resonance in three configurations : ( 1 ) @xmath220 au , @xmath221 au , where the outermost object is in the middle of the transition region ; ( 2 ) @xmath222 au , @xmath223 au , where neither object is in the transition zone but the objects are in different zones ; and ( 3 ) @xmath224 au , @xmath225 au , where the innermost object is in the transition zone .",
    "( all semimajor axes are approximate ; the initial configurations were found by introducing a slowly - decreasing dissipation into the dh algorithm . )",
    "the evolution of the resonance angles is plotted in figure [ 2to1 ] .",
    "in all cases the resonance is preserved , and in the cases where one object was in a transition zone the agreement is excellent between the naoko results and the results of a dh run with timestep 0.025 yr . in the second case ",
    "in which neither object is in a transition zone  the libration is considerably larger in the naoko run .",
    "this is not surprising : in the absence of dissipation the resonance is quite sensitive to the initial conditions , and case 2 has the greatest sudden change from dh to naoko , as none of the force is being evaluated on the higher ( inner ) frequency . even in this case",
    ", the introduced libration is comparable to the differences in width between different dh runs in which only the initial angles had been changed . for our purposes",
    "it is sufficient that the objects remain resonant , which they do .",
    "= ( 0.63 au , 1.00 au ) , ( 0.76 au , 1.20 au ) , and ( 1.00 au , 1.59 au).,width=321,height=278 ]      we place two objects  one 10 and one 1  at 1.3 au on ( osculating ) circular and coplanar objects with mean anomalies differing by 1.5 radians , and let them migrate inwards in the standard hayashi minimum mass solar nebula ( mmsn ) disc model @xcite with surface density @xmath226 g/@xmath227 . ) the migration was driven by a prescription for type i gas migration @xcite , in which the motion is produced by the asymmetry between the torques generated by the interior and exterior wakes of the body @xcite . ( the difference in mass between the two test objects is to ensure that the lower - mass planet is being carried along by the resonance and not merely migrating in tandem . )",
    "figure [ coorb ] shows the evolution of the semimajor axis and the resonant angle for both the dh and naoko integrators .",
    "even when the pair crosses the transition zone , the trajectories are barely distinguishable .",
    "it may seem counterintuitive that the algorithm performs near - perfectly on coorbital resonances which depend sensitively on the local potential and considerably worse on distant resonances which might be expected to be more forgiving of sampling errors .",
    "however , the method s errors compared with the the standard dh algorithm all involve _ relative differences _ , and in the case of co - orbital objects on near - circular objects , these are minimal .",
    "a more rigorous test comes from seeing whether resonance can be maintained when the objects are under different  and varying  terms in the hamiltonian .",
    "we place a 10 planet at 1.40 au and a 20 planet at 1.85 au , just outside the 3:2 resonance at @xmath228au , and turn on type i migration in the mmsn for them both .",
    "the results are shown in fig .",
    "the 20 planet migrates faster than the 10 planet and catches up to the resonance within the first @xmath229 yrs .",
    "the evolution under dh of 0.025 yr and naoko with 0.025/0.050 yr is almost identical until the inner object enters the transition zone ; that naoko is using a timestep twice as large makes little difference . even after the objects enter the transition region , the planets remain in the 3:2 , and the libration width is comparable between the two runs .",
    "it is of interest to see how the maintenance of the resonance varies as the inner : outer timestep ratio is varied .",
    "we place terms in the hamiltonian .",
    "we place a 1 planet at 0.77 au and a 10 planet at 1.23 au , just outside the 2:1 resonance , and again turn on mmsn type i migration .",
    "we fix the outer timestep at 0.05 yr , and change the number of inner steps per outer step , while keeping the transition zone from 0.90 au to 1.10 au in each run .",
    "figure [ vary_m ] shows the resulting evolution of the resonance angle . the use of multiple timescales for the forces introduces spurious libration spikes ( with corresponding behaviour in the eccentricities ) , with the libration width during the spikes generally increasing with the timestep ratio",
    "however , in all cases , from 2:1 through 96:1 , the integration error failed to break the resonance during the transition , and the pair returned to the correct trajectory after the outer object passed through the transition region .          as mentioned in ",
    "[ section : naoko1 ] , although we have chosen to evaluate the forces on the outermost timestep , one can vary this frequency .",
    "we repeat the test of the previous section but with the forces always evaluated on the inner timestep ( and accordingly with no need for any transition function applied to the kick operators ) , in which the only active transitions involve the timestep on which the object is being drifted .",
    "the resulting evolution of the resonance angle is shown in figure [ vary_m_highfreq ] .",
    "we see that using the fixed high - frequency forces results in a considerable qualitative improvement , although the multiple timescales used for the kepler drift still generate libration spikes .",
    "this serves to bound the likely improvement we can imagine by increasing the force frequency , which is very costly .",
    "recall that the formation scenarios we seek to study using the new method involve large particle numbers where the execution time is dominated by the force calculation  a quite different regime from the solar system modelling of @xcite .",
    ".,width=321,height=278 ]      it is important to recognize that by changing the time sampling as we have done , we are unavoidably changing the dynamics of the system .",
    "since the outer timestep remains fixed as we increase the inner timestep , and with it some fraction of the force evaluation , we are modifying the effective interaction between the inner and outer objects .",
    "for example , we consider a pair of 1 objects near a nominal 2:1 resonance at @xmath230 au and @xmath231 au and vary the timestep and inner : outer ratio .",
    "the original outer timestep was 0.05 yr . figure [ conv2 ] shows the resulting change in eccentricity evolution for the inner object as both the inner : outer timestep ratio and the outer timestep are varied ( the outer object shows similar behaviour . ) as the ratio is increased in the top section of the figure  i.e. as the inner timestep is decreased ",
    "the eccentricity evolution does converge , but it does not converge to the correct trajectory , although the relative differences in this case are not large . for a fixed timestep ratio , of course , as the outer timestep is decreased , the evolution converges as it should .     for various timesteps and inner : outer timestep ratios ; the system does not converge to the true path as the ratio is increased but does as the timestep is decreased.,width=321,height=321 ]      as mentioned previously , when two objects are in the same zone the close encounters are treated as in the chambers algorithm , and we disallow encounters between objects which are not in neighbouring zones . since it is known that accurate resolution of close encounters is quite sensitive to the effective hamiltonian under which it is being integrated ( dll98 ,  4 ) , it is reasonable to expect poor behaviour for objects undergoing close encounters in a transition region where it is undergoing drifts of different duration .",
    "a decrease in accuracy may be tolerable at these few locations in a simulation , but the objects can not suffer dramatic instabilities .",
    "we use the 0.9 - 1.1 au , dt=0.05 yr/0.025 yr transition . to generate frequently - encountering systems",
    ", we placed a 5 planet at 1.00 au , in the middle of the transition region , on a circular orbit and a protoplanet of 0.1 at 1.5 au with @xmath232 on a coplanar orbit , set all angles to 0 and varied only the mean anomaly from 0 to @xmath233 . after removing runs in which the smaller body did not undergo an encounter , would have suffered a potential merger , or ( in one case ) became sufficiently eccentric that it escaped the integration region , 16 runs remained .",
    "the relative change in the energy and the tisserand parameter @xmath234 ( @xcite  3.4 ) is plotted in figure [ closeenc ] .",
    "the rms of the maximum changes in e is @xmath235 , and that of t @xmath4 ; the horizontal segments correspond to periods without encounters , where the conservation properties revert to the standard non - encountering behaviour .",
    "for comparison , the equivalent rms maximum changes for our reference symba implementation with timestep 0.025 yr  with mergers disallowed , to make the integration even more difficult  were @xmath236 and @xmath237 for e and t , respectively .",
    "it is clear that the repeated close encounters in the transition zone cause a considerable decrease in accuracy , especially in the energy , but the error growth should be tolerable .",
    "the bulirsch - stoer numerical integrator we use often fails , and reports its failure , at high precision for very close encounters .",
    "this is typically not a problem in practice , as the separations at which the integrator fails are usually much smaller than the distances at which we would merge the two bodies , but is an issue for small - radius dynamical problems .",
    "the same failure mode exists when no transition zones are involved and the symplectic algorithm is one resembling that of chambers .",
    ".,width=321,height=278 ]      as a case study , we consider the problem of forming short - period neptunes , which are particularly mysterious .",
    "it is clear they did not form at the small orbital radii at which they are currently found , and so it is likely they have migrated in from further out .",
    "however , their masses ",
    "@xmath238and higher  are unexpected .",
    "they are large enough that the timescale for type i migration to drag them into the sun is considerably shorter than the formation timescale , but too small for some plausible mechanisms for suppressing type i migration to be effective ( such as the opening of a gap in the disc at the transition to type ii migration . )    there are two main scenarios present in the literature for forming these objects .",
    "the first , due to @xcite , concentrates on sophisticated gas physics and follows the evolution of effectively isolated cores through the disc as they grow via planetesimal accretion and migrate , and finally have their atmospheric mass reduced after arriving in the short - period region by evaporation .",
    "the second , due to @xcite , takes a more traditional n - body approach , and follows the evolution of a small number of large embryos in the inner region .",
    "neither of these are easy to reconcile with the standard oligarchic growth model for core formation @xcite : the first requires core formation to be suppressed everywhere in the disc except at a few special locations , and the second uses initial conditions for the mass distribution which it is difficult to recover self - consistently from earlier stages of oligarchic evolution .",
    "it is of considerable interest whether the standard model can generate anything resembling the observed planets  if it can not , then we have strong evidence that we are missing important physics  and the new method can address this question .",
    "we will merely sketch the application here ; forthcoming work will describe our results in more detail .",
    "we apply the two - stage approach of @xcite , which was based on that of @xcite , using semianalytic approximations of oligarchic evolution to treat the early evolution of the disc and then generating an n - body realization when the number of n - body particles needed drops to practical levels .",
    "we consider various disc models ( all resembling the minimum mass model of @xcite ) and different migration efficiencies .",
    "an example of a low - resolution run is shown in figure [ example1_029 ] which employed 21 embryos and 212 planetesimals .",
    "the semianalytic model was run to 1 myr for a disc with surface density proportional to @xmath239 of @xmath240 times the standard hayashi mass without a snow line , with nominal type i migration and aerodynamic drag ( for a 1 km planetesimal size ) , where the e - folding time for the decay of the gas disc was 0.5 myr .",
    "a section of the system ranging from 1.0 au to 5.1 au was then evolved under the new n - body code until the gas was mostly absent . as a consequence of the semianalytic model predicting that the innermost part of the disc had gone to oligarchic completion , the embryos inside of 2.0 au migrate inwards smoothly in tandem : there is nothing to perturb them .",
    "this results in @xmath241 of embryo material inside of 1 au when the gas vanishes in an apparently stable configuration .",
    "further out , the system is still undergoing chaotic evolution . in a more realistic situation ,",
    "in which there were still planetesimals around in the inner regions to perturb the embryos , they might merge , producing larger planets ; or , if they merge too early , they could migrate into the sun .",
    "figure [ grid9 ] presents examples of the kinds of interior configurations our toy simulations produce ; all are plotted at t=3.25 myr .",
    "typical results include failures in which no or almost no mass is left in the interior region ( s2 , s5 , s7 , s9 ) ; cases where the total mass is interesting from the perspective of hot neptune formation but the embryo mass is spread out over a large number of embryos instead of being concentrated in one or two objects ( s4 , s8 ) ; and cases where the total mass is appealing and there are only two embryos of multiple earth masses ( s1 , s3 , s6 ) but where too much of the mass is locked up in planetesimals , possibly as a consequence of the low resolution .",
    "( planetesimals do not self - interact in these simulations . )",
    "even these crude simulations are useful to estimate whether the conditions are appropriate for larger integrations .",
    "we will present results from higher resolution simulations in a forthcoming publication .",
    ", with disc dissipation e - folding time of 0.5 myr . for each embryo lines corresponding to semimajor axis , perihelion distance , and aphelion distance are drawn .",
    "[ example1_029],width=321,height=413 ]    ) and planetesimals ( @xmath242 ) in the region inside 1 au is given in the upper left .",
    "[ grid9],width=321,height=413 ]",
    "the observed behaviour of the method ( including on tests not presented above ) is compatible with the principles that ( 1 ) parts of the hamiltonian can be moved between operators with different timesteps if the transition is sufficiently smooth , ( 2 ) reversibility is more important than accuracy for secular energy conservation , and ( 3 ) decreased time resolution is not catastrophic for dynamics on much longer timescales .",
    "we emphasize that we do not claim , and have not shown , that the integrators are in any sense optimal .",
    "( some evidence suggests that a drift - kick - drift splitting can be preferable to the kick - drift - kick splitting used here , for example ; see @xcite . ) to use a loose analogy from the history of close encounter treatment , this approach probably lies somewhere between the hybrid methods of @xcite and the mature methods of dll98 .",
    "as always , one must bear the approximations being used in mind ",
    "small effects can accumulate to cause dramatic changes on secular timescales in ways not always easy to predict .",
    "the approximations used here have the virtue of being different from those used previously . given the decrease in force accuracy involved , it may be best to think of the use of these methods as one would a reversible , kepler - adapted treecode : useful for studying certain formation problems , and generally informative in a statistical sense , but inappropriate for cases where detailed dynamics are important .",
    "potential users are advised to think carefully about whether the approximations are suited for their problems , as there are far more ways for an integration to fail in the multi - zone case than there are in standard symba - style integrators .",
    "there are several potential applications and directions for generalization we have not considered here .",
    "as discussed in section [ section : close_enc_with_sun ] , @xcite modified the chambers approach to handle objects which occasionally require very small timesteps , at the price of integrating the entire system numerically when such an approach occurs .",
    "the new method succeeds in decoupling such objects , and so may be practical in some cases for which their method is inapplicable ( such as when ejections of low - mass objects are common )",
    ". it may also be useful in studying planet formation in close binaries , for which some symplectic methods for dealing with these systems already exist @xcite .",
    "@xcite develop ` symplectic interpolation ' methods to improve the accuracy of their integrator , by using a symplectic prediction of the effects of @xmath32 to better synchronize the force calculations .",
    "this would probably work here as well , in a formal sense , but it is unlikely to provide dramatic improvements , and the errors in energy and angular momentum conservation introduced by the method should be tolerable for most formation problems as they stand .",
    "we have presented a new integration method which preserves most of the speed and conservation properties of standard close - encountering symplectic integrators for planetary dynamics , but introduces radial zones between which the drift and force evaluation timesteps can vary .",
    "this allows for a new tradeoff between the accuracy of the integration and the speed , one which is inappropriate for precise dynamical studies but may be of use for investigating other scenarios .",
    "we expect it to be useful for approximate n - body modelling of planetary formation problems where ( 1 ) there is a wide range of orbital velocities , ( 2 ) the majority of the material needing particle representation is in the regions with longer orbital periods , and ( 3 ) the system remains sufficiently cold that the transition regions between radial zones can be kept reasonably small .",
    "migration scenarios of the formation of hot exoplanets satisfy all these constraints , and we are currently exploring such applications .",
    "dsm thanks martin duncan and paul wiegert for useful discussions , and thank the anonymous referee for a careful review .",
    "the authors gratefully acknowledge the support of sftc grant pp / d002265/1 .",
    "the simulations presented in this paper were performed using the qmul hpc facilities ."
  ],
  "abstract_text": [
    "<S> modern n - body techniques for planetary dynamics are generally based on symplectic algorithms specially adapted to the kepler problem . </S>",
    "<S> these methods have proven very useful in studying planet formation , but typically require the timestep for all objects to be set to a small fraction of the orbital period of the innermost body . </S>",
    "<S> this computational expense can be prohibitive for even moderate particle number for many physically interesting scenarios , such as recent models of the formation of hot exoplanets , in which the semimajor axis of possible progenitors can vary by orders of magnitude . </S>",
    "<S> we present new methods which retain most of the benefits of the standard symplectic integrators but allow for radial zones with distinct timesteps . </S>",
    "<S> these approaches should make simulations of planetary accretion with large dynamical range tractable . as proof - of - concept we present preliminary science results from an implementation of the algorithm as applied to an oligarchic migration scenario for forming hot neptunes .    </S>",
    "<S> [ firstpage ]    methods : numerical  celestial mechanics  solar system : general </S>"
  ]
}