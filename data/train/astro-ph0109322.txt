{
  "article_text": [
    "in currently favoured dark matter dominated cosmological models , initially small density fluctuations are amplified by gravity and eventually condense out of the hubble expansion to form gravitationally bound systems at a density contrast of @xmath3  dark matter haloes ( e.g. peebles 1993 ) .",
    "the properties of the halo population are of fundamental importance for understanding galaxy formation and evolution .",
    "indeed , galaxies are thought to form when baryons fall into such dark matter haloes and are shocked to sufficiently high temperatures and densities that the gas can cool radiatively to form stars ( rees & ostriker 1977 , white & rees 1978 ) .",
    "the formation of haloes can be studied using numerical simulations which usually evolve a set of equal mass particles that represent the dark matter in a periodic simulation box ( e.g. efstathiou et al .",
    "1985 ) . a popular way of identifying haloes  in such calculations is the friends - of - friends ( fof ) algorithm , which links particles within a fraction @xmath4 of the mean inter - particle spacing into one halo , at a density contrast of @xmath5 .",
    "other halo identification algorithms generally give similar results .",
    "jenkins et al .",
    "( 2001 ) combined the results from simulations with a variety of box sizes to obtain the mass function @xmath6 of fof haloes over a large dynamic range .",
    "analytical descriptions of the halo formation process were pioneered by press & schechter ( 1974 , hereafter ps ) and were recently reviewed by monaco ( 1998 ) . although the ps mass function and its extensions ( the so - called excursion set approach , bond et al .",
    "1991 ) fit the numerical fof mass function reasonably well ( e.g. efstathiou et al . 1988 ) , there are real discrepancies both at large and small masses where ps respectively under and over predicts halo numbers ( e.g. governato et al .",
    "1999 ; jenkins et al .",
    "2001 ; bode et al .",
    "similar discrepancies are found when reproducing the mass function of the progenitors of halos of given mass ( sheth & lemson 1999 ; somerville et al .",
    "in addition , bond et al .",
    "( 1991 ) and white ( 1996 ) demonstrated that the ps approach achieves a very poor agreement on an object - by - object basis when compared to simulations ( but see sheth , mo & tormen 1999 for a different view ) .",
    "analytic approaches based on the peaks of the initial density fields did not achieve a better agreement with simulations ( katz , quinn & gelb 1993 ) .",
    "intermediate between simulations and analytical techniques are perturbative approaches that describe the growth of haloes in a _ given _ numerical realisation of a linear density field , such as the truncated zeldovich ( 1970 ) approximation ( borgani , coles & moscardini 1994 ) , the peak - patch algorithm ( bond & myers 1996a , b ) and the merging cell model ( rodriguez & thomas 1996 ; lanzoni , mamon & guiderdoni 2000 ) .",
    "in this paper we present a new algorithm to compute the formation and evolution of dark matter haloes in a given linear density field .",
    "a 1d version of this algorithm was given by monaco & murante ( 2000 ) .",
    "in common with the other perturbative approaches , we combine a local description of the dynamics in order to identify collapsed haloes with lagrangian perturbation theory to displace the haloes to their final positions .",
    "we demonstrate that the algorithm leads to an accurate description of the detailed clustering and merger history of haloes while requiring several orders of magnitude less computer time and post - simulation analysis than the corresponding full blown numerical simulation .",
    "in addition , the successful reproduction of the merger history demonstrates that we have identified the key processes that govern halo formation , and that these can be described with a perturbative approach .",
    "we follow a two step procedure that mimics the hierarchical built - up of haloes through accretion and merging .",
    "the first step identifies orbit - crossing ( hereafter oc ) as the instant at which a mass element undergoes collapse .",
    "we compute oc numerically by applying local ellipsoidal collapse approximation to the full lagrangian perturbative expansion ( bond & myers 1996a , monaco 1995 , 1997 ) .",
    "this part is the more computationally expensive , requiring several hours of computer time on a personal computer for a 256@xmath7 realization .",
    "the second step groups the collapsed particles into disjoint haloes , using an algorithm similar to that used to identify haloes in @xmath2-body simulations .",
    "basically , a particle accretes onto a halo if it is sufficiently close to it at its collapse instant .",
    "we use lagrangian perturbation theory ( lpt , catelan 1995 , bouchet 1996 ; buchert 1996 ) to compute the positions of haloes and particles .",
    "seed haloes are local maxima of the collapse redshift .",
    "this second step automatically determines the full merger history of haloes and requires negligible computer time .",
    "compared to simulations , the first step determines when a simulation particle enters a high - density region whereas the second identifies the haloes .",
    "since our method describes , in the linear density field , the hierarchical built - up of objects that have undergone oc , we refer to it as pinocchio : pinpointing orbit - crossed collapsed hierachical objects . in the next section",
    "we describe the algorithm in more detail . in section 3",
    "we compare its predictions with those from simulations and discuss possible applications of the method .",
    "section 4 gives the conclusions .",
    "technical details and resolution issues are addressed in forthcoming papers ( monaco , theuns & taffoni 2001 ; taffoni , monaco & theuns 2001 ) .",
    "[ fig : mfunc ]    ( 7,9 ) ( -3 , -2.5 )    [ fig : dplot ]    ( 7,7 ) ( -2,-2 )      consider a random realization of a density field , @xmath8 , where @xmath9 denote lagrangian ( initial ) coordinates , and let @xmath10 be the corresponding peculiar potential .",
    "both fields can be smoothed by convolving them with a gaussian with fwhm @xmath11 ; we denote them as @xmath12 and @xmath13 respectively .",
    "the first derivative of the potential , @xmath14 , describes the motion of the particle in the zeldovich ( 1970 ) approximation , and the shear tensor , @xmath15 , can be used to give a description of the deformation of the mass element based on ellipsoidal collapse ( bond & myers 1996a , monaco 1995 , 1997 ) . in our context ellipsoidal collapse is a convenient truncation of lpt ( monaco 1997 ) .    for a given smoothing radius @xmath11 ,",
    "the density of a mass element will become infinite as soon as at least one of the ellipsoid s axes reaches zero size , at which point the relation @xmath16 becomes multi - valued and the jacobian of the transformation @xmath17 , @xmath18 .",
    "this is the definition of oc .",
    "we argue that after this instant @xmath19 , non - linear processes will become important and hence further predictions of what happens to the mass element can not be safely made using lpt . however , as the density of the mass element is already very high , we regard it as a candidate for the building up of a collapsed halo at time @xmath20 .",
    "a different definition of collapse was used , e.g. , by audit , teyssier & alimi ( 1997 ) , lee & shandarin ( 1998 ) and sheth & tormen ( 2000 ) .    in practice",
    "we generate the density field @xmath21 on a cubic grid . in our description , mass elements ( or particles ) then correspond to the grid vertices @xmath22 .",
    "the potential @xmath23 and its derivatives are computed from @xmath21 using fast fourier transforms .",
    "we typically use @xmath2420 logarithmically spaced smoothing radii . applying local ellipsoidal collapse to each particle",
    ", we obtain the collapse redshift on each smoothing scale , and we record for each particle the highest collapse redshift @xmath25 , the corresponding smoothing scale @xmath26 and the zeldovich ( 1970 ) estimates for the peculiar velocity @xmath27 on that smoothing scale . note that at this stage we make no prediction of the _ mass _ of the collapsed halo that the particle accreted onto .",
    "in fact , the collapsed mass element will not necessarly have accreted onto any halo , but may instead have become part of a filament or sheet ( collectively referred to as filaments  hereafter ) , since these have undergone oc as well .",
    "these structures trace the moderate over densities that connect the much higher density collapsed haloes in simulations .",
    "the next subsection describes how the oc region is divided into collapsed haloes and oc filaments .",
    "the grouping of oc particles into haloes mimics the hierarchical formation of objects , and also the way in which halo finders identify collapsed objects in simulations .",
    "we begin by sorting particles according to decreasing collapse redshift @xmath25 , and , starting from the highest @xmath25 we decide the fate of the collapsed particle , working our way down forward in time to the last particle to collapse .    briefly , at the instant the particle is deemed to collapse , we decide which halo , if any , it accreted onto .",
    "the candidate haloes are those that already contain one _ lagrangian neighbour _ of the particle of lagrangian positions , the six particles nearest to a given particle are its lagrangian neighbours . ] .",
    "the particle will accrete onto the halo if it is sufficiently close  to it at the collapse time , mimicking the construction of fof haloes .",
    "we use the zeldovich velocities @xmath28 as defined earlier to compute the distance , at the collapse time , between the particle and the candidate halo .",
    "if a particle has more than one candidate halo , we also check whether these haloes should merge , using a similar merger criterion .",
    "notice that in this way haloes are by construction connected regions in lagrangian space .",
    "more in detail , we apply the following rules for accretion and merging .",
    "( lengths are in units of the grid spacing ; @xmath29 is the radius  of a halo of @xmath30 particles . )    1 .   _",
    "seed haloes _ local maxima of the collapse redshift @xmath25 are seeds for a new halo .",
    "accretion _ a collapsing particle ( not a local maximum ) accretes onto a candidate halo ( i.e. containing one of its lagrangian neighbours ) if the distance @xmath31 , at the collapse time , between particle and halo centre - of - mass is @xmath32 .",
    "@xmath33 is a parameter of order unity , analogous to the linking length parameter used to identify fof haloes .",
    "if the particle is able to accrete onto two ( or more ) haloes , we assign it to the one for which @xmath34 is the smallest .",
    "3 .   _ merging _ if the particle has more than one candidate halo , then these haloes are merged if their mutual distance @xmath31 , again at the particle s collapse time , is @xmath35 , where @xmath36 refers to the larger halo and @xmath37 is again a parameter of order unity .",
    "since we only consider six lagrangian neighbours , up to six haloes may merge at a given time , although binary and ternary mergers are of course much more frequent .",
    "_ filaments _ with these rules for accretion and merging , some collapsing particles do not accrete onto a halo at their collapse time .",
    "since these particles tend to occur in the mildly overdense regions that connect the haloes ( visible as a filamentary network between haloes in simulations ) , we assign them to a filamentsgroup . in @xmath2-body simulations , some particles accrete onto a halo directly from this filamentary network , _ without _ passing through a collapsed halo first . in order to account for this",
    ", we check the lagrangian neighbours of a particle that accretes onto a halo according to the accretion condition ( 2 ) . if any of these neighbours already belong to the filaments group , then they also accrete onto that halo .",
    "( so up to five additional particles may accrete onto the halo , if their common lagrangian neighbour satisfies condition ( 2 ) ) .",
    "when the groups are very small , @xmath36 is comparable to the grid spacing , and the zeldovich displacements are often not sufficiently accurate for the accretion or merging condition to be fulfilled .",
    "this resolution effect results in producing too few small haloes at high redshift . to remedy this",
    "we improve the accretion condition to @xmath38 , and similarly for merging .",
    "our algorithm thus contains three parameters ( @xmath33 , @xmath37 and @xmath39 ) which need to be calibrated using the fof mass function as determined from a simulation , and which have obvious physical interpretations in terms of accretion , merging and resolution effects .",
    "optimal values are @xmath40 , @xmath41 and @xmath42 .",
    "these values were obtained by comparing the pinocchio mass function with those of several simulations , including the standard scdm one discussed below , a @xmath43cdm simulation ( @xmath44 , @xmath45 , @xmath46 , @xmath47 ) run with the same simulation code and box size ( 500 @xmath48 mpc ) and another @xmath43cdm simulation ( @xmath45 , @xmath44 , @xmath49 , @xmath50 ) with different resolutions ( @xmath51 and @xmath1 particles ) in a smaller box of 100 @xmath48 mpc , evolved with the p3 m hydra code ( couchman 1991 ) .",
    "the agreement between pinocchio  and these other simulations is as good as the comparison with the scdm simulation described in the next section ; the best fit parameters are found to agree within @xmath520.01 .",
    "however , at smaller and more non - linear scales more subtle resolution effects appear , which can be corrected for",
    ". these details will be discussed in the forthcoming paper monaco et al .",
    "[ fig : obj ]    ( 7,12 ) ( -3 . , -4 )    [ fig : dplot2 ]    ( 10,10 ) ( 0 , -1.5 )    [ fig : prog ]    ( 7,9 ) ( -4.5 , -5 )    [ fig : corr ]    ( 7,11 ) ( -1.5 , -4.8 )    we have applied pinocchio  to the initial conditions of a simulation by governato et al ( 1999 ) . this large volume dissipationless simulation uses @xmath0 dark matter particles and was evolved using the pkdgrav tree code ( comoving box size 500 @xmath48 mpc , matter density @xmath53 , hubble constant @xmath54 km s@xmath55 mpc@xmath55 , standard cdm spectrum with @xmath46 ) .",
    "haloes have been identified at several output times using a standard fof algorithm with linking - length @xmath56 .",
    "pinocchio  is fast : resampling the initial conditions onto a 256@xmath7 grid , the first stage of computing orbit - crossing requires @xmath52 6 hours of cpu time , the second step of identifying the haloes takes just a few minutes .",
    "( timings refer to a pentium  iii 450mhz personal computer .",
    "memory requirement in this case amounts to @xmath57mbytes of ram . )",
    "these timings should be contrasted with the several hundreds of hours on 256 nodes of a t3e cray supercomputer required to perform the original simulation . moreover",
    ", pinocchio  immediately outputs the merger tree of each halo , which should be contrasted to the complicated and expensive postprocessing necessary to extract merger trees from a simulation .",
    "one way to understand the large speed - up between an @xmath2-body simulation and pinocchio  is that most of the cpu time used in the @xmath2-body simulation is spent integrating the orbits for particles _ already inside a halo_. these particles undergo large accelerations as they orbit inside the halo , and hence may require thousands of time - steps in order for their orbits to be integrated accurately .",
    "pinocchio on the other hand , completely ignores particles once they are inside a halo and so can use far fewer steps per particle to perform the whole simulation , since it only needs to compute the particle s orbit _ before _ it enters any high density region . obviously , all information on the internal structure of the halo is lost in the process , but it is well known that several millions of particles are required to get the internal structure correct .",
    "( see the controversy about the slope of halo profiles as determined using high - resolution collisionless simulations , e.g. ghingha et al .",
    "2000 ) . in the following",
    "we demonstrate that pinocchio  is indeed able to predict the merging and clustering properties of haloes very accurately .",
    "pinocchio  reproduces the mass function @xmath58 ( number of objects per unit volume and unit @xmath59 ) to better than 10 per cent at all redshifts ( figure  [ fig : mfunc ] ) , in the mass range in which haloes have at least @xmath5230 particles and poisson error bars are small . to make this more evident , we plot in the lower panel of figure  [ fig : mfunc ] the residuals with respect to the @xmath60 fof mass function",
    "this level of accuracy improves over the fit proposed by sheth and tormen ( 2000 ) .",
    "( the ps mass function , which over ( under ) predicts the number of low ( high ) mass objects , is shown for comparison as well . )    the good agreement between halo masses is not just statistical in nature .",
    "we have plotted in figure  [ fig : dplot ] the masses of the haloes that a particle is assigned to , for both pinocchio  and fof haloes , for a random subset of particles drawn from the initial conditions .",
    "the correlation between pinocchio  and fof masses is extremely tight , and is dramatically better than ps ( compare with figure  2 in sheth , mo & tormen 2001 ) , and also improves over peak - patch ( bond & myers 1996b , their figure  11 ) .",
    "figure  [ fig : dplot ] contains outliers which correspond to particles that are assigned to a different halo ( or are not assigned to a halo at all ) by pinocchio  than by the simulation ( or vice versa ) .",
    "we have investigated in detail the typical overlap in the initial conditions between simulated haloes and those found by pinocchio .",
    "since pinocchio  refers to the same initial conditions as the simulation , we can determine the fraction of lagrangian volume @xmath61 of a given halo identified by pinocchio  that overlaps the lagrangian volume @xmath62 of a fof halo .",
    "in general , for any fof halo , the volume @xmath62 may overlap with the lagrangian volumes of several pinocchio  haloes ( and vice versa ) .",
    "for example , if two pinocchio  haloes fail to merge , whereas the corresponding fof haloes do merge , then the volume @xmath62 may be broken - up into two pinocchio  volumes @xmath61 .",
    "we choose to pair - up two haloes between the two catalogs , if their lagrangian volumes overlap to better than 30 per cent .",
    "paired - up haloes are in addition called cleanly assigned if the intersection of @xmath62 with @xmath63 is larger than for any other fof halo , and vice versa .",
    "paired - up haloes that are not cleanly assigned are called split . denoting the fraction of haloes that are cleanly assigned and",
    "the fraction that are split by @xmath64 and @xmath65 respectively , then the fraction of haloes that are not paired - up is obviously @xmath66 .    in figure",
    "[ fig : obj ] we show @xmath64 and @xmath65 as a function of halo mass , for several redshifts .",
    "for sufficiently massive haloes @xmath67 ( corresponding to 40 particles ) , @xmath68 , showing that most fof haloes can be unambigously associated with a corresponding pinocchio  halo , while the fraction of fof haloes split in two or more pinocchio  haloes is small .",
    "the fraction @xmath69 of fof haloes that have no corresponding pinocchio  halo is very small as well , ranging from @xmath70 per cent for the most massive haloes , to @xmath71 per cent for small haloes with @xmath5240 particles .",
    "the latter limit is close to the minimum number needed to correctly numerically simulate the formation of a halo , given an initial density field .",
    "for cleanly assigned haloes , the bottom panel in the figure shows the fractional overlap @xmath72 of the respective lagrangian volumes .",
    "a typical values for well resolved haloes is @xmath73 , indicating that the mass errors are usually smaller than 30 per cent .",
    "this is made more clear in figure  [ fig : dplot2 ] , which compares the fof with the pinocchiomasses for cleanly assigned halo pairs .",
    "the correlation is very tight .",
    "the level of agreement between pinocchio  and simulations is only weakly dependent on redshift .    since pinocchio  haloes are in detail very similar to their corresponding fof haloes",
    ", their merging history and clustering properties can be expected to be very similar as well .",
    "the conditional mass function @xmath74 ( the number density of objects of mass @xmath30 at redshift @xmath75 that are merged in haloes of mass @xmath76 at the later redshift @xmath77 ) is shown in figure  [ fig : prog ] .",
    "the ps prediction , computed following bond et al .",
    "( 1991 ; see also bower 1991 ; lacey & cole 1993 ) is also shown . also in this case the agreement between pinocchio  and the simulation is very good , making an improvement with respect to ps and demonstrating that pinocchio  haloes undergo a very similar merging history as do fof haloes .",
    "finally , we compare in figure  [ fig : corr ] the two - point correlation function @xmath78 of haloes as a function of mass and redshift .",
    "the agreement with the simulations is again very good .",
    "in particular , the high clustering amplitude of massive haloes at early times is well reproduced , and the correlation length @xmath79 is recovered to within 10 per cent or better , thus improving the ps - like estimate of sheth et al .",
    "( 2001 ) and allowing to discriminate easily between different cosmological models ( colberg et al .",
    "the quality of this agreement suggests that halo positions are well estimated by pinocchio ; we find that the 1d rms error on the final positions is @xmath52 0.8 @xmath48 mpc ( smaller than the grid spacing ) , while velocities are recovered with a 1d rms of @xmath52150 km / s .",
    "we have demonstrated that pinocchio  is able to accurately describe the evolution of clustering of haloes as a function of mass .",
    "therefore , when combined with semi - analytical models for galaxy formation ( white & frenk 1991 , kauffmann , white & guiderdoni 1993 , cole et al 1994 , somerville & primack 1999 ) , pinocchio  can be used to reliably generate mock galaxy catalogs , with the correct evolution of galaxy clustering build - in , while requiring orders of magnitude less computer time than numerical simulations .",
    "easy and accurate production of large halo catalogues is invaluable for interpreting data and estimating errors from galaxy or galaxy cluster surveys , for example when studying galaxy bias ( diaferio et al . 1999 ; benson et al .",
    "2000 ) , estimating power - spectra ( e.g. efstathiou & moody 2001 ) , determining shear from weak lensing measurements ( van waerbeke et al .",
    "2000 , wittman et al .",
    "2000 , bacon , refregier & ellis 2000 , kaiser , wilson & luppino 2000 ) or studying intrinsic galaxy alignments ( crittenden et al .",
    "2001 , brown et al .",
    "2000 ) .    a more detailed and technical account account of the code , suitable for those who wish to use it , will be given in a forthcoming paper ( monaco et al .",
    "2001 ) , while the ability of predicting halo merger histories beyond the progenitor mass function will be presented by taffoni et al .",
    "a public version of pinocchio  is available at the site http://www.daut.univ.trieste.it/pinocchio .",
    "we thank jasjeet bagla , stefano borgani , anatoly klipin , barbara lanzoni , sergei shandarin and ravi sheth for many discussions .",
    "@xmath2-body simulations were run at the arsc and pittsburg supercomputing centers .",
    "pm acknowledges support from murst .",
    "tt acknowledges support from the formation and evolution of galaxies  network set up by the european commission under contract erb fmrx - ct96086 of its tmr programme , and from pparc for the award of of post - doctoral fellowship .",
    "research conducted in cooperation with silicon graphics / cray research utilising the origin 2000 super computer at damtp , cambridge ."
  ],
  "abstract_text": [
    "<S> we present a new algorithm ( pinocchio , pinpointing orbit - crossing collapsed hierarchical objects ) to predict accurately the formation and evolution of individual dark matter haloes in a given realization of an initial linear density field . compared with the halo population formed in a large ( @xmath0 particles ) collisionless simulation of a cdm universe , </S>",
    "<S> our method is able to predict to better than 10 per cent statistical quantities such as the mass function , two - point correlation function and progenitor mass function of the haloes . </S>",
    "<S> masses of individual haloes are estimated accurately as well , with errors typically of order 30 per cent in the mass range well resolved by the numerical simulation . </S>",
    "<S> these results show that the hierarchical formation of dark matter haloes can be accurately predicted using local approximations to the dynamics when the correlations in the initial density field are properly taken into account . </S>",
    "<S> the approach allows one to automatically generate a large ensemble of accurate merging histories of haloes with complete knowledge of their spatial distribution . </S>",
    "<S> the construction of the full merger tree for a @xmath1 realisation requires a few hours of cpu - time on a personal computer , orders of magnitude faster than the corresponding @xmath2-body simulation would take , and without needing any extensive post - processing . </S>",
    "<S> the technique can be efficiently used , for instance , for generating the input for galaxy formation modeling . </S>"
  ]
}