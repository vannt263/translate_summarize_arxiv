{
  "article_text": [
    "galaxies are morphologically complex entities .",
    "even seemingly simple systems like elliptical galaxies can have outer envelopes and distinct cores or nuclei , while so - called `` bulge - less '' spiral galaxies can still have nuclear star clusters and disks with complex radial or vertical profiles . in order to accurately describe the structure of galaxies , it is often necessary to decompose galaxies into component substructures .",
    "even single - component systems are often modeled with analytic functions in order to derive quantitative measurements such as scale lengths or half - light radii , srsic indices , etc .    the traditional method for dealing with this complexity",
    "has been to model 1d surface - brightness profiles of galaxies  derived from 2d images  as the sum of separate , additive components ( e.g. , bulge + disk ) ; pioneering examples of this include work by @xcite , @xcite , @xcite , @xcite , @xcite , and @xcite .",
    "while this 1d approach can be conceptually and computationally simple , it has a number of limitations , above and beyond the fact that it involves discarding most of the data contained in an image . to begin with ,",
    "there are uncertainties about _ what type _ of 1d profile to use ",
    "should one use major - axis cuts or profiles from ellipse fits to isophotes , should the independent variable be semi - major axis or mean radius , etc .",
    "it is also difficult to correctly account for the effects of image resolution when fitting 1d profiles ; attempts to do so generally require simple analytic models of the point - spread function ( psf ) , extensive numerical integrations , and the assumption of circular symmetry for the psf , the surface - brightness function , or both ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "furthermore , there are often intrinsic degeneracies involved : images of galaxies with non - axisymmetric components such as bars can yield 1d profiles resembling those from galaxies with axisymmetric bulges , which makes for considerable ambiguity in interpretation .",
    "finally , if one is interested in the properties of non - axisymmetric components ( bars , elliptical rings , spiral arms ) themselves , it is generally impossible to extract these from 1d profiles .",
    "a better approach in many cases is to directly fit the images with 2d surface - brightness models .",
    "early approaches along this line include those of @xcite , @xcite , and @xcite .",
    "the first general , self - consistent 2d bulge+disk modeling of galaxy images  that is , constructing a full 2d model image , comparing its intensity values with the observed image pixel - by - pixel , and iteratively updating the parameters until the @xmath0 is minimized  was that of @xcite , with @xcite being the first to include extra , non - axisymmetric components ( bars ) in fitting galaxy images .",
    "an interesting alternate approach developed at roughly the same time was the multi - gaussian expansion method @xcite , which involves modeling both psf and image as the sum of an arbitrary number of elliptical gaussians ; the drawback is the difficulty that lies in trying to associate sets of gaussians with particular structural components and parameters .",
    "the most commonly used galaxy - fitting codes at the present time are probably gim2d @xcite , ] galfit @xcite , ] budda @xcite , ] and mge @xcite . ] gim2d is specialized for bulge - disk decompositions and is implemented as an iraf package , using the metropolis algorithm to minimize the total @xmath0 for models containing an exponential disk and a srsic bulge .",
    "budda is written in fortran and is also specialized for bulge - disk decompositions , though it includes a wider variety of possible components : exponential disk ( with optional double - exponential profile ) , srsic bulge , srsic bar , analytic edge - on disk , and nuclear point source .",
    "it uses a version of the nelder - mead simplex method @xcite , also known as the `` downhill simplex '' , for @xmath0 minimization .",
    "galfit , which is written in c , is the most general of these codes , since it allows for arbitrary combinations of components ( including components with different centers , which allows the simultaneous fitting of overlapping galaxies ) and includes the largest set of possible components ; the latest version @xcite includes options for spiral and other parametric modulation of the basic components .",
    "galfit uses a version of the fast levenberg - marquardt gradient - search method @xcite for its @xmath0 minimization .",
    "mge , available in idl and python versions , is rather different from the other codes in that it uses what is effectively a non - parametric approach , fitting images using the sum of an arbitrary number of elliptical gaussians ( it is similar to galfit in using the levenberg - marquardt method for @xmath0 minimization during the fitting process . )    for most astronomical image - fitting programs the source code is not generally available , or else is encumbered by non ",
    "open - source licenses . even when the code _ is _ available , it is not easy to extend the built - in sets of predefined image components .",
    "the simplest codes provide only elliptical components with exponential and srsic surface brightness profiles ; more sophisticated codes such as budda and ( especially ) galfit provide a larger set of components , including some sophisticated ways of perturbing the components in the case of galfit .",
    "but if one wants to add completely new functions , this is not easy .",
    "( the case of mge is somewhat different , since it does not allow parametric functions at all . )    as an example of why one might want to do this , consider the case of edge - on ( or nearly edge - on ) disk galaxies .",
    "both budda and galfit include versions of the analytical solution for a perfectly edge - on , axisymmetric , radial - exponential disk of @xcite , with a @xmath1 function for the vertical light distribution . but real galaxy disks are not always perfectly edge - on , do not all have single - exponential radial structures , and their vertical structure may in some cases be better described by a sech or exponential profile , or something in between ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "various authors studying edge - on disks have suggested that models using radial profiles other than a pure exponential would be best fit via line - of - sight integration through 3d luminosity - density models ( e.g. , * ? ? ? * ; * ? ? ?",
    "* ; * ? ? ?",
    "more sophisticated approaches could even involve line - of - sight integrations that account for scattering and absorption by dust ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "another potential disadvantage of existing codes is that they rely on the gaussian approximation of poisson statistics for the fitting process .",
    "while this is eminently sensible for dealing with many ccd and near - ir images , it can in some cases produce biases when applied to images with low count rates ( see @xcite and section  [ sec : biases ] of this paper ) .",
    "this is why packages for fitting x - ray data , such as sherpa @xcite , often include alternate statistics for fits .    in this paper , i present imfit , a new , open - source image - fitting code designed to overcome some of the limitations mentioned above . in particular ,",
    "imfit uses an object - oriented design which makes it relatively easy to add new , user - designed image components ; it also provides multiple fitting algorithms and statistical approaches .",
    "it can also be extremely fast , since it is able to take advantage of multiple cpu cores on the same machine to execute calculations in parallel .",
    "the outline of this paper is as follows .",
    "section  [ sec : gen - outline ] provides a quick sketch of how the program works , while section  [ sec : modelimage ] details the process of generating model images and the configuration files which describe the models .",
    "the different underlying statistical models and minimization algorithms used in the fitting process are covered in section  [ sec : fitting ] ; methods for estimating confidence intervals for fitted parameters are discussed in section  [ sec : confidence - intervals ] . the default 2d image functions which can be used in models",
    "are presented in section  [ sec : image - funcs ] ; this includes functions which perform line - of - sight integration through 3d luminosity - density models ( section  [ sec : image - funcs-3d ] ) .",
    "after a brief discussion of coding details ( section  [ sec : programming ] ) , two examples of using imfit to model galaxy images are presented in section  [ sec : examples ] : the first involves fitting a moderately - inclined spiral galaxy with disk , bar , and ring components , while the second fits an edge - on spiral galaxy with thin and thick edge - on disk components .",
    "finally , section  [ sec : biases ] discusses possible biases to fitted parameters when the standard @xmath0 statistic is used in the presence of low - count images , using both model images and real images of elliptical galaxies .",
    "an appendix discusses the relative sizes and accuracies of parameter error estimates using the two methods available in imfit .    to avoid any confusion ,",
    "i note that the program described in this paper is unrelated to tasks with the same name and somewhat similar ( if limited ) functionality in pre - existing astronomical software , such as the `` imfit '' tasks in the radio - astronomy packages aips and miriad and the `` images.imfit '' package in iraf .",
    "imfit begins by processing command - line options and then reads in the data image , along with any optional , user - specified psf , noise , and mask images ( all in fits format ) .",
    "the configuration file is also read ; this specifies the model which will be fit to the data image , including initial parameter values and parameter limits , if any ( see section  [ sec : config - file ] ) .",
    "the program then creates an instance of the modelobject class , which holds the relevant data structures , instances of the image functions specified by the configuration file , and the general code necessary for computing a model image .",
    "if @xmath0 minimization ( the default ) is being done , a noise image is constructed , either from a user - specified fits file already read in or by internally generating one , assuming the gaussian approximation for poisson noise . the noise image is then converted to @xmath2 form and combined with the mask image , if any , to form a final weight image used for calculating the @xmath0 value . ( if model - based @xmath0 minimization has been specified , then the noise image , which is based on the model image , is recalculated and combined with the mask image every time a new model image is computed ; if a poisson maximum - likelihood statistic ( @xmath3 or pmlr ; see section  [ sec : poisson ] ) is being used for minimization , then no noise image is read or created and the weight image is constructed directly from the mask image .",
    "see section  [ sec : statistics ] for more on the different statistical approaches . )",
    "the actual fitting process is overseen by one of three possible nonlinear minimization algorithms , as specified by the user .",
    "these algorithms proceed by generating or modifying a set of parameter values and feeding these values to the aforementioned model object , which in turn calculates the corresponding model image , convolves it with the psf ( if psf convolution is part of the model ) , and then calculates the fit statistic ( e.g. , @xmath0 ) by comparing the model image with the stored data image .",
    "the resulting fit statistic is returned to the minimization algorithm , which then updates the parameter values and repeats the process according to the details of the particular method , until the necessary stop criterion is reached ",
    "e.g. , no further significant reduction in the fit statistic , or a maximum number of iterations .",
    "finally , a summary of the fit results is printed to the screen and saved to a file , along with any additional user - requested outputs ( final model image , final residual image , etc . ) .",
    "the model which will be fit to the data image is specified by a configuration file , which is a text file with a relatively simple and easy - to - read format ; see figure  [ fig : config - file ] for an example .",
    "the basic format for this file is a set of one or more `` function blocks '' , each of which contains a shared center ( pixel coordinates ) and one or more image functions .",
    "a function block can , for example , represent a single galaxy or other astronomical object , which itself has several individual components ( e.g. , bulge , disk , bar , ring , nucleus , etc . ) specified by the individual image functions .",
    "thus , for a basic bulge / disk decomposition the user could create a function block consisting of a single srsic function and a single exponential function .",
    "there is , however , no a priori association of any particular image function or functions with any particular galaxy component , nor is there any requirement that a single object must consist of only one function block .",
    "the final model is the sum of the contributions from all the individual functions in the configuration file .",
    "the number of image functions per function block is unlimited , and the number of function blocks per model is also unlimited .",
    "each image function is listed by name ( e.g. , `` ` function sersic ` '' ) , followed by the list of its parameters . for each parameter ,",
    "the user supplies an initial guess for the value , and ( optionally ) either a comma - separated , two - element list of lower and upper bounds for that parameter or the keyword `` fixed '' ( indicating that the parameter will remain constant during the fit ) .. ]    the total set of all individual image - function parameters , along with the central coordinates for each function block , constitutes the parameter vector for the minimization process .",
    "an image function can be thought of as a black box which accepts a set of parameter values for its general setup , and then accepts individual pixel coordinates @xmath4 and returns a corresponding computed intensity ( i.e. , surface brightness ) value for that pixel .",
    "the total intensity for a given pixel in the model image ( prior to any psf convolution ) is the sum of the individual values from each image function .",
    "this design means that the main program needs to know nothing about the individual image functions except the number of parameters they take , and which subset of the total parameter vector corresponds to a given image function .",
    "the actual calculations carried out by an image function can be as simple or as complex as the user requires , ranging from returning a constant value for each pixel ( e.g. , the flatsky function ) to performing line - of - sight integration through a 3d luminosity density model ( e.g. , the exponentialdisk3d function ) ; user - written image functions could even perform modest simulations in the setup stage .",
    "the list of currently available image functions , along with descriptions for each , is given in section  [ sec : image - funcs ] .",
    "to simulate the effects of atmospheric seeing and telescope optics , model images can be convolved with a psf image .",
    "the latter can be any fits file which contains the point spread function .",
    "psf images should ideally be square with sides measuring an odd number of pixels , with the peak of the psf centered in the central pixel of the image .",
    "( off - center psfs can be used , but the resulting convolved model images will of course be shifted . ) imfit automatically normalizes the psf image when it is read in .    the actual convolution follows the standard approach of using fast fourier transforms of the internally - generated model image and the psf image , multiplied together , with the output convolved model image being the inverse transform of the product image .",
    "the transforms are done with the fftw library (  fastest fourier transform in the west ",
    "* ) , which has the advantage of being able to perform transforms on images of arbitrary size ( i.e. , not just images with power - of - two sizes ) ; in addition , it is well - tested and fast , and can use multiple threads to take advantage of multiple processor cores .    to avoid possible edge effects in the convolution",
    ", the internal model - image array is expanded on all four sides by the width and height of the psf image , and all calculations prior to the convolution phase use this full ( expanded ) image .",
    "( for example , given a @xmath5-pixel data image and a @xmath6-pixel psf image , the internal model image would be @xmath7 pixels in size . )",
    "this ensures that model pixels corresponding to the edge of the data image are the result of convolution with an extension of the model , rather than with zero - valued pixels or the opposite side of the model image .",
    "this is in _ addition _ to the zero - padding applied to the top and right - hand sides of the model image during the convolution phase .",
    "( i.e. , the example @xmath7-pixel expanded model image would be zero - padded to @xmath8 pixels before computing its fourier transform , to match with the zero - padded psf image of the same size . )    [ [ makeimage - generating - model - images - without - fitting ] ] make pixels ) .",
    "although analytic expressions for total flux exist for some common components , this is not true for all components  and one of the goals of imfit is to allow users to create and use new image functions without worrying about whether they have simple analytic expressions for the total flux .",
    "this mode can be used to help determine such things as bulge / total and other ratios after a fit is found , although it is up to the user to decide which of the components is the `` bulge '' , which is the `` disk '' , and so forth .",
    "given a vector of parameter values @xmath9 , a model image is generated with per - pixel predicted data values @xmath10 , which are then compared with the _ observed _ per - pixel data values @xmath11 .",
    "the goal is to find the @xmath9 which produces the best match between @xmath10 and @xmath11 , subject to the constraints of the underlying statistical model .",
    "the usual approach is based on the maximum - likelihood principle ( which can be derived from a bayesian perspective if , e.g. , one assumes constant priors for the parameter values ) , and is conventionally known as maximum - likelihood estimation ( mle ; e.g. , * ? ? ?",
    "* ) . to start , one considers the per - pixel likelihood @xmath12 , which is the probability of observing @xmath11 given the model prediction @xmath10 and the underlying statistical model for how the data are generated .",
    "the goal then becomes finding the set of model parameters which maximizes the total likelihood @xmath13 , which is simply the product over all @xmath14 pixels of the individual per - pixel likelihoods : @xmath15 it is often easier to work with the logarithm of the total likelihood , since this converts a product over pixels into a sum over pixels , and can also simplify the individual per - pixel terms . as most nonlinear optimization algorithms are designed to _ minimize _ their objective function , one can use the _ negative _ of the log - likelihood .",
    "thus , the goal of the fitting process becomes minimization of the following : @xmath16 during the actual minimization process , this can often be further simplified by dropping any additive terms in @xmath17 which do not depend on the model , since these are unaffected by changes in the model parameters and are thus irrelevant to the minimization .",
    "in some circumstances , multiplying the negative log - likelihood by 2 produces a value which has the property of being distributed like the @xmath0 distribution ( e.g. , * ? ? ? * and references therein ) ; thus , it is conventional to treat @xmath18 as the statistic to be minimized .",
    "the data in astronomical images typically consist of detections of individual photons from the sky + telescope system ( including photons from the source , the sky background , and possibly thermal backgrounds in the telescope ) in individual pixels , combined with possible sources of noise due to readout electronics , digitization , etc .",
    "photon - counting statistics obey the poisson distribution , where the probability of detecting @xmath19 photons per integration , given a true rate of @xmath20 , is @xmath21[eq : poisson ]    additional sources of ( additive ) noise such as read noise tend to follow gaussian statistics with a mean of 0 and a dispersion of @xmath22 , so that the probability of measuring @xmath23 counts after the readout process , given an input of @xmath19 counts from the poisson process , is @xmath24.\\ ] ]    the general case for most astronomical images thus involves both poisson statistics ( for photon counts ) and gaussian statistics ( for read noise and other sources of additive noise ) .",
    "unfortunately , even though the individual elements are quite simple , the combination of a gaussian process acting on the output of a poisson process leads to the following rather frightening per - pixel likelihood ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) : @xmath25 the resulting negative log - likelihood for the total image ( dropping terms which do not depend on the model ) is @xmath26 \\right).\\ ] ] since this still contains an infinite series of exponential and factorial terms , it is clearly rather impractical for fitting images rapidly .      fortunately , there is a way out which is often ( though not always ) appropriate astronomical images .",
    "this is to use the fact that the poisson distribution approaches a gaussian distribution when the counts become large . in this approximation",
    "the poisson distribution is replaced by a gaussian with @xmath27 .",
    "it is customary to assume this is valid when the counts are @xmath28 per pixel ( e.g. , * ? ? ?",
    "* ) , though @xcite point out that biases in the fitted parameters can be present even when counts are higher than this ; see section  [ sec : biases ] for examples in the case of 2d fits .",
    "since the contribution from read noise is also nominally gaussian , the two can be added in quadrature , so that the per - pixel likelihood function is just @xmath29,\\ ] ] where @xmath30 , with @xmath31 being the dispersion of the read - noise term .",
    "twice the negative log - likelihood of the total problem then becomes ( dropping terms which do not depend on the model ) the familiar @xmath0 sum : @xmath32    this is the default approach used by imfit : minimizing the @xmath0 as defined in eqn .",
    "[ eqn : chi2 ] .",
    "the approximation of the poisson contribution to @xmath33 is based on the model intensity @xmath10 .",
    "traditionally , it is quite common to estimate this from the _ data _ instead , so that @xmath34 .",
    "this has the nominal advantage of only needing to be calculated once , at the start of the minimization process , rather than having to be recalculated every time the model is updated .",
    "values is often negligible .",
    "] however , the bias resulting from using data - based errors in the low - count regime can be worse than the bias introduced by using model - based @xmath33 values ( see section  [ sec : biases ] ) .",
    "both approaches are available in imfit , with data - based @xmath33 estimation being the default .",
    "the data - based and model - based approaches are often referred to as `` neyman s @xmath0 '' and `` pearson s @xmath0 '' , respectively ; in this paper i use the symbols @xmath35 and @xmath36 to distinguish between them .    in the case of `` error '' images generated by a data - processing pipeline , the corresponding @xmath33 or @xmath37 ( variance ) values can easily be used in equation  [ eq : chi2 ] directly , under the assumption that the final per - pixel error distributions are still gaussian .",
    "so why not always use the gaussian @xmath0 approximation , as is done in most image - fitting packages ?    in the absence of any noise terms except poisson statistics",
    " something often true of high - energy detectors , such as x - ray imagers  the individual - pixel likelihoods are just the probabilities of a poisson process with mean @xmath10 , where the probability of recording @xmath11 counts is @xmath38 this leads to a very simple version of the negative log - likelihood , often referred to as the `` cash statistic '' @xmath3 , after its derivation in @xcite : @xmath39 where the factorial term has been dropped because it does not depend on the model .    a useful alternative is to construct a statistic from the likelihood ratio test  that is , a maximum likelihood ratio ( mlr ) statistic  which is the ratio of the likelihood to the maximum possible likelihood for a given dataset . in the case of poisson likelihood , the latter is the likelihood when the model values are exactly equal to the data values @xmath40",
    "( e.g. , * ? ? ?",
    "* ) , and so the likelihood ratio @xmath41 is @xmath42 and the negative log - likelihood version ( henceforth pmlr ) is @xmath43 ( this is the same as the `` cstat '' statistic available in the sherpa x - ray analysis package and the `` poisson likelihood ratio '' described by @xcite . ) comparison with equation  [ eq : cashstat ] shows that pmlr is identical to @xmath3 apart from terms which depend on the data only and thus do not affect the minimization . in the remainder of this paper , i will refer to @xmath3 and pmlr collectively as _ poisson mle _ statistics .",
    "since minimizing pmlr will produce the same best - fitting parameters as minimizing @xmath3 , one might very well wonder what is the point in introducing pmlr .",
    "there are two practical advantages in using it .",
    "the first is that in the limit of large @xmath14 , @xmath44 statistics such as pmlr approach a @xmath0 distribution and can thus be used as goodness - of - fit indicators @xcite .",
    "the second is that they are always @xmath45 ( since @xmath41 itself is by construction always @xmath46 ) ; this means they can be used with fast least - squares minimization algorithms .",
    "this is the practical drawback to minimizing @xmath3 : unlike pmlr , it can often have negative values , and thus requires one of the slower minimization algorithms .    @xcite point out that using a poisson mle statistic ( e.g. , @xmath3 ) is preferable to using @xmath35 or @xmath36 even when the counts are above the nominal limit of @xmath47 per pixel , since fitting pure - poisson data using the @xmath35 or @xmath36 gaussian approximations can lead to biases in the derived model parameters .",
    "section  [ sec : biases ] presents some examples of this effect using both artificial and real galaxy images , and shows that the effect persists even when moderate ( gaussian ) read noise is _ also _ present .",
    "using a poisson mle statistic such as @xmath3 or pmlr is also appropriate when fitting simulated images , such as those made from projections of @xmath14-body models , as long as the units are particles per pixel or something similar .",
    "for convenience , table  [ tab : terminology ] summarizes the main symbols and terms from this section which are used elsewhere in the paper .",
    "ll poisson mle & maximum - likelihood estimation based on poisson statistics + & ( includes both @xmath3 and pmlr ) + @xmath3 & poisson mle statistic from @xcite + pmlr & poisson mle statistic from maximum likelihood ratio + @xmath35 & gaussian mle statistic using data pixel values for @xmath22 + & ( `` neyman s @xmath0 '' ) + @xmath36 & gaussian mle statistic using model pixel values for @xmath22 + & ( `` pearson s @xmath0 '' ) +      imfit s default behavior , as mentioned above , is to use @xmath0 as the statistic for minimization .",
    "to do so , the individual , per - pixel gaussian errors @xmath33 must be available .",
    "if a separate error or noise map is not supplied by the user ( see below ) , imfit estimates @xmath33 values from either the data values or the model values , using the gaussian approximation to poisson statistics .",
    "to ensure this estimate is as accurate as possible , the data or model values @xmath48 must at some point be converted from counts to actual detected photons ( e.g. , photoelectrons ) , and any previously subtracted background must be accounted for .    by default , imfit estimates the @xmath33 values from the data image by including the effects of a / d gain , prior subtraction of a ( constant ) background , and read noise . rather than converting the image to electrons pixel@xmath49 and then estimating the @xmath22 values , imfit generates @xmath22 values in the same units as the input ] [ eqn : error - est ] where @xmath50 is the data intensity in counts pixel@xmath49 , @xmath51 is any pre - subtracted sky background in the same units , @xmath52 is the read noise in electrons , @xmath53 is the number of separate images combined ( averaged or median ) to form the data image , and @xmath54 is the `` effective gain '' ( the product of the @xmath55 gain , @xmath53 , and optionally the exposure time if the image pixel values are actually in units of counts s@xmath49 pixel@xmath49 rather than integrated counts pixel@xmath49 ) .",
    "if model - based @xmath0 minimization is used , then model intensity values @xmath56 are used in place of @xmath50 in equation  [ eqn : error - est ] . in this case",
    ", the @xmath57 values must be recomputed each time a new model image is generated , though in practice this adds very little time to the overall fitting process .",
    "if a mask image has been supplied , it is converted internally so that its pixels have values @xmath58 for valid pixels and @xmath59 for bad pixels",
    ". then the mask values are divided by the variances to form a weight - map image , where individual pixels have values of @xmath60 .",
    "these weights are then used for the actual @xmath0 calculation : @xmath61    instead of data - based or model - based errors , the user can also supply an error or noise map in the form of a fits image , such as might be produced by a reduction pipeline .",
    "the individual pixel values in this image can be gaussian errors , variances ( @xmath62 ) , or even pre - computed weight values @xmath63 .",
    "in the case of cash - statistic minimization , the sum @xmath3 is computed directly based on equation  [ eq : cashstat ] ; for pmlr minimization , equation  [ eq : pmlr ] is used .",
    "the `` weight map '' in either case is then based directly on the mask image , if any ( so all pixels in the resulting weight map have values of @xmath59 or 1 ) .",
    "the actual minimized quantities are thus @xmath64 and @xmath65 with @xmath66 and @xmath67 .",
    "the default minimization algorithm used by imfit is a robust implementation of the levenberg - marquardt ( l - m ) gradient search method @xcite , based on the minpack-1 version of @xcite and modified by craig markwardt @xcite , ] which includes optional lower and upper bounds on parameter values .",
    "this version of the basic l - m algorithm also includes auxiliary code for doing numerical differentiation of the objective function , and thus the various image functions do not need to provide their own derivatives , which considerably simplifies things when it comes to writing new functions .",
    "the l - m algorithm has the key advantage of being very fast , which is a useful quality when one is fitting large images with a complex set of functions and psf convolution .",
    "it has the minor disadvantage of requiring an initial starting guess for the parameter values , and it has two more significant disadvantages .",
    "the first is that like gradient - search methods in general it is prone to becoming trapped in local minima in the objective - function landscape .",
    "the second is that it is designed to work with least - squares objective functions , where the objective function values are assumed to be always @xmath45 .",
    "in fact , the l - m algorithm makes use of a vector of the individual contributions from each pixel to the total @xmath0 , and these values as well ( not just the sum ) must be nonnegative . for the @xmath0 case ,",
    "this is always true ; but this is _ not _ guaranteed to be true for the cash statistic @xmath3 .",
    "thus , it would be quite possible for the l - m minimizer to fail to find the best - fitting solution for a particular image , simply because the solution has a @xmath3 value @xmath68 .",
    "( fortunately , minimizing pmlr leads to the same solution as minimizing @xmath3 , and the individual terms of pmlr are always nonnegative . )",
    "a second , more general algorithm available in imfit is the nelder - mead simplex method @xcite , with constraints as suggested by @xcite , implemented in the nlopt library . like the l - m algorithm , this method requires an initial guess for the parameter set ; it also includes optional parameter limits .",
    "unlike the l - m algorithm , it works only with the final objective function value and does not assume that this value must be nonnegative ; thus , it is suitable for minimizing all the fit statistics used by imfit .",
    "it is also as a rule less likely to be caught in local minima than the l - m algorithm .",
    "the _ disadvantage _ is that it is considerably _ slower _ than the l - m method  roughly an order of magnitude so .",
    "a third alternative provided by imfit is a genetic - algorithms approach called differential evolution ( de ; * ? ? ? * ) .",
    "this searches the objective - function landscape using a population of parameter - value vectors ; with each `` generation '' , the population is updated by mutating and recombining some of the vectors , with new vectors replacing older vectors if they are better - performing .",
    "de is designed to be  in the context of genetic algorithms  fast and robust while keeping the number of adjustable _ algorithm _ parameters ( e.g. , mutation and crossover rates ) to a minimum .",
    "it is the least likely of the algorithms used by imfit to become trapped in a local minimum in the objective - function landscape : rather than starting from a single initial guess for the parameter vector , it begins with a set of randomly generated initial - parameter values , sampled from the full range of allowed parameter values ; in addition , the crossover - with - mutation used to generate new parameter vectors for successive generations helps the algorithm avoid local minima traps .",
    "thus , in contrast to the other algorithms , it does not require any initial guesses for the parameter values , but _ does _ require lower and upper limits for all parameters .",
    "it is definitely the _",
    "slowest _ of the minimization choices : about an order of magnitude slower than the n - m simplex , and thus roughly _ two _ orders of magnitude slower than the l - m algorithm .",
    "the current implementation of de in imfit uses the `` de / rand - to - best/1/bin '' internal strategy , which controls how mutation and crossover are done @xcite , along with a population size of 10 parameter vectors per free parameter .",
    "since the basic de algorithm has no default stop conditions , imfit halts the minimization when the best - fitting value of the fit statistic has ceased to change by more than a specified tolerance after 30 generations , or when a maximum of 600 generations is reached .      for most purposes , the default l - m method",
    "is probably the best algorithm to use , since it is fast enough to make exploratory fitting ( varying the set of functions used , applying different parameter limits , etc . ) feasible , and also fast enough to make fitting large numbers of individual objects in a reasonable time possible .",
    "if the problem is relatively small ( modest image size , few image functions ) and the user is concerned about possible local minima , then the n - m simplex or even the de algorithm can be used .",
    "table  [ tab : minimizers ] provides a general comparison of the different minimization algorithms , including the time taken for each to find the best fit for a very simple case : a @xmath69-pixel cutout of an sdss @xmath70-band image of the galaxy ic  3478 , fit with a single srsic function and convolved with a @xmath71-pixel psf image . for this simple case",
    ", the n - m approach takes @xmath72 times as long as the l - m method , and the de algorithm takes @xmath73 _ 60 _ times as long .",
    "( all three algorithms converged to the same solution , so there was no disadvantage to using the l - m method in this case . )",
    "llllllr levenberg - marquardt ( l - m ) & yes & no & high & no & fast & 2.2s + nelder - mead simplex ( n - m ) & yes & no & medium & yes & slow & 9.1s + differential evolution ( de ) & no & yes & low & yes & very slow & 2m15s",
    "+      when imfit finishes , it outputs the parameters of the best fit ( along with possible confidence intervals ; see section  [ sec : confidence - intervals ] ) to the screen and to a text file ; it also prints the final value of the fit - statistic . the best - fitting model image and the residual ( data @xmath74 model ) image",
    "can optionally be saved to fits files as well .    for fits which minimize @xmath0",
    ", imfit also prints the _ reduced _",
    "@xmath0 value , which can be used ( with caution ) as an indication of the goodness of the fit .",
    "( the best - fit value of pmlr can also be converted to a reduced-@xmath0 equivalent with the same properties . ) for fits which minimize the cash statistic , there is no direct equivalent to the reduced @xmath0 ; the actual value of the cash statistic does not have any directly useful meaning by itself .",
    "all the fit statistics ( including @xmath3 ) can also be used to derive comparative measures of how well _ different _ models fit the same data . to this end ,",
    "imfit computes two likelihood - based quantities which can be used to compare different models .",
    "the first is the akaike information criterion ( aic , @xcite ) , which is based on an information - theoretic approach .",
    "imfit uses the recommended , bias - corrected version of this statistic : @xmath75 where @xmath13 is the likelihood value , @xmath76 is the number of ( free ) parameters in the model and @xmath77 is the number of data points .",
    "the second quantity is the bayesian information criterion ( bic , @xcite ) , which is @xmath78 when two or more models fit to the same data are compared , the model with the _ lowest _ aic ( or bic ) is preferred , though a difference @xmath79aic or @xmath79bic of at least @xmath80 is usually required before one model can be deemed clearly superior ( or inferior ) ; see , e.g. , @xcite and @xcite for discussions of aic and bic in astronomical contexts , and @xcite for more general background .",
    "needless to say , all models being compared in this manner should be fit by minimizing the same fit statistic .",
    "in addition to its speed , the levenberg - marquardt minimization algorithm has the convenient advantage that it can automatically produce a set of approximate , 1-@xmath22 confidence intervals for the fitted parameters as a side product of the minimization process ; this comes from inverting the hessian matrix computed during the minimization process ( see , e.g. , section 15.5 of * ? ? ? * ) .",
    "the other minimization algorithms available in imfit do not compute confidence intervals .",
    "although one can , as a workaround , re - run imfit using the l - m algorithm on a solution that was found using one of the other algorithms , this will not work if @xmath3 ( rather than @xmath0 or pmlr ) was being minimized ( see section  [ sec : minimization ] ) .",
    "an alternate method of estimating confidence intervals is provided by bootstrap resampling @xcite .",
    "each iteration of the resampling process generates a new data image by sampling pixel values , with replacement , from the original data image .",
    "( what is actually generated inside imfit is a resampled vector of pixel _ indices _ into the image , excluding those indices corresponding to masked pixels ; the corresponding @xmath81 coordinates and intensities then form the resampled data . ) the fit is then re - run with the best - fit parameters from the original fit as starting values , using the l - m algorithm for @xmath0 and pmlr minimization cases and the n - m simplex algorithm when @xmath3 minimization is being done .",
    "after @xmath77 iterations , the combined set of bootstrapped parameter values is used as the distribution of parameter values , from which properly asymmetric 68% confidence intervals are directly determined , along with the standard deviation .",
    "( the 68% confidence interval corresponds to @xmath82-@xmath22 if the distribution is close to gaussian . )    in addition , the full set of best - fit parameters from all the bootstrap iterations can optionally be saved to a file , which potentially allows for more sophisticated analyses .",
    "figure  [ fig : bootstrap ] shows a scatter - plot matrix comparing parameter values for five parameters of a simple srsic fit to an image of a model srsic galaxy with noise ( see section  [ sec : biases ] for details of the model images ) .",
    "one can see that the distributions are approximately gaussian , have dispersions similar to those from the l - m estimates ( plotted as gaussians using red curves ) , and also that certain parameter distributions are _ correlated _",
    "( e.g. , @xmath77 and @xmath83 or , more weakly , ellipticity @xmath84 and @xmath83 ) .",
    "of course , this simple case ignores the complexities and sources of error involved in fitting real images of galaxies ; see the appendix for sample comparisons of l - m and bootstrap error estimates for a small set of real - galaxy images .",
    "the only drawback of the bootstrap - resampling approach is the cost in time .",
    "since bootstrap resampling should ideally use a minimum of several hundred to one thousand or more iterations , one ends up , in effect , re - running the fit that many times .",
    "( some time is saved by starting each fit with the original best - fit parameter values , since those will almost always be close to the best - fit solution for the resampled data . )     from the levenberg - marquardt output of the original fit ( thin red curves ) .",
    "vertical solid gray lines show the parameter values from the fit to the original image ; vertical dashed gray lines show the true parameters of the original model.[fig : bootstrap ] ]",
    "image functions are implemented in imfit as subclasses of an abstract base class called functionobject .",
    "the rest of the program does not need to know the details of the individual functions , only that they adhere to the functionobject interface .",
    "this makes it relatively simple to add new image functions to the program : write a header file and an implementation file for the new function , add a reference to it in another source file , and recompile the program .",
    "further notes on how to do this are included in the documentation .",
    "this section describes the various default image functions that come with imfit .",
    "specifications for the actual parameters ( e.g. , the order that imfit expects to find them in ) are included in the documentation , and a summary of all available function names and their corresponding parameter lists can be printed using the ` --list - parameters ` command - line flag .      most image functions , unless otherwise noted , have two `` geometric '' parameters : the position angle pa in degrees counter - clockwise from the vertical axis of the image and the ellipticity @xmath85 , where @xmath86 and @xmath87 are the semi - major and semi - minor axes , respectively .    in most cases",
    ", the image function internally converts the ellipticity to an axis ratio @xmath88 ( @xmath89 ) and the position angle to an angle relative to the image @xmath19-axis @xmath90 ( @xmath91 ) , in radians .",
    "then for each input pixel ( or subpixel if pixel subsampling is being done ) with image coordinates @xmath92 a scaled radius is computed as @xmath93 where @xmath94 and @xmath95 are coordinates in the reference frame centered on the image - function center @xmath96 and rotated to its position angle : @xmath97 this scaled radius is then used to compute the actual intensity , using the appropriate 1-d intensity function ( see descriptions of individual image functions , below ) .",
    "pure circular versions of any of these functions can be had by specifying that the ellipticity parameter is fixed , with a value of 0 .",
    "some functions ( e.g. , edgeondisk ) have only the position angle as a geometric parameter , and instead of computing a scaled radius , convert the pixel coordinates to corresponding @xmath70 and @xmath98 values in the rotated 2d coordinate system of the model function .",
    "this is a very basic function which produces a uniform background : @xmath99 for all pixels . unlike most image functions",
    ", it has _ no _ geometric parameters .",
    "this is an elliptical 2d gaussian function , with central surface brightness @xmath100 and dispersion @xmath22 .",
    "the intensity profile is given by @xmath101      this is an elliptical 2d function with a @xcite function for the surface brightness profile , with parameters for the central surface brightness @xmath100 , full - width half - maximum ( fwhm ) , and the shape parameter @xmath102 .",
    "the intensity profile is given by @xmath103 where @xmath104 is defined as @xmath105 in practice , fwhm describes the overall width of the profile , while @xmath102 describes the strength of the wings : lower values of @xmath102 mean more intensity in the wings than is the case for a gaussian ( as @xmath106 , the moffat profile converges to a gaussian ) .",
    "the moffat function is often a good approximation to typical telescope psfs ( see , e.g. , @xcite ) , and makeimage can easily be used to generate moffat psf images .",
    "the exponential function is an elliptical 2d exponential function , with parameters for the central surface brightness @xmath100 and the exponential scale length @xmath107 .",
    "the intensity profile is given by @xmath108 together with the position angle and ellipticity , there are a total of four parameters .",
    "this is a good default for galaxy disks seen at inclinations @xmath109 , though the majority of disk galaxies have profiles which are more complicated than a simple exponential ( e.g. , * ? ? ?",
    "the exponential_genellipse function is identical to the exponential function except for allowing the use of generalized ellipses ( with shapes ranging from `` disky '' to pure elliptical to `` boxy '' ) for the isophote shapes .",
    "following @xcite and @xcite , the shape of the elliptical isophotes is controlled by the @xmath110 parameter , such that a generalized ellipse with ellipticity @xmath111 is described by @xmath112 where @xmath113 and @xmath114 are distances from the ellipse center in the coordinate system aligned with the ellipse major axis ( @xmath110 corresponds to @xmath115 in the original formulation of athanassoula et al . ) .",
    "thus , values of @xmath116 correspond to disky isophotes , while values @xmath117 describe boxy isophotes ; @xmath118 for a perfect ellipse .",
    "this pair of related functions is analogous to the exponential and exponential_genellipse pair above , except that the intensity profile is given by the @xcite function : @xmath119 \\right\\},\\ ] ] where @xmath120 is the surface brightness at the effective ( half - light ) radius @xmath83 and @xmath77 is the index controlling the shape of the intensity profile .",
    "the value of @xmath121 is formally given by the solution to the transcendental equation @xmath122 where @xmath123 is the gamma function and @xmath124 is the incomplete gamma function .",
    "however , in the current implementation @xmath121 is calculated via the polynomial approximation of @xcite when @xmath125 and the approximation of @xcite when @xmath126 .",
    "the srsic profile is equivalent to the de vaucouleurs ( @xmath127 ) profile when @xmath128 , to an exponential when @xmath129 , and to a gaussian when @xmath130 ; it has become the de facto standard for fitting the surface - brightness profiles of elliptical galaxies and bulges .",
    "though the empirical justification for doing so is rather limited , the combination a srsic profile with @xmath131 and isophotes with a boxy shape is often used to represent bars when fitting images of disk galaxies .",
    "in addition , the combination of boxy isophotes and high @xmath77 values may be appropriate for modeling luminous boxy elliptical galaxies .",
    "this function generates an elliptical 2d function where the major - axis intensity profile is given by the core - srsic model @xcite , which was designed to fit the profiles of so - called `` core '' galaxies ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "it consists of a srsic profile ( parameterized by @xmath77 and @xmath83 ) for radii @xmath132 the break radius @xmath133 and a single power law with index @xmath134 for radii @xmath135 .",
    "the transition between the two regimes is mediated by the dimensionless parameter @xmath104 : for low values of @xmath104 , the transition is very gradual and smooth , while for high values of @xmath104 the transition becomes very abrupt ( a perfectly sharp transition can be approximated by setting @xmath104 equal to some large number , such as 100 ) .",
    "the intensity profile is given by @xmath136^{\\gamma/\\alpha } \\exp \\left [ -b \\left ( \\frac{r^\\alpha+r_b^\\alpha}{r_e^\\alpha } \\right)^{1/(n\\alpha ) } \\right],\\ ] ] where @xmath87 is the same as @xmath121 for the srsic function .",
    "the overall intensity scaling is set by @xmath137 , the intensity at the break radius @xmath133 : @xmath138.\\ ] ]      this is similar to the exponential function , but it has _ two _ exponential radial zones ( with different scalelengths ) joined by a transition region at @xmath139 of variable sharpness : @xmath140^{\\frac{1}{\\alpha } ( \\frac{1}{h_{1 } } \\ , - \\ , \\frac{1}{h_{2}})},\\ ] ] where @xmath100 is the central intensity of the inner exponential , @xmath141 and @xmath142 are the inner and outer exponential scale lengths , @xmath139 is the break radius , and @xmath104 parameterizes the sharpness of the break .",
    "low values of @xmath104 mean very smooth , gradual breaks , while high values correspond to abrupt transitions .",
    "@xmath143 is a scaling factor , given by @xmath144 see figure",
    "[ fig : brokenexp ] for examples .",
    "note that the parameter @xmath104 has units of length@xmath49 ( pixels@xmath49 for the specific case of imfit ) .",
    "the 1d form of this profile @xcite was designed to fit the surface - brightness profiles of disks which are not single - exponential : e.g. , disks with truncations or antitruncations @xcite .     and",
    "@xmath145 pixels , respectively , break radius = 6 pixels , and varying values of @xmath104 ( black = 100 , medium gray = 3 , light gray = 1 ) .",
    "the lower ( dashed ) curves show the effects of varying the outer scale length only ( @xmath146 , 3 , 2 pixels).[fig : brokenexp ] ]      this function creates an elliptical ring with a gaussian radial profile , centered at @xmath147 along the major axis .",
    "see figure  [ fig : rings ] for an example .",
    "this function is similar to gaussianring , except that it uses an asymmetric gaussian , with different values of @xmath22 for @xmath149 and @xmath150 ) .",
    "that is , the profile behaves as @xmath151 for @xmath152 , and @xmath153 for @xmath154 ; see figure  [ fig : rings ] for an example .     pixels .",
    "the larger , rounder ring is an example of the gaussianring2side function , with an ellipticity of 0.1 , a semi - major axis of 160 pixels , @xmath155 pixels , and @xmath156 pixels .",
    "[ fig : rings ] ]      this function provides the analytic form for a perfectly edge - on disk with a radial exponential profile , using the bessel - function solution of @xcite for the radial profile . although it is common to assume that the vertical profile for galactic disks follows a @xmath157 function , based on the self - gravitating isothermal sheet model of @xcite , @xcite suggested a more generalized form for this , one which enables the profile to range from @xmath157 at one extreme to exponential at the other : @xmath158 with @xmath98 the vertical coordinate and @xmath159 the vertical scale height .",
    "the parameter @xmath77 produces a @xmath1 profile when @xmath129 , @xmath160 when @xmath161 , and converges to an exponential as @xmath162 .",
    "see @xcite for examples of fitting the vertical profiles of edge - on galaxy disks using this formula , and @xcite for examples of 2d fitting of edge - on galaxy images .    in a coordinate system aligned with the edge - on disk",
    ", @xmath70 is the distance from the minor axis ( parallel to the major axis ) and @xmath98 is the perpendicular direction , with @xmath163 on the major axis .",
    "( the latter corresponds to height @xmath98 from the galaxy midplane . )",
    "the intensity at @xmath164 is given by @xmath165 where @xmath107 is the exponential scale length in the disk plane , @xmath159 is the vertical scale height , and @xmath166 is the modified bessel function of the second kind .",
    "the central surface brightness @xmath167 is given by @xmath168 where @xmath169 is the central luminosity _ density _ ( see @xcite ) .",
    "note that @xmath169 is the actual input parameter required by the function ; @xmath167 is calculated internally .",
    "the result is a function with five parameters : @xmath169 , @xmath107 , @xmath170 , @xmath77 , and the position angle ; figure  [ fig : edgeondisk ] shows three examples with differing vertical profiles parameterized by @xmath129 , 2 , and 100 .",
    "this is a simplistic model for an edge - on ring , using two offset subcomponents located at distance @xmath171 from the center of the function block .",
    "each subcomponent ( i.e. , each side of the ring ) is a 2d gaussian with central surface brightness @xmath100 and dispersions of @xmath172 in the radial direction and @xmath173 in the vertical direction .",
    "it has five parameters : @xmath100 , @xmath171 , @xmath172 , @xmath173 , and the position angle .",
    "see figure  [ fig : edgeonring ] for examples of this function .    a potentially more correct ( though computationally more expensive ) model for a ring seen edge - on ring  or at other inclinations  is provided by the gaussianring3d function , below .",
    "this is a slightly more sophisticated variant of edgeonring , where the radial profile for the two components is an asymmetric gaussian , as in the case of the gaussianring2side function , above : the inner ( @xmath174 ) side of each component is a gaussian with radial dispersion @xmath175 , while the outer side has radial dispersion @xmath176 .",
    "it thus has six parameters : @xmath100 , @xmath171 , @xmath175 , @xmath176 , @xmath173 , and the position angle .",
    "see the right - hand panel of figure  [ fig : edgeonring ] for an example .",
    "all image functions in imfit produce 2d surface - brightness output .",
    "however , there is nothing to prevent one from creating a function which does something quite complicated in order to produce this output . as an example",
    ", imfit includes three image functions which perform line - of - sight integration through 3d luminosity - density models , in order to produce a 2d projection .",
    "these functions assume a symmetry plane ( e.g. , the disk plane for a disk galaxy ) which is inclined with respect to the line of sight ; the inclination is defined as the angle between the line of sight and the normal to the symmetry plane , so that a face - on system has @xmath177 and an edge - on system has @xmath178 . for inclinations @xmath179 , the orientation of the line of nodes ( the intersection between the symmetry plane and the sky plane ) is specified by a position - angle parameter @xmath90 . instead of a 2d surface - brightness specification ( or 1d radial surface - brightness profile ) , these functions specify a 3d luminosity density @xmath180 , which is numerically integrated along the line of sight @xmath181 for each pixel of the model ]    to carry out the integration for a pixel located at @xmath4 in the image plane , the coordinates are first transformed to a rotated image plane system @xmath182 centered on the coordinates of the component center @xmath96 , where the line of nodes lies along the @xmath94 axis ( cf .",
    "[ eqn : xy ] in section  [ sec:2d ] ) : @xmath183 with @xmath90 being the angle between the line of nodes and the image @xmath184 axis ( as in the case of the 2d functions , the actual user - specified parameter is @xmath185 , which is the angle between the line of nodes and the @xmath186 axis ) .",
    "the line - of - sight coordinate @xmath181 is then defined so that @xmath187 in the sky plane ( an instance of the image plane located in 3d space so that it passes through the center of the component ) , corresponding to @xmath188 in the component s native @xmath189 cartesian coordinate system .",
    "a location at @xmath181 along the line of sight then maps into the component coordinate system as @xmath190 with @xmath191 by construction .",
    "the luminosity - density value is then @xmath192 .",
    "see figure  [ fig:3d - integration ] for a side - on view of this arrangement .",
    "although a fully correct integration would run from @xmath193 to @xmath194 , in practice the limit @xmath143 is some large multiple of the component s normal largest scale size ( e.g. , 20 times the horizontal disk scale length @xmath107 ) , to limit the possibility of numerical integration mishaps .     with respect to the line of sight , with the line of nodes rotated to lie along the sky - plane @xmath94 axis , perpendicular to the page ;",
    "the disk center is by construction at the intersection of the disk plane and the sky plane . for a pixel with sky - plane coordinates @xmath182 , the luminosity - density is integrated along the line of sight ( variable @xmath181 , with @xmath187 at the sky plane ) . for each value of @xmath181 used by the integration routine ,",
    "the luminosity density is computed based on the corresponding values of radius @xmath195 and height @xmath196 in the disk s native coordinate system .",
    "[ fig:3d - integration ] ]      this function implements a 3d luminosity density model for an axisymmetric disk where the radial profile of the luminosity density is an exponential and the vertical profile follows the @xmath197 function of @xcite ( see the discussion of the edgeondisk function in section  [ sec : edgeondisk ] ) .",
    "the line - of - sight integration is done numerically , using functions from the gnu scientific library .    in a cylindrical coordinate system",
    "@xmath198 aligned with the disk ( where the disk midplane has @xmath163 ) , the luminosity density @xmath199 at radius @xmath70 from the central axis and at height @xmath98 from the midplane is given by @xmath200 where @xmath107 is the exponential scale length in the disk plane , @xmath159 is the vertical scale height , @xmath77 controls the shape of the vertical distribution , and @xmath201 is the central luminosity density .",
    "note that in the context of the introductory discussion above , @xmath202 and @xmath195 .",
    "figure  [ fig : expdisk3d ] shows three views of the same model , at inclinations of 75 , 85 , and 89 ; the latter is almost identical to the image produced by the analytic edgeondisk with the same radial and vertical parameters ( right - hand panel of figure  [ fig : edgeondisk ] ) .",
    "this function is identical to the exponentialdisk3d function , except that the radial part of the luminosity density function is given by the broken - exponential profile used by the ( 2d ) brokenexponential function , above ( section  [ sec : brokenexp ] ) .",
    "thus , the luminosity density @xmath199 at radius @xmath70 from the central axis and at height @xmath98 from the midplane is given by @xmath203 where @xmath159 is the vertical scale height , and the radial part is given by @xmath204^{\\frac{1}{\\alpha } ( \\frac{1}{h_{1 } } \\ , - \\ , \\frac{1}{h_{2}})},\\ ] ] with @xmath201 being the central luminosity density and the rest of the parameters as defined for brokenexponential function ( section  [ sec : brokenexp ] ) .",
    "this function creates the projection of a 3d elliptical ring , seen at an arbitrary inclination .",
    "the ring has a luminosity density with a radial gaussian profile ( centered at @xmath205 along ring s major axis , with in - plane width @xmath22 ) and a vertical exponential profile ( with scale height @xmath206 ) .",
    "the ring can be imagined as residing in a plane which has its line of nodes at angle @xmath90 and inclination @xmath207 ( as for the exponentialdisk3d function , above ) ; within this plane , the ring s major axis is at position angle @xmath208 relative to the perpendicular to the line of nodes . to derive the correct luminosity densities for the line - of - sight integration ,",
    "the component coordinate values @xmath209 from equation  [ eqn:3d ] are transformed to a system rotated about the normal to the ring plane , where the ring s major axis is along the @xmath210 axis : @xmath211    figure  [ fig : ring3d ] shows the same gaussianring3d component ( with ellipticity = 0.5 ) seen at three different inclinations .",
    "imfit is written in standard c++ , and should be compilable with any modern compiler ; it has been tested with gcc versions 4.2 and 4.8 on mac  os  x and gcc version 4.6 on ubuntu linux systems .",
    "it makes use of several open - source libraries , two which are required ( cfitsio and fftw ) and two which are optional but recommended ( nlopt and the gnu scientific library ) .",
    "imfit also uses the python - based scons build system and cxxtest for unit tests .",
    "since the slowest part of the fitting process is almost always computing the model image , imfit is written to take advantage of openmp compiler extensions ; this allows the computation of the model image to be parceled out into multiple threads , which are then allocated among available processor cores on machines with multiple shared - memory cpus ( including single cpus with multiple cores ) . as an example of",
    "how effective this can be , tests on a macbook pro with a quad - core i7 processor , which has a total of eight virtual threads available , show that basic computation of large images ( without psf convolution ) is sped up by a factor of @xmath80 when openmp is used . even when the overhead of an actual fit is included , the total time to fit a four - component model with 21 free parameters ( without psf convolution ) to a @xmath212-pixel image is reduced by a factor of @xmath213 .",
    "additional computational overhead is imposed when one convolves a model image with a psf . to mitigate this",
    ", imfit uses the fftw library to compute the necessary fourier transforms .",
    "this is one of the fastest fft libraries available , and it can be compiled with support for multiple threads . when the same @xmath212-pixel image fit mentioned above",
    "is done including convolution with a @xmath214-pixel psf image , the total time drops from @xmath215s without any multi - threading to @xmath216s when just the fft computation is multi - threaded , and down to @xmath217s when openmp threading is enabled as well .",
    "multithreading can always be reduced or turned off using a command - line option if one does not wish to use all available cpu cores for a given fit .",
    "imfit has been used for several different astronomical applications , including preliminary work on the euclid photometric pipeline @xcite , testing 1d convolution code used in the analysis of core galaxies @xcite , fitting kinematically decomposed components of the galaxy ngc  7217 @xcite , determining the psf for data release 2 of the califa survey @xcite , and separation of bulge and disk components for dynamical modeling of black hole masses in nearby s0 and spiral galaxies ( erwin et al .",
    ", in prep ) .    in this section",
    "i present two relatively simple examples of using imfit to model images of real galaxies .",
    "the first case considers a moderately inclined spiral galaxy with a prominent ring surrounding a bar , where use of a separate ring component considerably improves the fit .",
    "the second case is an edge - on disk galaxy with both thin and thick disks ; i show how this can be fit using both the analytic pure - edge - on disk component ( edgeondisk ; section  [ sec : edgeondisk ] ) and the 3d luminosity - density model of an exponential disk ( exponentialdisk3d ; section  [ sec : expdisk3d ] ) .",
    "pgc 35772 is a @xmath218 , early / intermediate - type spiral galaxy ( classified as sa0/a by @xcite and as sb by @xcite ) which was observed as part of the h@xmath104 galaxy groups imaging survey ( haggis ; kulkarni et al .",
    ", in prep . )",
    "using narrow - band filters on the wide field imager of the eso 2.2 m telescope .",
    "the upper - left panel of figure  [ fig : haggis ] shows the stellar - continuum - filter image ( central wavelength @xmath219  nm , slightly blueward of the redshifted h@xmath104 line ) . particularly notable is a bright stellar ring , which makes this an interesting test case for including rings in 2d fits of galaxies .",
    "ellipse fits to the image show strong twisting of the isophotal position angle interior to the ring , suggesting a bar is also present .",
    "the rest of figure  [ fig : haggis ] shows the results three different fits to the image , each successive fit adding an extra component .",
    "these fits use a @xmath220-pixel cutout of the full wfi image , and were convolved with a moffat - function image with fwhm = 0.98 , representing the mean psf ( based on moffat fits to stars in the same image ) .",
    "the best - fit parameters for each model , determined by minimizing pmlr , are listed in table  [ tab : haggis ] , along with the uncertainties estimated from the l - m covariance matrix .",
    "since the fitting times are short , i also include parameter uncertainties from 500 rounds of bootstrap resampling ( in parentheses , following the l - m uncertainties ) .",
    "the first fit is uses a single sersic component ; the residuals of this fit show a clear excess corresponding to the ring , as well as mis - modeling of the region inside the ring .",
    "the fit is improved by switching to an exponential + srsic model , with the former component representing the main disk and the latter some combination of the bar + bulge ( if any ) .",
    "this two - component model ( middle row of the figure ) produces less extreme residuals ; the best - fitting srsic component is elongated and misaligned with the exponential component , so it can be seen to be modeling the bar .",
    "the residuals to this `` disk + bar '' fit are still significant , however , including the ring itself . to fix this ,",
    "i include a gaussianring component ( section  [ sec : gaussian - ring ] ) in the third fit ( bottom row of figure  [ fig : haggis ] ) .",
    "the residuals to _ this _ fit are better not just in the ring region , but also inside , indicating that this three - component model is doing a much better job of modeling the inner flux of the galaxy ( the three - component also has the smallest aic value of the three models ; see table  [ tab : haggis ] ) .",
    "llrll + sersic & pa & 138.14 & 0.48 ( 0.34 ) & deg + & @xmath84 & 0.254 & 0.0038 ( 0.0024 ) & + & @xmath77 & 1.041 & 0.0085 ( 0.027 ) & + & @xmath120 & 39.16 & 0.33 ( 0.52 ) & cont .",
    "flux + & @xmath83 & 8.267 & 0.042 ( 0.034 ) & arcsec +   +   + exponential & pa & 137.79 & 0.49 ( 0.29 ) & deg + ( disk ) & @xmath84 & 0.259 & 0.0039 ( 0.0021 ) & + & @xmath100 & 194.58 & 1.22 ( 0.97 ) & cont .",
    "flux + & @xmath107 & 5.17 & 0.025 ( 0.014 ) & arcsec + sersic & pa & 16.27 & 3.00 ( 1.13 ) & deg + ( bar ) & @xmath84 & 0.562 & 0.056 ( 0.025 ) & + & @xmath77 & 0.897 & 0.282 ( 0.074 ) & + & @xmath120 & 171.82 & 25.32 ( 6.77 ) & cont .",
    "flux + & @xmath83 & 0.713 & 0.041 ( 0.021 ) & arcsec +   +   + exponential & pa & 140.70 & 1.25 ( 0.53 ) & deg + ( disk ) & @xmath84 & 0.277 & 0.0098 ( 0.0053 ) & + & @xmath100 & 111.19 & 11.55 ( 4.05 ) & cont .",
    "flux + & @xmath107 & 5.74 & 0.18 ( 0.052 ) & arcsec + sersic & pa & 7.27 & 2.28 ( 1.04 ) & deg + ( bar ) & @xmath84 & 0.364 & 0.028 ( 0.092 ) & + & @xmath77 & 1.14 & 0.114 ( 0.046 ) & + & @xmath120 & 80.78 & 7.25 ( 2.47 ) & cont .",
    "flux + & @xmath83 & 1.42 & 0.080 ( 0.028 ) & arcsec + gaussianring & pa & 128.40 & 1.69 ( 0.69 ) & deg + ( ring ) & @xmath84 & 0.258 & 0.013 ( 0.0053 ) & + & @xmath221 & 26.90 & 3.22 ( 1.10 ) & cont .",
    "flux + & @xmath222 & 5.50 & 0.36 ( 0.14 ) & arcsec + & @xmath22 & 3.43 & 0.22 ( 0.13 ) & arcsec +      ic  5176 is an edge - on sbc galaxy , included in a `` control '' sample of non - boxy - bulge galaxies by @xcite and @xcite .",
    "@xcite noted that both the gas and stellar kinematics were consistent with an axisymmetric , unbarred disk ; @xcite concluded from their @xmath223-band image that it had a very small bulge and a `` completely featureless outer ( single ) exponential disk . ''",
    "this suggests an agreeably simple , axisymmetric structure , ideal for an example of modeling an edge - on galaxy . to minimize the effects of the central dust lane ( visible in optical images of the galaxy )",
    ", i use a _ spitzer _",
    "irac1 ( 3.6  ) image from s4 g @xcite , retrieved from the _ spitzer _ archive . for psf convolution ,",
    "i use an in - flight point response function image for the center of the irac1 field , downsampled to the 0.6 pixel scale of the post - processed archival galaxy image",
    ".    inspection of major - axis and minor - axis profiles from the irac1 image ( figure  [ fig : ic5176-prof ] ) suggests the presence of both thin and thick disk components ; the @xmath223-band image of @xcite was probably not deep enough for this to be seen .",
    "the major axis profile and the image both suggest a rather round , central excess , consistent with the small bulge identified by bureau et al .",
    "consequently , i fit the image using a combination of two exponential - disk models , plus a central srsic component for the bulge . the fast way to fit such a galaxy with imfit is to assume that the galaxy is perfectly edge - on and use the 2d analytic edgeondisk functions ( section  [ sec : edgeondisk ] ) for the thin and thick disk components .",
    "table  [ tab : ic5176 ] shows the results of this fit .",
    "the dominant edgeondisk component , which can be thought of as the `` thin disk '' , has a nearly sech vertical profile and a scale height of @xmath224 pc ( assuming a distance of 26.4 mpc ; * ? ? ?",
    "the second edgeondisk , with a more exponential - like vertical profile and a scale height of 1.4 kpc , is then the `` thick disk '' component ; it has a radial scale length @xmath225 times that of the thin disk .",
    "the central srsic component of this model contributes 1.8% of the total flux , while the thin and thick disks account for 70.5% and 27.7% , respectively .",
    "the thick / thin - disk luminosity ratio of 0.39 is consistent with the recent study of thick and thin disks by @xcite : using their two assumed sets of relative mass - to - light ratios gives a mass ratio @xmath226 or 0.94 , which places ic  5176 in the middle of the distribution for galaxies with similar rotation velocities ( see their fig .",
    "llrrl + sersic & pa & 149.7 & 0.0049 & deg + ( bulge ) & @xmath84 & 0.206 & 0.014 & + & @xmath77 & 0.667 & 0.033 & + & @xmath227 & 12.90 & 0.000 & mag  arcsec@xmath228 + & @xmath83 & 1.48 & 0.019 & arcsec + edgeondisk & pa & 149.7 & 0.0049 & deg + ( thin disk ) & @xmath229 & 11.829 & 0.0008 & mag  arcsec@xmath228 + & @xmath107 & 14.17 & 0.012 & arcsec + & @xmath77 & 2.607 & 0.025 & + & @xmath159 & 2.01 & 0.0044 & arcsec + edgeondisk & pa & 151.3 & 0.019 & deg + ( thick disk ) & @xmath229 & 15.557 & 0.0057 & mag  arcsec@xmath228 + & @xmath107 & 40.97 & 0.011 & arcsec + & @xmath77 & 9.89 & 0.700 & + & @xmath159 & 10.88 & 0.036 & arcsec +   +   + sersic & pa & 168.71 & 9.73 & deg + ( bulge ) & @xmath84 & 0.046 & 0.016 & + & @xmath77 & 0.762 & 0.033 & + & @xmath227 & 13.10 & 0.023 & mag  arcsec@xmath228 + & @xmath83 & 1.46 & 0.019 & arcsec + exponentialdisk3d & pa & 149.73 & 0.001 & deg + ( thin disk ) & @xmath207 & 87.21 & 0.015 & deg + & @xmath229 & 11.475 & 0.0010 & mag  arcsec@xmath228 + & @xmath107 & 14.44 & 0.011 & arcsec + & @xmath77 & 50 &  & + & @xmath159 & 2.04 & 0.004 & arcsec + exponentialdisk3d & pa & 151.43 & 0.019 & deg + ( thick disk ) & @xmath207 & 89.40 & 0.126 & deg + & @xmath229 & 15.604 & 0.0040 & mag  arcsec@xmath228 + & @xmath107 & 42.07 & 0.115 & arcsec + & @xmath77 & 50 &  & + & @xmath159 & 11.74 & 0.038 & arcsec +    a slower but more general approach is to use the edgeondisk3d function ( section  [ sec : expdisk3d ] ) for both components , which allows for arbitrary inclinations .",
    "the cost is in the time taken for the fit : @xmath230 minutes , versus a mere 3m20s for the analytic 2d approach . using the edgeondisk3d functions _",
    "does _ give what is formally a better model of the data than the analytic 2d - component fit , with @xmath79aic @xmath231 , though most of the parameter values  in particular , the radial and vertical scale lengths  are almost identical to previous fit .",
    "the only notable changes are the srsic component becoming rounder ( with a different and probably not very well - defined position angle ) and the vertical profiles of both disk components becoming pure exponentials ( the values of @xmath77 in table  [ tab : ic5176 ] are imposed limits ) .",
    "the relative contributions of the three components are essentially unchanged : 1.8% of the flux from the srsic component and 71.7% and 26.5% from the thin and thick disks , respectively .",
    "the best - fitting model converges to @xmath232 for the outer ( thick ) disk component , but does find @xmath233 for the thin - disk component .    ]",
    "the reality is that the combination of low spatial resolution of the irac1 image and the presence of residual structure in the disk midplane ( probably due to a combination of spiral arms , star formation , and dust ) means that we can not constrain the vertical structure of the disk(s ) very well",
    ". a vertical profile which is best fit with a sech function when the disk is assumed to be perfectly edge - on can also be fit with a vertical exponential function , if the disk is tilted slightly from edge - on .",
    "the low spatial resolution also means that the central bulge is not well constrained , either ; the half - light radius of the srsic component from either fit is @xmath234 pixels and thus barely larger than the seeing .",
    "in section  [ sec : statistics ] , i discussed two different practical approaches to fitting images from a statistical point of view : the standard , gaussian - based @xmath0 statistic and poisson - based mle statistics ( @xmath3 and pmlr ) .",
    "the @xmath0 approach can be further subdivided into the common method of using data values to estimate the per - pixel errors ( @xmath35 ) and the alternate method of using values from the model ( @xmath36 ) . outside of certain low - s / n contexts ( e.g. , fitting x - ray and gamma - ray data )",
    ", @xmath0 minimization is pretty much the default . even in the case of low s",
    "n , when the gaussian approximation to poisson statistics  which motivates the @xmath0 approach  might start to become invalid , one might imagine that the presence of gaussian read noise in ccd detectors could make this a non - issue .",
    "is there any reason for using poisson - likelihood approaches outside of very - low - count , zero - read - noise regimes ?",
    "@xcite used a combination of analytical approximations and fits of models to artificial data to show how @xmath0 fits ( using data - based or model - based errors ) can lead to biased parameter estimation , even for surprisingly high s / n ratios ; these biases were essentially absent when poisson mle was used .",
    "( @xcite used @xmath3 for their analysis , but minimizing pmlr would yield the same fits , as noted in section  [ sec : poisson ] . ) a fuller discussion of these issues in the context of fitting x - ray data can be found in that paper , and references therein ( e.g. * ? ? ?",
    "* ) . in this section ,",
    "i focus on the typical optical imaging problem of fitting galaxy images with simple 2d functions and use the flexibility of imfit to explore how fitting poisson ( or poisson + gaussian ) data with different assumptions can bias the resulting fitted parameter values .      as a characteristic example ,",
    "i consider a model galaxy described by a 2d srsic function with @xmath235 , @xmath236 pixels , and an ellipticity of 0.5 .",
    "this model is realized in three count - level regimes : a `` low - s / n '' case with a sky background level of 20 counts / pixel and model intensity at the half - light radius @xmath237 counts / pixel ; a `` medium - s / n '' version which is equivalent to an exposure time ( or telescope aperture ) five times larger ( background level = 100 , @xmath238 ) ; and a `` high - s / n '' version with total counts equal to 25 times the low - s / n version ( background level = 500 , @xmath239 ) .",
    "these values are chosen partly to test the question of how rapidly the gaussian approximation to poisson statistics becomes appropriate : 20 counts / pixel is often given as a reasonable lower limit for using this approximation ( e.g. , * ? ? ?",
    "* ) , while for 500 counts / pixel the gaussian approximation should be effectively indistinguishable from true poisson statistics .        the images were created using code written in python .",
    "the first stage was generating a noiseless @xmath240-pixel reference image ( including subpixel integration , but not psf convolution ) .",
    "this was then used as the source for generating 500 `` observed '' images of the same size , using poisson statistics : for each pixel , the value in the reference image was taken as the mean @xmath20 for a poisson process ( equation  [ eq : poisson ] ) , and actual counts were ( pseudo)randomly generating using code in the numpy package ( ` numpy.random.poisson ` ) .",
    "for simplicity , the gain was set to 1 , so 1 count = 1 photoelectron .",
    "the resulting images were then fit with imfit three times , always using the nelder - mead simplex method as the minimization algorithm . the first two fits used @xmath0 statistics , either the data - based @xmath35 or the model - based @xmath36 approach , with read noise set to 0",
    "; the third fit minimized @xmath3 .",
    "( essentially identical fits are obtained when minimizing pmlr instead of @xmath3 . ) the fitted model consisted of a single 2d srsic function with very broad parameter limits and the same starting parameter values for all fits ( with the initial @xmath120 value scaled by 5 for the medium - s / n images and by 25 for the high - s / n images ) , along with a fixed flatsky component for the background .",
    "figure  [ fig : sersic - histograms ] shows the distribution of best - fit parameters for fits to all 500 individual images in each s / n regime , with thick red histograms for the @xmath35 fits , thinner magenta histograms for the @xmath36 fits , and thin blue histograms for the poisson mle ( @xmath3 ) fits , along with the true parameter values of the original model as vertical dashed gray lines .",
    "a clear bias for the @xmath0 approaches can be seen in the fits to the low - s / n images ( top panels of figure  [ fig : sersic - histograms ] ) . for the @xmath35 approach ,",
    "the fitted values of @xmath77 and @xmath83 are too small : the average value of @xmath77 is 12.3% low , while the average value of @xmath83 is 15.4% too small .",
    "the fitted values of @xmath120 , on the other hand , are on average 34% too large . as can be seen from the figure ,",
    "these biases are significantly larger than the spread of values from the individual fits .",
    "the overall effect also biases the total flux for the srsic component , which is underestimated by 10.4% when using the mean parameters of the @xmath35 fit ; see figure  [ fig : lum - histograms ] .",
    "the ( model - based ) @xmath36 approach also produces biases , though these are smaller and are in the opposite sense from the @xmath35 biases : @xmath77 and @xmath83 are overestimated on average by 7.0% and 10.4% , respectively , while @xmath120 is 15.6% too small ; the total flux is overestimated by 6.5% .",
    "finally , the fits using @xmath3 are _ unbiased _ : the histograms straddle the input model values , and the mean values from the fits are all @xmath241% different from the true values .",
    "the other parameters of the fits  galaxy center , position angle , ellipticity  do not show any systematic differences , except for a very slight tendency of the ellipticity to be biased high with the @xmath35 fit , but only at the @xmath242% level . for the parameters which show biases in the @xmath0 fits , the trends are exactly as suggested by @xcite , including the fact that the @xmath36 biases are smaller and have the opposite sign from the @xmath35 biases .    in the medium - s / n case ( middle panels of the same figure ) ,",
    "the bias in the @xmath35 and @xmath36 fits is clearly reduced : for the @xmath35 fits , @xmath77 and @xmath83 are on average only 2.6% and 3.5% too small , while @xmath120 is on average 6.4% too high ( in the @xmath36 fits , the deviations are 1.3% and 1.9% too large and 3.2% too small , respectively )  though the bias is clearly still present , and in the same pattern .",
    "the biases in total flux are smaller , too : 2.3% low and 1.2% high for the data - based and model - based @xmath0 fits , respectively ( figure  [ fig : lum - histograms ] ) .",
    "these biases are even smaller in the high - s / n case : e.g. , in the @xmath35 case , @xmath77 and @xmath83 are 0.54% and 0.74% too small , while @xmath120 is 1.3% too high . in both s / n regimes ,",
    "the poisson mle fits remain unbiased .",
    "what is the effect of adding ( gaussian ) read noise to the images ? to investigate this , additional sets of images were prepared as before , except that the value from the poisson process was further modulated by adding a gaussian with mean = 0 and width @xmath243 e@xmath49 .",
    "( this value was chosen as a representative read noise for typical modern ccds ; it is also roughly equal to the dispersion of the gaussian approximation to the _ poisson _ noise of the background in the low - s / n limit ",
    "i.e. , @xmath244 . )",
    "the fits were done as before , with the read noise properly included in the @xmath0 fitting ; the histograms of the resulting fits are shown in figures  [ fig : sersic - histograms ] and [ fig : lum - histograms ] with dashed lines .",
    "what is clear from the figure is that while the addition of a gaussian noise term reduces the bias in the @xmath0 fits slightly in the low - s / n regime , the bias is still present .",
    "even though the poisson mle approach is no longer formally correct when gaussian noise is present , the @xmath3 fits remain unbiased in the presence of moderate read noise .",
    "how large is the bias produced by @xmath0 fits ?",
    "@xcite suggested that the absolute or relative size of the bias might not be as important as the size of the bias relative to the nominal statistical errors of the fits .",
    "there are , in principle , three different ways of estimating these errors : from the distribution of the fitted values for all 500 images ( similar to what was done by humphrey et al .  for their examples )",
    "; from the mean of individual - fit error estimates produced by using the l - m algorithm ; and from the mean of individual - fit error estimates produced by bootstrap resampling . for this simple model , all three approaches produce very similar values .",
    "for example , fitting the images in @xmath35 mode with the l - m algorithm produces estimated dispersions within @xmath245% of the dispersion of values from the individual @xmath35 fits ; the latter are in turn very similar to the dispersion of the individual @xmath3 fits ( as is evident from the similar histogram widths in figure  [ fig : sersic - histograms ] ) .",
    "the errors estimated from bootstrap resampling also agree to within @xmath246% of the other estimates ; see figure  [ fig : bootstrap ] for a comparison of bootstrap and l - m error estimates for a fit to a single low - s / n image .",
    "figure  [ fig : sersic - deviations ] shows the biases for the @xmath35 , @xmath36 , and poisson mle fits , plotted against the background value for the different s / n regimes : the top panels show the deviations relative to the true parameter values , while the bottom panels shows the deviations in units of the statistical errors ( using the standard deviation of the 500 fitted values ) .",
    "the left and right panels show the cases for @xmath35 and @xmath36 fits , respectively , with the poisson mle fits shown in each panel for reference . in all cases ,",
    "there is a clear trend of the @xmath0 biases becoming smaller as the overall exposure level ( represented by the mean background level ) increases , asymptotically approaching the zero - bias case exhibited by the poisson mle fits .",
    "@xcite derived an estimate for the bias ( relative to the statistical error ) that would result from fitting pure - poisson data using the @xmath35 statistic , based on the total number of counts @xmath247 and the total number of bins @xmath248 ( i.e. , the total number of fitted pixels ) : @xmath249 where @xmath250 is the true value , @xmath251 is the mean fitted value , and @xmath252 is the statistical error on the parameter value .",
    "they did the same for the @xmath36 approach and found @xmath253 the estimates derived from these equations are plotted as dotted lines in figure  [ fig : sersic - deviations ] . although the actual biases are systematically smaller than the predictions , the overall agreement is rather good .      is there any evidence that the @xmath0-bias effect is significant when fitting images of real galaxies ?",
    "figure  [ fig : real - deviations ] shows the differences seen when fitting single srsic functions to images of three elliptical galaxies . in the first case , i fit @xmath254-pixel cutouts from sdss @xmath255 , @xmath256 , and @xmath70 images of ngc  5831 ; these images correspond to successively higher counts per pixel in both background and galaxy .",
    "( the cutouts , as well as the mask images , were shifted in @xmath19 and @xmath257 to correct for pointing offsets between the different images . )",
    "although color gradients may produce ( genuinely ) different fits for the different images , these should be small for an early - type galaxy like ngc  5831 ; more importantly , the bias estimates i calculate ( see next paragraph ) are between the @xmath0 and poisson mle fits for each individual band . in the second and third cases i fit same - filter images with different exposure times : @xmath258-pixel cutouts from short ( 15s ) and long ( 60s ) @xmath70-band exposures of ngc  4697 , obtained with the isaac newton telescope s wide field camera on 2004 march 17 , and 15s and 40s @xmath259-band exposures of ngc  3379 , obtained with the prime focus camera unit of the int on 1994 march 14 ( image size = @xmath260 pixels ) .",
    "all images were fit with a single srsic function , convolved with an appropriate moffat psf image ( based on measurements of unsaturated stars in each image ) .",
    "all fits were done with @xmath35 , @xmath36 , and poisson mle ( @xmath3 ) minimization ; the @xmath0 fits included appropriate read - noise contributions ( 5.8 e@xmath261 and 4.5 e@xmath261 for the wfc and pfcu images , respectively ) .    unlike the case for the model images in the preceding section , the `` correct '' srsic model for these galaxies is unknown ( as is , for that matter , the true sky background ) .",
    "thus , figure  [ fig : real - deviations ] shows the differences between the best @xmath0-fit parameters and the parameters from the poisson mle fits , relative to the value of the latter , instead of the difference between all three and the ( unknown ) `` true '' solution .",
    "the trends are nonetheless very similar to the model - image case ( compare figure  [ fig : real - deviations ] with the top panels of figure  [ fig : sersic - deviations ] ) : values of @xmath77 and @xmath83 from the @xmath35 fits are smaller , and values of @xmath120 are larger , than the corresponding values from the poisson mle fits , and the offsets are reversed when @xmath36 fitting is done . although there is some scatter , the tendency of @xmath35 offsets to be larger than @xmath36 offsets is present as well : in fact , the average ratio of the former to the latter is 1.99 ( median = 1.65 ) , which is strikingly close to the ratio of 2 predicted by @xcite . even the fact that the @xmath262 offsets are always larger than the @xmath77 offsets replicates the pattern from the fits to artificial - galaxy images .",
    "in addition , the offsets between the @xmath0-fit values and the poisson mle fits diminish as the count rate increases , as in the model - image case .",
    "if we make the plausible assumption that the higher s / n images are more likely to yield accurate estimates of the true galaxy parameters ( to the extent that the galaxies _ can _ be approximated by a simple elliptical srsic function ) , then the convergence of estimated parameter values in the high - count regime strongly suggests that the poisson mle approach is the least biased in all regimes .    of course ,",
    "for many typical optical and near - ir imaging situations , the count rates even in the sky background are high enough that differences between @xmath0 and poisson mle fits can probably be ignored .",
    "for example , typical backgrounds in sdss @xmath256 , @xmath70 , @xmath207 , and @xmath98 images range between @xmath263 and 200 adu / pixel , or @xmath2641000 photoelectrons / pixel .",
    "sdss dr7 fields . ] only for @xmath255-band images does the background level become low enough ( @xmath265150 photoelectrons / pixel ) for the @xmath0-fit bias to become a significant issue .      a qualitative explanation for the @xmath35 bias is relatively straightforward .",
    "( a more precise mathematical derivation can be found in , e.g. , @xcite . ) in the low - count regime , pixels with downward fluctuations from the true model will have significantly lower @xmath33 values than pixels with similar - sized upward fluctuations ; since the weighting for each pixel in the fit is proportional to @xmath266 , the downward fluctuations will have more weight , and so the best - fitting model will be biased downward .",
    "the @xmath36 bias is slightly more complicated .",
    "here , one has to consider the effects of different possible models being fitted , because the @xmath33 values are determined by the _ model _",
    "values , not the data values . in the low - count regime , a model with slightly higher flux than the true model will have higher @xmath33 values , which will in turn _ lower _ the total @xmath0 .",
    "a model with lower flux will have smaller @xmath33 values , which will increase the total @xmath0 .",
    "the overall effect will thus be to bias the best - fitting model upward .",
    "figure  [ fig : bias - demo ] provides a simplified example of how the two forms of bias operate , using a gaussian + constant background model and a small set of poisson `` data '' points .",
    "the original ( true ) model is shown by the solid gray line , while the dashed red and blue lines show potential models offset above and below the correct model , respectively .",
    "the calculated @xmath35 ( left ) and @xmath36 ( right ) values for the offset models are also indicated , showing that the downward - offset model has the lowestchisquaredata of the three , while the upward - offset model has the lowest @xmath36 value .    in both cases ,",
    "the bias is strongest when the mean counts are low , and so for srsic fits affects the outer , low - surface - brightness part of galaxy . in order to accommodate",
    "the downward bias of @xmath35 fits , srsic models with lower @xmath77 and smaller @xmath83 ( fainter and steeper outer profiles ) are preferred ; the @xmath120 value increases in compensation to ensure a reasonable fit in the high - surface - brightness center of the galaxy , where the bias is minimal .",
    "the opposite trends hold for @xmath36 fits .",
    "it is important to note that the @xmath0 biases illustrated above apply to specific cases of estimating gaussian errors from the data or model values on a pixel - by - pixel basis .",
    "they do _ not _ necessarily apply when an external error map is used in the fitting , unless the error map is itself primarily based on the individual pixel values .",
    "error maps generated in other ways may have little or no effective bias .",
    "for example , the default behavior of galfit is to compute an error map from the image by estimating a global background rms value from the image ( after rejecting a fraction of high and low pixel values ) , combined with per - pixel @xmath22 values from a background - subtracted , _ smoothed _ version of the data .",
    "this means that galift s @xmath0 calculation is actually @xmath267 where @xmath268 is a global value for the image and @xmath269 is the background - subtracted , smoothed version of the data ; the underlying rationale is that a constant background should have , in the gaussian approximation , a single @xmath22 value ( chien peng , private communication ) .",
    "this approach has two advantages over the simpler @xmath35 method .",
    "first , smoothing the ( background - subtracted ) data before using it as the basis for @xmath22 estimation helps suppress the fluctuations which give rise to the @xmath35 bias , as demonstrated by @xcite for the case of 1d spectroscopic data .",
    "second , the galfit version of the @xmath0 statistic is similar in some respects to the so - called _ modified _ neyman s @xmath0 : @xmath270 where @xmath11 is the per - pixel data value . in both cases ,",
    "the effect of a fixed lower bound to the error term ( @xmath268 or 1 ) is to transition from approximately poisson weighting of pixels when @xmath11 or @xmath269 is large to _ equal _ weighting for pixels when the object counts approach zero ( this also removes the problem of pixels with zero counts ) .",
    "this tends to weaken , though not eliminate , the bias in the low - count regime ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "a hint of this effect can even be seen in the top panel of figure  [ fig : sersic - histograms ] , where the addition of a constant read - noise term to the @xmath22 estimation reduces both the @xmath35 and @xmath36 biases .    figure  [ fig : sigma1-galfit - histograms ] shows the distribution of @xmath77 , @xmath83 , and total luminosity for srsic fits to the low - s / n model images of section  [ sec : model - images ] for the @xmath35 , @xmath36 , and pmlr ( @xmath3 ) fits , along with fits to the same images using galfit ( version 3.0.5 ) . the distributions from fits using galfit ( black histograms )",
    "are almost identical to those from the pmlr fits using imfit ( blue histograms ) . a very slight bias in the @xmath35 sense ",
    "i.e. , underestimation of srsic @xmath77 , @xmath83 , and luminosity  can still be seen in the galfit results , but this is marginal and in any case much smaller than the dispersion of the fits .",
    "similarly , some evidence for the same biases can be seen in the galfit simulations of ( * ? ? ?",
    "* their fig .  5 ) , ( * ? ?",
    "* their fig .",
    "6 ) , and ( * ? ? ?",
    "* their figs .  4 and 5 ) , but these deviations are only visible at the very lowest s / n levels and are tiny compared to the overall scatter of best - fit values .",
    "the alert reader may have noticed that the discussion of how the galfit approach reduces bias in the fitted parameters implies that _ unweighted _ least - squares fits should be unbiased .",
    "so would it be better to forgo various @xmath22 estimation schemes entirely , and treat all pixels equally ?",
    "figure  [ fig : sigma1-galfit - histograms ] shows that @xmath0 fits to the same ( simple srsic ) model images are indeed unbiased when all pixels are weighted ( thick gray histograms ) .",
    "but the drawback of completely unweighted fitting is clear in the significantly larger dispersion of fitted results : unweighted fits are less _ accurate _ than either the poisson mle or galfit approaches .",
    "i have described a new open - source program , imfit , intended for modeling images of galaxies or other astronomical objects .",
    "key features include speed , a flexible user interface , multiple options for handling the fitting process , and the ability to easily add new 2d image functions for modeling galaxy components .",
    "images are modeled as the sum of one or more 2d image functions , which can be grouped into multiple sets of functions , each set sharing a common location within the image .",
    "available image functions include standard 2d functions used to model galaxies and other objects  e.g. , gaussian , moffat , exponential , and srsic profiles with elliptical isophotes  as well as broken exponentials , analytic edge - on disks , core - srsic profiles , and symmetric ( and asymmetric ) rings with gaussian radial profiles .",
    "in addition , several sample `` 3d '' functions compute line - of - sight integrations through 3d luminosity - density models , such as an axisymmetric disk with a radial exponential profile and a vertical @xmath271 profile .",
    "optional convolution with a psf is accomplished via fast fourier transforms , using a user - supplied fits image for the psf .",
    "image fitting can be done by minimization of the standard @xmath0 statistic , using either the image data to estimate the per - pixel variances ( @xmath35 ) or the computed model values ( @xmath36 ) , or by using user - supplied variance or error maps .",
    "fitting can _ also _ be done using poisson - based maximum - likelihood estimators ( poisson mle ) , which are especially appropriate for cases of images with low counts per pixel and low or zero read noise .",
    "this includes both the traditional cash statistic @xmath3 frequently used in x - ray analysis and an equivalent likelihood - ratio statistic ( pmlr ) which can be used with the fastest ( levenberg - marquardt ) minimization algorithm and can also function as a goodness - of - fit estimator .",
    "other minimization algorithms include the nelder - mead simplex method and differential evolution .",
    "confidence intervals for fitted parameters can be estimated by the levenberg - marquardt algorithm from its internal covariance matrix ; they can also be estimated ( with any of the minimization algorithms ) by bootstrap resampling .",
    "the full distribution of parameter values from bootstrap resampling can also be saved to a file for later analysis .",
    "a comparison of fits to artificial images of a simple srsic - function galaxy demonstrates how the @xmath0-bias discussed by @xcite manifests itself when fitting images : fits which minimize @xmath35 result in values of the srsic parameters @xmath77 and @xmath83 ( as well as the total luminosity ) which are biased low and values of @xmath120 which are biased high , while fits which minimize @xmath36 produce smaller biases in the opposite directions ; as predicted , these biases decrease , but do not vanish , when the background and source intensity levels increase .",
    "fits using poisson mle statistics yield essentially _ unbiased _ parameter values ; this is true even when gaussian read noise is present .",
    "srsic fits to images of real elliptical galaxies with varying exposure times or background levels show evidence for the same pattern of biased parameter values when minimizing @xmath35 or @xmath36 .",
    "this suggests that the fitting of galaxy images with imfit should generally use poisson mle minimization instead of @xmath0 minimization whenever possible , especially when the background level is less than @xmath272 photoelectrons / pixel .",
    "precompiled binaries , documentation , and full source code ( released under the gnu public license ) are available at the following web site : + http://www.mpe.mpg.de/~erwin / code / imfit/.    various useful comments and suggestions have come from maximilian fabricius , martin kmmel , and roberto saglia , and thanks are also due to michael opitsch and michael williams for being ( partly unwitting ) beta testers .",
    "further bug reports , suggestions , requests , and fixes from giulia savorgnan , guillermo barro , sergio pascual , and ( especially ) andr luiz de amorim are gratefully acknowledged .",
    "i also thank the referee , chien peng , for a very careful reading and pertinent questions which considerably improved this paper .",
    "this work was partly supported by the deutsche forschungsgemeinschaft through priority programme 1177 , `` witnesses of cosmic history : formation and evolution of galaxies , black holes , and their environment . ''",
    "this work is based in part on observations made with the _ spitzer _ space telescope , obtained from the nasa / ipac infrared science archive , both of which are operated by the jet propulsion laboratory , california institute of technology under a contract with the national aeronautics and space administration .",
    "this paper also makes use of data obtained from the isaac newton group archive which is maintained as part of the casu astronomical data centre at the institute of astronomy , cambridge .",
    "funding for the creation and distribution of the sdss archive has been provided by the alfred p. sloan foundation , the participating institutions , the national aeronautics and space administration , the national science foundation , the u.s .",
    "department of energy , the japanese monbukagakusho , and the max planck society .",
    "the sdss web site is ` http://www.sdss.org/ ` .",
    "the sdss is managed by the astrophysical research consortium ( arc ) for the participating institutions .",
    "the participating institutions are the university of chicago , fermilab , the institute for advanced study , the japan participation group , the johns hopkins university , the korean scientist group , los alamos national laboratory , the max - planck - institute for astronomy ( mpia ) , the max - planck - institute for astrophysics ( mpa ) , new mexico state university , university of pittsburgh , university of portsmouth , princeton university , the united states naval observatory , and the university of washington .",
    "table  [ tab : haggis ] lists the best - fit parameters for three progressively more complex models of the spiral galaxy pgc  35772 ( see section  [ sec : haggis - fit ] and figure  [ fig : haggis ] ) , along with both the levenberg - marquardt ( l - m ) uncertainties and the uncertainties derived from 500 rounds of bootstrap resampling ( the latter listed in parentheses after the l - m uncertainties ) .",
    "a comparison of the two types of uncertainty estimates suggests they are similar in size for the simplest model ( fitting the galaxy with just a srsic component ) , with mean and median values of @xmath273 and 0.81 , respectively .",
    "however , the bootstrap uncertainties are typically about half the size of the l - m uncertainties for the more complex models : the mean and median values for the uncertainty ratios are 0.48 and 0.51 , respectively , for the srsic + exponential model and 0.61 and 0.41 for the srsic + gaussianring + exponential model .    [ [ parameter - estimates - for - multiple - exposures - of - elliptical - galaxies ] ] parameter estimates for multiple exposures of elliptical galaxies ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~    in section  [ ref : biases - real ] i compared different @xmath0 fits with poisson mle fits for several elliptical galaxies . in this section , i compare l - m and bootstrap parameter error estimates for two of the same elliptical galaxies ( plus a third observed under similar conditions ) , always using poisson mle fits in order to avoid @xmath0 bias effects .",
    "specifically , i compare best - fit parameters from srsic fits to multiple images of the same galaxy , in two ways .",
    "first , i compare best - fit parameter values @xmath19 ( e.g. , srsic index @xmath77 ) from fits to short ( 15s ) exposures with values from fits to longer ( @xmath274s or @xmath275s ) exposures with the same telescope + filter system on the same night .",
    "i do this by comparing differences in parameter values @xmath276 with the error estimates for the same parameter @xmath252 from the short exposures ( left panel of figure  [ fig : uncertainty - ratios ] ) .",
    "this can be thought of as a crude answer to the question : how well do the error estimates describe the uncertainty of parameters from short - exposure fits relative to more `` correct '' parameters obtained from higher s / n data ? ( i do not compare @xmath120 values because these can vary due to changes in the transparency between exposures ; similarly , i do not compare values for the pixel coordinates of the galaxy center because these depend on the telescope pointing and are intrinsically variable . )",
    "to first order , if the uncertainty estimates were reasonably accurate we should expect @xmath277% of the points to be found at @xmath278 .",
    "as the left panel of the figure shows , neither approach is ideal , but the bootstrap-@xmath22 estimates are somewhat better : 50% of those are @xmath279 , while this is true for only 1/8 of the deviations if the l - m @xmath22 estimates are used .",
    "the second approach , seen in the right - hand panel of figure  [ fig : uncertainty - ratios ] , is to compare how well the differences in parameter values obtained from similar samples ( i.e. , multiple images of the same galaxy with the _ same _ exposure time ) compare with the error estimates .",
    "this is , in a limited sense , a test of the nominal frequentist meaning of confidence intervals : how often do repeated measurements fall within the specified error bounds ? in this case , i am comparing parameters from fits to the two 40s @xmath259-band exposures of ngc  3379 ( squares ) and also parameters from fits to three 15s @xmath222-band exposures of the lower - luminosity elliptical galaxy ngc  3377 ( diamonds ) , also from the int - wfc .",
    "again , we should expect @xmath277% of the points to lie within @xmath82 if the error estimates are accurate ; as the figure shows , essentially _ all _ the bootstrap and l - m estimates lie inside this range and so tend to be too small , particularly for @xmath83 .",
    "the bootstrap estimates do a better job in the case of ngc  3379 and a worse job in the case of ngc  3377 .",
    "the implication of the preceding subsections is that the l - m and bootstrap estimates of parameter errors are very roughly consistent with each other , though there is some evidence that the latter tend to become smaller than the former as the fitted models become more complex ( i.e. , more components ) . in general , both the l - m and bootstrap estimates",
    "should probably be considered _ underestimates _ of the true parameter uncertainties , something already established for l - m estimates from tests of other image fitting programs ( e.g. , * ? ? ?",
    "* ) .                                      , s. , elmegreen , b.  g. , knapen , j.  h. , salo , h. , laurikainen , e. , laine , j. , athanassoula , e. , bosma , a. , sheth , k. , regan , m.  w. , hinz , j.  l. , gil de paz , a. , menndez - delmestre , k. , mizusawa , t. , muoz - mateos , j .- c . , seibert , m. , kim , t. , elmegreen , d.  m. , gadotti , d.  a. , ho , l.  c. , holwerda , b.  w. , lappalainen , j. , schinnerer , e. , & skibba , r. 2011 , apj , 741 , 28                                , p. , doe , s. , & siemiginowska , a. 2001 , in society of photo - optical instrumentation engineers ( spie ) conference series , vol .",
    "4477 , society of photo - optical instrumentation engineers ( spie ) conference series , ed .",
    "starck & f.  d. murtagh , 7687                  , b. , mcintosh , d.  h. , barden , m. , bell , e.  f. , rix , h .- w . , borch , a. , beckwith , s.  v.  w. , caldwell , j.  a.  r. , heymans , c. , jahnke , k. , jogee , s. , koposov , s.  e. , meisenheimer , k. , snchez , s.  f. , somerville , r.  s. , wisotzki , l. , & wolf , c. 2007 , apjs , 172 , 615      , c. , den brok , m. , kleijn , g.  v. , carter , d. , balcells , m. , guzmn , r. , peletier , r. , ferguson , h.  c. , goudfrooij , p. , graham , a.  w. , hammer , d. , karick , a.  m. , lucey , j.  r. , matkovi , a. , merritt , d. , mouhcine , m. , & valentijn , e. 2011 , mnras , 411 , 2439        , m. , koppenhoefer , j. , riffeser , a. , mohr , j. , desai , s. , henderson , r. , paech , k. , & wetzstein , m. 2013 , in astronomical society of the pacific conference series , vol .",
    "475 , astronomical data analysis software and systems xxii , ed .",
    "d.  n. friedel , 357"
  ],
  "abstract_text": [
    "<S> i describe a new , open - source astronomical image - fitting program called imfit , specialized for galaxies but potentially useful for other sources , which is fast , flexible , and highly extensible . </S>",
    "<S> a key characteristic of the program is an object - oriented design which allows new types of image components ( 2d surface - brightness functions ) to be easily written and added to the program . </S>",
    "<S> image functions provided with imfit include the usual suspects for galaxy decompositions ( srsic , exponential , gaussian ) , along with core - srsic and broken - exponential profiles , elliptical rings , and three components which perform line - of - sight integration through 3d luminosity - density models of disks and rings seen at arbitrary inclinations .    </S>",
    "<S> available minimization algorithms include levenberg - marquardt , nelder - mead simplex , and differential evolution , allowing trade - offs between speed and decreased sensitivity to local minima in the fit landscape . </S>",
    "<S> minimization can be done using the standard @xmath0 statistic ( using either data or model values to estimate per - pixel gaussian errors , or else user - supplied error images ) or poisson - based maximum - likelihood statistics ; the latter approach is particularly appropriate for cases of poisson data in the low - count regime . </S>",
    "<S> i show that fitting low - s / </S>",
    "<S> n galaxy images using @xmath0 minimization and individual - pixel gaussian uncertainties can lead to significant biases in fitted parameter values , which are avoided if a poisson - based statistic is used ; this is true even when gaussian read noise is present . </S>"
  ]
}