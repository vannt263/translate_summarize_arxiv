{
  "article_text": [
    "as fusion energy research is rapidly approaching the reactor era , the role of energetic ions , most notably fusion alphas , is becoming increasingly important .",
    "numerical simulation tools for analyzing their behavior have been available for over 20 years . during this period ,",
    "the demands of more accurate and complete physics on one hand , and the development of computer architectures on the other hand have forced the developers to alter and amend the codes piece by piece , easily leading to a situation where the original philosophy and structure of the code are compromised and the full command of it is lost as a result of what could be called organic growth .",
    "the monte carlo orbit - following code ascot  @xcite is no exception in this .    in this paper",
    "we introduce a code that is still called ascot but has been fully rewritten .",
    "the new version is dubbed ascot4 and , when necessary , the old version is referred to as ascot3 . not only is the code rewritten using modern programming conventions but , more importantly , the philosophy behind the model has been reviewed . when doing so it was realized that the conventional way of solving the guiding center kinetic equation including collisional effects is in fact inconsistent : guiding center codes typically apply a monte carlo collision operator that has not been transformed to the guiding center phase space and , strictly speaking , is valid only for the particle phase space .",
    "another common discrepancy is to use different phase space coordinates for the hamiltonian and collisional parts when solving the kinetic equation with monte carlo methods . in ascot4",
    ", we follow recent developments regarding these issues and treat the collisional and hamiltonian parts consistently  @xcite .",
    "the paper is organized as follows : in section  [ sec : ascot ] , an introduction to ascot as a test particle code is given .",
    "section  [ sec : equations ] forms the backbone of this paper , describing in detail how the kinetic equation corresponding to the charged particle dynamics in tokamak plasmas is solved both for the full gyro motion and in the guiding center formalism . in this context",
    "we present the equations of motion for charged particles in electromagnetic fields , together with the integrators for advancing these equations in time , as well as methods to account for test particle coulomb collisions with the bulk plasma .",
    "the initial particle loadings corresponding to the most relevant fast ion sources are described in section  [ sec : sources ] . in section  [ sec : mhd ] , we discuss how magnetohydrodynamical ( mhd ) effects can be included to obtain more realistic simulations of fast ions , and section  [ sec : impurity ] introduces models for ionization and recombination required in impurity studies .",
    "section  [ sec : wall ] discusses the implementation of a wall surrounding the tokamak plasma , i.e. , the first solid surface of the machine seen by the particles , and how it limits the simulation regime . the rest of the paper includes a description of distributions that can be recorded during the simulation ( sec .",
    "[ sec : diagnostics ] ) , a benchmark between the new and the old version of the code ( sec .",
    "[ sec : benchmark ] ) , and a section describing various features of the code related to different platforms ( sec .",
    "[ sec : hightech ] ) , as well as a list of libraries required for compiling and executing the code on different platforms .",
    "the ascot code was originally designed for accelerated simulation of charged particle orbits in tokamaks , and the first targeted studies concerned runaway electrons as well as fast ion current drive in simple axisymmetric magnetic backgrounds  @xcite .",
    "early on ascot was upgraded to operate with realistic magnetic backgrounds that allowed shaped plasmas , up - down asymmetries as well as an x - point and a scrape - off layer ( sol ) .",
    "the toroidal non - uniformity included only the ripple produced by the finite number of toroidal field ( tf ) coils , and was given by trigonometric functions , sine or cosine , multiplied by an experimentally measured radial profile of the ripple strength . with the inclusion of a radial electric field model , ascot was used to model the dynamics of nbi ions at the plasma edge in the presence of both collisions and a radial electric field  @xcite . in particular , the response of ions trapped toroidally ( i.e. , between two adjacent tf coils ) to the appearance / disappearance of the edge radial electric field was of interest  @xcite .    due to the increasing size of the simulations and its practically ideal multiprocessor scalability ,",
    "ascot was parallelized using mpi in the late 1990 s .",
    "this made possible much larger simulations with several hundreds and even thousands of parallel processes .",
    "when the polarization equation was included in ascot , even bulk ions could be simulated , and the evolution of the radial electric field due to non - ambipolar currents was calculated in conditions characteristic of a low to high ( l - h ) confinement mode transition in the asdex upgrade tokamak  @xcite .",
    "the formation of a transport barrier via this mechanism was also investigated for the small ft-2 tokamak at ioffe institute , st .",
    "petersburg  @xcite .",
    "the significance of ion orbit losses to the divertor power loads was studied at jet  @xcite and , since ascot allowed simulations also in the sol , it was used to investigate the divertor in / out asymmetries observed at jet  @xcite .",
    "for the same reason , ascot was also applied to kinetic electrons in the asdex upgrade sol , trying to identify reasons for the discrepancy between results from the solps code and measurements  @xcite .",
    "for nearly ten years now , ascot has been used almost solely to simulate energetic ions .",
    "about ten years ago ascot also reached full maturity as far as the magnetic backgrounds are concerned : an arbitrary 3d field can be utilized , facilitating simulations in the presence of non - periodic features such as the test blanket modules ( tbm ) in iter . at the same time the wall collision model was also upgraded to 3d : a wall surface consisting of triangular and quadrilateral elements was introduced as a limit of the simulation regime . since then",
    ", ascot has been predominantly used in 3d configuration .",
    "these studies include calculations of fast ion power loads on iter first wall components , including contributions from fusion alphas , nbi ions and icrh - generated ions  @xcite , simulations of first wall power loads on asdex upgrade in the presence of the then - new elm mitigation coils  @xcite , and simulations of the nbi losses in the tbm mock - up experiments at diii - d  @xcite . in this context",
    ", changes in the neutron production were also evaluated and compared to measurements with very good agreement .",
    "this required simulations of fusion - born tritium in diii - d , which were made possible by the recent ascot code enhancement that allows following the full gyro orbits instead of guiding center orbits  @xcite .",
    "the most recent application for ascot is found at the low end of the energy spectrum : impurity transport , important for tritium retention , material migration and plasma performance in fusion reactors , is generally studied using axisymmetric codes that have a limited computational domain .",
    "ascot , for its part , offers a 3d alternative with the ability to follow particles in an unrestricted domain ranging from the core plasma to the first wall . for modeling impurity transport ,",
    "ascot was enhanced to include relevant atomic physics and a background plasma flow pertinent to the sol region .",
    "a trace - element injection experiments carried out at asdex upgrade were then simulated using the code .",
    "the results revealed that , in contrast to the commonly used experimental assumption of pure toroidal symmetry , the impurity deposition pattern can exhibit a strong toroidal asymmetry due to the 3d features of the first wall  @xcite . since then , similar",
    "modeling has been carried out also for jet to aid the interpretation of a beryllium migration experiment  @xcite .    as is evident from the above history ,",
    "the code has grown tremendously since the early 1990 s as new methods and models have been incorporated .",
    "the work has been carried out by a number of developers , using a range of programming conventions .",
    "simultaneously , the vast increase in computing resources with new supercomputers available around the world has forced the code out of the serial and modestly parallel processing era to accommodate up to tens of thousands of parallel processes .",
    "ascot is often used to calculate quantities such as fast ion density and torques for other codes to use as input .",
    "thus , solving the distribution function of the minority species forms the backbone of the code .",
    "the time evolution of the distribution function @xmath0 of an ensemble of test particles in a plasma is described by the kinetic equation @xmath1 where @xmath2 is the particle phase space , @xmath3 stands for the equations of motion , and @xmath4 describes the change in @xmath5 due to collisional processes . as the collisional effects , the right - hand side of eq .",
    "( [ eq : motion_fokker_planck ] ) , are often modelled with diffusion and friction , the kinetic equation essentially becomes a six - dimensional partial differential equation .    in practice",
    ", the high dimensionality excludes finite element and finite difference methods for finding the solution , but as the equations of motion conserve the phase space volume according to the liouville theorem , the kinetic equation can be expressed in a form similar to the kolmogorov forward equation @xmath6+\\frac{\\partial}{\\partial\\mathbf{z}}\\frac{\\partial}{\\partial\\mathbf{z}}:\\left[\\mathbf{c}(\\mathbf{z},t)f(\\mathbf{z},t)\\right],\\end{aligned}\\ ] ] where it is important to keep in mind that the quantity @xmath7 contains _ also the equations of motion _ , @xmath3 .",
    "the kolmogorov , or more familiarly , the fokker - planck equation describes how the probability density for finding a test particle at phase space location @xmath8 evolves in time when the motion of an individual particle is determined by a stochastic differential equation @xmath9 where the matrix @xmath10 satisfies @xmath11 and",
    "@xmath12 are independent stochastic wiener processes with zero mean .",
    "this connection between stochastic processes and partial differential equations has been known since the work of kolmogorov  @xcite .",
    "the solution to the kinetic equation is then obtained simulating random paths and taking a statistical average of them .    in a strong magnetic field ,",
    "the charged particle orbit consists of rapid gyro motion around the magnetic field lines , combined with various drifts brought about by the non - uniformity of the field or by the combined effect of magnetic and electric fields .",
    "the basic equations of motion contain all this physics . in fusion - related applications , it is often necessary to follow particles for millions of oscillation periods and the computational effort of numerical integration then becomes rather expensive . furthermore , in cases where the background quantities are practically constant across the larmor radius ( i.e. , have large gradient lengths ) , the full gyro motion is redundant .",
    "then , a more attractive approach is the guiding center transformation of the charged particle lagrangian , leading to equations of motion where the rapid oscillatory gyro motion is isolated into only one variable , namely the gyro - angle , that is not needed for following the particle s guiding center .",
    "this formalism , although only an approximation , is a powerful tool and significantly reduces the computational demands for the orbit - following , when applicable .",
    "the equations of motion in the particle phase space , corresponding to the full gyro orbit , are introduced in sec .",
    "[ sec : fo ] , and the ones corresponding to the guiding center formalism are described in sec .",
    "[ sec : gc ] .",
    "the algorithms for solving these equations are also explained . in sec .",
    "[ sec : fo_coll ] we describe the collision operator for the particle phase space and , in sec .",
    "[ sec : gc_coll ] , the corresponding operator is introduced for the guiding center phase space .",
    "the lagrangian for a particle with mass @xmath13 and charge @xmath14 under the influence of a magnetic vector potential @xmath15 and electric potential @xmath16 is  @xcite @xmath17 which is equivalent to the non - canonical hamiltonian equations of motion @xmath18 where @xmath19 is the particle velocity , and the electric and magnetic fields are defined by @xmath20 the change in the total energy of the particle is given by @xmath21 which is zero for time - independent potentials , but as the equations  ( [ eq : full_v ] ) and ( [ eq : full_r ] ) lead to a very rapidly oscillating motion with the characteristic frequency of @xmath22 , implementing a numerical integration scheme that would have the same property over long time periods poses a challenge .",
    "advancing the equations of motion in time is the essence of the ascot code . for the full gyro motion the code has two different options : a fourth - order runge - kutta method with fifth - order error estimation  @xcite , and a modified leap - frog method .",
    "with rapidly oscillating non - canonical systems , e.g. , eqs .",
    "( [ eq : full_v ] ) and  ( [ eq : full_r ] ) , the runge - kutta method , however , has the well - known tendency to cause numerical drift in the total energy .",
    "in contrast , a modified leap - frog method defined by @xmath23 has the property that @xmath24 if the electric field is zero , i.e. , it explicitly conserves energy .      for a guiding center phase space @xmath25 ,",
    "i.e , location , parallel velocity , magnetic moment , and gyro - angle , respectively , the transformed lagrangian is  @xcite @xmath26 where @xmath27 is the magnetic field unit vector , and the hamiltonian @xmath28 is given by @xmath29 the guiding center equations of motion are obtained applying the euler - lagrange equation @xmath30 for each phase space coordinate , yielding @xmath31 where @xmath32 , and the effective fields ( @xmath33 , @xmath34 ) in eqs .  ( [ eq : vpardot ] ) and  ( [ eq : rdot ] ) are defined by the effective potentials @xmath35 the time rate of change in the total energy for the guiding center then becomes @xmath36 and , for a static background , it is zero , as expected .",
    "the oscillation of the guiding center orbit happens in a radically different time scale than that of the gyro motion , and a fourth - order runge - kutta method with fifth - order error checking  @xcite has proved itself adequate when numerically integrating the guiding center equations of motion .",
    "the coulomb collisions are modelled by operators acting in particle velocity space .",
    "the collisional part of the kinetic equation takes the form @xmath37 , \\label{eq : perturbations_collision_term}\\end{aligned}\\ ] ] where the vector @xmath38 can be interpreted as a friction term in velocity space and the tensor @xmath39 as a velocity diffusion term .",
    "their explicit expressions are @xmath40 where @xmath41 , @xmath42 is the coulomb logarithm , @xmath43 is the electric charge of the plasma species @xmath44 , and @xmath45 . for a comprehensive derivation of the coefficients ,",
    "see  @xcite .    in the case of a maxwellian background plasma with no flow velocity",
    ", the friction and diffusion coefficients are reduced to the form @xmath46 where the scalar coefficients are @xmath47 and @xmath48 .",
    "the functions @xmath49 and @xmath50 are defined by @xmath51    the particle motion is then governed both by the hamiltonian motion , eq .",
    "( [ eq : full_v ] ) , and by coulomb drag and diffusion , yielding for the velocity @xmath52dt\\nonumber\\\\&+\\left[\\sqrt{d_{\\parallel}}\\frac{\\mathbf{v}\\mathbf{v}}{v^2}+\\sqrt{d_{\\perp}}\\left(\\mathbf{i}-\\frac{\\mathbf{v}\\mathbf{v}}{v^2}\\right)\\right]\\cdot d\\mathbf{\\mathcal{w}}^{\\mathbf{v}},\\end{aligned}\\ ] ] while the particle location obeys eq .",
    "( [ eq : full_r ] ) .",
    "the deterministic part of eq .",
    "( [ eq : dpprt ] ) , containing both the hamiltonian equation of motion and the collisional friction term , can be advanced in time using the leap - frog scheme introduced in sec .",
    "[ sec : fo ] , while the stochastic part is often treated with the stochastic euler method .",
    "it is essential to understand that the guiding center transformation should be applied consistently to the whole kinetic equation , not just to the equations of motion .",
    "an exclusive guiding center transformation of the kinetic equation with coulomb collisions included is given in  @xcite , and the corresponding stochastic differential equations for guiding center phase space coordinates are discussed in  @xcite .",
    "although the formalism includes the effects of magnetic drifts , within this work , the guiding center coulomb collision are considered only up to zeroth order in magnetic field non - uniformity . the most evident consequence of the proper treatment of the guiding center coulomb collisions , the appearance of a _ _ s__patial diffusion in addition to the velocity space operators , however , is present also in zeroth order .",
    "the simplest representation of the operators involves the guiding center velocity @xmath53 and pitch @xmath54 , for which the zeroth order coulomb contributions to the stochastic differential equations are @xmath55 here the frequency @xmath56 differs slightly from @xmath57 , and is defined by @xmath58    the guiding center equations of motion , however , are often given for the velocity space coordinates @xmath59 , and solving the kinetic equation by the stochastic approach calls for a consistent phase space . for the coordinates",
    "@xmath59 the zeroth order stochastic equations become @xmath60dt\\nonumber\\\\&+\\sigma^{\\mathrm{v}_{\\parallel}\\mathrm{v}_{\\parallel}}d\\mathcal{w}^{\\mathrm{v}_{\\parallel}}+\\sigma^{\\mathrm{v}_{\\parallel}\\mu}d\\mathcal{w}^{\\mu}\\\\ \\label{eq : mu_stoc } d\\mu\\;=\\;&\\left[-2\\nu\\mu+\\frac{m\\mu}{\\mathcal{e}}\\left(\\mathrm{v}\\frac{\\partial d_{\\parallel}}{\\partial\\mathrm{v}}+3\\left(d_{\\parallel}-d_{\\perp}\\right)\\right)+\\frac{2md_{\\perp}}{b}\\right]dt\\nonumber\\\\&+\\sigma^{\\mu\\mathrm{v}_{\\parallel}}d\\mathcal{w}^{\\mathrm{v}_{\\parallel}}+\\sigma^{\\mu\\mu}d\\mathcal{w}^{\\mu},\\end{aligned}\\ ] ] where , in eq .",
    "( [ eq : vpar_stoc ] ) , @xmath61 is given by eq .",
    "( [ eq : vpardot ] ) , and we have neglected @xmath62 since the magnetic moment is a constant of hamiltonian guiding center motion .",
    "the matrix @xmath63 is solved from the condition @xmath64 , where the symmetric guiding center velocity space diffusion matrix @xmath65 is expressed as a product where the diagonal matrix @xmath66 has the components @xmath67 and the symmetric normalized matrix @xmath68 has the components @xmath69\\\\ \\mathcal{y}^{v_{\\parallel}\\mu}&=2\\xi ( 1-\\xi^2)(d_{\\parallel}-d_{\\perp } ) \\\\",
    "\\mathcal{y}^{\\mu\\mu}&=4(1-\\xi^2)\\left[d_{\\parallel}(1-\\xi^2)+d_{\\perp}\\xi^2\\right].\\end{aligned}\\ ] ]    the zeroth order coulomb contribution to the spatial guiding center coordinates appears as a purely diffusive process , yielding for the guiding center position @xmath70 where the spatial coulomb diffusion coefficient is @xmath71,\\end{aligned}\\ ] ] and @xmath72 is given by eq .",
    "( [ eq : rdot ] ) .    as in the case of gyro orbit following",
    ", the deterministic part of the collisional effects should be evaluated together with the equations of motion , using the higher level integrators , while the stochastic part can be evaluated using the euler method .",
    "the ascot code is often used to gather information from fast ions . for convenience ,",
    "the code has an in - built capability to initialize test particles that represent the actual particles .",
    "the sources listed below include energetic ions and neutrons from fusion reactions , as well as ions generated by neutral beam injection or icrh acceleration , all relevant for studies of , e.g. , plasma heating and current drive or fast ion power loads to plasma facing components .      generating test particles that represent the fusion products is a two - phase process .",
    "first , the reaction rates for the fusion reactions of interest are calculated onto a cylindrical grid @xmath73 .",
    "then , test particles are generated making use of this grid . from here on , the symbol z no longer stands for the phase space coordinate but , rather , has its conventional role as one of the cylindrical coordinates .",
    "the four reactions described by bosch and hale@xcite are supported : d(d , n)@xmath74he , d(d , p)t , t(d , n)@xmath75 and @xmath74he(d , p)@xmath75 . these reactions are considered in three different cases : thermal , beam - target and beam - beam . for the thermal case bosch and hale",
    "provide a parametrized model .",
    "the background plasma parameters are used directly from the input files . the beam - target and beam - beam reaction rates",
    "are calculated as a post - processing step where the fast ion density distribution @xmath76 from an earlier run reacts either with itself ( beam - beam ) or with the background plasma ( beam - target ) .",
    "these calculations are integrals over one or two fast ion distributions . to expedite the integral",
    ", intermediate averaged reactivities are calculated . for the beam - beam reaction",
    "the fusion cross section is first averaged over the gyro angle @xmath77 in a similar way that nubeam  @xcite does in order to get the averaged reactivity@xmath78 where @xmath79 .",
    "then , the beam - beam fusion rate is calculated according to @xmath80 for the beam - target reaction , the reaction rate is given by @xmath81 where @xmath82 is the fast ion density calculated by ascot and @xmath83 is the maxwellian density distribution of the background plasma .",
    "once the reaction rate @xmath84 ( reactions per volume and time ) has been calculated , there are two methods to initialize fusion products : a weighted initialization and a uniform weight initialization . in the weighted initialization , the coordinates ( @xmath85 )",
    "are chosen by uniformly distributed random numbers between the minimum and maximum dimensions set by the walls and the x - point .",
    "if the chosen location is not inside the separatrix , the particle is discarded and a new location is picked .",
    "once a location inside the separatrix is found , a weight factor is calculated as @xmath86 where @xmath87 is the weight of the @xmath88th particle , @xmath89 is the fusion reaction rate with @xmath90 being the rate evaluated at the location of the _ i_th particle , @xmath91 is the total number of particles , @xmath92 is the flux surface volume , @xmath93 is the square root of the normalized poloidal magnetic flux , and @xmath94 is the toroidal angle . the initial velocity is chosen so that the velocity distribution is isotropic .    in the uniform weight initialization , r , @xmath94 and z",
    "are chosen as random numbers uniformly distributed in volume , between the minimum and maximum dimensions set by the walls and the x - point .",
    "then a uniformly distributed random number @xmath95 between @xmath96 and @xmath97 is compared against the normalized local reaction rate @xmath98 . if @xmath99 , the particle is generated .",
    "the weight factors for all particles are now equal , calculated simply as @xmath100      due to the structure of neutral beam injectors used in fusion devices worldwide , the produced beams consist of small sub - beams , or beamlets . in order to model neutral beam injection ( nbi ) as accurately as possible ,",
    "this fine structure of the beam is taken into account in the nbi ion source code used in ascot .    to generate an nbi test particle , a neutral particle from a random beamlet",
    "is chosen .",
    "the neutral is assigned a velocity in the direction of the beamlet , offset by a usually bi - gaussian dispersion , and advanced along its velocity vector until it either hits an obstacle or enters the vacuum chamber .",
    "once inside the vessel , the neutral particle is given a uniformly distributed random threshold value @xmath101 $ ] and advanced along a straight trajectory until the probability , calculated for the particle to survive further without ionization , is lower than the threshold  @xmath102 .    a general probabilistic model for effective ionization and recombination",
    "is derived considering a large number of particles , @xmath91 , with some initial state , and assuming that each reaction @xmath103 removes particles from the initial state according to the differential equations @xmath104 where @xmath105 is the number of reactions of type @xmath103 that have taken place before reaching the location @xmath106 and @xmath107 is the cross - section .",
    "integration gives the solution @xmath108 which satisfies @xmath109 and , thus , conserves the number of particles .",
    "letting @xmath110 denote a random location for the reaction @xmath103 to happen , the probability for ",
    "reaction @xmath103 takes place before reaching location @xmath106  is @xmath111    the model for a neutral to become ionized involves only the effective ionization , and the cumulative probability for a neutral to survive the interval @xmath112 $ ] is thus @xmath113 where @xmath114 is the total ionization cross - section calculated from the analytical fits given by suzuki _",
    "et al . _",
    "@xcite , and @xmath115 is the probability to survive the interval @xmath116 $ ] . in the code",
    "the integral is discretized with small steps @xmath117 , yielding @xmath118 and once @xmath119 is obtained , i.e. , the probability of the particle surviving to its current location falls below the threshold , the particle is backtracked by a fraction of the last step to the exact location where the exponential crosses the threshold value , given by @xmath120 at this location , a test particle is recorded .",
    "if the neutral particle hits the wall of the device before being ionized , it is considered shine - through .    at the time of writing ,",
    "the nbi geometries of jet , iter , asdex upgrade , diii - d , fast , textor , mast , and tore supra have already been implemented . adding the nbi geometries of new devices and benchmarking the model against existing codes is an ongoing project .",
    "a more detailed description of the nbi model and comparisons to other codes will be presented in a separate publication .",
    "ion cyclotron resonance heated ( icrh ) ions can be considered at different levels of sophistication .",
    "the most sophisticated level requires a self - consistent simulation taking into account the wave field caused by the icrh antenna and its interaction with the plasma .",
    "currently only a few dedicated models @xcite exist that can provide this kind of a realistic icrh distribution .",
    "often , however , it is enough to use approximations , e.g. , when one is looking for the types of particle orbits that will be lost to plasma facing components . the icrh ion source model for ascot",
    "is based on physical observations .",
    "the plasma acts as a lens for the wave field , focusing it on the magnetic axis . due to the effects of ,",
    "e.g. , finite wavelength , finite absorptivity and up - down asymmetry , the focusing is not perfect , and the distribution of icrh ions is peaked at the magnetic axis with a finite half - width responsible for spreading in the radial coordinate @xmath121 .",
    "in addition , the icrh ions will have the banana turning point at places where the frequency of the icrh wave , @xmath122 , meets the resonance condition , @xmath123 , for the @xmath124th harmonic of the wave field .",
    "as @xmath125 is proportional to the magnetic field @xmath126 , which is roughly a function of the inverse major radius @xmath127 , the icrh distribution will be roughly limited to a certain resonant major radius rather than spreading in @xmath128 only .",
    "the implementation in ascot first samples a gaussian distribution , with a user - defined peak location , @xmath129 , and half - width , @xmath130 , to get an ensemble of @xmath131 values .",
    "the energies are sampled from a maxwellian distribution with a given temperature , e.g. 500 kev , and an optional cut - off energy @xmath132 .",
    "after this , the @xmath133 locations for the particles are found by minimizing the function @xmath134 ^ 2+b\\left[n\\omega(r , z)-\\omega\\right]^2,\\ ] ] where @xmath135 and @xmath44 are user - defined constant parameters .",
    "finally , the particles are given a weight factor , scaled according to the total icrh power @xmath136 and the number of test particles created .",
    "high performance fusion plasmas rarely are mhd quiescent . in particular , all iter plasmas are prone to neoclassical tearing modes ( ntm ) , and the advanced scenario plasmas corresponding to steady - state operation are likely to exhibit significant alfvn activity . both of these mhd phenomena are expected to affect the fast ion trajectories and , therefore , possibly lead to redistribution of the fast ion population . to account for the physics related to such mhd activity , a new model , applicable in 3d geometries ,",
    "is incorporated in ascot .    the model for both stationary neoclassical tearing modes and rotating alfvn eigenmodes ( ae )",
    "is reported in detail in  @xcite .",
    "the mhd activity is introduced as a perturbation in the magnetic vector potential , @xmath137 , while a possible time dependence generates a perturbation also in the electric potential , @xmath138 .",
    "as the modes often appear as harmonic structures along the magnetic field lines , a helical structure is assumed for the perturbations @xmath139 and boozer coordinates ( @xmath140 ) are currently used to map the perturbative quantities back to cylindrical coordinates .    for ntms",
    ", the rotation frequency @xmath141 is usually low , and we may assume no electric perturbation to appear , thus neglecting @xmath138 and @xmath141 . in the case of a rapidly rotating ae , the approximation that the perturbed parallel electric field vanishes due to the rapid motion of electrons along the field line implies that @xmath142 and @xmath143 are related , and only one of them is required to describe the mode in the boozer coordinates  @xcite .",
    "the input data for ascot can be obtained , e.g. , from mhd codes like ligka  @xcite , and the data typically consists of radial functions @xmath144 , mode numbers @xmath124 and @xmath13 , and frequencies @xmath141 .",
    "although the model is strongly dependent on the coordinates ( @xmath140 ) , it differs from previous work : the test particle guiding center can be followed in any coordinate system , contrary to previous methods restricted to field - aligned coordinates only .",
    "adding the electric perturbation causes no changes to the equations of motion : only the gradient of the perturbation potential is added into the electric field that already appears in the equations . proceeding similarly with",
    "the magnetic vector potential would require calculating terms like @xmath145 .",
    "this is rendered unnecessary by adding the magnetic perturbation only into the symplectic part of the lagrangian , eq .",
    "( [ eq : gc_lagrangian ] ) , and neglecting it from the hamiltonian . as a result , we introduce the modified potentials ( @xmath146 ) which are related to the effective potentials ( @xmath147 ) by @xmath148 thus , in eqs .",
    "( [ eq : vpardot ] ) and  ( [ eq : rdot ] ) , the effective fields @xmath149 and @xmath150 are replaced with @xmath151 and also the time rate of change of the total energy is now expressed by the modified potentials @xmath152 still yielding zero for static backgrounds and time - independent perturbations .",
    "the implementation of the time - dependent method thus requires @xmath75 , @xmath153 , @xmath154 and @xmath155 at given location .",
    "these quantities are calculated with the aid of coordinate transformations from cylindrical / cartesian to boozer coordinates and back .",
    "in addition to fast particles , ascot can also be used for modelling impurity transport .",
    "the code has been applied to , e.g. , simulating trace element injection experiments  @xcite . for these purposes ,",
    "the advantage of ascot is impurity following in all regions of the plasma , extending from the core plasma , scrape - off layer ( sol ) and halo plasma to the wall in a fully 3d tokamak environment .",
    "compared to fast particles , however , impurities in the sol have typically very low energies ( of the order of 1100 ev ) . due to the low energy ,",
    "impurities are more strongly affected by the background plasma properties , such as the flow velocity .",
    "additionally , the charge state of impurity particles can vary significantly as a result of their high @xmath156 number , which further affects their transport .",
    "therefore , additional interaction models are needed for realistic simulations of impurities",
    ".      strong plasma flows with typical velocities of mach 0.51 have been measured in the sol region of various tokamaks  @xcite .",
    "owing to the low energy of impurities , the flow has a significant effect on their long range transport .",
    "the coulomb collision operators introduced in sec .  [ sec : equations ] , however , assume the background plasma to have a purely maxwellian distribution , which neglects plasma flow",
    ".    in ascot simulations , the effect of background plasma flow on coulomb collisions can be modelled by using a frame of reference moving with the local parallel flow velocity @xmath157 of the background plasma .",
    "as the collisions are about to be evaluated , the frame of reference is switched by updating the particle velocity according to @xmath158 and calculating the coulomb contribution in eq .",
    "(  [ eq : dpprt ] ) with @xmath159 instead of @xmath19 .",
    "this procedure is equal to calculating the coulomb coefficients with drift maxwellian backgrounds .    for a guiding center ,",
    "the parallel velocity is changed according to @xmath160 , yielding the velocity @xmath161 and the pitch @xmath162 . using either of the quantities @xmath163 or @xmath164 , the coulomb contribution",
    "is then integrated using either eqs .",
    "( [ eq : gcdv ] ) and  ( [ eq : gcdxi ] ) or eqs .",
    "( [ eq : vpar_stoc ] ) and  ( [ eq : mu_stoc ] ) that give new values for @xmath165 or @xmath164 , which are then transformed back to the laboratory frame of reference , giving new values of the velocity space coordinates .      during a single time step",
    ", test particles can experience several different atomic reactions , such as impact ionization , when interacting with the background plasma .",
    "these reactions change the charge state of the followed particles , which then affects their transport directly through the equations of motion described in sections  [ sec : fo ] and [ sec : gc ] . for heavy impurities , such as tungsten with @xmath166",
    ", the effect should not be neglected .",
    "if only the changes in the charge state of the followed particle are of interest , it is not necessary to model all possible atomic reactions individually .",
    "instead , it is sufficient to model the effective ionization and recombination of the particle . during a single time step",
    ", the particle may undergo several reactions , which effectively lead to the ionization or recombination of the particle , or to a situation where the charge state remains effectively unchanged .    as charged particles in a magnetic field do not move linearly , it is more convenient to use time @xmath167 and reaction rates @xmath168 rather than the distance @xmath106 and cross sections @xmath169 used in the nbi model in sec .",
    "[ sec : nbi ] .",
    "the probabilistic model , however , remains unchanged .",
    "thus , letting @xmath170 denote a random time for reaction @xmath103 to take place during time step @xmath171 , eq .",
    "( [ eq : prop_model ] ) is approximated as @xmath172\\end{aligned}\\ ] ] and tested against a uniformly distributed random number @xmath173 $ ] to determine whether the charge state is increased or decreased by one or remains unchanged during the time step @xmath171 .",
    "the reaction rate coefficients as a function of local electron temperature and density are taken from the adas database @xcite . at the time of writing ,",
    "data for carbon , beryllium , tungsten and nitrogen have been imported into ascot .",
    "setting up a realistic calculation domain requires a limiting surface to be defined .",
    "if fast ion power loads or the deposition of impurities on the first wall are to be reliably simulated , this limiting surface has to accurately represent the wall structures . in ascot",
    "this surface is taken to be the first wall of the vessel , represented by triangular and planar quadrilateral elements as shown in figure  [ fig : iter_wall_sector ] .",
    "inside the code all given planar quadrangular polygons are split into two triangles , as these are the simplest planar elements for collision detection .",
    "for each triangle , the unit normal vector @xmath174 and an implicit presentation of the triangle s plane @xmath175 are defined and stored . here , @xmath176 and @xmath177 is any vertex of the triangle .",
    "these definitions are used by the wall collision detection algorithm during simulations .        for modelling a 3d wall and test particle wall collisions , an efficient ray - polygon collision detection algorithm",
    "@xcite has been adopted in ascot . the test particle orbit step from @xmath178 to @xmath179 , to be tested for wall collision , is presented parametrically as @xmath180 .",
    "the parameter @xmath167 is evaluated at the intersection of the plane of each preliminary candidate triangle as @xmath181 and stored as @xmath182 .",
    "all triangles for which @xmath183 are stored as collision candidates .",
    "if no such triangles are encountered , the wall collision check routine returns a no - collision result .",
    "if collision candidate triangles are found , the plane intersection point @xmath184 is evaluated for each one of them .    a presentation based on two parameters , @xmath75 and @xmath185 ( see figure [ fig : parametric_presentation ] ) ,",
    "is used to determine whether the collision with the triangle s plane has occurred inside the boundaries of the triangle .",
    "this is true if @xmath186 , @xmath187 and @xmath188 .",
    "if several candidate triangles fulfill this criterion , the one with the smallest @xmath182 is selected and the wall collision point is returned by the routine .     of the test particle orbit step with the plane of the wall triangle is inside the triangle.,scaledwidth=36.0% ]    this algorithm , originally developed for computer graphics applications , has been optimized to use as little cpu time as possible .",
    "a function @xmath189 giving a lower limit for the distance to the wall is initialized before the actual simulation starts for checking the possibility of a collision .",
    "in addition , the wall elements are arranged into a bounding volume hierarchy tree during the initialization phase and , thus , the volumes that bound the wall elements and collide with the volume bounding the test particle orbit step from @xmath190 to @xmath191 can be found in logarithmic search time .",
    "this twofold mechanism has proved to be the most efficient the authors are aware of , and requires only a small percentage of the total simulation time .",
    "although the guiding center formalism offers a method to overcome the high computational demands of following full gyro - orbits , it may lead to false interpretations of , e.g. , wall power loads .",
    "if the guiding center orbit is close to parallel to the plane of the wall structure , the guiding center may proceed quite far without colliding , even when it is closer than one larmor radius to the wall elements , whereas the full orbit would collide immediately .",
    "aware of this , we have adopted a mixed scheme : when the particle is no more than one larmor radius away from the wall structures , the code starts to follow the full gyro - orbit in addition to the guiding center , and if no collision is observed when the particle again recedes farther away from the wall , full orbit - following is abandoned .",
    "this approach saves a significant amount of computation time as compared to complete gyro - orbit following , does nt noticeably increase the computational effort compared to the pure guiding center method , and gives a more accurate estimate of the wall collision location than pure guiding center simulation .",
    "during a simulation , test particle data can be gathered into n - dimensional histograms called _",
    "distributions_. the distributions can have up to six dimensions , and common to all are _ time _ and _ test particle species_. the remaining 14 dimensions are used for the desired phase space coordinates . after each time step @xmath171",
    ", a weight @xmath192 is added to all active histograms , where @xmath192 is a physical quantity to be diagnosed . for compatibility with transport codes ,",
    "most distributions are produced as 1-d radial profiles in @xmath128 .",
    "the distributions are updated after each orbit - following time step as follows .",
    "first , the locations of the beginning and end point of the time step are determined for each dimension of the distribution . if the locations of the beginning and the end of the time step differ , the value @xmath193 is distributed between the bins crossed , weighed by the fraction of the time step spent in each bin .",
    "if @xmath193 changes during the time step , the value of @xmath193 is linearly interpolated in time .",
    "the exception to this rule is the @xmath194 torque , as it is gathered after the simulation , as will be described below .    the calculation of the following radial profiles is implemented in ascot : particle density  ( [ eq : density ] ) , energy density  ( [ eq : energydensity ] ) , parallel energy density  ( [ eq : parallelenergydensity ] ) , parallel current  ( [ eq : jpar ] ) , toroidal current  ( [ eq : jtor ] ) collisional power deposition to the plasma  ( [ eq : powerdeposition ] ) , toroidal @xmath194 torque  ( [ eq : jxbtorq ] ) , toroidal collisional torque  ( [ eq : colltorq ] ) , toroidal torque from changes in toroidal canonical momentum @xmath195  ( [ eq : pphitorq ] ) , and particle and energy sources and sinks from cx reactions .",
    "the corresponding weights are @xmath196 here @xmath197 is the test particle weight factor indicating how many real particles it represents , @xmath198 the kinetic energy , @xmath199 and @xmath200 the changes in particle position and canonical toroidal momentum due to the orbit integration , and @xmath201 and @xmath202 are the deterministic changes in energy and parallel momentum due to collisions with the background during @xmath171 .    any distribution can be produced as a function of @xmath128 , or @xmath133 .",
    "in addition , the density distribution  ( [ eq : density ] ) is available in four phase space dimensions @xmath203 or @xmath204 .",
    "distributions depending on interactions with the background , i.e. , the power deposition  ( [ eq : powerdeposition ] )  and the collisional torque  ( [ eq : colltorq ] ) , are produced separately for each background species .",
    "this is possible because the collisional contributions to the torque and power depositions are calculated directly as moments of the collisional term in the kinetic equation : although the distribution function is represented by the test particles , this does not mean that , e.g. , the collisional torque deposition needs to be calculated from the absolute change in the particle s momentum , as is done in ascot3 .",
    "a proper derivation reveals that only the deterministic particle motion contributes to the collisional depositions .",
    "this approach , adopted in ascot4 , also makes it straightforward to divide the collisional contribution between different background species .",
    "it should be noted that the torques , eqs .",
    "( [ eq : jxbtorq ] ) ,  ( [ eq : colltorq ] ) and  ( [ eq : pphitorq ] ) , contain only the component of @xmath205 parallel to @xmath206 , which is the torque due to a toroidal force . the expression for @xmath194 torque , eq .",
    "( [ eq : jxbtorq ] ) , is obtained by calculating @xmath207 , which , assuming an axisymmetric magnetic field @xmath208 , reduces to @xmath209 .",
    "integrating this expression in time gives the change @xmath199 .",
    "this result is particularly useful for numerical implementation : it becomes possible to calculate the @xmath194 torque as a function of @xmath128 after the simulation is done , simply finding out which histogram bins belong to the interval defined by the particle s initial and final locations in @xmath128 .",
    "after the simulation is finished , the distributions are normalized by the volumes of the bins to obtain the density .",
    "for radial distributions , the volumes of flux surfaces are obtained by direct integration for closed flux surfaces , and by monte carlo integration for open flux surfaces . for distributions in @xmath133 space ,",
    "the volumes of the bins are @xmath210 .",
    "the volume elements of velocity space are @xmath211 and @xmath212 .",
    "in addition to the distributions integrated over the history of the particles , ascot also gives the detailed information on the test particles ending up at the wall structures .",
    "not only the location at the wall but also the energy and direction of the particle hitting a material surface are recorded .",
    "this information is important when the power and particle fluxes of energetic particles on plasma - facing components have to be evaluated , e.g. , to assess that the operational limits of the wall materials are not exceeded .",
    "to carry out a detailed comparison of the results produced by ascot3 and ascot4 , we have chosen an axisymmetric jet - like magnetic background with simple 1d plasma profiles , and carried out a slowing - down simulation of 200  000 test particles representing fast ions from neutral beam injection .",
    "the toroidal field strength at the magnetic axis is 3 t and the plasma current is 1.8 ma . during the slowing - down simulation , the test particles",
    "are followed with guiding center equations of motion and coulomb collisions are applied until the particles reach an energy equal to the local background ion temperature .",
    "the ion and electron temperatures and densities for the discharge are presented in fig .",
    "[ fig : plasma_density_temperature ] . despite the capability of handling 3d wall data , in this comparison , the wall limiting the calculation regime",
    "is taken simply as an axisymmetric structure defined as a contour in the poloidal plane .    ) and temperature ( @xmath213 ) profiles for the benchmark case .",
    "the temperatures of the ion species ( @xmath214h and @xmath215c ) are assumed equal.,scaledwidth=45.0% ]    as one of ascot s applications is to produce source terms for 1d transport codes ( being a part of the jintrac suite of codes and belonging to the european transport solver ( ets ) within the itm framework ) , the quantities of high interest in our benchmark are the fast ion density , toroidal current density , toroidal @xmath194 torque , and collisional power and torque depositions , given as a function of the radial coordinate @xmath128 .",
    "these distributions are presented for the current study in figs .",
    "[ fig : fast_density][fig : torque_depositions ] .",
    "the overall agreement of the results is very good .",
    "the 1-d fast ion densities and toroidal current densities in figs .",
    "[ fig : fast_density ] and  [ fig : toroidal_current ] , respectively , are practically identical .",
    "the power depositions in fig .",
    "[ fig : power_depositions ] match well , and the small deviations reflect the different methods for collecting the data : in ascot4 , the depositions are calculated from the distribution function as described in sec .  [",
    "sec : diagnostics ] , and not from the absolute changes in the test particle phase space coordinates , as is done in ascot3 .",
    "the advantages of this approach become evident in fig .",
    "[ fig : torque_depositions ] .",
    "the collisional torques recorded with ascot4 are less noisy than the torques recorded with ascot3 , and simulations with a smaller number of test particles would highlight this effect .",
    "the @xmath216 torques presented in fig .  [ fig : torque_depositions ] agree well between the codes apart from the small anomaly in the plasma core produced by ascot3 .                 and the collisional torque deposition from neutral beam ions to the background plasma species . notice the smoother results provided by ascot4.,scaledwidth=50.0% ]    although only the @xmath128 profiles are important if the output of ascot is to be used as input for transport codes , a comparison of the 4d density distributions can be considered as a more thorough test : the @xmath128 profiles are moments of the actual distribution function , and integrals of two different functions may still agree .",
    "the spatially local test particle distribution functions calculated with ascot4 and ascot3 are presented in figures  [ fig : ascot4_4d_density ] and  [ fig : ascot3_4d_density ] , respectively , for one spatial position , showing very good agreement between the codes . in general",
    ", ascot4 appears to reliably reproduce the results of ascot3 when considering configurations where the less refined methods used in ascot3 are not expected to strongly affect the results .    )",
    "nbi slowing - down velocity space distribution from ascot4.,scaledwidth=50.0% ]    ) nbi slowing - down velocity space distribution from ascot3.,scaledwidth=50.0% ]",
    "the new version of ascot is a highly parallel code written in modern fortran .",
    "the current record ( 16th august 2012 ) is a successful test run with @xmath217 parallel processes on the international fusion energy research centre s helios supercomputer in rokkasho , japan .",
    "the problem of following non - interacting particles in a static background is straightforward to parallelize because the calculations can be made independently for each particle . in a typical case , a large number of test particle initial parameters are first stored in a file",
    ". then multiple copies of ascot acquire their own slice of the input data and perform the calculations independently .",
    "finally , the distributions as well as other output quantities are merged .",
    "there is support for two complementary mechanisms for executing ascot in parallel , one for high performance computing ( hpc ) and another for high throughput computing ( htc ) .",
    "the former uses supercomputers while the latter exploits idling workstations .",
    "the widely used message passing interface  @xcite ( mpi ) is the parallelization method of choice when ascot is executed on supercomputers .",
    "this allows up to thousands of parallel processes for the calculations , while the mpi library provides for the distribution of tasks among the parallel processes .",
    "since file access is often the bottleneck in large parallel jobs , ascot uses a single process to read the files from the disk and broadcast and scatter the contents to all the parallel processes using mpi .",
    "similarly , only one process writes the results to the output files .",
    "the ascot code is compatible with condor distributed computing software  @xcite .",
    "condor allows ascot users to harvest the idle time of workstations by executing ascot on them .",
    "all the necessary input files and the ascot binary are sent to the remote workstation by condor , so no common file system is needed .",
    "each ascot process produces an output file , all of which are returned to the user s local workstation when the process finishes .",
    "when all the processes have been successfully finished , an auxiliary program combines the results into a single output file .      at the time of compilation",
    ", ascot requires only a single external library to be provided by the host system : hdf5  @xcite . practically all ascot output and",
    "an increasing part of the input is in the hdf5 format .",
    "it is a binary format widely supported both in hpc facilities and programming languages .",
    "using hdf5 offers high - performance time - resilient storage for ascot data .",
    "an extensive set of analysis and visualization tools have been written for matlab and are available for the users . inside ascot ,",
    "parts of several large and small libraries are used .",
    "the code is stored in a version control system and , within this repository , the code base also includes parts of the following libraries : pspline  @xcite for splines , kracken  @xcite for parsing command line arguments , quadpack  @xcite for numerical integration , and slatec  @xcite for elliptical integrals . the mpi library is usually used with ascot , but if it is not available , stubs  @xcite are used instead . for random numbers we use the well - known mersenne twister algorithm and library  @xcite .",
    "with the goal of providing the fusion community with a comprehensive test ion code optimized for fusion applications , we have redesigned the monte carlo orbit - following code ascot . a formalism that allows solving the kinetic equation for minority ions ,",
    "be they energetic ions or impurity species , in a manner where the hamiltonian particle motion and collisions are treated consistently , was developed both for the full gyro motion and in the guiding center formalism . to incorporate all the relevant physics , ascot",
    "was written to operate in full 3d , thus automatically including all neoclassical drifts .",
    "it uses a physical 3d bounding surface , corresponding to the first wall of a fusion device , and includes models for mhd processes relevant for fast ion distribution as well as background flow and atomic reactions that are important for impurity ions .",
    "ascot features first - principles sources for energetic particles corresponding to alphas and neutrons from thermonuclear , beam - target and beam - beam fusion reactions , as well as ions resulting from neutral beam injection . a simple model for icrh - accelerated ions is also provided .",
    "simulation results are given as n - dimensional distributions , where up to two velocity dimensions and two spatial dimensions can be assigned .",
    "furthermore , the distribution of ions ending up at the first wall is available , including the information of their energy and direction . to this end",
    ", an accurate and efficient description of the first wall and a sophisticated wall - collision algorithm were incorporated into the code .    in the process of redesigning ascot , shortcomings in the conventional approach were discovered and fixed .",
    "first and foremost was the use of a full gyro motion collision operator when the hamiltonian motion of test ions was treated within the guiding center formalism .",
    "furthermore , for historical reasons , the collision operator used different velocity space coordinates than those used for the equations of motion . yet another discrepancy , deriving from the historical development of fast ion codes , is the inconsistency in integrating the hamiltonian motion with high - level integrators while often treating the deterministic part of the collision operator with the very crude euler method .    in the new ascot ,",
    "coulomb collisions are now treated consistently with the hamiltonian motion and , in the guiding center formalism , spatial diffusion , as given in eq .",
    "( [ eq : spatial ] ) , is introduced in addition to the velocity space diffusion .",
    "the remaining question is whether the collisional contribution has to be treated as accurately as the hamiltonian motion .",
    "work to implement the consistent numerical integration schemes is ongoing .",
    "j.  a. heikkinen , s.  k. sipil , http://link.aip.org/link/?php/2/3724/1[power transfer and current generation of fast ions with large-@xmath218 waves in tokamak plasmas ] , physics of plasmas 2  ( 10 ) ( 1995 ) 37243733 .",
    "http://dx.doi.org/10.1063/1.871072 [ ] .",
    "http://link.aip.org/link/?php/2/3724/1    t.  kiviniemi , t.  kurki - suonio , s.  sipil , j.  heikkinen , a.  peeters , http://dx.doi.org/10.1023/a%3a1012846201220[radial electric field shear due to neoclassical effects in transport barriers ] , czechoslovak journal of physics 51  ( 10 ) ( 2001 ) 10531064 . http://dx.doi.org/10.1023/a:1012846201220 [ ] . http://dx.doi.org/10.1023/a%3a1012846201220    t.  kurki - suonio , o.  asunta , t.  hellsten , v.  hynnen , t.  johnson , t.  koskela , j.  lnnroth , v.  parail , m.  roccella , g.  saibene , a.  salmi , s.  sipil , http://stacks.iop.org/0029-5515/49/i=9/a=095001[ascot simulations of fast ion power loads to the plasma - facing components in iter ] , nuclear fusion 49  ( 9 ) ( 2009 ) 095001 .",
    "http://dx.doi.org/10.1088/0029-5515/49/9/095001 [ ] .",
    "t.  kurki - suonio , o.  asunta , e.  hirvijoki , t.  koskela , a.  snicker , t.  hauff , f.  jenko , e.  poli , s.  sipil , http://stacks.iop.org/0029-5515/51/i=8/a=083041[fast ion power loads on iter first wall structures in the presence of ntms and microturbulence ] , nuclear fusion 51  ( 8) ( 2011 ) 083041 .",
    "o.  asunta , s.  kslompolo , t.  kurki - suonio , t.  koskela , s.  sipil , a.  snicker , m.  garca - muoz , the asdex upgrade  team , http://stacks.iop.org/0029-5515/52/i=9/a=094014[simulations of fast ion wall loads in asdex upgrade in the presence of magnetic perturbations due to elm - mitigation coils ] , nuclear fusion 52  ( 9 ) ( 2012 ) 094014 .",
    "http://dx.doi.org/10.1088/0029-5515/52/9/094014 [ ] .",
    "http://stacks.iop.org/0029-5515/52/i=9/a=094014    v.  hynnen , t.  kurki - suonio , w.  suttrop , a.  stbler , the asdex upgrade  team , http://stacks.iop.org/0741-3335/50/035014[effect of radial electric field and ripple on edge neutral beam ion distribution in asdex upgrade ] , plasma physics and controlled fusion 50  ( 3 ) ( 2008 ) 035014 ( 15pp ) .",
    "http://dx.doi.org/10.1088/0741-3335/50/3/035014 [ ] .",
    "http://stacks.iop.org/0741-3335/50/035014    a.  j. brizard , http://link.aip.org/link/?php/11/4429/1[a guiding - center fokker ",
    "planck collision operator for nonuniform magnetic fields ] , physics of plasmas 11  ( 9 ) ( 2004 ) 44294438 . http://dx.doi.org/10.1063/1.1780532 [ ] .",
    "http://link.aip.org/link/?php/11/4429/1    e.  hirvijoki , a.  brizard , a.  snicker , t.  kurki - suonio , http://link.aip.org/link/?php/20/092505/1[monte carlo implementation of a guiding - center fokker - planck kinetic equation ] , physics of plasmas 20  ( 9 ) ( 2013 ) 092505 .",
    "http://dx.doi.org/10.1063/1.4820951 [ ] .",
    "j.  a. heikkinen , s.  k. sipil , t.  j.  h. pttikangas , http://www.sciencedirect.com/science/article/\\newline    b6tj5 - 46jymp4 - 4t/2/fba61a679f0da244c7c01213858cd5e6[monte carlo simulation of runaway electrons in a toroidal geometry ] , computer physics communications 76  ( 2 ) ( 1993 ) 215230 .",
    "http://dx.doi.org/10.1016/0010-4655(93)90133-w [ ] .",
    "b6tj5 - 46jymp4 - 4t/2/fba61a679f0da244c7c01213858cd5e6[http://www.sciencedirect.com / science / article/\\newline    b6tj5 - 46jymp4 - 4t/2/fba61a679f0da244c7c01213858cd5e6 ]    t.  k. kurki - suonio , m.  j. alava , s.  k. sipil , j.  a. heikkinen , http://dx.doi.org/10.1002/ctpp.2150340214[monte carlo simulation of edge ion dynamics in the presence of collisions and a radial electric field ] , contributions to plasma physics 34  ( 2 - 3 ) ( 1994 ) 180185 .",
    "http://dx.doi.org/10.1002/ctpp.2150340214 [ ] .",
    "j.  a. heikkinen , w.  herrmann , t.  kurki - suonio , http://link.aip.org/link/?php/4/3655/1[the effect of a radial electric field on ripple - trapped ions observed by neutral particle fluxes ] , physics of plasmas 4  ( 10 ) ( 1997 ) 36553662 .",
    "http://dx.doi.org/10.1063/1.872261 [ ] .",
    "j.  heikkinen , w.  herrmann , t.  kurki - suonio , http://stacks.iop.org/0029-5515/38/i=3/a=308[fast response in the ripple trapped ion distribution to abrupt changes in a radial electric field in tokamaks ] , nuclear fusion 38  ( 3 ) ( 1998 ) 419 .",
    "j.  a. heikkinen , t.  kurki - suonio , http://link.aip.org/link/?php/5/692/1[analysis of the tokamak ripple - blocked ion distribution with abrupt changes of a radial electric field ] , physics of plasmas 5  ( 3 ) ( 1998 ) 692704 .",
    "http://dx.doi.org/10.1063/1.872756 [ ] .",
    "j.  a. heikkinen , t.  kurki - suonio , w.  herrmann , http://stacks.iop.org/0741-3335/40/i=5/a=022[ripple-trapped beam ions in the presence of a radial electric field ] , plasma physics and controlled fusion 40  ( 5 ) ( 1998 ) 679 .",
    "w.  herrmann , j.  a. heikkinen , t.  kurki - suonio , the asdex upgrade  team , http://stacks.iop.org/0741-3335/40/i=5/a=023[the time behaviour of radial electric fields at the l - h transition from the observation of ripple - trapped ions ] , plasma physics and controlled fusion 40  ( 5 ) ( 1998 ) 683 .",
    "t.  kurki - suonio , s.  k. sipil , j.  a. heikkinen , http://stacks.iop.org/0741-3335/42/a277[active diagnostic of edge @xmath219 using neutral - particle analysers ] , plasma physics and controlled fusion 42  ( 5a ) ( 2000 ) a277a282 . http://dx.doi.org/10.1088/0741-3335/42/5a/333 [ ] .",
    "w.  w. heidbrink , t.  beitzel , k.  h. burrell , r.  colchin , c.  w. guldi , t.  kurki - suonio , http://stacks.iop.org/0741-3335/43/i=4/a=301[the effect of electric fields and pitch - angle scattering on the radial neutral flux ] , plasma physics and controlled fusion 43  ( 4 ) ( 2001 ) 373 .",
    "j.  a. heikkinen , t.  p. kiviniemi , a.  g. peeters , t.  kurki - suonio , s.  k. sipil , w.  herrmann , w.  suttrop , h.  zohm , http://stacks.iop.org/0741-3335/40/i=5/a=025[ion orbit loss current in asdex upgrade ] , plasma physics and controlled fusion 40  ( 5 ) ( 1998 ) 693 .",
    "t.  kiviniemi , j.  heikkinen , a.  peeters , t.  kurki - suonio , s.  sipil , http://lib.tkk.fi/diss/2001/\\newline    isbn9512255383/article7.pdf[transport barrier formation : self - consistent simulation and comparison with asdex upgrade experiments ] , chech .",
    "journal of physics 49 ( 1999 ) 8192 .",
    "/ diss/2001/\\newline    isbn9512255383/article7.pdf ]    t.  p. kiviniemi , j.  a. heikkinen , a.  g. peeters , t.  kurki - suonio , s.  k. sipil , http://stacks.iop.org/0741-3335/42/i=5a/a=320[critical assessment of ion loss mechanisms for l - h transition ] , plasma physics and controlled fusion 42  ( 5a ) ( 2000 ) a185 .",
    "j.  a. heikkinen , s.  jachmich , t.  p. kiviniemi , t.  kurki - suonio , a.  g. peeters , http://link.aip.org/link/?php/8/2824/1[bifurcation of the radial electric field in the presence of edge polarization in tokamaks ] , physics of plasmas 8  ( 6 ) ( 2001 ) 28242834 . http://dx.doi.org/10.1063/1.1368877 [ ] . http://link.aip.org/link/?php/8/2824/1    a.  heikkinen , t.  kiviniemi , t.  kurki - suonio , a.  peeters , s.  sipil , http://www.sciencedirect.com/science/article/\\newline    pii / s0021999101968913[particle simulation of the neoclassical plasmas ] , journal of computational physics 173  ( 2 ) ( 2001 ) 527  548 . http://dx.doi.org/http://dx.doi.org/10.1006/jcph.2001.6891 [ ] .",
    "pii / s0021999101968913[http://www.sciencedirect.com / science / article/\\newline    pii / s0021999101968913 ]    s.  lashkul , v.  budnikov , v.  dyachenko , l.  esipov , e.  its , m.  kantor , d.  kouprenko , a.  popov , p.  goncharov , e.  gourevich , s.  shatalin , v.  yermolaev , e.  vekshina , t.  kurki - suonio , j.  heikkinen , http://www.jspf.or.jp/jpfrs/pdf/vol4/\\newline    jpfrs2001_04 - 229.pdf[formation of transport barrier in lower hybrid experiment on ft-2 tokamak ] , journal of plasma and fusion research 4 ( 2001 ) 229233 .",
    "jpfrs2001_04 - 229.pdf[http://www.jspf.or.jp / jpfrs / pdf / vol4/\\newline    jpfrs2001_04 - 229.pdf ]    t.  kurki - suonio , s.  i. lashkul , j.  a. heikkinen , http://stacks.iop.org/0741-3335/44/i=3/a=302[formation and detection of internal transport barriers in low - current tokamaks ] , plasma physics and controlled fusion 44  ( 3 ) ( 2002 ) 301 .",
    "http://stacks.iop.org/0741-3335/44/i=3/a=302    t.  kurki - suonio , j.  a. heikkinen , s.  i. lashkul , http://link.aip.org/link/?php/14/072510/1[guiding-center simulations of nonlocal and negative inertia effects on rotation in a tokamak ] , physics of plasmas 14  ( 7 ) ( 2007 ) 072510 . http://dx.doi.org/10.1063/1.2749501 [ ] . http://link.aip.org/link/?php/14/072510/1    w.  fundamenski , s.  sipil , t.  eich , t.  kiviniemi , t.  kurki - suonio , g.  matthews , v.  riccardo , http://www.sciencedirect.com/science/article/\\newline    pii / s0022311502014320[narrow power profiles seen at jet and their relation to ion orbit losses ] , journal of nuclear materials 313 - 316  ( 0 ) ( 2003 ) 787  795 , plasma - surface interactions in controlled fusion devices 15 . http://dx.doi.org/http://dx.doi.org/10.1016/s0022-3115(02)01432-0 [ ] . http://www.sciencedirect.com/science/article/\\newline    pii / s0022311502014320[http://www.sciencedirect.com / science / article/\\newline    pii / s0022311502014320 ]    g.  matthews , g.  corrigan , s.  erents , w.  fundamenski , a.  kallenbach , t.  kurki - suonio , s.  sipil , j.  spence , http://www.sciencedirect.com/science/article/\\newline    pii / s0022311502015714[the effect of ion orbit losses on jet edge plasma simulations ] , journal of nuclear materials 313 - 316  ( 0 ) ( 2003 ) 986  989 , plasma - surface interactions in controlled fusion devices 15 .",
    "http://dx.doi.org/http://dx.doi.org/10.1016/s0022-3115(02)01571-4 [ ] .",
    "pii / s0022311502015714[http://www.sciencedirect.com / science / article/\\newline    pii / s0022311502015714 ]    t.  kurki - suonio , t.  kiviniemi , s.  sipil , j.  heikkinen , w.  fundamenski , g.  matthews , http://link.springer.com/content/pdf/\\newline    10.1023%2fa%3a1012854403037.pdf[significance of the radial electric field to divertor load asymmetries ] , chech .",
    "journal of physics 51 ( 2001 ) 10971105 .",
    "10.1023%2fa%3a1012854403037.pdf[http://link.springer.com / content / pdf/\\newline    10.1023%2fa%3a1012854403037.pdf ]    t.  kurki - suonio , t.  kiviniemi , s.  sipil , j.  heikkinen , w.  fundamenski , g.  matthews , v.  riccardo , http://stacks.iop.org/0029-5515/42/i=6/a=310[monte carlo simulations of the heat load asymmetries on jet divertor plates ] , nuclear fusion 42  ( 6 ) ( 2002 ) 725 .",
    "w.  fundamenski , s.  sipil , g.  f. matthews , v.  riccardo , p.  andrew , t.  eich , l.  c. ingesson , t.  kiviniemi , t.  kurki - suonio , v.  philipps , contributors to  the efda - jet work  programme , http://stacks.iop.org/0741-3335/44/i=6/a=311[interpretation of recent power width measurements in jet mkiigb elmy h - modes ] , plasma physics and controlled fusion 44  ( 6 ) ( 2002 ) 761 .",
    "l.  k. aho - mantila , t.  kurki - suonio , a.  v. chankin , d.  p. coster , s.  k. sipil , http://stacks.iop.org/0741-3335/50/i=6/a=065021[ascot simulations of electron energy distribution at the divertor targets in an asdex upgrade h - mode discharge ] , plasma physics and controlled fusion 50  ( 6 ) ( 2008 ) 065021 .",
    "g.  kramer , b.  budny , r.  ellis , m.  gorelenkova , w.  heidbrink , t.  kurki - suonio , r.  nazikian , a.  salmi , m.  schaffer , k.  shinohara , j.  snipes , d.  spong , t.  koskela , m.  v. zeeland , http://stacks.iop.org/0029-5515/51/i=10/a=103029[fast-ion effects during test blanket module simulation experiments in diii - d ] , nuclear fusion 51  ( 10 ) ( 2011 ) 103029 .",
    "a.  snicker , t.  kurki - suonio , s.  k. sipil , realistic simulations of fast - ion wall distribution including effects due to finite larmor radius , plasma science , ieee transactions on 38  ( 9 ) ( 2010 ) 2177 2184 . http://dx.doi.org/10.1109/tps.2010.2056705 [ ] .",
    "a.  snicker , s.  sipil , t.  kurki - suonio , http://stacks.iop.org/0029-5515/52/i=9/a=094011[orbit-following fusion alpha wall load simulation for iter scenario 4 including full orbit effects ] , nuclear fusion 52  ( 9 ) ( 2012 ) 094011 .",
    "http://stacks.iop.org/0029-5515/52/i=9/a=094011    j.  miettunen , t.  kurki - suonio , t.  makkonen , m.  groth , a.  hakola , e.  hirvijoki , k.  krieger , j.  likonen , s.  kslompolo , the asdex upgrade  team , http://stacks.iop.org/0029-5515/52/i=3/a=032001[the effect of non - axisymmetric wall geometry on 13c transport in asdex upgrade ] , nuclear fusion 52  ( 3 ) ( 2012 ) 032001 .",
    "http://dx.doi.org/doi:10.1088/0029-5515/52/3/032001 [ ] .",
    "http://stacks.iop.org/0029-5515/52/i=3/a=032001    j.  miettunen , m.  groth , t.  kurki - suonio , h.  bergsker , j.  likonen , s.  marsen , c.  silva , s.  kslompolo , http://www.sciencedirect.com/science/article/\\newline    pii / s0022311513001360[predictive ascot modelling of @xmath220be transport in jet with the iter - like wall ] , journal of nuclear materials 438 , supplement  ( 0 ) ( 2013 ) s612  s615 , proceedings of the 20th international conference on plasma - surface interactions in controlled fusion devices . http://dx.doi.org/http://dx.doi.org/10.1016/j.jnucmat.2013.01.128 [ ] .",
    "pii / s0022311513001360[http://www.sciencedirect.com / science / article/\\newline    pii / s0022311513001360 ]    a.  kolmogoroff , http://dx.doi.org/10.1007/bf01457949[ber die analytischen methoden in der wahrscheinlichkeitsrechnung ] , mathematische annalen 104  ( 1 ) ( 1931 ) 415458 . http://dx.doi.org/10.1007/bf01457949 [ ]",
    ". http://dx.doi.org/10.1007/bf01457949",
    "a.  kolmogorov , http://books.google.fi/books?id=ob4raaaayaaj[grundbegriffe der wahrscheinlichkeitsrechnung ] , ergebnisse der mathematik und ihrer grenzgebiete , julius springer , 1933 .",
    "http://books.google.fi/books?id=ob4raaaayaaj    j.  r. cary , a.  j. brizard , http://link.aps.org/doi/10.1103/revmodphys.81.693[hamiltonian theory of guiding - center motion ] , rev .",
    "81 ( 2009 ) 693738 . http://dx.doi.org/10.1103/revmodphys.81.693 [ ] . http://link.aps.org/doi/10.1103/revmodphys.81.693      s.  ichimaru , http://books.google.fi/books?id=yirraaaamaaj[basic principles of plasma physics : a statistical approach ] , frontiers in physics , benjamin , 1973 .",
    "bosch , g.  hale , http://stacks.iop.org/0029-5515/32/i=4/a=i07[improved formulas for fusion cross - sections and thermal reactivities ] , nuclear fusion 32  ( 4 ) ( 1992 ) 611 .",
    "r.  goldston , d.  mccune , h.  towner , s.  davis , r.  hawryluk , g.  schmidt , http://www.sciencedirect.com/science/article/\\newline    pii/002199918190111x[new techniques for calculating heat and particle source rates due to neutral beam injection in axisymmetric tokamaks ] , journal of computational physics 43  ( 1 ) ( 1981 ) 61  78 . http://dx.doi.org/http://dx.doi.org/10.1016/0021-9991(81)90111-x [ ] .",
    "pii/002199918190111x[http://www.sciencedirect.com / science / article/\\newline    pii/002199918190111x ]    a.  pankin , d.  mccune , r.  andre , g.  bateman , a.  kritz , http://www.sciencedirect.com/science/article/\\newline    pii / s0010465504001109[the tokamak monte carlo fast ion module nubeam in the national transport code collaboration library ] , computer physics communications 159  ( 3 ) ( 2004 ) 157  184 . http://dx.doi.org/http://dx.doi.org/10.1016/j.cpc.2003.11.002",
    "pii / s0010465504001109[http://www.sciencedirect.com / science / article/\\newline    pii / s0010465504001109 ]    s.  suzuki , t.  shirai , m.  nemoto , k.  tobita , h.  kubo , t.  sugie , a.  sakasai , y.  kusama , http://stacks.iop.org/0741-3335/40/2097[attenuation of high - energy neutral hydrogen beams in high - density plasmas ] , plasma physics and controlled fusion 40  ( 12 ) ( 1998 ) 20972111 .",
    "http://dx.doi.org/10.1088/0741-3335/40/12/009 [ ] .",
    "j.  hedin , t.  hellsten , l .- g .",
    "eriksson , t.  johnson , http://stacks.iop.org/0029-5515/42/i=5/a=305[the influence of finite drift orbit width on icrf heating in toroidal plasmas ] , nuclear fusion 42  ( 5 ) ( 2002 ) 527 .",
    "t.  hellsten , t.  johnson , j.  carlsson , l .- g .",
    "eriksson , j.  hedin , m.  laxback , m.  mantsinen , http://stacks.iop.org/0029-5515/44/i=8/a=008[effects of finite drift orbit width and rf - induced spatial transport on plasma heated by icrh ] , nuclear fusion 44  ( 8) ( 2004 ) 892 .",
    "m.  brambilla , http://www.ingentaconnect.com/content/\\newline    iop / ppcf/1999/00000041/00000001/art00002[numerical simulation of ion cyclotron waves in tokamak plasmas ] , plasma physics and controlled fusion 41  ( 1 ) ( 1999 ) 134 .",
    "http://www.ingentaconnect.com/content/\\newline    iop / ppcf/1999/00000041/00000001/art00002[http://www.ingentaconnect.com / content/\\newline    iop / ppcf/1999/00000041/00000001/art00002 ]    j.  wright , j.  lee , e.  valeo , p.  bonoli , c.  phillips , e.  jaeger , r.  harvey , challenges in self - consistent full - wave simulations of lower hybrid waves , plasma science , ieee transactions on 38  ( 9 ) ( 2010 ) 21362143 .",
    "http://dx.doi.org/10.1109/tps.2010.2055167 [ ] .",
    "e.  hirvijoki , a.  snicker , t.  korpilo , p.  lauber , e.  poli , m.  schneller , t.  kurki - suonio , http://www.sciencedirect.com/science/article/\\newline    pii / s0010465512002378[alfvn eigenmodes and neoclassical tearing modes for orbit - following implementations ] , computer physics communications 183  ( 12 ) ( 2012 ) 2589  2593 . http://dx.doi.org/10.1016/j.cpc.2012.07.009 [ ] .",
    "pii / s0010465512002378[http://www.sciencedirect.com / science / article/\\newline    pii / s0010465512002378 ]      p.  lauber , s.  gnter , a.  knies , s.  pinches , http://www.sciencedirect.com/science/article/pii/\\s0021999107001660[ligka : a linear gyrokinetic code for the description of background kinetic and fast particle effects on the mhd stability in tokamaks ] , journal of computational physics 226  ( 1 ) ( 2007 ) 447  465 .",
    "http://dx.doi.org/10.1016/j.jcp.2007.04.019 [ ] .",
    "http://www.sciencedirect.com / science / article / pii/\\s002% 1999107001660[http://www.sciencedirect.com / science / article / pii/\\s002% 1999107001660 ]    n.  asakura , http://www.sciencedirect.com/science/article/\\newline    pii / s0022311506006325[understanding the sol flow in l - mode plasma on divertor tokamaks , and its influence on the plasma transport ] , journal of nuclear materials 363 365  ( 0 ) ( 2007 ) 41  51 , plasma - surface interactions-17 . http://dx.doi.org/http://dx.doi.org/10.1016/j.jnucmat.2006.12.029 [ ] .",
    "pii / s0022311506006325[http://www.sciencedirect.com / science / article/\\newline    pii / s0022311506006325 ]      d.  badouel , http://dl.acm.org/citation.cfm?id=90767.90867[graphics gems ] , academic press professional , inc . , san diego , ca , usa , 1990 , ch . an efficient ray - polygon intersection , pp .",
    "j.  s. urban , kracken(3f ) : the ultimate fortran command line argument cracker , http://home.comcast.net/~urbanjost/clone/\\newline    kracken / krackenhelp.html[http://home.comcast.net/~urbanjost / clone/\\newline    kracken / krackenhelp.html ] .",
    "w.  h. vandevender , k.  h. haskell , http://doi.acm.org/10.1145/1057594.1057595[the slatec mathematical subroutine library ] , signum newsl .",
    "17  ( 3 ) ( 1982 ) 1621 . http://dx.doi.org/10.1145/1057594.1057595 [ ] . http://doi.acm.org/10.1145/1057594.1057595    j.  burkardt , mpi_stubs  dummy mpi library , http://people.sc.fsu.edu/~jburkardt/f_src/\\newline    mpi_stubs / mpi_stubs.html[http://people.sc.fsu.edu/~jburkardt / f_src/\\newline    mpi_stubs / mpi_stubs.html ] .",
    "m.  matsumoto , t.  nishimura , http://doi.acm.org/10.1145/272991.272995[mersenne twister : a 623-dimensionally equidistributed uniform pseudo - random number generator ] , acm trans .",
    "simul . 8  ( 1 ) ( 1998 ) 330 . http://dx.doi.org/10.1145/272991.272995 [ ] . http://doi.acm.org/10.1145/272991.272995"
  ],
  "abstract_text": [
    "<S> a comprehensive description of methods , suitable for solving the kinetic equation for fast ions and impurity species in tokamak plasmas using monte carlo approach , is presented . </S>",
    "<S> the described methods include hamiltonian orbit - following in particle and guiding center phase space , test particle or guiding center solution of the kinetic equation applying stochastic differential equations in the presence of coulomb collisions , neoclassical tearing modes and alfvn eigenmodes as electromagnetic perturbations relevant to fast ions , together with plasma flow and atomic reactions relevant to impurity studies . applying the methods , </S>",
    "<S> a complete reimplementation of the well - established minority species code ascot is carried out as a response both to the increase in computing power during the last twenty years and to the weakly structured growth of the code , which has made implementation of additional models impractical . </S>",
    "<S> also , a benchmark between the previous code and the reimplementation is accomplished , showing good agreement between the codes .    </S>",
    "<S> orbit - following , impurity tracing , monte carlo , fast ions 52.65.-y , 52.65.ff , 52.25.vy , 52.20.dq </S>"
  ]
}