{
  "article_text": [
    "let @xmath0 @xmath1 be an open and bounded set , @xmath2 be an intensity image , and consider the family of filters to which we shall refer broadly as to _ bilateral filters _ , defined by @xmath3 where @xmath4 and @xmath5 are positive constants , and @xmath6 is a normalization factor .",
    "functions @xmath7 and @xmath8 are the _ range _ kernel and the _ spatial _ kernel of the filter , respectively , making reference to their type of interaction with the image domain .",
    "a usual choice for @xmath9 is the gaussian @xmath10 , while different choices of @xmath8 give rise to several well known neighborhood filters , e.g. ,    * the neighborhood filter , see @xcite , for @xmath11 . * the yaroslavsky filter @xcite , for @xmath12 , the characteristic function of a ball centered at @xmath13 of radios @xmath5 . *",
    "the susan @xcite or bilateral filters @xcite , for @xmath14 .",
    "these filters have been introduced in the last decades as alternatives to local methods such as those expressed in terms of nonlinear diffusion partial differential equations ( pde ) , among which the pioneering approaches of perona and malik @xcite , lvarez , lions and morel @xcite and rudin , osher and fatemi @xcite are fundamental .",
    "we refer the reader to @xcite for a review and comparison of these methods .",
    "neighborhood filters have been mathematically analyzed from different points of view .",
    "for instance , barash @xcite , elad @xcite , barash et al .",
    "@xcite , and buades et al .",
    "@xcite investigate the asymptotic relationship between the yaroslavsky filter and the perona - malik equation .",
    "gilboa et al .",
    "@xcite study certain applications of nonlocal operators to image processing . in @xcite",
    ", peyr establishes a relationship between nonlocal filtering schemes and thresholding in adapted orthogonal basis . in a more recent paper , singer et al .",
    "@xcite interpret the neighborhood filter as a stochastic diffusion process , explaining in this way the attenuation of high frequencies in the processed images .    from the computational point of view , until the reformulation given by porikli @xcite , their actual implementation was of limited use due to the high computational demand of the direct space - range discretization .",
    "only window - sliding optimization , like that introduced by weiss @xcite to avoid redundant kernel calculations , or filter approximations , like the introduced by paris and durand @xcite , were of computational use . in @xcite , the space and range domains are merged into a single domain where the bilateral filter may be expressed as a linear convolution , followed by two simple nonlinearities .",
    "this allowed the authors to derive simple down - sampling criteria which were the key for filtering acceleration .",
    "however , in @xcite , the author introduced a new _ exact _ discrete formulation of the bilateral filter for spatial box kernel ( yarsolavsky filter ) using the local histograms of the image , @xmath15 , where @xmath16 is the box of radios @xmath5 centered at pixel @xmath13 , arriving to the formula @xmath17 where the range of summation is over the quantized values of the image , @xmath18 , instead of over the pixel spatial range .",
    "in addition , a zig - zag pixel scanning technique was used so that the local histogram is actualized only in the borders of the spatial kernel box .",
    "formula ( [ porikli ] ) is an exact formulation of the box filter where all the terms but the local histogram may be computed separately in constant time , and it is therefore referred to as a _ constant time @xmath19 method_.    unfortunately , the use of local histograms is only valid for constant - wise spatial kernels , and subsequent applications of the new formulation to general spatial kernels is , with the exception of polynomial and trigonometric polynomial kernels , only approximated .",
    "thus , in @xcite polynomial approximation was used to deal with the usual spatial gaussian kernel .",
    "this idea was improved in @xcite by using trigonometric expansions .    in @xcite ,",
    "yang et al . introduced a new @xmath19 method capable of handling arbitrary spatial and range kernels , as an extension of the ideas of durand et al @xcite .",
    "they use the so - called principle bilateral filtered image component @xmath20 , given by , for @xmath21 , @xmath22 where @xmath23 is some neighborhood of @xmath13 .",
    "then , the bilateral filter may be expressed as @xmath24 . in practice ,",
    "only a subset of the range values is considered , and the final filtered image is produced by linear interpolation . in this situation",
    "this filter is , thus , an approximation to the bilateral filter .",
    "the same authors have recently extended and optimized @xcite the method of paris et al .",
    "@xcite by solving cost volume aggregation problems .",
    "other approaches include that of kass et al .",
    "@xcite , who used a smoothed histogram to accelerate median filtering and proposed mode - based filters .",
    "adams et al .",
    "@xcite proposed to use gaussian kd - trees for efficient high - dimensional gaussian filtering , integrating this method with paris et al .",
    "method @xcite for fast bilateral filtering .",
    "they later proposed to use permutohedral lattice @xcite for bilateral filtering , which is faster than gaussian kd - trees for relatively lower dimensionality .",
    "however , both gaussian kd - trees and permutohedral lattice are relatively less efficient when applied to intensity images . ram et al .",
    "@xcite used a smooth patches reordering to image denoising and inpainting which , when the patches are shrunk to pixels , contain similar ideas to the decreasing rearrangement approach .",
    "a review of some of these methods may be found in @xcite .      in @xcite",
    ", we heuristically introduced a denoising algorithm based in the neighborhood filter for denoising images produced as time - frequency representations of one - dimensional signals , for which the large computational effort made useless other denoising methods based on pde s .",
    "the main observation was that the neighborhood filter can be computed using only the level sets of the image , instead of the pixel space , producing a fast denoising algorithm .",
    "in @xcite , this idea was rendered to a rigorous mathematical formulation through the notion of _ decreasing rearrangement _ of a function . in short",
    ", the decreasing rearrangement of @xmath25 , denoted by @xmath26 , is defined as the inverse of the _ distribution function _ @xmath27 , see section 2 for the precise definition and some of its properties .",
    "realizing that the structure of level sets of @xmath25 is invariant through the neighborhood filter operation as well as through the decreasing rearrangement of @xmath25 allowed us to rewrite ( [ def.nl ] ) , for the homogeneous kernel @xmath11 , in terms of the one - dimensional integral expression @xmath28 which is computed jointly for all the pixels in each level set @xmath29 .",
    "perhaps , the most important consequence of using the rearrangement was , apart from the large dimensional reduction , the reinterpretation of the neighborhood filter as a _ local _ algorithm . indeed ,",
    "notice that since @xmath26 is decreasing , we have @xmath30 for some continuous function @xmath31 .",
    "thus , the range kernel of the pixel - based filter ( [ def.nl ] ) , whose support in the pixel space may be disconnected , is transformed into a local kernel in its rearranged version ( [ def.nfin ] ) .",
    "thanks to this we proved , among others , the following properties for the most usual nonlinear iterative variant of the neighborhood filter :    * the asymptotic behavior of @xmath32 as a shock filter of the type introduced by lvarez et al .",
    "@xcite , combined with a contrast loss effect . * the contrast change character of the neighborhood filter , i.e. the existence of a continuous and increasing function @xmath33 such that @xmath34      in this article we extend the use of functional rearranging techniques , as introduced in @xcite , to bilateral filters which , in the discrete case and for the spatial box window , coincides with the bilateral filter reformulation given by porikli @xcite .",
    "we provide a rigorous mathematical ground which allows to interpret the discrete formulas of @xcite , and their extension to general spatial and range kernels , as the discrete counterpart of continuous pixel - space formulations .",
    "the formulas we obtain for general bilateral filters allows to reinterpret these filters from the range space point of view , as a natural extension to porikli s discrete model .",
    "in addition , these formulas may be computationally competitive when a high degree of approximation to the pixel - based formulation is required .",
    "this work may be considered as a non trivial extension of the rearranging techniques introduced in @xcite for the simpler neighborhood filter .",
    "thus , even if the spatial kernel @xmath8 is non - homogeneous , we may still use our approach by introducing the _ relative rearrangement _ of the spatial kernel with respect to the image , see section 2 for definitions .    using this tool",
    ", we may express the general bilateral filter ( [ def.nl ] ) in terms of the one - dimensional integral expression @xmath35 where @xmath36 denotes the relative rearrangement of @xmath37 with respect to @xmath25 .    to gain some insight into formula ( [ def.ubar0 ] ) ,",
    "let us consider a constant - wise interpolation of a given image , @xmath25 , quantized in @xmath38 levels labeled by @xmath39 , with @xmath40 .",
    "that is @xmath41 where @xmath42 are the level sets of @xmath25 , @xmath43 similarly , let @xmath8 be a constant - wise interpolation of the spatial kernel quantized in @xmath44 levels , @xmath45 , with @xmath46 . for each @xmath47 , consider the partition of @xmath42 given by @xmath48 then , we show in theorems  [ th.equivalence ] and [ th.approximation ] that for each @xmath49 , @xmath50 @xmath51 where @xmath52 , with @xmath53 denoting set measure ( number of pixels ) .",
    "that is , @xmath54 is the number of pixels in the @xmath39-level set of @xmath25 that belongs to the @xmath45-level set of @xmath8 .",
    "observe that , like for the neighborhood filter , the range kernel is transformed into a local kernel , independent of the pixel location , and it is therefore computed once and for all , explaining the large gain in computational cost , as already observed in @xcite .",
    "in fact , notice that in the particular case in which @xmath8 is taken as a box window we have that @xmath55 is just the local histogram , @xmath56 , used in porikli s formula , so ( [ porikli ] ) and ( [ def.ubar0 ] ) coincide in this case .",
    "however , the rearranged formula ( [ def.ubar0 ] ) is valid for any other shape of the spatial kernel .",
    "the results in this article may be summarized as follows :    \\1 .",
    "the rearranged formulation ( [ def.ubar0 ] ) is exact and has no restrictions on the spatial or range kernels shape ( theorem  [ th.equivalence ] ) .",
    "in fact , our results are not limited to the special functional form of the spatial kernel , @xmath57 , that we considered along this article .",
    "one can easily modify our arguments to deal with more general kernels of the type @xmath58 , thus including other well known filters like the median filter or the cross - joint bilateral filter @xcite .",
    "we preferred to limit ourselves to bilateral type filters for the sake of clarity , and leave the more general case to future developments of the work .",
    "when restricted to a spatial box kernel , the relative rearrangement term of formula ( [ def.ubar0 ] ) is just the local histogram , like in porikli s discrete formulation . for more general spatial kernels ,",
    "the relative rearrangement may be interpreted as an averaged local histogram evaluated on the kernel level sets , extending in this way the notion of local histogram and the discrete formulation of @xcite .",
    "we establish the relationship between the discrete and the continuous image setting of the rearranged version of the bilateral filter , proving the convergence of constantwise interpolators to their continuous counterpart ( theorems  [ th.convergence ] ,  [ th.approximation ] ) .",
    "the plan of the article is the following . in section  2",
    "we recall the notions of decreasing and relative rearrangements and motivate the deduction of the rearranged formula ( [ def.ubar0 ] ) under some restrictive regularity assumptions .    in section  3",
    ", we remove those assumptions and establish the equivalence between the usual pixel - based expression of the filter ( [ def.nl ] ) and its rearranged formulation ( [ def.ubar0 ] ) .",
    "in addition , we provide a fully discrete algorithm to approximate by constant - wise functions the filter @xmath59 given by ( [ def.ubar0 ] ) , and thus the original equivalent filter @xmath60 given by ( [ def.nl ] ) .",
    "we also prove the convergence of this discretization to the solution of the continuous setting . in section  4 ,",
    "we give the proofs of these results .",
    "in section  5 we illustrate the performance of the rearranged filter formulation in comparison to the _ brute force _ pixel - based implementation and to other state of the art filters : the @xmath19 method of yang et al .",
    "@xcite , and the permutohedral lattice method of adams et al .",
    "@xcite .",
    "finally , in section  6 we give the summary .",
    "let us denote by @xmath61 the lebesgue measure of any measurable set @xmath62 .",
    "for a lebesgue measurable function @xmath63 , the function @xmath64 is called the _ distribution function _ corresponding to @xmath25 .",
    "function @xmath65 is non - increasing and therefore admits a unique generalized inverse , called the _ decreasing rearrangement_. this inverse takes the usual pointwise meaning when the function @xmath25 has no flat regions , i.e. when @xmath66 for any @xmath67 . in general , the decreasing rearrangement @xmath68\\to{\\mathbb{r}}$ ] is given by : @xmath69 we shall also use the notation @xmath70 .",
    "notice that since @xmath26 is non - increasing in @xmath71 , it is continuous but at most a countable subset of @xmath71 . in particular , it is then right - continuous for all @xmath72 $ ] .",
    "the notion of rearrangement of a function is classical and was introduced by hardy , littlewood and polya @xcite .",
    "applications include the study of isoperimetric and variational inequalities @xcite , comparison of solutions of partial differential equations @xcite , and others .",
    "we refer the reader to the textbook @xcite for the basic definitions .",
    "two of the most remarkable properties of the decreasing rearrangement are the equi - measurability property @xmath73 for any borel function @xmath74 , and the contractivity @xmath75 for @xmath76 , @xmath77 $ ] .",
    "apart from the pure mathematical interest , the reformulation of neighborhood filters in terms of functional rearrangements is useful for computational purposes , specially when the spatial kernel , @xmath78 , is homogeneous , that is @xmath11 . in this case",
    ", it may be proven @xcite that the level sets of @xmath25 are invariant through the filter , i.e. @xmath79 implies @xmath80 , and thus , it is sufficient to compute the filter only for each ( quantized ) level set , instead of for each pixel , meaning a huge gain of computational effort .    for non - homogeneous kernels the advantages of the filter rearranged version are kernel - dependent , and in any case , the gain is never comparable to that of homogeneous kernels .",
    "the main reason is that the non - homogeneity of the spatial kernel breaks , in general , the invariance of level sets through the filter application .    in",
    "the following lines , we provide a heuristic derivation of the bilateral filter rearranged version , as first noticed in @xcite .",
    "we shall prove in theorem  [ th.equivalence ] that the resulting formula is valid in a very general setting .    under suitable regularity assumptions ,",
    "the coarea formula states @xmath81 taking @xmath82 , and using @xmath83 $ ] for all @xmath84 we get , for the numerator of the filter ( [ def.nl ] ) , @xmath85 assuming that @xmath26 is strictly decreasing and introducing the change of variable @xmath86 we find @xmath87 here , the notation @xmath36 stands for the _ relative rearrangement of @xmath37 with respect to @xmath25 _ which , under regularity conditions , may be expressed as @xmath88 see the next subsection for details .",
    "transforming the denominator of the filter , @xmath89 , in a similar way allows us to deduce @xmath90      the relative rearrangement was introduced by mossino and temam @xcite as the directional derivative of the decreasing rearrangement .",
    "thus , if for @xmath91 and @xmath92 , with @xmath93 $ ] , we consider the function @xmath94 then the _ relative rearrangement of @xmath37 with respect to @xmath25 _ , @xmath36 , is defined as @xmath95 this identity may also be understood as the weak @xmath96 directional derivative ( weak * @xmath97 , if @xmath98 ) , @xmath99 under the additional assumptions @xmath100 and @xmath101 , i.e. the non - existence of flat regions of @xmath25 , the identity ( [ rrr ] ) is well defined and coincides with ( [ def.rr ] ) . in this case , the relative rearrangement represents an averaging procedure of the values of @xmath37 on the level sets of @xmath25 labeled by the superlevel sets measures , @xmath102 .",
    "when formula ( [ rrr ] ) does not apply , that is , in flat regions of @xmath25 , we may resort to identity ( [ def.rr ] ) to interpret the relative rearrangement as the decreasing rearrangement of @xmath37 restricted to such flat regions of @xmath25 .",
    "after the seminal work of mossino and temam @xcite , the relative rearrangement was further studied by mossino and rakotoson @xcite and applied to several types of problems , among which those related to variable exponent spaces and functional properties @xcite , or nonlocal formulations of plasma physics problems @xcite . in the rest of the article , we shall make an extensive use of the results given in the monograph on the relative rearrangement by rakotoson @xcite .",
    "+    consider the constant - wise functions @xmath103\\to{\\mathbb{r}}$ ] given in fig .",
    "[ rem.fig ]  ( a ) .",
    "writing @xmath104 , we may express @xmath25 as @xmath105 , where @xmath42 are the level sets of @xmath25 , @xmath106 $ ] , @xmath107 $ ] , etc .",
    "then , the decreasing rearrangement of @xmath25 is constant - wise too , and given by @xmath108 with @xmath109 for @xmath110 , and with @xmath111 , @xmath112 , @xmath113,@xmath114,@xmath115 .",
    "the corresponding plot is shown in fig .",
    "[ rem.fig ]  ( b ) .    in fig .",
    "[ rem.fig ]  ( c ) we show the graphs @xmath116 transported as it was done in the step before to construct @xmath26 . for instance , the highest level set of @xmath25 , @xmath106 $ ] , was transported to @xmath117 $ ] ; @xmath107 $ ] to @xmath118 $ ] , etc . thus @xmath119 , \\{2\\ } \\}$ ] is transported to @xmath120 , \\{2\\}\\}$ ] ; @xmath121 , \\{3\\ } \\}$ ] is transported to @xmath122 , \\{3\\}\\}$ ] , etc .",
    "finally , to obtain the decreasing rearrangement of @xmath37 with respect to @xmath25 , @xmath36 , we rearrange decreasingly the restriction of @xmath37 to the level sets of @xmath25 , @xmath42 , as shown in fig .",
    "[ rem.fig ]  ( d ) .",
    "in this section we provide analytical results showing that , given an image , @xmath25 , a spatial kernel , @xmath8 , and a range kernel , @xmath123 , all bounded in @xmath124 , we may approximate the filtered image @xmath125 by a sequence of constant - wise functions , @xmath126 , which are obtained by filtering a constant - wise approximation of @xmath25 , @xmath127 , through a discrete filter , @xmath128 , involving a constant - wise approximation of @xmath8 , @xmath129 .",
    "in addition , and fundamentally , we show that the filter and its approximations may be obtained using the rearranged version ( [ def.nlr ] ) , and give explicit formulas for their computation .",
    "the main assumption we implicitly made for the heuristic deduction of formula ( [ def.nlr ] ) is the condition @xmath101 , i.e. the non - existence of flat regions of @xmath25 , which gives sense on one hand to formula ( [ rrr ] ) , and on the other hand , allows us to obtain the strictly decreasing behavior of @xmath26 , which justifies the change of variable in ( [ chco ] ) .",
    "our first result is that formulas ( [ def.nl ] ) and ( [ def.nlr ] ) for the pixel - based filter and its rearranged version are equivalent under weaker hypothesis . due to the nature of our application",
    ", we keep the assumption on the boundedness of @xmath25 and @xmath78 in @xmath124 , although these can be also weakened .",
    "theorems  [ th.equivalence ] and [ th.convergence ] are proven in section  [ sec.proofs ] .",
    "we use the notation @xmath130 .",
    "[ th.equivalence ] let @xmath0 be an open and bounded set , @xmath131 , @xmath132 and @xmath133 .",
    "assume that @xmath2 is , without loss of generality , non - negative .",
    "consider @xmath134 given by ( [ def.nl ] ) and @xmath135 then @xmath136 for a.e . @xmath47 .",
    "the next step towards the definition of a fully discrete algorithm to approximate the filter @xmath137 given by ( [ def.ubar ] ) , and thus the original equivalent filter @xmath138 given by ( [ def.nl ] ) , is showing that we may approximate @xmath25 and @xmath8 by constant - wise functions @xmath127 and @xmath139 such that , as @xmath140 , @xmath141 where @xmath142 is the discrete version of @xmath137 , @xmath143    [ th.convergence ] assume the conditions of theorem  [ th.equivalence ] and suppose that @xmath25 has a finite number of flat regions .",
    "then , there exist sequences of constant - wise functions @xmath144 , with a finite number of flat regions , such that @xmath145 strongly in @xmath146 , @xmath147 strongly in @xmath148 , and @xmath149    theorem  [ th.convergence ] may be extended to the case in which @xmath25 has a countable number of flat regions . however , in this case the approximation sequence of constant - wise functions @xmath127 has also a countable number of levels . since our aim is providing a _",
    "discretization for numerical implementation , such a sequence is not appropriate .    theorem  [ th.convergence ] gives utility to theorem  [ th.approximation ] , in which we produce the fully discrete formula actually used for the numerical implementation .",
    "the main difficulty in computing formula ( [ def.fhm ] ) is the determination of the relative rearrangement .",
    "however , in the case of constant - wise functions with a finite number of levels this computation is simplified thanks to identity ( [ def.rr ] ) , which may be easily applied to this situation , as shown in ( * ? ? ?",
    "* th.7.3.4 ) .    in few words , for the case of constant - wise functions @xmath25 and @xmath37 ,",
    "the relative rearrangement @xmath36 may be computed as the decreasing rearrangement of @xmath37 restricted to the level sets of @xmath25 .",
    "[ th.approximation ] let @xmath2 be a constant - wise function quantized in @xmath38 levels labeled by @xmath39 , with @xmath40 .",
    "that is @xmath41 where @xmath42 are the level sets of @xmath25 , @xmath43 similarly , let @xmath150 be constant - wise and quantized in @xmath44 levels , @xmath45 , with @xmath46 . for each @xmath47 , consider the partition of @xmath42 given by @xmath48 then , for each @xmath49 , @xmath151 @xmath152 with @xmath52 .",
    "as it clear from formula ( [ def.nlrd ] ) , the main difficulty for its computation is the determination of the measures of the sets @xmath153 , which must be computed for each @xmath47 .",
    "the formula provides the algorithm complexity .",
    "if @xmath154 is the number of pixels , then the complexity ( without any further code optimization ) is of the order @xmath155 , where @xmath38 is the number of levels of the image and @xmath44 is the number of levels of the spatial kernel .",
    "let us examine some examples .",
    "_ the neighborhood filter .",
    "_ in this case , @xmath11 , and therefore @xmath156 and @xmath157 is independent of @xmath13 for all @xmath158 .",
    "thus , formula ( [ def.nlrd ] ) is computed only on the level sets of @xmath25 , that is , for all @xmath49 @xmath159 in this case , the complexity is of order @xmath160 .    _ the yaroslavsky filter .",
    "_ in this case , @xmath161 , and therefore there are only two levels @xmath162 of @xmath8 corresponding to the sets @xmath163 thus , formula ( [ def.nlrd ] ) reduces to : for each @xmath49 , @xmath151 @xmath164 the complexity is then of order @xmath165 .",
    "_ the bilateral filter .",
    "_ in this case , @xmath166 and therefore there is a continuous range of levels of @xmath8",
    ". however , for computational purposes the range of @xmath8 is quantized to some finite number of levels , determined by the size of @xmath5 .",
    "thus , the full formula ( [ def.nlrd ] ) must be used in this case .",
    "the resulting complexity is of order @xmath155 .",
    "the corresponding complexities for the pixel based formulation is , at least , of the order @xmath167 , where @xmath168 denote the discrete size of the spatial kernel .",
    "however , meanwhile for the rearranged version the range kernel is computed only once , for the pixel - based version it must be computed for each pixel .",
    "observe that more optimized code and a further reduction of algorithm complexity may be reached by standard zig - zag techniques of window scanning , see @xcite .",
    "* proof of theorem  [ th.equivalence ] . * let @xmath169 and @xmath170 .",
    "we start showing @xmath171 consider the sets of flat regions of @xmath25 and @xmath26 , @xmath172 and @xmath173 , with , @xmath174 , where the subindices set @xmath175 is , at most , countable . according to (",
    "* lemma 2.5.2 ) , we have @xmath176 where @xmath177 , @xmath178 for @xmath179 , and @xmath180 where @xmath181 , with @xmath182 the flat regions of @xmath183 and @xmath184 . in ( [ expr.1 ] ) , since the functions @xmath26 and @xmath65 are strictly decreasing and inverse of each other in the set @xmath185 , we obtain @xmath186 in the flat regions of @xmath25 and @xmath26 we have , on one hand , @xmath187 and , on the other hand , since @xmath188 for @xmath189 , @xmath190 therefore , both sides of ( [ expr.0 ] ) are equal .    finally , for fixed @xmath47 set @xmath191 and first , @xmath192 , for @xmath193 to obtain , using the identity ( [ expr.0 ] ) , the equality between the numerators of ( [ def.nl ] ) and ( [ def.ubar ] ) , and second , @xmath194 to obtain the equality between the denominators of those expressions .",
    "@xmath195    as deduced in the proof , identity ( [ expr.0 ] ) follows from ( * ? ? ?",
    "* lemma 2.5.2 ) .",
    "in fact , a little more than ( [ expr.0 ] ) may be obtained .",
    "let @xmath196 . then",
    ", if @xmath197 is constant in the flat regions of @xmath25 , that is @xmath198 , then @xmath199    * proof of theorem  [ th.convergence ] .",
    "* we split the proof in several steps .",
    "_ we use the construction of the sequence of constant - wise functions @xmath127 given in ( * ? ? ?",
    "7.2.1 ) . in our case",
    ", the construction is simpler because @xmath25 has a finite number of flat regions , implying that @xmath127 has a finite number of levels .    in any case , this construction is such that @xmath145 a.e . in @xmath200 and strongly in @xmath146 , and @xmath201 weakly * in @xmath97 . besides , due to the strong continuity of the decreasing rearrangement ( [ prop.2 ] ) , we also have @xmath202 strongly in @xmath97 .",
    "therefore , we readily see first that @xmath203 and then , due to the dominated convergence theorem , @xmath204    _ step 2 .",
    "_ we consider a sequence of constant - wise functions with a finite number of levels , @xmath205 , such that @xmath206 strongly in @xmath207 . due to the contractivity property of the relative rearrangement ,",
    "see @xcite , we also have , for a.e .",
    "@xmath84 , @xmath208 strongly in @xmath146 , for any @xmath209 .",
    "thus , as @xmath210 , @xmath211 and , again , the dominated convergence theorem implies @xmath212    _ step 3 .",
    "_ in view of ( [ conv.1 ] ) and ( [ conv.2 ] ) , we have @xmath213 as @xmath214 and @xmath215 , so ( [ th.conv3 ] ) follows .",
    "@xmath195    * proof of theorem  [ th.approximation ] . *",
    "since @xmath25 is constant - wise , the decreasing rearrangement of @xmath25 is constant - wise too , and given by @xmath108 with @xmath109 for @xmath158 , and @xmath111 , @xmath216 , @xmath217,@xmath114,@xmath218 .",
    "it is convenient to introduce here the cumulative sum of sets measures @xmath219 for @xmath220 , where the symbol @xmath221 denotes the summation variable .",
    "thus , @xmath222 .",
    "we consider , for fixed @xmath47 and @xmath223 , the function @xmath224 .",
    "since both @xmath25 and @xmath8 are constant - wise with a finite number of levels , we have , for @xmath225 small enough @xmath226 implying that each level set of @xmath227 is included in one and only one level set of @xmath25 .",
    "thus , we have the orderings    * for each @xmath228 , if @xmath229 and @xmath230 then @xmath231 . * for each @xmath232 , if @xmath233 and @xmath234 then @xmath231 .    with these observations we may compute the decreasing rearrangement of @xmath227 as follows . for instance",
    ", for @xmath235 we have ( omitting @xmath13 from the notation @xmath236 ) @xmath237 notice that @xmath238 so , in general , we may write for @xmath158 and @xmath239 , @xmath240 where @xmath241 , with @xmath242 .",
    "observe that @xmath243 .",
    "finally , since @xmath244 we have for @xmath245 @xmath246    we are now in disposition to compute formula ( [ def.ubar ] ) . for @xmath49 , @xmath247 in a similar way we obtain @xmath248 and therefore , using the definition of the sets @xmath249 we deduce ( [ def.nlrd ] ) . @xmath195",
    "we conducted several experiments on standard natural images to check the performance of the discrete formula ( [ def.nlrd ] ) in comparison to well known state of the art denoising algorithms : yang s et al . real time",
    "@xmath19 bilateral filterqiyang ] @xcite , and the permutohedral lattice fast filtering @xcite[pagina ] .",
    "the aim of our experiments was to investigate the quality of the approximation of these algorithms to    1 .",
    "the ground truth , and 2 .   the _ exact _ pixel - based bilateral filter .    we also compared execution times as delivered straightly from the available codes .",
    "notice that execution time depends on code optimization and therefore a rigorous study of this aspect requires some kind of code normalization which was out of the scope of our study .    in both experiments we used four intensity images of different sizes to compare execution times and peak signal to noise ratio ( psnr ) : _ clock _",
    "( @xmath250 ) , _ boat _ ( @xmath251 ) , _ airport _ ( @xmath252 ) , and _ still life _ ( @xmath253 ) .",
    "the first three images were taken from the data base of the signal and image processing institute , university of southern california , while the fourth was courtesy of a. lubroth .",
    "we applied the denoising filters to the test images corrupted with an additive gaussian white noise of @xmath254 , according to the noise measure @xmath255 , where @xmath256 is the empirical standard deviation , @xmath25 is the original image , and @xmath257 is the noise .",
    "we repeated the experiments described in this section for higher levels of noise .",
    "since the results were qualitatively similar , we omitted them for the sake of brevity .",
    "we considered different spatial window sizes determined by @xmath5 , with @xmath258 .",
    "for the yaroslavsky filter , the spatial kernel is the characteristic function of a box of radius @xmath5 , while for the bilateral filter a gaussian function is taken in the experiments .",
    "the range size of the filter was taken , throughout all the experiments , as @xmath259 which , according to @xcite , is the regime in which the corresponding iterative filter behaves asymptotically as a perona - malik type filter .",
    "the shape of the range filter is always a gaussian .",
    "the discretization of the pixel - based and the rearranged version of both filters was implemented in non - optimized   codes in which the main differences are those corresponding to formulas ( [ for.disg ] ) and ( [ for.dis ] ) .",
    "execution time was measured by means of function clock .",
    "all the experiments were run on a standard laptop ( intel core i7 - 2.80 ghz processor , 8 gb ram ) .",
    "@xmath260      the performance of formula ( [ def.nlrd ] ) for filter computation strongly depends on the functional form of the spatial kernel @xmath8 . in the case",
    "in which @xmath8 is the characteristic function of a box of radius @xmath5 , that is @xmath261 the number of level sets of the spatial kernel is just two , and the rearranged version requires only the computation of the measure of the sets @xmath262 for each pixel @xmath13 , that is , counting among all pixels in the @xmath263level set of @xmath25 how many of them belong to the spatial box .    in the discretization of the pixel - based filter , for each pixel @xmath13 we compute @xmath25 in the square neighborhood , @xmath23 , centered at @xmath13 of radius @xmath264 , containing @xmath265 pixels ( close to the border , the image is extended by zero ) .",
    "then , we approximate ( [ def.nl2 ] ) as @xmath266 for the rearranged version we compute , for each pixel @xmath49 , @xmath151 , the number of pixels of the spatial box which belong to the different level sets of @xmath25 , @xmath267 . that is , @xmath268 is the number of pixels of @xmath42 which are present in the box @xmath23 .",
    "then , we take @xmath269 where @xmath270 are the quantization levels of @xmath25 . observe that since the rearranged version transforms the range kernel @xmath271 into , @xmath272 , this term may be computed and stored outside the main loop running over all the pixels , see algorithm  [ ps.yaros ] .",
    "thus , in ( [ for.dis ] ) , only @xmath273 and @xmath274 must be actualized for each pixel , establishing an important difference with respect to the pixel - based version ( [ for.disg ] ) , in which both the spatial and range kernels are actualized .",
    "in addition , following @xcite , we perform the actualization of the measures @xmath273 using previously computed information of neighbor boxes ( zig - zag scanning technique )",
    ".    @xmath260    @xmath275 @xmath228      if the spatial kernel @xmath8 has a more complex profile than the characteristic function , e.g. the gaussian function , then the rearranged version requires the computation of , for each pixel @xmath13 , the measure of the sets @xmath276 for all the level setss , @xmath277 , of some discretization of @xmath8 .",
    "for instance , for @xmath258 , the corresponding number of the gaussian function quantization levels arising from double precision arithmetic are @xmath278 , with @xmath279 , @xmath280 , @xmath281 , and @xmath282 .",
    "the approximations to the pixel based and the rearranged version are , respectively , @xmath283 and @xmath284 with @xmath52 , where , for @xmath49 , @xmath54 is the number of pixels of @xmath42 which belong to the @xmath285 level set of @xmath8 .",
    "the bilateral filter may be accelerated by manipulating the quantization levels of the image , and of the spatial range .",
    "as shown in @xcite for the yaroslavsky filter , the reduction of the image quantization levels leads to poor denoising results .",
    "however , we checked that a similar restriction applied to the spatial kernel reduces the execution time while conserving good denoising quality . in our experiments we tested this ansatz with a fixed number of levels , @xmath286 , for all the images and @xmath287values .",
    "the algorithm introduced by yang et al .",
    "@xcite is the following .",
    "let @xmath288 be a subset of the quantization levels of the image . then , if @xmath289 $ ] , yang s filter is given by the image interpolation @xmath290 where @xmath291 thus , if @xmath292 then @xmath293 coincides with the exact discrete version of the bilateral filter , whereas if @xmath294 an approximation of the bilateral filter is obtained by interpolation on the quantization range kernel levels .",
    "observe that since @xmath13 is no longer present in the range kernel of @xmath295 , both factors in ( [ yang1 ] ) may be computed by fast approximated convolution algorithms , which is the main strength of the algorithm provided in @xcite    however , in the first experiment ( yaroslavsky filter ) , and in order to obtain _ exact _ results when @xmath292 , we implemented yang s algorithm by using our rearranged version ( [ for.dis ] ) applied to @xmath295 , explaining the increment of execution times when compared to the actual implementation of yang et al .",
    "as already mentioned , we also use for comparison purposes the fast filtering using the permutohedral lattice introduced by adams et al .",
    "this algorithm is based on resampling techniques and specially useful for high dimensional filtering .",
    "we refer to @xcite for a thoroughfull explanation of the method .",
    "we use the following notation for the algorithms to be compared :    * ypb : yaroslavsky pixel - based version , formula ( [ for.disg ] ) .",
    "* yrr : rearranged yaroslavsky version , formula ( [ for.dis ] ) .",
    "* eyang@xmath296 : _ exact _ yang s algorithm , formula ( [ yang2 ] ) , computed with the rearranged strategy , for @xmath297 , @xmath298 or @xmath299 interpolators . * bpb : bilateral pixel - based version , formula ( [ for.bil ] ) .",
    "* brrm : rearranged bilateral version , formula ( [ for.bilr ] ) , with the maximum number of spatial kernel discretization levels , @xmath279 , @xmath280 , ... * brr20 : rearranged bilateral version , formula ( [ for.bilr ] ) , with fixed number of spatial kernel discretization levels , @xmath286 . * y@xmath296 : yang s code provided by the authors , see footnote 1 in page , for @xmath297 or @xmath300 interpolators . *",
    "p : permutohedral lattice bilateral filter code provided by the authors , see footnote 2 in page .      in the first experiment , we tested the approximation quality of the rearranged and the exact yang s versions of the yaroslavsky filter to the pixel - based version . in table  [ table1 ] we show the psnr of yrr and eyang with respect to ypb .",
    "we recall that , according to @xcite , psnr values above 40db often correspond to almost invisible differences .",
    "the high psnr values obtained for yrr and eyang256 show that these algorithms give practically the same results than ypb , up to rounding errors .",
    "eyang64 still gives very good approximation results , whereas these significantly diminishes for eyang8 .    in table",
    "[ table1 ] we also show the execution times .",
    "yrr is up to 400 times faster than ypb .",
    "the execution times of eyang compared to yrr are always higher , but this has to be taken cautiously since the code implementations were not optimized . in this experiment we were more interested in approximation quality .    in the second experiment , we tested the approximation quality of the algorithms described in the previous subsection to the ground truth image and to the bilateral pixel - based filter ( bpb ) .    in table  [ table2 ] we show the corresponding psnr s .",
    "we see that all the algorithms employed give similar results when compared to the ground truth image .",
    "thus , if this were the choice criterium , the faster , that is @xmath301 , should be considered .    however , when compared to the bpb , the psnr s are quite different . as expected , the rearranged version with the maximum number of quantization levels for the spatial kernel , brrm , gives the same result , up to rounding errors , than the bpb .",
    "however , the yang s algorithm with the maximum number of levels , y256 , although _ should _ give exact results , it does not , revealing other sources of error beyond rounding errors .",
    "even the brr20 and the yaroslavsky yrr give better approximations than y256 .",
    "in particular , brr20 has always values of psnr around 40db .",
    "the permutohedral algorithm gives similar results than y256 and y8 .",
    "let us mention two difficulties we found with the yang code implementation .",
    "the first is related to low @xmath302values , for which y8 gives poor results due to some artifact formation .",
    "the second is related to large images , for which huge memory allocation requirements result in running time execution errors .    in table",
    "[ table3 ] we collect the execution times obtained in this experiment . only for the smaller image sizes and @xmath302values",
    "y8 has a competitor in yrr . for large images and high @xmath302values",
    "the second fastest algorithm is , as expected , the permutohedral , although always taking around twice the time of y8 .",
    "both brrm and brr20 give execution times considerably higher than the other algorithms , for our non - optimized codes .    finally , in figures  [ fig_clock ] , [ fig_boat ] and [ fig_adam3 ] we show some of the filters outcome .",
    "the columns give , from left to right , the denoised image , a detail of the image , the contour plot of the detail , and the histogram of the denoised image .",
    "the rows give , from above to below , the noisy image , the results of bpb , brr20 , y8 , yrr and p , and in the last row , the ground truth clean image .",
    "it may be observed that , in general , the permutohedral algorithm performs a hardest denoising than the other algorithms .",
    "this is also reflected in the formation of picks in the histogram .",
    "the y8 gives the softest denoising and performs some smoothing in the histogram of the denoised image , unlike the other algorithms .",
    "finally , bpb and brr20 are almost indistinguishable , while yrr is very close to them , although with a harder denoising effect .",
    "the staircasing effect due to the reduction of level sets is present in all the algorithms , although not specially relevant in none of them .",
    "in this paper we introduced the use of functional rearrangements to express bilateral type filters in terms of integral operators in the one - dimensional space @xmath303 $ ] .",
    "we have proved the equivalence between the pixel - based formulation of the original filter and its rearranged version . in addition , we proved the convergence of discrete finite step - wise approximations of image and filter to their corresponding continuous limits .",
    "although this is a property easy to obtain in the pixel - based formulation , it is far from trivial in its rearranged version .    in the case in which the spatial kernel , @xmath8 , is homogeneous ( e.g. the neighborhood filter ) , it was proven in @xcite that the level set structure of the image is left invariant through the filtering process , allowing to compute the filter jointly for all the pixels in each level set , instead of pixel - wise .    however ,",
    "if the spatial kernel is not homogeneous the invariance of the @xmath304level sets through the filter is , in general , broken . despite this fact , there still remains an important property of the rearranged version : the range kernel @xmath305 is transformed into a pixel - independent kernel @xmath306 , implying a large gain in computational effort , as already observed for particular cases in @xcite .",
    "we have illustrated numerically this property .",
    "the present state of the rearranging technique has an inherent restriction : the need of a relation of order in the range space . while this may be a minor issue for vector - valued color images , for which a map to some one - dimensional color space may be used",
    ", it is unclear how to extend the method to patch - based algorithms such as the nonlocal means .",
    "whether or not the patch reordering techniques introduced , among others , by ram et al .",
    "@xcite may be adapted to the rearranging approach will be the focus of future research .",
    "the authors are partially supported by the spanish dgi project mtm2013 - 43671 ."
  ],
  "abstract_text": [
    "<S> we introduce an exact reformulation of a broad class of neighborhood filters , among which the bilateral filters , in terms of two functional rearrangements : the decreasing and the relative rearrangements .    independently of the _ image _ spatial dimension ( one - dimensional signal , image , volume of images , etc . </S>",
    "<S> ) , we reformulate these filters as integral operators defined in a one - dimensional space corresponding to the level sets measures .    </S>",
    "<S> we prove the equivalence between the usual pixel - based version and the rearranged version of the filter . </S>",
    "<S> when restricted to the discrete setting , our reformulation of bilateral filters extends previous results for the so - called fast bilateral filtering . </S>",
    "<S> we , in addition , prove that the solution of the discrete setting , understood as constant - wise interpolators , converges to the solution of the continuous setting .    </S>",
    "<S> finally , we numerically illustrate computational aspects concerning quality approximation and execution time provided by the rearranged formulation .    _ </S>",
    "<S> keywords : _ neighborhood filters , bilateral filter , decreasing rearrangement , relative rearrangement , denoising .    to appear in journal of mathematical imaging and vision , doi 10.1007/s10851 - 015 - 0583-y </S>"
  ]
}