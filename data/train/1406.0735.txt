{
  "article_text": [
    "identification of origin of ultra - high energy cosmic rays is one of the main problems of modern astrophysics .",
    "although existence of particles with energy @xmath0 ev has been confirmed by several experiments , their possible sources , propagation mechanism and even their nature are still subjects of intense research .",
    "noticeable progress has been achieved during last decade by the new generation experiments . a suppression of cosmic ray flux above @xmath1ev has been observed by hires , telescope array  @xcite and pierre auger observatories @xcite which depending on assumed uhecr composition may indicate either observation of the gzk - effect  @xcite , or natural cut - off in the energy of cosmic ray sources .",
    "the measurements of the position of the shower maximum and its fluctuations by the pierre auger experiment suggest a significant fraction of heavy nucleai above @xmath2ev  @xcite however both composition and energy spectrum studies by hires  @xcite and telescope array  @xcite ) show consistency with pure proton or light element composition in the same energy range .",
    "ultra - high energy protons and nuclei can not be kept by galactic magnetic field and therefore freely escape galaxy .",
    "since currently there are no known sources within milky way which could possibly accelerate protons or nuclei up to ultra - high energies it is assumed that the particles should have extragalactic origin . during their propagation through intergalactic space uhecrs rapidly loose energy in interactions with intergalactic photon background .",
    "understanding the uhecr attenuation process is crucial for making model predictions and interpretation of experimental results .",
    "a number of numerical codes has been developed so far for simulation of uhecr attenuation process and calculation of secondary particle spectra  @xcite .",
    "the mutual checks between different tests show consistency level of about 10% . due to growing experimental statistics improving simulation accuracy becomes critical .",
    "in this paper we focus on predictions of the spectra from proton sources .",
    "we describe in detail our transport equation solving code which has already been used in a number of works  @xcite although hasnt been publicly available until now .",
    "we compare our tool with the actively developed monte carlo code crpropa  @xcite , which is publicly available and used in pierre auger collaboration analysis  @xcite .",
    "while the former code benefits exceedingly high calculation speed the later is more universal and easy customizable . in section  [ methods ]",
    "we discuss simulation techniques on which the codes are based . in section  [ compare_and_improve ]",
    "we compare the results of proton propagation simulations and suggest improvements to crpropa .",
    "finally we make a conclusion .",
    "the observable uhecr spectra calculations for given production scenarios involve simulation of sources and attenuation effects such as interactions of cosmic rays with intergalactic media and their deflection by galactic and intergalactic magnetic fields .",
    "the interaction rate calculation accuracy depends on our knowledge of the infrared intergalactic photon background and it s evolution while particle trajectory calculations rely on the models of intergalactic and galactic magnetic fields .",
    "neither of the above factors is currently known enough to make definitive predictions . on the other hand identification of uhecr sources",
    "would help to constrain the properties of intragalactic media which especially applies to magnetic field estimates .",
    "our present knowledge of the intergalactic magnetic field ( igmf ) is very poor .",
    "the theoretical and observational constraints on the mean igmf strength @xmath3 and correlation length @xmath4 are summarised in the review  @xcite : @xmath5 the simulation assuming the magnetic field grow in a magnetohydrodynamical amplication process driven by structure formation out of a magnetic seed field present at high redshift  @xcite suggests present igmf strength @xmath6 ( see although ref .",
    "@xcite ) . one can show ( see i.e. ref .",
    "@xcite ) that the effect of magnetic fields on the average energy spectrum of protons with energies @xmath7 is negligible if igmf strength @xmath8 ( assuming @xmath9 ) provided that the average distance between the uhecr sources does nt exceed gzk radius .",
    "if these conditions are realized the computation of the averaged fluxes can be done by solving the coupled boltzmann equations for uhecr transport in one spatial dimension or using one - dimensional monte carlo simulation ( the first method is usually much faster ) . in the limit of strong magnetic fields",
    "when it is important to follow particle trajectories i.e. for calculation of images of discrete sources of uhecr only full 3d monte carlo simulation can give reliable result .",
    "our code  @xcite uses formalism of transport equations while the crpropa  @xcite implements either 1d or 3d monte carlo simulations .",
    "below we describe crpropa code only briefly and pay more attention to transport equation solution .",
    "crpropa  @xcite is a monte carlo simulation tool aimed at studying the propagation of neutrons , protons and nuclei in the intergalactic medium .",
    "it provides a one - dimensional ( 1d ) and a three - dimensional ( 3d ) modes . in 3d mode , magnetic field and source distributions",
    "can be defined on a 3d grid .",
    "this allows one to perform simulations in the source scenarios with a highly structured magnetic field configuration . in 1d mode ,",
    "magnetic fields can be specified as a function of the distance to the observer , but their effects are restricted to energy losses of electrons and positrons due to synchrotron radiation within electromagnetic cascades . furthermore in 1d mode",
    "it is possible to specify the cosmological and the source evolution as well as the redshift scaling of the background light intensity .",
    "all important interactions with the cosmic infrared ( irb ) and microwave ( cmb ) background light are included , namely , production of electron - positron pairs , photopion production and neutron decay .",
    "additionally , crpropa allows for tracking and propagating secondary @xmath10rays , @xmath11 pairs and neutrinos .",
    "the code also contains the module solving one - dimensional transport equations for electromagnetic cascades that are initiated by electrons , positrons or photons taking into account pair production and inverse compton scattering and synchrotron radiation of electrons . for more details on the code refer to the ref .",
    "@xcite      the code  @xcite simulates attenuation of protons , neutrons , nuclei , photons and stable leptons by solving transport equation in one dimension taking into account all standard dominant processes .",
    "uhe particles lose their energy in interactions with the electromagnetic background , which consists of cmb , irb and radio components ( the last one only effects em cascade development at ultra - high energies ) . for irb backgrounds",
    "several models are implemented  @xcite .",
    "for highest energy protons , neutrons and nuclei the main attenuation process is photopion production . below the threshold of photopion production photodisintegration ( for nuclei only ) and @xmath12 pair production provide the attenuation mechanism .",
    "although nuclei attenuation is implemented in the code ( we use photodisintegration rates derived in  @xcite ) , since deflections in magnetic fields can not be precisely described within 1d transport equation formalism , the reliable description of heavy nuclei propagation can be achieved only for energies @xmath13 ( assuming @xmath8 ) .",
    "below we focus on proton and neutron propagation simulations . with the photopion production by protons and neutrons , @xmath12 pair production by protons on background photons and",
    "neutron decay included , the transport equations for protons and nucleons can be written in the following form ( here and below we assume @xmath14 ) : @xmath15 @xmath16 where @xmath17 and @xmath18 are densities of protons and neutrons per unit energy . here",
    "isotropic distribution of background photons is assumed with number density @xmath19 depending on photon energy @xmath20 only , @xmath21 and @xmath22 are particle velocities , @xmath23 is the collision angle cosine and @xmath24 denotes external source terms .",
    "the terms describing neutron decay are proportional to @xmath25 , inverse neutron lifetime in the rest frame . in the neutron decay term of eq .",
    "( [ kineq_p ] ) we neglect difference in masses of neutron and proton and assume that the recoiling proton momentum is zero in the neutron rest frame . the terms proportional to @xmath26 and @xmath27 describe photopion production by protons and neutrons . here",
    "we take into account that nature of leading nucleon can be changed in the above interaction .",
    "finally , terms proportional to @xmath28 describe @xmath12 pair production by protons .    to solve the above equations numerically , we bin the energies of the cosmic rays .",
    "we divide each decade of energy into @xmath29 equidistant logarithmic bins .",
    "let us designate the central value of the @xmath30-th bin @xmath31 and boundary values @xmath32 and @xmath33 . than we rewrite equations  ( [ kineq_p],[kineq_n ] ) in terms of numbers of particles in each bin @xmath34 after replacing the continuous integrals by finite sums we have    @xmath35    where @xmath36 coefficients @xmath37",
    "have physical meaning of interaction rates and are given by @xmath38 \\nonumber \\\\ & & a_{\\rm n , i } = \\int d\\epsilon\\,n(\\epsilon ) \\int d\\mu \\frac{1-\\beta_{n , i } \\mu}{2 }",
    "\\sigma_{\\rm n,\\pi}(e_i,\\epsilon,\\mu ) + \\frac{m_n}{e_{n , i}}\\tau_n^{-1 } , \\label{coef_a}\\end{aligned}\\ ] ] and coefficients @xmath39 are given by @xmath40 , \\label{coef_b}\\\\ & & b_{\\rm p \\rightarrow n , ji } = \\int d\\epsilon\\,n(\\epsilon ) \\int d\\mu \\frac{1-\\beta_{p , j } \\mu}{2 } \\int_{e_{i-1/2}}^{e_{i+1/2}}de_n \\frac{d\\sigma_{\\rm p,\\pi}}{de_n}(e_j,\\epsilon,\\mu ; e_n ) , \\nonumber\\\\ & & b_{\\rm n \\rightarrow p , ji } = \\int d\\epsilon\\,n(\\epsilon ) \\int d\\mu \\frac{1-\\beta_{n , j } \\mu}{2 } \\int_{e_{i-1/2}}^{e_{i+1/2}}de_p \\frac{d\\sigma_{\\rm n,\\pi}}{de_p}(e_j,\\epsilon,\\mu ; e_p)+ \\delta_j^i   \\frac{m_n}{e_i}\\tau_n^{-1 } , \\nonumber\\\\ & & b_{\\rm n \\rightarrow n , ji } = \\int d\\epsilon\\,n(\\epsilon ) \\int d\\mu \\frac{1-\\beta_{n , j } \\mu}{2 } \\int_{e_{i-1/2}}^{e_{i+1/2}}de_n \\frac{d\\sigma_{\\rm n,\\pi}}{de_n}(e_j,\\epsilon,\\mu ; e_n).\\nonumber\\end{aligned}\\ ] ] the system of ordinary differential equations ( ode )  ( [ ode_p ] ) and  ( [ ode_n ] ) can be solved using standard methods .",
    "the transportcr code utilizes gnu scientific library ( gsl ) which provides a choice of 11 adaptive step ode integration schemes .",
    "in addition to standard gsl schemes the first order implicit scheme is implemented in the code which benefits the observation that the matrixes @xmath39 in equations  ( [ ode_p ] ) and  ( [ ode_n ] ) are triangular .",
    "this makes it possible to speed up ode solving by reducing number of independent variables .",
    "the implicit method has the advantage that the solution converges even for relatively large time step .",
    "however , to ensure the desired accuracy , we need to optimize the step size for a given problem by trial and error . note that coefficients @xmath41 , @xmath39 depend on time because of the redshift dependence of the background concentration .",
    "since in general the step size should be proportional to interaction length @xmath42 and the length itself is inversely proportional to concentration of background photons , we make the time step dependent on z : @xmath43 which corresponds to the evolution of cmb photons concentration .",
    "there is no need to recalculate coefficients @xmath41 , @xmath39 before each step unless the background is highly variable . in practice",
    "we recalculate the coefficients after intervals of time corresponding to redshift change of one log bin : @xmath44    the same calculation technique is used to obtain the fluxes of secondary particles produced by nucleons , namely electrons , positrons , photons and neutrino .",
    "the electron - photon cascade is driven by chain of inverse compton scattering and @xmath12 pair production by photons while secondary neutrinos propagate practically without attenuation .",
    "the direct application of the above scheme may be difficult in the special case of the fast processes with small inelasticity since it would require high density of energy binning and small time steps .",
    "the @xmath12 pair production by protons is good example of such process having inelasticity less then @xmath45 .",
    "similar problem occurs in the monte carlo simulation method . in both techniques continuous energy loss ( cel ) approximation",
    "is used to bypass the problem with mean energy loss rate given by equation @xmath46 while in monte carlo simulation the cel implementation is straightforward in transport equation approach simple first order scheme is used to express continuous energy loss in terms of coefficients @xmath41 , @xmath47 in equations  ( [ ode_p ] ) and  ( [ ode_n ] ) : @xmath48    equations  ( [ ode_p ] ) and  ( [ ode_n ] ) do nt take into account expansion of the universe .",
    "one way to treat it would be to introduce the cel term with @xmath49 along with replacing @xmath50 with comoving source densities @xmath51 in  ( [ coef_q ] ) to take into account the volume increase .",
    "as alternative to introduction of extra cel term one could perform shifting the energy binning each step  ( [ stepz ] ) as it is done in ref .",
    "both methods agree in the limit of large @xmath52 , the former is more accurate in the presence of other more rapid attenuation channels while the latter is precise in the absence of any interactions .",
    "photopion production is the main attenuation mechanism for protons and neutrons with energies @xmath53 .",
    "the energy threshold for this process is @xmath54 where @xmath55 is the nucleon mass .",
    "this process was extensively studied in ref .",
    "@xcite where the sophia event generator was developed for simulation of photopion production including calculation of various channels cross sections and sampling of secondaries .",
    "both crpropa and transport equation based code are using sophia event generator as black box .",
    "the former is calling the event generator directly while the latter provides the auxiliary routine to calculate the propagation coefficients @xmath41 and @xmath39 using calls of sophia procedures which is described below .",
    "first let us rewrite the contribution from photopion production in equations  ( [ coef_a ] ) and  ( [ coef_b ] ) in terms of photon energy @xmath56 in the nucleon rest frame ( nrf ) @xmath57 where @xmath55 and @xmath58 are the nucleon mass and energy respectively and @xmath59 .",
    "the threshold energy for photopion production @xmath60 after omitting in  ( [ coef_a ] ) and  ( [ coef_b ] ) the terms related to pair production and neutron decay in ultrarelativistic limit ( @xmath61 ) we have : @xmath62 where @xmath63 is maximal photon background energy in lab frame and @xmath64 is integral depending solely on photon background density which can be tabulated .",
    "the total photopion production cross sections as functions of photon energy in nrf @xmath65 are explicitly implemented in sophia which is enough for @xmath37 coefficients calculation .    to calculate @xmath39 we create logarithmic binning in @xmath56 with @xmath52 steps per decade from @xmath66 given by  ( [ k_th ] ) and @xmath67 and for each @xmath68 in nrf we perform sampling of secondary particles for @xmath69 times .",
    "let us assume that the nucleon momentum @xmath70 in the lab frame is directed along the @xmath71 axes .",
    "than since @xmath72 the background photon momentum in nrf @xmath56 should point to the opposite direction .",
    "let @xmath73 and @xmath74 be the energy and @xmath71-component of the sampled secondary particle momentum in nrf .",
    "then it s energy in the lab frame @xmath75 therefore in ultrarelativistic limit ( @xmath61 ) we have @xmath76 from eq .  [ fraq ]",
    "it follows that the distribution @xmath77 of the random variable @xmath78 does not depend on primary nucleon energy @xmath79 and may solely depend on @xmath56 .",
    "therefore for construction of @xmath39 it is enough to build the 2d tables of @xmath80 for each pair of primary and secondary particle .",
    "if distribution functions @xmath80 are normalized on average total number of secondary particles of type @xmath81 produced by primary particles of type @xmath82 in collision with photon @xmath56 than @xmath83 in practice the routine tabulates fractions of events with @xmath78 falling to a given range : @xmath84      @xmath12 pair production is the main energy attenuation mechanism for protons with energies below the gzk cutoff .",
    "the energy threshold for this process is @xmath85 as it was mentioned above the process is characterized by low inelasticity and therefore the cel approximation is used .",
    "the energy loss rate for the process on arbitrary isotropic background was calculated in ref .",
    "@xcite , see formulas ( 3.11)-(3.19 ) .",
    "in this section we use simple phenomenological model for source evolution and injection spectrum to compare the simulations described above : @xmath86    if fig .  [ spec ]",
    "we show propagated spectra calculations in two numerical codes .",
    "we consider both sources with constant density ( fig .",
    "[ spec_before_m0 ] ) and the sources with strong evolution ( fig .",
    "[ spec_before_m4 ] ) .",
    "the highest discrepancy is observed in the later case .",
    "it reaches @xmath87 at super - gzk energy .",
    "nevertheless the effect of this discrepancy on the spectrum fitting is weaker than that of uncertainty in sub - gzk energy region where more statistics is available . in this region",
    "the difference in the flux predictions is at most @xmath88 . in the case of nonevolving source",
    "the discrepancy is less pronounced .",
    "the above observations naturally lead to assumption that the differences may be related to pion production and in particular the implementation of this process for @xmath89 .",
    "the discrepancy is clearly seen for both processes in figs .",
    "[ rates ] , although in case of pair production it should nt have effect on the spectrum since the energy loss lengths become different in the region where redshift is the main attenuation mechanism .",
    "in fact the discrepancy is caused by the simplifying assumption on the dependence of the energy loss rate on @xmath71 used in crpropa : @xmath91 which is only valid for cmb background .",
    "the difference in the pion production interaction length is more important . in crpropa code pion production on cmb",
    "is implemented using prebuilt interaction rate tables for @xmath92 and scaling with redshift according to formula similar to  ( [ cmbrateevol ] ) , while interaction rates on infrared background are calculated for each @xmath71 in the same way as pion production term in formula  ( [ coef_a ] ) namely by integrating the collision angle averaged cross section ( which is tabulated ) with photon background spectrum . after inspecting crpropa code and tables we came to conclusion that the cross section function should be tabulated for broader range of arguments , besides the integration procedure accuracy as well as cross section tables interpolation can be enhanced . with the above corrections",
    "implemented we have also rebuilt the interaction rates table for cmb background . in fig .",
    "[ rates ] the corrected rates are shown as well .",
    "we ve also implemented more precise calculation of pair production energy loss rates in crpropa which takes into account the evolution of infrared background in proper way .",
    "[ spec_after ] illustrates level of agreement achieved after applying corrections to crpropa code in case of strong source evolution .",
    "note that in case on non - evolving source the same level of accuracy is achieved .",
    "calculation of spectra presented in fig .",
    "[ spec ] took 60 hours of 2.2 ghz cpu time using crpropa and 0.6 hours cpu time using transport code .",
    "we have compared the results of simulating ultra - high energy nucleons propagation using crpropa and transportcr codes and suggested improvements to the procedure of interaction rate calculation in crpropa . after applying the suggested improvements we have achieved @xmath93 level of agreement in flux predictions by the two codes for the whole relevant energy range except small interval in super - gzk region @xmath94 where relative error grows to @xmath95 .",
    "the level of accuracy achieved is enough for consistent analysis of the latest uhecr data .",
    "we have applied the propagation codes described above to fit the telescope array experimental spectrum  @xcite assuming phenomenological source model  ( [ source_model ] ) .",
    "the enhancements in crpropa introduced in this work let us achieve the systematic uncertainty in the best fit parameters related to the choice of propagation code at level @xmath96 and @xmath97 .",
    "modified crpropa and transport code described in this work can be downloaded from  @xcite .",
    "the modifications suggested in the former code have been discussed with crpropa developers team and are going to be incorporated into crpropa 3 release version  @xcite .    _",
    "acknowledgments_we thank masaki fukushima , kazumasa kawata , hiroyuki sagawa , gnter sigl and igor tkachev for fruitful discussion .",
    "the work of o.k . was supported by the russian federal science fund grant rscf 14 - 12 - 01340 .",
    "t.  abu - zayyad , r.  aida , m.  allen , r.  anderson , r.  azuma , e.  barcikowski , j.  w.  belz and d.  r.  bergman _ et al .",
    "_ , astrophys .  j.   * 768 * , l1 ( 2013 ) [ arxiv:1205.5067 [ astro-ph.he ] ] .",
    "k.  greisen , phys .",
    "* 16 * ( 1966 )          t.  abu - zayyad _ et al .",
    "_ [ telescope array and pierre auger collaborations ] , arxiv:1310.0647 [ astro-ph.he ] . k.  -h .",
    "kampert , jr .",
    "kulbartz , l.  maccione , n.  nierstenhoefer , p.  schiffer , gn .",
    "sigl and a.  r.  van vliet , astropart .  phys .",
    "* 42 * , 41 ( 2013 ) [ arxiv:1206.3132 [ astro-ph.im ] ] .",
    "+ r.  a.  batista , m.  erdmann , c.  evoli , k.  -h .",
    "kampert , d.  kuempel , g.  mller , p.  schiffer and g.  sigl _ et al .",
    "_ , arxiv:1307.2643 [ astro-ph.im ] . o.  k.  kalashev , phd thesis , institute for nuclear research ras , moscow 2003 .",
    "+ g.  b.  gelmini , o.  kalashev and d.  v.  semikoz , jcap * 1201 * , 044 ( 2012 ) [ arxiv:1107.1672 [ astro-ph.co ] ] .",
    "+ k.  arisaka , g.  b.  gelmini , m.  d.  healy , o.  e.  kalashev and j.  lee , jcap * 0712 * , 002 ( 2007 ) [ arxiv:0709.3390 [ astro - ph ] ] . v.  berezinsky , a.  z.  gazizov and s.  i.  grigorieva , phys .",
    "d * 74 * , 043005 ( 2006 ) [ hep - ph/0204357 ] .",
    "r.  aloisio , d.  boncioli , a.  f.  grillo , s.  petrera and f.  salamida , jcap * 1210 * , 007 ( 2012 ) [ arxiv:1204.2970 [ astro-ph.he ] ] .",
    "d.  allard , e.  parizot , e.  khan , s.  goriely and a.  v.  olinto , astron .",
    "astrophys .   * 443 * , l29 ( 2005 ) [ astro - ph/0505566 ] .",
    "a.  aab _ et al .",
    "_ [ pierre auger collaboration ] , arxiv:1307.5059 [ astro-ph.he ] .",
    "r.  durrer and a.  neronov , astron .",
    "astrophys .",
    "* 21 * , 62 ( 2013 ) [ arxiv:1303.7121 [ astro-ph.co ] ] .",
    "k.  dolag , d.  grasso , v.  springel and i.  tkachev , jcap * 0501 * , 009 ( 2005 ) [ astro - ph/0410419 ] .",
    "g.  sigl , f.  miniati and t.  a.  ensslin , astro - ph/0309695 .",
    "v.  berezinsky and a.  z.  gazizov , astrophys .",
    "j.   * 669 * , 684 ( 2007 ) [ astro - ph/0702102 [ astro - ph ] ] . t.  m.  kneiske et al . , astron .",
    "astrophys .",
    "* 386*(2002 ) 1 ; _ ibid .",
    "_ , * 413 * ( 2004 ) 807 .",
    "a.  franceschini , g.  rodighiero and m.  vaccari , astron .",
    "astrophys .   * 487 * , 837 ( 2008 ) [ arxiv:0805.1841 [ astro - ph ] ] .",
    "f.  w.  stecker , m.  a.  malkan and s.  t.  scully , astrophys .  j.   * 648 * , 774 ( 2006 ) .",
    "t.  m.  kneiske and h.  dole , arxiv:1001.2132 [ astro-ph.co ] . f.  w.  stecker , m.  a.  malkan and s.  t.  scully , astrophys .",
    "j.   * 761 * , 128 ( 2012 ) . s.  t.  scully , m.  a.  malkan and f.  w.  stecker , arxiv:1401.4435 [ astro-ph.he ] . y.  inoue et al . ,",
    "arxiv:1212.1683 .",
    "s.  lee , phys .",
    "d * 58 * , 043004 ( 1998 ) [ astro - ph/9604098 ] .",
    "a.  mucke , r.  engel , j.  p.  rachen , r.  j.  protheroe and t.  stanev , comput .",
    "commun .   * 124 * , 290 ( 2000 ) [ astro - ph/9903478 ] .",
    "m.  j.  chodorowski , a.  a.  zdziarski , and m.  sikora , astrophys .",
    "j. * 400 * , 181 ( 1992 ) ."
  ],
  "abstract_text": [
    "<S> we compare two techniques for simulation of ultra high energy cosmic rays ( uhecr ) propagation , the monte carlo approach and method based on solving transport equations in one dimension . for the former we adopt publicly available tool crpropa and for the later we use the code transportcr developed by o.k . </S>",
    "<S> et al . and </S>",
    "<S> used in number of applications which is made available online with publishing this paper . </S>",
    "<S> while the crpropa code is more universal , transport equation solver has advantage of roughly 100 times higher calculation speed . </S>",
    "<S> we conclude that the methods give practically identical results for the case of proton or neutron primaries provided that some accuracy improvements are introduced to crpropa code .    </S>",
    "<S> .06 in * simulations of ultra high energy cosmic rays propagation * + * o.e . </S>",
    "<S> kalashev * , + _ </S>",
    "<S> institute for nuclear research of the russian academy of sciences + moscow , russia _ + * e. kido * , + _ </S>",
    "<S> institute for cosmic ray research university of tokyo , kashiwa , chiba , japan _ + </S>"
  ]
}