{
  "article_text": [
    "the application of cross - correlation techniques to measure velocity shifts has a long history ( simkin 1972 , 1974 ; lacy 1977 ; tonry & davis 1979 ) , and with the advent of massive digital spectroscopic surveys of galaxies and stars , the subject has renewed interest .",
    "the recently completed sloan digital sky survey ( sdss ) has collected spectra for more than 600,000 galaxies and 90,000 quasars ( adelman - mccarthy et al .",
    "2007 , york et al . 2000 ) .",
    "the sdss has also obtained spectra for about 200,000 galactic stars , and it is now being extended at lower galactic latitudes by segue with at least as many spectra ( rockosi 2005 , yanny 2005 ) .",
    "another ongoing galactic survey , rave , is expected to collect high - resolution spectra for a million stars by 2011 ( steinmetz et al .",
    "2006 ) , and the plans for the gaia satellite include measuring radial velocities for 10@xmath0 stars by 2020 ( katz et al .",
    "2004 ) . extracting the maximum possible information from these spectroscopic surveys",
    "requires carefully designed strategies .",
    "cross - correlation has been the target of numerous developments in recent years ( see , e.g. , mazeh & zucker 1994 , statler 1995 , torres , latham & stefanik 2007 , zucker 2003 ) , but several practical aspects of its implementation would benefit from further research .",
    "these include the selection of templates ( e.g. , observed vs. synthetic libraries ) , how to combine measurements from multiple templates , the method to determine the maximum of the cross - correlation function , data filtering , and error determination .",
    "some of these issues are briefly addressed in this paper , but our focus is on how the requirement of coherence among all entries in a radial velocity data base can be used to improve the original measurements .",
    "a different but plausible approach has been recently proposed by zucker & mazeh ( 2006 ) .",
    "the doppler shifts of targets in a spectroscopic survey are determined one at a time .",
    "each object s projected velocity is measured independently , not counting a possible common set of cross - correlation templates . for a given template , from any pair of ( projected ) velocity measurements , we can derive a relative velocity between the two objects involved .",
    "however , that figure will likely be numerically different from the value inferred from the direct cross - correlation between their spectra , even if the two objects are of the same class . in this paper",
    ", we argue that it is possible to improve the original determinations by imposing consistency among all available measurements .",
    "our discussion is oriented to the case of a homogeneous sample : multiple observations of the same or similar objects .    in the following section",
    "i introduce cross - correlation , with a brief discussion about error evaluation .",
    "section [ basic ] presents the notion of _ self - improvement _ and section [ general ] extends the method to the more realistic scenario in which the spectra in a given data set have varying signal - to - noise ratios . in  [ sdss ]",
    "we explore an application of the proposed technique involving low - resolution spectra , concluding the paper with a brief discussion and reflections about future work .",
    "the most popular procedure for deriving relative velocities between a stellar spectrum and a template is the cross - correlation method ( tonry & davis 1979 ) .",
    "this technique makes use of all the available information in the two spectra , and has proven to be far superior than simply comparing the doppler shifts between the central wavelengths of lines when the signal - to - noise ratio is low .",
    "the cross - correlation of two arrays ( or spectra ) * t * and * s * is defined as a new array * c * @xmath1 if the spectrum * t * is identical to * s * , but shifted by an integer number of pixels @xmath2 , the maximum value in the array * c * will correspond to its element @xmath3 . cross - correlation can be similarly used to measure shifts that correspond to non - integer numbers . in this case , finding the location of the maximum value of the cross - correlation function can be performed with a vast choice of algorithms .",
    "the most straightforward procedure to estimate realistic uncertainties involves an accurate noise model and monte - carlo simulations , and that is the method we use in section [ sdss ] .",
    "we employ gaussians and low - order polynomials to model the peak of the cross - correlation function . for these simple models , implemented in a companion idl code ,",
    "it is possible to derive analytical approximations that relate the uncertainty in the location of the maximum of the cross - correlation function to the covariance matrix [ u@xmath4 .",
    "digital cross - correlation , introduced in section [ xcorr ] , is commonly employed to derive doppler radial velocities between two spectra .",
    "the discussion in this section is , nonetheless , more general , and deals with the statistical improvement of a set of relative velocity measurements .",
    "if three spectra of the same object are available and we refer to the relative radial velocity between the first two as @xmath5 , an alternative estimate of @xmath5 can be obtained by combining the other relative velocity measurements , @xmath6 .",
    "assuming uniform uncertainties , the error - weighted average of the two values is @xmath7 .",
    "for a set of @xmath8 spectra , we can obtain an improved relative radial velocity determination between the pair @xmath9 by generalizing this expression @xmath10    it can be seen from eq .",
    "[ ci ] that the correlation of * t * and * s * is equal to the reverse of the correlation between * s * and * t*. thus , when the relative velocities between two spectra is derived from cross - correlation and the spectra have a common sampling , it will be satisfied that @xmath11 , but this will not be true in general .",
    "for example , if we are dealing with grating spectroscopy in air , changes in the refraction index with time may alter the wavelength scale and the spectral range covered by any particular pixel , requiring interpolation .",
    "if our choice is to interpolate the second spectrum ( * s * ) to the scale of the first ( * t * ) , this may introduce a difference between @xmath12 and @xmath13 due to different interpolation errors .",
    "we can accommodate the general case by writing @xmath14 note that this definition ensures that @xmath15 , and @xmath16 .",
    "if the quality of the spectra is uniform , and all measured radial velocities @xmath12 have independent uncertainties of the same size @xmath17 , the primed values would have an uncertainty @xmath18 . despite @xmath12",
    "may be numerically different from @xmath13 , @xmath19 will be highly correlated with @xmath20 , and thus the uncertainty in the primed velocities will not be reduced that fast . in addition , all @xmath12 are also correlated with all @xmath21 , driving the improvement farther away from the ideal @xmath22 behavior . we can expect that after a sufficient number of spectra are included , either random errors will shrink below the systematic ones or all the available information will already be extracted , and no further improvement will be achieved .",
    "the case addressed in section [ basic ] corresponds to a set of spectra of the same quality .",
    "if the uncertainties in the measured relative radial velocities differ significantly among pairs of spectra , eq . [ vprime ] can be generalized by using a weighted average @xmath23 where @xmath24 and the uncertainty is @xmath25    in the common case in which @xmath26 , the counterpart of eq .",
    "[ symmetry ] for dealing with spectra of varying signal - to - noise ratios reduces to @xmath27 where @xmath28    in the next section we use simulated spectra for a case study : multiple observations of the same object or massive surveys involving large numbers of very similar objects at intermediate spectral resolution .",
    "the sdss spectrographs deliver a resolving power of @xmath29 , over the range 381910 nm .",
    "these two fiber - fed instruments are attached to a dedicated 2.5 m telescope at apache point observatory ( gunn et al .",
    "each spectrograph can obtain spectra for 640 targets simultaneously . as a result of a fixed exposure time in sdss spectroscopic observations",
    ", the flux in a stellar spectrum at a reference wavelength of 500 nm , @xmath30 , correlates well with the @xmath31 magnitude of the star and with the signal - to - noise ratio at 500 nm ( @xmath32 ) . on average ,",
    "we find @xmath33 at @xmath34 mag . to build a realistic noise model",
    ", we used the fluxes and uncertainties for 10,000 spectra publicly released as part of dr2 ( abazajian et al .",
    "2004 ) to derive , by least - squares fitting , a polynomial approximation .",
    "when @xmath30 is expressed in erg @xmath35 s@xmath36 @xmath36 , which are the units used in the sdss data base , we can write @xmath37 where @xmath38",
    ". this relationship holds in the range @xmath39 .",
    "the uncertainties in the sdss fluxes for stars ",
    "mostly relatively bright calibration sources are not dominated by photon noise , but by a _ floor _ noise level of 23% associated with a combination of effects , including imperfect flat - fielding and scattered light corrections .",
    "errors are highly variable with wavelength , but the noise at any given wavelength depends linearly on the signal . based on the same set of sdss spectra used for eq . [ snr500 ] , we determine the coefficients in the relation @xmath40 which we use here for our numerical experiments . for a given choice of @xmath32 ,",
    "we interpolate the table of coefficients @xmath41 and @xmath42 derived from sdss data , and by inverting eq .",
    "[ snr500 ] we derive the flux at 500 nm .",
    "finally , we scale the spectrum fluxes and calculate the expected errors at all wavelengths using eq .",
    "gaussian noise is introduced for each pixel position , according to the appropriate error , simulating multiple observations of the same star to create an entire library of spectra .",
    "we employed a spectrum of hd 245 , a nearby g2 star@xmath43 ) , surface gravity ( @xmath44 ) , and kinematics , make this object a prototypical thick - disk turn - off star .",
    "] , to produce spectra that resemble sdss observations with various signal - to - noise ratios .",
    "radial velocities are also artificially introduced .",
    "the spectrum of hd 245 used here has a resolving power of @xmath45 at 660 nm to 7700 at 480 nm .",
    "this variation is , however , irrelevant when smoothing the data to @xmath46 as we do in these experiments . ] and is included in the elodie.3 database ( moultaka et al .",
    "2004 , prugniel & soubiran 2001 ) . as the rest of the library",
    ", this spectrum was obtained with the 1.9 m telescope and the elodie spectrograph at haute provence .",
    "the original fluxes are resampled to @xmath47 , and then smoothed to @xmath46 by gaussian convolution .",
    "the output fluxes are sampled with 12 pixels per resolution element . the doppler shift due to the actual radial velocity of hd 245",
    "has already been corrected in the elodie library .",
    "new values for the radial velocity in the library of simulated sdss observations are drawn from a normal distribution with a @xmath48 km s@xmath36 , as to approximate the typical range found in f- and g - type stellar spectra included in the sdss ( mostly thick - disk and halo stars ) .",
    "the wavelength scale is then doppler shifted , changed to vacuum ( @xmath49 ) , and the spectrum resampled with a step of @xmath50 in @xmath51 ( approximately 2.17 pixels per resolution element ) .",
    "the elodie spectra only cover the range @xmath52 nm , and therefore a similar range is finally kept for the sdss - style files , which include 2287 pixels .",
    "we employed a set of 40 test spectra with @xmath53 , measuring the relative radial velocities for all possible pairs .",
    "[ xcf ] illustrates two sample spectra and their cross - correlation function . to avoid very large or small numbers ,",
    "the input arrays are simply divided by their maximum values before cross - correlation .",
    "we used second and third order polynomials , as well as a gaussian to model the cross - correlation function and estimate the location of its maximum by least - squares fitting .",
    "the solid line in the lower panels of the figure are the best - fitting models .",
    "we experimented varying the number of pixels involved in the least - squares fittings ( @xmath54 ) .",
    "with the sampling used , the measured relative shifts in pixel space ( @xmath55 ) correspond to a velocity @xmath56 , where @xmath57 is the speed of light in vacuum ; one pixel corresponds to 69 km s@xmath36 .",
    "we compare the relative velocities between all pairs of spectra derived from the measurement of the location of the cross - correlation peaks with the _ known _ , randomly drawn , relative velocities .",
    "the average difference for the 1600 velocities ( 40 spectra ) @xmath58 and the rms scatter ( @xmath59 ) are used to quantify systematic and random errors , respectively .",
    "our experiments exhibit no systematic errors in the derived velocity when the number of points entering the fit @xmath54 was an odd number , i.e. , when we use the same number of data points on each side from the pixel closest to the peak of the cross - correlation function .",
    "modest offsets ( @xmath60 ) , however , are apparent when fitting polynomials to an even number of data points , despite we enforce the maximum to be bracketed by the two central data points .",
    "random errors increase sharply with the number of data points involved in the fittings for the polynomial models , but not for the gaussian model .",
    "the best results for the polynomials are obtained when the lowest possible orders are used . using less than 11 points for the gaussian did not produce reliable results , as there was not enough information to constrain all the parameters of the model , which includes a constant base line .",
    "the best performance @xmath61 km s@xmath36 was obtained using a second order polynomial and @xmath62 . using a gaussian model",
    "achieved a minimum @xmath63 km s@xmath36 , fairly independent of @xmath54 .",
    "the third order polynomial provided the poorest performance , @xmath64",
    "km s@xmath36 at best .    the cross - correlation can be computed in fourier space , taking advantage of the correlation theorem ( brigham 1974 ) .",
    "this fact is usually exploited to speed up the calculation dramatically , as fast fourier transforms can be calculated with a number of operations proportional to @xmath65 , compared to @xmath66 required by eq .",
    "note , however , that for medium - resolution surveys of galactic stars , the velocity offsets , limited by the galactic escape velocity , usually correspond to a limited number of pixels .",
    "therefore , it is only necessary to compute the values of * c * in the vicinity of the center of the array , rendering the timing for a direct calculation similar to one performed in transformed space ) took @xmath67 seconds in fourier space ( arrays padded to @xmath68 or @xmath69 ) , while in pixel space , with a lag range restricted to @xmath70 pixels ( @xmath71 km s@xmath36 ) , it took @xmath72 seconds . ] .",
    "spectra and @xmath33 .",
    "the solid line represents the original distribution , and the dashed line the result after applying self - improvement .",
    "the error distributions are symmetric because the array * v * is antisymmetric .",
    ", width=317 ]          to test the potential of the proposed self - improvement technique we repeat the same exercise described in  [ sdss1 ] , but using increasingly larger datasets including up to 320 spectra , and adopting three different values for the @xmath73 per pixel at 500 nm : 50 , 25 , and 12.5 .",
    "we calculated the cross - correlation between all pairs of spectra ( matrix * v * ) , and performed quadratic fittings to the 3 central data points , cubic polynomial fittings to the central 4 points , and gaussian fittings involving the 11 central points .",
    "we estimated the uncertainties in our measurements by calculating the rms scatter between the derived and the known relative velocities for all pairs .",
    "then we applied eq .",
    "[ symmetry ] to produce a second set of _ self - improved _ velocities .",
    "( because the array of wavelengths , @xmath74 , is common to all spectra , the matrix * v * is antisymmetric and we can use eq .",
    "[ symmetry ] instead of eq .",
    "[ vprime ] . ) a first effect of the transformation from * v * to * v * , is that the systematic offsets described in  [ sdss1 ] when using polynomial fittings with even values of @xmath54 disappear ( the same systematic error takes place for measuring @xmath12 and @xmath75 , canceling out when computing @xmath76 ) .",
    "more interesting are the effects on the width of the error distributions . fig .",
    "[ dist ] illustrates the case when a quadratic model is used for @xmath77 and @xmath33 .",
    "the solid line represents the original error distribution and the dashed line the resulting distribution after self - improvement .",
    "[ sigma ] shows the rms scatter as a function of the number of spectra for our three values of the @xmath73 ratio at 500 nm .",
    "the black lines lines show the original results , and the red lines those obtained after self - improvement .",
    "each panel shows three sets of lines : solid for the quadratic model , dotted for the cubic , and dashed for the gaussian .",
    "extreme outliers at @xmath78 km s@xmath36 , if any , were removed before computing the width of the error distribution ( @xmath59 ) .",
    "note the change in the vertical scale for the case with @xmath79 .",
    "for the experiments with @xmath80 , several runs were performed in order to improve the statistics , and the uncertainty ( standard error of the mean ) is indicated by the error bars .",
    "these results are based on the gaussian random - number generation routine included in idl 6.1 , but all the experiments were repeated with a second random number generator and the results were consistent .    as described in ",
    "[ sdss1 ] , the quadratic model performs better on the original velocity measurements for @xmath81 and @xmath82 . at the lowest considered @xmath73 value of 12.5 , however , the gaussian model delivers more accurate measurements .",
    "self - improvement reduces the errors in all cases .",
    "although a second order polynomial fitting works better than third order for the original measurements , the two models deliver a similar performance after self - improvement .",
    "interestingly , the impact of self improvement is smaller on the results from gaussian fittings than on those from polynomial fittings .",
    "as expected , the errors in the original measurements are nearly independent of the number of spectra in the test , but there is indication that at low signal - to - noise the errors after self - improvement for the polynomial models decrease as the sample increases in size , until they plateau for @xmath83 .    from these experiments",
    ", we estimate that the best accuracy attainable with the original cross - correlation measurements are about 3 , 6 , and 15 km s@xmath36 at @xmath84 , 25 , and 12.5 , respectively .",
    "our results also indicate that by applying self - improvement to samples of a few hundred spectra , these figures could improve to roughly 2.5 , 4 , and 9 km s@xmath36 at @xmath84 , 25 , and 12.5 , respectively .",
    "we obtained an independent estimate of the precision achievable by simply measuring for 320 spectra the wavelength shift of the core of several strong lines ( h@xmath85 , h@xmath86 , h@xmath87 , and h@xmath88 ) relative to those measured in the solar spectrum ( see allende prieto et al .",
    "2006 ) , concluding that radial velocities can be determined from line wavelength shifts with a @xmath89 uncertainty of 3.8 km s@xmath36 at @xmath90 , 7.2 km s@xmath36 at @xmath91 , and 15.9 km s@xmath36 at @xmath92  only 1020% worse than straight cross - correlation but these absolute measurements can not take advantage of the self - improvement technique .",
    "allende prieto et al . ( 2006 ) compared radial velocities determined from the wavelength shifts of strong lines for sdss dr3 spectra of g and f - type dwarfs with the sdss pipeline measurements based on cross - correlation .",
    "the derived @xmath89 scatter between the two methods was 12 km s@xmath36 or , assuming similar performances , a precision of 8.5 km s@xmath36 for a given method .",
    "the spectra employed in their analysis have a @xmath32 distribution approximately linear between @xmath93 and 65 , with @xmath94 and with mean and median values of 22 and 18 , respectively .",
    "their result is in line with the expectations based on our numerical tests that indicate a potential precision of 67 km s@xmath36 at @xmath95 .",
    "independent estimates by the sdss team are also consistent with these values ( rockosi 2006 ; see also www.sdss.org ) .    after correcting for effects such as telescope flexure ,",
    "the wavelength scale for stellar spectra in dr5 is accurate to better than 5 km s@xmath36 ( adelman - mccarthy et al . 2007 ) .",
    "this value , derived from the analysis of repeated observations for a set of standards and from bright stars in the old open cluster m67 , sets an upper limit to the accuracy of the radial velocities from sdss spectra , but random errors prevail for @xmath96 .",
    "provided no other source of systematic errors is present , our tests indicate that self - improvement could reduce substantially the typical error bars of radial velocities from low signal - to - noise sdss observations .",
    "this paper deals with the measurement of relative doppler shifts among a set of spectra of the same or similar objects .",
    "if random errors limit the accuracy of the measured relative velocity between any two spectra , there is potential for improvement by enforcing self - consistency among all possible pairs .",
    "this situation arises , for example , when a set of spectroscopic observations of the same object are available and we wish to co - add them to increase the signal - to - noise ratio .",
    "the spectra may be offset due to doppler velocity offsets or instrumental effects , the only difference being that in the former case the spectra should be sampled uniformly in velocity ( or @xmath97 ) space for cross - correlation , while in the latter a different axis may be more appropriate .",
    "another application emerges in the context of surveys that involve significant numbers of spectra of similar objects .",
    "radial velocities for individual objects can be derived using a small set of templates and later _ self - improved _ by determining the relative velocities among all the survey targets and requiring consistency among all measurements .",
    "the potential of this technique is illustrated by simulating spectra for a fictitious survey of g - type turn - off stars with the sdss instrumentation .",
    "our simulations show that applying self - improvement has a significant impact on the potential accuracy of the determined radial velocities .",
    "the tests performed dealt with relative velocities , but once the measurements are linked to an absolute scale by introducing a set of well - known radial velocity standards in the sample , the relative values directly translate into absolute measurements .",
    "the ongoing segue survey includes , in fact , large numbers of g - type stars , and therefore our results have practical implications for this project .    the proposed scheme handles naturally the case when multiple templates are available .",
    "templates and targets are not treated differently .",
    "relative velocities are measured for each possible pair to build @xmath12 , and consistency is imposed to derive @xmath76 by using eqs .",
    "[ vprime ] or [ vprimegen ] .",
    "if , for example , the templates have been corrected for their own velocities and are the first 10 spectra in the sample , the velocity for the @xmath98th star ( @xmath99 ) can be readily obtained as the weighted average of the @xmath76 elements , where @xmath100 runs from 1 to 10 .",
    "the final velocities would take advantage of all the available spectra , not just the radial velocity templates , with differences in signal - to - noise among spectra already accounted for automatically .",
    "very recently , zucker & mazeh ( 2006 ) have proposed another approach with the same goals as the method discussed here .",
    "their procedure determines the relative velocities of a set of @xmath8 spectra by searching for the doppler shifts that maximize the value of the parameter @xmath101 , where @xmath102 is the maximum eigenvalue of the correlation matrix  a two - dimensional array whose @xmath9 element is is the cross - correlation function between spectra @xmath100 and @xmath103 .",
    "zucker & mazeh s algorithm is quite different from the self - improvement method presented here .",
    "it involves finding the set of velocities that optimally aligns the sample spectra , whereas self - improvement consists on performing very simple algebraic operations on a set of radial velocities that have already been measured .",
    "self - improvement is obviously more simple to implement , but a detailed comparison between the performance of the two algorithms in practical situations would be very interesting .",
    "this paper also touches on the issue of error determination for relative radial velocities derived from cross - correlation , and convenient analytical expressions are implemented in an idl code available online .",
    "we have not addressed many other elements that can potentially impact the accuracy of doppler velocities from cross - correlation , such as systematic errors , filtering , sampling , or template selection .",
    "the vast number of spectra collected by current and planned spectroscopic surveys should stimulate further thought on these and other issues with the goal of improving radial velocity determinations .",
    "there is certainly an abundance of choices that need to be made wisely ."
  ],
  "abstract_text": [
    "<S> the measurement of doppler velocity shifts in spectra is a ubiquitous theme in astronomy , usually handled by computing the cross - correlation of the signals , and finding the location of its maximum . </S>",
    "<S> this paper addresses the problem of the determination of wavelength or velocity shifts among multiple spectra of the same , or very similar , objects . </S>",
    "<S> we implement the classical cross - correlation method and experiment with several simple models to determine the location of the maximum of the cross - correlation function . </S>",
    "<S> we propose a new technique , _ self - improvement _ , to refine the derived solutions by requiring that the relative velocity for any given pair of spectra is consistent with all others . by exploiting all available information , spectroscopic surveys involving large numbers of similar objects </S>",
    "<S> may improve their precision significantly . </S>",
    "<S> as an example , we simulate the analysis of a survey of g - type stars with the sdss instrumentation . applying _ self - improvement </S>",
    "<S> _ refines relative radial velocities by more than 50% at low signal - to - noise ratio . </S>",
    "<S> the concept is equally applicable to the problem of combining a series of spectroscopic observations of the same object , each with a different doppler velocity or instrument - related offset , into a single spectrum with an enhanced signal - to - noise ratio . </S>"
  ]
}