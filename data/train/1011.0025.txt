{
  "article_text": [
    "natural selection is the force that drives the fixation of advantageous phenotypic traits , and represses the increase in frequency of deleterious ones .",
    "the growing amount of genome - wide sequence and polymorphism data motivates the development of new tools for the study of natural selection . distinguishing between genuine selection and the effect of demographic history , such as gene - flow and population bottlenecks , on genetic variation presents a major technical challenge .",
    "a traditional population genetics approach to the problem focuses on computing neutral allele frequency spectra to infer signatures of natural selection as deviations from neutrality .",
    "diffusion theory provides a set of classical techniques to predict such frequency spectra @xcite , while the connection between diffusion and the theory of partial differential equations ( pdes ) allows for borrowing well established high - perfomance algorithms from applied mathematics .     a graphical representation of a model for the demographic history of three populations .",
    ", width=188 ]    the theory of predicting the frequency spectrum under irreversible mutation was developed by fisher , wright and kimura @xcite . in particular",
    "kimura @xcite noted that this theory was applicable to many nucleotide positions and introduced the _",
    "infinite sites model_. the joint frequency spectra of neutral alleles can be obtained from the coalescent model @xcite or by monte - carlo simulations @xcite .",
    "the analysis in terms of diffusion theory is mathematically simpler and can incorporate natural selection easily @xcite . in this paper , we model the demographic history of @xmath0 different populations that are descended by @xmath1 population splitting events from a common ancestral population .",
    "the populations evolve with gene exchange under an infinite sites mutation model .",
    "we introduce a powerful numerical scheme to solve the associated forward diffusion equations . after introducing a regularized discretization of the problem ,",
    "we show how spectral methods are applied to compute theoretical non - equilibrium frequency spectra .",
    "the introduction of spectral methods is usually attributed to @xcite , although they are based on older precursors , such as finite element methods , and ritz methods in quantum mechanics @xcite .",
    "the basic idea consists of using finite truncations of expansions by complete bases of functions to approximate the solutions of a pde .",
    "this truncation allows the transformation of a diffusion pde into a finite system of ordinary differential equations ( odes ) .",
    "the motivation to use these methods relies on their excellent error properties , and their high speed . in general , they are the preferred methods when the dimension of the domain is high @xcite , and the solutions to the pde are smooth .",
    "this is because the number of basis functions that one needs to approximate the solutions of a pde is much lower than the number of grid - points that one needs in a finite difference scheme , working at the same level of accuracy @xcite .",
    "as we show in this paper , the convergence of spectral methods depends on the smoothness of the solutions to be approximated . in many situations , solutions to diffusion equations",
    "have good analytical properties , and spectral methods can be applied .",
    "however , the application of these methods to the problem that interests us here requires a proper discretization of the problem .",
    "influx of mutations , population splitting events and boundary conditions have to be properly regularized before one applies these methods and exploits their high - perfomance properties .",
    "the @xmath0-dimensional allele frequency spectrum ( afs ) summarizes the joint allele frequencies in @xmath0 populations .",
    "we distinguish between the afs , which consists of the unknown distribution of allele frequencies in @xmath0 natural populations , and _ observations _ of the afs . given dna sequence data from multiple individuals in @xmath0 populations , the resulting _ observation _ of the afs is a @xmath0-dimensional matrix with the allele counts ( for a complete discussion on this see @xcite ) .",
    "each entry of the matrix consists of the number of diallelic polymorphisms in which the derived allele was found .",
    "in other words , each entry of the afs matrix is the observed number of derived alleles , @xmath2 , found in the corresponding number of samples , @xmath3 , from population @xmath4 ( @xmath5 ) .",
    "the full afs is the real distribution of joint allele frequencies at the time when the samples were collected .",
    "if the total number of diploid individuals in the @xmath6-population is @xmath7 , the natural allele frequencies @xmath8 , @xmath9 , @xmath10 ( with @xmath11 the total number of derived polymorphisms in the @xmath6 population ) can be seen as points in the @xmath0-dimensional cube @xmath12^k$ ] .",
    "thus , given the frequencies of every diallelic polymorphism ( which we indexed by @xmath13 ) @xmath14 , @xmath15 , @xmath16 , the afs can be expressed as the probability density function @xmath17 here , @xmath18 is the total number of diallelic polymorphisms segregating in the @xmath0 populations , and @xmath19 is the dirac delta function .",
    "our goal is to determine this afs under the infinite sites model .",
    "any demographic scenario in the model is defined through a population tree topology @xmath20 , such as in fig .",
    "[ figone ] , and a set of parameters that specify the effective population sizes @xmath21 , splitting times @xmath22 , and migration rates @xmath23 at different times .",
    "hence , @xmath24 is defined as the number of haploid genomes that the population @xmath4 receives from @xmath25 per generation . for simplicity",
    ", we refer to the set of parameters that specify a unique demographic scenario as @xmath26 .",
    "thus , given a population tree topology and a choice of parameters , we will compute theoretical densities of derived joint allele frequencies as functions on @xmath27^k$ ] of the type @xmath28 with @xmath29 a truncation parameter , @xmath30 a complete basis of functions on the hilbert space @xmath31 $ ] to be defined below , and @xmath32 the coefficients associated with the projection of @xmath33 onto the basis spanned by @xmath34 .",
    "these continuous densities relate to the expectation of an _ observation _ of the afs via standard binomial sampling formulae @xmath35^{k } }   \\phi(x\\vert\\theta , t)\\prod_{a=1}^{k}\\frac{n_a!}{(n_a - j_a)!j_a ! } x_a^{j_a}(1-x_a)^{n_a - j_a}dx_a.\\ ] ] using eq .",
    "we can compare model and data , for instance , by means of maximum likelihood .",
    "the major goals of this paper are twofold .",
    "first , we present the finite markov chain and diffusion approximation , associated with the infinite sites model used to compute neutral allele spectra .",
    "a special emphasis is made on the boundary conditions and the influx of mutations , because of their potential singular behavior .",
    "second , we introduce spectral methods and show how to transform the diffusion equations into coupled systems of ordinary differential equations ( odes ) that can be integrated numerically . in particular , we introduce a set of techniques to handle population splitting events , mutations and boundary interactions , that protect the numerical setup against gibbs phenomena",
    ". a detailed analysis of the stability of the methods as a function of the model parameters , and the control of the numerical error , are included at the end of the paper .",
    "the evolutionary dynamics of diallelic snp frequencies in a randomly - mating diploid population can be modeled using a finite markov chain , with discrete time @xmath36 representing non - overlapping generations . for simplicity ,",
    "we consider first one population with @xmath37 diploid individuals , and later will extend the results to more than one population .",
    "the state of the markov chain at time @xmath36 is described by the vector @xmath38 , with @xmath39 .",
    "each entry , @xmath38 , consists of the expected number of loci at which the derived state is found on @xmath40 chromosomes .",
    "therefore , @xmath41 is the expected number of polymorphic loci segregating in the population at time @xmath36 , and @xmath42 is the expected number of loci fixed for the derived state .",
    "the model assumes that the total number of sites per individual is so large , and the mutation rate per site so low , that whenever a mutation appears , it always does so on a previously homoallelic site @xcite .",
    "the vector @xmath38 , is also called the density of states . under the assumption of free recombination between loci and constant mutation rate ,",
    "the time evolution of @xmath38 under random drift and mutation influx is described by the difference equations @xmath43 in its simplest form , one assumes that the alleles in generation @xmath44 are derived by sampling with replacement from the alleles in generation @xmath36 .",
    "therefore , the transition coefficients in the chain eq .",
    "are @xmath45 this describes stochastic changes in the state after a discrete generation , fig .",
    "[ fige ] . the second term in eq .",
    "represents the influx of polymorphisms .",
    "mutations are responsible for the creation of new polymorphisms in the population .",
    "the influx of mutations depends on the expected number of sites @xmath46 , in which new mutations appear in the population each generation , relates to the expected number of mutations per base @xmath47 , by the total length @xmath48 of the genomic sequence under study in units of base pairs , @xmath49 . sometimes in this paper ,",
    "in an abuse of notation we do not distinguish between @xmath50 and @xmath51 , and they are seen as the same quantity expressed with different units . ] .",
    "if we assume that at each generation , every new mutation is found in just one chromosome , then @xmath52 for the mutation alone @xcite .",
    "the term @xmath53 in eq .",
    "is the kronecker symbol , with @xmath54 if @xmath55 and @xmath56 otherwise .      in applications of the infinite sites model ,",
    "one usually finds that the census population size and the effective population size that drives random drift in eq .",
    "are not the same @xcite .",
    "for this reason , we distinguish between @xmath57 , the effective population size that defines the variance of the wright - fisher process in eq . , and the census population size @xmath37 that can be used to define the allele frequencies @xmath58 .",
    "therefore , the smallest frequency , @xmath59 , with which new mutations enter populations will be sensitive to small stochastic fluctuations in the census population size , even if the effective population size remains constant .",
    "this is important when we take the diffusion limit of eq . , and the stochastic process is described by the continuous variable @xmath60 , rather than the integer @xmath40 . if we consider a constant census population size , the term eq . in the markov chain",
    "is substituted by @xmath61 in the diffusion limit . however , if the census population size per generation is a stochastic variable distributed as @xmath62 , the diffusion limit of the mutation term will be @xmath63 we expect that @xmath64 will have some general properties , independent of the particular characteristics of @xmath62 . for instance , in many realistic scenarios @xmath64 will be a function that is nearly zero for frequencies @xmath65 , with @xmath66 a very small characteristic frequency associated with the inverse of the minimum census population size .    other phenomena that might not be properly captured by the simple mutational model in eqs . and ,",
    "consist of organisms with partially overlapping generations , and organisms in which mutations in gametes arise from somatic mutations .",
    "when an organism has a mating pattern that violates the assumption of non - overlapping generations ( e.g. humans ) , the generation time in the model eq . is interpreted as an _ average generation time_. hence , during a generation unit , there is time enough for some individuals to be born with new mutations at the beginning of the generation time , and to reproduce themselves by the end of a generation unit .",
    "this implies that after one average generation , there can exist new identical mutations in more than one chromosome .",
    "similarly , when the gametes of an organism originate from somatic tissue , they inherit de novo mutations that arose in the soma after multiple cell divisions .",
    "if the individuals of this organism can have more than one offspring per generation , one expects to find the same new mutation , in the same site , in more than one chromosome per generation .",
    "because of these different biological phenomena , we believe that the notion of _ effective mutation density _ , @xmath64 , is a more general way to describe mutations in natural populations .",
    "the _ effective mutation density _ describes the average frequency distribution of new mutations per generation , in one population , after taking into account the effects due to stochastic changes in census population size , non - overlapping generations and/or mutations of somatic origin . from a numerical point of view , effective mutation densities are a useful tool to avoid the numerical instabilities associated with polynomial expansions of non - smooth functions ( e.g. dirac deltas ) that appear in the standard approaches to mutation influx . as we show later when we discuss the continuous limit of the infinite sites model , different effective mutation densities can yield predictions which are identical to predictions of models based on eq . .      here",
    ", we show how to incorporate arbitrarily more populations , and migration flow between them .",
    "generally , for the state in the chain we consider a discrete random variable @xmath67 which takes values in the @xmath0-dimensional lattice of derived allele frequencies : @xmath68 with @xmath0 the number of populations , and @xmath69 . for simplicity",
    ", we use a single index notation , @xmath70 , to label the states where the random variable @xmath67 takes values . the random variable @xmath71 jumps to the state @xmath72 at a discrete generation unit , with prescribed probability @xmath73 .",
    "the density of states in this multi - population setup is @xmath74 , and the difference equations that describe its dynamics are equivalent to eq . .",
    "one unit of time transition in a finite markov chain .",
    ", width=83 ]    the transition matrix @xmath75 incorporates random drift and migration events between populations .",
    "new mutations enter each population with an effective mutation vector @xmath76 @xmath77 in the standard model , the mutation density is @xmath78 .",
    "the markov chain for a wright - fisher process for two independent populations is defined by the transition matrix @xmath79 @xmath80 where @xmath81 stands for the binomial distribution with index @xmath82 and parameter @xmath83 .",
    "also , we can introduce migration between populations , by sampling a constant number of alleles @xmath84 in population @xmath4 that become part of the allele pool in population @xmath25 .",
    "thus , in a model of two populations with migration , one considers the transition matrix @xmath85 in this model the parameter space is given by the effective population sizes @xmath86 and @xmath87 , and the scaled migration rates @xmath88 and @xmath89 .",
    "this process is generalizable to an arbitrary number of populations in a straightforward way .",
    "diffusion approximations to finite markov chains have a distinguished history in population genetics , dating back to wright and fisher .",
    "this approach can be used to describe the time evolution of derived allele frequencies in several populations , with relatively large population sizes .",
    "this approximation applies when the population sizes @xmath90 are large ( if @xmath91 , the binomial distribution with index @xmath92 can be accurately approximated by the gaussian distribution used in the diffusion limit ) and migration rates are of order @xmath93 .    in the large population size limit , the state space spanned by vectors such as eq .",
    "converges to the continuous space @xmath12^k$ ] .",
    "the density of states @xmath74 on the state space will converge to a continuous density @xmath94 on @xmath12^k$ ] .",
    "the time evolution of @xmath94 depends on how the inifinitesimal change @xmath95 , @xmath96 is distributed .",
    "if the mean of the @xmath95 distribution is @xmath97 and the covariance matrix is @xmath98 , the time continuous limit @xmath99 of the process @xmath100 is well defined . in the small , but finite , limit of @xmath101",
    "the stochastic process obeys the equation @xmath102 where @xmath103 is a standard normal random variable ( with zero mean and unit covariance matrix ) in @xmath104 , @xmath105 is a square root of the covariance matrix @xmath106 , and @xmath101 is a finite , but very small , time step .    in the diffusion approximation to the discrete markov chain",
    ", the process is described as a time continuous stochastic process governed by gaussian jumps of prescribed variance and mean .",
    "these processes can be denoted using the notation of stochastic differential equations : @xmath107 where @xmath108 is the infinitesimal element of noise given by standard brownian motion in @xmath0-dimensions , and @xmath109 is the square root matrix of the covariance matrix @xmath110 , @xcite . the diffusion generator associated with eq .",
    "is @xmath111 thus , if @xmath112 is the density of allele frequencies at time @xmath113 , the time evolution of @xmath94 will be governed by the forward kolmogorov equation @xmath114 -   \\sum_{a=1}^k \\frac{\\partial}{\\partial x^a}\\left [ m^a(x , t ) \\phi(x , t ) \\right ] + \\rho(x , t).\\ ] ] here , @xmath115 is the continuous limit of @xmath116 in eq .",
    ", that describes the net influx of polymorphisms in the population per generation .      the continuous limit of the markov chain defined in eq .",
    ", in the case of @xmath0 diploid populations and in the weak migration limit , has as associated moments @xmath117 with @xmath118 the kronecker delta ( @xmath119 if @xmath120 and @xmath121 otherwise ) .",
    "the matrix element @xmath122 defines the migration rate from the @xmath123 population to the @xmath6 population .",
    "thus , associated with this process one has the kolmogorov forward equations @xmath124 eq . describes the time evolution of the frequency spectrum density under random drift and migration events between populations , given an initial density and absorbing boundary conditions ( see below ) .",
    "the inhomogenous term @xmath115 models the total incoming / outgoing flow of snps per generation into the @xmath0-cube which is not due to the diffusion flow , @xmath125 , at the boundary .",
    "this total flow depends on mutation events that generate _ de novo _ snps : inflow from higher dimensional components of the allele density ( see below ) , inflow from migration events from lower dimensional components of the allele density , and the outflow of migration events towards higher dimensional components .",
    "if there is not a positive influx of snps , the density would converge to @xmath126 as @xmath127 . in order to understand the probability flow between different components of the density of alleles",
    ", we will have to study how the boundary conditions are defined precisely .",
    "understanding the boundary conditions in this problem is one of the most challenging tasks . in kimura s famous solution to the problem of pure random drift in one population , @xcite",
    ", he required the solutions to the diffusion equation to be finite at the boundaries @xmath128 and @xmath129 .",
    "this boundary condition is absorbing .",
    "the points @xmath128 and @xmath129 describe states where snps reach the fixation of their ancestral or derived states .",
    "if we consider @xmath0 populations , the natural generalization of kimura s boundary conditions can be derived by studying the possible stochastic histories of single diallelic snps segregating in the @xmath0 populations . a snp which is initially polymorphic in all the @xmath0 populations",
    "can reach the fixation of its derived or ancestral state in one population while still being polymorphic in the remaining @xmath1 populations .",
    "more generally , a snp can be polymorphic in @xmath130 populations , while its state can be fixated in the remaining @xmath131 populations .",
    "a convenient way of visualizing this is to look at the geometry of the @xmath0-cube of allele frequencies , and the different subdimensional components of its boundary ( see examples fig .",
    "[ figboundary2 ] and fig .",
    "[ figboundary3 ] for the 2-cube and 3-cube ) .",
    "a @xmath0-cube s boundary can be decomposed as a set of cubes of lower dimensionality , from @xmath132-cubes up to @xmath113-cubes or points .",
    "the number of boundary components of codimension @xmath131 , i.e. the number of @xmath133-cubes , contained in the boundary of the @xmath0-cube is @xmath134     decomposition of the singular probability density , for two populations , on the two - dimensional bulk and the different subdimensional boundary components .",
    ", width=272 ]    the most important set of boundary components are the @xmath132-cubes , because any other boundary component can be expressed as the intersection of a finite number of @xmath132-cubes at the boundary .",
    "we identify each @xmath135 codimension - one boundary component by the population where the snps are not polymorphic , and by the state that is fixated in this population ( derived or ancestral ) .",
    "for example , the component @xmath136 is defined as the set of points in the @xmath0-cube that obeys the equation @xmath137 , and the component @xmath138 is defined by the equation @xmath139 .",
    "therefore , any codimension @xmath131 boundary component can be expressed as the intersection @xmath140^k",
    "\\vert x_{i_1}=\\delta_{s_1 , d};\\ , x_{i_2}=\\delta_{s_2 , d};\\ldots ; x_{i_\\alpha}=\\delta_{s_\\alpha , d } \\},\\ ] ] with @xmath141 when @xmath142 , @xmath143 for the derived state @xmath144 , and @xmath145 for the ancestral state @xmath146 .",
    "decomposition of the singular probability density , for three populations , on the three dimensional bulk and the different subdimensional boundary components .",
    ", width=272 ]    to each boundary component of codimension @xmath131 we associate a @xmath133-dimensional density of derived allele frequencies that are polymorphic only on the corresponding @xmath130 populations , while are fixated in the other @xmath131 populations . in this way , @xmath147 denotes the bulk probability density , @xmath148 ( with the state @xmath149 being either ancestral @xmath150 or derived @xmath151 ) are the @xmath135 codimension - one densities , @xmath152 the codimension 2 densities , etc .",
    "this decomposition is illustrated in the case of 2 and 3 populations in fig .",
    "[ figboundary3 ] and fig .",
    "[ figboundary2 ] .    in this notation",
    ", we write the density of derived alleles segregating on @xmath0 populations as the generalized probability function @xmath153 with @xmath154 the dirac delta - function .",
    "the points @xmath155 and @xmath156 are the universal fixation boundaries , and they do not contribute to the total density of alleles in eq . .",
    "it is useful to write the probability density @xmath94 using such decomposition , because despite being a singular generalized function , each boundary component @xmath157 will be , most of the time , a regular analytic function .",
    "the dynamics of the boundary components @xmath158 are governed by diffusion equations , with an inhomogenous term , of the type @xmath159 with @xmath160 the net incoming / outgoing flow into the boundary component @xmath161 @xmath162 @xmath163 @xmath164 . the @xmath165 term can be interpreted as an interaction term between different boundary components .",
    "more precisely , @xmath166 consists of four terms @xmath167 @xmath168 is the influx of spontaneous mutations ( only present in codimension @xmath1 ) , @xmath169 consists of the boundary inflow from codimension @xmath170 components that have @xmath161 @xmath162 @xmath163 @xmath171 as a boundary component , @xmath172 represents the incoming flow due to migration events from lower dimensional boundary components , and @xmath173 is the outflow due to migration events from @xmath161 @xmath162 @xmath163 @xmath164 @xmath174 towards higher dimensional components that have @xmath161 @xmath162 @xmath163 @xmath164 @xmath174 as a boundary component",
    ".    we can write in a more precise way each term in @xmath160 , as follows :    * @xmath175 : @xmath176 with @xmath177 if @xmath178 , @xmath179 if @xmath180 , and @xmath181 is the mutation density ( in the classical theory , @xmath182 ) . * @xmath183 : assuming that the first derivatives of @xmath94 are finite at the boundary , @xmath184 where the sum over @xmath185 is over all components of codimension @xmath170 that have @xmath161 @xmath162 @xmath163 @xmath164 @xmath174 as a boundary component .",
    "@xmath186 is @xmath187 when @xmath188 and @xmath113 when @xmath189 ; similarly @xmath190 is one when @xmath189 and zero when @xmath188 .",
    "the sum over @xmath4 and @xmath25 is over all populations that are not @xmath191 @xmath185 .",
    "* @xmath192 : here , and throughout , @xmath193 is a shorthand for the boundary component @xmath194 @xmath195 @xmath196 @xmath197 .",
    "@xmath198 represents the total incoming flow due to migration events of snps that are contained in densities of snps located at boundary components of @xmath193 .",
    "if @xmath199 is the set of boundary components of @xmath193 with fixed codimension @xmath200 ( @xmath201 ) , @xmath202 then @xmath198 can be written as the sum of contributions from all boundary components in @xmath203 , for all codimensions @xmath204 , and for all possible migration events from elements @xmath205 in @xmath199 to @xmath193 : @xmath206 here , @xmath207 is the set of all possible migrations events from snps in @xmath208 to @xmath209 , @xmath210 denotes the probability of occurence of the migration event @xmath211 , and @xmath212 denotes the expected frequency , in the @xmath213-population , of a snp that enters @xmath193 after the event @xmath211 .",
    "we provide below a more precise description of eq .",
    ", such as a description of the event space @xmath207 , the corresponding probabilities of occurence and expected frequencies .",
    "* @xmath214 : denotes the outflow of snps due to migration events to higher dimensional boundary components . in other words , @xmath215 measures the rate of loss of snps in @xmath209 , because of migration flow towards boundary components of codimension @xmath216 , that have @xmath193 as a boundary component .",
    "let @xmath217 be a discrete function that returns 1 when @xmath193 is a boundary component of @xmath205 , and zero when it is not .",
    "thus , @xmath218    to compute eq . and eq .",
    ", the use of approximations is unavoidable . in principle , one could use the transition probabilities of the finite markov chain to estimate the probabilities of different migration events and their expected allele frequencies . however , there is a simpler approximation , which is consistent with the weak migration limit in which the diffusion equation is derived .",
    "this approximation follows from the observation that at the boundary @xmath219 , the strength of random drift along the population @xmath4 vanishes ( @xmath220 ) , and hence , the infinitesimal change in @xmath221 obeys a deterministic equation : @xmath222 eq .",
    "implies that a migration event from several populations @xmath25 , to a target population @xmath4 , can push the frequency @xmath221 of a snp out of the boundary where it was initially fixated ( @xmath219 ) .    therefore , given a @xmath0-cube , a boundary component @xmath193 ( of codimension @xmath131 ) , and a boundary component @xmath205 ( of codimension @xmath223 ) of @xmath193",
    ", we say that there will exist migration flow from @xmath205 to @xmath193 , if and only if @xmath224 where @xmath225 denote the allele frequencies of snps which are fixated at the boundary components @xmath193 and @xmath205 , @xmath226 are the populations at @xmath193 whose allele frequencies are polymorphic , and the frequencies @xmath227 are defined at the boundary component @xmath205 ( which means that @xmath227 is polymorphic as long as @xmath228 , and is @xmath229 otherwise ) .",
    "it is important to realize that @xmath230 can be @xmath113 or @xmath187 at @xmath205 , and a migration event to @xmath193 can still bring alleles of the opposite state that is fixated in the target population .    in this approximation , @xmath207 consists of a single element , and @xmath210 can be zero or one .",
    "and eq . are satisfied , the migration event in @xmath207 has probability @xmath231 , and the expected frequencies are @xmath232 if eq .",
    "and eq . are not satisfied , @xmath233 , and we say that there is not migration flow from @xmath205 to @xmath193 .",
    "given a constant spontaneous mutation rate in the species under study , of @xmath51",
    "`` base substitutions per site and per generation , '' and expected number of sites @xmath234 where new mutations appear in the population each generation , the total number of _ de novo _ mutant sites that appear in the population @xmath4 , every generation , is @xmath235 .",
    "we can model this constant influx of mutations by adding a dirac delta term @xmath236 to the @xmath0 diffusion equations that govern the ancestral components of codimension @xmath1 @xmath237 .",
    "however , as we discussed above , more generally we work with an effective mutation density @xmath238    as a particular example of an effective mutation density , we consider a stochastic census population size , which is a random variable distributed as @xmath239 this distribution avoids extremely small populations by an exponential tail , while large population sizes are distributed as @xmath240 , as shown in fig .",
    "[ mutation_density ] . in this model ,",
    "we keep constant the effective population size @xmath57 that defines the variance of random drift in eq . .",
    "thus , the mutation density will be @xmath241 we can integrate eq .",
    "exactly , by making the change of variables @xmath242 , @xmath243 : @xmath244     a model for a stochastic census population size , with exponential decay in the small population size limit , a quadratic decay @xmath240 in the large population size limit , and a population peak at @xmath245 . , width=283 ]",
    "so far we have studied how the allele frequency density changes as a function of time while the number of populations @xmath0 remains constant .",
    "when two populations split , the diffusion jumps to dimension @xmath246 , and the corresponding density will obey the time evolution defined by eq . for @xmath246 populations , with different population sizes and migration parameters .",
    "the initial density @xmath247 in the @xmath246 diffusion problem is determined from the density @xmath248 , before the populations split .",
    "therefore , if population @xmath246 was formed by @xmath249 migrant founders from the @xmath6 population , then @xmath250 this formula is derived by considering the binomial sampling of @xmath251 chromosomes from population @xmath4 , and using the gaussian approximation for the binomial distribution with @xmath251 degrees of freedom and parameter @xmath221 . in the limit @xmath252 , eq . simplifies to @xmath253 with @xmath254 the dirac delta . additionally ,",
    "if the new population is formed by migrants from two populations merging , with a proportion @xmath255 from population @xmath256 and @xmath257 from population @xmath25 , then @xmath258 in the diffusion framework , one can also deal with populations that go extinct or become completely isolated .",
    "more precisely , if we remove the @xmath6 population , the initial density in the @xmath1 dimensional problem will be @xmath259 } \\phi_{k}(x , t ) dx_{a},\\ ] ] with @xmath260 denoting the vector @xmath261 .",
    "the idea behind spectral methods consists of borrowing analytical methods from the theory of hilbert spaces to transform a partial differential equation , such as eq .",
    ", into an ordinary differential equation that can be integrated numerically using , for instance , a runge - kutta method .    in general",
    ", the problems in which we are interested are mixed initial - boundary value problems of the form @xmath262^k",
    "\\label{fp},\\\\ b(x)\\phi(x , t)=0,\\quad x\\in\\partial d , t>0,\\label{fpb}\\\\",
    "\\phi(x,0)=g(x),\\quad x\\in d,\\label{boundary}\\end{aligned}\\ ] ] where @xmath263^k$ ] is the frequency spectrum domain with boundary @xmath264 , @xmath265 is a linear differential operator also known as the fokker - planck operator , @xmath115 is a function , and @xmath266 is the linear boundary operator that defines the boundary condition . in this paper , we are interested in the particular set of pdes defined in eq . ,",
    "although we sometimes keep the notation of eq . as a shorthand",
    "we assume that @xmath94 is for all @xmath36 an element of a hilbert space @xmath267 of square integrable functions , and associated @xmath268-product @xmath269 .",
    "furthermore , we assume that all functions in @xmath267 satisfy the boundary conditions imposed by eq . . in spectral methods we consider a complete orthogonal basis of functions for @xmath267 , that we denote by @xmath270 , which obeys @xmath271 with @xmath272 a function of @xmath256 that depends on the particular choice of basis functions",
    "one then approximates @xmath94 as the truncated expansion @xmath273 similarly , one approximates the pde in eq . by projecting it onto the finite dimensional basis @xmath274 , as @xmath275 by @xmath276",
    "we denote the finite dimensional space spanned by @xmath277 , and by @xmath278 the corresponding projector @xmath279 .",
    "if @xmath280 we can re - write the ode in eq . using just _ modal _ variables as @xmath281 one can solve eq . by discretizing the time variable @xmath36 , and using a standard numerical method to integrate odes .",
    "therefore , the spectral solution to the diffusion pde is expressed in the form of a truncated expansion , like eq . , and has coefficients determined by the integral of eq . .",
    "there are many different ways to construct sequences of approximating spaces @xmath282 that converge to @xmath267 in the limit @xmath283 , when the domain is the @xmath0-cube . here , we follow other authors preferred choice @xcite , and choose the basis of chebyshev polynomials of the first kind . in the following section we introduce chebyshev expansions and show why they are a preferred choice .",
    "let @xmath284 be the basis of chebyshev polynomials of the first kind .",
    "they are the set of eigenfunctions that solve the singular sturm - liouville problem @xmath285 with @xmath286 , and @xmath287 .",
    "@xmath288 are orthogonal under the @xmath268-product with weight function @xmath289 : @xmath290 } t_i(x ) t_j(x )   \\frac{dx}{\\sqrt{1-x^2 } } = \\frac{\\pi c_i}{2 } \\delta_{ij},\\ ] ] where @xmath291 and @xmath292 .",
    "this basis of polynomials is a natural basis for the approximation of functions on a finite interval because the associated gauss - chebyshev quadrature formulae have an exact closed form , the evaluation of the polynomials is very efficient , and the convergence properties of the chebyshev expansions are excellent @xcite .",
    "the chebyshev polynomials of the first kind can be evaluated by using trigonometric functions , because of the identity @xmath293 .",
    "the derivatives of the basis functions can be computed by utilizing the recursion @xmath294 to express the derivative as @xmath295 similar formulae can be found for higher derivatives .",
    "the coefficients in the expansion @xmath296 can be calculated by using the orthogonality relations of the basis functions @xmath297 however , a direct evaluation of the continuous inner product , eq .",
    ", can be a source of considerable problems , as in the case of the fourier series .",
    "the classical solution lies in the introduction of a gauss quadrature of the form @xmath298 if @xmath299 is smooth enough , the finite sum over @xmath300 grid points in eq . will converge quicker than @xmath301 to the exact formula @xcite . as eq .",
    "is equivalent to a discrete fourier cosine transform , general results on the convergence of cosine transforms apply also to this problem .",
    "one can see this relationship by considering the change of variables @xmath302 : @xmath303 and choosing @xmath300 equally spaced abscissas in the interval @xmath304 , @xmath305 \\cos \\left ( i\\frac{2k-1}{2q}\\pi \\right).\\ ] ]    in order to study the convergence properties of the chebyshev expansions eq . , we exploit the rich analytical structure of the chebyshev polynomials . by using the identity eq . , one can re - write eq . as @xmath306 dx.\\ ] ] if @xmath299 is @xmath307)$ ] ( i.e. , if its first derivative is continuous ) , we can twice integrate by parts eq . to obtain @xmath308   \\frac{t_i(x)}{\\sqrt{1-x^2 } } dx.\\ ] ] we can repeat this process as many times as @xmath299 is differentiable ; thus , if @xmath309)$ ] then @xmath310   t_i(x ) \\frac{dx}{\\sqrt{1-x^2}}.\\ ] ] if we use the truncation error @xmath311^{1/2}= \\left ( \\sum_{i=\\lambda}^{\\infty }   \\vert a_i\\vert^2 \\right)^{1/2}\\ ] ] as a measure of convergence of the chebyshev expansion , we may estimate its asymptotic expansion by calculating the rate of decrease of @xmath312 .",
    "but as we showed in eq . , @xmath313 , for some constant @xmath314 if @xmath309)$ ]",
    ". therefore , for large @xmath29 the error decreases as a power law @xmath315 and if the function is infinitely differentiable ( @xmath316 ) , the corresponding chebyshev series expansion will converge faster than any power of @xmath317 .    in the applications of this paper we will work with re - scaled chebyshev polynomials . as the allele frequency spectrum is defined on the interval @xmath27 $ ] , or direct products of it , we re - scale the chebyshev polynomials to obtain an orthonormal basis on @xmath27 $ ] .",
    "more precisely , the basis that we use is @xmath318 with @xmath319 $ ] , @xmath320 , @xmath321 , @xmath268-product : @xmath322}f(x)g(x)\\frac{dx}{\\sqrt{x(1-x)}},\\ ] ] and orthonormality relations , @xmath323}r_i(x)r_j(x)\\frac{dx}{\\sqrt{x(1-x ) } } = \\delta_{ij}.\\ ] ]      the joint site frequency spectrum of @xmath0 populations can be defined as a density on @xmath27^k$ ] .",
    "a natural basis of functions on the hilbert space @xmath324^k)$ ] , comes from the tensor product of one dimensional functions .",
    "more particularly , we consider the tensor product of chebyshev polynomials @xmath325 because @xmath324^k)=l^2_w([0,1])\\otimes \\cdots \\otimes l^2_w([0,1])$ ] . therefore , any square integrable function @xmath326 under the @xmath268-product @xmath327^k } f(x)g(x)\\prod_{a=1}^k\\frac{dx_a}{\\sqrt{x_a(1-x_a)}},\\ ] ] can be approximated as multi - dimensional chebyshev expansion @xmath328 the truncation parameters @xmath329 , @xmath330 can be fixed depending on the analytical properties of the set of functions that one wants to approximate and their corresponding truncation errors .",
    "there always exists a trade - off between the accuracy of the approximation ( the higher the @xmath29 the more accurate the approximation ) and the speed of the implementation of the algorithm ( the lower the @xmath29 , the faster the algorithm ) ; therefore , choosing different values of @xmath331 will yield more optimal implementations of the algorithm . here ,",
    "for simplicity in the notation , we use a unique truncation parameter @xmath332 .      in order to approximate the pdes defined in eq . by a system of odes in the modal chebyshev variables such as eq .",
    ", we need to project the fokker - planck operator in the chebyshev basis spanned by eq . .",
    "later on we will show how to deal with the influx of mutations specified by the dirac deltas .    a direct projection of the fokker - planck operator onto the chebyshev basis spanned by eq .",
    ", would require storing the coefficients in a huge matrix with @xmath333 matrix elements .",
    "fortunately , the fokker - planck operator in our problem is very simple , and its non - trivial information can be stored in just four sparse @xmath334 matrices .",
    "first , we need the random drift matrix @xmath335 and then , the three matrices needed to reconstruct the migration term @xmath336    the matrix elements in eqs . , , and can be quickly determined by means of the gauss - chebyshev quadrature defined in eq . . due to the properties of the chebyshev",
    "polynomials many matrix elements vanish .",
    "more particularly , @xmath337 and @xmath338 are upper triangular matrices ( i.e. , @xmath339 if @xmath340 ) , @xmath341 if @xmath342 , and @xmath343 if @xmath344 or @xmath345 . thus , the total number of non - trivial matrix elements that we need to compute , for a given @xmath29 , is just @xmath346 .",
    "this is much smaller than the default number of matrix elements ( i.e. , @xmath333 ) .",
    "finally , the @xmath347 matrix elements of the corresponding @xmath348 matrix in eq . can be easily recovered from the tensor product structure of the @xmath349-dimensional vector space that defines the chebyshev expansion ( as in eq . ) .",
    "thus , @xmath350 @xmath351 with @xmath352 , if @xmath353 , and @xmath354 if @xmath355 .",
    "the inhomogeneous terms in eq . that model the influx of mutations are given by effective mutation densities .",
    "as we show in the appendices , a model of mutations given by an exponential distribution will give the same results , up to an exponentially small deviation , as a standard model with a dirac delta .",
    "the motivation for using smooth effective mutation densities is that they are better approximated by truncated chebyshev expansions . as we briefly explained in the review on chebyshev polynomials and its truncated expansions",
    ", the convergence of a truncated expansion depends strongly on the analytical properties of the function to be approximated . as dirac deltas are not smooth functions , their truncated chebyshev expansions present bad convergence properties",
    "this is related to the problem of gibbs phenomena , and we will give a more detailed account of its origin below ( see _ sources of error and limits of numerical methods _ ) .    [ cols=\"^,^ \" , ]     therefore , a pairwise comparison of both equilibrium densities shows that the deviation from both models when @xmath356 is exponentially small when equilibrium is reached ( see fig .",
    "[ mutation_densities_convergence ] ) .",
    "we can show that the same is true in non - equilibrium .      here",
    ", we show how the non - equilibrium dynamics of a diffusion system under an exponential distribution mutation influx is the same ( up to an exponentially small deviation ) as a system where mutations enter the population through the standard dirac delta @xmath357 , as long as the allele frequencies are bigger than certain minimum frequency @xmath358 .",
    "below @xmath358 the dynamics will be sensitive to differences in the mutation densities .",
    "let @xmath359 be an arbitrary initial density of alleles .",
    "let @xmath360 be the solution to the diffusion equations under pure random drift and a mutation influx given by @xmath357 .",
    "@xmath361 is the solution of the diffusion equations under pure random drift and mutation influx given by the exponential effective mutation density eq . .",
    "in appendix b , we prove the following identity in the large @xmath36 limit @xmath362 with @xmath363 , and @xmath364 . if we normalize eq . by @xmath365",
    "the normalized deviation of @xmath361 from @xmath360 is , for large @xmath36 , @xmath366 we can also show , by applying the minkowski inequality to eq . in appendix b , that @xmath367 for all @xmath368 .",
    "this means that the deviation is bounded by @xmath369 for all @xmath36 , and therefore the non - equilibrium dynamics of @xmath360 and @xmath361 are identical in the large @xmath370 limit .",
    "as @xmath371 at time zero and the deviation of @xmath361 from @xmath360 attains equilibrium in the large @xmath36 limit , we can study the frequency dependence of such deviation by looking at the equilibrium @xmath372 here , the @xmath373 term exactly cancels the singularity at @xmath129 and the deviation decays exponentially as a function of the frequency .",
    "this shows that for frequencies @xmath374 the dynamics of a model with mutation influx given by a dirac delta is the same , up to an exponentially small deviation , as the non - equilibrium dynamics of a model with exponential mutation density .",
    "modeling a population splitting event also involves the use of dirac deltas , as in eq . , or peaked functions such as eq .",
    ", whose truncated chebyshev expansions may present bad convergence properties .",
    "these gibbs - like phenomena can be dealt with in a similar way as we did with the mutation term of eq . .",
    "we implemented two different solutions to this problem and both solutions yielded similar results .",
    "diffusion under pure random drift acts by smoothing out the initial density at @xmath375 .",
    "here we show numerical solutions to the diffusion equations with @xmath376 , at @xmath377 different times , with initial condition @xmath378 .",
    "as time passes , the numerical solution approaches the exact solution more quickly , and the gibbs phenomena disappear .",
    ", width=321 ]    first , we constructed a smoothed approximation of the dirac delta by using gaussian functions : @xmath379 with @xmath380 and @xmath381 as a standard deviation which is chosen as small as possible while preserving the bound on error , @xmath382 } < \\epsilon$ ] , for any value of @xmath383 $ ] . in order to map the @xmath384-function in eq . to a truncated chebyshev expansion",
    ", @xmath385 one has to perform a gauss - chebyshev quadrature in 2 dimensions , @xmath386 , @xmath387 : @xmath388    the second approach exploits the analytical behavior of diffusion under pure random drift ( i.e. , with no migration ) .",
    "by kimura s solution to the diffusion pde in terms of the gegenbauer polynomials @xmath389 , see @xcite , we know that the time evolution of 1-d density is @xmath390 with @xmath391 , @xmath392 and @xmath393 . thus , in the exact solution to the diffusion equation , the time evolution of the coefficients of degree @xmath256 in the gegenbauer expansion is described by the term @xmath394 .",
    "this means that diffusion smooths out the dirac delta at initial time .",
    "[ figii ] represents the evolution of the density at different times .",
    "thus , we can use diffusion under pure random drift to smooth out the density introduced after the population splitting event .",
    "let @xmath248 be the density before the splitting and let @xmath4 be the population from which population @xmath246 is founded .",
    "we initially consider the density @xmath395 the associated chebyshev expansion @xmath396 will present gibbs - phenomena .",
    "however , by diffusing for a short time @xmath397 under pure random drift @xmath398 ( with @xmath399 , @xmath400 for @xmath401 , and @xmath402 ) , @xmath403 becomes tractable under chebyshev expansions .",
    "in other words , by choosing @xmath397 such that the error bound is satisfied @xmath404 we obtain a smooth density after the population splitting event which can follow the regular diffusion with migration prescribed in the problem , and approximate accurately the branching - off event . in some limits this approximation can fail , though we leave the corresponding analysis for the next section .    here",
    ", we do not consider the numerical solution to the problem of splitting with admixture , although we are confident that it should be possible to solve along similar arguments .",
    "there are two major sources of error in these numerical methods .",
    "first , the solution of the diffusion equation is itself a time - continuous approximation to the time evolution of a probability density evolving under a discrete markov chain .",
    "hence , whenever the diffusion approximation fails , its numerical implementation will also fail .",
    "secondly , a numerical solution by means of spectral expansions involves an approximation of the infinite dimensional space of functions on a domain by a finite dimensional space generated by bases of orthonormal functions under certain @xmath268-product .",
    "as we show below , under a broad set of conditions the numerical solution will converge accurately to the exact solution ; otherwise , the numerical solution can fail to approximate the exact solution .",
    "a third source of error appears because one has to discretize time in order to integrate the high - dimensional ode that approximates the pde .",
    "fortunately , this source of error can be ignored because the diffusion generators yield a stable time evolution .",
    "we summarize below the main conditions that have to be satisfied in order to obtain high - quality numerical solutions to the pdes studied in this work .      in the diffusion approximation to a markov chain",
    ", the transition probability is approximated by a gaussian distribution @xcite . here , we review the derivation of the diffusion equation as the continuous limit of a markov chain , in order to emphasize the assumptions made and determine the limits of this approximation .    given a markov process defined by a discrete state space @xmath405 , transition matrices @xmath406 , initial value @xmath407 and discrete time @xmath408 , the probability that the state will be at @xmath409 at time",
    "@xmath397 is @xmath410 , where @xmath410 obeys the recurrence relation @xmath411 in the diffusion approximation one considers a sequence of discrete state spaces @xmath412 such that in the limit @xmath413 the state space @xmath414 converges to a smooth manifold ( in practical applications , a compact domain @xmath415 ) .    in this paper , we take @xmath416 to be @xmath417^k$ ] , and @xmath418^k$ ] .",
    "therefore , the state variables can be re - scaled as @xmath419 , with @xmath420 and @xmath421^k$ ] .",
    "similarly , we introduce the time variable @xmath422 . in the large @xmath423 limit",
    ", the transition probability for the change of the state from time @xmath424 to time @xmath425 is governed by a distribution with moments @xmath426 in this continuous limit , the equation that describes the time evolution of the markov chain in eq .",
    "can be written as a forward kolmogorov equation if we neglect terms of order @xmath427 . however , if @xmath428 is proportional to @xmath423 , the @xmath427 terms in eq . can not be neglected and the diffusion approximation will not be valid . as in this paper",
    "we take @xmath429 , and @xmath428 proportional to the migration rates @xmath23 , if the migration rates obey @xmath430 the diffusion approximation will be valid . indeed , computer experiments show that the numerical solutions become unstable and yield incorrect results if this bound is violated .",
    "this limit precisely defines when two populations can be considered the same @xcite .",
    "therefore , in cases when @xmath431 , we can consider populations @xmath4 and @xmath25 as two parts of the same population .",
    "another assumption in the diffusion approximation is that a binomial distribution with @xmath432 degrees of freedom can be approximated by a gaussian distribution .",
    "this will be a valid approximation as long as @xmath21 is large enough .",
    "numerical experiments show that the approximation is accurate if @xmath433 ; otherwise , effects due to the finiteness of the markov chain can not be neglected and the approximation will fail .",
    "spectral methods , as with any numerical scheme for solving pdes , require several assumptions about the behavior of the solution of the pde .",
    "the most important one is that one can approximate the solution as a series of smooth basis functions , @xmath434 in other words , the projection of the solution @xmath435 is assumed to approximate @xmath94 well in some appropriate norm for sufficiently large @xmath29 .",
    "as one has to choose finite values for @xmath29 , eq . will sometimes fail to approximate correctly the solution of the pde .    in the applications of this paper ,",
    "the basis of functions that we use consist of the chebyshev polynomials of the first kind on @xmath436 $ ] , or with the re - scaled basis @xmath437 defined on @xmath438 $ ] , by performing a simple scale transformation . ] . below we provide bound estimates for the truncation error @xmath439^k } $ ] , to understand the quality of the approximate solutions for different values of @xmath29 , ( see also @xcite for different choices of basis functions ) .",
    "more precisely , as the @xmath268 inner product and norm in the chebyshev problem are : @xmath440^k}=\\int_{[-1,1]^k}f(x)g(x)\\prod_{i=1}^k\\frac{dx_i}{\\sqrt{1-x_i^2}},\\ ] ] and @xmath441^k}^2=\\int_{[-1,1]^k}\\vert f(x)\\vert^2 \\prod_{i=1}^k\\frac{dx_i}{\\sqrt{1-x_i^2}},\\ ] ] the terms in the expansion eq . can be computed by performing inner products @xmath442^k}\\phi(x , t )   t_{i_1}(x_{1})t_{i_2}(x_{2})\\cdots t_{i_k}(x_{k } ) \\prod_{j=1}^k\\frac{dx_j}{c_{i_j}\\sqrt{1-x_j^2}},\\ ] ] with @xmath291 and @xmath443 ( @xmath444 ) .",
    "a consequence of the orthogonality of the basis functions is that the squared truncation error admits a simple formulation in terms of the coefficients in the expansion : @xmath445^k}=   \\left ( \\frac{2}{\\pi } \\right)^k \\sum_{i_1\\geq\\lambda}\\cdots\\sum_{i_k\\geq\\lambda }    \\vert \\alpha_{i_1,i_2,\\ldots i_k}(t ) \\vert^2.\\ ] ] thus , the truncation error depends only on the decay of the higher modes @xmath446 in the expansion . on the other hand ,",
    "the decay of these higher modes depends on the analytical properties of @xmath94 itself .",
    "for instance , if @xmath447^k \\right)$ ] , i.e. if @xmath448^k } < \\infty,\\ ] ] we can integrate by parts eq .",
    ", as we did in eq .",
    ", to write the decay of each mode as @xmath449^k } \\left [ \\prod_{j=1}^k \\left ( \\sqrt{1-x_j^2}\\frac{\\partial}{\\partial x_j}\\right)^{2q_j }   \\phi(x , t)\\right]\\times \\nonumber \\\\ \\frac{t_{i_1}(x_{1})}{c_{i_1 } i_1^{2q_1 } \\sqrt{1-x_1 ^ 2 } } dx_1\\cdots   \\frac{t_{i_k}(x_{k})}{c_{i_k } i_k^{2q_k}\\sqrt{1-x_k^2 } } dx_k \\bigg\\vert.\\nonumber\\end{aligned}\\ ] ] eq .",
    "implies that the truncation error is directly related to the smoothness of @xmath94 ; it follows that we can bound the truncation error as a function of @xmath29 : @xmath450^k } \\leq   c(q ) \\lambda^{-\\sum_j q_j } \\left\\vert   \\prod_{j=1}^k \\left[\\sqrt{1-x_j^2}\\frac{\\partial}{\\partial x_j}\\right]^{q_j } \\phi(x , t ) \\right\\vert_{l^2[-1,1]^k}.\\ ] ] another convenient measure of smoothness is the sobolev norm : @xmath451^k}^2 = \\sum_{s_1=0}^{q_1}\\cdots \\sum_{s_p=0}^{q_k }   \\left\\vert    \\prod_{j=1}^k \\left(\\frac{\\partial}{\\partial x_j}\\right)^{s_j } \\phi(x ) \\right\\vert_{l^2[-1,1]^k};\\ ] ] in terms of the sobolev norm , the truncation error is bounded as @xmath452^k } \\leq   c \\lambda^{-\\sum_j q_j } \\left\\vert   \\phi(x , t ) \\right\\vert_{w^{q_1,\\ldots , q_k}[-1,1]^k}.\\ ] ] a corollary of eq .",
    "is that if @xmath94 is smooth , @xmath435 converges to @xmath94 more rapidly than any finite power of @xmath453 .",
    "this is indeed the basic property that has given name to spectral methods .    in the absence of influx of polymorphisms in the populations ,",
    "the time evolution of the density obeys pure diffusion , and therefore @xmath454 when @xmath127 as it follows from eq . .",
    "this means that diffusion acts as a smoothing operator on the initial density .",
    "empirically , we find that in the presence of influx of polymorphisms the density can also be approximated by spectral expansions and the truncation error remains low .    after two populations split and",
    "the @xmath0-dimensional diffusion becomes a @xmath246 dimensional process , the @xmath246 dimensional density becomes a distribution concentrated in the linear subspace of @xmath455^{k+1}$ ] defined by @xmath456 ( with @xmath4 and @xmath457 labeling the two daughter populations that just split ) .",
    "such density has an infinite sobolev norm and can not be represented as a finite sum of polynomials .",
    "fortunately , the diffusion generator acts on the density by smoothing it out and by bringing the density to a density with finite sobolev norm .",
    "the main variables involved in this process are : the time difference between the current splitting event and the next one , @xmath458 , and the effective population sizes @xmath21 and @xmath459 of the daughter populations .",
    "therefore , depending on the choice of the truncation parameter @xmath29 , a minimum diffusion time @xmath460 will be necessary to bring the truncation error within desired limits @xmath461 . here",
    ", @xmath462 is the control parameter on numerical error .",
    "therefore , the bigger the largest effective population size of the two daughter populations , the bigger will be such minimum diffusion time .",
    "if the time difference between the current splitting event and the next one is bigger than @xmath463 ( where @xmath464 is a function that can be computed numerically ) , the resulting numerical error will stay below the desired limits .",
    "as our model aims to reproduce the real snp allele frequency spectrum density there should exist low error approximations of such density ( that we denote as @xmath465 ) in terms of polynomial expansions .",
    "otherwise , the methods here presented will fail to solve the problem .",
    "this can only happen if @xmath465 is so rugged , i.e. the corresponding sobolev norm is so high , that the largest finite choice for @xmath29 that we can implement in our computer - code is not large enough to approximate accurately @xmath465 : @xmath466^k } \\sim   c \\lambda_{max}^{-\\sum_j q_j } \\left\\vert   \\hat{\\gamma}(x ) \\right\\vert_{w^{q_1,\\ldots , q_k}[-1,1]^k}\\gg \\epsilon .\\ ] ] in case that eq . is obeyed , it is likely that @xmath467 or more populations are so closely related that we can treat them as if they were one identical population . if we reduce the dimensionality of the problem in this way ( by only incorporating differentiated populations ) , the correlations will disappear and the sobolev norm of @xmath468 will be such that we will be able to find a sensible parameter @xmath29 to approximate @xmath468 as a truncated chebyshev expansion .",
    "in this paper we have introduced a forward diffusion model of the joint allele frequency spectra , and a numerical method to solve the associated pdes .",
    "our approach is inspired by recent work in which similar models were proposed @xcite .",
    "analogously , our methods are quite general and can accomodate selection coefficients and time dependent effective population sizes .",
    "the major novelties of the model here presented with respect to previous work are :    * the introduction of spectral methods / finite elements in the context of forward diffusion equations and infinite sites models .",
    "traditionally , these techniques yield better results than finite differences schemes when the dimension of the domain is high ( i.e. , when the final number of populations is high ) , and the solutions are smooth .",
    "a comparison of our implementation using spectral methods , and previous implementations using finite differences @xcite , will be the matter of future work . * a set of boundary conditions that deals with the possibility that some polymorphisms reach fixation in some populations while remaining polymorphic in other populations .",
    "when the differences in effective population sizes between different populations are large , this phenomenon can become very important . here , we have introduced a solution to address this possible scenario .",
    "previous work imposed zero flux at the boundaries @xcite , and hence avoided the fixation of polymorphisms in some populations while remaining polymorphic in the rest . * the introduction of effective mutation densities , which generalize previous models for the influx of mutations @xcite .",
    "we have emphasized how different ways to inject mutations at very low frequencies converge to the same solution for larger frequencies .",
    "the non - equilibrium theory of allele frequency spectra is of primary importance to analyze population genomics data .",
    "although it does not make use of information about haplotype structure or linkage non - equilibrium , the analysis of afs allows the study of demographic history and the inference of natural selection . in this work ,",
    "we have extended the diffusion theory of the multi - population afs , to accommodate spectral methods , a general framework for the influx of mutations , and non - trivial boundary interactions .",
    "we thank rasmus nielsen , anirvan sengupta , simon gravel and vitor sousa for helpful conversations .",
    "this work was partially supported by the national institutes of health ( grant number r00hg004515 - 02 to k. c. and grant number r01gm078204 to j. h. ) .",
    "in this appendix we compute the equilibrium densities associated with wright - fisher processes with mutation .",
    "two types of mutation processes are considered , both modeled by a mutation density .",
    "the first mutation density is a dirac delta , while the second one is an exponential distribution .    as the diffusion equation that describes the time evolution of the density of alleles for diallelic snps is @xmath469 + 2n_e u \\mu(x),\\ ] ]",
    "the equilibrium density @xmath470 satisfies @xmath471 . by using instead the function @xmath472 ,",
    "the associated second order ordinary differential equation becomes @xmath473 as eq .",
    "is only defined for @xmath474 , we can use laplace transforms to solve the equation .",
    "let @xmath475 be the laplace transform associated with the mutation density @xmath64 , and @xmath476 the laplace transform associated with @xmath477 , with @xmath478 and @xmath479 integration constants .",
    "therefore , in the @xmath480 domain , @xmath481 is @xmath482 and by performing the inverse laplace transform we obtain the solution to the equilibrium density @xmath483 we fix the integration constants , @xmath478 and @xmath479 , by requiring @xmath484 to be finite at @xmath129 , and the probability flow at @xmath129 to be equal to @xmath51 , @xmath485 as an example , we can evaluate exactly eq .",
    ", for @xmath486 and @xmath487 . for the dirac delta , the laplace transform is @xmath488 if we compute the corresponding inverse laplace transform in eq . , and fix the integration constants as explained above , we find the equilibrium density @xmath489 with @xmath490 the heaviside step function ( @xmath491 for @xmath492 , @xmath493 for @xmath494 , and @xmath495 for @xmath496 ) . if @xmath497 , eq .",
    "simplifies to @xmath498 in the case of @xmath487 , the laplace transform is @xmath499 and the corresponding equilibrium density , after integrating eq . , is @xmath500 which in the large @xmath370 limit , and for @xmath501 , converges exponentially quickly to @xmath502    in the limit @xmath503 , @xmath484 is finite only iff @xmath504 , which is the normalization choice made in eq . , and the only one satisfying @xmath505",
    "this shows how a mutation model defined by a certain class of smooth mutation densities reaches the same equilibrium density , up to a small deviation , as the standard model with a dirac delta .",
    "in this appendix we compare the non - equilibrium dynamics of models with a mutation influx described by exponential distributions , with models that consider a standard dirac delta .",
    "more particularly , we prove that if @xmath360 is the solution to an infinite sites model pde , with absorbing boundaries , @xmath506 + 2n_e u\\delta(x-1/(2n_e)),\\ ] ] and @xmath361 is the solution to the same model , but with an exponential mutation density @xmath507 + u",
    "\\frac{\\kappa^2 \\exp(-\\kappa x)}{1-\\exp(-\\kappa)-\\kappa\\exp(-\\kappa)},\\ ] ] then , the _ deviation _ of @xmath361 with respect to @xmath360 , as a function of time and for any initial condition @xmath508 , is , in the large @xmath36 limit , @xmath509 here , @xmath510 is the absolute value , and @xmath373 are terms that decay exponentially as a function of @xmath370 , which can be neglected in the large @xmath370 limit .    as the total number of snps that are polymorphic in one population depends on the population size and the mutation rate ,",
    "it is convenient to normalize the deviation eq . by @xmath511 . in this normalization",
    "we have @xmath366    to prove eq .",
    ", we first describe the solutions to eq . and",
    "both equations consist of a homogeneous term and an inhomogeneous contribution given by the mutation density . as they are linear equations , the solution to the pde is the sum of a homogeneous and an inhomogeneous term @xmath512 satisfying @xmath513 + \\nonumber\\\\ \\frac{1}{4n_e}\\frac{\\partial^2}{\\partial x^2}\\left [ x(1-x ) \\phi^e_1(x ) \\right ] + 2n_e u\\delta(x-1/(2n_e ) ) .",
    "\\label{equation_delta2}\\end{aligned}\\ ] ] hence , the only time - independent term @xmath514 that solves eq . is the equilibrium density eq .",
    ", and @xmath515 obeys a standard diffusion equation with no mutation density , and with initial condition @xmath516 .",
    "if @xmath517 denotes the fokker - planck operator acting on @xmath518 , @xmath519,\\ ] ] we can write the solution to eq . in the following compact form @xmath520 here ,",
    "@xmath521 is the time - dependent action of the diffusion operator on the initial density @xmath522 while preserving the absorbing boundary conditions .",
    "this operator can be diagonalized in the basis of gegenbauer polynomials on @xmath523)$ ] ; see @xcite .",
    "the corresponding eigenvalues of @xmath521 are @xmath524 with @xmath525 .",
    "we can solve eq . in a similar way , by using the decomposition @xmath526 in this case , @xmath527 is the equilibrium density associated with the exponential mutation density , as defined in eq . .",
    "the term @xmath528 evolves under pure random drift , with no mutation influx , and initial condition @xmath529 : @xmath530 by subtracting eq . from eq .",
    ", we can describe the time evolution of the deviation as @xmath531 which is independent of the initial condition @xmath359 .",
    "one can show that @xmath532 is non negative on @xmath27 $ ] , if @xmath364 .",
    "this can be seen more clearly by computing @xmath532 in the large @xmath370 limit @xmath533 . \\label{conditionii}\\end{aligned}\\",
    "] ] the terms of order @xmath534 in eq .",
    "exactly cancel the divergence at @xmath129 .",
    "therefore , the action of the diffusion operator on @xmath532 , will preserve the non - negativity of the density @xmath535,\\quad \\forall t>0.\\ ] ] because of this inequality , the absolute value @xmath536 , is the same as @xmath537 , and we can evaluate exactly the integral @xmath538 by expanding @xmath537 in the eigenbasis of @xmath521 . this basis is orthogonal under the @xmath268-product defined by the weight @xmath539 , and the constant function on @xmath27 $ ] corresponds to the eigenfunction with the smallest eigenvalue . in this way we can interpret the right - hand side of eq . as a projection on this eigenfunction , and evaluate the integral exactly .",
    "the eigenbasis of @xmath521 is defined by the gegenbauer polynomials . as an example , the first three gegenbauer polynomials on @xmath27 $ ] , orthonormal under the @xmath268-product with weight @xmath539 , are @xmath540 the corresponding eigenvalues in @xmath521 , are eigenvalues @xmath541 , @xmath542 , and @xmath543 .",
    "thus , eq . is the same as @xmath544 and @xmath545 as @xmath546 for all @xmath319 $ ] and for @xmath547 , we lastly compute eq . , as @xmath548 which is @xmath549 as we wanted to show .",
    "r. n. gutenkunst , r. d. hernandez , s. h. williamson , and c. d. bustamante , _ inferring the joint demographic history of multiple populations from multidimensional snp frequency data_. plos genet , vol . 5 , no . 10 .",
    "( 2009 ) .      j. hey and r. nielsen , _ multilocus methods for estimating population sizes , migration rates and divergence time , with applications to the divergence of drosophila pseudoobscura and d. persimilis_. genetics , vol .",
    "167 , 747 - 760 , ( 2004 ) .",
    "s. h. williamson , r. hernandez , a. fledel - alon , l. zhu , r. nielsen , et .",
    "al . , _ simultaneous inference of selection and population growth from patterns of variation in the human genome_. proc .",
    "usa * 102 * 7882 - 7887 , ( 2005 ) ."
  ],
  "abstract_text": [
    "<S> a major challenge in the analysis of population genomics data consists of isolating signatures of natural selection from background noise caused by random drift and gene flow . analyses of massive amounts of data from many related populations require high - performance algorithms to determine the likelihood of different demographic scenarios that could have shaped the observed neutral single nucleotide polymorphism ( snp ) allele frequency spectrum . in many areas of applied mathematics , fourier transforms and spectral methods </S>",
    "<S> are firmly established tools to analyze spectra of signals and model their dynamics as solutions of certain partial differential equations ( pdes ) . </S>",
    "<S> when spectral methods are applicable , they have excellent error properties and are the fastest possible in high dimension ; see @xcite . in this paper </S>",
    "<S> we present an explicit numerical solution , using spectral methods , to the forward kolmogorov equations for a wright - fisher process with migration of @xmath0 populations , influx of mutations , and multiple population splitting events .     corresponding author . ] </S>"
  ]
}