{
  "article_text": [
    "all ground - based astronomical spectra suffer from contamination by the earth s atmosphere , which introduces so - called telluric lines into the spectrum .",
    "the wavelength of the telluric lines change very slightly with wind along the line of sight and pressure shifts in water lines , and the relative line strength can vary a great deal with the observatory location , weather and the airmass of the observation .",
    "the telluric lines must be removed from the spectrum to retrieve many stellar features redward of about 500 nm , which is a nontrivial task .",
    "often , telluric lines are removed by observing a rapidly rotating hot star ( spectral type a or late b ) near the same time and airmass as the target star and using it as a template for the telluric spectrum .",
    "this approach has several disadvantages : ( 1 ) it can be difficult to find a suitable standard star near the same time and airmass as the observation , so approximate corrections are made to the line strengths using beer s law @xcite ; ( 2 ) the water vapor content changes much more rapidly than the other absorbing species in the atmosphere , so scaling the whole empirical telluric spectrum is incorrect ( 3 ) the standard star has strong hydrogen and helium lines and weak metal lines that can further contaminate the science spectrum ; ( 4 ) observing a standard star can take a significant amount of precious telescope time , especially for high signal - to - noise work .",
    "a better solution is often to generate a theoretical telluric absorption spectrum from a line list and the observing conditions .",
    "recently , several groups @xcite have used the lblrtm code ( * ? ? ?",
    "* line by line radiative transfer model ) for this purpose .",
    "however , the interface for the lblrtm code can be difficult to learn , and can not directly fit an observed spectrum .",
    "in this paper we describe telfit , a code that acts as a wrapper to lblrtm and allows for easy fitting of the telluric spectrum in astronomical data .",
    "we compare the results to those obtained from empiricial telluric correction in optical echelle spectra , and find that model - fitting produces similar telluric line residuals and is in fact better for dim targets or high signal - to - noise ratio work .",
    "we only demonstrate the use of telfit in optical spectra in this work , but note that an earlier version of this code corrected telluric methane absorption near @xmath1 m to @xmath2 of the continuum level @xcite . @xcite",
    "provide a case study of telluric modeling in several bands in the near - infrared using a different code , and find similar results .",
    "we describe the observations and data reduction used in this paper in section [ sec : obs ] .",
    "we then describe the telfit code and give a brief description of the telluric fitting procedure in section [ sec : tellcorr ] . finally , we demonstrate the use of the telfit code to correct several optical telluric bands in section [ sec : results ] .    [ cols=\"^,^,^,^,^,^,^ \" , ]",
    "we observed representative spectra for the early and late - type stars listed in table [ tab : sample ] .",
    "the a - stars hip 20264 and hip 25608 were observed with the chiron spectrograph on the 1.5 m telescope at cerro tololo interamerican observatory ( ctio ) .",
    "this spectrograph has a spectral resolution of @xmath3 from @xmath4 nm , and uses 3x1 binning along the spatial direction .",
    "the data were bias - subtracted , flat - fielded , and extracted using standard iraf tasks .",
    "the reduced spectra were wavelength - calibrated using a thar lamp exposure from immediately before the observation of the star . in order to reach high a signal - to - noise ratio and avoid detector saturation , we co - added 7 spectra after reduction and telluric correction ( see section [ sec : tellcorr ] ) .",
    "in addition , several m - type stars were observed with the magellan inamori kyocera echelle ( mike ) optical echelle spectrograph on the clay telescope at magellan observatory as spectral type standards for a study of young stars @xcite .",
    "we used the @xmath5 slit , which yields a spectral resolution of @xmath6 from @xmath7 nm .",
    "the pixel scale oversamples the resolution with the @xmath5 slit , so we used 2x binning in the spatial and spectral directions .",
    "the spectra were reduced using the carpy pipeline @xcite .",
    "the reduced spectra were wavelength calibrated using a combination of a thar lamp exposure and the 760 nm telluric a band ( see * ? ? ? * for details ) .",
    "telfit can handle rapidly rotating early - type stars without preprocessing the spectra by fitting a savitzky - golay smoothing filter @xcite as a pseudo - continuum for the telluric lines . for more feature - rich late - type stars ,",
    "we remove an approximation to the stellar spectrum using the procedure below before fitting the telluric lines .    1 .",
    "make an initial guess telluric spectrum with telfit .",
    "the guess spectrum intentionally has slightly higher molecular mixing ratios than the correct values so that it over - corrects the telluric lines . 2 .",
    "divide the observed spectrum by the guess telluric spectrum .",
    "this leaves a spectrum with stellar lines in absorption and telluric residuals appearing like emission lines .",
    "3 .   find the best - fit stellar model to the absorption lines using a grid of phoenix model spectra @xcite with effective temperature and log(g ) near the expected values for the star .",
    "4 .   divide the original data ( before the telluric over - correction in step 1 ) by the best - fit normalized stellar spectrum .",
    "this leaves a spectrum that is mostly telluric lines , but which may have strong stellar line residuals .",
    "5 .   enumerate the wavelength ranges that are strongly affected by stellar line residuals , and tell telfit to ignore them .",
    "we ignored all wavelengths from 817.5 - 820 nm in our m - star spectra , which have strong residuals from the sodium lines .",
    "the fit to the primary star does not need to be perfect .",
    "indeed , if we could perfectly model stellar spectra there would be little reason to observe them !",
    "the purpose of the preprocessing described above is to ensure that telluric lines dominate the spectrum before fitting .",
    "any strong residuals from that process can and should be ignored in the telluric fit . while a physically better solution would be to fit the stellar and telluric spectra simultaneously ,",
    "the method described above will often work well enough for most purposes and is much faster than a simultaneous fit .",
    "the telfit code performs a least - squares fit using a constrained levenberg - marquardt algorithm @xcite .",
    "it is extremely flexible ; the user can decide which atmospheric parameters to fit , which spectral regions to use in the fit , how the detector point spread function ( psf ) is modeled , the order of the continuum fit used in each iteration , and whether the data wavelengths are calibrated to fit the model or vice versa .",
    "the algorithm will optimize the fitting variables , as well as the detector resolution and the wavelength solution .",
    "lblrtm requires an atmosphere profile giving the temperature , pressure , and the abundance of several molecules as a function of height .",
    "we provide a default atmosphere profile with the telfit code that is acceptable for mid - latitude observatories , but provide the ability to easily give an alternate atmosphere profile for more accurate results .",
    "while telfit explicitly fits the temperature , pressure , and abundances at the observatory altitude , it scales the quantities at _ all _ atmosphere layers . for the pressure and temperature ,",
    "it finds the difference between the requested pressure ( temperature ) at the requested altitude , and the pressure ( temperature ) in the atmosphere profile .",
    "if @xmath8 is the requested pressure at altitude @xmath9 , and the atmosphere profile pressure is @xmath10 at that altitude , then the pressure @xmath11 at each atmosphere layer @xmath12 is scaled as @xmath13 the temperature is scaled in the same way as the pressure above , and is done in this way so that the quantities more than about 10 km above the observatory are effectively unchanged .",
    "the mixing ratio of all molecules is scaled in a much simpler way : if @xmath14 is the requested mixing ratio at the telescope altitude , and @xmath15 is the mixing ratio in the atmosphere profile , the mixing ratio at each layer @xmath16 is given by @xmath17 _ because of the way telfit scales the temperature , pressure , and molecular mixing ratios in every atmosphere layer , the optimized values should not be taken as a measurement of the actual surface mixing ratios . _    in each iteration for the main variables ( temperature , pressure , telescope zenith angle , and molecular abundances ) , telfit refines the wavelength solution and detector resolution . the wavelength fitter performs a third - order polynomial fit to adjust the wavelengths of the model such that the telluric lines match the data",
    "alternatively , the data wavelengths can be adjusted to fit the model .",
    "the wavelength solution of the data should be very close , as telfit will not shift any wavelengths by more than 0.1 nm . by default , telfit fits the spectrograph psf as a gaussian , and fits the detector resolution by finding the best gaussian width to convolve the model against .",
    "alternatively , telfit can do a nonparametric fit to the spectrograph psf using the singular value decomposition described in detail in @xcite",
    "we fit the spectra for the rapidly - rotating a0v star hip 20264 with a two - step approach . in the first step ,",
    "we fit the observatory temperature and humidity in the echelle orders dominated by the water bands at 590 nm , 650 nm , 700 nm , and 730 nm . for the rest of the fit ,",
    "the humidity and temperature were fixed at the @xmath18-weighted average of the fits for each band .",
    "next , we fit the @xmath19 abundance with the @xmath20 and b bands near 630 nm and 690 nm , respectively .",
    "because the blue end of the b band is extremely strong and absorbs nearly all the light , we only use the red half in the fit .",
    "the @xmath19 abundance was fixed at the @xmath18-weighted average of the individual fitted values for the two echelle orders .",
    "we then applied the best - fit parameters to every echelle order , allowing the fitter to adjust the model wavelengths and detector resolution separately for each order . for",
    "all telluric fits in this paper , we adjusted the temperature , pressure , and water vapor atmosphere profile with sounding data from the global data assimilation system ( gdas ) meteorological archive .",
    "as stated in section [ sec : obs ] , we fit each frame of hip 20264 separately , and co - added the telluric - corrected spectra .",
    "the fitted value of the relative humidity varied from @xmath21 to @xmath22 , and the airmass of the star increased from 1.15 to 1.52 ( a change of @xmath23 in zenith angle ) over the course of the 7 frames , making the individual fits crucial .",
    "we show the telluric correction for the observation of the a0v star hip 20264 in four water bands and two @xmath24 bands in figures [ fig : bstarcorr_water ] and [ fig : bstarcorr_oxygen ] , respectively .",
    "the telluric model shown is the average telluric model of the 7 individual exposures , since we corrected each one separately to better account for the changing water vapor content and telescope zenith angle .",
    "we apply a savitzky - golay smoothing filter to the corrected data to remove any broad features in the stellar spectrum .",
    "the water features are corrected to near the noise level of the spectrum , with the exception of the very strong telluric water band near 730 nm .",
    "the poor correction may be due to a slightly incorrect temperature and water - vapor atmospheric profile , which causes the line profile to change appreciably for strong lines .",
    "in addition , small errors in the line strength parameters are more noticable for strong telluric lines .",
    "the correction in the @xmath24 b and @xmath20 bands ( figure [ fig : bstarcorr_oxygen ] ) is somewhat worse . the same @xmath24 mixing ratio undercorrects the @xmath20 band and slightly overcorrects the b band .",
    "this systematic error may be from incorrect line strengths in the hitran database for the two bands .",
    "+    we observed the a1v star hip 25608 30 minutes after hip 20264 and at similar airmass , and so use it as a telluric standard star to directly compare our method to the empirical telluric correction method . to have comparable s / n ratios as in figures [ fig : bstarcorr_water ] and [ fig : bstarcorr_oxygen ] , we co - added all 7 frames of both the the target star ( hip 20264 ) and the standard star ( hip 25608 ) .",
    "we account for the different column density of absorbers in the target and standard star observations using beer s law @xcite as follows . for each order ,",
    "we scaled the normalized flux of the standard star ( @xmath25 ) with    @xmath26    where @xmath20 is determined using the normalized flux of the standard star and target star ( @xmath27 ) and is defined as    @xmath28    in equation [ eqn : scale ] , we only use the points with @xmath29 in the median computation , so that the noise does not dominate in the orders with few telluric lines .",
    "these empirical telluric corrections are shown in the top row of figure [ fig : bstarcorr_empirical ] .",
    "the corrections are quite poor in this case , mostly because the airmass of the target ( standard ) star changes from 1.15 - 1.52 ( 1.31 - 1.86 ) from the first to last frame , and co - adding the spectra amounts to a flux - weighted average over airmass that the correction in equation [ eqn : correction ] can not capture .",
    "+    we also test an empirical telluric correction using only the last frame of the target star and the first frame of the standard star , and show the result in the bottom row of figure [ fig : bstarcorr_empirical ] . in this case",
    ", the airmass can be treated as approximately constant and equation [ eqn : correction ] does a much better job in accounting for the small airmass difference between the target and standard star spectra , with the exception of the nearly saturated oxygen lines ( bottom left panel ) .",
    "the water line correction results in similar line residual amplitudes to the telluric modeling method ( see figure [ fig : bstarcorr_water ] for comparison ) .",
    "+    we now turn to a more typical - use case for the telfit code : correcting the telluric lines in late - type stars near a feature of interest . for this",
    ", we use a series of m - type stars ( see table [ tab : sample ] ) with observations near the 819 nm sodium doublet , which is used as a gravity - sensitive age indicator for late - type stars @xcite . as the stellar age and therefore surface gravity increases , the line strength increases . amongst main sequence m - stars , later spectral types have higher surface gravity and so we expect the equivalent width of the sodium lines to increase as we go towards later spectral types .    figure [ fig : mtellcorr ] shows the telluric correction for the m1v star gj 908 . for this and all m - star spectra in this work , we fit the water vapor , temperature , and @xmath19 mixing ratio at the same time for the spectral order covering 819 nm .",
    "the bottom panel of figure [ fig : mtellcorr ] shows that each of the spectral lines after telluric correction come from the star itself , and that the telluric contamination is reduced to near the noise level of the spectrum .",
    "importantly , the telluric lines that fall within the sodium doublet line profile no longer affect the profile shape .",
    "we can now directly compare the line profile of the sodium doublet lines as a function of spectral type , without the influence of telluric lines .",
    "figure [ fig : lineprofile ] shows the evolution of the doublet lines .",
    "the central depth stays about the same throughout the sequence , but the later spectral type stars show significantly broader line wings , leading to the known sequence in equivalent width @xcite .",
    "the robust recovery of the sodium line strengths and profiles demonstrate that telfit can accurately remove telluric lines , even in feature - rich spectra .",
    "we presented the telfit code , an object - oriented python code capable of accurately fitting the telluric spectrum in ground - based spectra .",
    "we use a high signal - to - noise ratio echelle spectrum of the a0v star hip 20264 to demonstrate the fit quality in figures [ fig : bstarcorr_water ] and [ fig : bstarcorr_oxygen ] .",
    "contrary to expectation , the water lines are typically fit to much higher precision than the @xmath24 telluric lines .",
    "this is likely coming from a systematic error in the hitran line strength database , since the same @xmath19 mixing ratio overfits the b band and underfits the @xmath20 band .",
    "we compare our code to an empirical telluric correction of hip 20264 , and find that the model is at least as accurate .",
    "in fact , telfit is significantly more accurate than the empirical method when several frames of both the target and standard star are co - added .",
    "we also demonstrated the use of telfit for in - depth analysis of spectral features in late - type stars with a series of m - star observations near the 819 nm sodium doublet .",
    "the telluric lines were removed to near the noise level of the observations , allowing for analysis of the sodium line profiles and recovery of the known sequence of increasing equivalent width with later spectral types .",
    "regions contaminated by telluric lines are often ignored in optical spectral analysis ; accurate correction of telluric features could help open these regions up for further analysis .",
    "this code was mostly developed and tested for correction of optical spectra .",
    "however , an early version of this code was used in @xcite to correct for telluric methane absorption in b - star spectra , with similar line residuals to those that @xcite found in the same spectral region .",
    "we encourage the use of telfit for correcting telluric absorption in near - infrared as well as optical data .",
    "we would like to thank andreas seifahrt for his help in the early stages of code development .",
    "this project was funded by a ut austin hutchinson fellowship to kevin gullikson and start - up funding to sarah dodson - robinson from the university of texas .",
    "this work makes use of astropy , a community - developed core python package for astronomy @xcite , as well as scipy and numpy @xcite .",
    "we would like to thank the developers of all of those packages ."
  ],
  "abstract_text": [
    "<S> ground - based astronomical spectra are contaminated by the earth s atmosphere to varying degrees in all spectral regions . </S>",
    "<S> we present a python code that can accurately fit a model to the telluric absorption spectrum present in astronomical data , with residuals of @xmath0 of the continuum for moderately strong lines . </S>",
    "<S> we demonstrate the quality of the correction by fitting the telluric spectrum in a nearly featureless a0v star , hip 20264 , as well as to a series of dwarf m star spectra near the 819 nm sodium doublet . </S>",
    "<S> we directly compare the results to an empirical telluric correction of hip 20264 and find that our model - fitting procedure is at least as good and sometimes more accurate . </S>",
    "<S> the telluric correction code , which we make freely available to the astronomical community , can be used as a replacement for telluric standard star observations for many purposes . </S>"
  ]
}