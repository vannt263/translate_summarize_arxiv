{
  "article_text": [
    "mts and rpc techniques can be combined fairly straightforwardly  @xcite , and indeed , such a combination was used already in early classical simulations based on ring - polymer contraction  @xcite . however , to date no attempt has been reported to use rpc ( alone or in combination with mts ) in the context of ab initio molecular dynamics , despite the fact that this is a scenario in which obtaining an accurate estimate of nuclear quantum effects at a reduced computational cost would be particularly desirable .",
    "this is largely due to the considerable implementation overhead connected with combining sophisticated techniques for solving efficiently the electronic - structure problem and the cumbersome formalism that underlies pimd and its rpc and mts extensions . here",
    "we present a simple example that demonstrates a working implementation of such combination , modeling nuclear quantum effects with a post - hf wavefunction description of the electronic structure .",
    "our implementation relies on the modular assembly of i - pi @xcite  a python interface in which we implemented mts and rpc techniques  and cp2k@xcite  that sports a highly efficient periodic implementation of second - order mller - plesset ( mp2 ) theory .",
    "commented example input files , and a snapshot of our development code are provided in the supporting information .",
    "we refer the reader to the relevant literature for the theoretical foundations , and general considerations regarding mts and rpc techniques  @xcite . here",
    "we will just briefly overview the main ideas , using as an example a path integral simulation of a flexible fixed - point - charge model of water  @xcite . in the most straightforward formulation , performing a pimd simulation for a system composed of @xmath0 distinguishable particles with masses @xmath1 and positions @xmath2 amounts to sampling at inverse temperature @xmath3 a canonical distribution consistent with the classical hamiltonian @xmath4 , where the free ring - polymer hamiltonian is @xmath5 ^ 2}{2m_i } + \\frac{1}{2 } m_i \\omega_p^2 [ \\mathbf{q}_i^{(j ) } - \\mathbf{q}_i^{(j+1)}]^2\\right ) \\label{eq : free - rp}\\ ] ] and the physical potential term is @xmath6 the ring polymer is composed of @xmath7 replicas of the physical system ( positions @xmath8 ) cyclically connected by springs with frequency @xmath9 . to simplify the discussion of the combination of rpc and mts , let us split the potential in a slow ( s ) and a fast ( f ) part @xmath10 .",
    "the @xmath11 notations indicates that the slow part of the potential is evaluated on a `` contracted '' ring polymer",
    ". the @xmath7-bead path can be fourier - interpolated down to a smaller number of replicas p , for which energy and forces are computed , and then fourier - expanded back to @xmath7 replicas .",
    "this makes rpc fully transparent from the point of view of the integration of the equations of motion and the evaluation of system properties , simplifying both notation and implementation .",
    "note that it is often the case that one wants to use a low level of theory for the quickly varying part , @xmath12 , and apply on a longer time step or contracted ring polymer a correction term based on a more accurate assessment of the inter - atomic potential @xmath13 .        as shown in fig .",
    "[ fig : h2o - rpc ] , the convergence of observables to quantum expectation values in a simulation of liquid water at room temperature require a large number of replicas , of the order of @xmath14 . however , this is mostly due to the internal modes of each water molecule , that are well described by cheap quasi - harmonic terms .",
    "the non - bonded dispersion and electrostatic interactions vary on considerably larger length scales , and therefore a rpc scheme that computes the latter on a reduced number of replicas converges very rapidly .",
    "a simple range - separation procedure would allow one to reach convergence with a single evaluation of electrostatic interactions  @xcite . here",
    "we want however just to verify to what extent one can push a mts procedure , alone or in combination with rpc , in a pimd context .",
    "a multiple time - step integrator for constant - temperature pimd is epitomized by the corresponding split operator for the propagator over the outer time step @xmath15 : @xmath16^m e^{-\\mathcal{l}_{v}^{\\text{s}}\\frac{\\delta t}{2}}e^{-\\mathcal{l}_\\gamma\\frac{\\delta t}{2}}. \\end{split } \\label{eq : liouville}\\ ] ] first , a thermostat is applied by half the outer time step ( @xmath17 ) ; then the slowly varying force ( possibly computed by rpc ) is applied ( @xmath18 ) ; then , the inner loop of the mts integrator is performed , repeating @xmath19 times the combined integration of the fast force component ( @xmath20 ) and the free - ring - polymer hamiltonian ( @xmath21 ) , with a time step duly scaled by a factor of @xmath22 . finally , the slowly varying force and the thermostat are applied symmetrically , concluding the time step .",
    "as discussed e.g. in refs.@xcite , regardless of how well separated the two components of the potential are , it is not possible to extend indefinitely the outer time step , as accumulation of errors will make the integration unstable when @xmath15 is larger than a fraction of the highest - frequency vibrational period .",
    "due to the presence of high - frequency normal modes in the free ring - polymer hamiltonian  ( eq . ) one would expect the first occurrence of resonances to appear already at a time step of about 1fs for a path integral simulation with 32 replicas at 300k@xcite , much earlier than the @xmath232.7fs limit that would be expected due to the stretching mode frequency .",
    "figure  [ fig : h2o - mts ] shows that in this particular case the pimd simulation remains stable up to an outer step of about 2fs , even in a weakly - thermostatted ( white - noise langevin , thermostat correlation time of 2 ps ) pimd simulation .",
    "this rather puzzling finding can probably be ascribed to the exceedingly weak coupling between the physical potential and the high - frequency normal modes of the ring polymer , and does not necessarily apply to different systems with stronger anharmonicities . here",
    ", increasing the dynamical masses of high - frequency ring - polymer modes would delay only minimally the resonance barrier , and would not be possible when using approximate quantum dynamics techniques , such as centroid molecular dynamics ( cmd )  @xcite and thermostatted ring polymer molecular dynamics ( trpmd )  @xcite , that involve specific prescriptions for the magnitude of the dynamical masses .",
    "however , a similarly effective solution to deal with ring - polymer resonance barriers is to selectively thermalize the high - frequency vibrations  @xcite . exploiting the approximate knowledge of high - frequency ring polymer modes",
    ", one can here simply use optimally - damped langevin thermostats in the ( ring - polymer ) normal - modes representation , as explained e.g. in ref .",
    "@xcite . as discussed in ref .",
    "@xcite , however , some care must be paid to minimize the effect of normal modes thermostatting on the dynamical properties of interest .",
    "and @xmath24 beads respectively .",
    "the dot dashed curves in the top panel correspond to simulations using a white noise langevin thermostat with a time constant of @xmath25 ps while the rest to simulations using a pile - g thermostat . ]",
    "figure  [ fig : h2o - mts ] shows that the use of an optimally - damped path integral langevin thermostat  @xcite does actually extend the stability of the method to outer timesteps well above the resonance barrier for the stretches .",
    "in fact , the deviations that are observed for the mean potential energy are due to the outer time step becoming inappropriate to integrate the long - range force ( which is relatively quickly varying since we do not use any kind of range separation scheme ) .",
    "this additional stabilization is probably due to the coupling between ring - polymer modes and high - frequency centroid vibrations  which is also the cause for spectral broadening observed in thermostatted rpmd .    )",
    "runs for q - tip4p / f water at 300k .",
    "a reference run ( timestep 0.25fs , 32 beads , shaded area ) is compared with a run with 8-beads rpc for the non - bonded interactions , and an outer mts timestep of 1fs ( c8+m1 , red continuous line ) , with a run with 1-bead rpc and 1fs mts ( c1+m1 , blue dashed line ) , and with a run with 8-beads rpc and 3fs mts ( c8+m3 , green dot - dashed line ) . ]",
    "figure  [ fig : acf ] shows the velocity - velocity autocorrelation function for liquid water computed with trpmd , and compare the results using full 32-beads pimd and those obtained with rpc to 8 beads of the non - bonded interactions , and mts to 1fs outer .",
    "dynamical properties appear to be less strongly affected than thermodynamic averages when rpc / mts techniques are pushed to their limits . using rpc down to the centroid , or using a 3fs outer time step , lead to minor deviations from the reference . in summary , these benchmarks demonstrate the effectiveness of our implementation of combined rpc and mts techniques in i - pi , and shows that with an appropriate thermostatting scheme one can push the stability limit of mts schemes beyond the resonance barrier of rpmd , for the calculation of both static and dynamical properties ( fig .",
    "[ fig : h2o - mts ] and  [ fig : acf ] ) .",
    "having briefly reviewed the main ideas , and demonstrated the stability of rpc+mts pimd , let us move on to discuss a few aspects that are specific to a first principles context . here , we simulate the quantum distributions of the zundel cation at the mp2 level of theory , using semi - local dft for rpc+mts . while other choices are possible , this combination is really attractive , as it is general in nature , and the impact of the scheme can be very significant . indeed , as system size increases , mp2 and semi - local dft display very different computational costs , since traditional implementations scale as @xmath26 and @xmath27 respectively .",
    "for example , three orders of magnitude time difference can be expected for samples of 64 water molecules  @xcite .",
    "the excellent scalability of our mp2 implementation@xcite nevertheless enables an acceptable time to solution . in the mp2+rpc context a large number of cheap dft calculations must be combined with the expensive mp2 calculations , and the question of load balancing , avoiding idle processes as much as possible , imposes itself . as a simple , yet efficient , solution to this problem , we over - subscribe compute nodes using two processes per core .",
    "one process belongs to the @xmath7 dft tasks , while one process belongs to the @xmath19 mp2 tasks and the contracted dft tasks , which run at the same time as mp2 is the number of processes assigned to each of the @xmath7 dft tasks , and @xmath28 and @xmath29 are the scalar costs of each force evaluation at the two levels of theory , each of the contracted mp2 processes should be assigned about @xmath30 processes , and @xmath31 processes should be given to each contracted dft task . ] .",
    "while the mp2 tasks computes , the full - path dft tasks are effectively sleeping , and vice versa . in this way ,",
    "idle resources are avoided , and only a small fraction of total wall time is spent in the dft part , which is naturally parallel over the beads , while the computation for each bead is parallelised as well . if the contraction is pushed all the way to the centroid , the cost of performing mp2+dft with mts+rpc is basically the same as the cost of doing standard mp2 md .",
    "an example of how these simulations can be set up in practice can be obtained from the authors .",
    ".expectation values of quantum kinetic energies per h and o atom , and for the o - o distance , in a simulation of a gas - phase zundel cation at 300k .",
    "all simulations were performed using 32 beads and a base time step of @xmath32fs , except that using piglet ( + g ) that used six replicas .",
    "pbe refers to use of the standard pbe generalized gradient approximation ( gga ) functional  @xcite , odf refers to a gga optimized to mp2@xcite , and hfx to hartree - fock .",
    "ring - polymer contraction was used to reduce the cost by computing the mp2 forces on the centroid only ( + c ) , or on two beads ( + c2 ) .",
    "a multiple time step algorithm was also employed to evaluate such force only once every 1fs ( + m ) or 2fs ( + m2 ) .",
    "all simulations were run for 10ps , including 1ps for equilibration .",
    "statistical errors on the last digit are reported in parentheses . [ cols=\"<,^,^,^\",options=\"header \" , ]     the combination of mp2 with semi - local dft employs the same computational setup as described in ref .",
    "in particular , this approach is based on the resolution of identity gaussian and plane waves ( ri - gpw ) which provides an efficient and scalable approach to perform mp2 based md in gas and condensed phases.@xcite the gaussian basis employed for mp2 is of the correlation consistent triple zeta quality@xcite and is parametrized for the pseudopotentials employed@xcite the optimized density functional ( odf ) discussed below is of the gga family , starting from the pbe1w @xcite functional , for which the small basis and van der waals d3 parameters@xcite have been specifically refitted in order to reproduce the energetics of bulk liquid water.@xcite    results for the mean kinetic energy of hydrogen and oxygen atoms , and the mean o - o distance , for different simulations , are reported in table  [ tab : zundel ] .",
    "the table caption summarizes the details of the simulations .",
    "the standard pbe functional underestimates the h kinetic energy with single - bead contraction , improving as expected with a contraction to two beads .",
    "this indicates that pbe differs too much from the reference , requiring a considerable increase in the number of mp2 replicas .",
    "also hartree - fock is not very accurate , this time predicting a too large value of the h kinetic energy , despite the rpc correction .",
    "this suggests that the mts strategy proposed in ref .",
    "@xcite , which combines hfx and mp2 , can not be used universally for rpc , at least not without a large number of correction beads .",
    "hybrid functionals , which mix gga exchange with hartree - fock exchange , will likely provide a suitable intermediate potential energy surface .",
    "however , as a computationally less demanding , but less universal alternative , an optimized semi - local dft ( odf ) shows excellent performance .",
    "the results reported in table  [ tab : zundel ] are within the statistical error bars from the mp2 reference already without any rpc correction , and as a consequence it is not possible to detect statistically significant effects on these averages due to rpc and/or mts . however ,",
    "also in this case the rpc correction does have a noticeable effect .",
    "this is shown in figure  [ fig : doonu ] using the joint probability distribution of the o - o distance and the proton transfer coordinate .",
    "the difference between the mp2 and the odf+c is almost zero and smaller than odf only .",
    "the remaining error is largely due to the statistical uncertainty in the probability distributions , which is relatively costly to reduce for the reference mp2 simulation that employs 32 mp2 beads .",
    "let us finally note that rpc and mts methods can be seamlessly combined with other strategies to reduce the cost of a pimd calculation : as demonstrated in table  [ tab : zundel ] , the use of a colored - noise piglet thermostat  @xcite makes it possible to reduce the number of baseline beads to six , that would be advantageous in cases where the cost of the gga calculations is not negligible .            a simple way to assess",
    "the viability of accelerating a simulation by means of rpc and/or mts is to verify the magnitude and time scale for the variation of the correction potential .",
    "[ fig : cvv ] shows the fourier transform of the correction potential correlation function @xmath33 .",
    "clearly , the difference between mp2 and hfx contains strong high - frequency components , which would require a high number of beads in the contracted @xmath34 . using the pbe gga shows only a marginal advantage , as the spectrum still has a pronounced peak at the stretching frequencies . on the contrary ,",
    "the odf exhibits a smaller difference , and in particular a density of states smaller by an order of magnitude for the stretching region - which explains the excellent performance in reproducing quantum kinetic energies even without rpc .",
    "even on a small model system such as the gas - phase zundel cation a combination of ring - polymer contraction , multiple time step algorithms and a force - matching strategy to minimise the discrepancy between the expensive , post - hf calculation and a gga dft baseline makes it possible to model nuclear quantum effects at virtually no additional cost .",
    "modular implementation in i - pi means that all sorts of similar schemes  combining different levels of theory , more or less converged basis sets , range - separated potentials , empirical or semi - empirical methods , etc .",
    " could be tested and used without further coding effort .",
    "parallelism across replicas and potential components can be obtained by appropriately managing the execution on a hpc system , realizing a rudimentary but effective form of load balancing .",
    "multiple time - stepping and ring - polymer contraction provide additional tools to reduce the computational expense for modeling quantum nuclei in ab initio simulations , that can be combined seamlessly with with high - order path integrals and correlated - noise techniques .",
    "nuclear quantum effects can now be incorporated accurately and at low cost in simulations employing high level electronic structure theory .",
    "given the importance of nuclear quantum effects and the generality of the approach , we expect this to become standard practice in the near future .",
    "j.v . acknowledges financial support by the european union fp7 in the form of an erc starting grant under contract no .",
    "m.c and v.k acknowledge financial support by the swiss national science foundation ( project i d 200021 - 159896 ) . this research was partly supported by nccr marvel , funded by the swiss national science foundation .",
    "calculations were enabled by the swiss national supercomputer centre ( cscs ) under project i d ch5 . during the preparation of this manuscript we became aware that o. marsalek and t. markland were working on a related combination of dft and self - consistent tight binding  @xcite using mts and rpc  another excellent example of how inexpensive modelling of quantum nuclei",
    "can be achieved by coupling different levels of electronic structure theory .",
    "47ifxundefined [ 1 ] ifx#1 ifnum [ 1 ] # 1firstoftwo secondoftwo ifx [ 1 ] # 1firstoftwo secondoftwo `` `` # 1''''@noop [ 0]secondoftwosanitize@url [ 0 ] ",
    "+ 12$12  & 12#1212_12%12@startlink[1]@endlink[0]@bib@innerbibempty @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop _ _  ( ,  ,  ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * , ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop ,  * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) link:\\doibase 10.1103/physrevb.54.1703 [ * * ,   ( ) ] @noop * * , ( ) @noop * * ,   ( ) @noop"
  ],
  "abstract_text": [
    "<S> the development and implementation of increasingly accurate methods for electronic structure calculations mean that , for many atomistic simulation problems , treating light nuclei as classical particles is now one of the most serious approximations . even though recent developments have significantly reduced the overhead for modeling the quantum nature of the nuclei , the cost is still prohibitive when combined with advanced electronic structure methods . here </S>",
    "<S> we present how multiple time step integrators can be combined with ring - polymer contraction techniques ( effectively , multiple time stepping in imaginary time ) to reduce virtually to zero the overhead of modelling nuclear quantum effects , while describing inter - atomic forces at high levels of electronic structure theory . </S>",
    "<S> this is demonstrated for a combination of mp2 and semi - local dft applied to the zundel cation . </S>",
    "<S> the approach can be seamlessly combined with other methods to reduce the computational cost of path integral calculations , such as high - order factorizations of the boltzmann operator , or generalized langevin equation thermostats .    </S>",
    "<S> simulations of molecules and materials from first principles are constantly improving in accuracy and predictive power , thanks to the combination of the availability of more powerful high - performance computing ( hpc ) platforms and the development of more efficient techniques to treat the electronic structure problem at high levels of theory . </S>",
    "<S> for example , the structure and dynamics of bulk liquid water can now be computed using correlated wavefunction methods @xcite , or quantum monte carlo @xcite . </S>",
    "<S> at the same time , these developments pose new challenges . to reach the ultimate level of accuracy </S>",
    "<S> it is not sufficient to fully account for exchange and correlations between electrons , but it is also necessary to describe the quantum mechanical nature of light nuclei , such as hydrogen . </S>",
    "<S> modelling of nuclear quantum effects ( nqes ) can be achieved by path integral molecular dynamics ( pimd )  @xcite , that traditionally involves a very large overhead . </S>",
    "<S> the large computational cost can be traced to the need of simulating multiple replicas of the physical system and to the need for a reduced time step to properly integrate the dynamics of the stiff , non - ergodic modes of the ring polymer hamiltonian . indeed , using brute force pimd techniques , several hundred million core hours </S>",
    "<S> would be needed to faithfully model quantum effects in the above mentioned mp2 simulations of liquid water .    </S>",
    "<S> however , recent advances have contributed to dramatically reduce this overhead , by using high - order expansions of the finite - temperature density matrix@xcite , by using a correlated - noise generalized langevin equation to induce frequency - dependent fluctuations mimicking quantum effects  @xcite , or by selectively treating with different number of path integral replicas different parts of the system @xcite or different components of the potential@xcite . in a converged path integral simulation , </S>",
    "<S> adjacent replicas in the ring polymer are held close together by the presence of harmonic springs . </S>",
    "<S> whenever it is possible to partition the inter - atomic potential into a rapidly - varying and easily - computed part , and a harder - to - compute but slowly - varying part , one can also reduce the cost of evaluating the path energy by a so - called ring - polymer contraction ( rpc ) scheme  @xcite , that only evaluates the expensive component on a reduced number of replicas .    </S>",
    "<S> in fact , the idea of exploiting the presence of different length scales in the interactions between atoms has been recognized long since , and has been used to accelerate the integration of classical equations of motion where the granularity of time is set by the stiffest part of the interaction  @xcite . </S>",
    "<S> this intuition can lead to significant speed - ups when the rapidly varying part of the interaction potential can be computed more efficiently than the slowly - varying part  which is e.g. the case for long - range electrostatic interactions  @xcite , or biasing potentials derived from complex order parameters  @xcite . </S>",
    "<S> the partitioning of interactions in slow ( smoothly - varying and expensive to compute ) and fast ( quickly - varying and inexpensive ) components is less obvious when first - principles calculations are considered , as individual terms are often hard to treat separately . </S>",
    "<S> however , in this context , the vastly different costs between different levels of theory can be exploited . </S>",
    "<S> this was first demonstrated in ref .  </S>",
    "<S> @xcite where a combination of hybrid functionals and semi - local dft was exploited in a multiple time - step ( mts ) scheme . </S>",
    "<S> this early work was inspired by the combination of force - fields and dft for presampling and biasing.@xcite different variations on this theme , that all have the potential to be generally applicable , have been shown to be effective . for mts schemes that have been applied in an _ ab initio </S>",
    "<S> _ context include the combination of explicitly correlated methods on top of a baseline hartree - fock calculation  @xcite , the application of a range - separated coulomb operator or a divide - and - conquer strategy  @xcite , the use of better - converged simulation parameters as a correction , considered to be slowly varying  @xcite , or the combination of mp2 and semi - local dft@xcite . </S>",
    "<S> the latter variant will be employed here , yielding a massive speedup by combining mts and rpc . </S>"
  ]
}