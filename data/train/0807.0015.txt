{
  "article_text": [
    "in many physics analyses , one seeks to extract information from a reaction with multi - dimensional kinematics",
    ". fits to binned data are often limited by statistical uncertainties ; thus , use of the unbinned maximum likelihood method is generally preferred .",
    "this method is well suited to obtaining estimators for unknown parameters in a hypothesis probability density function ( p.d.f . ) .",
    "it is also an excellent way of discriminating between hypotheses ; however , it does not provide a means of determining how well the best hypothesis describes the data .    in this paper",
    ", we describe an _ ad - hoc _",
    "procedure for obtaining a @xmath0 goodness - of - fit measurement of a hypothesis whose parameters were determined using an unbinned maximum likelihood fit without having to bin the data .",
    "this quantity is not meant to replace the likelihood .",
    "the likelihood should still be used to determine which hypothesis best describes the data and to obtain estimators for any unknown parameters , _",
    "i.e. _ extract any physical observables .",
    "the goodness - of - fit quantity obtained using our method would simply be used to judge how well the best hypothesis describes the data .    in our approach ,",
    "event - by - event standardized residuals are used to obtain the global @xmath0 .",
    "these residuals can also be used for diagnostic purposes to study the goodness - of - fit as a function of kinematics or detector components .",
    "determining where in phase space a fit fails to describe the data is vital to understanding what physics has not been accounted for in the p.d.f .",
    "identifying regions or components of the detector where a fit fails to describe the data could help diagnose unaccounted for inefficiencies in the acceptance calculation .",
    "other authors have also developed methods for obtaining goodness - of - fit quantities from unbinned data .",
    "the methods closest to ours are based on the nearest neighbors to a given event  @xcite .",
    "however , there are several other recent articles on other procedures as well @xcite . while these and other authors have developed methods for obtaining goodness - of - fit quantities from unbinned maximum likelihood fits , the advantage of our approach lies in the event - by - event residuals .",
    "it is also straight - forward to apply our method to most experimental physics analyses .",
    "consider a data set composed of @xmath1 total events , each of which is described by @xmath2 coordinates , @xmath3 .",
    "the coordinates can be masses , angles , energies , _ etc_. two separate hypotheses have been proposed to describe the data .",
    "their probability density functions will be denoted by @xmath4 where @xmath5 are the functional dependencies on the coordinates , @xmath3 , and ( possible ) unknown parameters , @xmath6 , of hypothesis @xmath7 @xmath8 .    using these p.d.f.s , unbinned maximum likelihood fits",
    "can easily be performed to obtain estimators , @xmath9 , for the unknown parameters , @xmath6 , of each hypothesis .",
    "the likelihoods from these fits , @xmath10 , can be used to determine which hypothesis provides the better description of the data ; however , the following simple question about this hypothesis can not yet be answered : `` how well does it describe the data ? ''",
    "the aim of this procedure is to obtain a @xmath0 goodness - of - fit measurement of a hypothesis whose parameters were determined using an unbinned maximum likelihood fit .",
    "we first need to define a metric for the space spanned by the `` relevant '' coordinates of @xmath3 , _",
    "i.e. _ all coordinates on which the p.d.f has functional dependence .",
    "a reasonable choice is to use @xmath11 , where @xmath12 is the maximum possible difference between the coordinates , @xmath13 , of any two events in the sample . using this metric , the distance between any two events , @xmath14 ,",
    "is given by @xmath15 ^ 2,\\ ] ] where the sum is over all relevant coordinates ( discussed above ) .",
    "for each event , we then compute the distance , @xmath16 , to the @xmath17th closest event using ( [ eq : dist ] ) .",
    "the value of @xmath17 is discussed below .",
    "thus , a hypersphere centered at the @xmath18 event with radius @xmath16 contains @xmath17 data events ( excluding the event itself ) . in this way",
    ", we can calculate the density of data events at the point @xmath19 . by comparing these density calculations to those predicted by a given hypothesis",
    ", we can determine how well the hypothesis describes the data without resorting to binning .",
    "for each event , the standardized residual , @xmath20 , for any hypothesis is then calculated according to @xmath21 where @xmath22 is the number of measured ( predicted ) events contained within a hypersphere of radius @xmath16 centered at @xmath19 and @xmath23 is the uncertainty on @xmath22 .    for the case where the data set contains no background events ( dealing with backgrounds is discussed in section  [ section : example : bkgd ] ) , @xmath24 and @xmath25 , provided @xmath17 is chosen to be large enough for the gaussian approximation to hold . the number of predicted events , @xmath26 , is calculated for hypothesis @xmath7 as @xmath27,\\ ] ] where the integral in the numerator is over the hypersphere of radius @xmath16 centered at @xmath19 discussed above .    in principle , there are cases where the integrals in ( [ eq : method - num - predicted ] ) can be performed analytically ; however , once detector acceptance is included , for which an analytic expression typically is not known , they must be done using the monte carlo technique .",
    "for these cases , @xmath28 can be calculated by generating @xmath29 monte carlo events according to @xmath3 phase space which leads to the following approximation of ( [ eq : method - num - predicted ] ) : @xmath30,\\ ] ] where the heaviside function , @xmath31 , is used to restrict the sum in the numerator to monte carlo events within the hypersphere .",
    "the statistical uncertainty in the monte carlo calculation of @xmath28 would be @xmath32 , where @xmath33 is the number of monte carlo events within the hypersphere .",
    "we note here that if @xmath33 is small , then the uncertainty is better approximated by @xmath34  @xcite .",
    "if the hypothesis does in fact provide a good description of the data , then the values of @xmath35 obtained from ( [ eq : chi2-event ] ) will follow a @xmath36 distribution with one degree of freedom . the overall goodness - of - fit",
    "can be obtained as follows : @xmath37 where @xmath38 is the number of free parameters present in the hypothesis p.d.f .",
    "hypotheses which describe the data well will yield values of @xmath39 , while those which do not describe the data well will yield larger values .",
    "as an example , we will consider the reaction @xmath40 in a single @xmath41 bin , _",
    "i.e. _ a single center - of - mass energy and production angle bin ( extending the example to avoid binning in production angle , or @xmath42 , is discussed below ) .",
    "the @xmath43 decays to @xmath44 about 90% of the time ; thus , we will assume we have a detector which has reconstructed @xmath45 events .",
    "below we will analyze a simulated @xmath43 photoproduction data set .",
    "the goal of our model analysis is to extract the @xmath43 polarization observables known as the _ spin density matrix elements _ , denoted by @xmath46 ( discussed below ) .    in terms of the mass of the @xmath44 system , @xmath47 ,",
    "the @xmath43 events were generated according to 3-body phase space weighted by a voigtian ( a convolution of a breit - wigner and a gaussian ) to account for both the natural width of the @xmath43 and detector resolution .",
    "for this example , we chose to use @xmath48  mev / c@xmath49 for the detector resolution .",
    "the goal of our analysis is to extract the three measurable elements of the spin density matrix ( for the case where neither the beam nor target are polarized ) traditionally chosen to be @xmath50 , @xmath51 and @xmath52 .",
    "these can be accessed by examining the distribution of the decay products ( @xmath44 ) of the @xmath43 in its rest frame .",
    "for this example , we chose to work in the helicity system which defines the @xmath20 axis as the direction of the @xmath43 in the overall center - of - mass frame , the @xmath53 axis as the normal to the production plane and the @xmath54 axis is simply given by @xmath55 .",
    "the decay angles @xmath56 are the polar and azimuthal angles of the normal to the decay plane in the @xmath43 rest frame .",
    "the decay angular distribution of the @xmath43 in this frame is then given by  @xcite @xmath57 we chose to use the values @xmath58 , @xmath59 and @xmath60 for our simulated data set .",
    "we will begin by considering the simplest case where the signal is able to be extracted without any background contamination and our detector efficiency is 100% .",
    "for this study , a simulated data set of 10,000 events was generated following the criteria described above ( see figure  [ fig : gen - no - acc - no - bkgd ] ) . to facilitate the calculation of ( [ eq : method - num - predicted - mc ] ) ,",
    "100,000 monte carlo events were generated using the same @xmath47 distribution as the data ; however , the decay distribution was generated according to flat phase space in @xmath61 and @xmath62 .",
    "the likelihood function required to extract the spin density matrix elements is simply @xmath63 where @xmath64 is the decay angular distribution defined in ( [ eq : schil ] ) . to obtain estimators for the @xmath46 elements , we minimize @xmath65 which yields the values    [ eq : rho - no - acc - no - bkgd ] @xmath66 @xmath67 @xmath68    these values are in good agreement with the values used to generate the data .    at this point in our model analysis ,",
    "we have extracted the physical observables we are interested in .",
    "the spin and parity of the @xmath43 meson are well established ; however , what if we were analyzing a less well - known meson ? in that case , we may not be certain that @xmath69 , _",
    "i.e. _ the use of ( [ eq : schil ] ) might not be justified .",
    "prior to publishing our results , it would be reassuring to know that the fit performed using ( [ eq : schil ] ) does in fact provide a good description of our data .      for this analysis ,",
    "the relevant coordinates are the decay angles @xmath70 and @xmath62 , since these are the only kinematic quantities for which the p.d.f . defined in ( [ eq : schil ] ) has dependence .",
    "the metric defined in ( [ eq : dist ] ) is then given by @xmath71 for this analysis .",
    "for each simulated event , we find the distance to the @xmath17th nearest neighbor event , @xmath16 .",
    "for now , we ll proceed using @xmath72 , determining what to use for this value is discussed in detail in section  [ section : example : nc ] .",
    "the phase space monte carlo events we generated are then used to obtain the predicted number densities according to @xmath73,\\ ] ] using the @xmath46 values given in ( [ eq : rho - no - acc - no - bkgd ] ) .",
    "for this example , the 100% acceptance makes explicitly computing the sum in the denominator unnecessary ; however , in the examples that follow it will be required .",
    "the standardized residuals , @xmath20 , for this hypothesis are obtained from ( [ eq : chi2-event ] ) as @xmath74 where @xmath26 is obtained from ( [ eq : npi - no - bkgd - no - acc ] ) .",
    "figure  [ fig : chi2-no - acc - no - bkgd ] shows the @xmath36 , pull and confidence level distributions obtained for our simulated data set .",
    "the values are in excellent agreement with the theoretical distributions , _",
    "i.e. _ they do follow a @xmath36 distribution .",
    "the total @xmath36 is obtained by summing over all events .",
    "for this example , the value is 10344 ; thus , @xmath75 ; a clear indicator that this hypothesis provides an excellent description of the data .",
    "it is also instructive to examine hypotheses which do not perfectly describe the data .",
    "if the likelihood is maximized while requiring @xmath76 , then the spin density matrix elements extracted are @xmath77 and @xmath78 .",
    "figure  [ fig : chi2-no-1 - 1-no - acc - no - bkgd ] shows the @xmath36 , pull and confidence level distributions obtained for our simulated data set under this hypothesis . since the data were generated with @xmath59 , this fit provides a fair description of the data ; the total @xmath79 .    maximizing the likelihood while requiring @xmath80 yields @xmath81 .",
    "figure  [ fig : chi2-no - off - no - acc - no - bkgd ] shows the @xmath36 , pull and confidence level distributions obtained for our simulated data set under this hypothesis .",
    "this fit clearly provides a poor description of the data ; the total @xmath82 .",
    "the total @xmath0 values do provide a goodness - of - fit value which accurately indicates how well the fit describes the data .",
    "thus , these values can be used to ascertain the quality of the hypotheses .",
    "it is also interesting to note that the pull and confidence level distributions are also good indicators .",
    "one could plot these quantities _ vs. _ kinematic variables to determine where a given hypothesis fails to describe the data .      in this section",
    ", we will examine the value of @xmath17 ( the number of nearest neighbor events used to determine the values of the radii @xmath16 ) .",
    "figure  [ fig : nc_ratio](a ) shows the @xmath83 value obtained for two choices of @xmath17 ( @xmath84 and @xmath85 ) for various event sample sizes .",
    "the data sets ( with sample sizes ranging from 50 to 10,000 events ) were all generated from the same parent distributions as in section  [ section : example : simple ] .",
    "each data set was fit individually to extract the @xmath46 values used to obtain the @xmath36 s .",
    "figure  [ fig : nc_ratio](a ) clearly shows that the @xmath83 value obtained does depend on the choice of @xmath17 , if @xmath17 is chosen to be greater than about 2% of the total number of events . for values of @xmath17",
    "less than 2% of the event sample size , the @xmath0 is quite stable .",
    "this behavior is expected .",
    "if @xmath17 is large relative to @xmath1 , then the method is averaging over large fractions of phase space ; thus , finer structure in the physics will not be properly accounted for .",
    "we also note here that @xmath86 as @xmath87 regardless of the quality of the fit , due to how @xmath28 is calculated ( see ( [ eq : method - num - predicted ] ) ) .    figure  [ fig : nc_ratio](b ) shows the value of @xmath83 obtained for the same two choices of @xmath17 for various event sample sizes for fits to the data which constrain @xmath88 .",
    "the values of @xmath0 are again stable when @xmath17 is chosen to be less than 2% of the data ; however , the values depend on the choice of @xmath17 .",
    "this behavior is again expected ; a similar effect can be seen in fits to binned data for which the value of @xmath83 depends on the number of bins .",
    "the larger the value of @xmath17 , the larger the @xmath0 can be .",
    "consider a kinematic region where the number density of the data is high , leading to a small value of @xmath16 .",
    "for this case , the largest obtainable value for @xmath35 is @xmath89 thus , there are two competing factors which should be considered when choosing the value of @xmath17 .",
    "the ratio of @xmath90 must be small enough to permit a true comparison of the finer structure of the physics ; however , the value of @xmath17 must be large enough such that the relative statistical uncertainties do not forbid larger values of @xmath20 .",
    "typically , these considerations will dictate @xmath17 be about 1%-2% of the event sample size .",
    "if this results in @xmath17 being less than 50 , _",
    "i.e. _ if @xmath91 , then this method will most likely be less effective . of course , this statement is not all encompassing ; in practice , it will depend on the physics .",
    "( color online ) events generated without background and with 100% acceptance .",
    "the quantities plotted are @xmath92 vs. @xmath50 ( red triangles ) and @xmath93 vs. @xmath50 ( black squares ) . , scaledwidth=45.0% ]      it is also useful to examine how changes in the likelihood map onto changes in the @xmath36 values obtained using this method . here",
    "we trace out both goodness - of - fit quantities near the optimal value of @xmath50 .",
    "figure  [ fig : diff - comp ] shows the changes in @xmath96 and @xmath36 _ vs _",
    "@xmath50 for the data set used in section  [ section : example : simple ] ( @xmath97 and @xmath72 ) .",
    "clearly , an increase in @xmath96 does corresponds to an increase in @xmath36      we will now extend our example by including detector acceptance .",
    "the physics used in this section will be identical to that of section  [ section : example : simple ] ; however , we will now include a detector efficiency , @xmath98 , given by @xmath99 we again generated 10,000 data events and 100,000 monte carlo events from the same parent distributions as in section  [ section : example : simple ] convolved with the detector acceptance given in ( [ eq : detector - acc ] ) .",
    "figure  [ fig : gen - acc - no - bkgd ] shows the decay angular distribution of this data set .",
    "the effects of the detector acceptance are clearly visible when compared with figure  [ fig : gen - no - acc - no - bkgd ] .    an unbinned maximum likelihood fit was performed and the following values were obtained for @xmath50 :    [ eq : rho - acc - no - bkgd ] @xmath100 @xmath101 @xmath102    to obtain @xmath36 values , we apply the procedure just as in section  [ section : example : simple ] .",
    "figure  [ fig : chi2-acc - no - bkgd ] shows the @xmath36 , pull and confidence level distributions obtained for this simulated data set .",
    "the values are again in excellent agreement with the theoretical distributions .",
    "the total @xmath103 , indicating that this fit does provide an excellent description of the data ( as it should ) .",
    "( color online ) @xmath62 ( radians ) vs @xmath61 : events generated without background and with detector acceptance given by ( [ eq : detector - acc ] ) .",
    ", scaledwidth=45.0% ]      in many physics analyses , there is a sample of non - interfering background events which can not be separated from the signal .",
    "we will now deal with this situation .",
    "the signal sample will simply be that of section  [ section : example : acc ] ; thus , we will be including detector acceptance effects as well . for the background , we chose to generate it according to 3-body phase space weighted by a linear function in @xmath47 and @xmath104 in the decay angles .",
    "the number of background events generated , @xmath105 , was 10,000 ( the background events were also subjected to the detector acceptance given in ( [ eq : detector - acc ] ) ) .",
    "figure  [ fig : decay - bkgd - acc](a ) shows the @xmath44 mass spectrum for all generated events and for just the background .",
    "the generated decay angular distributions for all events , along with only the signal and background are shown in figures  [ fig : decay - bkgd - acc](b ) , ( c ) and ( d ) .",
    "there is clearly no way to separate out the signal events through the use of a cut .",
    "the method used to extract the signal events is described in detail in  @xcite .",
    "it accurately preserves all kinematic correlations in the data while separating signal and background events .",
    "each event is assigned a signal weight factor , @xmath106 , or equivalently , a background weight factor , @xmath107 .",
    "these @xmath106-factors are then used to weight each event s contribution to the `` log likelihood '' during unbinned maximum likelihood fits to extract physical observables .",
    "the method works in a very similar way to the one presented in this paper .",
    "a metric is defined in the space of all relevant kinematic variables and the @xmath17 nearest neighbor events ( we chose @xmath72 ) are selected .",
    "for this example , the metric defined in ( [ eq : example - metric ] ) can again be used . since",
    "each subset of events occupies a very small region of phase space , the @xmath47 distributions can be used to determine each event s @xmath106-factor while preserving the correlations present in the remaining kinematic variables ( @xmath61 and @xmath62 ) .",
    "to this end , unbinned maximum likelihood fits were carried out for each event , using its nearest neighbors , to determine the parameters @xmath108 in the p.d.f .",
    "@xmath109 where , @xmath110 parameterizes the signal as a voigtian ( convolution of a breit - wigner and a gaussian ) with mass @xmath111  gev / c@xmath49 , natural width @xmath112  gev / c@xmath49 and resolution @xmath113 .",
    "the parameter @xmath114 sets the overall strength of the signal .",
    "the background , in each small phase space region , was parameterized by the linear function @xmath115 the @xmath106-factor for the event was then calculated as @xmath116 where @xmath117 is the event s @xmath118 mass and @xmath119 are the estimators for the parameters obtained from the @xmath18 event s fit .",
    "figures  [ fig : decay - bkgd - acc](e ) and ( f ) show the extracted signal and background distributions , _",
    "i.e. _ they show the events weighted by @xmath106 and @xmath107 respectively .",
    "the agreement with the generated distributions ( see figures  [ fig : decay - bkgd - acc](c ) and ( d ) ) is very good .",
    "we conclude this section by noting that the full covariance matrix obtained from each event s fit , @xmath120 , can be used to calculate the uncertainty in @xmath106 as @xmath121      the likelihood function used to obtain the spin density matrix elements , defined in ( [ eq : log - likelihood ] ) , can be modified to account for the presence of background events as follows : @xmath122 thus , the @xmath106-factors are used to weight each event s contribution to the likelihood . using the @xmath106-factors obtained in section  [ section : example : q - factors ] , minimizing ( [ eq : log - l - q ] ) yields    @xmath123    @xmath124    @xmath125    which are in good agreement with the generated values .",
    "the metric used to obtain the @xmath17 nearest neighbor events is again ( [ eq : example - metric ] ) ; however , the number of measured events contained within each hypersphere is now given by @xmath126 with uncertainty @xmath127 where the sums ( @xmath128 ) are over the @xmath17 events used to calculate the @xmath18 event s @xmath106-factor and @xmath129 is the correlation factor between events @xmath130 and @xmath131 .",
    "this factor is equal to the fraction of shared nearest neighbor events used in calculating the @xmath106-factors for these events .",
    "thus , ( [ eq : n_m - error ] ) accounts for both the statistical uncertainty in the signal yield , along with the uncertainty in the signal - background separation , _",
    "i.e. _ the uncertainty in the @xmath106-factors .",
    "the number of predicted events , along with its uncertainty , is calculated the same way as in section  [ section : example : simple ] and the @xmath20 values are again obtained using ( [ eq : chi2-event ] ) .",
    "figure  [ fig : chi2-acc - bkgd ] shows the @xmath36 , pull and confidence level distributions obtained for our simulated data set .",
    "the values are again in excellent agreement with the theoretical distributions .",
    "this indicates that we have properly handled the uncertainties in the signal .",
    "the total @xmath132 .",
    "calculating the correlation factor , @xmath129 , in ( [ eq : n_m - error ] ) is very cpu intensive due to the multiple loops which need to be performed over the data events . in  @xcite",
    ", we noted that assuming 100% correlation for all @xmath106-factors provides a reasonable upper limit on the signal yield in any kinematic region . under this assumption , which eliminates much of the bookkeeping and cpu cycles needed to properly calculate @xmath129 ,",
    "the uncertainty on @xmath133 becomes @xmath134 where the sum is again over the @xmath17 nearest neighbor events used to calculate @xmath135 .",
    "figure  [ fig : chi2-cor - acc - bkgd ] shows the @xmath36 , pull and confidence level distributions obtained for our simulated data set under this assumption .",
    "the deviations from the theoretical distributions are relatively small .",
    "the total @xmath136 . this value is smaller than 1 as expected",
    "; however , it is still reasonably close to the value obtained when the errors are handled rigorously .",
    "thus , this is a reasonable approximation and could be used effectively in situations where calculating the values of @xmath129 is not possible ( or , perhaps , desirable ) .      to extend this example to allow for the case where the data is not binned in production angle",
    ", we would simply need to include @xmath137 or @xmath42 in the vector of relevant coordinates , @xmath3 . to perform a full partial wave analysis on the data",
    ", we would also need to include any additional kinematic variables which factor into the partial wave amplitudes , _",
    "e.g. _ the distance from the edge of the @xmath44 dalitz plot ( typically included in the @xmath43 decay amplitude ) .",
    "we would then construct the likelihood from the partial waves and minimize @xmath96 using the @xmath106-factors obtained by applying our signal - background separation procedure , including the additional coordinates .    the estimators from these event - based fits",
    "would then serve as input into a higher dimensional version of the method presented in this example . the procedure for obtaining @xmath20-values ,",
    "however , would remain almost unchanged .",
    "we would simply need to account for the additional relevant kinematic variables in our metric .",
    "if the fit provides a good description of the data , then the @xmath0 should be approximately one and the squares of the standardized residuals should follow a @xmath36 distribution .",
    "in this paper , we have presented an _ ad - hoc _",
    "procedure for obtaining @xmath0 values from unbinned maximum likelihood fits which does not require binning the data .",
    "this makes it very applicable to multi - dimensional problems .",
    "we have shown that these @xmath0 values accurately reflect how well a given hypothesis describes the data .",
    "this work was supported by grants from the united states department of energy no .",
    "de - fg02 - 87er40315 and the national science foundation no . 0653316 through the `` physics at the information frontier '' program .",
    "99 j. friedman , phys . rev . *",
    "d9 * , 11 ( 1973 ) .",
    "mark f. schilling , the annals of statistics , * 11 * , 13 , ( 1983 ) .",
    "mark f. schilling , journal of the american statistical association , * 81 * , 799 ( 1986 ) .",
    "b. aslan and g. zech , arxiv : hep - ex/0203010 ( 2003 ) .",
    "k. kinoshita , arxiv : physics/0312014 ( 2003 ) .",
    "r. raja , arxiv : physics/0401133 ( 2003 ) .",
    "v. h. regener , phys . rev . * 84 * , 161 ( 1951 ) . k. schilling , p. seyboth and g. wolf , nucl",
    "b15 * , 397 ( 1970 ) .",
    "m. williams , m. bellis and c. a. meyer , arxiv:0804.3382 ( submitted to nim ) ."
  ],
  "abstract_text": [
    "<S> a common goal in an experimental physics analysis is to extract information from a reaction with multi - dimensional kinematics . </S>",
    "<S> the preferred method for such a task is typically the unbinned maximum likelihood method . in fits using this method , the likelihood is a goodness - of - fit quantity in that it effectively discriminates between available hypotheses ; however , it does not provide any information as to how well the best hypothesis describes the data . in this paper </S>",
    "<S> , we present an _ </S>",
    "<S> ad - hoc _ </S>",
    "<S> procedure for obtaining @xmath0 values from unbinned maximum likelihood fits . </S>",
    "<S> this method does not require binning the data , making it very applicable to multi - dimensional problems .    </S>",
    "<S> and    11.80.et,29.85.fj </S>"
  ]
}