{
  "article_text": [
    "in astrophysical fluid dynamics , the evolution time of the fluid flow is often substantially longer than the sound crossing time of the system .",
    "this is particularly true for convection deep in stellar interiors where the flows are very subsonic .",
    "near the base of the solar convection zone the sound speed is about 220 km / s , while the convective velocities are likely of order hundreds of meters per second . following the evolution of sound",
    "directly imposes crippling computational limits on simulations of such flows , as their evolution times are typically many convective turnover times , each of which is often several thousand sound times .",
    "so called `` sound - proof '' equations address this separation of scales by beginning with the navier - stokes equations and filtering out fast , high - frequency sound waves while retaining compressible motions on slower time scales due to gravitational stratification .",
    "these motions include gravity waves in stably stratified regions and asymmetric convection in unstably stratified regions , with typically broad slow upflows and narrow fast downflows . in astrophysical and geophysical settings ,",
    "the most commonly employed `` sound - proof '' equations are the anelastic equations .",
    "these have been employed in various astrophysical and geophysical codes to study solar convection and the solar dynamo , stellar convection and dynamos ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) , the buoyant rise of magnetic structures , terrestrial convection and the geodynamo and the coupling of an unstably stratified convection zone to a stably stratified region beneath . recently a significant benchmarking effort has been undertaken to compare the various implementations of the anelastic equations @xcite .",
    "formally the anelastic approximation is only valid for an adiabatic or nearly adiabatic atmosphere .",
    "the solar convection zone is nearly adiabatic but it is underlain by a stably stratified radiative zone ; unsurprisingly the anelastic equations are often extended into this region where their validity may break down , to study the coupling of penetrative convection with a stably - stratified region .",
    "this is particularly important in simulations of the solar dynamo , as the stably stratified internal boundary layer known as the tachocline at the base of the convection zone is thought to play a major role in the global - scale dynamo",
    ".    fundamentally , the anelastic equations filter sound waves by modifying the continuity equation of the fully compressible navier - stokes equations .",
    "questions about the energy conserving properties of the anelastic approximation have remained a thorny issue in the fluid dynamics community , with an especially vigorous debate occurring in the atmospheric sciences ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) , where these equations were originally derived . likewise , there are several competing anelastic approaches , including `` co - density '' formulations and their different properties are unclear .",
    "an alternate approach to sound - proofing the navier - stokes equations are the pseudo - incompressible equations , where the pressure rather than continuity equation is modified .",
    "these equations were proposed in @xcite and have recently been adopted in the astrophysical fluid dynamics community ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) and see particular use in the maestro code @xcite . the properties of gravity waves and stable - layer dynamics in the pseudo - incompressible equations have been explored extensively in the atmospheric sciences community , with several comparisons against the properties of the anelastic equations .",
    "we reserve further discussion of gravity waves in this set of equations for a later paper .    here",
    "we explore three implementations of the anelastic equations , one used in the anelastic spherical harmonic ( ash ) code , and two different implementations of the `` co - density '' formulation ( lbr equations ) .",
    "these equation sets are detailed in section  [ sec : anelastic equations ] .",
    "we show that the anelastic equations based directly on the navier - stokes equations ( anelastic navier - stokes , or ans equations ) behave incorrectly in stably stratified region .",
    "first we analytically study wave motions in an isothermal atmosphere in section  [ sec : isothermal atmosphere ] .",
    "we find that these equations do not conserve energy and instead conserve an entropy - weighted `` pseudo - energy '' ( section  [ sec : self - adjointness ] ) .",
    "we find however that the lbr equations do behave correctly for strongly stratified regions , conserving energy and reproducing the results obtained from the full compressible euler equations .",
    "this is surprising , as the lbr equations make further assumptions of adiabaticity beyond those contained in the basic ans equations , but these assumptions lie at the heart of the energy - conserving properties . as a consequence ,",
    "adjustments to the lbr equations to more correctly capture the sub - adiabatic stratification can have profound consequences , introducing a completely different form of energy non - conservation .",
    "we explore the behavior of these differing equations further in bounded atmospheres and spherical geometries in section  [ sec : bounded geometries ] and perform numerical simulations that show the difference between the normal ans equations and the lbr equations .",
    "the implications of these findings for simulations of solar convection is discussed in section  [ sec : conclusions ] , which also give suggestions for improving anelastic treatments of stably - stratified regions .",
    "the reader who is primarily interested in implementing energy - conserving anelastic equations should read sections  [ sec : anelastic equations ] , [ sec : bounded geometries ] and [ sec : conclusions ] .",
    "for the purposes of this paper , the most general equations for fluid dynamics in the solar interior are the fully compressible navier - stokes equations .",
    "when viscosity is neglected , as we do here , these are known as the fully compressible euler equations ( fc equations ) .",
    "the equations of continuity and momentum are @xmath0 with gravitational acceleration @xmath1 . for an ideal gas , @xmath2 with @xmath3 the specific internal energy and",
    "@xmath4 is the ratio of specific heats . here",
    "@xmath5 is the specific heat at constant pressure .",
    "the evolution equations for temperature and pressure are @xmath6 where thermal conduction and other sources and sinks of energy are neglected .",
    "although equations  ( [ eq : compressible continuity][eq : compressible p ] ) form a complete system , it will be useful during our discussion of the anelastic equations to rewrite these in terms of entropy @xmath7 .",
    "equations  ( [ eq : compressible t ] ) and ( [ eq : compressible p ] ) can be combined with an equation of state linking the thermodynamic properties @xmath8 into an equation for the evolution of entropy fluctuations @xmath9    we now specialize to the case of a hydrostatically balanced , stratified atmosphere with background density stratification @xmath10 , pressure @xmath11 , temperature @xmath12 and entropy @xmath13 that only vary with radius , with @xmath14 we define fluctuating quantities , denoted with subscript 1 , by subtracting the time - independent hydrostatic atmosphere making no assumptions about relative amplitudes , with e.g. , @xmath15 , thus these equations are fully nonlinear .",
    "all anelastic approximations employ a continuity equation of the form @xmath16 equation  ( [ eq : anelastic continuity ] ) derives from the assumption that the density fluctuations are small @xmath17 in this case , the fluctuating density is given by the linearized equation of state , @xmath18 and though using a linear equation of state is not strictly required , we find it a clarifying simplification for the current discussion .",
    "we consider equation  ( [ eq : anelastic continuity ] ) to be the defining characteristic of anelastic models .",
    "there exist however a variety of different treatments for the momentum and energy equations in the anelastic literature . in the following subsections",
    "we will consider three common formulations .",
    "the different notation and different thermodynamics used in the various anelastic treatments leads to some confusion . to remedy this",
    ", we reproduce each set of models under as consistent a notation as possible .",
    "practical _ numerical _ or computational differences can arise when _ solving _ different transformations of the same fundamental model , but these issues lie beyond our current scope .",
    "therefore , we consider two models identical if one can bring them into the same form by legitimate mathematical transformation , i.e. , without approximation .    for comparison with the anelastic equations we first write the fc equations in standard form . with a linearized equation of state  ( [ eq : linearized eos ] ) , we rewrite the buoyancy term involving pressure fluctuations in the following fashion @xmath19,\\ ] ] where we have used equations ( [ eq : hydrostatic balance ] ) and ( [ eq : background eos ] ) .",
    "we now introduce the reduced or kinematic pressure @xmath20 with @xmath21 the fully compressible euler equations , with an entropy based energy equation and reduced pressure @xmath20 , are @xmath22 these equations linearize the thermodynamic variables ( eq .",
    "[ eq : linearized eos ] ) but are nonlinear in the velocities and are the counterparts of the anelastic equations that we now turn to ; we do not solve these equations ( [ eq : compressible continuity linearized rho][eq : euler fluctuating entropy ] ) but include them for illustrative purposes .      in many anelastic equations",
    "the momentum equation is the same as in the fc equations .",
    "we thus refer to these equations as the anelastic navier - stokes ( ans ) equations . in the ans equations ,",
    "the momentum equation is @xmath23 which with equation  ( [ eq : linearized eos ] ) can be transformed into the same form as equation  ( [ eq : compressible momentum pomega ] ) , with @xmath24 the ans momentum equation  ( [ eq : ash momentum pomega ] ) can be written in an alternative form by combining @xmath20 terms to yield @xmath25 which will be useful for our analysis in section  [ sec : self - adjointness ] . as a notational issue",
    ", the stratification term interacting with @xmath20 in equation  ( [ eq : ash momentum pomega energy form ] ) takes the same form as a potential temperature , as is traditionally used in studies of geophysical flows in the atmosphere and ocean with @xmath26 and , with the linearized equation of state  ( [ eq : linearized eos ] ) , @xmath27 in terms of @xmath28 , the ans momentum equation is @xmath29    neglecting diffusion and sources of energy , the energy equation is the same as in the fc equations ( eq .",
    "[ eq : euler entropy ] ) , with a background entropy gradient @xmath30 combined with the anelastic continuity equation  ( [ eq : anelastic continuity ] ) , equations  ( [ eq : ash momentum pomega ] ) and ( [ eq : ash entropy ] ) constitute a full set of equations for anelastic motions .      in the `` co - density '' equations or lantz - braginsky - roberts equations ,",
    "the @xmath31 term is dropped and the momentum equation becomes @xmath32 or , in terms of potential temperatures , @xmath33 as in the ans equations , the energy equation  ( [ eq : ash entropy ] ) and the continuity equation  ( [ eq : anelastic continuity ] ) complete the full set of equations .",
    "the lbr momentum equation  ( [ eq : lbr momentum pomega ] ) is derived from the full euler momentum equation  ( [ eq : euler momentum ] ) by assuming @xmath34 , as for a nearly adiabatic state . despite this assumption ,",
    "we find that the lbr equations perform well when @xmath35 while the ans equations perform poorly in that same limit . though @xcite and",
    "are typically credited with independently deriving the lbr equations , these equations bear striking similarities to the lipps - hemler anelastic equations , who were possibly the first to recognize the importance of introducing a reduced pressure and neglecting the interactions between fluctuating pressure and stratification .",
    "they likewise recognized that gravity waves derived from their anelastic equations conserved energy .",
    "use a different set of anelastic equations ( hereafter the rg equations ) . as",
    "above , neglecting viscosity and sources of heat , their equations are the momentum equation and a temperature based energy equation @xmath36 with the anelastic continuity equation  ( [ eq : anelastic continuity ] ) , these constitute a full set of equations for anelastic motions .",
    "equation  ( [ eq : rg momentum pomega ] ) can be equivalently written @xmath37 a form that will be useful in section  [ sec : self - adjointness ] . by combining the equation of state  ( [ eq : background eos ] ) with the anelastic continuity equation  ( [ eq : anelastic continuity ] )",
    ", we can cast the energy equation in terms of entropy with @xmath38 with a linearized equation of state , this takes the same form as the entropy equation  ( [ eq : compressible entropy ] ) , but with an extra factor of @xmath39 multiplying the background entropy gradient .",
    "the right hand sides of the momentum equations for these four systems of equations are summarized in table  [ table : rhs momentum ] .",
    "clccccccccccc fc & @xmath40 & ( [ eq : compressible momentum pomega ] ) + ans & @xmath40 & ( [ eq : ash momentum pomega ] ) + lbr & @xmath41 & ( [ eq : lbr momentum pomega ] ) + rg & @xmath42 & ( [ eq : rg momentum pomega ] ) + fc & @xmath43 & + ans & @xmath44 & + lbr & @xmath45 & + rg & @xmath46 & + ans & @xmath47 & ( [ eq : ash momentum pomega ] ) + lbr & @xmath41 & ( [ eq : lbr momentum pomega ] ) + rg & @xmath48 & ( [ eq : rg momentum pomega ] )",
    "a plane - parallel isothermal atmosphere gives an analytically tractable background for computing eigenfrequencies and modes for linear gravity and/or acoustic waves .",
    "computing these simple solutions helps elucidate the differences between the various anelastic treatments . defining the velocity in terms of the vector displacement",
    ", @xmath49 allows simple integration of the linear thermodynamic equations , @xmath50 for wavelike perturbations in an atmosphere of infinite extent , we can assume without loss of generality that @xmath51 where @xmath52 is the horizontal coordinate , @xmath53 is the horizontal wave number , and the vertical dependence on @xmath54 has been left in general form with wavenumber @xmath55 .    in a hydrostatically balanced isothermal atmosphere @xmath56 where @xmath57 is the pressure or density scale height , @xmath58 is the vertical derivative , and @xmath59 is the ( constant ) sound speed .",
    "the brunt - visl frequency @xmath60 is @xmath61      the solution for the fully compressible equations is well known and can be found in several textbooks ( e.g. , * ? ? ?",
    "we begin with the linearized momentum equation for waves @xmath62 and solve for eigenfrequencies using equations  ( [ eq : xi])([eq : frozen - in pressure ] ) and ( [ eq : wave properties ] ) . taking the vertical eigenfunction @xmath63 , the dispersion relationship for waves in an isothermally - stratified atmosphere is @xmath64 = m^2 n^2 .",
    "\\label{eq : compressible dispersion i}\\ ] ] it is well known that the fully compressible euler equations conserve energy .",
    "their frequencies @xmath65 must thus be purely real with no imaginary component ( see section  [ sec : self - adjointness ] ) , yet equation  ( [ eq : compressible dispersion i ] ) has an imaginary component .",
    "taking a complex vertical wavenumber @xmath66 with real component @xmath67 resolves this .",
    "the vertical eigenfunction follows @xmath68 all waves in this atmosphere share the properties that their eigenfunctions grow with height , their momentum density decreases with height @xmath69 while their kinetic energy @xmath70 is constant with height .",
    "these eigenfunctions are orthogonal with respect to the density weight @xmath71 with @xmath72 here the dirac delta .",
    "the final dispersion relationship with @xmath73 real is @xmath74 = m^2 n^2 .",
    "\\label{eq : compressible dispersion}\\ ] ] with @xmath75 given by equation  ( [ eq : n2 ] ) .",
    "the quadratic nature of equation  ( [ eq : compressible dispersion ] ) in @xmath73 provides for two distinct branches of acoustic and gravity waves . in the high frequency limit @xmath76 , @xmath77   c_s^2,\\ ] ] representing the propagation of pure sound waves in an atmosphere with an acoustic cutoff frequency @xmath78 . in the low frequency limit , we obtain pure internal gravity waves with @xmath79 the full solution for @xmath73 follows @xmath80 with the positive root corresponding to the sound waves while the negative root corresponds to the internal gravity waves .",
    "we begin our analysis of the anelastic systems with the ans equations . for linear waves , the continuity , momentum and energy equations are @xmath81 combining the vertical momentum equation  ( [ eq : anelastic wave momentum ] ) and the energy equation  ( [ eq : anelastic wave energy ] ) for linearized waves , we obtain @xmath82 where we have also used equation  ( [ eq : n2 ] ) .",
    "we obtain @xmath20 by taking the horizontal divergence of the momentum equation @xmath83    the dispersion relationship for linear waves is @xmath84 =   m^2 n^2.\\ ] ] once again , @xmath73 has an imaginary component . as with the fully compressible equations",
    ", we can try to absorb this imaginary component within the vertical eigenfunction , which leads to a vertical wave number @xmath85 and vertical eigenfunction @xmath86 with time dependence @xmath87 = m^2 n^2 .",
    "\\label{eq : ash dispersion relationship real omega}\\ ] ] a serious problem lurks within these choices however , as the momentum and kinetic energy densities scale as @xmath88 for adiabatic motions in an ideal gas , @xmath89 , and the kinetic energy of the waves grows exponentially with height .    alternatively , we can use the eigenfunctions from the fully compressible equations , in equations  ( [ eq : compressible vertical eigenfunction]-[eq : compressible vertical wavenumber ] ) , which leads to the correct far - field behavior for momentum and energy , but leads to a dispersion relationship of @xmath90 = m^2 n^2 .",
    "\\label{eq : ash dispersion relationship}\\ ] ] there is now an imaginary component to @xmath73 and anelastic gravity waves in an infinite isothermal atmosphere can have spurious growing ( or decaying ) modes . as we will see in section  [ sec : self - adjointness",
    "] , this bizarre behavior reflects the fact that the ans equations do not conserve energy .",
    "further , as we will see in sections  [ sec : self - adjointness][sec : bounded geometries ] , the fact that these spurious modes have not been detected in simulations previously is likely related to the presence of a conserved pseudo - energy ( i.e. , a differently weighted quadratic integral of the fluctuating velocities and entropies ) .",
    ", for the fundamental mode @xmath91 and with horizontal wavenumber @xmath53 .",
    "@xmath92 frequencies for each set of equations in the low frequency limit ( @xmath93 . shown",
    "are the gravity wave branch of the exact solutions for the fully compressible euler equations ( black , labelled fc , and given by eq  [ eq : omega navier - stokes infinite isothermal full dispersion ] ) . also shown",
    "are the dispersion relation for the ans equations ( blue , dot - dashed ) , the lbr equations ( red , solid ) , and the rg equations ( green , dashed ) with each line labeled . in this regime",
    "the lbr equations and exact solutions to the euler ( fc ) equations are in good agreement , while the ans and rg equations obtain frequencies that are too high .",
    "the corresponding dispersion relationships are given in table  [ table : dispersion relationships ] .",
    "@xmath94 full frequency domain . at large @xmath53 the ans , lbr and",
    "fc equations converge to the brunt - visl frequency @xmath60 , while the rg equations are too large by a factor of @xmath95 . here",
    "we also show the sound wave branch ( black , labelled `` acoustic '' , and given by eq  [ eq : omega navier - stokes infinite isothermal full dispersion ] ) of the exact solution to the full euler equations .",
    "[ fig : omega infinite atm ] ]      finding linear eigenfrequencies in the lbr equations amounts to the same procedure as in section  [ sec : ans waves ] .",
    "now however the @xmath31 term is missing from the vertical momentum equation , and equation  ( [ eq : ash vertical momentum omega ] ) becomes @xmath96 this readily yields the following dispersion relationship @xmath97 = m^2 n^2 , \\label{eq : lbr vertical momentum omega isothermal final}\\ ] ] requiring that @xmath98 is clearly the natural choice for obtaining real frequencies . by employing the vertical eigenfunctions in equations  ( [ eq : compressible vertical eigenfunction]-[eq : compressible vertical wavenumber ] )",
    "we get @xmath99 = m^2 n^2 ,    \\label{eq : lbr dispersion relationship}\\ ] ] which is the same as equation  ( [ eq : compressible dispersion gw ] ) .",
    "adiabatically propagating gravity waves solved with the lbr equations in an infinite isothermal atmosphere behave like the low frequency branch of the fully compressible equations in both their time dependence and their vertical structure .",
    "next we look at the propagation of gravity waves within the rg equations . in an isothermal atmosphere",
    "the coupling between @xmath20 and the background stratification disappears . with the anelastic continuity equation  ( [ eq : anelastic wave continuity ] ) , the linear rg wave equations are @xmath100 combining the vertical momentum and energy equations yields @xmath101 this leads to a dispersion relationship of @xmath102 = \\gamma m^2 n^2.\\ ] ] as previously , the vertical eigenfunctions in equations  ( [ eq : compressible vertical eigenfunction]-[eq : compressible vertical wavenumber ] ) are the clear choice and lead to a final dispersion relationship of @xmath103 = m^2 \\gamma n^2 ,    \\label{eq : rg dispersion relationship}\\ ] ] which is the same as equation  ( [ eq : compressible dispersion gw ] ) except for the factor of @xmath39 multiplying @xmath75 .",
    "while the functional form of the frequencies given in equation  ( [ eq : rg dispersion relationship ] ) are correct up to a factor of @xmath104 for @xmath105 , and while the vertical structure of the eigenfunction matches with the fully compressible case , we note that this is a special case brought about by @xmath106 in an isothermal atmosphere . in more general atmospheres , an extra term would exist in equation  ( [ eq : rg wave momentum ] ) of the form @xmath107 and we would be faced by the same problems with energy conservation and growth that we found in section  [ sec : ans waves ] for the ans equations .",
    "we will see this in section  [ sec : anelastic - i energy balance ] .",
    "we summarize the properties of gravity waves for all four systems of equations in an isothermal atmosphere of infinite extent in table  [ table : dispersion relationships ] and plot them for waves with @xmath108 in figure  [ fig : omega infinite atm ] . in the low - frequency regime (",
    "figure  [ fig : omega infinite atm]@xmath109 ) , the gravity wave branch of the exact solutions to the euler equations ( labelled fc , and given by eq  [ eq : omega navier - stokes infinite isothermal full dispersion ] ) matches the dispersion relationship of the lbr equations closely , while the frequencies of gravity waves in the ans and rg equations are too large . as the horizontal wavenumber @xmath53 increases , the lbr dispersion relationship begins to diverge from the exact results . at still larger wavenumber @xmath53 ,",
    "both the ans and lbr dispersion relationships return to agreement with the exact euler solutions ( figure  [ fig : omega infinite atm]@xmath110 ) .",
    "at all wavenumbers , the frequencies from the rg equations are a factor of @xmath95 larger than those obtained from the lbr equations and thus exceed the brunt - visl frequency @xmath60 at large @xmath53 .",
    "higher order radial modes show similar behavior , though the relative differences between the lbr and fc dispersion relationships decreases as @xmath67 increases .",
    "ccccccccccccc fc & @xmath111^{-1 } m^2 n^2 $ ] & ( [ eq : compressible dispersion gw ] ) + ans & @xmath112^{-1 } m^2 n^2 $ ] & ( [ eq : ash dispersion relationship real omega ] ) + ans - i & @xmath113^{-1 } m^2 n^2 $ ] & ( [ eq : ash dispersion relationship ] ) + lbr & @xmath114^{-1 } m^2 n^2 $ ] & ( [ eq : lbr dispersion relationship ] ) + rg & @xmath114^{-1 } m^2 \\gamma n^2 $ ] & ( [ eq : rg dispersion relationship ] )",
    "[ sec : self - adjointness ]    an important theme of this paper revolves around energy budgets in different approximations to the full euler equations .",
    "the curious discrepancies found in isothermal atmospheres in section  [ sec : isothermal atmosphere ] hint at deeper issues in these approximated equation sets . in this section , we find that those issues are associated with energy conservation and its violation . here",
    "we consider general atmospheres , with the isothermal atmospheres of section  [ sec : isothermal atmosphere ] being a subset of these results .",
    "for each set of equations , beginning with the full euler equations and proceeding with each anelastic equation set in turn , we derive the energy conservation properties for arbitrary nonlinear motions .",
    "we then consider the energy conserving properties of linearized motions including wave - like perturbations .",
    "we find that some equation sets ( fc and lbr ) conserve energy and behave as expected .",
    "we find that the other anelastic equation sets ( ans and rg ) do not conserve energy and instead conserve a stratification - weighted pseudo - energy , which leads to some surprising and paradoxical results for wave - like motions .",
    "the key results of this section are summarized in table  [ table : energies and pseudo energies ] .",
    "crcccc fc & @xmath115 & ( [ eq : linear euler energy ] ) & y & y & y + ans & @xmath116 & ( [ eq : anelastic - i weighted - self - adjoint ] ) & n & n & y + lbr & @xmath115 & ( [ eq : anelastic - ii self - adjoint ] ) & y & y & y + rg & @xmath117 & ( [ eq : anelastic - iii weighted - self - adjoint ] ) & y & n & n      we begin by considering the euler equations .",
    "the main results of this subsection are well known in the literature ( e.g. , * ? ? ?",
    "namely , in the fully compressible euler equations , energy is conserved by wavelike motions and the temporal frequencies @xmath65 are purely real . however , for the purposes of comparison with anelastic models , we note that the fully nonlinear equations  ( [ eq : euler continuity])([eq : euler entropy ] ) contain a statement of conservation of energy . contracting equation  ( [ eq : euler momentum ] ) with velocity @xmath118 and assuming that gravity is given by a potential function gives @xmath119 \\ = \\ 0 , \\label{euler energy}\\end{aligned}\\ ] ] where @xmath120 with @xmath121 the gravitational potential .",
    "the fully compressible euler equations conserve energy for arbitrary ( nonlinear ) motions .    for the linearized version of the euler equations",
    ", we may go a step further . for a system in hydrostatic balance ( eq .  [ eq : hydrostatic balance ] ) , we write equation  ( [ eq : linear euler ] ) in terms perturbed pressure @xmath122 and entropy @xmath123 as @xmath124 we introduce an arbitrary vector @xmath125 that is related to the displacement vector @xmath126 ( eq  [ eq : xi ] ) and guided by equations ( [ eq : frozen - in pressure ] ) and ( [ eq : frozen - in entropy ] ) define @xmath127 and @xmath128 as @xmath129 contracting equation  ( [ eq : linear euler 2 ] ) with arbitrary @xmath125 and using equations  ( [ eq : frozen - in pressure prime ] ) and ( [ eq : frozen - in entropy prime ] ) gives @xmath130    we may derive a number of different results from equation  ( [ eq : euler self - adjoint ] ) .",
    "first we consider velocity perturbations and take @xmath131 ( thus @xmath132 and @xmath133 ) .",
    "this choice gives the local conservation of energy for linear perturbations @xmath134 integrating equation  ( [ eq : linear euler energy ] ) over a volume @xmath135 with @xmath136 on the boundary @xmath137 , gives @xmath138 where the kinetic and potential energies are given respectively by @xmath139 linear perturbations also conserve energy in the fully compressible euler equations .",
    "choosing instead that @xmath140 ( with this choice , @xmath141 and @xmath142 ) in equation  ( [ eq : euler self - adjoint ] ) , integrating over volume @xmath135 with @xmath136 on boundary @xmath137 , and averaging over time gives a version of energy equipartition for linear perturbations , where the time average of the kinetic energy equals the time average of the potential energy .    rather than considering energy conservation ,",
    "we now consider the time - dependence of linearized displacements @xmath143 where @xmath144 represents the complex conjugate of displacement @xmath145 .",
    "here , @xmath128 gives the characteristic entropy perturbation @xmath123 associated with a displacement of amplitude @xmath145 and likewise with @xmath127 and pressure perturbation @xmath122 .",
    "integrating over the same volume , @xmath135 , gives @xmath146 all of the integrals in equation  ( [ eq : real - omega ] ) are strictly real and positive definite , which implies that the squared temporal frequencies must also be real @xmath147 equation  ( [ eq : real omega squared ] ) states that while instability may or may not exist , the system must transition from purely oscillating ( @xmath148 ) to purely growing behavior ( @xmath149 ) . neither growing nor damped waves exist in the fully compressible euler equations .",
    "lastly , one may show that displacements with different frequencies are orthogonal with respect to the energy inner product , @xmath150 where @xmath151 is here the kronecker delta .",
    "together , equation  ( [ eq : energy inner product ] ) and equation  ( [ eq : euler self - adjoint ] ) imply that the right - hand side of the linear perturbation equation  ( [ eq : linear euler 2 ] ) is self - adjoint with respect to this energy inner product .",
    "therefore , the condition equation  ( [ eq : real omega squared ] ) unlimitedly stems from _ both _ a particular dynamical equation , and an appropriate inner product . if equation  ( [ eq : energy inner product ] ) is altered , which amounts to a different spatial weighting of the solutions , then equation  ( [ eq : real omega squared ] ) may not hold , and the time dependence of the solution may acquire spurious growth or decay .",
    "the above four results that derive from integrating over the volume @xmath135 hinge on the condition that @xmath152 on the boundary of @xmath135 with @xmath153 the unit normal vector .",
    "this condition is not a mere technical triviality , as equation  ( [ boundary condition ] ) causes the divergence term in equation  ( [ eq : euler self - adjoint ] ) to vanish .",
    "if @xmath135 is a bounded domain , or is periodic in the horizontal direction and bounded in the vertical direction , then we may easily satisfy equation  ( [ boundary condition ] ) by requiring @xmath154 by itself ( e.g. , impenetrable boundaries ) . for the travelling waves we considered in section  [ sec : isothermal atmosphere ]",
    "the product @xmath155 is itself periodic and integrates to zero , since @xmath156 , and @xmath157 for large and small atmospheric heights .",
    "as we will see in the following subsections , the far - field behavior of travelling waves controls the stability properties of different anelastic models .      for comparison with the total energy equation  ( [ euler energy ] ) for the euler system",
    ", we now derive an equivalent energy balance for the anelastic models , beginning with the ans equations . contracting equation  ( [ eq : ash momentum pomega ] ) with @xmath118 and using the anelastic continuity equation  ( [ eq : anelastic continuity ] ) gives in basic form @xmath158 +   \\rho_{0}{\\boldsymbol}{u } { { \\boldsymbol}{\\cdot}}{\\boldsymbol}{g } \\ , \\frac { s_{1}}{c_{p } }   = \\\\",
    "\\varpi \\rho_{0 } { \\boldsymbol}{u }   { { \\boldsymbol}{\\cdot}}{{\\boldsymbol}{{\\nabla}}}\\left ( \\frac{s_{0}}{c_{p}}\\right)\\ ] ] with kinetic energy density @xmath159 . using the relationship  [ eq : conservative buoyancy work i ] in appendix  [ sec : appendix conservative buoyancy ] , we put the left hand side of equation  ( [ eq : ash energy ] ) into conservative form @xmath160   \\ = \\   \\varpi \\rho_{0 } { \\boldsymbol}{u }   { { \\boldsymbol}{\\cdot}}{{\\boldsymbol}{{\\nabla}}}\\left ( \\frac{s_{0}}{c_{p}}\\right ) ,   \\end{aligned}\\ ] ] where @xmath161 and @xmath162 are given by equations  ( [ eq : anelastic energy e i ] ) and ( [ eq : pomega hat ] ) respectively .",
    "we can not however transform the right - hand side into conservative form unless @xmath163 this condition is not true in general and , simply stated , arbitrary ( nonlinear ) motions in the ans equations do not conserve energy .",
    "condition  ( [ ash conservation condition ] ) is satisfied for adiabatically - stratified atmospheres , where @xmath164 , and in those systems the ans equations do conserve energy .",
    "we turn now to linearized motions to learn more about the strange behavior found in section  [ sec : ans waves ] by considering the equivalent of equation  ( [ eq : euler self - adjoint ] ) for the ans model equations .",
    "contracting the linear momentum equation with an arbitrary @xmath165 , but here satisfying @xmath166 ( again , @xmath125 could be either @xmath126 or @xmath167 ) , produces @xmath168 if we integrate equation  ( [ eq : anelastic - i non - self - adjoint ] ) over the entire volume , @xmath135 , then the right - hand side refuses to vanish : even linearized motions do not conserve energy in the ans equations .    the non - vanishing right - hand side of equation  ( [ eq : anelastic - i non - self - adjoint ] ) would also appear to imply that the squared frequencies @xmath73 are not strictly real . on the surface , the asymmetric nature of equation  ( [ eq : anelastic - i non - self - adjoint ] ) would appear to imply non - self - adjointness of the linear equations and hence spuriously growing modes .",
    "this is consistent with what we found for our analysis in an infinite isothermal atmosphere ( sec .",
    "[ sec : ans waves ] ) ; as we found there , a correction to the spatial structure counteracts this effect and regains real eigenvalues for the linear equations at the cost of modes which grow in spatial height . in the literature of anelastic simulations",
    "however , no mention appears of these spuriously growing gravity waves , and a paradox seems apparent .",
    "the paradox of spurious growth is remedied by the following transformation of equation  ( [ eq : anelastic - i non - self - adjoint ] ) , @xmath169 where we define the scaled pseudo - density @xmath170 which reduces to the actual background density in the case of adiabatic stratification .",
    "though energy is not conserved for nonlinear dynamics , nor for linear waves , equation  ( [ eq : anelastic - i weighted - self - adjoint ] ) implies that the following pseudo - energy is conserved @xmath171{\\,\\mathrm{d}^{3}{\\boldsymbol}{x } } , \\label{eq : ash pseudo energy}\\end{aligned}\\ ] ] i.e. , @xmath172 , for _ linear _ perturbations .",
    "if the perturbations are _ nonlinear _ then the rescaling of the density fails since the advection of kinetic energy is not an exact divergence in terms of this pseudo - density .    as in the compressible case ( eq .  [ eq : real - omega ] ) , one may use equations  ( [ eq : omega displacement ] )  &  ( [ eq : anelastic - i weighted - self - adjoint ] ) to show that @xmath173 which implies that @xmath174 even if energy is not conserved .",
    "this indicates that the conservation of a pseudo - energy resolves the paradox of spurious growth and leads to purely real squared temporal frequencies @xmath73 .",
    "we believe that this explains why this phenomena of pseudo - energy conservation and energy violation has been previously missed in the literature .",
    "equations  ( [ eq : anelastic - i weighted - self - adjoint ] )  &  ( [ eq : ash real omega squared ] ) imply that the linearized ans equations are self - adjoint under the pseudo - energy inner product , and that eigenfunctions with different frequency are orthogonal with respect to this pseudo - density weighted norm @xmath175 the difference between equations  ( [ eq : energy inner product ] )  &  ( [ eq : pseudo - energy inner product ] ) imply that external forcings and initial conditions project onto different frequencies and basis vectors differently in the ans equations than in the fc equations .",
    "in particular , the eigenfunctions of pseudo - energy - conserving waves in the ans equations are different than the eigenfunctions given by energy - conserving motions ( e.g. , the fc equations ) . in strongly stably - stratified atmospheres , these differences may be dramatic , as we will encounter in section  [ sec : bounded geometries ]      unlike the ans equations , the lbr equations show no problems with energy conservation .",
    "contracting equation  ( [ eq : lbr momentum pomega ] ) with @xmath118 and using the anelastic continuity equation  ( [ eq : anelastic continuity ] ) gives in basic form @xmath176 +   \\rho_{0}{\\boldsymbol}{u } { { \\boldsymbol}{\\cdot}}{\\boldsymbol}{g } \\",
    ", \\frac { s_{1}}{c_{p } } =    0 .",
    "\\end{aligned}\\ ] ] using the relationship  [ eq : conservative buoyancy work i ] in appendix  [ sec : appendix conservative buoyancy ] , we put equation  ( [ eq : lbr energy-0 ] ) into conservative form @xmath177   \\ = \\   0 ,   \\end{aligned}\\ ] ] where @xmath161 and @xmath162 are given by equations  ( [ eq : anelastic energy e i ] ) and ( [ eq : pomega hat ] ) respectively .",
    "if we integrate this over a bounded volume @xmath135 ( where as in eq  [ boundary condition ] , @xmath178 ) then the divergence terms vanish and arbitrary ( nonlinear ) motions in the lbr equations obey an energy conservation law .    for linear perturbations and for nonlinear perturbations in certain atmospheres ( including adiabatic and isothermal atmospheres ) ,",
    "the lbr equations conserve an alternative total energy @xmath179 i.e. @xmath180 , as detailed in appendix  [ sec : appendix conservative buoyancy ] .    for linear perturbations",
    "we may furthermore write @xmath181 this implies self - adjointness of system under the energy inner product , and also that @xmath182 whence it follows that @xmath183 .",
    "linear motions conserve energy in the lbr equations and wavelike motions have real squared temporal frequencies @xmath73 .      for the rg equations , using similar transformations as in sections  [ sec : euler energy balance][sec : anelastic - ii energy balance ] , we obtain the following nonlinear energy balance @xmath184   \\ = \\    \\varpi \\rho_{0 } { \\boldsymbol}{u }   { { \\boldsymbol}{\\cdot}}{{\\boldsymbol}{{\\nabla}}}\\ln t_{0},\\end{aligned}\\ ] ] where @xmath185 it is not possible to cast the right - hand side of equation  ( [ eq : rg energy ] ) into conservative form except in the specialized case of isothermal atmospheres where @xmath186 .",
    "this contrasts with the ans equations , which can only be written in conservative form in adiabatic atmospheres .",
    "thus the rg equations do not conserve energy for either anelastic convection or gravity wave dynamics in arbitrary atmospheres .",
    "linear perturbations to these equations do nevertheless obey a pseudo - density weighted self - adjointness @xmath187 where @xmath188 and the pseudo - density becomes @xmath189 furthermore , as in sections  [ sec : euler energy balance][sec : anelastic - ii energy balance ] , we find that @xmath190 equation  ( [ eq : rg real omega squared ] ) implies that @xmath191 even if energy is not conserved . as in the ans equations , waves in the rg equations have real squared temporal frequencies @xmath73 in volumes where @xmath192 on the domain boundaries , but the eigenfunctions and energies are weighted by pseudo - density  ( [ eq : rg pseudo density ] ) .",
    "equation  ( [ eq : rg real omega squared ] ) implies that the stability _ boundary _ for the fully compressible and other anelastic models , @xmath193 , remains unaltered in the rg equations in spite of energy non - conservation .",
    "two problems do however still remain .",
    "the first is that an extra factor of @xmath39 appears in the last integral of equation  ( [ eq : rg real omega squared ] ) .",
    "as we found for waves in an isothermal atmosphere , this leads to frequencies that are too high .",
    "the second more serious issue is that energy is not conserved _ unless _ the background atmosphere is isothermal .",
    "in particular , both linear and nonlinear motions within adiabatically - stratified atmospheres will not conserve energy .",
    "we now turn to considering gravity waves in a spherical shell . in this geometry divergence at infinity",
    "is no longer a problem .",
    "we will find that impenetrable boundary conditions at the top and bottom of the spherical shell lead to frequencies that are purely real ( e.g. , oscillating waves only , with no spuriously growing modes ) but now the eigenfunctions will be severely distorted in the ans equations as compared with the lbr equations . in a sense ,",
    "the eigenfunctions try to diverge to infinity but are constrained by the boundary conditions .",
    "analytic eigenfunctions can be found if we consider a simplified atmosphere with constant gravity @xmath1 and constant brunt - visl frequency @xmath60 . in an isothermal atmosphere with temperature",
    "@xmath12 this can be achieved by setting the entropy gradient to @xmath194 the background entropy @xmath13 is found by integration , with the arbitrary constant set by a reference value within the atmosphere ( here at the base of the domain ) .",
    "the background pressure and density are determined by hydrostatic balance and their values at the reference layer .",
    "we first derive the analytic solutions and then compare these solutions with fully nonlinear calculations using two versions of the anelastic spherical harmonic ( ash ) code .",
    "we begin by obtaining analytic solutions for the low - mach number ans , lbr , and rg equations .",
    "full details are given in appendix  [ appendix : eigenfunctions ] .",
    "motivated by the properties of the solar radiative zone , we solve for the eigenvalues of the low - mach number anelastic equations within a spherical shell stretching from @xmath195 to @xmath196 with @xmath197 the solar radius .",
    "this shell has geometric extent @xmath198 and we consider several different values for the scale height @xmath57 and number of density scale heights @xmath199 .",
    "the atmospheric parameters are reported in table  [ table : atmospheres ] .",
    "the first five such wavenumbers for the ans and lbr equations are presented in table  [ table : numerical vertical wavenumbers ] for several of these atmospheres .",
    "ccccccccccccc 0.25 & 0.1 & 548 & 0.788 & 39.3408 & 0.84 & 1185 + 1.0 & 0.4 & 137 & 0.197 & 9.83520 & 1.69 & 592.6 + 2.5 & 1 & 54.8 & 0.0788 & 3.93408 & 2.66 & 374.6 + 5.0 & 2 & 27.4 & 0.0394 & 1.96704 & 3.77 & 264.9 + 7.5 & 3 & 18.3 & 0.0263 & 1.31136 & 4.62 & 216.3 + 10.0 & 4 & 13.7 & 0.0197 & 0.98352 & 5.34 & 187.4 + 12.5 & 5 & 11.0 & 0.0158 & 0.78682 & 5.96 & 168.5    lcccccccccccc ans & 9.72953 & 19.0635 & 28.4829 & 37.9246 & 47.3752 + lbr & 10.1839 & 19.3017 & 28.6431 & 38.045 & 47.4717 + ans & 10.4846 & 19.4637 & 28.7527 & 38.1277 & 47.5379 + lbr & 12.0834 & 20.3817 & 29.3825 & 38.605 & 47.9216 + lbr & 14.6998 & 22.0671 & 30.5764 & 39.5211 & 48.6627 + ans & 11.6324 & 20.1134 & 29.1969 & 38.4639 & 47.8080 + fc-1 & 2.16693 & 15.4867 & 26.2203 & 36.2565 & 46.0510 + fc-@xmath200 & 9.49926 & 18.6646 & 27.9660 & 37.3421 & 46.7676 + ans & 14.692 & 22.0618 & 30.5726 & 39.5182 & 48.6602 + lbr & 20.888 & 26.7604 & 34.1169 & 42.3167 & 50.9577 +    we begin by discussing eigenfunctions in the @xmath201 atmosphere , as this atmosphere will form the primary comparison case for the 3-d numerical simulations in section  [ sec : ash sims ] . in figure",
    "[ fig : n7.5 eigenfunctions ] we show both the fundamental @xmath202 mode and a higher - order @xmath203 mode .",
    "in addition to the various low - mach number anelastic eigenfunctions , here we also overplot eigenfunctions for the fully compressible euler ( fc ) equations ; and these require numeric solutions . in the full fc equations ,",
    "the radial eigenfunction depends on spherical harmonic @xmath204 , whereas in the anelastic equation sets this coupling disappears .",
    "this effect is most pronounced in the fc eigenfunctions at low-@xmath204 , with the eigenfunctions largely becoming constant with @xmath204 when @xmath205 . as such",
    ", we plot two fc eigenfunctions , one at @xmath206 ( fc-@xmath207 ) and one at @xmath208 ( fc-@xmath200 ) .     atmosphere .",
    "@xmath92 eigenfunctions for the fundamental @xmath202 mode and @xmath94 the higher - order @xmath203 mode .",
    "@xmath209 dispersion relationship @xmath210 for the first , third and fifth radial modes ( @xmath202 , @xmath211 , @xmath203 ) , with lower - k having higher @xmath65 . in each plot , the ans equations are shown in blue ( dash - dotted ) while the lbr equations are shown in red ( solid ) .",
    "the full compressible results are shown in black .",
    "for the eigenfunctions , the solid line corresponds to @xmath206 ( fc-@xmath207 ) and the thick dashed line corresponding to @xmath208 ( fc-@xmath200 ) .",
    "[ fig : n7.5 eigenfunctions ] ]    as is clearly evident in figure  [ fig : n7.5 eigenfunctions]@xmath110 , the discrepancies in the ans eigenfunctions do not diminish at high radial wavenumbers .",
    "this continues to hold true for higher wavenumbers than we show here .",
    "this is not surprising , as these discrepancies arise from the energy non - conservation in the ans equations , rather than from assumptions about the relative size of the gravity wavelengths and scale heights in the atmosphere .",
    "in contrast , at high-@xmath67 , the other equation sets all converge .",
    "the dispersion relationship for odd modes @xmath202 , @xmath211 and @xmath203 are shown as a function of spherical harmonic @xmath204 in figure  [ fig : n7.5 eigenfunctions]@xmath209 . for the @xmath202 mode and at low-@xmath204 , the low - mach number anelastic equations generally produce higher frequencies than the full compressible euler equations . at higher-@xmath204 all of these frequencies converge to the brunt - visl frequency @xmath60 , and the frequencies in the ans and lbr equations generally cross the frequencies of the euler equations at some moderate @xmath204 .",
    "the frequencies converge much sooner at high radial order ( e.g. ,  @xmath203 ) .",
    "the rg equations are not shown in figure  [ fig : n7.5 eigenfunctions ] ; their frequencies are consistently a factor of @xmath212 larger than the lbr equations .",
    "the eigenfunctions of the fundamental mode @xmath202 are shown in figure  [ fig : eigenfunctions ] for several isothermal atmospheres from table  [ table : atmospheres ] . with the normalization that we have chosen ( appendix  [ appendix : eigenfunctions ] ) , the ans eigenfunctions are generically larger in amplitude than the other systems of equations .",
    "this difference is most pronounced near the top of the domain , and the discrepancies grow as the amount of stratification grows .",
    "we turn now to fully nonlinear 3-d simulations of gravity wave propagation using the ash code .",
    "we study gravity waves in ash using both the standard ans equations as well as an implementation of the lbr equations . in the ash - ans equations , the momentum and energy equations are @xmath213 =     -{\\boldsymbol}{{\\nabla}}p_1 + \\rho_0\\frac{p_1}{\\gamma p_0}{\\boldsymbol}{g } -    \\rho_0\\frac{s_1}{c_p}{\\boldsymbol}{g } -{\\boldsymbol}{{\\nabla}}\\cdot{\\boldsymbol}{{\\mathcal{d } } } , \\label{eq : ash code momentum}\\ ] ] @xmath214 \\\\ + 2 \\frac{\\nu}{t_0 } \\left[e_{i j } e_{i j } - \\frac{1}{3 } ( { \\boldsymbol}{{\\nabla}}\\cdot{\\boldsymbol}{u})^2\\right ] , \\label{eq : ash code entropy } \\ ] ] where the viscous stress tensor is @xmath215,\\ ] ] with @xmath216 the strain rate tensor and @xmath217 the kronecker delta .",
    "these anelastic equations assume a linearized equation of state ( eq  [ eq : linearized eos ] ) and the anelastic constraint ( eq  [ eq : anelastic continuity ] ) but are otherwise fully nonlinear .",
    "the ash - lbr equations are identical except for the momentum equation , where @xmath218 =    -\\rho_0{\\boldsymbol}{{\\nabla}}\\left(\\frac{p_1}{\\rho_0}\\right )    -\\rho_0\\frac{s_1}{c_p}{\\boldsymbol}{g }   -{\\boldsymbol}{{\\nabla}}\\cdot{\\boldsymbol}{{\\mathcal{d}}}.   \\label{eq : ash - lbr momentum}\\ ] ] all other properties of the simulations are identical .",
    "we take the geometry and atmosphere used previously in this section for the background reference state entropy @xmath13 , pressure @xmath11 , temperature @xmath12 , and density @xmath10 .",
    "these quantities vary in radius but do not evolve in time . here",
    "we first focus on simulations conducted in an isothermal atmosphere with @xmath219 and with other parameters given in table  [ table : atmospheres ] . in comparison , over the same range of radii in the sun @xmath220 , while @xmath221 over the whole solar radiative zone .",
    "as such , the results presented here are likely an over - estimate for comparable effects in the solar interior , but the larger number of scale heights more clearly emphasizes the differences between the ash - ans and ash - lbr equations .",
    "we will return to solar conditions at the end of this section .    in the pseudo - energy conserving ans equations ,",
    "the scaled pseudo - density ( eq  [ eq : scaled pseudo - density ] ) is weighted by the background entropy @xmath13 . as such ,",
    "the non - dimensional entropy drop across the domain @xmath222 or the number of pseudo - density scale heights @xmath223 with @xmath224 are both likely better measurements of how much pseudo - energies differ from energies in the ans equations than the number of density scale heights @xmath199 in the atmosphere . for a non - isothermal atmosphere",
    ", we can use the equation of state ( [ eq : background eos ] ) to obtain @xmath225 where @xmath226 is the number of temperature scale heights . in an isothermal atmosphere with @xmath105 ,",
    "this reduces to @xmath227 and the number of ans pseudo - density scale heights always exceeds the number of density scale heights .",
    "our isothermal atmosphere with @xmath228 has @xmath229 and @xmath230 .",
    "the numerical simulations were conducted in a non - rotating system with viscosity @xmath231 and entropy diffusivity @xmath232 and with @xmath233 .",
    "in contrast to ash simulations of stellar convection ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) , in these isothermal atmosphere simulations we neglect radiative diffusion of temperature in the entropy equation and diffusion of the background entropy gradient @xmath234 , which in these simulations is set by equation  ( [ eq : isothermal dsdr ] ) .",
    "as such , there is no energy flux through the simulation .",
    "the velocity boundary conditions at the top and bottom of the domain are stress - free and impenetrable , and the thermal boundaries maintain a constant entropy gradient .",
    "all simulations are conducted with a resolution of @xmath235 ( @xmath236 ) , with all functions expanded in chebyshev polynomials radially and spherical harmonics horizontally ; this leads to a dealiased spectral resolution of @xmath237 , which resolves the wave motions studied here .",
    "isothermal atmosphere . shown",
    "are the rms radial velocities for ash simulations calculated with ans ( blue , solid ) and lbr ( red , solid ) treatments of the momentum equation .",
    "the thick dashed lines give the analytic @xmath202 eigenmode for each equation set , normalized by the peak velocity realized in the ash simulations .",
    "[ fig : ans and lbr eigenfunctions ] ]    timestepping errors can have important impacts on the properties of wave motions .",
    "the ash code uses a second - order adams - bashforth / crank - nicolson technique for time evolution , which treats diffusive processes implicitly and advective processes explicitly . in our studies here",
    ", we found that it is crucial that the advective interactions between the wave motions and the background reference state stratification be handled implicitly ( on the crank - nicolson side ) . in the entropy equation  ( [ eq : ash code entropy ] ) , this term is @xmath238 if these interactions are handled explicitly ( via the adams - bashforth portion ) then the solutions are sensitive to the size of the timestep ; with sufficiently small timesteps a solution can be time - evolved correctly , but these timesteps must be nearly an order of magnitude smaller than are otherwise possible .",
    "larger timesteps lead to explicit timestep errors that grow quickly in the solution .",
    "handling these interactions implicitly , as we do here , leads to much more stable behavior . to simplify matters , in these studies we fix the timestep at slightly less than one third of the brunt - visl timescale @xmath239 ( e.g. , @xmath240 in the @xmath228 atmosphere ) .    at the start of each simulation ,",
    "random entropy perturbations are introduced in a band of spherical harmonic @xmath204 ranging from @xmath206@xmath241 , at all spherical harmonic @xmath53 values .",
    "the radial perturbation has two bumps in radius , defined by @xmath242 with scaled radius @xmath52 given by @xmath243.\\ ] ] this radial perturbation does not exactly match the radial eigenfunction of the gravity waves but rather drives a broad band of such waves with the largest power in the lowest @xmath202 and @xmath244 modes .",
    "the initial perturbations lead to flows of roughly @xmath245 in amplitude , with reynolds numbers @xmath246 of about 100 .",
    "the viscous @xmath247 of these waves , @xmath248 where we have taken @xmath249 ( the low - frequency @xmath206 fundamental mode has @xmath250 ) and @xmath251 , the depth of our shell . a thermal @xmath247 would be four times smaller .",
    "the @xmath247 calculated in equation  ( [ eq : q ] ) is most applicable to our longest wavelength modes ; our shortest wavelength modes with @xmath252 would have a @xmath247 of about @xmath253 which is still quite large .",
    "thus , we expect that the gravity waves should only be very weakly damped by diffusion .",
    "we expect that there will be two clear effects from the choice of ans or lbr equations .",
    "the first such effect is that radial eigenfunctions of the two systems should differ strongly , as discussed in section  [ sec : isothermal analytic bounded ] .",
    "the radial eigenfunctions for the ash - ans and ash - lbr simulations are shown in figure  [ fig : ans and lbr eigenfunctions ] .",
    "plotted on the same scale and against radius are fluctuating rms radial velocities @xmath254 at a time late in the simulations ( 30 days after initiation , or roughly 12,000 @xmath255 ) .",
    "these rms velocities are further time - averaged over roughly 2.5 days or about 1000 @xmath255 .",
    "overplotted on each simulation is the appropriate radial eigenfunction corresponding to the gravest @xmath202 mode for the ans or lbr equations . here",
    "the eigenfunctions are scaled by the peak rms velocity . in both simulations ,",
    "the rms velocities from the fully nonlinear 3-d numerical simulations agree very well with the analytic eigenfunctions . in the ash - ans set of equations , the radial velocities peak more strongly in the upper portion of the domain , reaching amplitudes 2 - 4 times larger than the ans - lbr equations .",
    "the fluctuating velocities differ strongly , as expected .",
    "the second effect is that , as discussed in section  [ sec : self - adjointness ] , the lbr equations should conserve energy while the ans equations conserve a pseudo - energy .",
    "in the simulations we define volume - averaged total energy @xmath161 , kinetic energy @xmath55 and potential energy @xmath256 densities @xmath257 with fluctuating velocity @xmath258 and fluctuating entropy @xmath123 , and where the integral is over the full simulation volume @xmath135 ( e.g. ,  eqn  [ eq : alternative total energy ] ) . likewise we define pseudo - energy densities ( e.g. ,  eqn  [ eq : ash pseudo energy ] ) @xmath259 in an isothermal atmosphere with constant brunt - visl frequency @xmath60 , @xmath13 is a function of radius and the stratification term can not be factored out of the integral . if thermal and viscous diffusion can be neglected , @xmath161 should be conserved in the lbr equations while @xmath260 will vary in time .",
    "likewise , the ans equations should conserve total pseudo - energy @xmath260 but should fail to conserve total energy @xmath161 . indeed , this is what we find .    shown in figure  [ fig : ans and lbr e and pe ] are temporal traces of energy and pseudo - energy in the ash - ans simulation and the simulation using the ash - lbr equations . here",
    "a short interval , spanning about 100@xmath255 , is shown from a much longer simulation .",
    "the wave periods are generally longer than @xmath255 , owing to their long horizontal wavelengths .",
    "the ash - ans simulation shows large variations in kinetic and potential energies k and u and does not conserve total energy e ( fig .",
    "[ fig : ans and lbr e and pe]@xmath92 ) .",
    "this simulation does however clearly conserve total pseudo - energy pe ( fig .",
    "[ fig : ans and lbr e and pe]@xmath94 ) . over much longer intervals of time , both the total energy and total pseudo - energy decay dissipatively .",
    "in contrast , the ash - lbr simulation correctly conserves energy e ( fig .",
    "[ fig : ans and lbr e and pe]@xmath209 ) while the pseudo - energy pe fluctuates in time ( fig .",
    "[ fig : ans and lbr e and pe]@xmath261 )    we define the relative energy variation @xmath262 and pseudo - energy variation @xmath263 as @xmath264 with @xmath72 signifying the standard deviation in time and brackets denoting a time average over the same period .",
    "subtracting off the slow diffusive decay , we find that over a ten - day interval ( 4000 @xmath239 ) , @xmath265 in the ash - ans simulation ( during the interval shown in figure  [ fig : ans and lbr e and pe ] , @xmath266 ) . over the same interval , @xmath267 .",
    "in contrast , the ash - lbr simulation has @xmath268 and @xmath269 over the same ten - day interval of time .",
    "we have conducted similar simulations with diffusivities @xmath270 and @xmath271 ten times larger ( e.g. , @xmath272 ) and find a similar level of variability , and thus conclude that our results are not strongly dependent on the level of diffusivity employed . for the linear waves considered here , we find that @xmath262 and @xmath263 are independent of the initial perturbation amplitude",
    ".    in these many - wave simulations , the introduced waves span varying portions of the frequency dispersion relationship , including regions where @xmath65 depends almost linearly on @xmath204 and regions where it does not ( e.g. , figure  [ fig : n7.5 eigenfunctions]@xmath209 ) .",
    "thus we might expect a collection of these very linear waves to behave as incoherent oscillators and that the relative energy variations for many waves might be smaller than those of any individual horizontal wave .     in the single - wave ash - ans solution for the atmosphere with @xmath228 and @xmath273 .",
    "this should be compared with figure  [ fig : ans and lbr e and pe]@xmath92 . generally , the variations in these single wave solutions are about a factor of 5 larger than the many - wave solutions . [",
    "fig : single wave nrho 7.5 ] ]    this is confirmed by simulations where only a single spherical harmonic perturbation is initially introduced , as shown by traces of @xmath161 , @xmath55 and @xmath256 in figure  [ fig : single wave nrho 7.5 ] for the @xmath228 and @xmath274 atmosphere . in this ash - ans simulation , only @xmath252 waves ( at all @xmath275 ) are initially excited , with the same radial perturbation as the many - wave simulations ( eq  [ eq : radial perturbation ] ) .",
    "hereon , we will refer to these as single - wave solutions . comparing figure  [ fig : single wave nrho 7.5 ] with the corresponding many - wave solution in figure  [ fig : ans and lbr e and pe]@xmath92",
    "it is clear that the relative energy variation is significantly greater . here , @xmath276",
    "( @xmath263 remains negligible ) .",
    "we have studied single - wave solutions with different horizontal wavelengths , sampling in the range from @xmath206 to @xmath277 and find that this level of energy variation is reasonably representative for individual waves of any horizontal wavelength in this range .",
    "this confirms our understanding that the phenomenon of energy non - conservation is due to the level of stratification and does not depend strongly on the particulars of any single mode ( e.g. , horizontal or vertical wavelength ) .",
    "we now turn to considering isothermal atmospheres with differing levels of stratification , ranging from @xmath278@xmath279 and @xmath280@xmath281 ( see table  [ table : atmospheres ] ) .",
    "the configurations of the simulations are the same as previously discussed , though at large stratification ( @xmath282 ) a higher resolution was used , with @xmath283 and a dealiased horizontal resolution of @xmath284 .",
    "the time - averaged relative energy variations in these ash - ans simulations are shown in figure  [ fig : many atmospheres and single waves ] , which displays both many - wave solutions ( @xmath206@xmath241 , triangles ) and single - wave solutions ( @xmath252 , squares ) .",
    "the many - wave solutions span from @xmath285@xmath281 , while the single - wave solutions span a wider range from @xmath286@xmath281 . as the stratification increases ,",
    "energy non - conservation becomes increasingly significant in the ash - ans equations , with @xmath262 approaching 10% in the many - wave simulation with @xmath287 and @xmath288 and @xmath289 in the corresponding single - wave solution .",
    "generally , we find that the relative energy variations are about 5 times higher in the single - wave solutions than the corresponding many - wave solutions , independent of stratification . in the corresponding ash - lbr simulations ( not shown ) ,",
    "energy is always well conserved with @xmath290 .    unsurprisingly , the relative energy variation is smaller in less stratified atmospheres . at very low levels of stratification ( @xmath291 )",
    "the ratio of pseudo - density and density is almost constant throughout the domain ( eq  [ eq : scaled pseudo - density ] ) , and we should expect the pseudo - energy conserving ash - ans equations to also conserve energy fairly well . indeed , this is what we find . as shown for single - wave solutions in figure  [ fig : many atmospheres and single waves]@xmath92 , at low values of @xmath292 , the energy variation @xmath262 is also small ( @xmath293 at @xmath294 ) . with increasing stratification , @xmath262 in the single - wave ash - ans solutions scales almost linearly with @xmath292 up through @xmath295 . at @xmath296 @xmath297 in the single - wave solution and @xmath298 in the many - wave solution .",
    "there is a change in the scaling for both single - wave and many - wave solutions at @xmath299 , apparent in both figures  [ fig : many atmospheres and single waves]@xmath300 ; we do not understand the origin of this behavior . in all cases shown here , @xmath301 , and generally @xmath302@xmath303 . this floor on @xmath263 likely reflects aspects of our data analysis technique and we feel that our current approach is insufficient to reliably measure energy variations in cases where @xmath304 .",
    "relative energy variation @xmath262 as given in equation  ( [ eq : ve and vp ] ) for isothermal atmospheres with different non - dimensional energy drops @xmath292 in log - log plot .",
    "@xmath94 same , in linear plot , emphasizing the behavior at large @xmath292 . shown in both",
    "are solutions with a single horizontal wave ( @xmath252 , blue squares ) and solutions with many horizontal waves ( @xmath206@xmath241 , black triangles ) . also shown are solutions in a solar radiative zone atmosphere stretching from 0.50.7@xmath305 , with a single - wave solution ( blue square with asterisk ) and a many - wave solution ( black diamond with asterisk ) . all solutions are time - averaged over an interval of 2000@xmath255 , generally beginning about 200@xmath255 after the start of the simulation .",
    "[ fig : many atmospheres and single waves ] ]      at much lower levels of diffusivity , or at larger initial amplitudes , the gravity waves may begin to interact nonlinearly .",
    "this is also likely to occur when the gravity waves are driven by overshooting convection from below . to confirm the linear nature of the waves we have studied here , we define a froude number",
    "@xmath306 as @xmath307 or the ratio of local vorticity to the brunt - visl frequency @xmath60 .",
    "this corresponds to the vorticity criteria for nonlinearity in .",
    "we find here that @xmath306 attains a peak value of about @xmath308 in the @xmath228 ash - ans simulation and of about @xmath309 in the corresponding ash - lbr simulation .",
    "thus the waves studied here are quite linear . for linear waves ,",
    "the froude number gives the characteristic amplitude of all fluctuations .",
    "owing to this , despite the large stratifications studied here ( @xmath310 ) , the thermodynamic fluctuations remain quite small ( @xmath311 ) .",
    "when nonlinear interactions become important , we might expect that the non - conservation of energy may cause ash - ans simulations to diverge even further from simulations which do conserve energy ( e.g. , the ash - lbr equations ) . as discussed in section  [ sec : ans energy ] , the conservation of pseudo - energy also vanishes when nonlinearity is important .",
    "energy is conserved in the nonlinear lbr equations , but neither the pseudo - energy nor the energy is conserved in the nonlinear ans equations . if the pseudo - energy is also not conserved , it may be possible to _ inject _ pseudo - energy into otherwise closed systems ; alternatively , the energy and pseudo - energy may leak away without coupling to the reservoir of internal energy .",
    "either case leads to physical inconsistencies .",
    "lastly , the transport by nonlinear processes in the ans equations is likely to be very different from that in equations that do conserve energy , as the eigenfunctions of gravity waves in the ans equations are significantly higher in amplitude in the upper domain of stably - stratified atmospheres ( figures  [ fig : n7.5 eigenfunctions][fig : ans and lbr eigenfunctions ] ) .",
    "this will also have important implications for mode coupling , for the steepening and breaking of gravity waves , and for all other problems where the shape of the eigenfunction itself is important .",
    "the results presented here so far have been for the special case of an isothermal atmosphere .",
    "the solar radiative zone is stably stratified , but has fewer density scale heights than have been considered in most of this section . across the entire solar radiative zone @xmath312 and @xmath313 , while @xmath314 and @xmath315 over the shell geometry that we consider here ( @xmath316@xmath317 ) .    to constrain our results ,",
    "we have repeated these gravity wave rundown ash - ans and ash - lbr simulations in the solar radiative interior .",
    "we take our model atmosphere from the cesam code @xcite .",
    "we keep the same values of @xmath270 and @xmath271 and continue to neglect radiative diffusion acting on the fluctuating flows . a large scale radiative diffusion based on the rossland mean - opacity",
    "is included that acts on @xmath318 and there is a flux equal to the solar flux throughout the domain .",
    "we keep the same choice of @xmath319 and @xmath320 , thus @xmath321 and @xmath322 .",
    "these solar simulations are shown in figure  [ fig : many atmospheres and single waves]@xmath92 as asterisks . in this model solar atmosphere",
    ", we find that in many - wave solutions ( @xmath206@xmath241 ) with the ash - ans equations @xmath323 and @xmath263 is tiny while in the ash - lbr equations @xmath324 and @xmath262 is tiny . in single - wave solutions ( @xmath252 ) , the relative energy variations in the ash - ans equations are much larger ( @xmath325 ) .",
    "surprisingly , the solar atmosphere simulations show larger relative energy variations than similarly stratified isothermal atmosphere simulations , with @xmath262 being roughly five times larger in this solar atmosphere than in the corresponding @xmath296 isothermal atmosphere .",
    "if we plotted these against @xmath223 , the solar simulations would lie midway between the @xmath280 and @xmath326 atmospheres and would still be clearly discrepant .",
    "we expect that the effects of energy non - conservation will become significantly larger as more entropy scale heights are included in the domain",
    ". this may be difficult to diagnose in simulations that include a realistic solar stratification as the radially varying brunt - visl frequency creates acoustic cavities that may trap high frequency gravity waves , but we expect that the low frequency waves which travel the entire radiative zone and experience the full stratification will be affected .",
    "the results of sections  [ sec : isothermal atmosphere][sec : bounded geometries ] provide a clear path to improving the treatment of dynamics within stably - stratified atmospheres in anelastic systems of equations . as clearly shown in figure  [ fig : ans and lbr e and pe ] , the ans equations do not conserve energy and instead conserve a stratification weighted pseudo - energy .",
    "these equations thereby obtain incorrect frequencies and radial eigenfunctions for gravity waves in both infinite and bounded isothermal atmospheres .",
    "the variation in the eigenfunctions is substantially larger than the level of energy non - conservation .",
    "these results hold in general for all subadiabatically - stratified atmospheres .",
    "in contrast , the anelastic lbr equations do conserve energy and appear to need no additional modification to capture dynamics in subadiabatically - stratified regions .",
    "this is fairly surprising , as those equations are generally derived in nearly adiabatic atmospheres and the isothermal atmospheres we have considered here take them far from their realm of validity . at low vertical and horizontal wave numbers , eigenfunctions in the lbr equations",
    "differ from the full compressible equations , and results from gravity waves in this regime should be treated with caution .",
    "these differences shrink as either wavenumber increases and the lbr equations may do a reasonable job of capturing the dynamics of those shorter wavelength gravity waves ( e.g. , figure  [ fig : n7.5 eigenfunctions ] ) .",
    "though we did not explore their dynamics in direct numerical simulation , we have demonstrated that the rg equations do not conserve energy in general atmospheres that have temperature gradients , and in those atmospheres will also likely obtain incorrect radial eigenfunctions .    to correctly capture the dynamics in sub - adiabatically stratified regions ,",
    "it is vitally important that subsonic treatments of the fluid equations conserve energy .",
    "systems of equations that conserve energy are physically self - consistent , even if simulations done with them have transport coefficients ( e.g. , @xmath270 and @xmath271 ) that are several orders of magnitude larger than the molecular values in astrophysical systems .",
    "systems that do not conserve energy are not physically consistent , and though the variations of energy may be small for some problems , these variations point to deeper underlying problems with those systems of equations .",
    "in particular , the eigenfunctions of the waves are significantly different in the non - conservative systems ( e.g. , ans ) from the energy conserving systems ( e.g. , fc and lbr ) , and this is very important for nonlinear transport , mode coupling and wave steepening and breaking . the clear path forward is to ensure that simulations employ anelastic systems of equations that conserve energy ; fortunately this can be done with simple modifications to existing codes .",
    "the route to energy conservation is to modify the momentum equation of the non - conservative systems .",
    "fundamentally the conservation of energy is more physical than the conservation of momentum : there are many physical systems conserve energy instead of momentum , especially those where a very fast restoring force acts to constrain the behavior of the system .",
    "examples of this include inelastic scattering off of rigid boundaries , where momentum changes sign but energy is conserved , and roller coasters on rigid tracks , where the track changes the momentum of the careening roller coaster but not its total energy . in anelastic systems , the fast sound waves provide the rapid restoring force and the divergence constraint embodied in equation  ( [ eq : anelastic continuity ] ) acts analogously to the rigid tracks of the roller coaster , applying a continuous forcing to the system .",
    "fundamentally , this forcing is energy - conserving in the lbr equations but violates energy conservation in the ans equations .    in simulation codes , there are two equivalent paths to convert the ans equations into an energy conserving form identical to the lbr equations .",
    "the first path is by rewriting the equations to exactly match the anelastic lbr equations .",
    "this is done by solving for the reduced pressure @xmath20 instead of the fluctuating pressure @xmath122 , and by converting the buoyancy term to a `` codensity '' where entropy fluctuations @xmath123 contribute to buoyancy but pressure fluctuations do not .",
    "doing so causes the momentum equation to take the following form @xmath327 which is identical to the lbr momentum equation  ( [ eq : ash - lbr momentum ] ) .",
    "the second path to energy conservation is considerably simpler and relies on introducing a correction term into the momentum equation .",
    "generally , energy non - conservation occurs in anelastic systems of equations when the reduced pressure @xmath20 interacts with the background stratification .",
    "the problematic term in the ans momentum equation  ( [ eq : ash momentum pomega ] ) is the @xmath328 term .",
    "we modify the momentum equation to read @xmath329 where the correction term is @xmath330 and where equation  ( [ eq : fixed ash momentum ii ] ) reduces to the lbr momentum equation  ( [ eq : ash - lbr momentum ] ) .",
    "we remind the reader that we have taken @xmath1 , and this sign is incorporated into equation  ( [ eq : f - bvz correction term ] ) . in a code like the ash code , where the intermediate variable @xmath331 is carried around ,",
    "this amounts to changing the equation of state for density fluctuations to @xmath332 equations  ( [ eq : fixed ash momentum i ] ) and ( [ eq : fixed ash momentum ii ] ) are mathematically equivalent , but implementing this second path in a production code like ash requires only a few lines of code and is considerably simpler than re - writing the equations in terms of @xmath20 .",
    "we have implemented both approaches in the ash code , and the two paths to energy conservation give identical results in these test simulations .",
    "the rg equations appear to not conserve energy in any atmosphere that has a temperature gradient .",
    "instead they conserve a pseudo - energy weighted inversely by the background temperature @xmath12 in both stably - stratified radiative zones and in nearly adiabatically - stratified convection zones .",
    "this is an important distinction , as the differences between pseudo - energy conservation and energy conservation can appear in the rg equations even when @xmath292 is small .",
    "instead , what matters is the number of temperature scale heights across the domain .",
    "this can be seen from the rg pseudo - density ( [ eq : rg pseudo density ] ) and the associated pseudo - density scale height @xmath333 where @xmath334 is the number of temperature scale heights .",
    "( compare with eqn  [ eq : n pseudo rho arbitrary ] ) . in the rg equations",
    ", @xmath334 has a similar but opposite role as @xmath292 in the ans equations : increased @xmath334 leads to less pseudo - density stratification . in the solar interior ,",
    "@xmath12 is about @xmath335k near the core , about @xmath336k at the base of the convection zone ( @xmath317 ) and roughly @xmath337k in the upper convection zone ( @xmath338 ) .",
    "this leads to @xmath339 and @xmath340 across the solar radiative zone ( @xmath341@xmath317 ) , and to @xmath342 and @xmath343 across the deep convection zone ( @xmath344@xmath338 ) .",
    "the energy conserving properties of the rg equations could be studied in either a solar interior setting or in a polytropic atmosphere where there is a linear temperature gradient ( e.g. , * ? ? ?",
    "* ) .    as with the ans equations , it is straight - forward to put the rg equations into energy - conserving form . the term that leads to energy non - conservation is the @xmath345 term in equation  ( [ eq : rg momentum pomega ] ) , which arises from a correction term , @xmath346 intended to more correctly capture sub - adiabatic stratifications . if the rg momentum equation were re - written as @xmath347 then these equations would conserve energy , though the frequencies of gravity waves in these equations remain a factor of @xmath95 higher than both the lbr frequencies and the low - frequency branch of the full compressible euler equations .",
    "the source of this remaining disagreement remains unclear .",
    "it would be very interesting to see whether the non - conservation of energy has any impacts on the nature of convection in the rg equations , and on the coupling of convection to stably - stratified regions above and below .",
    "here we have explored how gravity waves in a solar radiative interior may be affected by anelastic treatments .",
    "the boussinesq equations , which we have not considered here , are well known to conserve energy both linearly and nonlinearly , and this indicates that the issue is not the filtering of sound waves alone .",
    "rather , it is the treatment of filtered , subsonic motions in a stratified atmosphere ( in boussinesq treatments the background density is constant ) .",
    "other treatments of subsonic motions , such as the pseudo - incompressible equations and reduced sound speed techniques ( e.g. , * ? ? ? * ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) may similarly not conserve energy , and we would suggest that this be carefully tested . generally , the isothermal atmospheres considered here or similar stably - stratified polytropic atmospheres ( not considered here ) provide simple test cases .",
    "the next paper in this series will consider variations on the pseudo - incompressible equations .",
    "the subsonic dynamics of gravity waves may play an important role within the radiative envelopes in more massive stars , such as main - sequence a- , b- and o - type stars , where convective overshoot drives gravity waves up into a rarifying envelope leading to possible nonlinear wave breaking . taking a cesam model of a @xmath348 a - type star",
    ", we estimate that the entropy change across the radiative envelope is about @xmath349 which is substantially larger than the drop across the solar radiative zone ( eq  [ eq : solar delta s ] ) . over this range of radii ,",
    "@xmath350 and @xmath351 .",
    "though we have focused on stellar interiors , energy conservation within anelastic systems is an important concern for dynamics in any stably - stratified atmosphere , including planetary atmospheres , planetary interiors , and astrophysical accretion disks .",
    "energy conservation in anelastic equations may also play an important role when magnetic fields are included in questions of the dynamics of magnetohydrodynamic instabilities including magnetic buoyancy instabilities @xcite .",
    "conservation of energy remains among the most sacrosanct and useful of principles in the physicist s toolbox .",
    "the principle of energy conservation applies not only to ideal systems but furthermore to fundamentally dissipative or externally driven situations . in the latter scenarios , a time - dependent statement of energy budget replaces the simpler notion of time - constancy of total energy in an isolated ideal system . in all situations",
    ", we believe that one should not tolerate the existence of uncontrolled spurious kinetic sources . for the particular problem of gravity and acoustic waves ,",
    "this principle is more than philosophical .",
    "when examining the gravity and acoustic waves , energy - conserving anelastic models reproduce fully compressible results with much greater fidelity than energy - violating anelastic models ; and this fact produces implications for our understanding of stellar interiors .",
    "our particular work further shows that the existence of a conserved `` pseudo - energy '' does not rescue the energy non - conserving models .",
    "rather , the existence of the pseudo - energy merely indicates why these problems appear to have gone unnoticed in previous simulations .",
    "however , including any nonlinear or dissipative effects leads to the impossibility of even proper pseudo - energy budgeting ; in this case dissipation can even _",
    "inject _ positive pseudo - energy .",
    "there is in short no way around the issue .",
    "our best advice : properly account for energy whenever possible .",
    "we thank mark miesch for his help in implementing the lbr equations in the ash code ( by more difficult path one ) .",
    "we thank matthew browning and allan sacha brun for supplying the cesam a - type star model .",
    "we thank fausto cattaneo for useful discussions about time - stepping errors .",
    "we thank daniel lecoanet , mark rast , eliot quataert and gary glatzmaier for reading this paper and making useful suggestions .",
    "we additionally thank ann almgren , nic brummell , chris jones , jon dursi , keith julien , tami rogers , steve tobias , juri toomre , toby wood and everyone previously thanked for useful discussions while exploring these anelastic equations .",
    "we thank the anonymous referee for their careful read of the paper .",
    "ellen zweibel thanks the department of astronomy at u.  chicago for their hospitality ; a portion of this work was completed there .",
    "benjamin brown is supported in part by nsf astronomy and astrophysics postdoctoral fellowship ast 09 - 02004 .",
    "cmso is supported by nsf grant phy 08 - 21899 .",
    "the simulations were carried out with nsf paci support of nics and tacc .",
    "when analyzing energy conservation properties in the anelastic equations ( section  [ sec : self - adjointness ] ) , the energy equation takes the general form @xmath352 + \\rho_{0}{\\boldsymbol}{u } { { \\boldsymbol}{\\cdot}}{\\boldsymbol}{g } \\ , \\frac { s_{1}}{c_{p } } = rhs , \\label{eq : lhs anelastic momentum}\\ ] ] with kinetic energy density @xmath353 and where @xmath354 is the right hand side ( e.g. , eqns  [ eq : ash energy ] and [ eq : lbr energy-0 ] ) . in equation  ( [ eq : lhs anelastic momentum ] ) ,",
    "the buoyancy work term takes the form @xmath355 .",
    "we put this buoyancy work term into conservative form by using the gravitational potential , @xmath356 and by recognizing the relation @xmath357 using equation  ( [ eq : conservative buoyancy work i ] ) , the left hand side ( eqn .",
    "[ eq : lhs anelastic momentum ] ) can be put into conservative form @xmath358 = rhs\\end{aligned}\\ ] ] where @xmath359 with @xmath109 an arbitrary reference radius ( here the radius of the lower boundary ) and where the entropy profile is monotonic .",
    "the energy defined in equation  ( [ eq : anelastic energy e i ] ) is slightly unusual in that the buoyancy contribution is not quadratic in entropy perturbation @xmath123 .",
    "this can be put in a more familiar quadratic form by first noting that for arbitrary ( possibly nonlinear ) motions @xmath360 where the available potential energy @xmath361 is given by @xmath362 and @xmath363 equations  ( [ eq : quadratic potential energy][eq : dphi / ds0 ] ) let us rewrite equation  ( [ eq : lhs anelastic momentum ] ) as @xmath364   - a{\\boldsymbol}{u}{{\\boldsymbol}{\\cdot}}{\\boldsymbol}{{\\nabla}}\\ln \\left ( \\frac{d\\phi}{d s_{0 } } \\right)= rhs , \\nonumber\\\\ \\label{eq : anelastic energy e i full}\\end{aligned}\\ ] ] where the alternative total energy @xmath365 is @xmath366 and where @xmath162 is given by equation  ( [ eq : pomega hat ] ) .    the left - hand side of equation  ( [ eq : anelastic energy e i full ] ) can be put into conservative form if the condition @xmath367 is satisfied .",
    "this happens under under two different conditions : ( _ i _ ) if @xmath368 is constant , or ( _ ii _ ) we only consider linear perturbations .",
    "if condition ( _ i _ ) is satisfied ( e.g. , in isothermally- or adiabatically - stratified atmospheres ) then equation  ( [ eq : a condition ] ) holds for nonlinear motions as well and systems of equations with @xmath369 will conserve a quadratic potential energy for nonlinear as well as linear motions .",
    "our analytic approach is similar to that in an infinite isothermal atmosphere , except now the wavelike perturbations are expanded in spherical harmonics and the radial eigenfunctions must be solved for .",
    "we take the spherical shell geometry of section  [ sec : bounded geometries ] and take impenetrable boundary conditions at the upper and lower boundary @xmath370 where @xmath371 and @xmath372 ( and see table  [ table : atmospheres ] ) .",
    "analytic eigenfunctions can be found if we consider a simplified atmosphere with constant gravity @xmath1 and constant brunt - visl frequency @xmath60 , and we do so here as well as in the main body of the text .",
    "we begin with the lbr equations . in this system , in a spherical shell geometry , equation  ( [ eq : pomega horizontal divergence ] ) for reduced pressure @xmath20 becomes @xmath373,\\ ] ] where we have used the anelastic continuity equation  ( [ eq : anelastic continuity ] ) . defining @xmath374 and",
    "@xmath375 the momentum equation  ( [ eq : lbr vertical momentum omega ] ) becomes @xmath376 for different @xmath377 the different @xmath378 are orthogonal and this can be used to determine @xmath379 where the vertical wavenumber @xmath67 is normalized by the pressure and density scale height @xmath57 . with equation  ( [ eq : lambda definition ] )",
    "we obtain the dispersion relationship @xmath380    the vertical wavenumber @xmath381 can be approximated as @xmath382 for a spherical shell with lower boundary at @xmath383 and upper boundary at @xmath384 .",
    "exact solutions can be found numerically by solving the problem in terms of bessel functions , with @xmath385                      r^{-3/2 } \\exp{\\left(\\frac{r}{2h}\\right ) } , \\end{gathered}\\ ] ] where @xmath386 and @xmath387 are modified bessel functions of the first and second kind respectively with imaginary index @xmath388 .",
    "the impenetrable boundary conditions at @xmath384 requires that @xmath389 and thus @xmath390 which can be solved by newton s method and using equation  ( [ eq : approximate wavenumber ] ) as an initial guess , yielding @xmath381 .      at this point",
    "the eigenfunctions for the linear ans equations can be found by a simple transformation @xmath391 @xmath392 which leads to @xmath393 and transforms the linearized lbr wave equations  ( [ eq : lbr vertical momentum omega ] ) into the linearized ans wave equations  ( [ eq : ash vertical momentum omega ] ) .",
    "this transformation leads to eigenfunctions of @xmath394                      r^{-3/2 } \\exp{\\left((2\\gamma-1)\\frac{r}{2\\gamma h}\\right)}. \\ ] ] the vertical wavenumbers are found as before by solving @xmath395      the linear rg are already in almost the same form as the lbr equations , except that @xmath396 thus the solutions for radial wavenumber @xmath67 and the radial eigenfunctions are the same as in the lbr equations , but the frequencies @xmath65 are a factor of @xmath95 higher than the brunt - visl frequency .      as defined so far",
    ", the amplitude of the eigenfunctions @xmath397 is a free parameter . in all sets of equations ,",
    "we normalize the eigenfunctions by an amplitude @xmath361 , with @xmath398 r^2 dr } }   { \\int^b_a{\\exp[-\\epsilon r / h ] r^2 dr } } , \\ ] ] where @xmath399 represents the imaginary part of the vertical wavenumber @xmath55 and is @xmath400 this choice of normalization gives the correct amplitude for motions in the different systems of equations when subject to the same initial conditions ( entropy perturbations of fixed initial amplitude ) ; this is how we conduct the 3-d numerical simulations and thus the analytic eigenfunctions shown in section  [ sec : isothermal analytic bounded ] show the same amplitude ordering as the numerical simulations of section  [ sec : ash sims ] ."
  ],
  "abstract_text": [
    "<S> typical flows in stellar interiors are much slower than the speed of sound . to follow the slow evolution of subsonic motions , various sound - proof equations are in wide use , particularly in stellar astrophysical fluid dynamics . </S>",
    "<S> these low - mach number equations include the anelastic equations . </S>",
    "<S> generally , these equations are valid in nearly adiabatically stratified regions like stellar convection zones , but may not be valid in the sub - adiabatic , stably stratified stellar radiative interiors . understanding the coupling between the convection zone and the radiative interior is a problem of crucial interest and may have strong implications for solar and stellar dynamo theories as the interface between the two , called the tachocline in the sun , plays a crucial role in many solar dynamo theories . here </S>",
    "<S> we study the properties of gravity waves in stably - stratified atmospheres . </S>",
    "<S> in particular , we explore how gravity waves are handled in various sound - proof equations . </S>",
    "<S> we find that some anelastic treatments fail to conserve energy in stably - stratified atmospheres , instead conserving pseudo - energies that depend on the stratification , and we demonstrate this numerically . </S>",
    "<S> one anelastic equation set does conserve energy in all atmospheres and we provide recommendations for converting low - mach number anelastic codes to this set of equations . </S>"
  ]
}