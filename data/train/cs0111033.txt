{
  "article_text": [
    "the esrf control systems control 3 accelerators and 32 beamlines .",
    "they have been built using the same technology and are completely compatible .",
    "they were built 10 years ago based on the state - of - the - art technology ten years ago .",
    "this included vme , 10 mhz ethernet , os-9 , solaris , hp - ux , nfs / rpc , motif and c. most of these technologies have not evolved over the last few years . in our search for better tools , support ,",
    "ease of programming , and overall stability and quality we have put all our old technologies to the test .",
    "our main criterium was which technology or tool will allow us to offer users a better control system .",
    "a better control system means one which offers more features to users without losing any of the present good features .",
    "the result of this technology survey was 100 mhz ethernet , vme ( for the existing hardware ) , compactpci ( cpci ) and pci for new hardware , linux as main frontend operating system , windows for commercially supported hardware and software , solaris and gnu / linux as main desktop operating systems , corba / iiop as new network protocol , c++ , java and python as main programming languages .",
    "what does gnu / linux offer that other systems does nt offer ?    1 .",
    "freedom in this context means access to all the source code so that it can be compiled , understood and improved .",
    "an additonal freedom is the freedom from supplier pressure and fees .",
    "2 .   technology we know well ( unix ) and which is conceptually simple to understand and program .",
    "this is an important feature in our case because we need to develop device drivers .",
    "in addition to being easy to understand it is well - documented .",
    "3 .   a rich set of software packages .",
    "almost all known sourceware packages have been developed or ported to gnu / linux .",
    "it is easy to manage in a network environment and has excellent support for all network protocols . because our control systems are distributed over the network this played a strong role in our choice for gnu / linux .",
    "the esrf has over 200 vme crates installed .",
    "this represents an investment of millions of euros as well as many tens of years of work hardware and software development .",
    "any modernization project must take this investment into account .",
    "the modernization foresees two ways to do this - using the motorola cpu s ( mvme-162 ) to run gnu / linux directly or replacing the cpu with a bus extender which allows the vme bus to be controlled from pc running linux / x86 .",
    "this section describes the first option .",
    "the bus extender solution is discussed in the next section .    for linux",
    "/ m68k we use the debian distribution 2.1 .",
    "it can be downloaded from the debian website and is available in source code and binary format .",
    "the standard kernel ( we are running kernel 2.2.10 ) includes the support for the motorola cpu port ( originally done by richard hirst ) .",
    "we run all our linux / m68k crates without harddisk ( diskless ) .",
    "the root disk is nfs mounted readonly .",
    "in addition there is a ram disk for /etc , /dev , /var and /tmp .",
    "this means crates can be switched on / off without risk of losing data nor do we have to do fsck s .",
    "we have rewritten device drivers for all our main vme cards . for many of them",
    "we subcontracted the driver writing for the first version to richard hirst ( later linuxcare ) .",
    "maintenance and further development is now done in house .",
    "client programs communicate with the hardware via the network using taco / tango device servers ( cf .",
    "we use the gnu tools for compiling and debugging ( g++ and gdb ) .",
    "our experience with linux / m68k compared to os-9 ( the commercial operating system we were using previously ) is that it is at least if not more stable , the tcp / ip implementation is more efficient and robust and that it is easy to add new features to our software using standard techniques like multithreading .",
    "the modernization project of the instrument control at the esrf using gnu / linux supports two main hardware platforms : pci / cpci and vme .",
    "the former provides access to the most recent interface boards developed for a highly demanding market , and hence , with better performance / price ratios .",
    "the latter is needed for a gradual transition between the current vme instrumentation and the pci technology .",
    "vme boards can be controlled from a motorola mvme cpu or from a pc through a pci / vme bus extender , both running gnu / linux as os .    as it was said before",
    ", the modernization project also includes the cpci platform , which , in combination of pci / cpci bus extenders , notably increases the flexibility in the hardware configuration .",
    "it is well known that due to the dynamic resource configuration in the pci specification , identical boards are only distinguishable by their slot position in the bus .",
    "most of the drivers available for pci boards enumerate the boards in the same order they are found by the bios / os at boot time .",
    "this means that the board identification number will change when a similar one , situated before in the pci bus structure , is removed . moreover , if we apply the same logic to slave cpci crates , their bus numbers will change when another is removed . to solve this problem",
    "a differentiation between physical numbers , those used by the drivers , and logical numbers used by applications is made .",
    "the mechanism responsible to make this mapping keeps track of the boards present in the system and detects any change in the bus configuration .",
    "any non - trivial change is informed to the user , avoiding wrong addressing to the boards .",
    "the position of the boards are presented to the user in terms of chassis and slot , which are translated to pci device numbers by hardware specific mappings .",
    "setups based on the pci architecture have been mounted using both a desktop pc and an industrial pc that implements the picmg standard .",
    "remote vme crates are controlled through sbs technologies pci / vme bus extenders , and cpci crates are directly linked to the main pci bus by means of national instruments mxi-3 pci / cpci / pxi bus adapters .",
    "these adapters expand by a large factor the amount of hardware that can be managed by a single host .",
    "furthermore , both mvme and pci gnu / linux can independently control boards in the same crate , providing even more possibilities for the vme - pci transition .",
    "in order to use the same device driver codes in both systems , an interface layer was implemented to manage i / o addresses and irqs , taken from the module parameters at load time . in the bus coupler configuration , this interface does the necessary pci to vme address mappings during the initialization of the vme board drivers , allowing boards on different ( remote ) vme buses to be controlled from the same host as local .",
    "this interface also exports automatically the state and configuration of each board to the /proc virtual file system .    in experiment automation",
    "it is often very useful to record the value of several magnitudes when an event occurs .",
    "such an event can be generated by a hardware signal or by a software condition . to provide this functionality a buffering mechanism",
    "was developed in the kernel , named hook after a similar facility developed at the esrf for os/9 drivers , which hooks data on hardware interrupts .",
    "the values to be written in the buffer are run - time configurable by specifying the driver name , the board and the channel to be read .",
    "each driver that can export its channels will register with the hook module during initialization . when an application wants to read one of its channels",
    ", the hook asks for the necessary actions to be done .",
    "if the actions are just simple register read / write operations ( one single read is very common ) , they are returned in the form of a `` program '' . otherwise ,",
    "if the process is more complicated , a pointer to a function is saved .",
    "one source of hook events is a timer provided by the hook itself , which attaches to the system software timer , and hence has a minimum repetition period of 10 ms on standard installations .",
    "higher rates can be achieved with hardware interrupts generated by counter / timer boards like the esrf vct6 .",
    "not all the boards allow a fast reading of their registers , and the system should not wait in an interrupt handler ( actually a bottom half handler ) .",
    "this problem can be overcome with an asynchronous buffer writing , as long as it is done before the next event arrives .",
    "finally , the hook buffer can be filled in linear mode , which stops acquisitions when the end of the buffer is reached , or in circular mode for continuous measurement .",
    "the device drivers are the first layer in our control system architecture .",
    "the second layer is called the _ device server _ layer and provides transparent network access .",
    "this means hardware can be shared transparently between geographically separated parts of the accelerator and/or beamline , thereby adding a layer of flexibility which would otherwise not be available ( except by recabling ) .",
    "the device servers at the esrf are of two flavours .",
    "the original flavour called taco uses the onc / rpc as network protocol and is a lightweight protocol .",
    "it has the advantage that the onc / rpc runs everywhere where nfs runs .",
    "the second flavour called tango is based on corba and uses the iiop protocol for the network layer .",
    "corba is slightly more heavyweight compared to onc / rpc but offers more high - level services .",
    "both flavours of device servers offer synchronous , asynchronous and event - driven communication paradigms and a database for permanent storage . a large number ( hundreds ) of device servers",
    "have been written at the esrf and other sites ( frm ii , lure , hartrao ) .",
    "refer to the websites for more information .",
    "the challenge we are facing with the modernization of the control system is not only to be able to provide the best combination of operating system+hardware , but also to be able to do the system administration of the system installed all over the site .",
    "administration means two important things :    * quick recovery of a system after a failure . *",
    "new release of the system .",
    "our present control system is based on vme / os9 diskless systems .",
    "these os9 systems are served by bootp servers which give them an identity and then downloads the kernel onto the vme crate at startup .",
    "the vme crates then mounts all the same remote file system using nfs .",
    "thus , for example if a cpu fails we have just to change it and press the on button . this type of action takes less than 15 minutes .    with the modernized control system ,",
    "bootp technique is replaced with dhcp which is based on bootp but has more powerful features . in this way",
    "dhcp allows for dynamic allocation of the network address .",
    "the compact pci crates that are being installed are equipped with a hard disk .",
    "it is inconceivable to think that numerous systems that will be running in the future have each their own configuration . in this case",
    "it should be almost impossible to do the system administration and to provide a good service to the users of these systems .",
    "the decision was taken to do a base system and to duplicate it as many time as it will be needed .",
    "this technique is also called `` cloning '' .",
    "the esrf has bought a commercial product called rembo ( for remote boot ) .",
    "this tool is able to deal with dhcp technology to give a network identity to a client that broadcasts a dhcp request .",
    "moreover this tool can be used to make a base image of any system ( linux / windows ) and to upload that image on a computer on which a rembo server has been installed .",
    "rembo is a cloning tool and a backup utility as well .",
    "the administration of the compact pci can be improved with the capability of rembo to do differential image .",
    "we use this feature to manage different hardware configuration starting from a base system .",
    "for example the crates dedicated to vacuum and the crates dedicated to the front end system have the same base hardware ( same crate , same cpu , network card ) and therefore will have the same base image ( same operating system , network drivers , etc . ) .",
    "but since these crates do not have the same i / o boards installed a differential image for each type of hardware configuration will be made . in case of failure ( crash of the hard disk ) the tool will be able to rebuild the whole system from the base image and the differential one .",
    "we have long had the need for handheld portable controllers for motors , and other hardware which need local tuning far from the control room . enter the new generation of handheld devices , wireless ethernet and linux .",
    "we have used the ipaq from compaq running gnu / linux and an x11 based client ( labview for example ) to control motors remotely using a simple one - click interface .",
    "the fact of choosing gnu / linux makes the task of network and graphical display much easier than if we were using windows ce for example .",
    "_ `` linux is nt realtime '' .",
    "_ this is true therefore we do not claim to do any realtime with gnu / linux .",
    "however we have found that for our applications we need little or no realtime .",
    "most realtime needs are delegated to hardware or dsp s . where we do need soft realtime ( i.e. 99% guarantee ) we use interrupt routines in device drivers .",
    "we measured an interrupt response time of @xmath0 for linux on 68k and x86 . using",
    "a driver interrupt routine we achieve a soft realtime response of @xmath1 for a function generator ( providing we do not recompile the kernel at the same time ! ) . for the rest of our applications _",
    "`` as - fast - as - possible '' _ is good enough . and",
    "for that gnu / linux on commodity hardware is surprisingly good .",
    "gnu / linux is not without problems .",
    "the main problems we have identified so far are :    * the standard gnu / linux distributions are not easily adapted to running on diskless systems * most commercial hardware does not have gnu / linux drivers but windows drivers",
    "there is a viable alternative to windows 95/98/me , nt/2000/ce / xp for building control systems and it is called gnu / linux ! linux is sufficiently mature for the task and even offers some advantages i.e. it is easier to program , is better adapted to distributed control and is free of commercial pressure ."
  ],
  "abstract_text": [
    "<S> the esrf control system is in the process of being modernised . </S>",
    "<S> the present control system is based on vme , 10 mhz ethernet , os9 , solaris , hp - ux , nfs / rpc , motif and c. the new control system will be based on compact pci , 100 mhz ethernet , linux , windows , solaris , corba / iiop , c++ , java and python . </S>",
    "<S> the main frontend operating system will be gnu / linux running on intel / x86 and motorola/68k . </S>",
    "<S> linux will also be used on handheld devices for mobile control . </S>",
    "<S> this poster describes how gnu / linux is being used to modernise the control system and what problems have been encountered so far . </S>"
  ]
}