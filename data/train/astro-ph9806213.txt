{
  "article_text": [
    "the tree algorithms @xcite are now widely used in astrophysical community . for astrophysical simulations ,",
    "the tree algorithms are particularly suitable because of the adaptive nature of the algorithm .",
    "however , the use of tree algorithms in astrophysics has been limited to problems with relatively short timescales , such as collisions of two galaxies or large scale structure formation of the universe .",
    "this is mainly because of the high calculation cost associated with high - accuracy calculation .",
    "existing implementations of barnes - hut treecode use only up to quadrupole moment .",
    "therefore the calculation cost rises rather quickly when high accuracy is required .    as in the case of the fast multipole method ( fmm ) @xcite ,",
    "it is possible to implement higher order multipole expansion to achieve high accuracy .",
    "however , the translation formulae for multipole expansion are rather complex and difficult to program .    in this paper ,",
    "we describe a new method of implementing fmm or tree method with high order multipole expansion .",
    "the basic idea is extremely simple . in the multipole expansion , we approximate the potential field generated by a clump of particles by multipole expansion .",
    "we approximate the potential field back again by a distribution of particles .",
    "this approximation offers many advantages over traditional fmm which uses the coefficients of multipole expansion themselves . in this paper",
    "we describe the basic idea and formulae in two and three dimensions , and discuss the relation between the proposed method , traditional fmm , and anderson s method @xcite which is closely related to the the proposed method .    this paper is organized as follows . in section [",
    "sect : fmm ] , the basic structure of the tree algorithm and fmm are summarized . in section [",
    "sect : ppmm ] , the mathematics of the new method is presented in two and three dimensions . in section [",
    "sect : test ] , the result of some numerical tests for the truncation error is presented .",
    "section [ sect : discussion ] is for discussions and section [ sect : conclusion ] sums up .",
    "the basic idea of the tree algorithm is to replace the gravitational forces from distant particles with the force from their center of mass , or with multipole expansion if high accuracy is desired .",
    "particles are organized into an octree structure , with the root node covering the entire system and leafs corresponding to each particles .",
    "the force on a particle from a node is defined ( and calculated ) recursively . if the node and particle are well separated ( in terms of the error of the multipole expansion ) ,",
    "the force from the node to the particle is calculated by evaluating the multipole expansion of the node at the location of the particle .",
    "if they are not well separated , the force is evaluated as the sum of the forces from children of the node .",
    "the calculation cost of the force on one particle is @xmath2 , since the cost is proportional to the number of levels of the tree .    in order to use the mutipole expansions of the nodes",
    ", they must be precomputed .",
    "the expansion coefficients for a node can be recursively calculated from those of children nodes .",
    "the calculation cost of this part is @xmath0",
    ".    for details of implementation , see @xcite .",
    "@xcite describes the implementation of the tree algorithm on distributed - memory parallel computers .      in the tree algorithm , the particles which generate the gravitational potential and the particles which feel the potential are not symmetric",
    "the particles which generate potential are treated as clumps whenever possible .",
    "however , calculations of the forces on two particles are totally independent , even though the two particles are in small distance .",
    "the basic idea of fmm ( fast multipole method , @xcite ) is to locally expand the potential field and use that expansion to obtain the forces on multiple particles .",
    "figure [ fig : treeandfmm ] shows the relation between the tree algorithm and fmm .",
    "10 cm    10 cm    since neighboring particles share the same expansion , the scaling of the calculation cost changes from @xmath1 of the tree algorithm to @xmath0 .",
    "however , for similar accuracy , the actual calculation cost of fmm is significantly higher than that of tree algorithm , even for very large number of particles .",
    "@xcite    the fundamental reason for the relatively high cost of fmm is that the scaling with the order of the expansion is different . in three dimensions ,",
    "the calculation cost of the tree algorithm is @xmath3 , where @xmath4 is the order of the multipole expansion .",
    "the number of independent terms of the spherical harmonics of order @xmath4 is @xmath5 .",
    "since the evaluation of terms can be done using recurrent relation , the calculation cost is proportional to the number of terms . on the other hand ,",
    "the calculation cost of fmm is @xmath6 , since the translation of the multipole expansion to the local expansion requires the calculation cost proportional to the square of the number of terms .    of course",
    ", it is possible to reduce this @xmath6 scaling to @xmath3 , by increasing the number of particles at the lowest cell .",
    "also , it is possible to apply fft to the translation @xcite to reduce @xmath6 scaling to @xmath7 . when these two are combined , the resulting scaling is @xmath8 .",
    "however , it should be noted that fft is advantageous only for very large values of @xmath4 .",
    "even for pretty large values of @xmath4 , the gain by fft does not exceed a factor of two .",
    "in addition , fft works fine for non - adaptive variant of fmm , but might not work so well for an adaptive version .      at present",
    ", fmm does not offer clear advantage in performance compared to the tree algorithms .",
    "one of the reason is that the mathematics used in fmm is much more complex and therefore it is more difficult to implement fmm than to implement the tree algorithm . as a result ,",
    "relatively small number of implementations exist for fmm .",
    "these implementations are not widely used and not very highly optimized .",
    "since fmm is a complex algorithm , there are many small places which can easily lead to rather large inefficiency .",
    "the tree algorithm is much simpler and therefore easier to achieve high efficiency .",
    "anderson @xcite proposed an alternative formulation of fmm which is based on poisson s formula . in two dimensions ,",
    "the gravitational potential outside a disk of radius @xmath9 containing particles is expressed as @xmath10ds , \\label{eq : poissonorg2d}\\ ] ] where @xmath11 is the gravitational constant , @xmath12 is the total mass of the particles in the disk , @xmath13 is the position in polar coordinate .",
    "this formula gives the solution of the boundary value problem of the laplace equation .    in order to use formula ( [ eq : poissonorg2d ] ) as an replacement of the multipole expansion , the integral must be replaced by some numerical quadrature .",
    "the `` best '' method for the numerical integration over a circle is to distribute the points in equal spacing and sum the values on these points with equal weights .",
    "when we use @xmath14 points to sample potential , the integration should give exact values for @xmath4-th order terms in multipole expansion .",
    "note that the @xmath4-th term in the multipole expansion corresponds to @xmath4-th term in the fourier expansion of the potential on the circle @xmath15 .",
    "anderson found that the naive use of the numerical quadrature in combination with formula ( [ eq : poissonorg2d ] ) gives unacceptable result .",
    "the reason is that finite number of sampling points introduces fictitious high - frequency terms in fourier components . in order to suppress high - frequency terms",
    ", we should truncate the multipole expansion at order @xmath4 .",
    "in other words , formula ( [ eq : poissonorg2d ] ) should be replaced by @xmath16ds , \\label{eq : poissonmod2d}\\end{aligned}\\ ] ]    with this modification , anderson successfully used poisson s formula to implement fmm .",
    "the local expansion can also given in a similar form .",
    "in three dimensions , the outer and inner expansions are given by @xmath17\\psi(a\\bs ) ds , \\label{eq : outerpoison3d}\\ ] ] and @xmath18\\psi(a\\bs ) ds , \\label{eq : innerpoison3d}\\ ] ] in actual implementation , the infinite sum must also be truncated at the order of the integration scheme used .    in two dimensions ,",
    "the trapezoidal rule is optimum and is directly related to the fourier expansion .",
    "however , in three dimensions , the way to assign points on a sphere is not unique .",
    "anderson followed the formula given in @xcite , which claims to have constructed 5th , 7th , 9th , 11th and 14th order integration formulae with 12 , 24 , 32 , 50 and 72 points . recently ,",
    "hardin and sloane @xcite suggested a complete set of the achievable orders for integration schemes with up to 100 points .",
    "they called an integration schemes which achieved order @xmath19 as @xmath19-designs .",
    "table [ tab : hardinsloane ] gives the summary of their result .",
    "note that a @xmath20-th order scheme ( @xmath20-design ) can express spherical harmonics of the order only up to @xmath21 @xcite .",
    "24 pt plus 1 pt minus 2 pt    .number of points @xmath22 and achievable order @xmath20 [ cols=\"^,^,^,^,^,^,^,^,^,^,^,^,^,^ \" , ]     [ tab : hardinsloane ]    for orders 2 , 3 and 5 , the corresponding distributions of points are the vertices of tetrahedron(@xmath23 ) , octahedron(@xmath24 ) and icosahedron ( @xmath25 ) .",
    "blackston and suel @xcite implemented both the classical fmm and anderson s method , and found that for similar accuracy the latter is faster typically by a factor of few .    the most significant practical advantage of anderson s method is the ease of the implementation .",
    "the classical fmm in three dimensions requires rather complex formulas to be implemented for the shifting the center of the the multipole expansion ( `` m2 m '' part ) , translation of the multipole expansion to local expansion ( `` m2l '' part ) and shifting the center of the local expansion ( `` l2l '' part ) . in anderson s method ,",
    "all shiftings and translations are realized by evaluating the potential on the sample points on the sphere .",
    "thus , all mathematics are confined into formulae ( [ eq : innerpoison3d ] ) and ( [ eq : outerpoison3d ] ) .",
    "in anderson s method , the multipole expansion of the potential due to a clump of particles is effectively expressed in terms of the values of potentials on a sphere surrounding the particles . the potential outside the sphere",
    "is given by the surface integral on that sphere , which is then approximated by the sum over sampling points .",
    "this method , though elegant , appears to be rather indirect .    an alternative approach would be to use multiple particles to represent the multipole expansion .",
    "the basic idea here is to place small number of pseudoparticles which reproduce the multipole expansion of the original physical particles . in the following ,",
    "i first present the theory in two dimensions , and then that in three dimensions .      in two dimensions ,",
    "the multipole expansion of the gravitational field due to one particle is given by @xmath26 where @xmath27 and @xmath28 are position of the particle and position at which to evaluate the potential in the complex plane , and @xmath29 is the mass of the particle . here",
    "we use the system of units where the gravitational constant @xmath11 is unity .",
    "this formula converges if @xmath30 .",
    "if we have @xmath31 particles with mass @xmath32 at locations @xmath33 ( @xmath34 ) , the potential field outside the circle of radius @xmath9 is expressed as @xmath35 where @xmath12 is the total mass of particles and @xmath36 is defined as @xmath37    our goal is to find an efficient way to place @xmath22 pseudoparticles to approximate the potential field @xmath38 . in theory",
    ", the total number of freedoms we can attain with @xmath22 particles is @xmath39 .",
    "therefore , with arbitrary assignment of mass and position , @xmath22 particles should be able to represent multipole expansions of up to @xmath40 $ ] , where @xmath41 $ ] denotes the maximum integer which does not exceed @xmath42 .",
    "however , in order to determine such an arbitrary distribution of pseudoparticles , we have to solve the system of nonlinear equations with @xmath14 variables , and the calculation cost would be at least @xmath43 .",
    "in addition , it is not clear whether or not an acceptable solution exists . in the following ,",
    "we describe a more systematic approach in which we do not have to solve nonlinear equations .    in anderson s method , potential is calculated at equispaced points on a circle . in the same splits , here",
    "we place particles in a ring , and only allow the masses of particles to change .",
    "this implies that we use only @xmath22 out of @xmath39 degrees of freedoms , and we need @xmath14 particles to express the multipole expansion coefficients .",
    "however , with this choice we can determine the mass of these @xmath14 particles with @xmath3 or @xmath44 calculation cost .",
    "consider the mass distribution of on a ring of radius @xmath45 .",
    "the multipole expansion coefficients is given by @xmath46 where @xmath47 is the line density of mass at polar coordinate @xmath13 .",
    "thus , from the expansion coefficients @xmath36 , @xmath48 can be calculated by evaluating the fourier series @xmath49 when we approximate this continuous @xmath29 by @xmath14 discrete points at @xmath50 , @xmath51 is given by @xmath52    because of the nature of the fourier series , these @xmath32 express exact values of multipole expansions up to @xmath4-th order . the potential outside this circle",
    "can be calculated as the sum of the potentials by these particles as @xmath53 where @xmath54 .    in the case of the tree algorithm , we can use eq .",
    "( [ eq : ppmm2d ] ) to calculate the gravitational interaction between a node and a particle",
    ".    in the m2 m part , which is the same for both the tree algorithm and fmm , we still have to construct the multipole expansion or particle representation around the center of a node from those of the child nodes .",
    "since the child nodes are already represented by particles , we can use eq .",
    "( [ eq : mp2d ] ) to obtain the expansion coefficients of the parent node .",
    "alternatively , we can eliminate the use of multipole expansion coefficient by calculating the mass of pseudoparticles directly from mass of physical particles ( or the mass of the pseudoparticles in child nodes ) .",
    "we can derive the formula to calculate @xmath51 directly from @xmath32 by combining eqs .",
    "( [ eq : mp2d ] ) and ( [ eq : mp2d_ifft ] ) @xmath55    in the case of fmm , we still have to specify the algorithms for m2l part and l2l part .",
    "we can use either anderson s method or standard harmonic expansion . for local expansion ,",
    "anderson s method is simpler to implement than the spherical harmonics .",
    "the formulation for three dimensions is essentially the same as that for two dimensions , except that we need to use spherical harmonics instead of @xmath56 .",
    "the expansion coefficients @xmath57 is expressed as @xmath58 where @xmath32 is the mass of particle @xmath59 and @xmath60 is its polar coordinate .",
    "the function @xmath61 is the spherical harmonics of degree @xmath62 , which is expressed as @xmath63 here , @xmath64 is the associated legendre function of degree @xmath62 and order @xmath29 . using these @xmath57 , the potential at position @xmath65",
    "is given by @xmath66    our goal here is to obtain a mass distribution @xmath67 on a sphere of radius @xmath9 which satisfy @xmath68 where @xmath69 denotes the surface of the sphere .",
    "because the spherical harmonics comprise an orthonormal system , this @xmath47 is expressed as @xmath70    if we use @xmath22 points on a sphere , their masses are calculated by @xmath71 the series expansion must be truncated at a finite value as we ve seen in the case of two dimensions . as discussed by anderson @xcite , the cutoff order must be @xmath72 $ ] , if @xmath22 points form a spherical @xmath19-design .    as in the case of two dimensions , we can directly translate the positions and masses of physical particles to that of pseudoparticles .",
    "the formal expression is a triple summation over @xmath59 , @xmath62 , and @xmath29 .",
    "however , we can simplify it using the addition theorem of spherical harmonics .",
    "the addition theorem is @xmath73 where @xmath74 is the angle between two vectors with directions @xmath75 and @xmath76 . using this addition theorem ,",
    "@xmath51 is expressed as @xmath77 where @xmath74 is the angle between the direction of physical particle @xmath59 and pseudoparticle @xmath78 .",
    "the potential due to physical particles is approximated by the sum of potentials due to these pseudoparticles .",
    "figure [ fig : errors ] shows the decay of the error in two dimensions , for various choices of expansion order and geometry .",
    "here we calculate the absolute error in the potential between two particles .",
    "one is localed at @xmath79 .",
    "the other is located at @xmath13 , where @xmath45 is varied from 1 to 10 in each panel and @xmath80and @xmath81 for four panels , respectively . as is clearly seen , for all cases",
    "the new method achieves the theoretical order .",
    "it s error is slightly larger that thar of direct evaluation of multipole expansion , but the difference is small .",
    "+    note that we could make the result obtained by the new method to be identical to the direct evaluation of multipole expansion , by truncation the pairwize potential to the order of the integration scheme @xmath4 .",
    "however , the result shown in figure [ fig : errors ] suggests such trancation is unnecessary .",
    "one practical problem is how we chose the radius of the ring .",
    "though the expansion is exact up to order @xmath4 , a ring of finite number of particles and finite radius has spurious high - order multipole moment .",
    "therefore , in order to make the truncation error small , we should make the radius as small as possible . on the other hand ,",
    "as we make the radius @xmath45 smaller , the absolute values of the masses of particles diverge as @xmath82 , since this factor directly enters into the inverse transformation . therefore ,",
    "if we make @xmath45 too small , the round off error would increase rapidly . in practice",
    ", the choice of @xmath83 makes the spurious high - order terms sufficiently small , without noticeable effect on the round - off error . for the result shown in figure [ fig : errors ] we used @xmath84 .",
    "the error is not sensitive to the choice of @xmath45 , unless the required accracy is very high .",
    "our pseudoparticle method and anderson s method are quite similar .",
    "both approximate the multipole expansion by a function on a circle ( two dimensions ) or a sphere ( three dimensions ) .",
    "the difference is that the value of potential is used in anderson s method and the mass distribution itself is used in our method .",
    "both the potential and mass distribution are formally defined by the inverse transform from the multipole expansion .",
    "the only difference lies in the multiplication factor applied in the inverse transform .",
    "one practical advantage of our method is that the calculation of the m2l part , which is known to be the dominant part of the computation , is significantly simpler for our method .",
    "therefore , the overall calculation speed for the same expansion order would be faster for our method .",
    "if we view anderson s method as one way of expressing the multipole expansion , it seems clear that there is a room for improvement in the original formulation by anderson . in the first transform from physical particles to the values of potential on the outer ring",
    ", he used the @xmath85 ( or @xmath86 ) potential without truncation .",
    "this treatment naturally introduces fictitious high - frequency terms in the potential on the ring .",
    "this is the reason why he had to carefully chose the radius of the ring to suppress the high - order terms .",
    "these high - order terms contaminate the values of potential itself through aliasing , unless we make the radius of the ring sufficiently large . on the other hand ,",
    "if we make the radius of the ring too large , the solution inside the ring tends to be quite inaccurate .",
    "if we use the truncated form of the potential for the first conversion , the values of potential on the ring always represent exact values of the multipole expansion , for any choice of the radius of the ring . thus , such choice should improve the accuracy of anderson s method significantly , without increasing the calculation cost .    in our method ,",
    "untruncated potential is used in m2l part .",
    "this also introduce the high - order terms which are not in the original multipole expansion .",
    "however , this does not cause much degradation in accuracy , since here it is guaranteed that the contribution of the high - order terms is small .",
    "our group has developed a series of special - purpose computers for @xmath31-body problem @xcite .",
    "the basic function of these machines is to evaluate and accumulate the gravitational interaction between particles .",
    "though a modified version of the tree algorithm has been implemented on these machines @xcite , previously only the monopole ( effectively dipole ) approximation could be used , since the hardware could only calculate the interaction between point particles .    in our pseudoparticle method ,",
    "the high order expansion is expressed by means of particles , which means we can use the special - purpose hardware to evaluate high order expansion .",
    "our pseudoparticle method combined with special - purpose hardware will provide a very large speed advantage over fmm or tree algorithms on general - purpose computer .      as we discussed in section [ sect : ppmm2d ] , the present implementation uses rather large number of particles to represent the multipoles .",
    "this is because we put a stringent restriction to the placement of particles : we fix the positions and only vary the mass of particles .",
    "this restriction makes it possible to obtain the mass of particles using linear convolution .",
    "however , this is certainly not optimal .",
    "for example , it is clear that a monopole can be exactly expressed by one particle , while our method require two . in the case of gravitational potential , a dipole term can also be expressed by one particle placed at the center of mass , while our method requires four .",
    "a quadrupole can be expressed by four particles , while out method requires 12 .",
    "for these low - order expansions , it would be relatively easy to obtain the location of particles without actually solving the nonlinear equation .    for orders higher than 2 , the calculation cost of solving the nonlinear equation would be too high .",
    "in this paper i present a new representation of the multipole expansion used in tree algorithm and fmm . in the new method , gravitational field due to the multipole expansion is approximated by the potential due to a set of pseudoparticles on a ring or a sphere .",
    "the new method is quite similar to anderson s method , which uses the value of potential itself on a ring .",
    "however , compared to anderson s original algorithm , the new method is more accurate for the same number of points .    on a general - purpose computer",
    ", the performance of the new method and anderson s method would be practically the same .",
    "however , when combined with special - purpose computers , the new method offers a huge advantage , since the evaluation of the multipole expansion can be done on a hardware which is specialized to the calculation of the interaction of point particles .",
    "l.  greengard and v.  rokhlin , rapid evaluation of potential fields in three dimensions . in _ vortex methods ,",
    "1360 in lecture notes in mathematics , _ edited by c. anderson and c. greengard , ( springer - verlag , berlin 1988 ) , p. 121"
  ],
  "abstract_text": [
    "<S> in this paper we describe a new approach to implement the @xmath0 fast multipole method and @xmath1 tree method , which uses pseudoparticles to express the potential field . </S>",
    "<S> the new method is similar to anderson s method , which uses the values of potential at discrete points to represent the potential field . </S>",
    "<S> however , for the same expansion order the new method is more accurate and computationally efficient .    submitted to : _ journal of computational physics _ </S>"
  ]
}