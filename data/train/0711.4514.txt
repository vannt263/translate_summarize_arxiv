{
  "article_text": [
    "let @xmath0 be a @xmath1-valued random variable and @xmath2 a measurable function such that @xmath3 .",
    "we are interested in the computation of @xmath4 using a stratified sampling monte - carlo estimator .",
    "we suppose that @xmath5 is a partition of @xmath6 into @xmath7 _ strata _ such that @xmath8 $ ] is known explicitely for @xmath9 . up to removing some strata ,",
    "we assume from now on that @xmath10 is positive for all @xmath9 .",
    "the stratified monte - carlo estimator of @xmath11 ( see @xcite p.209 - 235 and the references therein for a presentation more detailed than the current introduction ) is based on the equality @xmath12 where @xmath13 denotes a random variable distributed according to the conditional law of @xmath0 given @xmath14 . indeed ,",
    "when the variables @xmath13 are simulable , it is possible to estimate each expectation in the right - hand - side using @xmath15 i.i.d drawings of @xmath13 .",
    "let @xmath16 be the total number of drawings ( in all the strata ) and @xmath17 denote the proportion of drawings made in stratum @xmath18",
    ".    then @xmath19 is defined by @xmath20 where for each @xmath18 the @xmath21 s , @xmath22 , are distributed as  @xmath13 , and all the @xmath21 s , for @xmath23 , @xmath22 are drawn independently .",
    "this stratified sampling estimator can be implemented for instance when @xmath0 is distributed according to the normal law on @xmath1 , @xmath24 where @xmath25 and @xmath26 is such that @xmath27 .",
    "indeed , then one has @xmath28 with @xmath29 denoting the cumulative distribution function of the one dimensional normal law and it is easy to simulate according to the conditional law of @xmath0 given @xmath30 ( see section [ ssopt ] for a numerical example in the context of options pricing ) .",
    "we have @xmath31 and @xmath32 where @xmath33 for all @xmath23 .    during all the sequel we consider that @xmath34    the brute force monte carlo estimator of @xmath35 is @xmath36 , with the @xmath37 s i.i.d .",
    "drawings of @xmath0 .",
    "its variance is @xmath38    for given strata the stratified estimator achieves variance reduction if the allocations @xmath15 or equivalently the proportions @xmath39 are properly chosen .",
    "for instance , for the so - called proportional allocation @xmath40 , @xmath41 , the variance of the stratified estimator is equal to the previous lower bound of the variance of the brute force monte carlo estimator . for the choice @xmath42 the lower - bound in is attained .",
    "we speak of _ optimal allocation_. we then have @xmath43 and no choice of the @xmath39 s can achieve a smaller variance of @xmath19 .    in general when the conditional expectations @xmath44 are unknown , then so are the conditional variance @xmath45",
    ". therefore optimal allocation of the drawings is not feasible at once .",
    "one can of course estimate the conditional variances and the optimal proportions by a first monte carlo algorithm and run a second monte carlo procedure with drawings independent from the first one to compute the stratified estimator corresponding to these estimated proportions .",
    "but , as suggested in @xcite in the different context of importance sampling methods , it is a pity not to use the drawings made in the first monte carlo procedure also for the final computation of the conditional expectations .    instead of running two successive monte carlo procedures , we can think to get a first estimation of the @xmath46 s , using the first drawings of the @xmath13 s made to compute the stratified estimator .",
    "we could then estimate the optimal allocations before making further drawings allocated in the strata according to these estimated proportions .",
    "we can next get another estimation of the @xmath46 s , compute again the allocations and so on .",
    "our goal is thus to design and study such an _ adaptive stratified estimator_. the estimator is described in section [ sec_algo ] . in particular , we propose a version of the algorithm such that at each step , the allocation of the new drawings in the strata is not simply proportional to the current estimation of the optimal proportions but chosen in order to minimize the variance of the stratified estimator at the end of the step .",
    "a central limit theorem for this estimator is shown in section [ sec - vit ] .",
    "the asymptotic variance is equal to the optimal variance @xmath47 and our estimator is asymptotically optimal . in section [ snum ] , we confirm the efficiency of our algorithm by numerical experiments .",
    "we first deal with a toy example before considering the pricing of an arithmetic average asian option in the black - scholes model .",
    "another stratified sampling algorithm in which the optimal proportions and the conditional expectations are estimated using the same drawings has been very recently proposed in @xcite for quantile estimation .",
    "more precisely , for a total number of drawings equal to @xmath48 , the authors suggest to allocate the @xmath49 with @xmath50 first ones proportionally to the probabilities of the strata and then use the estimation of the optimal proportions obtained from these first drawings to allocate the @xmath51 remaining ones .",
    "their stratified estimator is also asymptotically normal with asymptotic variance equal to the optimal one . in practice",
    ", @xmath48 is finite and it is better to take advantage of all the drawings and not only the @xmath49 first ones to modify adaptively the allocation between the strata .",
    "our algorithm works in this spirit .",
    "the construction of the adaptive stratified estimator relies on steps at which we estimate the conditional variances and compute the allocations .",
    "we denote by @xmath52 the total number of drawings made in all the strata up to the end of step  @xmath53 . by convention , we set @xmath54 . in order to be able to make one drawing in each stratum at each step we assume that @xmath55 for all @xmath56 .    for all @xmath23",
    "we denote by @xmath57 the number of drawings in stratum @xmath18 till the end of step @xmath53 with convention @xmath58 .",
    "the increments @xmath59 s are computed at the beginning of step @xmath53 using the information contained in the @xmath60 first drawings .",
    "_ computation of the empirical variances .",
    "_    if @xmath61 , for all @xmath23 compute @xmath62 if @xmath63 , set @xmath64 for @xmath23 .    _ computation of the allocations @xmath59 .",
    "_    we make at least one drawing in each stratum .",
    "this ensures the convergence of the estimator and of the @xmath65 s ( see the proof of proposition [ conv ] below ) .    that is to say we have , @xmath66 and we now seek the @xmath67 s .",
    "we have @xmath68 , and possibly @xmath69 for some indexes .",
    "we present two possible ways to compute the @xmath67 s .",
    "_ a ) _ we know that the optimal proportion of total drawings in stratum @xmath18 for the stratified estimator is @xmath70 , so we may want to choose the vector @xmath71 close to @xmath72 defined by @xmath73 this can be achieved by setting @xmath74 with the convention that the second term is zero for @xmath75 .",
    "this systematic sampling procedure ensures that @xmath76 and @xmath77 for all @xmath23 . in case @xmath78 for all @xmath79 ,",
    "the above definition of @xmath80 does not make sense and we set @xmath81 for @xmath79 before applying the systematic sampling procedure .",
    "note that thanks to @xmath82 and the convergence of the @xmath65 ( see proposition [ conv ] below ) , this asymptotically will never be the case .    _",
    "b ) _ in case @xmath78 for all @xmath79 , we do as before .",
    "otherwise , we may think to the expression of the variance of the stratified estimator with allocation @xmath15 for all @xmath18 , which is given by , and find @xmath83 that minimizes @xmath84 under the constraint @xmath85 .",
    "this can be done in the following manner ( see in the appendix proposition  [ prop - opt ] ) :    for the indexes @xmath18 such that @xmath78 , we set @xmath86 .",
    "we denote @xmath87 the number of indexes such that @xmath88 .",
    "we renumber the corresponding strata from @xmath89 to @xmath87 .",
    "we now find @xmath90 that minimizes @xmath91 , under the constraint @xmath92 , by applying the three following points :    \\i ) compute the quantities @xmath93 and sort them in decreasing order . denote by @xmath94 the ordered quantities .",
    "\\ii ) for @xmath95 compute the quantities @xmath96 denote by @xmath97 the last @xmath18 such that @xmath98    if this inequality is false for all @xmath18 , then by convention @xmath99 .",
    "\\iii ) then for @xmath100 set @xmath101 and for @xmath102 , @xmath103 this quantity is non - negative according to the proof of proposition [ prop - opt ] .",
    "we then build @xmath104 by reincluding the @xmath105 zero valued @xmath106 s and using the initial indexation .",
    "finally we deduce @xmath107 by the systematic sampling procedure described in _",
    "_ drawings of the @xmath13 s .",
    "_ draw @xmath108 i.i.d .",
    "realizations of @xmath13 in each stratum @xmath18 and set @xmath109 .",
    "compute @xmath110    square integrability of @xmath111 is not necessary in order to ensure that the estimator @xmath112 is strongly consistent . indeed",
    "thanks to , we have @xmath113 as @xmath114 and the strong law of large numbers ensures the following proposition .",
    "[ conv ] if @xmath115 , then @xmath116{}c\\quad\\mathrm{a.s .. }\\ ] ] if moreover , @xmath117 , then a.s . , @xmath118{}\\sigma_i\\;\\;\\mbox {    and } \\;\\;\\sum_{i=1}^i p_i\\widehat{\\sigma}_i^k \\xrightarrow[k\\to\\infty]{}\\sigma_*.\\ ] ]",
    "in this section we prove the following result .",
    "[ thm - vit - conv ] assume @xmath82 , @xmath117 and @xmath119 as @xmath114 . then , using either procedure _ a ) _ or procedure _ b ) _ for the computation of allocations , one has @xmath120{\\mathrm{in law } } \\m{nor}(0,\\sigma_*^2).\\ ] ]    with proposition [ conv ] , one deduces that @xmath121{\\mathrm{in law } } \\m{nor}(0,1)$ ] , which enables the easy construction of confidence intervals .",
    "the theorem is a direct consequence of the two following propositions .",
    "[ prop - vit - conv ] if @xmath117 and @xmath122{}q_i^*\\;\\;\\mathrm{a.s.},\\ ] ] then @xmath120{\\mathrm{in law } } \\m{nor}(0,\\sigma_*^2).\\ ] ]    [ convnink ] under the assumptions of theorem [ thm - vit - conv ] , using either procedure _ a ) _ or procedure _ b ) _ for the computation of allocations , holds .",
    "we prove proposition [ prop - vit - conv ] and [ convnink ] in the following subsections .",
    "the main tool of the proof of this proposition will be a clt for martingales that we recall below .",
    "[ clt ] let @xmath123 be a square - integrable @xmath124-vector martingale .",
    "suppose that for a deterministic sequence @xmath125 increasing to @xmath126 we have ,    \\i ) @xmath127{\\m{p}}\\gamma.\\ ] ]    \\ii ) the lindeberg condition is satisfied , i.e. for all @xmath128 @xmath129 \\xrightarrow[n\\to\\infty]{\\m{p}}0.\\ ] ]    then @xmath130{\\mathrm{in law}}\\m{nor}(0,\\gamma).\\ ] ]    as we can write @xmath131 we could think to set @xmath132 and try to use theorem [ clt ] .",
    "indeed if we define the filtration @xmath133 by @xmath134 , it can be shown that @xmath135 is a @xmath136-martingale .",
    "this is thanks to the fact that the @xmath57 s are @xmath137-measurable .",
    "then easy computations show that @xmath138 where @xmath139 denotes the diagonal matrix with vector @xmath140 on the diagonal .",
    "thanks to we thus have @xmath141{\\mathrm{a.s . } } \\mathrm{diag}\\big(\\big(q_1^*\\sigma_1 ^ 2,\\ldots , q_i^*\\sigma_i^2\\big)\\big),\\ ] ] and a use of theorem [ clt ] and slutsky s theorem could lead to the desired result .",
    "the trouble is that lindeberg s condition can not be verified in this context , and we will not be able to apply theorem [ clt ] .",
    "indeed the quantity @xmath142 involves @xmath143 random variables of the type @xmath13 and we can not control it without making some growth assumption on @xmath143 .    in order to handle the problem , we are going to introduce a microscopic scale . from the sequence of estimators @xmath144 we will build a sequence @xmath145 of estimators of @xmath11 , such that @xmath146 , and for which we will show a clt using theorem [ clt ] .",
    "it will be possible because it involves a new martingale @xmath147 such that @xmath148 is equal to a vector the only non zero coordinate of which is _ one _ random variable @xmath149",
    ". then the lindeberg condition will be easily verified , but this time we will have to work a little more to check the bracket condition . as the sequence @xmath144 is a subsequence of @xmath145 , proposition [ prop - vit - conv ] will follow .",
    "this is done in the following way .",
    "let @xmath150 . in the setting of the algorithm of section [ sec_algo ]",
    "let @xmath151 such that @xmath152 .",
    "given the allocations @xmath153 , for @xmath154 , we define for each @xmath23 a quantity @xmath155 with the inductive rule below . each @xmath155 is the number of drawings in the @xmath18-th strata among the first @xmath156 drawings and we have @xmath157 .",
    "we then define    @xmath158    * rule for the @xmath155 s *    for @xmath159 , @xmath160 , for all @xmath23 .    1 .   for @xmath161 set @xmath162 for @xmath23 .",
    "2 .   for @xmath163 , and given the @xmath164 s find @xmath165 if several @xmath18 realize the maximum choose @xmath166 to be the one for which @xmath167 is the greatest .",
    "if there are still ex aequo s choose the greatest @xmath18 .",
    "3 .   set @xmath168 , and @xmath169 if @xmath170 .",
    "there is always an index @xmath18 for which @xmath171 , since @xmath172    moreover , for the first @xmath173 such that @xmath174 in the @xmath18-th strata , @xmath175 and @xmath176 for @xmath177 .",
    "this implies that @xmath178 and as a consequence , @xmath179 therefore proposition [ prop - vit - conv ] is an easy consequence of the following one .",
    "[ thm_main ] under the assumptions of proposition [ prop - vit - conv ] , @xmath180{\\mathrm{in law } } \\m{nor}(0,\\sigma_*^2).\\ ] ]    in the proof of proposition [ thm_main ] , to verify the bracket condition of theorem [ clt ] , we will need the following result .",
    "[ propnu ] when holds , then @xmath181{}q_i^*\\;\\;\\mathrm{a.s.}\\ ] ]    let be @xmath23 . during the sequel , for @xmath182 or @xmath150 ,",
    "the integer  @xmath53 is implicitely such that @xmath183 .",
    "we notice that for any @xmath150 @xmath184 and define for @xmath182 , @xmath185    we will see that , as @xmath156 tends to infinity , @xmath186 tends to @xmath187 and @xmath188 tends to zero .",
    "computing the derivative of @xmath189 on any interval @xmath190 $ ] we find that this function is monotonic on it . besides @xmath191 and @xmath192 .",
    "so if @xmath193 tends to @xmath187 as @xmath53 tends to infinity , we can conclude that @xmath194{}q_i^*.\\ ] ]    as @xmath195 we now write @xmath196 we conclude the proof by checking that @xmath197 indeed , this inequality implies @xmath198 which combined with gives the desired conclusion . we first show @xmath199 we distinguish two cases .",
    "either @xmath200 for all @xmath201 , that is to say no drawing at all is made in stratum @xmath18 between @xmath60 and @xmath156 , then is trivially verified .",
    "either some drawing is made between @xmath60 and @xmath156 .",
    "let us denote by @xmath202 the index of the last one , i.e. we have @xmath203 . as a drawing",
    "is made at @xmath202 we have @xmath204 .",
    "we thus have , @xmath205 and @xmath206 and thus we have again .    using now the fact that @xmath207 we get @xmath208    using this and we get .    for @xmath209 , @xmath210 for all @xmath23",
    "and we can write @xmath211 with @xmath212 note that if @xmath213 for a stratum @xmath18 , then @xmath214 and by lemma [ propnu ] , @xmath215{\\mathrm{a.s.}}+\\infty$ ] which may cause some trouble in the convergence analysis . in compensation",
    ", @xmath213 means that @xmath216 a.s .",
    "thus the component @xmath217 of @xmath218 makes no contribution in @xmath219 .",
    "so we might rewrite with @xmath218 a vector of size less than @xmath7 , whose components correspond only to indexes @xmath18 with @xmath220 . for the seek of simplicity we keep the size @xmath7 and consider that @xmath220 for all @xmath23 .",
    "if we define @xmath221 , then @xmath222 is obviously a @xmath223-martingale . indeed , for @xmath150 let @xmath224 such that @xmath163 . for @xmath23 the variables @xmath225 and @xmath57",
    "are respectively @xmath226 and @xmath227-measurable ( step @xmath61 in the algorithm ) . as for each @xmath23 the quantity",
    "@xmath155 depends on the @xmath225 s and the @xmath57 s , it is @xmath227-measurable .",
    "thus @xmath218 is @xmath228-measurable and easy computations show that @xmath229=\\mu_n$ ] .",
    "we wish to use theorem [ clt ] with @xmath230 .",
    "we will denote by @xmath231 the @xmath232 matrix having null coefficients except the @xmath18-th diagonal term with value  @xmath233 .",
    "we first verify the lindeberg condition .",
    "we have , using the sequence @xmath234 defined in the rule for the @xmath155 s , @xmath235\\\\ \\\\ = & \\frac{\\displaystyle 1}{\\displaystyle n}\\sum_{l=1}^n \\m{esp}\\big[|f(x_{i_l}^{\\nu_{i_l}^l})-\\m{esp}f(x_{i_l})|^2 \\m{ind}_{\\{|f(x_{i_l}^{\\nu_{i_l}^l})-\\m{esp}f(x_{i_l})|>\\varepsilon\\sqrt{n}\\}}|\\m{f}_{l-1 } \\big]\\\\ \\\\ \\leq&\\frac{\\displaystyle 1}{\\displaystyle n}\\sum_{l=1}^n \\sup_{1\\leq i\\leq i}\\m{esp}\\big[|f(x_i)-\\m{esp}f(x_{i})|^2\\m{ind}_{\\{|f(x_i)-\\m{esp}f(x_{i})|>\\varepsilon\\sqrt{n}\\}}\\big]\\\\ \\\\ = & \\sup_{1\\leq i\\leq i}\\m{esp}\\big[|f(x_i)-\\m{esp}f(x_{i})|^2\\m{ind}_{\\{|f(x_i)-\\m{esp}f(x_{i})|>\\varepsilon\\sqrt{n}\\}}\\big].\\\\ \\end{array}\\ ] ]    as @xmath236 \\xrightarrow[n\\to\\infty]{}0,\\ ] ] the lindeberg condition is proven .",
    "we now turn to the bracket condition .",
    "we have , @xmath237\\\\ \\\\ & = & \\sum_{k=1}^n\\mathrm{diag}\\big(\\m{esp } \\big[\\,\\big|f(x_{i_k}^{\\nu_{i_k}^k})-\\m{esp}f(x_{i_k})\\big|^2\\,\\big]\\big)\\\\ \\\\ & = & \\sum_{k=1}^n\\mathrm{diag}\\big(\\sigma_{i_k}^2\\big).\\\\ \\end{array}\\ ] ]    thus , we have @xmath238{}\\mathrm{diag } \\big(\\,(q_1^*\\sigma_1 ^ 2,\\ldots , q_i^*\\sigma_i^2)\\,\\big)\\;\\;\\mathrm{a.s.},\\ ] ] where we have used lemma [ propnu ] .",
    "theorem [ clt ] implies that @xmath239{\\mathrm{in law } } \\m{nor}\\big(0,\\mathrm{diag } \\big(\\,(q_1^*\\sigma_1 ^ 2,\\ldots , q_i^*\\sigma_i^2)\\,\\big)\\big).\\ ] ]    using again lemma [ propnu ] we have @xmath240{}(\\frac{p_1}{q_1^*},\\ldots,\\frac{p_i}{q_i^*})\\;\\;\\mathrm{a.s.}\\ ] ]    using finally slutsky s theorem , , and , we get , @xmath241{\\mathrm{in law } } \\m{nor}\\big(0,\\sigma_*^2).\\ ] ]      thanks to @xmath82 and proposition [ conv ] there exists @xmath242 s.t . for all @xmath243 we have @xmath244 .",
    "the proportions @xmath245 are well defined for all @xmath243 and play an important role in both allocation rules _ a ) _ and _ b)_. proposition [ conv ] implies convergence of @xmath246 as @xmath247 .    [ lem - rhob ] under the assumptions of theorem [ thm - vit - conv ] , @xmath248{}q_i^*\\;\\;\\mathrm{a.s.}\\ ] ]    let be @xmath23 .",
    "we have @xmath249 .",
    "using the fact that @xmath250 we can write @xmath251    we will show that @xmath252 , and , as @xmath253 , will get the desired result .    for @xmath254",
    ", we have @xmath255 where the sequence @xmath256 defined by @xmath257 for @xmath258 converges to @xmath187 as @xmath156 tends to infinity .",
    "the cesaro means which appear as factors in the second and third terms of the r.h.s .",
    "both converge a.s . to @xmath187 .",
    "one easily deduce that the first , second and third terms respectively converge to @xmath259 , @xmath187 and @xmath259",
    ".    there may be some strata of zero variance .",
    "we denote by @xmath260 ( @xmath261 ) the number of strata of non zero variance .    for a stratum @xmath18 of zero variance the only drawing made at each step",
    "will be the one forced by . indeed @xmath262 for all @xmath53 in this case .",
    "thus @xmath263 for all the strata of zero variance and since @xmath264 , we get the desired result for them ( note that of course @xmath214 in this case ) .",
    "we now work on the @xmath260 strata such that @xmath265 .",
    "we renumber these strata from @xmath89 to @xmath260 .",
    "let now @xmath266 be such that @xmath267 for all @xmath268 , and all @xmath269 . for @xmath268 , the integer @xmath270 at step @xmath271 in procedure _",
    "b ) _ is equal to @xmath260 .",
    "_ we will firstly show that @xmath272 let @xmath268 . at step @xmath271",
    "we denote by @xmath273 the ordered index in point i ) of procedure  _ b ) _ and by @xmath274 the index @xmath97 in point ii ) .",
    "we also set @xmath275 . by point iii ) , for @xmath276 , @xmath277    _ case 1 : _",
    "@xmath278 . then , in addition to the drawing forced by , there are some drawings at step @xmath271 in stratum @xmath279 , and consequently in all the strata . thus leads to @xmath280 but @xmath281 and , following the systematic sampling procedure",
    ", we have @xmath282    thus , in this case , @xmath283    _ case 2 : _ @xmath284 . if @xmath285 , @xmath286 and holds .",
    "if @xmath287 , then leads to @xmath288 using , it is enough to check that @xmath289 in order to deduce that also holds for @xmath287 .    if @xmath290 , then inequality holds by the definition of @xmath274 .    if @xmath291 we have @xmath292 , @xmath293 and thus @xmath294 this inequality also writes @xmath295 and follows .",
    "_ let @xmath269 .",
    "we set @xmath296 ( this the number of drawings in stratum @xmath18 that have not been forced by ) .",
    "using we have @xmath297 and thus @xmath298    let @xmath128 .",
    "thanks to lemma [ lem - rhob ] , there exists @xmath299 s.t . for all @xmath300 , @xmath301 .",
    "thus @xmath302    by induction @xmath303 indeed suppose @xmath304 . if @xmath305 then @xmath306 and using we get @xmath307 .",
    "otherwise @xmath308 and using we are done .    but as @xmath309 as @xmath114 we deduce that @xmath310 .",
    "since this is true for any @xmath311 , and @xmath264 , we can conclude that @xmath312 . now using the indexation on all the strata and the result for the strata with variance zero",
    ", we deduce that for @xmath313 , @xmath314 this concludes the proof .",
    "we compute @xmath315 where @xmath316 .",
    "let @xmath317 .",
    "we choose the strata to be given by the @xmath318-quantiles @xmath319 of the normal law for @xmath320 for @xmath23 .",
    "that is to say @xmath321 $ ] for all @xmath23 , with the convention that @xmath322 and @xmath323 .    in this",
    "setting we have @xmath324 for all @xmath23 .",
    "let us denote by @xmath325 the density of the law @xmath326 .",
    "thanks to the relation @xmath327 and using integration by parts , we can establish that , for all @xmath23 , @xmath328 and @xmath329 with the convention that @xmath330 .    we can then compute the exact @xmath331 s and the optimal standard deviation of the non - adaptive stratified estimator , @xmath332    we can also for example compute @xmath333    this will give us benchmarks for our numerical tests .",
    "we will compute @xmath334 for @xmath335 .",
    "we choose @xmath336 , @xmath337 , @xmath338 and @xmath339 .",
    "first for one realization of the sequence @xmath340 we plot the evolution of @xmath341 , when we use procedure _ a ) _ or _ b ) _ for the computation of allocations .",
    "this is done on figure [ fignink ] .     for @xmath342 , for procedure _ a ) _ ( the @xmath343-line ) and procedure _ b ) _ ( the @xmath344-line ) , in function of @xmath52 .",
    "the horizontal line is at level @xmath345.,width=340 ]    we observe that the convergence of @xmath341 to @xmath345 is faster with procedure _",
    "b)_.    second , to estimate the variance of our adaptive stratified estimator , we do @xmath346 runs of all the procedure leading to the sequence @xmath340 . for @xmath342 we compute , @xmath347^l)^2-\\big(\\frac{1}{l}\\sum_{l=1}^l[\\hat{c}^k]^l\\big)^2,\\ ] ] with the @xmath348^l\\big)_{1\\leq l\\leq l}$ ] independent runs of the algorithm till step @xmath53 .",
    "this estimates the variance of the stratified estimator at step @xmath53 ( @xmath52 total drawings have been used ) . to compare with @xmath349 we compute the quantities @xmath350 ( in other words",
    "we compare the standard deviation of our adaptive stratified estimator with @xmath52 total drawings with the one of the non - adaptive stratified estimator with optimal allocation , for the same number of total drawings ) .     for @xmath351 , for procedure _",
    "a ) _ ( the @xmath343-line ) and procedure _ b ) _ ( the @xmath344-line ) , in function of @xmath52 ( the abscissas axe ) .",
    "the horizontal line is at level @xmath349.,width=340 ]    the values are ploted on figure [ figsk ] .",
    "we observe that the convergence to @xmath349 is slightly faster with procedure _",
    "b)_. this corresponds to the fact that the convergence of the @xmath193 s is faster with this later procedure ( see proposition [ prop - vit - conv ] ) .",
    "we wish to compare the efficiency of our algorithm with the one of the non - adaptive stratified estimator with proportional allocation .",
    "indeed this is the one we would use if we did not know the @xmath46 s .    with the same strata as in the previous setting the stratified estimator with proportional allocation of @xmath11 for a total number of drawings",
    "@xmath339 is @xmath352 we will compare it to @xmath353 that was computed in the example above . as we have seen in the introduction ,",
    "the variance of @xmath354 is @xmath355    we do @xmath346 runs of @xmath353 and @xmath354 .",
    "we get an estimation @xmath356 of the variance of @xmath353 as previously . in a similar manner",
    "we get an approximation @xmath357^l)^2-\\big(\\frac{1}{l}\\sum_{l=1}^l[\\bar{c}]^l\\big)^2 $ ] of the variance of @xmath354 .    as @xmath358 we know that we will have @xmath359 . but to compute @xmath353 we do some additional computations compared to a non adaptive stratified estimator .",
    "this has a numerical cost .",
    "we thus use the @xmath360 runs to compute the average computation times @xmath361 and @xmath362 , respectively of @xmath353 and @xmath354 .",
    "we have @xmath363 and @xmath364 .",
    "this means that in this toy example the numerical cost of our algorithm is not that much balanced by the achieved variance reduction .",
    "we wish to compare our results with the ones of @xcite .",
    "we will work on the example of the arithmetic asian option in the black - scholes model presented in this paper .",
    "we shortly present the setting .",
    "we have a single underlying asset , with price at time @xmath365 denoted by @xmath366 . under the risk neutral measure @xmath367",
    ", the price @xmath368 follows the stochastic differential equation , @xmath369 with @xmath370 the constant interest rate , @xmath371 the constant asset s volatility , @xmath372 a standard wiener process , and @xmath373 fixed .",
    "let @xmath374 be the option s maturity and @xmath375 the sequence of times when the value of the underlying asset is monitored to compute the average .",
    "the discounted payoff of the arithmetic asian option with strike @xmath376 is given by @xmath377 thus the price of the option is given by @xmath378.\\ ] ]    but in this black - scholes setting we can exactly simulate the @xmath379 s using the fact that @xmath380 and @xmath381(t_m - t_{m-1})+v\\sqrt{t_m - t_{m-1}}x^m \\big ) , \\quad\\forall 1\\leq m\\leq d,\\ ] ]    where @xmath382 are independent standard normals .",
    "thus , @xmath383,\\ ] ] with @xmath384 some deterministic function , @xmath385 , and @xmath0 a @xmath1-valued random variable with law @xmath386 .    in @xcite the authors discuss and link together two issues : importance sampling and stratified sampling .",
    "their importance sampling technique consists in a change of mean of the gaussian vector @xmath0 .",
    "let us denote by @xmath387 the density of the law @xmath386 and by @xmath388 the density of the law @xmath389 for any @xmath390 .",
    "we have , @xmath391.\\ ] ] the variance of @xmath392 is given by @xmath393 heuristically , this indicates that an effective choice of @xmath394 should give weight to points for which the product of the payoff and the density is large . in other words , if we define @xmath395 we should look for @xmath396 that verifies , @xmath397    the most significant part of the paper @xcite is aimed at giving an asymptotical sense to this heuristic , using large deviations tools .",
    "the idea is then to sample @xmath392 .",
    "standard computations show that for any @xmath390 , @xmath398.\\ ] ] thus the problem is now to build a monte carlo estimator of @xmath399 , sampling @xmath400 with @xmath401 , and with @xmath402 , for the vector @xmath403 satisfying .",
    "the authors of @xcite then propose to use a stratified estimator of @xmath399 . indeed for @xmath26 with @xmath404 , and @xmath405 real numbers , it is easy to sample according to the conditional law of @xmath0 given @xmath406 $ ] .",
    "it can be done in the following way ( see subsection 4.1 of @xcite for details ) .",
    "we first sample @xmath407 with @xmath408 the inverse of the cumulative normal distibution , and @xmath409 , with @xmath410 uniform on @xmath411 $ ] .",
    "second we sample @xmath412 independent of @xmath413 .",
    "we then compute , @xmath414 which by contruction has the desired conditional law .",
    "let be @xmath26 satisfy @xmath404 . with our notation the stratified estimator @xmath19 in @xcite",
    "is built in the following way .",
    "they take @xmath415 . as in subsection [ ssfirstex ]",
    "we denote by @xmath319 the @xmath318-quantile of the law @xmath326 . for all @xmath23 , they take @xmath416 .",
    "that is to say @xmath13 has the conditional law of @xmath0 given @xmath417 , for all @xmath23 . as in this setting @xmath418",
    ", they have @xmath419 for all @xmath23 .",
    "they then do proportional allocation , that is to say , @xmath420 for all @xmath23 , where @xmath48 is the total number of drawings ( in other words @xmath40 ) .",
    "then , the variance of their stratified estimator is @xmath421 according to the introduction , that choice ensures variance reduction",
    ".    the question of the choice of the projection direction @xmath422 arises .",
    "the authors take @xmath423 , with the vector @xmath403 satisfying that has been used for the importance sampling .",
    "they claim that this provides in practice a very efficient projection direction , for their stratified estimator with proportional allocation .    as @xmath424 ( i.e. proportional allocation is suboptimal ) ,",
    "if @xmath422 is a good projection direction for a stratified estimator with proportional allocation , it is a good direction for a stratified estimator with optimal allocation .    in the sequel",
    "we take the same direction @xmath422 and the same strata as in @xcite , and discuss allocation .",
    "indeed we may wish to do optimal allocation and take @xmath425 .",
    "the trouble is the analytical computation of the quantities @xmath426),\\ ] ] is not tractable , at least when @xmath427 is not linear . as the @xmath10 s are known , this is exactly the kind of situation where our adaptive stratified estimator can be useful .      in all the tests we have taken @xmath428 , @xmath429 , @xmath430 and @xmath431 .",
    "the total number of drawings is @xmath432 .",
    "we call ghs the procedure used in @xcite , that is importance sampling plus stratified sampling with proportional allocation .",
    "we call ssaa our procedure , that is the same importance sampling plus stratified sampling with adaptive allocation .",
    "more precisely in the procedure ssaa we choose @xmath433 , @xmath434 , @xmath435 and compute our adaptive stratified estimator @xmath436 of @xmath437 , with the same strata as in ghs .",
    "we have used procedure _ a ) _ for the computation of allocations .",
    "we denote by @xmath354 the ghs estimator of @xmath11 .",
    "we call < < variance ghs > > or < < variance ssaa > > the quantity @xmath438 , which is an estimation of the variance of @xmath354 or @xmath436 . more precisely for ghs , @xmath439 where for each @xmath23 , @xmath440 and for ssaa @xmath441 where for each @xmath23 , @xmath442    ccccc d & k & price&variance ssaa&ratio ghs / ssaa +   + 16 & 45 & 6.05 & @xmath443 & 2.04 + & 50 & 1.91 & @xmath444 & 35 + & 55 & 0.20 & @xmath445 & 39.36 +   + 64 & 45 & 6.00 & @xmath446 & 3.34 + & 50 & 1.84 & @xmath447 & 1.60 + & 55 & 0.17 & @xmath448 & 61 +    tables [ tab1 ] and [ tab2 ] show the results respectively for a call option and a put option .",
    "< ratio ghs / ssaa > > the variance ghs divided by the variance ssaa . in general the improvement is much better for a put option .",
    "indeed the variance is often divided by @xmath449 in this case .",
    "ccccc d & k & price&variance ssaa&ratio ghs / ssaa +   + 16 & 45 & 0.013 & @xmath450 & 107 + & 50 & 0.63 & @xmath451 & 79 + & 55 & 3.74 & @xmath452 & 249 +   + 64 & 45 & 0.011 & @xmath453 & 95 + & 50 & 0.62 & @xmath454 & 64 + & 55 & 3.69 & @xmath455 & 58 +    a further analysis can explain these results .",
    "we plot on figure [ figcall ] and [ figput ] the values of the @xmath456 s and the estimated values of the conditional expectations @xmath457 s , for a call and a put option , with @xmath458 and @xmath459 , a case for which the ratio ghs / ssaa is 3.34 in the call case and 95 in the put case .     in function of the stratum index @xmath18 in the case of a call option .",
    "on the right : estimated value of @xmath457 .",
    "( parameters are the same as in tables [ tab1 ] , with @xmath458 and @xmath459).,title=\"fig:\",width=226 ]   in function of the stratum index @xmath18 in the case of a call option . on the right : estimated value of @xmath457 .",
    "( parameters are the same as in tables [ tab1 ] , with @xmath458 and @xmath459).,title=\"fig:\",width=226 ]     in function of the stratum index @xmath18 in the case of a put option . on the right : estimated value of @xmath457 .",
    "( same parameters than in figure [ figcall]).,title=\"fig:\",width=226 ]   in function of the stratum index @xmath18 in the case of a put option . on the right : estimated value of @xmath457 .",
    "( same parameters than in figure [ figcall]).,title=\"fig:\",width=226 ]    we observe that in the case of the put option the estimated conditional variance of about @xmath460 of the strata is zero , unlike in the case of the call option .",
    "these estimated conditional variances are zero , because in the corresponding strata the estimated conditional expectations are constant with value zero .    but these strata are of non zero probability ( remember that in this setting @xmath461 , for all @xmath462 ) . thus the ghs procedure with proportional allocation will invest drawings in these strata , resulting in a loss of accuracy , while in our ssaa procedure most of the drawings are made in the strata of non zero estimated variance .",
    "one can wonder if the expectation in the strata of zero observed expectation is really zero , or if it is just a numerical effect .",
    "we define the deterministic function @xmath463 by @xmath464\\frac{t}{d}+v\\sqrt{\\frac{t}{d}}x^p\\big\\ } \\big),\\quad\\forall x=(x^1,\\ldots , x^d)'\\in\\m{r}^d.\\ ] ] with the previous notations , in the put option case , we have @xmath465 a.s . , and thus @xmath466 , if @xmath467 a.s .",
    "( note that @xmath18 denotes here the stratum index and not the component of the random vector @xmath13 ) .",
    "thus the problem is to study , in function of @xmath468 , the deterministic values of @xmath469 for @xmath470 satisfying @xmath471 .",
    "the following facts can be shown . whatever the value of @xmath422 or @xmath472 the quantity @xmath469 has no upper bound .",
    "thus in the call option case no conditional expectation @xmath457 will be zero . to study the problem of the lower bound we denote by @xmath473 the matrix of size @xmath474 given  by @xmath475 and by @xmath476 the @xmath477-sized vector @xmath478 .",
    "if we use the change of variable @xmath479\\frac{t}{d}\\m{ind}+v\\sqrt{\\frac{t}{d}}(x+\\mu ) \\big),\\ ] ] we can see that minimizing @xmath469 for @xmath470 satisfying @xmath471 is equivalent to minimizing @xmath480 for @xmath481 satisfying @xmath482 where , @xmath483 and @xmath484\\frac{t}{d}\\m{ind}+v\\sqrt{\\frac{t}{d}}(x+\\mu ) \\big)=v\\sqrt{\\frac{t}{d}}(z+u'\\mu)+(r-\\frac{v^2}{2})\\sum_{m=1}^du_m.\\ ] ]    if all the components of @xmath485 are stricly positive the lower bound of @xmath469 under the constraint @xmath471 is @xmath486 if all the components of @xmath485 are stricly negative we get the same kind of result by a change of sign .",
    "otherwise the lower bound is zero : it is possible to let the @xmath487 s tend to @xmath488 with satisfied .    in the numerical example that we are analysing",
    "the direction vector @xmath422 is the same in the call or put option cases , and its components are stricly positive and decreasing with the index ( see figure [ figum ] ) .",
    "thus the components of @xmath485 are strictly positive and the lower bound is given by @xmath489 defined by . with @xmath472 taking values in the @xmath490 last strata we have @xmath491 . thus the conditional expectations @xmath457 are truly zero in these strata .",
    "of @xmath26 in function of @xmath492.,width=302 ]    we can then wonder if it is worth stratifying the part of the real line corresponding to these strata , in other words stratifying @xmath1 and not only @xmath493 .",
    "maybe stratifying @xmath493 and making proportional allocation will provide a sufficient variance reduction .",
    "but this would require a first analysis , while our ssaa procedure avoids automatically to make a large number of drawings in @xmath494 .    to conclude on the efficiency of our algorithm in this example",
    "let us notice that the computation times of the ghs and ssaa procedures are nearly the same ( less than @xmath495 additional time for the ssaa procedure ) .",
    "indeed , unlike in the toy example of subsection [ ssfirstex ] , the computation time of the allocation of the drawings in the strata is almost negligible in comparison to the other calculations ( drawings etc ... ) .",
    "we justify the use of procedure _ b ) _ in the following proposition .",
    "[ prop - opt ] when @xmath88 for some @xmath23 , by computing at step @xmath53 the @xmath106 s with the procedure _",
    "b ) _ described in section [ sec_algo ] , we find @xmath83 that minimizes @xmath84 under the constraint @xmath85 .    first note that if @xmath78 for some index @xmath18 it is clear that we have to set @xmath86 and to rewrite the minimization problem for the indexes corresponding to @xmath88 .",
    "this corresponds to the very beginning of procedure _",
    "b)_.                                  this function is continuous on @xmath525 , equal to @xmath526 for @xmath527 , decreasing on @xmath528 $ ] and tends to @xmath126 as @xmath508 tends to @xmath259 .",
    "we deduce that @xmath529 reaches its unique maximum at some @xmath530 .",
    "we have thus found @xmath545 that satisfies @xmath546 which implies that @xmath547 for all @xmath548 . besides implies @xmath549 and @xmath550 for all @xmath509 . therefore @xmath545 is a saddle point of the lagrangian and @xmath551 solves the constrained minimization problem .",
    "the proof of proposition [ prop - opt ] in then completed : in points i ) and ii ) of procedure _ b ) _ we find the index @xmath97 mentionned in step 1 , using the criterion of step 2 . in point iii ) we compute the solution of the optimization problem using the results of step 1 ."
  ],
  "abstract_text": [
    "<S> in this paper , we propose a stratified sampling algorithm in which the random drawings made in the strata to compute the expectation of interest are also used to adaptively modify the proportion of further drawings in each stratum . </S>",
    "<S> these proportions converge to the optimal allocation in terms of variance reduction . </S>",
    "<S> and our stratified estimator is asymptotically normal with asymptotic variance equal to the minimal one . </S>",
    "<S> numerical experiments confirm the efficiency of our algorithm . </S>"
  ]
}