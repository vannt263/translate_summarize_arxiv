{
  "article_text": [
    "essentially all our knowledge about the structure and evolution of stars , hence about galactic evolution in general , rests on the interpretation of their electromagnetic spectrum .",
    "therefore quantitative analysis of stellar spectra is one of the most important tools of modern astrophysics .",
    "the formation of the observed spectrum is confined to the atmosphere , a very thin layer on top of the stellar core .",
    "spectral analysis is performed by modeling the temperature- and pressure - stratification of the atmosphere and computing synthetic spectra which are then compared to observation .",
    "fitting synthetic spectra to the data yields basic photospheric parameters : effective temperature , surface gravity , and chemical composition .",
    "comparison with theoretical evolutionary calculations allows one to derive stellar parameters : mass , radius , and total luminosity .",
    "the classical stellar - atmosphere problem considers radiation transfer through the outermost layers of a star into free space under three assumptions .",
    "first it is assumed that the atmosphere is in hydrostatic equilibrium , thus , the matter which interacts with photons is at rest .",
    "second , the transfer of energy through the atmosphere is assumed to be done entirely by photons , i.e.heat-conduction and convection are regarded as negligible ( radiative equilibrium ) .",
    "but the effectiveness of photon - transfer depends on the opacity and emissivity of the matter , which are strongly state- and frequency - dependent quantities .",
    "they depend in detail on the occupation numbers of atomic / ionic levels , which , in turn , are determined by the local temperature and electron density , and the radiation field , whose nature is _ non - local_. the occupation number of any atomic level is determined by a balance among radiative and collisional population and de - population processes ( statistical equilibrium ; our third assumption ) , i.e.  the interaction of atoms with other particles and photons .",
    "mathematically , the whole problem requires the solution of the radiation transfer equations simultaneously with the equations for hydrostatic and radiative equilibrium , together with the statistical equilibrium ( rate equations ) .",
    "a stellar atmosphere radiates into circumstellar space and thus is an _",
    "open thermodynamic system _ ; hence it can not be in thermodynamic equilibrium ( te ) , and can not be characterized by a single temperature .",
    "the idea of `` local thermodynamic equilibrium '' ( lte ) is a hypothesis which assumes that while te does not hold for the atmosphere as a whole , it can be applied in small volume elements . in this case",
    "the atomic occupation numbers depend only on the local electron temperature and electron density via the saha - boltzmann equations . but this approximation can be valid only in the limit that collision rates dominate radiative rates , and photon - mean - free - paths are small",
    ". models in which the saha - boltzmann equations are replaced by the physically more accurate rate equations are called non - lte ( or nlte ) models .",
    "this designation is somewhat imprecise because the velocity distribution of particles is still assumed to be maxwellian , i.e.  we can still define a local temperature .",
    "nlte calculations are more costly than lte calculations , however , and it is hard to predict a priori whether nlte effects will be important in a specific problem .",
    "generally , nlte effects are large at high temperatures and low densities , which imply intense radiation fields , hence frequent radiative processes ( which have a non - local nature and , in particular , respond to the presence of the open boundary ) , and less - frequent particle collisions , which tend to enforce lte conditions .",
    "abandonment of the lte assumption leads to a much more difficult model - atmosphere problem , because of subtle couplings between the radiation transfer and statistical equilibrium equations .",
    "the pioneering work by auer & mihalas ( 1969 ) provided a basic tool for making such models .",
    "but the numerical problem going from lte to _ realistic _",
    "nlte models has been solved only recently , and is the topic of this paper .",
    "we now have much more powerful tools to compute non - classical models , which account for very complex opacities , and solve the radiation transfer equations in more general environments , for example in expanding stellar atmospheres .",
    "these are the topics of other papers in this volume .",
    "stellar - atmosphere modeling has made huge progress in recent years .",
    "this advance was achieved by the development of new numerical techniques for model - construction , and by the availability of atomic data for many species . and",
    "these achievements became possible only with an enormous increase of computing power .",
    "model atmospheres assuming lte have been highly refined by the inclusion of many more atomic and molecular opacity sources , and effective numerical techniques for lte model - computation have been available for years .",
    "the progress is most remarkable in the field of nlte model atmospheres .",
    "replacement of the saha - boltzmann equations by atomic rate - equations requires radically different numerical - solution techniques , otherwise metal - opacities can not be taken into account at all .",
    "such techniques have been developed with great success during the last decade , inspired by important papers by cannon ( 1973 ) and scharmer ( 1981 ) .",
    "the _ accelerated lambda - iteration method _",
    "( ali ) is at the heart of this development .",
    "combined with statistical representations of line - opacities , we are finally able to compute metal - line - blanketed nlte models , including many millions of spectral lines , with a very high level of sophistication .    in this paper",
    "we discuss the basic ideas behind the new numerical methods for nlte modeling .",
    "we begin by presenting the classical model - atmosphere problem and introduce the basic equations .",
    "then we focus on the ali solution - method , and our numerical implementation of it .",
    "we then briefly describe the solution of the nlte metal - line - blanketing problem .",
    "we assume plane - parallel geometry , which is well justified for most stars because the atmospheres are thin compared to the stellar radius . the only parameters needed to characterize uniquely such an atmosphere are the effective temperature ( ) , a measure for the amount of energy transported through the atmosphere per unit area and time ( see eq.[nominal ] ) , the surface gravity ( @xmath0 ) , and the chemical composition .",
    "generalization to spherical symmetry to account for extended ( static ) atmospheres mainly affects the radiation transfer equation and is straightforward ( mihalas & hummer 1974 ) .",
    "a spherical - symmetry variant of our code has been written by nagel ( 2001 ) . to construct model atmospheres",
    "we must solve simultaneously a set of equations that is highly coupled and non - linear .",
    "because of the coupling , no equation determines uniquely a single quantity ",
    "_ all _ equations jointly determine each of the state parameters .",
    "neverlethess , each of them is usually thought of as determining , more or less , a particular quantity .",
    "these equations are :    * the radiation transfer equations which are solved for the angle - integrated mean intensities @xmath1 , on a pre - chosen frequency grid comprising @xmath2 points .",
    "the formal solution is given by @xmath3 , where @xmath4 is the source function as defined later ( eq.[source ] ) , and @xmath5 is the transport operator .",
    "although @xmath5 is written as an operator , one may think of it as a _ process _ of obtaining the mean intensity from the source function . * the hydrostatic - equilibrium equation which determines the total particle density @xmath6 . *",
    "the radiative - equilibrium equation from which the temperature @xmath7 follows .",
    "* the particle - conservation equation , determining the electron density @xmath8 .",
    "* the statistical - equilibrium equations , which are solved for the population densities @xmath9 of the atomic levels that are allowed to depart from lte ( nlte levels ) . * the equation that defines a fictitious massive - particle density @xmath10 , which is introduced for convenience in the solution procedure .",
    "this set of equations has to be solved at each point @xmath11 of a grid comprising @xmath12 depth points .",
    "thus we are looking for solution vectors @xmath13 the complete linearization ( cl ) method ( auer & mihalas 1969 ) solves this set by linearizing the equations with respect to all variables .",
    "the basic advantage of the ali ( or `` operator splitting '' ) method over cl is that it allows one to eliminate , at the outset , the explicit appearance of the mean intensities @xmath14 from the solution scheme by expressing these variables by the current , yet - to - be determined , occupation numbers and temperature .",
    "this is accomplished by an iteration procedure which may be written as ( suppressing indices indicating depth and frequency dependence of variables ) : @xmath15 this means that the actual mean intensity at any iteration step @xmath16 is computed by applying an approximate lambda operator ( alo ) @xmath17 on the actual source function @xmath18 plus a correction term that is computed from quantities known from the previous iteration step .",
    "this correction term includes the exact lambda operator @xmath5 , which guarantees convergence to the exact solution of the radiation transfer problem @xmath3 .",
    "the use of @xmath5 in eq.[ali ] only indicates that a formal solution of the transfer equation is performed , but in our application the operator is not constructed explicitly .",
    "instead we employ the feautrier ( 1964 ) solution scheme ( mihalas 1978 ) or a short - characteristic method ( olson & kunasz 1987 ) to solve the transfer equation as a differential equation .",
    "the resulting set of equations for the reduced solution vectors @xmath19 is of course still non - linear .",
    "the solution is obtained by linearization and iteration which is performed either with a usual newton - raphson iteration or by other , much faster methods like the quasi - newton or kantorovich variants ( dreizler & werner 1991 , hubeny & lanz 1992 ) ( see sect.[broy ] ) .",
    "the first model - atmosphere calculations with the ali method were performed by werner ( 1986 ) .",
    "another advantage of the ali method is that explicit depth coupling of the solution vectors eq.[psi1 ] through the transfer equation can be avoided if one uses diagonal ( i.e.  local ) alos .",
    "then the solution vectors eq.[psi2 ] are independent from each other and the solution procedure within one iteration step of eq.[ali ] is much more straightforward .",
    "depth coupling is provided by the correction which contains the exact solution of the transfer equation .",
    "the hydrostatic equation , which also gives explicit depth coupling , may be taken out of the set of equations and can  as experience shows ",
    "be solved in between two iteration steps of eq.[ali ]",
    ". then full advantage of a local alo can be taken .",
    "the linearized system may be written as : @xmath20 where @xmath21 is the current estimate for the solution vector at depth @xmath11 and @xmath22 is the correction vector to be computed .",
    "using a tri - diagonal @xmath17 operator the resulting system for @xmath22 is  like in the classical cl scheme  of block tri - diagonal form coupling each depth point @xmath11 to its nearest neighbors @xmath23 : @xmath24 the quantities @xmath25 are ( @xmath26 ) matrices where @xmath27 is the total number of physical variables , i.e. , @xmath28 , and @xmath29 is the residual error in the equations .",
    "the solution is obtained by the standard feautrier scheme . with starting values @xmath30 ) and @xmath31 we sweep from the outer boundary of the atmosphere inside and calculate at each depth : @xmath32 at the inner boundary we have @xmath33 and by sweeping backwards to the surface we calculate the correction vectors , first @xmath34 , and then successively @xmath35 .",
    "as already mentioned , the system eq.[tri ] breaks into @xmath12 independent equations @xmath36 ( @xmath37 ) when a local @xmath17 operator is used . the additional numerical effort to set up the subdiagonal matrices and matrix multiplications in the tri - diagonal case",
    "is outweighed by the faster global convergence of the ali cycle , accomplished by the explicit depth coupling in the linearization procedure ( werner 1989 ) .",
    "the principal advantage of the ali over the cl method becomes clear at this point .",
    "each matrix inversion in eq.[feau ] requires @xmath38 operations whereas in the cl method @xmath39 operations are needed . since the number of frequency points @xmath2 is much larger than the number of levels @xmath40 , the matrix inversion in the cl approach",
    "is dominated by @xmath2 .",
    "recent developments deal with the problem that the total number of atomic levels tractable in nlte with the ali method described so far is restricted to the order of 250 , from experience with our model atmosphere code pro2 .",
    "this limit is a consequence of the non - linearity of the equations , and in order to overcome it , measures must be taken in order to achieve a linear system whose numerical solution is much more stable .",
    "such a pre - conditioning procedure was first applied in the ali context by werner & husfeld ( 1985 ) using the core - saturation method ( rybicki 1972 ) .",
    "more advanced work achieves linearity by replacing the @xmath5 operator with the @xmath41 operator ( and by judiciously considering some populations as `` old '' and some as `` new '' ones within an ali step ) which is formally defined by writing : @xmath42 where the total opacity @xmath43 ( as defined in sect.[opa ] ) is calculated from the previous ali cycle .",
    "the advantage is that the emissivity @xmath44 ( sect.[opa ] ) is linear in the populations , whereas the source function @xmath45 is not .",
    "hence the new operator @xmath41 gives the solution of the transfer problem by acting on a linear function .",
    "this idea was proposed by rybicki & hummer ( 1991 ) who applied it to the line - formation problem , i.e.regarding the atmospheric structure as fixed .",
    "hauschildt ( 1993 ) and hauschildt & baron ( 1999 ) generalized it to solve the full model - atmosphere problem .",
    "in addition , splitting the set of statistical equations , and solving it separately for each chemical element , means that now many hundreds of levels per species are tractable in nlte ( see dreizler , this volume , for our experience ) . a very robust method and fast variant of the ali method , the ali / cl hybrid scheme , permits the linearization of the radiation field for selected frequencies ( hubeny & lanz 1995 ) , but it is not implemented in pro2 .",
    "any numerical method requires a formal solution ( i.e.  atmospheric structure already given ) of the radiation transfer problem .",
    "we disregard here polarization effects .",
    "( an implementation of an ali technique to treat polarized radiation is discussed by deetjen in this volume . )",
    "radiation transfer at any depth point is described by the transfer equation : @xmath46,\\ ] ] written separately for positive and negative @xmath47 ( the angle - cosine between the direction of propagation and the outward - directed normal to the surface ) , i.e.  for the inward and outward directional intensities @xmath48 at frequency @xmath49 .",
    "here @xmath50 is the optical depth ( defined in terms of the column mass @xmath51 used in the other structural equations by @xmath52 , where @xmath53 is the mass density ) , and @xmath54 is the local source function . introducing the feautrier intensity @xmath55 we obtain the second - order form ( mihalas 1978 , p.151 ) : @xmath56.\\ ] ] we may separate the thomson emissivity term ( scattering from free electrons , assumed coherent , with cross - section @xmath57 ) from the source function so that @xmath58 where @xmath59 is the ratio of thermal emissivity to total opacity as described in detail below ( sect.[opa ] ) : @xmath60 .",
    "the mean intensity is the angular integral over the feautrier intensity , hence the transfer equation becomes @xmath61 thomson scattering complicates the situation by its explicit angle coupling but the solution can be obtained with the standard feautrier scheme . assuming complete frequency - redistribution in spectral lines ( mihalas 1978 , p.29 ) , no explicit frequency coupling occurs so that a parallel solution for all frequencies enables very efficient vectorization on the computer .",
    "the following boundary conditions are used for the transfer equation . at the inner boundary where the optical depth is at maximum , @xmath62",
    ", we have @xmath63 where we specify @xmath64 from the diffusion approximation : @xmath65 here @xmath66 is the planck function and @xmath67 the nominal ( frequency - integrated ) eddington flux : @xmath68 with the stefan - boltzmann constant @xmath69 . at the outer boundary",
    "we take @xmath70 , assuming that @xmath71 is a linear function of @xmath51 for @xmath72 . since @xmath73 , it is not exactly valid to assume no incident radiation at the stellar surface",
    ". instead we specify @xmath74 after scharmer & nordlund ( 1982 ) : @xmath75\\ ] ] which follows from eq.[te ] assuming @xmath76 for @xmath77 .",
    "then we get : @xmath78 the boundary conditions are discretized performing taylor expansions which yield second - order accuracy ( mihalas 1978 , p.155 ) .",
    "the statistical equilibrium equations are set up according to mihalas ( 1978 , p.127 ) .",
    "the number of atomic levels , ionization stages , and chemical species , as well as all radiative and collisional transitions are taken from the input model atom supplied by the user .",
    "ionization into excited states of the next ionization stage is taken into account .",
    "dielectronic recombination and autoionization processes can also be included in the model atom .      as usual ,",
    "the atomic energy levels are ordered sequentially by increasing excitation energy , starting with the lowest ionization stage .",
    "then for each atomic level @xmath79 of any ionization stage of any element , the rate equation describes the equilibrium of rates into and rates out of this level : @xmath80 the rate coefficients @xmath81 have radiative and collisional components : @xmath82 .",
    "radiative upward and downward rates are respectively given by : @xmath83 @xmath84 photon cross - sections are denoted by @xmath85 .",
    "@xmath86 is the boltzmann lte population ratio in the case of line transitions : @xmath87 , where the @xmath88 are the statistical weights .",
    "the lte population number of a particular level is defined relative to the ground state of the next ion , so that in the case of recombination from a ground state @xmath89 we have by definition @xmath90 with the saha - boltzmann factor @xmath91 where @xmath92 is the ionization potential of the level @xmath79 .",
    "care must be taken in the case of recombination from an excited level into the next lower ion . then @xmath93 .",
    "dielectronic recombination is included following mihalas & hummer ( 1973 ) .",
    "assuming now that @xmath94 is a ground state of ion @xmath95 , then the recombination rate into level @xmath79 of ion @xmath96 via an autoionization level @xmath97 ( with ionization potential @xmath98 , having a negative value when lying above the ionization limit ) is : @xmath99 the reverse process , the autoionization rate , is given by : @xmath100 the oscillator strength for the stabilizing transition ( i.e.  transition @xmath101 ) is denoted by @xmath102 , and @xmath103 is the mean intensity averaged over the line profile .",
    "our program simply takes @xmath104 from the continuum frequency point closest to the transition frequency , which is reasonable because the autoionization line profiles are extremely broad . the population of autoionization levels",
    "is assumed to be in lte and therefore such levels do not appear explicitly in the rate equations .",
    "the computation of collisional rates is generally dependent on the specific ion or even transition .",
    "several options , covering the most important cases , may be chosen by the user .",
    "the rate equation for the highest level of a given chemical species is redundant .",
    "it is replaced by the abundance definition equation .",
    "summation over all levels usually includes not only nlte levels but also levels which are treated in lte , according to the specification in the model atom . denoting the number of ionization stages of species @xmath95 with @xmath105 , the number of nlte and lte levels per ion with @xmath106 and @xmath107 , respectively",
    ", we can write : @xmath108 = y_k ( n - n_e ) .\\ ] ] @xmath109 is the number fraction of element @xmath95 .",
    "we close the system of statistical equilibrium equations by demanding charge conservation . we denote the total number of chemical species with @xmath110 , the charge of ion @xmath111 with @xmath112 ( in units of the electron charge ) and write : @xmath113=n_e .\\ ] ]",
    "we introduce a vector comprising the occupation numbers of all nlte levels , @xmath114 @xmath115 .",
    "then the statistical equilibrium equation is written as : @xmath116 the gross structure of the rate matrix @xmath117 is of block matrix form , because transitions between levels occur within one ionization stage or to the ground state of the next ion .",
    "the structure is complicated by ionizations into excited levels and by the abundance definition and charge conservation equations which give additional non - zero elements in the corresponding lines of @xmath118 .",
    "radiative equilibrium can be enforced by adjusting the temperature stratification either during the linearization procedure or in between ali iterations . in the former case a linear combination of two different formulations is used and in the latter case the classical unsld - lucy temperature correction procedure ( lucy 1964 ) is utilized .",
    "the latter is particularly interesting , because it allows one to exploit the block form of the rate - coefficient matrix .",
    "this fact allows an economic block - by - block solution followed by a subsequent unsld - lucy temperature correction step . on the other hand , however , this correction procedure may decelerate the global convergence behavior of the ali iteration .",
    "the two forms of expressing the radiative equilibrium condition follow from the requirement that the energy emitted by a volume element per unit time is equal to the absorbed energy per unit time ( integral form ) : @xmath119 where scattering terms in @xmath43 and @xmath45 cancel out . in principle , this formulation is equivalent to demanding flux - constancy throughout the atmosphere ( differential form ) @xmath120 where @xmath67 ( eq.[nominal ] ) is the nominal flux . here",
    "@xmath121 is the variable eddington factor , defined as @xmath122 which is computed from the feautrier intensity @xmath123 ( eq.[udef ] ) after the formal solution .",
    "as discussed e.g.  in hubeny ( 1988 ) the differential form is more accurate at large depths , while the integral form behaves numerically superior at small depths . instead of arbitrarily selecting that depth in the atmosphere where we switch from one formulation to the other",
    ", we use a linear combination of both constraint equations , which guarantees a smooth transition with depth , based on physical grounds ( hubeny & lanz 1992 , hamann 1994 ) : @xmath124 for details on this equation and on our implementation of the unsld - lucy procedure see dreizler ( this volume ) .",
    "we note that explicit depth coupling is introduced by the differential form eq.[diff ] through the derivative @xmath125 even if a purely local @xmath17 operator is used .",
    "therefore the linearization procedure can no longer be performed independently at each depth point and the question at which boundary to start becomes relevant .",
    "numerical experience shows that it is essential to start at the outer boundary and proceed inwards .",
    "if a tri - diagonal operator is used , nearest neighbor depth coupling is introduced anyhow .",
    "we write the equation for hydrostatic equilibrium as mihalas ( 1978 , p.170 ) : @xmath126 @xmath127 is the total pressure comprising gas , radiation and turbulent pressures , so that : @xmath128 with boltzmann s constant @xmath95 and the turbulent velocity @xmath129 .",
    "the hydrostatic equation may either be solved simultaneously with all other equations or separately between iterations .",
    "the overall convergence behavior is usually the same in both cases . if taken into the linearization scheme , and a local @xmath17 operator is used , then , as in the case of the radiative equilibrium equation , explicit depth - coupling enters via the depth derivative @xmath130 .",
    "again , solution of the linearized equations must proceed inwards starting at the outer boundary .",
    "the starting value at the first depth point ( subscript @xmath131 ) is : @xmath132 where @xmath133 is the variable eddington factor denoting the ratio of @xmath134 at the surface , kept fixed during linearization .",
    "we are also able to account for element separation resulting from pressure diffusion , which is the process that governs the spectroscopic appearance e.g.  of white dwarfs .",
    "the numerical method and some results are described by dreizler & wolff ( 1999 ) and schuh ( this volume ) .      the total particle density @xmath6 is the sum of electron density plus the populations of all atomic / ionic states , in all lte and nlte levels : @xmath135 .\\ ] ] the fictitious massive - particle density @xmath10 is introduced for notational convenience .",
    "it is defined by : @xmath136 .\\ ] ] the mass of a chemical species in amu is denoted by @xmath137 . introducing the mass of a hydrogen atom @xmath138 , we may write the material density simply as @xmath139      thermal opacity and emissivity are made up by radiative bound - bound , bound - free and free - free transitions . for each species we compute and",
    "sum : @xmath140 \\nonumber\\end{aligned}\\ ] ] where the total opacity includes thomson scattering , i.e.@xmath141 , and @xmath142 .",
    "\\nonumber\\end{aligned}\\ ] ] @xmath143 denotes the cross - section for photoionization from level @xmath79 of ion @xmath111 into level @xmath95 of ion @xmath144 .",
    "the double summation over the bound - free continua takes into account the possibility that a particular level may be ionized into more than one level of the next high ion .",
    "again , note the definition of the lte population number @xmath145 in this case , which depends on the level @xmath146 of the parent ion : @xmath147 note also that the concept of lte levels ( whose occupation numbers enter , e.g.  the number- and charge - conservation equations ) in the atomic models of complex ions is therefore not unambiguous .",
    "our code always assumes that lte levels in the model atoms are populated in lte with respect to the ground state of the upper ion .",
    "the source function used for the approximate radiation transfer is @xmath148 , thus it excludes thomson scattering . for the exact formal solution of course",
    ", the total opacity @xmath43 in the expression eq.[source ] includes the thomson term ( @xmath149 ) .",
    "as high - lying atomic levels are strongly perturbed by other charged particles in the plasma they are broadened and finally dissolved .",
    "this effect is observable by line merging at series limits and must be accounted for in line profile analyses .",
    "moreover , line - overlap couples the radiation field in many lines and flux - blocking can strongly affect the global atmospheric structure .",
    "numerically , we treat the level dissolution in terms of occupation probabilities , which for lte plasmas can be defined as the ratio of the level populations to those in absence of perturbations . a phenomenological theory for these quantities",
    "was given in hummer & mihalas ( 1988 ) .",
    "the non - trivial generalization to nlte plasmas was made by hubeny ( 1994 ) . in practice",
    "an individual occupation - probability factor ( depending on @xmath150 , and principal quantum number ) , is applied to each atomic level , which describes the probability that the level is dissolved .",
    "furthermore , the rate equations eq.[rates ] must be generalized in a unique and unambiguous manner .",
    "for details see hubeny ( 1994 ) .",
    "in all constraint equations described above the mean intensities @xmath104 are replaced by the approximate radiation field eq.[ali ] in order to eliminate these variables from the solution vector eq.[psi1 ] . in principle",
    "the alo may be of arbitrary form as long as the iteration procedure converges . in practice , however , an optimum choice is desired in order to achieve convergence with a minimum amount of iteration steps .",
    "the history of the alos is interesting , and was summarized in detail by hubeny ( 1992 ) . of utmost importance were two papers by olson and collaborators ( olson 1986 , olson & kunasz 1987 ) who overcame the major drawback of early alos , namely the occurrence of free parameters controlling the convergence process , and thus found the optimum choice of alos .",
    "our model atmosphere program permits the use of either a diagonal or a tri - diagonal alo , both are set up following olson & kunasz ( 1987 ) .      in this case the mean intensity @xmath151 at a particular depth @xmath11 in the current iteration step is computed solely from the local source function @xmath152 and a correction term @xmath153 , the latter depending on the source functions ( at all depths ) from the previous iteration . dropping the iteration count and introducing indices denoting depth points we can rewrite eq.[ali ] as : @xmath154 in discrete form we can think of @xmath17 as a matrix acting on a vector whose elements comprise the source functions of all depths",
    ". then @xmath155 is the diagonal element of the @xmath17 matrix corresponding to depth point @xmath11 .",
    "writing @xmath156 ( for numerical computation see eq.[matrix ] below ) we have a purely local expression for the mean intensity : @xmath157      much better convergence is obtained if the mean intensity is computed not only from the local source function , but also from the source function of the neighboring depths points .",
    "then the matrix representation of @xmath17 is of tri - diagonal form and we may write : @xmath158 where @xmath159 and @xmath160 represent the upper and lower subdiagonal elements of @xmath17 , and @xmath161 the source functions at the adjacent depths . by analogy the correction term becomes : @xmath162 again all quantities for the computation of @xmath153 are known from the previous iteration , and the first term gives the exact formal solution of the transfer equation .",
    "we emphasize again that the source functions in eq.[trij ] are to be computed from the correct occupation numbers and temperature , all of which are still unknown .",
    "we therefore have a non - linear set of equations for these quantities , which must be solved by either newton - raphson iteration or other techniques , resulting in the solution of a tri - diagonal linear equation of the form eq.[tri ] .",
    "as was shown in olson ( 1986 ) the elements of the optimum @xmath17 matrix are given by the corresponding elements of the exact @xmath5 matrix .",
    "the diagonal and subdiagonal elements are computed following olson & kunasz ( 1987 ) : @xmath163 with @xmath164 . at large optical depths with increasing @xmath165 steps ( the depth grid is roughly equidistant in @xmath166 ) the subdiagonals @xmath160 and @xmath159 vanish , and the diagonal @xmath167 approaches unity , reflecting the fact that the radiation field is more and more determined by local properties of the matter",
    ". at very small optical depths all elements of @xmath17 vanish , reflecting the non - localness of the radiation field at these depths .",
    "our code takes advantage of an acceleration scheme to speed up convergence of the iteration cycle eq.[ali ] .",
    "we implemented the scheme originally proposed by ng ( 1974 ) and later by auer ( 1987 ) .",
    "it extrapolates the correction vector @xmath22 from the previous three iterations . from our experience",
    "the extrapolation often yields over - corrections , resulting in alternating convergence or even divergence .",
    "in contrast , use of a tri - diagonal alo usually results in satisfactorily fast convergence , so that the acceleration scheme is rarely used .",
    "at each depth the complete set of non - linear equations eq.[ali ] for a single iteration step comprises the equations for statistical , radiative , and hydrostatic equilibrium , and the particle - conservation equation . for the numerical solution",
    "we introduce discrete depth and frequency grids .",
    "the equations are then linearized and solved by a suitable iterative scheme .",
    "explicit angle - dependence of the radiation field is not required here and is consequently eliminated by the use of variable eddington factors . angle dependence is considered only in the formal solution of the transfer equation . our program requires an input model - atmosphere structure as a starting approximation , together with an atomic data file , and a frequency grid .",
    "depth and frequency grids are therefore set up in advance by separate programs .      after a depth - grid is chosen , we start by computing a gray lte continuum model using the unsld - lucy temperature - correction procedure",
    ". depth points ( typical number is 90 ) are chosen in equidistant steps on a logarithmic ( rosseland ) optical depth scale .",
    "the converged lte model ( temperature and density structure , given on a column mass depth scale ) is written to a file that is read by pro2 .",
    "the nlte code uses the column mass as an independent depth variable .",
    "the frequency grid is determined by the atomic - data input file .",
    "frequency points are set blue- and red - ward of each absorption edge , and for each spectral line .",
    "gaps are filled up by setting continuum points . finally , the quadrature weights are computed .",
    "frequency integrals appearing e.g.  in eq.[combi ] are replaced by quadrature sums , and depth derivatives by difference quotients .",
    "all variables @xmath168 are replaced by @xmath169 where @xmath170 denotes a small perturbation of @xmath168 .",
    "terms not linear in these perturbations are neglected .",
    "the perturbations are expressed by perturbations of the basic variables : @xmath171 as an illustrative example we linearize the equation for radiative equilibrium .",
    "most other linearized equations may be found in werner ( 1986 ) .",
    "assigning two indices ( @xmath11 for depth and @xmath79 for frequency of a grid with nf points ) to the variables and denoting the quadrature weights with @xmath172 eq.[combi ] becomes : @xmath173+\\delta\\chi{_{di}}[s{_{di}}-j{_{di } } ] )   + { \\bar\\lambda_j^\\star}\\sum_{i=1}^{nf }   \\frac{w_i}{\\delta\\tau_i}(\\delta j{_{di } } f{_{di}}-\\delta j{_{d-1,i } } f{_{d-1,i } } ) \\nonumber\\ ] ] @xmath174 note that we do not linearize @xmath175 .",
    "because of this , convergence properties may deteriorate significantly in some cases .",
    "perturbations @xmath176 are expressed by eq.[deltax ] , and the perturbation of the mean intensity @xmath177 is , according to eq.[trij ] , given through the perturbations of the source function at the current and the two adjacent depths : @xmath178 where @xmath179 are the @xmath5 matrix elements from eq.[matrix ] .",
    "the @xmath180 contain the term @xmath181 which is neglected because we want to account only for nearest neighbor coupling .",
    "we write @xmath182 with the help of eq.[deltax ] and observe that for any variable @xmath183 : @xmath184 derivatives of opacity and emissivity with respect to temperature , electron and population densities are computed from analytical expressions ( see e.g.  mihalas 1975 , werner 1987 ) .",
    "we finally get from eq.[lin ] : @xmath185 \\right.\\nonumber \\\\   & & \\left.+{\\bar\\lambda_j^\\star}\\sum_{i}^{nf}\\frac{w_i}{\\delta\\tau_i}(f{_{di } } b{_{di}}-f{_{d-1,i } } a{_{di } } ) \\frac{\\partial s{_{di}}}{\\partial t } \\right\\}+ \\nonumber\\\\   & & % \\hspace{-1 cm }   \\delta t{_{d+1,i}}\\left\\ { \\sum_{i}^{nf}-\\frac{w_i}{\\bar\\kappa_j } \\frac{\\partial s{_{d+1,i}}}{\\partial t}\\chi{_{di } } a{_{d+1,i } } \\right.\\nonumber \\\\ & & \\left .",
    "+ { \\bar\\lambda_j^\\star}\\sum_{i}^{nf}\\frac{w_i}{\\delta\\tau_i } ( f{_{di } } a{_{d+1,i}}-f{_{d-1,i } } b{_{d+1,i}})\\frac{\\partial s{_{d+1,i}}}{\\partial t } \\right\\}+ \\nonumber \\\\ & & % \\hspace{-1 cm }   \\delta n_{e_{d-1,i}}\\{\\cdots\\ }      + \\delta n_{e_{d , i}}\\{\\cdots\\ }      + \\delta n_{e_{d+1,i}}\\{\\cdots\\}+ \\nonumber \\\\ & & % \\hspace{-1 cm }   \\sum_{l=1}^{nl}\\delta n_{l_{d-1,i}}\\{\\cdots\\ }      + \\sum_{l=1}^{nl}\\delta n_{l_{d , i}}\\{\\cdots\\ }      + \\sum_{l=1}^{nl}\\delta n_{l_{d+1,i}}\\{\\cdots\\ } \\nonumber \\\\   &   & % \\hspace{-1 cm }   = { \\rm r.h.s.}\\end{aligned}\\ ] ] the curly brackets @xmath186 denote terms that are similar to those multiplied by perturbations of the temperature . instead of partial derivatives with respect to @xmath7 ,",
    "they contain derivatives with respect to @xmath8 and the populations @xmath187 .",
    "they all represent coefficients of the matrices @xmath25 in eq.[tri ] .",
    "as described in sect.[eins2 ] the linearized equations have a tri - diagonal block - matrix form , see eq.[tri ] .",
    "inversion of the grand matrix ( @xmath188 sized @xmath189 , i.e.  about @xmath190 in typical applications ) is performed with a block - gaussian elimination scheme , which means that our iteration of the non - linear equations is a multi - dimensional newton - raphson method . the problem is structurally simplified when explicit - depth coupling is avoided by the use of a local alo , however , the numerical effort is not reduced much , because in both cases the main effort lies with the inversion of matrices sized @xmath26 .",
    "the newton - raphson iteration involves two numerically expensive steps , first setting up the jacobian ( comprising @xmath25 ) and then inverting it .",
    "additionally , the matrix inversions in eq.[feau ] limit their size to about @xmath191 because otherwise numerical accuracy is lost .",
    "two variants recently introduced in stellar atmosphere calculations are able to improve both numerical accuracy and , best of all , computational speed .",
    "broyden s ( 1965 ) variant belongs to the family of quasi - newton methods ; it was first used in model - atmosphere calculations in dreizler & werner ( 1991 ) , hamann 1991 , koesterke ( 1992 ) .",
    "it avoids the repeated set - up of the jacobian by the use of an update formula .",
    "in addition , it also gives an update formula for the _ inverse _ jacobian . in the case of a local alo",
    "the solution of the linearized system at any depth is : @xmath192 let @xmath193 be the @xmath95-th iterate of the inverse jacobian , then an update can be found from : @xmath194 where @xmath195 denotes the dyadic product , and where we have defined : @xmath196 the convergence rate is super - linear , i.e.  slower than the quadratic rate of the newton - raphson method ; but this is more than compensated by the tremendous speed - up for a single iteration step .",
    "it is not always necessary to begin the iteration with the calculation of an exact jacobian and its inversion .",
    "experience shows that in an advanced stage of the overall ( ali- ) iteration eq.[ali ] ( i.e.  when corrections become small , of the order 1% ) we can start the linearization cycle eq.[xxx ] by using the inverse jacobian from the previous overall iteration .",
    "computational speed - up is extreme in this case , however , it requires storage of the jacobians of all depths .",
    "more difficult is its application to the tri - diagonal alo case .",
    "here we have to update the grand matrix @xmath197 which , as already mentioned , is of block tri - diagonal form .",
    "we can not update its inverse , because it is never computed explicitly .",
    "furthermore we need an update formula that preserves the block tri - diagonal form which is a prerequisite for its inversion by the feautrier scheme eq.[feau ] .",
    "such a formula was found by schubert ( 1970 ) : @xmath198 where @xmath199 with the structure matrix @xmath200 as defined by : @xmath201 the vectors @xmath202 and @xmath203 are defined as above but now they span quantities over all depth instead of a single depth point . with this formula",
    "we obtain new submatrices @xmath25 and @xmath204 with which the feautrier scheme eq.[feau ] is solved again .",
    "this procedure saves the computation of derivatives .",
    "another feature realized in our program also saves the repeated inversion of @xmath205 by updating its inverse with the broyden formula eq.[xxx ] .",
    "similar to the diagonal alo case it is also possible to pass starting matrices from one overall iteration eq.[ali ] to the next for the update of @xmath206 and the matrix @xmath207 . in both cases",
    "the user specifies two threshold values for the maximum relative correction in @xmath208 which cause the program to switch from newton - raphson to broyden stages 1 and 2 . during stage 1 , each new overall cycle eq.[ali ] is started with an exact calculation and inversion of all matrices involved , and in stage 2 these matrices are passed through each iteration .",
    "another variant , the kantorovich ( 1949 ) method has been introduced into model - atmosphere calculations ( hubeny & lanz 1992 ) .",
    "it is more simple and straightforward to implement .",
    "this method simply keeps the jacobian fixed during the linearization cycle ; it is surprisingly stable .",
    "in fact it turns out to be even more stable ( i.e.  it can be utilized in an earlier stage of iteration ) than the broyden method in the tri - diagonal alo case .",
    "the user of pro2 may choose this variant in two stages in analogy to the broyden variant .",
    "it was found that in stage 2 it is necessary to update the jacobian every 5 to 10 overall iterations in order to prevent divergence .",
    "despite the increase in capacity for solving nlte model - atmosphere problems given by the ali method combined with pre - conditioning techniques , the blanketing by millions of lines from the iron - group elements arising from transitions among some @xmath209 levels can be attacked only with statistical methods .",
    "these were introduced into nlte model - atmosphere work by anderson ( 1989 , 1991 ) . at the outset",
    ", model atoms are constructed by combining many thousands of levels into a relatively small number of _ superlevels _ which can be treated by ali ( or other ) methods .",
    "then , in order to reduce the computational effort , two approaches were developed which vastly decrease the number of frequency points ( hence the number of transfer equations to be solved ) needed to describe properly the complex frequency dependence of the opacity .",
    "these two approaches have their roots in lte modeling techniques , where statistical methods are applied for the same reason in the treatment of opacity : the opacity distribution function ( odf ) and opacity sampling ( os ) approaches .",
    "both are based on the fact that the opacity ( in the lte approximation ) is a function of two only local thermodynamic quantities .",
    "roughly speaking , each opacity source can be written in terms of a population density and a photon cross - section for the respective radiative transition : @xmath210 . in lte",
    "the population follows from the saha - boltzmann equations , hence @xmath211 .",
    "the os and odf methods use such pre - tabulated ( on a very fine frequency mesh ) @xmath212 during the model atmosphere calculations .",
    "the nlte situation is more complicated , because pre - tabulation of opacities is not useful .",
    "the occupation numbers at any depth now also depend explicitly on the radiation field ( via the rate equations which replace the te saha - boltzmann statistics ) and thus on the populations in every other depth of the atmosphere . as a consequence , the os and odf methods",
    "are not applied to opacity tabulations , but to tabulations of the photon cross - sections @xmath213 .",
    "these do depend on local quantities only , e.g.  line broadening by stark- and doppler - effects is calculated from @xmath7 and @xmath8 . in the nlte case cross - sections take over the role which the opacity played in the lte case .",
    "so , strictly speaking , the designation os and odf is not quite correct in the nlte context .",
    "the strategy in our code is the following .",
    "before any model atmosphere calculation is started , the atomic data are prepared by constructing superlevels , and the cross - sections for superlines .",
    "then these cross - sections are either sampled on a coarse frequency grid or odfs are constructed .",
    "these data are put into the model atom which is read by the code .",
    "the code does not know if os or odfs are used , i.e.  it is written to be independent of these approaches .",
    "further details about our implementation are described in dreizler & werner ( 1993 ) , haas ( 1996 ) , werner & dreizler ( 1999 ) , and by rauch & deetjen in this volume .",
    "we have presented in detail our technique for numerical solution of the classical model - atmosphere problem .",
    "the construction of metal - line - blanketed models in hydrostatic and radiative equilibrium under nlte conditions was the last and longest - standing problem of classical model atmosphere theory .",
    "it has finally been solved with a high degree of sophistication .",
    "the essential milestones for this development , starting from the pioneering work of auer & mihalas ( 1969 ) are :    * introduction of accelerated lambda iteration ( ali , or `` operator splitting '' ) methods , based upon early work by cannon ( 1973 ) and scharmer ( 1981 ) .",
    "the first ali model atmospheres were constructed by werner ( 1986 ) . *",
    "introduction of statistical approaches to treat the iron - group elements in nlte by anderson ( 1989 , 1991 ) .",
    "* linear formulation of the statistical - equilibrium equations ( rybicki & hummer 1991 , hauschildt 1993 ) .",
    "* computation of atomic data by kurucz ( 1991 ) , by the opacity project ( seaton 1994 ) and subsequent improvements , and by the iron project ( hummer 1993 ) .",
    "anderson , l. s. 1989 , apj , 339 , 558 anderson , l. s. 1991 , in stellar atmospheres : beyond classical models , nato asi series c , vol .",
    "l. crivellari , i. hubeny & d. g. hummer , ( dordrecht : kluwer ) , 29 auer , l. h. 1987 , in numerical radiative transfer , ed .",
    "w. kalkofen , cambridge university press , 101 auer , l. h. , & mihalas , d. 1969 , apj , 158 , 641 broyden , c. g. 1965 , math . comp .",
    ", 19 , 577 cannon , c. j. 1973 , apj , 185 , 621 dreizler , s. , & werner , k. 1991 , in stellar atmospheres : beyond classical models , nato asi series c , vol .",
    "l. crivellari , i. hubeny & d.g .",
    "hummer , ( dordrecht : kluwer ) , 155 dreizler , s. , & werner , k. 1993 , a&a , 278 , 199 dreizler , s. , & wolff , b. 1999 , a&a , 348 , 189 feautrier , p. 1964 , c. r. acad .",
    "paris , 258 , 3189 haas , s. , dreizler , s. , heber , u. , jeffery , s. , & werner , k. 1996 , a&a , 311 , 669 hamann , w .- r .",
    "1994 , private communication hamann , w .- r . , koesterke , l. , & wessolowski , u. 1991 , in stellar atmospheres : beyond classical models , nato asi series c , vol .",
    "l. crivellari , i. hubeny & d.g .",
    "hummer , ( dordrecht : kluwer ) , 69 hauschildt , p. h. 1993 , jqsrt , 50 , 301 hauschildt , p. h. , & baron , e. 1999 , in computational astrophysics , ed . h. riffert & k. werner , journal of computational and applied mathematics , 109 , 41 hubeny , i. 1988 , comput .",
    "commun . , 52 , 103 hubeny , i. 1992 , in atmospheres of early - type stars , ed .",
    "u. heber & c.s .",
    "jeffery , lecture notes in physics vol .",
    "401 , ( berlin : springer ) , 377 hubeny , i. , & lanz , t. 1992 , a&a , 262 , 501 hubeny , i. , & lanz , t. 1995 , apj , 439 , 875 hubeny , i. , hummer , d. g. , & lanz , t. 1994 , a&a , 282 , 157 hummer , d. g. , & mihalas , d. 1988 , apj , 331 , 794 hummer , d. g. , berrington , k. a. , eissner , w. , pradhan , a. k. , saraph , h. e. , & tully , j. a. 1993 , a&a , 279 , 298 kantorovich l. v. 1949 , trudy mat .",
    "steklova , xxviii , 104 koesterke , l. , hamann , w .- r .",
    ", & kosmol , p. 1992 , a&a , 255 , 490 kurucz , r. l. 1991 , in stellar atmospheres : beyond classical models , nato asi series c , vol .",
    "l. crivellari , i. hubeny & d.g .",
    "hummer , ( dordrecht : kluwer ) , 441 lucy , l. b. 1964 , in first harvard smithsonian conference on stellar atmospheres , smithsonian astrophysical observatory special report no .",
    "167 , cambridge , massachusetts , 93 mihalas , d. 1978 , stellar atmospheres , 2nd edition , ( san francisco : freeman ) mihalas , d. , & hummer , d. g. 1973 , apj , 179 , 827 mihalas , d. , & hummer , d. g. 1974 , apjs , 265 , 343 mihalas , d. , auer , l. h. , & heasley , j. n. 1975 , ncar technical note str-104 , ( boulder : national center for atmospheric research ) nagel , t. , dreizler , s. , & werner , k. 2001 , in white dwarfs , ed .",
    "j. l. provencal , h. l. shipman , j. macdonald & s. goodchild , asp conf .",
    "226 , ( san francisco : asp ) , 86 ng , k. c. 1974 , j. chem .",
    "phys . , 61 , 2680 olson , g. l. , & kunasz , p. b. 1987 , jqsrt , 38 , 325 olson , g. l. , auer , l. h. , & buchler , j. r. 1986 , jqsrt , 35 , 431 rybicki , g. b. 1972 in line formation in the presence of magnetic fields , ed .",
    "r. g. athay , l. house & g. newkirk , jr . , ( boulder : high altitude observatory ) , 145 rybicki , g. b. , & hummer , d. g. 1991 , a&a , 245 , 171 scharmer , g. b. 1981 , apj , 249 , 720 scharmer , g. b. , & nordlund , a. 1982 , stockholm observatory report 19 schubert , l. k. 1970 , math .",
    ", 24 , 27 seaton , m. j. , yan , y. , mihalas , d. , & pradhan , a. k. 1994 , mnras , 266 , 805 werner , k. 1986 , a&a , 161 , 177 werner , k. 1987 , phd thesis , universitt kiel werner , k. 1989 , a&a , 226 , 265 werner , k. , & husfeld , d. 1985 , a&a , 148 , 417 werner , k. , & dreizler , s. 1999 , in computational astrophysics , ed . h. riffert & k. werner , journal of computational and applied mathematics , 109 , 65"
  ],
  "abstract_text": [
    "<S> we address the classical stellar - atmosphere problem and describe our method of numerical solution in detail . </S>",
    "<S> the problem consists of the solution of the radiation transfer equation under the constraints of hydrostatic , radiative and statistical equilibrium ( non - lte ) . </S>",
    "<S> we employ the accelerated lambda iteration ( ali ) technique , and use statistical methods to construct non - lte metal - line - blanketed model - atmospheres . </S>"
  ]
}