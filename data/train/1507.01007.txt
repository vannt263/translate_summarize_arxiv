{
  "article_text": [
    "the growth of planets out of km - sized planetesimals remains an attractive scenario for both terrestrial planet formation and , in the core accretion model , also as a necessary step in the creation of gas giant planets .",
    "nevertheless - regardless of whether these planetesimals form by direct gravitational collapse or agglomerative growth - there are a number of problems associated with the formation and retention of planetesimals in protoplanetary discs ( for a recent review of the subject see @xcite ) .",
    "for example , although there is observational evidence at mm and cm wavelengths for rather rapid grain growth @xcite , agglomerative growth beyond @xmath3 cm - sizes is inefficient , since collisions tend to result in fragmentation or bouncing rather than sticking and grain growth .",
    "particles in this size range are said to be ` critically coupled ' to the disc gas , having values of the stokes number ( st : the ratio of the timescale for gas drag to the dynamical time ) of around unity .",
    "drag causes such particles to lose angular momentum to the gas ( which orbits at slightly sub - keplerian velocity on account of being partially supported by outwardly directed pressure gradients ) and to drift towards the star on time - scales of 100 to 1000 orbits @xcite .",
    "once the drifting particles reach the snow - line they will sublimate , enhancing the local density in vapour form @xcite , removing most of the solids from the outer disc within @xmath4 @xcite .    the loss of solids by radial drift can potentially be overcome if pressure does not increase monotonically with decreasing radius in the disc and if instead some process can create and sustain local pressure maxima . in this case solid material can be trapped at the maximum ( since regions of outwardly increasing pressure drive outward migration of solids by the same argument ) .",
    "for example , the pressure maxima at the outer edge of gaps formed by massive planets have been proposed as an effective dust trap @xcite , and this has been invoked to explain the asymmetric dust around oph irs 48 @xcite . during the early phase of protoplanetary disc evolution , while the disc is still massive enough that gas self - gravity is important , spiral structures may likewise slow or halt the radial drift of dust grains , concentrating dust in the pressure maxima associated with spiral arms @xcite . if this focusing of dust into the spiral arms can raise its density by two orders of magnitude then it becomes the dominant mass component locally and direct gravitational collapse in the dust layer - creating km scale planetesimals - may ensue .",
    "if planetesimals do form in self - gravitating discs , then the spiral structure will drive eccentricities to @xmath5 .",
    "the high velocity dispersion ( and hence suppression of gravitational focussing ) renders collisions negligible and hence planetesimals should survive the self - gravitating phase @xcite .",
    "planetesimal formation is most likely to occur at radii greater than @xmath6 , where the relatively short cooling time is linked to a larger amplitude of spiral structure @xcite .",
    "the direct conversion of grains that are critically coupled ( with size 1  10@xmath7 in this region of a self - gravitating disc ) into planetesimals offers the attractive prospect of by - passing the problems of agglomerative growth over intermediate size scales .    since the mechanism requires a significant fraction of the dust to be in large grains that have a stokes number , @xmath8 , the success of this model depends on their survival during the self - gravitating phase .",
    "their survival is sensitive to relative velocity of collisions between particles , since collisions with velocities greater than 1  10@xmath9 result in fragmentation @xcite .",
    "since @xcite found velocity dispersions of order the sound speed , which is approximately @xmath10 at @xmath11 , collisions may destroy the grains before a sufficient density has been built up for collapse to occur .",
    "the results of competing grain growth and fragmentation processes require detailed knowledge of the velocity distributions of the dust grains during the self - gravitating phase , and this remains uncertain .",
    "in particular , early simulations of self - gravitating discs were studied using smoothed particle hydrodynamics ( sph ) , which had problems related to the need to reduce artificial viscosity in order to avoid a situation where the heating by the gravitational instability is exceeded by the action of artificial viscosity on keplerian shear @xcite .",
    "the amount of artificial viscosity in sph is typically controlled by two parameters , @xmath12 and @xmath13 , which govern artificial viscosity terms that are linear and quadratic in the relative velocity , respectively . to reduce the viscosity",
    "often @xmath12 was reduced by an order of magnitude from the typical values of @xmath14 and sometimes @xmath13 was also reduced @xcite .",
    "subsequently it has been shown that such a choice fails to generate enough entropy in shocks and results in considerable noise in the gas velocities ( @xcite ; see also @xcite and @xcite who suggest @xmath15 , even for weak shocks ) .",
    "the velocity noise is likely to be transmitted to the dust component via drag forces and this means it is not entirely clear that the velocity dispersion measured in a simulation is physical .",
    "recent shearing - box simulations go some way towards addressing the issue @xcite and also find a velocity dispersion of dust particles over the entire box of @xmath16 .",
    "however , the collision velocities are sensitive to the correlation structure in the velocity distribution , a quantity that has not been derived from these simulations .    with recent developments in computational techniques , accurate simulations of the dynamics of gas - dust mixtures are within reach @xcite .",
    "however , while there have been significant efforts to verify codes involving the simulations of turbulence and the streaming instability ( e.g. * ? ? ?",
    "* ) , there have been few ways to verify that codes capture the velocity distribution of solids in the context of self - gravitating discs .    in this work",
    "we conduct a series of tests that can be used to assess code performance in this respect . while some of these ( e.g. the dustybox and dustyshock tests described in @xcite ) have previously been used in this way , we also introduce two tests that have not previously been examined with respect to the modelling of coupled dust .",
    "these two tests involve shocks in 2d : the implosion test of @xcite and the modelling of a rigidly rotating spiral mode in an isothermal gas disc @xcite .",
    "the latter in particular was chosen because it bears some resemblance to the problem of interest ( since it involves centrifugally supported gas interacting with a pattern of spiral shocks ) but - unlike the _ self-_gravitating disc problem - is amenable to an analytic solution for the gas that is steady in the co - rotating frame .",
    "for each test we quantify the velocity structure in the dust and how this is affected by a range of numerical choices .",
    "finally , we summarise our conclusions in terms of a set of recommendations and requirements for the simulation of dust in self - gravitating protoplanetary discs .",
    "the dynamics of solids in protoplanetary discs is governed by the interplay of drag forces with keplerian motion .",
    "the force on a solid particle of mass @xmath17 is given by @xmath18 and the corresponding equation for the gas is @xmath19 where @xmath20 and @xmath21 are the local gas dust and gas velocities , @xmath22 , and @xmath23 are their respective densities , @xmath24 is the gas pressure and @xmath25 and @xmath26 are additional accelerations .",
    "these have been made distinct for the gas and dust to allow for forces that affect both phases , such as gravity and those that only affect a single phase , like viscosity . in these equations",
    "@xmath27 refers to the full lagrangian derivative in the frame moving with the gas or dust .",
    "the drag coefficient , @xmath28 , depends on the reynolds number , gas density and temperature , which can vary significantly over the different gas and grain properties found in astrophysical problems .",
    "the stopping time , @xmath29 , can be defined as the time over which the velocity difference @xmath30 decays , @xmath31 , giving @xmath32 for negligible dust densities , @xmath33 , this is equal to the stopping time for a single dust particle , @xmath34 . in protoplanetary discs",
    "an approximation for the drag coefficient by @xcite is generally used . for small grains , where the grain size , @xmath35 , is less than the mean free path , @xmath36",
    ", the drag force can be calculated using the epstein approximation @xmath37 where @xmath38 , @xmath39 is the gas temperature , @xmath40 is the boltzmann constant and @xmath41 is the mean - molecular weight . for @xmath42 ,",
    "the drag force can be calculated in the stokes regime , @xmath43 the coefficient @xmath44 can be approximated by @xmath45 where , @xmath46 is the reynold s number of the fluid and @xmath47 is the molecular viscosity of the gas . typically in astrophysical applications @xmath33 . in these circumstances",
    "the effect of drag forces on the gas can be neglected and the dust particles can be considered as test particles , with @xmath48 . while there are interesting astrophysical problems in which non - negligible dust density is required , such as the streaming instability @xcite , the test - particle limit has the advantage of allowing comparison between the simulations and analytical solutions .",
    "furthermore , it allows a more direct comparison with work on self - gravitating protoplanetary discs , in which the test particle limit was used ( c.f . * ? ? ?",
    "? * ; * ? ? ?",
    ".      a number of different approaches to including the mutual dynamics of gas and solids in sph have been proposed , which can be broadly separated into single - fluid or two - fluid approaches @xcite . in",
    "two - fluid approaches the gas and solids are integrated by including separate particle types for the gas and dust grains , while the single - fluid approach considers the dust fraction @xmath49 and relative velocity @xmath50 to be properties of the sph particles and solves equations for these quantities on an unstructured mesh made up of the sph particles .    in the case of high dust to gas ratios , where momentum feedback on the gas from the dust is important @xcite have shown that it is essential that all length scales in the problem are resolved for both the gas and dust treatments , which places a requirement on traditional two - fluid approaches that the smoothing length , @xmath51 , where @xmath52 is the sound - speed .",
    "single fluid approaches appear to avoid this difficulty , but they do so at the cost of the full phase - space information , since only one velocity each of the gas and dust components can be known at each point in space .",
    "conversely , the two - fluid approach is able to capture full phase space information . in the test particle",
    "limit the motions of the dust particles are independent of each other and thus their motions can be calculated accurately as long as the relevant scales in the gas are resolved .",
    "thus the criterion @xmath51 does not apply unless the gas varies on these scales . @xcite",
    "have shown this idea holds in general for low dust - to - gas ratios .",
    "since the full phase - space is essential for evaluating the collisions between grains and the growth of planetesimals , we take a two - fluid approach , which we implement into the sph code gadget-2 @xcite .",
    "the two - fluid method has been implemented either by considering pair - wise forces between gas and dust particles @xcite , or by interpolating the gas properties to location of the dust @xcite . when back - reaction is included pair - wise forces",
    "are preferable , since they explicitly conserve angular momentum .",
    "however , for the test - particle limit we find a similar performance for both methods ( see appendix [ sec : appendimpl ] ) .",
    "we take the approach of interpolating the gas properties to the location of the dust particles , since it is less sensitive to the underlying gas particle distribution .",
    "the gas properties are interpolated to the location of each dust particle using a kernel sum . for a property @xmath53 , where each gas particle has the value @xmath54 , its value at the location of a dust particle @xmath55 can be evaluated via @xmath56 where @xmath57 , @xmath58 , @xmath59 and @xmath60 are the position , mass and density and quantity to be interpolated evaluated at the location of the @xmath61th gas particle , and @xmath62 is the smoothing kernel .",
    "the sum is over the gas particles neighbouring the dust particles and smoothing length , @xmath63 , is set in the same way as for the gas particles , by solving @xmath64 for @xmath63 at the location of the dust particle @xmath65 .",
    "the factor @xmath66 is the volume of the kernel , in three dimensions @xmath67 and @xmath68 ; and @xmath69 is the desired number of neighbours .",
    "the smoothing length and interpolated gas properties are evaluated for all active dust particles after the gas density has been calculated .",
    "as a default choice for the kernel , @xmath70 , we use the standard cubic - spline kernel and choose @xmath71 . in some tests we also consider wendland kernels .",
    "we note this is contrary to recommendation of @xcite , but as shown by the tests in the following section , this choice generates the expected forces .",
    "time integration for gas particles in gadget-2 uses a kick - drift - kick leapfrog algorithm , in which the gas velocities and positions are updated alternatively .",
    "the positions , @xmath72 , and velocities , @xmath73 at time @xmath74 are advanced to time @xmath75 via @xmath76 where the total accelerations @xmath77 are evaluated at positions @xmath78 .",
    "the leap - frog scheme is a symplectic , time - reversible integrator for hamiltonian mechanics , which has the advantage that for closed orbits the energy error can neither grow or decrease , resulting in excellent long term stability even when the truncation error of a single step is relatively high .    for dust particles with @xmath79 , which follow weakly perturbed keplerian orbits ,",
    "the leap - frog integrator is a natural choice .",
    "however , for @xmath80 explicit time integration schemes require very small time steps .",
    "since in these cases @xmath29 is much shorter than any other time - scale in the problem , this suggests the use of implicit , or semi - implicit approaches that allow @xmath81 .",
    "@xcite extend this idea by using the analytical solution in an operator - split approach .",
    "they suggest initially updating the velocities according to non - drag forces and subsequently applying the drag .",
    "the first step is @xmath82 where from here we drop the explicit @xmath83 on @xmath84 and @xmath85 .",
    "the drag forces are applied making use of the analytical solution for relative velocity , @xmath86 , which can be derived in the absence of external forces . for linear drag laws",
    "this gives @xmath87 writing @xmath88 , this generates the final dust velocity via @xmath89 which is valid in the test particle limit .",
    "@xmath81 leads to @xmath90 .",
    "this property means that although the scheme is stable for all time - steps , it does not produce the correct terminal velocity unless @xmath91 . to see this",
    "consider a static atmosphere in which the external forces include only constant gravity , @xmath92 . for a static atmosphere",
    "both gas velocity and acceleration must be zero , with pressure balancing gravity , @xmath93 . for large time - steps @xmath94 and @xmath95 , which is not the analytical solution , @xmath96 .",
    "instead , we approximate @xmath20 as constant in both time and space during the time - step , giving rise to the dust kick @xmath97 which is exact for static atmospheres and uniform flow for all @xmath98 and reproduces the short friction time limit .",
    "this approximation is as good as the approximation that @xmath99 and @xmath100 are constant . only when both the pressure gradients and external forces are zero do the analytical solution and operator split time - steps produce equivalent kicks .    in some cases",
    "it may be beneficial to take into account the effect of motion of the gas on the update for @xmath101 ( since uniform gas motion is already taken into account in equation [ eqn : exactlin ] ) .",
    "the full equation of motion for @xmath101 in a frame moving with the dust is @xmath102 where the last term takes into account the relative advection between the dust and gas ( see equation 27 of @xcite ) .",
    "while the advection could be calculated , there are many situations in which equation [ eqn : dragimplicit ] represents an improvement . in the cases where the relative advection term is important , it will be adequately controlled by the courant - like condition because the velocity should not vary significantly on scales of order of the smoothing length in resolved flow .",
    "the exception to this is at shocks , where all schemes are limited to first order anyway .",
    "] , neglecting it and approximating the forces as constant during a time - step gives @xmath103 the utility of this approximation can be seen by looking at the limits @xmath104 and @xmath105 . in the first limit , @xmath94 and the dust velocity reduces to the short friction time limit , but using the updated gas velocity . for the @xmath106 ,",
    "the dust velocity becomes exactly the updated gas velocity . in the second limit , @xmath107 and",
    "the dust kick reduces to the explicit update for the dust .",
    "since the approximation of constant @xmath108 , @xmath109 and @xmath110 better reflects assumptions made for the integration of the equations of motion for the gas , we recommend the use of equation [ eqn : dragimplicit ] . however , in practice we have used equation [ eqn : exactlin ] in the results presented .",
    "our tests have shown that the difference in the results presented is small , because in general the sph forces and interpolation dominate the error .    to demonstrate the accuracy of the time - stepping schemes , we show the @xmath111 error norm for the velocity in fig .",
    "[ fig : tstepconv ] for two tests in which we have prescribed a total gas acceleration @xmath112 . in the first we used a 1d forced oscillation , @xmath113 and we integrated both the gas and dust using the leap - frog schemes . for the second test we used a travelling wave @xmath114 , but integrated only the dust using the leap - frog scheme at the location of the dust .",
    "we show the full problem using interpolation and sph forces in section  [ sec : dustywave ] . ] .",
    "the two tests are chosen to highlight the effect of neglecting the relative advection term , which is identically zero in the first example . for the parameters we have used @xmath115 , @xmath116 , and a stopping time of @xmath117 . for the @xmath111 error norm , we use @xmath118^{1/2},\\ ] ]",
    "where , for the forced oscillation we used the analytical solution for @xmath119 , and a high accuracy numerical solution for the travelling wave .",
    "for the range of number steps shown , both the regimes @xmath91 and @xmath81 are tested , which corresponds to @xmath120 and @xmath121 for these parameters .",
    "we see that in both cases equation [ eqn : exactlin ] produces a first order scheme , while equation [ eqn : dragimplicit ] is a second order scheme .",
    "if an explicit update for the dust velocity had been used , then for @xmath122 the integration would have lead to significant error .",
    "however , as the stopping time decreases the power of our scheme becomes apparent , since we find essentially the same error regardless of stopping time with our scheme , and an accuracy of 0.1 per cent can be achieved with 100 steps .",
    "many more steps would be needed for tightly coupled particles ( @xmath123 ) and an explicit scheme .",
    "one of the main attractions of our scheme is the ability to accurately reproduce the forces in poorly resolved flows , i.e. those with @xmath124 .    for non - linear drag laws expressions equivalent to equations [ eqn : exactlin ] and [ eqn : dragimplicit ]",
    "can not be expressed in terms of elementary functions , except in the case @xmath125 ( although see @xcite for the case of quadratic drag laws ) . in this case",
    "the only options are explicit integration or an operator split approach . in protoplanetary discs",
    "the transition to non - linear drag regimes occurs for particle sizes @xmath126 , where @xmath127 is the ratio of the disc mass to the minimum mass of the solar nebula @xcite .",
    "since these particles have @xmath128 , the time - steps are limited by the orbital velocity and @xmath91 , which means that explicit integration is suitable .    , in the forced oscillation ( circles ) and sound wave propagation ( triangles ) tests , as measured by the @xmath111 error norm",
    "the filled symbols show the second order scheme ( equation [ eqn : dragimplicit ] ) and the hollow ones show the first order scheme ( equation [ eqn : exactlin ] ) . when the spatial dependence is included ( sound wave test ) , the accuracy is slightly degraded , but it is clear that equation [ eqn : dragimplicit ] remains second order.,scaledwidth=47.0% ]    using analytical solutions means that the time - steps are not limited by the stopping time , and we can use the standard limits from the gas time - step .",
    "we find that a courant - like condition is sufficient to make sure that @xmath20 does not change too much over a time - step .",
    "we use a signal velocity @xmath129 and set the time - step via @xmath130 , with @xmath131 .",
    "for the sound - speed , @xmath52 , we use the sound speed interpolated at the location of dust particles .",
    "since the courant condition is proportional to resolution , the dust velocity converges for @xmath132 , even for @xmath104 .",
    "additionally , we limit the time - step based on the gravitational acceleration , @xmath133 .",
    "the limits have been sufficient in all tests presented , however it may be necessary to include an additional limiter in the presence of strong shocks @xcite .",
    "in order to validate the scheme , we present several simple tests based upon the dustybox , dustywave , settling , and dustyshock tests described in @xcite and @xcite , evaluated in the test particle limit . using the test particle limit means it is possible to compare the simulations to semi - analytical solutions , of which few are available for general problems .",
    "additionally , we consider multidimensional test problems , which are more stringent tests of the codes robustness and performance in problems that are closer to real physical scenarios .      , for power - law drag forces , @xmath134 , with varying index @xmath135 .",
    "in each case the coefficients are set such that the stopping time @xmath136 at @xmath137 .",
    "the sph solution is given by the circles , while the analytical solution is given by the solid lines .",
    "the scheme is able to correctly reproduce the force , producing a peak velocity error of @xmath138.,scaledwidth=47.0% ]    the dustybox test is conducted in a 3d periodic box of uniform density at a resolution of @xmath139 gas particles placed on a cartesian grid .",
    "we use @xmath139 dust particles , although since the motion of the dust particles are independent a single dust particle could be considered .",
    "the dust particles are placed on a grid offset from the gas .",
    "the initial dust velocity is taken to be @xmath140 in code units , and the gas velocity @xmath141.the particles are then evolved using the analytical solution time - steps for different drag regimes , which is possible for the non - linear drag laws since there are no external forces . in each case",
    "the drag coefficients are chosen such that @xmath136 at @xmath137 .",
    "this test should be trivially passed by our time - stepping scheme since the velocity update is exact in this case .",
    "nevertheless , this verification is important since some early schemes struggle with even this simple test , although generally this can be solved with appropriate kernels @xcite . as can be seen in fig .",
    "[ fig : stopt ] , the scheme successfully captures the drag forces in each regime , achieving a force error of less than 0.5 per cent , which verifies the accuracy of the interpolation scheme .",
    "the results are independent of the ratio of stopping time , @xmath29 , to gas time - steps , @xmath142 .",
    "similar results are found using an explicit time - stepping scheme , albeit at significantly higher computational cost when @xmath143 .      .",
    "the red lines show the exact solution for the gas ( solid ) and dust ( dashed ) , while the black points and circles show the numerical solution for the gas and dust respectively , using 128 particles per phase .",
    "the results show good agreement between the numerical and exact solution .",
    "the @xmath111 error norms are the same for all stopping times , but larger than the idealized case using the exact gas velocity for the force .",
    "the explanation is that the sph force evaluation is the dominant source of error . ]",
    "the dustywave test @xcite is essentially the travelling wave test that we used to verify the order of the time - stepping scheme in section [ sec : timeinteg ] , but using live sph particles and interpolation to calculate the velocity at the location of the dust particles .",
    "we have computed the test in one dimension , using 128 particles per phase .",
    "we switched off the artificial viscosity since our aim is to study the motion of dust particles rather than viscous dissipation , which depends sensitively on the artificial viscosity implementation ( see , for example , * ? ? ? * ) .",
    "in addition to the velocity perturbation @xmath144 , we set up a density perturbation @xmath145 by perturbing the initial particle positions according to the integrated density along the wave .",
    "we have used an adiabatic equation of state , with @xmath146 , and set the entropic function @xmath147 to be a constant in order to produce @xmath148 in the unperturbed flow . in each test",
    "we have set the stopping time @xmath29 to be a constant .",
    "the results of the live test are shown in fig .",
    "[ fig : dustywave ] , which show good agreement between the analytical solution and the numerical results .",
    "although not shown , we see similarly good agreement for arbitrarily small stopping times , which shows that our numerical scheme successfully captures the evolution of a time - dependent flow , even when @xmath149 and @xmath150 , which occurs for @xmath123 . in these tests , we find that the @xmath111 error norm for the dust velocity is essentially equal to the error norm for the gas and is independent of stopping time .",
    "this is due to the dominant source of error coming from the sph force evaluation giving rise to a slight bias in the gas velocity and effective sound speed .",
    "we note that the good agreement in the limit of small stopping times is aided by the fact that the dustywave test is much less stringent in the test particle limit , because unlike the full two - fluid case the sound speed is not modified by the presence of dust , and numerical dissipation does not occur , which can be an issue for @xmath149 and large dust - to - gas ratios @xcite .",
    "this test involves the settling of particles under the action of gravity in a stratified density medium , and is useful for testing the scheme in the presence of a varying drag coefficient .",
    "for this test we mimic a protoplanetary disc in one dimension by applying an external force @xmath151 .",
    "we fix the sound speed , @xmath52 , and orbital frequency , @xmath152 , to 1 .",
    "the gas is supported against gravity via pressure forces , which gives rise to a gaussian density structure for the gas , @xmath153 where @xmath154 and @xmath155 .",
    "following @xcite , we use 100 gas particles initially spread over the range @xmath156 to @xmath157 , with an initially constant density @xmath158 , which implies @xmath159 , and relax the gas until it reaches equilibrium .",
    "once the gas has reached equilibrium we introduced 100 dust particles , spread uniformly over the range @xmath156 to @xmath157 as before .",
    "we mimic the epstein regime by setting the stopping time @xmath160 , and start the dust particles from rest .    in fig .",
    "[ fig : settling ] we show the motion of a particle initially at @xmath161 for a range of @xmath162 . in all cases ,",
    "the results show excellent agreement between the numerical solution and the exact solution , which for strong coupling tends quickly to the terminal velocity .",
    "we contrast our results with those reported by @xcite , who found spurious oscillations in the velocity for @xmath163 at the same resolution . for @xmath164 , the stopping time @xmath165 at @xmath166 and the smoothing length @xmath167 . for reasonable values of the courant parameter , @xmath168",
    ", we find that the time - step , @xmath169 , is of order the stopping time .",
    "we suggest the oscillations in their scheme may be due to the incorrect approach to the short - friction time limit for @xmath170 , rather than low number of particles .",
    "this is consistent with the disappearance of the oscillations at higher resolution , since the courant condition enforces smaller time - steps and thus @xmath171",
    ". if our explanation is correct , then at every resolution there should be minimum stopping time below which their scheme produces oscillations .",
    "this test shows the benefit of using the full equation of motion for the velocity difference , rather than an operator splitting scheme .      [ cols=\"^,^ \" , ]     for the dustyshock test , we set up the initial conditions in 3d .",
    "the sph particles are initially placed on a lattice with a spacing of 240 particles per unit length in the high - density region ( @xmath172 ) , 152 particles per unit length in the low - density region ( @xmath173 ) and 64 neighbour particles .",
    "the masses and internal energies are set to give @xmath174 and @xmath175 for @xmath176 and @xmath177 and @xmath178 and the adiabatic index @xmath179 .",
    "the dust particles are set up using the same density and number of particles as the gas . even at arbitrarily low dust resolution",
    "the correct velocities are recovered , but an accurate density estimate requires a reasonable number of particles .",
    "an equal number of gas and dust particles has the advantage that the density in both phases experiences the same broadening , making a direct comparison simple .",
    "similarly to the dustybox test , the dust particles are placed on a lattice which is offset from the gas .",
    "the dust particles are then evolved using a linear drag law with a constant stopping time , @xmath29 .    in the dust free case ,",
    "the analytical solution for the gas is well known , which equally applies when dust is present in the test particle limit , ( see for example * ? ? ?",
    "in addition to the analytical solution to the gas , it is possible to compute the solution for dust via direct integration . for particles that initially have @xmath173",
    ", the solution can be expressed parametrically in terms of the initial position of each dust particle , @xmath180 and the time at which the shock reaches the particle @xmath181 .",
    "for linear drag forces with constant coefficients this gives @xmath182 ) , & \\quad x_0 < v_s t ,                      \\end{array } \\right .\\ ] ] and @xmath183 where @xmath184 is the shock velocity and @xmath185 is the velocity of the contact discontinuity .",
    "since for a stationary shock @xmath186 , the dust density can then be written in terms of the pre- and post - shock velocity , @xmath187 , where @xmath188 is the initial dust density for @xmath173 . for non - linear forces",
    "similar expressions can be derived straight - forwardly .        .",
    "the different symbols ( triangles , squares , pentagons ) refer to dust particles with differing stopping times , and the corresponding velocity dispersion in the gas .",
    "the filled symbols refer to standard simulations , whereas the hollow symbols show simulations where a low artificial viscosity , @xmath189 , was used .",
    "the points show the median velocity dispersion measured and the error bars show the 25th and 75th percentiles .",
    "we show @xmath190 on the x - axis to highlight the low velocity noise for weak shocks , as expected in protoplanetary discs.,scaledwidth=47.0% ]    the results of the dustyshock test are shown in fig .",
    "[ fig : shocktube ] for a linear drag law with stopping times , @xmath191 ( left ) and 0.01 ( right ) .",
    "there is good agreement between the analytical solution and the sph solution .",
    "however , for moderate values of the stopping time , @xmath192 , it can be seen that the dust velocity is slightly larger in the simulations than the analytical solution .",
    "this arises due to the broadening of the shock and is most severe for the shortest stopping times .",
    "however , since the particles with the smallest stopping times reach the terminal velocity quickly the error in the position is bounded .",
    "for @xmath193 we find the positional error is approximately @xmath194 , where @xmath195 is the gas smoothing length , but for longer stopping times the error is smaller . for the smooth post - shock flow in the dustybox problem the post - shock density is recovered .",
    "however , for more complex flows the positional error means that sph simulations of gas and dust are limited to first order accuracy .",
    "in sph , shocks compress the particle distribution anisotropically , which leads to re - meshing noise as particles re - arrange themselves to maintain a uniform distribution @xcite . using smoother kernels , such as the wendland or quintic spline ,",
    "can reduce this noise @xcite . since the re - meshing noise is driven by pressure forces , the dust particles do not undergo re - meshing , although the drag forces introduce a velocity dispersion into the dust . to measure the velocity dispersion in the shock tube",
    "tests it is necessary to subtract off the gradient of velocity since the broadening of the shock introduces a slight bias into the velocity of the dust particles . to this end",
    "we use the linear - exact sph gradient estimator @xcite , which results in an estimate of @xmath196 in the post - shock gas . for the dust particles with @xmath197",
    "the velocity dispersion is the same as the gas . for more",
    "weakly coupled dust the velocity dispersion is lower , with @xmath198 for @xmath191 .    while these noise levels are considerably lower than the velocity dispersion typically measured in simulations of self - gravitating protoplanetary discs , we do find that the noise is sensitive to the value of the artificial viscosity parameter , @xmath12 . as described above , early simulations of self - gravitating discs , including the first with dust , employed @xmath199 instead of the usually employed @xmath14 . as a result ,",
    "the simulations fail to generate sufficient entropy in shocks which gives rise to oscillations in the velocity and density behind the shock .",
    "we illustrate this in fig .",
    "[ fig : shocktubelowvisc ] , which also shows the considerable noise in the dust velocity driven by these oscillations .",
    "we note that in this case , subtracting off the gradient produces a considerably lower estimate for the velocity dispersion in the gas ( @xmath200 ) than if we use the difference between the simulation and analytical solution for the estimation ( @xmath201 ) . for the dust",
    "the difference between the estimators is smaller , since the oscillatory structure is less well defined in the dust .    since the shocks in protoplanetary discs are weak , we have measured the velocity dispersion generated by the re - meshing noise for mach numbers between 1.03 and 1.44 , which are shown in fig .",
    "[ fig : shocktubeveldisp ] . in this range",
    ", we find @xmath202 , reflecting the relationship between the compression in the post - shock gas and the velocity noise in the gas . the low velocity dispersion introduced in the dust particles by weak shocks",
    "@xmath203 shows that even though @xmath199 under - produces entropy in shocks , planar shocks are unlikely to be the dominant factor determining the velocity dispersion of dust in simulations of protoplanetary discs . in the following sections , we consider multidimensional tests to explore whether the level of noise produced in the shock tube tests is typical of more general problems .",
    "we note that the level of velocity noise reported is implementation dependent and reflects the levels of noise expected in a commonly used sph implementation .",
    "in particular , the results will be sensitive to the choice of kernel , since smoother kernels that use a larger number of neighbours , such as the quintic spline or wendland @xmath204 kernel , produce lower levels of noise in the gas velocity @xcite . in cases where numerical noise from shocks needs to be minimised , these kernels are highly recommended since the dust particles lack the ability to regularize their particle distribution ( see also section  [ sec : shock2d ] ) .",
    "the high symmetry of the sod shock tube problem means that the uniformity of the initial conditions is preserved .",
    "however , in real applications the high symmetry of the initial conditions is broken as the system evolves . in order to show the effect that this has on the dust distribution we have conducted the implosion test @xcite , which we have modified to use periodic boundary conditions @xcite .",
    "for the initial conditions we consider a two - dimensional box with @xmath205 .",
    "the gas is initially at rest with density and pressure are @xmath206 and @xmath207 , except for @xmath208 , where @xmath209 and @xmath210 , and the adiabatic index @xmath211 .",
    "we have set up the test using equal mass particles and @xmath212 particles in the high density region .",
    "the particles have been on a hexagonal lattice and we use 14 neighbour particles in 2d ( equivalent to 39.4 neighbours in 3d ) .",
    "we add dust to this problem assuming a uniform initial density , using @xmath213 particles placed on a hexagonal lattice offset from the lattice of gas particles .",
    "the stopping time is taken to be constant , @xmath191 .",
    "the shocks launched by the initial discontinuities interact in the low density region and should drive a jet of gas along the symmetry axis @xmath214 .",
    "the interaction of this jet with multiple shocks leads to richtmyer - meshkov instabilities .",
    "vanilla sph , as implemented in gadget-2 , is known to struggle with such instabilities @xcite .",
    "although we are more interested in how the dust evolves in a problem without a high degree of symmetry , we have included an artificial conductivity as described by @xcite and a viscosity limiter @xcite to help reduce the damping of instabilities .",
    "we have also run the test using the grid - code fargo @xcite , which is based upon the zeus algorithm @xcite to provide a reference solution for the dust .",
    "dust has been included in fargo using a finite volume approach in a similar way to @xcite , using explicit time - stepping for the dust acceleration .",
    "strictly a finite volume approach is not valid for this problem , since the dust velocity becomes multivalued in the region @xmath215 .",
    "while this results in density artefacts that arise on the grid scale , this does not degrade the solution elsewhere , which can be confirmed by comparison with the sph simulations .",
    "the fargo simulations were run using @xmath216 cells .    in fig .",
    "[ fig : shock2d ] we show the density at @xmath217 , after approximately a sound - crossing time . in the simulations in the top row , the large scale density structure is reasonably well reproduced , and the combination of a viscosity limiter with artificial conduction allows the growth of instabilities .",
    "however , the instabilities remain weak due to large amounts of noise in the density and velocity on scales of a smoothing length .",
    "the noise is particularly evident in the vorticity , which is largely featureless .",
    "the failing of standard sph to reproduce the vorticity was noted by @xcite , and we find that while using a viscosity limiter and artificial conductivity helps the instabilities grow , it also results in a more noisy solution .",
    "the larger noise in the vorticity is associated with the lower viscosity - using a fixed @xmath14 not only damps the instabilities but also damps the velocity noise and helps maintain a regular particle distribution .",
    "the noisy gas velocity translates into considerable noise in the dust density on scales close to a smoothing length , even in regions that are not affected by the instabilities .",
    "the difference in the noise in the dust and gas densities provides a clear illustration of the importance of the self - regulation in sph in producing an accurate solution , since the dust has no mechanism by which it can reduce the noise in the density distribution once it has been introduced .    since the higher density noise in the dust",
    "is associated with the fact that the dust particle distribution is less regular , the noise could be decreased by increasing the number of neighbours . for a standard cubic spline kernel particle ,",
    "the pairing instability prevents the use of many more neighbours in the gas @xcite . since",
    "the drag forces have been included using averages of the gas velocity the dust particle should not be affected by the pairing instability . in this case",
    "it makes more sense to spend additional computational time to ensure the gas dynamics is computed accurately .",
    "to demonstrate this , we recompute the test using a modern sph implementation that uses a wendland kernel , 50 neighbours , and integral based derivatives .",
    "the implementation is essentially identical to the @xmath218 formulation of @xcite . increasing the number of neighbours results in an additional computational cost of a factor of three .",
    "since the integral based derivatives are required for the @xcite viscosity switch , they can also be used for the force calculation at negligible extra cost , although we note that this represents a 20 per cent increase over simulations in which the viscosity parameter is kept at a fixed value of @xmath14 .",
    "the results using this scheme are shown in the middle row of fig [ fig : shock2d ] .",
    "the effect of these modernizations on the gas density is relatively minor , resulting in sharper shocks and stronger richtmyer - meshkov plumes .",
    "the sharper shocks are a result of the reduced noise and give the appearance of higher resolution , although the same resolution has been used , albeit at considerable extra computational cost .",
    "however , the improvement that this makes on the dust density is staggering .",
    "the density noise in smooth parts of the flow is significantly reduced and vortices in the gas appear that are devoid of dust .",
    "these results are in good agreement with the fargo calculations , shown in the bottom panel of fig .",
    "[ fig : shock2d ] , which exhibit a higher effective resolution .",
    "the main difference arise in the region @xmath219 , reflecting the both the higher resolution of the fargo simulations in this region , along with the issues related to the dust velocity being multi - valued in this region .",
    "the vast improvement in the dust density distribution with the state of the art sph calculation reflects the fact that reasonable agreement in the gas density can be achieved even when the gas velocity structure is dominated by noise .",
    "since the gas velocity determines the dust dynamics , the dust density reflects the accuracy achieved in the velocity structure .",
    "the modern sph implementation clearly does a much better job at reproducing the gas velocity , which also results in a much better reproduction of the instabilities . as this test shows ,",
    "an accurate velocity structure is essential for reproducing the dust dynamics and convergence in the velocity structure can be considerably more difficult to attain .",
    "in addition to the simple verification tests above , we present a test for the code in a mode of operation that is close to the conditions present in protoplanetary discs . for this",
    ", we consider the motion of an isothermal gas in a fixed potential , consisting of an axisymmetric background potential with an imposed spiral perturbation . for a logarithmic potential",
    "the solution can be calculated along streamlines that orbit at a given average radius @xcite .",
    "in particular , we follow the method of solution given in @xcite .",
    "we use a logarithmic spiral perturbing potential , @xmath220 , with a constant pitch angle , @xmath221 , given by @xmath222 where @xmath223 for the number of spiral arms , @xmath224 , we use @xmath225 , the pitch angle , @xmath226 and the pattern speed at which the spiral potential rotates , @xmath227 . the constants @xmath228 and @xmath229 set the strength of the potential and the length over which it decays , and @xmath230 is the cylindrical radius .",
    "the spiral perturbation strength can be set relative to the background potential , we take @xmath231 and @xmath232 at @xmath233 , where @xmath234    for the background potential , a keplerian velocity @xmath235 could be used . however , the streamline solutions can not be found in regions close to corotation , where the background velocity is subsonic , @xmath236 .",
    "since the spiral modes present in protoplanetary discs are close to corotation it is not possible to directly probe the regime present in protoplanetary discs using the streamline solutions @xcite .",
    "instead , we use a flat rotation curve in which the streamline solutions have been well studied in relation to spiral galaxies .",
    "nevertheless , this allows us to test how the code handles shocks in a shearing environment . for the background potential",
    "we use the form and parameters from @xcite , which we scale to dimensionless values .",
    "the velocity is given by @xmath237 where we set the maximum rotation velocity @xmath238 from @xmath239 at @xmath240.the parameters @xmath241 , and @xmath242 define the strength and size of the galactic bulge , which we neglect by taking @xmath243 .",
    "the scale of the disc is set via @xmath244 and the sound speed of the gas is @xmath245 .",
    "the streamline solutions are calculated in coordinates that denote the position along , @xmath246 , and between , @xmath247 , the spiral arms . choosing @xmath248 means that @xmath249 for integer @xmath250 at the potential minima . choosing @xmath246 to be perpendicular everywhere to @xmath247",
    "gives @xmath251    the streamline solution can be calculated at a given radius under the approximation that the local angular velocity , epicyclic frequency , perturbation strength and sound speed are constant along the streamline .",
    "the streamlines are found by choosing a value @xmath252 for the sonic point and integrating forward and backwards along the streamline , whilst looking for a shock . once a shock has been found @xmath252 is varied until a period solution is found . for more details on the exact method ,",
    "see appendix a of @xcite .",
    "in addition to the equations for the velocity along and perpendicular to the streamlines , @xmath253 and @xmath254 , we solve for the position about the disc by integrating @xmath255 along a streamline @xcite .                once the streamline solutions have been calculated , the full structure of the gas can be built by interpolating between them .",
    "however , the periodicity of the streamlines is only approximate , with the initial and final radii differing by roughly 1 per cent after the gas has travelled through an angle of @xmath256 .",
    "for this reason instead of computing streamlines that give velocities that are periodic over @xmath257 , we look for solutions that are periodic over @xmath258 .",
    "this is motivated by the need for streamlines that do not overlap themselves in the interpolation process .",
    "we now simulate the evolution of dust particles that evolve under the action of the spiral gravitational potential as well as drag forces exerted by gas whose density and kinematics is given by the analytic gas streamline solutions .",
    "henceforth the dust properties derived from these simulations are described as ` dust streamline solutions ' and these are to be compared with the properties of the dust population obtained when the dust is instead introduced into a ` live ' sph calculation and the dust - gas drag computed as described above . for the ` dust streamline solutions ' , up to @xmath259 particles",
    "are placed on a grid with an initial velocity taken to be the unperturbed background velocity .",
    "the particles are then evolved using a fourth order runge - kutta - fehlberg integrator .",
    "once all the dust positions are known , the dust density in any snapshot is then calculated using an sph kernel sum .",
    "the sph simulations are conducted both in 2d and 3d . in the 3d simulations , periodic boundary conditions are used in the @xmath260-direction to allow direct comparison between the 2d and 3d results .",
    "this avoids the additional complications associated with stratified discs and the settling of dust into the mid - plane which arises within them .",
    "while the difference between velocity distributions in 2d and 3d is an interesting issue in its own right , it complicates the comparison to the analytical solution .",
    "the sph particles are set up using a uniform density glass , and the gas is evolved under the static potential until they reach a steady - state , roughly 35 orbits at @xmath233 .",
    "once the gas has reached a steady - state the dust particles are introduced and the system is evolved for a further 35 orbits .",
    "tests conducted in which the perturbing potential was slowly applied to the gas show no significant differences to tests in which the potential was switched on immediately . in all results presented the latter approach was taken .",
    "the uniform density means the inner regions of the disc are less resolved than the outer regions ; therefore , it is instructive to quote the resolution in terms of @xmath261 , where @xmath195 is the smoothing length and @xmath262 is the pressure scale - height . for comparison at @xmath233 , a @xmath261 of 0.35 and 0.17",
    "translates into 2.5 million particles with a box - height of @xmath263 and 6 million particles with a box - height of @xmath264 . in 2d @xmath265 can be achieved with 4 million particles .",
    "the number of particles used here is larger than the @xmath266 particles typically used in protoplanetary disc simulations ( c.f . * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) , which reflects the fact the model disc is thinner @xmath267 than protoplanetary discs ( @xmath268 ) , resulting in the need for considerably more particles to resolve the pressure scale height .    the density structure in the disc",
    "is shown in fig .",
    "[ fig : discdensity ] , for the 3d simulation with @xmath269 and @xmath270 , upon which a typical streamline is marked for comparison .",
    "each streamline crosses both of the spiral arms once . in calculating the dust density 400 neighbours",
    "have been used .",
    "the large number of neighbours needed in the dust density calculation reflects the fact that no self - regularizing forces apply to the dust . for a comparison of",
    "how noisy the dust density is with the normal @xmath271 neighbours , see fig .",
    "[ fig : boulderstream ] .",
    "the flow is anti - clockwise and the dust density peaks significantly downstream of the shock , since the dust particles respond to the change in velocity over a stopping time .",
    "[ fig : gasstream ] shows the gas density and velocity along a streamline at @xmath240 , showing that standard sph is able to adequately reproduce the streamline solutions . while the sph simulations accurately reproduce @xmath253 , there is minor discrepancy in @xmath254 since the streamlines converge to a velocity that is systematically 1 per cent lower than the streamline solution . while pressure support can reduce the velocity below its keplerian value , the disc is isothermal and initially has no density gradient .",
    "once the spiral perturbation is applied a density gradient does arise , giving an order unity change in the density over the size of the disc . however , since the disc is cold and the ratio @xmath272 , pressure support should only contribute at the @xmath273 level .    in some cases , artificial viscosity can be responsible for producing an incorrect disc structure in sph simulations , via viscous angular momentum transport .",
    "for example , it has been shown that when a constant @xmath14 is used in the differentially rotating gresho - chan vortex problem that simulations do not converge to the correct inviscid solution , but appear to converge to a different solution @xcite . however , it is possible to show that artificial viscosity is not responsible for the velocity difference observed in our simulations .",
    "firstly , in our test problem the spiral perturbing potential is responsible for driving the density gradient .",
    "furthermore , the tests with low viscosity also show the velocity difference , as do tests in which a viscosity switch similar to @xcite was used .",
    "since the streamline solutions are only approximate , and the streamlines only close to within 1 per cent , the streamline solutions themselves may be the origin of the error . while the discrepancy is clearly greater than the noise in the simulations , the agreement with the streamlines is good enough that we can compare the dynamics of dust in the simulations to the streamline solutions .    in fig .",
    "[ fig : boulderstream ] , the properties of dust for a linear drag law with @xmath274 are shown along the same streamline at @xmath233 . the density has been calculated using both 50 and 400 neighbours , showing that a large number of neighbours is needed to achieve an accurate density estimate . increasing the number of neighbours has a much more dramatic effect on the density estimate than increasing the resolution , which reflects that the local density estimate is subject to monte - carlo noise once the smooth density field",
    "present in the initial conditions has been sheared away .",
    "conversely , the noise in the dust velocity is considerably lower , and can be clearly seen to be converging to the streamline solutions as the resolution increases .    .",
    "the sampling resolution of the streamline solution is close to the highest resolution sph simulation . for the sph simulations , filled and empty symbols mark simulations with standard viscosity and low viscosity respectively .",
    "the points mark the median velocity dispersion and the error bars denote the 25th and 75th percentile .",
    "the simulations at @xmath265 were conducted in 2d , with both the higher resolution and lower number of degrees of freedom contributing to the lower noise.,scaledwidth=47.0% ]    since the velocity distribution of dust particles is fundamental to understanding the growth and evolution of dust grains in protoplanetary discs , it is important to check that the velocity distribution is not dominated by numerics . since in a shearing disc",
    "there are variations in the velocity at the order of the sound speed , these need to be subtracted off in order to measure the velocity dispersion . to do this",
    ", we fit a third order polynomial to velocities at each point in space .",
    "we fit the velocity using a smoothing length that gives 400 neighbours to reduce the noise .",
    "we then subtract off the fitted velocity field and calculate the velocity dispersion from the residuals , again weighted by the kernel function .",
    "the method we use to fit the polynomial is identical to that described in @xcite , except we fit a 3rd order polynomial . for more details , see appendix c of @xcite .    the velocity dispersion for the dust particles for a range of stopping times and resolutions is shown in fig .",
    "[ fig : bouldervdisp ] .",
    "the use of analytical solutions in the time - step means that we can investigate a range of stokes numbers , @xmath275 , that would be inaccessible using explicit time integration . since the resolution varies as a function of radius , we calculate the velocity dispersion at points along a streamline at @xmath233 , for both the simulations and the streamline solutions .",
    "the simulations find normalized velocity dispersions in the solid component of as little as @xmath276 at the highest resolution and @xmath274 , which is @xmath277 of the orbital speed .",
    "however , since this level of velocity is larger than that measured from the dust particles in the streamline solutions at the same resolution , it can still be considered numerical noise . for @xmath278 even the velocity dispersion from the streamline solutions is dominated by numerical noise .    for the worst case scenario , the lowest resolution simulation with @xmath189 , the median velocity dispersion in the gas particles reaches @xmath279",
    "typically the low viscosity simulations produce 5 times more velocity noise than those run with @xmath280 . similarly to the shock tube test , the velocity dispersion in the dust is typically a factor of 10 smaller than that in the gas .",
    "comparison of the velocity dispersion measured from the simulations and streamline solutions near @xmath281 shows that the velocity dispersion in the simulation is dominated by noise since the velocity dispersion of the streamline solutions is considerably lower .",
    "however , the velocity dispersion in this problem is orders of magnitude lower than that seen in simulations of the time - dependent structures in self - gravitating protostellar discs , which have @xmath282 @xcite . since the numerical noise is at the @xmath283 level in our @xmath284 3d calculation , the velocity dispersion found in simulations of dust evolution is more likely to be associated with the physics of the problem , ( i.e. the fluctuating spiral structure ) than being a simple artefact of the numerical implementation .",
    "we have tested how using a modern sph implementation affects the gas and dust dynamics in the spiral disc test .",
    "although these methods help enormously with the two - dimensional shock tube test we found only a minor improvement when using integral - based gradients in the spiral disc problem . this can be understood since in the simple test cases the wendland kernel and integral gradients produce a very regular particle distribution . however , in the static disc problem the shear prevents this from happening , which limits the benefits these improvements can provide . additionally , we have run simulations using a @xcite limiter with @xmath285 , and @xmath286 . with these parameters we found that @xmath287 is 50 per cent higher than when using a fixed @xmath280 , since viscosity acts to damp the noise in the particles",
    ". however , using a low fixed @xmath199 results in a @xmath287 is several times higher than is produced when using the limiter . clearly using a @xcite limiter",
    "is preferred when in problems where it is necessary to reduce viscosity away from shocks .",
    "for a over a decade sph has been relied on to provide insights into the dynamics of gas and dust in self - gravitating discs .",
    "indeed to date , most of the global 3d simulations of self - gravitating discs and been performed with sph ( although @xcite investigated enrichment of solids in gas giants that are formed by gravitational instability using a 3d eulerian code ) .",
    "it is therefore necessary to take a critical look at the fidelity of the method .",
    "while many code comparisons exist in the case of purely gaseous discs @xcite , the dust implementation has been hitherto untested in this context ( although , for studies of dust in general see * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "a key question in the case of self - gravitating discs concerns the velocity dispersion of solid material in the disc , since this controls the prospects for gravitational collapse in the dust phase as well as for particle growth or destruction .",
    "previous simulations @xcite found a large velocity dispersion in the dust ( of order a sound speed ) , which is unfavourable to either grain growth or gravitational collapse .",
    "it is therefore important to test whether this result is likely to be a numerical artefact .    in order to test the reliability of such codes ,",
    "we have implemented dust particles into the sph code gadget-2 .",
    "we have used a two fluid approach and limited the study in the test particle limit where the feedback from the dust onto the gas can be neglected , allowing a direct comparison between simulations and analytical models .",
    "the code has been designed to accelerate the time - step using analytical solutions for the drag forces , in order to cope with particles that have stokes number @xmath80 .",
    "the chosen method has the advantage that it captures the full phase - space information of the dust , which is essential for evaluating the growth and survival of dust grains in protoplanetary discs .",
    "the code can handle the full range of stokes numbers and produces the correct terminal velocity for @xmath81 .",
    "we have focussed on extensively testing the code and its ability to tackle the questions in the dynamics of gas and dust in self - gravitating discs . in many of the tests",
    "presented we have focussed on the dynamically interesting cases in which the stopping time is comparable , or slightly smaller than the dynamical time scale .",
    "the result is that our time - stepping scheme only really saves computational time for the shortest stopping times .",
    "however , demonstrating that the time - stepping scheme can handle both situations readily is important for realistic physical problems , such as protoplanetary discs in which both short and long stopping times are present .",
    "the code performs well in the standard dustybox and dustyshock test problems , in which the high symmetry means that the orderly distribution of the particles is maintained by the symmetry in the problems .",
    "we also find good agreement in dustywave test , and have shown that our method is able to correctly reproduce the velocity of particles in a settling test , even at low resolutions and in strong drag regimes .",
    "we also run the two dimensional shock - tube or implosion problem @xcite , which involves interacting shock waves and is a much more severe test of a code s robustness .",
    "we have shown that correct modelling of the dust requires accurate modelling of the gas dynamics ; fig .",
    "[ fig : shock2d ] contains a striking demonstration that a correct modelling of the gas density distribution does _ not _ guarantee that the gas dynamics ( and the density distribution in the dust ) is well represented since the dust is quite sensitive to noise in the gas velocity . in agreement with the results of @xcite in the case of the gresho - chan vortex test",
    ", we find that using a wendland kernel ( which allows the number of neighbours to be increased beyond the traditional limit imposed by the pairing instability ) makes a huge difference to the accuracy of the velocity field , as does using integral based derivatives .",
    "since grid codes compare much more favourably in the two - dimensional shock tube problem , grid - based implementations of gas - dust mixtures will not show the same poor performance that standard sph does in this problem .",
    "however , it would be interesting to see how one - fluid sph codes perform in the presence of interacting shocks .",
    "we also tested the code on a problem that includes spiral shocks in a shearing environment , which is applicable to shocks in self - gravitating discs , or structures that form from planet - disc interactions .",
    "we find that the code is able to reproduce accurately the motion of the dust particles , giving the expected solutions .",
    "however , in general this is less true for dust density .",
    "while the gas density in sph calculations is accurate to the 1 per cent level for roughly 50 neighbours , we have found that even with 400 neighbours 10 per cent accuracy in the dust density is not achieved .",
    "the difference arises because the sph particle distribution is continually regularized by pressure forces , but the dust distribution is not .",
    "once the disc has evolved for a sufficient length of time that the initial structure of the disc has been sheared away , the dust particles then randomly sample the density distribution .",
    "this means the density error , @xmath288 , for the dust particles while @xmath289 for the gas .",
    "our results agree with the findings of @xcite , who find that roughly 1000 neighbours are required to calculate the density with an accuracy of 10 per cent when particles are placed randomly in a volume . the reason",
    "this density noise is not seen in the shock tube problems is that the turbulence has not sufficiently deteriorated the initial particle distribution .",
    "since the dust density does not enter the equations of motion within the test particle limit , the error does not affect the ability of the code to calculate the motion of dust particles .",
    "the low velocity dispersion of the dust in the steady disc problem @xmath290 verifies this .",
    "the good performance of the code in the static disc test problem is promising , producing much lower velocity dispersion than seen hitherto in simulations of self - gravitating discs .",
    "however , there are some caveats .",
    "firstly , using a low viscosity parameter , @xmath199 , fails to generate enough thermal energy at shocks , which results in post - shock oscillations in the gas when an adiabatic equation of state is used . as the static disc test case is isothermal",
    "the energy generation requirements do not apply , which may help to reduce the noise generated .",
    "however , in all our test cases the amplitude of the velocity dispersion is smaller than the velocity jump across the shock @xmath291 , setting a natural limit on the amount of noise introduced by shocks .",
    "it remains to be seen how the dusts dynamical state will be affected by these various code choices in the self - gravitating case and we leave this exploration ( which will help to distinguish between physical and numerical effects ) to a future paper .",
    "furthermore , when the dust is sufficiently dense to affect the dynamics of the gas , reducing the density error , which can be of order unity , will be important for producing reliable results .",
    "this is one area in which using a single - fluid approach would help , since the dust properties are evaluated at the location of the sph particles and the @xmath292 noise does not apply .",
    "however , in the presence of velocity noise the solution obtained by one - fluid approaches may also be deteriorated .",
    "furthermore , in problems where the full phase space information is required , using a two - fluid approach with a large number of dust particle neighbours may be necessary to ensure an accurate force estimate .",
    "indeed , similar results were reported by @xcite , who find significant noise in the dust density in a protoplanetary disc simulation , which led to artificial clumping . they found that using the gas smoothing length partially resolves the issue , since the gas has lower density and a larger smoothing length .",
    "we suspect that both error in the dust density and requirement that the gas is resolved on length scales present in the dust distribution are important for resolving the issue @xcite .",
    "reducing the noise in the dust density distribution is even more important when dust self - gravity is important , since spurious over - dense clumps may collapse and feed back on the gas phase fragmentation .",
    "when self - gravity is important it is likely to be essential that a large softening length is used .",
    "therefore , care must be taken in simulations of fragmentation in the dust layers of self - gravitating discs to avoid numerical artefacts .",
    "this is likely to apply to all particle based implementations of dust , independent of whether the gas is calculated using sph or with a grid code .",
    "we have implemented dust particles in the smoothed particle hydrodynamics code gadget-2 . similarly to @xcite we avoid the need for small time - steps when the dust and gas are tightly coupled . however , unlike previous methods , our time stepping scheme produces the correct terminal velocity even when the time - step is much greater than the stopping time .",
    "we have applied a number of simple test problems that verify the code produces the expected results .",
    "the tests show the importance of producing an accurate velocity structure for capturing the dust dynamics , since a noisy velocity field introduces noise into the dust density that persists for the duration of the simulation .    we have used a rigidly rotating potential to test the dynamics of dust in spiral discs , and find that as long as the gas is well resolved numerical noise contributes a velocity dispersion @xmath293 to @xmath294 , below the levels found in simulations of _ self - gravitating _ protoplanetary discs .",
    "we find the dust density in disc problems is more difficult to estimate as shear destroys the high accuracy present in the initial density field .",
    "this means that the dust density is subject to monte - carlo noise and more than 400 neighbours are required for an accurate density estimate .",
    "while errors in the dust density do not affect the tests presented here , which are calculated in the test particle limit , when the dust density is high enough to be dynamically important , either through drag forces or self - gravity , care must be taken to ensure accurate results .    from these numerical experiments",
    "we have shown that for simulations in which the length scales in the gas are well resolved , @xmath295 , the dynamics of dust can be accurately modelled .",
    "these tests have been conducted in the test particle limit and in relation to sph , but we expect them to hold more generally with the caveat that if the dust reaches high enough densities to affect the gas dynamics then a large number of neighbours is needed to ensure robust results .",
    "as long as care is taken to ensure the density noise is controlled , then simulations should be able to tackle some of the key questions related to the physics of dusty gasses .",
    "we thank giuseppe lodato for useful discussions relating to this work , which has been supported by the discsim project , grant agreement 341137 funded by the european research council under erc-2013-adg .",
    "we would also like to thank the anonymous referees for many constructive points that helped to improve the paper .",
    "and [ eqn : centraldrag ] .",
    "both formulations produce similar results as long as appropriate kernels are used .",
    "while increasing the number of particles does not improve the accuracy of the drag forces , increasing the number of neighbours does , since this improves the local estimate of the gas properties.,scaledwidth=47.0% ]    the evaluation of drag forces in sph requires interpolation of the gas properties to the location of the dust particles and vice versa when the feedback on the dust is important .",
    "the most straight - forward way that this can be done is via sph interpolation at the location of the dust particles , giving a force @xmath296 which is the approach taken by @xcite and used throughout this paper .",
    "however , if this approach is used for the velocity difference then the expression does not conserve angular momentum explicitly @xcite . to solve this they propose projecting the force been pairs of particles along the line between them , which gives @xmath297 where @xmath47 is the number of dimensions and @xmath298 .",
    "equation [ eqn : centraldrag ] approximates the force as the average of a series of forces acting in different directions .",
    "this means that even if the velocity field is uniform , the distribution of particles affects the force .",
    "additionally , even if the particle distribution is regular a large number of neighbours is needed to evaluate the force accurately . @xcite",
    "suggest resolving this problem by using a double hump kernel that has the form @xmath299 , where @xmath300 approximates a gaussian .",
    "this essentially removes the contribution of particles closest to the dust particle . since it is these particles that drive the bias when a centrally peaked kernel is used , down weighting them is effective in removing the bias .",
    "for the original form ( equation [ eqn : lineardrag ] ) the bias is not present and a kernel that approximates a gaussian should be used .",
    "we illustrate these properties in fig .",
    "[ fig : draglaws ] , which shows the velocity error from both schemes using either cubic spline or double hump cubic spline kernels .",
    "the performance of both schemes is similar , and as expected equation [ eqn : lineardrag ] is less sensitive to the choice of kernel , although it is still more accurate for the standard cubic - spline kernel .",
    "since we have investigated the drag forces in the test - particle limit , in which exact angular momentum conservation is not an issue , the comparable accuracy justifies our choice of force law , which was essentially motivated by facilitating a direct comparison to earlier work .",
    "however , we suggest equation [ eqn : centraldrag ] should be used when the force from the dust on the gas can not be neglected ."
  ],
  "abstract_text": [
    "<S> we present a ` two - fluid ' implementation of dust in smoothed particle hydrodynamics ( sph ) in the test particle limit . </S>",
    "<S> the scheme is able to handle both short and long stopping times and reproduces the short friction time limit , which is not properly handled in other implementations . </S>",
    "<S> we apply novel tests to verify its accuracy and limitations , including multi - dimensional tests that have not been previously applied to the drag - coupled dust problem and which are particularly relevant to self - gravitating protoplanetary discs . </S>",
    "<S> our tests demonstrate several key requirements for accurate simulations of gas - dust mixtures . </S>",
    "<S> firstly , in standard sph particle jitter can degrade the dust solution , even when the gas density is well reproduced . </S>",
    "<S> the use of integral gradients , a wendland kernel and a large number of neighbours can control this , albeit at a greater computational cost . secondly , when it is necessary to limit the artificial viscosity we recommend using the @xcite switch , since the alternative , using @xmath0 , can generate a large velocity noise up to @xmath1 in the dust particles . </S>",
    "<S> thirdly , we find that an accurate dust density estimate requires @xmath2 neighbours , since , unlike the gas , the dust particles do not feel regularization forces . </S>",
    "<S> this density noise applies to all particle - based two - fluid implementations of dust , irrespective of the hydro solver and could lead to numerically induced fragmentation . </S>",
    "<S> although our tests show accurate dusty gas simulations are possible , care must be taken to minimize the contribution from numerical noise .    </S>",
    "<S> [ firstpage ]    hydrodynamics  methods : numerical  protoplanetary discs  planets and satellites : formation  dust , extinction </S>"
  ]
}