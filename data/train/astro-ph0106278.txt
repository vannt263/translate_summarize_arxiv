{
  "article_text": [
    "numerous questions in physical cosmology and galaxy formation require a detailed understanding of the physics of radiative transfer . of particular interest",
    "are problems related to the reionization of the intergalactic medium ( * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* and references herein ) , absorption line signatures of high redshift structures @xcite , and hydrodynamic and thermal effects of uv emitting central sources on galaxy formation ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "several attempts have been made to develop numerical algorithms for solving the radiative transfer equation in astrophysics in general , and in cosmology in particular .",
    "@xcite described a ray tracing approach for modeling radiative transfer around point sources .",
    "a related ray tracing approach was introduced by @xcite which can also handle diffuse radiation fields but finite computer memory limits the angular resolution and therefore only poorly captures ionization fronts around point sources on reasonably large grids .",
    "@xcite discussed a monte carlo approach to sample angles , energies and the time evolution of the radiative transfer problem .",
    "a ray tracing scheme for use with smooth particle hydrodynamics was introduced by @xcite .",
    "all these approaches however suffer from the excessive operation count and are costly to implement in realistic simulations ( e.g. * ? ? ?",
    "in order to implement a radiative transfer scheme into modern numerical simulations , one needs to be able to solve the radiative transfer equation in @xmath2 operations ( where @xmath3 is the number of baryonic resolution elements , and we ignore a possible logarithmic multiplier , so that @xmath4 $ ] still counts as o[@xmath3 ] ) .",
    "however , the radiative transfer equation is six - dimensional in general and its direct solution requires of the order of @xmath6 operations , where @xmath7 is the number of frequency bins ( typically must be about 200 - 300 ) .",
    "various formal solutions of the transfer equation ( like an attenuation equation ) can be reduced to a four dimensional ( spatial plus frequency dimensions ) form , but then the calculation of the pairwise optical depth requires an operation count of the order of @xmath8 , where @xmath9 is the number of sources , which for an arbitrary source function can be equal to @xmath3 . for some restricted case , like reionization by quasars ,",
    "when the number of sources @xmath9 is small enough , the whole solution can indeed be computed directly in @xmath2 operations @xcite . however , for more realistic cases the operation count increases to @xmath10 .",
    "in addition , in cosmological applications calculation of the background radiation field would still require @xmath11 operations .",
    "thus , one has to use approximations to try to decrease the operation count .",
    "the `` local optical depth '' ( lod ) approximation for the cosmological radiative transfer was first introduced in @xcite for the homogeneous distribution of sources , and later was expanded on the case with an arbitrary source function in @xcite .",
    "this approximation is however highly approximate and uncontrolled .",
    "another possible approach is to use a so - called variable eddington tensor approximation by solving moment equations for the radiative field .",
    "such an approach allows to ensure exact conservation of photon numbers and flux , and thus would automatically give correct speeds for the ionization fronts . in this paper",
    "we describe such an approach whose main feature is the variable eddington tensor approximation with the tensor calculated in the optically thin regime .    @xcite first suggested to solve the moment equations for the simulation of three dimensional radiative transfer in cosmological hydrodynamics . they suggested to split the transfer of radiation of point sources from the transfer of diffuse emitters .",
    "the method presented here shares some of their ideas , but works with different variables .",
    "we reformulate the equations of radiative transfer by decomposing the radiation field into a uniform component and a perturbation term .",
    "it is this new mathematical framework that we will present in the following section . in section  3",
    "we discuss our treatment of multiple frequency bins and also introduce a new `` reduced speed of light '' approximation which allows us to overcome numerous numerical problems .",
    "we then go on in section  4 to introduce particular details of our implementation of the algorithm .",
    "section  5 is devoted to various one and three dimensional test cases that exemplify the strengths and weaknesses of our approach .",
    "we also present in that section a realistic cosmological simulation based on our new scheme , and compare our scheme with the lod approach .",
    "we conclude in section  6 and give a discussion of various performance issues .",
    "the evolution of the specific intensity @xmath12 in the expanding universe is given by the following equation : @xmath13 here @xmath14 are the comoving coordinates , @xmath15 is the hubble constant , @xmath16 is the absorption coefficient , @xmath17 is the source function , and @xmath18 , where @xmath19 is the unit vector in the direction of photon propagation .    equation ( [ jnueq ] ) includes all relativistic effects and therefore is quite complex .",
    "but in the same spirit as equations for particle motions in the expanding universe are split into a uniform relativistic background and newtonian perturbations , we can split equation ( [ jnueq ] ) into a background and perturbations @xcite .",
    "first , we define the mean specific intensity , @xmath20 where the averaging operator @xmath21 acting on a function @xmath22 of position and direction is defined as : @xmath23 the mean specific intensity ( `` background '' ) satisfied the following equation : @xmath24 where , _ by definition _ , @xmath25 and @xmath26 it is important to emphasize here that we use the overbar symbol merely as a part of notation and not to denote the space average ; in particular , @xmath27 is not a space average of @xmath16 since it is weighted by the local value of the specific intensity @xmath12 .",
    "we can now introduce a new quantity , which we call relative ( to the mean ) specific intensity @xmath28 , which quantifies the difference between the local value of the specific intensity and the mean , @xmath29 so that @xmath30 . in the dynamic analogy , @xmath31 corresponds to @xmath32 , where @xmath33 is the cosmic overdensity .",
    "it is now straightforward to derive the following equation for @xmath31 : @xmath34 this equation is of course not simpler than the original equation ( [ jnueq ] ) .",
    "but , if we restrict ourselves to scales significantly smaller than the horizon size , and matter velocities much smaller than the speed of light ( newtonian limit ) , then we can simplify equation ( [ fnueqfull ] ) substantially by noting that the relative specific intensity does not change substantially and the universe does not expand substantially over the period of time a photon needs to travel over the scale under consideration ( for example , a size of a computational box ) .",
    "therefore , we can ignore the derivative with respect to the frequency .",
    "strictly speaking , we should also discard the time derivative , as it has the same power of @xmath35 as the frequency derivative .",
    "however , we will retain it for a moment , keeping in mind that it is small - as we explain below , the time derivative turns out to be quite useful for the numerical implementation of our scheme .    under these assumptions , equation ( [ fnueqfull ] )",
    "reduces to the following simple equation : @xmath36 where @xmath37 @xmath38 and @xmath39    equations ( [ jnubareq ] ) and ( [ fnueq ] ) thus separate the average cosmological evolution of specific intensity ( including redshift and effects of `` distant '' sources - sources outside the simulation box ) from the local evolution due to inhomogeneous absorption and sources inside the box .",
    "the transfer equation ( [ fnueq ] ) is a six - dimensional equation in the phase space , and as such offers a considerable difficulty to solve numerically . pursuing the analogy with dynamics further",
    ", we can define moments of the radiation field similarly to how density , momentum , pressure etc of a medium are defined as moments of the distribution function .",
    "specifically , we define the ( relative to the mean ) radiation energy density @xmath40 , @xmath41 the flux @xmath42 , @xmath43 and the so - called eddington tensor @xmath44 , @xmath45 in particular , @xmath46    taking moments of equation ( [ fnueq ] ) , we can derive equations for the moments of the radiation field ( assuming that the source function is isotropic ) : @xmath47 and @xmath48    it is easy to see that equations ( [ eeq ] ) and ( [ feq ] ) are in a conservative form , and so represent the conservation of the number of photons and the flux respectively",
    ".    equations ( [ eeq ] ) and ( [ feq ] ) constitute a system of two partial differential equations .",
    "the system is however not closed since the eddington tensor is not specified by these two equations . however , _ if the eddington tensor is given as a function of position and time _ , the system becomes closed . in the following section we assume that the eddington tensor is known and describe the numerical implementation of an algorithm based on equations ( [ eeq ] ) and ( [ feq ] ) .",
    "we then discuss how to define the eddington tensor , thus completing the numerical scheme .",
    "in this section we omit the frequency dependence for clarity . equations ( [ eeq ] ) and ( [ feq ] ) can be combined into one equation preserving the accuracy of the newtonian approximation .",
    "namely , from ( [ feq ] ) we have : @xmath49 substituting this into ( [ eeq ] ) , we obtain : @xmath50 the right hand side can be expanded into two terms , @xmath51 both of these terms are of the order of @xmath52 , and thus can be dropped in the newtonian limit .",
    "we therefore neglect the first term , but retain the second one , keeping in mind that it is of the higher order in @xmath52 than the leading terms in equation ( [ eqaa ] ) . that leaves the right hand side of equation ( [ eqaa ] ) in the following form : @xmath53 of which we retain only one term , @xmath54 with the same @xmath52 accuracy .",
    "this reduces the original equation ( [ eqaa ] ) to the following final form : @xmath55 this one equation is equivalent to the original two equations ( [ eeq ] ) and ( feq ) in the newtonian limit , and the term with the time derivative is small and formally of the order of @xmath52 .",
    "the physical reason for retaining the time derivative and throwing away other terms which are formally of the same order is that at the ionization front @xmath56 can change very rapidly making this term significantly larger than the terms we neglected , even if formally they have the same @xmath52 order .    in the newtonian limit",
    "the speed of light is infinite , which in practice means that we ignore all the terms of the order of @xmath35 .",
    "thus , it actually does not matter what the specific value of the speed of light is as long as @xmath57 , and we can replace the true speed of light @xmath58 in equation ( [ difeq ] ) with some other quantity @xmath59 without violating the validity of the newtonian limit as long as @xmath60 .",
    "for example , for modeling cosmological reionization we can adopt a value for @xmath59 as low as @xmath61 , because typical gas velocities during reionization do not exceed @xmath62 .",
    "this trick of `` reducing the speed of light '' ( which we call the reduced speed of light , or rsl , approximation ) allows us to achieve a very important goal .",
    "namely , if we ignore the time derivative term in equation ( [ difeq ] ) , the equation turns elliptic , which is difficult to solve for an arbitrary @xmath63 .",
    "thus , keeping the time derivative in equation ( [ difeq ] ) allows us to solve this equation as a dynamical equation and use simple stable explicit schemes .",
    "there is however one very serious limitation - the time - step in any explicit scheme will be limited by an appropriate courant condition to a value which is about @xmath64 times smaller than the hydrodynamic time - step ( here @xmath65 is the gas sound speed ) . for the intergalactic gas at @xmath66",
    "this ratio can be as small as @xmath67 .",
    "clearly , this will make such a scheme impractical , as it is impossible to make 30,000 radiative transfer time steps for every hydrodynamic time step in a realistic simulation .",
    "the rsl approximation allows to reduce this ratio dramatically to less than 100 , and in our tests described below we even find that taking @xmath68 does not lead to large errors .",
    "thus , in the rsl approximation equation ( [ eqaa ] ) reduces to the following form : @xmath69 where @xmath70 .",
    "it is important to note here that the reduction in the speed of light _ does not _ limit the propagation speed of an ionization front to @xmath59 .",
    "equation ( [ rsl ] ) is a diffusion equation , which has an infinite speed of signal propagation . in other words ,",
    "the rsl approximation puts no limit on the speed of ionization fronts and thus can sometimes lead to unphysical , faster than the speed of light propagation of the ionization fronts @xcite . in practice , we put a limit on the maximum possible speed of an ionization front by limiting the number of time - steps .",
    "this is discussed in greater detail in  [ ifssec ] .",
    "equation ( [ rsl ] ) is a diffusion equation , and as such is not more difficult to solve than equations of hydrodynamics ( in fact , it is much easier to solve ) .",
    "however , we have omitted the frequency dependence in the derivations of the previous section .",
    "tests indicate that in order to calculate the various ionization and heating rates with sufficient precision on a logarithmically spaced mesh in frequency space , at least 20 points per e - folding are required , which translates into at least 200 frequency bins .",
    "solving equation ( [ rsl ] ) 200 times at each hydrodynamic time step would be too prohibitive with the currently available computer resources .",
    "we therefore need to introduce further approximation in order to break this unfavorable scaling . in order to do that , it is instructive to consider the optically thin case first . in this regime",
    "the angle averaged solution to equation ( [ jnueq ] ) is ( omitting time dependence for clarity ) : @xmath71 both , @xmath72 and @xmath17 may have very complicated frequency dependence , which would require a large number of frequency bins . however ,",
    "if we assume that all sources have the same frequency dependence , i.e. @xmath73 where @xmath74 depends only on frequency , and @xmath75 depends only on time and space ( say , the mass density of stars ) , then in the optically thin regime @xmath12 as a function of frequency separates into two terms : @xmath76 where @xmath77 and @xmath78 and both @xmath79 and @xmath80 are independent of frequency .",
    "thus , in this regime the frequency dependence is factorized in two one dimensional functions @xmath72 and @xmath74 , and all relevant ionization and heating rates need to be computed only once and then simply rescaled by frequency - independent factors @xmath79 and @xmath80 .",
    "this procedure is equivalent to separating all sources into `` distant '' ones , which include full redshift dependence and cosmological terms , as well as diffuse radiation , and whose frequency dependence is described by @xmath72 , and into `` near '' sources which are just newtonian perturbations on the gr background with the frequency dependence given by @xmath74 .    in a general case ,",
    "let s try to use ansatz ( [ fnsor ] ) . in that case @xmath79 and @xmath80 are no longer frequency - independent , but we will consider them being `` weakly frequency dependent '' in some sense .",
    "we then proceed by approximating their frequency dependence with `` effective column densities '' , @xmath81 where @xmath82 is either @xmath79 or @xmath80 , and @xmath83 is the respective quantity in the optically thin regime .",
    "index @xmath84 runs over the list of species , which normally includes , , and , but may also include other species , for example such as @xmath85 or dust . where @xmath86 is the abundance of a species @xmath84 ( which can change during the hydrodynamic time - step ) , and @xmath87 are now fixed functions of position during the time - step ( independent of time during the hydrodynamic time - step ) .",
    "the quantity @xmath88 is defined as @xmath89 , where @xmath90 is the number density of a given species at a given point , and @xmath91 is the size of the resolution element .",
    "the latter quantity is not defined precisely , but rather up to a factor of a few , but the numerical scheme is quite insensitive to its specific value : we varied it by a factor of 10 with little change to the final solution . ] any rate of a specific physical process ( such as photoionization rates , photoheating rates , etc ) will now depend on those @xmath92 .",
    "for the case of just three species ( say , @xmath84= , , ) , we precompute these rates with fine frequency dependence of @xmath72 and @xmath74 , store them in a 3d table , and then simply pick up a number from a table when it is needed . for four or more species rates need to be recalculated `` on the fly '' because the four - dimensional table is not practical .",
    "tests show that precomputing gives about a factor of 10 - 30 speed up .    in order to use ansatz ( [ fnsor ] ) ,",
    "we need to define the two quantities @xmath93 and @xmath94 .",
    "first , we note that since @xmath95 then @xmath96    the simplest way to split the `` full '' function @xmath56 into @xmath79 and @xmath80 is by the following two equations ( we put tildes over @xmath79 and @xmath80 because , albeit the simplest , this scheme does not work in practice ) : @xmath97 where @xmath98 and @xmath99 is the original eddington tensor ( @xmath100 from eq .",
    "[ [ feq ] ] ) . note ,",
    "that the second equation now contains @xmath101 and not @xmath102 because the @xmath72 dependence was factored out .",
    "however , the scheme ( [ schone ] ) does not work , because @xmath103 can then be negative and positive , and numerical truncation errors will prevent the exact cancellation for @xmath104 outside the ionization front , where @xmath40 should be exactly zero .",
    "therefore , we use a different splitting : @xmath105 quantity @xmath106 is not specified here , it is only required to go to 0 when the mean free path is much shorter than the size of the periodic computational box , and to 1 when the means free path is much larger than the box size .",
    "irrespective of the choice of @xmath106 , periodic boundary conditions of the computational box will guarantee that our solution will deviate from the solution in the exact case of non - periodic universe when the mean free path is close to the size of the computational box . therefore , the specific choice for @xmath106 is not that important . in this paper",
    "we adopt @xmath107 , where @xmath108 ( the latter integral is apparently independent of @xmath109 ) .",
    "we verified that other choices of @xmath106 give different solutions when the mean free path is close to the box size , but converge to the same solution when the mean free path is much shorter or much larger than the box size .",
    "we emphasize that this procedure is only required in order to reduce the number of frequency bins in the calculation .",
    "it can be entirely circumvented if the full frequency space coverage can be afforded .",
    "the scheme presented above can be easily generalized on a case when there are several kinds of sources , each with its own spectral shape @xmath74",
    ".      equations ( [ rslab ] ) are then solved by the following simple semi - explicit scheme .",
    "let @xmath82 be either @xmath79 or @xmath80 ( we omit the frequency dependence in this section for the sake of clarity ) , @xmath110 with the appropriate tensor @xmath111 , @xmath112 is the source term ( @xmath113 for @xmath79 or @xmath114 for @xmath80 ) , and @xmath115",
    ". then equations ( [ rslab ] ) are shorthanded as @xmath116 let the superscript @xmath117 label the @xmath90-th time step in the time - discretized version of equation ( [ eqa ] ) .",
    "we then adopt a semi - explicit scheme for solving equation ( [ eqa ] ) , in which we treat the laplacian and the source term explicitly , and absorption implicitly ( since the time scale for absorption can be extremely short ) , @xmath118 which can be reduced to the explicit expression for @xmath119 , @xmath120 and @xmath121 the time step @xmath122 is determined from the standard courant condition for the diffusion equation , @xmath123 where @xmath124 is the mesh cell size , and @xmath125 is the courant number .",
    "our scheme is implemented in the soften lagrangian hydrodynamics ( slh ) code @xcite .",
    "the slh code follows all physical quantities on a moving deformed mesh specified by a coordinate transformation from the quasi - lagrangian space @xmath126 ( where the mesh is uniform ) into the real space @xmath127 . in the quasi - lagrangian space",
    "the laplacian can be represented by using the deformation tensor @xmath128 its inverse @xmath129 , and its determinant @xmath130 : @xmath131 =       { 1\\over \\a } { \\partial \\over \\partial q^k } \\left [          { 1\\over\\kappa+\\delta\\kappa } \\a b^k_i b^l_j           { \\partial q h^{ij}\\over \\partial q^l }          \\right],\\ ] ] where we also introduced `` artificial viscosity '' @xmath132 to prevent the denominator from becoming zero .",
    "the results are insensitive to the choice of @xmath133 as long as it is less than about 0.03 .",
    "the cell size @xmath124 is now defined as @xmath134    the description above completes our numerical scheme except for the choice of the `` reduced speed of light '' @xmath59 .",
    "we determine it from the following condition : @xmath135 where @xmath136 is the hydrodynamic time - step during which equations ( [ rslab ] ) are solved , @xmath137 is the time - step for equations ( [ rslab ] ) determined from the courant condition , and @xmath138 is the upper limit on the number of time - steps in one hydro time - step .",
    "this is equivalent to solving equations ( [ rslab ] ) in @xmath138 time steps at most - if more time steps is required , the integration is interrupted at the moment when the maximum allowed number of time steps is reached .",
    "our scheme is fairly insensitive to the choice of @xmath138 , as discussed in the next subsection .",
    "thus , the whole scheme for solving rt within the slh code is the following . at each hydrodynamic time step :    * gravity and hydro are updated .",
    "* equations ( [ rslab ] ) are solved for @xmath138 steps at four frequency bins ( @xmath139=0 , , , )",
    ". then @xmath140 are calculated .",
    "* equations for gas temperature and ionization state are solved given @xmath140 .      as we discussed in ",
    "[ rslsec ] , the rsl approximation by itself does not limit the signal propagation speed . however , an adopted limit on the number of time - steps @xmath138 does limit the speed with which a signal can propagate across the mesh .",
    "namely , since we are using a 3-point finite differencing scheme for computing the laplacian , in one time - step a signal can only propagate one cell on our quasi - lagrangian mesh .",
    "let us first assume that our mesh is uniform in real space as well , i.e.  that our quasi - lagrangian space coincides with the real space . in that case during one hydrodynamic time - step @xmath136 the signal can only travel the physical distance @xmath141 , where @xmath91 is the comoving size of the computational box , and",
    "@xmath142 is the number of cells along one dimension of the box .",
    "thus , the propagation speed of a signal over the box is limited to @xmath143 or @xmath144 where @xmath145 and @xmath146 .",
    "for example , for the test shown in fig .  [ fighs ] this number is about @xmath147 .",
    "the test was performed with @xmath148 and @xmath149 and we found no noticeable difference between the two cases , which is not surprising since the top speed of the ionization front in this case is only about @xmath150 .",
    "this speed is however much larger than @xmath138 times the sound speed in the gas ( @xmath151 behind the ionization front and @xmath152 outside it ) , which illustrates that the rsl approximation does not limit the propagation speed of the signal .",
    "thus , one can in principle adjust @xmath138 in equation ( [ vmax ] ) so that the signal propagation speed is always fixed to @xmath58 ( unless it would require @xmath153 ) . however , for realistic cosmological simulations presented in  [ sim ] we do not do that , because the slh code allows for severe deformations of the computational mesh in real space , and in this case the signal propagation speed is only fixed in the quasi - lagrangian space for a fixed value of @xmath138 , but varies at different spatial locations in real space .",
    "instead , we keep @xmath138 fixed throughout the simulation , and we have tried two values , @xmath154 and @xmath155 , which give visually indistinguishable results . incidentally , during the whole simulation with @xmath154 the signal propagation speed @xmath156 never deviated from @xmath58 by more than a factor of 10 ( and it is respectively 5 times larger for @xmath155 ) .",
    "the scheme presented in the previous sections is complete given the eddington tensor @xmath100 .",
    "the devil of course is in the choice for the eddington tensor , because it allows to close the moment hierarchy .",
    "the eddington tensor can be written in a closed form as @xmath157 where @xmath158 where @xmath159 is the optical depth between points @xmath109 and @xmath160 .",
    "evaluation of this integral requires @xmath161 operations , and thus this form is unsatisfactory .",
    "thus , we need to make a further approximation to achieve a favorable @xmath2 scaling",
    ". however , this approximation has to be introduced carefully so that the physical meaning of equation ( [ expij ] ) is not violated . specifically , equation ( [ expij ] )",
    "describes the fact that radiation propagates from a set of discrete sources along straight lines , and any new approximation has to preserve this property .    in this paper",
    "we propose to use eddington tensors calculated in the optically thin regime , @xmath162 ( in this case @xmath163 and @xmath111 become frequency independent ) .",
    "the latter integral can now be computed in @xmath2 operations by standard algorithms used to compute high - resolution gravitational forces such as p@xmath164 m , tree , or adaptive mesh refinement .",
    "it is important to underscore that in our approximation the physical meaning of equation ( [ expij ] ) is preserved - radiation still propagates from a set of discrete sources along straight lines - and only the relative weight of different sources is misestimated .",
    "the latter however does not mean that the number of ionizing photons emitted by a given source is misestimated as well . by separating the computation of the eddington tensor from the first two moments of the transfer equation , we in effect separate two physical processes : absorption and emission of photons ( which is described by the two moments ) and propagation of photons along the straight lines from the source locations ( which is described by the eddington tensor ) .",
    "the first we compute almost exactly ( subject to the rsl approximation and finite number of frequency bins ) , while the second we compute in the optically thin regime . in other words",
    ", we insure the exact conservation of the number and the flux of photons , but may occasionally advect some flux in the wrong direction .",
    "we also stress that out approximation differs significantly from other schemes , like the diffusion approximation . in the latter",
    "the eddington tensor is computed locally , and it thus misses the non - locality present in equations ( [ expij ] ) and ( [ otpij ] ) .",
    "for example , the diffusion approximation will grossly fail for the case when a small  region is overrun by a larger  region from a more distant but a much stronger source , whereas our approach will give a quite accurate representation of the radiation field in that case ( this test is discussed in the next section ) .",
    "in order to verify the accuracy of our method , we have compared the results obtained with the 3d code to the predictions of the exact solution in spherical symmetry .    in spherical symmetry equation ( [ fnueq ] ) with no time derivative term and for a point source at the center ( @xmath165 $ ] ) has an exact solution , @xmath166 our implementation of a spherically symmetric code has 1000 points per decade in the radial direction ( which has been verified to be sufficient to converge to 1% accuracy ) and exactly the same frequency dependence and ionization and heating rates as the 3d slh code .",
    "propagation of the ionization front into the uniform neutral medium with @xmath167 from a point source with @xmath168 .",
    "solid lines show the exact spherically symmetric solution , whereas grey symbols show the 3d approximate solution after 3 , 6 , 12 , 25 , 50 , 100 , and 200 hydrodynamic time steps ( in the order of the increasing darkness of a symbol ) .",
    "two sets of open symbols show the 3d solution after 700 and 1000 hydrodynamic time steps .",
    "the latter moment corresponds to the time when the entire computational box is optically thin .",
    "the upper panel shows the gas temperature , the middle panels shows the hydrogen ionization fraction on a linear scale , and the bottom panel shows the hydrogen ionization fraction on a logarithmic scale . ]",
    "figure [ fighs ] now illustrates how our scheme works for a case of a point source in a uniform medium . in this test",
    "the point source is located at the center of a @xmath169 mesh in a @xmath170 box with periodic boundary conditions .",
    "the source spectrum contains only hydrogen ionizing photons .",
    "we notice that the approximate 3d solution converges to the exact solution in about 10 hydrodynamic time steps , after which time the 3d scheme reproduces accurately not only the position of the ionization front , but also its detailed temperature and ionized fraction profiles .",
    "the deviation at the initial moment is most likely due to finite resolution of the 3d code . at later times",
    "the ionization front leaves the computational box and the solution properly approaches the optically thin regime ( open symbols in fig .",
    "[ fighs ] ) when most of the box has a uniform radiation background and a proximity region exists around the source .",
    "the same as fig .   except for @xmath171 ( _ a _ ) and @xmath172 (",
    "_ b _ ) . in this case",
    "only first 200 hydrodynamic time steps are shown.,title=\"fig : \" ] the same as fig .   except for @xmath171 ( _ a _ ) and @xmath172 (",
    "_ b _ ) . in this case",
    "only first 200 hydrodynamic time steps are shown.,title=\"fig : \" ]    figure [ fighm ] shows in two panels the same test with 100 and 10,000 weaker source respectively .",
    "again , not only the position , but also the detailed profile of the ionization front is reproduced . in the latter case",
    "the source is so weak ( by construction ) that it reaches its stromgen sphere before the ionization front leaves the box .",
    "we continued the weak source test for another factor of three in time and the solution remains undistinguishable from the last line shown with no trace of unphysical numerical diffusion propagating outside of the stromgen sphere .    the same as fig .   except ( _ a _ ) three sets of solutions shown corresponding to three choices for the hydrodynamic time step ; ( _ b _ ) the source spectrum is a power - law with the slope of -1.25 and thus includes  and  ionizing photons . in the latter case",
    "the middle panel shows the  ionization fraction ( _ filled symbols _ ) .",
    "open symbols mark  ionization fraction at the last output . only 6th , 25th , and 100th hydrodynamic time steps are shown.,title=\"fig : \" ] the same as fig .   except ( _ a _ ) three sets of solutions shown corresponding to three choices for the hydrodynamic time step ; ( _ b _ ) the source spectrum is a power - law with the slope of -1.25 and thus includes  and  ionizing photons . in the latter case",
    "the middle panel shows the  ionization fraction ( _ filled symbols _ ) .",
    "open symbols mark  ionization fraction at the last output .",
    "only 6th , 25th , and 100th hydrodynamic time steps are shown.,title=\"fig : \" ]    figure [ fight]a shows the effect of changing the hydrodynamic time step .",
    "three sets of filled symbols correspond to the hydrodynamic time step changed by a factor of @xmath173 , 1 , and 2 relative to fig .",
    "[ fighs ] .",
    "we again notice that about 10 hydrodynamic time steps after switching on of the source are sufficient to achieve complete convergence .",
    "figure [ fight]b also tests the performance of our scheme in the case when the ionizing spectrum extends to higher energies , thus being able to ionize  and  as well as . in that case",
    "the agreement for helium is somewhat worse than for hydrogen , and it takes about 30 hydrodynamic time steps to converge on the helium profiles .",
    "this is however is still very small compared to the total number of hydrodynamic time steps in a realistic simulation , so that the compound error is expected to be negligible .",
    "the same as fig .   except that the density is not uniform by falls off as @xmath174 ( _ a _ ) or @xmath175 ( _ b _ ) with a small core at the center.,title=\"fig : \" ] the same as fig .   except",
    "that the density is not uniform by falls off as @xmath174 ( _ a _ ) or @xmath175 ( _ b _ ) with a small core at the center.,title=\"fig : \" ]    figure [ figuo ] illustrates another two tests in which the density distribution is not uniform but falls off away from the source as the first or the second power of radius . in the latter case",
    "the profile of the ionization front at earlier times is not well reproduced due to the finite resolution of the 3d scheme .",
    "two eigenvectors of the optically thin eddington tensor in one quadrant of @xmath176 section of the computational box .",
    "the source location is labeled by a filled circle . ]",
    "the tests from the previous section demonstrate that our scheme performs reasonably well for a single source in a spherically symmetric case .",
    "however , the choice of the optically thin eddington tensor is , obviously , an approximation , and we can identify regimes where it is likely to fail .",
    "this is best illustrated by figure [ figtn ] , which shows the two eigenvectors of the optically thin eddington tensor for a single source .",
    "the box has a unit side , and is located so that its center coincides with the point ( 0,0,0 ) .",
    "the source is located at the center .",
    "we show the @xmath177 plane of the box with two eigenvectors laying in that plane .",
    "the eigenvectors are scaled by the square root of their respective eigenvalues ( due to symmetry , the third eigenvector is directed along @xmath178 direction , but the respective eigenvalue is zero ) .",
    "their signs therefore are undetermined , i.e. each vector can be turned around 180 degrees .    in this test case",
    "it is easy to find the exact eddington tensor - it has only one nonvanishing eigenvalue ( therefore equal unity everywhere because the trace of the eddington tensor is identically equal unity ) and the corresponding eigenvector at every point in space points towards ( or away from ) the source ( i.e.  @xmath179 ) .",
    "the grey vectors in fig .",
    "[ figtn ] show this eigenvector .",
    "however , in the optically thin case there exist another eigenvector , shown in black in fig .",
    "[ figtn ] .",
    "this eigenvector arises due to periodic boundary conditions as a contribution from periodic images of the source . as the result",
    ", the second eigenvector will allow for the propagation of the ionization front in the direction tangential to the source ( albeit with a lower speed ) .     the distribution of neutral hydrogen in the one quadrant of the midplane of the computational box for four different tests : uniform medium ( _ lower left panel _ ) , uniform medium with a 1000 times denser wedge ( _ lower right panel _ ) , uniform medium with a wedge in a twice larger ( @xmath180 ) box ( _ upper right panel _ ) , uniform medium with a wedge with the exact eddington tensor ( _ upper left panel _ ) .",
    "all panels are flipped so that the source is located at the center of the plot .",
    "the side bars give the correspondence between the color and the decimal log of the neutral hydrogen density . ]",
    "figure [ figwe ] serves to illustrate this point .",
    "its lower left panel shows the one quadrant in the midplane from a test shown in fig .",
    "[ fighs ] .",
    "dark color shows the ionized region , and light color shows the still neutral medium .",
    "the lower right panel shows the same test ( the panel is flipped around the @xmath181 axis ) but with the 1000 times denser wedge inserted on the way of the ionization front .",
    "the wedge is supposed to shield the medium behind it from the ionizing radiation , however we can see the ionization front propagating behind the wedge with about 1/5 of the normal ionization front speed .",
    "this propagation is caused by the second eigenvector of the eddington tensor , and is therefore unphysical - it is a manifestation of the optically thin eddington tensor calculated in a periodic universe .    to verify that our conclusion is indeed correct ,",
    "we have performed the same test in a twice larger box ( @xmath180 instead of @xmath169 ) shown on the upper left panel of fig .",
    "[ figwe ] . in that case",
    "all the periodic images are twice further away , the contribution from them to the eddington tensor is 4 times smaller , and we expect the tangential ionization front to propagate with @xmath182 times lower speed , as indeed can be observed from the figure .",
    "finally , we show the same test but calculated with the exact eddington tensor on the upper left panel . in this case",
    "the ionization front does not propagate behind the wedge except by a very weak numerical diffusion ( which is not important in a realistic simulation ) .",
    "these tests illustrate the main shortcoming of the proposed scheme : the slow propagation of the ionization fronts behind the shadow .",
    "we emphasize that this propagation is quite slow , significantly slower than the ionization front speed .",
    "we notice this effect only because there should be no propagation of the radiation behind the shadow whatsoever .",
    "our tests are not sufficient to evaluate whether this is a significant drawback or it is not important in realistic simulations - we expect that future work will shed light on this question .    in the proposed framework ,",
    "we are not aware of the acceptable way to circumvent this deficiency of the scheme .",
    "we have tried to experiment with different choices of the green functions for calculating the eddington tensor , but found no noticeable improvement - with the following simple reason : if we adopt a green function which falls faster than @xmath183 ( a short - range one ) in order to reduce the contributions from the distant periodic images , we at same time introduce deformations into the eddington tensor inside the computational box , because of the periodicity of boundary conditions .",
    "these deformations may lead to even larger errors than the original optically thin eddington tensor .",
    "significant improvement over the proposed scheme is only possible if the eddington tensor is estimated more accurately , for example , by calculating the exact tensor at a number of selected points inside the computational box .",
    "however , it seems unlikely this could be done with acceptable computational cost .",
    "we again emphasize here that the fact that the eddington tensor is calculated in the optically thin regime does not compromise shadowing by itself , but only due to imposed periodic boundary conditions .",
    "the reason that the shadowing works with the optically thin eddington tensor is because the absorption of ionizing photons by the obstacle is computed essentially exactly ( up to the rsl approximation , which becomes exact in the limit of a very dense obstacle ) .",
    "the optically thin approximation does make an error by assigning the incorrect values for the eddington tensor behind the obstacle , but because the moments equations insure that the ionizing photon number density behind the obstacle is zero , the error in the eddington tensor becomes irrelevant .",
    "it may appear that the choice of the optically thin eddington tensor will also lead to a serious error in a case of several sources inside the computational box .",
    "indeed , let s consider two sources inside a computational box : a strong one and a weak one , and let s assume that the two sources switch on simultaneously . until their respective ionization fronts meet , each will have a spherical  region around it , and inside each of the  regions the eddington tensor will be of the form @xmath184 where @xmath185 is the unit vector pointing toward the respective source .",
    "however , the proposed scheme adopts an optically thin eddington tensor , which means that at each point in space the eddington tensor is given by equation ( [ ouret ] ) with @xmath186 where @xmath187 and @xmath188 are coordinates of the two sources in a reference frame tied to a given point in space , and @xmath189 and @xmath190 are their respective luminosities .",
    "we assume that @xmath191 .",
    "near the strong source the contribution from the weak source is small , and thus the optically thin eddington tensor is a good approximation to the exact one .",
    "however , near the weak ( second ) source the contribution from the first source could be important : even if @xmath192 , @xmath191 .",
    "however , the physics of the ionization fronts is such that this is not a significant problem .",
    "we can illustrate that with the following simple estimate .",
    "the radius of the ionization front scales as a cubic root of the source luminosity .",
    "thus , at the moment when the ionization fronts from the two sources overlap , the ratio of the front radii is @xmath193 the contribution to the tensors from each of the sources is proportional to @xmath194 , i.e.  the ratio of the contributions from the weak and the strong sources to the eddington tensor within the weak source s  region is @xmath195     the distribution of neutral hydrogen in one quadrant of the midplane of the computational box for four different cases .",
    "the upper row shows the two source test with the weak source located at ( -0.5,-0.5,0 ) and in the bottom row the weak sources is at ( -0.25,-0.25,0 ) .",
    "the strong source is at ( 0,0,0 ) , and the ratio of source luminosities is 10 . left columns show the case with the exact eddington tensors ( which can only be calculated easily before the two ionization fronts overlap ) , and right columns show the test with optically thin eddington tensors . in both cases",
    "the difference is noticeable but not large . ]",
    "this contribution is greater than 1 ( i.e. the weak source dominates its own eddington tensor in the optically thin regime regime ) when @xmath196 or @xmath197 even at the time of overlap , when @xmath198 , most of the volume inside the hii region around the weak source is dominated by the weak source , because @xmath199 is too weak a power law . before the overlap , @xmath200 ( @xmath201 is the distance from the strong source to a point inside the weak source  region ) , so the constraint is even weaker .",
    "the distribution of neutral hydrogen in one quadrant of the midplane of the computational box for the two - source test with optically thin eddington tensors at four different times . ]",
    "figure [ figts ] illustrates this conclusion .",
    "the two two - source tests presented in the figure show that the effect of the stronger source on the propagation of the ionization front around a weaker source are small albeit still noticeable .",
    "we also show in figure [ figtt ] consequent evolution for this test for the approximate solution .",
    "we are unable to compute the exact solution in this case because we can not calculate the exact eddington tensor when two  regions overlap .       the number of ionizing photons per baryon as a function of time for the optically thin case ( _ dashed line _ ) and for the full calculation ( _ solid line _ ) for the test presented in fig .  .",
    "the dotted line shows the optically thin case minus one ( one photon per baryon is used to ionize the box ) . ]",
    "one of the attractive features of this scheme is that the transition to the optically thin regime ( or , more precisely , to the regime when the mean free path is much larger than the size of the computational box ) is automatic , whereas in many alternative approaches it is not so trivial .",
    "[ fighs ] shows this regime for one of our tests with open symbols . in figure [ fignb ]",
    "we show the ionizing background ( i.e.  the volume averaged specific intensity ) measured in units of ionizing photons per baryon in the computational box for the optically thin case ( no absorptions ) and for one of our single source tests .",
    "the dotted line in this figure shows the optically thin case minus one , which approaches the full solution at later times .",
    "this illustrates the conservation of photons as the solution switches from the optically thick to the optically thin regime ( in this test , recombinations are not important , and only one ionizing photon per baryon is needed to ionize the whole box ) .",
    "this test illustrates that our scheme automatically insures the exact conservation of the number of photons as the mean free path crosses the box boundaries .",
    "the evolution of the spatially averaged ionizing intensity @xmath202 ( measured in conventional units of @xmath203 ) in two simulations of a representative cosmological model : using the local optical depth ( lod ) approximation of ( * ? ? ?",
    "* _ dotted line _ ) and optically thin variable eddington tensor ( otvet ; _ solid line _ ) approximation developed in this paper . ]    while the main purpose of this paper is to present the new and accurate approximation for modeling continuum radiative transfer , we give here also an example of how it performs for the problem it was developed for , cosmological reionization . for this purpose",
    "we have repeated one of the simulations from @xcite , namely the run labeled `` n64_l2_a '' . that simulation contained @xmath169 dark matter particles , an equal number of baryonic cells and , towards the end of the calculation , roughly the same number of stellar particles in a computational box with the size of @xmath204 comoving mpc .",
    "a reader can find a full description of this simulation in @xcite and we do not repeat it here for brevity .",
    "this test allows us not only to check the performance of our optically think variable eddington tensor ( otvet ) approximation in a realistic cosmological simulation , but also to compare it with the much less accurate local optical depth ( lod ) approximation .",
    "the otvet radiative transfer simulation presented here consumed roughly three times the computational time than the one using lod transfer .    in figure [ figjj ]",
    "we show the evolution of the volume averaged ionizing intensity for two simulations .",
    "the two simulations have identical parameters and the same physical content - the only difference is in the method used to solve for the radiative transfer .",
    "we notice here that the two simulations are qualitatively similar , and reionization ( the sharp rise in the specific intensity at around @xmath205 ) occurs almost at the same time in both simulations .",
    "this should be expected because the lod approximation is designed to give the correct time for the overlap of  regions , which marks the time of reionization",
    ". however , there are also noticeable differences , which we attribute to the inaccuracy of the lod approximation .     the distribution of neutral hydrogen in a realistic simulation of cosmological reionization at three different times as shown in three rows : before the overlap of  regions ( _ top row _ ) , during the overlap ( _ middle row _ ) , and after the overlap ( _ bottom row _ ) .",
    "the left column shows the highly approximate solution with the local optical depth ( lod ) approximation from @xcite , and the right column shows the present scheme ( otvet ) . ]    in order to investigate these differences further , we show in figure [ figre ] slices from two simulations at three different times - before the overlap of  regions , during the overlap , and after the overlap .",
    "we notice that while large - scale features are similar in two simulations , small - scale structure is quite different .",
    "the main difference is the excess of low density neutral gas in the lod approximation .",
    "this is indeed expected , because the lod approximation makes the largest error in the regions with the optical depth is about unity .",
    "it appears from fig .",
    "[ figre ] that this error is systematic - neutral regions are always larger in the lod approximation - and thus the lod approximation performs worse than one of the authors ( ng ) hoped for . on the other hand",
    ", the lod approximation only reproduces the ionization fronts speed on average , i.e.  it does not guarantee a correct speed for every ionization front .",
    "the fact that the large - scale structure of ionization fronts agrees quite well between the two simulations indicate that the ionization front speed in the lod approximation is calculated more accurately than could be expected a priori .",
    "this observation would allow to improve the lod approximation by correcting the systematic deviation on the @xmath206 regime .",
    "another significant difference between the two approximations is a higher asymmetry of  regions at early times in the lod approximation .",
    "this difference arises because the lod approximation estimates the total optical depth to the source from its local density .",
    "somewhat denser material becomes therefore artificially more difficult to ionize .",
    "consequently , i ",
    "fronts wrap around dense material unphysically strongly giving rise to the strongly distorted ionization fronts observed in figure  [ figre ] .    finally , at later times ( after the overlap ) the two solutions are quite similar ( except for small errors in the lod approximation in the @xmath206 regime ) because both approximations become exact in the optically thin regime .",
    "we present a new approach to numerically model continuum radiative transfer based on the optically thin variable eddington tensor ( otvet ) approximation .",
    "our method insures the exact conservation of the photon number and flux ( in the explicit formulation ) and automatically switches from the optically thick to the optically thin regime .",
    "it scales as @xmath0 with the number of hydrodynamic resolution elements and is independent of the number of sources of ionizing radiation ( i.e.  works equally fast for an arbitrary source function ) .",
    "we also describe an implementation of the algorithm for the soften lagrangian hydrodynamic code ( slh ) .",
    "we present extensive tests of our method for single and multiple sources in homogeneous and inhomogeneous density distributions , as well as a realistic simulation of cosmological reionization .",
    "the method fully solves the cosmological radiative transfer equation in a conservative fashion via moment equations .",
    "the only approximation is our use of optically thin eddington tensors .",
    "one may envision to employ a monte carlo or short characteristic methods to supply more accurate tensors for applications in which an even more accurate knowledge of the isotropy of radiation field is required .",
    "the main shortcoming introduced by optically thin eddington tensors with periodic boundary conditions is the unphysical propagation of ionization fronts behind an optically thick obstacle .",
    "this diffusive effect is however slow and negligible for the typical r  type ionization fronts of interest in numerical cosmology .",
    "a realistic simulation of cosmological reionization with our current implementation of the new method took approximately three times the computing time than a simulation without radiative transfer .",
    "however , there are several optimizations which we have not yet implemented , which will shorten this time by at least a factor of two .",
    "t.a .  acknowledges stimulating and insightful discussions with markus ramp , dimitri mihalas , pascal paschos and michael norman .",
    "we are also grateful to the referee andreas burkert for friendly and valuable comments .",
    "this work has partially been supported through nsf grants aci96 - 19019 and ast-9803137 , as a part of gc@xmath164 , and by national computational science alliance under grant ast-960015n , and utilized the sgi / cray origin 2000 array at the national center for supercomputing applications ( ncsa ) .",
    "abel , t. , & mo , h.  j. 1998 , apj , 494 , l151 abel , t. , norman , m.  l. , & madau , p. 1999",
    ", apj , 523 , 66 barkana , r. , & loeb , a. 2001 , phys .  rep . , in press ciardi , b. , ferrara , a. , marri , s. , raimondo , g. 2001 , mnras , in press ( astro - ph/0005181 ) gnedin , n.  y. 1995 , apjs , 97 , 231 gnedin , n.  y. 2000 , apj , 535 , 530 gnedin , n.  y. , & bertschinger , e. 1996 , apj , 470 , 115 gnedin , n.  y. , & ostriker , j.  p. 1997 ,",
    "apj , 486 , 581 haehnelt , m.  g. 1995 , mnras , 273 , 249 haiman , z. , abel , t. , & rees , m. j. 2000 , apj , 534 , 11 kepner , j. , tripp , t.  m. , abel , t. , & spergel , d.  n. 1999 , aj , 117 , 2063 kessel - deynet , o. , & burkert , a.  2000 , mnras , 315 , 713 norman , m.  l. , paschos , p. , & abel , t. 1998 , mmsai , 69 , 455 razoumov , a.  o. , & scott , d. 1999 , mnras , 309 , 287 silk , j. , & rees , m.  j. 1998 , a&a , 331 , l1 sokasian , a. , abel , t. , & hernquist , l. 2001 , newa , submitted"
  ],
  "abstract_text": [
    "<S> we present a new approach to numerically model continuum radiative transfer based on the optically thin variable eddington tensor ( otvet ) approximation . </S>",
    "<S> our method insures the exact conservation of the photon number and flux ( in the explicit formulation ) and automatically switches from the optically thick to the optically thin regime . </S>",
    "<S> it scales as @xmath0 with the number of hydrodynamic resolution elements and is independent of the number of sources of ionizing radiation ( i.e.works equally fast for an arbitrary source function ) .    </S>",
    "<S> we also describe an implementation of the algorithm in a soften lagrangian hydrodynamic code ( slh ) and a multi  </S>",
    "<S> frequency approach appropriate for hydrogen and helium continuum opacities . </S>",
    "<S> we present extensive tests of our method for single and multiple sources in homogeneous and inhomogeneous density distributions , as well as a realistic simulation of cosmological reionization .    </S>",
    "<S> cosmology : theory - cosmology : large - scale structure of universe - galaxies : formation - galaxies : intergalactic medium 95.30.j 07.05.t 98.80    # 110^#1    # 1n _ # 1 # 1k_#1    # 1@xmath1 # 1_#1 _    # 1#2#1#2    # 1 </S>"
  ]
}