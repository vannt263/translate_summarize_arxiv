{
  "article_text": [
    "in recent years much progress has been made in the field of freeform surface design without the assumption of symmetries @xcite .",
    "the goal of these design methods is the solution of the so called inverse problem of nonimaging optics .",
    "this means that for given _ arbitrary _ source and target intensities @xmath0 and @xmath1 one or more freeform surfaces have to be calculated , which map the intensities onto each other . especially the design of _ continuous _ freeform surfaces , on which we will concentrate on in the following , is a challenging problem and of great interest for practical applications .",
    "+ the first successful method at calculating a continuous freeform surface utilizing a complex target intensity was developed by ries and muschaweck @xcite , but unfortunately the numerical method was not published @xcite .",
    "their approach is able to handle the far field design problem for single freeform surfaces illuminated by a point source @xcite .",
    "+ nowadays , many other methods have been developed by different research groups . a quite popular approach",
    "are the so - called monge - ampre methods @xcite .",
    "they are based on the modelling of the design problem by a nonlinear partial differential equation of monge - ampre type and solving it with sophisticated numerical techniques .",
    "these methods are able to handle the design problem in the far field for intensity control of point sources @xcite and collimated beams @xcite as well as intensity and phase control with double freeform surfaces @xcite . +",
    "another popular approach for the single freeform surface design with point sources is the supporting ellipsoids method developed by oliker @xcite . with this method",
    "a freeform mirror is constructed by putting a point source in the focal point of a unification of ellipoids , whereby every ellipsoid has a different position of the second focal point on the target plane to build the required intensity pattern .",
    "the challenge of this method is the calculation of a smooth freeform surface by the unification of the ellipsoids .",
    "therefore it was further developed by other research groups @xcite and generalized to calculate freeform lenses @xcite .",
    "it can handle the far field as well as the near field design problem .",
    "+ also quite often used are ray - mapping techniques @xcite , which are frequently based on the calculation of a ray mapping between the source and the target intensity and a subsequent construction of the freeform surface @xcite .",
    "the aim and challenging part of these methods is to find an _ integrable _ ray mapping , which allows the calculation of a _ continuous _ surface .",
    "+ the approach we will concentrate on is a subgroup of the ray - mapping techniques , which are called optimal mass transport ( omt ) methods @xcite .",
    "these gained some interest in recent years and are partly based on the mathematical concept of optimal mass transport as explained in the following paragraph .",
    "they can handle the design problem of a single and double freeform surfaces for intensity control @xcite as well as double freeform surfaces for intensity and phase control @xcite .",
    "the connection between mass transport and freeform design was also discussed in @xcite . +",
    "this approach for the freeform surface design consists of two separate steps . in the first step a ray mapping between",
    "the given input and output intensities is calculated via omt . in the second step",
    "the freeform surface is constructed with the help of the law of refraction / reflection and the well - known integrability condition , which ensures the continuity of the surface .",
    "+ the difference between the omt methods mentioned above is the second step . in first approach by buerle _",
    "the freeform is constructed by an optimization procedure @xcite , while the second approach by feng _",
    "et al . _ uses a simultaneous point - by - point construction method to design a double freeform surface @xcite .",
    "+ since these attempts seem to be quite successful but do not give theoretical insights about the integrability of the omt map , we want to clarify this point in our work for a single freeform illuminated by a collimated beam .",
    "this will be done by deriving a condition for an integrable map and showing that it can be fulfilled ( approximately ) by the omt map .",
    "based on our findings , we present an efficent and easy - to - implement numerical freeform surface construction technique differing from the previously published omt methods @xcite . to do so this paper is structured as follows .",
    "+ in section [ sec : design method ] after a short introduction to the omt and a presentation of its basic properties , we will derive from the law of reflection / refraction and the integrability condition a _ general _ condition for an integrable ray mapping and its corresponding surface for collimated input beams .",
    "it will be shown that in a small - angle approximation this condition can be fulfilled by using an omt mapping and therefore the freeform surface design process indeed decouples into the two steps described above .",
    "thereby it will be shown that the freeform surface can be constructed from a linear advection equation with appropriate boundary conditions . in section [ sec : numerical algorithm ] we then argue that the advection equation for the freeform construction can be solved by simple integrations , which is different to the omt freeform design methods mentioned above and implies the approximate integrability over a wide range of freeform - target plane distances . the efficiency of this approach is then demonstrated in section [ sec : examples ] by applying it to two challenging design examples , followed by a discussion of our results in section [ sec : conclusion ] .",
    "the problem statement of omt , also called the monge - kantorovich problem , is as follows : two positive density functions @xmath2 and @xmath3 with @xmath4 have to be mapped onto each other according to the jacobi equation @xmath5 with a smooth , bijective mapping @xmath6 .",
    "if @xmath7 is defined as the set of mappings fulfilling equation ( [ eq:2 ] ) , we are searching for a mapping minimizing the transport cost according to the kantorovich - wasserstein distance @xmath8 whereby @xmath9 denotes the mapping for which the integral has its minimal value .",
    "this mapping , which is defined by ( [ eq:1 ] ) , ( [ eq:2 ] ) and ( [ eq:3 ] ) , has the useful property that it is unique @xcite and it is characterized by a vanishing curl @xcite .",
    "the latter property will be important for our findings in the next subsection .",
    "+ in the special case of freeform surface design considered here , the densities @xmath2 and @xmath3 correspond to the source and target intensities with the units @xmath10 ( see fig . [",
    "fig : geometrie ] ) . therefore equation ( [ eq:1 ] ) describes a global and equation ( [ eq:2 ] ) a local energy conservation .",
    "+ for the numerical examples in section [ sec : examples ] , we have implemented the omt method developed by sulman _",
    "it provides a good compromise between an easy implementation and an efficient mapping calculation and is thus sufficient for our test purposes .",
    "+ the result of this design process step is therefore the mapping @xmath11 , but we have to keep in mind , that it is not obvious at this point , whether the omt mapping is integrable and if it is , for which lens - target distances ( see fig . [",
    "fig : geometrie ] ) this is the case .",
    "this point will be clarified in the next subsection .            in the following ,",
    "we want to derive a differential equation for the direct calculation of a freeform surface for a given _ general _ ray mapping @xmath11 .",
    "our derivations will lead to a condition an _ integrable _ mapping and its corresponding freeform surface have to fulfill .",
    "as we will show , this condition can be fulfilled approximately over a wide range of lens - target distances by the omt mapping defined in the previous subsection .",
    "+ to do so , two basic equations are considered . on the one hand , for an incoming beam described by the ray direction vector field @xmath12 and the refracted vector field @xmath13 , the law of refraction @xmath14 with the refractive indices @xmath15 of the lens and @xmath16 of the surrounding medium , has to be fulfilled . on the other hand , we want to ensure the continuity of the surface @xmath17 by the well - known integrability condition @xcite @xmath18 since the collimated beam @xmath12 as well as @xmath13 can be expressed in terms of the unknown freeform surface @xmath17 and the given ray mapping @xmath11 ( see fig .",
    "[ fig : geometrie ] ) : @xmath19 the equations ( [ eq:4 ] ) and ( [ eq:5 ] ) represent a differential equation for @xmath17 . plugging ( [ eq:4 ] ) into equation ( [ eq:5 ] ) the integrability condition can be written in the form ( see appendix a ) @xmath20\\}_z } { \\mathbf{n}\\cdot\\mathbf{s}_2 } + \\mathbf{s}_2(\\nabla \\times \\mathbf{s}_3),\\ ] ] which holds for a _ general _ ray mapping @xmath11 .",
    "equation ( [ eq:7 ] ) is organized in a way that only the left - hand side ( lhs ) depends on the derivatives of @xmath17 .",
    "equation ( [ eq:7 ] ) takes a more familiar form by inserting the vector fields ( [ eq:6 ] ) , which leads to @xmath21}{\\mathbf{n}\\cdot \\mathbf{s}_2}-(z_t- z(x , y ) ) \\nabla \\mathbf{v},\\ ] ] with the velocity field @xmath22 , the identity vector @xmath23 and @xmath24 .",
    "this equation is a semilinear two dimensional advection equation , whereby the unknown surface @xmath17 corresponds to conserved transport quantity and the right - hand side ( rhs ) to a source term .",
    "+ in principle one could try to solve equation ( [ eq:8 ] ) after applying suitable boundary conditions , but as it will be demonstrated , it is not appropriate for finding a continuous freeform surface .",
    "this can be seen easily by considering the condition that the normalized vector field ( [ eq:4 ] ) has to be equal to the gradient of the surface @xmath17 : @xmath25 plugging this relation into the lhs of ( [ eq:8 ] ) , we get @xmath26 , which can only be fulfilled if the rhs vanishs : @xmath27}{\\mathbf{n}\\cdot \\mathbf{s}_2}-(z_t- z(x , y ) ) \\nabla \\mathbf{v } \\stackrel{!}{\\equiv}0.\\ ] ] the importance of this condition is due to the fact that is has to hold for _ every _ integrable ray mapping . since @xmath28 and therefore @xmath29 it reflects the nature of the law of refraction , that according to the definitions ( [ eq:6 ] ) and ( [ eq:9 ] ) the vectors @xmath30 , @xmath31 and @xmath32 have to lie in the same plane . + we now know , that the source term of ( [ eq:8 ] ) has to vanish , but we are still left with the question , if we can find a way to fullfil condition ( [ eq:10 ] ) .",
    "the main task is obviously to find a ray mapping for which relation ( [ eq:10 ] ) holds , which is nontrivial , since it couples the mapping with the unknown function @xmath17 . +",
    "but if we use the omt mapping , it follows from its vanishing curl that @xmath33 .",
    "if we use in addition to that , the small - angle approximation @xmath34\\ ] ] between the surface normal @xmath32 and the outgoing ray @xmath35 , we see that the condition ( [ eq:10 ] ) can be fulfilled approximately by using an omt map .",
    "because of the fact that @xmath36 is locally proportional to @xmath37 in contrast to the rhs , ( [ eq:11 ] ) can be interpreted as a far field approximation .",
    "this also implies , that the integrability of omt map is only asymptotically exact .",
    "+ hence for an omt mapping and the small - angle approximation , we get our final equation @xmath38 which has to be solved to get the required freeform surface @xmath17 .",
    "+      if we want to solve a linear advection equation like ( [ eq:12 ] ) , we have to know the function @xmath17 on the inflow part of the boundary , where the velocity field points into the integration area @xmath39 @xcite .",
    "because of energy conservation , this area is defined as @xmath40 and therefore its inflow part by @xmath41 with the outward boundary normal @xmath42",
    ". together with this boundary condition equation ( [ eq:12 ] ) has at most one solution @xcite .",
    "+ in our case the boundary conditions can be deduced in the following way .",
    "first , we have to realize , that for an incoming collimated beam the boundary of the freeform surface can only determine the tangential deflection of a ray refracted at the boundary .",
    "the normal deflection is determined by the inner parts of the surface @xmath17 .",
    "therefore it makes sense to parameterize the boundary @xmath43 by a parameter @xmath44 and define the local coordinate system at each point of the boundary by the vectors(see fig .",
    "[ fig : boundary ] ) @xmath45    since @xmath46 only determines the tangential deflection , it is sufficient to consider the law of refraction ( [ eq:4 ] ) in the tangential plane spanned by @xmath47 and @xmath48 . hence , we can interpret the boundary value calculation as a two dimensional problem which allows us to derive a differential equation for the boundary values @xmath49 by the two dimensional equivalent of equation ( [ eq:9 ] ) projected on the @xmath50 plane @xmath51 where path length @xmath52 was introduced for dimensional reasons . from this",
    "we get : @xmath53 which reduces in the far field to @xmath54 whereby the position of the surface in space compared to the target plane is fixed by integration constant . since ( [ eq:12 ] ) itself can be interpreted as a far field approximation , as explained above , equation ( [ eq:16 ] )",
    "seems more suitable for our purposes .",
    "it provides us with a simple way of calculating the boundary values .",
    "the only degree of freedom left is the integration constant .",
    "equation ( [ eq:16 ] ) will build the basis of the numerical algorithm for solving equation ( [ eq:12 ] ) presented in the next section .",
    "+ at the end of this section , we want to note that ( [ eq:12 ] ) and ( [ eq:16 ] ) can be derived analogously for freeform mirrors by replacing ( [ eq:4 ] ) by the law of reflection and keeping in mind that @xmath55",
    ".     is parameterized by @xmath44 . at each point of the boundary the local coordinate system",
    "is spanned by the tangential vector @xmath56 and normal vector @xmath42 to the boundary as well as the unit vector @xmath57 .",
    "since the boundary values @xmath49 of the freeform surface only determine the tangential deflection of the rays hitting the boundary , the projection of the law of refraction ( [ eq:4 ] ) on the @xmath50 plane can be used for the calculation of the boundary values.,width=207 ]",
    "we could solve equation ( [ eq:12 ] ) by standard computational fluid dynamic approaches , like finite volume methods , which are appropriate for the numerical treatment of linear advection equations .",
    "based on the nature of equation ( [ eq:16 ] ) , a different approach is proposed in the following . + considering ( [ eq:16 ] )",
    ", we recognize that the boundary values are calculated by the velocity field itself .",
    "this is in contrast to the usual fluid dynamical framework and allows us to separate @xmath39 into an arbitrary number of subareas @xmath58 for each of which we can calculate the boundary values by ( [ eq:16 ] ) .",
    "therefore , the freeform surface can be calculated on each subarea @xmath58 and the solution on @xmath59 by their unification .",
    "this implies that the freeform surface can be constructed by an integration of the omt map along arbitrary paths on @xmath59 , which characterizes the integrability of ray mappings @xcite . thus according to ( [ eq:12 ] ) and ( [ eq:16 ] )",
    "the omt map is approximately integrable as long as ( [ eq:11 ] ) holds .",
    "+ hence , the most convenient way to get the solution of ( [ eq:12 ] ) seems to be a line - by - line integration of ( [ eq:16 ] ) , which along the @xmath60- and @xmath61-direction is equivalent to equation ( [ eq:9 ] ) in a far field approximation .",
    "one possible way of integrating ( [ eq:16 ] ) is shown as an example in fig .",
    "[ fig : integration ] .",
    "thus , only the integration constant of one integral has to be fixed from which the others follow automatically . +",
    "the proposed approach has the useful feature that we do not need to parameterize the boundary @xmath62 , which allows the calculation of freeform surfaces with complex boundary shapes .",
    "the efficiency of the line - by - line integration approach is shown in the next chapter for two challenging design examples .    ) by the simple integration of ( [ eq:16 ] ) along straight lines .",
    "first the value @xmath63 is fixed and used for the integration along the green line .",
    "the values of @xmath17 on the green line serve as starting values for the line - by - line integration along the red lines in the orthogonal direction",
    ". then the blue lines are integrated by using the values of @xmath17 on the last red line.,width=207 ]",
    "to show the efficiency of the algorithm , we want to apply it to two design examples . in the first one , we will calculate a freeform lens that maps a collimated beam of uniform intensity on the logo of the institute of applied physics ( iap ) in jena with a resolution of 500 x 500 pixels ( see fig .",
    "[ fig : iap ] ) .",
    "it shows strong intensity gradients between the letters and the background . to omit a division by zero within the implemented omt algorithm @xcite we have to use a background intensity @xmath64 for the input and output intensities . for an appropriate speed of convergence the background intensity",
    "is set to @xmath65 per cent of the maximum intensity .",
    "the second example , which shows smooth intensity variations and a lot of details , is the well - known picture of lena with a resolution of 500 x 500 pixels ( see fig .",
    "[ fig : iap ] ) .",
    "+ since the freeforms were calculated by integrating equation ( [ eq:16 ] ) , the specific characteristics of both pictures do not have any influence on the speed of the lens construction step explained in section [ sec : numerical algorithm ] , but they increase the mapping calculation time . +",
    "the pictures both have a square format .",
    "hence , it is convenient to integrate first along the upper side of the square region and then line - by - line in the orthogonal direction with the starting values given by the first integration .",
    "therefore we have to solve 501 integrals , which took in both cases less than one second in matlab on an intel core i3 at 2.4ghz with 16 gb ram .",
    "this time has to be added up with the mapping calculation time , which strongly depends on the implemented method and the specific features of the picture .",
    "+ the integration constant on the upper left side of the integration area was chosen to be @xmath66 .",
    "values of @xmath67 and @xmath68 were used for the refractive indices , and the source - target distance was chosen to be @xmath69 .",
    "the input and output beam as well as the freeform lens had side length of one .",
    "since every spatial value is normalized the results are scalable .",
    "+ at this point we want to note that according to ( [ eq:16 ] ) the validity of the approximation ( [ eq:11 ] ) can simply be checked by scaling the numerical results with @xmath70 , which of course has to be done for each intensity and configuration individualy . for our examples",
    "the quality of the illumination patterns produced by the raytracing did not change significantly even for distances between the lens and the target plane smaller than the side length of the lens .",
    "+ in both cases the calculated freeform lens was imported as a grid sag surface into zemax to verify our results by a raytracing simulation .",
    "the imported lens data are interpolated by zemax automatically .",
    "the results can be seen in fig .",
    "[ fig : iap ] .     +",
    "we presented an efficient numerical method for the single freeform surface design for the shaping of collimated beams .",
    "it is based on the derivation of the condition ( [ eq:10 ] ) for integrable mappings by combining the law of reflaction / refraction and the well - known integrability condition in a suitable way .",
    "we showed that the condition can be fulfilled in the small - angle approximation ( [ eq:11 ] ) by using a ray mapping calculated by optimal mass transport .",
    "equation ( [ eq:11 ] ) therefore represents a quantitative estimate for the applicability of the omt map .",
    "this serves as a theoretical basis for the decoupling of the design process into two separate steps : the calculation of the omt mapping and the construction of the freeform surface with a linear advection equation . on the basis of the finding of appropriate boundary conditions for the advection equation",
    ", we presented a simple numerical algorithm for the surface construction by solving the standard integrals ( [ eq:16 ] ) , which differs from the previously published omt freeform design methods .",
    "+ besides its simplicity , accuracy and quickness , a useful feature of the construction technique is the independence of the freeform boundary shape ( see fig .",
    "[ fig : integration ] ) . by using a proper method for the calculation of the omt mapping ,",
    "this allows for example the calculation of a freeform for disconnected intensities or source and target intensties with two concave boundaries , which is in general a nontrivial problem , but important for applications .",
    "+ the results imply the approximate integrability of the omt map over a wide range of freeform - target plane distances and gives the omt freeform design methods a theoretical basis for collimated input beams .",
    "especially the condition ( [ eq:10 ] ) is interesting , also for other ray mapping techniques than omt methods , since it has to hold for every integrable mapping .",
    "hence , it opens up new possibilities for nearfield calculations as well as generalizations to it for point sources and double freeforms , which are currently under work .",
    "we want to derive equation ( [ eq:8 ] ) from the law of refraction ( [ eq:4 ] ) and the integrability condition ( [ eq:5 ] ) .",
    "since the curl of the incident field @xmath71 vanishs , plugging ( [ eq:4 ] ) into ( [ eq:5 ] ) gives @xmath72 with @xmath73\\\\        \\nonumber\\ ] ] it follows @xmath74}_{=[\\mathbf{s}_2(\\nabla \\times \\mathbf{s}_2)]\\mathbf{s}_2-|\\mathbf{s}_2 |^2 ( \\nabla \\times \\mathbf{s}_2 ) } + \\mathbf{s}_2 \\times [ ( \\mathbf{s}_2\\nabla)\\mathbf{s}_2 ] \\}\\ ] ] and we can write ( [ eq : a.1 ] ) as @xmath75\\mathbf{s}_2 + \\mathbf{s}_2 \\times [ ( \\mathbf{s}_2\\nabla)\\mathbf{s}_2 ] \\right\\ } = 0.\\ ] ] inserting ( [ eq:4 ] ) and using @xmath76 and @xmath77 leads to @xmath78 + n_1 \\{\\mathbf{s}_2 \\times",
    "[ ( \\mathbf{s}_2\\nabla)\\mathbf{s}_2 ] \\}_z = 0\\ ] ] and with @xmath79 it follows @xmath80\\}_z } { \\mathbf{n}\\cdot\\mathbf{s}_2 } + \\mathbf{s}_2(\\nabla \\times \\mathbf{s}_3).\\ ] ] using the definition @xmath81 and ( [ eq:6 ] ) the terms in equation ( [ eq : a.5 ] ) can be written as @xmath82 and @xmath83\\}_z   & = ( \\mathbf{s}_2)_x \\cdot [ ( \\mathbf{s}_2 \\cdot \\nabla)\\mathbf{s}_2]_y - ( \\mathbf{s}_2)_y   \\cdot [ ( \\mathbf{s}_2 \\cdot \\nabla)\\mathbf{s}_2]_x   \\\\ & = \\begin{pmatrix } -(\\mathbf{s}_2)_y   \\\\",
    "( \\mathbf{s}_2)_x   \\end{pmatrix}\\cdot \\left[(\\mathbf{s}_2 \\cdot \\nabla )   \\begin{pmatrix } ( \\mathbf{s}_2)_x   \\\\",
    "( \\mathbf{s}_2)_y   \\end{pmatrix } \\right ] \\\\ & = \\mathbf{v}\\cdot \\left[\\left(\\mathbf{v}^{\\perp}\\cdot \\nabla \\right)\\mathbf{v}^{\\perp}\\right ] \\end{split}\\ ] ] and @xmath84 \\\\ & = -(z_t - z(x , y))\\nabla \\mathbf{v}. \\end{split}\\ ] ]",
    "the authors thank m. esslinger , and m. tessmer for valuable discussions , r. hambach and s. schmidt for valuable discussions and comments on the manuscript , c. liu and d. lokanathan for the help with the zemax implementation and d. musick for the spelling and grammar check .",
    "we also acknowledge the federal ministry of education and research germany for financial support through the project kosimo ( fkz:031pt609x ) .",
    "r.  wu , y.  zhang , m.m .",
    "sulman , z.  zheng , p.  bentez , and j.c .",
    "miano , `` initial design with l2 monge - kantorovich theory for the monge  ampre equation method in freeform surface illumination design , '' opt . express * 22*(13 ) , 1616116177 ( 2014 )        v.i .",
    "oliker , `` mathematical aspects of design of beam shaping surfaces in geometrical optics , '' in _ trends in nonlinear analysis _ , m. kirkilionis , s. kromker , r. rannacher , and f. tomi , eds .",
    "( springer - verlag , 2003 ) , pp .",
    "193 - 222 .",
    "v.  oliker , and b.  cherkasskiy , `` controlling light with freeform optics : recent progress in computational methods for optical design of freeform lenses with prescribed irradiance properties , '' proc .",
    "spie * 9191 * , 919105919105 - 7 ( 2014 ) ."
  ],
  "abstract_text": [
    "<S> the efficient design of continuous freeform surfaces , which transform a given source into an arbitrary target intensity , remains a challenging problem . a popular approach </S>",
    "<S> are ray - mapping methods , where first a ray mapping between the intensities is calculated and in a subsequent step the surface is constructed . </S>",
    "<S> the challenging part hereby is the to find an _ integrable _ mapping ensuring a _ continuous _ surface . </S>",
    "<S> based on the law of reflection / refraction and the well - known integrability condition , we derive a general condition for the surface and ray mapping for a collimated input beam . it is shown that in a small - angle approximation a proper mapping can be calculated via optimal mass transport . </S>",
    "<S> we show that the surface can be constructed by solving a linear advection equation with appropriate boundary conditions . </S>",
    "<S> the results imply that the optimal mass transport mapping is approximately integrable over a wide range of distances between the freeform and the target plane and offer an efficient way to construct the surface by solving standard integrals . </S>",
    "<S> the efficiency is demonstrated by applying it to two challenging design examples .    </S>",
    "<S> pacs numbers : :    ` 42.15.-i , 42.15.eq ` . </S>"
  ]
}