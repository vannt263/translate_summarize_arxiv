{
  "article_text": [
    "worldwide energy demand is expected to increase steadily over the incoming years , driven by energy demands from humans , industries and electrical vehicles : more precisely , it is expected that the growth will be in the order of 40% by year 2030 .",
    "this demand is fueled by an increasingly energy - dependent lifestyle of humans , the emergence of electrical vehicles as the major source of transportation , and further automation of processes that will be facilitated by machines .    in today",
    "s power grid , energy is produced in centralized and large energy plants ( macrogrid energy generation ) ; then , the energy is transported to the end client , often over very large distances and through complex energy transportation meshes .",
    "such a complex structure has a reduced flexibility and will hardly adapt to the demand growth , thus increasing the probability of grid instabilities and outages .",
    "the implications are enormous as demonstrated by recent outages in europe and north america that have caused losses of millions of euros  @xcite .    given these problems at macro generation , it is of no surprise that a lot of efforts have been put into replacing or at least complementing macrogrid energy by means of local renewable energy sources . in this context",
    ", microgrids are emerging as a promising energy solution in which distributed ( renewable ) sources are serving local demand @xcite .",
    "when local production can not satisfy microgrid requests , energy is bought from the main utility .",
    "microgrids are envisaged to provide a number of benefits : reliability in power delivery ( e.g. , by islanding ) , efficiency and sustainability by increasing the penetration of renewable sources , scalability and investment deferral , and the provision of ancillary services . from this list ,",
    "the capability of islanding @xcite deserves special attention .",
    "islanding is one of the highlighted features of microgrids and refers to the ability to disconnect the microgrid loads from the main grid and energize them exclusively via local energy resources .",
    "intended islanding will be executed in those situations where the main grid can not support the aggregated demand and/or operators detect some major grid problem that may potentially degenerate into an outage . in these cases ,",
    "the microgrid can provide enough energy to guarantee , at least , a basic electrical service .",
    "the connection to the main grid will be restored as soon as the entire system stabilizes again .",
    "clearly , these are nontrivial functionalities that may cause instability . in this regard ,",
    "the sequel of papers @xcite provide a recent survey on decentralized control techniques for microgrids .    in order to improve the capabilities of the smart grid ,",
    "a typical approach is to consider the case where several microgrids exchange energy to one another even when the microgrids are islanded , that is disconnected from the main grid @xcite . in other words , there exist energy flows within a group of contiguous microgrids but not between the microgrids and the main grid . in this context , the optimal power flow problem has recently attracted considerable attention .",
    "for instance , in @xcite the authors consider the power flow problem jointly with coordinated voltage control . alternatively",
    ", the work in @xcite focuses on unbalanced distribution networks and proposes a methodology to solve three - phase power flow problems based on a newton - like descend method . due to the fact that these centralized solutions may suffer from scalability @xcite and privacy issues , distributed",
    "approaches based on optimization tools have been proposed in @xcite and more recently in @xcite . in general , the optimal power flow problem is nonconvex and , thus , an exact solution may be too complex to compute .",
    "for this reason , suboptimal approaches are often adopted . as an example , references @xcite show that semidefinite relaxation ( see @xcite for further details on this technique ) can , in some cases , help to approximate the global optimal solution with high precision .",
    "alternatively , @xcite resorts to the so - called alternating direction method of multipliers ( see @xcite for further information ) to solve the power flow problem in a distributed manner .    in this paper , conversely to the aforementioned works , we consider an abstract model that allows us to focus on the trading process rather than on the electrical operations of the grid . in terms of trading , the massive spread of distributed energy resources is expected to drive the transition from today s oligopolistic market to a more open and flexible one @xcite .",
    "this new picture of the market has triggered the interest on new energy trading mechanisms @xcite .",
    "for instance , the authors in @xcite consider a scenario where a set of geographically distributed energy storage units trade their stored energy with other elements of the grid .",
    "the authors formulate the problem as a noncooperative game that is shown to have at least one nash equilibrium point . in the context of demand response",
    ", the work in @xcite proposes an efficient energy management policy to control a cluster of demands .",
    "interestingly , @xcite considers demand - response capabilities as an asset to be offered within the market and , thus , they can be traded between the different agents ( retailers , distribution system operators , aggregators , etc . ) . from a more general perspective",
    ", the problem of energy trading between microgrids ( or , market agents ) has been considered in @xcite .",
    "whereas these works mainly focus on simulation studies and architectural issues , this paper attempts to provide a comprehensive analytical solution for the energy trading problem between microgrids that , besides its theoretical appeal , can be distributedly implemented without the need of a central coordinator .",
    "more specifically , our setting consists of @xmath0 microgrids in which :    each microgrid has an associated energy generation cost ;    there exists a cost imposed by the distribution network operator for transferring energy between adjacent microgrids ; and    each microgrid has an associated power demand that must be satisfied .    under these considerations",
    ", we aim to find the optimal amounts of energy to be exchanged by the microgrids in order to minimize the total operational cost of the system ( energy production and transportation costs ) . of course",
    ", a possible approach would be to solve the optimization problem by means of a central controller with _ global _ information of the system .",
    "however , such a centralized solution presents a number of drawbacks since microgrids might be operated by different utilities and information on production costs can not be disclosed .",
    "therefore , in order to safeguard critical information on local cost functions and make the system more scalable , we propose an algorithm based on dual decomposition that iteratively solves the problem in a distributed manner .",
    "interestingly , each iteration of the resulting algorithm has a straightforward interpretation in economical terms , once the new operational variables we introduce are given the meaning of energy prices .",
    "first , each microgrid locally computes the amounts of energy it must produce , buy and sell to minimize its local cost according to the current energy prices .",
    "then , after exchanging the microgrid bids , a regulation phase follows in which , in a distributed way , the energy prices are adjusted according to the law of demand .",
    "this two - step process iterates until a global agreement is reached about prices and transferred energies .",
    "the remainder of this paper is organized as follows . in section [ sec : system_model ] we present the system model . next ,",
    "section [ sec : minimization ] shows how the distributed optimization framework provides a solution for the local subproblems and gives an interpretation from an economical point of view .",
    "finally , in sections [ sec : num_results ] and [ sec : conclusions ] , we present the numerical results and draw some conclusions .",
    "consider a system composed of @xmath0 interconnected microgrids ( @xmath1gs ) operating in islanded mode . during each scheduling interval , each microgrid @xmath1g-@xmath2 generates @xmath3 units of energy and consumes @xmath4 units of energy .",
    "moreover , @xmath1g-@xmath2 may be allowed to sell energy @xmath5 to @xmath1g-@xmath6 , @xmath7 , and to buy energy @xmath8 from @xmath1g-@xmath9 , @xmath10 .",
    "then , energy equilibrium within the @xmath1 g  requires @xmath11 where the two @xmath0-dimensional column vectors @xmath12 gather all the energies bought and sold , respectively , by @xmath1g-@xmath2 .",
    "also , we have introduced the adjacency matrix @xmath13}_{m\\times m}$ ] : element @xmath14 is equal to one if there exists a connection from @xmath1g-@xmath2 to @xmath1g-@xmath6 and zero otherwise .",
    "note that , generally , @xmath15 may be nonsymmetric , meaning that at least two @xmath1gs  are allowed to exchange energy in one direction only . by convention ,",
    "we fix @xmath16 .",
    "also , @xmath17  mwh for all @xmath18 .    next ,",
    "let @xmath19 and @xmath20 be the costs of producing @xmath3 units of energy at @xmath1g-@xmath2 and transferring @xmath5 units of energy on the @xmath1g-@xmath2@xmath1g-@xmath6 link , respectively .",
    "this transferring cost function may model several factors .",
    "for example , the distribution network operator , as the enabler of the energy transfer between @xmath1gs , may charge a tax for energy transactions .",
    "in addition , this transfer cost function may also account for line congestions by introducing soft constrains on the maximum capacity of the line ( see section [ ssec : cost_fncts ] for further information ) .",
    "even though the solution below may be extended to the case where different links have different transfer cost functions , we assume that @xmath21 is common among all the links in order to avoid further complexity . as it will be clearer later , our approach is quite general and only requires that all cost functions ( both production and transport ) satisfy some mild convexity constraints , summarized in section  [ ssec : cost_fncts ] .",
    "finally , we further assume that all @xmath1gs  agree to cooperate with one another in order to minimize the total cost of the system .",
    "in other words , the energy quantities exchanged by interconnected @xmath1gs  form the equilibrium point of the following minimization problem : @xmath22 where @xmath23 is the @xmath2-th column of the @xmath24 identity matrix and , with some abuse of notation , we wrote @xmath25 .",
    "also , we used ( [ eq : equilibrium ] ) to get rid of the variables @xmath26 . note that problem ( [ eq : start ] ) considers the @xmath1gs  as parts of a common system ( for instance , they are controlled by the same operator ) and",
    "the aim is at minimizing the global cost , without focusing on the benefits / losses of each individual @xmath1 g .",
    "we will see later on , however , that the proposed distributed and iterative minimization algorithm opens to a wider - sense interpretation where achieving the global objective implies a cost reduction at every @xmath1 g .      as mentioned before , the algorithm proposed hereafter works with any set of generation / transfer cost functions , as long as they all satisfy some mild convexity constraints .",
    "specifically , it is required that @xmath27 and @xmath21 are positive valued , monotonically increasing , convex and twice differentiable . even though these requirements may seem abstract and distant from real systems",
    ", one should take into account that the cost function of a common electrical generator ( as , e.g. , oil , coal , nuclear ,  )",
    "is often modeled as a quadratic polynomial @xmath28 , where the coefficients @xmath29 , @xmath30 and @xmath31 depend on the generator type , see  @xcite and , especially  @xcite .",
    "such a generation model clearly satisfies our assumptions and , without available counterexamples , we extended it to the transfer cost function  @xmath21 .",
    "it is worth commenting here that the assumptions on the cost functions also allow for a simple way to introduce upper bounds on the energy generated by the @xmath1gs  or supported by the transfer connections .",
    "indeed , one can introduce _ soft _ constraints by designing the cost function with a steep rise at the nominal maximum value ( see also the first paragraph of section  [ sec : num_results ] , where we comment on the cost functions used for simulation ) . by doing so ,",
    "the maximum generated / transferred energies are controlled directly by the cost functions , without the need for hard constraints ( i.e. , well specified inequalities such as @xmath32 ) that would increase the complexity of the minimization problem in ( [ eq : start ] ) .",
    "note that this expedient translates , somehow , to a more flexible system : when needed , a @xmath1 g   can produce more energy than the nominal maximum if it is willing to pay an ( significant ) extra cost .",
    "indeed , this situation arises in practical systems when backup generators are activated .",
    "problem ( [ eq : start ] ) is known to have a unique minimum point since both the objective function and the constraints are strictly convex . however , dealing with @xmath33 unknowns can be very involved . moreover , a centralized solution would require a control unit that is aware of all the system characteristics .",
    "this fact implies a considerable amount of data traffic to gather all the information and can miss some privacy requirements , since @xmath1gs  may prefer to keep production costs and quantities private . to avoid these issues ,",
    "we propose here a distributed iterative approach that reaches the minimum cost by decomposing the problem into @xmath0 local , reduced - complexity subproblems solved by the @xmath1gs  with little information about the rest of the system .      in order to decompose  ( [ eq : start ] ) into @xmath0 @xmath1 g  subproblems ,",
    "let us rewrite it in the following equivalent form @xmath34 the idea is that , for each @xmath1 g , we first use the new variable @xmath35 to represent the energy sold by @xmath1g-@xmath2 and only later we force it to be equal to all the energy bought by other @xmath1gs  from @xmath1g-@xmath2 , namely @xmath36 , the coupling constraint .    due to the convexity properties of the primal problem  ( [ eq : start ] ) ( or , equivalently ,  ( [ eq : step1 ] ) )",
    ", one can find the minimum cost by relaxing the @xmath0 coupling constraints and solving the dual problem @xmath37 where @xmath38 with terms @xmath39 in the last definition , which is a local minimization subproblem given the parameters @xmath40 , we introduced @xmath41 that is the contribution of @xmath1g-@xmath2 to the lagrangian function relative to  ( [ eq : step1 ] ) .",
    "the parameter vector @xmath42 gathers all the lagrange multipliers @xmath43 corresponding to the coupling constraints @xmath44 , respectively and for all @xmath45 .      to solve the dual problem  ( [ eq : dual ] )",
    ", we resort to the iterative subgradient method  ( * ? ? ?",
    "* chapter 8) , which basically finds a sequence @xmath46\\}$ ] that converges to the optimal point of the dual problem  ( [ eq : dual ] ) , namely @xmath47 .",
    "more specifically , for each point @xmath48 $ ] , each @xmath1 g  minimizes its contribution to the lagrangian function by solving the local subproblem  ( [ eq : min_local ] ) and determining the minimum point @xmath49,{\\ensuremath\\mathbf{e}}_i^{(b)}[k])=({\\ensuremath\\varepsilon^{(s)}}_i({\\ensuremath\\boldsymbol{\\lambda}}[k]),{\\ensuremath\\mathbf{e}}_i^{(b)}({\\ensuremath\\boldsymbol{\\lambda}}[k]))$ ] .",
    "then , the lagrange multipliers are updated according to @xmath50 = { \\ensuremath\\boldsymbol{\\lambda}}[k ] + \\alpha[k]\\begin{bmatrix}{\\ensuremath\\mathbf{e}}_1^t{\\ensuremath\\mathbf{a}}{\\ensuremath\\mathbf{e}}_1^{(s)}[k]- { \\ensuremath\\varepsilon^{(s)}}_1[k]\\\\\\vdots\\\\{\\ensuremath\\mathbf{e}}_m^t{\\ensuremath\\mathbf{a}}{\\ensuremath\\mathbf{e}}_m^{(s)}[k]-{\\ensuremath\\varepsilon^{(s)}}_m[k]\\end{bmatrix},\\ ] ] where @xmath51 $ ] is a positive step factor . also ,",
    "recall from  ( [ eq : en_vectors ] ) that the set of vectors @xmath52 can be readily derived knowing the set @xmath53 .",
    "note that the vector @xmath54-[{\\ensuremath\\varepsilon^{(s)}}_i[k]]}_{m\\times 1}$ ] is a subgradient of the dual concave function @xmath55 in @xmath56 $ ] , i.e.@xmath57 ) + \\boldsymbol{\\varsigma}^t({\\ensuremath\\boldsymbol{\\lambda}}-{\\ensuremath\\boldsymbol{\\lambda}}[k ] ) , \\forall { \\ensuremath\\boldsymbol{\\lambda}}$ ] .",
    "finally , ( [ eq : clearing ] ) also says that @xmath43 can be updated at @xmath1g-@xmath2 once the vector @xmath58 $ ] has been built with the inputs @xmath59 $ ] collected from the neighboring @xmath1gs .",
    "algorithm  [ alg : distributed ] summarizes the distributed minimization procedure .",
    "one can readily notice that all necessary data is computed at the @xmath1gs , with no need for an external , centralized control unit .",
    "the information exchanged by the @xmath1gs  is limited to the lagrange multipliers @xmath60 and the demanded energies @xmath61 , computed at @xmath1g-@xmath2 and communicated only to the corresponding @xmath1g-@xmath6 . both privacy and traffic limitations",
    "are hence satisfied .",
    "@xmath1g-@xmath2 initialize @xmath62 $ ] @xmath1gs  exchange @xmath63\\}$ ] @xmath1g-@xmath2 computes @xmath64 $ ] and @xmath65 $ ] by solving  ( [ eq : min_local ] ) with fixed @xmath48 $ ] @xmath1g-@xmath2 informs @xmath1g-@xmath6 , @xmath7 , about the energy it is willing to buy , namely @xmath66 $ ] , at the given price @xmath67 $ ] with energy requests @xmath59 $ ] from neighboring @xmath1gs , @xmath1g-@xmath2 builds @xmath58 \\gets { \\begin{bmatrix}e_{i,1}[k ] & \\cdots & e_{i , m}[k]\\end{bmatrix}}^t$ ] @xmath1g-@xmath2 computes @xmath68 \\gets \\lambda_i[k ] + \\alpha[k ] ( { \\ensuremath\\mathbf{e}}_i^t{\\ensuremath\\mathbf{a}}{\\ensuremath\\mathbf{e}}_i^{(s)}[k]-{\\ensuremath\\varepsilon^{(s)}}_i[k])$ ] @xmath69    as commented before , this algorithm allows for an interesting interpretation : each lagrange multiplier @xmath43 may be understood as the price per energy unit requested by @xmath1g-@xmath2 to sell energy to its neighbors .",
    "then , the lagrangian function  ( [ eq : lagrangian ] ) can be seen as the `` net expenditure '' ( the opposite of the net income ) for @xmath1g-@xmath2 : each @xmath1 g  pays for producing energy , for buying energy and for transporting the energy it buys .",
    "conversely , the @xmath1 g  is payed for the energy it sells . by solving problem  ( [ eq : min_local ] ) , @xmath1g-@xmath2 is thus maximizing its benefit for some given selling ( @xmath70 $ ] ) and buying ( @xmath71 , j\\ne i$ ] ) prices per energy unit . according to this view , the updating step  ( [ eq : clearing ] ) is _ clearing the market _ : prices should be modified until , globally , energy demand matches energy offer .",
    "note that ( [ eq : clearing ] ) is an example of the law of demand : if the energy offered by @xmath1g-@xmath2 @xmath64 $ ] is less than all the energy demanded by the neighboring @xmath1gs  from @xmath1g-@xmath2 , that is @xmath72 , then the selling price must increase and @xmath68\\ge\\lambda_i[k]$ ] .      in the previous section",
    "we have shown how the cost minimization problem  ( [ eq : start ] ) can be solved by means of successive iterations between the solution of local problems  ( [ eq : min_local ] ) and the update of the lagrange multipliers according to  ( [ eq : clearing ] ) .",
    "we will give now a closed - form solution to the local subproblem  ( [ eq : min_local ] ) to be solved by the generic @xmath1g-@xmath2 .    in order to keep notation as simple as possible , and without loss of generality , we assume that the lagrange multipliers @xmath73 are ordered in increasing order , i.e.  @xmath74 .",
    "also , with some abuse of notation , we fix @xmath75 when @xmath76 : as far as @xmath1g-@xmath2 is concerned , the fact that there is no connection from @xmath1g-@xmath6 to @xmath1g-@xmath2 is equivalent to assume that the price of the energy sold by @xmath1g-@xmath6 is too high to be worth buying . besides",
    ", we will make use of the functions @xmath77 and @xmath78 ( the first derivatives of the cost functions @xmath79 and @xmath21 ) and of their inverse functions , respectively @xmath80 and @xmath81 .",
    "it is interesting to mention that , in economics , the derivative of a cost function is called the _ marginal cost _ ( the cost of increasing infinitesimally the argument ) . to see this ,",
    "consider for instance the generation cost function and assume that we increase production from @xmath3 to @xmath82 , with @xmath83 representing a small amount of energy .",
    "then , the new generation cost can be approximated as @xmath84 showing that the cost varies proportionally with @xmath83 and that the coefficient is @xmath85 .",
    "note that @xmath83 can be either positive ( more energy is produced for , e.g. , selling purposes ) or negative ( because , e.g. , some energy is bought from outside ) .",
    "analogously , @xmath86 is the marginal transportation cost .",
    "the solution to the minimization subproblem  ( [ eq : min_local ] ) at @xmath1g-@xmath2 behaves according to six different cases .",
    "each case is characterized by a specific relationship between the generation / transportation marginal costs @xmath77 and @xmath78 and the unitary selling / buying prices @xmath60 .",
    "we report next the mathematical definition of the six cases whereas , in section  [ ssec : economical_interpretation ] , some additional comments will help in grasping their electrical / economical meaning .",
    "[ case:1 ] if @xmath87 and @xmath88 , then @xmath1g-@xmath2 will decide to remain in a self - contained state and generate all and only the energy it consumes .",
    "namely , @xmath89    [ case:2 ] let us assume that @xmath90 and @xmath91 . moreover",
    ", we can identify a partition @xmath92 of @xmath93 that satisfies the following assumptions :    * it exists @xmath94 such that * * @xmath95 for all @xmath96 ; * * @xmath97 for all @xmath98 ; * * @xmath99 is the unique positive solution to @xmath100 * either @xmath101 or @xmath102 and @xmath103 ; * for all @xmath96 , one has @xmath104 and @xmath105    then , @xmath1g-@xmath2 buys all and only the energy it consumes , i.e.  it neither generates nor sells any energy .",
    "more specifically @xmath106    [ case:3 ] let us assume that @xmath107 while @xmath108 and @xmath109 .",
    "moreover , we can identify a partition @xmath92 of @xmath93 that satisfies the following assumptions :    * it exists @xmath94 such that * * @xmath95 for all @xmath96 ; * * @xmath97 for all @xmath98 ; * * @xmath99 is the unique positive solution to @xmath110 * either @xmath101 or @xmath102 and @xmath111 ; * either @xmath112 or @xmath113 and @xmath114    then , @xmath1g-@xmath2 does not sell any energy .",
    "furthermore , it buys some energy to supplement the local generator and feed all the loads .",
    "the exact amounts are as follows : @xmath115    [ case:4 ] if @xmath116 and @xmath117 , then @xmath1g-@xmath2 does not buy any energy .",
    "conversely , it generates all the energy it needs plus some extra energy for the market .",
    "more specifically , @xmath118    [ case:5 ] assume that @xmath90 and @xmath119 . also , let @xmath120 .",
    "note that @xmath121 since , at least , @xmath122 .",
    "then , @xmath1g-@xmath2 does not generate any energy : it buys all the energy it consumes , plus some extra energy for the market , from all @xmath1gs  in the set @xmath123 .",
    "the exact amounts are as follows : @xmath124    [ case:6 ] assume that @xmath125 , @xmath126 and @xmath127 where we introduced the set @xmath120 .",
    "then , the local generator is activated but @xmath1g-@xmath2 also buys energy from all @xmath1gs  in @xmath123 . after feeding all local loads with @xmath4 ,",
    "some extra energy is left for selling in the market : @xmath128    the proof of these results is a cumbersome convex optimization exercise . from the karush - kuhn - tucker conditions associated to  ( [ eq : min_local ] ) , one must suppose all the different cases above and realize that the corresponding assumptions are necessary for each given case .",
    "furthermore , one can also derive the exact values of all energy flows .",
    "once all cases have been considered , a careful inspection shows that the derived necessary conditions form a partition of the hyperplane @xmath129 .",
    "hence , the condition are also sufficient , along with necessary , and the proof is concluded .",
    "all the details are given in the appendix .",
    "as a final remark , note that we are assuming a positive load at the @xmath1gs , i.e.  @xmath130 .",
    "the case where may be handled analogously and brings to similar results .",
    "more specifically , cases  [ case:4 ] ,  [ case:5 ] and  [ case:6 ] extend directly because of continuity .",
    "conversely , cases  [ case:2 ] and  [ case:3 ] disappear and expand the domain of case  [ case:1 ] to @xmath90 and @xmath131 .",
    ".45    .45     +    .9      it is interesting to note that the optimal solution provided in the previous section has a straightforward interpretation in economical terms .",
    "recall that , at @xmath1g-@xmath2 , the lagrange multipliers can be interpreted as the unitary selling price ( @xmath43 ) and the unitary buying prices from the other @xmath1gs  ( @xmath73 ) .",
    "moreover , the derivatives @xmath77 and @xmath78 are the marginal generation cost and the marginal transportation cost , respectively , that is the linear variation on the cost due to an infinitesimal variation of the generated or transported energy , respectively .",
    "bearing this in mind , let us focus on case  [ case:1 ] . by means of  ( [ eq : lagrangian ] ) and ( [ eq : marginal ] ) ,",
    "one readily realizes that @xmath1g-@xmath2 is not interested in selling energy since the selling price @xmath43 is lower than the marginal production cost @xmath85 .",
    "indeed , the income @xmath132 will be lower than the extra production cost , namely @xmath133 ( the last inequality is due to the convexity of @xmath79 ) .",
    "similarly , buying is not profitable either since the minimum energy price @xmath134 is larger than the marginal benefit ",
    "the @xmath1 g  generates all and only the energy it consumes  is thus @xmath135 .",
    "] @xmath135 .",
    "the conditions for case  [ case:1 ] are hence justified .",
    "analogous considerations hold for the other cases .",
    "another interesting point is that microgrids are always willing to trade since their local cost without trading , i.e. @xmath136 , will always be higher than their `` net expenditure '' @xmath137 in ( [ eq : lagrangian ] ) , where @xmath138 stands for the optimal point of ( [ eq : dual ] ) . for the sake of brevity , we prove this result for case  [ case:6 ] only , although the same reasoning holds true for the rest of cases . in case",
    "[ case:6 ] , the `` net expenditure '' reads @xmath139 where @xmath140 is now the minimum point of  ( [ eq : min_local ] ) for @xmath141 .",
    "next , by means of the results of case  [ case:6 ] , one has @xmath142 and @xmath143 for all @xmath144 .",
    "then , the equation above can be rewritten as follows : @xmath145 with @xmath146 .",
    "finally , since the cost functions are monotonically increasing and convex , it turns out that @xmath147 and @xmath148 , which leads to the desired result .",
    "as for the numerical results , we have considered a system composed of four microgrids and , for simplicity , we have assumed the same generation cost function at all microgrids .",
    "more specifically , we have considered the u12 generator in @xcite , whose quadratic cost function @xmath28 has coefficients @xmath149  $ , @xmath150  $ /mwh and @xmath151  $ /(mwh)@xmath152 .",
    "besides , as motivated in section  [ ssec : cost_fncts ] , the original cost function has been multiplied by the function @xmath153 in order to include a soft constraint that accounts for the maximum energy generation @xmath154  mwh . regarding the transfer cost function ,",
    "we have modeled it as the cubic polynomial note that this particular choice is arbitrary and this function may depend on physical parameters and the business model . however , similar results are expected with other setups . ]",
    "@xmath155 , with @xmath156 in mwh and @xmath157 in us dollars .",
    "numerical results are given for the three topologies shown in fig .",
    "[ fig : topologies ] : fully connected , ring and line .    .9     +    .9    fig .",
    "[ fig : duality_and_lambdas ] assesses the convergence speed of the distributed minimization algorithm .",
    "the curves refer to a fully connected system where the microgrid loads are @xmath158^t$ ] mwh .",
    "first , fig .",
    "[ fig : dualitygap ] shows the duality gap and the total cost of the system as a function of the iteration number .",
    "as we can observe , the algorithm converges ( the duality gap is almost null ) after a reasonable number of iterations .",
    "more interestingly , fig .",
    "[ fig : lambdas ] shows the evolution of the selling prices .",
    "note that the relationship between prices after convergence reflects the one between local loads : the more energy the @xmath1 g  consumes locally , the higher its selling price is .",
    "while this is a natural consequence of the generation cost function being strictly increasing ( if the local load is low , the @xmath1 g  can generate extra energy for selling purposes at a lower cost ) , we can also see it as a manifestation of the law of demand .",
    "indeed , the microgrid energy demand may be seen as composed by two terms , an internal one corresponding to the local loads and an external one from the other microgrids .",
    "the selling price will hence increase with the resulting total demand .",
    "some more insights about how and how fast the algorithm converges can be found in @xcite .",
    "there , only two microgrids are considered : such a simple case allows for a centralized closed - form solution and its direct comparison with the distributed approach .    0.95     +    0.95    next , in order to get some more insight into the evolution of prices and energy flows , we consider a scenario where",
    "all local loads are held constant at 11  mwh ( just above @xmath159 ) , except for @xmath1g-4 , whose load varies from  1 to  11  mwh . in figures  [ fig : fully_costs ] ,  [ fig : ring_costs ] and  [ fig : line_costs ] , for the four microgrids , we report the local cost after convergence @xmath160 , that is the minimum `` net expenditure ''  ( [ eq : min_local ] ) , with @xmath161 the maximum point of ( [ eq : dual ] ) . for benchmarking purposes , we have also depicted the costs at each microgrid in the disconnected case ( i.e.  when no trading is performed , the dashed lines ) . as shown in section  [ ssec : economical_interpretation ] , when using  ( [ eq : lagrangian ] ) as the local cost , we can observe that optimal trading always brings some benefit ( cost reduction ) to all microgrids .",
    "let us now focus on the fully connected topology of fig .",
    "[ fig : fully ] . in fig .",
    "[ fig : fully_costs ] we see that the cost attained by @xmath1g-4 after trading initially follows the cost of the disconnected microgrid .",
    "it is only when the local load grows above 6  mwh that the gain becomes noticeable , reaches its maximum for @xmath162  mwh and then decreases again until it becomes null at @xmath163  mwh .",
    "there , all @xmath1gs  have the same internal demand and , for symmetry reasons , there is no energy exchange .",
    "the gain , indeed , is a result of the energy sold by @xmath1g-4 to the other microgrids , whose amount , unit price and corresponding income is depicted in fig .",
    "[ fig : impactmu4 ] . at first sight",
    ", it may be disconcerting to see that the negligible gain obtained by @xmath1g-4 for @xmath164  mwh is the result of selling a large amount of energy at a very low price ( both almost constant for @xmath164  mwh ) .",
    "for @xmath165  mwh , however , the @xmath1 g  sells less energy but the unit price increases fast enough to improve the gain ( the `` income '' curve ) : the best trade - off between the amount of energy sold by the @xmath1 g  and its unit price is reached , as said before , for @xmath162  mwh . for larger values of @xmath166 ,",
    "the high selling price can not compensate for the decrease of sold energy and the income goes to zero .    to understand why this happens ,",
    "let us consider @xmath1g-4 .",
    "after convergence , @xmath1g-4 is defined by case  [ case:4]generates and sells . then , particularizing  ( [ eq : lagrangian ] ) , the local costs at @xmath1g-4 is @xmath167 where we used the fact that we are assuming @xmath168 for @xmath169 .",
    "the optimal @xmath170 is given by the marginal cost , that is @xmath171 now , consider ( [ eq : cost4 ] ) , ( [ eq : price4 - 4 ] ) and recall that the cost function @xmath172 is the one with label `` disconnected ( @xmath1g-4 ) '' in fig .",
    "[ fig : fully_costs ] : for @xmath173  mwh approximately , the cost function is almost linear .",
    "thus , the unit price ( [ eq : price4 - 4 ] ) is nearly constant and so is the cost ( [ eq : cost4 ] ) as a function of @xmath174 for all @xmath166 and @xmath174 such that @xmath175  mwh .",
    "in other words , the @xmath1 g  cost @xmath176 only depends on the consumed energy and not on the sold one since the income from selling some extra energy is canceled out by the extra cost needed to generate it .",
    "all these considerations are reflected by the curves in figures  [ fig : fully_costs ] and  [ fig : impactmu4 ] for @xmath164  mwh or , equivalently , @xmath173  mwh , since the total energy sold by @xmath1g-4 in this regime is approximately 3  mwh .",
    "now , without loss of generality , let us focus on @xmath1g-1 .",
    "note that , for symmetry reasons , @xmath1g-1 , @xmath1g-2 and @xmath1g-3 are all buying the same amount of energy from @xmath1g-4 ( namely , @xmath177 ) and they are not exchanging energy to one another .",
    "intuitively , @xmath1g-1 falls within case  [ case:3]generates and buys  and its local cost is @xmath178 the optimal price @xmath170 is given by ( [ eq : price4 - 4 ] ) but , from @xmath1g-1 perspective , can also be rewritten as @xmath179 let us neglect , for the moment , the transfer cost function @xmath21 .",
    "also , recall that @xmath180 is again the one depicted in fig .",
    "[ fig : fully_costs ] with label `` disconnected ( @xmath1g-4 ) '' . since @xmath181  mwh",
    ", the production cost @xmath182 takes values above the curve elbow for all @xmath183  mwh , approximately . in this regime ,",
    "the generation cost is very high and @xmath1g-1 is certainly trying to buy energy to reduce its expenditure . for @xmath184  mwh",
    ", however , the generation cost takes values below the curve elbow and has an almost linear behavior ( see also comments above ) .",
    "then , it is not worth to buy more energy , since its price will cancel out the generation savings .",
    "the convex nature of the transfer cost function @xmath21 accentuates this trend .",
    "these considerations explain why @xmath185  mwh for all @xmath164  mwh .    for @xmath165",
    "mwh , the four @xmath1gs  work in the nonlinear part of the generation cost function . matching the energy price at both the selling side ( [ eq : price4 - 4 ] ) and the buying side ( [ eq : price4 - 1 ] ) results in the trade - off of fig .",
    "[ fig : impactmu4 ] , which turns out to be quite fruitful for @xmath1g-4 . this fact compensates somehow for the little benefit ( with respect to the benefits of the other @xmath1gs ) experienced by @xmath1g-4 at low values of @xmath166 .",
    "finally , let us recall that the purpose of the original problem  ( [ eq : start ] ) is to minimize the total cost of the system and not to maximize local benefits .",
    "this , together with the fact that we do not allow @xmath1gs  to cheat , explains why @xmath1g-4 always sells at a unit price given by the marginal cost and does not look for extra gains .    even though the general ideas discussed above about the cost behaviors apply to all systems , connection topologies ( see fig .",
    "[ fig : topologies ] ) other than the full connected one present some specific characteristics .",
    "for instance , fig .",
    "[ fig : ring_costs ] report the local cost for the four @xmath1gs  in ring topology .",
    "we may see that @xmath1g-2 and @xmath1g-3 get some extra benefit from acting as intermediaries between @xmath1g-4 and @xmath1g-1 . to be more precise , after the trading process , the local solutions at @xmath1g-@xmath186 will fall within case [ case:6 ] : energy is bought not only to satisfy internal needs but also to be resold to @xmath1g-1 . by doing so , @xmath1g-@xmath186 can reduce their local cost substantially .    in fig .",
    "[ fig : line ] we depict another situation where topology heavily impacts on the costs . in this case , microgrids are connected by means of a line topology with @xmath1g-4 at the end of the line .",
    "therefore , @xmath1g-3 can be regarded as the bottleneck of the system , since all the energy that goes from @xmath1g-4 to @xmath1g-\\{1,2 } has to pass through it inevitably . as it can be observed in the figure",
    ", this situation benefits @xmath1g-3 .",
    "in this paper , we have addressed a problem in which several microgrids interact by exchanging energy in order to minimize the global operation cost , while still satisfying their local demands . in this context , we have proposed an iterative distributed algorithm that is scalable in the number of microgrids and keeps local cost functions and local consumption private .",
    "more specifically , each algorithm iteration consists of a local minimization step followed by a market clearing process . during the first step ,",
    "each microgrid computes its local energy bid and reveals it to its potential sellers .",
    "next , during the market clearing process , energy prices are adjusted according to the law of demand . as for the local optimization problem",
    ", it has been shown to have a closed form expression which lends itself to an economical interpretation .",
    "in particular , we have shown that no matter the local demand that a microgrid will be always willing to start the trading process since , eventually , its `` net expenditure '' will be lower than its local cost when operating on its own .",
    "finally , numerical results have confirmed that the algorithm converges after a reasonable number of iterations and there certainly is a gain over nonconnected @xmath1gswhich strongly depends on the energy demands and network topology .",
    "this appendix proves the solution to the @xmath1 g  problem given in section  [ ssec : subproblem ] . as explained before",
    ", we will suppose that the @xmath1 g  best option is to operate in one of the six different states defined according to whether the @xmath1 g  is ( or is not ) selling , buying and generating any energy , as described by the six cases of section  [ ssec : subproblem ] . by doing so",
    ", one can compute all the energy values of interest and identify what constraints the prices @xmath187 must satisfy for the considered case to be feasible . after all cases have been considered , the six sets of necessary conditions should form a partition of the @xmath188 hyperplane . indeed , this fact implies that each set of conditions is sufficient , along with necessary , for the corresponding @xmath1 g  state and that the computed energy values are those minimizing the local cost function ( [ eq : lagrangian ] ) for given prices @xmath187 .    before delving into the different cases ,",
    "some common preliminaries are needed .",
    "for the local problem ( [ eq : min_local ] ) the lagrangian function is as follows : @xmath189 where we have introduced the lagrange multipliers @xmath190 and @xmath191 .",
    "the kkt conditions hence write      by recalling the definition of @xmath15 in section  [ sec : system_model ] , the elements of the gradient in ( [ eq : kkt2 ] ) can be written in a much simpler form , namely @xmath193 the derivation of the six possible solutions given in section  [ ssec : subproblem ] is based on the analysis of the kkt conditions above , as explained hereafter .",
    "let us suppose that the solution of the minimization problem tells us that the @xmath1 g  neither sells nor buys any energy , that is @xmath194 , @xmath195 and @xmath196 .",
    "if this was the case , then the kkt conditions  ( [ eq : kkt ] ) would write @xmath197 the first condition implies @xmath198 while the second condition yields @xmath199 which are the two necessary conditions corresponding to case  [ case:1 ] .",
    "we now look for the necessary conditions for case  [ case:2 ] , that is @xmath1g-@xmath2 sells no energy ( i.e.  @xmath194 ) and buys energy from at least another @xmath1 g  ( i.e.  @xmath200 ) .",
    "besides , @xmath1g-@xmath2 generates no energy and @xmath201 . the kkt conditions  ( [ eq : kkt ] ) simplify to        the first necessary condition @xmath90 is a straightforward consequence of ( [ eq : kkt1_2 ] ) and ( [ eq : kkt4_2 ] ) .",
    "next , for all @xmath96 , ( [ eq : kkt1_2 ] ) and ( [ eq : kkt2_2 ] ) imply @xmath204 which means that @xmath205 similarly , because of ( [ eq : kkt1_2 ] ) and ( [ eq : kkt3_2 ] ) , one has @xmath206 by comparing the last two inequalities , one sees that @xmath207 for all @xmath208 , meaning that @xmath209 is certainly part of the set @xmath123 when this solution is correct .    from ( [ eq:5.2a ] ) , and taking ( [ eq:5.2b ] ) into account",
    ", we can infer that @xmath210 where @xmath81 is the inverse of @xmath78 , which exists because of the continuity and convexity assumptions on the cost function @xmath21 .",
    "since we are supposing that the optimal working point satisfies @xmath211 , we see that @xmath99 shall satisfy the equality @xmath212 given that @xmath81 is an increasing function , and recalling ( [ eq:5.2b ] ) , it can be easily shown that equation ( [ eq:5.2c ] ) in the variable @xmath99 has a unique solution , whose value allows us to compute the energies @xmath213 bought from neighbor @xmath1g-@xmath6 , @xmath96 ( compare with the statement of case  [ case:2 ] ) .    to derive the other necessary conditions for this case ,",
    "let us focus on ( [ eq:5.2c ] ) .",
    "since @xmath81 is a non - negative function and @xmath214 , it follows : @xmath215 recalling that @xmath81 is the inverse of @xmath78 , this implies @xmath216 and , hence , @xmath217 is a necessary condition for case  [ case:2 ] .",
    "now , let @xmath218 , which is a subset of @xmath123 because of ( [ eq:5.2b ] ) . then , by comparison with ( [ eq:5.2c ] ) , @xmath219 where the second inequality is a consequence of @xmath81 being an increasing function . also , we are letting @xmath220 , which is possible since @xmath221 for the considered @xmath6 .",
    "in particular , if @xmath222 then @xmath223 , as reported in case  [ case:2 ] .",
    "we will see later that this condition is important to identify the boundary between the solution regions of case  [ case:2 ] and case  [ case:5 ] .",
    "consider now ( [ eq : kkt1_2 ] ) and ( [ eq:5.2b ] ) , which give @xmath224 and , in turn , a new necessary condition : @xmath225 moreover , ( [ eq : kkt1_2 ] ) and ( [ eq:5.2c ] ) yield @xmath226 substituting into ( [ eq:5.2c ] ) ,",
    "we can write the last necessary condition of case  [ case:2 ] , namely @xmath227 note that the left - hand side has a meaning according to ( [ eq:5.2d ] ) . the last inequality may also be deduced from the graphical representation in fig .",
    "[ fig : help2 ] .",
    "we suppose again a solution where @xmath194 and @xmath228 for at least one @xmath229 . as opposed to the previous case , however , we also suppose that @xmath230 , i.e.  @xmath1g-@xmath2 produces some energy . with this solution , the lagrange multiplier @xmath231 is zero and the kkt conditions become        condition ( [ eq : kkt1_3 ] ) directly gives the first requirement for the case in hand , namely @xmath107 .",
    "next , by combining ( [ eq : kkt1_3 ] ) and ( [ eq : kkt3_3 ] ) , one has @xmath233 and , hence , @xmath234 since @xmath235 .",
    "similarly , ( [ eq : kkt1_3 ] ) and ( [ eq : kkt2_3 ] ) yield @xmath236 , which implies @xmath237 since @xmath78 is an increasing function , and @xmath238 where @xmath81 is the inverse of @xmath78 .",
    "inequality ( [ eq:5.3a ] ) guarantees that @xmath213 is positive .",
    "following , by injecting ( [ eq:5.3b ] ) into ( [ eq : kkt1_3 ] ) , it turns out that @xmath99 must satisfy @xmath239 it is straightforward to show that the last equation in @xmath99 admits a unique solution ( see also the graphical representation in fig .  [",
    "fig : help3 ] ) that allows us to compute the energies bought from neighbor microgrids according to ( [ eq:5.3b ] ) , as stated by case  [ case:3 ] . also , knowing @xmath99 and recalling that @xmath80 is the inverse function of @xmath77 , ( [ eq : kkt1_3 ] ) allows us to compute the generated energy @xmath240    combining ( [ eq:5.3c ] ) with ( [ eq:5.3a ] ) , we get @xmath241 for all @xmath242 and in particular for @xmath243 ( see the statement of case  [ case:3 ] ) .",
    "we are particularly interested in @xmath134 since the corresponding microgrid will certainly belong to the set @xmath123 ( and possibly be its only element ) if this case is the solution to the minimization problem .",
    "this can be deduced by comparing ( [ eq:5.3z ] ) and ( [ eq:5.3a ] ) .      from ( [ eq:5.3c ] )",
    "one further has @xmath249 .",
    "then , again because of @xmath81 being increasing in @xmath99 , @xmath250 and , equivalently , @xmath251 , where we have introduced @xmath252 ( see also fig .  [ fig : help3 ] ) . in particular , if @xmath253 then @xmath254 , which represents the complementary set of ( [ eq:5.2f ] ) in case  [ case:2 ] .",
    "the next potential solution provides @xmath260 for all @xmath7 ( @xmath1g-@xmath2 does not buy any energy ) , @xmath261 and , obviously , @xmath262 ( the @xmath1 g  sells and generates some energy ) . according to the kkt conditions , we also have @xmath263 and @xmath264    the first kkt condition can be satisfied only if @xmath116 ( the first necessary condition for the current case ) . moreover , combining both conditions , we get @xmath265 , which requires @xmath266 ( the second necessary condition for the current case ) in order to have @xmath235 .        we now analyze potential solutions of the type @xmath261 , @xmath228 for at least one index @xmath7 and @xmath269 . in other terms , the microgrid does not generate any energy but buys more than consumes and sells the surplus . in this case , the kkt conditions write        since @xmath271 , condition ( [ eq : kkt1_5 ] ) requires @xmath90 , the first necessary condition for the current case .",
    "next , joining ( [ eq : kkt1_5 ] ) and ( [ eq : kkt3_5 ] ) , we readily see that @xmath272 and @xmath273    similarly , ( [ eq : kkt1_5 ] ) and ( [ eq : kkt2_5 ] ) imply @xmath274 for all @xmath96 . by using the function @xmath81 , inverse of @xmath78 ,",
    "the last equation allows computing the value of the energy bought from @xmath1g-@xmath6 , namely @xmath275 , as we wanted to show .",
    "note , however , that this is a meaningful expression only if @xmath276 for all @xmath96 . by comparing this last requirement with ( [ eq:5.5a ] ) , we see that @xmath277 , which is the definition of the set @xmath123 as stated by case  [ case:5 ] .",
    "the last type of solution we have to deal with is characterized by @xmath261 , @xmath228 for at least one index @xmath7 and @xmath280 , i.e.  @xmath1g-@xmath2 generates , buys and sells certain positive amounts of energy .",
    "the kkt conditions become        condition ( [ eq : kkt1_6 ] ) directly implies @xmath282 ( the first necessary condition for case  [ case:6 ] ) because of the convexity assumptions on @xmath180 .",
    "also , for all @xmath98 , the lagrangian multipliers @xmath283 are given by ( [ eq : kkt1_6 ] ) and ( [ eq : kkt3_6 ] ) , namely @xmath272 .",
    "this value is non - negative only if @xmath284    on the other hand , ( [ eq : kkt1_6 ] ) and ( [ eq : kkt2_6 ] ) lead to @xmath274 for all @xmath96 .",
    "this identity allows us to express the quantity @xmath275 ( the desired result ) , with @xmath81 the inverse of @xmath21 , provided that @xmath276 for all @xmath96 .",
    "this requirement , together with ( [ eq:5.6a ] ) , results in the definition of @xmath123 for case  [ case:6 ] , namely @xmath277 .    to conclude , by means of the function @xmath80 , inverse of @xmath77 , ( [ eq : kkt1_6 ] ) is equivalent to @xmath268 or , also , @xmath285 , which are the required expressions of the total generated and sold energy , respectively .",
    "note that this is a positive ( and meaningful ) quantity only if @xmath286 , the last necessary condition for case  [ case:6 ] ( compare also with case  [ case:3 ] ) .",
    "so far , we have analyzed all the cases representing possible operating states for the microgrid .",
    "for each case we have found the corresponding values taken by the energy flows @xmath3 , @xmath35 and @xmath287 . also , each case",
    "is characterized by a set of conditions that are necessary for the feasibility of the case itself .",
    "a close inspection of these conditions shows that they are mutually exclusive ( see also the representation of fig .  [",
    "fig : areas ] ) .",
    "thus , each set of conditions is also sufficient , together with necessary , for the respective solution case , meaning that the local minimization problem is univocally solved ."
  ],
  "abstract_text": [
    "<S> in this paper , a distributed convex optimization framework is developed for energy trading between islanded microgrids . more specifically , the problem consists of several islanded microgrids that exchange energy flows by means of an arbitrary topology . due to scalability issues and </S>",
    "<S> in order to safeguard local information on cost functions , a subgradient - based cost minimization algorithm is proposed that converges to the optimal solution in a practical number of iterations and with a limited communication overhead . </S>",
    "<S> furthermore , this approach allows for a very intuitive economics interpretation that explains the algorithm iterations in terms of `` supply  demand model '' and `` market clearing . '' </S>",
    "<S> numerical results are given in terms of convergence rate of the algorithm and attained costs for different network topologies .    </S>",
    "<S> energy trading , smart grid , distributed convex optimization </S>"
  ]
}