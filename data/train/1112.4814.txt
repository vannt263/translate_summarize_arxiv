{
  "article_text": [
    "in order to keep the presentation simple , i prefer to deal only with binary variables ( ising spins ) @xmath0 and hamiltonian containing up to two - body interactions , i.e.  external fields and pairwise couplings .",
    "thus , the most general model i want to study is defined by the following joint probability distribution over @xmath1 ising variables @xmath2\\ ; , \\label{measure}\\ ] ] where the partition function @xmath3 is a normalizing constant , that depends on all the couplings @xmath4 and the external fields @xmath5",
    ". please notice that the temperature parameter has been absorbed in the definition of external fields and couplings .",
    "all the required information about the model is encoded in the free - energy @xmath6 in the rest of this section i summarize the most common mfa to the free - energy : i am particularly interested in deriving the self - consistency equations for the magnetizations that are used in section [ sec : corr ] for obtaining 2-point correlations .",
    "the simplest mfa , also known as naive mf ( nmf ) , approximates the model in terms of local magnetizations @xmath7 , where the angular brackets represent the average w.r.t .",
    "the measure in eq.([measure ] ) .",
    "the corresponding approximation to the free - energy is @xmath8 + \\sum_i h_i m_i + \\sum_{i \\neq j } j_{ij } m_i m_j\\;,\\ ] ] where @xmath9 and the @xmath10 must be fixed according to the self - consistency equations @xmath11\\;.\\label{mimf}\\ ] ]    a better mfa can be obtained by considering also the onsager reaction term @xcite , leading to the following tap approximated free - energy and self - consistency equations @xmath12 + \\nonumber \\\\ & & + \\sum_i h_i m_i + \\sum_{i \\neq j } \\left ( j_{ij } m_i m_j + \\frac12 j_{ij}^2 ( 1-m_i^2)(1-m_j^2 ) \\right)\\ ; , \\label{ftap}\\\\ m_i & = & \\tanh\\left[h_i + \\sum_j j_{ij } \\big(m_j - j_{ij } ( 1-m_j^2 ) m_i\\big ) \\right]\\;.\\label{mitap}\\end{aligned}\\ ] ] in the tap approximation , when computing the marginal probability of spin @xmath13 ( i.e.  its magnetization @xmath10 ) , the reaction term modifies the marginal probabilities of the neighboring spins , @xmath14 , in order to try to remove the effect of the spin @xmath13 under study .",
    "it has been recognized @xcite that @xmath15 and @xmath16 are only the first two terms of the expansion of @xmath17 in small couplings @xmath18 at fixed magnetizations @xmath19 .",
    "this expansion contains @xcite both loop terms , like @xmath20 , and terms with higher powers of a single coupling , i.e.  @xmath21 : the latter terms , that correspond to considering recursively the reaction to the reaction between spins @xmath13 and @xmath22 , can be resummed and lead to the ba .",
    "the ba gives a description of the model in terms of magnetizations @xmath10 and connected correlations @xmath23 between neighboring spins ( i.e.  spins connected by a non - zero coupling @xmath24 ) .",
    "the ba can be derived in two equivalent ways . the first way consists in finding values of @xmath25 and @xmath26 minimizing the following free - energy @xmath27 + \\nonumber\\\\ + \\sum_i ( 1-d_i ) \\left [ h\\left(\\frac{1+m_i}{2}\\right ) + h\\left(\\frac{1-m_i}{2}\\right ) \\right ] + \\sum_i h_i m_i + \\sum_{i \\neq j } j_{ij } ( c_{ij } + m_i m_j)\\;,\\label{eq : fba}\\end{aligned}\\ ] ] where @xmath28 is the degree of spin @xmath13 , i.e.  the number of its neighboring spins .",
    "in eq.([eq : fba ] ) the last two terms correspond to the average value of the energy at given magnetizations and neighbouring correlations , while the first two terms correspond to the entropy of the bethe approximation to the joint probability distribution of the @xmath1 spin variables , @xmath29 where the first product runs over all pair of neighboring spins and the two - spins and single - spin marginal probabilities are given respectively by @xmath30/4 $ ] and @xmath31 .",
    "the conditions @xmath32 can be solved analytically and lead to @xmath33 where @xmath34",
    ". please note that eq.([eq : ip ] ) is identical to eq.(26 ) in ref .   and",
    "this is a further confirmation that resumming all 2-spin terms in the plefka expansion leads to the ba .",
    "moreover eq.([eq : ip ] ) has been used in the literature @xcite as the independent - pair ( ip ) approximation for inferring couplings from magnetizations and correlations : such an approximation infers the coupling @xmath24 by assuming spins @xmath13 and @xmath22 form an isolated pair with magnetizations @xmath10 and @xmath35 and correlation @xmath36 . unfortunately under this ip approximation computing the external fields in not immediate and moreover even the estimates of the couplings are rather poor ( see section [ sec : numeric ] ) .    by making the substitution @xmath37 in @xmath38 one",
    "can obtain the bethe free - energy only in terms of magnetizations , from which the self - consistency equations for the magnetizations can be derived .",
    "however this derivation requires a rather complicated algebra and i prefer to obtain the same equations in a much simpler alternative way .    in the so - called cavity method @xcite local magnetizations @xmath10 and neighbouring",
    "correlations @xmath36 are expressed in terms of some auxiliary variables , the cavity magnetizations @xmath39 ( i.e.  the mean value of @xmath13 in the absence of a neighboring spin @xmath22 ) : @xmath40 cavity magnetizations must satisfy the self - consistency equations @xmath41 \\;.\\label{spemij}\\ ] ] these equations are often solved by an iterative algorithm known as belief propagation ( bp ) @xcite : in case of convergence , the fixed point of bp gives directly the bethe free - energy that admits an expression in terms of cavity magnetizations only @xcite .    in order to obtain a closed set of self - consistency equations in the magnetizations @xmath25 ,",
    "let me solve eqs.([mi]-[mj ] ) for the cavity magnetizations and find @xmath42 where @xmath43 the sign in front of the square root has been chosen such that @xmath44 as it should .",
    "a consistency check can be made by substituting expressions ( [ mijmji ] ) in eq.([cij ] ) to obtain again the result in eq.([cijprimo ] ) .",
    "finally , combining eq.([mi ] ) and eq.([spemij ] ) , it is possible to obtain the self consistency equation for the magnetizations under the ba : @xmath45\\;.\\label{miba}\\ ] ] it is fair to comment that the use of this formula for finding bethe magnetizations is not a good idea : indeed an iterative solution of eq.([miba ] ) is typically more unstable than bp solving eq.([spemij ] ) .",
    "my interest in this formula is that it involves only physical magnetizations ( not cavity ones ) and can be used to obtain correlations ( see section [ sec : corr ] ) and to solve in a fast way the inverse ising problem ( see section [ sec : numeric ] ) .",
    "a series expansion of the exponent in eq.([miba ] ) for small couplings gives @xmath46 and one recognizes that the first two terms of the expansion are the naive mf approximation and the onsager reaction term .",
    "this expansion should make clearer that the ba is a way of considering recursively all the reactions between a pair of neighboring variables .",
    "a preliminary step to solve the inverse ising problem by any mfa is to derive an analytical expression for the pairwise correlations as a function of the coupling constants .",
    "actually , the mfa discussed in section [ sec : mfa ] do not provide information about the correlation between distant variables : indeed , naive mf and tap approximations give @xmath47 for any pair of variables , and the ba only provides an expression for correlation between neighboring spins , see eq.([cijprimo ] ) , which is trivially @xmath48 in case of null magnetizations .    nonetheless , a closed set of equations for the connected correlations with the parameter @xmath36 appearing in the ba : the two coincide only when the ba is exact .",
    "] , @xmath49 for any pair @xmath50 , can be derived from the magnetizations self - consistency equations , eqs.([mimf ] ) , ( [ mitap ] ) , ( [ miba ] ) , through the linear response @xcite @xmath51 the inverse correlation matrices @xmath52 for the three mfa discussed above are given by the following expressions : @xmath53\\delta_{ij } - \\left(j_{ij } + 2 j_{ij}^2 m_i m_j \\right)\\;,\\label{cinvtap}\\\\ \\text{bethe } \\quad ( c_\\text{ba}^{-1})_{ij } & = & \\left[\\frac{1}{1-m_i^2}-\\sum_k \\frac{t_{ik}f_2(m_k , m_i , t_{ik})}{1-t_{ik}^2 f(m_k , m_i , t_{ik})^2}\\right]\\delta_{ij } - \\frac{t_{ij}f_1(m_j , m_i , t_{ij})}{1-t_{ij}^2 f(m_j , m_i , t_{ij})^2}\\;,\\qquad\\label{cinvba}\\end{aligned}\\ ] ] where @xmath54 and @xmath55 . from these expressions",
    "one can obtain directly any correlation by simply computing the inverse of a matrix .",
    "please note that eq.([cinvba ] ) gives exactly the same solution found by the suscprop iterative algorithm @xcite , which is presently considered one among the best inference algorithms .",
    "the main advantage of eq.([cinvba ] ) is that it always provides the correlation matrix , even in those cases where suscprop does not converge to the fixed point .",
    "moreover inverting a matrix takes roughly the same time of a single iteration of suscprop , and so using eq.([cinvba ] ) is much faster than running suscprop , even when the latter converges .    nevertheless , it is fair to notice that the use of eq.([cinvba ] ) does not solve all the problems related to the lack of convergence of suscprop .",
    "indeed , during the many tests i have run , i noticed that often the lack of convergence of suscprop does correspond to the ba fixed point becoming unphysical : in these cases , by inverting the correlation matrix provided by eq.([cinvba ] ) , one gets an unphysical correlation matrix ( e.g. a correlation matrix with negative diagonal elements ! ) . in this sense",
    "the lack of convergence of suscprop gives a warning that the `` blind '' use of eq.([cinvba ] ) does not provide .",
    "so , a general suggestion when using the above formulas , providing an analytical expression for the correlation matrices under a mfa , is to check explicitly the physical consistency of the outcome .",
    "one may comment that eq.([cinvba ] ) contains the magnetizations and the iterative computation of these ( i.e.  the bp algorithm ) suffers the same convergence problems of suscprop : this is easy to prove , given that the homogeneous suscprop equations are nothing but the iterative equations for evolving under bp a small perturbation in the magnetization , and so bp is unstable if suscprop does not converge .",
    "however there are provably convergent algorithms for the computation of magnetizations under the ba @xcite : the use of these algorithms in conjunction with eq.([cinvba ] ) allows a direct computation of correlations under the ba .",
    "moreover there are situations where magnetizations are known a priori and eq.([cinvba ] ) can be applied directly : e.g.  when symmetries in the probability measure force magnetizations to be zero , or in the inverse ising problem , where magnetizations are given as an input to the problem .",
    "in the rest of the paper i deal mainly with these two cases .",
    "a preliminary ranking of mfa can be done on the basis of how good are their estimates of correlations , given the couplings .",
    "indeed i expect that the better is this estimate , the better will be the solution to the inverse problem .    for simplicity",
    "i concentrate on models with no external fields and the couplings are multiplied by a parameter @xmath56 ( the inverse temperature ) such that the difficulty of the inference problem increases with @xmath56 .    in case of null magnetizations , the expressions for the inverse correlation matrices simplify a lot @xmath57\\delta_{ij } - j_{ij}\\;,\\\\ \\text{bethe } \\qquad ( c_\\text{ba}^{-1})_{ij } & = & \\left[1+\\sum_k \\frac{t_{ik}^2}{1-t_{ik}^2}\\right]\\delta_{ij } - \\frac{t_{ij}}{1-t_{ij}^2}\\;,\\label{cinvbam0}\\end{aligned}\\ ] ] since @xmath58 and @xmath59 .    given that for @xmath60 the expressions for the correlation matrices are much simpler ,",
    "i report also those that can be obtained from the plefka expansion at the third and fourth order @xmath61\\delta_{ij } - \\left ( j_{ij } + \\frac23 j_{ij}^3 \\right)\\;,\\\\ 4^\\text{th } \\text { order } \\qquad ( c_4^{-1})_{ij } & = & \\left[1 + \\sum_k j_{ik}^2 + 2 \\sum_{k,\\ell } j_{ik } j_{k\\ell } j_{\\ell i } + \\frac13 \\sum_k j_{ik}^4 + 2 \\sum_{k,\\ell , m } j_{ik } j_{k\\ell } j_{\\ell m } j_{mi } \\right]\\delta_{ij } + \\nonumber\\\\ & & - \\left ( j_{ij } + \\frac23 j_{ij}^3 + 2 j_{ij}^2 \\sum_k j_{ik } j_{kj } \\right)\\;.\\label{last}\\end{aligned}\\ ] ] the purpose is to understand if and how much does the estimate of the correlation matrix improve by adding terms in the plefka expansion .",
    "i have tested the accuracy of formulas in eqs.([first]-[last ] ) for ferromagnetic ( @xmath62 ) and spin glass ( @xmath63 ) models defined on fully connected ( fc ) topologies , on a 2d square lattice and on a 3d cubic lattice . in diluted versions of these models",
    "a fraction @xmath64 of couplings has been set to zero . in models defined on fc graphs",
    "the couplings have been normalized such as to have a critical inverse temperature @xmath65 in the thermodynamic limit .",
    "the discrepancy between true correlations @xmath66 and those inferred @xmath67 is defined as @xmath68 in figure [ plot_2d_all ] and [ plot_other ] i report the typical behavior of the error @xmath69 between exact and estimated correlation matrices for 5 different mfa .",
    "figure [ plot_2d_all ] shows results for models defined on a 2d square lattice , while figure [ plot_other ] refers to fc and 3d topologies . in order to compare the mfa estimates with the exact correlation matrices i am studying here small systems , but the qualitative behavior does not change for larger sizes .",
    "( the qualitative behavior does not change for larger sizes ) . ]     for typical samples of the fully - connected spin glass ( sk model ) of size @xmath70 and of the 3d diluted ferromagnet of size @xmath71 . ]",
    "although the quantitative behavior of @xmath69 depends on the specific sample , some general statements can be made :    naive mf is typically the worst mfa and shows many spurious singularities ( roughly one for each peak in @xmath69 ) ;    tap and @xmath72 order approximations typically show no ( or very rare ) singularities ;    the best estimate is typically provided by ba and tap , with ba being the best unless it has a singularity ( in this case tap becomes the best at lower temperatures , higher @xmath56 ) .",
    "these results suggest that increasing the number of terms in the plefka expansion does not always improve the estimate of the correlation matrix ( as one could have naively expected ) . on the basis of these preliminary results",
    "i believe it is relevant to consider only tap and ba for the inverse ising problem , together with other inference methods ( see section [ sec : inverse ] ) .    in the left panel of figure [ plot_other ] the results obtained by tap and ba",
    "are almost perfectly superimposed ( indeed the former in not well visible ) .",
    "this is expected since the tap approximation is exact for the sk model at high temperatures ( @xmath73 ) in the large @xmath1 limit : so the ba can not improve it , but in @xmath74 corrections .",
    "indeed a careful analysis shows a tiny improvement of ba over tap around the critical temperature , where @xmath74 corrections are stronger .",
    "please note that in the right panel of figure [ plot_other ] the high temperature ( small @xmath56 ) behavior of @xmath69 is very different than in previous plots : indeed for @xmath75 , @xmath69 goes to a constant , instead of decreasing with a power law in @xmath56 ( as in figure [ plot_2d_all ] and in the left panel of figure [ plot_other ] ) .",
    "this is due to the fact that the comparison has not been made with the exact correlation matrix , but with correlations measured from a monte carlo ( mc ) simulation .",
    "actually , in this case , i have used the wolff algorithm and the correlation matrix has been computed from @xmath76 independent measures .",
    "the difference between the error due to the mfa and the error due to mc noisy data can be better appreciated in figure [ plot_2d_mcvsexact ] : in the high temperature region the error does not decrease below a limiting value given roughly by the inverse of the square root of the number of measures .",
    "expressions in eqs.([first]-[last ] ) are intrinsically approximated , and turn out to be correct only in some particular cases .",
    "naive mf and tap approximations ( as well as @xmath77 and @xmath72 orders approximations ) , being the first orders in a small couplings expansion , are exact only in the limit of very weak couplings ( either high temperature or fully - connected models in the large @xmath1 limit ) .",
    "the ba , on the contrary , is exact also for coupling intensities @xmath78 , but only if the interacting network is a tree ; on random graph models ( which are locally tree - like ) the ba turns out to be correct as long as the model has only one state ( modulo the known symmetries ) . on any other model",
    "those expressions are approximated and it is worth trying to improve it .",
    "let me first notice that any of the above mfa returns in general a value for the self - correlation differing from the exact one , i.e.  @xmath79 ( for simplicity i consider the case of null magnetizations , but the argument is general ) .",
    "this fact can be easily explained , noticing that all the above mfa assume that correlations along loops are vanishingly small ( at least in the large @xmath1 limit ) . on the contrary , on any loopy graph , like e.g.  regular lattices , correlations along loops are important and may alter significantly the mean - field estimates .",
    "a general solution to this problem is still not available , although many work is in progress to include loop contributions to mfa @xcite .",
    "what i am proposing here is a simple heuristic improvement .",
    "once the correlation matrix @xmath80 is computed by one of the approximations described in section [ sec : corr ] , a properly _ normalized _ correlation matrix can be defined @xmath81 by definition @xmath82 and also off - diagonal element may approximate better the true correlations .",
    "the reason for this is that the loops neglected in mfa actually modify in a similar way both self - correlations @xmath83 and off - diagonal correlations @xmath80 , and the heuristic normalization in eq.([normc ] ) is assuming that the modifying factor only depends on the loop structure around sites @xmath84 and @xmath85 ( which is certainly wrong for distant sites , but may be a reasonable approximation for closed - by sites ) .     for a typical sample of the 2d diluted ferromagnet of size @xmath86 .",
    "the error @xmath69 has been computed with respect to the exact correlation matrix and with respect to the one measured in mc simulations .",
    "full points show the error obtained with the normalization trick . ]    in figure [ plot_2d_mcvsexact ] full points show that the error @xmath69 in the ba decreases by roughly one order of magnitude if normalized correlations are used . on the contrary ,",
    "the tap result is not very sensitive to this normalization : the reason is that the estimates of the self - correlations in tap remain quite close to the right value , specially if compared to ba estimates that diverge at the singularity ( mark by a peak in figure [ plot_2d_mcvsexact ] ) . on the right of such a peak",
    "the error obtained by the normalized ba is not reported because eq.([normc ] ) can not be used , since several ba estimates for self - correlations are negative .",
    "this is the problem of the ba fixed point becoming ( strongly ) unphysical , already discussed in section [ sec : corr ] : indeed by running suscprop on this sample one would observe convergence only for @xmath56 smaller than the peak location .",
    "i would like to stress again that checking the physical consistency of a solution based on a mfa is very important : for the sample shown in figure [ plot_2d_mcvsexact ] , even without knowing the exact correlations , one should switch from the ba to tap , when the former reaches the singularity ( that manifests e.g.  in suscprop not converging or in self - correlations diverging ) , the correlation matrix can be computed by mean of eq.([cinvba ] ) .",
    "however in the general case , bp does not converge in presence of long range correlations , i.e.  after the singularity , and one must resort to other mfa . ] .",
    "moreover there are cases ( e.g. homogeneous fc models ) where the spurious singularity induced by the mfa in a system of finite size is such that @xmath83 and @xmath80 diverge with the same law at the spurious critical point , while the normalized correlation @xmath87 stays finite ( and much closer to the true one ) .",
    "for example for the fc ferromagnetic model the normalized correlation @xmath88 estimates the true correlation with an error roughly half than the one of @xmath89 for any of the 5 mfa considered here .",
    "i consider 4 different approximations for solving the inverse ising problem .",
    "the simplest one is the independent - pair ( ip ) approximation , already discussed in section [ sec : mfa ] and recalled here for convenience @xmath90 among the mfa which can be derived from the plefka expansion , i consider only tap and ba , because are those performing better in the direct problem of estimating correlations ( see section [ sec : corr ] ) .",
    "the corresponding expressions for the inferred couplings can be obtained by solving the equation @xmath91 for tap and the equation @xmath92 for the ba , thus leading to @xmath93\\;.\\label{ba}\\end{aligned}\\ ] ] the fourth approximation i am considering has been obtained from a small correlation expansion by sessak and monasson @xcite and has been further simplified in ref .   to the following expression @xmath94    for each approximation ,",
    "i measure the error in inferred couplings @xmath95 with respect to the true ones @xmath24 by the following expression @xmath96    i study both diluted ferromagnetic model with a fraction @xmath97 of non - zero couplings ( @xmath98 ) and undiluted spin glass models ( @xmath99 with probability @xmath100 ) .",
    "i also consider several topologies : 2d square lattices , 3d cubic lattices , random regular graphs with fixed degree @xmath101 and fully connected ( fc ) graphs . in the latter case",
    "the couplings are normalized in order to have a phase transition at @xmath65 in the thermodynamic limit .",
    "i restrict the study to models of small sizes , with @xmath1 ranging between 20 and 100 , because these are the sizes for problems of biological interest .",
    "moreover , as discusses below , the number @xmath102 of independent measurements of the correlation matrix that make inferred coupling reasonably good grows linearly with @xmath1 and so for larger systems the number of measurements needed become too large .",
    "the data shown in section  [ sec : numeric ] have been obtained with @xmath103 independent measures of the correlation matrix ( unless differently stated ) and going to much larger values seems to me rather unrealistic if compared with practical applications .",
    "the trick of normalizing the correlation matrix to improve inference ( see section [ sec : trick ] ) can be extended to the inverse ising problem . in practice",
    ", it corresponds to solve _ all _ the equations relating the inverse correlation matrix @xmath52 to the couplings @xmath24 , including also those for the diagonal elements which are usually ignored .",
    "let me illustrate the new method for the simple case of the tap approximation with null magnetizations . in this case ,",
    "solving the inverse ising problem only on the off - diagonal elements is equivalent to solve the equations @xmath104 but the diagonal equations are in general unsatisfied @xmath105 where @xmath106 is the inverse correlation matrix estimated by tap once coupling @xmath24 are given .",
    "please notice that diagonal elements @xmath107 are fully determined once the off - diagonal elements are known .",
    "following eq.([normc ] ) i would like to normalize the estimated matrix @xmath106 , and produce a normalized inverse correlation matrix @xmath108 , matching better the true inverse correlation matrix @xmath52 .",
    "in other words i would like to solve the equations @xmath109 where the @xmath1 variables @xmath110 are exactly those necessary to solve the new @xmath1 diagonal equations .",
    "physically speaking , @xmath111 should be the self - correlation @xmath83 produced by the mfa , when using the right couplings @xmath24 .",
    "when the @xmath110 becomes very different from 1 , then the mfa is working very badly ; however i expect situations where some of the errors produced by the mfa can be compensated by this normalization trick .",
    "unfortunately the solution to the new equations , those involving both @xmath24 and @xmath110 , does not have an analytical expression and need to be solved numerically .",
    "i have adopted an iterative solution , which is very fast ( when it converges ) . in practice ,",
    "i start with all @xmath112 and then , iteratively , first i solve the off - diagonal equations , thus getting an estimate for the couplings , and then i solve the diagonal equations to obtain a new estimate for the @xmath113 s .",
    "i repeat this iterative procedure , updating @xmath113 s with a damping factor , until the @xmath113 s variations is below a threshold ( typically @xmath114 ) .    from the many tests i have run",
    ", i noticed that this normalization trick is more relevant for unfrustrated models ( as the diluted ferromagnets studied below ) or models containing regions very weakly frustrated ( those usually leading to griffith singularities ) .",
    "most probably in these weakly frustrated regions correlations get self - reinforced by the loops ( ignored in the mfa ) and thus the normalization trick may improve coupling estimates . on the contrary for strongly disordered models , like spin glasses , the effect of the normalization trick depends a lot on the disorderd sample and it does not seem to give a clear improvement on average .    the use of the normalization trick for improving inference in the inverse ising problem may resemble the diagonal - weight trick introduced in ref .  , but it is actually very different . in the diagonal - weight trick , the self - couplings @xmath115 are allow to take non - zero values in order to solve all the equations @xmath116 , while in the normalization trick the self - couplings @xmath115 remain null .",
    "it has been shown @xcite that the the first order approximation ( nmf ) with the diagonal - weight trick improves over the second order approximation ( tap ) in estimating magnetizations .",
    "however the estimates for the couplings do not improve at all , because the off - diagonal equations are left unchanged by the diagonal - weight trick . on the contrary ,",
    "the normalization trick used here does change the estimates for the couplings . moreover , being based on the very general requirement that self - correlations must take the right value , it can be applied to any approximation .",
    "let me start by making some general statements that summarize the numerical results shown in this section .",
    "among the four approximations studied ( ip , tap , sm and ba ) it seems in general true that :    * ip always provides the worst estimate , especially at high temperatures ( low @xmath56 ) ; * ba always outperforms tap ; * between sm and ba , the former is better in the high temperature ( low @xmath56 ) phase , while the latter is better at lower temperatures ( higher @xmath56 values ) ; * at low @xmath56 , the error @xmath117 in couplings inference is completely dominated by the uncertainty on the correlation matrix and it does not depend on the inference method : for this reason the range where sm is the best method becomes tiny , especially for noisy data ; * at high @xmath56 , the error @xmath117 produced by tap and sm diverge , the one by ip stays limited , but very high , and only ba may have a reasonable error ; * for diluted ferromagnetic models the normalization trick works fine and thus ba with the normalization trick is the best method overall ; * in presence of an external field , i.e.  when magnetizations are different from zero , tap and ba stop working at high enough @xmath56 values ( i.e.  these methods do not admit a solution ) ; given that at high @xmath56 neither ip nor sm provide acceptable inferred couplings , i conclude that in such a situation the inverse ising problem needs to be solved by other methods not explored in the present work .       in inferred couplings on the number @xmath102 of independent measures for the correlation matrix .",
    "the model is a ferromagnet of @xmath70 variables on a regular random graph of fixed degree @xmath101 , whose critical temperature is marked by the vertical dotted line . ]",
    "let me start discussing the high temperature ( low @xmath56 ) regime . in figure",
    "[ fig : numsam ] are reported the errors @xmath117 in inferring the couplings of a ferromagnetic model of @xmath70 variables on a regular random graph of fixed degree @xmath101 .",
    "for simplicity i am plotting only the results obtained with sm and ba .",
    "data in the upper curves have been computed using a correlation matrix averaged over @xmath102 independent measurements , while data in lower curves have been computed from the exact correlation matrix .",
    "it is clear that the low @xmath56 regime is completely dominated by the uncertainty in the correlation matrix ( as already noticed in ref .",
    "@xcite ) , and the error in this regime is independent on the inference method used .",
    "for this reason the good performances of sm in this regime are actually washed out and , even for @xmath103 measurements , the improvement of sm over ba is very limited ( see figure  [ fig : numsam ] ) .",
    "moreover such an improvement tends to become smaller by increasing the system size because in the low @xmath56 regime the error goes like @xmath118    i think that comparing inference methods by using the exact correlation matrix is rather unrealistic , given that in any practical application the correlations are always known with some uncertainty . so in presenting below the numerical results i always consider the case with @xmath103 independent measurements for the magnetizations and the correlations .",
    "( left ) and @xmath119 ( right ) .",
    "the vertical dotted lines mark the locus of the ferromagnetic phase transition in the thermodynamic limit.,title=\"fig : \" ]   ( left ) and @xmath119 ( right ) .",
    "the vertical dotted lines mark the locus of the ferromagnetic phase transition in the thermodynamic limit.,title=\"fig : \" ]    . shown",
    "are typical samples for 4 different dilutions : 0.6 , 0.7 , 0.8 and 0.9 .",
    "the vertical dotted lines mark the loci of the ferromagnetic phase transitions in the thermodynamic limit.,title=\"fig : \" ] . shown",
    "are typical samples for 4 different dilutions : 0.6 , 0.7 , 0.8 and 0.9 .",
    "the vertical dotted lines mark the loci of the ferromagnetic phase transitions in the thermodynamic limit.,title=\"fig : \" ] . shown",
    "are typical samples for 4 different dilutions : 0.6 , 0.7 , 0.8 and 0.9 .",
    "the vertical dotted lines mark the loci of the ferromagnetic phase transitions in the thermodynamic limit.,title=\"fig : \" ] . shown",
    "are typical samples for 4 different dilutions : 0.6 , 0.7 , 0.8 and 0.9 .",
    "the vertical dotted lines mark the loci of the ferromagnetic phase transitions in the thermodynamic limit.,title=\"fig : \" ]    in figure [ ferrobethe ] i am showing the error in the couplings inferred by several approximation for a ferromagnet on a random regular graph with fixed degree @xmath101 .",
    "the two panels correspond to sizes @xmath70 ( left ) and @xmath119 ( right ) and show that the qualitative behavior is mostly size independent .",
    "also the dependence on the specific sample ( i.e. , on the random graph ) is rather weak .",
    "the data in figure  [ ferrobethe ] support many of the statements written above : ( i ) ip is a very bad approximation even in the low @xmath56 regime ; ( ii ) ba always outperforms tap ; ( iii ) sm is better than ba only in the low @xmath56 regime , but here the error is dominated by the uncertainty in the correlation and increases with the system size , so the improvement of sm over ba is tiny ; ( iv ) errors in tap and sm diverge for large @xmath56 , while those in ip and ba remains finite , although very large ; ( v ) the normalization trick works nicely and gives actually the best result in a wide range of temperatures .",
    "the data for tap with the normalization trick ( label `` tap norm '' ) are interrupted because at large @xmath56 the iterative procedure i am using for finding the parameters @xmath120 stops converging .",
    "the same qualitative conclusions can be reached by studying a diluted ferromagnet on a 2d square lattice for several different dilutions ( see figure  [ ferro2d ] ) . in particular the relative quality of the approximations",
    "seems to be independent on the dilution , and the ba with the normalization trick outperforms the other inference methods .",
    "however i notice that , while the error of ba ( with and without the normalization trick ) at the critical temperature is roughly independent on the dilution , the errors made by tap and sm tend to increase when the dilution is stronger and the system becomes more heterogenous .    .",
    "shown are two typical samples with different dilutions .",
    "the vertical dotted lines mark the loci of the ferromagnetic phase transitions in the thermodynamic limit.,title=\"fig : \" ] . shown",
    "are two typical samples with different dilutions .",
    "the vertical dotted lines mark the loci of the ferromagnetic phase transitions in the thermodynamic limit.,title=\"fig : \" ]    all the conclusions reached for the 2d case , perfectly apply also to the case of a diluted ferromagnetic model on a 3d cubic lattice ( see figure  [ ferro3d ] ) .",
    "so it is very reasonable to conclude that the statements made at the beginning of this section apply to any diluted ferromagnet independently on the specific topology .      ) on different topologies : random regular graphs with fixed degree 4 ( upper panels ) , 3d cubic and 2d square lattices ( lower panels ) .",
    "the vertical dotted lines mark the loci of the spin glass phase transitions in the thermodynamic limit.,title=\"fig : \" ] ) on different topologies : random regular graphs with fixed degree 4 ( upper panels ) , 3d cubic and 2d square lattices ( lower panels ) .",
    "the vertical dotted lines mark the loci of the spin glass phase transitions in the thermodynamic limit.,title=\"fig : \" ] ) on different topologies : random regular graphs with fixed degree 4 ( upper panels ) , 3d cubic and 2d square lattices ( lower panels ) .",
    "the vertical dotted lines mark the loci of the spin glass phase transitions in the thermodynamic limit.,title=\"fig : \" ] ) on different topologies : random regular graphs with fixed degree 4 ( upper panels ) , 3d cubic and 2d square lattices ( lower panels ) .",
    "the vertical dotted lines mark the loci of the spin glass phase transitions in the thermodynamic limit.,title=\"fig : \" ]    also for spin glass models the conclusions reached above apply very well : the relative goodness of the various approximations is roughly unchanged .",
    "the only major difference is that the normalization trick does not provide any more a clear improvement : its performances strongly depend on the disorder sample . in figure [ sgmodels ]",
    "i am reporting the error on the inferred coupling for spin glass models on a random regular graph with fixed degree @xmath101 , on a 3d cubic lattice and a 2d square lattice .",
    "again , willing to suggest a general purpose inference method , the choice is clearly in favor of the ba .",
    "please notice that by running suscprop it would be impossible to obtain the results shown in figure  [ sgmodels ] , because of the limited range of convergence of such an algorithm .",
    "indeed for spin glass models on a random graph suscprop stops converging around the critical temperature and for spin glass models on a regular lattice it stops converging even before , well into the high temperature phase : for example for the a spin glass model on a 2d square lattice it converges up to @xmath121 @xcite and on a 3d cubic lattice up to @xmath122 @xcite . in this sense , the use of the new formula in eq.([ba ] ) is really innovative .",
    "( upper left , just for comparison ) , sk model @xmath123 ( upper right ) , sk model @xmath124 ( lower left ) and spin glass on a random regular graph with fixed degree @xmath101 and @xmath125 ( lower right ) .",
    "the vertical dotted lines mark the loci of the spin glass phase transitions in the thermodynamic limit . in presence of an external field",
    "tap and ba cease to have a solution for high enough @xmath56 values.,title=\"fig : \" ]   ( upper left , just for comparison ) , sk model @xmath123 ( upper right ) , sk model @xmath124 ( lower left ) and spin glass on a random regular graph with fixed degree @xmath101 and @xmath125 ( lower right ) .",
    "the vertical dotted lines mark the loci of the spin glass phase transitions in the thermodynamic limit . in presence of an external field",
    "tap and ba cease to have a solution for high enough @xmath56 values.,title=\"fig : \" ]   ( upper left , just for comparison ) , sk model @xmath123 ( upper right ) , sk model @xmath124 ( lower left ) and spin glass on a random regular graph with fixed degree @xmath101 and @xmath125 ( lower right ) .",
    "the vertical dotted lines mark the loci of the spin glass phase transitions in the thermodynamic limit . in presence of an external field",
    "tap and ba cease to have a solution for high enough @xmath56 values.,title=\"fig : \" ]   ( upper left , just for comparison ) , sk model @xmath123 ( upper right ) , sk model @xmath124 ( lower left ) and spin glass on a random regular graph with fixed degree @xmath101 and @xmath125 ( lower right ) .",
    "the vertical dotted lines mark the loci of the spin glass phase transitions in the thermodynamic limit . in presence of an external field",
    "tap and ba cease to have a solution for high enough @xmath56 values.,title=\"fig : \" ]    let me finally come to the most surprising case : frustrated models in presence of an external field . as shown in figure  [ sgfield ] , once more the relative level of accuracy of the 4 approximations tested is the same , but the is a major difference with respect to case of zero field ( which has been reported in the upper left panel of figure  [ sgfield ] for reader convenience ) . at high enough @xmath56 values , both tap and ba cease to have a solution to eqs.([eq : tap ] ) and ( [ eq : ba ] ) or equivalently the expressions under the square roots in eqs.([tap ] ) and ( [ ba ] ) become negative . to my knowledge",
    ", this fact has been never noticed in the past , although the tap approximation for inferring couplings is largely used .",
    "in the appendix i sketch the analytical solution to the simplest model showing this phenomenon , namely a system of 3 spins connected by antiferromagnetic couplings in presence of an external field : such an analytical solution should convince the reader that the phenomenon is not due to any numerical inaccuracy related to the complexity of the models studied here , but it can be mathematically proved in a very simple model .    the absence of solutions in tap and ba is evident in figure  [ sgfield ] where the corresponding curves are interrupted at a @xmath56 value that becomes smaller for larger fields . beyond the point where ba stops providing inferred couplings , one should resort to other inference methods .",
    "unfortunately at that point both sm and ip already give quite large errors , that keep growing fast .",
    "so in practice none of the methods studied in the present work is valid for inferring couplings in a frustrated model in presence of an external field at low enough temperatures .",
    "the purpose of the present work is to make a detailed comparison among several approximation for solving the inverse ising problem , i.e. , estimating coupling and fields form magnetizations and correlations .",
    "after having explained how to derive the mean - field approximations based on the plefka expansion ( naive mean - field , tap , bethe approximations , etc ... ) , i have ranked these approximations on the basis of how good they are in solving the direct problem ( i.e. , computing the correlations given the couplings ) .",
    "tap and bethe turned out to be in general the best approximations available .",
    "secondly i have derived the new analytical formula ( [ ba ] ) for inferring couplings from magnetizations and correlations under the bethe approximation .",
    "this formula allow to infer couplings without running the susceptibility propagation algorithm , thus avoiding all the serious problems related to the lack of convergence of such an algorithm .",
    "after having summarized the formulas giving the inferred couplings for the 4 approximations tested ( independent - pair , tap , bethe and the small correlation expansion of ref .  ) , i have introduced a trick that , normalizing the correlation matrix , improves the tap and the bethe approximations in case of models being unfrustrated or weakly frustrated .",
    "finally i have presented the results of the comparison among the 4 approximations for inferring couplings in diluted ferromagnetic models and spin glass models .",
    "i have used several different topologies : fully connected graphs , regular random graphs , 3d cubic lattices and 2d square lattices .    at the beginning of section  [ sec : numeric ] a list of general statements about the performances of these approximations in solving the inverse ising problem",
    "the bottom - line suggestion is to use the bethe approximation , eq.([ba ] ) , eventually with the normalization trick if the model is weakly frustrated or unfrustrated .    in case of frustrated models with an external field (",
    "that is with non - zero magnetizations ) i have found an important limitation for the tap and bethe approximations : at low enough temperatures these approximations stop having a solution and can not be used any more for solving the inverse ising problem .",
    "this is a fundamental limitation , that take place also in very simple systems ( see the appendix ) and that was not noticed before .",
    "moreover , when the bethe approximation stops inferring couplings , the other methods already have a rather large error .",
    "so , in my opinion , it is still an open problem to find an approximation that , using only the correlation matrix , is able to solve the inverse ising problem in a frustrated model with a field at low enough temperatures .",
    "i acknowledge interesting conversations with a. decelle , s. franz , a. pelizzola , i. perez - castillo and j. raymond , and financial support by the italian research minister through the firb project no .",
    "rbfr086nn1 on `` inference and optimization in complex systems : from the thermodynamics of spin glasses to message passing algorithms '' .    after the completion of the present manuscript i learnt of a manuscript by h.  c. nguyen and j. berg @xcite showing a formula similar to eq.([ba ] ) .",
    "in this appendix i show explicitly that the formulas derived with tap and ba for solving the inverse ising problem do not always admit a solution for the case of frustrated models . in order to simplify the computation i focus on the simplest model showing this problem , namely a system of 3 spins interacting with antiferromagnetic couplings of intensity @xmath126 , in presence of an external field of intensity @xmath127 ,",
    "whose probability distribution is @xmath128\\;.\\ ] ] thanks to the symmetries in the above measure , each spin has the same local magnetization @xmath129 and each pair of spins has the same correlation @xmath130 .",
    "when using the tap approximation for the inverse problem one has to solve the following equation for each coupling @xmath24 , @xmath131 and the above equation admit a solution only if its discriminant is non - negative : @xmath132      in the present case , the discriminant is the same for each coupling and it is a function of the two parameters @xmath134 and @xmath127 , that i report schematically in figure  [ fig : discr ] .",
    "the full curve shown in figure  [ fig : discr ] corresponds to @xmath135 and has two asymptotes at @xmath136 and @xmath137 .",
    "it is clear that for any non - zero field @xmath127 and any antiferromagnetic coupling @xmath134 the inference method based on the tap approximation will fail at sufficiently small temperatures ( i.e. , large absolute values of @xmath127 and @xmath134 ) .",
    "the same phenomenon happens also for the inference method based on the ba . in this case",
    "the discriminant that may become negative is @xmath138 in figure  [ fig : discr ] the dashed line corresponds to @xmath139 and has two asymptotes at @xmath140 and along the line @xmath141 ( meaning that for this simple system of 3 spins the ba can work even a very low temperatures if the external field is large enough ) .",
    "t. heskes , c. albers , and h. kappen , in proceedings of the conference on uncertainty in artificial intelligence , 2003 , edited by christopher meek and uffe kjaerulff ( morgan kaufmann , san francisco , 2003 ) , p. 313 ."
  ],
  "abstract_text": [
    "<S> the inverse ising problem consists in inferring the coupling constants of an ising model given the correlation matrix . </S>",
    "<S> the fastest methods for solving this problem are based on mean - field approximations , but which one performs better in the general case is still not completely clear . in the first part of this work , i summarize the formulas for several mean - field approximations and i derive new analytical expressions for the bethe approximation , which allow to solve the inverse ising problem without running the susceptibility propagation algorithm ( thus avoiding the lack of convergence ) . in the second part , </S>",
    "<S> i compare the accuracy of different mean field approximations on several models ( diluted ferromagnets and spin glasses ) defined on random graphs and regular lattices , showing which one is in general more effective . </S>",
    "<S> a simple improvement over these approximations is proposed . </S>",
    "<S> also a fundamental limitation is found in using methods based on tap and bethe approximations in presence of an external field </S>",
    "<S> .    mean - field approximations ( mfa ) are very important tools in statistical mechanics , since they provide an approximated description of a physical system in terms of few parameters ( e.g.  local magnetizations ) . among mfa </S>",
    "<S> the one based on the bethe approximation ( ba ) is very effective . in recent years </S>",
    "<S> the ba  originally derived for the ferromagnetic model on regular lattices @xcite  has been extended , under the name of cavity method , to models having arbitrary couplings and topologies @xcite . </S>",
    "<S> although the ba is exact only for tree - like topologies , its application to models defined on random graphs has proved very successful : see e.g. the cases of low - density parity check codes , spin glasses and constraint satisfaction problems , all nicely reviewed in ref .  .    </S>",
    "<S> the inverse ising problem , originally known as boltzmann machine learning , consists in inferring coupling constants of an ising model ( both pairwise interactions and external fields ) given the vector of magnetizations and the matrix of pairwise correlations . in recent years </S>",
    "<S> the inverse ising problem has received a lot of attention , specially in connection to inference in biological problems @xcite .    </S>",
    "<S> the inverse ising problems can be viewed as the dual problem with respect to the ` direct ' problem of estimating magnetizations and correlation given the hamiltonian . </S>",
    "<S> so , under any mfa , the inverse problem can be solved by inverting ( if possible ) the analytic expressions that give the magnetizations and the correlations as a function of interactions and fields . </S>",
    "<S> although mfa usually do not provide directly the correlations between distant variables , these correlations can be computed by using the linear response theorem @xcite .    within the ba , a very fast and efficient way to estimate correlations between any pair of variables is given by the susceptibility propagation ( suscprop ) algorithm recently introduced in ref .  . </S>",
    "<S> suscprop is an iterative algorithm for solving a set of self - consistency equations : when it converges is very fast , but sometimes it may not converge . indeed </S>",
    "<S> the application of the ba to the inverse ising problem has been limited up to now by the range of convergence of suscprop @xcite .    </S>",
    "<S> in this work i present an analytical expression for the fixed point of suscprop , thus avoiding any problem related to its lack of convergence . </S>",
    "<S> actually such an expression already appeared in ref .  , but was unknown to the statistical mechanics community ( including the author ) : otherwise there would be no need for the suscprop algorithm introduced in ref .  .    </S>",
    "<S> in the first part of this work i derive new analytical expressions for solving the inverse ising problem under the ba . </S>",
    "<S> these analytical expressions , allow for a fair comparison among different mfa , in a wide range of temperatures , both for the problem of estimating 2-point correlations given the couplings ( direct problem ) and for the problem of estimating couplings given correlations and magnetizations ( inverse problem ) .    in the present work </S>",
    "<S> i consider mfa obtained from the so - called plefka expansion @xcite and from a small correlations expansion @xcite . </S>",
    "<S> for the inverse ising problem i compare methods that take in input only the correlation matrix . </S>",
    "<S> more complex , but usually slower , inference methods exist that require many samples of equilibrium configurations @xcite and not only the correlation matrix .    improving over these mfa would be very welcome . it is well known </S>",
    "<S> that mfa ignore loops , so correcting these mfa by adding the loops contributions would be the right direction to follow . </S>",
    "<S> however at present all the methods which has been developed to consider explicitly the loops @xcite do not provide analytical expressions for the correlations , which are simple enough to be inverted . </S>",
    "<S> for this reason , i have not considered these improved algorithms in the comparison of mfa for solving the inverse ising problem .    </S>",
    "<S> nonetheless , i am proposing a simple improvement of inference methods ( both for the direct and the inverse problems ) based on the idea that the loops may modify similarly self - correlations and correlations between close - by variables . </S>"
  ]
}