{
  "article_text": [
    "computation of the so - called exchange operator is often the most expensive step in electronic structure models applicable to large systems , such as the hybrid@xcite density functional theory ( dft ) and hartree - fock ( hf),@xcite the latter of which serves as the starting point for electron correlation treatment with modern reduced - scaling many - body methods.@xcite the exchange matrix , @xmath0 , is given by @xmath1 where @xmath2 , @xmath3 , @xmath4 , @xmath5 , ",
    "denote basis functions , @xmath6is the density matrix , and @xmath7 are the electron repulsion integrals ( eris ) in the mulliken `` bra - ket '' notation .",
    "here we consider atom - centered basis functions @xmath8 , typically represented by ( contracted ) gaussian - type orbitals .",
    "although @xmath9 decays with the bra - ket distance @xmath10 only as @xmath11 ( i.e. , slowly ) , the decay of the density matrix @xmath12 in a finite system ( and , generally , any system with a nonzero band gap ) is exponential with the distance between @xmath4 and @xmath5.@xcite therefore , as first noted by almlf,@xcite the number of nontrivial elements of the exchange matrix @xmath0grows linearly with system size  that is , @xmath0has @xmath13significant elements ( @xmath14 system size ) .",
    "a number of linear - scaling methods for the computation of @xmath0have been investigated over the years , with pioneering work done in chemistry in the mid-1990s by schwegler , challacombe , and head - gordon@xcite and burant , scuseria , and frisch.@xcite several related algorithms have been developed , e.g. onx by challacombe et al and linkby ochsenfeld , white , and head - gordon@xcite .",
    "the aforementioned @xmath13algorithms for exchange take advantage of the element - wise sparsity of the eri and density matrix tensors in eq .  .",
    "some effort has gone into utilization of rank sparsity of the eri tensor , as revealed by the multipole expansion of the coulomb operator,@xcite by the pseudospectral and related factorizations of eri,@xcite or , as done here , by the density fitting approximation of eris.@xcite the density fitting approximation@xcite ( df , also called resolution of the identity ) , expresses the two - center products in the bra and the ket of the eri tensor ( often called `` densities , '' not to be confused with the density matrix  @xmath6 ) as linear combinations of one - center functions from an auxiliary basis : @xmath15 where @xmath16 , @xmath17 ,    are indices in an auxiliary basis set . to obtain the coefficients @xmath18 , one must left - project with the auxiliary basis to obtain a system of linear equations : @xmath19 the solution of these equations in their full form requires 3 effort and is thus untenable for large molecular systems . moreover ,",
    "substitution of the form in eq .   into the exchange matrix expression in eq .",
    "does not reduce the formal scaling of the exchange matrix build .",
    "consequently , significant work has been done on methods of reducing the scaling of eq .  , principally by localizing the fitting basis.@xcite",
    "significantly less research has been done on the use of these localized decompositions for the exchange matrix build , eq .  , particularly in the context of the linear",
    "scaling exchange work of the late 1990s .",
    "indeed , only sodt and head - gordon@xcite have investigated a linear scaling exchange construction with local df .",
    "also , neese and coworkers@xcite presented a linear scaling algorithm for hf exchange in the context of their `` chain - of - spheres '' exchange ( cosx ) method , which borrows elements from both df and the pseudo - spectral method of friesner , et al.@xcite herein , we present a linear scaling hf exchange algorithm and implementation using the concentric atomic density fitting ( cadf ) approach , based on a concept that has been around for some time@xcite and was recently revived by merlot , et al.@xcite and the present authors.@xcite    in section  [ sec : theory ] , we briefly review the theory behind cadf and develop a diagrammatic scheme for further discussion of linear scaling methods .",
    "section  [ sec : link ] presents a progression of algorithms that lead to the final cadf - link method , and section  [ sec : impl ] discusses implementation details .",
    "section  [ sec : results ] gives the results of some benchmark computations , and section  [ sec : conc ] contains some concluding remarks .",
    "the idea behind what we call cadf has been around since the early days of df:@xcite expand a product density @xmath20 using only auxiliary functions centered on the same atom as the composite functions @xmath2 and @xmath3 .",
    "the fitting equations can thus be written @xmath21 where @xmath22 , @xmath23 , ",
    "are indices of atom centers , @xmath24 indicates that the function @xmath2 is centered on atom @xmath22 , and @xmath25 indicates that the function @xmath17 is centered on either atom @xmath22 or atom @xmath23 . in this context , the use of the simple expansion of the integral tensor @xmath26 yields errors in @xmath27that are too large to be useful for hf theory computations .",
    "however , in 2000 dunlap@xcite noted that this expansion is linear in the density error ( unless the full , non - local coulomb metric is used ) , and a more robust expansion correct to second order in the density error can be constructed . in the context of cadf , this robust expansion can be written @xmath28 the use of this robust expansion yields reasonable errors for hf theory  on the order of 2 - 5 times the errors arising from conventional density fitting , in most cases.@xcite however , eq",
    ".   breaks the positive semidefiniteness of the @xmath27tensor,@xcite which can cause convergence issues in rare cases .",
    "merlot , et al .",
    "and our group both suggested different approaches@xcite to correcting this issue . while we consider the convergence issues with cadf to be eminently solvable , to throughly test the cadf approximation we need to be able to apply cadf - based hartree - fock and density functional theory methods to large molecules .",
    "thus , in this paper the focus is on developing a practical @xmath13cadf - based exchange matrix algorithm , and hence the issues of positivity are set aside herein .      due to the rapid decay of the overlap between the gaussian basis function functions @xmath2 and @xmath3 , only @xmath13products @xmath20 result in significant eris .",
    "thus , the four - center eri tensor @xmath27contains 2 significant entries .",
    "hser and ahlrichs@xcite noted that the cauchy ",
    "schwarz inequality holds for the eri tensor , and thus this exponential decay could be exploited for prescreening using the inequality @xmath29 using the nomenclature of neese and coworkers,@xcite we say that @xmath2 forms an `` s - junction '' with @xmath3 if and only if @xmath30 is greater than some pairing threshold @xmath31 .      to illustrate the screening of significant contributions to the exchange matrix",
    ", we introduce a simple graphical method for showing contributing factors to the sparsity of a given tensor or tensor contraction expression .",
    "tensor indices are shown as vertices of a diagram .",
    "each of these indices has a range of @xmath13 , hence a diagram with @xmath32 vertices denotes to @xmath33 total contributions to a tensor or a tensor contraction .",
    "an edge connecting two vertices denotes that only @xmath13  _ pairs _ of these indices are significant for any finite precision in the limit of infinite system size .",
    "in other words , for each first index value there is a @xmath34 list of significant second index values .",
    "for example , the eri tensor screened using eq .   can be represented as    @xmath35 ( mu ) @xmath2 ; ( la ) [ right = of mu ] @xmath4 ; ( nu ) [ right = of la ] @xmath3 ; ( si ) [ right = of nu ] @xmath5 ; ( mu ) ",
    "node[above , font= ] s ( la ) ; ( nu ) ",
    "node[above , font= ] s ( si ) ; [ d : g ]    from this diagram , it is immediately apparent that the screening in eq .",
    "requires 2 integrals to be computed for @xmath27 , since there are a constant number of @xmath4 for each @xmath2 and a constant number of @xmath5 for each @xmath3 , but no connection between @xmath2 and @xmath3 .",
    "therefore , the diagram must be fully connected for a tensor or contraction to have @xmath13  significant contributions .",
    "@xmath13  exchange construction algorithms take advantage of the aforementioned rapid decay of the density matrix.@xcite diagrammatically , the conventional exchange matrix expression @xmath36 can be represented as    @xmath37 ( mu ) @xmath2 ; ( la ) [ right = of mu ] @xmath4 ; ( si ) [ right = of la ] @xmath5 ; ( nu ) [ right = of si ] @xmath3 ; ( mu ) ",
    "node[above , font= ] s ( la ) ; ( nu ) ",
    "node[above , font= ] s ( si ) ; ( la ) ",
    "node[above , font= ] p ( si ) ; [ eq : kdiag ]    where the connection between @xmath4 and @xmath5 is called a `` p - junction '' in the nomenclature of neese , et al.@xcite diagram is fully connected , which suggests the existence of a linear scaling algorithm .",
    "note also that the path length between two indices in the result suggests ( in a qualitative sense ) some aspects of the performance of the associated linear scaling algorithm .",
    "since there are a bounded number of @xmath4 for a given @xmath2we will use the notation @xmath38as well as a bounded number of @xmath5 given @xmath4 and a bounded number of @xmath3 given @xmath5 , the prefactor of the linear scaling algorithm will be bounded from above by the product @xmath39 , because one could , at worst , use the direct product of these index sets to construct the tensor . in practice , the scaling will be much better than this ( since , e.g. , the product of medium - sized contributions to each connection may still be quite small ) , though there may not necessarily be a reasonable algorithm to access this scaling .",
    "nevertheless , the diagrammatic approach presents a concise picture of the nature of the factors that necessarily contribute to the performance of any linear scaling algorithm for the construction of @xmath0 .",
    "it is clear from the form of the gaussian product rule ( gpr ) that @xmath38 and @xmath40 will depend on the number of basis functions per atom and the diffuseness of those functions . from physical reasoning",
    ", we note that @xmath41 will further depend on the band gap of the system and the degree of delocalization of electrons in the system . given these properties of s and p junctions ,",
    "we conclude that a linear scaling algorithm associated with this diagram would probably perform poorly for large basis sets or systems with small band gaps .",
    "while this is not a particularly profound insight ( both of these are well - known issues with virtually all linear scaling methods ) , it suggests by contrast what a method that improves on these limitations might look like : such a method would have to provide an alternative path between @xmath2 and @xmath3 that does not rely on the square of the s junction constant ( for large basis sets ) or the p - junction constant ( for smaller band - gap systems ) .",
    "our task herein is to identify useful additional pathways between @xmath2 and @xmath3 .",
    "cadf introduces another kind of junction between indices , that of concentricity . using the diagrammatic approach ,",
    "we can write the coefficient tensor as a union of two diagrams :    @xmath42[font= ] ( lpic )    ( mu ) @xmath24 ; ( la ) [ right = of mu ] @xmath43 ; ( x ) [ below = of mu ] @xmath44 ; ( mu )  node[above , font= ] ( s ) s ( la ) ; ( x ) ",
    "node[left , font= ] ca ( mu ) ;    ; ( un ) [ font= , right = of lpic ] @xmath45 ; ( rpic ) [ right = of un ]    ( mu ) @xmath24 ; ( la ) [ right = of mu ] @xmath43 ; ( x ) [ below = of la ] @xmath46 ; ( mu )  node[above , font= ] ( s ) s ( la ) ; ( x ) ",
    "node[left , font= ] ca ( la ) ;    ; ( eq ) [ font= , right = of rpic ] @xmath47 ; ( epic ) [ right = of eq ]    ( mu ) @xmath24 ; ( la ) [ right = of mu ] @xmath43 ; ( mid ) at ( @xmath48 ) ; ( x ) [ below = of mid.south west ] @xmath49 ; ( mu ) ",
    "node[above , font= ] ( s ) s ( la ) ; ( x ) ",
    "node[left , font= ] ca ( mid.south west ) ;    ;    where `` ca '' is short for `` concentric atomic , '' indicating that the connected indices are centered on the same atom , and the squiggled lines are used to introduce a shorthand for the left - hand side of the equals sign . by plugging the robust cadf approximation to eri , eq .  , into eq .   and relabeling some indices , we can write @xmath0as @xmath50    \\sum_{{\\ensuremath{\\sigma}\\xspace}_dx_{(cd)}}\\sum_{{\\ensuremath{\\lambda}\\xspace}_b}\\left[{\\ensuremath{\\left ( \\mu_a{\\ensuremath{\\lambda}\\xspace}_b \\middle| x_{(cd ) } \\right ) } }       \\vphantom {   - \\tfrac12 \\sum_{y_{(ab)}}c_{\\mu_a{\\ensuremath{\\lambda}\\xspace}_b}^{y_{(ab)}}{\\ensuremath{\\left ( y_{(ab ) } \\middle| x_{(cd ) }",
    "\\right ) } }    } \\right .    \\\\",
    ".    - \\tfrac12 \\sum_{y_{(ab)}}c_{\\mu_a{\\ensuremath{\\lambda}\\xspace}_b}^{y_{(ab)}}{\\ensuremath{\\left ( y_{(ab ) } \\middle| x_{(cd ) } \\right)}}\\right]d^{{\\ensuremath{\\lambda}\\xspace}_b{\\ensuremath{\\sigma}\\xspace}_d } c_{\\nu_c{\\ensuremath{\\sigma}\\xspace}_d}^{x_{(cd)}}. \\end{multlined}\\end{aligned}\\ ] ] diagrammatically , this can be written    @xmath51[font= ] ( lpic )    ( nu ) @xmath52 ; ( si ) [ left = of nu ] @xmath53 ; ( mid3 ) at ( @xmath54 ) ; ( x ) [ below = of mid3.south ] @xmath55 ; ( la ) [ left = of si ] @xmath43 ; ( mu ) [ left = of la ] @xmath24 ; ( mu ) ",
    "node[above , font= ] ( s ) s ( la ) ; ( si ) ",
    "node[above , font= ] ( p ) p ( la ) ; ( si )  node[above , font= ] ( s ) s ( nu ) ; ( x ) ",
    "node[left , font= ] ca ( mid3.south ) ;    ; ( minus ) [ font=,right = of lpic ] @xmath56 ; ( rpic ) [ right = of minus ]    ( nu ) @xmath52 ; ( si ) [ left = of nu ] @xmath53 ; ( mid ) at ( @xmath54 ) ; ( x ) [ below = of mid.south west ] @xmath55 ; ( la ) [ left = of si ] @xmath43 ; ( mu ) [ left = of la ] @xmath24 ; ( mid2 ) at ( @xmath48 ) ; ( y ) [ below = of mid2.south west ] @xmath25 ; ( mu ) ",
    "node[above , font= ] ( s ) s ( la ) ; ( si ) ",
    "node[above , font= ] ( p ) p ( la ) ; ( si ) ",
    "node[above , font= ] ( s ) s ( nu ) ; ( y ) ",
    "node[left , font= ] ca ( mid2.south west ) ; ( x )  node[left , font= ] ca ( mid.south west ) ;    ;    both terms in the diagram are connected , hence a linear - scaling algorithm can be designed .",
    "however , it is possible to significantly reduce the computational cost of the first term by screening the three - center two - electron integrals .",
    "three - center eris can be screened more efficiently than the standard four - center eris because the potential created by a solid - harmonic gaussian @xmath58 of angular momentum @xmath59 decays as @xmath60 , rather than the @xmath11 decay of a general product @xmath61 .",
    "the decay of the coulomb operator does not matter as much for the four - center eri - based exchange construction because the density decays so rapidly . in the cadf - based approach ,",
    "efficient screening of the three - center eris is important and can not be achieved using only the schwartz bound .",
    "recently we developed a tight estimator , called sqv@xmath57 , for three - center coulomb integrals that takes into account the correct asymptotic decay of the potential : @xmath62        r >",
    "\\operatorname{ext}_{\\kappa\\eta } + \\operatorname{ext}_{\\theta }   \\\\ \\text{and } s_{\\kappa\\eta}/q_{\\kappa\\eta } > { \\ensuremath{\\vartheta_{\\mathrm{sq}}}\\xspace}\\end{multlined }       \\\\",
    "\\frac{\\pi\\sqrt2\\,\\beta_{\\ell_\\theta}\\!(\\zeta_\\theta)\\,q_{\\kappa\\eta}}{(\\zeta_\\kappa+\\zeta_\\eta)^{\\frac14}r^{\\ell_\\theta+1 } }      & \\begin{multlined}[c ]        r > \\operatorname{ext}_{\\kappa\\eta }",
    "+ \\operatorname{ext}_{\\theta } \\\\ \\text{and } s_{\\kappa\\eta}/q_{\\kappa\\eta } \\leq { \\ensuremath{\\vartheta_{\\mathrm{sq}}}\\xspace}\\end{multlined }       \\\\      \\ q_{\\kappa\\eta}q_\\theta &   r \\leq \\operatorname{ext}_{\\kappa\\eta } + \\operatorname{ext}_{\\theta } ,    \\end{dcases }    \\label{eq : sqvl}\\end{aligned}\\ ] ] where @xmath63 @xmath64 , @xmath65 , and @xmath66 are the exponents of the various primitives , @xmath67 is the overlap , @xmath68 are cfmm extents , and @xmath69 and @xmath70 are user - defined thresholds ( see ref .   for details , including generalization to contracted basis functions ) . practically speaking",
    ", the ratio of prefactors from the first two cases is folded into the @xmath71 ratio , and the second case is used if this ratio is less than one .",
    "effectively , the far field estimator uses the minimum of the first two cases when the @xmath71 ratio is greater than @xmath72 , and only the second case when the ratio is less than @xmath72 .",
    "this latter detail will be important for the use of this estimator in section  [ sec : link ] .",
    "the sqv@xmath57 estimator allows us to add a crucial edge to the cadf exchange screening diagram :    @xmath73 ( nu ) @xmath52 ; ( si ) [ left = of nu ] @xmath53 ; ( mid ) at ( @xmath54 ) ; ( x ) [ below = of mid.south ] @xmath55 ; ( la ) [ left = of si ] @xmath43 ; ( mu ) [ left = of la ] @xmath24 ; ( mid2 ) at ( @xmath48 ) ; ( mu ) ",
    "node[above , font= ] ( s ) s ( la ) ; ( si ) ",
    "node[above , font= ] ( p ) p ( la ) ; ( si ) ",
    "node[above , font= ] ( s ) s ( nu ) ; ( x ) ",
    "node[left , font= ] ca ( mid.south ) ; ( x ) .. controls ( x-|la ) and ( x-|mid2.south ) .. node [ below , near start , font= ] @xmath74 ( mid2.south ) ; [ d : sqvl ]    note that the efficiency of the sqv@xmath57 screening will increase for kets with higher angular momenta ; hence , the more expensive the three - center eri , the more likely it will be screened out .",
    "like four - center eri - based linear scaling exchange algorithms,@xcite our linear scaling exchange algorithm based on concentric atomic density fitting ( which we will call cadf - link ) relies on the construction of prescreening lists , @xmath75 and @xmath76 , to drive the exchange matrix build . both sets of lists are computed with linear effort .",
    "@xmath75 specifies the list of @xmath4 for a given @xmath77 pair for which @xmath78 must be computed .",
    "it is defined as follows : @xmath79 where @xmath80 ,      \\label{eq : cexpand }    \\end{multlined } \\\\",
    "{ { \\ensuremath{\\tilde r_{\\mu{\\ensuremath{\\lambda}\\xspace}}^{x}}\\xspace}}&\\equiv { \\ensuremath{\\left ( x \\middle| x \\right)}}^{-1/2 } i_{\\mathrm{{sqv\\ensuremath{\\ell}\\xspace}}}(\\mu,{\\ensuremath{\\lambda}\\xspace},x ) \\end{aligned}\\ ] ] and @xmath81 is the sqv@xmath57screening factor from eq .  .",
    "( keep in mind that though the tensor - like notation @xmath82is used for compactness , this quantity is intended to be computed on the fly , so a notation like @xmath83 would be conceptually more appropriate . )",
    "we have loosely used the notation @xmath84 to represent the block frobenius norm of a matrix or tensor expression . in these expressions and the following , the orbital basis set ( obs ) and density fitting basis set ( dfbs ) are distinguished by their respective abbreviations , and the notation @xmath85 , for instance , represents the set of all basis functions from the obs centered on atom @xmath86 . the density fitting coefficients @xmath87 can be obtained in linear effort after a schwarz - based prescreening of obs pairs , as discussed in the original cadf paper.@xcite    we immediately note that ( theoretically , at least ) the @xmath88 ( `` d - bar '' ) intermediate can be constructed in linear scaling time , since    @xmath89 ( nu ) @xmath52 ; ( si ) [ left = of nu ] @xmath53 ; ( mid ) at ( @xmath54 ) ; ( x ) [ below = of mid.south ] @xmath55 ; ( la ) [ left = of si ] @xmath43 ; ( si ) ",
    "node[above , font= ] ( p ) p ( la ) ; ( si ) ",
    "node[above , font= ] ( s ) s ( nu ) ; ( x ) ",
    "node[left , font= ] ca ( mid.south ) ;    is a fully connected diagram .",
    "indeed , the construction of @xmath88 is quite straightforward if the density matrix @xmath6is stored in a sparse data structure .",
    "the construction of @xmath90 can also be performed in linear scaling effort , since the norm in the second term of eq .",
    "need only loop over the @xmath91 that have significant overlap with @xmath53 . with this in mind , a procedure for the linear scaling construction of @xmath92 is given in algorithm  [ alg : l3 ] .",
    "similar to the original linkalgorithm,@xcite the key to linear scaling in algorithm  [ alg : l3 ] is the list ordering that allows the program to exit the loops early in lines  [ al : exit1 ] and [ al : exit2 ] .",
    "the auxiliary list set @xmath93 is composed of @xmath16 for which @xmath94 is significant ; each list is then sorted by decreasing @xmath94 value .",
    "the other helper list set , @xmath95 , is simply the @xmath2 that form schwarz pairs with @xmath4 , sorted by decreasing value of @xmath96 .",
    "@xmath97 @xmath98 with @xmath99 sort @xmath93 by decreasing @xmath100 compute distance factor @xmath82 add @xmath4 to @xmath75 * break * out of @xmath2 loop [ al : exit1 ] * break * out of @xmath16 loop [ al : exit2 ]      using only the 3 lists , a quadratic scaling @xmath0build algorithm can be devised .",
    "such a procedure is outlined in algorithm  [ alg : krepl ] .",
    "note that the subscripted indices ( e.g. , @xmath24 ) are descriptive rather than prescriptive : the subscript @xmath22 merely indicates that the center on which the function @xmath2 is located has the index @xmath22 ; it does not indicate anything specific about the iteration range of @xmath24 .",
    "the algorithm loops over the significant @xmath101 integrals and immediately contracts these contributions into the @xmath102intermediate .",
    "the quadratic scaling of this algorithm arises because the loop in line  [ al : bloop ] is not restricted ; the restriction of this loop requires @xmath103 , discussed in section [ sec : lstb ] .",
    "form 3x for significant @xmath104 compute @xmath105 @xmath106 @xmath107 @xmath108",
    "[ al : bloop ] [ al : kbegin ] @xmath109[al : kpart1 ] @xmath110[al : kpart2 ]",
    "[ al : kend ] @xmath111    several important aspects of this quadratic scaling algorithm merit further discussion before the introduction of the linear scaling version .",
    "first , note that the summation of @xmath112 into @xmath113 ( lines [ al : kbegin][al : kend ] of algorithm  [ alg : krepl ] ) is split into two loops with one index restricted in each loop .",
    "this restriction is made possible by the cadf coefficient definition , which precludes coefficients with dfbs functions that do not share a center with the obs pair being fit .",
    "this loop structure also makes it possible to store the coefficients in an ordering more efficient for vectorization : @xmath114 is stored as @xmath115 \\rightarrow { \\ensuremath{\\sigma}\\xspace}_d$ ] ( from slowest- to fastest - running index ) , which is still a @xmath116 data structure .",
    "secondly , note that the algorithm is integral direct , and that the algorithm s storage requirements never exceed 2 .",
    "the intermediate @xmath112 requires linear storage in this algorithm , and the integrals @xmath78 need not be stored outside of the inner loop in which they are computed .      in order to further improve the scaling of algorithm [ alg : krepl ] to linear , another set of prescreening lists , @xmath103 , must be formed . for a given @xmath2 and @xmath16 ,",
    "the list @xmath76 from the set b is defined as @xmath117 where @xmath118 as with @xmath119 , the formation of @xmath120 in linear effort is relatively trivial if @xmath121 is stored in a sparse data structure , and particularly if @xmath75 is sorted by decreasing @xmath82 .",
    "an algorithm for the linear scaling formation of b is outlined in algorithm  [ alg : lb ] .",
    "the procedure is greatly simplified by the fact that a list of significant @xmath77 pairs is already known from the construction of 3 .",
    "the algorithm is little more than a sparse - sparse matrix multiply .",
    "if @xmath90 is stored in a sparse data structure , line  [ al : lc ] is already part of the manifestation of @xmath90 in memory .",
    "similarly , the conditional in line  [ al : lbif ] is essentially the procedure that a sparse - sparse matrix multiply undergoes to determine the nontrivial entries in the product matrix .",
    "nonetheless , we have included the b build algorithm here for completeness .",
    "@xmath122 with @xmath123",
    "[ al : lc ] [ al : lbif ] add @xmath5 to @xmath76      the use of b to create a @xmath0build procedure that scales linearly requires only a few modifications to algorithm  [ alg : krepl ] .",
    "the revised procedure is given in algorithm  [ alg : kb ] .",
    "the main changes involve restricting the loops in lines [ al : blr ] and [ al : klr ] .",
    "the restriction in line [ al : blr ] amounts to excluding from @xmath102any @xmath124 where the contraction over the full set of significant @xmath43 for a given @xmath125 is negligible .",
    "these indices can then also be excluded from the summation in line [ al : klr ] , since the @xmath126 are trivial for these @xmath53 .",
    "further optimization could be made by restricting the loop in line [ al : blr ] to include only @xmath53 for a given @xmath43 where @xmath127 is significant .",
    "this optimization would arise naturally if a sparse data structure were used for @xmath6 , but in the present implementation dense 2 data structures were used ( see section [ sec : impl ] ) .",
    "form 3x for significant @xmath104 form bx for significant @xmath104 [ al:3lr ] compute @xmath105",
    "[ al : intc ] @xmath106 @xmath107",
    "[ al : blr ] @xmath108 [ al : bcon ] [ al : klr ] @xmath109 [ al : kcon1 ] [ al : k2out ] [ al : schwloop ] @xmath110 [ al : kcon2 ] @xmath111",
    "the algorithms detailed in section  [ sec : link ] were implemented in a development version ( commit tag 3.0.0-cadflink of the localdf branch ) of the massively parallel quantum chemistry ( mpqc)@xcite quantum chemistry package .",
    "while the algorithms were implemented predominantly as written here , several small details differ from the ideal linear scaling implementation .",
    "most prominently , since integrals are computed more efficiently in shell blocks , all of the indices in the algorithms actually represent shell blocks rather than individual basis functions . in other words , for instance , @xmath128 where @xmath129 is a function index and @xmath16 is a shell index .",
    "the upshot of this is that the prescreening algorithms and list formations are significantly less expensive than the main computation in practice , even though in principle the onset of linear scaling is later for these portions of the computation .",
    "( the prescreening is more expensive in principle because the exit conditions of the loops in algorithm  [ alg : l3 ] use the schwarz estimate of the integrals rather than the distance - including estimate , since the latter can not be easily ordered ) .",
    "the quantities used in the screening process are replaced by their shell block frobenius norm analogs .",
    "indeed , if a scenario were to arise in which the screening portions of the algorithm began to dominate the cost , the concept of shell blocks could be generalized further to arbitrary blocks and a multi - tiered prescreening approach could be used .",
    "another difference in our implementation is that dense data structures were used to store all 2 quantities .",
    "the primary reason for this is that the scf solver in mpqc is currently based on an 3 eigensolve ; alternative @xmath13  scf solvers are well known ( e.g. ,  density matrix minimization@xcite ) but are not yet implemented in our program .",
    "it is difficult to measure the practical scaling of an algorithm outside of the context of its implementation details and execution environment .",
    "thus , many authors@xcite opt to present their algorithmic scaling in terms of integral counts , contraction sizes , or other implementation- and execution - independent metrics . here",
    "we use several such metrics corresponding to particular sections of algorithm [ alg : kb ] .",
    "our implementation of cadf - link has been heavily optimized to run well on massively parallel computers and to take advantage of both thread and process parallelism .",
    "however , a thorough discussion of the challenges involved in the parallelization of cadf - link has been reserved for a separate paper in the interest of both saving space and appealing to a more general audience .",
    "for our cost metrics , we chose a series of one dimensional molecules ( linear alkanes ) and a series of three dimensional systems ( water clusters ) .",
    "cartesian coordinates are included in the supplemental information .",
    "we used the basis set pairs def2-svp@xcite",
    "/ def2-svp / jk,@xcite cc - pvtz@xcite / cc - pvtz / jk,@xcite and cc - pvqz / cc - pvqz / jk . for these series of molecules and basis sets , we recorded the number of three - center integrals computed ( line [ al : intc ] ) , the number of multiplies in the contraction to form @xmath112 ( line [ al : bcon ] ) , and the number of multiplies in the contractions to form @xmath130 ( lines [ al : kcon1 ] and [ al : kcon2 ] ) .",
    "these data were averaged over the first three scf iterations ; later iterations were omitted to minimize variability due to convergence acceleration procedures .    for the computations in the remainder of this work ,",
    "an scf convergence criterion of @xmath131 was used .",
    "our method has no difficulty converging further than this , but since the emphasis is on per iteration performance , we chose a relatively loose convergence threshold .",
    "an initial screening threshold @xmath132 of @xmath131 was used throughout as well .",
    "however , this number was varied for differential density iterations as follows : the screening threshold for a given iteration was taken to be the initial threshold if the full density was used or the ratio of differential density to full density frobenius norm times the initial threshold if a differential density was used , down to a minimum threshold of @xmath133 . for the sqv@xmath57estimate ,",
    "@xmath134 was used for both @xmath69 and @xmath70.@xcite this use of a scaled screening threshold allowed us to use a quite aggressive initial threshold without sacrificing as much accuracy in the final result .",
    "this amounts to a simplified version of a previous variable precision scf approach@xcite that yields excellent results for large molecules .",
    "indeed , we were usually able to converge scf computations to a root mean squared density change of @xmath135 or less using an initial threshold of @xmath131 .",
    "this thresholding scheme also spreads the workload across iterations in a fairly uniform manor : in almost all cases , no iteration costs more than a factor of 2 different from any other iteration ( without threshold scaling , factors of 5 - 10 were often observed ) .",
    "the top plot uses a linear range , and the bottom plot shows the same data on a logarithmic range ( subtracting 1 to show proximity to linear scaling ) .",
    ", scaledwidth=50.0% ]    to analyze the asymptotic scaling of a positive computational cost metric @xmath136 with the system size parameter @xmath137 it is convenient to introduce of an effective scaling exponent : @xmath138 this amounts roughly to a `` two - point fit '' to the form @xmath139 , for constants @xmath22 and @xmath23 , at the points @xmath140 and @xmath141 . by definition , the effective exponent of the cost of a @xmath13algorithm should approach 1.0 in the limit of large @xmath137 .",
    "figure  [ fig : scaling ] shows the effective scaling exponents for the key cost metrics of our algorithm when applied to our one- and three - dimensional series of molecules .",
    "it is clear that all scaling exponents are less than 2 for @xmath142 , and decrease monotonically with @xmath137 .",
    "also , the @xmath0contraction step has the worst scaling ( highest effective exponent ) .",
    "this is anticipated due to the relatively weak restriction of the loop in line  [ al : schwloop ] of algorithm  [ alg : kb ] , which only utilizes schwarz screening . however , since the non - link behavior of the @xmath143 contraction is better than other parts of the algorithm ( 3 with no screening compared to 4 for the @xmath112 contraction without screening ) , the @xmath0contraction still costs less in terms of cpu time than the @xmath102contraction , even for our largest computations . nevertheless , the scaling with respect to the @xmath0contraction metric is good , reaching @xmath144 around 2500 basis functions for linear alkanes with a small basis and @xmath145 around 4000 and 10000 basis functions for a triple zeta and quadruple zeta basis , respectively . even for three dimensional systems ,",
    "the scaling of the @xmath0contraction is still around @xmath146 by about 4000 and 15000 basis functions for the def2-svp / def2-svp / jk and cc - pvtz / cc - pvtz / jk basis sets , respectively .",
    "the scaling behavior of the more expensive sections , the integral computation and @xmath102contraction , is even better .",
    "the scaling reaches @xmath144 around 1300 , 3500 , and 8700 basis functions , respectively , for linear alkanes with the three basis set pairs in our study . for our three dimensional systems ,",
    "the scaling of the @xmath102contraction is about @xmath146 by around 2400 and 5800 basis functions for def2-svp / def2-svp / jk and cc - pvtz / cc - pvtz / jk , respectively .    while the scaling exponent functions are less smooth for water clusters compared to linear alkanes due to the less systematic growth of the former , the overall trends in the data are similar for both one- and three - dimensional systems . obviously , the decay of the scaling exponents is much more rapid for one dimensional systems and for smaller , less diffuse basis sets . in the worst case  three dimensional water clusters with the cc - pvtz / cc - pvtz / jk basis set ",
    "the scaling of the most computationally intense sections of the algorithm is around @xmath147 for a system with 756 atoms . given that in the context of hf and hybrid ks dft the typical basis sets are smaller and less diffuse than cc - pvtz , it completely reasonable to conclude that cadf - link will closely approach linear scaling behavior in the vast majority of use cases .",
    "figure  [ fig : errors ] shows the errors in absolute energies resulting from the cadf - link approximation , relative to cadf - scf with schwarz screening only ( the coulomb matrix was computed in the same manner in both sets of computations ) . as with the cadf approximation and hartree ",
    "fock theory itself , the absolute energy errors arising from the cadf - link approximation scale linearly with the size of the system",
    ". however , these errors are still about one or two orders of magnitude smaller that the errors arising from the cadf approximation for molecules of comparable size ( see ref .  ) , which are in turn smaller than the basis set errors or the errors of the hartree ",
    "fock method itself .",
    "importantly , as demonstrated by the bottom plot in figure  [ fig : errors ] , the absolute error per electron does not increase significantly beyond a point for the molecules we tested .    the larger error per electron for three dimensional structures compared to one dimensional ones",
    "can be heuristically rationalized as follows .",
    "as two basis functions are separated from each other , their pair - wise contribution ( roughly speaking ) to the energy is excluded at some distance .",
    "a three dimensional structure will have more basis functions at or near this distance than a one dimensional structure .",
    "furthermore , in the specific case of water clusters compared to linear alkanes , the latter have a significantly larger number of covalent bonds , meaning that a much smaller portion of the contributions to the energy are likely to have separations near this critical exclusion length .    another notable feature of figure  [ fig : errors ] is the error behavior when the distance factor ( from the sqv@xmath57estimator ) is omitted . as the original sqv@xmath57paper noted,@xcite the estimator performs worse for the def2-@xmath16vp / def2-@xmath16vp / jk basis sets than the cc - pv@xmath16z / cc - pv@xmath16z / jk basis sets , because the former contains more contracted basis functions , particularly in the fitting basis , than the latter . since the sqv@xmath57estimator is tightest for uncontracted integrals , the error arising from its use with contracted basis functions",
    "is expected to be larger than with basis sets containing fewer contracted functions .",
    "the data in figure  [ fig : errors ] show this , but they also show that the increase in error from the use of the sqv@xmath57estimator is relatively small : in the def2-svp / def2-svp / jk case with linear alkanes , the sqv@xmath57estimator causes roughly a factor of two increase in the cadf - link error , and for water clusters the increase is even less .",
    "figure  [ fig : speedup ] shows the speedups for the three cost metrics we examined relative to a cadf - based exchange build with schwarz screening only  that is , the ratios of each cost metric for cadf exchange with schwarz screening only to the cost metric for cadf - link for a given system size .",
    "the most substantial speedups  as much as 250 times  are seen in the @xmath102contraction , which is expected given that both the inner and outer loops are restricted by cadf - link ( by the b@xmath148 and 3@xmath148 lists , lines  [ al : blr ] and [ al:3lr ] respectively in algorithm  [ alg : kb ] ) , whereas the 3 center integrals and the @xmath0contraction are only restricted by one list each .",
    "indeed , the only significant additional restriction of the contraction in line  [ al : kcon2 ] relative to schwarz screening comes from the outermost loop over @xmath104 pairs ( since the stronger concentricity restriction of the loop in line  [ al : k2out ] is imposed even without the formation of bx ) .",
    "consequently , the least substantial speedups are seen in the @xmath0contraction , though again this section is the least computationally intense of the three even for the largest computations we performed .",
    "these data clearly show that the small increase in error ( see section  [ sec : err ] ) is , in most contexts , more than compensated for by a massive decrease in computational effort .",
    "another noteworthy trend in the data from figure  [ fig : speedup ] is that for the first two cost metrics ( 3 center integrals and the @xmath102contraction ) , larger speedups were seen for three dimensional systems , while for the @xmath0contraction , larger speedups were seen for linear alkanes .",
    "this is attributed to the more prominent role of the distance factor in the 3x definition compared to the bx definition . for 3x ,",
    "the distance factor @xmath149 contributes directly to the thresholding for the inclusion of @xmath4 , whereas for bx , the distance factors for all @xmath4 connected by a p - junction to a given @xmath5 contribute to the thresholding for the inclusion of @xmath5 .",
    "heuristically , the 3 center integrals cost metric is most influenced by the efficiency of 3x , and the @xmath0contribution is most influenced by the efficiency of bx ( the @xmath102cost metric is influenced by both ) . since we have already noted in section  [ sec : err ] that the three - dimensional structures are more susceptible to the effects of the distance - including estimator , it makes sense that more substantial gains would be seen with water clusters for the 3 center integrals and the @xmath102contraction and with linear alkanes for the @xmath0contraction .",
    "the more interesting trend in figure  [ fig : speedup ] is the contribution to the speedup from the distance - dependent integral screening . for large water clusters with the def2-svp / def2-svp / jk basis pair , nearly tenfold speedups",
    "are observed compared to cadf - link without the sqv@xmath57estimator .",
    "this is remarkable , given that in the context of four - center eri - based link the use of distance - dependent screening results in speedups of about 2.0.@xcite this further demonstrates that there is more to be gained from screening three - center eris than from screening their four - center counterparts .",
    "we have presented a linear scaling algorithm for computing the exchange matrix using the concentric atomic density fitting approximation .",
    "our algorithm has been shown to perform well for basis sets of all sizes , and we have carried out some of the largest triple- and quadruple - zeta basis computations ever to demonstrate this point .",
    "errors in absolute energies from the cadf - link approximation are substantially smaller than other sources of error and have been shown to grow linearly with basis set size . even for large basis sets ,",
    "our method shows near linear scaling for systems of less than 1000 atoms , and for smaller basis sets the onset of linear scaling is even more rapid .",
    "not only does our algorithm serve as a highly efficient way to compute the exchange matrix in the context of hartree - fock and dft methods , but also it offers a blueprint for the use of the concentric atomic density fitting in many - body methods .",
    "the research by dsh and efv was supported by nsf grants che-0847295 , che-1362655 , and aci-1047696 , and a camille dreyfus teacher - scholar award .",
    "the research by dsh and hfs was supported by nsf grant che-1361178 .",
    "this work used resources of the national energy research scientific computing center , which is supported by the office of science of the u. s. department of energy under contract no . de - ac02 - 05ch11231 .",
    "49ifxundefined [ 1 ] ifx#1 ifnum [ 1 ] # 1firstoftwo secondoftwo ifx [ 1 ] # 1firstoftwo secondoftwo `` `` # 1''''@noop [ 0]secondoftwosanitize@url [ 0 ]",
    " + 12$12  & 12#1212_12%12@startlink[1]@endlink[0]@bib@innerbibempty @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) `` , ''  ( ,  ,  )  p.   @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) in @noop _ _ ,  vol .",
    "( )  pp .   @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( ) @noop * * ,   ( )"
  ],
  "abstract_text": [
    "<S> a linear - scaling algorithm is presented for computing the hartree  fock ( hf ) exchange matrix using concentric atomic density fitting . </S>",
    "<S> the algorithm utilizes the stronger distance dependence of the three - center electron repulsion integrals along with the rapid decay of the density matrix to accelerate the construction of the exchange matrix . </S>",
    "<S> the new algorithm is tested with computations on systems with up to 1536 atoms and 15585 basis functions , the latter of which represents , to our knowledge , the largest quadruple - zeta hf computation ever performed . </S>",
    "<S> our method handles screening of high angular momentum contributions in a particularly efficient manner , allowing the use of larger basis sets for large molecules without a prohibitive increase in cost . </S>"
  ]
}