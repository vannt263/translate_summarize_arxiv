{
  "article_text": [
    "while the concordance cold dark matter cosmological model ( @xmath1cdm ; krauss & turner 1995 ; ostriker & steinhardt 1995 ; bahcall 1999 ; spergel 2006 ) has been shown to be remarkably successful in many respects , there remain several apparent discrepancies between the model and the real universe .",
    "for example , the centers of simulated x - ray clusters of galaxies do not agree with observations , manifested in their inability to match even the simplest relations such as the temperature - luminosity relation ( e.g. , ponman , cannon , & navarro 1999 ) , among others .",
    "closely related to this problem is the so - called  cooling flow \" problem in the cores of many clusters , where the cooling time is less than the hubble time ( e.g. , fabian 1994 ; white , jones , & forman 1997 ; peres 1998 ; allen 2000 ) and , hence , in the absence of heating sources , the gas will cool and flow towards the center . this is confirmed by simple hydrostatic models ( fabian & nulsen 1977 ; cowie & binney 1977 ) and simulations ( suginohara & ostriker 1998 ; yoshida 2002 ) , with conventional physics , i.e. , gravity and cooling .",
    "what is most puzzling is that , observationally , this supposedly cooling x - ray gas shows up neither in soft x - rays nor in other cooler forms in the expected amounts ( e.g. , peterson et al .",
    "2003 ; kaastra et al .",
    "solutions such as supernova heating appear incapable of rectifying the problem ( binney 2000 ) .    based on a polytropic model taking into account both a removal of low entropy gas due to star formation and an addition of feedback energy , ostriker ( 2005 )",
    "show that if the feedback energy is of the order of a few percent of the rest mass of supermassive black holes , a consistent x - ray cluster model can be constructed .",
    "supermassive black holes ( smbh ) are now strongly believed to lurk at the centers of probably every massive galaxy ( magorrian 1998 ; ferrarese & merritt 2000 ; gebhardt 2000 ; tremaine 2002 ) .",
    "one of the most prominent known forms of feedback from the growth of smbh that is mechanically tightly coupled to surrounding gas is the powerful radio jets and giant radio lobes , whose energy is often observed to exceed @xmath2ergs ( urry 2000 ; kronberg et al .",
    "therefore , there is a good reason to believe that the inclusion of active galactic nuclei ( agn ) feedback , in form of radio jets / lobes , in direct simulations may bring theoretical predictions into good agreement with observations . in this case",
    ", our understanding of x - ray cluster formation will be much more complete and physically sound , which in turn would allow us to remove systematic uncertainties with regard to determinations of dark matter and dark energy , among others , afforded by accumulating x - ray data and upcoming sunyaev - zeldovich ( sz ) cluster data .",
    "clearly , it has become very pressing to properly model agn feedback in cosmological simulations .    in this era of precision cosmology ,",
    "multiple , independent constraints on cosmological parameters are vital .",
    "weak gravitational lensing of galaxies by large - scale structure provides one of the most powerful probes of matter distribution in the universe ( e.g. , refregier 2003 ) . since weak lensing",
    "directly probes the mass distribution , which is dominated by dark matter , it is often assumed that baryonic physics is not that important . with powerful future weak lensing surveys such as panstarrs ,",
    "snap and lsst , which have the potential capability of reducing statistical errors to about @xmath3 level with regard to power spectrum and dark energy equation - of - state determinations , it will be necessary to understand hitherto  less important \" effects such as the physics of cosmic baryons .",
    "baryons constitute a significant fraction ( @xmath4 ) of total mass in the universe ( spergel 2006 ) and could make a significant contribution to the total matter power spectrum . on sub - megaparsec scales ,",
    "baryons are known to be subject to different physics than the dark matter , and important differences between distributions of baryons and dark matter on small scales ( @xmath5kpc ) are well observed , such as in our own galaxy .",
    "it is , however , often assumed that baryons follow dark matter on large scales ( @xmath6mpc ) , where signals of weak gravitational lensing by large - scale structure are detected to in turn determine the total matter distribution on these large scales .",
    "estimates based on observed radio - lobe energy from agn suggest that a large volume fraction of the intergalactic medium may be moved and filled with magnetic bubbles ( furlanetto & loeb 2001 ; kronberg et al .",
    "2001 ; levine & gnedin 2005 ) . as a result",
    ", the effect of large - scale movement of baryonic gas under the influence of giant radio lobes / jets from agn on the total matter power spectrum might be as large as @xmath7 based on a simplified spherical model ( levine & gnedin 2006 ) . while the exact effect on the intergalactic medium of giant radio jet / lobes from agn is presently highly uncertain due to lack of any adequate treatment , these initial rough estimates of potential effects point to the need of much more detailed investigations .",
    "it is prudent to re - examine with greater care the assumption that baryons follow dark matter on large scales in light of the potential capabilities of future weak lensing surveys .",
    "cosmological parameters determined with claimed achievable high statistical accuracy based on gravitational weak lensing can be realized only after systematic effects on baryons due to powerful agn feedback can be convincingly demonstrated and removed .",
    "magnetohydrodynamics simulations provide the necessary tools to tackle this important problem .",
    "the idea of agn feedback is not new ( e.g. , silk & rees 1998 ; kronberg 2001 ; churazov 2001 ; quilis , bower , & balogh 2001 ; bruggen & kaiser 2001 ; binney 2004 ; omma & binney 2004 ; ruszkowski , bruggen & begelman 2004 ; henrik 2004 ; scannapieco & oh 2004 ; begelman 2004 ; dalla vecchia 2004 ; begelman & ruszkowski 2005 ; bruggen , ruszkowski , & hallman 2005 ; croton 2006 ) .",
    "recent sph ( smoothed - particle - hydrodynamics ) simulations have taken a major step to implement such an agn feedback ( hopkins 2005a , b , c , d,2006 ; robertson 2006 ; sajacki & springel 2006 ) through a deposition of thermal energy in the central regions of galaxies where massive gas accretion onto the central smbh takes place .",
    "the effects are clearly demonstrated to be significant , often with dramatic effects , such as a complete sweep - out of interstellar medium .",
    "but real mhd modeling is largely lacking .",
    "undoubtedly radio jets are highly anisotropic and the overall dynamics and thermodynamics of magnetic jets / bubbles and baryons on scales ranging from cluster cores to large - scale structure requires solving the propagation of relativistic jets using cosmological mhd codes in a complex , dynamic , cosmological setting . as an example , a highly collimated relativistic radio jet may not deposit most of its energy in the immediate neighborhood , whereas a thermal and spherical deposition of the energy , as has been implemented in sph simulation , would cause an interaction with the immediate surrounding gas at the outset .",
    "it has been well established that there are widespread magnetic fields in the intracluster medium ( see carilli & taylor 2002 ; govoni 2006 for recent reviews ) .",
    "there has also been tantalizing evidence for magnetic fields in the wider intergalactic medium ( igm ) ( kim et al .",
    "the origin of these large - scale magnetic fields is still unknown though several suggestions have been made ( e.g. , kulsrud et al .",
    "1997 ; furlanetto & loeb 2001 ; kronberg et al . 2001 ) .",
    "furthermore , it is presently mostly unknown whether these magnetic fields have played an important role or not , in systems ranging from large - scale structure formation , to galaxy clusters , to cluster core regions and to galaxy formation itself .",
    "there have been some studies aimed at investigating the role of magnetic fields in the intracluster ( icm ) and igm ( ryu et al .",
    "1998 ; dolag et al .",
    "2002 ; dolag et al . 2005 ; brggen et al .",
    "numerically , substantial efforts have gone into developing mhd solvers with sph ( dolag et al . 1999 , 2002 ) , though the divergence - free condition for magnetic fields is still difficult to handle ( ziegler et al .",
    "2006 ) . for a grid - based eulerian approach , studies by ryu et al .",
    "( 1998 ) and brggen et al .",
    "( 2005 ) have included the magnetic fields passively , i.e. , they have omitted the feedback of magnetic fields to the medium ( both in the momentum equation and energy equation ) .",
    "consequently , we are not aware of any eulerian - based cosmological simulations where magnetic fields are included self - consistently .    in this paper",
    ", we present a highly accurate cosmological mhd code , named cosmomhd , for cosmological simulations that involve magnetic fields .",
    "the outline of our paper is as follows .",
    "we first present an overview of the cosmomhd code and various physics packages included in cosmomhd in ",
    "[ sec : eqn ] .",
    "we then describe the basic solvers for ideal mhd adopted in our code in  [ sec : solver ] .",
    "numerical tests are presented in  [",
    "sec : tests ] .",
    "further discussions are given in ",
    "[ sec : conclu ] .",
    "the framework of our cosmomhd code is based on the combination of the tvd - es cosmological hydrodynamics ( hd ) code ( ryu 1993 ) and an mhd code on an adaptive mesh refinement ( amr - mhd ) grid ( li & li 2003 ) .",
    "we have integrated the cosmological solvers for dark matter , atomic physics and star formation feedback processes in the tvd - es code with the mhd solvers in amr - mhd code for gas dynamics ( amr features are _ not _ utilized in cosmomhd ) .",
    "the hydro tvd - es code has been extensively used for cosmological applications , including lyman - alpha forest ( cen 1994 ) , warm - hot intergalactic medium ( cen & ostriker 1999a ) , damped lyman - alpha systems ( cen 2003 ) , cosmological chemical evolution ( cen & ostriker 1999b ; cen , nagamine , & ostriker 2005 ) and galaxy formation ( nagamine 2000,2001a , b,2004,2005a , b,2006 ) .",
    "the mhd code has been extensively used for astrophysical jet simulations ( e.g. , li et al .",
    "2006 , nakamura , li , & li 2006 ) .",
    "consistent with the notations in ryu et al .",
    "( 1993 ) , the basic equations for cosmomhd in comoving coordinates are @xmath8 & = &   - \\frac{2\\dot a}{a } e   - \\frac{1}{a } \\rho { \\bf v } \\cdot",
    "\\nabla \\phi + \\frac{\\dot a}{a } \\frac{b^2}{2 } , \\\\",
    "\\frac{\\partial { \\bf b}}{\\partial t } - \\frac{1}{a}\\nabla\\times(\\mbox{\\bf v}\\times { \\bf b } ) & = & - \\frac{\\dot a}{2a } { \\bf b } \\label{cmhd_eq4}\\end{aligned}\\ ] ] where we have implicitly assumed @xmath9 . here , @xmath10 is the comoving density , @xmath11 is the proper peculiar velocity , @xmath12 is the comoving gas pressure , @xmath13 is the comoving magnetic pressure , @xmath14 is the total comoving pressure , @xmath15 is the total peculiar energy per unit comoving volume , @xmath16 is the proper peculiar gravitational potential from both dark matter and self - gravity , @xmath17 is the cosmic time , and @xmath18 is the expansion parameter .",
    "note that , from the induction equation above [ eq .",
    "( [ cmhd_eq4 ] ) ] , the magnetic field in the comoving frame expands as @xmath19 . since @xmath20 , the magnetic field in the proper frame expands as @xmath21 , consistent with the flux conservation .",
    "in addition to the total energy equation , we have implemented solvers for two auxiliary equations : the modified entropy equation given in ryu et al .",
    "( 1993 ) and the internal energy equation in bryan et al .",
    "this implementation allows us to perform better comparisons among different approaches in tracking the thermal energy accurately .",
    "the equations are : @xmath22 where @xmath23 is the comoving modified entropy , and @xmath24 is the internal energy .",
    "note that eqs .",
    "( [ mentropy ] ) and ( [ eq_ein_den ] ) remain the same even when the magnetic fields are present .",
    "the cosmomhd code integrates five sets of equations simultaneously : the ideal mhd equations for gas dynamics and magnetic field dynamics [ equations ( [ cmhd_eq1 ] ) to ( [ eq_ein_den ] ) ] , rate equations for multiple species of different ionizational states ( including hydrogen , helium and oxygen ) , the vlasov equation for dynamics of collisionless particles , the poisson s equation for obtaining the gravitational potential field and the equation governing the evolution of the intergalactic ionizing radiation field , all in cosmological comoving coordinates .",
    "the mhd code consists of several approaches for solving the mhd ( or hd ) by high - resolution schemes with finite - volume and finite - difference methods .",
    "the code preserves conservative quantities and the divergence - free condition of the magnetic fields .",
    "the code is fully parallelized with openmp directives .",
    "the mhd solver can also be used as an hydro solver when the magnetic fields are zero .",
    "we will describe the mhd solvers in more details in  [ sec : solver ] .",
    "the rate equations are treated using sub - cycles within a hydrodynamic timestep due to much shorter ionization timescales .",
    "dark matter particles are advanced in time using the standard particle - mesh ( pm ) scheme .",
    "the gravitational potential on a uniform mesh is solved using the fast fourier transform ( fft ) method .",
    "the simulation computes for each cell and each timestep the detailed cooling and heating processes due to all the principal line and continuum processes for a plasma of primordial composition ( cen 1992 ) .",
    "metals ejected from star formation are followed in detail in a time - dependent , non - equilibrium fashion .",
    "cooling due to metals is computed using a code based on the raymond - smith code assuming ionization equilibrium ( cen 1995 ) : at each timestep , given the ionizing background radiation field , we compute a lookup table for metal cooling in the temperature - density plane for a gas with solar metallicity , then the metal cooling rate for each gas cell is computed using the appropriate entry in that plane multiplied by its metallicity ( in solar units ) .",
    "in addition , compton cooling due to the microwave background radiation field and compton cooling / heating due to the x - ray and high energy background are also included .",
    "we follow star formation using a well defined ( heuristic but plausible ) prescription used by us in our earlier work ( cen & ostriker 1992,1993 ) and similar to that of other investigators ( katz , hernquist , & weinberg 1992 ; katz , weinberg , & hernquist 1996 ; steinmetz 1996 ; gnedin & ostriker 1997 ) . a stellar particle of mass @xmath25",
    "is created ( the same amount is removed from the gas mass in the cell ) , if the gas in a cell at any time meets the following three conditions simultaneously : ( i ) flow contracting , ( ii ) cooling time less than dynamic time , and ( iii ) jeans unstable , where @xmath26 is the timestep , @xmath27yrs ) , @xmath28 is the dynamical time of the cell , @xmath29 is the baryonic gas mass in the cell and @xmath30 is star formation efficiency .",
    "in essence , we follow the classic work of eggen , lynden - bell & sandage ( 1962 ) and assume that the dynamical free - fall and galaxy formation timescales are simply related .",
    "each stellar particle has a number of other attributes at birth , including formation time @xmath31 , initial gas metallicity and the free - fall time in the birth cell @xmath28 .",
    "the typical mass of a stellar particle in the simulation is about one million solar masses ; in other words , these stellar particles are like globular clusters .",
    "stellar particles are subsequently treated dynamically as collisionless particles . but feedback from star formation is allowed in three forms : ionizing uv photons , supernova kinetic energy in the form of galactic superwinds ( gsw ) , and metal - enriched gas , all being proportional to the local star formation rate . the temporal release of all three feedback components at time @xmath17 has the same form : @xmath32\\exp[-(t - t_i)/t_{dyn}]$ ] . within a timestep @xmath33 ,",
    "the released gsw energy to the igm , ejected mass from stars into the igm and escape uv radiation energy are @xmath34 , @xmath35 and @xmath36 .",
    "we use the bruzual - charlot population synthesis code ( bruzual & charlot 1993 ; bruzual 2000 ) to compute the intrinsic metallicity - dependent uv spectra from stars with salpeter imf ( with a lower and upper mass cutoff of @xmath37 and @xmath38 ) .",
    "note that @xmath39 is no longer just a simple coefficient but a function of metallicity .",
    "the bruzual - charlot code gives @xmath40 at @xmath41 .",
    "we also implement a gas metallicity - dependent ionizing photon escape fraction from galaxies in the sense that higher metallicity hence higher dust content galaxies are assumed to allow a lower escape fraction ; we adopt the escape fractions of @xmath42 and @xmath43 ( hurwitz 1997 ; deharveng 2001 ; heckman 2001 ) for solar and one tenth of solar metallicity , respectively , and interpolate / extrapolate using a linear log form of metallicity .",
    "in addition , we include the emission from quasars using the spectral form observationally derived by sazonov , ostriker , & sunyaev ( 2004 ) , with a radiative efficiency in terms of stellar mass of @xmath44 for @xmath45ev .",
    "finally , hot , shocked regions ( like clusters of galaxies ) which emit ionizing photons due to bremsstrahlung radiation are also included . the uv component is simply averaged over the box , since the light propagation time across our box is small compared to the timesteps . the radiation field ( from @xmath46ev to @xmath47kev )",
    "is followed in detail with allowance for self - consistently produced radiation sources and sinks in the simulation box and for cosmological effects , i.e. , radiation transfer for the mean field @xmath48 is computed with stellar , quasar and bremsstrahlung sources and sinks due to clouds etc .",
    "in addition , a local optical depth approximation is adopted to crudely mimic the local shielding effects : each cubic cell is flagged with six hydrogen  optical depths \" on the six faces , each equal to the product of neutral hydrogen density , hydrogen ionization cross section and scale height , and the appropriate mean from the six values is then calculated ; equivalent ones for neutral helium and singly - ionized helium are also computed . in computing the global sink terms for the radiation field , the contribution of each cell is subject to the shielding due to its own  optical depth \" .",
    "in addition , in computing the local ionization and cooling / heating balance for each cell , we take into account the same shielding to attenuate the external ionizing radiation field .",
    "galactic superwinds energy and ejected metals are distributed into 27 local gas cells centered at the stellar particle in question , weighted by the specific volume of each cell .",
    "we fix @xmath49 .",
    "gsw energy injected into the igm is included with an adjustable efficiency ( in terms of rest - mass energy of total formed stars ) of @xmath50 , which is normalized to observations for our fiducial simulation with @xmath51 .",
    "if the ejected mass and associated energy propagate into a vacuum , the resulting velocity of the ejecta would be @xmath52km / s .",
    "after the ejecta has accumulated an amount of mass comparable to its initial mass , the velocity may slow down to a few hundred km / s .",
    "we assume this velocity would roughly correspond to the observed outflow velocities of lyman break galaxies ( lbgs ) ( e.g. , pettini 2002 ) .",
    "we have also implemented a prescription to insert the initial mhd radio jets associated with the smbh formation , which in turn is based on the assumption that smbh formation is directly related to merger events .",
    "details will be presented elsewhere .",
    "without expansion factor and external sources , the equations ( [ cmhd_eq1 ] ) to ( [ cmhd_eq4 ] ) can be written in the conservative form as ( in cartesian coordinates ) : @xmath53 where @xmath54 and the flux functions are @xmath55 all variables carry their usual meaning , @xmath56 is the total pressure , @xmath57 are the electromotive force ( emf , defined via @xmath58 ) .",
    "we also assume the ideal gas law for equation of state , and hence the total energy is @xmath59    from the flux functions , we can obtain the jacobian matrices @xmath60    since @xmath61 and @xmath62 can be related to @xmath63 through proper index permutation , @xmath64 and @xmath65 should have similar structure as @xmath66 . the eigenvalues and eigenvectors for @xmath66",
    "have been extensively studied by many authors ( see brio & wu 1988 , ryu & jones 1995 , etc . ) . here",
    "we will write out the eigenvalues without explanation . in a direct extension of the 1d system with magnetic field component @xmath67 and total magnetic field @xmath68 ,",
    "the eigenvalues for @xmath69 are @xmath70 where @xmath71 is the alfvn speed based on @xmath67 , and @xmath72^\\frac12,\\ ] ] @xmath73^\\frac12,\\ ] ] are the speeds of fast and slow magneto - sonic waves respectively , and @xmath74 is the acoustic wave speed .    in an alternative formulation ,",
    "powell et al . ( 1999 ) have used an @xmath75 eigen - system .",
    "its corresponding eigenvalues are @xmath76 the corresponding eigenvectors have been given previously by many authors .",
    "we have adopted the eigenvector set given by powell et al .",
    "( 1999 ) in our code .    for the dimensional split approach",
    ", the cfl condition along each direction can be calculated with ( assume the same timestep is used ) @xmath77,\\ ] ] where the minimum is over all the cells . for the unsplit approach",
    ", the cfl condition is given as @xmath78,\\ ] ] where again , the minimum is over all the cells .      in recent years a variety of numerical algorithms for mhd based on the godunov method",
    "have been developed .",
    "early development of higher order godunov schemes for mhd focused on interpreting the mhd equations as a simple system of conservation laws .",
    "this was done by brio and wu ( 1988 ) , zachary , malagoli and colella ( 1994 ) , powell ( 1994 ) , dai and woodward ( 1994 ) , ryu and jones ( 1995 ) , roe and balsara ( 1996 ) , etc .",
    "there are two important extensions to the basic hd algorithm for use of mhd .",
    "the first is an extension of the riemann solver used to compute the fluxes of each conserved quantity to mhd ; the second is to preserve the divergence - free constraints @xmath79 numerically .",
    "a typical second - order godunov scheme for hyperbolic conservation law consists of three steps :    1 .",
    "predict the time - centered cell - interface values , @xmath80 and @xmath81 .",
    "2 .   using these left and right states at each cell - interface , solve the riemann problem to determine the time - centered fluxes , @xmath82 , possibly modified by the additional artificial viscosity .",
    "3 .   compute the cell - centered conservative variable at the next time step using a conservative update with the time - centered fluxes .",
    "the first step is a predictor step via data reconstruction and time evolution .",
    "the second step is a riemann solver .",
    "we included several data reconstruction approaches in our code .",
    "we used piecewise linear reconstruction along with several slope limiters , including a general _ minmod _ , @xmath83 where @xmath84 is a limited slope for cell @xmath85 $ ] , and @xmath86 $ ] . note that a larger @xmath87 corresponds to less dissipation , but still non - oscillatory limiters . for @xmath88 , it becomes a woodward limiter .",
    "these minmod - type limiters are not smooth functions with respect to @xmath89 .",
    "another limiter we used is van albada - type , which is a smooth function of @xmath89 , @xmath90 where @xmath91 is a tiny positive constant in case of @xmath92 and @xmath93 .",
    "this limiter is smooth and it preserves the monotonicity of the original profile of @xmath89 .    for robustness , we have also implemented the characteristic limiting data reconstruction , which applies the limited slope on wave - by - wave decomposition space obtained from local solutions of riemann problems . in addition",
    ", we have also implemented the piecewise parabolic ( colella & woodward 1984 ) and central weno ( levy et al .",
    "2000 ; 2002 ) reconstruction schemes . for robustness",
    ", the data reconstruction is applied to the primitive variables rather than the conservative variables .",
    "we have implemented several approaches as the predictor for the time - centered quantities .",
    "the simplest approach is the hancock predictor , @xmath94 where @xmath95 is the limited slope that is obtained from the data reconstruction .",
    "then we use @xmath96 and @xmath95 to construct the left and right interface values at time @xmath97 . in @xmath98 direction , we have @xmath99 since the hancock prediction does not need the characteristic decomposition , it can be done fast .",
    "note that the limited slopes are reconstructed only once during the whole process .",
    "we do not need to calculate the limited slope for intermediate state @xmath100 .",
    "we have also implemented the piecewise - linear method ( plm ) via upwinding characteristic tracing ( colella and glaz , 1985 ) .",
    "we implemented three different riemann solvers , including roe ( powell et al .",
    "1999 ) , hll / hlle [ see harten , lax , & van leer ( 1983 ) ; einfeldt ( 1988 ) ; einfeldt et al .",
    "( 1991 ) ] , and hllc ( li 2005 ) . to improve the robustness",
    ", we also combined the hlle and roe s riemann solves together in our code as proposed by janhunen ( 2000 ) .",
    "in cosmological simulations , hypersonic flows with a large mach number ( e.g. , @xmath102 ) appear to be very common , and they present a problem in our numerical schemes so far because the thermal energy is very small compared to the kinetic energy . the pressure , which is proportional to the thermal energy and used extensively in the numerical schemes , can not be tracked accurately , because the discretization errors made in computing the total energy and the kinetic energy can be large enough to result in negative pressure .",
    "a similar problem arises in modeling the mhd flow with a low plasma beta ( @xmath103 ) .",
    "dynamically , this is not a large problem because the negative pressure can be replaced with a nominal floor value and the total energy budget of the flow remains unaffected .",
    "however , if the temperature distribution is considered for other reasons , ( e.g. , radiative processes ) , the thermal energy must be tracked accurately .    as suggested by ryu et al .",
    "( 1993 ) and bryan et al .",
    "( 1995 ) , we present dual energy formulations to track the thermal energy accurately . for comparison ,",
    "we implement two approaches .",
    "the first is to solve the modified entropy eq .",
    "( [ mentropy ] ) , which is in conservative form and easy to implement for solvers that require eigen - decomposition .",
    "the other is to solve the internal energy density equation in eq .",
    "( [ eq_ein_den ] ) .    a similar set of riemann solvers described in  ( [ sec : riem ] )",
    "are also implemented when solving the dual energy formulation .",
    "since the internal energy equation is not in conservative form , we calculated only the flux @xmath104 in eq .",
    "( [ eq_ein_den ] ) with the riemann solver .",
    "the roe s solver requires eigen - decomposition for a conservative system and can not be applied to eq .",
    "( [ eq_ein_den ] ) directly . for the modified entropy equation ( [ mentropy ] )",
    ", we adopt the eigen - decomposition from balsara and spicer ( 1999b ) in our roe s solver .",
    "the hll and hllc solvers can be applied to flux @xmath104 as well as to eq .",
    "( [ mentropy ] ) in a straightforward manner .",
    "the @xmath105 in eq .",
    "( [ eq_ein_den ] ) can be discretized as @xmath106 where the time - centered values of @xmath107 and @xmath108 are obtained from the riemann solver .",
    "it is necessary to use the total energy equation as much as possible for proper conversion of kinetic to thermal energy .",
    "when the total energy equation fails to give the positive pressure , we switch to solve the modified entropy or internal energy equation .",
    "this is done by monitoring the values of the internal energy @xmath24 that comes from the total energy equation . when the ratio between the internal energy @xmath24 and the total energy @xmath109 satisfies @xmath110 , eq .",
    "( [ mentropy ] ) or eq .",
    "( [ eq_ein_den ] ) is solved and the total energy is updated with the new internal energy .",
    "we remark that as long as the parameter @xmath111 is small enough , the dual formulation will have no dynamical effect . after testing a large number of problems ,",
    "we have chosen @xmath112 .",
    "in ryu et al .",
    "( 1993 ) , @xmath113 combined with a shock detection is used . in bryan",
    "( 1995 ) , @xmath114 combined with a shock detection is used . in our code , we tested @xmath112 with and without shock detection .",
    "although both eqs .",
    "( [ mentropy ] ) and ( [ eq_ein_den ] ) will not give a correct solution for the shock , we have not found any problem fails using @xmath115 only without shock detection . on the other hand , if @xmath116 is used with a shock detection scheme , the internal energy of the cell near the shock usually is set to a nominal floor value , which is incorrect .",
    "maintaining the divergence - free condition @xmath117 is important in mhd simulations .",
    "brackbill and barnes ( 1980 ) find that the non - zero divergence , caused by discretization errors , can grow exponentially during the computation and destroy the correctness of the solutions .",
    "hence they proposed a divergence - cleaning approach , which solves an extra global elliptic ( poisson ) equation to recover @xmath79 at each time - step .",
    "balsara & kim ( 2004 ) find that the divergence - cleaning is significantly inadequate when used for many astrophysical applications .",
    "the constrained transport ( ct ) approach uses a staggered grid , which places the magnetic field variables at the cell - face to keep @xmath118 to the accuracy of machine round - off error .",
    "recently , this approach has been combined with various modern shock - capturing algorithms by many authors ( see toth 2000 and its references ) .",
    "toth ( 2000 ) proposed a constrained transport / central - difference ( ct / cd ) method that uses cell - centered values of the magnetic fields .",
    "this method works well with single grid but it is unknown currently how to apply it to adaptive grids . in the current stage of cosmomhd",
    ", we deal with only a single grid .",
    "therefore , we adopted the flux - ct method of toth ( 2000 ) to preserve the divergence - free condition .",
    "we first tested the code with an mhd shock tube problem on a two - dimensional ( 2d ) cartesian grid .",
    "the shock tube is usually posed as a 1d problem , and it is a standard test for a numerical scheme to handle the discontinuities , e.g. , shock and contact . solving it on a 2d grid can verify if a multi - dimensional scheme works properly and recovers the 1d solution profile .",
    "we chose an example that has been used by toth ( 2000 ) to compare several numerical schemes for mhd .",
    "we adopted the same initial and boundary conditions as toth ( 2000 ) .",
    "the initial left and right states are @xmath119 where @xmath120 refers to the direction along the normal of the shock front , @xmath121 refers to the direction perpendicular to the normal of the shock front but still in the computational plane , and @xmath122 refers to the direction out of the plane .",
    "note that @xmath123 and @xmath124 components are non - zero .",
    "therefore , it is often called the 2.5d mhd shock tube problem .",
    "we first solve this problem using a 1d grid and then solve it as a 2d problem with a rotation angle @xmath125 between the shock interface and @xmath126-axes .",
    "the same boundary conditions as toth ( 2000 ) and 256 cells in each direction are used .",
    "the computation is stopped at @xmath127 before the fast shocks reach the left and right boundaries .",
    "the numerical solution is compared with a reference solution that is calculated with a 1d grid and 1600 cells .    for this example , only the total energy equation is solved .",
    "the modified entropy equation and internal energy equation are not used .",
    "[ fig1 ] shows the results at the final time .",
    "the parallel component of the magnetic field is preserved very well by our ct scheme , which can preserve the divergence - free condition ( @xmath79 ) to machine round - off error .",
    "plots of density , magnetic components in parallel and vertical direction along the normal of the shock front , and pressure of the 2.5d shock - tube problem .",
    "the reference solution is calculated with 1d grid and 1600 grid cells .",
    "the 1d and 2d results are calculated with 256 and 256@xmath128256 cells respectively .",
    "output is at @xmath17=0.1 for the reference solution and 1d result , and at @xmath127 for 2d results with shock angle of @xmath129 .",
    "the parallel component of the magnetic fields ( @xmath130 ) is conserved with an accuracy of machine round - off errors.,title=\"fig:\",scaledwidth=45.0% ] plots of density , magnetic components in parallel and vertical direction along the normal of the shock front , and pressure of the 2.5d shock - tube problem .",
    "the reference solution is calculated with 1d grid and 1600 grid cells .",
    "the 1d and 2d results are calculated with 256 and 256@xmath128256 cells respectively .",
    "output is at @xmath17=0.1 for the reference solution and 1d result , and at @xmath127 for 2d results with shock angle of @xmath129 .",
    "the parallel component of the magnetic fields ( @xmath130 ) is conserved with an accuracy of machine round - off errors.,title=\"fig:\",scaledwidth=45.0% ] plots of density , magnetic components in parallel and vertical direction along the normal of the shock front , and pressure of the 2.5d shock - tube problem .",
    "the reference solution is calculated with 1d grid and 1600 grid cells .",
    "the 1d and 2d results are calculated with 256 and 256@xmath128256 cells respectively .",
    "output is at @xmath17=0.1 for the reference solution and 1d result , and at @xmath127 for 2d results with shock angle of @xmath129 .",
    "the parallel component of the magnetic fields ( @xmath130 ) is conserved with an accuracy of machine round - off errors.,title=\"fig:\",scaledwidth=45.0% ] plots of density , magnetic components in parallel and vertical direction along the normal of the shock front , and pressure of the 2.5d shock - tube problem .",
    "the reference solution is calculated with 1d grid and 1600 grid cells .",
    "the 1d and 2d results are calculated with 256 and 256@xmath128256 cells respectively .",
    "output is at @xmath17=0.1 for the reference solution and 1d result , and at @xmath127 for 2d results with shock angle of @xmath129 .",
    "the parallel component of the magnetic fields ( @xmath130 ) is conserved with an accuracy of machine round - off errors.,title=\"fig:\",scaledwidth=45.0% ]      this example is taken from ryu et al .",
    "it was proposed as a test for hydro cosmology code to handle the thermal energy correctly .",
    "the formation of 1d caustics has been calculated from the initial sinusoidal velocity field along the x - direction with the peak value @xmath131 .",
    "the initial density and pressure has been set to be uniform with @xmath132 and @xmath133 .",
    "hence the initial peak velocity corresponds to a mach number of 1.2@xmath128@xmath134 . in the simulations , the pressure can easily become negative for this type of high mach flow .",
    "we test this problem with and without magnetic fields . if the magnetic fields are present , we set @xmath135 , and only @xmath136 is nonzero .",
    "different values of @xmath136 are tested .",
    "[ fig2 ] shows the results at @xmath137 with 1024 cells . for this problem ,",
    "the total energy version of the code will give a wrong pressure floor value , which is not shown here .",
    "the results shown in fig . [ fig2 ] are calculated using the combination of the total energy version with a modified entropy equation .",
    "it is clear that the strong magnetic fields ( @xmath138=0.05 ) can suppress the density peak , while relatively weak magnetic fields ( @xmath138=1e-3 ) have little impact on the density and pressure profile .",
    "plots of density , gas pressure , total pressure , and magnetic component ( @xmath136 ) of 1d mhd caustics test at @xmath137 .",
    "the modified entropy equation is solved.,title=\"fig:\",scaledwidth=45.0% ] plots of density , gas pressure , total pressure , and magnetic component ( @xmath136 ) of 1d mhd caustics test at @xmath137 .",
    "the modified entropy equation is solved.,title=\"fig:\",scaledwidth=45.0% ] plots of density , gas pressure , total pressure , and magnetic component ( @xmath136 ) of 1d mhd caustics test at @xmath137 .",
    "the modified entropy equation is solved.,title=\"fig:\",scaledwidth=45.0% ] plots of density , gas pressure , total pressure , and magnetic component ( @xmath136 ) of 1d mhd caustics test at @xmath137 .",
    "the modified entropy equation is solved.,title=\"fig:\",scaledwidth=45.0% ]    we also solve the internal energy equation to follow the adiabatic changes correctly in the pre - shock region .",
    "figure [ fig3 ] shows the comparison between the modified entropy version and the internal energy version for @xmath139 case .",
    "the results are almost identical .",
    "figure [ fig3 ] also shows the comparison with different riemann solvers .",
    "apparently the hll solver is very diffusive in the post - shock region so that it can not recover the gas pressure correctly in the middle region .",
    "this example is also taken from ryu et al .",
    "we set up the problem as a 1d pancake ( i.e. , the zeldovich pancake problem ) in a purely baryonic universe with @xmath140 and @xmath141 in the comoving coordinates .",
    "the mhd solver with self - gravity module is tested .",
    "initially , at @xmath142 , which corresponds to @xmath143 in this test , a sinusoidal velocity field with the peak value @xmath144 in the normalized units has been imposed in a box with the comoving size @xmath145mpc .",
    "the baryonic density and pressure have been set to be uniform with @xmath146 in the normalized units .",
    "the calculation has been done with a different number of cells , with and without magnetic fields .",
    "when the magnetic fields are present , we use only the @xmath136 component , and set @xmath135 .",
    "figure [ fig4 ] shows the results with @xmath147 , i.e. , without the magnetic fields .",
    "the results for both the modified entropy version and internal energy version are shown .",
    "for comparison , we also show the results of tvd - es code ( ryu et al .",
    "( 1993 ) ) , running with the mass - diffusive correction .     one - dimensional gravitational collapse of a pancake in the comoving coordinates with different codes .",
    "the number of cells is 1024 .",
    "no magnetic fields are applied ( @xmath148).,title=\"fig:\",scaledwidth=80.0% ]   one - dimensional gravitational collapse of a pancake in the comoving coordinates with different codes .",
    "the number of cells is 1024 .",
    "no magnetic fields are applied ( @xmath148).,title=\"fig:\",scaledwidth=80.0% ]   one - dimensional gravitational collapse of a pancake in the comoving coordinates with different codes .",
    "the number of cells is 1024 .",
    "no magnetic fields are applied ( @xmath148).,title=\"fig:\",scaledwidth=80.0% ]    figure [ fig5 ] shows the results with magnetic fields .",
    "different magnetic fields have different impact on the shock location and the peaks of density and magnetic fields . with a small @xmath149 ,",
    "the magnetic fields have little impact on the shock and the density profile .",
    "the magnetic fields collapse in the same way as the density field does . as we increase the magnitude of the magnetic fields , the density peak in the post - shock region and shock location",
    "show large changes , while the profile in the pre - shock region has little change .",
    "one - dimensional gravitational collapse of a pancake in the comoving coordinates with different magnitude of magnetic fields .",
    "the number of cells is 1024 .",
    ", title=\"fig:\",scaledwidth=45.0% ]   one - dimensional gravitational collapse of a pancake in the comoving coordinates with different magnitude of magnetic fields .",
    "the number of cells is 1024 .",
    ", title=\"fig:\",scaledwidth=45.0% ]   one - dimensional gravitational collapse of a pancake in the comoving coordinates with different magnitude of magnetic fields .",
    "the number of cells is 1024 .",
    ", title=\"fig:\",scaledwidth=45.0% ]   one - dimensional gravitational collapse of a pancake in the comoving coordinates with different magnitude of magnetic fields .",
    "the number of cells is 1024 .",
    ", title=\"fig:\",scaledwidth=45.0% ]    figure [ fig6 ] shows the comparison for different riemann solvers applied to the modified entropy equation .",
    "the results for hllc and the more sophisticated roe s solver are almost identical , while the result for hll solver is not so good at the post - shock region .",
    "one - dimensional gravitational collapse of a pancake in the comoving coordinates with different riemann solvers .",
    "the number of cells is 1024 .",
    "@xmath150.,title=\"fig:\",scaledwidth=45.0% ]   one - dimensional gravitational collapse of a pancake in the comoving coordinates with different riemann solvers .",
    "the number of cells is 1024 .",
    "@xmath150.,title=\"fig:\",scaledwidth=45.0% ]      we have carried out a comparison of our cosmological mhd code with the original tvd - es code of ryu et al .",
    "we computed the adiabatic evolution of a purely baryonic universe but with an initial cdm power spectrum with the following parameters : @xmath151 , @xmath152 and @xmath153 , and the size of the computational cube is @xmath154 .",
    "we use the bardeen ( 1986 ) transfer function to calculate the power spectrum of the initial density fluctuations .",
    "this test problem is identical to that of kang ( 1994 ) except that the random numbers used to generate the initial condition are different .",
    "the universe is evolved from @xmath155 to @xmath156 .",
    "we use @xmath157 cells for each simulation performed .",
    "the comparisons are made at the final epoch , @xmath156 .",
    "figure [ fig7 ] shows a comparison of a mass - weighted histogram of the baryonic temperature at @xmath156 without magnetic fields between the original tvd - es code and cosmomhd .",
    "the mass - weighted histogram is calculated by using the temperature as @xmath98-axis and total mass in each temperature bin as the @xmath126-axis .",
    "they are in a good agreeement .",
    "we have also performed another run with initial magnetic fields , @xmath135 , @xmath136=2.5e-9 gauss ( which corresponds to 4.3176e-7 in code unit ) .",
    "figure [ fig8 ] shows a slice of the density and magnetic energy at @xmath156 .",
    "we see that the distributions of density and magnetic field are strongly correlated , as expected . to demonstrate the impact of the ct method , we set the initial @xmath136=1e-5 gauss , which corresponds to 0.0017 in code unit . figure [ fig9 ] shows the comparison of the divergence of the magnetic fields , averaged over the entire box , as a function of redshift .",
    "it is clear that without the ct method , the divergence of the magnetic fields grows in tandem with the growth of the magnetic field strength , and simulation results would hardly be meaningful . since single - precision is used in our whole simulation , the divergence from the ct method is close to the round - off error .",
    "the temperature plots are shown in fig .",
    "[ fig10 ] .",
    "the plasma beta becomes very small ( @xmath158 ) in many regions with these large magnetic fields .",
    "the dual - formulation must be used to track the internal energy accurately .",
    "mass - weighted temperature histogram at present ( redshift z=0 ) for the 3d simulations of a purely baryonic adiabatic universe.,scaledwidth=80.0% ]     the scaled divergence ( @xmath159 ) of the magnetic fields with and without constraint transport ( ct ) for the three - dimensional simulations of a purely baryonic adiabatic universe during the whole time history .",
    "the initial @xmath136 at @xmath160 is 0.0017 .",
    ", scaledwidth=80.0% ]",
    "we have developed and tested a modern cosmological mhd code ( cosmomhd ) . in the cosmomhd code , five sets of equations are evolved simultaneously : ( 1 ) the ideal mhd equations for magneto - gasdynamics , ( 2 ) rate equations for multiple species of different ionizational states ( including hydrogen , helium and oxygen ) , ( 3 ) the vlasov equation for dynamics of collisionless particles ( including dark matter particles and stellar particles ) , ( 4 ) the poisson s equation for obtaining the gravitational potential field and ( 5 ) the equation governing the evolution of the intergalactic ionizing radiation field , all in cosmological comoving coordinates .",
    "the mhd solver consists of several high - resolution schemes with finite - volume and finite - difference methods .",
    "the divergence - free condition of the magnetic field is preserved to an accuracy due just to round - off errors .",
    "additional implemented physical processes include : ( 1 ) detailed cooling and heating processes due to all the principal line and continuum processes for a plasma of primordial composition as well as cooling and heating due to metals , ( 2 ) star formation processes and feedback processes from star formation including uv radiation and galactic superwinds , and ( 3 ) formation of supermassive black holes and associated feedback processes including radio jets / lobes .",
    "the cosmomhd code developed here may be applied to a variety of astrophysical / cosmological problems with or without self - gravity .",
    "we intend to study the formation and evolution of galaxies , clusters of galaxies and the intergalactic medium using this accurate code .",
    "most importantly , we would like to investigate the role played by the agn feedback in the form of powerful radio jets / lobes in regulating structure formation on scales from the cores of clusters of galaxies ( @xmath161kpc ) through giant lobes ( @xmath162kpc@xmath163mpc ) to large scales ( @xmath164mpc ) .",
    "it seems prudent to check if many fundamental cosmological applications , such as weak gravitational lensing , formation and evolution of x - ray / sz clusters and matter power spectrum with baryonic oscillation features , may be affected by this feedback effect .",
    "a thorough understanding of agn feedback may be necessary to reduce systematic errors to levels that are commensurate with statistical errors that many of these important observations are expected to be able to achieve .",
    "we thank eric johnson for coding a prescription to form initial realistic mhd radio jets associated with smbh formation .",
    "this work was carried out under the auspices of the national nuclear security administration of the u.s .",
    "department of energy at los alamos national laboratory under contract no .",
    "de - ac52 - 06na25396 , and is supported by the laboratory directed research and development programs at lanl . it is also supported in part by grants ast-0407176 , ast-0507521 , nng05gk10 g and nng06gi09 g ."
  ],
  "abstract_text": [
    "<S> in this era of precision cosmology , a detailed physical understanding on the evolution of cosmic baryons is required . </S>",
    "<S> cosmic magnetic fields , though still poorly understood , may represent an important component in the global cosmic energy flow that affects the baryon dynamics . </S>",
    "<S> we have developed an eulerian - based cosmological magnetohydrodynamics code ( cosmomhd ) with modern shock capturing schemes to study the formation and evolution of cosmic structures in the presence of magnetic fields . </S>",
    "<S> the code solves the ideal mhd equations as well as the non - equilibrium rate equations for multiple species , the vlasov equation for dynamics of collisionless particles , the poisson s equation for the gravitational potential field and the equation for the evolution of the intergalactic ionizing radiation field . </S>",
    "<S> in addition , a detailed star formation prescription and feedback processes are implemented . </S>",
    "<S> several methods for solving the mhd by high - resolution schemes with finite - volume and finite - difference methods are implemented . </S>",
    "<S> the divergence - free condition of the magnetic fields is preserved at a level of computer roundoff error via the constraint transport method . </S>",
    "<S> we have also implemented a high - resolution method via dual - equation formulations to track the thermal energy accurately in very high mach number or high alfven - mach number regions . </S>",
    "<S> several numerical tests have demonstrated the efficacy of the proposed schemes .    </S>",
    "<S> =    # 1 # 1 ,     # 1 # 1 ,     # 1 # 1 ,     = cmr8 scaled 0 # 1 , # 2 , # 3 , # 4 , # 5 , # 6    2@xmath0 </S>"
  ]
}