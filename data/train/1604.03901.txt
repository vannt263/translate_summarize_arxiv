{
  "article_text": [
    "depth from a single rgb image is a fundamental problem in vision .",
    "recent years have seen rapid progress thanks to data - driven methods  @xcite , in particular , deep neural networks trained on large rgb - d datasets  @xcite .",
    "but such advances have yet to broadly impact higher - level tasks .",
    "one reason is that many higher - level tasks must operate on images `` in the wild''images taken with no constraints on cameras , locations , scenes , and objects  but the rgb - d datasets used to train and evaluate image - to - depth systems are constrained in one way or another .",
    "current rgb - d datasets were collected by depth sensors  @xcite , which are limited in range and resolution , and often fail on specular or transparent objects  @xcite .",
    "in addition , because there is no flickr for rgb - d images , researchers have to manually capture the images . as a result ,",
    "current rgb - d datasets are limited in the diversity of scenes .",
    "for example , nyu depth  @xcite consists mostly of indoor scenes with no human presence ; kitti  @xcite consists mostly of road scenes captured from a car ; make3d  @xcite consists mostly of outdoor scenes of the stanford campus ( figure .",
    "[ fig : dataset_comparison ] ) . while these datasets are pivotal in driving research , it is unclear whether systems trained on them can generalize to images in the wild .",
    "is it possible to collect ground - truth depth for images in the wild ? using depth sensors in unconstrained settings is not yet feasible .",
    "crowdsourcing seems viable , but humans are not good at estimating metric depth , or 3d metric structure in general  @xcite .",
    "in fact , metric depth from a single image is fundamentally ambiguous : a tree behind a house can be slightly bigger but further away , or slightly smaller but closer  the absolute depth difference between the house and the tree can not be uniquely determined .",
    "furthermore , even in cases where humans can estimate metric depth , it is unclear how to elicit the values from them .    but humans are better at judging relative depth  @xcite : `` is point a closer than point b ? '' is often a much easier question for humans .",
    "recent work by zoran et al .",
    "@xcite shows that it is possible to learn to estimate metric depth using only annotations of relative depth .",
    "although such metric depth estimates are only accurate up to monotonic transformations , they may well be sufficiently useful for high - level tasks , especially for occlusion reasoning . the seminal results by zoran et al .",
    "point to two fronts for further progress : ( 1 ) collecting a large amount of relative depth annotations for images in the wild and ( 2 ) improving the algorithms that learn from annotations of relative depth .    in this paper",
    ", we make contributions on both fronts .",
    "our first contribution is a new dataset called `` depth in the wild '' ( diw ) .",
    "it consists of 495k diverse images , each annotated with randomly sampled points and their relative depth .",
    "we sample one pair of points per image to minimize the redundancy of annotation  . to the best of our knowledge",
    "this is the first large - scale dataset consisting of images in the wild with relative depth annotations .",
    "we demonstrate that this dataset can be used as an evaluation benchmark as well as a training resource  .",
    "our second contribution is a new algorithm for learning to estimate metric depth using only annotations of relative depth .",
    "our algorithm not only significantly outperforms that of zoran et al .",
    "@xcite , but is also simpler . the algorithm of zoran et al .",
    "@xcite first learns a classifier to predict the ordinal relation between two points in an image .",
    "given a new image , this classifier is repeatedly applied to predict the ordinal relations between a sparse set of point pairs ( mostly between the centers of neighboring superpixels ) .",
    "the algorithm then reconstructs depth from the predicted ordinal relations by solving a constrained quadratic optimization that enforces additional smoothness constraints and reconciles potentially inconsistent ordinal relations . finally , the algorithm estimates depth for all pixels assuming a constant depth within each superpixel .",
    "in contrast , our algorithm consists of a single deep network that directly predicts pixel - wise depth ( fig .",
    "[ fig : teaser ] ) .",
    "the network takes an entire image as input , consists of off - the - shelf components , and can be trained entirely with annotations of relative depth .",
    "the novelty of our approach lies in the combination of two ingredients : ( 1 ) a multi - scale deep network that produces pixel - wise prediction of metric depth and ( 2 ) a loss function using relative depth .",
    "experiments show that our method produces pixel - wise depth that is more accurately ordered , outperforming not only the method by zoran et al .",
    "@xcite but also the state - of - the - art image - to - depth system by eigen et al .",
    "@xcite trained with ground - truth metric depth .",
    "furthermore , combing our new algorithm , our new dataset , and existing rgb - d data significantly improves single - image depth estimation in the wild .",
    "* rgb - d datasets : * prior work on constructing rgb - d datasets has relied on either kinect  @xcite or lidar  @xcite . existing kinect - based datasets are limited to indoor scenes ; existing lidar - based datasets are biased towards scenes of man - made structures  @xcite . in contrast , our dataset covers a much wider variety of scenes ; it can be easily expanded with large - scale crowdsourcing and the virually umlimited internet images .    * intrinsic images in the wild : * our work draws inspiration from intrinsic images in the wild  @xcite , a seminal work that crowdsources annotations of relative reflectance on unconstrained images .",
    "our work differs in goals as well as in several design decisions .",
    "first , we sample random points instead of centers of superpixels , because unlike reflectance , it is unreasonable to assume a constant depth within a superpixel .",
    "second , we sample only one pair of points per image instead of many to maximize the value of human annotations .    *",
    "depth from a single image : * image - to - depth is a long - standing problem with a large body of literature  @xcite . the recent convergence of deep neural networks and rgb - d datasets  @xcite has led to major advances  @xcite . but the networks in these previous works , with the exception of  @xcite , were trained exclusively using ground - truth metric depth , whereas our approach uses relative depth .",
    "our work is inspired by that of zoran et al .",
    "@xcite , which proposes to use a deep network to repeatedly classify pairs of points sampled based on superpixel segmentation , and to reconstruct per - pixel metric depth by solving an additional optimization problem .",
    "our approach is different : it consists of a single deep network trained end - to - end that directly predicts per - pixel metric depth ; there is no intermediate classification of ordinal relations and as a result no optimization needed to resolve inconsistencies .    * learning with ordinal relations : * several recent works  @xcite have used the ordinal relations from the intrinsic images in the wild dataset  @xcite to estimate surface refletance .",
    "similar to zoran et al .",
    "@xcite , zhou et al .",
    "@xcite first learn a deep network to classify the ordinal relations between pairs of points and then make them globally consistent through energy minimization .",
    "narihira et al .",
    "@xcite learn a `` lightness potential '' network that takes an image patch and predicts the metric reflectance of the center pixel . but",
    "this network is applied to only a sparse set of pixels .",
    "although in principle this lightness potential network can be applied to every pixel to produce pixel - wise reflectance , doing so would be quite expensive .",
    "making it fully convolutional ( as the authors mentioned in  @xcite ) only solves it partially : as long as the lightness potential network has downsampling layers , which is the case in  @xcite , the final output will be downsampled accordingly .",
    "additional resolution augmentation ( such as the `` shift and stitch '' approach  @xcite ) is thus needed .",
    "in contrast , our approach completely avoids such issues and directly outputs pixel - wise estimates .    beyond intrinsic images ,",
    "ordinal relations have been used widely in computer vision and machine learning , including object recognition  @xcite and learning to rank  @xcite .",
    ") and relative depth of two random points . , scaledwidth=83.0% ]    ) and relative depth of two random points . ,",
    "scaledwidth=67.4% ]    we gather images from flickr .",
    "we use random query keywords sampled from an english dictionary and exclude artificial images such as drawings and clip arts . to collect annotations of relative depth , we present a crowd worker an image and two highlighted points ( fig .",
    "[ fig : gui ] ) , and ask `` which point is closer , point 1 , point 2 , or hard to tell ? '' the worker presses a key to respond .",
    "* how many pairs ? * how many pairs of points should we query per image ?",
    "we sample just one per image because this maximizes the amount of information from human annotators .",
    "consider the other extreme  querying all possible pairs of points in the same image .",
    "this is wasteful because pairs of points in close proximity are likely to have the same relative depth . in other words , querying one more pair from the same image may add less information than querying one more pair from a new image . thus querying only one pair per image",
    "is more cost - effective .    * which pairs ? * which two points should we query given an image ?",
    "the simplest way would be to sample two random points from the 2d plane .",
    "but this results in a severe bias that can be easily exploited : if an algorithm simply classifies the lower point in the image to be closer in depth , it will agree with humans @xmath0 of the time ( fig .  [",
    "fig : bias_graph ] ) .",
    "although this bias is natural , it makes the dataset less useful as a benchmark .",
    "an alternative is to sample two points uniformly from a random horizontal line , which makes it impossible to use the @xmath1 image coordinate as a cue .",
    "but we find yet another bias : if an algorithm simply classifies the point closer to the center of the image to be closer in depth , it will agree with humans @xmath2 of the time .",
    "this leads to a third approach : uniformly sample two _ symmetric _ points with respect to the center from a random horizontal line ( the middle column of fig .",
    "[ fig : points_in_our_dataset ] ) . with",
    "the symmetry enforced , we are not able to find a simple yet effective rule based purely on image coordinates : the left point is almost equally likely ( @xmath3 ) to be closer than the right one .",
    "our final dataset consists of a roughly 50 - 50 combination of unconstrained pairs and symmetric pairs , which strikes a balance between the need for representing natural scene statistics and the need for performance differentiation .",
    "* protocol and results : * we crowdsource the annotations using amazon mechanical turk ( amt ) . to remove spammers , we insert into all tasks gold - standard images verified by ourselves , and reject workers whose accumulative accuracy on the gold - standard images is below 85% .",
    "we assign each query ( an image and a point pair ) to two workers , and add the query to our dataset if both workers can tell the relative depth and agree with each other ; otherwise the query is discarded . under this protocol , the chance of adding a wrong answer to our dataset is less than 1% as measured on the gold - standard images .",
    "we processed 1.24 m images on amt and obtained 0.5 m valid answers ( both workers can tell the relative depth and agree with each other ) . among the valid answers ,",
    "261k are for unconstrained pairs and 240k are for symmetric pairs . for unconstrained pairs",
    ", it takes a median of 3.4 seconds for a worker to decide , and two workers agree on the relative depth 52% of the time ; for symmetric pairs , the numbers are 3.8s and 32% .",
    "these numbers suggest that the symmetric pairs are indeed harder .",
    "[ fig : points_in_our_dataset ] presents examples of different kinds of queries .",
    "how do we learn to predict metric depth given only annotations of relative depth ?",
    "zoran et al .",
    "@xcite first learn a classifier to predict ordinal relations between centers of superpixels , and then reconcile the relations to recover depth using energy minimization , and then interpolate within each superpixel to produce per - pixel depth .",
    "we take a simpler approach .",
    "the idea is that any image - to - depth algorithm would have to compute a function that maps an image to pixel - wise depth . why not represent this function as a neural network and learn it from end to end ?",
    "we just need two ingredients : ( 1 ) a network design that outputs the same resolution as the input , and ( 2 ) a way to train the network with annotations of relative depth .    * network design : * networks that output the same resolution as the input are aplenty , including the recent designs for depth estimation  @xcite and those for semantic segmentation  @xcite and edge detection  @xcite .",
    "a common element is processing and passing information across multiple scales .    in this work ,",
    "we use a variant of the recently introduced `` hourglass '' network ( fig .",
    "[ fig : network ] ) , which has been used to achieve state - of - the - art results on human pose estimation  @xcite .",
    "it consists of a series of convolutions ( using a variant of the inception  @xcite module ) and downsampling , followed by a series of convolutions and upsampling , interleaved with skip connections that add back features from high resolutions .",
    "the symmetric shape of the network resembles a `` hourglass '' , hence the name .",
    "we refer the reader to  @xcite for comparing the design to related work . for our purpose ,",
    "this particular choice is not essential , as the various designs mainly differ in how information from different scales is dispersed and aggregated , and it is possible that all of them can work equally well for our task .",
    "* loss function : * how do we train the network using only ordinal annotations ?",
    "all we need is a loss function that encourages the predicted depth map to agree with the ground - truth ordinal relations .",
    "specifically , consider a training image @xmath4 and its @xmath5 queries @xmath6 , where @xmath7 is the location of the first point in the @xmath8-th query , @xmath9 is the location of the second point in the @xmath8-th query , and @xmath10 is the ground - truth depth relation between @xmath7 and @xmath9 : closer ( @xmath11 ) , further ( @xmath12 ) , and equal ( @xmath13 ) .",
    "let @xmath14 be the predicted depth map and @xmath15 be the depths at point @xmath7 and @xmath9 .",
    "we define a loss function @xmath16 where @xmath17 is the loss for the @xmath8-th query @xmath18 this is essentially a ranking loss : it encourages a small difference between depths if the ground - truth relation is equality ; otherwise it encourages a large difference .",
    "* novelty of our approach : * our novelty lies in the combination of a deep network that does pixel - wise prediction and a ranking loss placed on the pixel - wise prediction .",
    "a deep network that does pixel - wise prediction is not new , nor is a ranking loss . but to the best of our knowledge , such a combination has not been proposed before , and in particular not for estimating depth .",
    "sign denotes the element - wise addition .",
    "block h is a convolution with 3x3 filter .",
    "all other blocks denote the inception module shown in figure  [ fig : inception ] .",
    "their parameters are detailed in tab .",
    "[ table : network_parameters],scaledwidth=90.0% ]",
    "we evaluate our method using nyu depth  @xcite , which consists of indoor scenes with ground - truth kinect depth .",
    "we use the same setup as that of zoran et al .",
    "@xcite : point pairs are sampled from the training images ( the subset of nyu depth consisting of 795 images with semantic labels ) using superpixel segmentation and their ground - truth ordinal relations are generated by comparing the ground - truth kinect depth ; the same procedure is applied to the test set to generate the point pairs for evaluation ( around 3k pairs per image ) .",
    "we use the same training and test data as zoran et al .",
    "@xcite .    as the system by zoran et al .",
    "@xcite , our network predicts one of the three ordinal relations on the test pairs : equal ( @xmath19 ) , closer ( @xmath20 ) , or farther ( @xmath21 ) .",
    "we report wkdr , the weighted disagreement rate between the predicted ordinal relations and ground - truth ordinal relations  .",
    "we also report @xmath22 ( disagreement rate on pairs whose ground - truth relations are @xmath19 ) and @xmath23 ( disagreement rate on pairs whose ground - truth relations are @xmath20 or @xmath21 ) .    since two ground - truth depths are almost never exactly the same , there needs to be a relaxed definition of equality .",
    "zoran et al .",
    "@xcite define two points to have equal depths if the ratio between their ground - truth depths is within a pre - determined range .",
    "our network predicts an equality relation if the depth difference is smaller than a threshold @xmath24 .",
    "the choice of this threshold will result in different values for the error metrics ( @xmath25 , @xmath22 , @xmath23 ) : if @xmath24 is too small , most pairs will be predicted to be unequal and the error metric on equality relations ( @xmath22 ) will be large ; if @xmath24 is too big , most pairs will be predicted to be equal and the error metric on inequality relations ( @xmath23 ) will be large .",
    "we choose the threshold @xmath24 that minimizes the maximum of the three error metrics on a validation set held out from the training set .",
    "[ table : nyu_performance ] compares our network ( _ ours _ ) versus that of zoran et al .",
    "our network is trained with the same data   but outperforms  @xcite on all three metrics .",
    "following  @xcite , we also compare with the state - of - art image - to - depth system by eigen et al .",
    "@xcite , which is trained on pixel - wise ground - truth metric depth from the full nyu depth training set ( 220k images ) . to compare fairly",
    ", we give our network access to the full nyu depth training set .",
    "in addition , we remove the limit of 800 point pairs per training image placed by zoran et al and use all available pairs . the results in tab .",
    "[ table : nyu_performance ] show that our network ( _ ours_full _ ) achieves superior performance in estimating depth ordering .",
    "granted , this comparison is not entirely fair because  @xcite is not optimized for predicting ordinal relations . but this comparison is still significant in that it shows that we can train on only relative depth and rival the state - of - the - art system in estimating depth up to monotonic transformations .    in figure .",
    "[ fig : qual_nyu ] we show qualitative results on the same example images used by zoran et al .",
    "we see that although imperfect , the recovered metric depth by our method is overall reasonable and qualitatively similar to that by the state - of - art system  @xcite trained on ground - truth metric depth .",
    "* metric error measures . *",
    "our network is trained with relative depth , so it is unsurprising that it does well in estimating depth up to ordering . but",
    "how good is the estimated depth in terms of metric error ?",
    "we thus evaluate conventional error measures such as rmse ( the root mean squared error ) , which compares the absolute depth values to the ground truths . because our network is trained only on relative depth and does not know the range of the ground - truth depth values , to make these error measures meaningful we normalize the depth predicted by our network such that the mean and standard deviation are the same as those of the mean depth map of the training set .",
    "[ table : nyu_performance ] reports the results .",
    "we see that under these metric error measures our network still outperforms the method of zoran et al .",
    "in addition , while our metric error is worse than the current state - of - the - art , it is comparable to some of the earlier methods ( e.g.  @xcite ) that have access to ground - truth metric depth .        * superpixel sampling versus random sampling . * to compare with the method by zoran et al .",
    "@xcite , we train our network using the same point pairs , which are pairs of centers of superpixels ( fig .  [",
    "fig : random_structured_point ] ) .",
    "but is superpixel segmentation necessary",
    "? that is , can we simply train with randomly sampled points ?",
    "to answer this question , we train our network with randomly sampled points .",
    "we constrain the distance between the two points to be between 13 and 19 pixels ( out of a 320@xmath26240 image ) such that the distance is similar to that between the centers of neighboring superpixels .",
    "the results are included in tab .",
    "[ table : nyu_performance ] .",
    "we see that using 3.3k pairs per image ( _ * rand_3k * _ ) already achieves comparable performance to the method by zoran et al .",
    "@xcite . using twice or four times as many pairs ( _ * rand_6k *",
    "_ , _ * rand_12k * _ ) further improves performance and significantly outperforms  @xcite .",
    "it is worth noting that in all these experiments the test pairs are still from superpixels , so training on random pairs incurs a mismatch between training and testing distributions .",
    "yet we can still achieve comparable performance despite this mismatch .",
    "this shows that our method can indeed operate without superpixel segmentation .",
    "in this section we experiment on our new depth in the wild ( diw ) dataset .",
    "we split the dataset into 421k training images and 74k test images  .",
    "we report the whdr ( weighted human disagreement rate )   of 5 methods in tab .  [",
    "table : amt_performance ] : ( 1 ) the state - of - the - art system by eigen et al .  @xcite trained on full nyu depth ; ( 2 ) our network trained on full nyu depth ( ours_full ) ; ( 3 ) our network pre - trained on full nyu depth and fine - tuned on diw ( ours_nyu_diw ) ; ( 4 ) our network trained from scratch on diw ( ours_diw ) ; ( 5 ) a baseline method that uses only the location of the query points : classify the lower point to be closer or guess randomly if the two points are at the same height ( query_location_only ) .",
    "we see that the best result is achieved by pre - training on nyu depth and fine - tuning on diw .",
    "training only on nyu depth ( ours_nyu and eigen ) does not work as well , which is expected because nyu depth only has indoor scenes .",
    "training from scratch on diw achieves slightly better performance than those trained on only nyu depth despite using much less supervision .",
    "pre - training on nyu depth and fine - tuning on diw leaverages all available data and achieves the best performance . as shown in fig .",
    "[ fig : qual_diw ] , the quality of predicted depth is notably better with fine - tuning on diw , especially for outdoor scenes .",
    "these results suggest that it is promising to combine existing rgb - d data and crowdsourced annotations to advance the state - of - the art in single - image depth estimation ."
  ],
  "abstract_text": [
    "<S> this paper studies single - image depth perception in the wild , i.e. , recovering depth from a single image taken in unconstrained settings . </S>",
    "<S> we introduce a new dataset `` depth in the wild '' consisting of images in the wild annotated with relative depth between pairs of random points . </S>",
    "<S> we also propose a new algorithm that learns to estimate metric depth using annotations of relative depth . compared to the state of the art , </S>",
    "<S> our algorithm is simpler and performs better . </S>",
    "<S> experiments show that our algorithm , combined with existing rgb - d data and our new relative depth annotations , significantly improves single - image depth perception in the wild . </S>"
  ]
}