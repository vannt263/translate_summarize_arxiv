{
  "article_text": [
    "the constraint satisfaction problem ( csp ) provides a framework for expressing a wide class of combinatorial problems .",
    "given an instance of the csp , the aim is to determine if there is a way to assign values from a fixed domain to the variables of the instance so that each of its constraints is satisfied . while the entire collection of csps forms an * np*-complete class of problems , a number of subclasses have been shown to be tractable ( i.e. , to lie in * p * ) .",
    "a major focus of research in this area is to determine the subclasses of the csp that are tractable .",
    "one way to define a subclass of the csp is to restrict the constraint relations that occur in an instance to a given finite set of relations over a fixed , finite domain , called a constraint language .",
    "a central problem is to classify the constraint languages that give rise to tractable subclasses of the csp .",
    "currently , all constraint languages that have been investigated have been shown to give rise to a subclass of the csp that is either * np*-complete or in * p*. it is conjectured in @xcite that this dichotomy holds for all subclasses arising from finite constraint languages .    in some special cases ,",
    "the conjectured dichotomy has been verified .",
    "for example , the work of schaefer @xcite and of bulatov @xcite establish this over domains of sizes 2 and 3 respectively . for constraint languages over larger domains a number of significant results",
    "have been obtained @xcite .",
    "one method for establishing that the subclass of the csp associated with a finite constraint language is tractable is to establish a type of local consistency property for the instances in the subclass . in @xcite feder and vardi",
    "introduce a notion of the width of a constraint language and show that languages of bounded width give rise to tractable subclasses of the csp .",
    "there is a natural connection between these subclasses of the csp and definability within datalog .    in work by jeavons and his co - authors",
    "an approach to classifying the tractable constraint languages via algebraic methods has been proposed and applied with great success @xcite .",
    "in essence , their work allows one to associate a finite algebraic structure to each constraint language and then to analyze the complexity of the corresponding subclass of the csp in purely algebraic terms .    in this paper ,",
    "we employ the algebraic approach to analyzing constraint languages and with it are able to identify a new , general class of tractable constraint languages .",
    "these languages arise from finite algebras that generate congruence distributive varieties , or equivalently , that have a sequence of special term operations , called jnsson  terms , that satisfy certain equations .",
    "theorem [ main - result ] establishes the tractability of these languages by showing that they are of bounded width .",
    "related to our result is the theorem of jeavons , cohen , and cooper in @xcite that establishes the tractability of constraint languages that arise from another class of finite algebras that generate congruence distributive varieties .",
    "these algebras are equipped with a special term operation called a near unanimity operation .",
    "dalmau @xcite provides an alternate proof of their result .",
    "in this section we introduce the necessary terminology and results on the csp and from universal algebra that will be needed to prove the main result ( theorem [ main - result ] ) of this paper .    in the following discussion",
    "we will employ standard terminology and notation when dealing with @xmath0-tuples and relations over sets .",
    "in particular , if @xmath1 is a tuple over the sequence of domains @xmath2 , @xmath3 , ( i.e. , is a member of @xmath4 ) and @xmath5 is a subset of @xmath6 then @xmath7 denotes the tuple @xmath8 over the sequence of domains @xmath9 and is called the restriction ( or the projection ) of @xmath1 to @xmath5 .",
    "we extend this projection function to arbitrary relations over the @xmath2 .",
    "the @xmath10th element of the tuple @xmath1 will be denoted by @xmath11 .    for @xmath12 and @xmath13 binary relations on a set @xmath14 , we define the relational product of @xmath12 and @xmath13 , denoted @xmath15 , to be the binary relation consisting of all pairs @xmath16 for which there is some @xmath17 with @xmath18 and @xmath19 .",
    "[ csp - def ] an instance of the constraint satisfaction problem is a triple @xmath20 with    * @xmath21 a non - empty , finite set of variables , * @xmath14 a non - empty , finite set ( or domain ) , * @xmath22 a set of constraints @xmath23 where each @xmath24 is a pair @xmath25 with * * @xmath26 a tuple of variables of length @xmath27 , called the scope of @xmath24 , and * * @xmath28 an @xmath27-ary relation over @xmath14 , called the constraint relation of @xmath24 .",
    "given an instance @xmath29 of the csp we wish to answer the following question :    _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ is there a solution to @xmath29 , i.e. , is there a function @xmath30 such that for each @xmath31 , the @xmath27-tuple @xmath32 ? _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _    we say that two instances of the csp having the same set of variables and the same domain are equivalent if they have the same set of solutions .",
    "in general , the class of csps is * np*-complete ( see @xcite ) , but by restricting the nature of the constraint relations that are allowed to appear in an instance of the csp , it is possible to find natural subclasses of the csp that are tractable .",
    "let @xmath14 be a domain and @xmath33 a set of finitary relations over @xmath14 .",
    "csp(@xmath33 ) denotes the collection of all instances of the csp with domain @xmath14 and with constraint relations coming from @xmath33 .",
    "@xmath33 is called the constraint language of the class csp(@xmath33 ) .",
    "call a finite constraint language @xmath33 tractable if the class of problems csp(@xmath33 ) is tractable ( i.e. , lies in * p * ) .",
    "if @xmath33 is infinite and each finite subset @xmath34 of @xmath33 is tractable then we say that @xmath33 is tractable .",
    "if the entire class csp(@xmath33 ) is in * p * then we say that @xmath33 is globally tractable .",
    "@xmath33 is said to be * np*-complete if for some finite subset @xmath34 of @xmath33 , the class of problems csp(@xmath34 ) is * np*-complete .",
    "a key problem in this area is to classify the ( globally ) tractable constraint languages .",
    "note that in this paper we will assume that @xmath35 .",
    "feder and vardi @xcite conjecture that every finite constraint language is either tractable or is * np*-complete",
    ".    we will find it convenient to extend the above notions of instances of the csp and constraint languages to a multi - sorted setting .",
    "this approach has been used on a number of occasions , in particular in @xcite .",
    "[ multi - sort ] a multi - sorted instance of the constraint satisfaction problem is a pair @xmath36 where    * @xmath37 is a sequence of finite , non - empty sets , called the domains of @xmath29 , and * @xmath22 is a set of constraints @xmath23 where each @xmath24 is a pair @xmath38 with * * @xmath39 a non - empty subset of @xmath6 called the scope of @xmath24 , and * * @xmath28 an @xmath40-ary relation over @xmath41 , called the constraint relation of @xmath24 .    in this case ,",
    "a solution to @xmath29 is an @xmath0-tuple @xmath1 over the sequence @xmath42 such that @xmath43 for each @xmath44 .",
    "clearly , each standard instance of the csp can be expressed as an equivalent multi - sorted instance . while the given definition of a multi - sorted instance of the csp does not allow for the repetition of variables within the scope of any constraint ,",
    "there is a natural extension of definition  [ csp - def ] that allows this .",
    "note that there is a very straightforward procedure to transform such an instance to an equivalent one that conforms to definition  [ multi - sort ] .",
    "a relation @xmath12 over the sets @xmath2 , @xmath45 , is subdirect if for all @xmath3 , @xmath46 .",
    "we call a multi - sorted instance @xmath29 of the csp subdirect if each of its constraint relations is .",
    "in addition to the set of solutions of an instance of the csp , one can also consider partial solutions of the instance .",
    "for @xmath29 as in definition [ multi - sort ] and @xmath5 a subset of @xmath47 , the set of partial solutions of @xmath29 over @xmath5 , denoted @xmath48 , is the set of solutions of the instance @xmath49 where @xmath50 and @xmath51 with @xmath52 for @xmath44 .",
    "clearly if the set of partial solutions of an instance over some subset of coordinates is empty then the instance has no solutions .",
    "let @xmath22 be a finite set ( or sequence ) of finite , non - empty sets .",
    "a ( multi - sorted ) constraint language over @xmath22 is a collection of finitary relations over the sets in @xmath22 . given a multi - sorted constraint language @xmath33 over @xmath22 , the class csp(@xmath33 ) consists of all multi - sorted instances of the csp whose domains come from @xmath22 and whose constraint relations come from @xmath33 .",
    "@xmath53 denotes the set of all finitary relations over the members of @xmath22 .    in a natural way ,",
    "the notions of tractability and * np*-completeness can be extended to multi - sorted constraint languages .",
    "there are a number of standard sources for the basics of universal algebra , for example @xcite and @xcite .",
    "the books @xcite provide details on the more specialized aspects of the subject that we will use in this paper .",
    "an algebra @xmath54 is a pair @xmath55 where @xmath14 is a non - empty set and @xmath56 is a ( possibly infinite ) collection of finitary operations on @xmath14 .",
    "the operations in @xmath56 are called the basic operations of @xmath57 .",
    "a term operation of an algebra @xmath57 is a finitary operation on @xmath14 that can be obtained by repeated compositions of the basic operations of @xmath57 .",
    "we assume some familiarity with the standard algebraic operations of taking subalgebras , homomorphic images and cartesian products .",
    "note that in order to sensibly take a homomorphic image of an algebra , or the cartesian product of a set of algebras or to speak of terms and equations of an algebra we need to have some indexing of the basic operations of the algebras .",
    "algebras that have the same indexing are said to be similar ( or of the same similarity type ) .",
    "when necessary , we distinguish between an algebra and its underlying set , or universe .",
    "a subuniverse of an algebra @xmath55 is a subset of @xmath14 that is invariant under @xmath56 .",
    "note that we allow empty subuniverses but not algebras with empty universes .",
    "a variety of algebras is a collection of similar algebras that is closed under the taking of cartesian products , subalgebras and homomorphic images .",
    "if @xmath58 is a class of similar algebras then @xmath59 denotes the smallest variety that contains @xmath58 .",
    "a class @xmath60 of similar algebras is a variety if and only if @xmath60 can be axiomatized by a set of equations .",
    "it turns out that for a class @xmath58 of similar algebras , @xmath61 , i.e. , the class of homomorphic images of subalgebras of cartesian products of members of @xmath58 .",
    "let @xmath57 be an algebra",
    "an equivalence relation @xmath62 on @xmath14 is a congruence of @xmath57 if it is invariant under the basic operations of @xmath57 .",
    "the congruence lattice of @xmath57 , denoted @xmath63 , is the lattice of all congruences of @xmath57 , ordered by inclusion .",
    "3 .   @xmath64 denotes the congruence relation @xmath65 and @xmath66 denotes the congruence relation @xmath67 , the smallest and largest congruences of the algebra @xmath57 , respectively .",
    "an algebra @xmath57 is simple if @xmath64 and @xmath66 are its only congruences .",
    "the congruence lattice of an algebra is a very useful invariant and the types of congruence lattices that can appear in a variety govern many properties of the algebras in the variety .",
    "one particularly relevant and important property of congruence lattices is that of distributivity .",
    "an algebra @xmath57 is said to be congruence distributive if its congruence lattice satisfies the distributive law for congruence meet and join .",
    "a class of algebras is congruence distributive if all of its members are .",
    "[ jonequ ] for @xmath68 , we define @xmath69 to be the class of all algebras @xmath57 that have a sequence of ternary term operations @xmath70 , @xmath71 , that satisfies the identities : @xmath72    a sequence of term operations of an algebra @xmath57 that satisfies the above equations will be referred to as jnsson  terms of @xmath57 .",
    "the following celebrated theorem of jnsson  relates congruence distributivity to the existence of jnsson  terms .",
    "an algebra @xmath57 generates a congruence distributive variety if and only if there is some @xmath68 such that @xmath57 is in @xmath69 . in this case , all algebras in @xmath73 lie in @xmath69 .    for @xmath74 , define @xmath75 to be the variety of all algebras that have as basic operations a sequence of @xmath76 ternary operations @xmath70 , for @xmath71 , that satisfy the equations from definition  [ jonequ ] .",
    "note that an algebra is in @xmath77 if and only if it has size 1 and is in @xmath78 if and only if it has a majority term operation ( i.e. , a term operation @xmath79 that satisfies the equations @xmath80 ) .    some of the main results and conjectures dealing with the csp can be expressed in terms of tame congruence theory , a deep theory of the local structure of finite algebras developed by hobby and mckenzie .",
    "details of this theory may be found in @xcite or @xcite .",
    "the connection between the csp and tame congruence theory was made by bulatov , jeavons , and krokhin @xcite and we will touch on it in the next subsection . in this paper",
    "we will only introduce some of the basic terminology of the theory and will omit most details .    in tame congruence theory , five local types of behaviour of finite algebras are identified and studied .",
    "the five types are , in order :    _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 1 .   the unary type , 2 .   the affine or vector - space type , 3 .",
    "the 2 element boolean type , 4 .",
    "the 2 element lattice type , 5 .   the 2 element semi - lattice type .",
    "_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _    we say that an algebra @xmath57 omits a particular type if , locally , the corresponding type of behaviour does not occur in @xmath57 . a class of algebras @xmath22 is said to omit a particular type if all finite members of @xmath22 omit that type .",
    "in @xcite , chapter 9 , characterizations of finite algebras that generate varieties that omit the unary type or both the unary and affine type are given .",
    "the characterizations are similar to that given by jnsson  of the congruence distributive varieties .",
    "it easily follows from the characterizations that if @xmath57 is a finite algebra that generates a congruence distributive variety then the variety omits both the unary and affine types .    to close this subsection",
    "we note a special property of the term operations of the algebras in @xmath75 for all @xmath74",
    ".    an @xmath0-ary operation @xmath81 on a set @xmath14 is idempotent if for all @xmath82 , @xmath83 .",
    "an algebra is idempotent if all of its term operations are idempotent .",
    "note that idempotency is hereditary in the sense that if a function is the composition of some idempotent operations then it too is idempotent . in another sense ,",
    "if @xmath57 is idempotent then all algebras in @xmath73 are idempotent , since this condition can be described equationally .",
    "finally , note that jnsson  terms are idempotent and so all algebras in @xmath75 for @xmath74 are idempotent .",
    "the natural duality between sets of relations ( constraint languages ) over a set @xmath14 and sets of operations ( algebras ) on @xmath14 has been studied by algebraists for some time .",
    "jeavons and his co - authors @xcite have shown how this link between constraint languages and algebras can be used to transfer questions about tractability into equivalent questions about algebras . in this subsection",
    "we present a concise overview of this connection .",
    "let @xmath14 be a non - empty set .    1 .",
    "let @xmath12 be an @xmath0-ary relation over @xmath14 and @xmath84 an @xmath85-ary function over @xmath14 for some @xmath0 , @xmath86 .",
    "we say that @xmath12 is invariant under @xmath87 and that @xmath87 is a polymorphism of @xmath12 if for all @xmath88 , for @xmath89 , the @xmath0-tuple @xmath90 , whose @xmath10-th coordinate is equal to @xmath91 , belongs to @xmath92 .",
    "2 .   for @xmath33 a set of relations over @xmath14",
    ", @xmath93 denotes the set of functions on @xmath14 that are polymorphisms of all the relations in @xmath33 .",
    "3 .   for @xmath56 a set of finitary operations on @xmath14",
    ", @xmath94 denotes the set of all finitary relations on @xmath14 that are invariant under all operations in @xmath56 .",
    "4 .   for @xmath33 a constraint language over @xmath14",
    ", @xmath95 denotes @xmath96 and @xmath97 denotes the algebra @xmath98 .",
    "5 .   for @xmath99 ,",
    "an algebra over @xmath14 , @xmath100 denotes the constraint language @xmath94 .",
    "we call a finite algebra @xmath57 tractable ( * np*-complete ) if the constraint language @xmath100 is .",
    "note that if @xmath57 is an algebra , then @xmath101 coincides with the set of all subuniverses of finite cartesian powers of @xmath57 .",
    "sets of relations of the form @xmath102 for a set of relations @xmath33 are known as relational clones .",
    "equivalently , a set of relations @xmath103 over a finite set @xmath14 is a relational clone if and only if it is closed under definition by primitive positive formulas ( or conjunctive queries ) .",
    "( @xcite)[relclone ] let @xmath33 be a constraint language on a finite set . if @xmath33 is tractable then so is @xmath104 .",
    "if @xmath105 is * np*-complete then so is @xmath33 .    in algebraic terms , theorem [ relclone ] states that a constraint language @xmath33 is tractable ( or * np*-complete ) if and only if the algebra @xmath97 is .",
    "so , the problem of characterizing the tractable constraint languages can be reduced to the problem of characterizing the tractable finite algebras . in a further step , bulatov , jeavons and krokhin @xcite",
    "provide a reduction down to idempotent algebras .",
    "for this class of algebras , they propose the following characterization of tractability .",
    "[ tract - conj ] let @xmath57 be a finite idempotent algebra .",
    "then @xmath57 is tractable if and only if the variety @xmath73 omits the unary type .",
    "they show that when this condition fails , the algebra is * np*-complete @xcite .",
    "they also show that if @xmath57 is a finite , idempotent algebra then @xmath73 omits the unary type if and only if the class @xmath106 does .",
    "this conjecture has been verified for a number of large classes of algebras .",
    "for example , results of schaefer @xcite and bulatov @xcite provide a verification for algebras whose universes have size 2 and 3 respectively .    as noted in the introduction , one approach to proving",
    "the tractability of a constraint language @xmath33 is to apply a notion of local consistency to the instances in csp(@xmath33 ) to determine if the instances have solutions .",
    "we present a notion of width , called relational width , developed by bulatov and jeavons @xcite that , for finite constraint languages , is closely related to the notion of width defined by feder and vardi ( see @xcite ) . in this paper",
    "we will closely follow the presentation of relational width found in @xcite .",
    "let @xmath107 be a sequence of finite , non - empty sets , let @xmath108 be an instance of the csp and let @xmath68 .",
    "we say that @xmath29 is @xmath109-minimal if :    1 .   for each subset @xmath5 of @xmath110 of size at most @xmath109 ,",
    "there is some constraint @xmath111 in @xmath22 such that @xmath112 , and 2 .",
    "if @xmath113 and @xmath114 are constraints in @xmath22 and @xmath115 has size at most @xmath109 then @xmath116 .",
    "it is not hard to show that the second condition of this definition is equivalent to having the set of partial solutions @xmath48 of @xmath29 equal to @xmath117 for all subsets @xmath5 of size at most @xmath109 and all @xmath10 with @xmath118 .",
    "[ min - alg ] let @xmath33 be a constraint language and @xmath68 .",
    "there is a polynomial time algorithm ( the @xmath109-minimality algorithm ) that converts a given instance @xmath29 from csp(@xmath33 ) into an equivalent @xmath109-minimal instance @xmath119 from csp(@xmath120 ) .",
    "in fact , if the arities of the constraint relations of @xmath29 are bounded by an integer @xmath121 then the arities of the constraint relations of @xmath119 are also bounded by @xmath85 .",
    "see the discussion in section 3.1 of @xcite .",
    "let @xmath33 be a constraint language and @xmath68 .",
    "we say that @xmath33 has relational width @xmath109 if for every instance @xmath29 from csp(@xmath33 ) , @xmath29 has a solution if and only if the constraint relations of @xmath119 , the equivalent @xmath109-minimal instance produced by the @xmath109-minimality algorithm , are all non - empty .",
    "[ width - prop ] let @xmath33 be a constraint language and @xmath68 .    1 .",
    "if an instance @xmath29 of the csp has a solution then the constraint relations of all equivalent instances are non - empty .",
    "if @xmath33 has relational width @xmath109 and @xmath122 then @xmath123 also has relational width @xmath109 .",
    "3 .   if @xmath33 has relational width @xmath109 then every @xmath109-minimal instance @xmath29 from csp(@xmath33 ) whose constraint relations are non - empty has a solution .",
    "if @xmath33 is of finite relational width then it is globally tractable .",
    "if every @xmath109-minimal instance from csp(@xmath120 ) whose constraint relations are non - empty has a solution then @xmath33 has relational width @xmath109 and hence is globally tractable .",
    "if @xmath33 is finite and @xmath124 is an upper bound on the arities of the relations in @xmath33 then @xmath33 has relational width @xmath109 if every @xmath109-minimal instance from csp(@xmath120 ) whose constraint relations are non - empty and have arity @xmath125 has a solution .    statement ( 4 ) follows from proposition [ min - alg ] , since if @xmath33 has relational width @xmath109 and @xmath29 is an instance from csp(@xmath33 ) then in order to determine if @xmath29 has a solution , it suffices to test if @xmath119 , the equivalent @xmath109-minimal instance produced by the @xmath109-minimality algorithm , has non - empty constraint relations . statements ( 5 ) and ( 6 ) also follows from proposition [ min - alg ] since the constraint relations of @xmath119 belong to @xmath126 and their arities are no bigger than the maximum of @xmath109 and the arities of the constraint relations of @xmath29 .    in the case where @xmath33 happens to be a relational clone ( i.e. , @xmath127 ) it follows from statements ( 3 ) and ( 5 ) of the previous proposition that @xmath33 has relational width @xmath109 if and only if every @xmath109-minimal instance of csp(@xmath33 ) whose constraint relations are all non - empty has a solution . for the most part , we are interested in this type of constraint language in this paper .",
    "we note that in @xcite it is shown that a finite constraint language has bounded relational width if and only if it has bounded width in the sense of feder - vardi .",
    "the following conjecture is similar to conjecture [ tract - conj ] and was proposed by larose and zdori @xcite for constraint languages of bounded width .",
    "[ width - conj ] let @xmath57 be a finite idempotent algebra .",
    "then @xmath57 is of bounded width if and only if @xmath73 omits the unary and affine types .    in @xcite larose and zdori",
    "verify one direction of this conjecture , namely that if @xmath73 fails to omit the unary or affine types then @xmath57 is not of bounded width .",
    "note that in @xcite , bulatov proposes a conjecture that is parallel to [ width - conj ] .",
    "larose and the second author have noted that , as with the unary type , one need only check in @xmath106 to determine if @xmath73 omits the unary and affine types when @xmath57 is finite and idempotent ( see corollary 3.2 of @xcite for a more general version of this ) .    the main result of this paper can be regarded as providing some evidence in support of conjecture [ width - conj ] .",
    "theorem [ main - result ] establishes that if @xmath57 is a finite member of @xmath128 then any finite constraint language contained in @xmath100 is of bounded width and hence tractable .",
    "recall that the variety @xmath129 consists of all algebras @xmath57 having four basic operations @xmath70 , @xmath130 that satisfy the equations of definition  [ jonequ ] .",
    "since the equations dictate that @xmath131 and @xmath132 are projections onto @xmath133 and @xmath134 respectively , they will play no role in the analysis of algebras in @xmath128 .",
    "for @xmath57 an algebra in @xmath129 , define @xmath135 to be the binary term operation @xmath136 of @xmath57 .",
    "note that the jnsson  equations imply that @xmath137 as well .",
    "this `` multiplication '' will play a crucial role in the proof of the main theorem of this paper .    for @xmath138 a subset of an algebra @xmath139",
    "let @xmath140 be the smallest subuniverse @xmath141 of @xmath142 containing @xmath138 and satisfying the following closure property : if @xmath133 is in @xmath141 and @xmath143 then @xmath144 is also in @xmath141 .",
    "we will call @xmath140 the jnsson  ideal of @xmath142 generated by @xmath138 .",
    "the concept of a jnsson  ideal was developed in @xcite for any algebra that generates a congruence distributive variety and was used in that paper to establish some intersection properties of subalgebras that are related to relational width .",
    "a finite algebra @xmath139 will be called jnsson  trivial if it has no proper non - empty jnsson  ideals .",
    "note that @xmath142 is jnsson  trivial if and only if @xmath145 for all @xmath146 .",
    "also note that if @xmath142 is jnsson  trivial then every homomorphic image of it is , as well .",
    "we now define a notion of distance in an algebra that will be applied to jnsson  trivial algebras to establish some useful features of the subalgebras of their cartesian products .",
    "let @xmath147 and @xmath148 be arbitrary similar algebras and @xmath149 a subdirect subalgebra of @xmath150 .    1 .",
    "let @xmath151 and @xmath152 be the relation on @xmath14 defined by : @xmath153 2 .   for @xmath68 ,",
    "let @xmath154 .",
    "3 .   for @xmath155 , @xmath156",
    ", we write @xmath157 if the pair @xmath16 is in @xmath158 and not in @xmath159 and will say that the distance between @xmath155 and @xmath160 relative to @xmath13 is @xmath109 .",
    "if no such @xmath109 exists , @xmath161 is said to be undefined .",
    "if @xmath161 is defined for all @xmath155 and @xmath156 we say that @xmath57 is connected with respect to @xmath162 .",
    "let @xmath57 , @xmath142 and @xmath162 be as in the definition .    1 .   for each @xmath163 ,",
    "the relation @xmath158 is a reflexive , symmetric subuniverse of @xmath164 .",
    "2 .   if @xmath57 is an idempotent algebra and @xmath165 then for any @xmath163 , the set of all elements @xmath155 with @xmath166 is a subuniverse of @xmath57 .",
    "if @xmath57 is a simple algebra then either @xmath161 is undefined for all @xmath167 ( equivalently @xmath168 ) or @xmath57 is connected with respect to @xmath162 .",
    "the symmetry of @xmath152 is immediate from its definition and its reflexivity follows from @xmath13 being subdirect . to see that it is a subuniverse of @xmath164 ,",
    "let @xmath169 be a term operation of @xmath57 and @xmath170 for @xmath171 .",
    "then for all @xmath10 there are @xmath172 with @xmath173 and @xmath174 . applying @xmath175 to these pairs",
    "shows that @xmath176 and @xmath177 and so @xmath178 .",
    "this establishes that @xmath152 is a subuniverse of @xmath164 .",
    "since the relational product operation preserves the properties of symmetry , reflexivity and being a subuniverse , it follows that @xmath158 has all three properties , for @xmath163 .",
    "suppose that @xmath57 is idempotent , @xmath165 , and @xmath163 .",
    "if @xmath179 is a term operation of @xmath57 and @xmath180 with @xmath181 , for @xmath3 , then @xmath182 for all @xmath10 . by the first claim of this proposition , it follows that @xmath183 since @xmath158 is a subuniverse of @xmath164 . by idempotency",
    "we have @xmath184 and so @xmath185 , or @xmath186 .",
    "this establishes the second claim of the proposition .    for the last claim , note",
    "that since @xmath152 is a symmetric , reflexive subuniverse of @xmath164 then its transitive closure is a congruence on @xmath57 that is equal to the union of the @xmath158 , @xmath187 .",
    "since @xmath57 is assumed to be simple then this congruence is either @xmath64 or @xmath66 . in the former case",
    "we conclude that @xmath161 is undefined for all @xmath167 and in the latter case that for all @xmath155 , @xmath156 , @xmath188 for some @xmath163 and so @xmath161 is defined .",
    "[ distance_inequality ] let @xmath147 and @xmath148 be finite algebras in @xmath129 and @xmath149 a subdirect subalgebra of  @xmath189 .",
    "suppose that @xmath147 is connected with respect to @xmath162 .",
    "then for every @xmath190 we have @xmath191 , d(y , z)\\right)\\,.\\ ] ]    let @xmath192 , @xmath193 and choose elements @xmath180 for @xmath194 with @xmath195 , @xmath196 and @xmath197 for @xmath198 . for @xmath109 the largest integer below @xmath199 $ ] we get that @xmath200 and @xmath201 are both at most  @xmath109",
    ". therefore if @xmath202 , then the pairs @xmath203 are in @xmath204 , and so @xmath205 but @xmath206 and @xmath207 , proving the lemma .",
    "[ distance_inequality_ideal ] for @xmath57 , @xmath142 and @xmath162 as in the previous lemma , suppose that @xmath208 for all @xmath155 , @xmath156 .",
    "let @xmath209 $ ] be any integer and @xmath165 .",
    "then the set of all elements of @xmath14 whose distance from @xmath17 is at most  @xmath85 is a jnsson  ideal of @xmath57 .",
    "as noted earlier the set @xmath210 is a subuniverse of @xmath57 since @xmath57 is idempotent .",
    "we need only show that @xmath5 is closed under multiplication on the left .",
    "so , suppose that @xmath211 and @xmath212 .",
    "since @xmath213 , we have @xmath214 by the previous lemma .",
    "[ distance_inequality_connected ] let @xmath57 and @xmath142 be finite members of @xmath129 such that @xmath57 is jnsson  trivial and connected with respect to some subdirect subalgebra @xmath162 of @xmath215",
    ". then @xmath216 for all @xmath155 , @xmath156 ( or equivalently , @xmath217 ) .",
    "suppose that the maximum distance  @xmath0 between the points of  @xmath14 is at least  @xmath218 and that @xmath155 , @xmath156 with @xmath219 .",
    "then @xmath85 , the largest integer below @xmath199 $ ] is less than @xmath0 . from the previous lemma ,",
    "the set of all elements @xmath212 with @xmath220 is a proper jnsson  ideal of @xmath57 , contradicting that @xmath57 is jnsson  trivial .",
    "[ connected_simple ] let @xmath147 , @xmath221 be finite members of @xmath129 with @xmath57 jnsson  trivial and simple and let @xmath149 be a subdirect subalgebra of @xmath150 .",
    "then either @xmath222 , or @xmath13 is the graph of an onto homomorphism from  @xmath148 to  @xmath147 .    as @xmath147 is simple ,",
    "then either @xmath168 or @xmath57 is connected with respect to @xmath162 . in the former case ,",
    "we conclude that @xmath13 is the graph of an onto homomorphism from @xmath142 to @xmath57 and in the latter , it follows from the previous corollary that @xmath223 .    for @xmath82 ,",
    "let @xmath224 and choose @xmath155 with @xmath225 maximal .",
    "let @xmath5 denote the set of those elements @xmath133 of @xmath14 for which @xmath226 . to complete the proof we will need to demonstrate that @xmath227 and @xmath228 . to show that @xmath229 it will suffice to prove that it is a jnsson  ideal of @xmath57 .",
    "indeed , let @xmath230 and @xmath231 be arbitrary .",
    "then @xmath232 ( since @xmath217 ) and therefore there is a @xmath233 such that @xmath234 and @xmath235 are in @xmath13 .",
    "note that since @xmath231 then @xmath236 . if @xmath237 is any element of @xmath238 then @xmath231 implies that @xmath239 , so we get that @xmath240 since this holds for every @xmath241 , we conclude that @xmath242 .",
    "finally , since @xmath13 is subdirect it follows that @xmath243 .",
    "we apply this lemma to obtain a simple description of subdirect products of finite , simple , jnsson  trivial members of @xmath129 and then show how to use this description to prove that certain @xmath109-minimal instances of the csp have solutions , when @xmath244 .",
    "[ full - product ] let @xmath245 , for @xmath3 , be finite members of @xmath129 with @xmath246 jnsson  trivial .",
    "let @xmath162 be a subdirect product of the @xmath245 s such that for all @xmath247 , the projection of @xmath13 onto coordinates 1 and @xmath10 is equal to @xmath248",
    ". then @xmath249 , where @xmath250 .",
    "we prove this by induction on @xmath0 .",
    "for @xmath251 , the result follows by our hypotheses .",
    "consider the case @xmath252 and let @xmath253 be the projection of @xmath162 onto @xmath254 .",
    "let @xmath255 and let @xmath256 .",
    "our goal is to show that @xmath257 and we can accomplish this by showing that it is a non - empty jnsson  ideal . clearly @xmath258 is a non - empty subuniverse of @xmath246 since all algebras involved are idempotent .",
    "let @xmath259 , @xmath260 and choose elements @xmath261 and @xmath262 with @xmath263 and @xmath264 . by our hypotheses , these elements exist .",
    "applying @xmath265 to these elements , along with @xmath266 , we get the element @xmath267 , showing that @xmath268 .",
    "thus @xmath258 is a jnsson  ideal .    now , consider the general case and suppose that the result holds for products of fewer than @xmath0 factors .",
    "let @xmath269 and @xmath270 .",
    "then @xmath162 is isomorphic to a subdirect product of @xmath246 , @xmath271 and @xmath272 and , by induction , @xmath273 .",
    "then , applying the result with @xmath252 to this situation , we conclude that @xmath274 , as required .",
    "[ trivial - product ] let @xmath245 be finite , simple , jnsson  trivial members of @xmath129 , for @xmath3 , and let @xmath162 be a subdirect product of the @xmath245 s .",
    "if , for all @xmath275 , the projection of @xmath13 onto @xmath276 is not the graph of a bijection then @xmath277 .    for @xmath275 , we have , by lemma [ connected_simple ] that either the projection of @xmath13 onto @xmath276 is the graph of a bijection between the two factors ( since they are both simple ) or is the full product .",
    "the former case is ruled out by assumption and so we are in a position to apply the previous lemma inductively to reach the desired conclusion .",
    "[ almost - triv ] a subdirect product @xmath162 of the algebras @xmath245 , @xmath278 , is said to be almost trivial if , after suitably rearranging the coordinates , there is a partition of @xmath110 into intervals @xmath279 , @xmath280 , such that @xmath281 and , for each @xmath282 , if @xmath283 then there are bijections @xmath284 , for @xmath285 such that @xmath286 .",
    "[ almost - trivial ] let @xmath245 be finite , simple , jnsson  trivial members of @xmath129 , for @xmath3 , and let @xmath162 be a subdirect product of the @xmath245 s .",
    "then @xmath162 is almost trivial .    for @xmath287 ,",
    "set @xmath288 if @xmath289 or the projection of @xmath13 onto @xmath2 and @xmath290 is equal to the graph of a bijection between these two factors . in this case , let @xmath291 denote this bijection .",
    "it is not hard to see that @xmath292 is an equivalence relation on the set @xmath110 and , by applying lemma [ connected_simple ] , if @xmath293 then the projection of @xmath13 onto @xmath2 and @xmath290 is equal to @xmath276 . by using the bijections @xmath291 and corollary [ trivial - product ] it is elementary to show that @xmath162 is indeed almost trivial .",
    "for @xmath294 a finite sequence of finite algebras , @xmath36 denotes a multi - sorted instance of the csp whose domains are the universes of the algebras in @xmath294 and whose constraint relations are subuniverses of cartesian products of members from @xmath294 .",
    "[ induction - base ] let @xmath294 be a finite sequence of finite , simple , jnsson  trivial members of @xmath129 and let @xmath295 be a subdirect , @xmath109-minimal instance of the csp for some @xmath296 .",
    "if the constraint relations of @xmath29 are all non - empty then @xmath29 has a solution .    definition [ almost - triv ] and analogs of corollary [ almost - trivial ] and theorem [ induction - base ] can be found at the end of section 3.3 in @xcite .",
    "the proof of corollary 3.4 given in that paper can be used to prove our theorem [ induction - base ] . as we shall see",
    ", this theorem will form the base of the inductive proof of our main result .",
    "the goal of this subsection is to show how to reduce a @xmath109-minimal instance @xmath29 of the csp whose domains all lie in @xmath129 and whose constraint relations are all non - empty to another @xmath109-minimal , subdirect instance @xmath119 whose domains are all jnsson  trivial and whose constraint relations are non - empty . in order to accomplish this , we will need to work with a suitably large @xmath296 .",
    "to start , let @xmath297 be a sequence of finite algebras from @xmath129 and let @xmath298 .",
    "let @xmath299 and @xmath36 be a @xmath109-minimal instance of the csp with @xmath22 consisting of the constraints @xmath300 , @xmath89 . by taking suitable subalgebras of the @xmath245",
    "we may assume that @xmath29 is subdirect and , of course , we also assume that the @xmath28 are all non - empty .",
    "in addition , @xmath109-minimality assures that we may assume that the scope of each constraint of @xmath29 consists of at least @xmath109 variables and that no two constraints have the same @xmath109-element set as their scopes .",
    "since @xmath29 is @xmath109-minimal then its system of partial solutions over @xmath109-element sets satisfies an important compatibility property .",
    "namely , if @xmath5 and @xmath301 are @xmath109-element sets of coordinates then @xmath302 . in this section we will denote @xmath48 by @xmath303 and call this function the @xmath109-system ( of partial solutions ) determined by @xmath29 .",
    "since @xmath29 is subdirect then for all @xmath5 , @xmath303 will be a subdirect product of the algebras @xmath245 , for @xmath304 .",
    "we wish to consider the situation in which some @xmath245 , say @xmath246 , has a proper jnsson  ideal @xmath305 .",
    "the main result of this subsection is that if the scopes of the constraints of @xmath29 all have size at most @xmath109 ( and hence exactly @xmath109 ) , or if @xmath306 then we can reduce the question of the solvability of @xmath29 to the solvability of a @xmath109-minimal instance with @xmath246 replaced by @xmath305 .",
    "doing so will allow us to proceed by induction to reduce our original instance down to one whose domains are all jnsson  trivial .",
    "so , let @xmath305 be a proper non - empty jnsson  ideal of @xmath246 and define @xmath307 to be the following function on the set of @xmath109-element subsets of @xmath110 :    * if @xmath5 is a @xmath109-element set that includes 1 then define @xmath308 to be @xmath309 . * if @xmath310 , define @xmath308 to be the set of all @xmath311 such that for all @xmath304 the restriction of @xmath1 to @xmath312 can be extended to an element of @xmath313 .",
    "[ gamma_j ] if @xmath244 then    1 .",
    "@xmath308 is non - empty for all @xmath5 and if @xmath314 then the projection of @xmath308 onto the first coordinate is equal to @xmath305 .",
    "2 .   for @xmath5 , @xmath301 , @xmath109-element subsets of @xmath110 , @xmath315 .",
    "since @xmath29 is subdirect then for any @xmath109-element set @xmath5 with @xmath316 we have that @xmath308 is non - empty and projects onto @xmath305 in the first coordinate .",
    "let @xmath5 be some @xmath109-element set of coordinates with @xmath310 .",
    "for ease of notation , we may assume that @xmath317 .",
    "let @xmath318 be any member of @xmath319 .",
    "we will show that there is some @xmath320 such that @xmath321 .",
    "this will not only show that @xmath308 is non - empty , but will also allow us to easily establish condition ( 2 ) of the lemma .",
    "we construct the element @xmath322 as follows .",
    "since @xmath103 is the @xmath109-system for @xmath29 then there is some element @xmath323 such that @xmath324 .",
    "furthermore , there is some @xmath325 such that @xmath326 and then some @xmath327 with @xmath328 . similarly , there are @xmath329 and @xmath330 with @xmath331 and @xmath332 .",
    "let @xmath333 . by applying @xmath334 to the tuples @xmath335 , @xmath336 and @xmath337",
    "we see that the tuple @xmath338 .    we now need to show that for all @xmath339 there is some @xmath340 with @xmath341 there are a number of cases to consider .    * if @xmath342 then the tuple @xmath343 extends to @xmath344 , a member of @xmath345 , as required . * if @xmath346 : there are @xmath347 and @xmath261 with @xmath348 and @xmath349 in @xmath350 . applying @xmath334 to these tuples and the tuple @xmath351 ( in the second variable ) produces the tuple @xmath352 .",
    "since @xmath353 and @xmath305 is a jnsson  ideal , then @xmath354 and so this tuple belongs to @xmath355 , as required . * if @xmath356 or @xmath357 then small variations of the previous argument will work .    to complete the proof of this lemma we need to establish the compatibility of @xmath307 on overlapping elements of its domain",
    "let @xmath5 and @xmath358 be distinct members of the domain of @xmath307 with non - empty intersection @xmath359 and let @xmath360 and @xmath361 .",
    "let @xmath362 and let @xmath363 be the projection of @xmath1 onto the coordinates in @xmath359 .",
    "the restriction of @xmath1 to @xmath364 extends to an element @xmath365 .",
    "since @xmath103 is the @xmath109-system for @xmath29 , the restriction of @xmath366 to @xmath367 extends to an element @xmath368 of @xmath369 .",
    "note that @xmath370 and the restriction of @xmath371 to @xmath359 is @xmath363 . by the first part of this proof",
    ", it follows that the restriction of @xmath371 to @xmath372 extends to an element @xmath373 of @xmath374 as required .",
    "[ local ] if all of the constraints of @xmath29 have scopes of size @xmath109 then there is a @xmath109-minimal instance @xmath375 of the constraint satisfaction problem over the domains @xmath376 and the @xmath245 , for @xmath377 , whose constraint relations are all non - empty and whose solution set is contained in the solution set of @xmath29 .",
    "it follows from our assumptions on the sizes of the scopes of the constraints of @xmath29 that the constraints can be indexed by the @xmath109-element subsets of @xmath378 and that for such a subset @xmath5 , the constraint @xmath379 is of the form @xmath380 where @xmath381 is a subdirect product of the algebras @xmath245 , for @xmath304 .",
    "we set @xmath375 to be the instance of the csp over the domains @xmath382 and the @xmath245 , for @xmath377 , that has , for each @xmath109-element subset @xmath5 of @xmath110 , the constraint @xmath383 , where @xmath384 .",
    "it follows by construction and from the previous lemma that @xmath375 is a @xmath109-minimal instance of the csp whose constraint relations are all non - empty and whose solutions are also solutions of @xmath29 .",
    "the previous corollary can be used to establish the tractability of the constraint languages arising from finite members of @xmath129 , while the following lemma will be used to prove that these languages are in fact globally tractable .",
    "[ jon - reduction ] assume that @xmath306 and let @xmath385 be a constraint of @xmath29 .",
    "then there is a subuniverse @xmath386 of @xmath12 such that for all @xmath109-element subsets @xmath5 of @xmath13 , the projection of @xmath12 onto @xmath5 is equal to @xmath308 .    for @xmath301 a subset of @xmath13 and @xmath387",
    ", we will say that @xmath1 is reduced over @xmath301 if for all @xmath388-element subsets @xmath5 of @xmath301 , the restriction of @xmath1 to @xmath5 can be extended to an element of @xmath389 .",
    "we define @xmath386 to be the set of all tuples @xmath387 that are reduced over @xmath13 .",
    "@xmath386 is also equal to all elements @xmath1 of @xmath12 such that for all @xmath109-element subsets @xmath5 of @xmath13 , the restriction of @xmath1 to @xmath5 is in @xmath308 .",
    "@xmath386 is naturally a subuniverse of @xmath12 and so the challenge is to show that it satisfies the conditions of the lemma .",
    "our proof breaks into two cases , depending on whether or not the coordinate 1 is in @xmath13 .",
    "suppose that @xmath390 .",
    "we may assume that @xmath391 for some @xmath392 .",
    "we need to show that if @xmath5 is a @xmath109 element subset of @xmath13 and @xmath362 then there is some @xmath393 whose restriction to @xmath5 is @xmath1 .",
    "first consider the sub - case where @xmath314 . if @xmath394 then by the @xmath109-minimality of @xmath29 there is some",
    "@xmath395 whose restriction to @xmath5 is @xmath1 . since @xmath396 it follows that @xmath373 is in @xmath386 , as required .    now , suppose that @xmath310 and assume that @xmath397 . by the @xmath109-minimality of @xmath29 there is some @xmath398 whose restriction to @xmath5 is @xmath399 .",
    "for each @xmath339 there is some @xmath400 and some @xmath401 such that @xmath402 and such that the restrictions of @xmath403 and @xmath1 to @xmath364 are the same .    since @xmath404 it follows from the pigeonhole principle that there are @xmath405 with @xmath406 .",
    "we may assume that @xmath346 and @xmath407 and set @xmath408 .",
    "define @xmath373 to be @xmath409 .",
    "this element belongs to @xmath12 and satisfies : @xmath410 and the restriction of @xmath373 to @xmath5 is @xmath1 . to establish this equality over coordinate 2",
    "we make use of the identity @xmath411 and over coordinate 3 @xmath412 .",
    "finally , @xmath373 is in @xmath386 since @xmath413 .    for the remaining case , assume that @xmath414 , say @xmath415 .",
    "we will show by induction on @xmath416 that if @xmath417 , @xmath301 is a subset of @xmath418 of size @xmath416 and @xmath387 is reduced over @xmath301 then if @xmath419 there is some @xmath395 that is reduced over @xmath420 and such that @xmath421 .",
    "a consequence of this claim is that for any @xmath109-element subset @xmath5 of @xmath13 , any element of @xmath308 can be extended to a member of @xmath386 . from this",
    ", the lemma follows .",
    "lemma [ gamma_j ] establishes the base of this induction .",
    "assume the induction hypothesis holds for @xmath422 and let @xmath301 be a subset of @xmath418 of size @xmath423 . by symmetry , we may assume that @xmath424 .",
    "let @xmath387 be reduced over @xmath301 .",
    "we will show that there is some @xmath425 which equals @xmath1 over @xmath301 and is reduced over @xmath426 .    by the induction hypothesis , for each @xmath427 there is some @xmath88 such that the projections of @xmath1 and @xmath428 onto @xmath429 are the same and @xmath428 is reduced over @xmath430 . by the pigeonhole principle it follows that there is some @xmath431 and a set @xmath432 contained in @xmath301 of size at least @xmath433 such that for @xmath434 , @xmath435 .",
    "let @xmath10 and @xmath436 be distinct members of @xmath432 and let @xmath366 be the element @xmath437 of @xmath12 .",
    "note that over the coordinates in @xmath301 , @xmath366 and @xmath1 are equal and that at @xmath438 , @xmath366 equals @xmath439 , where @xmath440 .",
    "we claim that @xmath366 is reduced over @xmath441 . to establish this we need to show that over any subset @xmath442 of @xmath443 of size @xmath444 , the restriction to @xmath442 of @xmath366 can be extended to a member of @xmath445 .",
    "when @xmath442 avoids the coordinate @xmath438 there is nothing to do , since @xmath1 is reduced over @xmath301 .",
    "so , assume that @xmath442 contains @xmath438 and let @xmath446 be an extension to some element in @xmath447 of the restriction of @xmath1 to @xmath442 .",
    "since for each @xmath448 the element @xmath449 is reduced over @xmath450 then there is a member @xmath451 of @xmath452 whose restriction to @xmath453 is equal to the restriction of @xmath449 over this set .",
    "if there is some @xmath454 then the element @xmath455 witnesses that the restriction of @xmath366 to @xmath442 can be extended as desired .    if , on the other hand , @xmath456 then choose two elements @xmath457 and @xmath458 of @xmath432 such that @xmath459",
    "an application of the pigeonhole principle ensures the existence of these elements since @xmath460 .",
    "then , the element @xmath461 and its restriction to @xmath442 is equal the restriction of @xmath366 on @xmath442 .",
    "[ global ] if @xmath306 then there is a @xmath109-minimal instance @xmath375 of the constraint satisfaction problem over @xmath376 and the @xmath245 , for @xmath462 , whose constraint relations are all non - empty and whose solution set is contained in the solution set of @xmath29 .    from the preceding lemma it follows that the instance @xmath375 over the domains @xmath382 and the @xmath245 , for @xmath463 , with constraints @xmath464 , for each constraint @xmath465 of @xmath29 , is @xmath109-minimal and has all of its constraint relations non - empty .",
    "since the constraint relations of @xmath375 are subsets of the corresponding constraint relations of @xmath29 then the result follows .",
    "[ jon - trivial ] let @xmath466 be a sequence of finite algebras from @xmath129 and let @xmath36 be a @xmath109-minimal instance of the csp whose constraint relations are non - empty . if @xmath244 and the sizes of the scopes of the constraints of @xmath29 are bounded by @xmath109 or if @xmath306 , where @xmath467 , then there is a subdirect @xmath109-minimal instance @xmath119 of the csp over jnsson  trivial subalgebras of the @xmath245 such that the constraint relations of @xmath119 are non - empty and the solution set of @xmath119 is contained in the solution set of @xmath29 .",
    "this theorem is proved by repeated application of corollaries [ local ] and [ global ] .      in this subsection",
    "we show , for @xmath244 , how to reduce a @xmath109-minimal instance of the csp whose domains are jnsson  trivial members of @xmath129 and whose constraint relations are all non - empty to one which has in addition , domains that are simple algebras .",
    "our development closely follows parts of the proof of theorem 3.1 in @xcite .",
    "let @xmath245 , @xmath89 , be similar algebras and let @xmath468 be a sequence of congruences @xmath469 .    1 .",
    "@xmath470 denotes the congruence on @xmath471 that identifies two @xmath85-tuples @xmath1 and @xmath373 if and only if @xmath472 for all @xmath10 .",
    "2 .   if @xmath5 is a subset of @xmath473 and @xmath474 is a subalgebra of @xmath475 then @xmath476 denotes the quotient of @xmath474 by the restriction of the congruence @xmath477 to @xmath12 .",
    "let @xmath297 be a sequence of finite , jnsson  trivial members of @xmath129 and let @xmath36 be a subdirect , @xmath109-minimal instance of the csp whose constraint relations are all non - empty .",
    "let @xmath478 where , for @xmath89 , @xmath300 for some subset @xmath39 of @xmath6 and some subuniverse @xmath28 of @xmath479 .",
    "suppose that one of the @xmath245 is not simple , say for @xmath480 , and let @xmath481 be a maximal proper congruence of @xmath246 .",
    "recall that for @xmath482 , @xmath48 denotes the set of partial solutions of @xmath29 over the variables @xmath5 . if @xmath483 then since @xmath29 is @xmath109-minimal , @xmath48 is non - empty and is a subdirect subuniverse of @xmath475 .",
    "since the algebra @xmath484 is a simple , jnsson  trivial algebra then it follows by lemma [ connected_simple ] that for @xmath377 , @xmath485 is either the graph of a homomorphism @xmath486 from @xmath245 onto @xmath484 or is equal to @xmath487 .",
    "let @xmath488 consist of @xmath489 along with the set of all @xmath10 for which the former holds .",
    "for @xmath463 , let @xmath490 be the kernel of the map @xmath486 if @xmath491 , and @xmath492 otherwise .",
    "let @xmath493 and set @xmath494 where @xmath495 and @xmath496 consists of the constraints @xmath497 , for @xmath498 .",
    "note that since @xmath29 is subdirect and @xmath109-minimal then so is @xmath499 and that each @xmath500 is jnsson  trivial , since this property is preserved by taking quotients .",
    "[ pullback ] if the instance @xmath499 has a solution , then there is some @xmath109-minimal instance @xmath49 such that    * @xmath501 , where for each @xmath502 , @xmath503 a subalgebra of @xmath245 .",
    "* @xmath504 is a proper subset of @xmath505 , * @xmath506 where , for each @xmath89 , @xmath507 for some non - empty subuniverse @xmath508 of @xmath28 .",
    "hence , any solution of @xmath119 is a solution of @xmath29 .",
    "let @xmath509 be a solution of @xmath499 .",
    "we can regard each @xmath510 as a congruence block of @xmath490 and hence as a subuniverse of @xmath245 . for @xmath511 , define @xmath503 to be the subalgebra of @xmath245 with universe @xmath510 and for @xmath512 , set @xmath513 . for @xmath514 ,",
    "let @xmath515    we now set out to prove that the instance @xmath49 has the desired properties . since @xmath516 is a proper congruence of @xmath246 then @xmath517 is a proper subset of @xmath505 and so @xmath518 is properly contained in @xmath505 .",
    "since @xmath509 is a solution to @xmath499 it follows that for @xmath514 , @xmath519 is a non - empty subuniverse of @xmath520 .",
    "we need only verify that @xmath119 is @xmath109-minimal , so let @xmath521 and @xmath5 be some subset of @xmath522 of size at most @xmath109 . to establish that @xmath523 it will suffice to show that @xmath524 for all @xmath10 , since @xmath29 is @xmath109-minimal .    by the definition of @xmath508 it is immediate that the relation on the left of the equality sign is contained in that on the right . in the case that @xmath525",
    "the other inclusion is also clear .    if @xmath526 we have that @xmath527 is a subdirect product of simple , jnsson  trivial algebras that are all isomorphic to @xmath484 . since the projection of this subdirect product onto any two coordinates in @xmath528 is equal to the graph of a bijection then in fact",
    ", the entire subdirect product is isomorphic to @xmath484 in a natural way ( using the bijections @xmath486 from the definition of @xmath488 ) .",
    "then , using lemma [ full - product ] and the definition of @xmath488 ( or more precisely , the complement of @xmath488 ) , we conclude that @xmath529 is isomorphic to @xmath530 , where @xmath531 .    now",
    ", suppose that @xmath532 .",
    "then there is some @xmath533 with @xmath534 .",
    "if @xmath535 then , by the concluding remark of the previous paragraph , @xmath536 and hence @xmath537 can be extended to an element of @xmath28 that lies in @xmath538 ( here we use the fact that we have a solution of @xmath499 to work with ) .",
    "this establishes that , in this case , @xmath539 .",
    "finally , suppose that for some @xmath329 we have @xmath540 .",
    "the vector @xmath373 from @xmath28 that projects onto @xmath1 over @xmath5 has the property that @xmath541 ( since @xmath1 does ) .",
    "the structure of @xmath542 worked out earlier implies that @xmath543 for all @xmath544 since @xmath545 is a solution to @xmath499 . from this",
    "we conclude that @xmath546 , as required .",
    "in the preceding section we established techniques for reducing @xmath109-minimal instances of the csp over domains from @xmath129 to more manageable instances . the following theorem employs these techniques to establish the finite relational width of constraint languages arising from finite algebras in @xmath128 .",
    "let @xmath57 be a finite algebra in @xmath128 .",
    "then @xmath57 has term operations @xmath547 and @xmath548 that satisfy the equations : @xmath549    recall that associated with @xmath57 is the constraint language @xmath550 , consisting of all relations invariant under the basic operations of @xmath57 .",
    "[ main - result ] if @xmath33 is a subset of @xmath100 whose relations all have arity @xmath109 or less , for some @xmath244 , then @xmath33 has relational width @xmath109 . in any case , if @xmath551 then @xmath100 has relational width @xmath433 .",
    "if @xmath33 is a finite subset of @xmath100 then @xmath33 is tractable and is of bounded width in the sense of feder - vardi .",
    "furthermore , @xmath100 is globally tractable .",
    "( of the theorem ) we may assume that @xmath552 , where @xmath553 and @xmath554 for all @xmath133 , @xmath555 , @xmath556 since if we can establish the theorem for this sort of algebra , it will then apply to all algebras with universe @xmath14 that have the @xmath557 as term operations .    our assumption on @xmath57 places it in the variety @xmath129 and",
    "so the results from the previous section apply .",
    "let @xmath33 be a subset of @xmath100 .",
    "if @xmath33 is finite , let @xmath109 be the maximum of 3 and the arities of the relations in @xmath33 and replace @xmath33 by @xmath558 , the set of all relations in @xmath100 of arity @xmath109 or less . establishing relational width @xmath109 for this enlarged @xmath33 will , of course , be a stronger result . if @xmath33 is not finite , replace it by @xmath100 and set @xmath559 .",
    "we will show that in either case , @xmath33 has relational width @xmath109 .    from statements ( 5 ) or ( 6 ) of proposition [ width - prop ] it will suffice to show that if @xmath29 is a @xmath109-minimal instance of @xmath560 whose constraint relations are all non - empty then @xmath29 has a solution .",
    "we may express @xmath29 in the form @xmath561 where @xmath562 is a sequence of length @xmath0 , for some @xmath563 , and where @xmath564 is a set of constraints of the form @xmath565 , for some non - empty subset @xmath13 of @xmath6 and some non - empty subuniverse @xmath12 of @xmath566 .    in order to apply the results from the previous section as seamlessly as possible ,",
    "we enlarge our language @xmath33 to a closely related , but larger , multi - sorted language .",
    "let @xmath567 be the set of all quotients of subalgebras of @xmath57 .",
    "note that @xmath567 is finite and all algebras in it have size at most @xmath568 . if @xmath569 , replace it with the set of all subuniverses of @xmath436-fold products of algebras from @xmath567 , for all @xmath570 , and otherwise , replace it by the set of all subuniverses of finite products of algebras from @xmath567 .",
    "in both cases , we have extended our original constraint language .",
    "@xmath29 can now be viewed as a @xmath109-minimal instance of @xmath560 , the class of multi - sorted csps whose instances have domains from @xmath567 and whose constraint relations are from @xmath33 .",
    "we now prove that every @xmath109-minimal instance of @xmath560 whose constraint relations are non - empty has a solution .",
    "if this is not so , let @xmath432 be a counter - example such that the sum of the sizes of the domains of @xmath432 is as small as possible .",
    "note that independent of this size , no domain of @xmath432 is bigger than @xmath568 since they all come from @xmath567 .",
    "also note that @xmath432 must be subdirect .    from theorem [ jon - trivial ]",
    "it follows that all of the domains of @xmath432 are jnsson  trivial .",
    "then , from lemma [ pullback ] we can deduce that all of the domains of @xmath432 are simple .",
    "if not , then either there is a proper quotient of @xmath432 that is @xmath109-minimal and that does not have a solution , or the @xmath109-minimal instance produced by the lemma can not have a solution . in either case",
    ", we contradict the minimality of @xmath432 .",
    "thus @xmath432 is a subdirect , @xmath109-minimal instance of @xmath560 whose domains are all simple and jnsson  trivial and whose constraint relations are all non - empty . from theorem [ induction - base ] we conclude that in fact @xmath432 has a solution .",
    "this contradiction completes the proof of the theorem .",
    "the main result of this paper establishes that for certain constraint languages @xmath33 that arise from finite algebras that generate congruence distributive varieties , the problem class @xmath560 is tractable .",
    "this class of constraint languages includes those that are compatible with a majority operation but also includes some languages that were not previously known to be tractable .",
    "we feel that the proof techniques employed in this paper may be useful in extending our results to include all constraint languages that arise from finite algebras that generate congruence distributive varieties and perhaps beyond .",
    "extend the algebraic tools developed to handle algebras in @xmath128 to algebras in @xmath571 for any @xmath572 .",
    "in particular , generalize the notion of a jnsson  ideal to this wider setting .",
    "we note that in @xcite some initial success at extending the notion of a jnsson  ideal has been obtained .",
    "the bound on relational width established for the languages addressed in this paper seems to depend on the size of the underlying domain of the language .",
    "nevertheless , we are not aware of any constraint language that has finite relational width that is not of relational width 3 .    for each @xmath572 ,",
    "produce a constraint language @xmath573 that has relational width @xmath0 and not @xmath574 . as a strengthening of this problem , find @xmath573 that in addition have compatible near unanimity operations .",
    "the first author acknowledges the support of the hungarian national foundation for scientific research ( otka ) , grants no .",
    "t043671 and t043034 , while the second , the support of the natural sciences and engineering research council of canada .",
    "support of the isaac newton institute for mathematical sciences and the organizers of the logic and algorithms programme is also gratefully acknowledged .",
    "andrei bulatov .",
    "tractable conservative constraint satisfaction problems . in phokion",
    "g. kolaitis , editor , _ proceedings of the eighteenth annual ieee symp . on logic in computer science , lics 2003 _ , pages 321330 .",
    "ieee computer society press , june 2003 .",
    "andrei bulatov . a graph of a relational structure and constraint satisfaction problems . in _ proceedings of the 19th annual ieee symposium on logic in computer science , 2004 _ , pages 448457 .",
    "ieee , 2004 .",
    "victor dalmau .",
    "generalized majority - minority operations are tractable . in prakash",
    "panangaden , editor , _ proceedings of the twentieth annual ieee symp . on logic in computer science , lics 2005 _ , pages 438447 .",
    "ieee computer society press , june 2005 .",
    "toms feder and moshe  y. vardi .",
    "monotone monadic snp and constraint satisfaction . in _",
    "stoc 93 : proceedings of the twenty - fifth annual acm symposium on theory of computing _ , pages 612622 , new york , ny , usa , 1993 .",
    "acm press .",
    "thomas  j. schaefer .",
    "the complexity of satisfiability problems . in",
    "_ conference record of the tenth annual acm symposium on theory of computing ( san diego , calif . , 1978 )",
    "_ , pages 216226 .",
    "acm , new york , 1978 ."
  ],
  "abstract_text": [
    "<S> constraint languages that arise from finite algebras have recently been an object of study , especially in connection with the dichotomy conjecture of feder and vardi . an important class of algebras are those that generate congruence distributive varieties and included among this class are lattices , and more generally , those algebras that have near - unanimity term operations . </S>",
    "<S> an algebra will generate a congruence distributive variety if and only if it has a sequence of ternary term operations , called jnsson terms , that satisfy certain equations .    </S>",
    "<S> we prove that constraint languages consisting of relations that are invariant under a short sequence of jnsson terms are tractable by showing that such languages have bounded relational width . </S>"
  ]
}