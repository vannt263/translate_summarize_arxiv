{
  "article_text": [
    "recently a variety of classical field methods have become popular in the description of ultra - cold bose gases @xcite .",
    "the appeal of these methods is that the dynamics of the modes are treated non - perturbatively so that non - equilibrium situations ( e.g.  see @xcite ) or strongly fluctuating equilibrium systems ( e.g.  see @xcite ) can be accurately simulated .    in refs .",
    "@xcite we have developed a classical field theory , known as the projected gross pitaevskii equation ( pgpe ) formalism , to describe the finite temperature bose gas . this approach has found good agreement with experiment in the critical region of the condensation transition @xcite , and has seen numerous applications to regimes where traditional meanfield methods are inapplicable ( e.g.  see @xcite ) . a key component of our theory ( and the primary distinction from other finite temperature classical field theories @xcite ) that enables it to be applied to the quantitative description of experiments is the use of a projector , i.e. the explicit restriction of our description to the low energy modes of the system . for typical regimes of interest of order a thousand modes of the system",
    "are sufficiently highly occupied to be treated using a classical field approach @xcite .    over the past decade",
    "there has been extensive development of techniques for finding ground state solutions to the gross - pitaevskii equation and algorithms for evolving the condensate .",
    "the basic premise here is that the system is at zero temperature so that a single mode of the system is occupied and the underlying basis states used for the simulation are unimportant as long as they span the condensate . as such , in general these methods are not immediately applicable to the finite temperature case .    in ref .",
    "@xcite we have outlined a theoretical scheme for simulating a finite temperature trapped bose gas . in this paper",
    "we present our algorithm for that case as well as the uniform system , and discuss the techniques we use to initialize and analyze pgpe simulations . as the typical usage of the pgpe formalism",
    "is far removed from the well - known zero temperature gross - pitaevskii equation ( used to describe pure condensate dynamics ) , we use the results section to present a detailed example of application and analysis for the technique .",
    "this should be of benefit for others in the community wishing to adopt these techniques and also provides thermal quantities for comparison that arise from well - characterized simulations .",
    "an important result we present is a demonstration of irreversible behavior of the trapped pgpe , giving evidence for re - thermalization of this system .",
    "the outline of this paper is as follows . in the remainder of this section",
    "we briefly introduce the pgpe evolution equation . in sec .",
    "[ formalalgorithm ] we set up a convenient set of units and outline our generic spectral approach to solving the pgpe equation in a finite basis .",
    "the details of implementing the algorithm are first presented for a uniform system in sec .",
    "[ secnumunifo ] . in this case",
    "the modes are plane - wave - like and the algorithm can be efficiently implemented using fourier transforms . in sec .",
    "[ sec : numharm ] the main result of the paper is presented : an implementation for the experimentally relevant case of a harmonically trapped system . here the natural modes to work in are the harmonic oscillator eigenstates , and we show that a finite number of such modes can be propagated accurately and efficiently using appropriate quadrature grids to evaluate the nonlinear matrix elements .",
    "results for the finite temperature evolution of a harmonically trapped system are presented in sec .",
    "[ results ] before we conclude .",
    "the pgpe is a time - dependent nonlinear schrdinger equation of the form @xcite : @xmath0 where @xmath1 @xmath2 is the single particle hamiltonian , which includes the dominant @xmath3 part and we allow for a ( small ) perturbation part @xmath4 , @xmath5 is the classical matter wave field ( taken to be normalized to unity ) , @xmath6 is the total number of atoms described by the pgpe , @xmath7 is the external trapping potential , and @xmath8 , with @xmath9 the s - wave scattering length .",
    "the numerical implementation of the pgpe formalism poses a rather interesting challenge : formally only the low energy modes of the system are classical ( i.e. the classical region shown schematically in fig .",
    "[ fig : classicalregion ] @xcite ) and should be the only modes retained in the numerical description , a restriction expressed formally by the projector @xmath10 where @xmath11 are eigenstates of @xmath12 and the summation is restricted to modes in the classical region . the action of @xmath13 in eq .",
    "( [ eq : projector ] ) is thus to project the arbitrary function @xmath14 into the classical region ( @xmath15 ) , which we take to be defined by the single particle eigenstates up to some specified ( single particle ) energy @xmath16 . for a full description of the system dynamics",
    "we will require a means of simulating the incoherent region ( i.e. the modes complementary to the classical region ",
    "see fig .",
    "[ fig : classicalregion ] ) and a means to couple the two regions .",
    "a theoretical formalism for doing this has been presented in ref .",
    "@xcite , but has yet to be fully implemented numerically . however , the purpose of this paper is to present our approach for efficiently and accurately simulating eq .",
    "( [ eq : pgpe ] ) for the experimentally relevant case of a harmonic oscillator external potential .",
    "the modes of the system are of central importance in the implementation of the pgpe and care must be taken in numerical implementations to ensure the modes are faithfully represented .",
    "any useful simulation technique must satisfy the following requirements .    *",
    "the space spanned by the modes of the simulation should match that of the classical region of the physical system being simulated as closely as possible .",
    "that is , the modes should be the single - particle modes of the system ( i.e. eigenstates of @xmath3 ) up to the prescribed energy cutoff @xmath17 . *",
    "the assumption of high occupancy in all modes necessitates that the numerical scheme must propagate all modes accurately .",
    "most commonly used methods for propagating schrdinger - type equations do not satisfy these requirements ; in particular , many methods do not propagate all modes of the numerical basis faithfully .",
    "this leads to negligible errors if the highest modes are unoccupied , as is the case for the @xmath18 gross - pitaevskii equation .",
    "however , it is clear that methods based on such assumptions will not be appropriate for simulating fields where the dynamics of all the modes are important .",
    "for convenience we present the discussion of our numerical methods in computational units , indicated by tildes .",
    "we do this by introducing appropriate units of distance @xmath19 and time @xmath20 in each of the following sections . and wavevector @xmath21 and hence momentum @xmath22 .",
    "] so for example , our dimensionless distance variable is defined as @xmath23 , dimensionless time is @xmath24 , and classical field @xmath25 .",
    "the coefficient of the nonlinear term in the gross - pitaevskii equation is given by the product @xmath26 .",
    "in dimensionless units we define this as the nonlinearity constant @xmath27 .    adopting computational units",
    ", the projected gross - pitaevskii equation takes the form @xmath28      the projector can be implicitly implemented by restricting the classical field to the modes of interest , i.e. @xmath29 where @xmath30 are the eigenstates of @xmath31 with respective eigenvalue @xmath32 . the projection is effected by limiting the summation indices in eq .",
    "( [ eq : psibasis ] ) to the set of values @xmath33 i.e. the field @xmath34 only contains the modes of interest .",
    "having restricted the modes for the purposes of the projector , we can adopt these modes as our spectral basis and represent their evolution exactly using a galerkin approach ( i.e. projecting eq .",
    "( [ eq : numgpe1 ] ) on to our spectral basis ) .",
    "this leads to an evolution equation for the amplitudes @xmath35,\\label{eq : gpeshobasis}\\end{aligned}\\ ] ] where@xmath36 are the matrix elements of the perturbation potential and nonlinear term respectively .",
    "once all the matrix elements on the right hand side of eq .",
    "( [ eq : gpeshobasis ] ) are evaluated , the evolution of the system can be calculated using numerical algorithms for systems of ordinary differential equations , e.g. the runge - kutta algorithm ( e.g. see @xcite ) . here",
    "we do not concern ourselves with the particular choice of propagation algorithm , but instead focus on evaluating the matrix elements .",
    "we do mention in passing that by moving to an _ interaction picture _ , defined by the transformation @xmath37 ,",
    "the explicit dependence on @xmath38 can be removed from eq .",
    "( [ eq : gpeshobasis ] ) ( also see @xcite ) .",
    "here we consider the numerical description of a bose gas in a cuboid volume with linear dimensions @xmath39 and subject to periodic boundary conditions . to simplify our discussion",
    "we consider the case where @xmath40 so that the 1d basis states ( see below ) are identical in each direction . for a bose gas in a uniform system with periodic boundary conditions the basis hamiltonian takes the form @xmath41 with the boundary conditions , @xmath42 where we have taken @xmath43 as the unit of length and @xmath44 as the unit of time .",
    "the basis states ( eigenstates of @xmath3 ) are separable into 1d eigenstates , i.e. @xmath45 where @xmath46 are the 1d eigenstates of the kinetic energy operator with the wavevectors @xmath47 chosen as harmonics of the perodicity interval , i.e. @xmath48 with @xmath49 an integer , and have respective eigenvalues @xmath50 for clarity we use greek subscripts to label the 1d eigenstates , and note that the classically simulated region limits the values these can take to the set @xmath51 i.e. a sphere of radius @xmath52 in @xmath53-space . for later convenience",
    "we define @xmath54 as the maximum value of @xmath49 that occurs in @xmath15 , i.e. the highest order basis state in each direction . for the planewave case we have @xmath55 .",
    "this means that within the classical region there exists @xmath56 distinct 1d eigenstates ( i.e. @xmath57 ) in each direction ( since @xmath58 $ ] ) , and @xmath59 3d basis states ( @xmath60 ) in the classical region . in what follows",
    ", we will adopt the notation @xmath61 to indicate summations restricted to the classical region , i.e. all triplets of greek indices in @xmath15 .",
    "the nonlinear matrix element ( [ eq : gnl ] ) takes the form @xmath62 substituting the basis expansion for the field , given by eqs .",
    "( [ eq : psibasis ] ) and ( [ eq : pw1dstates ] ) into eq .",
    "( [ eq : gnlpw ] ) gives a series of matrix elements that can be independently integrated over the coordinate directions .",
    "each of these 1d integrals is of the form @xmath63 which the indices in general can take any of the @xmath64 values in the range @xmath65 .",
    "these integrals are in some sense trivial for the planewave case , i.e. @xmath66 , however knowledge of these matrix elements is not sufficient to implement an efficient algorithm , as we discuss below .    expanding the field @xmath67 in eq .",
    "( [ eq : gnlpw ] ) in terms of the basis states , the nonlinear matrix elements can be written as @xmath68 explicitly carrying out the summations in eq .",
    "( [ eq : gnlsum ] ) for all the matrix elements of @xmath69 requires @xmath70 operations , and would be prohibitively slow for any practical calculation .",
    "we now show how a quadrature approach can be used to evaluate these integrals much more efficiently , requiring only @xmath71 operations .",
    "the essence of this approach is to transform the field to a spatial representation where the nonlinear term is local . by choosing the spatial grid as an appropriate quadrature grid",
    ", the matrix elements will still be evaluated exactly .",
    "the basic idea of this approach ( efficient evaluation of nonlinear matrix elements on a spatial grid ) is widely used ( e.g. see @xcite ) , although it is usually implemented in a manner that is not exact .",
    "this is typically an acceptable approximation if the highest energy modes of the system are unoccupied , a luxury not available in the pgpe .    in each spatial dimension , the quadrature grid of interest ( for the uniform case ) consists of @xmath72-points given by @xmath73 with spacing @xmath74 , which spans the spatial region @xmath75 $ ] .",
    "the quadrature expression for an integral of an arbitrary function @xmath76 is @xmath77 where @xmath78 is the weight function , and @xmath79 are the quadrature weights .",
    "formally such a quadrature can be implemented for our planewave case if we take @xmath80 , @xmath81 , @xmath82 and @xmath83 .",
    "the requirement that our quadrature will exactly calculate the nonlinear matrix elements is equivalent to the requirement that the 1d matrix elements ( [ imnrq ] ) are all evaluated exactly , i.e. @xmath84 which holds for the quadrature described above if we take @xmath85 . for what follows",
    "we take @xmath86 .",
    "this quadrature can be applied to the 3d case , so that the nonlinear matrix elements are computed as @xmath87 where @xmath88 , the @xmath89 and @xmath90 grids are taken to be identical to the @xmath91 grid , and the summation over @xmath92 hereafter will be each taken to be over the range of values @xmath93 to @xmath86 .    unless the perturbation potential can be expressed as a superposition of the planewave states ( [ eq : pwstates1d ] ) of maximum wavevector @xmath94 in each direction , the quadrature given above will not be exact for evaluating eq .",
    "( [ eq : fpert ] ) .",
    "however , since the perturbation will normally be small this approximate treatment should be satisfactory , i.e. we will take @xmath95      here we briefly overview how the quadrature described above can be efficiently implemented numerically .",
    "starting from the basis set representation of the field ( i.e. @xmath96 ) at an instant of time @xmath97 , the steps for calculating the matrix elements are as follows :    1 .",
    "the field is transformed to a spatial representation according to @xmath98 where the transformation matrices are defined as the 1d basis states evaluated on the quadrature grid , i.e. @xmath99 2 .",
    "the integrands of the matrix elements ( [ eq : fpert ] ) and ( [ eq : gnl ] ) are then constructed , i.e. @xmath100 3 .",
    "inverse transforming these integrand functions yields the desired matrix elements : @xmath101    the slowest step in this procedure is carrying out the basis transformation ( steps 1 and 3 ) .",
    "the computational cost of this step is @xmath71 when carried out as a series of matrix multiplications .",
    "however , for the planewave case this transformation is equivalent to a fast fourier transformation , which has a computational cost of @xmath102 . in the last step",
    "the transforms to obtain @xmath103 and @xmath104 can be combined into a single transform , i.e. in practice we transform @xmath105 , which yields @xmath106 ( see eq .",
    "( [ eq : gpeshobasis ] ) ) .",
    "we now consider the main subject of this paper : the implementation of the pgpe for the harmonically trapped system , i.e. where @xmath107 in computational units the basis hamiltonian , @xmath108 , takes the form @xmath109 where @xmath110 , @xmath111 , and we have used the harmonic oscillator frequency associated with the @xmath90-direction to define units of length @xmath112 and time @xmath113 . to simplify our discussion of the numerical method , we will take the harmonic trapping potential to be isotropic , i.e. @xmath114 .",
    "this allows us to avoid using cumbersome notation to account for different spectral bases in each direction .",
    "the same decomposition used for the planewave case ( [ eq : pw1dstates ] ) can be applied in the harmonically trapped system if we take @xmath115 to be eigenstates of the 1d harmonic oscillator hamiltonian , i.e.@xmath116\\tilde\\varphi_{\\alpha}(\\tilde x)=\\tilde\\varepsilon_{\\alpha}\\tilde\\varphi_{\\alpha}(\\tilde x),\\label{eq : sho1d}\\ ] ] with eigenvalue @xmath117 , where we have taken @xmath49 to be a non - negative integer .",
    "such spectral representations have been considered previously for the zero - temperature ( non - projected ) gross - pitaevskii equation in refs .",
    "@xcite .",
    "we define @xmath54 as the maximum value of @xmath49 that occurs in @xmath15 , i.e. for the harmonic case @xmath118 .",
    "this means that within the classical region there exists @xmath119 distinct 1d eigenstates ( i.e. @xmath57 ) in each direction ( since @xmath49 takes the values @xmath120 ) , and @xmath121 3d basis states ( @xmath60 ) in the classical region .",
    "we briefly review the properties of the harmonic oscillator states , which we utilize as our spectral basis .",
    "the eigenstates of the 1d single particle hamiltonian ( [ eq : sho1d ] ) are @xmath122 where @xmath123^{-1/2}$ ] is the normalization constant , and @xmath124 is a hermite polynomial of degree @xmath49 , defined by the recurrence relation @xmath125 with @xmath126 and @xmath127 .",
    "the harmonic oscillator states are eigenstates of the fourier transform operator with eigenvalue @xmath128 , i.e. @xmath129 thus knowledge of the basis amplitudes @xmath130 allows us to efficiently and precisely construct the momentum representation of the classical field , i.e. @xmath131      it is useful to consider the so - called _ step operators _ of quantum mechanics , defined as @xmath132 which are mutually adjoint and have the commutation relation @xmath133=1.\\label{eq : acomm}\\ ] ] in a similar manner we can define step operators for the @xmath134 and @xmath135 directions , although for the sake of brevity we avoid doing this here .    applying the step operators to the 1d eigenstates yields",
    "@xmath136 so that the matrix representation of these operators in the spectral basis is@xmath137 most importantly this allows us to represent the operators @xmath138 and @xmath139 in the spectral basis ( exactly ) as@xmath140",
    "so , for example , consider the position expectation of the field , i.e. @xmath141 .",
    "note that this expectation is a quantum mechanical average at time @xmath142 , rather than a thermal ( ensemble / time ) average .",
    "this quantity can be calculated in the spectral basis as @xmath143 where @xmath144 indicates a restricted summation over the variables @xmath145 such that both @xmath146 and @xmath147 lie in @xmath15 .",
    "while this appears to be of computational cost @xmath71 , in fact the sparseness of the underlying step operators means that this operation is @xmath148 .",
    "some care needs to be taken when applying the step operators .",
    "formally , these operators have infinite size matrix representations , whereas our classical field application is intrinsically finite by virtue of the energy cutoff .",
    "an implication of this is that , e.g. the action of the @xmath149 operator will take the highest @xmath91-modes in the classical region onto modes above the cutoff , which would then be lost from our description .",
    "this is a problem when we wish to consider the product of operators and can be avoided by using the commutation relation ( [ eq : acomm ] ) to write operators of interest in a _ normally ordered _ form , whereby lowering operators ( @xmath150 ) occur before raising operators ( @xmath149 ) .",
    "for example , @xmath151,\\end{aligned}\\ ] ] where we have replaced @xmath152 by @xmath153 on the second line according to our normal ordering prescription .",
    "we do not develop these ideas any further here , but emphasize the utility of these results in the analysis of classical field calculations .",
    "many common operators , and hence matrix elements or expectations of interest , can be expressed in terms of products of position and momentum ( derivative ) operators ( e.g. angular momentum @xmath154 ) .",
    "these can be reformulated in terms of the normally ordered step operators that can be applied to the spectral basis as @xmath148 operations , and are exact .",
    "this avoids the @xmath71 cost of transforming to quadrature grids and the associated difficulties of coming up with accurate expressions on such grids for the operators of interest .",
    "the nonlinear matrix element ( [ eq : gnl ] ) takes the form given in eq .",
    "( [ eq : gnlpw ] ) . an important observation made in ref .",
    "@xcite is that these matrix elements can be computed exactly with an appropriately chosen gauss - hermite quadrature . to show this we note that because the harmonic oscillator states are of the form @xmath155 where @xmath124 is a hermite polynomial of degree @xmath49 , the field ( at any instant of time ) can be written as@xmath156 where @xmath157is a polynomial that , as a result of the cutoff , is of maximum degree @xmath158 in the independent variables .",
    "similarly , it follows that because the interaction term ( [ eq : gnl ] ) is fourth order in the field , it can be written in the form@xmath159 where @xmath160 is a polynomial of maximum degree @xmath161 in the independent variables . identifying the exponential term as the usual weight function for gauss - hermite quadrature , the integral can be exactly evaluated using a three - dimensional spatial grid of @xmath162 points ( i.e. @xmath163 points in each direction is integrated exactly using a @xmath6 point quadrature . ] ) , i.e. @xmath164 where @xmath165 and @xmath166 are the @xmath163 roots and weights of the 1d gauss - hermite quadrature with weight function @xmath167 @xcite .",
    "the perturbation potential can be calculated exactly on this grid if it is of the form @xmath168 where @xmath169 is a polynomial of maximum degree @xmath170 in the independent variables . however ,",
    "if we assume the perturbation is small , then it will be permissible to evaluate it approximately on the same quadrature grid used for the nonlinear term .",
    "here we briefly overview how the quadrature described above can be efficiently implemented numerically .",
    "this differs slightly from the planewave case by virtue of the less trivial nature of the quadrature weights and weight functions .",
    "starting from the basis set representation of the field ( i.e. @xmath96 ) at an instant of time @xmath97 , the steps for calculating the matrix elements are as follows :    1 .",
    "we transform the field to a spatial representation according to @xmath171 where the transformation matrices are defined as the 1d basis states evaluated on the quadrature grid , i.e. @xmath172 2 .",
    "the integrands of the matrix elements ( [ eq : fpert ] ) and ( [ eq : gnl ] ) are then constructed as quadratures by appropriately dividing by the weight function and pre - multiplying by the weights , as this corresponds to the polynomial ( @xmath173 ) required for the quadrature ( see eq .",
    "( [ gabc ] ) ) . ] i.e. @xmath174 3 .",
    "inverse transforming these integrand functions yields the desired matrix elements : @xmath175    the slowest step in this procedure is carrying out the basis transformation .",
    "the computational cost of this step is @xmath71 when carried out as a series of matrix multiplications .      for completeness",
    "we describe how the basis transformations can be generalized for use in preparing states in the spectral basis and transforming to position and momentum grids . while being unrelated to propagation , these procedures are part of an essential set of tools for the general application of the method and analysis of results .",
    "frequently we are presented with a field specified in the position basis , i.e. @xmath176 , and need to obtain its spectral representation , i.e. @xmath177 if the modes of the classical region span the function @xmath176 then this procedure provides an exact representation , however , in general the resulting coefficients @xmath178 represent the function projected into the classical region , i.e. , @xmath179 .    in practice",
    "we implement this transform onto the spectral basis in a similar manner to that used in eq .",
    "( [ harmftrans ] ) , i.e. , as @xmath180 where the transformation matrices are defined as the 1d basis states evaluated on the quadrature grid , i.e. , @xmath181 as in eq .",
    "( [ harmu ] but now the quadrature is different to that used to evaluate the nonlinear matrix elements . replacing @xmath182 by @xmath179 in eq .",
    "( [ cposproj ] ) we note that integrand is of the form of a exponential @xmath183 times a polynomial function of maximum degree @xmath163 in each of the coordinates . these integrals are exactly computed in each direction using gauss - hermite quadrature defined for the weight function @xmath184 with @xmath64 roots @xmath165 and weights @xmath166 .",
    "an important aspect of any classical field method is the ability to transform the results to desired grids for analysis and/or visualization .",
    "this is particularly convenient for the spectral representation we have adopted here .",
    "the basic procedure is as indicated in eq .",
    "( [ harm2pos ] ) except that the grid points are now arbitrary and need not be related to any quadrature grid .",
    "taking one direction to have a single point , e.g. , @xmath185 , allows us to take slices of the classical field .    as shown in eq .",
    "( [ eqmtmfield ] ) in the spectral basis there is a simple relationship between the position and momentum representations .",
    "thus to obtain the momentum space field we use @xmath186 as the transformation matrices , i.e. @xmath187      computing column densities is important for modeling ultra - cold bose gases , since this is what is measured in experiments using absorption imaging ( the primary method of analyzing these systems ) .",
    "for example , when the _ in situ _ system is imaged using light propagating along the @xmath90-direction , the observable corresponds to the column density defined as @xmath188 on the other hand , often the trapping potential is turned off and the system is allowed to expand freely before it is imaged .",
    "if the expansion time is sufficiently long the measured signal is related to a momentum space column density , e.g. for imaging along @xmath135 @xmath189 if the imaging direction ( i.e. direction along which we integrate ) corresponds to a coordinate direction the column density can be conveniently and exactly evaluated .",
    "we will consider the case in eq .",
    "( [ coldenz ] ) for definiteness , though the same procedure immediately applies to the momentum case , and for column densities taken along other axes .",
    "we transform the field to a position grid @xmath190 , where the @xmath138 and @xmath134 grids can be chosen arbitrarily , but the @xmath135 grid needs to be a @xmath64 point quadrature grid of the type discussed below eq .",
    "( [ tranfca ] ) .",
    "this choice for the @xmath135 grid ensures that @xmath191 exactly computes the @xmath135 integral in eq .",
    "( [ coldenz ] ) where the weights are those described below eq .",
    "( [ tranfca ] ) .",
    "another important term that often needs to be evaluated ( e.g.  see ref .",
    "@xcite ) is the so called three - body term , which can be implemented by adding the term @xmath192 to the right hand side of eq .",
    "( [ eq : numgpe1 ] ) , where @xmath193 characterizes the loss of atoms due to three - body recombination .",
    "generally this process is small in comparison to the two - body interaction term ( of strength @xmath194 ) , and causes the field to lose normalization .    including this term in the evolution equation ( [ eq : gpeshobasis ] ) we obtain @xmath195-\\frac{1}{2}{\\tilde{k}_3}j_n,\\label{eq : gpeshobasis3b}\\ ] ] where we have introduced the matrix element @xmath196 decomposing this into 1d eigenstate basis ( i.e. @xmath197 ) we have that @xmath198 where @xmath199 is a polynomial of maximum degree @xmath200 in the independent variables .    using the same arguments as applied to the normal interaction term ( see sec .",
    "[ oscimatelem ] ) , we can show that this term could be evaluated exactly on a three - dimensional spatial grid consisting of @xmath201 points ( i.e  @xmath202 points along each direction ) using a quadrature appropriate to the weight function @xmath203 in each direction .    however , like the perturbative potential , usually this term has a rather small effect on the dynamics and the additional expense of implementing a special transform to exactly evaluate the @xmath204-matrix elements is unnecessary . in such cases",
    "it should be an acceptable approximation to calculate these matrix elements on the same grids used for the two - body interaction .",
    ".[convtable ] convergence properties of evolution algorithm .",
    "the relative error tolerance , number of steps needed to obtain that error tolerance , and the final error measures @xmath205 and @xmath206 are shown ( see text ) .",
    "simulation with @xmath207 tolerance is used as @xmath208 in measuring error of less accurate calculations . other parameters : @xmath209 ,",
    "@xmath210 , @xmath211 , @xmath212 , @xmath213 and the initial state has energy @xmath214 ( see sec .",
    "[ results ] ) . [ cols=\"<,^,^,^\",options=\"header \" , ]     here we present some evolution convergence results for our algorithm and discuss avenues for future development of pgpe numerics . unlike the zero temperature gross - pitaevskii equation , where convergence can be ensured by increasing the basis size , here such a procedure will increase the classical region size ( number of degrees of freedom ) and hence effect the thermal properties of the system . thus for the pgpe formalism",
    "the essential requirement is that all modes within the classical region are propagated precisely .",
    "we have used an adaptive step runge - kutta - fehlberg algorithm to evolve the classical field equation ( [ eq : gpeshobasis ] ) with a specified relative error tolerance .",
    "since computing the matrix elements for our harmonically trapped algorithm is of computational cost @xmath71 the development of higher order or more efficient propagation algorithms would be desirable ( e.g.  see refs .",
    "@xcite for various algorithms developed for evolving the zero temperature gross - pitaevskii equation ) .",
    "for example , the simulation presented in column ( d ) of figs .",
    "[ fig : denxy]-[fig : dencxy ] has a basis of @xmath215 modes propagated over a time interval of @xmath216 . at a relative tolerance of @xmath217",
    "this simulation took approximately 2hrs and 23 minutes on a 2.66ghz xeon ( woodcrest ) processor , consisting of 61,147 steps including 3,013 failed steps . in table [ convtable ]",
    "we examine the evolution algorithm convergence properties using the two measures @xmath218 i.e.  a difference measure of the final states and the loss in normalization , where @xmath219 are the mode amplitudes at time @xmath142 of a more accurate simulation .    while we have strived to ensure highly accurate time propagation",
    ", statistical mechanical arguments suggest that this may be unnecessary and some additional _ noise _ from imprecise evolution may assist the system explore the ensemble of available states more rapidly , as long as this noise does not effect the constants of motion describing the system . for our evolution",
    "algorithm the normalization of the field is not conserved and anecdotal evidence suggests that monitoring changes in normalization can be used as a summative assessment of the evolution accuracy , e.g.  for the simulation described above the final state normalization was 0.99989 .",
    "here we have considered a spectral cutoff in the _ ideal _ single particle basis , _",
    "i.e_.  harmonic oscillator states .",
    "( we refer readers to ref .",
    "@xcite for a discussion of how numerics can be implemented for a rotating trapped system ) . for sufficiently high energy cutoff",
    ", this basis approximately diagonalizes the many - body problem .",
    "however , for situations requiring lower energy cutoffs ( e.g. when @xmath220 ) , the hartree - fock interacting modes would form a better basis for defining the classical region . since these modes",
    "do not have an associated quadrature , the scheme presented here can not be immediately extended to this regime .",
    "another pathway , which may allow more flexibility in the nature of the cutoff , would be to use a more efficient representation ( e.g.  plane - wave / fourier transform ) and approximately implement the projection .",
    "-plane . row ( a1)-(d1 ) instantaneous position density slices for @xmath221 .",
    "row ( a2)-(d2 ) time - averaged position density slices for @xmath221 . row ( a3)-(d3 )",
    "instantaneous momentum density slices for @xmath222 .",
    "row ( a4)-(d4 ) time - averaged momentum density slices for @xmath222 .",
    "parameters : column ( a1)-(a4 ) @xmath223 , @xmath224 , column ( b1)-(b4 ) @xmath225 , @xmath226 , column ( c1)-(c4 ) @xmath227 , @xmath228 , column ( d1)-(d4 ) @xmath229 , @xmath230 . other parameters : @xmath231 , @xmath211 , @xmath212 and @xmath213 .",
    ", width=307 ]    -plane .",
    "row ( a1)-(d1 ) instantaneous position density slices for @xmath232 . row ( a2)-(d2 )",
    "time - averaged position density slices for @xmath232 .",
    "row ( a3)-(d3 ) instantaneous momentum density slices for @xmath233 . row ( a4)-(d4 )",
    "time - averaged momentum density slices for @xmath233 .",
    "parameters : column ( a1)-(a4 ) @xmath223 , @xmath224 , column ( b1)-(b4 ) @xmath225 , @xmath226 , column ( c1)-(c4 ) @xmath227 , @xmath228 , column ( d1)-(d4 ) @xmath229 , @xmath230 . other parameters : @xmath231 , @xmath211 , @xmath212 and @xmath213 . , width=307 ]    -axis .",
    "row ( a1)-(d1 ) instantaneous position column densities . row ( a2)-(d2 ) time - averaged position column densities .",
    "row ( a3)-(d3 ) instantaneous momentum column densities .",
    "row ( a4)-(d4 ) time - averaged momentum column densities .",
    "parameters : column ( a1)-(a4 ) @xmath223 , @xmath224 , column ( b1)-(b4 ) @xmath225 , @xmath226 , column ( c1)-(c4 ) @xmath227 , @xmath228 , column ( d1)-(d4 ) @xmath229 , @xmath230 . other parameters : @xmath231 , @xmath211 , @xmath212 and @xmath213 .",
    ", width=307 ]    in this section we consider the application of the pgpe formalism to a harmonically trapped system with a fixed energy cutoff , and take @xmath234 . to elucidate features of our method",
    "we consider an anisotropic harmonic trap with @xmath211 and @xmath212 , i.e. the system has a _ fat pancake _ geometry with the @xmath91-direction being tightly confined .",
    "taking @xmath213 there are @xmath215 single particle modes in the classical region with the maximum order of eigenstate occurring in each coordinate direction being @xmath235 , @xmath236 , and @xmath237 .",
    "the pgpe is ergodic and the generic method to study finite temperature regimes is to begin with a randomized initial state with some definite energy , @xmath238 , as quantified by the energy functional @xmath239 = \\int d^3\\tilde{\\mathbf{x}}\\,\\tilde{\\psi}^*\\left\\ { \\tilde h_{\\rm sp}+ \\frac{c}{2 } |\\tilde\\psi|^{2}\\right\\}\\tilde\\psi.\\label{eq : numefunc}\\ ] ] this energy is a constant of motion for the pgpe ( [ eq : numgpe1 ] ) and forms a convenient macroscopic constraint for specifying the thermal state of the system .",
    "the procedure for making such energy states is rather arbitrary .",
    "we choose to make use of the thomas - fermi approximation to the ground state of the energy functional , given by @xmath240 where @xmath241 is the unit step function and @xmath242 is the thomas - fermi chemical potential @xcite .",
    "we mix the thomas - fermi state ( projected onto the spectral basis according to the procedure given in sec .",
    "[ sec : harmposproj ] ) with a _ high energy _ randomized state where @xmath243 and @xmath244",
    "are normally distributed random values .",
    "we then normalize this state so that @xmath245 . ] in the appropriate ratio to obtain a normalized state of the desired energy .",
    "such states , for a range of energies , are propagated according to the pgpe for a time period of @xmath246 and @xmath247 states of the field are saved at equally spaced times during the evolution , i.e. at times @xmath248 , with @xmath249 .    due to the stochastic nature of the initial condition for the simulation",
    "the instantaneous behavior of the system is of reduced importance , instead the quantities of interest are the macroscopic observables that can be computed from the system evolution .",
    "we consider a few such observables here , and refer the reader to ref .",
    "@xcite for a more general discussion on this topic .",
    "one observable we will concern ourselves with is the average position density calculated as the time - average @xmath250 where the summation is taken over some subset of @xmath251 saved states .",
    "here we use the last @xmath252 of the saved states for averaging .",
    "we use the first part of the evolution ( i.e. up to @xmath253 ) to allow the arbitrarily chosen initial state to relax to equilibrium , a point we consider further in sec .  [",
    "sec : relax ] .",
    "similarly we can construct the momentum density by time - averaging the fourier transformed classical field ( [ eqmtmfield ] ) .",
    "another quantity of interest is the condensate fraction .",
    "the definition we use was provided by penrose and onsager @xcite , and identifies the condensate fraction @xmath254 as the largest eigenvalue of the one - body density matrix , defined in terms of the field as @xmath255 . in our formalism",
    "this quantity is equivalently and much more efficiently computed in the mode basis as @xmath256 where @xmath257 is evaluated using time - averaging [ e.g. , see eq .",
    "[ psita ] ] .",
    "it is also possible to calculate thermal parameters from the dynamical evolution of the field , such as temperature and chemical potential , and we refer the reader to ref .",
    "@xcite for more details .      our results for the instantaneous and averaged",
    "density profiles are shown in figs .",
    "[ fig : denxy ] and [ fig : denyz ] . in fig .",
    "[ fig : denxy ] the system is viewed in the @xmath258-plane using a @xmath259 slice through the field .",
    "the position space density clearly reveals the anisotropy of the confining potential .",
    "as the energy of the system increases it fluctuates more strongly ( as revealed in the instantaneous density slices ) , however the averaged density profiles change quite gradually .",
    "in contrast , the momentum space density ( shown as @xmath222 slices ) changes much more significantly with system energy . at low energies [ e.g. , fig .",
    "[ fig : denxy](a3 ) and ( a4 ) ] the condensate is prominent in the system , and is easily identified as the dense anisotropic momentum peak centered at zero momentum .",
    "this momentum anisotropy is the opposite of that observed in position space due to the heisenberg relationship between position and momentum size of the condensate wavepacket along each direction .",
    "we also see a background radially symmetric distribution in the averaged momentum density [ e.g. , fig .",
    "[ fig : denxy](a4 ) ] that increases in prominence ( at the expense of the condensate ) as the energy of the system increases [ e.g. , see figures along the row fig .",
    "[ fig : denxy](a4)-(d4 ) ] .",
    "this background constitutes what is usually referred to as the _ thermal cloud _ of the system  or at least the component of this that exists within the classical region . comparing the averaged and respective instantaneous momentum density profiles [ i.e.",
    ", see fig .",
    "[ fig : denxy ] along the rows ( instantaneous ) ( a3)-(d3 ) and ( averaged ) ( a4)-(d4 ) ] we see that the modes contributing to this radially symmetric density fluctuate quite strongly , and adequate time - averaging to obtain their averaged profiles is essential .    in fig .",
    "[ fig : denyz ] the system is viewed in the @xmath260-plane using a @xmath232 slice through the field ( @xmath261=0 slice for the momentum space results ) .",
    "the averaged position and momentum space density are isotropic like the trapping potential in this plane .",
    "these results also allow us to appreciate the role of the classical region cutoff on typical fluctuations in the system .",
    "compare the instantaneous momentum densities in fig .",
    "[ fig : denxy](d3 ) and fig .",
    "[ fig : denyz](d3 ) . in fig .",
    "[ fig : denyz](d3 ) the length scale for fluctuations is the same in the @xmath262 and @xmath263 directions , reflecting the symmetry of the potential . in fig .",
    "[ fig : denxy](d3 ) the length scale for fluctuations is much longer in the @xmath261 direction than in the @xmath262 direction .",
    "we do not see the same features in the position space fluctuations , e.g. in fig .",
    "[ fig : denxy](d1 ) and fig .",
    "[ fig : denyz](d1 ) where the length scales in all directions appear to be similar .",
    "these observations can be explained by a simple argument based on a semiclassical analysis of the single particle hamiltonian ( [ eq : h0harm ] ) : the maximum position extent of the system in the @xmath264-direction is @xmath265 , and using that the number of modes in this direction is @xmath266 , we obtain that the typical fluctuation length scale is @xmath267 , and similarly @xmath268 . ]",
    "i.e. , independent of trap frequency ( i.e. @xmath269 ) in position space . in momentum space",
    "we instead have that the momentum extent of the field , @xmath270 , is independent of the trap frequency , while the length scale for fluctuations @xmath271 is proportional to the trap frequency .",
    "this qualitatively agrees with the observation in fig .",
    "[ fig : denxy](d3 ) that the momentum fluctuation length scale is about 4 times longer in the @xmath261 direction than in the @xmath262 direction .    for comparison with the density slices we have just discussed in fig .",
    "[ fig : dencxy ] we show the instantaneous and time - averaged column densities in position and momentum space . taking the column density in",
    "some sense averages the fluctuations in the instantaneous system state compared to the density slice .",
    "the instantaneous column densities closely approximate the images taken in experiment , and thus the fluctuations seen should be measurable , however we note that our results here exclude the contribution from the incoherent region which in general will be important to include .",
    "finally we consider some dynamical aspects of how a _ distorted _ system , described by the pgpe , returns to an equilibrium state . to do this",
    "we construct two initial states with the same total energy but rather different density distributions .",
    "density slices of these two states are shown in figs .",
    "[ fig : denneq](a ) and ( c ) .",
    "our preparation procedure for those two states is as described before , except that here we choose to use a thomas - fermi state that is distorted so as to be extended along the @xmath138 and @xmath134 directions , respectively . as conjectured earlier , since both states have the same energy they should relax to the same ( dynamical ) equilibrium . in figs .",
    "[ fig : denneq](b ) and ( d ) we show the density slices of these states after propagating the system for @xmath272 ( @xmath135-direction ) trap periods .",
    "the density slices of these final states qualitatively look much more similar to each other than the initial states did , consistent with both systems reaching the same equilibrium .",
    "however , we can provide other evidence for the system returning to equilibrium . in figs .",
    "[ fig : denneq](e ) and ( f ) we examine the position variance of the classical field along the @xmath134 direction defined as @xmath273 i.e.  the quantum mechanical average of the field at time @xmath142 .",
    "this provides a measure of the system width in that direction .",
    "we note that this quantity is efficiently evaluated with the step operator formalism discussed in sec .",
    "[ sec : stepops ] .",
    "[ fig : denneq](e ) reveals that @xmath274 initially shows strong evolution that is characteristic of the initial state being far from equilibrium .",
    "this initial evolution is strikingly different for the two cases reflecting that initial states considered here are respectively compressed [ fig .",
    "[ fig : denneq](a ) ] and extended [ fig .",
    "[ fig : denneq](c ) ] in the @xmath134 direction . after a few trap periods the dynamics of @xmath275",
    "is seen to reduce considerably .    in fig .",
    "[ fig : denneq](f ) we examine dynamics of @xmath275 after the system has relaxed for @xmath276 trap periods .",
    "the fluctuations in @xmath275 are much reduced in amplitude compared to what was observed in the initial evolution .",
    "indeed , the fluctuations here are consistent with thermal fluctuations of the equilibrium state , and it is clear that both initial states considered have relaxed to an equilibrium state with approximately the same average value for @xmath275 .",
    "we also note that both systems end up with approximately the same condensate fraction of @xmath277 , obtained from density matrix calculated by time - averaging states over the last 10 trap periods of the system evolution .",
    "( b ) and ( d ) .",
    "both states have @xmath278 .",
    "the variance of the classical field in the @xmath279-direction ( e ) during the first few trap periods and ( f ) after 10 trap periods . result for initial state ( a ) ( black line ) and initial state ( b ) ( grey line ) .",
    "other parameters : @xmath231 , @xmath211 , @xmath212 and @xmath213 .",
    ", width=307 ]",
    "in this paper we have described an efficient spectral method for solving the projected gross - pitaevskii equation for a bose gas in a harmonic oscillator potential .",
    "we have shown that the nonlinear matrix elements can be calculated exactly using appropriately chosen quadrature grids and have described how this can be implemented as an efficient algorithm .",
    "we have also discussed numerous properties of our approach that allow various observables to be calculated , either in the spectral basis or by making appropriate use of quadrature grids .",
    "finally , we have applied our method to an anisotropic 3d bose gas to indicate typical features of the solutions .",
    "the rather unique requirement of the pgpe is that it needs to be propagated on a small prescribed basis , usually containing of order a thousand modes .",
    "for this reason the additional computational cost of using a spectral method is offset by the rather small basis set size .",
    "however , recently our method has been used to simulate a trapped system with up to @xmath280 modes @xcite , and is reasonably efficient even for larger problems . however , there is much scope for development of the algorithm and we hope that the detailed discussion of numerics and example application in this paper will stimulate others in the community to develop more flexible and general pgpe algorithms    the algorithm outlined in this paper is an important step to realizing a comprehensive theory for simulating the dynamics of a trapped finite temperature bose gas .",
    "the next steps will involve moving beyond the pgpe description to the stochastic gross - pitaevskii equation ( sgpe ) @xcite , which includes the effects of coupling between the classical and incoherent regions .",
    "this theory differs from the pgpe primarily through two new features : ( i ) stochastic noise terms effect the evolution and cause the transfer of particles and energy into and out of the classical region .",
    "these contributions have already been added to the numerical approach outline here @xcite .",
    "( ii ) scattering terms corresponding to collisions between incoherent and classical region atoms that cause the transfer of momentum into the system .",
    "these terms are more challenging to implement and are the subject of current work .",
    "the author acknowledges a long and valuable collaboration with m.  j. davis and many useful discussions with b.  i. schneider , n. nygaard , a.  s. bradley , a.  bezett and t.  p. simula .",
    "this work was financially supported by the marsden fund of new zealand , the university of otago and the new zealand foundation for research science and technology under the contract nerf - uoox0703 : quantum technologies ."
  ],
  "abstract_text": [
    "<S> in this paper we describe a method for evolving the projected gross - pitaevskii equation ( pgpe ) for a bose gas in a harmonic oscillator potential . </S>",
    "<S> the central difficulty in solving this equation is the requirement that the classical field is restricted to a small set of prescribed modes that constitute the low energy classical region of the system . </S>",
    "<S> we present a scheme , using a hermite - polynomial based spectral representation , that precisely implements this mode restriction and allows an efficient and accurate solution of the pgpe . </S>",
    "<S> we show equilibrium and non - equilibrium results from the application of the pgpe to an anisotropic trapped three - dimensional bose gas . </S>"
  ]
}