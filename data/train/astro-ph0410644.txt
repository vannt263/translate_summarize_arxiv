{
  "article_text": [
    "diffuse sources , such as clusters of galaxies , supernova remnants , and the interstellar hot haloes of elliptical galaxies , comprise some of the most interesting targets for astrophysical x - ray spectroscopy .",
    "photons from these sources are focused and dispersed by optics and recorded in detectors designed to measure three interesting quantities : two related to the position on the detector ( @xmath0 , @xmath1 ) and one related to an intrinsic photon energy measurement ( @xmath2 ) .",
    "these quantities are indirectly related to the sky coordinates ( @xmath3 ) and the energy of the incident photon ( @xmath4 ) that can be predicted from an astrophysical model with parameters , \\{@xmath5 , @xmath6 , @xmath7 ,  } @xmath8 @xmath9 .",
    "the fundamental goal of data analysis for diffuse x - ray spectroscopy is to calculate the probability of a given distribution of photons in the ( @xmath0 , @xmath1 , @xmath2 ) data - space given the parameters of a particular astrophysical model .",
    "prior to the launch of the _ chandra _ ( @xcite ) and _ xmm - newton _ ( @xcite ) observatories , available instruments were characterized by sufficiently poor spatial and/or spectral resolution that simple one - dimensional spectral fitting techniques applied to data extracted from the image were sufficient for most applications .",
    "however , the grating experiments and non - dispersive ccd experiments on these two new observatories both have significant imaging and spectral capabilities , making it warranted to develop new techniques that utilize the full dimensionality of the data . in particular , the reflection grating spectrometers ( rgs ) on xmm - newton have a number of unique characteristics that make them powerful x - ray spectrometers for arcminute - size x - ray sources . in this paper",
    ", we demonstrate that the complex nature of the response function for the rgs requires new analysis methods that utilize the full dimensionality of the data .",
    "we also demonstrate how these methods might be useful for other x - ray instruments .",
    "the techniques for analyzing an x - ray spectrum of an unresolved source are well - developed and have been essentially unchanged since the analysis of early x - ray spectra ( @xcite ) .",
    "for that case , there is only one interesting measured quantity that is related to the energy of the photon . for non - dispersive spectrometers ( e.g. ccds , calorimeters , and proportional counters ) , the photon energy measurement ( @xmath2 ) is the useful quantity . for dispersive spectrometers ( e.g. gratings and crystals ) , the dispersion coordinate , @xmath0 , or",
    "the position along the detector parallel to the dispersion axis , is the useful measured value . in either case ,",
    "the detection probability , @xmath10 , of finding a photon at a given @xmath0 or @xmath2 is then given by @xmath11 which is an integral over all energies , @xmath4 . here , r is the response kernel and s is the input spectral model , which is a function of both the energy and the input parameters .",
    "the response kernel describes the probability of obtaining a distribution of measured values given a photon with incident energy , @xmath4 .",
    "the integral is computed numerically by converting the expression into a sum of discrete energies in well - developed software packages , such as xspec ( @xcite ) or spex ( @xcite ) .    for an extended source ,",
    "the probability distribution is described by a three - dimensional function and its calculation requires an integration over both the sky coordinates ( @xmath12 ) and the intrinsic energy ( @xmath4 ) . the three - dimensional detection probability , d ,",
    "is then given by @xmath13 computing this entire integral directly is often impractical .",
    "nevertheless , some approximations can be made that are useful in restricted situations .",
    "in particular , one can assume : 1 ) the source spectrum is independent of spatial position , and 2 ) the response does not vary as function of the off - axis angle .",
    "the problem can then be reduced to a one - dimensional integral , as for a point source .",
    "the former assumption is sometimes justified , but has become untenable in many recent analyses .",
    "for example , modeling an x - ray cluster of galaxies as a thermal plasma whose temperature varies spatially already violates this assumption .",
    "the second assumption depends on the nature of the x - ray instrument as well as the angular scale of the problem being investigated .",
    "attempts to circumvent this problem by weighting the response matrix for chandra acis - s observations can be found in @xcite and in @xcite for xmm - newton epic data .",
    "we demonstrate in  2 that the complex nature of the response function , @xmath14 , for the reflection grating spectrometer makes this approximation impossible to implement without assuming that there is no spectral variation over the entire field of view . instead",
    ", we are forced to consider new methods that consider the full multi - dimensionality of equation 2 .",
    "equation 2 can be evaluated directly through a monte carlo calculation as we will demonstrate in  3 .",
    "it has been known for some time that monte carlo methods are efficient for the evaluation of multi - dimensional integrals ( @xcite ) .",
    "few photons are typically detected in x - ray observations , so the exact calculation of the full integral is superfluous .",
    "after constructing an efficient monte carlo algorithm , we outline a generic approach for the analysis of diffuse x - ray sources with monte carlo calculations in  4 . in  5 ,",
    "we discuss several methods of event comparison that can be used with the photons simulated with the rgs monte carlo and real data . in  6 , we discuss several straightforward extensions to these methods .",
    "the reflection grating spectrometers consist of three instrumental components : the mirror module , the rgs grating array ( rga ) , and the rgs focal plane cameras ( rfc ) .",
    "there are two nearly identical sets of each of the three components .",
    "the full description and calibration of these components has been covered in @xcite and is also documented in the _ xmm users handbook_. we briefly discuss some of the important characteristics of each of the three components for the purpose of data analysis .",
    "the mirror module consists of 58 concentrically - aligned gold - coated mirrors shells .",
    "photons hit each wolter type i shell twice .",
    "the angular resolution is set by surface deformations of the mirrors and the relative alignment of the shells .",
    "the x - rays then arrive at the reflection grating array ( rga ) after exiting the mirror module .",
    "the rga consists of 182 coaligned rectangular reflection gratings .",
    "each grating has many triangular replicated grooves spaced at 645.6 lines per millimeter . on - axis x - rays",
    "hit the grating at 1.57 degrees and are dispersed between 2 and 5 degrees depending on their wavelength .",
    "the gratings are precisely arranged in an array , which is aligned so that all light hits the gratings at the same incidence angle ( @xcite ) .",
    "if @xmath15 is the angle of incidence of a photon , then the exit angle , @xmath16 , is determined by the dispersion equation : @xmath17 where @xmath18 is the grating spacing and @xmath19 is the integer diffraction order .",
    "the derivation of this relation is straightforward through fraunhofer diffraction theory .",
    "the deviation from this ideal relation is not simple , however , because it depends on the alignment of the array , the surface imperfections of the gratings , and the achromatic blurring already induced by the mirror module .",
    "the angle of incidence on the grating , @xmath15 , is related to the off - axis angle relative to the boresight axis , @xmath20 , by @xmath21 where @xmath22 is the distance between the rga and the rfc ( 6.7 m ) and @xmath23 is the focal length of the telescope ( 7.5 m ) . for directions perpendicular to the grooves of the gratings , photons that enter at an angle , @xmath24 , will exit at the same angle , which we will call cross - dispersion and designate by the angle , @xmath1 .",
    "the cross - dispersion equation is then simply , @xmath25 the photons are detected by the rfc .",
    "each rfc consists of 9 back - illuminated ccds placed in a row that detect individual x - rays .",
    "each ccd measures 1024 by 384 pixels , which are 27 microns on a side .",
    "each ccd consists of two nodes where the charge is clocked separately for each .",
    "the intrinsic ccd energy resolution , which is set by the ability to fully sample the energy deposited in the charge cloud , is sufficient to separate the spectral orders for sets of photons .",
    "we would otherwise be left with an ambiguity between wavelength and spectral order .",
    "the gain - corrected pulseheight , @xmath2 , is roughly proportional to the energy , @xmath26 the ccd array is approximately aligned along the roland circle in the rgs design so that the position along the detector array , @xmath0 , is approximately equal to the exit angle for the grating , @xmath16 , after correcting for the relative locations of the individual ccds .",
    "for that reason , we will use @xmath16 and @xmath0 interchangeably .",
    "the reflection grating spectrometers were designed to have relatively high dispersion ( i.e. , large dispersion angles from the focus ) in order to compensate for the fact that the mirrors would blur x - ray sources by 10 arcseconds ( @xcite ) .",
    "the soft x - ray spectrum gets dispersed over an angular range of about 3 degrees .",
    "thus , in principle if the spectral resolution is set mostly by the blurring of the mirror , spectral resolving powers ( @xmath27 ) near 3 degrees/10 arcseconds @xmath28 1000 are possible .",
    "an important aspect of the high dispersion angle capabilities is that x - ray sources with angular sizes of order the 10 arcsecond blurring also benefit from the high spectral resolution .",
    "if an x - ray source is larger than the mirror point - spread - function ( psf ) , then the resolution is obtained by differentiating equation 3 with respect to the off - axis angle , @xmath29 the rgs dispersion therefore has resolving powers 10 times higher than the energy resolution of a typical ccd in the fe l wavelength band for a source of arcminute size .",
    "equation 3 , 4 , 5 , and 6 form the basic _ first - order _ behaviour of the response function for the rgs and equation 7 clearly justifies our use of the rgs with extended sources .",
    "the full response function , however , is far from this simple .",
    "we will later use equations 3 - 6 to interpolate between elements of the complete response function .",
    "the complete response function is composed of a series of two and three dimensional functions .",
    "these functions take into account the relative alignment of the system , the optical scattering properties of the gratings and mirrors , and a model for the conversion and diffusion of charge in the ccds .",
    "the response probability function for the rgs system , @xmath14 , is given by @xmath30 \\times    \\nonumber \\\\    & &   h(p \\vert \\lambda , \\rm{ccd~node } ) \\times i ( \\beta , \\phi)\\end{aligned}\\ ] ] this probability function predicts the distribution of photons with a given @xmath16 , @xmath1 , and @xmath2 given a model that predicts the wavelength , @xmath31 , and angular distribution ( @xmath20 , @xmath24 ) .",
    "here @xmath16 , @xmath1 , and @xmath2 are compared with the event values after they have been corrected for the relative geometry of the ccd locations and the standard gain , offset , and charge transfer inefficiency corrections .",
    "the six functions , @xmath32 , @xmath33 , @xmath34 , @xmath35 , @xmath36 , and @xmath37 , are all either two or three dimensional and have one output variable for either one or two input variables .",
    "the reasons for the particular construction of the rgs response functions is the result of extensive calibration efforts both before and after the launch of the xmm - newton observatory .",
    "a full discussion of the physical theory that is used for the formulation and calibration of the response function is beyond the scope of this paper ( see e.g. @xcite or documentation at http://xmm.astro.columbia.edu ) , but we will briefly describe the purpose and general properties of the six functions below .",
    "@xmath38 and @xmath39 represent the convolution of the instrument response of the mirror shells and gratings together .",
    "@xmath38 encapsulates the dependence of the function perpendicular to the dispersion direction and @xmath39 represents the cross - dispersion dependence .",
    "they are divided in two parts : the small - angle ( sa ) and large - angle ( la ) response .",
    "the small - angle functions represent the unscattered ( coherent ) x - rays .",
    "its width in both the dispersion and cross - dispersion directions is therefore dominated by misalignments of the gratings and mirror shells as well as correlated errors in the grating s groove structure .",
    "the large - angle functions represent the scattered light that exits the gratings at large ( degree - scale ) angles .",
    "the relative normalization between the small - angle and large - angle terms is both wavelength and off - axis angle dependent . generally , the small - angle term is two or three times larger that of the large - angle term .",
    "the pulseheight function , @xmath36 , is the response of the various ccds in the rfc .",
    "a separate response function is calibrated for each ccd as well as for each node of the ccd .",
    "the exposure map , @xmath37 , is used to keep track of where the ccds are located relative to one another as well as to remove locations of the angular space where there are bad pixels or columns .",
    "aspect drift is included in its calculation .",
    "its value is usually either close to one or zero depending on whether there is an active pixel at a given angular position .",
    "in addition to the six functions there is an overall normalization of the total effective area ( units of @xmath40 ) and a total exposure time of a given observation .",
    "the combination of these normalizations , the six functions , and a model spectrum in units of photons per @xmath40 that can vary spatially , can be used to predict a given number of photons at a value of @xmath16 , @xmath1 , and @xmath2 .",
    "we plot two - dimensional slices of these six functions in figures 1 - 6 .",
    "these can be calculated from the science analysis system ( sas ) task * rgsmcrgen * ( a task we designed explicitly for these monte carlo calculations ) for the first five functions and * rgsproc * ( the standard analysis pipeline ) for the exposure map .    for an observation of an unresolved source , the calculations of the response function is straightforward",
    ". the substitution of equation 8 into equation 2 results in a integral relation like that of equation 1 .",
    "this is obtained after integrating over a given pulseheight and cross - dispersion selection .",
    "this integration only has to be performed once during an analysis .",
    "this is routinely done in the science analysis system ( sas ) in the construction of response matrices in the task * rgsrmfgen * ( the standard response generator ) .",
    "then equation 1 can be used in standard response matrix manipulations in software packages , such as xspec .    for a spatially - resolved x - ray source ,",
    "complete integration of equation 2 is unfeasible .",
    "furthermore , additional approximations to reduce the dimensionality of equation 8 are not possible without assuming that the source spectrum does not change as a function of spatial position , the response function does not change significantly at off - axis angles , and the lost events outside of a given pulseheight and cross - dispersion data selection is not significantly different than that of a point source , as we have discussed in  1 .",
    "although those three approximations can been applied in some global analyses of extended sources with the rgs ( see either @xcite ( xspec model rgsxsrc ) or @xcite ( spex function ) ) , we wish to avoid these assumptions in order to allow the spectral model to vary spatially .",
    "this will later give us much more flexibility in astrophysical modeling .",
    "the solution to the general problem presented here is the direct monte carlo integration of equation 2 while using a novel scheme for interpolating between elements of the expression in equation 8 .",
    "we outline this technique as applied to the rgs below .",
    "monte carlo codes have always played an important role in the calibration of x - ray space observatories and in the simulation of complex observations .",
    "however , they have not achieved widespread use in data analysis applications , primarily because of slow computation speeds . here",
    "we describe a method that generates events at rates of @xmath41 to @xmath42 photons per second per ghz of processor speed and apply it to the rgs response functions .",
    "a photon can be generated through probability density functions , like the six functions described in section 2 , in the following way .",
    "let the probability of a photon being detected with an output value , @xmath43 , given some input variable , @xmath44 , be represented by a probability density function , @xmath45 , normalized to unity .",
    "we want to sample this distribution by obtaining a set of events with various values of @xmath43 .",
    "first we calculate the cumulative distribution : @xmath46 . drawing a random number , @xmath47 ,",
    "between 0 and 1 then gives us a photon with a value of @xmath43 where @xmath48 .",
    "photons can also be thrown away in order to maintain the proper normalization if the probability varies as a function of @xmath44 .",
    "we incorporate the above method in a two step process to compute the integral in equation 2 .",
    "first , photons are chosen using the model function , @xmath49 , where the input variables , @xmath44 , are the model parameters and the output variables , @xmath43 , are the photon energy and sky coordinates ( @xmath4 , @xmath20 , @xmath24 ) .",
    "we then use a second monte carlo to predict sets of detector coordinates ( @xmath0 , @xmath1 , @xmath2 ) , using the sets of photon energies and sky coordinates as the input variables , @xmath44 , and involving the response function , @xmath14 , as the multi - dimensional probability distribution .",
    "the detailed implementation of the first step depends greatly on the type of astrophysical model , so we do not attempt to cover all cases here .",
    "the second step involves only the rgs instrument response , however , and is used in the same way for all observations and analyses . in the remainder of this section , we concentrate on ways of maximizing the efficiency of this second step .",
    "the calculation of a single element of the response kernel , @xmath14 , is computationally intensive , since @xmath14 is not described by simple analytic functions as we have discussed in  2 .",
    "the response kernel can be pre - calculated , however , and stored at various grid points .",
    "this improves the speed of photon generation by several orders of magnitude over recalculating the response function for every photon .",
    "the rgs response function , however , contains many three dimensional functions requiring billions of elements at full resolution .      instead of saving the functions in equation 8 in fine grids ,",
    "we save the response kernel on coarse grids and then interpolate between grid points to obtain the intermediate values .",
    "consider first the one - dimensional case , where we want to know the probability response function , @xmath45 , of some variable @xmath43 , at some point , @xmath44 .",
    "assume that the response has been pre - calculated at positions @xmath50 and @xmath51 such that @xmath52 .",
    "the response at position @xmath50 can be used as an approximation for the response at @xmath44 some fraction of the time and the response function at @xmath51 can be used the other fraction of the time .",
    "these fractions are determined by the distance that @xmath44 is from @xmath50 and @xmath51 . a random number , @xmath53 ,",
    "is generated to determine which function to use .",
    "the response at @xmath50 is used if @xmath53 is greater than @xmath54 . in this way",
    ", the intermediate probability function becomes a linear combination of the probability function at the two grid points after many photons are generated .",
    "this procedure is illustrated schematically in the top panel in figure 7 .",
    "an additional step is needed if the response functions have sharp peaks that shift as a function of @xmath44 .",
    "this is clearly the case for the dispersion function in figure 1 .",
    "the response peaks , however , can be shifted by interpolating by the derivative of the response function ( i.e. , the derivative of equations 3 - 6 ) .",
    "say we choose to use the response at position @xmath50 by the random number @xmath53 .",
    "then after choosing a value of @xmath43 from that response function , we shift @xmath43 by @xmath55 .",
    "this shifts the response function as illustrated in the bottom panel in figure 7 .",
    "these two interpolation steps are , in general , much faster than the steps needed to calculate the response function .",
    "such monte carlo interpolation methods are also easily generalized to more dimensions by drawing several random numbers , @xmath53 , for each dimension and then shifting by each of the partial derivatives in each dimension .",
    "we will repeat this interpolation scheme several times using the specific rgs response functions in the following section .",
    "there are several steps in the monte carlo calculation that involve manipulating the functions described in  2 by the method outlined in  3.2 .",
    "the goal of this calculation is to start with a set of sky angles ( @xmath20 , @xmath24 ) and wavelength , @xmath31 , for a given photon and end with a set of detected event coordinates , ( @xmath16 , @xmath1 , and @xmath2 ) .",
    "the first step of the rgs monte carlo is to choose one of the two instruments .",
    "this is accomplished by taking the sum of the normalization for @xmath32 and @xmath34 for rgs 1 and 2 separately .",
    "then we draw a random number between 0 and 1 and choose the instrument based on the relative values of the two normalizations .",
    "the second step is the correction for the instrument boresight .",
    "the rgs instruments are misaligned with respect to one another , so the sky coordinates , @xmath20 and @xmath24 , are not trivially related to the @xmath20 and @xmath24 that we use in the instrument response functions .",
    "we therefore define @xmath56 , @xmath57 as the sky angles relative to the star tracker and then convert these coordinates to a set of coordinates ( @xmath20 , @xmath24 ) for each rgs instrument .",
    "this is accomplished by a standard euler transformation , such that the rotated coordinates , @xmath58 , are related to the input vector , @xmath53 , by    @xmath59    where @xmath60 is an approximately diagonal rotation matrix specified for each rgs .",
    "more details of this transformation can be found in @xcite .",
    "a third step chooses whether the photon follows the small - angle or large - angle response distribution .",
    "this is simply accomplished by taking the relative normalization of the @xmath32 and @xmath34 distribution and choosing based on that distribution .",
    "assume first that we have chosen the large - angle distribution .",
    "then , we find a @xmath16 for that photon by the following procedure .",
    "first , find the closest wavelength on the wavelength grid that defines @xmath32 . define the difference between the closest wavelength , @xmath61 , and the desired input wavelength , @xmath62 , as @xmath63 and the difference between the second closest wavelength , @xmath64 , and @xmath62 as @xmath65 .",
    "then we will use the reference wavelength , @xmath61 , if a random number is less than @xmath66 .",
    "otherwise , we will use the reference wavelength @xmath64 . define the reference wavelength that we have chosen as @xmath67 .",
    "we repeat the same procedure for finding a reference @xmath20 , which we define as @xmath68 .",
    "then we look up the cumulative probability distribution , @xmath32 , which is a function of @xmath16 , for a given @xmath68 and @xmath67 .",
    "it will have a monotonically increasing value between 0 and 1 at each @xmath16 .",
    "note that the maximum value might be less than 1 because at a given @xmath31 and @xmath20 since its value might be lower than at another @xmath31 and @xmath20 where the response is higher .",
    "then another random number , @xmath53 , is chosen and we find the value of @xmath16 where @xmath69 . if the value of @xmath53 is greater than the maximum value for @xmath32 then the photon is thrown away and we start the procedure over again . we , however , keep track of the number of photons that have been discarded .",
    "assume now that we have successfully chosen a value of @xmath16=@xmath70 .",
    "then , the final value of @xmath16 that will be output by the monte carlo is defined by @xmath71 this equation is derived by differentiating the dispersion equation . a final step that avoids some aliasing is to shift that value of @xmath16 on to a uniform @xmath16 grid according to the same procedure where we found the reference @xmath20 and @xmath31 .",
    "the fourth step consists of choosing the cross - dispersion value , @xmath1 , based on the function , @xmath33 .",
    "we first choose the reference @xmath72 based on the same procedure we used to get the reference @xmath31 or @xmath20 in the previous step .",
    "we also use the value of @xmath16 we obtained from the previous step .",
    "then a random number , @xmath53 , is chosen between 0 and 1 where we will find a value @xmath1 such that @xmath73 .",
    "there is some possibility that we will throw out this photon for sufficiently high values of @xmath53 .",
    "otherwise , we will end up with a value @xmath74 .",
    "this value is shifted according to the equation , @xmath75 finally , we align @xmath1 according to a predefined reference grid according to the same procedure we have used to find our reference @xmath68 .",
    "we now have a prediction for both the dispersion variable , @xmath16 , and the cross - dispersion variable , @xmath1 .",
    "if we had chosen the large - angle distribution instead of the small - angle distribution at the beginning of step 3 the procedure is nearly identical .",
    "we first use the distribution @xmath34 instead of @xmath32 to get the value of @xmath16 .",
    "then we use @xmath35 instead @xmath33 to get the value of @xmath1 .",
    "@xmath34 depends on wavelength , however , rather than @xmath16 .",
    "we then have a prediction for the values of @xmath16 and @xmath1 for the photons that are produced from the large angle part of the response as well .",
    "the fifth step consists of using the exposure map to determine if the particular value of @xmath16 and @xmath1 corresponds with an active region of one of the ccds .",
    "each value of the exposure map , @xmath4 will have a value between 0 and 1 .",
    "we then simply find the value of @xmath76 and throw the photon away if the value of the exposure is less than a given random number chosen between 0 and 1 .",
    "otherwise , the photon is considered detected and we proceed to the final step .",
    "the last step consists of choosing the ccd pulseheight distribution .",
    "the distribution is different for each of the two nodes for each ccd . therefore using the chosen value of @xmath16 we determine which ccd node for the photon using a simple linear function .",
    "this is correct in the limit that the ccds are approximately aligned in @xmath16 , which is a good approximation although they are slightly rotated .",
    "then , we choose a reference wavelength , @xmath67 , based on the wavelength grid for the function @xmath36 using the same procedure used in step 3 and 4 .",
    "a random number , @xmath53 , is chosen between 0 and 1 .",
    "the predicted ccd pulseheight is then chosen by finding the value of the pulseheight distribution such that @xmath77 .",
    "we then shift the value of the pulseheight by @xmath78 if @xmath53 is greater than the value of @xmath36 then we throw the photon away .",
    "otherwise , we have successfully predicted a value of @xmath16 , @xmath1 , and @xmath2 .",
    "the overall normalization is achieved by using the total number of photons we attempted to simulate , @xmath79 , the maximum value of the effective area , @xmath80 , the maximum value of the exposure map , @xmath81 , and the relative normalization , @xmath82 , of the model in units of photons @xmath83 .",
    "if we simulate @xmath19 photons and there are @xmath84 photons in the data set , then the normalization of the spectral model is given by @xmath85 the monte carlo generates photons at rates of @xmath86 photons per second per ghz of processor speed .",
    "an example of a simulation of monochromatic light from a point source is shown in figure 8 and 9 .",
    "a public version of this code is currently being prepared .",
    "given an efficient instrument response monte carlo , how can it be used with the measured data to constrain an astrophysical model ?",
    "schematically , the following steps are required :    * models are formulated in terms of a set of parameters .",
    "these parameters predict probability distributions for the spectral and spatial distributions .",
    "* photons are then drawn from these probability distributions and assigned an energy and two sky coordinates ( @xmath20 , @xmath24 ) . * the detector coordinate and pulseheight values ( @xmath0 , @xmath1 , @xmath2 ) are predicted from the instrument monte carlo . * the simulated events",
    "are compared with the measured photon events via a comparison statistic . *",
    "finally , an iteration is performed to optimize this statistic subject to variation of the input parameters .",
    "when the iteration converges , the best fit has been found .",
    "these steps are also outlined in figure 10 and are similar to standard analysis methods practiced in high energy astrophysics .",
    "an example of a simulation and an actual data set for a galaxy cluster is in figure 11 and 12 .",
    "following , we discuss several useful methods of comparing the raw rgs data and the simulated photons from the monte carlo calculation like that in figure 11 and 12 .",
    "the obvious advantage of using a monte carlo is that we can manipulate and select the data in any way since we can perform the same operations to the simulated photons .",
    "for this reason there are a variety of approaches to event comparison .",
    "we have found that some are more useful depending on the situation .      after simulating a set of photons with a set of values of @xmath16 , @xmath1 , and @xmath2 ,",
    "it is more convenient to convert those coordinates into a corrected wavelength , @xmath87 , cross - dispersion value , @xmath88 , and spectral order ( the @xmath89 designates that this may not be the true wavelength but the one measured by the rgs ) .",
    "this is accomplished by using equation 3 with the value of @xmath16 and cross - dispersion relation with the value of @xmath1 after using the pulseheight @xmath2 to determine whether the photon falls into first , second , or third order .",
    "we assume a nominal dispersion coordinate , @xmath20 , for all of the photons even though for an extended source we may not have the same input @xmath20 for every event .",
    "we can do this because we can perform the same operations the simulated data .",
    "we can interpret a shift in wavelength from a spectral line as either an actual wavelength shift or a shift caused by the finite extent of the source .",
    "a simple yet important step of a monte carlo is the selection of data .",
    "we can perform the same data selection cuts that are normally performed on point source observations .",
    "a selection in cross - dispersion is achieved by requiring all values of @xmath88 between an arbitrary @xmath90 and @xmath91 such that @xmath92 .",
    "similarly , a joint pulseheight - dispersion cut is achieved by requiring that the pulseheight , @xmath2 , falls within the window @xmath93 for some arbitrary constants @xmath43 and @xmath44 . with extended sources ,",
    "the joint dispersion - pulseheight cut is also broadened by calculating the above formula based on two values of @xmath20 and then making sure the pulseheight value in within in the window for both values of @xmath20 .",
    "these selection cuts are important to reduce the number of background events .",
    "the advantage of using the monte carlo is that events can quickly be sorted and removed if they do not satisfy the selection criteria .",
    "the selection can be changed arbitrarily without re - running the simulation .",
    "cross - dispersion cuts , in particular , can be used to compare different spatial regions .",
    "various statistics can be constructed to determine the quality of the model used in the simulation . in particular , a useful specific form of the @xmath94 statistic for two samples of data can be computed .",
    "this is given below for binned data where the number of events in the @xmath95th bin for the data photons is @xmath96 and for the model photons is @xmath97 .",
    "if there are @xmath84 total events in the data and @xmath19 simulated events in the model then the @xmath94 statistic is given by @xmath98 note that the two sample @xmath94 value approaches the familiar continuous form of @xmath94 when @xmath97 is replaced with @xmath99 where p is the probability model and @xmath100 .",
    "the two - sample @xmath94 is used to compare both the extracted spectra ( a binned histogram of @xmath87 ) and the cross - dispersion distribution ( a binned histogram of @xmath88 ) .",
    "they are both extremely useful in comparing the spectrum to the model spectrum and the cross - dispersion distribution compared to the predicted one . in @xcite and @xcite this method was employed to compare several spectra and the cross - dispersion distribution iteratively .",
    "it is also possible to compute a two - dimensional @xmath94 statistic on the binned wavelength - cross - dispersion data space .",
    "this is only possible with extremely bright sources , however , since there are usually a few counts per bin .",
    "we have also found an alternative statistic useful when using comparing rgs data .",
    "the cramr - von mises statistic , @xmath101 ( @xcite ) , which is a more robust version of the kolmogorov - smirnov statistic ( @xcite ) , is determined by computing the cumulative distribution of the data values , @xmath102 , and the model values , @xmath103 , and then evaluating the following sum at each of the model and data values , @xmath104 the statistic is most easily computed by sorting the data and model values .",
    "the statistic can be extended to multi - dimensional distributions by comparing values that are a linear combination of the value in each dimension .",
    "if we compute the cramr - von mises statistic of @xmath105 where @xmath106 , then we can compare the multi - dimensional distribution .",
    "the cramr - von mises statistic is computed for a set of several @xmath107 so that the value in one - dimension is emphasized more than other dimensions in each computation . if enough combinations are used , the statistic is relatively insensitive to our choice of @xmath108 .",
    "we have used this method to compare the multi - dimensional distribution of the background .",
    "it works well for this purpose since few photons fill each bin of the three - dimensional ( @xmath16 , @xmath1 , @xmath2 ) space .",
    "it may be possible to construct other useful two - sample multi - dimensional statistics as well and clearly there is more progress to be made in this area .",
    "below we discuss several extensions to the method .",
    "we have not yet discussed methods for iterating the model parameters after the photons have been simulated and the statistics have been calculated .",
    "one method involves changing the parameters of the model after all the photons have been simulated .",
    "the standard techniques for the iteration of a set of model parameters without using a monte carlo are applicable here as well .",
    "simplex ( @xcite ) , simulated annealing , markov chain monte carlo techniques , or robust grid searches may be the best methods since they all avoid using derivatives of the fitting statistic and therefore avoid the statistical @xmath109 fluctuations of the monte carlo .",
    "a more advanced form of iteration involves selecting individual photons produced from a set of parameters that improve the statistic .",
    "the statistic is evaluated after every photon is produced instead of after the entire set is simulated .",
    "this is then the monte carlo analog to deconvolution as opposed to model fitting .",
    "further discussion of this technique is described in @xcite and @xcite .",
    "systematic errors dominate over statistical errors in many of the multi - dimensional global fits we have considered here .",
    "additionally , the statistics we have discussed in  5.1 usually have a non - universal distribution .",
    "our focus in using these statistics is merely for model iteration and not for hypothesis testing or for constructing parameter confidence regions .",
    "standard parameter estimation techniques , however , can still be applied when dealing with the one - dimensional spectrum or a specific feature in the data .",
    "for example , one can first calculate @xmath94 on the one - dimensional extracted spectrum of both the data and simulation as in  4.2 .",
    "then the difference in @xmath94 when a parameter is varied can be estimated .",
    "this method is identical to standard parameter estimation techniques in x - ray astronomy ( @xcite ) .",
    "a simple example of this is shown in figure 13 and 14 . in some other circumstances , however , bootstrapping techniques ( @xcite )",
    "could be used to construct the distribution of these multivariate statistics when statistical errors dominate .",
    "although we have focused on a number of multivariate monte carlo methods for the reflection grating spectrometer , there is little in our discussion that could not be generalized to analysis of data from other instruments as well .",
    "the three dimensional structure of the response calculation is not unlike the structure of a non - dispersive instrument response that has an energy - dependent point - spread function , vignetting function , ccd response function , and an exposure map .",
    "the flexibility in astrophysical modeling of this approach may outweigh the advantages of the simplicity of traditional one - dimensional spectral extraction techniques at least in some situations .",
    "we have also applied this method to a monte carlo of the rgs background induced by charged particles and other instrumental sources .",
    "the background monte carlo has its own response function that differs from equation 8 .",
    "for more details about this monte carlo see @xcite .      after the instrument response is formulated as a monte carlo it is reasonable to consider more complicated astrophysical modeling that could involve a monte carlo approach .",
    "a flexible method is to formulate the astrophysical models always in three dimensions and then project the photon velocity shifts and spatial positions to the two dimensional sky coordinates .",
    "radiative transfer also becomes a straight - forward problem since individual photons can have their frequency shifted or trajectory altered .",
    "monte carlo techniques for this are well - developed , but these techniques can be used naturally in conjunction with a monte carlo treatment of the instrument model as in @xcite .",
    "we expect that many of the methods discussed here could allow a closer connection between future observational and theoretical work .",
    "we thank an anonymous referee for many important comments that greatly improved this manuscript .",
    "jrp acknowledges many helpful discussions and technical improvements to the monte carlo code and methods by jean cottam , maurice leutenegger , frits paerels , andy rasmussen , doug reynolds , masao sako , cor de vries , and haiguang xu , as well as additional support from the xmm - rgs team and the xmm collaboration .",
    "smk acknowledges partial support for this work under sao chandra grant go2 - 3178x .",
    "( horizontal axis ) .",
    "each line corresponds to a spectral order ( first through fifth ) , the brightest one being the first order response .",
    "this plot is only the on - axis response .",
    "it varies as a function of off - axis position .",
    "the red region is where the response function is the highest , whereas the black regions are where the response function is low.,width=288 ]     ( horizontal axis ) .",
    "each peak corresponds to a spectral order ( first through fifth ) , the brightest one being the first order response .",
    "contrast this with the previous plot .",
    "this plot is only the on - axis response .",
    "it varies as a function of off - axis angle .",
    "the red region is where the response function is the highest , whereas the black regions are where the response function is low .",
    "the complex nature of the response function at the bottom of the plot is due to the gold m shell edge , which affects the reflectivity dramatically.,width=288 ]     ( vertical axis with @xmath16 increasing ) and cross - dispersion , @xmath1 ( horizontal axis ) .",
    "this plot is only the on - axis response .",
    "it varies as a function of off - axis angle .",
    "the red region is where the response function is the highest , whereas the black regions are where the response function is low.,width=288 ]     ( horizontal axis ) .",
    "this plot is only the on - axis response .",
    "it varies as a function of off - axis angle .",
    "the red region is where the response function is the highest , whereas the black regions are where the response function is low.,width=288 ]             and @xmath51 and then use an interpolation scheme to approximate the response probability at @xmath110 . if the response peaks line up , we can simply use the probability distribution at @xmath50 and @xmath51 some fraction of the time as shown in the top panel and get a combined probability curve shown by the purple curve .",
    "the probability distributions can also be shifted if the response probability peaks do not have a common value as shown in the second panel .",
    ", width=576 ]         photons .",
    "the plot shows the cross - dispersion vs. dispersion histogram .",
    "the left peak is the first order spot and the right peak is the second order spot .",
    "large scattering wings are present off a sharply peaked core .",
    "red shows the high intensity regions , and green shows the low intensity regions.,width=288 ]     photons .",
    "the plot shows the pulseheight vs. dispersion histogram .",
    "the left peak is the first order spot and the right peak is the second order spot .",
    "large scattering wings are present off a sharply peaked core along the dispersion direction and the partial event tails of the pulseheight distribution extend vertically .",
    "red represents the high intensity regions , and green represents the low intensity regions.,width=288 ]             ( three panels ) three simulations of a thermal plasmas at electron temperatures of 0.5 , 1.0 , and 1.5 kev emitted from an unresolved source using the rgs monte carlo .",
    "each plot is segmented in the same way as in figure 11 and 12 .",
    "the bright spots represent photons from strong emission lines .",
    "the simulations are compared in figure 14 .",
    "each simulation has approximately 30,000 photons . , width=288 ]     the two - sample @xmath94 and the cramr - von mises statistic , @xmath101 , ( see text ) calculated on the one - dimensional extracted spectrum by comparing the 1 kev simulation in figure 13 with various other simulations at other temperatures .",
    "the statistics correctly achieve the minimum at 1 kev and fluctuate around their 50th percentile values ( 1.0 for @xmath94 and 0.12 for @xmath101 ) .",
    "the fluctuations can be diminished if more events are simulated.,width=288 ]"
  ],
  "abstract_text": [
    "<S> we propose a novel multivariate monte carlo method as an efficient and flexible approach to analyzing extended x - ray sources with the reflection grating spectrometer ( rgs ) on xmm newton . a multi - dimensional interpolation method is used to efficiently calculate the response function for the rgs in conjunction with an arbitrary spatially - varying spectral model . </S>",
    "<S> several methods of event comparison that effectively compare the multivariate rgs data are discussed . </S>",
    "<S> the use of a multi - dimensional instrument monte carlo also creates many opportunities for the use of complex astrophysical monte carlo calculations in diffuse x - ray spectroscopy . </S>",
    "<S> the methods presented here could be generalized to other x - ray instruments as well . </S>"
  ]
}