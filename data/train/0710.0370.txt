{
  "article_text": [
    "the biggest barrier to using archival megacam ( boulade et  al .",
    "2003 ) images is the effort required to process them . while the individual images are occasionally useful by themselves , more often the original scientific program called for multiple exposures on the same field in order to build up depth and get rid of image defects .",
    "therefore , the images must be combined .",
    "a typical program calls for 5 or more exposures on a single field .",
    "each megacam image is about 0.7 gb ( in 16-bit integer format ) , making image retrieval over the web tedious .",
    "because of the distortion of the megaprime focal plane , the images must be resampled .",
    "this involves substantial computational demands . during this processing , which is often done in a 32-bit format ,",
    "copies of the images must be made , increasing the disk usage . in summary ,",
    "the demands in terms of cpu and storage are non - trivial .",
    "presumably moore s law ( 1965 ) , will make these concerns negligible , if not laughable , in ten years time .",
    "however , at the moment , they present a technological barrier to easy use of megacam data .    the elixir pipeline ( magnier & cuillandre 2004 ) at cfht processes each megacam image .",
    "it does a good job of detrending ( bias - subtracting , flat - fielding , de - darking ) the images .",
    "however , the astrometric solution elixir provides is only good to 0.5 - 1.0 arcseconds . to combine the images",
    ", they must be aligned to better than a pixel .",
    "one arcsecond accuracy is insufficient .",
    "therefore , it is necessary for a user to devise some way of aligning the images to higher accuracy .",
    "this is not an easy task , and rendered more difficult by the distortion of the megaprime focal plane .",
    "the problem is not intractable and there do exist a number of software solutions to the problem , but it remains an obstacle to easy use of megacam data .    in short , while the barriers to using archival megacam data are not insurmountable , they make using these data considerably less attractive .",
    "megapipe aims to increase usage of megacam data by removing these barriers .",
    "this paper describes the megapipe image processing pipeline .",
    "megapipe combines megacam images into stacks and extracts catalogues .",
    "the procedure can be broken down into the following steps :    * image grouping ( section [ grouping ] ) * astrometric calibration ( section [ astrom ] ) * photometric calibration ( section [ photom ] ) * image stacking ( section [ comb ] ) * catalogue generation ( section [ cat ] )    sections [ qualastro ] and [ qualphoto ] discuss checks on the astrometric and photometric properties of the output images . section [ sec : prod ] describes the production and distribution of the images .",
    "the first step of image grouping is to ensure that each input image can be calibrated .    in order for astrometric calibration to take place ,",
    "each ccd of each image must contain a minimum number of distinct sources with well defined centres .",
    "this means that images with short exposure times ( @xmath050 seconds ) , images of nebulae or images taken under conditions of poor transparency can not be used .    in order for photometric calibration to take place ,",
    "the image must either be taken on a photometric night or contain photometric standards .",
    "only  images are included in megapipe , so the sdss ( york et  al .",
    "2000 ) , which covers a significant fraction of the sky can be used as a source of photometric standards . also , sources from previously processed megapipe images can be used as standards .",
    "one ccd of each exposure is inspected visually .",
    "exposures with obviously asymmetric psfs ( due to loss of tracking ) or other major defects such as unusually bad seeing , bad focus , or poor transparency are discarded .",
    "only a sub - raster of one ccd is examined .",
    "however , these defects will affect the entire mosaic , so this examination is sufficient .",
    "the visual examination takes a trained operator about 1 second per image .",
    "the step is semi - automated using an asynchrous application which retrieves images from the archive before the are required so there is no delay in loading them .",
    "the time between images is a few milliseconds .    in some of the exposures , one or several of the ccd s in the mosaic are dead .",
    "other exposures are unusuable due to being completely saturated .",
    "these cases are detected automatically by examining the statistics of the pixel values of a subraster of each ccd of each mosaic .",
    "images that fail these tests are discarded .",
    "images which pass quality control are then grouped .",
    "initially , each image is in a single group containing only itself .",
    "the grouping algorithm first sorts all the groups by ra .",
    "it then loops through the groups looking for neighboring groups .",
    "neighbors are defined as a pair of groups whose centers are within 0.1 degrees of each other .",
    "when two neighboring groups are found , they are merged into a new single group .",
    "the center of the new group is set to the average of the centers of the two original groups , weighted by the number of images in each group .",
    "this process is repeated until no more new neighbors are found .",
    "it converges after 3 or 4 iterations . in principle , because the groups are sorted by ra and because the group centers shift as groups merge , group membership determined by this algorithm could be sensitive to the details of the image centers . in practice , because of the way megacam is typically used ( relatively small dithers , then a 1 degree or more shift to a new field ) , the algorithm is remarkably stable . even doubling the definition of neighbor from 0.1 degrees to 0.2 degrees only adds a small number of groups .    during the grouping described above",
    ", no attention is paid to the filters in which the images were taken ; this is done in a second step .",
    "each group is examined .",
    "if it does not contain five or more images taken in a particular ( ) filter , all the images taken in that filter are deleted from the group .",
    "the lower limit of four epxosures represents a compromise . stacking a smaller number of images means that image defects are not always perfectly rejected . setting a larger limit means less data can processed .",
    "four was chosen so as to include the large amount of imaging data taken as part of the cfhtls very wide survey which has a four exposure observing strategy .",
    "the first step in the astrometric calibration pipeline is to run the well known sextractor ( bertin & arnouts 1996 ) source detection software on each image .",
    "the parameters are set so as to extract only the most reliable objects .",
    "the detection criteria are set to flux levels 5 sigma above the sky noise in at least 5 contiguous pixels .",
    "this catalogue is further cleaned of cosmic rays ( by removing all sources whose half - light radius is smaller than the stellar locus ) and extended objects ( by removing sources whose kron magnitudes are not within 2 mags of their aperture magnitudes ) .",
    "this leaves only real objects with well defined centres : stars and ( to some degree ) compact galaxies .",
    "this observed catalogue is matched to the usno a2.0 astrometric reference catalogue ( monet & et al . 1998 ) .",
    "the ( x , y ) coordinates of the observed catalogue are converted to ( ra , dec ) using the initial elixir world coordinate system ( wcs ) .",
    "the catalogues are shifted in ra and dec with respect to one another until the best match between the two catalogues is found .",
    "the number of individual matches between objects in the catalogues is maximized as function of ra and dec offsets .",
    "an object in one catalogue is deemed to match on object in the other catalogue if the are within a certain radius ( intially 2 arcseconds , shrinking to 0.5 arcseconds as the wcs is refined ) of each other and there are no objects within a second radius ( initally 4 arcseconds , shrinking to 1 arcsecond .",
    "this second criteria protects against false matches from neighboring objects .    because there are a number of objects in the two catalogues , a small number of spurious matches can occur . if the number of individual matches even for the best offset for a particular ccd is low ( either less than 10 or less than half the average of the other ccds ) , then this ccd is flagged as having failed the initial match .",
    "this can occur for example when the initial wcs is unusually erroneous . in this case",
    ", the wcs for that ccd is replaced with a default wcs and the matching procedure is restarted .",
    "once the matching is complete , the astrometric fitting can begin .",
    "typically 20 to 50 sources per ccd are found with this initial matching .",
    "as the accuracy of the wcs improves , the observed and reference catalogues are compared again to increase the number of matching sources",
    ". a larger number of matching sources makes the astrometric solution more robust against possible errors ( proper motions , spurious detections , etc . ) in either the observed catalogue or the reference catalogue .",
    "the wcs is split into two parts : the linear part , which describes the tilt , rotation or offset of each ccd with respect to the focal plane ; and the higher order part which describes the distortion of the focal plane itself .",
    "the linear part is represented in a fits header by the crvaln , crpixn and cdnn keywords .",
    "the higher order part of the wcs has no standard representation as of yet but the most common is the pvnn keywords of calabretta et  al .",
    "( 2004 ) .",
    "the higher order terms are determined on the scale of the entire mosaic ; that is to say , the distortion of the entire focal plan is measured .",
    "this distortion is well described by a polynomial with second and fourth order terms in radius , @xmath1 , measured from the centre of the mosaic .",
    "the distortion appears to be quite stable over time , even when one of the lenses in the megaprime optics was flipped .",
    "determining the distortion in this way means that only 2 parameters need to be determined ( the coefficients of @xmath2 and @xmath3 ) with typically ( 20 - 50 stars per chip ) @xmath4 ( 36 chips ) @xmath5 1000 observations .",
    "if the analysis is done chip - by - chip , a third order solution requires 20 parameters per chip @xmath4 36 chips @xmath6 720 parameters .",
    "this is obviously less satisfactory .    in all of this ,",
    "the object is minimize the size of the average astrometric residuals which is very complicated function of the coefficients of the polynomials .",
    "the minimization is done using the non - linear least - squares approach described by press et  al .",
    "( 1992 ) modifed to use singular value decomposition instead of gauss - jordan elimination .    from the global distortion ,",
    "the distortion local to each ccd is determined .",
    "the 2-parameter , fourth - order distortion described in terms of @xmath1 ( the radius to the image centre ) is translated into a 10-parameter , third - order distortion described in terms of @xmath7 and @xmath8 ( the axes of the ccd ) .",
    "although the number of parameters needed to describe the distortion for the whole mosaic increases from 2 to 720 , the 720 parameters depend directly and uniquely on the 2 parameter global radial distortion ; only the representation is changed .",
    "the translation is done in order to be able to represent the distortion with the pvnn keywords .",
    "the error introduced by this translation is less than 0.001 arcseconds .",
    "the linear terms of the wcs are determined for each ccd individually , after the focal plane distortion has been removed .",
    "if the group lies within the sdss , this process is repeated with the sdss replacing the usno as the reference catalogue .",
    "the sdss has a higher source density and much greater astrometric precision than the usno .",
    "after the initial matching of the observed catalogues to the external reference catalogue ( usno or sdss ) , the astrometry is further improved by matching against an internal catalogue generated from megaprime images .",
    "for the first band of a group to be reduced ( the -band , if it exists , otherwise the order of preference is , , , ) , the internal catalogue is generated as follows : the observed source catalogues for each image are cross - referenced to identify sources common to two or more of the images .",
    "these sources are placed in a master catalogue .",
    "the positions of the sources in this master catalogue are the average of their positions in each of the original catalogues in which they appeared .",
    "this master catalogue is superior to the external reference catalogue because it has a higher source density since the typical megacam image goes deeper than either the usno or the sdss .",
    "further , the positions in the master catalogue are no less accurate than this external reference catalogue since each input catalogue was calibrated directly against it .    for the other bands in the group ,",
    "the image catalogues are first matched to the usno to provide a rough wcs and then matched to the catalogue generated using the first image so as to precisely register the different bands .",
    "the final astrometric calibration has an internal uncertainty of about 0.04 arcseconds and an external uncertainty of about 0.2 arcseconds , as discussed in section [ qualastro ] .",
    "the sloan digital sky survey dr5 ( adelman - mccarthy 2007 ) serves as the basis of the photometric calibration .",
    "the sloan  filters are not identical to the megacam filters , as shown in figure [ fig : megasdss ] .. the megacam filters differ from sdss filters mostly to adapt to the different type of ccd used in the camera . the color terms between the two filter sets can be described by the following equations :    @xmath9    the relations for the  bands come from the analysis of the snls group ( pritchet , private communication ) .",
    "the relation for the  band comes from the cfht web pages .",
    "the residuals about these relations are shown in figure [ fig : sdssmegares ] .",
    "the amplitude of the residuals in magnitudes where they are not affected by the intrinsic noise of the photometry are @xmath10 , @xmath11 , @xmath12 , @xmath13 , and @xmath14 .",
    "all groups lying in the sdss can be directly calibrated without referring to other standard stars such as the ( 2002 ) standards .",
    "the systematics in the sdss photometry are about 0.02 magnitudes ( ivezi et  al .",
    "2004 ) . the presence of at least 1000 usable sources in each square degree reduces the random error to effectively zero .",
    "it is possible to calibrate the individual ccds of the mosaic individually with about 30 standards in each . for each megacam image",
    ", megapipe matches the corresponding catalogue to the sdss catalogue for that patch of sky .",
    "the difference between the instrumental megacam magnitudes and the sdss magnitudes ( transferred to megacam system using the equations above ) gives the zero - point for that exposure or that ccd .",
    "the zero - point is determined by a median , not a mean .",
    "there are about 10000 sdss sources per square degree , but when one cuts by stellarity and magnitude this number drops to around 1000 .",
    "these numbers are valid at high galactic latitudes ; for fields near the galactic plane , the number of stars increases .",
    "it is best to only use the stars ( the above color terms are more appropriate to stars than galaxies ) , and to only use the objects with @xmath15 ( the brighter objects are usually saturated in the megacam image and including the fainter objects only increases the noise in the median ) .",
    "still , with 1000 objects , the zero point relative to the sdss calibration can be determined to @xmath16 magnitudes or better , even for the  band .",
    "this process can be used any night ; it is not necessary for the night to be photometric .    for groups outside the sdss footprint , the elixir photometric keywords",
    "are used , with modifications .",
    "the elixir zero - points were compared to those determined from the sdss using the procedure above for a large number of images .",
    "there are systematic offsets between the two sets of zero - points , particularly for the -band .",
    "these offsets also show variations with epoch , which are caused by modifications to elixir pipeline ( cuillandre , private communication ) .",
    "the most significant effect is a 0.2 magnitude jump in the u - band zero - point between elixir data from before may 2006 and data from after may 2006 . for megapipe ,",
    "the offsets are applied to the elixir zero - points to bring them in line with the sdss zero - points .",
    "archival data from the skyprobe real - time sky - transparency monitor ( cuillandre et  al .",
    "2002 ) is used to determine if a night was photometric or not .",
    "data taken on photometric nights is processed first through the astrometric and photometric pipelines to generate a catalogue of in - field standards .",
    "these standards are then used to calibrate any non - photometric data in a group .",
    "if none of the exposures in a group was taken on a photometric night , then that group can not be processed .",
    "the calibrated images are coadded using the program ( bertin 2004 ) .",
    "removes the sky background from each image so that its sky level is 0 .",
    "it scales each image according to the photometric calibration described in section [ photom ] . then resamples the pixels of each input image to remove the geometric distortion measured in section [ astrom ] and places them in the output pixel grid which is an undistorted tangent plane projection .",
    "a `` lanczos-3 '' interpolation kernel is used as discussed in section 5.6.1 of bertin ( 2004 ) .",
    "the values of the flux - scaled , resampled pixels for each image are then combined into the output image by taking a median .",
    "a median is noisier than an average , but rejects images defects such as cosmic rays or bad columns better .",
    "the optimum would be some sort of sigma - clipped average , but this is not yet an option in .",
    "the input images are weighted with mask images provided as part of the elixir processing .",
    "the mask images have the value 1 for good data and 0 for pixels with known image defects .",
    "an inverse variance weight map is produced along with each output image .",
    "this can be used as an input when running sextractor on the stack .",
    "the images are combined as full mosaics .",
    "the resulting output images ( stacks ) measure about 20000 pixels by 20000 pixels or about 1 degree by 1 degree ( depending on the input dither pattern ) and are about 1.7 gb in size .",
    "they are scaled to have a photometric zero - point of 30.000 in ab magnitudes ; that is , for each source :    @xmath17    due to the sky - substraction described above , the images have a sky level of 0 counts .",
    "this can cause unintended results for extended objects . if the extended emission varies smoothly and slightly ( as in a large nebula )",
    "swarp s background subtraction removes the extended emission at the same time as it removes the sky background , leaving a blank field .",
    "if the extended emission has sharp variations ( such as the spiral arm of a nearby galaxy ) , swarp s background subtraction can produce peculiar results .",
    "sextractor ( bertin & arnouts 1996 ) is run on each output image stack using the weight map .",
    "the resulting catalogues only pertain to a single band ; no multi - band catalogues have been generated . while this fairly simple approach works well in many cases , it is probably not optimal in some situations .",
    "sextractor was originally designed for sparse , high galactic latitude fields and does not do very well in highly crowded fields . in these cases",
    ", some users may wish to run their own catalogue generation software such as daophot ( stetson 1987 ) .",
    "the internal accuracy is checked by running sextractor on each stacked image in every band of each group and obtaining catalogues of object positions .",
    "the positional catalogues for each band are matched to each other and common sources are identified .",
    "if the astrometry is perfect , then the position of the sources in each band will be identical . in practice , there are astrometric residuals . examining these residuals",
    "gives an idea of the astrometric uncertainties .",
    "figure [ fig : astint ] shows checks on the internal astrometry between two images in a group .",
    "the top left quarter shows the direction and size ( greatly enlarged ) of the astrometric residuals as line segments .",
    "this plot is an important diagnostic of astrometry because , while the residuals are typically quite small , there are outliers in any distribution .",
    "if these outliers are relatively isolated from each other and pointing in random directions , this indicates errors in cross - matching between the two images , and is not an indicator of astrometric errors .",
    "conversely , if there are a number of large residuals in close proximity to each other , all pointing in the same direction , this indicates a systematic misalignment between the two images in question .",
    "the figure shows no such misalignments .",
    "the bottom left quarter of figure [ fig : astint ] shows the astrometric residuals in ra and dec .",
    "the red histograms show the relative distribution of the residuals in both directions .",
    "the 68%-tile of the residuals is 0.040 arcseconds radially .",
    "the two right panels show the residuals in ra and dec as a function of dec and ra respectively .",
    "the error in each direction is about 0.025 arcseconds .",
    "note that there should be a factor of @xmath18 between the radial uncertainties and the single direction uncertainties .",
    "figure [ fig : astint ] shows a better than average case .",
    "more typically , the astrometric residuals are 0.06 arcseconds , as shown in figure [ fig : astrores ] .",
    "the test described above is applied to every pair of images within each of the groups with similar results .",
    "this of course might not be too surprising , since the images were registered to each other in the first place .",
    "for example , if there is  and  data in a group , the   image is made first and then the  data is astrometrically mapped to the  image as described in section [ astrom ] . therefore , even if there are systematic errors in the astrometry , the  data is mapped to the erroneous positions , and the residuals between the  and image will still be small .",
    "however , this test is also applied between images belonging to different groups . since the astrometric calibration of one group is completely independent to that of another group , comparing the residuals between different groups is a more stringent test of the repeatability of the astrometry .",
    "figure [ fig : edgeast ] illustrates this test .",
    "it shows the astrometric residuals between two groups .",
    "the different panels have the same significance as in figure [ fig : astint ] .",
    "groups tend to overlap only at the edges , in a thin strip , as shown in the top left panel .",
    "consequently , the number of common sources between two groups will be much smaller than between two stacks in the same group .",
    "the residuals shown in figure [ fig : edgeast ] case 0.05 arcseconds . more typically , averaging over all the group overlaps , the repeatability is 0.06 arcseconds .",
    "this is checked by matching the catalogue for each field back to the astrometric reference catalogue .",
    "again , the scatter in the astrometric residuals is a measure of the uncertainty , and the presence or absence of any localized large residuals indicates a systematic shift .",
    "figure [ fig : astext ] shows checks on the external astrometry for a typical group .",
    "the panels have the same significance as in figure [ fig : astint ] .",
    "the only difference is that the residuals are typically larger , generally in the neighborhood of 0.2 arcseconds .",
    "note that there are uncertainties in the external astrometric catalogue as well . in this case",
    ", the sdss is used as a reference .",
    "the astrometric uncertainties inherent in the sdss are 0.05 to 0.10 arceconds ( pier et  al . 2003 ) .",
    "when this is taken into account , the estimated external astrometric uncertainties are probably 0.15 arcseconds .",
    "this is also true when the usno is used as the external catalogue .",
    "the residuals are more typically 0.5 , but the astrometric uncertainties inherent in the usno are about 0.3 or 0.4 arcseconds .",
    "the distribution of the astrometric residuals relative to the usno and sdss for 300 different groups are shown in figure [ fig : astrores ] .",
    "poor astrometry could also affect the stacked images in a more subtle way . while internal astrometric errors are small ( 0.06 arcseconds ) compared to the pixels ( 0.18 arcseconds ) and the typical image quality ( 1 arcsecond or better due to the superb seeing conditions at cfht ) , they are not zero .",
    "bad astrometry could degrade the image quality by placing sources from the individual input images in slightly different positions in the sky .",
    "when the images are coadded , the result would be a smearing of the source , in effect increasing the seeing .",
    "figure [ fig : iqinout ] shows that this is not taking place .",
    "the top left panel shows the image quality ( the `` seeing '' ) of the megapipe stacks plotted against the median of the image quality of the input images that went into each stack .",
    "the figure shows that the output image quality is the same as the median input image quality .",
    "the image quality degrades from the central portion of the mosiac to the corners , as shown in the top right panel of figure [ fig : iqinout ] . here",
    "the , image quality has been determined separately for ccds 00 , 08 , 27 and 35 of megacam ( the four corners ) and for ccds 12 , 13 14 , 21 , 22 and 23 ( the centre ) .",
    "the image quality is about 5% worse at the corners .",
    "the bottom left and right plots show the effects of stacking on the iq for ( respectively ) the centre ccds and the corner ccds .",
    "again , the astrometric errors and the stacking process are not affecting the image quality .",
    "whenever possible , the photometry of the megapipe images is directly tied to the sdss photometry . there @xmath19 standards in every field .",
    "thus , the systematic errors for these images are effectively nil with respect to the sdss .",
    "the systematic errors in the sdss are quoted as 2 - 3% ( ivezic , et al . , 2004 ) .",
    "the systematic errors for megapipe images not in the sdss are limited by the quality of the elixir photometric calibration .",
    "roughly half the images taken by megacam that can be calibrated lie within the sdss . by comparing the elixir photometric calibration to the sdss over a large number of nights , from 2003 until the present",
    ", the systematic errors can be estimated .",
    "the night - to - night scatter is typically 0.02 to 0.03 magnitudes . adding in quadrature the sdss systematic error ( 0.025 mags ) to the systematic error in transferring from the `` primary '' to `` secondary '' standards ( 0.025 mags )",
    ", we get 0.035 magnitudes of total systematic error .      for the groups lying within the sdss , it is possible to check the photometry of the stacked images directly .",
    "the magnitudes of sources in the megapipe groups can be compared to the magnitudes from sdss transformed through the equations in section [ photom ] .",
    "the agreement is very good .",
    "the photometric differences can be entirely attributed to the combination of the residuals in the equations ( [ eqn : trans1 ] ) through ( [ eqn : trans5 ] ) and random errors .",
    "the relative photometric offsets between the centre of the mosaic and the corners is typically less than 0.005 magntiudes .",
    "of course , the comparison above applies to images that were photometrically calibrated using the sdss , so it is not surprising that there are no residuals . as a test of the elixir calibration ,",
    "a number of groups lying within the sdss were stacked using only the elixir zero - points .",
    "the photometric residuals between the resulting stacks and the sdss were typically 0.03 magnitudes , consistent with the photometric residuals between the individual ( non - stacked ) images and the sdss .",
    "the internal consistency is checked by comparing catalogues from different groups .",
    "groups occasionally overlap each other ; even if they only overlap by a arcminute or two , there are usually several hundred sources in common in the two catalogues .",
    "since groups are reduced independently of each other , and since often the data was taken on different nights , comparing the magnitudes of objects common to two groups makes it possible to check the internal consistency .",
    "any systematic errors will show up as an offset in the median of the difference in magnitudes between the two groups , as shown in figure [ fig : edgemag ] .",
    "the offset in this case is -0.014 magnitudes .",
    "this same test was applied to all possible pairs of groups where there were more than 100 objects in common between the catalogues .",
    "the typical offset was found to be 0.015 magnitudes .",
    "this is smaller than the night - to - night variation of the elixir zero - points ( which is 0.03 mags ) for two reasons : first , many groups lie within the sdss so that their photometric calibration does not depend on the elixir zero - points .",
    "second , some neighbouring groups were observed on the same night so any systematic error in the elixir zero - points will be common to both groups .",
    "another diagnostic of photometry is to examine the colors of stars .",
    "stars have a relatively constrained locus in color space .",
    "any offsets between the observed and expected colors indicates a zeropoint error .",
    "this test will of course only indicate failure if the shift is quite large ( 0.05 magnitudes or more ) ; smaller shifts are not visible .",
    "further , the metalicity of the star population will systematically affect the color - color locus .",
    "high galactic latitude fields ( metal poor ) will not look the same as fields on the galactic plane ( metal rich ) .",
    "therefore , this test can not be viewed as definitive .",
    "however , the test can be applied to groups that do not lie in the sdss and therefore can not be checked directly .",
    "the top left panel of figure [ fig : starcol ] illustrates the selection of stars for a typical image .",
    "the plot shows half - light radius plotted as magnitude . on this plot",
    ", the galaxies occupy a range of magnitudes and radii while the stars show up as a well defined horizontal locus , turning up at the bright end where the stars saturate .",
    "the red points indicate the very conservative cuts in magnitude and radius to select stars for further analysis .",
    "the other 3 plots show the colors of the stars selected in this manner in black .",
    "the underlying stellar locus ( show in green ) was generated by selecting point sources from the sdss and transforming the colors by using equations ( [ eqn : trans1 ] ) through ( [ eqn : trans5 ] ) .",
    "no systematic shifts seem to be visible .",
    "the sdss points which do not lie on the stellar locus are quasars .",
    "this test was applied for all groups where stacks were made in 3 or more bands with similar results .",
    "the limiting magnitudes of the images is measured in three ways :    * number count histogram * 5-sigma point source detection * adding fake objects    the first method is quite simple , indeed crude .",
    "the magnitudes of the objects are sorted into a histogram .",
    "the peak value of the histogram , where the number counts start to turn over , is a rough measure of the limiting magnitude of the image .",
    "the second method is also simple .",
    "the estimated magnitude error of each source is plotted against its magnitude . in this case , the magauto or kron - style ( kron 1980 ) magnitude is plotted . at the faint magnitudes typical of megacam images , the sky noise dominates over the magnitude error .",
    "this means that extended objects ( which have more sky in their larger kron apertures ) will be noisier for a given magnitude than compact sources .",
    "turning this around , this means that , for a given fixed magnitude error , a point source will be fainter than an extended source .",
    "a 5-sigma detection corresponds to a s / n of 5 or , equivalently , a magnitude error of 0.198 magnitudes .",
    "thus , to find the 5-sigma point source detection limit , one finds the faintest source whose magnitude error is 0.198 magnitudes or less .",
    "it must be a point source , therefore , its magnitude is the 5-sigma point source detection limit",
    ". a more refined approach would be to isolate the point sources , by using the half - light radius for example . in practice",
    ", the quick and dirty method gives answers that are correct to within @xmath20 magnitudes , which is accurate enough for many purposes .",
    "figure [ fig : maglimnc ] illustrates these methods .",
    "the top panel shows the number count histogram .",
    "the number counts peak at 25.5 in magnitude as shown by the vertical red line .",
    "the bottom panel shows magnitude error plotted against magnitude .",
    "the horizontal red line lies at 0.198 magnitudes .",
    "the vertical red line intersects the horizontal line at the locus of the faintest object with a magnitude error less than 0.198 magnitudes .",
    "the magnitude limit by this method is 26.5 magnitudes .",
    "the final way the limiting magnitudes of the images was tested by adding fake galaxies to the images and then trying to recover them using the same parameters used to create the real image catalogues .",
    "the fake galaxies used are taken from the images themselves , rather than adding completely artificial galaxies .",
    "40 bright , isolated galaxies are selected out of the field .",
    "postage stamps of these galaxies are cut out of the images .",
    "the galaxies are faded in both surface brightness and magnitude through a combination of scaling the pixel values and resampling the images . to test the recovery rate at a given magnitude and surface brightness ,",
    "galaxy postage stamps are selected from the master list , faded as described above to the magnitude and surface brightness in question , and then added back to the image at random locations .",
    "sextractor is then run on the new image .",
    "the fraction of fake galaxies found gives the recovery rate at that magnitude and surface brightness .",
    "an illustration of adding fake galaxies is shown in figure [ fig : sampleim ]",
    ". the same galaxy has been added multiple times to the image , faded to various magnitudes and surface brightnesses .",
    "the red boxes contain the galaxy and are labelled by magnitude / surface brightness .",
    "note the galaxy at @xmath21 , @xmath22 accidentally ended up near a bright galaxy and is only partially visible .",
    "normally of course , the galaxies are not placed in such a regular grid .    to test the false - positive rate ,",
    "the original image was multiplied by -1 ; the noise peaks became noise troughs and vice - versa .",
    "sextractor was run , using the same detection criteria .",
    "since there are no real negative galaxies , all the objects thus detected are spurious .    the magnitude / surface brightness plot shown in figure [ fig : maglimmu ]",
    "is an example of such a test .",
    "the black points are real objects .",
    "the bottom edge of the black points is the locus of point - like objects .",
    "the green points show the false - positive detections .",
    "the red numbers show the percentage of artificial galaxies that were recovered at that magnitude / surface brightness .",
    "the blue contour lines show the 90% , 70% and 50% completeness levels .    deriving a single limiting magnitude from such",
    "a plot is slightly difficult .",
    "the cleaner cut in the false positives seems to be in surface brightness .",
    "extended objects become harder to detect at brighter magnitudes whereas stellar objects are detectable a magnitude or so fainter .    note that this plot is of limited usefulness in crowded fields . in this case",
    ", an object may be missed even if it is relatively bright because it lies on top of another object .",
    "however , the objects in crowded fields are almost always stellar .",
    "this suggests the use of the daophot package rather than using the sextractor catalogues provided as part of megapipe .",
    "the megapipe pipeline is now in place at the canadian astronomical data centre",
    ". the rate at which stacks can be generated depends directly on the number of input images . with the current generation of processing nodes at the cadc",
    ", each group can be produced in 10 minutes @xmath4 the number of input images .",
    "this last number is included chiefly to amuse future generations of astronomers .",
    "the images are distributed via the canadian astronomical data centre .",
    "a user can search for images by position or by name , or by the properties of the input images ( number of input images , total exposure time , etc . ) .",
    "a preview facility is provided which allows the user to rapidly pan and zoom over the images without downloading the fairly sizable science images . a cutout service which allows users to retrieve a small subsection of a megapipe image",
    "is also provided .        based on observations obtained with megaprime / megacam , a joint project of cfht and cea / dapnia , at the canada - france - hawaii telescope ( cfht ) which is operated by the national research council ( nrc ) of canada , the institute national des sciences de lunivers of the centre national de la recherche scientifique of france , and the university of hawaii .            , o. , charlot , x. , abbon , p. , aune , s. , borgeaud , p. , carton , p .- h . , carty , m. , da costa , j. , et al .",
    "2003 , in presented at the society of photo - optical instrumentation engineers ( spie ) conference , vol . 4841 , instrument design and performance for optical / infrared ground - based telescopes . edited by iye , masanori ; moorwood , alan f. m. proceedings of the spie , volume 4841 , pp . 72 - 81 ( 2003 )",
    "m.  iye & a.  f.  m. moorwood , 7281      , j .- c . ,",
    "magnier , e.  a. , isani , s. , sabin , d. , knight , w. , kras , s. , & lai , k. 2002 , in presented at the society of photo - optical instrumentation engineers ( spie ) conference , vol .",
    "4844 , observatory operations to optimize scientific return iii . edited by quinn , peter j. proceedings of the spie , volume 4844 , pp .",
    "501 - 507 ( 2002 ) . ,",
    "p.  j. quinn , 501507"
  ],
  "abstract_text": [
    "<S> this paper describes the megapipe image processing pipeline at the canadian astronomical data centre . </S>",
    "<S> the pipeline combines multiple images from the megacam mosaic camera on cfht and combines them into a single output image . </S>",
    "<S> megapipe takes as input detrended megacam images and does a careful astrometric and photometric calibration on them . </S>",
    "<S> the calibrated images are then resampled and combined into image stacks . </S>",
    "<S> the astrometric calibration of the output images is accurate to within 0.15 arcseconds relative to external reference frames and 0.04 arcseconds internally . </S>",
    "<S> the photometric calibration is good to within 0.03 magnitudes . </S>",
    "<S> the stacked images and catalogues derived from these images are available through the cadc website . </S>"
  ]
}