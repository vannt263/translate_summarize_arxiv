{
  "article_text": [
    "molecular dynamics ( md ) computer simulations have become a standard tool for investigating a variety of atomic and molecular systems ranging from solids to simple fluids to complex biomolecular assemblies @xcite .",
    "they are particularly attractive for dynamics and for equilibrium sampling in high density condensed matter systems where large scale collective modes may be significant .",
    "these modes may not be easily excited ( and relaxed ) by the alternative approach to phase space sampling , namely monte carlo ( mc ) simulations , because : ( i ) mc evolution is diffusive in nature , and ( ii ) mc tends to have low acceptance rates in high density regions @xcite . the mc method",
    ", however , possesses one significant advantage over md - the ability to sample , at least in principle ( i.e. , for sufficiently long runs ) , almost any statistical ensemble in a fairly straightforward manner .",
    "this task is accomplished by performing mc moves that are ergodic and satisfy the detailed balance condition . in the canonical @xmath0 ensemble ( where @xmath1 , @xmath2 , and @xmath3 denote the number of particles , volume , and temperature , respectively ) , the latter requirement is usually fulfilled by using the metropolis criterion for the acceptance probability : @xmath4 $ ] , where @xmath5 is the boltzmann constant and @xmath6 is the change in the potential energy between the two states which are approached via opposite moves .",
    "similarly , the isothermal - isobaric @xmath7 ( where @xmath8 is the pressure ) ensemble can be simulated by including coordinate displacements that change the volume of the system and scale the coordinates of the particles accordingly , and by redefining the potential energy to @xmath9 [ see , later , eq .",
    "( [ eq : ueff ] ) ] .",
    "things become more complicated when it comes to md simulations , which attempt to follow the _ dynamics _ of a molecular system by numerically solving newton s classical equations of motion for the constituent particles .",
    "this , supposedly , generates trajectories within the microcanonical ensemble @xmath10 ( where @xmath11 is the internal energy of the system , which is the sum of potential and kinetic energies ) although , due to truncation errors , one should not expect the computed trajectories to actually follow the real - time dynamics in many - particle systems @xcite .",
    "the most commonly used discrete - time integrator for md simulations is the strmer - verlet algorithm which ( in its so - called `` velocity - verlet '' form ) reads @xcite : @xmath12 where @xmath13 , @xmath14 , and @xmath15 denote , respectively , the coordinate , velocity , and the force acting on the particle with mass @xmath16 at time @xmath17 , and @xmath18 .",
    "notice that @xmath13 , @xmath14 , and @xmath15 represent cartesian components , which means that for a system of @xmath1 particles in a space with dimensionality @xmath19 , the number of equations one needs to compute per time step @xmath20 , is @xmath21 .",
    "the verlet algorithm results in a trajectory which is accurate to second order in the time step @xmath20 .",
    "this deviation between the computed and the `` correct '' trajectories should not be a matter of concern if the simulations properly sample the correct statistical ensemble , or otherwise retain the measures of interest .",
    "thus , the critical test for the performance of any numerical integrator must be its accuracy in measuring important thermodynamic quantities and the variations of the results with @xmath20 .",
    "remarkably , the verlet algorithm suffers from the problem that the total kinetic energy of a simulated system ( which is supposed to be proportional to the temperature ) becomes progressively depressed for increasing time step @xmath20 @xcite compared to the potential energy ( see also appendix [ appendix_b ] for a harmonic oscillator demonstration of how the velocity in discrete time is not precisely the velocity of the corresponding spatial coordinate )",
    ". other thermodynamic observables also exhibit variations with @xmath20 , which makes a striking contrast with mc simulations in which the thermodynamic configurational averages are insensitive to the step sizes .",
    "the microcanonical ensemble sampled in md simulations does not provide the best representation of experimental conditions , where the most common condition is that of constant temperature and pressure .",
    "therefore , considerable effort has been devoted to the development of md algorithms for simulations of the isothermal - isobaric ensemble . in the simplest method , proposed by berendsen ,",
    "the system is weakly coupled to external heat ( `` thermostat '' ) and pressure ( `` barostat '' ) baths , using the principle of least local perturbation @xcite .",
    "this method has been criticized for failing to correctly sample the statistical ensemble , due to its tendency to suppress fluctuations in kinetic energy and volume . a second ,",
    "more reliable method , pioneered by andersen for fixed pressure @xcite , extended by parrinello and rahman @xcite and by nos @xcite , and revised by hoover @xcite to fixed temperature md simulations , is the extended lagrangian formalism .",
    "the method is based on the idea of including additional degrees of freedom , corresponding to the volume and/or the kinetic energy of the system , together with their conjugate momenta variables .",
    "the new variables are coupled to the system in a manner which guarantees that the trajectory correctly samples the isothermal - isobaric ensemble .",
    "the latter constitutes a sub - space of the configuration space of the extended system . within the extended phase space ,",
    "the statistics is microcanonical and the equations of motion can be derived from the extended hamiltonian , which is conserved in time . in principle , these hamiltonian equations of motion can be integrated numerically using the verlet algorithm . in practice",
    ", the implementation of the discrete - time verlet algorithm raises several significant challenges and difficulties .",
    "specifically , for the barostat part , the coupling between the particles degrees of freedom and the `` piston '' ( introduced to control the volume fluctuations ) is the source of the following problems :    1 .   when the piston moves , the particle coordinates must be rescaled , which leads to a metric problem with the algorithm .",
    "this problem has been addressed in refs .",
    "the method is extremely sensitive to the value assigned to the mass of the piston .",
    "a low mass will result in rapid box size oscillations which are not attenuated very efficiently by the motions of the molecules , while a large mass will give rise to a slow adjustment of the volume and may therefore be computationally inefficient .",
    "the force on the piston [ see eq .",
    "( [ eq : presandersen ] ) below ] depends on the internal pressure of the system , the value of which depends on the instantaneous kinetic energy of the particles .",
    "this means that the velocity @xmath22 is the solution to an implicit equation , which therefore must be solved iteratively .",
    "this has several consequences , including that the computed trajectory is no longer time reversible - a feature that jeopardizes the ( extended ) energy conservation in long simulations .",
    "a set of explicit reversible integrators for the dynamics has been developed by martyna and coworkers @xcite .",
    "4 .   the dependence of the internal pressure on the kinetic energy leads to inaccurate determination of the pressure , since the kinetic contribution is derived from the particles velocities , which , as shown in appendix [ appendix_b ] , deviate from the actual velocities .",
    "the third approach to constant pressure and temperature md simulations employs the andersen extended lagrangian formalism , i.e. , it couples the system to a global piston which governs the volume fluctuations of the system .",
    "however , instead of using a nos - hoover thermostat and solving the hamiltonian equations of motion , the temperature is set by solving the langevin equation @xcite : @xmath23 the langevin equation describes newtonian dynamics where the conservative force field @xmath24 is augmented by : ( i ) a friction force proportional to the velocity with friction coefficient @xmath25 , and ( ii ) thermal white ( `` delta - function correlated '' ) noise , @xmath26 .",
    "the friction and noise terms represent the interactions with the implicit degrees of freedom of the heat bath . in order to satisfy einstein s fluctuation - dissipation theorem that relates the friction and noise to each other",
    ", it is usually assumed that the noise is gaussian distributed and has the following statistical properties @xcite : @xmath27 historically , langevin stochastic thermostats have been developed in parallel to the nos - hoover deterministic thermostat , in the early 80 @xcite .",
    "however , it was only in 1995 , when feller _ et al .",
    "_  proposed to simulate isothermal - isobaric conditions by considering langevin dynamics for the piston s equation of motion in andersen s extended system @xcite .",
    "this approach was improved a few years later by kolb and dnweg , who considered langevin dynamics for both the particles and piston , and who developed an integrator for this purpose @xcite .",
    "while many of the problems associated with the application of the nos - hoover thermostat for @xmath7 simulations remained unsolved ( especially those originating from the coupling between the movement of the piston and the particles ) , the idea of simulating the extended system withing the framework of langevin dynamics appears to offer shorter correlation times and improved sampling .    in this paper",
    "we present a new method for langevin dynamics simulations at constant pressure and temperature . the method , which is both effective and simple to implement , provides improvements compared to the method of kolb and dnweg ( kd ) .",
    "key distinctions between our algorithm and others , including kd , lie in the manner by which the displacements of the particles into `` physical '' and `` scaled '' components are decoupled . within the traditional methods",
    "these two displacements are defined and separated prior to time - discretization , while our method is based on formulating the equations of motion for an already temporally discretized set of coordinates .",
    "another change that we introduce in the method , is to replace the kinetic energy term in the instantaneous pressure with its known thermodynamic average , which is precisely the ideal gas pressure @xmath28 .",
    "this change does not only resolve the aforementioned problems in implementations of verlet - type integrators to the piston s equation of motion , it also makes the extended lagrangian dynamics _ more _ consistent with the statistical mechanics of the isothermal - isobaric ensemble that the simulations aims to sample . finally , we take advantage of the recent advances in numerical integrators for langevin dynamics and replace the old bbk ( brooks , brnger , and karplus ) thermostat @xcite with the recently introduced g - jf ( grnbech - jensen and farago ) thermostat @xcite . while the former has a simulated temperature that differs by @xmath29 from the correct one , the latter exhibits no detectable changes in the configurational sampling statistics as the time step is varied in the entire numerical stability range @xcite .",
    "the paper is organized as follows : in section [ sec : method ] we derive the new method for isothermal - isobaric md simulations .",
    "this section contains both a detailed discussion of the theoretical aspects of the method , as well as a derivation of the algorithm for isothermal - isobaric simulations .",
    "the new algorithm is tested against the method of kolb and dnweg in section [ sec : simulations ] .",
    "for this purpose we present simulation results of both a one - dimensional toy model that can be solved analytically , and a three - dimensional lennard - jones system .",
    "we conclude the paper in section [ sec : summary ] .",
    "in his seminal paper on the extended lagrangian formalism , andersen studied the statistical mechanics of @xmath1 particles within a box with a fluctuating volume @xmath2 subject to a constant external pressure @xmath8 @xcite .",
    "he associated the volume fluctuations with the motion of a `` piston '' , and considered an extended phase space of @xmath30 degrees of freedom , including ( i ) the @xmath31 coordinates of the particles , @xmath32 , and their @xmath31 conjugate momenta @xmath33 , and ( ii ) the volume @xmath2 representing the coordinate of a `` piston '' along with its conjugate momentum .",
    "the derivation of the extended lagrangian formalism was done in the rather uncommon isoenthalpic - isobaric ensemble @xmath34 , where the enthalpy is @xmath35 .",
    "this is the equivalent of the microcanonical ensemble @xmath10 for fixed pressure .",
    "the degrees of freedom @xmath32 and @xmath2 in the extended system are _ not _ independent of each other because the particle coordinates are adjusted to volume fluctuations via simple scaling during md simulations . in order to have independent statistical variables , one needs to define the scaled coordinates @xmath36 @xmath37 where @xmath38 , @xmath39 , and @xmath40 is the linear size of the simulations box along the @xmath41-axis . for simplicity , we here assume that the simulation box is orthorhombic with fixed aspect ratios , such that @xmath42 , and that all the particles have identical mass @xmath16 , except for the piston , which is considered a coordinate with inertial constant @xmath43 .",
    "the  force \" acting on the piston is derived from the extended hamiltonian , which is obtained from the extended lagrangian via legendre transformation .",
    "it is given by ( see eq .",
    "( 3.14c ) in ref .",
    "@xcite ) @xmath44    the transition from the isoenthalpic - isobaric into the isothermal - isobaric ensemble requires the introduction of a `` thermostat '' , and as noted in section [ sec : intro ] , the thermostat can be either `` deterministic '' ( nos - hoover ) or `` stochastic '' ( langevin ) . in terms of the coordinates",
    "@xmath36 and @xmath2 , the isothermal - isobaric partition function reads : @xmath45/k_bt } \\label{eq : npt - partition } \\\\",
    "& & = \\int_0^{\\infty}\\!\\!\\!dv\\!\\!\\int_0 ^ 1 \\mathop{\\prod_{i=1}^{n}}_{\\mu = x , y , z}ds_{i,\\mu } \\,e^{-\\left[u\\left(\\left\\{l_\\mu s_{i,\\mu}\\right\\}\\right)+pv - nk_bt\\ln{v}\\right]/k_bt}. \\nonumber\\end{aligned}\\ ] ] this partition function can be interpreted as if governing the canonical ensemble of a system consisting of @xmath1 particles confined to a three - dimensional unit cube ( @xmath46 ) , and a piston moving along an infinite line ( @xmath47 ) , with the potential energy given by @xmath48 notice that the partition function defined by eq .",
    "( [ eq : npt - partition ] ) includes summation only over the spatial degrees of freedom ( of the particles and piston ) , but not over their conjugate momenta .",
    "this deviation from andersen s extended lagrangian formalism , where both the coordinates and momenta were included in the partition sum , deserves an explanation .",
    "andersen s method describes newtonian dynamics within a microcanonical ensemble . in this ensemble ,",
    "the kinetic and potential energies are coupled by energy conservation .",
    "in contrast , langevin dynamics occurs within an open system in contact with a heat bath . in this canonical ensemble ,",
    "the kinetic and potential energies are decoupled , and the degrees of freedom of the coordinates can be integrated separately from their associated momenta .",
    "the momenta degrees of freedom follow a maxwell - boltzmann gaussian distribution , while the coordinates ( @xmath36 and @xmath2 ) are governed by the boltzmann distribution corresponding to @xmath49 ( [ eq : ueff ] ) .",
    "the separation of the ensemble into two sub - spaces , corresponding to the coordinates and their associated momenta , is important because _ the goal of constant temperature and pressure simulations is to sample the phase space of the coordinates correctly . _",
    "the momenta , i.e. , the velocities , are only used in these simulations as a mean to assess the simulated kinetic temperature .",
    "the average kinetic energy is a reasonable measure of the temperature , but not a good one in discrete - time because of the second order ( in @xmath20 ) deviation between the measured velocity relative to the trajectory of the corresponding coordinate ( see appendix [ appendix_b ] ) .",
    "thus , numerical measures involving velocity are not reliable for non - vanishing time steps . in constant volume simulations ,",
    "this problem is avoided if the langevin dynamics is computed using the accurate g - jf integrator , which exhibit no changes in the configurational sampling statistics in response to variations in @xmath20 .",
    "moreover , the aforementioned closely - related problem of constant pressure simulations resulting from the dependence of the `` piston force '' on the velocities [ see eq .",
    "( [ eq : presandersen ] ) ] is eliminated as well , because , in the configuration phase space of interest ( which does not include momenta degrees of freedom ) , the piston  force \" ( pressure ) is derived from @xmath49 ( [ eq : ueff ] ) @xmath50 where we have defined the internal pressure @xmath51 .",
    "this last important point was neither included by andersen in his original paper , nor in other later contributions on langevin dynamics at constant pressure .",
    "following andersen s idea , we introduce the inertial coefficient @xmath43 for a piston with a coordinate that coincides with the volume @xmath2 of the system . the `` regular '' force ( pressure ) , @xmath52 , acting on this particle , is given by eq .",
    "( [ eq : presgjf ] ) .",
    "the piston coordinate moves with velocity @xmath53 in a medium with friction coefficient @xmath54 at constant temperature @xmath3 .",
    "the langevin dynamics of this `` particle '' is @xmath55 this equation will be integrated using the g - jf thermostat , which ( in the velocity - verlet form ) is expressed by the following equations to calculate the coordinate ( i.e. , volume ) @xmath56 and velocity @xmath57 at time @xmath18 ( see eqs .",
    "( 4)-(8 ) in ref .",
    "@xcite ) : @xmath58 where @xmath59 and @xmath60 is a normally distributed random number with zero mean , and autocorrelation @xmath61 .",
    "the variation of the volume causes complications for the dynamics of the particles , which reside within the confines of the defined , yet variable , volume .",
    "these complications are particularly apparent in systems with periodic boundary conditions since the simulated volume is associated with a lattice constant of a simulation box and not with a physical location of an actual piston .",
    "thus , in order to preserve the translational invariance of the equations of motion in a bulk system with periodic boundary conditions , it is necessary to globally couple the dynamics of the volume to all the particles , regardless of particle location in the simulation cell @xcite , such that relative distances in the system are preserved .",
    "this is accomplished through the scaled ( normalized ) coordinate @xmath62 , which is understood to be constant for a simple expansion or contraction of @xmath40 .",
    "however , the physical velocity and acceleration of the coordinate @xmath63 can then not be translational invariant without modifications .",
    "andersen s solution to the problem is to investigate the derivative @xmath64 in eq .",
    "( [ eq : fullvelocity ] ) we can see the separation of two identifiable components to the motion : ( i ) the dynamics of the particle relative to the simulation cell ( first term on the r.h.s . ) , and ( ii ) the dynamics due to the motion of the simulation cell ( second term on the r.h.s . ) .",
    "thus , _ defining _ @xmath65 as the relevant _ physical _ velocity of the coordinate @xmath66 makes the particle dynamics invariant to the origin of the coordinate system  an essential necessity for meaningful dynamics . while this elegant observation has led to the advanced formulations of both deterministic @xcite and stochastic @xcite methods for npt simulations , the inherent problem of time discretization persists .",
    "we now arrive at the core of the derivation of the new method .",
    "we simplify the notation for brevity in the rest of this subsection , such that , e.g. , the coordinate @xmath67 refers to @xmath63 , @xmath68 to @xmath40 , etc , unless specifically indicated otherwise .",
    "we reevaluate the particle equations of motion in discrete - time , starting with the definition of the scaled coordinate eq .",
    "( [ eq : eq_andersen_coordinate ] ) .",
    "the total particle displacement @xmath69 in one time step is given by @xmath70 we use the analogy between eqs .",
    "( [ eq : fullvelocity ] ) and ( [ eq : eq_r_partitioning ] ) to _ define _ the relevant physical , spatially invariant , discrete - time particle displacement @xmath71 from the first term in eq .",
    "( [ eq : eq_r_partitioning ] ) @xmath72 notice that @xmath73 for @xmath74 , consistent with the usual continuous - time definition of the relevant velocity mentioned above @xmath75 ( [ eq : eq_vel_cont ] ) .",
    "thus , we conclude that the discrete - time particle dynamics must involve the physical coordinate @xmath76 and an associated velocity @xmath77 , which must relate to the discrete - time displacement through @xmath78 the corresponding discrete - time velocity change @xmath79 is obtained through the @xmath20-integrated langevin equation @xmath80\\ , dt^\\prime = \\int_{t_n}^{t_{n+1}}\\left[f(r , t^\\prime)+\\beta(t^\\prime)\\right]\\ , dt^\\prime,\\end{aligned}\\ ] ] which , using ( [ eq : eq_phys_q_v ] ) and with no approximation , can be written @xmath81 where we have defined the wiener process @xmath82 such that @xmath83 ( the noise autocorrelation reads with full notation : @xmath84 . ) notice that the introduction of the discrete - time langevin equation in eq .",
    "( [ eq : eq_gjf_pos_0 ] ) , for linking the coordinate displacement @xmath85 with its velocity change @xmath86 , ensures physically meaningful discrete - time evolution .    starting from eq .",
    "( [ eq : eq_phys_q_v ] ) , and following our previous work @xcite , we now choose the time - reversible relationship between the relative displacement and change in the associated velocity : @xmath87 inserting ( [ eq : eq_gjf_pos_0 ] ) into ( [ eq : eq_gjf_pos_1 ] ) yields @xmath88 where @xmath89 equations ( [ eq : eq_gjf_q ] ) and ( [ eq : eq_gjf_pos_0 ] ) constitute a set of equations for determining @xmath90 and @xmath91 .",
    "we then approximate the @xmath20-integrals over the deterministic force @xmath92 such that all terms in the equations become at least second order correct in @xmath20 ( i.e. , consistent with the traditional verlet methods ) , which yields : @xmath93 these are explicit discrete - time equations for evaluating the evolution of the coordinates @xmath94 and @xmath14 .    in order to express the equations in the most useful form for molecular simulations",
    ", we use the relationship @xmath95 ( eq .  ( [ eq : eq_andersen_coordinate ] ) ) to combine eqs .",
    "( [ eq : eq_def_del_q ] ) and ( [ eq : eq_gjf_q ] ) for a direct expression of the dynamics of the physical coordinate @xmath13 : @xmath96 \\nonumber \\\\ \\label{eq : eq_gjf_bar_r}\\end{aligned}\\ ] ] we also insert eq .",
    "( [ eq : eq_gjf_q ] ) into eq .",
    "( [ eq : eq_gjf_vq ] ) in order to obtain an explicit equation for the dynamics of the velocity @xmath14 : @xmath97 where @xmath98 equations ( [ eq : eq_gjf_bar_r ] ) and ( [ eq : eq_gjf_bar_v ] ) are the verlet - type equations for particle updates in the stochastic g - jf thermostat / barostat , given a change @xmath99 in simulation box dimension during the time step @xmath100 .",
    "notice that the velocity equation depends only indirectly on the change in the simulation dimension @xmath68 through the force @xmath101 .    to summarize , given @xmath13 , @xmath14 , @xmath15 , @xmath102 , @xmath103 , and @xmath104 , the discrete - time dynamics evolves according to the following protocol :    \\1 . compute @xmath56 ( and @xmath105 )",
    "using eq .",
    "( [ eq : eq_gjf_vol_q ] ) .",
    "compute @xmath106 ( all @xmath107 ) using eq .",
    "( [ eq : eq_gjf_bar_r ] ) .    \\3 .",
    "evaluate the new forces @xmath108 ( all @xmath109 ) , and @xmath110 .",
    "compute @xmath57 using eq .",
    "( [ eq : eq_gjf_vol_p ] ) and @xmath22 ( all @xmath111 ) using eq .",
    "( [ eq : eq_gjf_bar_v ] ) .",
    "we reemphasize that the coordinates @xmath13 , @xmath14 , and @xmath15 here refer to each cartesian coordinate of each particle , and that @xmath68 refers to @xmath40 , such that @xmath112 is the volume of an isotropically varying , orthorhombic simulation box .",
    "in order to test the method we have applied it to two characteristic systems with a specific eye on the robustness against time - step variations .",
    "we compare our results with those generated by the kd method @xcite , which represents state - of - the - art of a sound approach to langevin dynamics npt simulations in atomic and molecular ensembles .",
    "the first system is a particular non - trivial , one - dimensional particle model for which we can analytically derive measurable thermodynamic quantities .",
    "this model therefore serves as a strict benchmark for the statistical accuracy of a numerical test simulation .",
    "the second system is the foundational model system in computational statistical mechanics , namely the three - dimensional ensemble of particles interacting with a lennard - jones force field . in this latter case",
    ", we do not have analytical expressions for the statistical measures , but we investigate the measures for different values of the discrete time step , and from that infer the quality of the applied numerical methods .",
    "we consider a one dimensional system of normalized length @xmath68 ( characteristic length @xmath113 ) with periodic boundary conditions .",
    "@xmath1 identical particles are located in order at @xmath114 such that the periodic boundary conditions ensure two neighbors for each particle ( i.e. , @xmath115 ) .",
    "each particle interacts with its two neighbors via a pair - potential that depends on the normalized pair distance @xmath67 . expressing the energy in units of the thermal energy ( @xmath116 ) ,",
    "the normalized pair - potential @xmath117 [ related to the physical potential via @xmath118 reads @xmath119    the pair potential @xmath117 consists of two contributions : a repulsive part ( @xmath120 ) , inversely proportional to @xmath67 , and an attractive logarithmic part .",
    "the latter may represent an entropic potential of mean force resulting from implicit degrees of freedom .",
    "considering the isobaric - isothermal ensemble @xmath7 ( where @xmath8 denotes the one - dimensional pressure , i.e. , the force , and is expressed in units of @xmath121 ) , the partition function of the system is given by @xmath122.\\end{aligned}\\ ] ] switching to the set of variables @xmath123 , the partition function reads @xmath124 \\nonumber\\\\ & = & \\left[\\int_0^{\\infty}\\frac{dr}{\\sqrt{r}}\\,e^ { -\\left(\\epsilon / r+pr\\right)}\\right]^n \\nonumber \\\\ &",
    "= & \\left[2\\int_0^{\\infty}dy\\,e^ { -\\left(\\epsilon / y^2+py^2\\right)}\\right]^n,\\end{aligned}\\ ] ] where the last equality has been obtained by setting @xmath125 .",
    "the value of the last integral is known , giving @xmath126^n.\\end{aligned}\\ ] ] the normalized gibbs free energy is given by @xmath127 , and the mean nearest neighbor particle normalized distance , @xmath128 , is then derived by @xmath129 the variance of the normalized length distribution is given by @xmath130    for a system of @xmath131 particles , we simulate the evolution for a normalized transient time of @xmath132 units before producing statistical averages of @xmath133 and @xmath134 over the next @xmath135 normalized time units .",
    "figures [ fig : fig_oa](a ) and ( b ) show the resulting data for both the g - jf method of this paper ( solid markers , dotted line ) and the kd method ( open markers , dashed line ) for three different values of the external , one - dimensional pressure @xmath8 , with particle mass and dissipation normalized parameters @xmath136 and @xmath137 , respectively . by inspecting the convergence of @xmath138 to its equilibrium value",
    ", we can find values for the normalized piston parameters that provide efficient relaxation .",
    "for the model system discussed herein , we choose @xmath139 .",
    "the acquired data clearly show that the g - jf method is extremely accurate .",
    "the computed values of both the average and fluctuations of the length agree with the predictions of eqs .",
    "( [ eq : first ] ) and ( [ eq : second ] ) .",
    "the accuracy of the method is also demonstrated in fig .",
    "[ fig : hist ] , where the full length distribution @xmath140 is plotted for @xmath141 and @xmath142 .",
    "the agreement with the analytically calculated exact distribution is perfect .",
    "another important feature of the method , demonstrated in figure [ fig : fig_oa ] , is its robustness against time step variations . in comparison",
    ", we observes in fig .",
    "[ fig : fig_oa ] that the kd method yields the correct result for small @xmath20 , but that the stability range is generally considerably smaller than for the g - jf procedure . in a different set of simulations ( data not shown ) , we used @xmath143 and @xmath144 .",
    "this choice of parameters made the kd barostat unstable for all the simulated values of @xmath20 ( @xmath145 ) , while keeping almost unchanged the stability range of the g - jf method .",
    "the relative robustness of the latter against variations in the piston parameters is yet another merit of this method .",
    "we now consider the simplest possible well - known system in the modeling of materials and liquids , namely a three - dimensional ensemble of identical spherical particles .",
    "each particle has a normalized mass @xmath136 ( in units of @xmath146 ) and normalized friction coefficient @xmath137 , and they all interact through the normalized potential @xmath117 given by the physical pair - potential @xmath147 , where @xmath148 is the normalized pair - distance ( in units if the characteristic length @xmath113 ) and @xmath149 is the characteristic energy .",
    "the normalized pair - potential reads @xmath150 where @xmath151 this function ( see fig .  [",
    "fig : fig_a ] ) is a short - range splined lennard - jones potential with continuity through the second derivative at @xmath152 and continuity through third derivative at @xmath153 .",
    "conducting npt simulations on a cubic system with @xmath154 particles , we optimize the relaxation of the barostat degree of freedom @xmath2 by choosing small values for the inertia @xmath43 . by inspection",
    ", we find that values in the range @xmath143 and @xmath155 represent efficient relaxation .",
    "we also , by inspection , conclude that a small friction coefficient @xmath156 helps relax the system ( although this seems to be a weak effect ) and , therefore , choose this value for our simulations .",
    "we have further chosen two characteristic normalized temperatures , for both solid ( @xmath157 ) and liquid ( @xmath158 ) phases .",
    "finally , we have studied three different applied pressures ( @xmath159 ) ( expressed in units of @xmath160 ) , and varied the discrete normalized time step @xmath20 in the entire range of stability to observe the behavior of the numerical methods .",
    "we only show the @xmath161 data here since the results of all three applied pressures exhibit the same characteristics .",
    "all statistical data are obtained by initiating the system in a close - packed crystal near a zero - temperature ground state .",
    "we then simulate at least 2@xmath16210@xmath163 normalized time units before averages are acquired over the next 2@xmath16210@xmath163 units .",
    "the normalizing time @xmath164 is given by @xmath165 .",
    "all the left axes of the figures display absolute results , while all the right vertical axes display the percentage deviation from the @xmath74 value of the quantity shown in the plot .",
    "figure [ fig : fig_2v ] shows the data for the volume @xmath2 of the simulation box ( @xmath143 : fig .  [ fig : fig_2v]a ; @xmath155 : fig .",
    "[ fig : fig_2v]b ) and its fluctuations ( @xmath143 : fig .",
    "[ fig : fig_2v]c ; @xmath155 : fig .",
    "[ fig : fig_2v]d ) as a function of the time step for a solid phase at @xmath157 and external pressure @xmath161 .",
    "the new g - jf barostat results are displayed as solid markers ( @xmath166 ) , while the comparison kd method results are shown with open markers ( @xmath167 ) .",
    "the data clearly shows that the g - jf results are nearly independent of the time step @xmath20 for both the average volume and the corresponding fluctuations . in comparison ,",
    "the kd method exhibits a consistent , albeit weak , increase in average volume .",
    "more dramatic is the increasing deviation of the volume fluctuations in the kd method . for @xmath143 , this can be in excess of 10% , while we observe up to 70% discrepancy for @xmath155 .",
    "such discrepancies clearly change not only measured thermodynamic properties such as the elastic bulk modulus and heat expansion coefficient , but also the structure of the material under investigation .",
    "for example , close inspection ( not shown ) of the kd simulation shows that the excessive volume fluctuations induce crystal defects into the material for large @xmath168 , before the numerical instability is found for @xmath169 .",
    "notice that the results of both methods converge to the same numbers for small @xmath20 throughout the simulation data , indicating that any deviation from small @xmath20 constitutes a measure of the error induced exclusively by the discrete time step .",
    "the data for the total potential energy @xmath170 are shown in fig .",
    "[ fig : fig_2pot ] .",
    "the results of the g - jf method are also here unimpressed with the simulated time step throughout the stability ranges , while the kd method shows a characteristic positive deviation .",
    "since the kd method coincides with the bbk thermostat @xcite when the volume is constant , this result is entirely expected in light of our previous work on the g - jf thermostat and comparisons @xcite to other thermostats , including bbk .",
    "these results are also consistent with the kinetic temperature @xmath171 measurements shown in figure [ fig : fig_2kin ] , where @xmath171 is defined as    @xmath172    in the g - jf method , the kinetic temperature decreases with increasing @xmath20 .",
    "this is anticipated since , as mentioned in the introduction , it is known that the momentum @xmath173 is _ not _ the conjugate variable to @xmath174 for @xmath175 ( see , e.g. , refs .",
    "@xcite as well as appendix [ appendix_b ] below ) , and that the discrete - time second order approximations ( @xmath176 and @xmath177 ) to the velocity variables from the central difference approach in the verlet formalism leaves kinetic and configurational measures mutually inconsistent .",
    "thus , the very good configurational sampling properties of the g - jf method seen from the measurements of , e.g. , volume and enthalpy ( along with their fluctuations ) inevitably mean that a measurement [ such as @xmath171 in eq .",
    "( [ eq : eq_tk ] ) ] derived from the ( incorrect ) velocities will be incorrect to second order in @xmath20 . this is a simple consequence of @xmath176 being an _ approximation _ to the true velocity of @xmath174 , which can not be obtained .",
    "figure [ fig : fig_2kin ] further displays the measured kinetic temperature @xmath171 for the kd method , and it is apparent that this quantity appears to confirm the required temperature , which is consistent with the _ incorrect _ configurational properties of this method seen for volume and enthalpy as @xmath20 is increased .",
    "this artifact of discrete time emphasizes that one should refrain from using kinetic measures as reliable quantities in these types of simulations .",
    "we now show results for a liquid phase at @xmath158 .",
    "otherwise , all system and simulation parameters are exactly as for the @xmath157 results shown above",
    ". the liquid phase is validated by structural analysis and through the measured diffusion constant , which we derive from the einstein definition @xmath178 we use time averages over @xmath179 for all chosen values of @xmath20 , and @xmath180 is understood to extend beyond the interval @xmath181 in this expression @xcite .",
    "figure [ fig : fig_3d ] displays the non - zero measured diffusion coefficient of the liquid state as a function of the time step .",
    "it is clear that the migration at this temperature and pressure is weak , and that the diffusion measurement is noisy .",
    "even so , the figure demonstrates that both g - jf and kd methods exhibit diffusion coefficients reasonably independent of the choice of the size of time step , although there may be a hint of a slight increase for the kd method for increasing @xmath20 .",
    "figure [ fig : fig_3v ] shows the @xmath158 data for the volume @xmath2 of the simulation box .",
    "the kd results for both average and fluctuation of the volumes exhibit significant increases with @xmath20 , consistent with the comparable @xmath157 data .",
    "the g - jf results are much less impressed by the time step @xmath20 , but there is a small tendency for the volume and its fluctuations to decrease with increasing @xmath20 . however , the overall impression is clearly that the g - jf method is significantly less dependent on variations in @xmath20 than the kd method is .",
    "the @xmath158 data for the potential energy are shown in fig .",
    "[ fig : fig_3pot ] .",
    "the kd results for this liquid phase exhibit the typical bbk behavior that was also seen in fig .",
    "[ fig : fig_2pot ] for the solid phase at @xmath157 . in comparison ,",
    "the potential energy shows only a slight decrease in both average and fluctuations for the g - jf method .",
    "it is again clear that the g - jf method produces simulated matter with configurational properties nearly independent of @xmath20 .",
    "the uncertainty on the acquired averages can be assessed from the associated standard deviations and the averaging time .",
    "we here also include a multiple of simulation data for the same parameters in order to indicate the magnitude of the statistical error that should be associated with the presented standard deviations .",
    "we confirm that the kinetic measurements of temperature and its fluctuations behave similarly in the liquid and solid phases by comparing figs .",
    "[ fig : fig_2kin ] and [ fig : fig_3kin ] .",
    "the latter shows the data for @xmath158 , which again demonstrates the signature of the momentum @xmath182 not exactly being the conjugate variable to @xmath13 .",
    "thus , also for the liquid phase , we observe that the calculated discrete - time kinetic temperature is progressively short of the actual temperature of the configurational sampling statistics that can be inferred from the potential energy measurements in figure [ fig : fig_3pot ] .",
    "we finally turn to investigating the pressure .",
    "clearly , one should expect that the average internal pressure @xmath183 is controlled and equal to the imposed external pressure @xmath8 , since this is the principal purpose of the barostat .",
    "it is important to note that the internal pressure is defined differently in the g - jf and kd methods ( see discussion above in section [ sec : method ] ) .",
    "the former uses the canonical ensemble definition [ see eq .",
    "( [ eq : presgjf ] ) ] @xmath184 while the latter targets the microcanonical ensemble expression [ see eq .",
    "( [ eq : presandersen ] ) ] @xmath185 for each method we inspect the statistics of the relevant internal pressure .",
    "the results for the solid phase simulations at @xmath157 are displayed in figure [ fig : fig_2p ] . from the data , it is obvious that the imposed pressure is correctly adopted by the g - jf method presented here .",
    "the kd method , however , displays a curious and perhaps significant deviation from the expected .",
    "the origin of these deviations is the time reversible discretization used in the kd method ( see sequential steps ( 1)-(7 ) in sec .  v of ref .",
    "@xcite ) , that applies a trapezoidal approximation [ @xmath186 to the configurational pressure contribution [ first term on rhs of eq .  ( [ eq : cont_time_press ] ) ] , while using a mid - point approximation ( @xmath187 ) to the kinetic part [ second term on rhs of eq .",
    "( [ eq : cont_time_press ] ) ] .",
    "therefore , the discrete - time instantaneous pressure @xmath188 corresponding to the expression ( [ eq : cont_time_press ] ) is different from , and inconsistent with , the enforced pressure in the kd method for @xmath175 .",
    "this inconsistency is visible in figure [ fig : fig_2p ] , where the marker @xmath167 shows the average of the instantaneous pressure calculated from eq .",
    "( [ eq : eq_inst_press ] ) .",
    "the data exhibits a quadratically increasing deviation between the enforced and measured internal pressures as @xmath20 is increased .",
    "an measure of the internal pressure , more consistent with the enforced value @xmath8 , is found from @xmath189 which is shown by the markers @xmath190 .",
    "this measure of pressure seems properly enforced for all time steps @xmath20 .",
    "the fluctuations , defined as the standard deviation @xmath191 , of the internal pressure show very reasonable robustness of the g - jf method against @xmath20 variations , although we do observe up to about 5% error for @xmath20 very close to the stability limit . in comparison ,",
    "the kd method shows larger deviations , especially for the measure of the internal pressure defined by eq .",
    "( [ eq : eq_kd_press ] ) .",
    "we thus conclude that within the kd method , neither @xmath192 nor @xmath193 exhibit statistics that is insensitive to variations in @xmath20 .",
    "figure [ fig : fig_3p ] shows the acquired statistics of the measured pressure and its fluctuations as a function of the time step for the liquid phase at @xmath158 .",
    "the overall behavior of the methods is the same for liquid and solid phases with direct averages of the instantaneous pressure eq .",
    "( [ eq : eq_inst_press ] ) being significantly depressed for the kd method as @xmath20 is increased .",
    "we also see that the fluctuations of the kd pressure is fairly independent of @xmath20 for @xmath143 , while the fluctuations of the pressure @xmath193 increase dramatically for @xmath155 .",
    "the g - jf method is generally robust , although we do observe some increase in pressure fluctuations for @xmath155 .",
    "we note that improved statistical accuracy of kinetics using half - step velocities @xmath187 in the so - called leap - frog versions of the verlet method have been investigated @xcite for deterministic nos - hoover control of temperature and pressure .",
    "however , while the half - step velocities may be able to produce better consistency for the averaged kinetic temperature in deterministic dynamics , these approaches may neither translate to stochastic dynamics nor resolve the fundamental question of calculating instantaneous pressure ( at times @xmath17 ) for statistical averages and fluctuations , as illustrated above .",
    "we have presented and demonstrated a new thermostat - barostat pair for simulating atomic and molecular dynamics with periodic boundary conditions .",
    "the new g - jf method is simple and stable , and simulations of thermodynamic properties produce data with very little dependency on the applied numerical time step .",
    "we have investigated the method in the context of two characteristic models - a one - dimensional toy model with known statistical solutions , and the classical three - dimensional lennard - jones material , simulated in both crystalline and liquid phases . in all cases",
    "the g - jf method behaves extremely well for measured averages as well as for their fluctuations . in comparison ,",
    "the state - of - the - art kd method , which is also representative of other commonly used methods , may exhibit significant deviations in both averages and fluctuations for increasing time steps . as we have emphasized throughout this paper , and specifically in appendix [ appendix_b ] , it is crucial to appreciate that discrete time invalidates the conjugate relationship between the coordinate @xmath67 and its simulated velocity @xmath77 .",
    "consequently , one _ can not _ expect accurate simulation measures for both configurational and kinetic quantities using any given method .",
    "this interesting and essential feature becomes apparent when comparing the behavior of kinetic and potential energies as a function of time step variations .",
    "we submit that the g - jf thermostat and barostat are advantageous in that they consistently provide proper configurational properties ( such as boltzmann distributions , einstein diffusion , potential energy , pressure , system volume , as well as their fluctuations ) , while leaving kinetic measures ( such as measured kinetic energy and the derived kinetic temperature ) with predictable deviations .",
    "in contrast , most other methods ( e.g. , kd , nos - hoover , etc . ) enforce the expected kinetic measures , thereby sacrificing the accuracy of proper configurational sampling .",
    "the latter is unfortunate , since _ most molecular simulations are conducted in order to obtain configurational information_.    we close by noting that the g - jf method is easily extended to non - isotropic volume adjustments , and that the algorithm is not only simple , but also in a form that makes it easy to implement into existing molecular dynamics codes that have thermodynamic temperature and pressure control .",
    "specifically , the method can also conveniently be expressed in the so - called leap - frog and position - verlet forms , as outlined for the thermostat in ref .",
    "@xcite .",
    "this work was supported by the us department of energy , project # de - ne0000536000 , and by the israel science foundation ( isf ) , grant no .",
    "the continuous - time expectation , that the momentum @xmath194 is the conjugate variable to the spatial coordinate @xmath13 , is _ not _ fulfilled in discrete - time verlet methods .",
    "this unfortunate consequence of time discretization has significant implications for the use and interpretation of simulations , and it can be illuminated by considering a the simple analysis of a simulated harmonic oscillator @xcite , @xmath195 where @xmath196 is a hooke s spring constant . the continuous - time solution to this equation is , of course , @xmath197 and @xmath198 , where @xmath199 .",
    "( we use @xmath200 for complex notation in this appendix . )    the discrete - time verlet equations for eq .",
    "( [ eq : eq_harmonic_cont ] ) are found from eqs .",
    "( [ eq : verlet_r ] ) and ( [ eq : verlet_v ] ) : @xmath201 the solution is @xmath202 with the oscillation frequency @xmath203 of the discrete - time verlet oscillator given by @xmath204 for @xmath205 ( see , e.g. , refs .",
    "@xcite ) . inserting eq .",
    "( [ eq : eq_harm_sol_r ] ) into eq .",
    "( [ eq : eq_harmonic_v ] ) , we get the verlet velocity @xmath206 which , when compared to eq .",
    "( [ eq : eq_harm_sol_r ] ) , shows that the verlet velocity is _ always _ depressed in magnitude compared to the true velocity of @xmath13 when @xmath207 . for the extreme case of the stability limit , @xmath208 ( @xmath209 ) , we find @xmath210 , even if @xmath211 changes every time step .",
    "it is obvious from the above analysis that the verlet velocity is not an accurate representation of the discrete time trajectory , and that any kinetic measure , such as kinetic energy , temperature or diffusion derived from velocity autocorrelations , can not reliably represent the behavior of the simulated configurational evolution ( see also discussion in the appendix of ref .",
    "@xcite ) .",
    "notice the importance of using the einstein expression for diffusion , since this form directly measures the displacement of the coordinates . using velocity autocorrelation for estimating",
    "diffusion is valid only for @xmath74 for the reasons discussed in appendix [ appendix_b ] and commented on in ref ."
  ],
  "abstract_text": [
    "<S> we present a new and improved method for simultaneous control of temperature and pressure in molecular dynamics simulations with periodic boundary conditions . </S>",
    "<S> the thermostat - barostat equations are build on our previously developed stochastic thermostat , which has been shown to provide correct statistical configurational sampling for any time step that yields stable trajectories . here </S>",
    "<S> , we extend the method and develop a set of discrete - time equations of motion for both particle dynamics and system volume in order to seek pressure control that is insensitive to the choice of the numerical time step . </S>",
    "<S> the resulting method is simple , practical , and efficient . </S>",
    "<S> the method is demonstrated through direct numerical simulations of two characteristic model systems - a one dimensional particle chain for which exact statistical results can be obtained and used as benchmarks , and a three dimensional system of lennard - jones interacting particles simulated in both solid and liquid phases . </S>",
    "<S> the results , which are compared against the method of kolb & dnweg , show that the new method behaves according to the objective , namely that acquired statistical averages and fluctuations of configurational measures are accurate and robust against the chosen time step applied to the simulation . </S>"
  ]
}