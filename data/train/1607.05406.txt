{
  "article_text": [
    "the nature of dark matter remains a mystery in the current paradigm of structure formation ( see * ? ? ?",
    "* for a review ) .",
    "although many experiments have been proposed to directly detect signatures of dark matter , such as particle annihilation , particle decay , and interaction with other particles ( see * ? ? ?",
    "* for a review ) , the main avenue to probe the existence and properties of dark matter is still through the gravitational potentials associated with the structures in the dark matter distribution .",
    "one promising way to detect the gravitational effects of dark matter structures is through their gravitational lensing effect , in which light rays from distant sources are bent by foreground massive objects such as galaxies or clusters of galaxies residing in massive dark matter halos . in the case of galaxies ,",
    "the multiple images prediction was first observationally confirmed by @xcite . since then more and more strong lensing systems were found and analyzed ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "in addition , smaller distortions in galaxy images have been detected in large surveys , such as sdss , cfhtls , and subaru weak lensing surveys .",
    "these are referred to as weak lensing effects and have been studied very extensively in the past decade @xcite .",
    "weak gravitational lensing studies are further sub - divided into two categories : lensing effects based on individual massive systems , such as clusters of galaxies , galaxy - galaxy lensing , which relies on the stacking of lensing signals around many galaxies . for a deep survey such as cfhtlens @xcite , des @xcite , dls @xcite , euclid @xcite , lsst @xcite , kids @xcite and subaru weak lensing survey @xcite ,",
    "the number density of background galaxies around a single cluster is sufficient to measure the weak lensing signals with high s / n ratio , so that the mass and shape of the dark matter distribution can be obtained @xcite . for shallower surveys and for less massive systems , such as sdss @xcite ,",
    "stacking lensing signals around many systems is the only way to measure the weak lensing effects with sufficient s / n ratio .",
    "although unable to give dark matter distributions associated with individual systems , galaxy - galaxy lensing provides a powerful tool to estimate the average mass and profile of dark matter halos around galaxies with certain properties , as the luminosity , stellar mass , etc .    in principle , weak gravitational lensing can provide a clean measurement of the total mass distribution of the lens system .",
    "however , the lensing signals are weak and a number of effects need to be understood and modeled accurately to obtain reliable results .",
    "these include uncertainties in photometric redshifts , intrinsic alignment , source selection bias and mask effect @xcite .",
    "in addition , accurate image measurements are absolutely essential in galaxy - galaxy lensing studies .",
    "thus , for any weak lensing survey , an image processing pipeline has to be developed first and validated by a series of test simulations , such as step ( shear testing program ) @xcite , great08 @xcite , great 10 @xcite , great3 @xcite or kaggle  the dark matter mapping competition .",
    "other independent softwares , such shera ( * ? ? ?",
    "* hereafter m12 ) , have also been designed for specific surveys .",
    "many groups have developed image processing pipelines devoted to improving the accuracy of shape measurements for weak lensing studies @xcite . among these",
    ", lensfit @xcite applies a bayesian based model - fitting approach ; bfd ( bayesian fourier domain ) method @xcite carries out bayesian analysis in the fourier domain , using the distribution of un - lensed galaxy moments as a prior , and the fourier_quad method developed by @xcite uses image moments in the fourier domain .    in this paper",
    "we attempt to develop an image processing pipeline for weak lensing studies by combining the ( * ? ? ?",
    "* herefater bj02 ) method ( see appendix [ bj02_detail ] for details ) with the re - gaussianization method introduced in ( * ? ? ?",
    "* hereafter hs03 ) .",
    "we test the performance of our pipeline using a number of commonly adopted simulations , and we apply our method to the sdss data .",
    "the structure of the paper is as follows . in section [ sec_method ]",
    ", we describe the procedures used to construct our image processing pipeline .",
    "the pipeline is tested using simulations in section [ sec_test ] .",
    "section [ sec_application ] presents the application of our pipeline to the sdss dr7 data , along with the galaxy - galaxy lensing results obtained for galaxies of different luminosities and colors .",
    "finally , we summarize our results in section [ sec_summary ] . in addition",
    ", some details of our method are given in appendix  [ bj02_detail ] , some tests on systematic errors are made in appendix [ sec_systematic ] , and our main results for the sdss data are listed intables presented in appendix [ sec_esd ] .",
    "all the galaxy - galaxy lensing data shown in this paper can be downloaded from http://gax.shao.ac.cn/wtluo/weak_lensing/wl_sdss_dr7.tar.gz .",
    "the goal of our pipeline is to measure , for each observed galaxy image @xmath1 , two ellipticity parameters @xmath2 and @xmath3 ( to be defined below ) that describe the intrinsic shape of the galaxy .",
    "however , the observed image is the convolution between the intrinsic galaxy image @xmath4 and the psf @xmath5 , @xmath6 where @xmath7 stands for the intrinsic galaxy surface brightness and @xmath5 is the psf .",
    "formally , the impact of the psf on the ellipticity parameters can be written as @xmath8 where @xmath9 .",
    "psf anisotropy causes a non - zero additive error @xmath10 , while psf smearing causes a non - zero multiplicative error @xmath11 .",
    "the challenge is to develop a reduction pipeline that minimize both @xmath12 and @xmath13 .",
    "our pipeline consists of the following steps :    * create a kernel function @xmath14 to correct for the psf anisotropy ( see  [ psf_ani ] for details ) .",
    "* convolve both @xmath1 and @xmath5 with the kernel function @xmath14 , so that we have @xmath15 and @xmath16 .",
    "* measure the sizes @xmath17 and @xmath18 , as well as the ellipticity parameters @xmath2 and @xmath3 , from the surface brightness weighted second moments of @xmath19 and @xmath20 , @xmath21 and @xmath22 , respectively , using the adaptive gaussian kernel method as described in ",
    "[ shape_params ] .",
    "* re - gaussianize @xmath20 and @xmath19 using the method of hs03 .",
    "this results in @xmath23 and @xmath24)$ ] . here",
    "@xmath25 and @xmath26 are 2d gaussian functions reconstructed from the same second moments @xmath22 and @xmath21 obtained from @xmath20 and @xmath19 . *",
    "expand @xmath27 and @xmath28 in terms of the quantum harmonic oscillator ( qho ) eigenfunctions , as described in ",
    "[ psf_ani ] .",
    "compute @xmath29 and @xmath30 , where @xmath31 and @xmath32 are the coefficients of the qho expansions of @xmath27 and @xmath28 , respectively . *",
    "calculate the resolution factor @xmath33 , which is defined as , @xmath34 and correct the ellipticity parameters according to @xmath35 and @xmath36 . *",
    "rotate @xmath37 , which are measured with respect to the coordinates of the ccd image ( i.e. , @xmath2 is measured in the direction of ccd pixel rows ) , such that @xmath2 is aligned with the direction of increasing right ascension .",
    "this is achieved by the transformation : @xmath38 where @xmath39 is the angle between the north and the direction of the ccd columns , and is provided in the header of each ccd image .",
    "* background noise of each galaxy is estimated from both the sky and the dark current as in ( * ? ? ?",
    "* hereafter m05 ) , @xmath40 where @xmath41 is the size of the galaxy in pixels , @xmath42 is the flux and @xmath43 is the sky and dark current brightness in photons per pixel .",
    "the end result of our pipeline is a catalog listing for each source image the values , @xmath44 , @xmath45 , @xmath33 , @xmath46 , @xmath47 , @xmath48 , @xmath49 , where @xmath47 , @xmath48 , @xmath49 are the ra , dec and photometric redshift of the source ( galaxy ) .",
    "note that we explicitly list @xmath33 since it is a common practice in galaxy - galaxy lensing measurements to only select images with @xmath33 exceeding some limiting value . throughout this paper",
    "we follow m05 and only use images with @xmath50 .",
    "there are two systematics associated with the psf .",
    "one is an isotropic smearing of the original image and the other is an anisotropic effect which introduces extra shape distortion . our image processing pipeline is designed to correct for both effects .",
    "more specifically , we use the rounding kernel method of bj02 for the anisotropic correction and the re - gaussianization method of hs03 for the isotropic correction .",
    "the reason for this combination is that , according to our test with step2 data , the multiplicative error it produces is the smallest among the other methods ( e.g. bj02 method alone , re - gaussianization method alone , and the ksb method ) . in this subsection ,",
    "we focus on the psf anisotropy correction .",
    "the basic idea of the rounding kernel method of bj02 for psf anisotropy corrections is to convolve the psf with a reconstructed kernel . in the ideal case ,",
    "the fourier transformation of the kernel @xmath51 is related to the psf as @xmath52 so that the convolution of @xmath51 and @xmath53 in real space is a delta function . in that case",
    "we have : @xmath54 and @xmath55 where @xmath56 is the observed image , @xmath57 the intrinsic image , and @xmath58 represents the reconstructed kernel [ see eqs.(7.1 ) - ( 7.4 ) in bj02 ] . in real applications ,",
    "the psf is not modeled perfectly , a better kernel approximation is needed to serve our purpose . to this end , we expand the psf with the quantum harmonic oscillator ( qho ) eigenfunctions , @xmath59 and write its convolution with @xmath51 as @xmath60 where @xmath61 @xmath62 are the laguerre polynomials obeying @xmath63 and @xmath64 is the size of the object in pixel units . if @xmath65 satisfies @xmath66\\delta_{pq}\\ ] ] up - to some order @xmath67 ,",
    "the psf anisotropy is then ideally removed by the reconstructed kernel .",
    "note that @xmath68 can be set to 0 if the psf centroid is properly measured , and the dominant bias is introduced by @xmath69 , @xmath70 and so on ( see appendix [ bj02_detail ] for details ) .      in this subsection",
    ", we outline a few parameters that are important in galaxy - galaxy lensing shear measurements as well as in our image processing pipeline .",
    "the shape parameters , @xmath2 and @xmath3 , are obtained from the surface brightness - weighted second moment of the 2-dimensional galaxy image @xcite , @xmath71 where @xmath72 and @xmath73 is the surface brightness at the pixel located at @xmath74 .",
    "the function @xmath75 is an adaptive gaussian kernel ( see section 2.1 in hs03 ) used to avoid divergent noise @xcite : @xmath76,\\ ] ] with @xmath77 being the centroid vector : @xmath78    following convention , the ellipticity parameters @xmath2 and @xmath3 are respectively defined as the compressions along a fiducial direction ( e.g. @xmath79 ) and along a direction rotated 45 degrees with respect to it .",
    "the size @xmath80 is defined as the trace of the moment tensor .",
    "thus , @xmath81      psf isotropic effect a.k.a smearing effect , dilutes the value of ellipticity and therefore leads to shear underestimation .",
    "the method we adopt here to correct this effect is the re - gaussianization method from hs03 .",
    "it consists of applying a resolution factor @xmath82 ( eq . [ eq : eq_r ] ) to correct for the ellipticity parameters .",
    "note , however , as pointed out in hs03 , eq . [ eq : eq_r ] ( eq .",
    "14 in hs03 ) is only valid when both psf and galaxy images are gaussian , which does not apply to real observations .",
    "hs03 reconstructed a gaussian psf model using the second moments from the psf , and then corrected the galaxy image for the effect of the residuals .",
    "we assume that , eq .",
    "[ eq : eq_r ] is valid after these treatments .",
    "the related processes are called re - gaussianization and carried out as follows .",
    "we first construct a gaussian psf from the real psf @xmath5 using the second moment covariance matrix @xmath83 , @xmath84 with the residual being , @xmath85 the galaxy image @xmath1 then satisfies @xmath86 where @xmath87 is the intrinsic brightness distribution of the galaxy .",
    "next , we approximate the galaxy image also with a gaussian distribution from its second moments matrix , @xmath88 , @xmath89 where @xmath90 denotes the galaxy second moments matrix once the psf contribution has been subtracted .    finally , an image , corrected for the residual between real psf and gaussian psf , is obtained using @xmath91 in our pipeline , we compute the @xmath92 from @xmath93 and @xmath75 .      once we have processed all the source images , we can obtain the shear signals @xmath94 along any desired directions .",
    "we first compute the responsiveness @xmath95 of our survey galaxies which is defined as @xmath96 where @xmath97 is the total number of source images with @xmath50 .",
    "next we compute the shear components @xmath98 and @xmath99 using all the images sampling the local shear field : @xmath100 where @xmath101 and @xmath102 is a weighting function .",
    "each source image is weighted by @xmath103 where @xmath104 is the background noise estimated using eq .",
    "[ eq : sky ] and @xmath105 is the shape noise . for a sample of background galaxies ,",
    "the shape noise is defined as the variance of their ellipticities .",
    "observationally , the tangential shear @xmath106 as a function of radius around foreground lens galaxies is estimated as @xmath107 where @xmath108 is given by @xmath109 with @xmath110 the angle between the line connecting the lens and the source and the direction of increasing right ascension .",
    "so defined , @xmath108 is the shape parameter along the tangential direction around the lens .",
    "before applying our pipeline to real data , we benchmark test it using simulated images . these contain input shear signals as well as observational effects , such as psf , sky background noise and pixellization .",
    "the two simulations catalogs used here are shera ( shear reconvolution analysis ) developed by m12 , and great3 as described in @xcite .",
    "shera ( m12 ) is designed to test the accuracy of shape measurement pipelines for ground - based images .",
    "it uses cosmological evolution survey ( cosmos ) images as input .",
    "the output are low - resolution images expected from a given ground - based observation .",
    "parameters such as pixel size , psf size , and sky background , are set in accordance to sdss data .",
    "the weak lensing shear signal is added to each image using the following equation : @xmath111 where @xmath112 are the un - lensed coordinates , and @xmath113 the lensed ones .",
    "the input shear @xmath114 are randomly generated ranging from @xmath115 to @xmath116 .",
    "the input galaxy image catalog is constructed from cosmos acs field @xcite following the method described in @xcite .",
    "the survey field is a @xmath117 square degree region centered at 10:00:28.6@xmath1180.l2:12:21.0 ( j2000 ) .",
    "the images are corrected for charge transfer inefficiency ( * ? ? ?",
    "* cti ) , geometric distortion , sky subtraction and cosmic rays , and are further dithered using multi - drizzle algorithm .",
    "the final production is a co - added image of @xmath119 pixels with a scale of 0.03\" / pixel .",
    "further cuts are applied to fulfill the special requirements of shera , as described in @xmath120 of m12 .    with the above criteria , 30,225",
    "galaxies are selected . to mimic the sdss images ,",
    "additional galaxies are discarded either because these sources are undetectable in sdss or because their sizes are smaller than the sdss psf , as detailed in m12 .",
    "the final sample contains 26,113 galaxies .",
    "the high resolution images obtained above are transformed into low resolution ones by psf matching , i.e. by first de - convolving the images with the space psf and then convolving them with the ground - based psf . in fourier space , this is mathematically given by @xmath121 where @xmath122 and @xmath123 are the ground - based brightness distribution and psf , respectively , whereas @xmath124 and @xmath125 are the corresponding space - based quantities .",
    "this psf matching works as long as the power spectrum of the space psf is larger than the one of the ground psf for all @xmath126 ; otherwise it leads to ringing effect in the new image .",
    "as shown in fig.2 of m12 , the power spectrum of sdss psf is smaller than the one of cosmos at all wave numbers , and so the psf matching can be done safely .",
    "in addition to the psf , the noise level at the position of cosmos in the sdss imaging should also be taken into account .",
    "[ fig : image ] shows the cosmos image of a typical disk galaxy ( left ) , the shera simulated sdss image ( middle ) and the real sdss fpatlas image ( right ) of the same galaxy .",
    "the bulge and disk components can be clearly identified from the original cosmos image , whereas in sdss only a small number of pixels brighter than the detection limit ( 22.0 in r band ) can be identified .",
    "we downgrade the high resolution cosmos images to low resolution sdss images . during this process",
    ", we miss 2.2 percent of the objects because of masking , which leaves a total of 25,527 images .",
    "( upper left ) and @xmath99 ( lower left ) .",
    "the corresponding residuals are plotted against the input values in the right panels .",
    "the red lines are linear fits.,width=302 ]    using the mock sdss images obtained above , we follow m12 and rotate each image 90 degree in order to eliminate the effect from intrinsic galaxy shape . in the spirit of making a fair comparisons with the results of m12 , the sky background and poisson noise are not added to the simulation , so as to assess the performance of the psf correction alone .",
    "due to the size cut , only about 11,700 ( 44% ) galaxies are selected for the final shear measurements .",
    "we measured the two shear components @xmath127 and @xmath128 , and compare them to the input signals in fig . [",
    "fig : shera ] .",
    "the upper - left and low - left panels are the one - to - one correlations for the two components , while the right panels are the corresponding residuals plotted against the input signals .",
    "the red lines are the linear fit to the data points .",
    "we use the standard terminology of multiplicative error ( including psf smearing effect and other unknown bias in the measurement method itself ) and additive error ( mostly from psf anisotropy ) to relate the input signal and the measured signal : @xmath129 where @xmath130 and @xmath131 represent the two types of errors . in general",
    ", our pipeline achieves @xmath132 in the multiplicative error , with @xmath133 and @xmath134 , and @xmath135 in the additive error , with @xmath136 and @xmath137 .",
    "the fact that the multiplicative error in @xmath99 is larger than the one in @xmath98 is due to pixellization . in @xcite",
    "the corresponding multiplicative errors are @xmath138 and @xmath139 , and the additive errors are @xmath140 and @xmath141 .",
    "these values demonstrate that the performances of the two pipelines are favorably comparable .",
    "however , some shortcomings of our pipeline appear during our tests .",
    "when strong sky background and poisson noise are added , our pipeline sometimes suffers from non - convergence either during the calculation of the adaptive moments or during the estimation of the coefficients ( see eq .",
    "[ eq : kernel ] in appendix [ bj02_detail ] ) .",
    "thus , our pipeline can not provide shape measurements for images with too low qualities .",
    "this reduces the number of sources that can be used for lensing studies .",
    "due to the fact that the cosmos image sample is small , we do not perform further tests with noise as in m12 .",
    "the convergence problem is also not discussed further , because it is difficult to determine whether it is caused by the iteration of adaptive moments or by the procedure constraining the @xmath142 ( see appendix [ bj02_detail ] ) . nevertheless , as we will show in next subsection , even with the reduced number of sources , our pipeline provides lensing signals that are competitive to other methods or implementations .",
    "great3 ( gravitational lensing accuracy test 03 ) @xcite is the continuation of the testing projects step ( shear testing program , * ? ? ?",
    "* ) , step2 @xcite , great08 @xcite and great10 @xcite .",
    "all of these code comparison projects are designed to compare the performances of different shape measurement methods in different observational conditions . from step to great3 , different psfs , pixel sizes , galaxy morphologies are adopted . in particular , great3 uses controlled galaxy morphologies generated with shapeless @xcite , real galaxy morphologies obtained from cosmos , co - added multiply observed images , variable psf , and variable shears .",
    "five major branches of simulations are generated using galsim @xcite : ( i ) a controlled sample generated with parametric ( single or double srsic ) galaxy models ; ( ii ) real galaxy sample with realistic morphology from hst comos dataset ; ( iii ) multiple - epoch sample containing six images combined by dithering ; ( iv ) sample with variable psf that is reconstructed from star images ; ( v ) a sample that includes all the above procedures .",
    "each major branch is further divided into ground versus space , and constant versus variable shear sub - branches .    for the constant shear datasets ,",
    "10,000 galaxies with shear are simulated . in order to cancel the effect of galaxy intrinsic shape",
    ", great3 applies the same rotation method as in the step2 simulation @xcite .",
    "the basic idea is to use the fact that the shape is a spin - two quantity , meaning that the sum of the original and 90-degree rotated ellipticity is zero .",
    "our pipeline participated in the controlled ground constant , the controlled space constant , the real ground constant and the real space constant tests .",
    "we labelled our implementation as bj02+hs03 within this project .",
    "overall , it ranks 15 among a total of 26 participating pipelines .",
    "as mentioned earlier , our pipeline suffers from a non - convergence problem . together with the size cut using the resolution factor in eq .",
    "( [ eq : eq_r ] ) , only about 40% galaxies are used in the competition . among our submissions",
    ", we found that the best weighting scheme for our pipeline was to take the inverse of the shape noise and errors from ellipticity as in ( * ? ? ? * herefater m15 ) .",
    "the more detailed information and results about the great3 competition can be found in m15 .",
    "since our pipeline proved to be reliable , we processed the sdss dr7 @xcite @xmath0 band imaging data .",
    "the sdss @xcite consists of three imaging and spectroscopic surveys ( legacy , segue , and supernova ) , using a 2.5 m telescope at apache point observatory in southern new mexico .",
    "the sdss photometric camera has two tdi ( time - delay - and - integrate ) ccd scanning arrays @xcite .",
    "one is a @xmath143 ccd array , with each of the ccd having @xmath144 pixels ( 24 @xmath145 on the sky ) for five - band photometry , and the other is a 24 @xmath146 ccd array used for astrometry and focus monitoring . the dr7 imaging data , with _",
    "g _ , _ r _ , _ i _ and _ z _ band , covers about 8423 square degrees of the legacy sky ( @xmath147230 million distinct photometric objects ) and about 3240 square degrees of segue sky , ( @xmath147127 million distinct objects , including many stars at low latitude ) .",
    "the total number of objects identified as galaxies is around 150 million .",
    ".[tab : tbl-1 ] properties of the six lens samples created for this paper .",
    "we indicate the number of galaxies in the equivalent samples in @xcite @xmath148 , to be compared to our number @xmath149 [ cols=\"^,^,^,^,^,^,^\",options=\"header \" , ]"
  ],
  "abstract_text": [
    "<S> as the first paper in a series on the study of the galaxy - galaxy lensing from sloan digital sky survey data release 7 ( sdss dr7 ) , we present our image processing pipeline that corrects the systematics primarily introduced by the point spread function ( psf ) . using this pipeline , we processed sdss dr7 imaging data in @xmath0 band and generated a background galaxy catalog containing the shape information of each galaxy . based on our own shape measurements of the galaxy images from sdss dr7 </S>",
    "<S> , we extract the galaxy - galaxy ( gg ) lensing signals around foreground spectroscopic galaxies binned in different luminosity and stellar mass . </S>",
    "<S> the overall signals are in good agreement with those obtained by @xcite from the sdss dr4 . </S>",
    "<S> the results in this paper with higher signal to noise ratio is due to the larger survey area than sdss dr4 , confirm that more luminous / massive galaxies bear stronger gg lensing signal . </S>",
    "<S> we also divide the foreground galaxies into red / blue and star forming / quenched subsamples and measured their gg lensing signals , respectively . </S>",
    "<S> we find that , at a specific stellar mass / luminosity , the red / quenched galaxies have relatively stronger gg lensing signals than their counterparts especially at large radii . </S>",
    "<S> these gg lensing signals can be used to probe the galaxy - halo mass relations and their environmental dependences in the halo occupation or conditional luminosity function framework . </S>",
    "<S> our data are made publicly available in http://gax.shao.ac.cn/wtluo/weak_lensing/wl_sdss_dr7.tar.gz . </S>"
  ]
}