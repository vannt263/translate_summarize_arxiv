{
  "article_text": [
    "in ( * ? ? ? * hereafter paper i ) we described an adaptive , lagrangian , meshless , method for magnetohydrodynamics ( mhd ) .",
    "we now describe the parallel implementation of this algorithm and its tests , and discuss its practical properties .",
    "the test problems used are selected from the accepted ones in the literature ; many follow those documented for athena @xcite , and those used by @xcite , and @xcite .",
    "the three goals of the tests are to verify the convergence to smooth solutions of the mhd equations , demonstrate the global conservation properties and shock errors , and finally to verify the ability of phurbas to model the linear growth of magnetorotational instability correctly .    in   [ sec_implementation ]",
    "we describe how we have implemented our algorithm into a parallel code called phurbas using the gadget-2 code @xcite as a basis .",
    "we describe the tests that we have performed with this implementation in   [ sec_tests ] . we summarize the results of the tests , and discuss the implications and future prospects for phurbas - like methods in   [ sec_discussion ] .",
    "phurbas is a parallel code using the message passing interface , following the patterns of the gadget-2 code @xcite , which originally combined a smoothed particle hydrodynamics ( sph ) treatment of gas dynamics with a tree solution of the poisson equation to follow n - body dynamics .",
    "the serial particle update module described in paper  i has been incorporated into a modified version of gadget-2 that has been re - purposed to serve as a parallel framework .",
    "we refer to the version documented in this work as phurbas version 1.1 to allow for the differentiation of future modifications to the algorithm and the code .",
    "( we note that tests of phurbas 1.0 were described in the first submitted version of this paper , posted to arxiv as version 1 of this paper . )",
    "we summarize here the algorithm described in detail in paper i. phurbas solves the equations of ideal mhd , expressed in terms of lagrangian time derivatives .",
    "the equations are discretized on an adaptive set of particles that carry values of the field variables ( density @xmath1 , velocity @xmath2 , magnetic field @xmath3 , and internal energy density @xmath4 ) .",
    "the particles move with the velocity @xmath2 that they carry , making the lagrangian formalism the natural description of the time evolution of the field variables .",
    "the evolution equations relate time derivatives of the field variables to their spatial derivatives . to calculate the spatial derivatives",
    ", phurbas uses a local , third - order , polynomial , moving least squares interpolation , using neighbor particle values drawn from a sphere of radius @xmath5 about particle @xmath6 , where @xmath7 is the effective resolution parameter .",
    "a second order predictor - corrector scheme is used with the time derivatives obtained by applying the mhd equations to the approximate spatial derivatives to advance the particle positions and variable values .",
    "particles are added and deleted , filling voids and destroying clumps , to ensure that each sphere of radius @xmath8 is well sampled . on average ,",
    "the particle creation and deletion results in at least one particle per volume @xmath9 .",
    "the resolution parameter @xmath10 need not be constant in space or time , and each particle has an individual time step . in this sense phurbas is fully adaptive both spatially and temporally .",
    "the time steps are independent of the bulk velocity of the flow .",
    "spatial variation of the time steps is limited to prevent the penetration of short time step particles into regions of long time step particles .    to obtain numerical stability",
    ", phurbas integrates a modified version of the ideal mhd equations including a bulk viscosity .",
    "the bulk viscosity coefficient is broken into two scalar fields .",
    "the first is scaled so that motions near the grid scale are always damped .",
    "the second adapts to provide damping in regions with large change , such as shocks and contact discontinuities .",
    "a diffusive correction term in the induction equation locally diffuses nonzero @xmath11 away .      in this section",
    "we outline the changes made to gadget-2 to adapt it to phurbas , which serves also to highlight the differences in the infrastructure needed to support sph and phurbas .",
    "the largest modifications are the removal of the sph algorithm for evaluating the spatial derivatives , the addition of data passing and elements in the data structures needed for the phurbas mhd algorithm , the modification to support addition and deletion of gas - type particles , the addition of magnetic field variables , and a new main time advance loop .",
    "additions to the input - output routines and global statistics were also made .    in gadget-2 sph ,",
    "the sums required for value and gradient evaluation are computed in a distributed manner . the contribution to each sum from a set of neighbor particles can be computed on the processor where those neighbors reside , so that only the total value need be communicated . for the phurbas particle update , the values for all particles within @xmath12 of particle @xmath6 must be communicated to the process hosting particle @xmath6 .",
    "particles are updated in batches , so within groups of @xmath1310,000 particles duplicate neighbor communications can be avoided .",
    "phurbas requires only a strict radius - based neighbor search , unlike in gadget-2 sph where a mutual neighbor relation is required to achieve symmetric interparticle forces .",
    "the phurbas neighbor search is also performed on a fixed radius volume , so it does not need iterative refinement like the gadget-2 sph neighbor search , which adapts the neighbor search radius to include a target number of neighbors . in phurbas , the moving least squares interpolation and the particle adaption algorithm require information from the neighbor particles of particle @xmath6 to be retrieved to the host process of particle @xmath6 .",
    "the set of particles used for these three procedures is the same , the particles within @xmath8 .",
    "compared to gadget-2 sph particles , phurbas particles use somewhat more memory .",
    "phurbas uses 56.5 eight byte variables per particle as opposed to the 36.5 used by gadget-2 in double precision mode .",
    "we retain the basic structures of gadget-2 in that the variables required for the neighbor tree construction are stored in a separate array from the fluid quantities .",
    "as the memory required to complete the retrieval of neighbor information can be much larger than in gadget-2 sph , and dynamically varies , we dynamically allocate buffers as needed to complete this step and free the memory after the process is finished .",
    "compared to gadget-2 sph , we have modified the code to avoid persistent allocation of memory , which in particular alleviates problems with computing the domain decomposition with large numbers of parallel processes .    the void search in phurbas described in paper  i relies on computing distances to neighbor particles placed on a @xmath14 grid .",
    "this procedure gains in computational speed if the three - dimensional grid is implemented as a one - dimensional list in memory that is shortened each time a grid point is eliminated from consideration as a nearest neighbor .",
    "this minimizes the number of times each grid point must be accessed , while keeping the values arranged compactly in memory .",
    "we have implemented this strategy by simply replacing the coordinates of any eliminated point with the coordinates of the current last point on the list and shortening the length of the list .",
    "gadget-2 does not support dynamic particle addition and deletion . in phurbas",
    ", we first perform a load balance on the list of particles to add to voids , in order to distribute them among processes evenly .",
    "the particles are created in free memory spaces on the processors where they are moved to by the load balance algorithm .",
    "particles in clumps are deleted from the processors they are resident on .",
    "as we have now deleted some particles , and added others to essentially random processors , we perform a new global gadget-2 load balance calculation , followed by a peano - hilbert ordering and tree build , as in the standard gadget-2 algorithm @xcite .",
    "doing this on the entire particle list brings the new particles to optimal positions on the processors and provides neighbor information for the subsequent processing stages .",
    "the restriction of local time step variations only requires information from particle @xmath6 to be sent to the host processes of the neighbors of particle @xmath6.time steps are rounded down to powers of two in order to use the gadget-2 binary block time step scheme @xcite , and the increase in time step is limited with the gadget-2 synchronized time step scheme .",
    "the most significant optimization made has been for the assembly of the left hand side matrix for the least squares fitting problem used in the polynomial interpolation .",
    "this has been explicitly loop - unrolled into very simple fortran designed to maximize the ability of the compiler to pipeline the instructions and optimize cache use . despite the increased memory use compared to gadget-2 sph",
    ", our experience has been that simulations are computation limited rather than memory limited .",
    "compared to dark matter dominated , cosmological , n - body problems , pure mhd fluid problems intrinsically require more work per particle per time step . for the highest resolution run in the cylindrical geometry mri test in the following section , we used @xmath15 particles on 48 cores , 95% of which were typically active , non - boundary particles .",
    "this was run on the texas advanced computation center lonestar cluster , which consists of nodes with dual xeon intel , hexacore , 3.33  ghz , 64-bit , westmere processors ( 13.3 gflops per core ) interconnected with infiniband qdr .",
    "phurbas took an average @xmath16 seconds for the serial procedures per particle ( void and clump checks , moving least squares interpolations , time derivative calculations , and time integration corrector step ) .",
    "we note that the performance of this section of the code depends highly on the compiler and optimization settings used .",
    "the wallclock time per step was @xmath17 seconds for a step involving @xmath18 active particles , giving a speed of @xmath19 seconds per particle or @xmath20 total updates per core per wallclock second , including adaptivity involving @xmath21 additions and deletions . it should be noted that phurbas version 1.1 code has not yet been heavily optimized , so we believe the parallel overhead can be further reduced .    for",
    "a given application to be suitable for simulation with phurbas , the lagrangian nature , adaptivity , and individual time steps of phurbas must offer a significant advantage on a problem .",
    "otherwise a high - order , grid - based method such as the pencil code @xcite is a more efficient choice , as it computes more than @xmath22 times more updates per core per second .",
    "we present in this section a series of tests that serve to verify the performance of phurbas , and illustrate its abilities and limitations . these include linear waves ( sec .  [ sec_linwaves ] ) , circularly polarized alfvn waves ( sec .  [ sec_circwaves ] ) , hydrodynamical and mhd shock tubes ( sec .",
    "[ sec_shocks ] ) , kelvin - helmholtz instabilities ( sec .  [ sec_khi ] ) , and cylindrical magnetorotational instability ( sec .  [ sec_flocktest ] ) .",
    "as phurbas is meshless , it is an intrinsically three - dimensional algorithm .",
    "the performance and design criteria are different in different numbers of dimensions .",
    "hence , even when tests have symmetries such that they could be stated in a lower number of dimensions , we perform them in fully three - dimensional domains to achieve results reflective of the true capabilities of the code .",
    "it is important to use realistic particle distributions for these tests .",
    "though perfectly gridded particle distributions would yield good results for some tests , as has been demonstrated in the literature , such well arranged distributions can not be expected in a general flow . instead , we realize cubes of relaxed , glassy particle distributions using several iterations of phurbas s void and clump detection algorithms , and then tile these distributions to fill the problem domain .",
    "this also ensures that initially , no particle adaption occurs until the particles move far enough to justify it .",
    "this allows both the use of a realistic particle distribution and makes it possible to create a set of predictably refined initial conditions for convergence studies .",
    "irregular initial particle distributions also remove the need to set up tests at odd angles to prevent aligning waves and shock fronts with a grid .      to verify the convergence of the scheme and its accuracy in the linear domain ,",
    "three mhd waves are modeled .",
    "the three waves are a magnetoacoustic wave propagating perpendicularly to the background magnetic field , a shear alfvn wave propagating along the background field , and a sound wave propagating in an unmagnetized medium .",
    "we compare the results with solutions of the dispersion relation for the mhd equation , including the bulk viscosity @xmath23 .",
    "the solutions for the magnetoacoustic and sound waves are derived in appendix [ sec_dispersion ] .    to set this problem up",
    ", we use a cubic domain , with side length 1.0 , is initialized with density @xmath24 , pressure @xmath25 , and adiabatic index @xmath26 , in which the waves propagate in the @xmath27-direction . for the magnetoacoustic wave the magnetic field is @xmath28 , for the alfvn wave it is @xmath29 , and for the sound wave the magnetic field",
    "is set to zero .",
    "the initial condition is generated from a relaxed particle distribution so that no particle deletion or addition initially occur . for runs with resolution higher than the lowest value , the same set of particles used in the lowest resolution test",
    "is scaled and tiled to fill the computational volume .",
    "the wave is propagated one wavelength , and then the @xmath30-norm error is summed across all fields .",
    "we analyze the convergence of the relative @xmath30 error , dividing the absolute error by the amplitude given by the linear analysis in appendix  [ sec_dispersion ] , as for the waves with a compressive nature ( sound and magnetoacoustic ) , the analytical solution varies with resolution .",
    "all the waves are observed to converge with at least second order accuracy , as shown in figure [ figlinwaveerr ] .      for our next test of mhd",
    ", we run finite - amplitude , circularly polarized , alfvn plane waves using the parameters from @xcite in a cubic domain with periodic boundary conditions , with the propagation direction parallel to the x - axis .",
    "this is equivalent to @xmath31 in the formalism of @xcite .",
    "specifically , the initial conditions are @xmath32 , @xmath33 , @xmath34 , @xmath35 , @xmath36 , @xmath37 , and @xmath26 .",
    "the wave is propagated five wavelengths , returning to its original position .",
    "the solutions shown in figure [ figcircalfvensols ] show that at low resolution , the wave is strongly damped , while as resolution increases the wave rapidly converges .",
    "figure [ figcircalfvenerr ] shows the @xmath30 norm errors , which converge faster than second order .",
    "[ cols=\"<,<,<,<,<,<,<,<,<\",options=\"header \" , ]     [ tabshocktubes ]    to test performance on supersonic and super - alfvnic problems , we set up several shock tube problems .",
    "we used the parameters given in table  [ tabshocktubes ] on long rectangular domains with periodic boundaries . a spatially constant resolution criterion",
    "@xmath10 allows comparison to grid based codes , while an appropriately density dependent resolution criterion allows comparison to other lagrangian methods . for the constant @xmath10 tests we denote the distance along the long axis of the domain in units of @xmath10",
    "we first run the classic @xcite shock tube , in gas with @xmath38 on a domain of size @xmath39 units .",
    "a smooth transition between the left and right states with a width of @xmath40 units is described with a fifth - order spline . in the first version of this test we use a refinement criteria @xmath41 that yields a constant mass per resolution element ( that is , per region with volume of @xmath42 ) .",
    "this is in effect the resolution criterion used by sph . in figure  [ figsodrho ] the solution at time @xmath43 is shown . for this test the x axis on the plot",
    "is denoted in units of @xmath10 in the left initial state . unlike sph , phurbas supports more general refinement criteria . as a simple example , we ran the same sod test problem with spatially constant resolution @xmath44 .",
    "figure [ figsod ] shows the result at time @xmath45 .",
    "the result is generally very similar to the result with mass - based refinement , with the main change being that the shock is thinner , as the local resolution is higher in the constant - refinement case . in either case , the shock speed is reasonably well reproduced .",
    "we next perform a suite of mhd shock tube tests , selecting from the large set of standard mhd riemann problems used in the literature . to tabulate reference solutions ,",
    "we have used athena @xcite at high resolution in 1d .",
    "the first test we show is the classical brio - wu @xcite shock tube test , which is a standard problem , though not particularly stringent .",
    "the test shown in figure  2a of ( * ? ? ?",
    "* denoted rj2a ) provides a more complete test of the appearance of the various possible mhd discontinuities .",
    "@xcite in their figure  4d show a test ( denoted rj4d ) of other discontinuities .",
    "the problem described by @xcite in his figure  6 ( denoted f6 ) is specifically used to demonstrate shock errors in non - locally - conservative methods .",
    "finally , the test shown in figure  6 of @xcite , as well as in figure 1a of ( * ? ? ?",
    "* denoted rj1a ) is commonly used as a stringent test of @xmath11 errors in shocks , and in the case of phurbas demonstrates the effects of local non - conservation errors associated with strong mhd shocks .",
    "note that with the exception of the brio - wu test , all these mhd shock tube tests use an adiabatic gas with @xmath26 .",
    "[ [ brio - wu ] ] brio - wu + + + + + + +    the brio - wu @xcite shock tube ( see table  [ tabshocktubes ] ) is an mhd analog to the sod shock tube problem .",
    "we set up this test in gas with @xmath46 , on a fully periodic domain of @xmath47 units , with constant resolution @xmath48 .",
    "a smooth transition between the left and right states with a width of @xmath49 units was produced with a cosine function .",
    "the width of the transition region was chosen to avoid excessive start - up transients .",
    "as the problem was run in two mirror images in a periodic volume , only half of the periodic volume used is shown in figure [ figbriowupara ] , with the @xmath27-axis labeled in @xmath10 units , at time @xmath50 .",
    "the solution captures the fundamental features of the problem , including , from left to right , the rarefaction fan , the compound wave , the contact discontinuity , the slow shock , and the fast rarefaction wave .",
    "the final panel of figure  [ figbriowupara ] shows a measure of the effect of @xmath11 . here",
    "the quantity @xmath51 is the fractional magnetic field error on the scale of @xmath10 .",
    "grey points in this panel show the raw values of this quantity , with maximum magnitude @xmath52 .",
    "however , the scatter is very symmetric , indicating that most of it can be attributed to the truncation error in the approximation of @xmath11 itself . to extract the coherent skew from zero",
    ", we plot the data binned in bins with width @xmath10 as the black step curve , demonstrating that the normalized @xmath11 errors are less than @xmath53 .",
    "the athena solution that we compare our result to , as well as the usually accepted numerical solutions to the brio - wu problem , show a compound wave structure , seen at @xmath54 in figure  [ figbriowupara ] .",
    "this structure should not formally exist @xcite , but most multidimensional numerical methods , including phurbas , show it as part of the solution .    [ [ rj2a ] ] rj2a + + + +    the test shown in figure 2a of @xcite ( also see @xcite table 3a ) is shown in figure  [ figrj2a ] at time @xmath55 .",
    "initial conditions for this test are listed in table  [ tabshocktubes ] as rj2a .",
    "this test is otherwise set up in the same manner and on the same domain as the brio - wu test .",
    "a high resolution solution was computed with athena for comparison .",
    "as @xcite point out , this test is particularly interesting because it requires modeling a fast magnetosonic shock and a rotational discontinuity in each direction of propagation , as well as a contact discontinuity in the center .",
    "no visible ringing is seen at the shocks .",
    "the largest coherent @xmath11 errors are also seen near the fast shocks , but the largest scatter in particle @xmath11 values is located at the contact discontinuity .",
    "[ [ rj4d ] ] rj4d + + + +    the test shown in figure 4d of @xcite is shown in figure  [ figrj4d ] at time @xmath56 .",
    "this test was run with the same computational domain and resolution as the previous test but with the left and right states listed in table  [ tabshocktubes ] as test rj4d .",
    "a small overshoot can be seen on the leftmost rarefaction wave .",
    "this is a result of the bulk viscosity of the scheme .",
    "[ [ f6 ] ] f6 + +    the test shown by @xcite in his figure 6 is shown in figure [ figfalle2002 ] at time @xmath57 .",
    "this test was used to show an error in the zeus @xcite solution .",
    "the initial states are listed in table [ tabshocktubes ] as test f6 and the problem was run in a domain of @xmath58 units with @xmath59 .",
    "fixed boundaries were used in the @xmath27 direction and periodic boundaries in the @xmath60 and @xmath61 directions . compared to the nonconservative zeus result shown in @xcite the slow shock is captured more accurately . at this resolution ,",
    "the slow shock and the contact discontinuity directly behind it have not yet separated , and the bulk viscosity of the scheme is causing an undershoot in density at the foot of the contact discontinuity .",
    "the left - going features also show overshoots in density and specific internal energy that are initial transients caused by the bulk viscosity .",
    "these effects are not however due to significant nonconservation errors .",
    "[ [ rj1a ] ] rj1a + + + +    the test shown by @xcite in their figure 6 , is shown in figure  [ figtothpara ] at time @xmath62 .",
    "this test also appears in @xcite in their figure  1a , in table  6 of @xcite , and in @xcite . in the latter two",
    "it is used as a demonstration of @xmath11 errors .",
    "we show this problem here as a test of the technique used in phurbas to handle @xmath11 , though we expect that the strength of the shocks in this problem lies outside of the intended use regime of phurbas .",
    "a computational volume @xmath63 units was used , with fixed value boundaries in the @xmath27 direction , and periodic boundaries in the @xmath60 and @xmath61 directions with left and right states listed in table  [ tabshocktubes ] as test rj1a . as @xcite show , the solution consists of a right going fast shock with mach number 6.54 , a left going fast shock with mach number 2.54 , a slow shock , a slow rarefaction , and a contact discontinuity",
    ". phurbas shows a @xmath64 error of a few parts in @xmath65 in the region lying between the two fast shocks .      as an example of multidimensional smooth flow with bulk motions ,",
    "we demonstrate the performance of phurbas on three - dimensional kelvin - helmholtz instability .",
    "recently kelvin - helmholtz instability has attracted significant discussion following the demonstration by @xcite that some sph formulations fail to show the growth of the instability in a particular test problem .",
    "a number of works have discussed aspects of kelvin - helmholtz instability in numerical methods used in astrophysics , particularly in lagrangian schemes .    in the terminology of @xcite and we use a smoothed interface initial condition . however , unlike we choose a smoothing of the interface such that a closed - form algebraic expression can be computed for the first order , linear , perturbation theory prediction for the growth rate in an incompressible flow on an infinite domain .",
    "@xcite have derived such an analytic treatment , providing an exact analytic benchmark for the first time . from that work ,",
    "we select an initial condition with an exponential smoothing .",
    "the initial condition for the kelvin - helmholtz test is as follows in coordinates where @xmath27 is parallel to the direction of flow , and @xmath61 is in the direction of slab symmetry .",
    "density is given by @xmath66 where @xmath67 , @xmath68 , @xmath69 , and @xmath70 .",
    "the velocity field is given by a similar smoothed profile with a perturbation in the @xmath27 direction @xmath71 where @xmath72 , @xmath73 , @xmath74 , and a perturbation in the @xmath60 direction @xmath75 where @xmath76 .",
    "pressure is set to @xmath77 , and @xmath26 .    to extract the growth of the velocity perturbation",
    ", we use a discrete convolution over the particles .",
    "we use this technique , as opposed to a discrete fourier transform on gridded values , as the discrete convolution maps more directly to the meshless phurbas discretization .",
    "we define the magnitude of the unstable @xmath60-velocity mode @xmath78^\\frac{1}{2},\\end{aligned}\\ ] ] where all the sums run over @xmath79 particles , and @xmath80 the domain is @xmath81 units with thickness @xmath82 , @xmath83 , or @xmath84 , simulated with uniform target resolutions @xmath85 , @xmath84 , and @xmath86 .    in figure [ figkhslice ] the developed state of the highest resolution run",
    "is shown , while figure  [ figkhgrowth ] shows the growth of the unstable @xmath60-direction velocity mode and the maximum @xmath60-direction kinetic energy .",
    "the linear perturbation theory predictions from @xcite for the growth rate of the mode amplitude and the maximum @xmath60-direction kinetic energy are also plotted as a guide , but due to the periodic domain , compressibility , and finite perturbation magnitude we can not expect the result to exactly follow this curve . however , clear convergence toward the linear theory can be seen as resolution increases .",
    "a more sophisticated , multiple code verification study , circumventing the limitations of the incompressible theory comparison for a similar problem , will be presented in a separate publication .",
    "the magnetorotational instability ( mri ; * ? ? ?",
    "* ) is thought to be an important mechanism for driving turbulence in protoplanetary disks @xcite .",
    "we have performed a test similar to one done by to examine the growth rate of mri during its linear phase . for this test",
    ", we remove the background keplerian shear flow from the velocity field , and evolve only the perturbations to the initial steady state velocity .",
    "that is , the velocity field we evolve and fit in this test is @xmath87 where @xmath88 is the cylindrical radius from the point ( 0.5,0.5 ) , @xmath89 is the keplerian angular velocity and @xmath90 is the unit vector in the azimuthal direction .",
    "additionally , to ensure that the magnetic field configuration we study is consistent between resolutions , we solve only for perturbations from the initial magnetic field configuration . solving only for the perturbations is particularly useful here as the mri grows fastest where the orbital timescale is smallest .    the magnetic field configuration used in this test , an annulus of uniform vertical field , is chosen to artificially cut off the growth of mri at a finite radius .",
    "ensuring that the mri is cleanly shut off and that the annulus is represented in a constant manner allows clearer measurements of the convergence of the growth rate in the magnetized annulus .",
    "the domain is an annulus with radius ranging from 0.08 to 0.32 and height 0.0375 units .",
    "the vertical boundaries are periodic .",
    "the inner and outer radial boundaries are fixed - value , arranged by preventing time evolution for particles with radius greater than 0.3 or less than 0.1 .",
    "the initial density is 1.0 everywhere .",
    "a vertical magnetic field is imposed with radial profile @xmath91 , where @xmath92 and @xmath93 \\right)\\right\\},\\ ] ] which gives a magnetized annulus .",
    "the sound speed in the magnetized annulus was set to @xmath94 , and the internal energy in the non - magnetized region adjusted so that the total pressure ( thermal plus magnetic ) is constant . the radial velocity is perturbed with @xmath95 spatially constant resolutions of @xmath96 , @xmath97 , and @xmath98 were used corresponding to @xmath99 , @xmath100 , @xmath101 where @xmath102 is the wavelength of the fastest growing mri mode at @xmath103 .",
    "we then measure the growth of the most unstable mode at @xmath103 .",
    "figure  [ figflocktestslice ] shows the radial magnetic field configuration achieved at time @xmath104 ( or @xmath105 orbits at @xmath103 ) for all three resolutions . to calculate the mode amplitude @xmath106",
    ", we use a convolution defined directly on the particles , instead of gridding and fourier transforming the data .",
    "the motivations are the same as when this procedure was used for the kelvin - helmholtz test . in this case ,",
    "@xmath107^\\frac{1}{2 } , \\label{eq_khimode}\\ ] ] where all sums run over the @xmath79 points , and @xmath108 the chosen width of the convolution @xmath109 minimizes the radial range that influences the measurement , while still giving sufficiently low sampling noise .",
    "we plot the evolution of the mode amplitude in figure  [ figflocktest_18 ] together with the maximum growth rate of @xmath110 predicted by a linear perturbation analysis of vertical field mri .",
    "the modeled growth rates are reasonably consistent with the prediction from the linear analysis for the fastest growing mode .",
    "importantly , in the context of the findings of , where spuriously high growth rates were observed , we find growth rates slightly lower than the theoretical maximum value .",
    "to determine if phurbas can be used for practical computations , we need to establish some guidelines for its relative ability to resolve particular phenomena .",
    "this should be done cautiously , as different classes of algorithms have different properties in each flow regime .",
    "an equivalence or difference between algorithms in one regime may not hold across different regimes . in any case",
    ", it is expected that an unstructured mesh or unstructured meshless method will have a lower effective resolution than a structured mesh method .",
    "this is because a given number of resolving elements can represent the largest possible set of wavelengths when they are arranged in a regular manner .",
    "given these caveats , we can compare the test results that we have presented here to examples computed with eulerian , mesh - based schemes .",
    "the first example is the circularly polarized alfvn wave test .",
    "the lowest resolution , three - dimensional , athena results in a rectangular domain published in ( * ? ? ? * fig . 33 ) correspond to @xmath111 and @xmath112 cells per wavelength , computed with third order spatial reconstruction and hlld fluxes .",
    "the phurbas results on this test at @xmath113 and @xmath114 of a wavelength appear to roughly equal the accuracy of the @xmath111 and @xmath112 cells per wavelength athena results in the sense that the final amplitude of the wave in the phurbas results is closer to the analytically correct value even though there are fewer resolution elements used per wavelength .",
    "this result should be interpreted cautiously , as the two codes have different and nonlinear numerical dissipation .",
    "nevertheless , this can be interpreted to mean that the phurbas effective resolution @xmath10 is roughly equal to two athena cells as a measure of resolution .",
    "( on average , there should be one particle in each volume of radius @xmath10 . ) in this sense phurbas with a third - order polynomial fit is competitive with a spatially third - order grid code .",
    "a possibly more operationally useful comparison can be drawn from the results of the linear phase mri growth test .",
    "claim that in the code pluto @xcite with piecewise linear reconstructions and an hlld riemann solver , 10 cells per wavelength are required to resolve the growth of mri .",
    "our test in section [ sec_flocktest ] shows phurbas requires @xmath115 @xmath10 per mri wavelength to resolve the growth .",
    "thus , for this test we can say that one  cell@xmath116 . the algorithm used by has a stencil size of five cells , while phurbas can be said to have a stencil size of @xmath117 , so the same rough proportionality holds between the two algorithms when expressed in terms of stencil size .",
    "the main advantage of phurbas is its lagrangian nature .",
    "eulerian codes suffer from numerical dissipation that varies with the speed and direction of the flow across the grid .",
    "phurbas s formulation cleanly avoids this behavior . for systems where the bulk velocity varies as a multiple or large fraction of the wave speeds , this means phurbas can capture the flow with more uniform fidelity across the domain .",
    "techniques that add an extra advection step to an eulerian method can only efficiently handle simple flow geometries .",
    "moreover , in phurbas , the time step is only dependent on galilean - invariant quantities .",
    "for flow with bulk velocities greater than the signal speeds that determine the courant time step limit , phurbas has a significant advantage in the number of time steps that must be computed to reach a given physical time .",
    "the resolution criterion in phurbas is spatially continuous , unlike in adaptive mesh refinement techniques , so there are no abrupt resolution jumps that can lead to undesirable artifacts .",
    "also , due to the lagrangian and meshless nature of the code , refined regions can be arbitrarily shaped and follow the flow with minimal creation and deletion of resolution elements .",
    "as phurbas formally computes strong solutions to the governing partial differential equations using a method - of - lines type approach , it is relatively simple , compared to godunov methods for example , to switch to an alternate set of variables or even alternate equations .",
    "the central limitation is only that the equations should be amenable to the explicit hermitian time integration used .",
    "however , changing the time integration scheme would not fundamentally alter the method .    a moving unstructured mesh or meshless method must win in terms of the galilean invariance of the numerical diffusion , adaptivity , and the time step advantages , since the quality of the spatial derivatives on an unstructured set of discretization points is lower than for equivalent fits on a grid of points . for problems where the lagrangian and adaptive nature of phurbas is of no significant advantage , a grid - based method such as",
    "the pencil code @xcite remains substantially more efficient .",
    "several enhancements to phurbas can be made , which we briefly mention here .    *",
    "the phurbas discretization is very flexible in how it can incorporate governing equations other than ideal mhd .",
    "implementing non - ideal mhd is relatively simple with forward - time - centered - space viscosity and resistivity operators .",
    "* self - gravity can be implemented using the existing gadget-2 tree algorithm and particle masses derived from a local voronoi tessellation . *",
    "passive tracer particles and interacting dust particles can be added in a straightforward manner , using the spatial fitting and time integration methods used for gas particles . * in the moving least squares procedure the choice of least squares error and cartesian polynomial functions for the fitting procedure is not obviously the ideal choice , and alternate fitting procedures should be explored .",
    "these could include those with a basis that can be used to minimize the variation or oscillation of the fitted function , and fitting the magnetic field using a set of divergence - free basis functions @xcite .",
    "* least - squares minimization itself does not appear to be a unique choice , and less computationally intensive gradient approximation procedures could be used . *",
    "non - lagrangian particle trajectories can be added , using similar logic to the steering of voronoi cell generating centers in @xcite .",
    "this could reduce the number of particle additions and deletions , and hence diffusivity in shear flows .",
    "* an improved void check algorithm could reduce the number of redundant particle creation requests , minimizing the potentially expensive step of pruning of the proposed particle addition list .",
    "* a diffusion with properties similar to a hyperdiffusion would be of great advantage if applied to the density and internal energy fields to smooth out the smallest scale structures .",
    "the challenge of this enhancement is to find an approximation with sufficiently robust conservation properties .",
    "evidently , there are many possible alterations and extensions that can be made to phurbas that will significantly alter both the nature of the scheme and the capabilities of the code .",
    "we believe that phurbas is not just a new method for mhd , but one of the first practical examples of a new class of schemes for mathematical modeling of similar physical problems .",
    "simon c.o .",
    "glover wrote the initial version of the routine to couple the phurba mhd module to gadget-2 , which lies at the core of phurbas .",
    "the tests shown here are of the version of the code incorporating interpolating fits as advised by the anonymous referee .",
    "as noted in paper i , this was a contribution equivalent to co - authorship .",
    "we are indebted to volker springel for making the source code of gadget-2 publicly available @xcite .",
    "we also thank the authors of athena for making it publicly available @xcite .",
    "m .- m.m.l .  and c.p.m .",
    "acknowledge hospitality from the max - planck - institut fr astronomie , and m .-",
    "m.m.l  additionally acknowledges hospitality of the institut fr theoretische astrophysik der uni .",
    "this work has been supported by national science foundation cdi grant ast-0835734 and allocation tg - mca99s024 , originally from the teragrid , and now from the extreme science and engineering discovery environment ( xsede ) , which is supported by national science foundation grant number oci-1053575 .",
    "33 natexlab#1#1    , o. et  al .",
    "2007 , , 380 , 963 , arxiv : astro - ph/0610051    , s.  a. , & hawley , j.  f. 1991 , , 376 , 214    , s.  a. , & hawley , j.  f. 1998 , rev .",
    "phys . , 70 , 1    , a. , & dobler , w. 2002 , comp .",
    "comm . , 147 , 471 , arxiv : astro - ph/0111569    , m. , & wu , c.  c. 1988 , j.  comp .  phys .",
    ", 75 , 400    , s .- h . , inutsuka , s .-",
    "i . , & nayakshin , s. 2010 , , 403 , 1165    , w. , & woodward , p.  r. 1994 , j.  comp .",
    "phys . , 111 , 354    , s.  a.  e.  g. 2002 , , 577 , l123 , arxiv : astro - ph/0207419    , s.  a.  e.  g. , & komissarov , s.  s. 2001 , j.  plasma  phys .",
    ", 65 , 29    , m. , dzyurkevich , n. , klahr , h. , & mignone , a. 2010 , , 516 , a26 + , 0906.5516    , s. , & springel , v. 2010 , , 406 , 2289 , 0912.0629    , a. , youdin , a. , & klahr , h. 2009 , , 697 , 1269 ,",
    "0811.3937    , v. , walch , s. , heitsch , f. , burkert , a. , wetzstein , m. , schartmann , m. , & price , d. 2010 , , 407 , 1933    , j. , mcnally , c.  p. , & mac low , m .- m . 2012 ,  accepted    , f. 2000 , , 141 , 165 , arxiv : astro - ph/9910390    , c.  p. 2011 , , 413 , l76 , 1102.4852    , a. , bodo , g. , massaglia , s. , matsakos , t. , tesileanu , o. , zanni , c. , & ferrari , a. 2007 , , 170 , 228 , arxiv : astro - ph/0701854    , a. , tzeferacos , p. , & bodo , g. 2010 , j.  comp .",
    "phys . , 229 , 5896 , 1001.2832    , d.  j. 2008 , j.  comp .",
    "phys . , 227 , 10040 , 0709.2772    , j.  i. , hayfield , t. , & agertz , o. 2010 , , 405 , 1513 ,",
    "0906.0774    , b.  e. , kravtsov , a.  v. , gnedin , n.  y. , abel , t. , & rudd , d.  h. 2010 , , 401 , 2463 , 0909.0513    , d. , & jones , t.  w. 1995 , , 442 , 228 , arxiv : astro - ph/9404074    , g.  a. 1978 , j.  comp .",
    "phys . , 27 , 1    , v. 2005 , , 364 , 1105 , arxiv : astro - ph/0505010    , v. 2010 , , 401 , 791 , 0901.4107    , v. 2010 , , 48 , 391    , v. 2011 , arxiv e - prints , 1109.2218 , accepted , to appear in tessellations in the sciences : virtues , techniques and applications of geometric tilings , eds .",
    "r. van de weijgaert , g. vegter , j. ritzerveld and v. icke , springer    , j.  m. , gardiner , t.  a. , teuben , p. , hawley , j.  f. , & simon , j.  b. 2008 , , 178 , 137 , 0804.0402    , j.  m. , & norman , m.  l. 1992 , , 80 , 791    , g. 2000 , j.  comp .",
    "phys . , 161 , 605    , s. , de rijcke , s. , rdiger , e. , & dejonghe , h. 2010 , , 408 , 71 , 1006.1767    , j.  w. , veeravalli , g. , & couchman , h.  m.  p. 2008",
    ", , 387 , 427    , l.  f. , ye , w.  h. , & li , y.  j. 2010 , phys .",
    "plasmas , 17 , 042103",
    "the test in  [ sec_linwaves ] is a convergence test to the solution of the linearized version of the modified mhd equations that phurbas solves .",
    "we derive here the dispersion relation and solutions in the cases used in the convergence test .",
    "we start with the mhd mass , momentum , and induction equations , with a bulk viscosity term @xmath118 added to the momentum equation , @xmath119 and for adiabatic gas we also use an energy equation @xmath120 in these equations , @xmath1 is density , @xmath121 is velocity , @xmath122 is pressure , @xmath123 is magnetic field , and @xmath124 is the adiabatic index .",
    "linearizing , and taking the viscosity @xmath125 as constant we obtain @xmath126 where subscripts @xmath127 indicate background values , and unsubscripted variables are fluctuations . substituting the form @xmath128 as a dependence for all variables to search for wave solutions gives @xmath129 solving these transformed version of the mass , induction , and equation of state for the perturbed variables gives @xmath130 we can then substitute these into the linearized momentum equation to yield @xmath131 \\mathbf{v } = \\nonumber\\\\ \\left \\ { \\left [ \\frac{\\gamma p_0}{\\rho_0 } + \\frac{\\mathbf{b}_0 ^ 2}{\\rho_0}\\right]\\mathbf{k } -\\frac{(\\mathbf{k}\\cdot \\mathbf{b}_0)}{\\rho_0 } \\mathbf{b}_0\\right \\ } ( \\mathbf{k}\\cdot\\mathbf{v } ) -\\frac{(\\mathbf{k}\\cdot\\mathbf{b}_0)(\\mathbf{v}\\cdot\\mathbf{b}_0)}{\\rho_0}\\mathbf{k } -\\zeta i\\omega \\mathbf{k}(\\mathbf{k}\\cdot\\mathbf{v})\\end{aligned}\\ ] ] substituting in the alfvn and sound speeds @xmath132 we obtain @xmath133 \\mathbf{v } = & \\nonumber\\\\ \\left \\ { ( v_s^2+v_a^2)\\mathbf{k } -(\\mathbf{k}\\cdot\\mathbf{v}_a)\\mathbf{v}_a\\right \\}(\\mathbf{k}\\cdot\\mathbf{v } ) -(\\mathbf{k}\\cdot\\mathbf{v}_a)(\\mathbf{v}\\cdot\\mathbf{v}_a)\\mathbf{k } -\\zeta i\\omega \\mathbf{k}(\\mathbf{k}\\cdot\\mathbf{v}).\\end{aligned}\\ ] ] we can now choose a propagation direction of the wave , the direction of the wave vector @xmath134 .",
    "the wave vector @xmath134 is chosen to lie in the @xmath135 plane , at an angle @xmath136 clockwise from the @xmath61-axis .",
    "this gives @xmath137\\mathbf{v } = & \\nonumber\\\\   \\left \\ { ( v_s^2 + v_a^2)\\mathbf{k }   - \\hat{\\mathbf{z } } |k|v_a^2\\cos \\theta\\right \\}(\\mathbf{k}\\cdot \\mathbf{v } ) - k^2 \\mathbf{v}_a\\cos \\theta ( \\mathbf{v}\\cdot \\mathbf{v}_a ) -\\zeta i\\omega \\mathbf{k}(\\mathbf{k}\\cdot\\mathbf{v}).\\end{aligned}\\ ] ] upon transforming this into a matrix eigenvalue problem , and solving for the eigenvectors @xmath121 one obtains expressions for the eigenvalues , which can be solved for @xmath138 .",
    "unfortunately , we have only found analytic solutions for two special cases of the propagation direction @xmath136 .",
    "these cases are used to test the convergence of our scheme . for propagation perpendicular to the background magnetic field @xmath139 ,",
    "@xmath140 and the first eigenvalue corresponds to a magnetoacoustic wave , with speed given by @xmath141 , and attenuation given by @xmath142 .",
    "for propagation in the direction of the background magnetic field @xmath139 , @xmath143 and the first eigenvalue corresponds to a sound wave , with speed given by @xmath144 , and attenuation given by @xmath142 .",
    "in general , the shear alfvn wave eigenmodes are unaffected by the addition of the bulk viscosity , as they do not involve compressive motions ."
  ],
  "abstract_text": [
    "<S> we present an algorithm for simulating the equations of ideal magnetohydrodynamics and other systems of differential equations on an unstructured set of points represented by sample particles . </S>",
    "<S> the particles move with the fluid , so the time step is not limited by the eulerian courant - friedrichs - lewy condition . </S>",
    "<S> full spatial adaptivity is required to ensure the particles fill the computational volume , and gives the algorithm substantial flexibility and power . </S>",
    "<S> a target resolution is specified for each point in space , with particles being added and deleted as needed to meet this target . </S>",
    "<S> we have parallelized the code by adapting the framework provided by gadget-2 . </S>",
    "<S> a set of standard test problems , including @xmath0 amplitude linear mhd waves , magnetized shock tubes , and kelvin - helmholtz instabilities is presented . </S>",
    "<S> finally we demonstrate good agreement with analytic predictions of linear growth rates for magnetorotational instability in a cylindrical geometry . </S>",
    "<S> this paper documents the phurbas algorithm as implemented in phurbas version 1.1 . </S>"
  ]
}