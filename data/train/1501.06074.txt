{
  "article_text": [
    "lock - in amplification and phase - sensitive detection are important techniques in experimental physics , see  @xcite for pedagogical uses of these techniques .",
    "commerical devices are expensive and can be intimidating for new users .",
    "building a home - made instrument can be instructive  @xcite ; however , doing so requires advanced electronics skills that a student may not already have , putting the emphasis on the electronics and not the method .",
    "conversely , it is possible to perform the mixing and filtering on a computer using a computer s sound card or other low - cost data acquisition devices to handle the input and output , see for instance  @xcite , but in the author s experience computer driver issues often get in the way of relatively easy implementation .    in this paper",
    "i describe a psd that uses the popular arduino microcontroller and the processing programming environment  @xcite .",
    "the major design goal was to make the device as self - contained as possible , a task made difficult by the memory and hardware constraints of a typical microcontroller .",
    "while these devices are fantastic for controlling robots and basic data - logging , turning them into scientific instruments requires techniques that go beyond what is normally found in the literature .",
    "an added benefit is that these techniques can be used to build other types of instrumentation such as function generators and fast dmms out of a low - cost microcontroller that typically only cost a few tens of dollars .",
    "arduino  @xcite is a catch - all term for a family of open - source hardware based on atmel micro - controllers with a pre - loaded bootloader so that instead of programming the arduino with the more difficult , but more powerful , avr instruction set , users can program with a c@xmath0-like language .",
    "programming and communication can be done via usb or through a set of on - board communication pins .",
    "there have been sixteen different arduino - labeled boards produced to date , each of which has its own unique hardware and memory specifications . in this paper ,",
    "the uno r3 is used , simply because it was what was on hand and is one of the cheaper and more basic arduinos .",
    "the heart of the uno r3 is the atmel atmega328 microcontroller  @xcite .",
    "the uno r3 has 14 digital input / output pins , six of which provide pulse width modulation ( pwm ) output .",
    "it also has six analog inputs , and an on - board @xmath1mhz oscillator .",
    "the atmega 328 has 32 kb of flash memory to store programs , and 2 kb of sram for variable storage .",
    "the program given in this paper is easily stored in the flash memory , but the limited sram places severe restrictions on the amount of data that can be taken and manipulated on - board the arduino .",
    "and @xmath2 are the input and reference voltages respectively .",
    "_ lpf _ is a low - pass filter and _ a _ is an amplifier . a phase - shifter is shown after @xmath2 , but this and the amplifier are not used in this project . see the text for more details . ]    a block diagram for phase - sensitive detection is shown in fig .",
    "[ fig : block ] .",
    "the input stage of a psd consists of two signals , the input of interest and the reference signal .",
    "typically , these two signals are oscillating at the same frequency , but in the derivations to follow this will only be enforced at the end . after the signals",
    "are acquired , the input signal may be amplified and filtered . after the input stage comes the mixing stage where the input and reference signals are combined .",
    "there are a number of ways of doing this , but in this implementation the signals will simply be multiplied .",
    "finally , the output of the mixing stage is heavily filtered by a low - pass filter .",
    "once again this can be done using analog circuitry , but here it will be done mathematically .",
    "let us assume that the input signal @xmath3 and the reference @xmath4 are given by    @xmath5    a dc offset is included with @xmath3 because arduino , like most microcontrollers , only input or output positive voltage ; therefore the arduino outputs an offset reference voltage .",
    "this offset is removed during mixing , so @xmath4 is centered on zero in what follows . upon multiplication of the two signals in eq .",
    "[ eq : inputs ] , and making use of a trig identity , the output of the mixing stage @xmath6 is    @xmath7-\\cos\\left [ \\left(\\omega_2+\\omega_1 \\right)t-\\left(\\phi_2+\\phi_1\\right ) \\right]\\rbrace\\ ] ]    at this stage eq .",
    "[ eq : mix ] is nothing more than what we find in heterodyne detection in radio and optical engineering .",
    "the power of coherent detection is that small signals get amplified by a larger local oscillator signal is evident in eq .",
    "[ eq : mix ] . upon mixing of the two signals",
    "there are contributions to the signal at the original frequencies and at the sum and difference frequencies .",
    "this is the heart of psd ; the output filter is set to reject all frequencies other than the difference frequency of the inputs .",
    "furthermore , if @xmath3 and @xmath4 are made to oscillate at the same frequency before entering the psd , the output @xmath8 of the psd simply depends on the phase difference between the two signals    @xmath9    the final effect of this filtering is to move our output from @xmath10 to dc .",
    "the stronger the filtering , the more noise is rejected and the signal - to - noise increases .",
    "however , in effect , the psd is performing signal averaging , so with each factor of two increase in the signal - to - noise , the collection time increases by a factor of four .",
    "the other disadvantage of psd is that by making the measurements at dc we are placing our signal where @xmath11 noise dominates@xcite .",
    "once again we can see similarities with homodyne detection , and even though we have added no active amplification , the presence of a strong local oscillator can boost a weak experimental signal .",
    "as stated in sec .  [ sec : intro ] , the ultimate goal of this project was to make the project as self - contained as possible .",
    "it would need only a computer for display , the arduino , and as few passive circuit components as possible .",
    "these turned out to be fairly severe constraints and required some exploits that are not commonly presented in introductions to microcontrollers .",
    "the structure of this section is to discuss the implementation of each of the sub - systems shown in fig .",
    "[ fig : block ] .",
    "briefly , and following fig .",
    "[ fig : flowchart ] , the arduino synthesizes a sine wave output from a wavetable . as",
    "the output is updated from the wavetable , the input signal is quickly read .",
    "finally after the arduino has cycled through the complete wavetable , mixing is performed mathematically onboard the arduino , and the resulting waveforms are sent to the host computer running processing for filtering and display .          creating the reference signal is in many ways the most significant constraint on the project .",
    "the arduino does not have a true analog output .",
    "the only way to approximate an analog signal is to use pwm with a low pass filter circuit on the output to smooth things out .",
    "additional tricks are needed to generate something resembling a sine wave .    to generate a reference signal under these limitations",
    "a technique sometimes called `` bit - banging''@xcite is employed .",
    "bit - banging takes advantage of the timers on the arduino and pwm . in pwm",
    ", the duty - cycle ( ratio of ` on ' to ` off ' times ) of a square wave is modulated .",
    "the greater the duty - cycle , the longer the pwm pin on the arduino is held high . integrating that square - wave produces a dc voltage that increases with the duty - cycle .",
    "the final step is to rapidly change this dc voltage so that the desired waveform , in this case a sine - wave , is synthesized .",
    "this paper will only briefly sketch the relevant idea . for details , refer to the comments in the source code for this project , the `` bit - banging '' paper  @xcite , or the atmega328 datasheet  @xcite .",
    "this technique relies on two counters on the arduino .",
    "timer 1 , tcnt1 , is a 16-bit timer / counter that is configured as an 8-bit counter .",
    "tcnt1 runs at the full arduino clock frequency , @xmath12 , and produces the pwm output signal .",
    "timer 2 , tcnt2 , runs slower than tcnt1 by a factor of eight , and is used to step through the pre - generated wavetable .",
    "[ fig : bitbang ]    output compare registers ( ocrna ) set a flag when the value of tcntn matches ocrna .",
    "when the ocrna flag is set each timer can exhibit different behavior depending on how the arduino is programmed .",
    "when the ocr1al flag is set , the pwm pin is made to go low , but tcnt1 keeps incrementing until it overflows .",
    "at which point tcnt1 starts counting again , the pwm pin goes high again , and ocr1la is reset . so changing the value of ocr1al determines the duty - cycle of the pwm signal and consequently the dc voltage that is used to construct @xmath4 .",
    "the pre - programmed wavetable for @xmath2 is what updates ocr1al . to do this tcnt2 ,",
    "running eight times slower than tcnt1 , updates ocr1al with the next value from the wavetable upon reaching ocr2a .",
    "ocr2a is pre - set in the arduino in the code such that the frequency of @xmath2 is given by : @xmath13 when tcnt2 reaches ocr2a , an interrupt is called which does two things , update ocr1al to the next value of the wavetable and get an input voltage for the adc .",
    "the last step in generating @xmath2 is to place a simple low - pass rc filter on the pwm pin to get a smooth sine - wave .",
    "the arduino adc is a 10-bit successive approximation circuit connected to an 8-channel multiplexer .",
    "the measurements are single - ended and normally referenced to a @xmath14 on - board reference voltage , although it is possible to use an external reference voltage . because interrupts are used to create an analog output for the reference signal , it is important to ensure that anything that happens during the interrupt is quick , which is why in fig .",
    "[ fig : flowchart ] , the data is sent for filtering after the wavetable has been completely cycled through .",
    "serial calls are slow .    according to atmel the ultimate sampling rate for single - ended measurements",
    "is limited by the adc clock speed .",
    "the adc clock speed is derived from the main system clock , and for maximum resolution should be between @xmath15 and @xmath16 , however , for purposes of this project satisfactory resolution and accuracy are obtained by setting the adc clock to a speed of @xmath17 .",
    "the successive approximation circuit requires @xmath18 clock cycles , giving a sampling rate of @xmath19  @xcite , which is much faster than this project needs .      since the values of the reference signal are pre loaded into the arduino memory , changing the phase while data is being taken is difficult .",
    "often , however , the ability to shift the relative phase between @xmath20 and @xmath2 is need to maximize the signal .",
    "additionally , sometimes what is needed in a measurement is the phase shift between the reference and input signals . to meet these needs a cue",
    "is taken from dual - phase , lock - in amplifiers@xcite and in addition to our reference waveform a quadrature signal , which is just the reference waveform shifted by @xmath21 , is generated .",
    "both the in - phase , @xmath22 and quadrature @xmath23 mixed waveforms are used so that the phase ambiguity is removed by calculating the magnitude signal @xmath24 and the phase difference between the input and reference signals is @xmath25 .",
    "the @xmath26 and @xmath27 signals are what are sent from the arduino to the host computer for filtering and display .",
    "once the arduino finishes running through the waveform , it takes the collected data and sends it via usb to a computer running the processing ide  @xcite .",
    "processing is a programming language and development environment that was designed to make it easier for the arts community to become software literate . like the arduino",
    ", it has a vibrant community that has produced numerous tutorials , examples , and books that make learning processing relatively easy .",
    "processing is also a direct forebear of the arduino development system and therefore makes it a natural fit with the arduino side of this project .    in this project",
    "the processing sketch ( processing - talk for program ) initiates serial communications with the arduino and once communications are established , the arduino sends the @xmath28 and @xmath29 data to the processing sketch",
    ". the processing sketch applies a recursive , single - pole , low - pass filter[bib : dsp_guide ] to the array that is to be displayed ( @xmath30 ) . in general a recursive filter is given by    @xmath31=a_0 x[n]&+a_1x[n-1]+a_2x[n-2]+\\dots\\\\ & + b_1 y[n-1]+b_2y[n-2]+\\dots,\\end{aligned}\\ ] ]    where @xmath32 is the output of the filter and @xmath33 is the input data .",
    "for this project a single - pole filter was used , so the only coefficients used are given by a single parameter @xmath34",
    "@xmath35    where @xmath36 is the time constant of the filter .",
    "mathematically this filter is identical to a single - pole rc - filter in electronics .",
    "the stronger the filtering , the better it is for lock - in detection , since inadequate filtering causes the output to oscillate at the reference frequency . ref .",
    "@xcite has algorithms for calculating coefficients for higher - order filters with faster roll - off , single - pole filters are limited to attenuations of @xmath37db / decade .",
    "to test this project a all - pass phase - shifter was built .",
    "[ fig : phase_shift ] shows the circuit used to test the arduino .",
    "the voltage gain for this circuit is @xmath38 , so the amplitude of the output is unchanged with respect to the input voltage .",
    "the high - pass rc filter at the non - inverting terminal of the op - amp controls the amount of phase - shift at the output . at @xmath39",
    "the phase - shift is @xmath21 and changes by @xmath40 . by varying @xmath41 , the @xmath21 point shifts and moves our operating frequency along the phase plot . to test the arduino psd , the reference signal generated by the arduino",
    "is sent to the input of the phase - shifting circuit .",
    "the output of the phase - shifting circuit becomes the input signal to the psd .",
    "[ fig : results ] shows the @xmath26 signal , as displayed in the processing sketch , as @xmath41 is varied .    [",
    "fig : phase_shift ]   shifts the phase through @xmath42 degrees.,title=\"fig : \" ]    [ fig : results ]   of the phase - shift test circuit is varied.,title=\"fig:\",width=326 ]",
    "a phase - sensitive detector using an arduino microcontroller has been described .",
    "the main design goal of the project was to make the psd as self - contained as possible , namely that an external reference signal was not needed and that any phase corrections were unnecessary . aside from the arduino and a computer the only other hardware needed",
    "are a resistor and a capacitor .",
    "furthermore the techniques used for this project can be used in other projects involving using the arduino microcontroller as a standalone , low - cost , scientific instrument .",
    "the `` bit - banging '' technique is not limited to sine - waves , but can be used to output any synthesized waveform that may be required .",
    "more complicated waveforms can be created outside of the arduino environment and loaded into the eeprom allowing faster execution and freeing up regular memory.@xcite"
  ],
  "abstract_text": [
    "<S> phase - sensitive detection ( psd ) is an important experimental technique that allows signals to be extracted from noisy data . </S>",
    "<S> psd is also used in modulation spectroscopy and is used in the stabilization of optical sources . </S>",
    "<S> commercial lock - in amplifiers that use psd are often expensive and host a bewildering array of controls that may intimidate a novice user . </S>",
    "<S> low - cost microcontrollers such as the arduino family of devices seem like a good match for learning about psd ; however , making a self - contained device ( reference signal , voltage input , mixing , filtering , and display ) is difficult , but in the end the project teaches students `` tricks '' to turn the arduino into a true scientific instrument . </S>"
  ]
}