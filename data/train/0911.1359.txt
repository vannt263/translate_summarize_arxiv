{
  "article_text": [
    "measurements of cosmic microwave background ( cmb ) temperature anisotropies by the wilkinson microwave anisotropy probe ( wmap ) have ushered in the era of precision cosmology , confirming that the universe is spatially flat , with a matter budget dominated by dark matter and a baryonic mass fraction @xmath11 @xcite in agreement with the measured ratio of deuterium - hydrogen abundances ( d / h ) @xcite .",
    "wmap measurements of large - scale cmb polarization also yield the optical depth @xmath12 to the surface of last scattering ( sls ) , meaningfully constraining cosmological reionization . together with surveys of supernovae @xcite , galaxies @xcite , and galaxy clusters @xcite",
    ", wmap measurements build the case that the universe s expansion is accelerating , due to  dark energy \" or modifications of general relativity @xcite , and constrain other physical parameters ( such as the sum of neutrino masses @xmath13 @xcite and the effective number of massless neutrino species @xmath14 ) .",
    "cmb temperature observations ( wmap , boomerang @xcite , cbi @xcite and acbar @xcite ) probe properties of the primordial density field , such as the amplitude @xmath15 , slope @xmath16 , and running @xmath17 of its power spectrum .",
    "these observations constrain deviations from the adiabatic , nearly scale free and gaussian spectrum of perturbations predicted by the simplest models of inflation , but also offer controversial hints of deviations from these models ( see refs . @xcite and references therein ) .",
    "experimental upper limits to b - mode polarization anisotropies ( e.g. dasi @xcite and bicep @xcite ) impose constraints to the energy density of relic primordial gravitational waves @xcite .",
    "the _ planck _ satellite , launched in may 2009 , will obtain extremely precise measurements of the cmb temperature anisotropy power spectrum ( @xmath18 ) up to @xmath0 and the e - mode polarization anisotropy power spectrum ( @xmath19 ) up to @xmath20 @xcite .",
    "robust measurements of the acoustic horizon and distance to the sls will break degeneracies in dark energy surveys @xcite .",
    "polarization measurements will yield the optical depth @xmath12 to the sls @xcite , further constraining models of reionization and breaking the degeneracy between @xmath16 and @xmath12 @xcite .",
    "cosmological parameters will be determined with much greater precision .",
    "more precise values of @xmath16 and @xmath17 will be obtained from cmb data alone , helping to robustly constrain inflationary models and alternatives to inflation @xcite .",
    "the advent of _ planck _ , ongoing ( spt @xcite and act @xcite ) experiments at small scales , and a future space based polarization experiment like cmbpol @xcite all require predictions of primary anisotropy multipole moments @xmath21 with @xmath22 accuracy .    during atomic hydrogen",
    "( h ) recombination , the thomson scattering opacity drops , decoupling the baryon - photon plasma and freezing in acoustic oscillations .",
    "the phases of acoustic modes are set by the peak location of the visibility function @xcite , while damping scales @xcite and the amplitude of polarization @xcite are set by its width .",
    "small - scale cmb anisotropies are also smeared out by free electrons along the line of sight , suppressing power on small scales so that @xmath23 , where @xmath12 is the total optical depth of this w @xcite .",
    "an accurate prediction of the time - dependent free - electron fraction @xmath24 from cosmological recombination is thus essential to accurately predict cmb anisotropies .",
    "recent work has highlighted corrections of @xmath25 to the standard recombination history computed by recfast @xcite .",
    "these corrections will propagate through to predictions of anisotropies , and neglecting them would lead to biases and errors in _ planck",
    "_ measurements of cosmological parameters @xcite .",
    "the use of the cmb as a probe of the first ionizing sources and of physics at energy scales greater than @xmath26 thus requires an accurate treatment of the @xmath27 atomic physics of recombination @xcite .",
    "direct recombination to the hydrogen ground state is ineffective because of the high optical depth to photoionization @xcite .",
    "recombination proceeds indirectly , first through recombination to a @xmath28 state of h , and then by cascades to the ground state .",
    "because of the optical thickness of the lyman-@xmath4 ( ly@xmath4 ) lines , the resulting radiation may be immediately absorbed , exciting atoms into easily ionized states",
    ".    there are two ways around this bottleneck @xcite . in the first",
    ", the sequence of decays from excited h levels ends with a two - photon decay ( usually @xmath29 ) .",
    "the emitted photons may have a continuous range of energies , allowing escape off resonance and a net recombination . in the second , photons emitted in the @xmath30 transition",
    "redshift off resonance due to cosmological expansion , preventing re - excitation and yielding some net recombination .",
    "the dominant escape channel is from the @xmath31 lyman-@xmath32 line .",
    "these resonant transitions give off line radiation and distort the cmb @xcite .",
    "peebles , sunyaev , kurt , and zeldovich modeled recombination assuming that all net recombination resulted from escaping the @xmath33 bottleneck @xcite .",
    "this three - level - atom ( tla ) treatment included recombinations to excited states , under the assumption of equilibrium between energy levels @xmath4 and angular momentum sublevels @xmath34 for all @xmath35 ( note the use of @xmath34 for atomic angular momentum and @xmath36 for cmb multipole number ) .",
    "this sufficed until the multi - level - atom ( mla ) model of seager et al .",
    "@xcite , which included hydrogen ( h ) and helium ( he ) , separately evolved excited states assuming equilibrium between different @xmath34 , accurately tracked the matter / radiation temperatures @xmath37/@xmath38 @xcite , accounted for line emission using the sobolev approximation @xcite , and included @xmath39 chemistry .",
    "this treatment underlies the recfast module used by most cmb anisotropy codes , including those used for wmap data analysis @xcite .",
    "the higher precision of _ planck _ requires new physical effects to be considered , among them two - photon transitions from higher excited states in h and he @xcite , other forbidden and semiforbidden transitions in he @xcite , feedback from ly@xmath4 lines @xcite , and corrections to the sobolev approximation due to a host of radiative transfer effects in h and he resonance lines @xcite .",
    "most recent work on recombination has focused in one way or another on the radiative transfer problem .",
    "here we direct our attention to the populations of very high-@xmath4 states .",
    "one important effect is the breakdown of statistical equilibrium between states with the same value of the principal number @xmath4 but different angular momenta @xmath34 .",
    "this effect is dramatic at late times .",
    "when @xmath34 sublevels of a level @xmath4 are resolved , increases in @xmath24 of @xmath40 at late times result @xcite .",
    "this changes predicted @xmath21 s at a statistically significant level for _",
    "planck_. highly excited states in hydrogen also change the recombination history at a level significant for _ planck_. while levels as high as @xmath41 were included in the treatment of ref .",
    "@xcite underlying recfast , @xmath34 sublevels were not resolved .",
    "it is thus important to update cosmological recombination histories to include high - n states of h while resolving @xmath34 sublevels , in order to predict the @xmath21 s as well as cmb spectral distortions from recombination .    simultaneously including very high @xmath4 and resolving the @xmath34 sublevels is computationally expensive , taking nearly a week on a standard workstation for @xmath42 @xcite , using a conventional multilevel - atom recombination code .",
    "this becomes prohibitively expensive for higher values of @xmath6 , unless considerable resources are devoted to the problem .",
    "to date , this has prevented a determination of how @xmath24 converges with @xmath6 and how high @xmath6 must be to predict @xmath21 s for _ planck_. the existence of electric dipole selection rules @xmath43 means the relevant rate matrices are sparse , and we have used this fact to develop a fast code , recsparse , to explore convergence with @xmath6 . while the computation time @xmath44 for standard @xmath34-resolving recombination codes scales as @xmath45 , with recsparse",
    "the scaling is @xmath46 , where @xmath47 .",
    "with recsparse , we can calculate recombination histories for @xmath48 in @xmath49 days on a standard work - station ; this would likely take weeks using a conventional code .",
    "for the first time , we have calculated recombination histories for @xmath6 as high as @xmath50 _ with @xmath34 sublevels resolved_.    while previous computations have included some forbidden transitions , none have included optically thick electric quadrupole ( e2 ) transitions in atomic hydrogen .",
    "we include e2 transitions , and find that the resulting correction to cmb anisotropies is negligible .",
    "we find that the correction to cmb @xmath21 s due to extremely excited levels is @xmath51 or less if @xmath52 , in the purely radiative case .",
    "this paper is not the final word on recombination ; atomic collisions must be properly included and the effect of levels with @xmath53 must be included to conclusively demonstrate absolute convergence .",
    "the end goal of the present recombination research program is to include all important effects in a replacement for recfast , as the interplay of different effects is subtle .    in sec .",
    "[ mla ] , we review the formalism of the multilevel atom ( mla ) , and follow by explaining how we extend the mla to include very high - n states ( sec . [ highnsec ] ) and electric quadrupole transitions ( sec .",
    "[ quadtheorysec ] ) .",
    "state populations , recombination histories , and effects on the @xmath21 s are presented in sec .",
    "[ res_highn ] .",
    "we conclude in sec .",
    "[ concl ] .",
    "we use the same fiducial cosmology as in ref .",
    "@xcite : total matter density parameter @xmath54 , @xmath55 , @xmath56 , @xmath57 , and helium mass fraction @xmath58 .",
    "we now review the elements of the standard multilevel - atom ( mla ) treatment of cosmological recombination . for fundamental constants , we use nist ( national institute of standards and technology )",
    "codata ( committee on data for science and technology ) values everywhere @xcite .",
    "unless explicitly noted otherwise , we make the substitution @xmath59 in all expressions for the bohr radius @xmath60 and the ground - state hydrogen ionization potential @xmath61 to correctly account for reduced - mass effects .",
    "cgs units are used except where explicitly noted otherwise .",
    "we follow the abundance @xmath62 , where @xmath63 is the total number density of hydrogen nuclei and @xmath64 is the density of hydrogen in a state with principal quantum number @xmath4 and angular momentum @xmath34 ( we denote the state @xmath65 $ ] ) .",
    "we evolve these abundances including bound - bound and bound - free radiative , single photon , dipole transitions , as well as the @xmath29 two - photon transition , which has rate @xmath66 @xcite .",
    "focusing on the effect of single - photon dipole processes at high @xmath6 , we neglect higher @xmath4 two - photon processes but note that their effects are large enough that they must be included in a final recombination code @xcite .",
    "note that we also neglect collisional transitions .",
    "we comment on how this may change our conclusions in sec .",
    "[ lresec ] .",
    "bound - bound electric dipole processes are described by the equation @xcite @xmath67 with @xmath68 where @xmath69 is the downward einstein rate coefficient for decays from @xmath70 $ ] to @xmath65 $ ] and @xmath71 is the probability that a photon emitted in the @xmath70\\to[n , l]$ ] line escapes the resonance without being reabsorbed .",
    "this probability is calculated in the sobolev approximation , described in sec .",
    "[ rad_trans ] . for lower @xmath34 states easily described using the @xmath72 orbital notation , we will sometimes use the notation @xmath73 , @xmath74 , and so on to simplify the discussion .",
    "the degeneracy of @xmath65 $ ] is @xmath75 .",
    "we explicitly keep track of the angular momentum quantum number @xmath34 , as this will simplify discussion of our sparse - matrix technique in sec .",
    "[ sparse_sec ] .    the photon occupation number blueward / redward of a line transition ( @xmath70\\to [ n , l]$ ] )",
    "is denoted @xmath76 where @xmath77 is the photon occupation number at photon energy @xmath78 and radiation temperature @xmath38 . here",
    "@xmath79 is an infinitesimal line width and @xmath80 is the energy of a photon produced in the transition @xmath70\\to[n , l]$ ] .",
    "the simplest possible assumption for @xmath77 is a blackbody ; we discuss further subtleties in sec .",
    "[ rad_trans ] : @xmath81 here @xmath82 is the usual boltzmann constant .",
    "the @xmath83 term accounts for stimulated and spontaneous emission .",
    "the two - photon term is @xcite @xmath84,\\label{mla_c}\\end{aligned}\\ ] ] where @xmath85 and the second term describes two - photon absorption with a rate coefficient obtained by requiring that forward / backward rates satisfy the principle of detailed balance .",
    "the bound - free term is @xcite @xmath86de_{e}\\label{bfratenet},\\end{aligned}\\ ] ] with@xmath87p_{\\rm m}\\left(e_{e},t_{\\rm m}\\right)\\end{aligned}\\ ] ] and @xmath88 this integral is over the total energy @xmath89 of a recombining electron .",
    "the energy of a recombination photon is @xmath90 , where @xmath91 is the bound - state energy of the recombined electron .",
    "the recombination rate in @xmath92 of such an electron to the bound state @xmath93 $ ] is @xmath94 and is discussed in sec .",
    "[ bfratesec ] .",
    "the ionization rate in @xmath95 is @xmath96 , and easily shown by detailed balance considerations to be @xcite @xmath97    the free - electron abundance is @xmath98 , where @xmath99 is the free - electron density . we restrict our attention to times after helium recombination , and so the free proton abundance @xmath100 .",
    "the net bound - free rate [ eq .  ( [ bfratenet ] ) ] includes both spontaneous and stimulated recombination .",
    "the electron energy distribution is a maxwellian with matter temperature @xmath37 : @xmath101      numerically solving the radiative transfer problem is computationally intensive , but tremendous simplification can be achieved with the sobolev escape probability formalism , also known as the sobolev approximation @xcite .",
    "the hubble flow can be used to define a lengthscale over which the bulk flow induces a velocity change equal to the thermal velocity : @xmath102 , where @xmath103 is the value of the hubble expansion parameter when the radiation has temperature @xmath38 and @xmath104 is the mass of an atom @xcite .",
    "the conditions of the sobolev approximation are @xcite : ( i ) @xmath105 is much smaller than the typical length scales over which cosmological quantities vary , ( ii ) @xmath106 is much smaller than the typical time scales over which cosmological quantities vary , ( iii ) complete frequency distribution the rest - frame frequency of an outgoing scattered photon @xmath107 does not depend on the incoming frequency @xmath108 and ( iv ) no other emission , absorption , or scattering processes occur in the vicinity of the line .",
    "corrections to the sobolev approximation result from diffusion around resonance lines @xcite , atomic recoil @xcite , thomson scattering near resonances @xcite , and overlap of the higher ly series lines , leading to important corrections to cosmological recombination calculations . in this work , however , we work in the sobolev approximation to focus on other physical effects .    in the sobolev approximation ,",
    "the escape probability for photons produced in the downward transition @xmath70\\to[n , l]$ ] is @xcite @xmath109 where the sobolev optical depth is given by @xmath110 with transition frequency @xmath111 correct expressions for @xmath112 are obtained by reversing arguments . during cosmological recombination , transitions between excited states are optically thin ( @xmath113 ) @xcite , and so we set @xmath114 in our calculations for non - lyman lines .",
    "transitions in the lyman ( ly ) series ( @xmath115 , @xmath116 , @xmath117 ) are optically thick ( @xmath118 ) @xcite , and so @xmath119 .",
    "ly transitions can not , however , be ignored in the recombination calculation , as the rate at which atoms find their way to the ground state through the redshifting of resonance photons , @xmath120 is comparable to @xmath121 and other two - photon rates @xcite . strictly speaking ,",
    "@xmath122 depends on @xmath123 , and so one should solve for @xmath124 and then iteratively improve the solution .",
    "the populations of the excited states , however , are very small and the maximum resulting correction to the optical depth is @xmath125 ( for @xmath126 ) @xcite .",
    "we thus drop the second term in eq .",
    "( [ sobdepth ] ) , simplifying our computation by working in the approximation where the lyman-@xmath4 ( ly@xmath4 ) line optical depth depends only on the ground - state population and not on the excited - state populations .",
    "another aspect of the lyman - series lines is feedback : a photon that escapes from the ly@xmath4 ( @xmath127 ) line will redshift into the ly@xmath128 line and be reabsorbed .",
    "recsparse has the ability to implement the resulting feedback , using the iterative technique of ref .",
    "this slows down the code by a factor of a few , however , and so to efficiently focus on the @xmath6 problem , we turned feedback off .",
    "for the high lyman lines , feedback is almost instantaneous : the universe expands by a factor of @xmath129 during the time it takes to redshift from ly@xmath4 to ly@xmath128 . in the instantaneous - feedback limit",
    ", the ly@xmath4 lines do not lead to a net flux of h atoms to the ground state . to approximate",
    "this net effect we turned off lyman transitions with @xmath130 ; this leads to a smaller error than would result from leaving these transitions on but disabling feedback .",
    "previous tests using the code of ref .",
    "@xcite show resulting errors in the recombination history at the @xmath131% level ; in any case , this should only weakly be related to the @xmath6 problem .",
    "all of the recombination histories and plots in this paper were produced by running recsparse with both feedback and lyman transitions from @xmath130 disabled .",
    "electrons , though nonrelativistic during recombination , interact with photons through thomson scattering . as a result , they do not follow the simple adiabatic scaling @xmath132 , where @xmath133 is the cosmological scale factor . the matter temperature is set using the asymptotic solution of ref .",
    "@xcite for @xmath134 , after which the relevant ordinary differential equation ( ode ) is solved numerically ; this transition point occurs in the regime of mutual validity for the numerical and asymptotic solutions .",
    "we neglect subdominant processes , such as free - free , line , photorecombination and collisional ionization cooling , as well as photoionization and collisional recombination heating @xcite .",
    "the wide range of disparate time scales in this problem would naively necessitate a stiff differential equation solver .",
    "this computational expense can be avoided by repackaging eqs .",
    "( [ mla_a ] ) ,  ( [ mla_b]),and  ( [ mla_c])-([mla_d ] ) .",
    "these equations may be rewritten for excited states as ( @xmath65\\neq[1,0]$ ] ) @xmath135 with @xmath136 where the integrated photoionization rate from @xmath65 $ ] is @xmath137 and @xmath138 is defined in eq .",
    "( [ mla_b ] ) .",
    "the downward flux to the ground state is @xmath139 where the first term describes ly@xmath4 series transitions ( stimulated and spontaneous ) while the second accounts for the @xmath140\\to [ 1,0]$ ] two - photon transition .",
    "kronecker delta symbols ( @xmath141 and @xmath142 ) are employed throughout to enforce @xmath65=[n^{\\prime},l^{\\prime}]$ ] and @xmath143 ) .",
    "the source term @xmath144 includes flux from the ground state and direct recombination into the state @xmath65 $ ] : @xmath145 this can also be rewritten in matrix notation : @xmath146 , where @xmath147 is the matrix of rates with components given by eq .",
    "( [ stiffset_b ] ) .    the left - hand side of eq .",
    "( [ stiffset_a ] ) is associated with the recombination time scale , while both terms on the right - hand side are associated with much shorter atomic time scales . for example , the longest lifetimes in the recombination problem are those of the @xmath148 and @xmath149 states ( @xmath150 and @xmath151 when ly-@xmath32 optical depth peaks at @xmath152 ) , considerably shorter than the recombination time scale of @xmath153 . thus we make a steady - state approximation , @xmath154 , which is formally valid because the reciprocal of the minimum eigenvalue of @xmath147 peaks at @xmath155 , which is @xmath156 of the duration of recombination .",
    "thus the excited - state abundances are given by @xmath157 the rates in @xmath147 and @xmath158 depend on @xmath159 , @xmath160 , @xmath37 , @xmath38 , and @xmath161 .",
    "the ground - state population is given by @xmath162\\neq [ 1,0]}x_{n , l}$ ] , but since excited - state populations are small ( @xmath163 ) , @xmath160 can be eliminated from eq .",
    "( [ stiffset_e ] ) using the approximation @xmath164 .",
    "we can then solve for the evolution of @xmath159 , leaving out ineffective direct recombinations to the ground state : @xmath165\\neq [ 1,0]}\\left(\\gamma_{nl}x_{n , l}-\\frac{g_{l}}{2}a_{1,n}^{0,1}p_{1,n}^{0,1}\\mathcal{n}_{1",
    "n } x_{1s}\\delta_{l,1}\\right).\\label{xe_evol } \\end{array}\\end{aligned}\\ ] ]    the steady - state approximation thus allows us to convert a stiff system of ordinary differential equations into a large system of coupled linear algebraic equations , along with a single ordinary differential equation .",
    "the original  effective 3-level atom \" ( tla ) treatments of cosmological recombination in refs .",
    "@xcite were built on the assumption that the primary bottlenecks to effective recombination are the slow @xmath29 transition rate and the reabsorption of @xmath31 resonance photons by the optically thick plasma .",
    "other crucial assumptions included radiative equilibrium between excited states , @xmath166 and statistical equilibrium between angular momentum sublevels : @xmath167 recombination to higher excited states was included through an effective  case b \" total recombination constant @xmath168 ( recombinations to the ground state are omitted ) @xcite .",
    "as the radiation field cools and the baryon density falls at late times , the transitions coupling high - n to low - n become inefficient , as do those coupling different @xmath34 sublevels with the same @xmath4 .",
    "this leads to a breakdown of statistical equilibrium ( note however that the steady - state approximation is still valid ) , and so eqs .  ( [ rad_eq ] ) and ( [ l_eq ] ) cease to apply . in ref .",
    "@xcite , eq .",
    "( [ rad_eq ] ) is relaxed while eq .",
    "( [ l_eq ] ) is still imposed , and @xmath169 corrections to the tla prediction for @xmath24 result . at late times ,",
    "nonequilibrium effects cause a net flux downward from states with quantum number @xmath4 to the ground state , accelerating recombination .",
    "the inclusion of progressively more shells increases the number of downward cascade channels to the ground state for continuum electrons .",
    "thus higher @xmath6 leads to faster recombination and lower @xmath24 .",
    "reference @xcite reports results for @xmath6 as high as @xmath170 .",
    "the lyman ( @xmath30 ) transitions from very high-@xmath4 states overlap with the lyman continuum , motivating ref .",
    "@xcite s claim that there is no need to go past @xmath41 .",
    "the real question as to whether the different values of @xmath4 are well defined , however , is whether the broadening of the state , @xmath171 ( where @xmath12 is the lifetime ) is larger than the splitting of adjacent energy levels , @xmath172 .",
    "the intrinsic broadening for a typical level with @xmath173 is @xmath174 @xcite .",
    "thus @xmath175 and so these extremely high-@xmath4 energy levels are well defined ; indeed , transitions between highly excited states in such nonequilibrium plasmas are seen in interstellar h  ii regions and are a useful diagnostic of physical conditions @xcite .    for extremely large @xmath4 ,",
    "the above physical argument may break down because of additional broadening contributed by interactions with the radiation field and the plasma .",
    "for example , the broadening due to stimulated emission and absorption scales as @xmath176 ( the spontaneous @xmath177 times the phase space density for photons in the @xmath178 transitions ) and that due to electron - impact collisions scales as @xmath179 @xcite ; at sufficiently high @xmath4 these will dominate over @xmath180 and the atomic energy levels will become blended .",
    "however , the orders of magnitude of the collisional coefficients @xcite suggest that this occurs at values of @xmath4 larger than those considered in this paper .",
    "we have also verified that for conditions of interest for the recombining cosmological plasma , the plasma debye length is greater than the average bound electron radius @xmath181 as long as @xmath182 .",
    "more recent work @xcite shows that additional @xmath183 corrections to @xmath24 arise when eq .",
    "( [ l_eq ] ) is not imposed and the populations of @xmath34 sublevels are followed separately . bottlenecks to decays from high @xmath34 imposed by @xmath184 slow down cascades to the ground state , and thus lead to slower recombination . in this case , the sidelength of @xmath147 is @xmath185 . since the number of computational steps needed to invert a matrix is generically a @xmath186 process , the computational time needed for a single ode time step in the recombination time will be proportional to @xmath187 .    as noted in ref .",
    "@xcite , a recombination calculation with @xmath42 already takes @xmath188 days on a standard workstation .",
    "it this thus difficult to explore how quickly @xmath189 converges for progressively higher values of @xmath6 .",
    "even between @xmath190 and @xmath42 , @xmath183 changes are seen in the tt and ee multipole moments ( @xmath21 s ) of the cmb on cmb @xmath21 s . in that work",
    ", it is noted that the fractional difference between the @xmath21 s for @xmath191 and @xmath192 falls within a heuristic _",
    "planck _ performance benchmark .",
    "higher values of @xmath6 come even closer to the fiducial case of @xmath192 , a fact used to argue that even @xmath191 recombination is adequate for _ planck _ data analysis . from the cauchy convergence criterion , however , we know that a meaningful convergence test requires a comparison between successive members in a sequence . using the results of ref .",
    "@xcite alone , the question of convergence with @xmath6 thus remains open . ]",
    "@xcite . in spite of the computational challenge",
    ", it is thus crucial to push the calculation to sufficiently high @xmath6 that corrections to @xmath24 from remaining @xmath53 are so small that they do not effect @xmath18 or @xmath19 at a level statistically significant compared to the predicted _ planck _ sample variance ( e.g. , several parts in @xmath193 for @xmath194 ) @xcite .",
    "there are two challenges in treating such a big multilevel atom .",
    "the first is the calculation of atomic transition rates at extremely high @xmath4 ; this is tractable because of some convenient recursion relations .",
    "the second is simultaneously evolving the populations of @xmath195 states .",
    "we discuss these in turn below .      here",
    "we discuss the einstein coefficients for dipole bound - bound and bound - free transitions in atomic hydrogen , which are used in our recombination computation .",
    "we omit reduced - mass corrections to make a consistent comparison with refs .",
    "@xcite , but include them when calculating actual recombination histories .",
    "the spontaneous electric dipole transition rate @xmath196 for a nonrelativistic hydrogen atom is given by @xcite @xmath197 , \\label{ab}\\end{aligned}\\ ] ] where @xmath198 is the charge of an electron , @xmath199 is the _",
    "planck _ constant , and @xmath200 denotes the radial matrix element between the states @xmath93 $ ] and @xmath201 $ ] at order @xmath202 in the multipole expansion .",
    "for example , @xmath203 denotes the quadrupole rate , and so on.the restriction @xmath184 enforces electric dipole selection rules . here @xmath204 is the radial wave function of an electron in a hydrogen atom , with principal quantum number @xmath4 and angular momentum quantum number @xmath34 , at a dimensionless distance @xmath205 .",
    "all dimensionless distances are measured in terms of @xmath60 . for coulomb wave functions ,",
    "this integration yields the gordon formula @xcite : @xmath206 where @xmath207 , @xmath208 with @xmath209 , @xmath210 , and @xmath211 . here",
    "@xmath212 is gauss s hypergeometric function for integer @xmath213 and @xmath214 , evaluated using the recursion relationship @xmath215+\\left(a+bx - c\\right ) { \\ensuremath{{}_{2}\\!{f_{1}}}}\\left(a , b , c;x\\right),\\end{aligned}\\ ] ] with initial conditions @xmath216 we use eqs .",
    "( [ ab])-([hgc ] ) to calculate bound - bound transition rates at the beginning of a mla computation , storing them for easy and repeated access .",
    "we compared the resulting radial matrix elements with several values for high @xmath4 in ref .",
    "@xcite and found agreement to all @xmath217 published digits .",
    "we calculated oscillator strengths and compared with ref .",
    "@xcite ( all transitions with @xmath4 and @xmath218 were evaluated , as was the entire balmer series for @xmath219 ) and found agreement to all @xmath220 published digits . we also compared with the results in ref .",
    "@xcite ( in which oscillator strengths were computed up to @xmath221 for @xmath222 ) and found agreement to @xmath223 digits .",
    "we attribute the difference in oscillator strengths to the fact that a polynomial expansion of @xmath224 was used in ref .",
    "@xcite , rather than the more stable recursion relationship .",
    "we also compared with the dipole one - photon rates used for the @xmath225 mla computation of ref .",
    "most rates agreed to @xmath226 or more significant figures .",
    "transition rates between @xmath227 and @xmath202 orbitals only agreed to @xmath228 significant figures .",
    "we ran our mla model using the rates of ref .",
    "@xcite and verified that these small disagreements do not lead to any differences in @xmath189 at the desired level of accuracy .",
    "given the high quantum numbers considered , it was important to verify that no numerical instability plagues our numerical implementation of these recursions .",
    "we thus checked matrix elements computed using eqs .",
    "( [ hga])-([hgc ] ) against values estimated using the wkb approximation , as detailed in the appendix . [ bbratesec ]      bound - free rates are evaluated using the same principle , but one of the two states used to evaluate matrix elements must be a continuum coulomb wave function .",
    "the resulting matrix element is @xcite@xmath229 where @xmath230 is the continuum coulomb wave function for a recombining photoelectron with angular momentum quantum number @xmath231 and dimensionless energy @xmath232 .",
    "the energy of the outgoing photon is @xmath233 .",
    "this integral may also be evaluated in terms of hypergeometric functions , which in turn yields a recursion relationship for @xmath234 @xcite : @xmath235\\nonumber g_{n,\\kappa}^{l-1,l}\\\\ & -4n^{2}\\left(n^{2}-l^{2}\\right)\\left[1+\\left(l+1\\right)^{2}\\kappa^{2}\\right]g_{n,\\kappa}^{l , l+1}\\nonumber , \\\\",
    "g_{n,\\kappa}^{l-1,l-2}&=\\left[4\\left(n^{2}-l^{2}\\right)+l\\left(2l+1\\right)\\left(1+n^{2}\\kappa^{2}\\right)\\right]\\nonumber g_{n,\\kappa}^{l , l-1}\\\\ & -4n^{2}\\left[n^{2}-\\left(l+1\\right)^{2}\\right]\\left(1+l^{2}\\kappa^{2}\\right)g_{n,\\kappa}^{l+1,l}\\label{befmel } .\\end{aligned}\\ ] ] the initial conditions of the recursion are @xcite",
    "@xmath236    these matrix elements are tabulated at the beginning of each mla run for all @xmath237 , and @xmath238 ; this range of @xmath239 is partitioned into @xmath240 logarithmically spaced bins , with each bin containing @xmath241 equally spaced @xmath239 values .",
    "bound - free matrix elements were compared with tabulated values for low @xmath4 in ref .",
    "@xcite and agreed to all @xmath242 listed digits .",
    "matrix elements were also compared with those used in ref .",
    "@xcite ; we found agreement to one part in @xmath243 , aside from @xmath244 transitions , as already discussed .",
    "the recombination rate to @xmath93 $ ] as a function of energy is then @xmath245 with @xmath246    at each value of @xmath247 , the tabulated matrix elements , eqs .",
    "( [ bfratenet ] ) and ( [ recratenet ] ) are used to calculate thermally averaged recombination rates , using an @xmath241-point newton - cotes @xcite formula for the integration and neglecting stimulated emission .",
    "large bins are added into the integral until it has converged to a fractional precision of @xmath248 .",
    "we compared our values with integrated rates tabulated in ref .",
    "@xcite and found agreement to all @xmath242 listed digits . comparing with the rates used in ref .",
    "@xcite , we found agreement to one part in @xmath243 , aside from s - p transitions . +   + in saha equilibrium , @xmath249p_{\\rm m}\\left(e_{e},t_{\\rm m}\\right)\\nonumber\\\\=\\eta_{\\rm h}x_{n , l}\\mathcal{n}\\left(e_{\\gamma},t_{\\rm r}\\right)\\beta_{nl}\\left(e_{\\gamma}\\right),\\end{aligned}\\ ] ] and so by the principle of detailed balance , @xmath250}{\\mathcal{n}\\left(e_{\\gamma},t_{\\rm r}\\right ) } \\right|_{\\rm eq } p_{\\rm m}\\left(e_{e}\\right).\\end{aligned}\\ ] ] we verified that our computed thermally averaged recombination and ionization rates satisfied this equality to machine precision .",
    "we also checked bound - free matrix elements computed using eq .",
    "( [ befmel ] ) against values estimated using the wkb approximation , as detailed in the appendix [ appendix_wkb ] . [ bfratesec ]      the key to making the recombination problem tractable for high values of @xmath6 is the sparsity of eqs .",
    "( [ stiffset_a ] ) and ( [ stiffset_b ] ) .",
    "dipole selection rules only allow coupling of states with angular momentum quantum numbers @xmath34 and @xmath251 if @xmath184 .",
    "it is easiest to understand how sparsity simplifies the problem with a slight change of notation .",
    "we can compose the vector @xmath252 ( with components @xmath253 ) of excited - state populations , as @xmath254 where @xmath255 and @xmath256 denotes a vector of the populations of all states with angular momentum @xmath34 , except for the @xmath257 state .",
    "specifically , @xmath258 where @xmath259        the source vector @xmath158 can similarly be written by concatenating source vectors @xmath260 ; each @xmath260 feeds all states with angular momentum @xmath34 .",
    "the rate matrix may be similarly built of submatrices @xmath261 , as illustrated in fig .",
    "the complete rate matrix is block tridiagonal , and the blocks decrease in dimension as @xmath34 increases .",
    "the matrix @xmath261 has components @xmath262    in the steady - state approximation , eq .  ( [ stiffset_a ] ) can be rewritten as a system of matrix equations . if @xmath117 , @xmath263 if @xmath264 , @xmath265 to close the system , we must truncate the hierarchy by excluding states with @xmath53 as both sources and sinks , which is equivalent to setting @xmath266 for @xmath267 .",
    "then for @xmath268 , @xmath269 it might be possible to approximate the correction due to this truncation error , using asymptotic expressions for @xmath270 and saha equilibrium abundances for @xmath53 .",
    "this will only work if @xmath6 is sufficiently high for nearly perfect equilibrium saha equilibrium to hold between states with @xmath53 and the continuum .    at any given time step ,",
    "the actual quantity of interest is not the inverse @xmath271 of the rate matrix but the solution set @xmath272 to the steady - state rate equations .",
    "the closed form solution to eqs .",
    "( [ bottom])-([top ] ) is @xmath273 , \\label{ssola}\\ ] ] if @xmath274 . if @xmath268 , then @xmath275.\\label{ssolb}\\ ] ] here @xmath276 and @xmath277 our new mla code , recsparse , operationally implements this solution at each time step as follows :    1 .   using the values of @xmath38 and @xmath159 , @xmath37 is calculated using the results of sec .",
    "[ rad_trans ] .",
    "all relevant @xmath261 and @xmath260 are computed using eqs .",
    "( [ submat_comp ] ) and ( [ stiffset_e ] ) and stored .",
    "all @xmath278 and @xmath279 are computed using eqs .",
    "( [ saa])-([sab ] ) and stored .",
    "4 .   equation ( [ ssolb ] ) is applied to obtain the solution for @xmath280 .",
    "5 .   equation ( [ ssola ] ) is iterated to obtain the solutions for all @xmath256 .",
    "the free - electron fraction @xmath159 is then evolved forward in time using @xmath272 and eq .",
    "( [ xe_evol ] ) .",
    "it would also be interesting to compute the cumulative spectral distortion emitted by the line and continuum processes responsible for recombination @xcite .",
    "this fractional perturbation of @xmath281 to the blackbody intensity of the cmb could be detectable with future experiments and would offer a test both of our understanding of recombination and of new physics behind the surface of last scattering ( e.g. , time variation of fundamental constants , energy injection by decaying / annihilating dark matter ) @xcite .",
    "this and the development of a fast code for _ _ planck _ _ data analysis including all the relevant physical effects will be the subject of future work .",
    "recsparse begins at @xmath282 , assuming saha equilibrium to compute the initial value of @xmath159 and setting @xmath37 as discussed in sec .",
    "[ rad_trans ] .",
    "excited - state populations are obtained using the method of sec .",
    "[ sparse_sec ] .",
    "submatrix inversions are implemented using the double precision routine dgesvx from the lapack library @xcite .",
    "time evolution of @xmath24 with eq .",
    "( [ xe_evol ] ) is implemented using the @xmath283-order runge - kutta - cash - karp ( rkck ) implementation in _ numerical recipes _ @xcite .",
    "the rapid time scale for return to saha equilibrium introduces a stiff mode into the equations at early times , necessitating care in the choice of a stepsize for the integrator .",
    "we were able to achieve relative precision of @xmath284 by placing @xmath285 time steps at @xmath286 and @xmath50 steps in the range @xmath287 , partitioning each interval into equally sized steps in @xmath288 ; relative errors were estimated by halving step size and comparing values of @xmath24 at identical time steps .",
    "the computation time @xmath44 for recsparse scales as @xmath46 , where @xmath47 .",
    "this is an empirical estimate for the range of @xmath6 that we have explored , and may not extend to higher @xmath6 values .",
    "in contrast , for standard mla codes , @xmath289 .",
    "we can calculate recombination histories for @xmath48 in @xmath49 days on a standard workstation ; this would likely take weeks using a conventional mla code .",
    "[ num_meth ]",
    "early work on recombination highlighted the importance of forbidden transitions , as half of the hydrogen atoms in the universe form by way of the @xmath290  forbidden \" transition @xcite .",
    "recent work has included additional  forbidden \" transitions in the mla treatment , namely , two - photon transitions ( @xmath291 and @xmath292 ) in h @xcite , two - photon and spin - forbidden transitions in he  @xcite , as well as electric quadrupole ( e2 ) transitions in he @xcite .    until this work , the impact of e2 transitions in h on recombination has not been considered , even though they are optically thick for transitions to / from the ground state . for optically thick lines ,",
    "the overall transition rate is proportional to @xmath293 .",
    "since @xmath294 , the overall transition rate is independent of the rate coefficient .",
    "transitions such as electric quadrupoles , which seem  weaker \" judging from rate coefficients alone , can thus be as important as  stronger \" transitions , like the ly@xmath4 lines .",
    "for example , this is why the semiforbidden he  i 591  line is important in cosmological recombination @xcite .",
    "we thus include e2 quadrupole transitions in our mla computation to properly assess their relevance for cosmological recombination .",
    "m1 ( magnetic dipole ) transition rates in h are typically suppressed by an additional factor of @xmath295 , and are thus negligible @xcite .",
    "the electric quadrupole ( e2 ) einstein a - coefficient for transitions from states @xmath93 $ ] to states @xmath296 $ ] is @xcite : @xmath297 where the quadrupole matrix element is @xmath298    the matrix elements of the reduced angular tensor operator @xmath299 are given by @xmath300 where the last factor is the well - known wigner-@xmath301 symbol .",
    "this operator is defined as @xmath302    the dimensionless radial quadrupole integral is @xmath303 the radial matrix element for the @xmath304 transition is a special case of eq .",
    "( b.13 ) of ref .",
    "@xcite with @xmath305 : @xmath306^{1/2}\\frac{\\left(n-1\\right)^{n-4}}{\\left(n+1\\right)^{n+4}}.\\label{crap}\\end{aligned}\\ ] ]      the obvious way to include quadrupole transitions into our mla code would be to generalize eq .",
    "( [ mid ] ) to include @xmath307 transitions : @xmath308 the resulting system is obviously not as sparse as in the dipole case , and solving for all @xmath309 would be computationally more expensive , slowing down the whole mla code .",
    "since the contribution from even the largest quadrupole rates may turn out to be small , we pursue a computationally less expensive approach .",
    "higher energy e2 transitions will proceed much faster than lower energy ones , since e2 rates scale as @xmath310 .",
    "in particular , transitions to and from the @xmath257 ground state will dominate any other quadrupole contributions to the recombination problem , since @xmath311^{5}{\\mathrel{\\hbox{\\rlap{\\lower.55ex\\hbox{$\\sim$ } } \\kern-.3em \\raise.4ex \\hbox{$>$}}}}10^{3}~\\mbox{if $ q\\geq 2$}.\\ ] ] moreover , the @xmath312 lines are optically thick for small @xmath4 .",
    "we thus restrict our consideration to @xmath313 transitions , since other quadrupole transitions are  corrections to a correction . \"",
    "a further simplification follows if we recall that the ly@xmath4 lines are all optically thick @xcite .",
    "thus , the transition @xmath292 is highly probable to be immediately followed by a transition @xmath314 .",
    "this yields a net @xmath315 transition , analogous to an @xmath34-changing collision , which occurs with forward rate @xmath316 .",
    "the reverse process occurs with rate @xmath317 , where @xmath318 is a factor relating forward and backward rates .",
    "if the @xmath202 and @xmath319 states were in equilibrium , the two rates would cancel , so by the principle of detailed balance , @xmath320 , where  @xmath321 \" denotes an equilibrium value .",
    "the net @xmath322 transition rate due to e2 transitions is thus @xmath323 since this overall rate obeys the @xmath43 selection rule , it can be numerically implemented within the same framework as the dipole rates .",
    "we ran the recsparse code for a variety of @xmath6 values . here",
    "we omitted e2 transitions to focus on the effect of deviations from statistical equilibrium and increasing @xmath6 .",
    "we begin by discussing deviations from equilibrium , and proceed to discuss the recombination history and numerical convergence with @xmath6 .",
    "[ res_highn ]      the assumptions of statistical equilibrium between different @xmath34 sublevels within the same @xmath4 shell and boltzmann equilibrium between different @xmath4 states fail at late times , as discussed in sec .",
    "[ highnsec ] . furthermore ,",
    "as reactions become inefficient on the hubble time scale and @xmath24 freezes out , saha equilibrium between the continuum and excited states of h also fails .",
    "below , we discuss each of these failures quantitatively .      at early times , the populations of hydrogen atoms in states with the same @xmath4 but different angular momentum @xmath34 are in statistical equilibrium [ see eq.@xmath324([l_eq ] ) ] .",
    "radiative transitions do not include reactions that are @xmath34 changing but @xmath4 conserving .",
    "the @xmath34 sublevels must thus be kept in equilibrium by a combination of sequences of allowed radiative transitions and atomic collisions .",
    "these processes become inefficient at later times , leading the different @xmath34 sublevels to fall out of equilibrium . both the tla treatment of peebles and the later mla treatment of seager et  al . rely on the statistical equilibrium assumption @xcite .",
    "our recsparse code relaxes this assumption and follows the populations of all @xmath34 sublevels separately .    for @xmath325 ,",
    "the resulting populations are marked by several features , shown in figs .",
    "[ res_state_gas_lneq_boltz_fine ] and [ res_state_gas_lneq_boltz ] at early and late times , respectively .",
    "we use @xmath326 to compare actual with equilibrium populations , where @xmath327 deviations begin modestly at early times ( @xmath328 for @xmath329 ) but are quite large by late times ( @xmath330 by @xmath331 ) .",
    "lower @xmath34 states depopulate efficiently , and are significantly underpopulated relative to statistical equilibrium expectations . states with @xmath117 can only make downward dipole transitions in @xmath4 if @xmath116 . these rates are several order of magnitude lower than lyman - series rates with the same @xmath332 , and so @xmath117 states depopulate less efficiently than other low-@xmath34 states .",
    "this explains the upturn at the lowest @xmath34 values .",
    "the @xmath43 selection rule implies that higher @xmath34 states couple efficiently to neighboring bound states ( @xmath184 ) with a limited range of accessible @xmath333 , since @xmath334 .",
    "these states thus depopulate less efficiently than states with lower @xmath34 due to this bottleneck .",
    "the recombination rate @xmath335 peaks in the range @xmath336 .",
    "together , these facts imply the presence of a peak in @xmath337 , which turns out to occur in the range @xmath338 for a wide range of @xmath4 at all times .",
    "the transition to @xmath339 occurs in the range @xmath340 , also for a wide range of @xmath4 at all times . at very high @xmath34 ,",
    "recombination rates are so slow that these states are again underpopulated relative to statistical equilibrium , though less dramatically than they are at low @xmath34 .",
    "the observed amplitude and shape of the curves in figs . [ res_state_gas_lneq_boltz_fine]-[res_state_gas_lneq_boltz ] qualitatively agree with the results in refs .",
    "@xcite-@xcite , including the upturn near the lowest @xmath34 and sharp minimum at @xmath341 .",
    "the minimum is due to fast balmer transitions out of the @xmath341 state .",
    "when we computed a recombination history with these rates ( @xmath342 for @xmath35 ) artificially set to zero , the minimum moved to @xmath343 , as shown in fig .",
    "[ balmerfig ] .",
    "it is interesting that the curves in figs .",
    "[ res_state_gas_lneq_boltz_fine]-[res_state_gas_lneq_boltz ] exhibit the same behavior with @xmath34 as the departure coefficients of ref .",
    "@xcite , which describe neutral hydrogen ( also in the steady - state approximation ) in interstellar h  ii regions .",
    "recsparse only takes into account radiative transitions , and omits @xmath34 and @xmath4-changing collisions .",
    "these rates would flatten all the curves in figs .",
    "[ res_state_gas_lneq_boltz_fine]-[balmerfig ] , lessening deviations from statistical equilibrium between the different @xmath34 sublevels @xcite .",
    "indeed , the assumption of statistical equilibrium between these states at all times is formally equivalent to the limit of infinite @xmath34-changing collision rates .",
    "theoretical estimates for collisional rates all depend on different assumptions and tabulated rates disagree by factors of two or more ( see , e.g. , ref .",
    "@xcite ) . as a function of redshift @xmath344",
    ", we estimate the ratio @xmath345 of collisional to radiative transition rates out of the state @xmath93 $ ] , where @xmath346 is the collisional rate coefficient ( in @xmath92 ) , and @xmath347 is the total radiative lifetime of the state , including stimulated emission and absorption .    using the rate coefficients in ref .",
    "@xcite , we estimate that collisional rates ( per unit time ) are of the same order of magnitude as radiative rates for @xmath348 at @xmath349 , @xmath350 at @xmath351 , @xmath352 at @xmath353 , and @xmath354 at @xmath355 . in other words , as the primordial gas cools , collisions come to only influence the highest h energy levels , which contain the least bound electrons .",
    "this occurs because of the exponential decrease in the free - electron density @xmath356 in the early stages of recombination , which drives down collision rates accordingly . near @xmath349 and shortly thereafter , radiative rates alone are high enough to keep the excited states in @xmath34-equilibrium .",
    "collisions thus have little effect on @xmath24 at early times .",
    "there may , however , be a window at some intermediate redshift , when collision rates are still relatively high , but departures from @xmath34-equilibrium are large enough to warrant including collisions in the recombination model .",
    "a full calculation is necessary to understand the actual effect . a final answer on the effect of resolving @xmath34 sublevels on both the recombination history @xmath24 and the recombination spectrum awaits a robust theoretical calculation of the relevant collisional rates .",
    "this is an area of future investigation .     at fixed @xmath4 and @xmath6 , as computed by recsparse.,width=312 ]              we may also compare the total population of the @xmath357 energy level to values in boltzmann equilibrium with @xmath33 : @xmath358 the recombination rate to states with @xmath359 is greater than the downward cascade rate , creating a bottleneck to depopulating these states .",
    "this bottleneck causes an over - population of the excited states compared to the equilibrium values of eq .",
    "( [ boldef ] ) , as shown in fig .",
    "[ res_state_gas_nneq_boltz ] .",
    "the ratio @xmath360 is @xmath361 at early times but grows as high as @xmath362 by @xmath363 .",
    "the ratio approaches a constant at high @xmath4 , as energy levels get closer to the continuum and the energy differences between successive levels shrink .",
    "relative to @xmath33 , excited states are over - populated , but there is no population inversion or cosmic maser .",
    "excited states are still less populated than the @xmath33 energy level , just not as dramatically as they would be if eq .",
    "( [ boldef ] ) held . among highly excited states , some pairs of levels do exhibit population inversion . for effective maser action , inversion must occur between pairs of radiatively connected levels , and the coherence of the radiation field must not be destroyed along the line of sight .",
    "this effect will be explored in detail in future work . in extremely dense structure - forming regions ,",
    "more dramatic population inversion may result and lead to local masing ; if these masers were observed , they could offer interesting new probes of structure formation near @xmath364 as well as the physics of reionization @xcite .",
    "recombination becomes inefficient at late times ; i.e. , the recombination time scale @xmath365^{-1}$ ] becomes longer than the age of the universe .",
    "saha equilibrium expressions for @xmath159 and @xmath366 fail dramatically at late times .",
    "the free - electron fraction @xmath159 freezes out and is higher than the saha equilibrium value , and thus @xmath366 is lower than the saha equilibrium value .",
    "excited states are overpopulated relative to the ground state , but still not enough to be in saha equilibrium with the continuum .",
    "the tower of excited states is thus also underpopulated relative to saha equilibrium , as shown in figs .",
    "[ res_state_gas_nneq_saha ] and [ res_state_gas_nneq_sahaz ] .",
    "lower energy levels fall out of saha equilibrium faster than higher energy levels .",
    "higher energy levels are closest to saha equilibrium , but at late times ( @xmath367 ) , even the population of the @xmath368 level is nearly @xmath369 below its saha equilibrium value . modeling the effect of states with @xmath53 may require saha equilibrium abundances to hold in the regime past the cutoff . to this end , it is important to properly model atomic collisions ( which would push atoms towards saha equilibrium at a lower transitional value of @xmath6 ) , and apply even greater computational resources to obtain @xmath24 for even higher @xmath6 .",
    "shell compared to its population in boltzmann equilibrium with @xmath33 , as computed by recsparse at a variety of times through the recombination process.,width=312 ]     shell compared to the saha equilibrium population , as computed by recsparse at a variety of times through the recombination process .",
    ", width=312 ]     values as an explicit function of cosmological redshift @xmath344.,width=312 ]      to explore the relative convergence of @xmath24 over a wide logarithmic range of @xmath6 values , we computed @xmath24 for @xmath370 , and @xmath50 .",
    "we define a relative error : @xmath371 here @xmath372 is the @xmath373 @xmath6 value .",
    "we show the resulting recombination histories and @xmath374 in fig .",
    "[ hist ] . as @xmath6 increases",
    ", the larger number of pathways to the ground state makes recombination more efficient , decreasing @xmath375 and making @xmath374 positive . the relative error @xmath374 shrinks with @xmath6 , indicating that relative convergence is taking place , as demonstrated in fig .",
    "note , however , that the relative error may not be a good proxy for the absolute error .",
    "suppose that the absolute error is given by @xmath376 , where @xmath377 , for some normalization @xmath378 and power - law index @xmath379 .",
    "then it is easy to show that for @xmath380 , @xmath381 . in other words",
    ", the relative error will underestimate the absolute error . to demonstrate absolute convergence",
    ", one should demonstrate that the physics neglected by ignoring transitions to @xmath53 does not cause large changes in @xmath24 .",
    "we also calculated recombination histories for @xmath382 , and @xmath383 .",
    "we may also assess the effect of the computed changes in @xmath24 on the cmb @xmath21 s .",
    "to this end , we replace the usual table generated and used in the recfast module of cmbfast with a table of our own output for different @xmath6 values , smoothly stitching our history onto the usual recfast history at the boundaries @xmath282 and @xmath384 .",
    "we tried a variety of smoothing schemes including no smoothing at all , and determined that the resulting error was at most @xmath369 the change already induced by varying @xmath6 .",
    "the choice of smoothing scheme is thus a  correction to a correction \" and does not alter the conclusions of our analysis . in particular , the number of sigmas at which power spectra corrected and uncorrected for higher-@xmath4 levels can be distinguished will change by at most @xmath369 of itself as a result of changing the smoothing scheme .",
    "the statistical significance of higher-@xmath4 shells will thus be essentially unchanged by the choice of smoothing scheme .",
    "the results for temperature and e - mode polarization anisotropy power spectra ( @xmath18 and @xmath19 ) are shown in figs .",
    "[ tt ] and [ ee ] , respectively . here",
    "we also define a relative error : @xmath385 here xx denotes the tt or ee label of the power spectrum under consideration .",
    "the relative error @xmath386 is always positive , indicating that increasing @xmath6 also increases @xmath387 , as shown in figs .",
    "[ tt ] and [ ee ] .",
    "the common ( tt and ee ) origin for this effect is clear from fig .",
    "higher @xmath6 makes recombination more efficient , driving down the freeze - out value of @xmath24 and the residual optical depth @xmath12 , leading to the high-@xmath34 plateaus seen in fig .",
    "[ tt ] and [ ee ] . as a result ,",
    "the smearing out of primary cmb anisotropies by relic free electrons , @xmath23 @xcite , is less dramatic when @xmath6 is increased .",
    "the relative error @xmath386 shrinks with increasing @xmath6 .    taken as a proxy for the absolute error ,",
    "@xmath386 may be compared to a crude ( cosmic variance ) estimate of the required accuracy of @xmath388 predictions in the damping tail : @xmath389    here @xmath390 is the fraction of the sky covered by a cmb experiment . for @xmath391 , results are shown in figs .",
    "[ tt ] and [ ee ] and we see that only for @xmath5 does the relative error shrink to a level comparable with the cosmic variance .",
    "the ultimate aim is for _ the total _ correction from recombination physics to be less than statistical errors , so any individual contribution such as the truncation error at @xmath6 should be @xmath392 . in any case , collisions must be properly included to show absolute convergence , and so this should be a key focus of future work on highly excited states in hydrogen recombination . to more",
    "realistically assess the importance of high-@xmath4 states , @xmath393 should be compared with a realistic error estimate for _",
    "planck_.         different values of redshift @xmath344 .",
    "errors shrink with @xmath6 , indicating relative convergence .",
    "note , however , that this figure gives no scale for the absolute error.,width=312 ]     computed using cmbfast , modified to include successively more accurate recsparse recombination histories .",
    "pairs of @xmath6 values used for the comparison are indicated in the legend . @xmath18",
    "increases with @xmath6 , as discussed in sec .",
    "[ resultsn ] .",
    "the correction shrinks with increasing @xmath6 .",
    "the long dashed line indicates the cosmic variance target for @xmath394 , as discussed in the text.,width=312 ]     computed using cmbfast , modified to include successively more accurate recsparse recombination histories .",
    "pairs of @xmath6 values used for the comparison are indicated in the legend of fig .",
    "[ tt ] . @xmath19",
    "increases with @xmath6 , as discussed in sec .",
    "[ resultsn ] .",
    "the correction shrinks with increasing @xmath6 .",
    "the long dashed line indicates the cosmic variance target for @xmath394 , as discussed in the text.,width=312 ]      as a test of the importance of the modified recombination history for _ planck _ , we have compared our corrections to the power spectrum @xmath395 with the forecast _ planck _ error bars .",
    "the comparison is done by means of the statistic @xmath396 where @xmath397 is the fisher matrix for the cmb power spectrum .",
    "for the temperature - only case , @xmath36 ranges from 2 to @xmath398 and hence @xmath399 is an @xmath400 matrix ; when polarization is included , @xmath399 expands to a @xmath401 matrix incorporating tt , ee , and te spectra .",
    "the @xmath402 statistic is the number of sigmas at which the corrected and uncorrected power spectra could be distinguished assuming perfect knowledge of the cosmological parameters , and hence represents the largest possible bias ( in sigmas ) on any combination of cosmological parameters in any fit that incorporates the cmb @xcite .",
    "we use the forecast noise and beam curves for _ planck _ data 70 ghz ( low - frequency instrument ) and 100 and 143 ghz ( high - frequency instrument ) channels in the blue book @xcite , and assume a usable sky fraction of @xmath403 .",
    "the computation considering the difference between the @xmath404 and 250 curves gives a @xmath402 value of @xmath405 .",
    "however , the actual error in the @xmath10 calculation is somewhat greater because even the @xmath5 calculation is not completely converged .",
    "if the error in the @xmath406s scales as @xmath407 and has a shape that varies slowly with @xmath6 , then our value of @xmath402 should be increased by a factor of @xmath408^{-1}$ ] ; for @xmath409 ( as suggested by fig .",
    "[ conv ] ) this is 1.39 .",
    "thus if the power - law extrapolation is to be trusted there is a @xmath410 error ( @xmath411 ) in the cmb power spectrum if one restricts attention to @xmath10 , and a @xmath412 times smaller error ( @xmath413 ) at @xmath5 .",
    "a similar comparison between @xmath7 and 250 implies an error of @xmath414 at @xmath7 .",
    "this suggests that in the _ purely radiative _ problem the cmb power spectrum is converged ( in the sense that our remaining errors are small compared to projected _ planck _ errors ) at @xmath415 ; however this issue will have to be reconsidered in future work when collisions are included .      using the treatment of sec .",
    "[ quadtheorysec ] and an integration stepsize fine enough to obtain a fractional accuracy of @xmath416 in @xmath159 , we compute the effect of e2 quadrupole transitions on cosmological hydrogen recombination for several values of @xmath6 .",
    "we can parametrize this effect using @xmath417 and @xmath418 note that unlike the case of varying @xmath6 , these are the absolute errors induced by ignoring e2 transitions .",
    "the results are shown in fig .",
    "[ quad_hist ] .",
    "the maximum effect of e2 transitions occurs at @xmath419 with a fractional enhancement of @xmath420 , and the calculation seems well converged by @xmath225 .",
    "corrections due to higher excited states would be a correction to a correction , and so we ignore them .",
    "although the correction from e2 transitions is small , it extends over a broad epoch at late times after reaching its maximum . to determine if this could affect cmb anisotropies in an observable way , we modify and run cmbfast @xcite using recombination histories computed with / without e2 transitions .",
    "we incorporated recsparse recombination histories including e2 transitions into cmbfast by applying the same method employed in sec .",
    "[ resultsn ] .    running the recombination histories including e2 quadrupole transitions through cmbfast gives a maximum change @xmath421 in both temperature and polarization , negligible compared to cosmic variance .",
    "thus e2 transitions in hydrogen are negligible for cmb applications .    .",
    "the net effect is always to speed up recombination.,width=312 ]",
    "we have developed a new recombination code , recsparse , optimized for tracking the populations of many energy shells of the hydrogen atom while resolving angular momentum sublevels .",
    "the code runs more quickly than would be anticipated using simple scaling arguments , which would yield the the scaling @xmath289 . using recsparse",
    ", we find empirically that for the range of @xmath6 values used , computation time scales as @xmath46 , where @xmath47 . with this code",
    ", we have computed cosmological hydrogen recombination histories for a series of @xmath6 values going as high as @xmath5 and explored the highly nonequilibrium state of the resulting atomic hydrogen .",
    "the resulting correction @xmath422 satisfies @xmath423 for @xmath424 when @xmath5 and converges with @xmath425 .",
    "the correction to the @xmath21 s becomes of order the cosmic variance when @xmath5 . in light of realistic error",
    "estimates for _ planck _ , the resulting cmb anisotropy spectra @xmath387 are converged to @xmath51 at fisher - matrix level for @xmath404 in the purely radiative case , assuming error extrapolations may be trusted .    to definitively answer the question of absolute convergence",
    ", collisions must be included to speed the approach to saha equilibrium at high @xmath4 , allowing a conclusive treatment of states beyond the truncation limit , with @xmath53 .",
    "future work should also properly account for the overlap of the lyman resonance line series at high @xmath4 .",
    "it will also be interesting to determine if there is coherent stimulated emission between excited states , given its relevance for the detectability of faint cmb spectral distortions from the epoch of recombination .",
    "finally , the sparse - matrix methods applied here or similar techniques could be profitably applied in the development of fast recombination codes for cmb data analysis , even at early times in recombination , when only lower values of @xmath6 are relevant .",
    "the authors acknowledge useful conversations with y. ali - hamoud , n. bode , a. pullen , t. l. smith , j. chluba , j. a. rubio - martn , and the participants of the july 2009 paris workshop on cosmological recombination .",
    "is supported by the dan david foundation and the gordon and betty moore foundation .",
    "is supported by doe de - fg03 - 92-er40701 , the national science foundation under contract no .",
    "ast-0807337 , and the alfred p. sloan foundation .",
    "the development of laser spectroscopy of high-@xmath4 states in hydrogen and other atoms , along with the study of nonlinear and multiphoton ionization , required the computation of dipole radial matrix elements for high and even fractional quantum numbers in a coulomb or perturbed coulomb potential @xcite .",
    "until adequate algorithms for these computations were ultimately developed , the wentzel , kramers , brillouin , and jeffreys ( wkbj ) semiclassical approximation ( quite accurate for @xmath426 ) @xcite proved a useful tool for estimating @xmath427 . at high",
    "@xmath4 , radial wave functions in the coulomb potential have a large number of nodes and thus a short wavelength @xmath428 . for the wkb approximation to be valid ,",
    "it is necessary that @xmath429 . because of the large number of nodes in the coulomb wave functions at high @xmath4",
    ", the wkb approximation is ideally suited to estimating matrix elements for transitions between high @xmath4 .",
    "[ appendix_wkb ] in the classically allowed region , the nonrelativistic wkb radial wave function for a hydrogen atom is @xmath430}\\end{aligned}\\ ] ] with @xmath431^{1/2},\\label{wkb_bb_wfb}\\end{aligned}\\ ] ] where the inner classical turning point @xmath432 is a solution of the equation @xmath433 . substituting eq .",
    "( [ wkb_bb_wfb ] ) into eq .",
    "( [ mel_bb ] ) for the dipole matrix element , and making several additional approximations , the following expression is obtained if @xmath434 and @xmath435 @xcite : @xmath436\\label{bb_low_wkb } .\\end{aligned}\\ ] ] with @xmath437 , @xmath438 , @xmath439 , @xmath440 , and @xmath441 here @xmath79 is the eccentricity of a keplerian orbit with the quantum numbers @xmath442 and @xmath443 , and @xmath444 is a bessel function of the first kind .",
    "these estimates agree with matrix elements computed using eq .",
    "( [ hga ] ) to a precision of @xmath445@xmath446 ; the agreement worsens as @xmath447 .    if @xmath448 and @xmath449 , then @xcite @xmath450 with @xmath451 . here",
    "@xmath452 is a modified bessel function of the second kind .",
    "these estimates agree with matrix elements computed using eq .",
    "( [ hga ] ) to a precision of @xmath453@xmath454 ; the agreement worsens as @xmath227 shrinks , at which point eq .",
    "( [ bb_low_wkb ] ) becomes more accurate .",
    "a wkb estimate of bound - free matrix elements is obtained by making the substitution @xmath455 in eq .",
    "( [ wkbfar ] ) @xcite .",
    "the resulting estimate is reasonable if @xmath456 and agrees with matrix elements computed using eq .",
    "( [ befmel ] ) to a precision of @xmath446 .",
    "this analysis confirms that the high @xmath4 and @xmath34 values under consideration do not afflict our evaluation of eqs .",
    "( [ hga ] ) or ( [ befmel ] ) with any instability that would throw computed rates off by orders of magnitude ."
  ],
  "abstract_text": [
    "<S> calculations of cosmological hydrogen recombination are vital for the extraction of cosmological parameters from cosmic microwave background ( cmb ) observations , and for imposing constraints to inflation and reionization . </S>",
    "<S> the _ planck _ </S>",
    "<S> mission and future experiments will make high precision measurements of cmb anisotropies at angular scales as small as @xmath0 , necessitating a calculation of recombination with fractional accuracy of @xmath1 . </S>",
    "<S> recent work on recombination includes two - photon transitions from high excitation states and many radiative transfer effects . </S>",
    "<S> modern recombination calculations separately follow angular momentum sublevels of the hydrogen atom to accurately treat nonequilibrium effects at late times ( @xmath2 ) . </S>",
    "<S> the inclusion of extremely high - n ( @xmath3 ) states of hydrogen is then computationally challenging , preventing until now a determination of the maximum @xmath4 needed to predict cmb anisotropy spectra with sufficient accuracy for _ planck_. here , results from a new multi - level - atom code ( recsparse ) are presented . </S>",
    "<S> for the first time , ` forbidden ' quadrupole transitions of hydrogen are included , but shown to be negligible . </S>",
    "<S> recsparse is designed to quickly calculate recombination histories including extremely high-@xmath4 states in hydrogen . </S>",
    "<S> histories for a sequence of values as high as @xmath5 are computed , keeping track of all angular momentum sublevels and energy shells of the hydrogen atom separately . </S>",
    "<S> use of an insufficiently high @xmath6 value ( e.g. , @xmath7 ) leads to errors ( e.g. , @xmath8 for _ planck _ ) in the predicted cmb power spectrum . extrapolating errors , </S>",
    "<S> the resulting cmb anisotropy spectra are converged to @xmath9 at fisher - matrix level for @xmath10 , in the purely radiative case . </S>"
  ]
}