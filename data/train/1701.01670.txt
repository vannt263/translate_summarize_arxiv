{
  "article_text": [
    "the largest and most powerful solar telescopes are ground - based facilities . however , compared to their counterparts in space such as the solar dynamics observatory ( ( * ? ? ?",
    "* sdo ; pesnell et al .",
    "2012 ) ) , they often lack in providing user - friendly data pipelines to reduce the raw data .",
    "only few ground - based instruments have such a pipeline ( ( * ? ?",
    "* e.g. , de la cruz rodrguez  2015 ) ) .",
    "the data reduction process is often much more complex than for space missions and differs substantially from instrument to instrument .",
    "the need for automatized data reduction pipelines to produce science - ready data becomes crucial in the era of big data .",
    "therefore , in the framework of the eu - funded solarnet project , we developed a pipeline called `` stools '' to reduce and prepare data acquired with the gregor fabry - prot interferometer ( ( * ? ? ?",
    "* gfpi ; puschmann  2012 ) ) , large - format imaging cameras , and the high - resolution fast imager ( hifi ) located at europe s largest solar telescope gregor ( ( * ? ? ?",
    "* schmidt  2012 ) ) . in sect .",
    "2 we will briefly describe the instruments supported by the pipeline .",
    "section 3 is dedicated to the description of the pipeline , and sect .",
    "4 reports on the data archive and provides an outlook .",
    "the gfpi is the successor of the gttingen fabry - prot interferometer ( ( * ? ? ?",
    "* bendlin  1992 ) , ( * ? ? ?",
    "* puschmann  2006 ) ) which was attached to the vacuum tower telescope ( vtt ) at the observatorio del teide and is now installed at gregor .",
    "it is an imaging spectropolarimeter which operates in the visible and near infrared spectral range .",
    "the gfpi has two tunable etalons in a collimated setup .",
    "the two ccd cameras , one for the broad - band and another for the narrow - band images , have the same image scale and a size of @xmath0 pixels . the spatial scale of gfpi was derived comparing gfpi broad - band images from the year 2014 with continuum images from sdo which results in 0@xmath10405pixel@xmath2 . hence , the field - of - view ( fov ) of the gfpi in spectroscopic mode is @xmath3 .",
    "the blue imaging channel ( bic ) of the gfpi is fed by light in the visible below @xmath45300 .",
    "a beamsplitter allows for simultaneous image acquisition at two different wavelengths with two cameras .",
    "the observer aims for high - cadence with these cameras to minimize atmospheric seeing effects and assure high - quality image reconstruction .",
    "initially , two pco.4000 ccd cameras with a size of @xmath5 pixels and a spatial sampling of 0@xmath10347pixel@xmath2 were used . in 2016 , these cameras were replaced by two synchronized scmos imagers and the instrument is now named high - resolution fast imager ( hifi ) .",
    "both cameras write their images into the same file .",
    "this requires the same exposure times for both cameras which can be achieved using neutral density filters .",
    "the hifi chips have a size of @xmath6 pixels and a spatial sampling of 0@xmath10253pixel@xmath2 . of special interest",
    "is the frame rate of these cameras which is 49hz or 98hz with the full or a @xmath7 pixels fov , respectively .",
    "hifi can be used independently from the gfpi , e.g. , as the context image of the gregor infrared spectrograph ( ( * ? ? ?",
    "* gris , collados  2012 ) ) .",
    "a careful acquisition of calibration data each day is crucial to produce high - quality science data after the reduction process .",
    "the following calibration data are required : dark , flat field , resolution target , and several pinhole images .",
    "in addition , the spectroscopic mode of the gfpi requires a long scan to derive the prefilter curve of the interference filter .",
    "it is crucial to have dark images with the same exposure times as all the acquired data .",
    "all routines are written in the interactive data language ( idl ) and are documented in the header . moreover ,",
    "the routines are strictly named with the prefix `` stools '' in order to avoid overlapping with other idl routines .",
    "gfpi and hifi data are recorded in the native format of davis , a software package from the company lavision gmbh , gttingen .      we will focus on the data reduction of the imaging spectroscopic mode . all computed images and parameters for the data calibration are stored in one single idl save file .",
    "single variables are added to or are extracted from idl save files with special stools routines . to initialize the pipeline",
    ", the user only needs to specify the in and output directories , the observed wavelength , and the on - chip binning of the cameras .",
    "first , the average dark images are computed for both cameras . in the next step",
    "the flat - field images are averaged for each position of the etalon .",
    "other valuable information such as the positions of the etalon , accumulations , and step size is also saved .",
    "the pinhole and resolution target images are corrected for dark and flat - field .",
    "they are then used to derive the alignment parameters between both gfpi cameras such as rotation , displacement , pivot point , and magnification .",
    "the output is stored in an idl structure .",
    "the blueshift correction needs to be performed across the fov of the narrow - band images . for this task ,",
    "flat - field images are taken and interpolated to a narrower and equidistant wavelength grid .",
    "the resulting spectral profiles for each pixel are slightly smoothed by convolving them with a normalized kernel of @xmath8 units .",
    "a polynomial fit of second order to the line core of the spectral line yields the central position on the wavelength axis .",
    "we repeat this step for all spectra across the fov .",
    "the average of all central positions is then computed and subtracted from each individual position . hence , we obtain the displacement in wavelength , i.e. , the blueshift correction , for all pixels within the fov .",
    "the correction is applied by displacing the spectra using cubic spline interpolation . for the narrow - band camera , the aforementioned flat field",
    "can now be used together with the blueshift correction to compute a normalized master flat , i.e. , a single two - dimensional gain table , where the spectral information is removed .",
    "the user can choose either this master flat or the former spectral - dependent flat field to correct the data .",
    "kms@xmath2.,scaledwidth=99.0% ]    kms@xmath2.,scaledwidth=99.0% ]    the last step before correcting the science observations is to derive the prefilter curve of the gfpi . to this end",
    ", we use a long scan with a small step size covering a large fraction of the etalon s scan range .",
    "this scan is ideally taken at the solar disk center under quiet - sun conditions to avoid spectral line shifts .",
    "after dark , flat - field , and blueshift corrections a gfpi mean spectrum , which represents the average transmission profile of the narrow - band interference filter , is computed . to extract the trend of the prefilter curve we take advantage of the fourier transform spectrometer ( ( * ? ? ?",
    "* fts ; neckel & labs 1984 ) ) spectrum from the kitt peak national observatory .",
    "the fts spectrum is first convolved with the theoretical gfpi transmission profile and then matched to the observed gfpi mean spectrum by minimizing the wavelength offset .",
    "it follows a resampling of the fts spectrum to the gfpi wavelength scale .",
    "afterwards , the ratio of both spectra is computed .",
    "finally , the ratio , with the exception of parts showing large variations , is fitted using a double gaussian .",
    "linear least - squares fitting between model and observations is performed with the mpfit package ( ( * ? ? ? * markwardt 2009 ) ) .",
    "all calibration data are now ready to be applied to the science data .",
    "the pipeline splits now into two different branches . on the one hand ,",
    "quick - look physical maps are being generated , e.g. , line - core intensity images , line - of - sight ( los ) velocity maps , equivalent width maps , seeing quality parameters , etc .",
    "the results are stored into an idl structure together with the reduced broad- and narrow band images ( level 1.0 data ) . on the other hand ,",
    "the data are prepared for image - restoration ( level 2.0 data ) with multi - object multi - frame blind deconvolution ( ( * ? ? ?",
    "* momfbd ; lfdahl 2002 ) , ( * ? ? ?",
    "* van noort  2005 ) ) .",
    "the restored images are finally written in the flexible image transport system format ( ( * ? ? ?",
    "* fits , wells  1981 ) ) .",
    "one example of a restored line - core image and its associated los velocity map is shown in fig .",
    "[ fig1 ] .",
    "we follow a similar approach for the hifi data reduction .",
    "the user needs to introduce the directory of the observations , telescope and user names , and the two wavelengths of the respective interference filters .",
    "the average dark , flat field , pinholes , and resolution target images are then computed and saved as individual fits files .",
    "the file name has a two - digit suffix which identifies the type of calibration data .",
    "moreover , the fits header includes basic information such as date and time of the observations , wavelength , telescope , dimensions of the images , etc .",
    "the target frames are used to align both cameras .",
    "the obtained parameters such as displacement , rotation , and magnification are stored in an idl save file . due to the setup of the cameras , both have the same image scale , however , there might be a slight displacement in the vertical and horizontal axes .",
    "the science observations are then corrected for dark and for artifacts on the chip by using the flat - field images .",
    "if more than one burst of flat - field images was taken , the pipeline chooses the one closest in time to the science observations .",
    "an image quality check to sort the images is performed at this point .",
    "the reason for this is that hifi , with its high frame rate , acquires more images than actually needed for the image restoration .",
    "usually 500 images are taken per burst and only the 100 best are used for the restoration .",
    "the other images are dropped .",
    "however , the user can change this criterion .",
    "we take advantage of the median filter - gradient similarity ( mfgs ) introduced by ( * ? ? ?",
    "* deng  ( 2015 ) ) , to scrutinize the image quality .",
    "the mfgs code is implemented in an independent idl routine and is applied to every single image .",
    "each pixel has now a value between 0 and 1 .",
    "this value and additional statistics related to the mfgs are stored in a separate idl save file and also added to the fits header .",
    "finally , the average mfgs value over the whole image is used as a reference . note that the mfgs value is only calculated for the images of one of the cameras .",
    "this is justified since both cameras strictly acquire images at the same time , hence , both were recorded under the same seeing conditions .",
    "finally , the sorted images according to their mfgs value ( level 1.0 data ) are written into a fits file using standard routines of the idl astronomy user s library hosted at .",
    "the two bursts of images are written alternately in a single fits file using image extensions ( ( * ? ? ?",
    "* ponz  1994 ) ) .",
    "odd extension numbers belong to images from one filter whereas even numbers belong to the other filter .",
    "the file has a detailed primary header with all relevant information about the observations .",
    "furthermore , there are extension headers for each image showing only image specific information , e.g. , the wavelength , image statistics , and mfgs information .",
    "the data restoration is carried out using the speckle - interferometry code kisip ( ( * ? ? ?",
    "* wger & von der lhe 2008 ) ) to produce science - ready data ( level 2.0 data ) as shown in fig .",
    "gfpi and hifi data are stored at the data archive of aip ( http://gregor.aip.de[gregor.aip.de ] ) . in addition , the pipeline generates a webpage , which includes an overview of the acquired observations as well as quick - look images and statistics .",
    "the data recorded since 2014 will be made public to the solar community .",
    "the stools pipeline is under constant development .",
    "an official version will be released in 2017 via a version control system on the abovementioned webpage under creative commons license .",
    "this work was carried out as a part of the solarnet project supported by the european commission s 7th framework programme under grant agreement no .",
    "the 1.5-meter gregor solar telescope was built by a german consortium under the leadership of the kiepenheuer - institut fr sonnenphysik in freiburg ( kis ) with the leibniz - institut fr astrophysik potsdam ( aip ) , the institut fr astrophysik gttingen ( iag ) , the max - planck - institut fr sonnensystemforschung in gttingen ( mps ) , and the instituto de astrofsica de canarias ( iac ) , and with contributions by the astronomical institute of the academy of sciences of the czech republic ( ascr ) .",
    "sjgm is grateful for financial support from the leibniz graduate school for quantitative spectroscopy in astrophysics , a joint project of aip and the institute of physics and astronomy of the university of potsdam ."
  ],
  "abstract_text": [
    "<S> a huge amount of data has been acquired with the gregor fabry - prot interferometer ( gfpi ) , large - format facility cameras , and since 2016 with the high - resolution fast imager ( hifi ) . </S>",
    "<S> these data are processed in standardized procedures with the aim of providing science - ready data for the solar physics community . for this purpose , </S>",
    "<S> we have developed a user - friendly data reduction pipeline called `` stools '' based on the interactive data language ( idl ) and licensed under creative commons license . </S>",
    "<S> the pipeline delivers reduced and image - reconstructed data with a minimum of user interaction . </S>",
    "<S> furthermore , quick - look data are generated as well as a webpage with an overview of the observations and their statistics . </S>",
    "<S> all the processed data are stored online at the gregor gfpi and hifi data archive of the leibniz institute for astrophysics potsdam ( aip ) . </S>",
    "<S> the principles of the pipeline are presented together with selected high - resolution spectral scans and images processed with stools . </S>"
  ]
}