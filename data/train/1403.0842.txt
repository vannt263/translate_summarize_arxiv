{
  "article_text": [
    "a well established property of financial markets is that the order flow , defined as the process assuming value one for buyer initiated trades and minus one for seller initiated trades , displays a very slowly decaying autocorrelation function  @xcite .",
    "since a buyer initiated trade moves on average the price up and a seller initiated trade moves it down , one would naively expect that a correlated flow induces a correlated return time series .",
    "however this latter correlation is not observed in real data because it would allow to easily predict price movements , and therefore would provide arbitrage opportunity .",
    "reconciling correlated order flow with uncorrelated price returns is therefore a subtle issue , which is subject of current research ( see also  @xcite for a recent review ) .",
    "the autocorrelation of order flow is strictly connected with the fact that large trading volumes are typically fragmented in small trades and executed incrementally ( see  @xcite ) . in this way , investors are able to execute much of the large order , which is called _ metaorder _ , minimizing the price impact and the leakage of information on their trading activity .    a possible mechanism for efficiency is the _ asymmetric liquidity _  @xcite .",
    "defining price impact of a trade as the difference between the log - price before the next trade and the price before the current trade , asymmetric liquidity states that the price impact of a type of order ( buy or sell ) is inversely related to the probability of its occurrence .",
    "this means that if at a certain point in time it is more likely that the next trade is a buy rather than a sell , a buyer initiated trade will have a smaller impact than a seller initiated trade .",
    "there is therefore a compensation between probability of an event and its effect on the price .     for the asset astrazeneca in 2004.,width=283 ]    an empirical demonstration of the asymmetric liquidity",
    "is given in figure  [ fig : ret_vs_correctness ] .",
    "we indicate with @xmath0 the sign of the @xmath1-th trade , where @xmath2 ( @xmath3 ) for a buyer ( seller ) initiated trade .",
    "moreover @xmath4 is the observed price impact due to the @xmath5th trade ( according to the definition above ) .",
    "we construct an autoregressive predictor @xmath6 $ ] of the order flow , where @xmath7 and @xmath8 are , respectively , the information set used and the particular model used to describe the order flow ( see below for more details on the predictor ) .",
    "we compute the average signed stock return @xmath9 conditional on the sign predictor @xmath10 and on being triggered by a buy @xmath11 or sell @xmath12 initiated trades .",
    "the investigated stock is astrazeneca traded on the london stock exchange in the whole year 2004 . from the buyer",
    "initiated trades curve ( blue triangles ) , we observe that when the next order is more likely to be a buy ( essentially due to an excess of buys in the recent past ) , _ i.e. _ @xmath13 , a buy trade moves on average the price less than a sell trade .",
    "the opposite occurs when the next order is more likely to be a sell ( @xmath14 ) .",
    "this is exactly what asymmetric liquidity prescribes and in this case the mechanism is at work even at the level of individual transactions .",
    "the asymmetric liquidity mechanism is conceptually clear , but it does not give any indication about the microstructural mechanisms which are responsible of it .",
    "in other words , why does a highly predictable trade impact very marginally prices ?",
    "there are several possible explanations , which can be for the sake of convenience classified into two categories : the first one includes those mechanisms due to the action of the initiators of the trade and the second one where the liquidity providers are responsible .",
    "in fact , in an electronic double auction market , the initiator of the trade ( the _ liquidity taker _ ) can control the volume of the market order initiating the trade . in this way she can decrease the probability that her order triggers a price change by using small volumes when her order sign is more predictable . on the other hand , other agents submitting and cancelling limit orders ( the _ liquidity providers _ ) can control the price adjustment between two trades .",
    "this can be done , for example by reverting , at least partly , the price when a predictable order arrives and moving the price in the same direction of the trade when its sign is unpredictable . in reality",
    "both types of agents are partly responsible of asymmetric liquidity . in this paper",
    "we want to investigate empirically which microstructural mechanisms enforce efficiency of prices .",
    "we will present an extensive empirical analysis aimed at identifying the main contributions to asymmetric liquidity and therefore to price efficiency .",
    "the persistence of the order flow leads to significant challenges also in the modeling of the order book dynamics .",
    "order book modeling is a complex task , especially if one wants to take into account the strategic behaviour of economic agents .",
    "for this reason , in recent years there has been a growing interest toward the statistical modeling of order book .",
    "this type of modeling , pioneered by  @xcite , drops agent rationality almost completely and describes the different types of orders as random variables .",
    "although no one would dispute that agents in financial markets behave strategically , and that for some purposes taking this into account is essential , there are some problems where other factors might be more important .",
    "for example , this approach has the merit that can be calibrated and tested against real data  @xcite , because it presents simple quantitative laws that relate one set of market properties to another , placing restrictions on the allowed values of variables .",
    "the simplest class of these models are the so called `` zero - intelligence '' models , where one assumes that limit and market orders arrive randomly according to poisson processes .",
    "moreover queued limit orders are cancelled according to a poisson process . to keep the model as simple as possible ,",
    "there are equal rates for buying and selling , and all these processes are independent .",
    "the model just described is a prototypical queueing model of limit order book dynamics which consists in specifying the arrival rates of different types of order book events and the rules of execution of these orders . to the same class of models",
    "belong the markovian queueing models discussed in  @xcite .",
    "however , all these modeling approaches neglect the persistence of the order flow , which destroys the markovian feature of the modeling and leads to unrealistic behaviour and wrong predictions on the dynamics of prices . to be specific ,",
    "we have calibrated a zero intelligence model  @xcite on the stock astrazeneca in the whole year 2004 .",
    "we have then replaced in the model the poisson market order flow with the one extracted from the real data .",
    "we have then studied the diffusivity properties of the generated prices . to this end",
    "we computed the `` signature plot '' of the model , _",
    "i.e. _ the plot of the quantity @xmath15}{\\ell } } \\label{eqn : signplot}\\ ] ] where the average @xmath16 $ ] is done over different instants of time @xmath17 , which is the time that immediately precedes the @xmath1-th transaction .",
    "this quantity is a measure of the volatility of the price process on time scale @xmath18 . for a purely diffusive process , @xmath19 is constant and independent of @xmath18 . if @xmath20 decays when @xmath18 increases , the price motion is `` sub - diffusive '' and it has a mean - reverting behaviour ( there exist negative correlations between lagged returns ) . on the other hand ,",
    "if @xmath20 increases when @xmath18 increases , the price process is super - diffusive and it shows a trending behaviour ( positive correlations between lagged returns ) .",
    "thus , a necessary condition for price efficiency is that @xmath19 is constant .",
    "it is well known that real price time series show a sub - diffusive behaviour for very short lags , and then the price is diffusive at the other lags .    ) of a simulation of the model discussed in  @xcite .",
    "the parameters are calibrated on astrazeneca in the whole year 2004 and we used the real market order flow as input of the model . ]    in figure  [ fig : smith_real_flow ] we present the result of the above described monte carlo simulation .",
    "we observe that price is initially sub - diffusive and for lags larger than @xmath21 trades it becomes super - diffusive .",
    "it is evident that embedding a persistent order flow in the framework developed in  @xcite induces a super - diffusive behaviour of prices .",
    "an analogous pattern should be expected from any markovian model .",
    "recent attempts of modeling the limit order book with strongly persistent order flow include  @xcite . in these papers",
    ", however , either the diffusivity is not guaranteed  @xcite , or it is attained by fine tuning the value of a parameter describing the counterbalancing reaction to the order flow persistence  @xcite . more importantly , in this last case ( detailed below ) diffusivity is recovered up to the time scale of the lifetime of limit orders , while for longer time scales the price becomes super - diffusive .    in this paper",
    ", we propose a new statistical model of the limit order book which is able to give diffusive prices at all time scales and to reproduce the empirical statistical properties observed to explain the underlying mechanisms of the asymmetric liquidity .",
    "the key ingredient of the modeling is a liquidity dynamics that adapts itself to the degree of predictability of the order flow . in other words , instead of having a fine tuning of a parameter that guarantees ( approximate ) diffusivity , we model liquidity as an adaptive process that responds to the local predictability of the order flow and gives exact diffusivity .    the paper is organized as follows .",
    "section  [ sec : datasets ] describes the investigated data and in section  [ sec : empirical ] we present the empirical findings on the microstructural mechanisms responsible of the restoration of price efficiency and diffusivity when the order flow is correlated . in section  [ sec : statistical ] we discuss the incompatibility between existing limit order book models , correlated order flow , and price diffusion .",
    "section  [ sec : adaptive ] presents our model and the main theoretical findings and in section  [ sec : numerical ] we discuss some numerical simulations of the model .",
    "finally , in section  [ sec : conclusions ] we draw some conclusions .",
    "the data used in our empirical analysis belong to two distinct datasets spanning different time periods and recorded on different markets .",
    "the first dataset corresponds to the trading activity of two stocks traded on the london stock exchange ( lse ) during the whole year 2004 .",
    "the second one is more recent and records the activity of two stocks traded on the nasdaq stock exchange in new york .",
    "this dataset covers only a short period of time , namely july and august 2009 , but the higher trading frequency partially compensates for the shorter horizon .",
    "the lse dataset includes the limit order book information about the astrazeneca ( azn ) and vodafone ( vod ) stocks .",
    "the data come from the stock exchange electronic trading service ( sets ) , the lse s flagship electronic order book , and contain the detailed description of all order book events ( submissions of limit and market orders and cancellations of outstanding orders ) which occurred in the whole year of 2004 ( 254 trading days ) . in particular , the information concerning the market order events report the execution time of the event , the sign of the order ( _ i.e. _ if it is buyer or seller initiated ) , the traded volume and price .",
    "we select azn and vod because of the sensible difference in the discretization of the prices .",
    "azn has a tick size - price ratio of few basis points , whereas vod is characterized by a very large tick size - price ratio ( see table  [ tab : info_datasets ] ) .",
    "for this reason , we refer to the former as a small - tick stock , while to the latter as a large - tick stock .",
    "the second dataset includes all the executed trades and order book updates of stocks traded at the nasdaq market in new york . in particular , we analyse two liquid stocks , namely a small - tick stock , apple ( aapl ) , and , a large - tick stock ( relatively to aapl ) , microsoft ( msft ) .",
    "the data cover 42 days of trading activity during july and august of 2009 .",
    "for the two datasets , we have taken care of the possibility that the execution of a single market order hitting several existing limit orders produces many records with the same timestamp .",
    "we have aggregated them in a single market order , whose volume is the cumulative volume of the components .",
    "a summary of the properties of the four stocks is collected in table  [ tab : info_datasets ] .",
    "the empirical analysis has been performed using a code written in the _ python _ programming language .",
    "specifically , we have used the scientific _ scipy _ libraries , the statistical library _ statsmodels _ , while all the graphs have been generated by the plotting library _",
    "@lrrrrr & & number of & average & average & average + & & trades & intertrade time & stock price & tick size - price ratio + aapl & & 857,925 & 1.1 s & 157.17 usd & 0.6 bp + msft & & 575,040 & 1.7 s & 23.74 usd & 4.2 bp + azn & & 405,481 & 23.1 s & 24.38 gbp & 4.1 bp + vod & & 411,736 & 22.9 s & 1.34 gbp & 18.7 bp +",
    "in this section we investigate empirically the mechanisms responsible for restoring efficiency and , as a consequence , diffusivity of prices .",
    "more specifically , we perform an empirical analysis in order to investigate the origin of the asymmetric liquidity mechanism .",
    "we consider the variables of the order book at the instant of time @xmath17 which immediately precedes the @xmath1-th transaction .",
    "the best ask price @xmath22 is the lowest price among the sell limit orders in the book at time @xmath17 .",
    "symmetrically , the best bid price @xmath23 is the highest price among the buy limit orders quoted in the book .",
    "then , we can define the midpoint price @xmath24 , and introduce the logarithmic quantities , namely , the best ask log - price @xmath25 , the best bid log - price @xmath26 , and the log - midprice @xmath27 .",
    "then , we characterize the limit order book sparsity by means of the bid ( ask ) gap and the volume at the best bid ( ask ) quote . the former is the logarithmic price difference between the best bid quote and the second best bid quote , _ i.e. _ @xmath28 ( between the second best ask quote and the best ask quote , _",
    "i.e. _ @xmath29 ) , where the variable @xmath30 ( @xmath31 ) is the second best bid ( second best ask ) price .",
    "the last investigated quantity is the amount of shares available at the best bid @xmath32 ( at the best ask @xmath33 ) .",
    "given the crucial role played by the order flow and following  @xcite we introduce the _ sign predictor _ and study the variables characterizing the state of the order book conditioned on its value .",
    "assuming a model for the order flow process , we can compute at each time @xmath34 the expected value of the future market order sign , @xmath6 $ ] , conditional to the information set @xmath7 ( typically the past order flow ) and the particular model @xmath8 used to describe the order flow . in early works ,",
    "the order flow was modelled in terms of a real valued autoregressive process , but clearly the order flow takes only discrete values .",
    "thus , we model it by means of a discrete autoregressive process of order @xmath35 ( _ dar(p ) _ ) , which is an integer valued process easy to calibrate on real data .",
    "dar(p ) _ was introduced in a series of papers  @xcite and describes a sequence of stationary discrete random variables with the properties of a markov process of order @xmath35 . in  [ app : dar ] we review the main properties of the _",
    "dar(p ) _ process , its auto - covariance structure and how to forecast it .",
    "the first step in our analysis is the estimation of the _",
    "dar(p ) _ model by using the observed order flow @xmath0 .",
    "when performing estimation we discard the first @xmath35 trades of each trading day to avoid spurious overnight effect .",
    "the idea is that a sign predictor obtained with the order flow partially observed the previous trading day is less significant than a sign predictor computed with the order flow which belongs entirely to the same trading day .    in order to evaluate the predictability of order flow , we rely on the sign predictor defined by equation  [ eqn : epshat ] in  [ app : dar ] , @xmath36 $ ] , and specify a loss function indicating how much our prediction is correct . we employ the mean square error ( mse ) defined as @xmath37\\,.\\ ] ]    this function has an upper bound equal to @xmath38 , when the prediction is always wrong , and a lower bound @xmath39 when the prediction is systematically correct .",
    "when @xmath40=0 $ ] , the mse is equal to @xmath41 $ ] and this value is the upper bound in case of no predictability of the model .     trades . ]     trades . ]",
    "+     trades . ]     trades . ]    in table  [ tab : mse ] we list the mse values computed for aapl , msft , azn , vod , and three different values @xmath42 . as anticipated , we see that the mse values obtained for each stock are almost independent from the order @xmath35 of the auto - regression .",
    "thus , for the rest of the analysis we fix it equal to 500 .",
    "@lcccccc & & + & @xmath43 & @xmath44 & @xmath45 & @xmath43 & @xmath44 & @xmath45 + aapl & @xmath46 & @xmath47 & @xmath48 & @xmath49 & @xmath50 & @xmath51 + msft & @xmath52 & @xmath53 & @xmath54 & @xmath55 & @xmath56 & @xmath57 + azn & @xmath58 & @xmath59 & @xmath60 & @xmath61 & @xmath62 & @xmath63 + vod & @xmath64 & @xmath65 & @xmath66 & @xmath67 & @xmath68 & @xmath69 +    we notice that the mse values of small - tick stocks are always higher than the values of large - tick stocks within the same dataset .",
    "more interestingly , there are substantial differences between the mse of the stocks belonging to the lse and nasdaq datasets .",
    "the mse for aapl and msft are smaller than those of azn and vod , which are closer to the value @xmath41 $ ] .",
    "we also compute the lagged sign predictor @xmath70 $ ] for @xmath71 and in figure  [ fig : dist_pred ] we show the distributions of the sign predictor values corresponding to @xmath72 trades .",
    "two distinct regions characterize the predictor distributions : the region where the values of the sign predictor are close to the extrema of the support , and the region where the predictor is close to zero .",
    "the former is the high predictability region and indicates that the corresponding market operates in a high predictable regime .",
    "this is the case for the nasdaq dataset for @xmath73 and the effect is more intense for the large - tick stock msft than for aapl .",
    "the latter is the low predictability region where typically @xmath74 .",
    "the lse market for both azn and vod operates under this regime confirming the previous findings about the mse values .",
    "it is worth noticing that when the value of @xmath75 increases from 0 to 10 , the predictor distribution converges to the low predictability region also for the assets belonging to the nasdaq dataset .",
    "this convergence is faster for the small - tick asset aapl than for msft , thus we expect that possible divergences from an efficient behaviour should be more evident for large - tick stocks .",
    "equipped with the order sign predictor , we measure the order book state variable at the instant of time which immediately precedes the @xmath1-th transaction ( @xmath76 ) conditional on the predictor value @xmath10 .",
    "we use the _",
    "dar(500 ) _ model to construct a sign predictor and we split the range of @xmath10 into a finite number of bins .",
    "we do not evenly sample the bins , but we fix the bins according to the empirical quantiles requiring that the number of empirical sign predictors falling within each bin is the same .    the first quantity that we consider is the volume outstanding at the best quotes . the best bid and",
    "ask volumes are natural indicators of the liquidity available on each side of the order book .",
    "we condition the volume at the best ask @xmath33 and the volume at the best bid @xmath32 on the level of the sign predictor , and we take their conditional expectation , @xmath77 $ ] and @xmath78 $ ] . in figure",
    "[ fig : volbest ] we show the conditional average of the best volumes as a function of @xmath10 for the assets aapl , msft , azn , and vod .",
    "$ ] and conditional best bid volumes @xmath78 $ ] on different sign predictor values , for four stocks ( aapl , msft , azn , vod ) .",
    "the error bars are standard errors . ]",
    "$ ] and conditional best bid volumes @xmath78 $ ] on different sign predictor values , for four stocks ( aapl , msft , azn , vod ) .",
    "the error bars are standard errors . ]",
    "+    $ ] and conditional best bid volumes @xmath78 $ ] on different sign predictor values , for four stocks ( aapl , msft , azn , vod ) .",
    "the error bars are standard errors . ]",
    "$ ] and conditional best bid volumes @xmath78 $ ] on different sign predictor values , for four stocks ( aapl , msft , azn , vod ) .",
    "the error bars are standard errors . ]",
    "we start commenting on the stocks which belong to the lse dataset .",
    "we recall from figure  [ fig : dist_pred ] that for azn and vod the sign predictor is mainly distributed in the low predictability region .",
    "we focus on the behaviour of the volumes at the best ask , for those at the bid side similar comments apply .",
    "when buy orders are more likely than sell orders ( @xmath13 ) the average volume outstanding at the ask side is smaller than the volume outstanding at the bid side .",
    "moreover , when the sign predictor increases , the best ask volumes decrease and the best bid volumes increase .",
    "this behaviour is compatible with a model where liquidity takers mechanically erode the liquidity available at the opposite side of the book .",
    "indeed , a positive sign predictor means that the recent order flow has been dominated by a sequence of buy orders and the volume outstanding at ask side of the book has been eroded by market orders .",
    "however , when the predictor is approaching the upper bound ( @xmath79 ) , the volume at the ask side starts to increase . indeed , high predictability of the order flow means that significant information about the intentions of the liquidity taker has been released to the market and a large fraction of her metaorder has been executed .",
    "thus , the probability that the metaorder is close to expiration is high and it becomes pressing for liquidity providers to refill the ask side of the order book at the best price .",
    "for the lse dataset both the large - tick and the small - tick assets manifest the same behaviour .",
    "when we switch to the nasdaq dataset the picture is less clear . while the large - tick asset msft follows the same pattern of the lse assets , for aapl",
    "the situation is different . when buy orders are very likely ( @xmath80 ) the volume refill of the liquidity providers dominate and the average outstanding volume increases with @xmath10 .",
    "however , since we know that the sign predictor is concentrated in the high predictable region conclusions about the behaviour of the average volume in the central region are less definitive .",
    "finally , we notice that the volumes at the best quotes are higher in large - tick stocks than in small - tick stocks , not only in the number of shares but also in dollar ( pound ) value .",
    "in fact , if we multiply the average volume by the average price , we find that there is a difference of one ( two ) order of magnitude between large - tick and small - tick stocks of the nasdaq ( lse ) dataset .",
    "this difference is likely caused by the discretization effect of limit prices since liquidity providers suffer less availability of quotes in large - tick than in small tick stocks and they pile up volumes at the same price .",
    "following the same procedure described in the previous section , we consider the conditional distribution of the bid ( ask ) logarithmic gap between the best bid price and the second best quote ( the best ask price and the second best ask quote ) immediately before the transaction time @xmath81 .",
    "as before we compute the expectation of these quantities conditioning on the level of the sign predictor , _",
    "i.e. _ we compute @xmath82 $ ] and @xmath83 $ ] .",
    "$ ] and conditional bid gap @xmath83 $ ] as a function of the sign predictor for the four stocks ( aapl , msft , azn , vod ) .",
    "the error bars are standard errors . ]",
    "$ ] and conditional bid gap @xmath83 $ ] as a function of the sign predictor for the four stocks ( aapl , msft , azn , vod ) .",
    "the error bars are standard errors . ]",
    "+    $ ] and conditional bid gap @xmath83 $ ] as a function of the sign predictor for the four stocks ( aapl , msft , azn , vod ) .",
    "the error bars are standard errors . ]",
    "$ ] and conditional bid gap @xmath83 $ ] as a function of the sign predictor for the four stocks ( aapl , msft , azn , vod ) .",
    "the error bars are standard errors . ]    in figure  [ fig : gap ] we plot the conditional mean of the bid and ask gap as a function of the sign predictor for the stocks aapl , msft , azn , and vod .",
    "we observe that for large - tick stocks , independently of the dataset , the bid and ask gap are approximately constant and equal to one tick for all sign predictor values .",
    "this is largely expected and is due to the high level of discretization of limit prices . for small - tick stocks",
    "the bid gap is larger than the ask gap when sell orders are more likely ( @xmath14 ) , whereas the ask gap is larger than the bid gap when buy orders are more likely ( @xmath13 ) .",
    "the slope of the curves strongly change if we move from the lse asset to the nasdaq asset .",
    "for azn the bid gap monotonically decreases and the ask gap monotonically increases when the sign predictor value increases . for aapl",
    "when the sign predictor increases and a buy order is more probable the ask gap decreases , whereas when the sign predictor goes from zero to the minimum value the ask gap increases .",
    "the opposite behaviour holds for the bid gaps .    in conclusion , for large - tick assets the conditional distribution of the gaps",
    "is not informative .",
    "conversely , for small - tick assets figures show an interesting behaviour .",
    "if buy orders are very likely at a given time it means that many buy orders have taken place in the recent past and they have eroded liquidity and increased the sparsity of the ask side of the book .",
    "therefore , the slope of the gap distribution for azn could be consistent with a purely mechanical effect due to the erosion of the market orders",
    ". however , this explanation neglects the possible presence of liquidity providers refilling the order book .",
    "moreover , as it will be clarified in the next section , liquidity takers adjust their trades in order to minimize the price impact , they do not penetrate the opposite side of the order book , and thus the impact of the erosion can not be the only mechanism which determines sparsity of the order book . finally , the slope of the curves for aapl can not be explained without considering the interplay with market makers .",
    "indeed , the negative slope of the curve for the ask gap when predictability increases suggests that the extreme probability of a buy order stimulates the liquidity providers to refill the ask side of the book . for aapl",
    "the figure is consistent with a refill taking place not only at the opposite best , as already confirmed by the volume curve , but also at quotes inside the order book and close to the best price .      we now ask how market orders , limits and cancellations determine the price impact .",
    "we define the returns as the difference of the logarithmic mid - prices measured immediately before the @xmath1-th and the @xmath84-th trades , @xmath85 , and we decompose them in two components .",
    "the first component is due to the mechanical impact of market orders , @xmath86 , and is given by the difference between the log - price observed immediately after and the one observed before the trade .",
    "the second component is the aggregate effect of the quote revision @xmath87 and cumulates the effect of all the limit orders and cancellations placed in the order book immediately after the @xmath1-th trade and before the next trade .",
    "thus , we have @xmath88 then , we introduce the quantity @xmath89 which measures the correctness of a prediction at a given trade time @xmath17 and quantifies the surprise of the transaction sign given the level of the predictor . the former information is delivered by the sign of @xmath89 since when @xmath89 is positive we can conclude that the prediction was correct , whereas when @xmath89 is negative the prediction was wrong .",
    "the amount of surprise associated to the realized order sign is instead related to the absolute value of @xmath89 .",
    "for instance , a large negative value of @xmath89 is more informative than a negative value close to zero since it implies that the order sign was largely unexpected by the market .",
    "we are interested in the conditional expectation of the return components @xmath90 ,",
    "\\qquad \\mathbb{e}[\\epsilon_n r_n^q|\\epsilon_n\\cdot\\hat{\\epsilon}_n],\\ ] ] which show how the correctness of the sign prediction determines the mechanical and quote revision impact , respectively .",
    "the first term is the conditional expectation of the mechanical impact and depends on the probability of an order to penetrate the opposite best price and on the distribution of the gaps on the opposite side of the book , @xmath91 .",
    "this expectation satisfies the approximate relation @xmath92&\\simeq&\\sum_{r_n^m",
    "\\neq 0}\\epsilon_n r_n^m p(v_n \\geqslant v_n^{ob},\\epsilon_n g_n^{ob } \\simeq 2r_n^m|\\epsilon_n\\cdot\\hat{\\epsilon}_n,\\mathcal{c}_n^v ) \\nonumber \\\\    & = & \\sum_{r_n^m \\neq 0}\\epsilon_n r_n^m p(v_n \\geqslant v_n^{ob}|\\epsilon_n\\cdot\\hat{\\epsilon}_n,\\mathcal{c}_n^v)p(\\epsilon_n g_n^{ob } \\simeq 2r_n^m|v_n \\geqslant v_n^{ob},\\epsilon_n\\cdot\\hat{\\epsilon}_n,\\mathcal{c}_n^v ) \\nonumber \\\\    & \\simeq&p(v_n \\geqslant v_n^a|\\epsilon_n\\cdot\\hat{\\epsilon}_n,\\mathcal{c}_n^v,\\epsilon_n=1)\\mathbb{e}\\left[\\frac{g_n^a}{4}\\bigg|v_n \\geqslant v_n^a,\\epsilon_n\\cdot\\hat{\\epsilon}_n,\\mathcal{c}_n^v,\\epsilon_n=1\\right ] \\nonumber \\\\    & & + \\,p(v_n \\geqslant v_n^b|\\epsilon_n\\cdot\\hat{\\epsilon}_n,\\mathcal{c}_n^v,\\epsilon_n=-1)\\mathbb{e}\\left[\\frac{g_n^b}{4}\\bigg|v_n \\geqslant v_n^b,\\epsilon_n\\cdot\\hat{\\epsilon}_n,\\mathcal{c}_n^v,\\epsilon_n=-1\\right ] \\nonumber \\\\    & \\equiv & r_n^m(\\hat{\\epsilon}_n)\\,,\\label{eqn : mec_impact}\\end{aligned}\\ ] ] where @xmath93 and @xmath94 are the opposite best and second opposite best volumes , respectively , @xmath95 is the volume of the market order , and @xmath96 corresponds to the condition @xmath97 .",
    "the approximate equality in the first line is due to two distinct effects .",
    "first , we neglect the possibility that the market order volume is greater than the sum of the best and second opposite best volumes . in real datasets",
    "this condition is verified for the large majority of the transactions and only in a very small fraction of trades ( @xmath98 ) a market order penetrates the opposite side of the book deeper than the first price level ( see also  @xcite ) .",
    "this is in particular true for large - tick assets .",
    "then , we assume that @xmath99 when @xmath100 , which is exactly true for linear gaps and linear returns and holds only approximately for logarithmic quantities .",
    "for instance , for buy orders the relation between log - gaps and mechanical log - returns is given by @xmath101 where @xmath102 .",
    "finally , the approximation in the third line of equation  [ eqn : mec_impact ] follows from the realistic assumption that @xmath103 .",
    "the quantity @xmath104 corresponds to the conditional probability that the volume of a market order is larger than the liquidity available at the opposite best .",
    "thus , it represents the probability that a market order immediately triggers a mid - price change .",
    "we estimate the penetration probability on the real datasets and condition it on the correctness of the order sign predictor @xmath89 , but we remove the mild conditioning @xmath96 . starting from the quantities @xmath105 we express the total penetration probability of market orders as @xmath106 \\,,\\ ] ] where we have assumed that @xmath107 .",
    "we also compute the conditional average fraction of liquidity eroded by a market order @xmath108 $ ] with @xmath109 .    .",
    "the error bars are standard errors . ]    .",
    "the error bars are standard errors . ]",
    "the error bars are standard errors . ]    .",
    "the error bars are standard errors . ]",
    "figure  [ fig : penetration_fraction ] shows the conditional penetration and fraction for aapl , msft , azn and vod .",
    "we see that for all the stocks the eroded fraction tracks quite well the behaviour of the penetration probability , and we observe the largest discrepancies for the nasdaq assets in a region @xmath110 which is scarcely populated . for the lse",
    "dataset the penetration probability is consistent with previous findings in the literature  @xcite , _ i.e. _ when the order sign predictability increases and the prediction is correct , the probability of penetration drops . the stocks of the nasdaq dataset ( aapl , msft ) show deviations from a monotonic behaviour .",
    "msft shows an increasing penetration probability when the order sign predictability increases and the prediction is correct up to @xmath111 then drops , whereas for aapl deviations from a decreasing behaviour are relevant in the region where @xmath112 .",
    "this effect leads to inefficiencies of the market that we will comment about more extensively in the next section .",
    "finally , as expected the penetration probability of large - tick stocks ( msft , vod ) is lower than the probability of small - tick stocks ( aapl , msft ) . indeed , for large - tick stocks market orders eroding the opposite liquidity are less frequent since they trigger a large impact on the mid - price .",
    "$ ] and conditional market order volumes @xmath113 $ ] for aapl , msft , azn , and vod .",
    "the error bars are standard errors . ]",
    "$ ] and conditional market order volumes @xmath113 $ ] for aapl , msft , azn , and vod .",
    "the error bars are standard errors . ]",
    "+    $ ] and conditional market order volumes @xmath113 $ ] for aapl , msft , azn , and vod .",
    "the error bars are standard errors . ]",
    "$ ] and conditional market order volumes @xmath113 $ ] for aapl , msft , azn , and vod .",
    "the error bars are standard errors . ]    in figure  [ fig : vol_mo_ob ] we examine in more detail the empirical behaviour of the opposite best volume and market order volume whose ratio leads to the fraction of eroded liquidity . for msft , azn , and vod two aspects are common : the conditional average market order volume decreases with @xmath89 .",
    "the second striking feature is the behaviour of the average amount of volume available at the opposite side .",
    "it decreases when the correctness increases , then , for @xmath114 it increases quickly .",
    "thus , up to moderate values of @xmath89 liquidity is removed from the opposite best either because of a mechanical erosion or because liquidity providers revise their limit orders .",
    "then , finally , the high predictability stimulates the liquidity refill , a liquidity barrier piles up at the opposite best and the penetration probability drops . for aapl",
    "the conditional average market order volume is independent from the predictability of the order flow .",
    "however , there are clear signs of the liquidity refill effect",
    ". we can therefore interpret these effects concluding that liquidity takers adapt their orders to the outstanding liquidity only when correctness is not too high , because in the extreme region of predictability liquidity takers shrink the volume of their markets orders , though the available volume at the opposite side is high .    in light of above considerations about outstanding and market volumes , and gap distributions",
    ", we can now discuss the observed behaviour of the price impact . in figure",
    "[ fig : return ] we show the conditional mechanical impact @xmath86 , the approximate expression @xmath115 derived in equation  [ eqn : mec_impact ] , and the whole impact @xmath4 conditioned on @xmath89 for aapl , msft , azn , and vod .    $ ] , the approximate expression @xmath115 , and conditional returns @xmath116 $ ] for the stocks aapl , msft , azn , vod .",
    "the error bars are standard errors . ]",
    "$ ] , the approximate expression @xmath115 , and conditional returns @xmath116 $ ] for the stocks aapl , msft , azn , vod .",
    "the error bars are standard errors . ]",
    "+    $ ] , the approximate expression @xmath115 , and conditional returns @xmath116 $ ] for the stocks aapl , msft , azn , vod . the error bars are standard errors . ]",
    "$ ] , the approximate expression @xmath115 , and conditional returns @xmath116 $ ] for the stocks aapl , msft , azn , vod .",
    "the error bars are standard errors . ]    from this figure we notice that the approximate quantity @xmath115 reproduces extremely well the mechanical impact .",
    "this evidence supports the idea that the mechanical component of the impact is mainly determined by the gap distribution and by the penetration probability of a market order .",
    "the second relevant message is that whenever the correctness of the order sign increases the mechanical impact of the order decreases .",
    "this result confirms the results in  @xcite , but now we can better understand what is happening in the order book . indeed , for large - tick assets the gap is basically constant , so the main determinant of the impact is the penetration probability .",
    "while for vod the decrease of the mechanical impact is evident for all values of @xmath89 , for msft the drop of the impact becomes clearer when we reach large values of @xmath89 .",
    "the penetration probability is determined by the interplay between the volume outstanding at the opposite side and the volume of the market order . from figure",
    "[ fig : vol_mo_ob ] we know that the volume at the opposite best drops when @xmath89 increases and increases again only for very large values of the correctness .",
    "thus , the reduction of the impact has to be given by the decrease of the penetration probability which is determined for high values of @xmath89 by liquidity takers placing market orders of decreasing volumes and by liquidity providers placing limit orders at best opposite quotes .",
    "from the difference between the return impact and the mechanical return we can also infer the impact of quote revisions and draw conclusions about the adaptive behaviour of liquidity providers .",
    "figure  [ fig : return ] shows that the quote revision always acts in the same direction of the mechanical impact ( the only exception is represented by the two extreme bins in the msft plot , but such evidence should be confirmed with a more systematic analysis of large - tick stocks from the nasdaq dataset ) .",
    "this suggests that when the correctness increases , liquidity providers tend to cancel their old limit orders and place new orders at quotes beyond the best price .",
    "however , this effect becomes less and less severe when the correctness of the sign predictor is very high , since the impact of the quote revision shrinks to zero , and liquidity providers increase the volume of limit orders outstanding at the opposite best . for small - tick assets the empirical analysis gives similar results .",
    "the mechanical impact still decreases when @xmath89 increases for both azn and aapl . from the analysis of the best volume and market order volume profiles",
    "we conclude that this effect is due to liquidity takers which adjust their order volume to the outstanding liquidity and thus drop the penetration probability .",
    "the quote revision acts as for the large - tick assets in a similar way : for moderate levels of @xmath89 the liquidity providers revise their position , whereas for extreme values the revision stops and liquidity piles up at the opposite best .",
    "the major difference between azn and aapl emerges looking at the gap distribution . indeed , for azn it increases monotonically with @xmath89 , whilst for aapl it diminishes ( see figure  [ fig : gap ] ) .",
    "since liquidity takers act in a similar fashion for both assets , the cause of the different behaviour has to be attributed to the different way liquidity providers revise their position .",
    "however , a precise answer to this question is beyond the scope of the current analysis and should deserve further investigation .",
    "the analysis of empirical data discussed in the previous sections largely confirms that asymmetric liquidity is present in financial markets at the transaction by transaction level .",
    "however , our analysis clarifies that the drop of the price impact when the order sign predictability increases is the result of the adaptive behaviour of both liquidity takers and liquidity providers acting on the market .",
    "in fact , the former adjust their market order volume at the outstanding liquidity , while the latter revise their limit orders and refill liquidity at the best quotes or within the order book as an adaptive answer to the order flow predictability .",
    "how are these results related to market efficiency ? by observing figure  [ fig : return ] , we notice that for azn and vod the return is a non increasing function of @xmath89 , _",
    "i.e. _ more predictable trades have a smaller impact , but this effect is relatively small . ] .",
    "aapl shows more significant deviations around @xmath117 , while msft shows a pattern , which is clearly inconsistent with market efficiency .",
    "we therefore argue that there is room for some inefficiency in the market .",
    "more quantitatively , from the figures for the nasdaq assets we observe that for some @xmath118 @xmath119<\\mathbb{e}[\\epsilon_n(r_n^m+r_n^q)|\\epsilon_n\\cdot\\hat{\\epsilon}_n]\\ , .",
    "\\label{eqn : cond_inefficiency}\\ ] ] this inequality means that if we use the information set @xmath7 at time @xmath34 , a non vanishing predictability of return @xmath4 , @xmath120 \\neq 0 $ ] , still persists .",
    "obviously this condition is necessary but not sufficient for the inefficiency of markets . in the following we use this condition to test for inefficiency of returns .    .",
    "bottom row : returns @xmath121 $ ] for aapl and msft and different step values @xmath75 .",
    "the error bars are standard errors . ]    . bottom row : returns @xmath121 $ ] for aapl and msft and different step values @xmath75 .",
    "the error bars are standard errors . ]",
    "bottom row : returns @xmath121 $ ] for aapl and msft and different step values @xmath75 .",
    "the error bars are standard errors . ]    . bottom row : returns @xmath121 $ ] for aapl and msft and different step values @xmath75 .",
    "the error bars are standard errors . ]    . bottom row : returns @xmath121 $ ] for azn and vod and different step values @xmath75 .",
    "the error bars are standard errors . ]    . bottom row : returns @xmath121 $ ] for azn and vod and different step values @xmath75 .",
    "the error bars are standard errors . ]",
    "bottom row : returns @xmath121 $ ] for azn and vod and different step values @xmath75 .",
    "the error bars are standard errors . ]    . bottom row : returns @xmath121 $ ] for azn and vod and different step values @xmath75 .",
    "the error bars are standard errors . ]    given that at the individual transaction level clear signs of inefficiency exist , one can ask whether these inefficiencies are removed when one considers the expected signed returns @xmath75 steps ( transactions ) ahead , conditional to the present information set . to this end",
    "we use the information set @xmath7 at time @xmath34 to build the predictor of market order sign at time @xmath122 .",
    "we then compute expectations at time @xmath123 conditional to the variable @xmath124 .",
    "in particular we measure @xmath125 , \\qquad p(v_{n+s } \\geqslant v_{n+s}^{ob}|\\epsilon_{n+s}\\cdot\\hat{\\epsilon}_{n+s}).\\ ] ]    the results of these analysis are shown in figures  [ fig : lagged_penetration_return1 ]  and  [ fig : lagged_penetration_return2 ] .",
    "we consistently observe qualitatively the same behaviour as @xmath75 increases .",
    "the conditional return as a function of @xmath124 shows evidences of inefficiency for small values of @xmath75 . for larger values of @xmath75",
    "the curves become closer to a linear relation .",
    "a similar transition is observed when one considers the lagged probability of penetration .",
    "the linear behaviour is consistent with a linear model of market impact , _",
    "i.e. _ a model where @xmath126 where for simplicity we have neglected any dependence on the volume and @xmath127 is an idiosyncratic component . in this model",
    "we have that @xmath128=a ( 1-\\epsilon_n\\cdot\\hat{\\epsilon}_n)\\,,\\ ] ] _ i.e. _ a linear behaviour .",
    "the data shows that this linear behaviour is not observed for @xmath73 , but rather for intermediate values of @xmath75 .",
    "we postulate therefore that a linear model of market impact could be developed to describe returns on an aggregated time scale .",
    "when @xmath75 is very large , the conditional return curves become flatter and flatter .",
    "the flat behaviour can be understood by considering that when the lag @xmath75 is very large , the value of the predictor is typically very close to zero and its predictive power is very low .",
    "in fact in the limit of no predictability , it is @xmath121=\\mathbb{e}[\\epsilon_{n+s}r_{n+s}]$ ] .",
    "it is important to stress that the number of transactions needed to observe a transition from the behaviour of returns which shows inefficiencies to the linear behaviour is different in the two datasets .",
    "specifically , by observing the figures , we note that the stocks of nasdaq market reach an approximately linear behaviour of the return for a value of @xmath75 which is larger than the corresponding @xmath75 for the lse stocks .",
    "we interpret this fact as a sign that nasdaq market needs more trade time to process past information than lse market .",
    "this may seem surprising at first view , because modern financial markets are supposed to be more efficient and faster in processing information when compared to several years ago .",
    "this is surely true in physical time , but it might be false in trade time .",
    "high frequency trading decreases the physical time needed to restore efficiency in the market , but it might increase the trade time .    in order to test this hypothesis more quantitatively , for each stock we estimated the minimal value of @xmath75 such that the inefficiency condition of equation  [ eqn : cond_inefficiency ] is not observed for any value of @xmath118 .",
    "we then multiply this value of @xmath75 by the average time in seconds between trades , already shown in table  [ tab : info_datasets ] , in order to get an average minimal time needed to not observe inefficiency as the one of equation  [ eqn : cond_inefficiency ] . by spanning different @xmath75 values for each stock",
    ", we find that this physical time is @xmath129 ( @xmath130 lags ) for aapl , for msft it is @xmath131 ( @xmath132 lags ) , for azn it is @xmath133 ( @xmath134 lags ) and for vod it is @xmath135 ( @xmath130 lags ) . by considering separately large and small tick size stocks , we conclude that recent nasdaq stocks become efficient in a smaller physical time than older lse stocks .",
    "modeling the dynamics of the order book is in general quite complicated and challenging .",
    "this is due to its multidimensional nature and to the non trivial coupling between the different components of the process . in recent years",
    "there has been a growing interest toward the statistical modeling of the order book  @xcite , _ i.e. _ a modeling approach where the different components of the order flow ( limit orders , market orders , and cancellations ) are treated as independent poisson processes and the state of the order book emerges as the result of the interplay between these different components .",
    "this type of modeling is sometimes termed `` zero - intelligence '' , because the flow of each type of orders follows the simplest unconditional process . despite being conceptually simple ,",
    "this modeling approach has proven to be surprisingly useful in giving testable predictions of some very short time  @xcite or long time  @xcite properties of the order book .    from the previous empirical section",
    "we have seen that a key element describing the microstructure of financial markets is the fact that the order flow is long range correlated . as we have seen in the introduction , when a strongly autocorrelated order flow ( such as the one of real markets ) is used as input of an empirically calibrated statistical model of the order book",
    ", an unrealistic price time series emerges .",
    "in particular , strong predictability of returns and super - diffusivity of prices are observed .",
    "this can be easily understood by considering that we use a strongly correlated input in a markovian model of the order book .    in recent years",
    "there have been few notable attempts of modeling the limit order book dynamics in presence of a strongly correlated order flow .",
    "mike and farmer  @xcite introduced a model with correlated order flow .",
    "however their main task was to reproduce fat tails of returns and not to reproduce diffusive prices and uncorrelated returns , and in fact in their model these last two properties are not verified .",
    "the attempt of understanding how diffusivity can be recovered in a limit order book model with long memory market order flow has been discussed in  @xcite . as we will detail more below , the proposed model is a variation of the basic zero intelligence model where the market order signs are long memory . in order to limit the effect of the persistence of market orders on prices , authors proposed that market order volume is a random fraction @xmath136 of the volume at the opposite best price .",
    "they claimed that for a fixed level of market order persistence , there is a critical value of the mean value of @xmath136 such that the price is diffusive ( see also  @xcite ) .",
    "our model is a variation of the zero intelligence model .",
    "more specifically , the order book is modeled as a discrete price grid of constant minimum price increment @xmath137 ( the tick size , that we set to @xmath138 ) . in the simulations",
    "this grid must be sufficiently large in order to consider it as an infinite support .",
    "each price level is populated by buy limit orders , if the price level is below the current midpoint , or sell limit orders , if the price level is above the current midpoint .",
    "this is the instantaneous snapshot of the order book state , whereas its time evolution is dominated by three different types of stochastic processes : limit order placement , market orders arrival , and cancellations of existing limit orders .",
    "limit order placement follows a poisson process of rate @xmath139 per tick and unit event time , which for simplicity is uniform across the discrete price grid . for each event time and each price level we draw the number of limit orders of size @xmath75 ( in our simulations @xmath140 ) from a poisson distribution .",
    "market orders arrival triggers an immediate transaction with limit orders at the opposite side of the book .",
    "market orders arrive at a rate @xmath141 per unit event time , following a poisson process , which is independent from limit orders and cancellations",
    ". finally , each existing limit order has the same probability @xmath142 per unit event time to be cancelled by liquidity providers .",
    "these features are present also in the zero intelligence model of  @xcite .",
    "the modification to the zero intelligence model affects mostly the market order stochastic process .",
    "we assume that the market order flow sign process has long - range correlations , reflecting the order splitting strategy of large orders used by liquidity takers . in the next section",
    "we detail how we model this correlated process .",
    "moreover , as in  @xcite we set the market order volume executed at time @xmath17 as a fraction @xmath136 of the best opposite volume , @xmath143 .",
    "the scalar @xmath136 is a random variable drawn from a specific distribution taking values in @xmath144 $ ] , whose shape plays a crucial role in the model . in  @xcite authors proposed that the random scalar @xmath145 $ ] is drawn from a beta distribution @xmath146 .",
    "the parameter @xmath147 determines the typical relative volume of market orders and the aggressiveness of liquidity takers .",
    "in fact , for @xmath148 , the distribution peaks around @xmath149 ; @xmath150 corresponds to a uniform distribution ; finally , the limit @xmath151 corresponds to unit volumes , because we fix a lower bound for market order volumes to @xmath152 .     for the parameter choice @xmath153 , @xmath154 , @xmath155 , @xmath156 and different values of @xmath157 .",
    "the resulting curves show a strong super - diffusive behaviour for large values of @xmath18 .",
    "when @xmath151 , the volatility converges to zero .",
    "( top right ) signature plot @xmath20 for the parameter choice @xmath153 , @xmath158 , @xmath156 , different values of @xmath142 and fixed asymptotic order book depth @xmath159 .",
    "the resulting curves show a strong super - diffusive behaviour for large values of @xmath18 , whereas for low values of @xmath142 the price process has sub - diffusive behaviour for an intermediate time scale region @xmath18 .",
    "( bottom ) conditional volumes at the best quotes on different values of the sign predictor , for parameters @xmath160 , @xmath161 ( left ) and @xmath162 , @xmath163 ( right ) .",
    "the result is compatible with real markets when the cancellation rate is high , whereas for low values of @xmath142 volumes at the best quotes behave in the opposite way . ]     for the parameter choice @xmath153 , @xmath154 , @xmath155 , @xmath156 and different values of @xmath157 .",
    "the resulting curves show a strong super - diffusive behaviour for large values of @xmath18 .",
    "when @xmath151 , the volatility converges to zero .",
    "( top right ) signature plot @xmath20 for the parameter choice @xmath153 , @xmath158 , @xmath156 , different values of @xmath142 and fixed asymptotic order book depth @xmath159 .",
    "the resulting curves show a strong super - diffusive behaviour for large values of @xmath18 , whereas for low values of @xmath142 the price process has sub - diffusive behaviour for an intermediate time scale region @xmath18 .",
    "( bottom ) conditional volumes at the best quotes on different values of the sign predictor , for parameters @xmath160 , @xmath161 ( left ) and @xmath162 , @xmath163 ( right ) .",
    "the result is compatible with real markets when the cancellation rate is high , whereas for low values of @xmath142 volumes at the best quotes behave in the opposite way . ]     for the parameter choice @xmath153 , @xmath154 , @xmath155 , @xmath156 and different values of @xmath157 .",
    "the resulting curves show a strong super - diffusive behaviour for large values of @xmath18 .",
    "when @xmath151 , the volatility converges to zero .",
    "( top right ) signature plot @xmath20 for the parameter choice @xmath153 , @xmath158 , @xmath156 , different values of @xmath142 and fixed asymptotic order book depth @xmath159 .",
    "the resulting curves show a strong super - diffusive behaviour for large values of @xmath18 , whereas for low values of @xmath142 the price process has sub - diffusive behaviour for an intermediate time scale region @xmath18 .",
    "( bottom ) conditional volumes at the best quotes on different values of the sign predictor , for parameters @xmath160 , @xmath161 ( left ) and @xmath162 , @xmath163 ( right ) .",
    "the result is compatible with real markets when the cancellation rate is high , whereas for low values of @xmath142 volumes at the best quotes behave in the opposite way . ]     for the parameter choice @xmath153 , @xmath154 , @xmath155 , @xmath156 and different values of @xmath157 .",
    "the resulting curves show a strong super - diffusive behaviour for large values of @xmath18 .",
    "when @xmath151 , the volatility converges to zero .",
    "( top right ) signature plot @xmath20 for the parameter choice @xmath153 , @xmath158 , @xmath156 , different values of @xmath142 and fixed asymptotic order book depth @xmath159 .",
    "the resulting curves show a strong super - diffusive behaviour for large values of @xmath18 , whereas for low values of @xmath142 the price process has sub - diffusive behaviour for an intermediate time scale region @xmath18 .",
    "( bottom ) conditional volumes at the best quotes on different values of the sign predictor , for parameters @xmath160 , @xmath161 ( left ) and @xmath162 , @xmath163 ( right ) .",
    "the result is compatible with real markets when the cancellation rate is high , whereas for low values of @xmath142 volumes at the best quotes behave in the opposite way . ]    in order to test price diffusivity , we investigate the `` signature plot '' of the model using equation  [ eqn : signplot ] .",
    "toth et al .",
    "@xcite have found numerically that there exists a critical value @xmath164 for which the resulting price process of the model is `` diffusive '' in the intermediate time scale region @xmath165 , where @xmath166 is the event time of the model .",
    "thus the lifetime of limit orders @xmath167 is a critical ingredient for the diffusivity of the price process . for times longer than this value",
    ", the long - range correlation of the order signs dominates and the lagged returns are positively correlated .",
    "an illustration of this fact is shown in the top panels of figure  [ fig : sim_bence ] .",
    "the left top panel shows the signature plot of the toth et al .",
    "@xcite model for different values of the parameter @xmath157 .",
    "from the figure , where we set @xmath168 , it is clear that prices are asymptotically super - diffusive .",
    "moreover when @xmath169 volatility goes to zero .",
    "this is due to the fact that in this limit , volume at the best is never eroded by market orders and price remains constant .",
    "the top right panel of figure  [ fig : sim_bence ] shows the signature plot of the model in  @xcite for different values of cancellation rates , but keeping fixed the asymptotic order book depth @xmath159 .",
    "the critical value of the cancellation rate is @xmath170 and we observe an approximately diffusive behaviour for lags @xmath18 between @xmath134 and @xmath171 ( we convert event time to trade times , like lags @xmath18 , by using the relation @xmath172 ) .",
    "as expected , after this value the price becomes highly super - diffusive . by increasing the cancellation rate , the intermediate region for which prices are diffusive shrinks to zero .    in conclusion , the toth et al .",
    "@xcite model reproduces diffusive prices in a range of lags which strongly depends on the cancellation rate . in order to extend the range of diffusivity one needs to decrease the cancellation rate to very low values .",
    "these values are unrealistically small if one wants to consider the model as describing the _ real _ order book .",
    "the authors in  @xcite used this model to describe the latent order book instead .",
    "this means that this is a hidden liquidity model , where the values of the rates of cancellation are explicitly chosen to be much smaller than the ones observed in the visible limit order book .",
    "we notice that low cancellation rates lead to wrong predictions of stylized facts of the order book . in the bottom panels of figure  [ fig : sim_bence ]",
    "we show the volume at the best bid and ask conditional to the value of the predictor @xmath173 . in all cases",
    "we have selected the value of @xmath157 that gives `` diffusive '' prices , according to the method in  @xcite .",
    "the left panel refers to the low cancellation rate regime , while the right panel refers to the high cancellation rate regime ( compare with the empirical results of figure  [ fig : volbest ] ) .",
    "we observe that in the low cancellation rate regime , the conditional volume at the best is opposite to the one observed in real data , _",
    "i.e. _ there is more volume at the ask ( bid ) when it is more likely that the next order is a buy ( sell ) . on the other hand , when the cancellation rate is high ( as in real markets ) the conditional volume at the best is in agreement with real data .",
    "thus if we want diffusive prices on a large range of lags we need low cancellation rates , but in this case the conditional properties of the order book have the wrong sign .",
    "if we want to reproduce the latter , we need high and realistic cancellation rates , but in this case the range of diffusivity will be very small .",
    "we therefore conclude that current statistical models of the order book are unable to reproduce the observed stylized facts when one considers a strongly persistent order flow and is interested in how order book quantities change as a function of order flow predictability as well as efficiency and diffusivity .",
    "even when one uses mechanisms for counterbalancing the persistence of order flow , such as by fine tuning the value of a parameter ( e.g. the penetration probability in the  @xcite model ) , diffusivity is reproduced up to the maximal time scale of the cancellation rate . by decreasing the cancellation rate one obtains a very low volatility and it is not able to reproduce other stylized facts , such as the volume imbalance at bid and ask as a function of order flow predictability .    in the following section we present a statistical order book model with long memory order flow where we are able to simultaneously obtain exact diffusivity of prices and the correct conditional properties of the order book as a function of the order flow predictability .",
    "the key intuition behind our modeling scheme is that order book and flow dynamics depend on the predictability of the order flow itself . in other words , instead of fine tuning the value of a parameter ( such as the @xmath157 in  @xcite model ) , we assume that this `` parameter '' adapts itself dynamically , depending on the predictability of order flow .",
    "this kind of adaptation guarantees diffusivity and the correct dependence of order book quantities on order flow predictability .",
    "the version of the model we present here aims at modeling how liquidity takers adapt their order flow , keeping the price diffusive and efficient . in this sense",
    "our model is close to the one in  @xcite , since the limit order and cancellation processes are totally random .",
    "the adaptation occurs inside the market order flow .",
    "however we believe that the idea of adaptation could be exported for modeling also the liquidity providers .",
    "the main intuition behind our modeling approach is that the mechanism restoring efficiency ( and therefore diffusivity ) must depend on the local level of predictability of the order flow . in the previous sections on the empirical analysis we have shown that many quantities of the order flow and of the limit order book depend in fact from the degree of predictability of the order flow , as well as from the fact that the next market order is in agreement or not with the predictor . in particular we have seen that the penetration probability , _",
    "i.e. _ the probability that the market order volume is larger or equal to the volume at the opposite best , strongly depends on @xmath89 ( see figures  [ fig : penetration_fraction ] and  [ fig : vol_mo_ob ] ) . when this quantity is large , _",
    "i.e. _ the predictability is high and order executed agrees with the predictor , the volume at the opposite best is small , but the penetration probability also declines , suggesting that liquidity takers adjust the volume of their market order to reduce market impact .",
    "this behaviour clearly counterbalances the persistence of order flow , making prices more diffusive and efficient .",
    "we now show that it is possible to _ exactly _ counterbalance the super - diffusivity of order flow and to give the correct conditional behaviour of limit order book quantity . before describing the mechanism",
    "a caveat is in order .",
    "we do not believe that this is the only mechanism responsible for efficiency and diffusivity .",
    "we believe that liquidity providers , through the so - called `` stimulated refill '' mechanism ( see  @xcite ) , are also responsible in part of the restoration of efficiency . however , we think that this mechanism should also be adaptive , depending on the local level of predictability of order flow .",
    "our model take as a starting point the model of  @xcite .",
    "we assume that the distribution of @xmath136 , the ratio between the volume of the market order and the volume at the opposite best , depends parametrically on @xmath89 .",
    "in particular , we assume that @xmath174 where @xmath175 is the exponent of the beta distribution , which in  @xcite model is the constant @xmath157 , and fine tuned to recover `` diffusivity '' . in our model",
    "this exponent depends on the predictability of market order flow and the degree of surprise of the market order ( _ i.e. _ if it agrees with the predictor ) .    in our model , when @xmath176 $ ] , where @xmath177 is a small parameter , the market order volume is equal to the volume at the opposite best and penetrates the book .",
    "thus the conditional probability of penetration is @xmath178    since @xmath179 , @xmath180 is a decreasing function of @xmath89 if @xmath181 is an increasing function of its argument .",
    "this framework reproduces the strategic behaviour of liquidity takers against liquidity providers which operates in a completely random setting .",
    "those who place market orders adjust locally the requirement of liquidity on the level of predictability of the order signs .",
    "this mechanism is captured by the model through the adaptive dependence of @xmath182 on the sign predictor value .",
    "a liquidity taker knows exactly the past history of the market order sign process and the sign of the next order ( buy or sell ) executed in the market , therefore the choice of the local dependence of @xmath183 appears to us reasonable .",
    "we can explain this strategic behaviour of the traders in this way : high predictability of the order flow means that liquidity takers reveal to the market information about their intentions , and in order to control the market impact of their trades , they reduce the volumes of the market orders progressively during the execution of the whole metaorder .    under some conditions",
    ", the penetration probability can be connected to the market impact .",
    "in fact , we have @xmath184&\\simeq&\\sum_{r_n \\neq 0}\\epsilon_n r_n p\\left(v_n = v_n^{ob},\\epsilon_n g_n^{ob } \\simeq 2r_n\\big|\\epsilon_n\\cdot\\hat{\\epsilon}_n\\right ) \\nonumber \\\\ & \\simeq&\\sum_{r_n \\neq 0}\\epsilon_n r_n p\\left(v_n = v_n^{ob}\\big|\\epsilon_n\\cdot\\hat{\\epsilon}_n\\right)p\\left(\\epsilon_n g_n^{ob } \\simeq 2r_n\\big|\\epsilon_n\\cdot\\hat{\\epsilon}_n , v_n = v_n^{ob}\\right ) \\nonumber \\\\ & \\simeq&\\frac{1}{2}p\\left(v_n = v_n^{ob}\\big|\\epsilon_n\\cdot\\hat{\\epsilon}_n\\right)\\mathbb{e}\\left[g_n^{ob}\\big|\\epsilon_n\\cdot\\hat{\\epsilon}_n , v_n = v_n^{ob}\\right]\\,.\\end{aligned}\\ ] ]    we consider a configuration of our model where the price gaps are constant and equal to @xmath138 ( this is the case of large - tick stocks , where each price level behind the best quotes is populated by limit orders ) , so that the previous equation reduces to @xmath128 \\simeq \\frac{w}{2}p\\left(v_n = v_n^{ob}\\big|\\epsilon_n\\cdot\\hat{\\epsilon}_n\\right ) = \\frac{w}{2}\\delta^{g(\\epsilon_n\\cdot\\hat{\\epsilon}_n)}\\ , .",
    "\\label{eqn : return_penetration}\\ ] ]    the expression in the left hand side of equation  [ eqn : return_penetration ] is exactly the probability of penetration of market orders , which is the probability that the volume of the market order is equal to the volume at the opposite best .",
    "it is possible to choose the function @xmath181 is such a way that @xmath185 _ i.e. _ the penetration probability is a linear function of @xmath89 .",
    "taking into account that the last expression is a probability , we fix the constants @xmath186 as @xmath187 & \\longrightarrow & \\alpha\\in[0,1/2]\\,,\\end{aligned}\\ ] ] and we obtain @xmath188    under the large - tick size hypothesis , equation  [ eqn : return_penetration ] implies that returns and impact are also linear functions . in fact ,",
    "we have @xmath128=a(1-\\epsilon_n\\cdot\\hat{\\epsilon}_n)\\,,\\ ] ] where @xmath189 .",
    "this model can be rewritten as @xmath190\\ , , \\label{eqn : efficient_model}\\ ] ] where @xmath127 is an idiosyncratic iid component of variance @xmath191 .",
    "the model is completely defined when we assign the model for the time series of order signs as well as the predictor and the information set used .",
    "we have thus found a reduced statistical model for price returns starting from a structural model of the order book . as shown in  @xcite , using as sign predictor an _",
    "ar(p ) _ model when @xmath192 , the statistical model of equation  [ eqn : efficient_model ] proposed in  @xcite is equivalent to the propagator model ( see  @xcite ) .",
    "we expand this result to the case of the _",
    "dar(p ) _ model , for which we remind the analytical expression of the sign predictor ( see equation  [ eqn : epshat ] ) @xmath193 where for simplicity we restrict the model to the case of @xmath194=0 $ ] . in the propagator model",
    "@xcite , prices are written as a superposition of past order signs , weighted by a propagator @xmath195 , and external shocks @xmath196,\\ ] ] which leads to the expression of the tick by tick returns of the model , @xmath197\\epsilon_{n - i}+\\eta_n\\,.\\ ] ]    if we impose the equivalence @xmath198\\,,\\ ] ] we find the relation between the coefficient of the statistical model of equation  [ eqn : efficient_model ] and the functional form of the propagator @xmath195 of the model of  @xcite .",
    "let us emphasize the statistical properties of returns of the model of equation  [ eqn : efficient_model ] .",
    "we clearly see that prices are efficient , since @xmath199=0\\,.\\ ] ]    this means that returns are uncorrelated , @xmath200=0 $ ] , for all @xmath201 . since @xmath200=\\mathbb{e}[\\mathbb{e}[r_n r_{n+\\ell}|\\omega_{n-1},\\mathcal{m}]]$ ] it is enough to prove that @xmath202=0 $ ] , which follows making use of the law of iterated expectations .",
    "furthermore , prices of the model are diffusive for all lags .",
    "let us consider the quantity @xmath203 and compute its variance , using the last result of uncorrelated returns of the model @xmath204=\\mathbb{e}\\left[\\left(\\sum_{i=0}^{\\ell-1 } r_{n+i}\\right)^2\\right]=\\sum_{i=0}^{\\ell-1 } \\mathbb{e}\\left[r_{n+i}^2\\right ] = ( \\sigma^2 + a^2)\\ell - a^2\\sum_{i=0}^{\\ell-1 } \\mathbb{e}\\left[\\hat{\\epsilon}_{n+i}^2\\right]\\,.\\ ] ]    the quantity @xmath205 $ ] depends only on the particular choice of the driving model of the order flow . in the case of the _",
    "dar(p ) _ model it is constant and independent from @xmath18 , @xmath206= \\left(\\chi^2\\sum_{i=1}^p\\phi_i^2 + 2\\chi^2\\sum_{r > s\\geqslant 1}^p\\phi_r \\phi_s \\rho(r - s)\\right)\\ell\\,,\\ ] ] where @xmath207 $ ] is the empirical autocorrelation of order signs .",
    "the unconditional variance finally reads @xmath208=\\left[\\sigma^2 + a^2\\left(1-\\chi^2\\sum_{i=1}^p\\phi_i^2 - 2\\chi^2\\sum_{r > s\\geqslant 1}^p\\phi_r \\phi_s \\rho(r - s)\\right)\\right]\\ell\\,,\\ ] ] which scales perfectly as a diffusive process with the lag @xmath18 .",
    "since in our model the market order flow plays a crucial role , in this section we present the specific model for the time series describing it .",
    "moreover we shall discuss the different predictors that can be built for this time series . in the final subsection we shall present in detail numerical simulations of the model .",
    "order flow is strongly autocorrelated in time . as shown in  @xcite , correlation of order flow",
    "is mostly due to order splitting , rather than herding .",
    "this was originally suggested by lillo , mike , and farmer  @xcite on the basis of indirect empirical evidences . in this paper , authors proposed a simple model where the correlation of order flow is a consequence of order splitting and the very heterogeneous distribution of metaorder sizes .",
    "here we use a variation of this model to generate the market order flow which enters the limit order book .    according to the model of  @xcite",
    ", there are @xmath209 funds that want to trade one metaorder each of a size @xmath210 ( @xmath211 ) taken from a distribution @xmath212 , where for simplicity @xmath213 .",
    "the sign of the each metaorder is taken randomly and at each trade time step , one fund is picked randomly with uniform probability .",
    "the selected fund initiates a trade of the sign of its metaorder , and the size of the metaorder is reduced by one unit .",
    "when a metaorder is completely traded , a new one is drawn from @xmath212 and assigned a random sign .    in @xcite",
    "it is shown how to connect the distribution @xmath212 of metaorder size with the autocorrelation function of trade signs .",
    "in particular if the distribution is pareto @xmath214 where @xmath215 is the riemann zeta function , then the autocorrelation function of trade signs decays asymptotically as @xmath216\\sim \\frac{m^{\\beta-2}}{\\ell^{\\beta-1 } } \\sim \\frac{1}{\\ell^\\gamma}\\ ] ]    this model connects the exponent of the autocorrelation function of order signs with the tail exponent of metaorder distribution , since @xmath217 .",
    "the market order sign is a long memory process if @xmath218 , _",
    "i.e. _ if the variance of the metaorder size diverges .",
    "there is a growing empirical evidence that the distribution of metaorder size is asymptotically pareto distributed with a tail exponent close to @xmath219 .",
    "ref.s  @xcite and  @xcite argue that block trades ( _ i.e. _ traded off book ) could be used as a proxy of metaorders and find that an exponent very close to @xmath220 describes the tail of the trade size distribution .",
    "@xcite use trade data of the spanish stock exchange with an identifier of the broker to statistically reconstruct the metaorders .",
    "they find that the size of the metaorder is asymptotically pareto distributed with an exponent @xmath221 .",
    "finally ,  @xcite use proprietary data of a set of large institutional metaorders executed at alliancebernstein s buy - side trading desk in the us equity market and find that the tail of metaorder size is pareto with exponent @xmath222 .    in this paper in order to have an analytically tractable expression of the predictor of the order flow , we shall consider a slight modification of the above model .",
    "first of all we will consider that only one metaorder is present at each time .",
    "this is similar to what is done in  @xcite .",
    "the second modification is that we will assume that other traders are present and that they contribute with a random background of signs .",
    "this can be considered as a large set of metarorders of size @xmath134 .",
    "more specifically , we introduce the participation ratio @xmath223 of the metaorder , which is the probability that a trade is initiated by the metaorder ( of size larger than one ) , while @xmath224 is the probability that the trade is initiated by the noise traders .",
    "the introduction of the noise traders does not change the long memory properties of the autocorrelation of the order flow .",
    "their only effect is to reduce the global level of the autocorrelation . more specifically ,",
    "if @xmath225 is the autocorrelation function of the order flow when one considers only the trades of the metaorder ( _ i.e. _ equation  [ eqn : acflmf ] with @xmath226 ) , one has in presence of noise @xmath227\\simeq\\pi^2 \\rho_s ( \\pi \\ell)\\,,\\ ] ] because the probability that the two trades at time @xmath17 and @xmath228 both come from a metaorder ( not necessarily the same ) is @xmath229 and a time lag of @xmath18 trades corresponds on average to a time lag of @xmath230 trades from the metaorder .",
    "if the metaorder size distribution is pareto ( see equation  [ eqn : pareto ] and  [ eqn : acflmf ] ) , we have @xmath231 _ i.e. _ the autocorrelation function is dampened by a factor @xmath232 , but it is still long memory with the same hurst exponent .      in our model market order volume",
    "depends on the predictability of market order flow .",
    "given the time series model described above , we will consider two predictors of the order flow .",
    "the first predictor is the one associated with the _",
    "dar(p ) _ model discussed in the empirical section and reviewed in the appendix .",
    "the @xmath35 signs of past market orders are used to build the expected value of the next sign .",
    "clearly this predictor does not have any direct information on how many metaorders were present in the estimation window , thus we call it the `` public '' sign predictor .",
    "given the fact that our order flow model is composed by one metaorder at a time ( plus the noise background ) , it is likely that the estimation window of @xmath35 past signs includes orders that are coming from past ( _ i.e. _ not anymore active ) metaorders .",
    "this adds of course noise and decreases the forecasting ability of the predictor . on the opposite side , if the metaorder is longer than @xmath233 , from a certain point on , the predictor is using information of the most recent part of the metaorder and it is discarding information of the first part of the metaorder . as we will see below",
    ", this will have an effect on the diffusivity of price at time scales longer than @xmath35 trades .",
    "the second predictor is the one which makes use of the information allowing to discriminate the orders due to the active metaorder to those due to the noisy background .",
    "this information is not typically of public domain and therefore can not be used by the liquidity providers , therefore we call it the `` private '' sign predictor . in our model",
    "the liquidity taker adjusts the volume of their market orders to the degree of predictability of the order flow .",
    "given their active role , they are able to use a predictor that takes into account the history of the recent order flow and the information on the current length of the metaorder .",
    "the key point is that the correlation of the order flow comes from the presence of the metaorder . if @xmath234 trades of the current metaorder has been already traded , the probability that the metaorder continues is  @xcite @xmath235 for example , if the metaorder size distribution is pareto ( see equation  [ eqn : pareto ] ) this continuation probability is @xmath236 where @xmath237 is the generalized riemann zeta function ( also called the hurwitz zeta function )",
    ". the approximations are valid in the large @xmath234 limit .",
    "this means that the longer the metaorder has been active ,",
    "the more likely is that it continues .",
    "let us suppose that the active metaorder is a buy and the participation rate is @xmath223 .",
    "the probability that the next order is a buy is @xmath238 the first term describes the event in which the next order is from a noise trader , which with probability @xmath239 will place a buy .",
    "the second term describes the event in which the next order comes from a metaorder .",
    "moreover , the first term in parenthesis gives the probability that the active metaorder is not finished ( and one trade from it will be surely a buy ) , while the second term in brackets describes the possibility that the active metaorder is finished and that the order comes from a new metaorder , which with @xmath239 probability is a buy . similarly if the active metaorder is a sell , rather than a buy , then @xmath240 . if we indicate with @xmath241 the sign of the active metaorder at time @xmath17 , we can rewrite @xmath242    in general , since the sign predictor @xmath243 and obviously @xmath244 , we have @xmath245 or , in other words , it is @xmath246=2p^+_n-1\\,.\\ ] ] where lmf refers to the model developed by lillo , mike , and farmer in  @xcite and described above .",
    "this means that the predictor which allows to discriminate the trades from the metaorder is @xmath247     and @xmath248 , and for the parameter choice @xmath153 , @xmath154 , @xmath155 , @xmath156 , @xmath249 .",
    "the vertical line is the lifetime of limit orders @xmath250 . ]",
    "numerical simulations of the model confirm the theoretical prediction explained above .",
    "we have measured the signature plot ( see equation  [ eqn : signplot ] ) of the price process as result of the interaction of market orders , limit orders , and cancellation of the model .",
    "we have used the `` private '' sign predictor of equation  [ eqn : exact_pred ] .",
    "figure  [ fig : vol_pareto ] shows the signature plot of the model . as one can observe , the volatility as a function of the lag @xmath18 is almost constant , @xmath19 , and it is compatible with a diffusive process . the vertical line is the lifetime of limit orders @xmath251 , which is in the model of ref .",
    "@xcite the maximum time scale for which prices are still diffusive . furthermore , by construction the resulting prices of the model are informationally efficient .",
    "this characteristic does not depend on the particular choice of the participation @xmath223 and of the parameter @xmath248 .",
    "in fact we observe that , as expected from the theoretical analysis , volatility does not depend on @xmath248 for a fixed value of @xmath223 . on the other hand , volatility is lower for higher values of @xmath223 , which is not surprising because high levels of participation rate lead to lower uncertainty in the order flow and lower volatility .",
    "we have repeated the same simulations by using the sign predictor of the _",
    "dar(p ) _ process , which uses only the signs of past order flow , and no information on metaorders . figure  [ fig : vol_dar ] shows the signature plot of the resulting price process in such a setting .",
    "the time scale for which the price process is diffusive depends on the chosen order @xmath35 of the _",
    "dar(p ) _ process , and @xmath20 is constant for @xmath252 .",
    "this is not surprising because if one considers a time window of length @xmath253 , there might exist non vanishing positive correlations of order signs due to metaorders longer than @xmath233 , but the predictor considers only the past @xmath35 trades . by taking longer windows for the _",
    "dar(p ) _ predictor ( or by considering models with shorter metorders ) one recovers diffusivity at all scales .",
    "an interesting result of the simulations is that the volatility using the two different sign predictor has approximately the same value , _",
    "i.e. _ it is almost independent from the choice of the particular set of information used for the sign predictor .     of the _",
    "process used for the computation of the sign predictor , using @xmath153 , @xmath154 , @xmath155 , @xmath156 , @xmath254 , @xmath255 , @xmath249 .",
    "the vertical line is the lifetime of limit orders @xmath250 . ]     of the model .",
    "the parameters of the model were @xmath153 , @xmath154 , @xmath155 , @xmath156 , @xmath254 , @xmath255 , @xmath249 . ]     of the model .",
    "the parameters of the model were @xmath153 , @xmath154 , @xmath155 , @xmath156 , @xmath254 , @xmath255 , @xmath249 .",
    "]     of the model .",
    "the parameters of the model were @xmath153 , @xmath154 , @xmath155 , @xmath156 , @xmath254 , @xmath255 , @xmath249 . ]     of the model .",
    "the parameters of the model were @xmath153 , @xmath154 , @xmath155 , @xmath156 , @xmath254 , @xmath255 , @xmath249 . ]",
    "we therefore conclude that our model is able to give exactly diffusive prices .",
    "our model is also able to reproduce the empirically observed dependencies of order book quantities from the predictability of the order flow .",
    "specifically , we have measured the same order book quantities of section  [ sec : empirical ] in our synthetic market , using in @xmath183 the `` private '' sign predictor .",
    "however , the conditional expected values of volume at best quotes , price gaps , probability of penetration , fraction , and returns are computed conditioning them on the sign predictor of the _",
    "dar(p ) _ process . in this way",
    ", we can compare the results from our model with the evidences from real markets .",
    "the results are shown in figure  [ fig : sim ] .",
    "the model reproduces quite well the behaviour of real order books .",
    "in particular , volume at the bid is higher ( smaller ) than the volume at the ask when the most likely next market order is a buy ( sell ) , as observed in figure  [ fig : volbest ] .",
    "gaps are constant because we are working in the large tick approximation , where all the level of the order book are occupied ( see the right panels of figure  [ fig : gap ] )",
    ". the penetration probability and the average fraction @xmath136 both decline with @xmath89 , as seen in figure  [ fig : penetration_fraction ] .",
    "finally , the impact @xmath9 declines with @xmath89 , as postulated by the asymmetric liquidity mechanism , and as observed in real data in the region where the mass of the distribution of sign predictors is concentrated ( see figure  [ fig : return ] ) .",
    "let us comment the property of efficiency of our model .",
    "the synthetic market simulated by the model is more efficient than the real ones .",
    "in fact , the signature plot is almost constant for every time scale @xmath18 and conditional returns are linear in @xmath89 like the efficient model in equation  [ eqn : efficient_model ] . in modern markets linearity",
    "is recovered after few trades ( see figures  [ fig : lagged_penetration_return1 ] and  [ fig : lagged_penetration_return2 ] ) .",
    "we are confident that introducing some inefficiency in the model , it can reproduce some effects measured during our empirical analysis of real stocks .",
    "in this paper we have considered the subtle issue of reconciling the persistence of order flow with price efficiency and return diffusivity . since on average a buyer initiated trade pushes the price up while a seller initiated trade pushes it down , in a naive view the strong positive correlation between trades measured empirically would lead to strongly correlated returns .",
    "however , the empirical evidence of price efficiency clashes with this view .",
    "we have investigated the microstructural mechanisms able to reconcile both evidences . in the first part of our analysis",
    "we have performed an empirical study of the behaviour of four stocks , astrazeneca , vodafone , apple , and microsoft , which have been selected in light of their different features .",
    "while the order book data for the former two stocks were recorded at the london stock exchange in 2004 , for the latter two stocks the data sample is relatively more recent and was recorded at nasdaq in july / august 2009 . moreover , while vodafone and microsoft are stocks whose tick - to - price ratio is on average large , for astrazeneca and apple the ratio is very small .",
    "our choice should guarantee independence of our results on the specificity of the stocks and of the market place .",
    "nonetheless , we have planned a future extension of our analysis to a wider data sample .    a possible mechanism able to reconcile the persistence of trade signs and price efficiency is the asymmetric liquidity mechanism proposed by  @xcite : the price impact of an order is inversely related to the probability of its occurrence .",
    "this means that if at a certain point in time it is more likely that the next trade is a buy rather than a sell , a buyer initiated trade will have a smaller impact than a seller initiated trade .",
    "there is therefore a compensation between the probability of an event and its effect on the price . in spite of its conceptual simplicity",
    "there are many possible microstructural mechanisms responsible for it . among the several explanations of the drop of the impact one could consider the case where efficiency is guaranteed by the agents initiating the trade and adjusting the volume of their trades to the volume outstanding on the opposite side of the order book .",
    "a second explanation would focus on the leading role of liquidity providers revising their quotes after a trade in order to compensate for the impact due to liquidity takers .",
    "our empirical analysis evidences that when the order flow predictability increases in one direction ( buy or sell ) the volume outstanding at the opposite best decreases , the opposite side of the book becomes more and more sparse , but the probability that a trade moves the price decreases significantly . while the last mechanism is able to counterbalance the persistence of order flow and restore efficiency and diffusivity , the first two act in the opposite direction",
    "moreover , disentangling each return in a component due to a mechanical impact and in a second aggregated component due to the revision of liquidity providers , we have measured a positive correlation between impact and quote revision .",
    "however , this effect tends to disappear when the order sign predictability increases .",
    "the above empirical evidences lead to significant challenges in the modeling of the order book dynamics .",
    "a growing strand of literature is dealing with this issue , and in the second part of our paper we have introduced a statistical model designed for large tick stocks which is able to successfully recover the empirical findings in the presence of a strongly persistent order flow .",
    "the main intuition behind our approach is that the mechanism restoring efficiency must depend on the local level of predictability of the order flow .",
    "more precisely , the agent placing a market order knows exactly the past history of the market order sign process and the sign of the next order ( buy or sell ) she is going to execute and adapts her order volume to the level of predictability of the order sign .",
    "we explain this strategic behaviour in this way : high predictability of the order flow means that liquidity takers reveal to the market information about their intentions , and in order to control the market impact of their trades , they reduce the volumes of the market orders progressively during the execution of the whole metaorder .",
    "we have supported our conclusions with extensive monte carlo simulations .",
    "the adaptive liquidity taking mechanism described above is , however , only part of the story . in spite of its effectiveness ,",
    "it is indeed evident that a determinant role has to be also played by liquidity providers .",
    "while in the current paper we have focused on modeling the strategic behaviour of liquidity takers , we are currently working on the extension of the statistical model in order to include the strategic behaviour of market makers .",
    "the authors acknowledge partial support by the grant , sns13lillb `` systemic risk in financial markets across time scales '' .",
    "we also thank jean - philippe bouchaud , iacopo mastromatteo , and bence toth for inspiring discussions .",
    "the _ dar(p ) _ model defines a general class of simple models for discrete variate time series . it generates a sequence of stationary discrete random variables with the properties of a @xmath35-th order markov process . these properties",
    "are reflected by the fact that the distribution of @xmath256 only depends on @xmath257 .",
    "the process is specified by the stationary marginal distribution of @xmath256 and by the correlation structure of the sequence .    _ definition . _ the @xmath35-th order discrete autoregressive model _",
    "dar(p ) _ is given by @xmath258    the sequence @xmath259 is composed by iid random values drawn by a marginal distribution @xmath260 , whose sample space is a subset of the integers @xmath261 , where @xmath139 is the cardinality of the sample space .",
    "furthermore , @xmath262 is a sequence of iid random values following a bernoulli distribution @xmath263 .",
    "therefore we have @xmath264    finally , @xmath265 is a sequence of iid random values drawn from a multinomial distribution @xmath266 , with states @xmath267 and probabilities @xmath268 where the parameter vector @xmath269 is normalised to unity , @xmath270 .",
    "let us explain in a less formal way the _",
    "dar(p ) _ process of equation  [ eqn : darp ] : the value @xmath256 is either taken from the history of @xmath271 ( with probability @xmath272 ) or drawn randomly from the @xmath260 distribution ( with probability @xmath273 ) . the random values @xmath274 have the function of a switch between the two cases . in the case of a positive bernoulli trial ( @xmath275 ) , @xmath256",
    "is determined by moving @xmath22 steps back in the past observations of @xmath271 , with @xmath22 assuming values in @xmath267 with probability given by the parameter vector @xmath269 . therefore , with probability @xmath276 , @xmath277 , for @xmath278 . in the second case , when @xmath279 , @xmath280 is drawn randomly from the specific marginal distribution @xmath260 , which has a discrete state space .",
    "it is possible to select an initial distribution of @xmath281 which yields a stationary sequence @xmath282 with marginal distribution @xmath260 , and it is possible to prove that this initial distribution coincides with the marginal distribution @xmath260 .",
    "this procedure differs essentially from the representation of a markov process as a matrix of transition probabilities , where the number of parameters to estimate is @xmath283 . here",
    "a smaller number @xmath284 of effective parameters allows a better control of the statistical properties of the sequence , while in the case of a transition probability matrix one has many independent parameters , each of which regulates only a minor aspect of the process .",
    "_ autocovariance structure .",
    "_ let @xmath282 be a stationary _ dar(p ) _ process with marginal distribution @xmath260 , parameter @xmath272 and parameter vector @xmath269 . from equation",
    "[ eqn : darp ] , we immediately find that @xmath285=\\mathbb{e}[z_n]=\\mu_z$ ] .",
    "we center the @xmath256 s with the unconditional mean , @xmath286 , multiply equation  [ eqn : darp ] by @xmath287 , @xmath288 and we take the expectation of both sides @xmath289=\\chi\\sum_{i=1}^p \\phi_i \\mathbb{e}[\\widetilde{x}_{n - i}\\widetilde{x}_{n - k}]+(1-\\chi)\\mathbb{e}[(z_n-\\mu_x)\\widetilde{x}_{n - k}]\\,.\\ ] ]    dividing both sides by the variance of @xmath290 , we obtain the corresponding relation for the autocorrelations @xmath291 which are the usual yule - walker equations  @xcite . this linear system can be solved recursively after the computation of the sample autocorrelations from the time series .",
    "given @xmath292 , the first @xmath35 equations can be solved for the @xmath35 parameters @xmath293 and @xmath272 . the parameter @xmath294 is given by @xmath295 .",
    "the estimations of the components of the parameter vector @xmath296 can lead to negative values , but probabilities must be always greater than or equal to zero , @xmath297 .",
    "this problem is important when we perform simulations of the process , in this case we smooth the empirical coefficients performing a moving average which spans ten points and finally we set the negative elements to zero .",
    "the advantages of the _",
    "dar(p ) _ model is that it is intrinsically autoregressive , and its parameters can be easily computed by means of the sample autocorrelation .",
    "_ forecasting .",
    "_ we can now construct the best predictor of variable @xmath256 within this model .",
    "we recall the fact that all sequences @xmath262 , @xmath265 and @xmath259 are independent one from each other .",
    "we take the expected values both unconditional and conditional on @xmath7 and we calculate the second conditional moment , @xmath298&=&\\mu_z\\ , , \\nonumber \\\\ \\mathbb{e}[x_n|\\omega_{n-1}]&=&\\chi \\sum_{i=1}^p \\phi_i x_{n - i } + \\mu_z(1-\\chi)\\equiv\\hat{x}^{dar}_n , \\nonumber \\\\ \\mathbb{e}[x^2_n|\\omega_{n-1}]&=&\\chi",
    "\\mathbb{e}[x^2_{n - a_n}|\\omega_{n-1}]+\\mu_z(1-\\chi ) \\nonumber \\\\ & = & \\chi \\sum_{i=1}^p\\phi_i \\mathbb{e}[x^2_{n - i}|\\omega_{n-1}]+\\mu_z(1-\\chi ) \\nonumber \\\\ & = & \\chi \\sum_{i=1}^p\\phi_i x^2_{n - i}+\\mu_z(1-\\chi)\\ , .",
    "\\label{eqn : preddar}\\end{aligned}\\ ] ]    the expression of the predictor can be extended by computing the conditional expected value of @xmath299 , for @xmath300 .",
    "after simple calculations , we find that @xmath301 where @xmath302",
    "99 bacry e and muzy j f _ hawkes model for price and trades high - frequency dynamics _ 2013 _ preprint _ arxiv:1301.1135 .",
    "daniels m g , farmer j d , gillemot l , iori g and smith e _ quantitative model of price diffusion and market friction based on trading as a mechanistic random process _",
    "2003 _ physical review letters _ * 90 * 10 1081024 .",
    "farmer j d , patelli p and zovko i i _ the predictive power of zero intelligence in financial markets _ 2005 _ proceedings of the national academy of sciences of the united states of america _ * 102 * 6 225459 .",
    "farmer j d , gerig s , lillo f and mike s _ market efficiency and the long - memory of supply and demand : is price impact variable and permanent or fixed and temporary ?",
    "_ 2006 _ quantitative finance _ * 6 * 2 10712 .",
    "toth b , lemperiere y , deremble c , de lataillade j , kockelkoren j and bouchaud j - p _ anomalous price impact and the critical nature of liquidity in financial markets _ 2011a _ physical review x _ * 1 * 2 021006 ."
  ],
  "abstract_text": [
    "<S> in financial markets , the order flow , defined as the process assuming value one for buy market orders and minus one for sell market orders , displays a very slowly decaying autocorrelation function . since orders impact prices , reconciling </S>",
    "<S> the persistence of the order flow with market efficiency is a subtle issue . </S>",
    "<S> a possible solution is provided by asymmetric liquidity , which states that the impact of a buy or sell order is inversely related to the probability of its occurrence . </S>",
    "<S> we empirically find that when the order flow predictability increases in one direction , the liquidity in the opposite side decreases , but the probability that a trade moves the price decreases significantly . while the last mechanism is able to counterbalance the persistence of order flow and restore efficiency and diffusivity , the first acts in opposite direction . </S>",
    "<S> we introduce a statistical order book model where the persistence of the order flow is mitigated by adjusting the market order volume to the predictability of the order flow . </S>",
    "<S> the model reproduces the diffusive behaviour of prices at all time scales without fine - tuning the values of parameters , as well as the behaviour of most order book quantities as a function of the local predictability of order flow .    </S>",
    "<S> _ keywords _ : models of financial markets , financial instruments and regulation , risk measure and management </S>"
  ]
}