{
  "article_text": [
    "hierarchical structure formation is a messy process .",
    "the assembly of virialized objects in cold dark matter ( cdm ) cosmologies involves countless merger and accretion events that can convulse the interiors of growing halos .",
    "n - body simulations have shown that halos can have tumultuous lives , in which they are bombarded on all sides by infalling clumps of material .    out of this seeming chaos ,",
    "however , emerges remarkable regularity .",
    "simulated dark matter halos have fairly generic radial profiles , with density scaling as @xmath0 at large radii , becoming more shallow at smaller radii , approaching @xmath1 near the resolution limit of the simulations .",
    "* ; * ? ? ?",
    "* hereafter nfw ) suggested that this behavior is universal among cdm halos .",
    "subsequent numerical work found qualitatively similar results , producing halos whose density rises steeply down to the resolution limits of the simulations ( e.g. * ? ? ? * ; * ? ? ? * ; * ? ? ? * ; * ? ? ? * ; * ? ? ? * ; * ? ? ? * ) .",
    "the vast majority of halos show this behavior ; the exceptions largely appear to correspond to ` bridged ' halos artificially linked together , or halos that have undergone recent major mergers and not yet had time to virialize @xcite .",
    "the origin of this near - universality of halo structure has been a longstanding puzzle that has attracted considerable theoretical attention .",
    "many different types of arguments and mechanisms have been advanced to account for halos nfw - like behavior .",
    "for example , @xcite suggested that the shape of the halo profile may be related to the shape of the matter power spectrum .",
    "other groups have argued that tidal disruption of substructure in halos could dynamically drive the inner profile towards @xmath2 @xcite .",
    "while such mechanisms could affect halo profile shapes , however , these mechanisms are not apparently _ required _ to produce nfw - like profiles . in particular , calculations of monolithic collapse of halos",
    "has shown that the resulting halos generically have nfw - like profiles @xcite .",
    "more recently , @xcite used simulations of hot dark matter cosmologies to show that halos forming at the cutoff scale of the power spectrum have radial profiles that are fit by the nfw form just as well as cdm halos are at comparable resolution .",
    "these halos have no subhalos in them , and the power spectrum shape on the relevant scales is completely different than cdm power spectra , and yet the same generic halo profile results .",
    "because such a broad class of initial perturbations produce collapsed halos with nfw - like profiles , it is useful to study particularly simple classes of collapsing halos to help identify the important mechanisms . towards this end , in a companion paper ( * ? ? ?",
    "* hereafter paper i ) we studied the collapse of initially scale - free density profiles .",
    "this problem admits a similarity solution , which allows us to achieve considerably higher resolution than is possible using conventional n - body techniques .",
    "we showed in paper i that nfw - like profiles are not a generic outcome of cold , dissipationless gravitational collapse in three dimensions .",
    "instead , self - similar collapse produces halos with central cusps whose shapes depend on the slopes of the initial peaks of the linear density .",
    "we identified adiabatic contraction as a crucial mechanism in setting the overall shape of the halo , and showed that the conserved adiabatic invariants governing the contraction of mass shells are set during the initial , quasi - linear regime preceding collapse into the halo . using this result",
    ", we were able to write down a simple toy model to predict the final collapsed profiles of halos as a function of the initial peaks . in this paper , we will attempt to generalize and apply these results to the formation of halos in the context of hierarchical structure formation .    this paper is structured as follows . in ",
    "[ sec : collapse ] , we briefly review the results of our study of self - similar collapse from paper i , and discuss how these results may be generalized to peaks that are not scale - invariant . in  [ sec : vl ] , we compare our model predictions with the high - resolution n - body simulation via lactea - ii . we show that our model agrees well with the simulation s results , however we find evidence that dynamical friction significantly modifies the structure of the collapsed halo . in  [ sec : stats ] we present a simple model for how to account for the effect of dynamical friction on the statistics of the hierarchy of peaks within peaks of gaussian random fields , again finding excellent agreement with the via lactea - ii simulation .",
    "we show how our model may be used to predict the distribution of halo properties like concentration in  [ sec : conc ] , and conclude in  [ sec : conclude ] .",
    "many aspects of halo formation may be understood from fairly general considerations of gravitational collapse , as we will show .",
    "we start by reviewing spherical collapse of peaks .",
    "it will prove useful throughout the discussion in this section to imagine decomposing the initial volume around the peak into lagrangian shells , indexed by their lagrangian radius @xmath3 , and to build up the collapsed halo profile by summing over lagrangian shells .",
    "our discussion and notation here intentionally parallels that in paper i , however in this paper we will use conventional mass and distance coordinates , rather than the self - similar units of paper i. besides paper i , there have been many previous papers employing a similar approach towards understanding halo formation ; see e.g.   @xcite for examples .",
    "consider a spherically symmetric peak of the initial linear density field @xmath4 .",
    "here , @xmath5 refers to the average interior mass overdensity @xmath6 , not the local overdensity @xmath7 , and @xmath3 is lagrangian radius .",
    "the spherical collapse model @xcite shows that turnaround occurs at the scale where the linear mass overdensity becomes of order unity , that is @xmath8 .",
    "the linear density grows like the linear growth factor , @xmath9 at early times , so we can easily determine the time at which different scales turn around and collapse , given the linear density profile .",
    "for example , if the linear density has some local slope @xmath10 , such that locally @xmath11 , then the expansion factor @xmath12 when a given scale @xmath3 collapses behaves as @xmath13 . therefore the turnaround radius in proper ( not comoving ) coordinates behaves as @xmath14 . from the dependence of the turnaround radius with initial lagrangian radius",
    ", we can infer the halo profile under various assumptions .",
    "first , for simplicity , let us assume ( briefly ) that subsequent to turnaround , matter shells remain fixed at some constant fraction of the turnaround radius .",
    "we refer to this as the `` frozen '' model , since instead of allowing mass elements to orbit , we freeze them at their turnaround radii .",
    "this is essentially identical to the `` circular orbit '' model of @xcite , who froze mass shells at one - half the turnaround radius .",
    "the point of this exercise is to isolate the effect that the initial peak profile has on the distribution of orbital apoapses , before shell crossing occurs .",
    "this is important in setting the outer profile , though at smaller radii the orbital motions of particles lead to significant changes in the mass distribution .    making this ` frozen ' assumption",
    ", we can easily determine the density profile using @xmath15 .",
    "for example , if the linear density is a power - law with slope @xmath10 , then as noted above @xmath16 , and the density becomes @xmath17 , where @xmath18 is the fillmore - goldreich slope described in paper i. figure [ fig : frozen ] illustrates this behavior . in regimes where the slope of the linear density is very shallow , @xmath19 ,",
    "then the frozen model predicts that the final collapsed profile is also shallow , @xmath20 .",
    "in contrast , when the initial slope is quite steep , @xmath21 , then the final slope also becomes steep , @xmath22 ( actually slightly steeper when @xmath5 is not an exact power law , i.e.  when @xmath23 is nonzero ) .    .",
    "the flat region in the linear profile leads to the flat region in the halo profile , while the steep region in the linear profile produces the roughly @xmath24 slope in the outer halo .",
    "the green curve shows the profile if each shell lays down interior profiles with minimal tails , without any resulting adiabatic contraction . the density is larger than the frozen model prediction , but still rolls over in slope quickly .",
    "the blue curve shows the prediction of the minimal contraction model .",
    "once any contraction is taken into account , the roll - over in slope from steep to shallow becomes considerably more gradual with radius than the frozen model . for comparison ,",
    "the black dashed curve shows the nfw profile , normalized to match the minimal contraction model at @xmath25 , the radius where the logarithmic slope @xmath26 . at small radius ,",
    "the slope of the minimally contracted profile rolls over more quickly than the nfw slope .",
    "note that for all the 1-d models , the actual outer slope is slightly steeper than -3 , since the total mass of the halo is finite .",
    "[ fig : frozen ] , scaledwidth=40.0% ]    this already explains some of the behavior found in halos in cosmological n - body simulations , which tend to have steep @xmath27 outer profiles .",
    "as can be seen from the simple argument above , this is a natural outcome whenever the initial linear density peaks acquire steep outer slopes ( e.g. when the linear overdensity falls below zero , a common occurrence among peaks of random fields ) . put in more physical terms , steep @xmath24 profiles naturally occur whenever the growth of halos slows or stops . indeed ,",
    "once the halo stops growing , then as time progresses the @xmath24 region simply extends .",
    "essentially the same argument has previously been used to explain the correlations between halo concentration and formation time , which underlies the mass - concentration relation at low mass @xcite .",
    "we discuss this point in more detail in ",
    "[ sec : conc ] .",
    "the frozen model described above assumes that each lagrangian shell lays down a thin annulus of material in the collapsed halo , with no shell crossing .",
    "this aspect is unrealistic , of course  following collapse , material entering the halo will execute orbits that cover a finite range of radii , and therefore the density profile laid down by that material is not a thin annulus , @xmath28 , but instead has tails extending to small radii .",
    "this affects the overall halo profile in multiple ways .",
    "first , the slope of the interior profile will obviously be steeper than the fillmore - goldreich slope if the tails from individual shells are steep enough . secondly ,",
    "because of shell crossing , the mass interior to a lagrangian shell grows following collapse , which causes contraction and hence steepening of the overall profile .",
    "a full description of these effects requires numerical calculation ( see paper i ) , however we can understand some of the basic behavior using simple qualitative arguments .",
    "we can generally expect the density profile @xmath29 laid down by some shell with total mass @xmath30 to take the form @xmath31 each term in this expression is easy to understand .",
    "first , we expect the density at each scale to behave like mass divided by volume , i.e.  @xmath32 .",
    "the middle term corresponds to the fraction of the orbital time that a particle spends inside radius @xmath33 , assuming it reaches radius @xmath33 .",
    "lastly , the third piece is simply the probability that the particle is on an orbit whose periapse is inside radius @xmath33 ; particles obviously deposit no mass at radii @xmath34 inside of their periapses .",
    "next , the time spent at radius @xmath33 scales as @xmath35 , where @xmath36 is the velocity .",
    "now , as long as the circular velocity profile is either flat or declining towards small radius ( i.e. the total density is @xmath37 or shallower ) , then the velocity of a particle at radii smaller than apoapse will be approximately constant , so that @xmath38 .",
    "therefore , to a reasonable approximation , the density laid down by a particle behaves as @xmath39 for @xmath40 .",
    "there are small corrections to this near periapse and apoapse , but these corrections are unimportant when we sum over all particles .",
    "accordingly , the density from a shell behaves like @xmath41 , i.e. the density profile depends upon the distribution of periapses .",
    "for example , in spherical collapse where all motion is perfectly radial , all particles pass through the origin , meaning that @xmath42 for all finite @xmath33 . then we expect the interior profile from each shell to behave as @xmath43 , and as long as the fillmore - goldreich slope is shallower than this ( i.e.  @xmath44 ) , then the interior profile will be @xmath43 .",
    "this is indeed the behavior found in the full solutions to spherical collapse @xcite , as described in paper i.    more generally , however , the orbits of particles in the collapsed halo are not perfectly radial , meaning that the interior profile is asymptotically shallower than @xmath43 .",
    "we can not quantitatively determine the periapse distribution without characterizing the full orbital structure , which requires numerical calculation",
    ". however we can make useful qualitative arguments .",
    "assuming that the density profile is shallower than @xmath43 , then particles at small radius @xmath45 have velocities much greater than the local circular velocity .",
    "we can therefore treat their motion as unaccelerated , i.e.  straight lines .",
    "the distribution of the orientations of these straight lines then determines the periapse distribution .",
    "for example , for random orientations with some spread ( e.g.  a gaussian distribution ) , the probability to reach radius @xmath33 simply scales like the area subtended by radius @xmath33 , that is @xmath46 . in this case",
    ", we would expect that at asymptotically small radius , the density profile laid down by individual shells should tend towards a constant , @xmath47const as @xmath48 .",
    "note that this disagrees with @xcite , who claimed that an isotropic velocity dispersion leads to a @xmath2 density profile , due to an unphysical ansatz they assumed .",
    "when material is accreted onto halos , its mass is deposited over a range of radii .",
    "this newly deposited mass not only adds to the existing density , but also causes contraction of the mass already present in the halos . to see this , note that the radial action @xmath49^{1/2}$ ] is an adiabatic invariant for spherically symmetric systems .",
    "if @xmath50 at radius @xmath33 increases due to accretion of new matter , then the orbits of particles at that radius will shrink in order to hold fixed the product @xmath51 .",
    "this effect is caused entirely by the density tails described in the previous subsection ; in the absence of such tails ( i.e. , in the absence of shell crossing ) the mass interior to any shell would remain constant and there would be no further contraction following collapse .    because the contraction acts to hold fixed @xmath52",
    ", we can easily estimate its effects given the @xmath52 profile before shell crossing ( e.g.  at turnaround ) and the density tails laid down by each shell .",
    "the most conservative estimate of this contraction arises if we assume minimal tails .",
    "as noted above , in triaxial potentials , we expect shell profiles to behave as @xmath53const as @xmath54 , so the weakest tails we expect would be for perfectly constant density @xmath55const for all @xmath56 .",
    "we denote this the minimal contraction model .    in this minimal contraction model",
    ", a lagrangian mass shell @xmath57 , of width @xmath58 and apoapse @xmath59 lays down a mass profile @xmath60 , where @xmath61 we compute the total mass profile by summing over all shells .",
    "this requires knowing @xmath59 , which we can estimate by assuming that the product @xmath52 is constant . at turnaround , this product is @xmath62 where we have used @xmath63 .",
    "let us write @xmath59 as the apoapse for shell @xmath57 , and the inverse function @xmath64 which gives the lagrangian shell @xmath57 whose @xmath65 . then we can easily write down the total ( contracted ) mass profile at @xmath66 as a sum over all shells ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) @xmath67 inserting our expression for the shell profile , eqn .",
    "( [ eqn : mininmalshell ] ) , gives @xmath68 differentiating this expression with respect to @xmath33 gives @xmath69 \\nonumber\\\\ & = & \\frac{3}{r } [ m - f^{-1}(m\\,r ) ] ,   \\label{eqn : min}\\end{aligned}\\ ] ] where @xmath70 is the inverse function of the expression in eqn .",
    "( [ eqn : mr ] ) .",
    "this is a simple ordinary differential equation for @xmath71 which may easily be solved for any linear density profile @xmath72 .",
    "as the name implies , the minimal contraction model provides a lower limit on the effects of adiabatic contraction . if the shell profiles have more mass at small radius than this model assumes , then contraction can be considerably stronger . to illustrate this",
    ", we provide another example toy model , ( very ) loosely motivated by our earlier study of self - similar triaxial collapse .",
    "we found that in certain cases , the shell profiles had inner slopes @xmath73 .",
    "if we assume that all shells have such profiles inside of their apoapses , then following the same reasoning that led us to eqn .",
    "( [ eqn : min ] ) , it is straightforward to show that the mass profile satisfies @xmath74 we label this as the @xmath75 model .",
    "we stress that both of these toy models are not meant to be considered as serious descriptions of the shell profiles ; rather they are meant to be illustrative , since they allow the halo mass distribution to be computed by solving simple ordinary differential equations .",
    "figure [ fig : frozen ] illustrates the effects of contraction .",
    "the predicted halo profile is significantly modified compared to the frozen model , even with minimal contraction .",
    "as the figure shows , the transition from steep to shallow slopes becomes much more gradual , once the effects of contraction are taken into account .",
    "even though the input peak profile sharply transitions to a flat , @xmath76const behavior , similar to a top - hat perturbation , the adiabatically contracted halo profile is very similar in form to nfw , even with minimal contraction .",
    "it is therefore not entirely surprising that nfw - like profiles arise in contexts like monolithic collapse or simulations with truncated power spectra .",
    "it is worth noting , however , that our models do not generically predict power - law central cusps in the final halo profile @xmath77 .",
    "only for power - law initial profiles , @xmath78 do we find power - law cusps , @xmath79 ( see paper i ) .",
    "more generally , for peaks with @xmath80 as @xmath81 , our models predict only logarithmic divergence of the halo density @xmath82 as @xmath48 .",
    "the logarithmic slope @xmath83 as @xmath33 approaches 0 , however the roll - over in slope occurs extremely slowly over many decades in radius .",
    "recent high resolution simulations ( e.g * ? ? ?",
    "* ; * ? ? ?",
    "* ) have found similar behavior , in the sense that their halo profiles appear better described with rolling profiles like the einasto profile @xcite instead of power - law cusps .",
    "we return to this topic in  [ sec : conclude ] .    to summarize this section ,",
    "we have described a simple method to translate from the initial peak to the final halo , essentially by adiabatically contracting the linear density profile and adopting a prescription for the distribution of orbits . in the next section , we compare this model to results of a high resolution cosmological n - body simulation .",
    "the model discussed in the previous section may seem overly simplistic .",
    "it employs arguments based on spherical symmetry , and describes halo assembly as an orderly process , resulting in an effectively stratified structure in which the orbits of particles within the halo reflect the locations where those particles originated . in contrast , the assembly of halos observed in cosmological simulations is often violent , involving discrete , stochastic accretion events that frequently take the form of major mergers . for this reason ,",
    "it is unclear whether a model that assumes that all halo material evolves adiabatically is capable of describing the messy reality of structure formation .",
    "previous work does , however , give us reason to hope that our simple model may nonetheless be useful .",
    "results from multiple simulations have shown that hierarchical assembly , including major mergers , does not completely obliterate all pre - existing structure within halos ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "more recently , @xcite analyzed high - resolution simulations of individual halos , and showed that their halo structure is indeed somewhat stratified , with a clear gradient of accretion time with radius .",
    "on the other hand , they also showed that major mergers can disrupt this stratification , by bringing in fresh material into the halo core .",
    "therefore , it is not clear whether our model , with its simplistic assumptions , would be relevant for realistic halos .    to test the assumptions and predictions of our simple model , we have analyzed results of the ultra - high resolution via lactea - ii ( vl2 ) simulation @xcite .",
    "this simulation resolves the lagrangian region of a typical milky way dark matter halo with just over one billion particles of mass 4,100 @xmath84 , and follows its evolution and formation in a cosmological environment ( 40 mpc ) , most of which is covered only with lower resolution ( higher mass ) particles .",
    "the simulation begins at redshift @xmath85 , and outputs 400 snapshots in time ending at @xmath86 .",
    "the snapshots were processed to determine halo properties including mass , centroid , and mean velocity , allowing us to reconstruct the halo s detailed assembly history . at @xmath86",
    "the main halo has @xmath87 kpc ( the radius enclosing a density of @xmath88 ) and @xmath89 .",
    "its density profile is well fit by an einasto profile with parameters @xmath90 kpc@xmath91 , @xmath25 = 28.9 kpc , and @xmath92 . assuming that this simulation provides a typical example of halo formation for galaxies like the milky way",
    ", its high resolution should allow us to test the key assumptions and predictions of our model .",
    "the most important assumption of our model that we would like to test is adiabaticity of the orbits .",
    "a direct check of this for over 1 billion particles with 400 snapshots would be a computational challenge , which we defer to future work .",
    "instead , we will attempt an easier exercise which worked well in our study of self - similar triaxial collapse in paper i. as mentioned in  [ sec : collapse ] , we expect that the product @xmath93 should be approximately conserved if the radial action @xmath94 is an adiabatic invariant . in paper",
    "i , we computed the average of this quantity , @xmath95 for entire shells of particles , and showed that the shell average is not only well conserved , but furthermore may be predicted from the linear density profile of the initial peak . because this is much simpler to compute , we perform a similar test for the vl2 halo .    , linearly evolved to redshift @xmath86 .",
    "lagrangian radius is measured relative to the lagrangian centroid of particles in the halo s main progenitor at @xmath96 .",
    "the thick dashed black curve shows the average profile about the lagrangian centroid of the particles inside @xmath97 at @xmath86 . for comparison ,",
    "the upper ( blue ) line and shaded region indicate the mean and dispersion in the highest subpeak profile expected from supremum statistics ( see  [ sec : stats ] ) , while the lower ( gray ) line and shaded region depicts the mean and dispersion expected for the peak profile neglecting subpeaks ( bbks ) .",
    "[ fig : delta ] , scaledwidth=45.0% ]    the first ingredient needed is the linear density profile of the initial peak that collapses to form this halo .",
    "this is plotted as the solid black curve in figure [ fig : delta ] .",
    "given this peak profile , we predict each shell s invariant @xmath52 using the spherical collapse model .",
    "at early times , prior to shell crossing , the mass enclosed within each shell is a constant , @xmath98 , and the spherical collapse model predicts the shell s turnaround radius to be @xmath99 .",
    "we assume that each shell s adiabatic invariant is equal to @xmath100 .",
    "given each shell s adiabatic invariant , we can compute the shell s average final radius within the halo at @xmath86 , given the halo s mass profile @xmath71 : we simply find the radius where @xmath93 is equal to @xmath100 for each shell .",
    "this is plotted as the dashed blue curve in figure [ fig : rfinal ] . for comparison , the solid black curve in fig .",
    "[ fig : rfinal ] shows the median radius @xmath33 measured at @xmath86 for each shell .",
    "the level of agreement between the two curves is striking , especially since neither has any freedom to be adjusted .     at @xmath86 for particles in narrow lagrangian shells , as a function of lagrangian radius @xmath101 .",
    "the dashed blue curve shows the predicted final radius for each shell , under the assumption that each shell adiabatically contracts , with adiabatic invariants determined from the linear density profile of the initial peak at @xmath85 . for comparison , the dotted red curve shows the predicted final radius in the frozen model , in which @xmath102 with no subsequent adiabatic contraction .",
    "[ fig : rfinal ] , scaledwidth=45.0% ]    it is important to stress that this test is not circular : this is a direct check that shells conserve @xmath93 , the prediction of adiabatic evolution . for a given @xmath71 profile , there are many ways that the lagrangian shells could add up to give the total mass . for example , if the halo had violently relaxed during formation , such that all the orbital actions became randomized , then the final orbital actions ( and hence orbital radii ) would be unrelated to original lagrangian location , and we would expect the median @xmath33 to be independent of @xmath101 .",
    "this clearly does not occur within the vl2 halo .    , but using the @xmath86 lagrangian centroid .",
    "the disagreement at small @xmath33 shows that the mass at small radius , @xmath103 , does not originate near the centroid of the overall lagrangian volume , but instead originates near the subpeak that was used in fig .",
    "[ fig : rfinal ] .",
    "[ fig : badrfinal ] , scaledwidth=45.0% ]    to illustrate that this test could have failed , we plot in figure [ fig : badrfinal ] how this comparison would have looked if we had used a different lagrangian centroid .",
    "the @xmath104 profile plotted in fig .",
    "[ fig : delta ] was measured relative to the lagrangian centroid of the progenitor halo at high redshift , @xmath96 .",
    "if we instead use the lagrangian centroid of all the particles in the halo at @xmath86 , we obtain the result shown in fig .",
    "[ fig : badrfinal ] . here",
    ", the agreement between the predicted and measured radii at @xmath86 is reasonable at large radii , but much worse near @xmath105 .",
    "there are two reasons for this .",
    "first , the linear density profile @xmath104 changes when we measure lagrangian radii relative to a different centroid , as illustrated by the difference between the solid and dashed curves in fig .",
    "[ fig : delta ] .",
    "more importantly , however , the particles originating near the @xmath86 lagrangian centroid are not the particles that are found near @xmath105 in the final collapsed halo .",
    "rather , the mass at small @xmath33 in the final halo largely originated near a sub - peak within the total lagrangian volume , that gave rise to the main progenitor halo at high redshift .",
    "this sub - peak is off - center within the overall lagrangian volume ( see fig .  [",
    "fig : delta ] ) , but the mass within this off - center peak eventually falls towards @xmath105 through processes like dynamical friction . earlier work ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) has already shown that the mass at small radius within halos typically collapses at high redshift .",
    "our result is potentially much more powerful : we now have a means of quantitatively calculating where material will occur within the halo , as a function of time .",
    "the level of agreement shown in fig .  [ fig : rfinal ] is even more remarkable when we consider how simplistic the prediction is . to reiterate",
    ", we take the spherically averaged linear density profile @xmath104 , apply the spherical collapse model to predict each shell s turnaround radius @xmath106 , and then assume that the product @xmath100 is an adiabatic invariant .",
    "the formation of the vl2 halo is highly nonsphericalmqk / vl2/movie_10m_withfly.mp4 ] , as is typical in cdm cosmologies , so one potential area of future work could be to explore whether the adiabatic invariants may be predicted more precisely by accounting for triaxiality .",
    "this simplistic , spherical approach is already adequate to make considerable progress towards understanding and predicting the mass distribution within the collapsed halo . if we know how to calculate the typical location of each shell within the halo , then we need only add a prescription for the individual shell profiles to predict the total mass profile . in  [ sec : collapse ] , we described two examples of toy models for the profiles of shells : a minimal contraction model , in which each shell deposits density as a step function , @xmath107 , and a slightly more elaborate model in which each shell deposits mass with a profile @xmath108 .",
    "these are both obviously very crude treatments and are no replacement for a detailed understanding of the orbital structure within halos ; we employ them here simply because they allow us to solve for the total mass distribution using ordinary differential equations .",
    "we plot the predictions of these toy models in figures [ fig : massprofile ] and [ fig : shells ] .",
    "note that , unlike the plots in figs .",
    "[ fig : rfinal ] and [ fig : badrfinal ] , this calculation does not use the measured @xmath71 profile from the vl2 halo at @xmath86 .",
    "rather , these toy models solve self - consistently for the total mass distribution , placing each shell at the required radius @xmath33 given each shell s adiabatic invariant and the mass profile obtained by summing over all shells .",
    "[ fig : shells ] shows that this toy model is only a very crude approximation to the individual shell profiles , but fig .",
    "[ fig : massprofile ] illustrates that this is already adequate to predict the halo s radial mass distribution reasonably well .     measured from vl2 ,",
    "the dashed blue curve is our @xmath75 toy model eqn .",
    "( [ toy2 ] ) , and the dotted red curve is the minimal contraction model eqn .",
    "( [ eqn : min ] ) .",
    "[ fig : massprofile ] , scaledwidth=46.0% ]     toy model .",
    "neither toy model captures the shell profiles well , especially at small radius , however the @xmath75 model is a close enough approximation to reproduce the overall mass profile ( see fig .",
    "[ fig : massprofile ] ) .",
    "[ fig : shells ] , scaledwidth=46.0% ]    before closing this section , we stress that vl2 is just one halo . the remarkable agreement between our model predictions and this simulation s results could ,",
    "in principle , be a fluke , if ( for example ) this halo had an atypical formation history . further study of additional examples ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) would be useful to verify the generality of our results .",
    "in the previous section , we showed that the radial structure of the vl2 halo may be understood quite simply .",
    "lagrangian shells evolve over time in a manner that , on average , conserves their radial actions .",
    "these adiabatic invariants may be predicted in a simple way by applying the spherical collapse model to the spherically averaged profile of the peak that collapses to form this halo .",
    "given this result , even a crude treatment of the mass profiles deposited by lagrangian shells suffices to describe the overall mass profile within the halo reasonably well .",
    "consistent with previous work , we also found evidence for processes like dynamical friction that can transport material within early - collapsing subregions towards the halo center .",
    "given this success in understanding one particular halo , what can we say about halo structure more generally ?",
    "our key result is that the profiles of collapsed halos may easily be understood in terms of the properties of their precursor peaks . for most cosmologies of interest ,",
    "the properties of the initial peaks are well described by gaussian statistics @xcite .    in our model ,",
    "the radial profile @xmath77 within the halo is determined by the linear overdensity profile @xmath104 of the initial peak .",
    "it is straightforward to determine the statistics of the interior @xmath104 profile for gaussian random fields .",
    "for example , suppose that we have a peak on scale @xmath109 that collapses to make a halo of mass @xmath110 , and suppose that the peak has height @xmath111 and derivative @xmath112 on this scale .",
    "we would like to compute the conditional probability distribution for the density at interior radii given the peak height and slope at the outer scale , @xmath113 .",
    "in general , the conditional probability distribution @xmath114 for gaussian variables @xmath115 and @xmath116 ( with zero mean ) is also a gaussian , with mean and variance @xmath117 in our case , @xmath115 would correspond to the small - scale density @xmath104 , and @xmath116 would correspond to the density @xmath118 and slope @xmath119 on scale @xmath109 . given a power spectrum ,",
    "the required covariances are easy to compute . in fig .",
    "[ fig : delta ] , the dotted line and gray dashed band illustrate the mean and dispersion of the @xmath120 profile when we condition on the value and slope of @xmath121 at the top - hat radius .",
    "the mean profile quickly plateaus inside the top - hat radius @xmath122 , where @xmath123 .",
    "in addition , there is considerable scatter about the mean profile , increasing towards smaller radii .",
    "if we use the @xmath86 lagrangian centroid , the measured @xmath5 profile ( dashed line in the figure ) is quite consistent with this bbks prediction .",
    "previous workers have made similar arguments for the expected shape of the gaussian peaks that form halos .",
    "@xcite assumed that peak profiles follow the unsmoothed matter correlation function , which bbks later showed is not typical for gaussian peaks . @xcite and",
    "@xcite used the average bbks profile , however they used a smoothing scale much smaller than the top - hat scale of the halos , which gives a profile extremely atypical for the peaks that collapse into halos .",
    "more recently , @xcite employed the mean bbks profile to describe the typical profiles of gaussian peaks .    as we have seen in ",
    "[ sec : vl ] , however , the linear profile centered on the overall lagrangian centroid may not be relevant for computing the structure of the collapsed halo , because processes like dynamical friction can drag off - center subpeaks towards the halo center .",
    "we found good agreement between the measured and predicted adiabatic invariants if we instead used the lagrangian position of the sub - peak that formed the earliest halo progenitor at @xmath96 . as fig .",
    "[ fig : delta ] shows , the profile centered on this subpeak is quite different than the mean bbks profile used in earlier works . in general",
    ", we would expect similar behavior in other halos as well .",
    "the hierarchy of peaks within peaks expected for cdm cosmologies significantly modifies the structure that we would naively calculate using the mean peak profile .",
    "one simple way to account for this effect is simply to graft the profile of the highest subpeak onto the overall peak profile .",
    "so if we wish to compute the density @xmath104 for some @xmath101  that is much smaller than the peak size , instead of using the value of @xmath104 centered on the halo s lagrangian centroid , we instead find the largest @xmath5 for all the sub - volumes of size @xmath124 within the halo s lagrangian volume .",
    "this is effectively what we have done in fig .",
    "[ fig : delta ] by centering on the @xmath96 sub - peak .",
    "of course , this sub - peak will have subsubpeaks inside of it , but with a hierarchy of such grafts , we can construct the effective peak profile that accounts for effects like dynamical friction .",
    "the statistics of the highest subpeaks are elementary to compute , as we illustrate with a simple example .",
    "suppose that @xmath125 is a gaussian random variable with zero mean and unit variance , of which we have @xmath126 independent samples .",
    "the probability that @xmath127 exceeds any one of these @xmath125 samples is @xmath128 and so the probability that @xmath127 exceeds all @xmath126 of the @xmath125 values is @xmath129^n \\approx \\exp\\left(-n y^{-1 } e^{-y^2/2}/\\sqrt{2\\pi}\\right ) , \\label{eqn : supremum}\\ ] ] where the last approximation is valid in the limit of large @xmath126 .",
    "the double - exponential form of the extreme - value probability is not specific only to our gaussian distribution , but in fact arises generically for any parent distribution that is sufficiently steep @xcite .",
    "the differential probability that @xmath127 is the supremum of the @xmath126 samples is @xmath130 . in figure",
    "[ fig : supremum ] , we plot the typical supremum as a function of sample size @xmath126 .",
    "as might be expected for a gaussian parent distribution , the largest value grows roughly like @xmath131 in the limit of large @xmath126 .    , the largest value of @xmath126 random gaussian numbers with zero mean and unit variance .",
    "[ fig : supremum ] , scaledwidth=45.0% ]    it is straightforward to apply this expression to our problem of computing the distribution of the highest subpeaks . here , @xmath132 is simply the bbks probability described above , and @xmath133 is the number of independent samples of size @xmath134 inside a peak of size @xmath109 . by construction , we account for the correlations between the density on scale @xmath134 and the density and derivatives on scale @xmath109 , but we neglect any additional spatial correlations among the subpeaks beyond this .",
    "we caution that , in general , this expression will overestimate the height of the effective @xmath135 profile , and will underestimate its scatter .",
    "this is because dynamical friction is not always effective , especially at low subhalo mass  which is why so much substructure persists in cdm halos ( e.g. * ? ? ?",
    "we are implicitly assuming that the highest subpeak of size @xmath134 will always find its way to the origin , but for @xmath136 , the dynamical friction timescale may exceed the halo s lifetime , meaning that this sub - peak would have to be carried to @xmath105 by some larger scale structure . clearly , it is not always the case that , for example , the highest peak on scale @xmath137 arises inside of the highest peak on scale @xmath138 .",
    "a more careful treatment would be considerably more complicated , however , so we have opted to make this simplifying assumption .",
    "bearing this caveat in mind , the blue curve and shaded area in fig .  [ fig : delta ] plots the mean value and dispersion of the highest sub - peak , calculated using supremum statistics . as with the bbks curve",
    ", we have conditioned the probability on the value and derivative of the linear overdensity @xmath5 on the top - hat scale corresponding to the measured mass @xmath139 .",
    "the agreement between the predicted curve and the actual measured peak profile over decades in radius is striking .",
    "another remarkable feature is that the scatter in the effective profile is much smaller than the scatter in the bbks profile .",
    "this occurs because the the dispersion in the largest value of a sample is considerably smaller than the dispersion of the sample as a whole , in the limit of large @xmath126 .",
    "note that this level of dispersion is not indicative of the full scatter in peak profiles for halos of a fixed mass . in this example",
    ", we have constrained the profiles to match the value and slope of the vl2 peak profile at the largest plotted radius . other halos with",
    "comparable mass will correspond to peaks with different heights and slopes at the boundary , and hence their internal profiles will show different behavior .    to illustrate this ,",
    "we plot in fig .",
    "[ fig : range ] the predicted profiles for initial peaks that have outer slopes different than the vl2 peak .",
    "the blue and red solid curves show the predicted halo profiles for peaks with outer slopes either @xmath140 larger , or @xmath141 smaller , than the vl2 peak . for comparison ,",
    "the dotted curve shows the nfw profile , @xmath142 and the dashed curves show the einasto profile @xcite , @xmath143\\ ] ] for @xmath144 and 0.17 , covering the range found in the aquarius simulations @xcite .",
    "as the figure shows , varying the outer profile slope of the initial peak over a reasonable range spans the profile shapes found in high resolution simulations .     toy model . for comparison ,",
    "the dotted black curve shows the nfw profile , while the two dashed black curves are the einasto profile for @xmath144 and 0.17 , the range of the aquarius halos @xcite .",
    "[ fig : range ] , scaledwidth=45.0% ]",
    "the previous sections described a simple model for the structure of cosmological halos , combining gaussian statistics with prescriptions for physical effects like dynamical friction and adiabatic contraction .",
    "such a model can have many obvious applications .",
    "we illustrate with one example in this section .    in our model ,",
    "the shape of the final collapsed halo profile is simply related to the shape of the linear density profile of the original peak .",
    "one of the important parameters used to describe halo profiles is the concentration , which we can define as the ratio between the halo s radius @xmath97 , and @xmath25 , the radius where the local density slope is @xmath145 .",
    "many papers have attempted to quantify the typical halo concentration as a function of mass ( e.g. * ? ? ? * and references therein ) .",
    "using our model , we can try to predict this @xmath146 relation .",
    "the halo concentration basically measures how quickly the halo slope rolls over from near -3 to -2 , and in our model this is controlled by the outer height and slope of the initial peak ( mainly the latter ) .",
    "the distribution of the heights of the peaks producing halos is set by the distribution of collapse thresholds .",
    "@xcite proposed a simple ellipsoidal collapse model to predict the distribution of collapse thresholds , and @xcite found that the predictions of the @xcite model are reasonably approximated by the fitting function @xmath147,\\ ] ] where @xmath148 is the spherical collapse threshold , @xmath149 is the variance of linear density fluctuations smoothed on mass scale @xmath50 , and the fitting function parameters are @xmath150 and @xmath151 .",
    "@xcite showed that this expression is in broad agreement with the heights of peaks that produce halos in @xmath152cdm simulations , so we will adopt it here .",
    "more importantly , we also need the typical outer slopes of the same peaks .",
    "this has been less well quantified in the literature . for high mass halos , with @xmath153 , we can use simple gaussian statistics to predict the outer slopes @xmath154 .",
    "the typical slope for a peak of height @xmath5 is @xmath155 where @xmath156 is the conditional gaussian probability distribution .",
    "note that this expression is different than eqn .",
    "( [ cond_mean ] ) , since we require that the slope @xmath157 , since otherwise this peak would not collapse on mass scale @xmath50 but instead some larger mass @xcite .",
    "this expression works well for high mass halos , @xmath158 , where @xmath159 is the characteristic nonlinear mass scale satisfying @xmath160 .",
    "however , this significantly underestimates the magnitude of the outer slopes for low mass halos , @xmath161 , which are considerably steeper than eqn .",
    "( [ eqn : slopebbks ] ) predicts .",
    "this appears to occur for the same reason that these low - mass halos are anti - biased : such halos tend to avoid high - density regions .",
    "more precisely , the peaks that produce low mass halos tend to occur within underdense environments , presumably because similar peaks inside of overdense regions do not lead to low mass halos , but rather are incorporated into higher mass halos .",
    "this is the reason why the average peak profile plotted as the dotted curve in fig .",
    "[ fig : frozen ] changes sign .",
    "as the figure shows , the outer profiles for such halos are extremely steep , which we argued in  [ sec : frozen ] was the origin of the high concentrations of these halos .    given the lack of a theory to describe this effect , we have attempted to measure the typical outer slopes of initial peaks .",
    "we performed a low - resolution @xmath152cdm simulation for a volume 256 @xmath162 mpc on a side , identified halos at @xmath86 down to mass @xmath163 , and stacked the linear density profiles of the halos precursor peaks in narrow mass bins .",
    "very crudely , we found that a rough scaling @xmath164 reasonably described the mass range that we measured .    .",
    "the solid black curve shows our model ( see text ) , while the dotted red curve shows the prediction from using the naive peak slopes from gaussian statistics . for comparison ,",
    "the dashed blue curve shows the power law @xmath165 found in n - body simulations @xcite .",
    "[ fig : conc ] , scaledwidth=45.0% ]    given this expression , and our expression for the average peak height as a function of mass , we use eqn .",
    "( [ eqn : supremum ] ) to predict the average peak profile , and then eqn .",
    "( [ toy2 ] ) to predict the halo profile , from which we measure the concentration .",
    "figure [ fig : conc ] shows the result .",
    "the solid black curve in the figure is our prediction , while the dashed blue curve shows the scaling @xmath165 , as found in cosmological simulations @xcite . for comparison ,",
    "the red dotted curve shows how the concentration would depend on mass if the outer slopes followed simple gaussian statistics .",
    "the agreement between our prediction and the results of simulations is , once again , quite good . at low masses , this model appears to underpredict the concentrations , but this is likely because eqn .",
    "( [ slopefit ] ) underestimates the slopes of halos below @xmath166 . at high masses , note that our concentrations appear to saturate near values @xmath167 .",
    "this occurs because , at high masses , peaks no longer are anti - biased , and hence their outer slopes are given by the shallow values predicted from gaussian statistics .",
    "in this paper , we have presented a model to explain the origin of the nearly universal density profiles of dark matter halos found in n - body simulations .",
    "we argued that the physics setting the shape of halo radial profiles is extremely simple .",
    "we find that adiabatic contraction sets the basic shape of the halo profile , and that the conserved quantities in this contraction , i.e.  the adiabatic invariants , are determined by the linear density profile of the initial peak .",
    "we further argue that , because of dynamical friction , the hierarchy of peaks within peaks significantly alters and _ simplifies _ the effective peak profile setting the adiabatic invariants and hence the halo profile .",
    "we have compared our model predictions to n - body simulations , and found striking agreement . in particular , the detailed mass distribution of the high - resolution via lactea - ii halo is quite consistent with our model , and provides strong evidence for the importance of both adiabatic contraction and dynamical friction .",
    "we then showed how this model may be used to predict the statistics of halo properties , focusing on the example of the mean concentration relation @xmath146 .    our model ,",
    "if correct , could have additional implications beyond what we have discussed so far .",
    "one example that has attracted considerable attention is the asymptotic inner profile of dark matter halos , which can be important for dark matter annihilation ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) . for cdm - like power spectra",
    ", our models do not produce power - law central cusps , but instead diverge logarithmically . the local slope @xmath168 rolls over very slowly with radius , asymptotically approaching zero slope at @xmath105 .",
    "as we noted above , recent high resolution simulations have found qualitatively similar behavior , where the halo slope @xmath168 rolls smoothly down to the resolution limits of the simulations . as we showed in figure",
    "[ fig : range ] , the einasto profiles used to fit these halos are quite similar to the predictions of our model .    as we have emphasized in this paper ,",
    "our model is not complete , because it lacks a detailed understanding of the mass profiles deposited by lagrangian shells . for simplicity ,",
    "we have adopted a simple ansatz that is loosely motivated by our previous study of self - similar triaxial collapse ( paper i ) , however in the future we intend to examine the orbital distribution within halos in more detail . our study of self - similar collapse has already shown that the evolution of orbits in time - varying triaxial potentials is quite interesting and can often be surprising , for example in the different ways that box orbits and loop orbits respond to changes in the potential .",
    "this is the subject of ongoing work .",
    "lastly , we note that it would be useful to extend the comparison of our models to other high resolution halo simulations",
    ". in particular , it would be worthwhile to explore the limits of this model , which so far appears to work surprisingly well in regimes ( e.g.  @xmath169 ) where we might naively have expected it to fail .",
    "one regime where this model is likely to break down is the case of nearly 1:1 major mergers in halos , in which both progenitors have comparable central density and both contribute to the central core",
    ". it would be interesting to see whether we can find adiabatic invariants to describe the dynamics even in such extreme cases ."
  ],
  "abstract_text": [
    "<S> a longstanding puzzle of fundamental importance in modern cosmology has been the origin of the nearly universal density profiles of dark matter halos found in n - body simulations  the so - called nfw profile . </S>",
    "<S> we show how this behavior may be understood , simply , by applying adiabatic contraction to peaks of gaussian random fields . </S>",
    "<S> we argue that dynamical friction acts to reduce enormously the effect of random scatter in the properties of initial peaks , providing a key simplification . </S>",
    "<S> we compare our model predictions with results of the ultra - high resolution via lactea - ii n - body simulation , and find superb agreement . </S>",
    "<S> we show how our model may be used to predict the distribution of halo properties like concentration . </S>",
    "<S> our results suggest that many of the basic properties of halo structure may be understood using extremely simple physics . </S>"
  ]
}