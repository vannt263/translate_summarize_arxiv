{
  "article_text": [
    "the aim of magnetic confinement fusion is to develop a power plant that gains energy from the fusion of deuterium and tritium in a magnetically confined plasma .",
    "iter , a tokamak type fusion experiment currently being built in the south of france , is the next step towards this goal .    in order to achieve a reasonable lifetime of first wall materials in iter and future fusion reactors ,",
    "plasma instabilities like edge localized modes ( elms ) @xcite need to be well controlled .",
    "numerical modelling can help to develop the necessary understanding of the relevant physical processes .",
    "a physical model well suited to describe those large scale instabilities is the set of magneto - hydrodynamic equations ( mhd ) or the simpler reduced mhd model .",
    "we begin by introducing the resistive magnetohydrodynamic ( mhd ) fluid system in 3d .",
    "the spatial variable is @xmath0 .",
    "we note @xmath1 the mass density of the plasma , @xmath2 the velocity , @xmath3 the temperature , @xmath4 the pressure , @xmath5 the magnetic field , @xmath6 the current and @xmath7 the electric field . the evolution of the plasma can be described by the following mhd model @xmath8 with @xmath9 the viscosity coefficient , @xmath10 the resistivity coefficient .",
    "the resistive term originates from the collision between the two species electrons and ions present in the plasma .",
    "the viscosity term is a very simple approximation of the stress tensor .",
    "the resistive mhd model used here is a simplification of two fluids models ( extended mhd ) .",
    "the numerical properties of extended mhd terms in jorek are beyond the scope of this paper and will be investigated in a future publication .",
    "first we recall the energy conservation and dissipation properties of the resistive mhd model .",
    "the total energy of the mhd model is given by the sum of the kinetic energy , magnetic energy and internal energy : @xmath11 with @xmath4 and @xmath12 .",
    "the balance law for the total energy is given by @xmath13=-\\eta \\mid{\\mathbf{j}}\\mid^2+(\\nabla \\cdot(\\nu \\nabla { \\mathbf{v } } ) ) \\cdot { \\mathbf{v}})\\ ] ] if @xmath14 and @xmath15 on @xmath16 we obtain @xmath17 with @xmath18 .",
    "we multiply the mass equation by @xmath19 , the velocity equation by @xmath20 , the pressure equation by @xmath21 and the magnetic field equation by @xmath22 .",
    "we obtain @xmath23 first we multiply the velocity equation by @xmath20 and the mass equation by @xmath19 to obtain the following equation on the kinetic energy @xmath24 adding this equation to the pressure equation and the magnetic field equation multiplied by @xmath22 , we obtain @xmath25 rearranging the terms this becomes @xmath26 to obtain this we have used @xmath27 .",
    "now we use @xmath28 to finish the proof we use the definition of the vector laplacian @xmath29 and an integration by parts .",
    "if the resistivity and viscosity coefficients are equal to zero the total energy is conserved in time and otherwise it is dissipated in time .",
    "this result comes from the flux divergence theorem and the assumptions on the boundary conditions .",
    "normally the dissipation introduced by the resistive and viscous terms is balanced by the viscous and the ohmic heating to obtain at the end the conservation of the total energy .",
    "however it is classical to neglect these terms and work with the dissipative resistive mhd system . in the following , we will derive a reduced model with the same dissipative energy ( or a really close energy ) . indeed , energy conservation or dissipation is important for the numerical stability .",
    "the reduced resistive mhd models are designed to reduce the cpu cost by making assumptions , which are reasonable for the tokamak configuration .",
    "since the perturbation of the toroidal magnetic field is of second order ( in terms of a small expansion parameter ) and enters into the equation of motion only at third order , it can be neglected in the reduced mhd limit @xcite such that we take the toroidal magnetic field to be constant in time .",
    "the magnetic field @xmath22 can be split into two parts : the toroidal part @xmath30 and the poloidal part @xmath31 given by @xmath32 the velocity field depends on the electrical potential in the poloidal plane and the parallel velocity ( parallel to the magnetic field ) .",
    "it is given by @xmath33 this choice come from to the choice of the electrical potential @xmath34 with @xmath35 and the fact that the poloidal velocity is homogeneous to @xmath36 .",
    "this potential formulation allows to reduce the number of variables and filter the fast magnetosonic waves of the mhd for nearly incompressible flows .",
    "the full mhd system with all waves is a very stiff problem with restrictive cfl stability conditions and bad conditioning for the numerical methods .",
    "consequently eliminating these waves allows to obtain a less stiff problem , which is easier to solve . to obtain the final reduced models we plug the potential formulations in the full mhd model and use projections to obtain the equations on @xmath37 and @xmath38 . for the equation on the electric potential we project by applying the operator @xmath39 to the momentum equation . to obtain the equation on @xmath38 we project by applying the operator @xmath40 to the momentum equation",
    "one of the aims of this work is to derive exactly the reduced mhd model used in the jorek code and prove that this model satisfies the energy conservation law .",
    "indeed the energy conservation is a very important property to ensure the numerical stability of the time evolution method for nonlinear models .",
    "the non - linear jorek code was originally developed by huysmans @xcite , see also @xcite , solves the reduced or full mhd equations in realistic three - dimensional tokamak geometry .",
    "the spatial discretization is performed by isoparametric bzier finite elements in the poloidal plane and a toroidal fourier decomposition . as a first step in a simulation , the grad shafranov equation given by @xmath41 with @xmath42 , @xmath43 , @xmath44 the pressure and @xmath30 the toroidal magnetic field , is solved on an initial grid ( fig . 1 , on the left ) to calculate the plasma equilibrium and again on a grid aligned to the equilibrium magnetic flux surfaces ( fig . 1 , on the right in blue ) .",
    "this second grid is used during the following time integration as well , in which the ( reduced ) mhd equations are solved by a fully implicit method ( crank - nicholson or gear scheme ) .",
    "the resulting large sparse matrix system is solved using the iterative gmres method with a physics - based preconditioning during which the direct sparse matrix solver pastix is employed .",
    "jorek is implemented in fortran 90/95 and uses a hybrid mpi plus openmp parallelization suitable for large scale simulations on supercomputers .",
    "the realistic treatment of the tokamak geometry including the plasma region , separatrix and x - point , as well as scrape - off layer and divertor region makes the code suitable for simulations of many different types of plasma instabilities .",
    "+   + in the following we will provide a rigorous algebraic derivation of the reduced mhd equations that are implemented in jorek from the full mhd equations ( sections 2.12.3 ) and investigate the energy conservation properties of this reduced mhd model ( section 2.4 ) . in section 3 , we will introduce a non - linear time integrator based on inexact newton iterations for jorek in order to increase the robustness and performance of the code in highly non - linear stages .",
    "numerical tests of the non - linear time stepping scheme are presented in section 4 and brief conclusions of the work are provided in section 5 .",
    "the derivation of reduced mhd models is not a new research topic .",
    "we can find some derivations of models with parallel velocity for small curvature in the tokamak in @xcite .",
    "these derivations are based on an asymptotic analysis with the small parameter @xmath45 which corresponds to the curvature of the geometry . in these calculations ,",
    "some terms are neglected in the final models . in our case",
    "we use an algebraic derivation . using the same assumptions for the magnetic field and the velocity field as in @xcite .",
    "the same method and the same type of calculation can be found in the works of r. sart and b. desprs in @xcite . in these papers",
    "the authors propose two methods to obtain the reduced mhd in the low @xmath46 case , where @xmath46 is the ratio between plasma and magnetic pressures ( which correspond to @xmath47 ) for general density profiles . in this work",
    "we use the same technique as in their first paper , but we apply this method to obtain the more complicated models , which are actually implemented in the jorek code . so far , no exact derivation for the reduced mhd models implemented in jorek had been published . for this reason we give these proofs and identify",
    "previously neglected terms in the reduced mhd physics models .",
    "the fundamental coordinate system used in jorek is the cylindrical system @xmath48 illustrated in fig .",
    "2 . the connection to cartesian coordinates is given by @xmath49 we define @xmath50 , @xmath51 and @xmath52 with @xmath53 , @xmath54 , @xmath55 functions of ( @xmath56,@xmath57,@xmath55 ) . by definition of the basis we have @xmath58 , @xmath59 and @xmath60 .",
    "+        the domain is defined by @xmath61 .",
    "to finish we define the different differential operators used for the calculation : @xmath62 @xmath63 @xmath64 @xmath65 @xmath66 @xmath67 @xmath68={\\mathbf{e}_{\\phi}}\\cdot(\\nabla a \\times \\nabla b)={\\partial_r}a{\\partial_z}b-{\\partial_z}a { \\partial_r}b.\\ ] ] the variables associated to the reduced mhd models are the poloidal magnetic flux @xmath69 , the electrical potential @xmath37 , the density @xmath1 , the temperature @xmath3 and the parallel velocity @xmath38 .",
    "we introduce two additional variables : the toroidal current @xmath70 defined by @xmath71 and the vorticity @xmath72 defined by @xmath73 .",
    "this procedure is used to break some high order operators into lower order ones . for the integration",
    "we denote by @xmath74 the cylindrical measure and @xmath75 . when no measure is given explicitly , @xmath76 is used .",
    "the starting point of our derivation is the the following resistive mhd model @xmath77 we do not treat the viscosity term in the following derivation , but discuss it briefly at the end of section [ sec : final_model ] .",
    "we use the magnetic field @xmath78 given by ( [ bbb ] ) .",
    "since @xmath79 and @xmath80 we get @xmath81 .",
    "consequently the equation on the magnetic field in ( [ mhdre1 ] ) becomes @xmath82 with @xmath83 .",
    "the equation becomes @xmath84 with @xmath85 a potential .",
    "we begin by estimating the term @xmath86 .",
    "since @xmath87 we obtain @xmath88 which gives @xmath89{\\mathbf{e}_{\\phi}}.\\end{aligned}\\ ] ] now we study the term @xmath83 . @xmath90 since @xmath91 is constant , using the properties of curl and gradient operators we have @xmath92 .",
    "so @xmath93 since @xmath94 and @xmath95 we have @xmath96 therefore expanding the gradient for each component we obtain @xmath97 and using the definition of the grad - shafranov diffusion operator we have @xmath98 we plug together all the terms to obtain @xmath99{\\mathbf{e}_{\\phi}}\\\\ & \\quad -\\eta\\left[-\\frac{1}{r}\\triangle^{*}\\psi{\\mathbf{e}_{\\phi}}+\\frac{1}{r^2}{\\partial_{\\phi}}({\\partial_z}\\psi){\\mathbf{e}_z}+\\frac{1}{r^2}{\\partial_{\\phi}}({\\partial_r}\\psi){\\mathbf{e}_r}\\right]+\\nabla v.\\end{aligned}\\ ] ] now we multiply the previous equation by @xmath100 and after by @xmath101 to obtain the expressions of the @xmath53 and @xmath55 derivatives of v : @xmath102 consequently @xmath103 and @xmath104 .",
    "we have assumed that the constant @xmath105 is equal to zero to obtain the electrical potential that is usually chosen and compatible with the choice of the poloidal velocity .",
    "this definition of @xmath85 gives the final result .",
    "@xmath106+\\eta\\triangle^{*}\\psi - f_0{\\partial_{\\phi}}u+\\eta \\frac{\\partial_{\\phi\\phi } \\psi}{r^2}\\ ] ] with @xmath107 the toroidal current .",
    "to obtain an equation on the electric potential we apply the projection operator @xmath108 in the poloidal plane to the momentum equation .",
    "the equation obtained is @xmath109.\\ ] ] we begin by considering the first term of ( [ u1 ] ) : @xmath110 . using the definition of @xmath111 we obtain @xmath112,\\ ] ] and @xmath113 by definition of the gradient and the divergence we obtain @xmath114 we consider the term associated to the time derivative of the parallel velocity @xmath115 $ ] . developing @xmath22 we obtain @xmath116\\right].\\ ] ] after some algebra @xmath117-{\\partial_r}\\left[r\\rho { \\partial_t}(v_{||}{\\partial_r}\\psi)\\right]= -r \\nabla \\cdot \\left[\\rho { \\partial_t}(v_{||}\\nabla_{pol } \\psi)\\right].\\ ] ] secondly , we study the current term @xmath118 .",
    "we recall the form of the current @xmath119 computed in the previous subsection .",
    "so , using ( [ u3 ] ) - ( [ u4 ] ) we have @xmath120\\\\   & + \\frac{1}{r}\\left[-(({\\partial_r}\\psi)(\\partial_{r\\phi}\\psi)+({\\partial_z}\\psi)(\\partial_{z\\phi}\\psi)){\\mathbf{e}_{\\phi}}\\right].\\end{aligned}\\ ] ] applying the operator @xmath121 we obtain @xmath122 a final calculation gives the following result @xmath123-\\frac{f_0}{r}{\\partial_{\\phi}}{\\triangle^{*}}\\psi=[\\psi , j]-\\frac{f_0}{r}{\\partial_{\\phi}}j.\\ ] ] for the pressure term , trivial computations allow to obtain the following result @xmath124=[r^2,p].\\ ] ] the last term considered is @xmath125 .",
    "firstly we study the part which depends only on the poloidal velocity : @xmath126 . to begin we denote by @xmath127 , @xmath128 and @xmath129 .",
    "so @xmath130 to estimate this term we propose the following decomposition @xmath131 one has the identities @xmath132,\\ ] ] and @xmath133.\\ ] ] using @xmath134 and @xmath135 $ ] we obtain @xmath136-r \\widehat{\\rho } w [ r , u]$ ] . in a first time we estimate the term @xmath137 .",
    "the definition of the vector product gives @xmath138\\ ] ] which we can rewrite in the following form @xmath139-{\\partial_r}(\\widehat{\\rho})\\left[{\\partial_z}(\\frac12\\alpha^2+\\frac12\\beta^2)-\\alpha({\\partial_z}\\alpha-{\\partial_r}\\beta)\\right]\\right).\\ ] ] using @xmath140 , we obtain the final expression of the term @xmath137 , which reads @xmath141-{\\partial_z}(\\widehat{\\rho})\\beta({\\partial_z}\\alpha-{\\partial_r}\\beta)-{\\partial_r}(\\widehat{\\rho})\\alpha({\\partial_z}\\alpha-{\\partial_r}\\beta)=-\\frac12[r^2|\\nabla_{pol}u|^2,\\widehat{\\rho}]-r^2 w [ \\widehat{\\rho},u].\\ ] ] to finish we sum up @xmath142 and @xmath137 to obtain @xmath143-r[r\\widehat{\\rho } w , u]-r\\widehat{\\rho } w [ r , u].\\ ] ] therefore @xmath144-[r^2\\widehat{\\rho } w , u].\\ ] ]   + at this moment of the derivation using the equation on the velocity in the resistive mhd ( [ mhdre1 ] ) , using the projection @xmath110 and neglecting all the terms in the velocity equation which depend on the parallel velocity we have obtained the equation on @xmath37 implemented in the code .",
    "now we propose to derive the terms neglected in the code which correspond to the following cross terms between the parallel and poloidal velocities and given by @xmath145 firstly we consider the term @xmath146 .",
    "we begin by splitting the term into two parts @xmath147 and we define @xmath148 with @xmath149 , @xmath150 and @xmath151 , consequently @xmath152{\\mathbf{e}_r}+\\left [ a{\\partial_r}(bv_{||})+b{\\partial_z}(bv_{||})+\\frac{c}{r}{\\partial_{\\phi}}(bv_{||})\\right]{\\mathbf{e}_z}\\\\ & + \\left[a{\\partial_r}(cv_{||})+b{\\partial_z}(cv_{||})+\\frac{c}{r}{\\partial_{\\phi}}(cv_{||})\\right]{\\mathbf{e}_{\\phi}}-\\left(v_{||}^2 \\frac{c^2}{r}\\right){\\mathbf{e}_r}+\\left(v_{||}^2 \\frac{c}{r } a\\right){\\mathbf{e}_{\\phi}}.\\end{aligned}\\ ] ] the term @xmath137 can be decomposed as @xmath153 with @xmath154-({\\partial_z}\\widehat{\\rho})\\left[av_{||}{\\partial_r}(av_{||})+bv_{||}{\\partial_z}(av_{||})\\right],\\ ] ] and @xmath155-({\\partial_z}\\widehat{\\rho})\\left[\\frac{cv_{||}}{r}{\\partial_{\\phi}}(av_{||})\\right]+{\\partial_z}(\\widehat{\\rho})(v_{||}^2\\frac{c^2}{r})\\\\ & = -\\frac{f_0}{r^3}v_{||}\\left(\\nabla_{pol } \\widehat{\\rho}\\cdot{\\partial_{\\phi}}(v_{||}\\nabla_{pol } \\psi)\\right)+{\\partial_z}(\\widehat{\\rho})(v_{||}^2\\frac{f_0 ^ 2}{r^3}).\\end{aligned}\\ ] ] we rewrite the term @xmath105 to obtain @xmath156\\\\ & -{\\partial_z}(\\widehat{\\rho})\\left[{\\partial_r}(\\frac12 v_{||}^2a^2+\\frac12 v_{||}^2b^2)+bv_{||}{\\partial_z}(av_{||})-bv_{||}{\\partial_r}(bv_{||})\\right]\\end{aligned}\\ ] ] which is equal to @xmath157-v_{||}\\left[{\\partial_r}(\\widehat{\\rho})a({\\partial_z}(av_{||})-{\\partial_r}(bv_{||}))+{\\partial_z}(\\widehat{\\rho})b({\\partial_z}(av_{||})-{\\partial_r}(bv_{||}))\\right].\\ ] ] we remark that @xmath158 . using this result",
    "we obtain the following expression for @xmath137 : +   + @xmath159-\\frac{v_{||}^2}{r^2 } j [ \\widehat{\\rho},\\psi]-\\frac{v_{||}}{r^2}({\\nabla_{pol}}v_{||}\\cdot { \\nabla_{pol}}\\psi)[\\widehat{\\rho},\\psi]\\\\ & -\\frac{f_0}{r^3}v_{||}({\\nabla_{pol}}\\widehat{\\rho}\\cdot{\\partial_{\\phi}}(v_{||}{\\nabla_{pol}}\\psi))+{\\partial_z}(\\widehat{\\rho})(v_{||}^2\\frac{f_0 ^ 2}{r^3}),\\end{aligned}\\ ] ] with @xmath160 .",
    "+   + now we study the term @xmath161 which is equal to @xmath162\\\\ & + \\widehat{\\rho}{\\partial_r}\\left[a v_{||}{\\partial_r}(b v_{||})+b v_{||}{\\partial_z}(b v_{|| } ) + \\frac{c v_{||}}{r}{\\partial_{\\phi}}(b v_{||})\\right].\\end{aligned}\\ ] ] we split these terms into two terms @xmath163 defined by @xmath164 and @xmath165 .",
    "+   + factorizing the term @xmath166 we obtain @xmath167\\\\   &   -\\widehat{\\rho}\\left[({\\partial_r}(a v_{||})+{\\partial_z}(bv_{|| } ) ) ( { \\partial_z}(a v_{||})-{\\partial_r}(bv_{||}))\\right].\\end{aligned}\\ ] ]   + using that @xmath168 and @xmath169 $ ] we obtain @xmath170-\\frac{\\widehat{\\rho}v_{||}}{r}[\\frac{1}{r}({\\nabla_{pol}}v_{||}\\cdot{\\nabla_{pol}}\\psi),\\psi]\\\\ & -\\frac{\\widehat{\\rho}v_{||}}{r } j [ \\frac{v_{||}}{r},\\psi]-\\frac{\\widehat{\\rho}}{r}({\\nabla_{pol}}v_{||}\\cdot{\\nabla_{pol}}\\psi)[\\frac{v_{||}}{r},\\psi].\\end{aligned}\\ ] ] the properties of the poisson bracket allow to conclude @xmath171-\\widehat{\\rho}[\\frac{v_{||}}{r^2}({\\nabla_{pol}}v_{||}\\cdot{\\nabla_{pol}}\\psi),\\psi].\\ ] ] for the term @xmath172 , some computations allow to obtain the result @xmath173 at the end using the properties of the poisson bracket and the product of derivatives we obtain @xmath174-[\\rho v_{||}({\\nabla_{pol}}v_{||}\\cdot{\\nabla_{pol}}\\psi),\\psi]+\\frac12[\\widehat{\\rho},v_{||}^2|{\\mathbf{b}}_{pol}|^2]\\\\ & -{\\partial_z}\\left(\\widehat{\\rho}\\frac{f_0}{r^3}v_{||}{\\partial_{\\phi}}(v_{||}{\\partial_z}\\psi)\\right)-{\\partial_r}\\left(\\widehat{\\rho}\\frac{f_0}{r^3}v_{||}{\\partial_{\\phi}}(v_{||}{\\partial_r}\\psi)\\right)\\\\ & + { \\partial_z}\\left(\\widehat{\\rho}\\frac{f_0 ^ 2}{r^3}v_{||}^2\\right ) { \\addtocounter{equation}{1}\\tag{\\theequation}}\\label{u12b}.\\end{aligned}\\ ] ] to finish the derivation associated with poloidal velocity , we study the last term @xmath175 .",
    "firstly we note @xmath176{\\mathbf{e}_r}+v_{||}\\left[a{\\partial_r}\\beta + b{\\partial_z}\\beta + \\frac{c}{r}{\\partial_{\\phi}}\\beta\\right]{\\mathbf{e}_z}+v_{||}\\frac{c}{r}\\alpha { \\mathbf{e}_{\\phi}}\\ ] ] and @xmath177{\\mathbf{e}_r}+\\left[\\alpha{\\partial_r}(b v_{||})+\\beta{\\partial_z}(b v_{||})\\right]{\\mathbf{e}_z}+ \\left[\\alpha{\\partial_r}(c v_{||})+\\beta{\\partial_z}(c v_{||})\\right]{\\mathbf{e}_{\\phi}}.\\ ] ] the term @xmath178 can be split into two terms @xmath179 using our notation we obtain that @xmath180 with @xmath181\\\\ &   + { \\partial_r}\\widehat{\\rho } \\left[v_{||}b{\\partial_z}\\beta+\\beta { \\partial_z}(b v_{||})+v_{||}a{\\partial_r}\\beta+\\alpha{\\partial_r}(b v_{||})\\right],\\end{aligned}\\ ] ] and @xmath182 straightforward calculations show that the term @xmath183 is equal to @xmath184 .",
    "now we consider the term @xmath185 which can me rewritten in the following form @xmath186\\\\ & + { \\partial_r}(\\widehat{\\rho } ) \\left [ { \\partial_z}(a v_{||}\\alpha+b v_{||}\\beta ) -v_{||}a { \\partial_z}\\alpha-\\alpha{\\partial_z}(a v_{||})+\\alpha { \\partial_r}(b v_{||})+v_{||}a{\\partial_r}\\beta\\right].\\end{aligned}\\ ] ] using the definition of the different coefficients we obtain that @xmath187+(a3)+(a4)$ ] with @xmath188 now we consider the term @xmath189 which can be factorized in the following way @xmath190 using that @xmath191 we obtain that @xmath192 $ ] and @xmath193 .",
    "+ we known that @xmath194 , consequently at the end we have @xmath195({\\nabla_{pol}}\\psi\\cdot{\\nabla_{pol}}v_{||}+v_{|| } j)$ ] with @xmath196 $ ] . putting all the terms together",
    "we obtain that @xmath197({\\nabla_{pol}}\\psi\\cdot{\\nabla_{pol}}v_{||})-[u,\\widehat{\\rho}]v_{|| } j -[\\widehat{\\rho},v_{||}({\\nabla_{pol}}\\psi\\cdot{\\nabla_{pol}}u)]\\\\ & \\quad+v_{|| } w [ \\widehat{\\rho},u]+\\frac{f_0}{r}v_{||}({\\nabla_{pol}}\\widehat{\\rho}\\cdot{\\nabla_{pol}}({\\partial_{\\phi}}u)).\\end{aligned}\\ ] ] now we consider the term @xmath198 decomposed into two terms @xmath199 with @xmath200\\\\ & \\quad + \\widehat{\\rho}{\\partial_r}\\left[v_{||}a{\\partial_r}\\beta+v_{||}b{\\partial_z}\\beta+\\alpha { \\partial_r}(b v_{||})+\\beta { \\partial_z}(b v_{|| } ) \\right]\\end{aligned}\\ ] ] and @xmath201 we consider the term @xmath202 .",
    "we begin by expending @xmath202 and after rearranging terms we obtain @xmath203.\\end{aligned}\\ ] ] we use that @xmath204 and @xmath205 . using @xmath206",
    "$ ] and @xmath207 $ ] , we write the term @xmath202 in the following form @xmath208+\\widehat{\\rho}r w [ \\frac{v_{||}}{r},\\psi]-r\\widehat{\\rho}[u,\\frac{v_{||}}{r } j ] -\\widehat{\\rho}[u , r]\\frac { v_{||}}{r } j\\\\ = & -r\\widehat{\\rho}[u,\\frac{1}{r}({\\nabla_{pol}}\\psi\\cdot{\\nabla_{pol}}v_{|| } ) ] -\\frac{\\widehat{\\rho}}{r}[u , r]({\\nabla_{pol}}\\psi\\cdot{\\nabla_{pol}}v_{||})\\\\ = & + \\widehat{\\rho}[v_{|| } w,\\psi]-\\widehat{\\rho}[u , v_{|| } j ] -\\widehat{\\rho}[u,({\\nabla_{pol}}\\psi\\cdot{\\nabla_{pol}}v_{||})].\\end{aligned}\\ ] ] the term @xmath209 is equal to @xmath210 , consequently we obtain @xmath211-\\widehat{\\rho}[u , v_{|| } j]-\\widehat{\\rho}[u,({\\nabla_{pol}}\\psi\\cdot{\\nabla_{pol}}v_{||})]+\\widehat{\\rho } r\\nabla.(\\frac{f_0}{r^2}v_{||}{\\nabla_{pol}}({\\partial_{\\phi}}u)).\\ ] ] all together we have derived the following term @xmath212+[\\widehat{\\rho}v_{|| } w,\\psi]-[u,\\widehat{\\rho}v_{|| } j ] \\\\ & -[u,\\widehat{\\rho}({\\nabla_{pol}}\\psi\\cdot{\\nabla_{pol}}v_{||})]+ r\\nabla\\cdot\\left(\\widehat{\\rho}\\frac{f_0}{r^2}v_{||}{\\nabla_{pol}}({\\partial_{\\phi}}u)\\right ) .",
    "{ \\addtocounter{equation}{1}\\tag{\\theequation}}\\label{u13b}\\end{aligned}\\ ] ]      for the thermodynamic equations @xmath213 and",
    "@xmath214 , we propose to rewrite the equations in order to obtain a dependency on @xmath37 and @xmath38 .",
    "we begin with @xmath215\\\\ = & -r({\\partial_z}u)({\\partial_r}\\rho)+r({\\partial_r}u)({\\partial_z}\\rho)=-r[\\rho , u].\\end{aligned}\\ ] ] then we compute the second term @xmath216 : @xmath217 now we derive the term associated to the parallel velocity @xmath218 : @xmath219\\cdot\\nabla \\rho\\\\   & = v_{||}\\frac{f_0}{r^2}{\\partial_{\\phi}}\\rho + \\frac{1}{r}v_{||}[\\rho,\\psi].\\end{aligned}\\ ] ] the second term is @xmath220\\\\   & = \\frac { \\rho}{r}[v_{||},\\psi]+\\frac{\\rho f_0}{r^2}{\\partial_{\\phi}}v_{||}.\\end{aligned}\\ ] ] consequently we obtain @xmath221 + 2\\rho { \\partial_z}u-\\frac{v_{|| } f_0}{r^2}{\\partial_{\\phi}}\\rho-\\frac{v_{||}}{r}[\\rho,\\psi]-\\frac { \\rho}{r}[v_{||},\\psi]-\\frac{\\rho f_0}{r^2}{\\partial_{\\phi}}v_{||}\\ ] ] and @xmath222 + 2\\gamma p { \\partial_z}u-\\frac{v_{|| } f_0}{r^2}{\\partial_{\\phi}}p-\\frac{v_{||}}{r}[p,\\psi]-\\frac{\\gamma p}{r}[v_{||},\\psi]-\\frac{\\gamma p f_0}{r^2}{\\partial_{\\phi}}v_{||}.\\ ] ]      we consider the equation @xmath223 . to obtain the equation on @xmath38 we project the momentum equation applying the operator @xmath224 .",
    "firstly we remark that @xmath225 .",
    "secondly we consider @xmath226 .",
    "using the definition of @xmath22 we prove that the term @xmath227 ) is equal to @xmath228 for the poloidal term @xmath229 , straightforward computations show that this term is given by @xmath230 for the pressure term @xmath231 , we obtain @xmath232.\\ ] ] now we consider the following terms ( the four last terms which are neglected in the model implemented in the code jorek ) : @xmath233 firstly we study @xmath234 . for this we note @xmath235 with @xmath236 , @xmath237 and @xmath151",
    ". using these notations we obtain @xmath238 now we rewrite the term as @xmath239 , where @xmath240 is given by @xmath241+\\\\ & = \\rho \\frac{f_0}{2 r^2}{\\partial_{\\phi}}\\left(v_{||}^2 a^2+v_{||}^2 b^2+v_{||}^2 c^2\\right ) = \\rho \\frac{f_0}{r^2}{\\partial_{\\phi}}\\left(\\frac{v_{||}^2|{\\mathbf{b}}|^2}{2}\\right).\\end{aligned}\\ ] ] the term @xmath242 is given by @xmath243\\\\ & = b\\rho { \\partial_z}\\frac12\\left(v_{||}^2 a^2+v_{||}^2 b^2+v_{||}^2 c^2\\right ) = -\\frac{\\rho}{r}{\\partial_r}\\psi { \\partial_z}\\left(\\frac{v_{||}^2|{\\mathbf{b}}|^2}{2}\\right).\\end{aligned}\\ ] ] the term @xmath244 is given by @xmath245\\\\ & = a \\rho { \\partial_r}\\frac12\\left(v_{||}^2 a^2+v_{||}^2 b^2+v_{||}^2 c^2\\right ) = \\frac{\\rho}{r}{\\partial_z}\\psi { \\partial_r}\\left(\\frac{v_{||}^2|{\\mathbf{b}}|^2}{2}\\right).\\end{aligned}\\ ] ] at the end we obtain @xmath246+\\rho\\frac{f_0}{r^2}{\\partial_{\\phi}}\\left(\\frac{v_{||}^2|{\\mathbf{b}}|^2}{2}\\right).\\ ] ] now we propose to study the fourth term @xmath247 .",
    "to estimate this term we define @xmath127 and @xmath128 .",
    "using this notation we prove that @xmath130 using the definitions of the coefficients we obtain @xmath248 which is equal to @xmath249 to obtain @xmath250+\\frac{\\rho}{r}\\left[{\\partial_z}(\\psi)\\beta({\\partial_z}\\alpha-{\\partial_r}\\beta)+{\\partial_r}(\\psi)\\alpha({\\partial_z}\\alpha-{\\partial_r}\\beta)\\right].\\ ] ] after straightforward computations we obtain @xmath251+\\rho r w [ \\psi , u].\\ ] ] now we consider the term @xmath252 . to estimate this term we define @xmath253 , @xmath254 , @xmath236 , @xmath237 and @xmath151 .",
    "consequently we obtain @xmath255 using these notations we obtain @xmath256{\\mathbf{e}_r}\\\\   & + \\rho[\\alpha { \\partial_r}(v_{||}b)+\\beta { \\partial_z}(v_{||}b)]{\\mathbf{e}_z}+\\rho[\\alpha { \\partial_r}(v_{||}c)+\\beta { \\partial_z}(v_{||}c)]{\\mathbf{e}_{\\phi}},\\end{aligned}\\ ] ] consequently @xmath257\\\\ & + \\rho b[\\alpha { \\partial_r}(v_{||}b)+\\beta { \\partial_z}(v_{||}b)]+\\rho c[\\alpha { \\partial_r}(v_{||}c)+\\beta { \\partial_z}(v_{||}c)].\\end{aligned}\\ ] ] rearranging terms we obtain @xmath258 using that @xmath259 we obtain that @xmath260+r\\rho v_{||}[u,\\frac{|{\\mathbf{b}}|^2}{2}].\\ ] ] to finish we consider the term @xmath261 .",
    "we define @xmath262 and @xmath263 . using these definitions",
    "we obtain @xmath264+b\\left[a{\\partial_r}\\beta + b{\\partial_z}\\beta + \\frac{c}{r}{\\partial_{\\phi}}\\beta\\right]+\\frac{c^2}{r}\\alpha,\\\\ & = a\\left[a{\\partial_r}\\alpha + b{\\partial_z}\\alpha\\right]+b\\left[a{\\partial_r}\\beta + b{\\partial_z}\\beta\\right ] + \\frac{ac}{r}{\\partial_{\\phi}}\\alpha+\\frac{bc}{r}{\\partial_{\\phi}}\\beta+\\frac{c^2}{r}\\alpha.\\end{aligned}\\ ] ] now we consider the first term @xmath265 . for this we rewrite the term in the following form @xmath266 we define @xmath267 and @xmath268 .",
    "we can rewrite the term @xmath269 in the following form @xmath270 we obtain @xmath271+\\frac{j}{r}[u,\\psi]\\ ] ] straightforward computations show that @xmath272 $ ] .",
    "the term @xmath142 is given by @xmath273 .",
    "now we consider the term @xmath274 and it is easy to prove that + @xmath275 . at the end we obtain @xmath276+\\rho v_{||}\\frac{j}{r}[u,\\psi]+\\frac{\\rho v_{||}}{r}[\\psi,({\\nabla_{pol}}\\psi\\cdot { \\nabla_{pol}}u)]\\\\ & \\quad -\\frac{\\rho v_{||}f_0}{r^2}({\\nabla_{pol}}\\psi\\cdot { \\nabla_{pol}}({\\partial_{\\phi}}u))-\\rho v_{||}\\frac{f_0 ^ 2}{r^2}{\\partial_z}u.{\\addtocounter{equation}{1}\\tag{\\theequation}}\\label{vp6}\\end{aligned}\\ ] ]      we define the magnetic and velocity fields by @xmath277 and @xmath278 .",
    "using all the equations ( [ psifinal ] ) , ( [ u2],[u3],[u5],[u6],[u8],[u12],[u13 ] ) , ( [ rho ] ) , ( [ t ] ) , ( [ dtvpar1],[dtvpar2],[vp1],[vp3],[vp4],[vp5],[vp6 ] ) based on these definitions of the fields and the definition of the toroidal current and poloidal vorticity , we obtain the final reduced mhd model with parallel velocity . @xmath279+\\frac{\\eta}{r^2}\\left(j",
    "+ \\frac{\\partial_{\\phi\\phi } \\psi}{r^2}\\right)-\\frac{1}{r^2}f_0{\\partial_{\\phi}}u,\\\\ \\\\ \\\\ { \\displaystyle}\\nabla \\cdot(\\widehat{\\rho}\\nabla_{pol } { \\partial_t}u ) -\\nabla \\cdot ( \\rho { \\partial_t}(v_{||}{\\nabla_{pol}}\\psi))=\\frac{1}{2r}[r^2|\\nabla_{pol}u|^2,\\widehat{\\rho}]+\\frac{1}{r}[\\widehat{\\rho } r^2w , u]-\\frac{1}{r}[r^2,p]+\\frac{1}{r}[\\psi , j]-\\frac{f_0}{r^2}{\\partial_{\\phi}}j\\\\ \\\\ { \\displaystyle}+\\nabla\\cdot ( \\nu_{perp}\\nabla w)+\\frac{1}{r}[\\rho v_{||}^2 j,\\psi]+\\frac{1}{r}[\\rho v_{||}({\\nabla_{pol}}v_{||}\\cdot{\\nabla_{pol}}\\psi),\\psi]- \\nabla \\cdot \\left(\\widehat{\\rho}\\frac{f_0}{r^2}v_{||}\\nabla_{pol } ( { \\partial_{\\phi}}u)\\right)\\\\ \\\\ { \\displaystyle}+\\frac{1}{r}[\\widehat{\\rho},v_{||}({\\nabla_{pol}}\\psi\\cdot{\\nabla_{pol}}u)]-\\frac{1}{2r}[\\widehat{\\rho},v_{||}^2|{\\mathbf{b}}_{pol}|^2]-\\frac{1}{r}[\\widehat{\\rho}v_{|| } w,\\psi]+\\frac{1}{r}[u,\\widehat{\\rho}v_{|| } j ] + \\frac{1}{r}[u,\\widehat{\\rho}({\\nabla_{pol}}\\psi\\cdot { \\nabla_{pol}}v_{||})]\\\\ \\\\ { \\displaystyle}+\\frac{1}{r}{\\partial_z}\\left(\\widehat{\\rho}\\frac{f_0}{r^3}v_{||}{\\partial_{\\phi}}(v_{||}{\\partial_z}\\psi)\\right)+\\frac{1}{r}{\\partial_r}\\left(\\widehat{\\rho}\\frac{f_0}{r^3}v_{||}{\\partial_{\\phi}}(v_{||}{\\partial_r}\\psi)\\right)-\\frac{1}{r}{\\partial_z}\\left(\\widehat{\\rho}\\frac{f_0 ^ 2}{r^3 } v_{||}^2\\right ) , \\\\",
    "\\\\ { \\displaystyle}w={\\triangle_{pol}}u,\\\\ \\\\ \\\\ { \\displaystyle}j={\\triangle^{*}}\\psi,\\\\ \\\\ \\\\ { \\displaystyle}{\\partial_t}\\rho = r[\\rho , u]+2\\rho { \\partial_z}u-\\frac{v_{|| } f_0}{r^2}{\\partial_{\\phi}}\\rho-\\frac{v_{||}}{r}[\\rho,\\psi]-\\frac { \\rho}{r}[v_{||},\\psi]-\\frac{\\rho f_0}{r^2}{\\partial_{\\phi}}v_{||},\\\\ \\\\ \\\\ { \\displaystyle}{\\partial_t}p = r[p , u]+2\\gamma p { \\partial_z}u-\\frac{v_{|| } f_0}{r^2}{\\partial_{\\phi}}p-\\frac{v_{||}}{r}[p,\\psi]-\\frac{\\gamma p}{r}[v_{||},\\psi]-\\frac{\\gamma p f_0}{r^2}{\\partial_{\\phi}}v_{||},\\\\ \\\\ \\\\",
    "\\rho|{\\mathbf{b}}^2|{\\partial_t}v_{||}+\\rho v_{||}\\frac{1}{r^2}{\\nabla_{pol}}\\psi \\cdot{\\nabla_{pol}}({\\partial_t}\\psi)-\\rho{\\nabla_{pol}}\\psi\\cdot { \\nabla_{pol}}({\\partial_t}u)=-\\frac{1}{r}[p,\\psi]-\\frac{f_0}{r^2}{\\partial_{\\phi}}p+\\frac{\\rho } { r}[\\psi,\\frac{v_{||}^2|{\\mathbf{b}}|^2}{2}]\\\\ \\\\ { \\displaystyle}-\\frac{f_0}{r}\\rho { \\partial_{\\phi}}\\left(\\frac{v_{||}^2|{\\mathbf{b}}|^2}{2r}\\right)-\\frac{1}{2r}\\rho[r^2|\\nabla_{pol}u|^2,\\psi]-\\frac{\\widehat{\\rho}}{r } w [ \\psi , u]-r\\rho|{\\mathbf{b}}|^2[u , v_{||}]-r\\rho v_{||}[u,\\frac{|{\\mathbf{b}}|^2}{2}]+r\\rho v_{||}[u,\\frac{|{\\mathbf{b}}_{pol}|^2}{2}]\\\\",
    "\\\\ { \\displaystyle}-\\rho v_{||}\\frac{{\\triangle^{*}}\\psi}{r}[u,\\psi]-\\frac{\\rho v_{||}}{r}[\\psi,({\\nabla_{pol}}\\psi\\cdot { \\nabla_{pol}}u)]+\\frac{\\rho v_{||}f_0}{r^2}({\\nabla_{pol}}\\psi\\cdot { \\nabla_{pol}}({\\partial_{\\phi}}u))+\\rho v_{||}\\frac{f_0 ^ 2}{r^2}{\\partial_z}u.\\end{array}\\right.\\ ] ] in our derivation we have not treated the viscosity term @xmath280 .",
    "this term in the resistive mhd is not really physical .",
    "this a very simple approximation of the stress tensor in the fluid model , which is physically justified for a gas but not for a magnetized plasma in a tokamak .",
    "it is used in jorek to model somewhat the effect of the stress tensor , dissipate the energy and stabilize the system . for this reason",
    ", we propose to use a simple viscosity in the poloidal velocity equation given by @xmath281 rather than compute the reduced viscosity associated to the viscosity @xmath280 .",
    "we will discuss the effects of this simplification on the total energy later .",
    "for the full mhd model the total energy is conserved in the ideal case and dissipated in the resistive case . to validate the derivation of the model , to validate the choice of the projection operators and to obtain the stability results , which are important for the numerical methods we prove that the reduced mhd model satisfies an energy balance equation compatible with the energy balance associated with full mhd model @xcite-@xcite . before the energy estimate",
    "we introduce the natural dirirchlet and neumann boundary conditions @xcite given by @xmath282 with @xmath283 the outgoing normal to the domain .",
    "we can also use the boundary conditions @xmath284 these two boundary conditions are relatively close ( see @xcite ) .",
    "we define the energy @xmath285.we assume that the boundary conditions are given by ( [ bc ] ) . if @xmath286 the total energy satisfies @xmath287 and if @xmath288 and @xmath289 @xmath290    to begin we compute @xmath291 .",
    "we obtain @xmath292 after straightforward computations we shows that the derivative of the energy is given by @xmath293 the term @xmath294 is equal to @xmath295 . integrating by parts we obtain @xmath296 using an integration by parts we also obtain @xmath297 consequently @xmath298 using @xmath299 $ ] , we obtain @xmath300+\\frac{\\rho}{r}[r^2,u]-\\frac{v_{|| } f_0}{r^2}{\\partial_{\\phi}}\\rho-\\frac{v_{||}}{r}[\\rho,\\psi]-\\frac { \\rho}{r}[v_{||},\\psi]-\\frac{\\rho f_0}{r^2}{\\partial_{\\phi}}v_{||}.\\ ] ] before computing the energy estimate we give an equation on @xmath301 . for @xmath301",
    "we multiply by @xmath302 the equation on @xmath1 .",
    "we obtain @xmath303 + 2\\widehat{\\rho}{\\partial_z}u+r[\\psi,\\rho v_{||}]-f_0{\\partial_{\\phi}}(\\rho v_{||})\\\\ = & r[\\widehat{\\rho},u]-\\frac{\\widehat{\\rho}}{r}[r^2,u]+2\\widehat{\\rho}{\\partial_z}u+r[\\psi,\\rho v_{||}]-f_0{\\partial_{\\phi}}(\\rho v_{||}).\\end{aligned}\\ ] ] using that @xmath304 $ ] , we obtain @xmath305+r[\\psi,\\rho v_{||}]-f_0{\\partial_{\\phi}}(\\rho v_{||}),\\ ] ] which is equal to @xmath305+r\\rho[\\psi , v_{||}]+r v_{||}[\\psi,\\rho ] -f_0\\rho{\\partial_{\\phi}}v_{||}-f_0v_{||}{\\partial_{\\phi}}\\rho.\\ ] ] to compute @xmath306 we add to the final model three equations on the density : @xmath307-\\frac{v_{||}^2|{\\mathbf{b}}|^2}{2}\\frac { f_0}{r^2}{\\partial_{\\phi}}(\\rho v_{||})-\\frac{v_{||}^2|{\\mathbf{b}}|^2}{2}\\frac{1}{r}[\\rho v_{||},\\psi],\\\\ \\\\ { \\displaystyle}v_{||}({\\nabla_{pol}}u\\cdot{\\nabla_{pol}}\\psi){\\partial_t}\\rho=\\frac{v_{||}}{r}({\\nabla_{pol}}u\\cdot{\\nabla_{pol}}\\psi)[\\widehat{\\rho},u]-v_{||}({\\nabla_{pol}}u\\cdot{\\nabla_{pol}}\\psi)\\frac { f_0}{r^2}{\\partial_{\\phi}}(\\rho v_{||})-v_{||}({\\nabla_{pol}}u\\cdot{\\nabla_{pol}}\\psi)\\frac{1}{r}[\\rho v_{||},\\psi],\\\\ \\\\ { \\displaystyle}\\frac{|\\nabla_{pol } u|^2}{2}{\\partial_t}\\widehat{\\rho}=\\frac{|\\nabla_{pol } u|^2}{2}r[\\widehat{\\rho},u]-\\frac{|\\nabla_{pol } u|^2}{2}f_0{\\partial_{\\phi}}(\\rho v_{||})-\\frac{|\\nabla_{pol } u|^2}{2}r[\\rho v_{||},\\psi].\\end{array}\\right.\\ ] ] now we compute @xmath308 the derivative in time @xmath306 can by writing as the sum of 18 groups of terms : @xmath309 .",
    "now we propose to prove that each group of terms is equal to zero or negative : @xmath310 j dw-\\int_{\\omega}\\frac{1}{r}[\\psi , j]u dw=-\\int_{\\omega}([\\psi , u ] j+[\\psi , j]u ) dv=0,\\\\ ( e2 ) & = -\\int_{\\omega}\\frac{f_0}{r^2}{\\partial_{\\phi}}(u ) j dw+\\int_{\\omega}\\frac{f_0}{r^2}{\\partial_{\\phi}}(j ) u dw=\\int_{\\omega}\\frac{f_0}{r}({\\partial_{\\phi}}(u ) j+ { \\partial_{\\phi}}(j)u ) dv=0.\\end{aligned}\\ ] ] these results are obtained by integration by parts and using the assumptions on the boundary conditions ( [ bc ] ) .",
    "now we study the term @xmath311 : @xmath312u dw=-\\int_{\\omega}[\\widehat{\\rho}r^2 w , u]u dv=\\int_{\\omega}[u , u]\\widehat{\\rho}r^2 w dv=0.\\ ] ] the term @xmath313 corresponds to the viscosity and resistivity terms : @xmath314 to obtain this result we use @xmath73 and a double integrating by parts .",
    "now we define the term @xmath315 which depends on the pressure .",
    "dw+\\frac{1}{\\gamma-1}\\int_{\\omega}r[p , u]dw+\\frac{2\\gamma}{\\gamma-1}\\int_{\\omega}p { \\partial_z}u dw.\\ ] ] using @xmath317 $ ] and integrating by parts we obtain @xmath318u dv+\\frac{1}{\\gamma-1}\\int_{\\omega}r^2[p , u]dv+\\frac{\\gamma}{\\gamma-1}\\int_{\\omega}p [ r^2,u ] dv.\\\\ ( e5 ) & = -\\int_{\\omega}[r^2,u]p dv-\\frac{1}{\\gamma-1}\\int_{\\omega}p[r^2,u]dv+\\frac{\\gamma}{\\gamma-1}\\int_{\\omega}p [ r^2,u ] dv=0.\\end{aligned}\\ ] ] now we study the terms @xmath319 and @xmath320 . in these two cases using integration by parts and the anti - symmetric properties of bracket operator we conclude .",
    "@xmath321u dw+\\int_{\\omega}\\frac{|\\nabla_{pol } u|^2}{2}r[\\widehat{\\rho},u]dw,\\\\   & = -\\int_{\\omega}\\frac{1}{2}[r^2|\\nabla_{pol } u|^2,\\widehat{\\rho}]u dv-\\int_{\\omega}u[\\widehat{\\rho},\\frac{|\\nabla_{pol } u|^2}{2}r^2]dv=0,\\end{aligned}\\ ] ] @xmath322u dv-\\int_{\\omega}\\frac{\\widehat{\\rho}}{r}w [ \\psi , u]v_{||}dw.\\\\ = & -\\int_{\\omega}\\widehat{\\rho}v_{||}w [ u,\\psi ] dv-\\int_{\\omega}\\widehat{\\rho } w [ \\psi , u]v_{||}dv=0.\\end{aligned}\\ ] ] the term @xmath323 correspond to the coupling between the pressure and the parallel velocity @xmath38 .",
    "we obtain @xmath324dw-\\frac{\\gamma}{\\gamma-1}\\int_{\\omega}\\gamma\\frac{p}{r}[v_{||},r]dw\\\\ & \\quad -\\frac{\\gamma}{\\gamma-1}\\int_{\\omega}\\frac{f_0}{r^2}p({\\partial_{\\phi}}v_{||})dw-\\int_{\\omega}\\frac{f_0v_{||}}{r^2}({\\partial_{\\phi}}p)dw-\\int_{\\omega}\\frac{v_{||}}{r}[p,\\psi]dw.\\end{aligned}\\ ] ] integrating by parts the terms which depend on @xmath325 and factorizing we obtain that @xmath326 . the term @xmath327 is defined by @xmath328dw+\\int_{\\omega}\\frac{\\rho v_{||}}{r}[\\psi,\\frac{v_{||}^2|{\\mathbf{b}}_{pol}|^2}{2}]dw\\\\ & \\quad -\\int_{\\omega}\\frac{v_{||}^2|{\\mathbf{b}}_{pol}|^2}{2}\\frac{f_0}{r^2}{\\partial_{\\phi}}(\\rho v_{||})dw-\\int_{\\omega}\\frac{f_0}{r^2}\\rho v_{||}{\\partial_{\\phi}}\\left(\\frac{v_{||}^2|{\\mathbf{b}}_{pol}|^2}{2}\\right)dw.\\end{aligned}\\ ] ] integrating by parts we obtain @xmath329+[\\frac{v_{||}^2|{\\mathbf{b}}_{pol}|^2}{2},\\psi]\\right)dv\\\\ & \\quad + \\int_{\\omega}\\frac{f_0}{r}\\rho v_{||}{\\partial_{\\phi}}\\left(\\frac{v_{||}^2|{\\mathbf{b}}_{pol}|^2}{2}\\right)dv-\\int_{\\omega}\\frac{f_0}{r}\\rho v_{||}{\\partial_{\\phi}}\\left(\\frac{v_{||}^2|{\\mathbf{b}}_{pol}|^2}{2}\\right)dv=0.\\end{aligned}\\ ] ] the term @xmath330 is defined by @xmath331dw-\\int_{\\omega}\\frac{1}{2r}\\rho v_{||}[r^2|\\nabla_{pol } u|^2,\\psi]dw.\\ ] ] we apply the classical integration to conclude ( e10)=0 .",
    "now we study the term @xmath332",
    "@xmath333u dw-\\int_{\\omega}\\frac{1}{r}[u,\\widehat{\\rho}({\\nabla_{pol}}\\psi\\cdot{\\nabla_{pol}}v_{||})]u dw.\\ ] ] to conclude we use the integration by parts and the fact that @xmath334=0 $ ] .",
    "the term @xmath335 depends of the toroidal direction @xmath336 using that @xmath337 and integrating by parts the second term we conclude .",
    "the term @xmath338 also depends on the toroidal derivative .",
    "it is defined by @xmath339 we integrate by parts the first term and expand this term , we integrate by parts the second one to obtain @xmath340 to conclude we expand the third term @xmath341 in two terms @xmath342 and @xmath343 .",
    "the sum of the five terms obtained is equal to zero .",
    "now we introduce the terms @xmath344 and @xmath345 .",
    "@xmath346u dw-\\int_{\\omega}\\frac{1}{r}v_{||}({\\nabla_{pol}}u\\cdot{\\nabla_{pol}}\\psi)[\\widehat{\\rho},u]dw,\\\\ ( e15 ) & = -\\int_{\\omega}\\frac{1}{r}[\\rho v_{||}^2 { \\triangle^{*}}\\psi,\\psi]u dw-\\int_{\\omega}\\rho v_{||}\\frac{{\\triangle^{*}}\\psi}{r}[u,\\psi]dw.\\end{aligned}\\ ] ] a integration by parts of the first term is sufficient to prove that @xmath344 and @xmath345 are equal to zero .",
    "the term ( e16 ) is defined by @xmath347u dw+\\int_{\\omega}\\frac{v_{||}^2|{\\mathbf{b}}|^2}{2r}[\\widehat{\\rho},u ] dw\\\\ & -\\int_{\\omega}r\\rho v_{||}^2[u,\\frac{|{\\mathbf{b}}|^2}{2}]dw-\\int_{\\omega}r\\rho v_{||}\\frac{f_0}{r^2}[u , v_{||}]dw+\\int_{\\omega}r\\rho v_{||}^2[u,\\frac{|{\\mathbf{b}}_{pol}|^2}{2}]dw.\\end{aligned}\\ ] ] the fourth term of @xmath348 is the toroidal part of the term @xmath349 $ ] in the parallel velocity equation .",
    "now we split @xmath348 between two terms @xmath350 and @xmath351 .",
    "@xmath350 is defined by @xmath352u dw+\\int_{\\omega}v_{||}^2\\frac{|{\\mathbf{b}}_{pol}|^2}{2r}[\\widehat{\\rho},u]dw\\\\ & -\\int_{\\omega}r\\rho v_{||}^2 [ u,\\frac{|{\\mathbf{b}}_{pol}|^2}{2}]dw+\\int_{\\omega}r\\rho v_{||}^2 [ u,\\frac{|{\\mathbf{b}}_{pol}|^2}{2}]dw.\\end{aligned}\\ ] ] this term is equal to zero ( integrating by parts the first term is sufficient to prove this ) .",
    "the @xmath351 is defined by @xmath353dw-\\int_{\\omega}r\\rho v_{||}^2[u,\\frac{f_0 ^ 2}{2r^2}]dw -\\int_{\\omega}r\\rho v_{||}\\frac{f_0 ^ 2}{r^2}[u , v_{||}]dw\\ ] ] we rewrite the term @xmath351 to obtain @xmath354dv-\\int_{\\omega}\\widehat{\\rho } v_{||}^2[u,\\frac{f_0 ^ 2}{2r^2}]dv\\\\ & -\\int_{\\omega}\\widehat{\\rho } v_{||}\\frac{f_0 ^ 2}{2r^2}[u , v_{||}]dv-\\int_{\\omega}\\widehat{\\rho } v_{||}\\frac{f_0 ^ 2}{2r^2}[u , v_{||}]dv\\end{aligned}\\ ] ] we combine the second and third terms and use the anti - symmetry property of the bracket for the fourth term .",
    "we obtain @xmath355dv+\\int_{\\omega}v_{||}^2\\frac{f_0 ^ 2}{2r^2}[\\widehat{\\rho},u]dv+\\int_{\\omega}\\widehat{\\rho } v_{||}\\frac{f_0 ^ 2}{2r^2}[v_{||},u]dv.\\ ] ] now we combine the two last terms and we use anti - symmetric property of the bracket in the first to obtain @xmath356dv+\\int_{\\omega}v_{||}\\frac{f_0 ^ 2}{2r^2}[\\widehat{\\rho}v_{||},u]dv=0.\\ ] ] the result is obtained using an integration by parts .",
    "the last @xmath357 is given by @xmath358 u dw+\\int_{\\omega}\\frac{1}{r}v_{||}({\\nabla_{pol}}u\\cdot{\\nabla_{pol}}v_{||})[\\rho v_{||},\\psi]dw,\\\\ & -\\int_{\\omega}\\frac{1}{r}\\rho v_{||}^2[\\psi,({\\nabla_{pol}}\\psi\\cdot{\\nabla_{pol}}u)]dw-\\int_{\\omega}r\\rho|{\\mathbf{b}}_{pol}|^2[u , v_{||}]v_{||}dw.\\end{aligned}\\ ] ] firstly @xmath359v_{||}=\\frac{\\rho}{r}({\\nabla_{pol}}\\psi\\cdot{\\nabla_{pol}}\\psi)v_{||}[u , v_{||}]$ ] , secondly we have the identity @xmath360=({\\nabla_{pol}}\\psi\\cdot{\\nabla_{pol}}\\psi)[u , v_{||}]+({\\nabla_{pol}}u\\cdot{\\nabla_{pol}}\\psi)[v_{||},\\psi].\\ ] ] using these two identities we obtain @xmath361dv-\\int_{\\omega}\\rho v_{||}^2[({\\nabla_{pol}}u\\cdot{\\nabla_{pol}}\\psi),\\psi]dv\\\\ & -\\int_{\\omega}\\rho v_{||}({\\nabla_{pol}}u\\cdot{\\nabla_{pol}}\\psi)[v_{||},\\psi]dv- \\int_{\\omega}\\rho v_{||}^2[\\psi,({\\nabla_{pol}}u\\cdot{\\nabla_{pol}}\\psi)]dv\\\\ & -\\int_{\\omega}\\rho v_{||}({\\nabla_{pol}}\\psi\\cdot{\\nabla_{pol}}\\psi)[u , v_{||}]dv.\\end{aligned}\\ ] ] the sum of second and fourth terms is equal to zero ( anti - symmetry property of the bracket ) .",
    "the sum of the other terms is equal to zero ( second identity ) .",
    "to finish the proof we compute @xmath362 defined by @xmath363 this term is equal to zero because the sum of the two terms is also equal to zero ( using a integration by parts ) .",
    "this last result concludes the proof .",
    "this result proves that the physical energy associated with the reduced mhd system is conserved in the ideal case ( @xmath364 ) as for the full mhd case and dissipated in the resistive case . as for the full mhd case the dissipation",
    "is linked to the vorticity and the current .",
    "however the dissipation terms are not exactly the same in the reduced and full mhd . in the part of the dissipation which depends on the resistive terms , we have the square of the current for the full mhd and the square of the toroidal current of the reduced mhd . consequently during the reduction the poloidal current disappears ( we can explain this by the choice of the projections during the reduction ) .",
    "the ordering proposed in the physics papers show that the poloidal current is smaller than the toroidal current , consequently it is logical that the reduction kills the effects of this part . in the part of the dissipation which depends on the viscous terms we observe that the part linked to compressibility ( divergence of @xmath20 ) and the parallel vorticity disappears . at the end",
    "we conserve only the dissipation associated with the poloidal vorticity .",
    "finally , in the ideal case the reduced model conserves the energy as for the full mhd problem and in the resistive and viscous cases the reduced model dissipates energy with decay terms that are relatively close to the decay terms of the dissipation of the full mhd .",
    "first this result validates the reduced model since we obtain two consistent energy balance estimates associated to the full and reduced mhd models .",
    "secondly the dissipation result is useful to verify at the mathematical level that the model is well - posed .",
    "for example in @xcite-@xcite the authors explain and detail the key role of the energy balance to prove the existence of weak solutions .",
    "finally , this energy estimate is very important to ensure the numerical stability of the schemes . indeed a way to ensure the stability is to design a numerical method which dissipates the energy at the discrete level and we can not obtain this stability property a similar energy dissipation on the continuous model .",
    "let us make a first remark about the resistive term @xmath365 , which is the poloidal current neglected in the jorek code . with or without this term",
    "we have a model which conserves energy in the ideal case and dissipate the energy in the resistive case . and a second remark about the other invariant of the mhd .",
    "the classical full mhd admits other quantities , which are conserved .",
    "the first invariant is the mass conservation .",
    "when we have written the equation on the density we have plugged our reduced velocity field and never used an approximation . consequently we can write the density equation in a conservative form and obtain the mass conservation .",
    "the second invariant is the cross helicity which is conserved only in the incompressible case . in our case",
    "we assume that the flow is compressible consequently the cross helicity may not be conserved . after it is not clear that the balance law for the cross helicity is the same for the reduced and the full mhd .",
    "the last one is the magnetic helicity ( conserved only when the resistivity is equal to zero ) defined by @xmath366 with @xmath367 the vector potential given by @xmath368 consequently the equation on the magnetic helicity is the equation on @xmath69 . now using the same boundary conditions that before we obtain @xmath369dv - f_0\\int\\frac{f_0}{r}{\\partial_{\\phi}}u dv\\\\ = & f_0\\int_{\\omega}({\\partial_r}(\\psi{\\partial_z}u)-{\\partial_z}(\\psi{\\partial_r}u))dv - f_0\\int\\frac{f_0}{r}{\\partial_{\\phi}}u dv\\\\ = & f_0\\int_{\\partial \\omega}\\psi \\nabla_{pol}u \\cdot\\mathbf{n } dv - f_0\\int\\frac{f_0}{r}{\\partial_{\\phi}}u dv=0\\end{aligned}\\ ] ] consequently the magnetic helicity is conserved .",
    "in the jorek code , different discretization methods are applied for the toroidal direction and the poloidal plane . for the toroidal direction we use a classical fourier expansion .",
    "this discretization is easy to implement but generates a large matrix . using a fast fourier transformation ( fft )",
    "we obtain a faster algorithm to construct the matrix and the right hand side than the classical loop used to assemble the matrix and the right hand side . for the poloidal plane we use a classical finite element method with numerical viscosity to stabilize the method .",
    "the elements chosen are cubic bezier elements which allow to guarantee @xmath370 continuity useful to discretize the fourth order operators and preserve the free divergence constraints .",
    "however this @xmath370 reconstruction is not guaranteed for the grid center and for the x - point .",
    "because of the higher continuity requirement , these elements need only 4 degrees of freedom per grid node compared to the lagrangian @xmath371 cubic element , which needs 9 degrees of freedom by grid node .",
    "another advantage comes from the isoparametric formulation .",
    "indeed we can discretize the geometrical quantities like @xmath53 and @xmath55 with bezier splines .",
    "this property allows to construct the grid aligned with the magnetic surfaces easily .",
    "the details about the discretization using bezier elements are given in @xcite .",
    "in this section we explain the time discretization originally used in jorek and the preconditioning used for the linear solver .",
    "the different models implemented in the jorek code ( with or without parallel velocity ) can be written in the following form @xmath372 with @xmath142 and @xmath137 discrete nonlinear differential operators and @xmath373 . for the time discretization",
    "we use the classical crank nicholson or a gear second order scheme allowing to write the time scheme in the following form @xmath374 with @xmath375 and @xmath376 the parameters of the scheme .",
    "if @xmath377 and @xmath378 we obtain the implicit euler scheme , if @xmath378 and @xmath379 we obtain the crank - nicholson scheme and if @xmath380 and @xmath381 we obtain the gears scheme .",
    "these implicit schemes do not preserve the decay of the discrete time energy , because the system is too nonlinear .",
    "finding an accurate time scheme with this property is an interesting problem for the future .",
    "now we define two nonlinear vectors @xmath382 and @xmath383 . at the end",
    "we want to solve the following nonlinear system @xmath384 a first order linearization is applied in the original code to obtain the following linear system @xmath385 with @xmath386 and the jacobian @xmath387 .",
    "to solve this system we use the classical gmres method with left preconditioning @xcite .",
    "the principle of the left preconditioning is to replace the solver @xmath388 by @xmath389 .",
    "the last system can be split between two steps .",
    "first we solve exactly @xmath390 and then we solve with the gmres method @xmath391 it is necessary to obtain the final algorithm that the preconditioning matrix @xmath392 is invertible .",
    "the idea currently followed in the code is to write the jacobian by block , each block corresponding to the coupling terms between two fourier modes . under the assumption of weak coupling it is possible to eliminate the non diagonal blocks .",
    "we obtain a diagonal block matrix where the blocks correspond to the equations for each fourier mode . to compute the inverse we use a direct solver ( lu method for example ) to obtain the inverse of each block and consequently the inverse of @xmath392 . to minimize the cpu cost we do nt invert @xmath392 at each time step , but only when the convergence for the previous linear step is too slow",
    ".      the first order linearization previously used may not be the optimal choice to solve the problem in the nonlinear phase of the run .",
    "consequently we propose to replace this linearization by a newton procedure .",
    "since we use an iterative solver to compute the solution of the linear system , it will be interesting to use an inexact newton procedure @xcite-@xcite .",
    "this variation of the newton method means that the convergence criterion of the gmres method is adapted using the nonlinear residual and the convergence of the newton procedure .",
    "the aim is to use the nonlinear convergence to minimize the number of gmres iterations .",
    "indeed it is not necessary to solve with a high accuracy the linear system but just enough at each step to converge to the solution of the nonlinear system at the end .",
    "let us now detail the inexact newton algorithm :   + * algorithm *   +    * at the time step @xmath393 , we compute @xmath394 , @xmath395 . * we choose @xmath396 and the initial guess @xmath397 .",
    "* at each iteration @xmath398 of the newton method we have the solution @xmath399 .",
    "* we compute @xmath400 and the jacobian @xmath401 .",
    "* we solve the linear system with gmres @xmath402 and the following convergence criterion @xmath403 with @xmath404 * we iterate with @xmath405 .",
    "* we apply a convergence test ( for example @xmath406 ) . *",
    "when the newton method has converged we define @xmath407 .    here",
    "@xmath408 and @xmath409 are the relative and absolute stopping criteria for the newton procedure .",
    "we couple this algorithm with an adaptive time stepping which allows to use large time steps in the linear phase and smaller time steps in the nonlinear phase .",
    "actually the principle is simple : if the newton process converges very quickly we increase the time step and if the convergence is slow we decrease the time step for the following iteration . if the newton process does not converge or if @xmath410 during two or three consecutive linear steps we decrease the time step and restart the newton iterations . to have a smooth evolution of the time step",
    "it is necessary to avoid a large increasing or decreasing of the time step .",
    "in general the different test cases used in this paper have the same structure .",
    "first we compute the equilibrium on the poloidal grid ( fig 1 . , left ) ,",
    "compute the aligned grid ( fig 1 .",
    ", right ) and begin the time loop . at the beginning of the time loop peeling - ballooning modes @xcite set in which are responsible for the appearance of edge localized modes ( elms ) .",
    "these linear instabilities are driven by large pressure gradients ( steep pressure pedestal ) and large current densities in the edge . during these instabilities",
    "the energy associated with the non principal modes grows exponentially .",
    "the background profiles are modified .",
    "when the energies associated with the non principal modes are sufficiently large , the pressure gradients get smaller which stabilizes the instability .",
    "this is the nonlinear saturation phase .",
    "the implicit time methods are known to be stable without restriction on the time step , however this type of result is valid for stable physical dynamics and stable models . in our cases",
    "we have physical instabilities consequently the numerical stability is not ensured .",
    "typically we will show that if the numerical error ( time error , linearization error ) becomes too large the numerical simulation does not capture correctly the beginning of the salutation phase and generates critical numerical instabilities .",
    "+   + in this section we present some numerical results for the models with and without parallel velocity .",
    "we add to the reduced mhd models , numerical diffusion operators for each equation and two anisotropic diffusion operators on the density and the temperature ( density and pressure equations ) .",
    "for example , for the pressure equation we add the following diffusion operator @xmath411 with @xmath412 and @xmath413 .",
    "+ we propose to compare the different methods ( exact and inexact newton methods and classical linearization ) mainly in the nonlinear phase . indeed in the linear phase",
    "the classical method is clearly more efficient . in this phase",
    "the preconditioning is very efficient and the gmres solver converges quickly ( between 1 and 5 iterations ) .",
    "the newton procedure converges with 3 iterations in general . consequently using the newton method",
    "the cost is clearly higher for each time step in the linear phase . in the nonlinear phase the situation is more complicated .",
    "the nonlinear phase begins when the quantities associated with the non principal modes have the same order of magnitude as the quantities associated to the principal mode . to compare the numerical results",
    ", we define the beginning of the nonlinear phase as the time where the kinetic and magnetic energies for @xmath414 are at the level of the energies associated to @xmath415 . to compare the classical linearization and the newton procedure we use the adaptive time stepping .",
    "if the algorithm for one time step does not converge we recompute it with a smaller time step ( typically @xmath416 ) .",
    "for the newton and the linearization methods the factorization is recomputed for each time step and during a newton step the factorization is recomputed if the number of gmres iterations associated with the two last newton steps is superior to 50 .",
    "this first case corresponds to a simplified equilibrium configuration associated to the jet reactor . we solve the model without parallel velocity . in this case",
    "the numerical viscosity is zero and the numerical resistivity is @xmath417 .",
    "the physical viscosity and resistivity , dependent on the temperature are given by @xmath418 and @xmath419 .",
    "note that the energy estimate for our model is valid only for a constant viscosity coefficient , which is not the case here .",
    "this point will be discussed in the future .",
    "we consider a geometry with x - point .",
    "the number of degrees of freedom for these simulations is around @xmath420 with around @xmath421 nonzero coefficients . in the toroidal direction we use three fourier modes",
    "@xmath422 , @xmath423 and @xmath424 with @xmath425 a parameter called the periodicity . for the linearization procedure the criterion of convergence for the gmres procedure is @xmath426 . for the newton procedure",
    "the maximum number of newton iteration is 10 and the criterion of convergence for the newton procedure @xmath427 , the @xmath428 of the gmres convergence criterion is @xmath429 . using @xmath430 we compare the results for the linearization method , the exact newton method and the inexact newton method .",
    "these results are given between the time 1400 and 3500 corresponding to the nonlinear saturation phase .",
    "the final time is @xmath431 .",
    "the code is executed with 2 mpi and 16 openmp threads per mpi process . in the tables ( tab 1 ) - ( tab 2 ) - ( tab 3 ) we give the average of different quantities associated to the solver during one time step .",
    "@xmath432 & gmres iter .",
    "& @xmath433 fact . & time + 30 & 19 & 1 & 53.25 +     @xmath432 & gmres iter .",
    "& @xmath433 fact . &",
    "newton iter . & total gmres iter . & time + 30 & 19.8 & 1.05 & 3 & 59 & 79.6 + 40 & 26.6 & 1.28 & 3.2 & 85.5 & 102 +     @xmath432 & gmres iter .",
    "& @xmath433 fact .",
    "& newton iter . & total gmres iter . & time + 30 & 3.3 & 1 & 5.7 & 18.7 & 76.25 + 40 & 5.4 & 1 & 5.8 & 31 & 82.9 +    some remarks about these results .",
    "it is clear that the cpu cost associated with the newton procedure is higher compared to the classical linearization for the same time stepping .",
    "this result is expected , indeed by definition of the newton method , the number of linear problems solved is larger with the newton procedure .",
    "first in the nonlinear phase we remark that the newton procedure is also less performing , but using an inexact newton method we can reduce the cpu cost . in the tables 2 and 3 we remark that for the time step @xmath434 , the main difference between the inexact and exact newton method is small , but for @xmath435 the difference is larger . the main difference between exact and inexact newton method",
    "can be explained by the fact that the number of gmres iterations is larger using the exact newton method and consequently the factorization for the preconditioning is called more often . at the end",
    "we remark that the inexact newton method is clearly more efficient when the problem is more nonlinear and similar when the problem is not too nonlinear .",
    "this result verifies the usefulness of the inexact newton method .",
    "now we propose to compare the linearization method and the inexact newton method . in the nonlinear phase",
    "the difference is less important . indeed in the nonlinear phase",
    "the number of gmres iterations for each linear problem is larger . using an inexact newton procedure we have more linear problems to solve but",
    "each linear system is solved with a small accuracy .",
    "consequently the cost associated with each linear system is smaller when we use the inexact newton procedure .",
    "the tables 1 - 3 for @xmath434 show that the total gmres iterations for one time step are similar between an inexact newton procedure and the linearization procedure .",
    "consequently the additional cost associated with the inexact newton method come from the computation of the matrix and in this case is around 1.5 which is an acceptable additional cost . additionally , the parallel scaling is better for the construction of the matrix than the iterative solver and the preconditioning .",
    "consequently with more mpi process the difference between the cpu cost associated with the inexact newton method and the linearization method can be reduced .",
    "+ secondly we compare the two methods with @xmath436 . for the newton procedure",
    "the maximum number of newton iterations is 20 and the criterion of convergence for the newton procedure @xmath437 , the @xmath438 of the gmres convergence criterion is @xmath429 .",
    "we plot the kinetic and magnetic energies associated with the different modes for the two procedures and the different time steps ( fig 3 . ) and ( fig 4 . ) .",
    "gives by the newton method .",
    "this solution can be use as reference to validate the solutions computed with very large time steps .",
    "the coefficient @xmath393 corresponds to the periodicity . in this case",
    "the periodicity is equal to @xmath439 . ]    . in the left kinetic and magnetic energies for newton method for @xmath440,title=\"fig : \" ] . in the left kinetic and magnetic energies for newton method for @xmath440,title=\"fig : \" ]    . in the left kinetic and magnetic energies for newton method for @xmath440,title=\"fig : \" ] . in the left kinetic and magnetic energies for newton method for @xmath440,title=\"fig : \" ]    . in the left kinetic and magnetic energies for newton method for @xmath440,title=\"fig : \" ] . in the left kinetic and magnetic energies for newton method for @xmath440,title=\"fig : \" ]    these results show that the newton procedure with adaptive time stepping is more robust than the classical linearization and allows to use a larger time step .",
    "when we use the classical linearization with a very large time step , the numerical error linked to the time discretization and the linearization becomes too large such that consequently the numerical scheme does not capture correctly the beginning of the saturation phase . in this case ,",
    "numerical instabilities appear and the iterative solver does not converge after the beginning of the numerical instability . if we use an adaptive time stepping the situation is the same because in general the scheme computes the beginning of the numerical instabilities and at this moment is too late to adapt and decrease the time step .    with the newton procedure",
    "the situation is different .",
    "first the error of linearization and consequently the global numerical error is smaller so we can use larger time steps and capture correctly the beginning of the saturation phase .",
    "secondly we do nt have the problem associated with the numerical instabilities with the newton procedure as the newton method does not converge in case of the numerical instability such that the time step is recalculated with smaller @xmath441 .",
    "we conclude that the adaptive time stepping works with the newton method because this procedure detects the beginning of the numerical instabilities by non convergence of the method contrary to the linearization , for which in order to continue the computation it is necessary to adapt the @xmath441 before the beginning of the numerical instability . consequently the newton procedure is more robust , allowing an efficient adaptive time stepping , which avoids numerical instabilities for large time steps and non convergence issues .",
    "the figure ( fig 4 . ) shows that the code with the linearization method does not converge with @xmath435 contrary to the newton method which converges even with @xmath442 .",
    "this test case is not too nonlinear and consequently not too stiff for the numerical method .",
    "for more nonlinear test cases the newton procedure gives better results when the problems get stiffer .",
    "this second test case corresponds to a realistic asdex upgrade equilibrium configuration with unrealistically large resistivity which makes the instability especially violent .",
    "we solve the model without parallel velocity . in this case",
    "the numerical viscosity and the numerical resistivity are close to @xmath443 .",
    "the physical viscosity and resistivity are dependent of the temperature : @xmath444 and @xmath445 .",
    "we consider a geometry with x - point . in the toroidal direction we use three fourier modes",
    "@xmath422 , @xmath423 and @xmath424 with @xmath425 a parameter called the periodicity",
    ". the final time is @xmath446 .",
    "+ for the linearization procedure the maximum number of gmres iteration is 500 and the convergence criterion for the gmres procedure @xmath426 .",
    "first we propose to compare the two methods for @xmath447 .",
    "for the newton procedure the maximum number of newton iterations is 10 and the the criterion of convergence for the newton procedure @xmath448 , the @xmath438 of the gmres convergence criterion is @xmath429 .",
    "+    . in the middle kinetic and magnetic energies for linearization method for @xmath449 . in the right kinetic and magnetic energies for the newton method for @xmath450 with adaptive time stepping.,title=\"fig : \" ] . in the middle kinetic and magnetic energies for linearization method for @xmath449 . in the right kinetic and magnetic energies for the newton method for @xmath450 with adaptive time stepping.,title=\"fig : \" ]    . in the middle kinetic and magnetic energies for linearization method for @xmath449 . in the right kinetic and magnetic energies for the newton method for @xmath450 with adaptive time stepping . ]",
    "this test case with violent physical instabilities allows to confirm the previous remarks about adaptive time stepping and numerical instabilities .",
    "first if we choose a too big time step with the linearization method , we have a numerical instability which appears and the adaptive time stepping is not efficient .",
    ".cpu time of the simulation for the gmres method with @xmath451 and for newton method with adaptive time method ( initial time step @xmath450 ) . [ cols=\"^,^,^,^,^\",options=\"header \" , ]     due to the violent physical instabilities",
    "the problem is strongly nonlinear in the saturation phase .",
    "contrary to the previous test case , using the newton method allows to reduce significantly the cpu cost for the total run ( tab 5 . ) .",
    "+ the inexact newton method with adaptive time stepping is more robust than the linearization method and allows to reduce the cpu costs for highly nonlinear cases because of the possibility to take larger time steps .",
    "this test case is the same as the one used in section 4.1.1 but we solve the model with parallel velocity .",
    "first we compare the two methods in the nonlinear phase with @xmath452 .",
    "for the newton procedure the maximum number of newton iteration is 10 and the the criterion of convergence for the newton procedure @xmath453 , the @xmath438 of the gmres convergence criterion is @xmath429 .",
    "these results are given between the time 1250 and 3500 which correspond to the saturation phase ( stiff part of the computation ) .",
    "models & gmres iter . & facto . &",
    "time + with neglected terms & 25.4 & 1 & 75.7 + without neglected terms & 28 & 1 & 83.6 +     models & gmres iter .",
    "& facto . & newton iter . & total gmres iter . & time + with neglected terms & 5.1 & 1 & 6.4 & 32.7 & 119.3 + without neglected terms & 5.2 & 1 & 6.4 & 33.4 & 122.5 +     models & gmres iter . & precon",
    ". called & newton iter .",
    "& total gmres iter . & time + with neglected terms & 10.9 & 1.1 & 6.95 & 75.6 & 152 + without neglected terms & 8.7 & 1 & 6.7 & 58 & 142 +    the conclusions on the comparison between the newton procedure and the linearization procedure are similar to the conclusion for the first test case : in the nonlinear phase the new method costs around 1.4 - 1.5 times more , but this additional cost can be reduced using a larger time step .",
    "indeed using the newton procedure ( as previously ) we can use larger time steps than with the original linearization method without running into numerical instabilities . for example in this latter case the linearization method is unstable with @xmath454 and the newton method is stable with @xmath455 ( fig 6 . ) .    .",
    "in the left kinetic and magnetic energies for newton method for @xmath456,title=\"fig : \" ] . in the left kinetic and magnetic energies for newton method for @xmath456,title=\"fig : \" ]    . in the left kinetic and magnetic energies for newton method for @xmath456,title=\"fig : \" ] . in the left kinetic and magnetic energies for newton method for @xmath456,title=\"fig : \" ]    for all these results we recompute the factorization for the preconditioning at each time step . for the newton method we have added an additional rule .",
    "the factorization is recomputed if the convergence is too slow for the previous linear step . to reduce the cpu time we can use only the second rule for the newton procedure and the linearization method . in this case , it is not necessary to compute the factorization for each time step .",
    "the different test cases show that for the newton procedure it will be important to use a smaller @xmath438 ( initial @xmath45 for the gmres method in the inexact newton procedure ) to compute correctly the first newton iteration .",
    "the last remark about this result is on the difference between the model with and without neglected terms .",
    "these terms in the potential and parallel velocities equations come from to the fact the poloidal and parallel velocity are not perpendicular , this is the cross terms between the poloidal velocity and the poloidal part of the parallel velocity . in the ( fig 7 . )",
    "we remark that we have small differences in the dynamics of kinetic and magnetic energies between the models with and without neglected terms .",
    "we observe these differences for the linearization method with @xmath457 and for the newton methods with @xmath435 . with the newton procedure and @xmath458",
    "the difference is smaller . in theory",
    "these terms are small consequently it is expected that the impact of these terms is small when the numerical error ( time and linearization errors ) is small .",
    "when the error is larger ( linearization method with @xmath458 , newton method with @xmath435 ) the impact of these terms is more important .",
    "however the impact of these additional terms on the stability , conditioning and convergence issues is not clear and requires additional studies for exemple when the resistivity and viscosity are close to zero .",
    ", in the top and right , results given by the newton method with @xmath458 and in bottom results given by the newton method with @xmath435.,title=\"fig : \" ] , in the top and right , results given by the newton method with @xmath458 and in bottom results given by the newton method with @xmath435.,title=\"fig : \" ]    , in the top and right , results given by the newton method with @xmath458 and in bottom results given by the newton method with @xmath435 . ]",
    "in this paper , we have presented a rigorous analytical derivation of the reduced mhd models implemented in the non - linear mhd code jorek . starting from the potential formulation of the magnetic field vector and fluid velocity used in jorek we obtain a few additional terms that have been neglected in the code but might be relevant in the non - linear phase .",
    "we have also given a proof of the conservation ( in the ideal case ) or dissipation ( in the resistive and viscous cases ) of total energy for this reduced mhd model if the additional terms are taken into account .",
    "this is an important validation for the choices of the projections and the assumptions of the derivation .",
    "indeed we obtain an energy estimate close the energy estimate associated with the full mhd . at the numerical level it is important to have a stable model ( here we consider the dissipation of the energy as a first stability result for the model ) .",
    "indeed it is not possible to certify the numerical stability ( decay of the norm or of the energy ) and the good behavior of the numerical methods if it is not the case for the continuous model .",
    "the numerical results do not show large differences between our model derived previously with the dissipative energy estimate and the model implemented initially in jorek which does not preserve this energy balance estimate . perhaps",
    "because at the numerical level the discrete energy decay is not yet satisfied exactly under all circumstances ( time scheme not adapted , negative density or wrong viscous coefficient can explain this ) .",
    "however , now we have a model with a good energy balance law which makes possible the design of numerical method that are stable and robust . in the future we would like to study the derivation of the reduced mhd with the bi - fluid effects , with more physical stress tensors @xcite .",
    "+   + the second part of the paper is focused on the time solver of jorek .",
    "the original method used in jorek for the time - stepping of the nonlinear system is a linearization solved iteratively by gmres with physics - based preconditioning .",
    "we have replaced this by the nonlinear inexact newton method in which the linear convergence accuracy of gmres depends on the non - linear convergence . especially at the onset of non - linear saturation",
    ", large numerical errors can cause numerical instabilities and prevent convergence .",
    "the non - linear time stepping reduces those errors and consequently allows to use larger time steps as confirmed by numerical tests .",
    "we have also implemented and tested an adaptive time stepping that works very efficiently with the newton method and allows to reduce computational costs .",
    "the newton method is more robust than the linearization method as it avoids certain numerical instabilities , is well suited for adaptive time stepping , and allows to reduce computational costs in highly non - linear cases .",
    "the newton method is currently implemented for the single fluid reduced mhd equations in jorek , and will be extended to two - fluid terms and further extended models in the future .",
    "bcoulet m. , orain f. , huijsmans g.t.a .",
    ", pamela s. , cahyna p. , hoelzl m. , garbet x. , franck e. , sonnendrcker e. , dif - pradalier g. , passeron c. , latu g. , morales j. , nardon e. , fil a. , nkonga b. , ratnani a. , grandgirard v. _ mechanism of edge localized mode mitigation by resonant magnetic perturbations_. physical review letters 113 , 115001 ( 09/2014 ) .",
    "e. deriaz , b. desprs , g. faccanoni , k. p. gostaf , l. m. imbert , g. sadaka , r. sart _ magnetic equations with freefem + + : the grad - shafranov equation and the current hole _ , esaim : proc .",
    "32 , 149162 , ( 2011 )    b. desprs , r. sart _ derivation of hierarchies of reduced mhd models in tokamaks _ ,",
    "submitted to archive of rational mechanics and analysis , preprint : http://hal.archives-ouvertes.fr/docs/00/79/64/25/pdf/mhd_tout_12.pdf    cahyna p. , becoulet m. , huijsmans g.t.a .",
    ", orain f. , morales j. , kirk a. , thornton a.j .",
    ", pamela s. , panek r. , hoelzl m. _ modelling of spatial structure of divertor footprints caused by edge - localized modes mitigated by magnetic perturbations_. nuclear fusion ( submitted ) .",
    "fil a. , nardon e. , bcoulet m. , dif - pradalier g. , grandgirard v. , guirlet r. , hoelzl m. , huijsmans g.t.a .",
    ", latu g. , lehnen m. , monier - garbet p. , orain f. , passeron c. , pgouri b. , reux c. , saint - laurent f. , tamain p. _ modeling of disruption mitigation by massive gas injection_. 41st eps conference on plasma physics , berlin , germany , p1.045 ( 06/2014 ) .",
    "hoelzl m. , huijsmans g.t.a .",
    ", merkel p. , atanasiu c. , lackner k. , nardon e. , aleynikova k. , liu f. , strumberger e. , mcadams r. , chapman i. , fil a. _ non - linear simulations of mhd instabilities in tokamaks including eddy current effects and perspectives for the extension to halo currents_. journal of physics : conference series 561 , 012011 ( 2014 ) .",
    "huijsmans g.t.a . , liu f. , loarte a. , futatani s. , koechl f. , hoelzl m. , garofalo a. , salomon w. , snyder p.b . , nardon e. , orain f. , bcoulet m. _ non - linear mhd simulations for iter .",
    "25th fusion energy conference ( fec 2014 ) _ , saint petersburg , russia , th/6 - 1ra ( 17/10/2014 ) .",
    "liu f. , huijsmans g.t.a .",
    ", loarte a. , garofalo a.m. , solomon w.m . , hoelzl m. _ nonlinear mhd simulations of qh - mode plasmas in diii - d_. 41st eps conference on plasma physics , berlin , germany , o5.135 ( 06/2014 ) .",
    "s. k. malapaka , b. desprs , r. sart _ unconditionally stable numerical simulations of a new generalized reduced resistive magnetohydrodynamics model _ , international journal for numerical methods in fluids volume 74 , issue 4 , pages 231 - 249 , 10 february 2014 .",
    "hoelzl m. , gnter s. , wenninger r.p .",
    ", mueller w .- c .",
    ", huysmans g.t.a . ,",
    "lackner k. , krebs i. , asdex upgrade team .",
    "reduced - mhd simulations of toroidally and poloidally localized elms .",
    "physics of plasmas , 19 , 082505 ( 08/2012 ) .",
    "orain f. , bcoulet m. , morales j. , dif - pradalier g. , garbet x. , nardon e. , passeron c. , latu g. , fil a. , huijsmans g.t.a .",
    ", hoelzl m. , pamela s. , cahyna .",
    "_ p. non - linear mhd modeling of multi - elm cycles and mitigation by rmps_. plasma physics and controlled fusion 57 , 014020 ( 11/2014 ) .",
    "pamela s.j.p .",
    ", huysmans g.t.a . ,",
    "kirk a. , chapman i.t .",
    ", becoulet m. , orain f. , hoelzl m. , and the mast team . _ influence of diamagnetic effects on resistive mhd simulations of rmps in mast_. ( in preparation ) .",
    "d. d. schnack , d. c. barnes , d. p. brennan , c. c. hegna , e. held , c. c. kim , s. e. kruger , a. y. pankin , c. r. sovinec , _ computational modeling of fully ionized magnetized plasmas using the fluid approxmation _",
    ", physics of plasmas 13 , 058103 ( 2006 )    pb snyder , hr wilson , jr ferron , ll lao , aw leonard , th osborne , ad turnbull , d mossessian , m murakami , xq xu , _ edge localized modes and the pedestal : a model based on coupled peeling ballooning modes _ , physics of plasmas 9 ( 5 ) , 2037 - 2043 , 2002"
  ],
  "abstract_text": [
    "<S> in this paper we present a rigorous derivation of the reduced mhd models with and without parallel velocity that are implemented in the non - linear mhd code jorek . </S>",
    "<S> the model we obtain contains some terms that have been neglected in the implementation but might be relevant in the non - linear phase . </S>",
    "<S> these are necessary to guarantee exact conservation with respect to the full mhd energy .    for the second part of this work , we have replaced the linearized time stepping of jorek by a non - linear solver based on the inexact newton method including adaptive time stepping . </S>",
    "<S> we demonstrate that this approach is more robust especially with respect to numerical errors in the saturation phase of an instability and allows to use larger time steps in the non - linear phase . </S>"
  ]
}