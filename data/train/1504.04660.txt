{
  "article_text": [
    "the most powerful events observed in the solar system are the result of convective dynamics in the outer layers of the sun .",
    "researchers trying to understand these dynamics need tools to measure and study these turbulent motions and their interaction with the local magnetic field .",
    "several methods for deducing the flows in the solar photosphere ( the visible surface of the sun ) have been developed over the years .",
    "many of these have been based upon some form of local correlation tracking ( lct ) @xcite where pairs of successive images of the photosphere are broken into sub - images which are then shifted relative to each other to find an optimal relative shift .",
    "this shift is then associated with the local mean velocity of the flow .",
    "these methods appear to work well on high - resolution images collected from both ground - based @xcite and space - based @xcite observatories .",
    "there have been a few attempts to assess and compare the performance of such methods over the past twenty years including those of hurlburt  @xcite , welsch @xcite , chae and sakurai @xcite and most recently , verma , steffen and denker @xcite .",
    "these have used a variety of data input for their assessments , from those derived from simulations of mhd flows in the photosphere , to creating image sets from solar images by applying known distortions , to direct comparisons with real solar data .",
    "all tested methods gave consistent results .",
    "however the best method was somewhat dependent on the test and the choice of the respective parameters for each method .",
    "alternative methods have been developed in other fields with similar goals .",
    "machine vision researchers developed optical flow methods for deducing the relative motions of objects in digital images @xcite and atmospheric scientists developed various methods for deducing winds on earth from cloud motions in satellite images @xcite .",
    "experimentalists in other branches of fluid dynamics , including blood flow measurements deduced from x - ray images @xcite and flows with various tracer particles in suspensions @xcite , have explored similar methods .",
    "one difference between the typical machine vision problem and that of deducing fluid velocities is that the former seek motions of discrete objects while the latter seeks motions of continuous flows .",
    "applying optical flow methods such as those described by jhne @xcite on high - resolution solar images typically underestimate the velocity of the flows . in part",
    "this is due to the simple spatial averaging used in deriving the velocity .",
    "hurlburt @xcite presented a method which does not make use of such spatial averaging .",
    "instead the flows are assumed to be smooth and continuous  being represented by a truncated fourier series .",
    "here we present a detailed description of the method and assess it using previously developed tests and compare it to local correlation tracking methods .",
    "the basic assumption is that the visible pattern observed in the fluid , as measured by the local intensity @xmath0 will be advected by the velocity field @xmath1 and hence should satisfy the equation @xmath2 in the case of solar physics the pattern is typically formed by convective motions in the photosphere , which are clearly visible in white - light images and which appear to be advected by larger scale flow fields .",
    "images are collected frequently relative to the flow speeds , such that the displacement of the pattern between any sequential pair of images is less than a pixel .",
    "the problem is to determine @xmath1 from a time sequence of two dimensional images @xmath3 in the presence of measurement noise and other `` noise '' sources , such as the acoustic oscillations present in the solar atmosphere or missing frames due to data dropouts . using equation ( [ eq : advect ] ) we can seek the best fit velocity field @xmath4 using least squares .",
    "first we form the merit function of the fit for the full dataset @xmath3 .",
    "@xmath5 which we seek to minimize",
    ". here the sums are taken over the discrete pixel and frame coordinates for @xmath6 and @xmath7 if the velocity field @xmath1 is a continuous field , we can express the fit velocity @xmath8 as a fourier series @xmath9    where @xmath10 and @xmath11 are unit vectors , @xmath12 and @xmath13 are complex amplitudes and @xmath14 and @xmath15 are the number of fourier modes retained in the expansion . substituting this into equation ( [ eq : merit ] ) and differentiating with respect to @xmath16 and @xmath17 results in the system of equations @xmath18",
    "this can be reorganized to form the complex system of equations @xmath19 where @xmath20    these matrices consist of discrete fourier transforms of the various , time - averaged products of the spatial and temporal derivatives of the image .",
    "the matrices of the complex linear system ( [ eq : spectral ] ) for the spectral amplitudes @xmath12 , @xmath13 can be combined to form a single hermitian matrix of size @xmath21    this method has been implemented in an idl routine opflow3d and is available as part of the solarsoft environment @xcite .",
    "the time derivative is evaluated using finite differencing between sequential images while the spatial derivatives is evaluated using 4th order finite differences on the average of the two images used for the time derivative .",
    "the matrices are then computed for the entire time - space cube @xmath3 and the system is solved .    solving the system using direct methods",
    "can quickly become expensive , scaling as @xmath22 .",
    "the method requires 70 seconds on an 2013-vintage imac workstation ( with 3.4ghz processor and 32 gb of memory ) to obtain the solutions for @xmath23 on a @xmath24 image .",
    "this is partially offset by the fact that the method requires no preprocessing or filtering and that it fits flows over many instances in time in one go .",
    "the matrices in ( [ eq : system ] ) can also be reused in subsequent calculations with minimal additional expense .",
    "performance could be further optimized by taking advantage of the matrix structure in equation ( [ eq : system ] ) which has a blocked - toeplitz - toeplitz - block ( bttb ) structure @xcite .",
    "as a first test of the method , we take the simulated observations developed by hurlburt  @xcite . using a sixth - order accurate numerical scheme @xcite they took a single intensity image @xmath25 of solar granulation and evolved it with equation ( [ eq : advect ] ) with a steady velocity field",
    "they then degraded and resampled the image to represent the expected resolution of the michelson doppler imager ( mdi ) on the solar and heliospheric observatory @xcite .",
    "since there is no source of noise and the imposed flows are themselves based on fourier modes , we expect and observe that the opflow3d method can recover the flow with a high accuracy . the results for a case where @xmath26 on a @xmath27 pixel image is displayed in figure [ fig : h95 ] , along with the known input velocty field and a sample image .",
    "the two sets of arrows , corresponding to the known ( black ) and derived ( white ) velocity fields are almost perfectly correlated , both in direction and magnitude .",
    "= 4 , @xmath28 using sixty @xmath29 pixel images .",
    "the two agree within the noise level of the supergranular flow field . ]    with this basic validation of the method on perfect data , we turn to comparisons with other methods and operate on real solar data and then consider a detailed error analysis .",
    "first we compare the results of applying this method to other large - scale , full - disk measurements .",
    "figure [ fig : difrot ] displays the zonal ( e - w ) component of the solar velocity along the central meridian of the sun as a function of solar latitude derived from one hour of mdi @xcite data .",
    "we include the corresponding measure based upon fits to doppler measurements @xcite .",
    "aside from the departures induced by sampling errors of the supergranular flows in this short time , the two curves agree very well .",
    "there are several factors that may contribute to errors in the velocity estimate provided by opflow3d .",
    "these can be broken into three classes : systematic errors introduced by the choice of velocity representation , errors due to image quality and errors introduced by physical effects in the solar atmosphere . as a first step , we take what is currently the most consistent and stable images available , using data obtained by the helioseismic and magnetic imager ( hmi ) on sdo @xcite .",
    "we then subject them to a variety of controlled tests to address the first two classes of error .",
    "this is the best - case scenario for studies of the solar photosphere : a stable imager observing `` quiet '' sun ( where magnetic effects are negligible ) .",
    "the following section considers a more complex situation of observing magnetic regions with a less - stable imager .",
    "one hour of level-1 hmi continuum images consisting of 80 individual frames were used for this study beginning at 2010 - 10 - 26t08:29:00 .",
    "a set of 1024x1024 pixel sub - images were extracted centered on a coronal hole identified in the heliophysics event knowledgebase @xcite ( herein referred to as c2010 ) .",
    "is displayed in black and the fitted velocity @xmath30 , and error , @xmath31 in red and green respectively .",
    "it is clear that error drops rapidly away from the boundaries , within half a wavelength of the truncated mode . ]",
    "the use of a truncated fourier representation for the velocity field is a common practice in fluid dynamic investigations .",
    "however it has two well - known issues that must be considered : it imposes a periodic structure to the flows and may introduce aliasing or other errors due to truncation . to assess these effects",
    ", we use the first frame from the c2010 and generate ten artificial images from it using equation ( [ eq : advect ] ) with a known , hexagonal flow field , in a similar approach to that of hurlburt @xcite .",
    "our implementation uses a fast fourier transform and can be sensitive to discontinuities at frame boundaries .",
    "while the fourier representation forces the velocity to match across opposing boundaries , the application of a least squares fit works to confine such effects to near the edges .",
    "the resulting spikes in the residual @xmath31 decay rapidly away from frame boundaries ( figure [ fig : gibbs ] ) .",
    "thus , avoiding pixels near the boundaries is the practical means for avoiding these errors .",
    "aspects of image quality that may influence our fit include large displacements arising from insufficient sampling rates ( which may introduce ambiguity into the possible solution ) , image noise and missing data . to assess the impact of image quality",
    ", we adapt the approach from the previous section .",
    "the first frame of the c2010 is advected to generate ten frames with a known velocity field @xmath32 composed of 22 by 22 randomized fourier modes .",
    "a set of these data cubes is generated with a range of magnitudes for @xmath32 .",
    "we find the accuracy of the fit starts to break down when the rms velocity exceeds 0.4 pixels / frame .",
    "this result applies to the images with repeating , high - frequency patterns such as solar granulation seen in c2010 . in contrast , larger - scale patterns could allow larger unambiguous motions between frames .",
    "the effect of truncation can be assessed by evaluating this same test case with an increasingly large number of modes ( @xmath33 ) in equation ( [ eq : vel ] ) , from @xmath34 to @xmath35 .",
    "we find that the overall trend is constant , but with higher values being more sensitive to the effects of noise as the effective sample size of the fit decreases .",
    "thus the selection of the number of modes should take this trade off into account .",
    "a rule of thumb would be that @xmath36 where @xmath37 is the number of features ( e.g. granules ) required to span the image .    to assess the impact of noise on velocity estimate , we first measure the inherent noise in the synthetic datacube used above by setting @xmath38 in equation ( [ eq : merit ] ) to give @xmath39 counts per frame .",
    "@xmath40 is used here to represent the original variation that is reduced by fitting v , and because it scales with image contrast .",
    "next , we generate a sequence of datacubes by adding increasing levels of gaussian white noise . the datacube with added noise standard deviation @xmath41 has velocity estimate @xmath42 . by comparing @xmath43 with @xmath44",
    ", we can gain some insight into the sensitivity of the method to noise .",
    "we find that for a maximum relative error of 1% , the maximum additional noise must have @xmath45 .",
    "comparing this value of @xmath41 to the inherent signal noise @xmath40 , demonstrates that high noise images can still yield reliable velocity estimates .",
    "this robustness against measurement noise most likely results from averaging over many pixels .",
    "finally there are features in the solar atmosphere that may impact the performance of any method of velocity estimation .",
    "these include the presence of strong acoustic modes ( known as five - minute oscillations ) which generate a relatively - smooth , but random intensity fluctuation in solar images ; limb - darkening , which introduces fixed , large - scale intensity gradients due to line - of - sight effects ; and strong magnetic features that may distort the intensity patterns in non - obvious ways . in exploring these cases",
    ", we can not compare our results to a known solution .",
    "instead we must make statistical inferences .",
    "if we seek flows that persist on time scales significantly larger than five minutes , we can assess the effect of acoustic oscillations .",
    "we take @xmath46 to be the velocity fit for @xmath47 frames starting at frame @xmath48 .",
    "we examine the convergence of @xmath46 , as @xmath47 increases . using c2010",
    ", we divide the 80 frames into sets 1 and 41 , consisting of the first and last sets of 40 frames .",
    "since the images in this case may possess an overall motion akin to camera motion ( say @xmath49 ) , we first subtract such motions from @xmath50 to produce the the euclidean metric @xmath51 pixels / frame .",
    "similarly , the distance between @xmath50 and @xmath52 is the euclidean metric @xmath53 ppf .",
    "this distance is a rough measure of precision .",
    "thus , with @xmath54 , considerable convergence is apparent .    to examine the rate of convergence",
    ", we can next estimate @xmath55 for @xmath56 .",
    "we then compute the distance @xmath57 .",
    "this distance , averaged over all @xmath48 , is 0.19 ppf .",
    "clearly a two frame estimate is poor .",
    "comparison of the 2 frame and 40 frame distances , 0.19 ppf and 0.019 ppf , imply that the rate of convergence is between @xmath58 and @xmath59 , which is expected for traveling wave patterns in acoustic oscillations .",
    "this is consistent with previous studies of solar flows using lct methods @xcite .",
    "the contrast in the image varies smoothly across each frame in our sample due to the limb - darkening effect of the solar atmosphere .",
    "such gradients can cause problems for some methods .",
    "however in our case , it only changes the weights of the sum of the squares in equation ( [ eq : merit ] ) , so that the fit is only slightly affected .",
    "the same logic shows the method is insensitive to image - quality problems such as missing frames .",
    "as a final test , we provide a detailed comparison of our method to that used a recent study by verma & decker @xcite ( hereinafter referred to as v&d ) .",
    "they conducted a thorough investigation of horizontal flow fields observed in hinode g - band images using a local correlation tracking ( lct ) approach that was used in november and simon @xcite .",
    "following v&d , we selected an hour - long set of g - band images collected by the hinode solar optical telescope ( sot , @xcite ) on june 4 , 2007 between 14:27 and 15:27ut . in that study , the authors first applied the standard calibrations to the images and then further pre - processed them by correcting for foreshortening , applying a rigid alignment between the images to remove spacecraft jitter and solar rotation , and then employed a subsonic filter to remove acoustic oscillations .",
    "we also calibrate the images using the solarsoft routine fg_prep with its default settings .",
    "however , we do not apply the other preprocessing steps .",
    "other than foreshortening , those corrections effectively remove noise from the velocity signal that we are seeking , be it jitter from the spacecraft , bulk motion across the field of view or distracting intensity fluctuations .",
    "since the opflow3d method has already been shown to address such noise sources , we rely on it alone to do so .",
    "in addition , we found seven of the 238 images in the sequence were missing : rather than attempt to correct for these , we left those images blank and left it to opflow3d to deal with the consequences .",
    "figures [ fig : verma2 ] and [ fig : verma6 ] display a comparison of applying the two methods to the same image set .",
    "the only free parameters for opflow3d are the number of modes used to fit the velocity field , and whether to use a direct or iterative solution method : we select a direct solution with 20 modes in each direction .",
    "this corresponds to an effective pixel size of about 2 mm when compared to the gaussian fwhm used by v&d .",
    "we correct for foreshortening after the fact by scaling the components of the velocity and display the magnitude of the resulting velocity field ( less the average velocity over the frame ) in figure [ fig : verma2 ] .",
    "strong moat flows are visible in the lower left , as well as converging flows elsewhere in plage areas .",
    "figure [ fig : verma6 ] displays a normalized histogram of flow speeds , which can be compared to figure 6 of v&d . in both cases the peak value across the field of view is around 0.3 km / s .",
    "we find the overall rms speed to be 0.46km / s , the median to be 0.42 km / s and the maximum to be 1.68 ; as compared to 0.44 km / s , 0.40 km / s and 1.95 km / s respectively .",
    "the fact that opflow3d method retains slightly higher rms velocities while reducing the extremes suggests that it might both retain a higher resolving power while mitigating the influences of outliers .",
    "we have described a method for deriving flows from sets of images obtained by a variety of solar imagers .",
    "the opflow3d procedure has been shown to extract accurate velocity estimates when provided perfect test data and quickly generates results consistent with completely distinct methods when applied on global scales .",
    "we have also verified that it agrees in detail with an established method when applied to high - resolution datasets  and without the need to tune , filter or otherwise preprocess the images before its application .",
    "it is currently running as part of the hek system to identify regions of solar eruptions @xcite from data collected by the atmospheric imaging array on sdo @xcite .",
    "our method has been found to work well on other types of image data , including magnetograms , since the only assumptions made are that the motions displayed in them are reasonably smooth and persistent .",
    "it can also be combined with other image processing methods to extract motions of specific features within the field .",
    "for instance the motion of the two polarities ( north / south ) in magnetograms could be tracked by thresholding the images prior to using opflow3d .",
    "similarly , particular scales could be extracted by using high- or low - pass filters .    with the basic approach established ,",
    "there are several avenues for improvement .",
    "first , we could replace the model equation ( [ eq : advect ] ) with a more elaborate one , say one that solves the vertical component of the induction equation to extract velocities from sets of magnetograms .",
    "second , we could provide a more elaborate fitting function , say one that permits a simple time dependence .",
    "finally one can seek to optimize the method using more sophisticated tools of linear algebra .",
    "we will explore some of these options in future work .",
    "we are grateful to k. schrijver , r. shine , t. tarbell , a. title and t. berger for their helpful conversations and comments .",
    "this work has been supported by the national aeronautics and space administration through contracts nas8 - 39746 and nas5 - 3077 and by lockheed - martin independent research funds .",
    "cochran , w. , plemmons , r. and torgersen , t. , exploiting toeplitz structure in atmospheric image restoration in structured matrices in mathematics , computer science , and engineering ii , ed by v. olshevsky , proc ams - ims - siam ( 1999 )                        negahdar , m. and amini , a.,a 3d optical flow technique based on mass conservation for deformable motion estimation from 4-d ct images of the lung , proc .",
    "spie 8317 , medical imaging 2012 : biomedical applications in molecular , structural , and functional imaging ( march 2012 )",
    "november , l.j . ,",
    "simon , g.w . ,",
    "tarbell , t.d . ,",
    "title , a.m. and ferguson , s.h .",
    "`` large - scale horizontal flows from soup observations of solar granulation , '' in _ theoretical problems in high resolution solar physics _ , ( nasa / gsfc , 1987 ) eds . g. athay and d.s .",
    "spicer , p121 .",
    "scherrer , p. h. , bogart , r. s. , bush , r. i. , hoeksema , j. t. , kosovichev , a. g. , schou , j. , rosenberg , w. , springer , l. , tarbell , t. d. , title , a. , wolfson , c. j. , zayer , i. & the mdi engineering team , `` the solar oscillations investigation - michelson doppler imager , '' solar phys.,*162*,129 ( 1995 ) .",
    "simon , g.  w. , title , a.  m. , topka , k.  p. , tarbell , t.  d. , shine , r.  a. , ferguson , s.  h. , zirin , h. and the soup team , `` on the relation between photospheric flow fields and the magnetic field distribution on the solar surface , '' _ astrophys .",
    "j. _ , * 327 * , 964 ( 1988 )"
  ],
  "abstract_text": [
    "<S> we present a method for determining surface flows from solar images based upon optical flow techniques . </S>",
    "<S> we apply the method to sets of images obtained by a variety of solar imagers to assess its performance . </S>",
    "<S> the opflow3d procedure is shown to extract accurate velocity estimates when provided perfect test data and quickly generates results consistent with completely distinct methods when applied on global scales . </S>",
    "<S> we also validate it in detail by comparing it to an established method when applied to high - resolution datasets and find that it provides comparable results without the need to tune , filter or otherwise preprocess the images before its application .    </S>",
    "<S> example.eps gsave newpath 20 20 moveto 20 220 lineto 220 220 lineto 220 20 lineto closepath 2 setlinewidth gsave .4 setgray fill grestore stroke grestore </S>"
  ]
}