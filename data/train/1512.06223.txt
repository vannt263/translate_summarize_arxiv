{
  "article_text": [
    "magnetic resonance imaging ( mri ) plays a crucial role in quantitatively measuring the differences in anatomical structures between either individuals or groups . in many clinical studies ,",
    "the hippocampal volumetry from mri is one of the bio - markers used to examine the diagnosis of alzheimer disease ( ad )  @xcite .",
    "volumetric hippocampal measurements are the best predictors of ad conversion in subjects with mild cognitive impairment  @xcite .",
    "manual volumetry is considered the gold standard , but it is time consuming .",
    "consequently , many automatic approaches have been proposed to extract hippocampal structures from brain mri . among them , atlas - based methods have been demonstrated to outperform other algorithms  @xcite . in the context of this study ,",
    "an atlas is an image in one modality with its respective labeling ( typically generated by manual segmentation )  @xcite .",
    "atlas - based segmentation is motivated by the observation that segmentation strongly correlates with the context information . after warping the atlas to the target image",
    ", context is directly transferred from the atlas to the target image . in medical images ,",
    "context plays a very important role because the anatomical structures are primarily constrained to relatively fixed positions",
    ".    however , the disease status of the subject - atlases used in this approach may affect the quality of the results .",
    "therefore , atlases should be customized for pathological studies .",
    "there are atlases in epilepsy  @xcite and in ad  @xcite for hippocampal segmentation , which capture the significant morphological variations that occur in both disease processes .    assuming that manual labeling is the ground truth , the errors produced by atlas - based segmentation can be primarily attributed to the registration step .",
    "segmentations with a single atlas are intrinsically biased toward the shape and the appearance of a subject  @xcite .",
    "several studies have shown that approaches that incorporate the properties of a group of atlases outperform the use of a single atlas  @xcite .",
    "multi - atlas segmentation is a popular approach for labeling anatomical structures from medical images .",
    "a subset of atlases within a database are registered to a target image , and their segmentations can be transformed and subsequently fused to provide a consensus segmentation .",
    "the main benefit of the multi - atlas label fusion is that the effect of errors associated with any single atlas propagation can be reduced in the process of combination .",
    "the main drawback of this approach is its computational complexity .",
    "indeed , the computational time for segmentation increases linearly with the number of atlases that have to be registered .",
    "although the availability and low cost of multi - core processors are making this approach more feasible , an atlas selection is generally required such that the number of atlases is as low as possible so that no further improvement is expected when adding more atlases  @xcite .",
    "furthermore , a label fusion method is also required to obtain the resulting segmentation .",
    "this paper is focused on the label fusion problem .",
    "the label fusion methods have been classified into two categories : global weighted voting and local weighted voting .",
    "most existing label fusion methods are based on global weighted voting , such as majority voting  @xcite ( mv ) , staple  @xcite or weighted voting ( wv )  @xcite , which are widely used in medical image segmentation . in these approaches",
    ", each atlas contributes to the resulting segmentation with the same weight for all of its voxels .",
    "it is very sensitive to registration errors because it does not take into account the relevance of each sample .",
    "recent works have shown that local weighted voting methods outperform global methods  @xcite .    moreover , the errors differ if the registration is affine or non - rigid . in affine transformations ,",
    "the structures of the target image and the atlases are only aligned in position , orientation and scale , but the context information of the aligned atlas is preserved in the domain of the target image .",
    "however , the atlases are typically warped to the target image using non - rigid registration techniques .",
    "this approach presents the advantage of forcing the resulting segmentation to have a similar global shape to those of expert - labeled structures in the atlases . in these approaches",
    ", there is a one - to - one mapping between the target image and each atlas .",
    "the major drawback of applying non - rigid registration to the atlases is the smoothing of the transferred labels . indeed , because of the regularization constraints involved in these registrations , some details can be lost , and the local high variability can not be captured .",
    "we propose combining the information from the registered atlases by means of an affine as non - rigid registrations .    in atlas - warping by non - rigid registrations ,",
    "label fusion methods generally calculate the labels associated with the target image via maximum a posteriori ( map ) estimation  @xcite .",
    "a statistical model is constructed from the registered atlases , which is normally decomposed into an appearance model and a shape prior term .",
    "appearance models are able to combine many of the local intensity statistics",
    ". these models have difficulty in taking the regional information into account .",
    "for this reason , appearance models are joined with shape prior models .",
    "the map inference can be obtained via expectation maximization  @xcite or by transforming the labeling problem in terms of energy minimization  @xcite .",
    "patch - based label fusion methods have shown great potential using only affine registrations  @xcite .",
    "rather than fusing label maps as in multi - atlas segmentation , this framework is based on the non - local mean principle  @xcite .",
    "each voxel is represented by a small image patch .",
    "similar patches on each atlas image are aggregated to a reference voxel in the target image based on the non - local mean .",
    "the more similar a patch of a voxel in an atlas image is to a reference voxel in the target image , the higher is the weight that is used to propagate its labeling to the reference voxel in the target image .",
    "all selected patches from a subset of atlases with their weighed labelings are fused to estimate the labeling of the reference voxel .",
    "these methods exhibit two interesting properties : ( i ) this approach drastically increases the number of samples considered during the labeling estimation , and ( ii ) the local intensity context ( i.e. , patch ) can be used to produce a robust comparison among samples  @xcite .",
    "therefore , the usual assumption of one - to - one mapping in the label fusion using non - rigid registrations is relaxed by using local search windows .",
    "although these methods are powerful , they highly depend on the intensity - based similarity measures between patches . for selected patches with similar appearance according to the similarity measures used , their corresponding labelings may be very different .",
    "image similarities over small image patches may not be an optimal estimator  @xcite .",
    "moreover , the labeling is local and independent , without global constraints . to overcome these drawbacks ,",
    "asman and landman  @xcite have proposed an iterative algorithm between the estimation of the labeling and the weights of the patches that maximizes the expected value of a conditional likelihood function .",
    "alternatively , we propose an algorithm without iterations .",
    "an estimate of the labeling with constraints in the shape priors is inferred by a label fusion method based on non - rigid registrations .",
    "then , a patch - based labeling method is applied , which selects the patches , and their weights are calculated using similarity measures of the intensities and binary labelings .",
    "these combined similarity measures produce better selection of the patches , and their weights are more robust , which improves the segmentation results compared to other existing approaches .    in this paper , brain mri are used to validate the proposed framework",
    ". these images generally show different structures of interest to be segmented .",
    "therefore , a region - wise approach is more appropriate  @xcite , which can be achieved by dividing the image into multiple anatomically meaningful regions  @xcite . once the regions of interest ( rois ) are defined , a ranking of atlases is calculated for each roi  @xcite , and the selected registered atlases are fused into each roi of the target image . partitioning the problem in rois improves the registration and segmentation results .",
    "indeed , the multi - atlas approaches have greater accuracy when the registrations are only made near the object of interest and not in the entire image  @xcite .",
    "furthermore , these approaches convert the complex multi - label problem into feasible binary segmentation problems .",
    "finally , we test different label fusion methods on publicly available mri of human brains .",
    "we demonstrate that our approach produces as good or even better automatic segmentations than other label fusion methods .",
    "+ the remainder of this paper is organized as follows . in section 2 ,",
    "the proposed method of combining a patch - based labeling method with an atlas - warping using non - rigid registrations is presented .",
    "the experiments and results for the hippocampal segmentation are described in section 3 .",
    "the discussion and conclusions are presented in section 4 .",
    "we propose a patch - based labeling method that cooperates with atlas - warping using non - rigid registrations .",
    "first , a subset of @xmath0 atlases are registered non - rigidly into the target image , and then a label fusion method is applied .",
    "the label fusion method is based on minimizing a pseudo - boolean function using graph cuts with information of appearance , shape and context  @xcite .",
    "then , a patch - based labeling method is applied using the above segmentation of the target image .",
    "the patches of another subset of @xmath1 atlases , which are registered by affine transformations , are pre - selected with a structural similarity measure that takes into account both the intensity and the labeling of the candidate patches . from the selected patches ,",
    "a multi - point label estimation is calculated for each voxel that belongs to the target image .",
    "the weights of the selected patches are computed from a combination of @xmath2-norm measures between patches using intensity - based distances and labeling - based distances .",
    "the following paragraphs explain the methods used and how they work together .      given a roi of the target image @xmath3 ,",
    "a subset of @xmath0 atlases @xmath4 are used for the label fusion method using non - rigid registrations , where @xmath5 are the modality images and @xmath6 are the label maps . in the labeled images , voxels that belong to the anatomical structure of interest are designated by the label @xmath7 and background voxels are designated by the label @xmath8 .",
    "we denote @xmath9 as the spatial mapping from the target image coordinates to the coordinates of the @xmath10th atlas . for simplicity",
    ", we assume that @xmath11 have been pre - computed using a pairwise registration procedure .",
    "this assumption allows us to shorthand @xmath12 as the atlases into the coordinates of the target image .",
    "we seek to minimize an energy function under the bayesian formulation , which defines the conditional probability as a discrete random field @xmath13 with a neighborhood system @xmath14 .",
    "the neighborhood system @xmath14 is the set of edges that connect variables in the random field .",
    "a conditional random field model  @xcite ( crf ) is defined by the following pseudo - boolean function :    @xmath15    where @xmath16 are the model parameters for this roi and @xmath17 is a tunable parameter that determines the trade - off between the unary and pairwise potentials .",
    "we next define the form of the two potential functions and their parameters .      the unary potentials @xmath18 use the bayesian formulation , which allows prior information about the shape and appearance of structures to be segmented to be incorporated in the model .",
    "we assume that the observed intensities of @xmath3 are independent random variables .",
    "the image likelihood @xmath19 can then be written as a product of the likelihoods of the individual voxels :    @xmath20    a discriminative appearance model with low computational effort is selected .",
    "the registered atlas images are convolved with a filter - bank .",
    "a set of feature extraction kernels @xmath21 are used to produce different feature maps :    @xmath22    where @xmath23 is the dimension of the feature vector and @xmath24 denotes the resulting feature vector of @xmath25 at voxel @xmath26 associated with the filter @xmath27 . in this paper ,",
    "derivatives of gaussians  @xcite and 3d steerable filters  @xcite are adopted to extract features ( for further details , see section [ subsec : ds ] ) .",
    "the responses for all registered atlas image voxels are whitened separately ( to provide zero mean and unit covariance ) .",
    "these feature vectors are used to train a @xmath28-nearest neighbor ( @xmath28-nn ) appearance model . for computational efficiency",
    ", we use the @xmath28d - tree algorithm  @xcite to perform the nearest neighbor search .",
    "a @xmath28d - tree model is constructed with @xmath29 .",
    "the target image is also convolved and whitened .    for each label @xmath30 , we consider @xmath31 as the set of feature vectors extracted from the voxels that belong to the registered atlas images and whose labels are @xmath32 .",
    "let @xmath33 be the set whose elements are nearest neighbors to @xmath34 and @xmath35 be the set of the indices of the feature vectors with label @xmath32 that are nearest neighbors to @xmath34 .",
    "the image likelihoods of the individual voxels that belong to the target image are calculated using the following formula :    @xmath36      the label prior probability @xmath37 models the joint probability of all voxels that belong to the roi in a particular label configuration .",
    "however , we assume that the prior probability that voxel @xmath26 has label @xmath32 only depends on its position , the similarity between @xmath3 and @xmath25 and the transferred atlas - labeled images :    @xmath38    this assumption is not realistic , but we encode the correlations of the labels using pairwise potentials . for each voxel @xmath26 and each label @xmath30 ,",
    "we define : @xmath39    where @xmath40 , @xmath41 is a local or global similarity measure between the target image and the registered atlas image at @xmath26 , and @xmath42 is an associated gain exponent  @xcite . the prior probability is defined as    @xmath43    the image likelihood and label prior terms are combined to define the unary potentials @xmath18 : @xmath44      following the work of song et al .",
    "@xcite , a smoothness term is added to the energy function .",
    "these authors combined intensity and local boundary information into the pairwise potentials , which have been successfully applied for brain segmentation .",
    "these pairwise potentials take the form of a contrast - sensitive potts model : @xmath45 where @xmath46    where @xmath47 with a normalization factor @xmath48 .",
    "@xmath49 is a line that joins @xmath26 and @xmath50 , and @xmath51 is the robust scale of image @xmath3 .",
    "the parameter @xmath52 controls the influence of the boundary - based and intensity - based parts .",
    "given a subset of the aligned atlases in a roi of the target image using affine transformations , each voxel @xmath26 in @xmath3 is correlated to each voxel @xmath50 in @xmath25 with a weight of @xmath53 . in the conventional method , the weights are defined by intensity - based similarity measures between patches . a patch - based representation is extracted using a sub - volume centered at @xmath26 from the target image or the aligned atlas .",
    "these signatures are denoted by @xmath54 and @xmath55 , respectively .",
    "the signature difference between a reference voxel @xmath26 and a voxel in an atlas image @xmath50 is used to define @xmath53 :    @xmath56    where @xmath57 denotes the neighborhood of voxel @xmath26 in the atlas images .",
    "the parameter @xmath58 determines how this method assigns the weights for each patch @xmath59 .",
    "we use @xmath58 to show the minimal distance between the target patch @xmath54 and its neighboring patches @xmath59  @xcite .    using these weights",
    ", we can use a single - point model for the label fusion from the atlases , as follows :    @xmath60    where @xmath61 is an estimation of label 1 for every voxel @xmath26 and @xmath1 is the number of the selected aligned atlases used to fuse .",
    "however , because the similarity measure is based on patches , one can obtain a multi - point model for the label fusion  @xcite :    @xmath62    where @xmath63 is a label patch that belongs to the @xmath10th atlas and @xmath64 is a label patch estimation of the target image at @xmath26 , i.e. , for each voxel , a vector of the likelihood for label 1 is calculated .",
    "these estimates are then aggregated using a combination classifier . in this work",
    ", we used the majority voting rule to fuse these estimates .",
    "the label patch estimation provides better results than the single estimation  @xcite .",
    "the similarity measure is the core of the patch - based labeling methods , and this measure is only calculated using intensity - based distances .",
    "the selected patches from the atlases can have similar distances to the patch of the reference voxel , but nevertheless , their label patches may be very different .",
    "in addition , these approaches estimate the labels in a local manner , without global constraints such as the shape priors . to overcome this drawback , a new similarity measure based on the labeling distance",
    "is added .",
    "we consider the label patch as a clique , i.e. , a connected set of voxels , whose labels are conditionally dependent on each other .",
    "a label patch estimation can be inferred by minimizing ( [ eq : crfmodel ] ) using global shape constraints .",
    "next , we add a measure using label - based distances :    @xmath65    where @xmath66 and @xmath67 are defined as the minimal distances between the target patch and its neighboring patches according to the intensities and labelings , respectively ( for further details , see section [ subsec : patch ] ) .",
    "now , the weights of the patches are calculated considering both the local appearance and the global shape . moreover",
    ", this proposal does not require the addition of more tunable parameters compared to the path - based conventional labeling method .",
    "to evaluate the performance and the robustness of the proposed label fusion method , we select hippocampal segmentation because it is one of the most studied problems in the analysis of brain images .",
    "we employ two available databases of t1-weighted ( t1w ) mri : ( i ) 18 modified images from the internet brain segmentation repository ( ibsr )  @xcite and ( ii ) 50 images of epileptic and nonepileptic patients with hippocampal outlines ( hfh )  @xcite .",
    "ibsr contains images of healthy patients with expert segmentation of 43 anatomical structures .",
    "the voxel spacing of these images is 0.9375 x 1.5 x 0.9375 @xmath68 .",
    "in contrast , hfh contains a total of 50 images , which were randomly divided into 25 images used for the training set and the other 25 for the test set .",
    "manual segmentations are only available for the training images .",
    "images were acquired using two mri systems with different field strengths ( 1.5 t and 3.0 t ) and with different resolutions ( 0.78 x 2 x 0.78 @xmath68 and 0.39 x 2 x 0.39 @xmath68 ) .",
    "the proposed segmentation scheme involves four main steps : ( 1 ) mri pre - processing , ( 2 ) spatial normalization and definition of the rois , ( 3 ) the first labeling based on atlas warping using non - rigid registrations and ( 4 ) the final labeling by patches based on similarity measures in intensity and labeling .    during pre - processing of the databases ,",
    "non - brain regions are removed from all structural images . removing non - brain tissue prior to registration",
    "is generally accepted as a means to simplify the inter - subject registration problem and thus increase the quality of the registrations  @xcite .",
    "the images are skull - stripped using bet  @xcite .",
    "then , all images are spatially normalized to a reference atlas using an affine registration . for the ibsr database , cmtk s affine registration tool",
    "is used  @xcite . in hfh , an atlas ( hfh_021 ) is selected as a reference to",
    "which all atlases are then co - registered with an affine transformation using flirt with 12 degrees of freedom  @xcite .",
    "after spatial normalization for both of the databases , a region of interest is defined for each structure studied ( left and right hippocampus ) as the minimum bounding box containing the structure for all of the training atlases expanded by three voxels along each dimension .",
    "the patient image is also processed using a skull - striping filter , and an affine transformation is applied to the common reference space .",
    "then , the normalized patient image is cropped around the structures of interest .    for each roi , the normalized atlas images are first ranked based on their similarity according to the normalized target image using the mutual information ( mi ) measure  @xcite .",
    "then , the @xmath0-selected atlases are registered non - rigidly into the roi of the normalized target image .",
    "next , the registered atlases are fused , and the labeling is calculated using graph cuts based on minimizing the energy function of ( [ eq : crfmodel ] ) .    next , an intensity normalization is applied to the above normalized atlas images using the histogram matching algorithm  @xcite with the roi of the normalized target image as a reference .",
    "now , the sum of the squared difference ( ssd ) measure between each atlas image and the target image is used to rank and select the first @xmath1 atlases .",
    "this measure is chosen because ssd is related to the similarity between patches in intensities .",
    "finally , from the previous labeling of the target image and the @xmath1-selected atlases , the segmentation result is obtained using the proposed patch - based labeling method , and an inverse affine transformation is applied to return the automatic segmentation into the native space of the target image .",
    "[ fig : flowchar_hippo ] shows a flow chart that summarizes the processing of the images .",
    "although in the theoretical framework ( see section [ subsection : crfmodel ] ) , the registrations were performed from the atlases into the target image , there is no loss of generality using the spatial normalization by using affine transformations .",
    "this intermediate step improves the computational efficiency .",
    "furthermore , the ranking of the atlases for both fusion methods is immediately calculated with the spatial normalization .",
    "the normalized atlases are also used to obtain the library of the patches for implementing the patch - based labeling method .      for each database",
    ", a leave - one - out validation strategy is performed to determinate the tunable parameters .",
    "these parameters are varied in certain ranges , and their effects are measured from the overlap between the resulting segmentation and the ground truth .",
    "the dice coefficient  @xcite is chosen as the measure of the segmentation overlaps : @xmath69 , where @xmath70 and @xmath71 represent the automatic and manual segmentation binary images , respectively .",
    "the function @xmath72 indicates the size of 1 in the set . in atlas",
    "warping by non - rigid registrations , the parameters @xmath73 in ( [ eq : crfmodel ] ) of each roi are first learned by piecewise training and then recombined with the tunable weight @xmath17 . with respect to the patch - based labeling method ,",
    "the influence of the patch pre - selection process , the patch and search volume size , the local adaptation of @xmath58 and the number of the fused atlases are studied .",
    "the non - rigid registrations , the atlas selection and the label fusion method have to be investigated to improve the performance of the multi - atlas segmentation approach . for each roi ,",
    "the atlases are ranked based on their similarity according to the target image using mi  @xcite .",
    "once the atlases are ranked , we employ a leave - one - out validation strategy to determinate the number of atlases @xmath0 that are fused to the target image . in our experiments ,",
    "the first @xmath74 atlases more similar to the target image were registered non - rigidly ( @xmath75 )  @xcite .",
    "then , the selected atlases are co - registered non - rigidly to the roi of the target image .",
    "all non - rigid registrations are computed using _ elastix _",
    "@xcite , a publicly available package for medical image registration .",
    "non - rigid registration of images is based on the maximization of mi , in combination with a deformation field parameterized by cubic b - splines  @xcite .",
    "the mi is implemented according to  @xcite , using a joint histogram size of 32 x 32 and cubic b - spline parzen windows .",
    "a unique resolution is employed using a b - spline control point spacing of 3.0 mm in all directions .",
    "to optimize the cost function , an iterative stochastic gradient descent optimizer is used  @xcite . in each iteration ,",
    "2000 random samples are used to calculate the derivative of the cost function .",
    "a maximum of 500 iterations of the stochastic optimization procedure is used .",
    "the above - described settings were determined through trial - and - error experiments on two image pairs .",
    "these parameters of the non - rigid registrations are equally applicable to both databases .    the atlas - labeled images are modeled using the logarithm of odds ( logodds ) formulation , which is based on the signed distance transform  @xcite .",
    "this representation replaces the labels by the signed distances , which are assumed to be positive inside the structure of interest .",
    "we find that the logodds model produces more accurate results compared with trilinear interpolation or nearest - neighbor interpolation for transferring the atlas - labeled images  @xcite .",
    "then , the registered atlases are fused , and the labeling is calculated based on minimizing the energy function of ( [ eq : crfmodel ] ) .",
    "we now examine the impact of the label fusion parameters using atlas - warping by non - rigid registrations . regarding the discriminative appearance model , we have explored three types of feature vectors : derivatives of gaussians , 3d steerable filters and patches .",
    "the filter - banks provided similar results to the patches .",
    "the feature vectors using filter - banks are applied to the images because their dimensions @xmath23 are smaller than patches .",
    "the experimental results lead us to choose a 12-dimensional filter bank , which is applied in the hfh database .",
    "the images are convolved with gaussians at scales of @xmath76 , @xmath77 and @xmath78 ; derivatives of gaussians at scales of @xmath77 and @xmath78 ; and laplacians of gaussians at scales of @xmath76 , @xmath77 and @xmath78  @xcite .",
    "following our experiments , in the ibsr database , a 16-dimensional steerable filter bank is used  @xcite : the 6 basis functions of the second derivatives of gaussian and 10 basic functions of the hilbert transform .",
    "we hypothesize that the difference in the filter bank used in each database is due to the voxel spacing .",
    "the gaussian - based filter bank is better if the voxel spacing is strongly anisotropic .",
    "we choose a k - nn appearance model due to the compromise between performing the estimation and computational efficiency .",
    "this model could be replaced by other discriminative approaches , such as sophisticated randomized trees or boosting - based classifiers .",
    "preliminary results on random forests  @xcite have shown similar results but with a higher computational cost ( note that the discriminative model must also be trained at runtime ) . from the proposed k - nn appearance model and given the feature vector of a voxel belonging to the target image , the training vectors in the @xmath28d - tree that are nearest are found .",
    "these vectors are used to calculate the distances to each label , and then equation ( [ eq : discmodel ] ) is applied for obtaining @xmath79 .",
    "the amount of training data in the discriminative model is often biased toward the background class .",
    "a classifier learned on these data will have a prior preference for this class . to normalize for this bias , we weight each training example by the inverse class frequency .",
    "the classifiers trained using this weighting tend to provide better performance  @xcite .    in the weighted voting method for estimating the label prior probabilities , similarity measures are required between regions of the target image and each registered atlas image , i.e. , @xmath80 in ( [ eq_wv ] ) .",
    "a semi - global strategy is used to calculate the weight for each registered atlas .",
    "this strategy is most appropriate when the contrast between neighboring structures is low , as in the case of the hippocampus  @xcite .",
    "a binary mask is used for measuring this similarity between the target image and the registered atlases .",
    "this mask is constructed by joining all transferred labeled images .",
    "a voxel is considered in the binary mask if at least one vote of the foreground class is received .",
    "because a statistical relationship is assumed among the intensities of these images , mi is used as a similarity measure .",
    "the gain exponent is set to @xmath81  @xcite .",
    "finally , we consider a 3d grid - graph with 26 neighborhood systems in @xmath14 , and @xmath82 is calculated from the derivatives of gaussians at scale @xmath76 for obtaining the pairwise potentials in ( [ eq : song ] ) .",
    "the final trained parameters for both database were @xmath83 , @xmath84 ( ibsr ) , and @xmath85 ( hfh ) .",
    "a subset of the target image domain @xmath86 is considered to accelerate the patch - based labeling method  @xcite .",
    "a binary mask is given with the union of all transferred labeled images using non - rigid registrations , @xmath87 .",
    "figure  [ fig : compdomain ] shows the first advantage of the collaboration between the atlas - warping by non - rigid registrations and the patch - based labeling method . when the domains @xmath88 are calculated using non - rigid registrations , rather than using affine transformations as  @xcite , the overlap between @xmath89 and the ground - truth segmentation @xmath90 is increased ( i.e. , @xmath91 is higher ) and the volume of @xmath92 decreases with respect to the manually labeled hippocampal volumes ( i.e. , @xmath93 $ ] is lower ) . in this experiment ,",
    "two conclusions were drawn : a ) because @xmath88 obtained by the non - rigid registrations are more robust than those obtained by affine transformations , the success rates of the labelings are increased , and b ) the computational time of the patch - based labeling method is reduced by having fewer voxels with uncertainty in their labels .     between affine transformations ( a ) and non - rigid registrations ( nr ) for the ibsr and hfh datasets .",
    "for the left ( lh ) and right ( rh ) hippocampus , the first row plots the distribution of @xmath91 , where @xmath94 is the ground - truth segmentation .",
    "the second row plots the distribution of @xmath95 $ ] .,height=226 ]    an atlas selection is also used to identify a subset of the normalized atlases to the normalized target image by affine transformations .",
    "first , the image intensities are normalized through histogram matching .",
    "then , the ssd measure in @xmath88 between each atlas image and the target image is used to rank the atlases .",
    "a compromise between the performance of the patch - based labeling method and computational efficiency is to choose the first 10 atlases that most resemble the target image  @xcite ( @xmath96 ) .",
    "next , for each voxel in @xmath88 and whose label is uncertain , a patch pre - selection is used to accelerate the label fusion procedure and to improve the robustness of label fusion by excluding the unrelated patches  @xcite .",
    "the pre - selection process uses a modified version of the well - know structural similarity measure  @xcite .",
    "we consider a similarity measure that takes both the intensity and the labeling of the candidate patch into account :    @xmath97    where @xmath98 and @xmath99 are the mean and standard deviation of the target patches @xmath54 and @xmath64 , respectively .",
    "similarly , @xmath100 and @xmath101 are the mean and standard deviation of the candidate patch @xmath59 and @xmath63 belonging to the @xmath10th selected atlas .    in the conventional patch - based labeling method ,",
    "if the value of a similarity measure is larger than a given threshold @xmath102 , the candidate patch is selected  @xcite . to avoid adding more tuning parameters in our proposed approach , we consider a candidate patch if our similarity measure is greater than @xmath103 , @xmath104 .",
    "we evaluated the label fusion accuracy when applying different thresholds during the pre - selection .",
    "the value of @xmath102 was varied from @xmath105 to @xmath106 , showing no significant improvement in the label fusion accuracy . in all experiments",
    ", we set the similarity threshold as @xmath107 . on overage ,",
    "thousands of patches of the selected aligned atlases are used to calculate the non - local mean label fusion in every voxel .",
    "figure  [ fig : patchdistrib ] shows the distributions of the number of selected patches according to the ranking of the aligned atlases .",
    "a comparison between the conventional and proposed patch pre - selection procedures is shown .",
    "the number of selected patches with our similarity measure is approximately one - third less than that of the conventional method .",
    "our proposal selects more patches than the conventional pre - selection process and also improves the robustness of label fusion by excluding the patches whose labelings are not similar to the labeling of the target voxel .",
    "our approach allows geometrical constraints , such as shape priors , to be imposed due to the labeling obtained by the atlas warping using non - rigid registrations .",
    "indeed , the selected patches show similarity in appearance and labeling according to the target voxel .",
    "this is the second advantage of the collaboration between the atlas - warping by non - rigid registrations and the patch - based labeling method .",
    ".,height=226 ]    the impacts of the patch size and the search volume size must be investigated .",
    "the patch size is related to the complexity of the anatomical structure , and the search volume size reflects the anatomy variability of the structure of interest  @xcite .",
    "these parameters are normally defined with a @xmath108 cube - shaped neighborhood by the radius @xmath109 . in the case of the hippocampal segmentation ,",
    "coupe et al .",
    "@xcite have reported a patch size of @xmath110 voxels and a search volume of @xmath111 .",
    "wang et al .",
    "@xcite and tong et al .",
    "@xcite have proposed a patch size of @xmath112 and a search volume size of @xmath110 , whereas rousseau et al .",
    "@xcite have used a patch size of @xmath113 and a search volume size of @xmath114 .    because the voxel spacing of brain t1w - mri is not the same in all components ( particularly in the hfh database )",
    ", we analyze this parameter by taking into account the values in each direction .",
    "now , we use a cuboid - shaped patch , which is expressed the radius @xmath109 in millimeters , and the patch size and the search volume size are defined by    @xmath115    where @xmath116 rounds @xmath26 to toward plus infinity of the nearest integer .",
    "figure  [ fig : rpps ] shows the dice distributions over varying patch and search volume sizes on both datasets .",
    "the last three above - standard cube - shaped patches are used . by contrast , the cuboid - shaped patch is defined by @xmath117 or @xmath77 mm in the path size and @xmath118 or @xmath119 mm in the search volume size .",
    "the comparison between the cube - shaped patch and the cuboid - shaped patch shows improvement when the patch size and the search volume size consider the voxel spacing .     or @xmath77 mm in the path size with a search volume size of @xmath120 mm .",
    "the second row shows the impact of search volume size with a constant path size : @xmath118 or @xmath119 mm in the search volume size with a path size of @xmath117 mm .",
    "the standard cube - shaped patches are also plotted and compared with our proposal . in hfh data",
    ", images are first subsampled by a factor of two in the @xmath121 plane to reduce the computation time .",
    "preliminary experiments showed that using the full - resolution data increased the computation times and negligibly improved the results.,height=226 ]    the parameter @xmath58 of ( [ eq : convpacth ] ) plays a crucial role in the weighting of the selected patches .",
    "when @xmath58 is low , only a few samples are taken into account .",
    "if @xmath58 is high , all selected patches tend to have the same weight , and the estimation is similar to a classical average .",
    "we use a modified version of @xmath58  @xcite , which estimates @xmath58 based on the minimal distance between the target patch @xmath54 and its neighboring patches @xmath59  @xcite .",
    "a smoothing parameter @xmath122 is added to the estimation of @xmath58 , which depends on the noise level .",
    "the parameter @xmath122 is common in image denoising tasks with the non - local mean principle  @xcite or in the kernel used by rousseau et al .",
    "@xcite in their patch - based labeling method . for low levels of noise in images ,",
    "the best value of @xmath122 is close to @xmath123 . for high levels of noise ,",
    "this value is @xmath76  @xcite . considering the above",
    ", we define @xmath124 and @xmath125 of ( [ eq : mixpacth ] ) as :    @xmath126    where @xmath127 and @xmath128 are small constants to ensure numerical stability in case the patch under consideration is contained in its neighboring patches .",
    "the value of @xmath129 is set to @xmath123 and @xmath76 for @xmath130 .",
    "the aligned atlas images are considered to have low noise , but not the results of the label fusion method using non - rigid registrations , i.e. , the similarity measures between labelings are considered to have a high noise level to relax restrictions imposed by the labeling obtained by the atlas warping .    because the registered atlases using non - rigid registrations to the target image are available , we explore the possibility of replacing the affine transformations by non - rigid registrations for obtaining the library of the training patches .",
    "figure [ fig : compaffinernr ] shows that the results with the dice distributions in both datasets are worse using the non - rigid registrations than those using affine transformations . we believe that the reason for this result is that the context information is better represented using patches with affine transformations than non - rigid registrations .",
    "moreover , the proposed combination increases the robustness using information that is less correlated because the algorithm employs both aligned atlases as the registered atlases .",
    "we compare our results with those obtained other label fusion methods .",
    "five label fusion methods are chosen : staple , majority voting ( mv ) and the three methods that we have used from our framework ( the conventional patch - based labeling method  @xcite , the non - rigid registration - based label fusion method and the proposed combined method ) .",
    "for each of the methods in the experiments , we report the dice coefficient as a segmentation quality measure . table  [ table : comp_labelfusion ] shows the quantitative segmentation results for each label fusion method and each roi in the ibsr and hfh databases .",
    "as previously reported in  @xcite , staple does not necessarily lead to higher dice coefficients compared to the majority voting rule .",
    ".average values and standard deviations of the dice coefficient for all images belonging to the ibsr and hfh databases using a ) staple , b ) majority voting rule , c ) the conventional patch - based labeling method , d ) the non - rigid registration - based label fusion method and e ) the proposed method . [ cols=\"<,^,^,^\",options=\"header \" , ]",
    "in this work , we developed a patch - based labeling method that cooperates with atlas - warping using non - rigid registrations .",
    "first , a labeling of the target image is inferred with atlas - warping by non - rigid registrations .",
    "then , a patch - based label fusion method is applied , whose patches and weights are computed from a combination of similarity measures between patches using intensity - based distances and labeling - based distances , where the labeling distances are calculated from the previous binary labeling of the target image by atlas - warping using non - rigid registrations .",
    "the patch - based labeling methods have the advantages of considering multiple samples during the labeling estimation and the local context is well represented by the patches , particularly with affine transformations .",
    "in contrast , the label fusion methods using non - rigid registrations lead to segmentations with shape prior constraints . when the delineation of the anatomical structures do not rely on intensity contrast , as in the case of hippocampal segmentation , the conventional patch - based labeling is not sufficient for obtaining good results .",
    "we have experimentally observed that the collaboration between these two approaches through the addition of a similarity measure based on the distance between binary labeling produces higher quality segmentations .    the collaboration between the two methods is given in the following levels : ( 1 ) the sub - domain considered to accelerate the algorithm , @xmath88 , generated by non - rigid registrations is smaller and has more overlap with the manual segmentation than that obtained by affine registrations .",
    "the consequence is a higher computational efficiency due to the smaller size of @xmath88 and improved segmentation results by increasing the overlapping between the union of the transferred labeled atlases and the ground - truth segmentations .",
    "( 2 ) the pre - selection of the patches in the atlases are improved by adding similarity measures based on both the intensity and labeling of the candidate patches . in our experiments , we observe that the numbers of selected patches with our similarity measure are approximately one - third less than that with the conventional method without adding any additional parameter to tune .",
    "( 3 ) the weights of our selected patches are also more robust through the addition of label - based distances .",
    "the segmentation results are the best compared to other label fusion methods , including the conventional patch - based labeling method .",
    "moreover , our proposed method does not require further tuning parameters compared to the conventional patch - based methods , neither in the selected patches nor in calculating the weights .",
    "( 4 ) in the conventional patch - based labeling method , there are no global constraints .",
    "both in the pre - selection patch process and in determining their weights , our approach imposes geometrical restrictions , such as shape priors , using similarity measures based on binary labeling .",
    "( 5 ) we observe that an improvement in the segmentation results using the label fusion method with non - rigid registrations becomes an improvement of the proposed method .",
    "this is a consequence of improvement in the selection and the robustness weights of the patches .",
    "( 6 ) the spatial normalization of the atlases and the target images into a reference makes the work - flow very efficient . the ranking of the atlases for both fusion methods and the library of the patches are obtained from the spatial normalization . in the first version of our sources , without the optimized code and only parallelization of the non - rigid registration task and the patch - based labeling , our proposal takes an average of approximately 3 and 6 minutes for segmenting the left and right hippocampus on images belonging to the ibsr and hfh databases , respectively .",
    "finally , we also propose a type of patch adapted to the voxel spacing that provides better results than standard solutions , which uses a cube shape .",
    "the scripts used in this study are available at https://www.nitrc.org / projects / lf_patches/.    in this paper , the patch - based labeling method is based on similarity measures of intensities and labeling .",
    "a new strategy of patch - based labeling has been proposed using the minimal reconstruction error  @xcite .",
    "the patch library of the aligned atlases is considered as a dictionary , and the target patch is modeled as a sparse linear combination of the atoms in the dictionary .",
    "an extension of the patch reconstruction can be achieved by adding the inferred labeling from the label fusion using non - rigid registrations , in the same manner as performed on the similarity measures .",
    "another limitation in this work is that the weights of the patches have been computed independently for each aligned atlas , without taking into account the fact that the selected atlases may produce similar label errors due to a high correlation between them .",
    "wang et al .",
    "@xcite proposed that the weighted voting is formulated in terms of minimizing the total expectation of labeling error and in which pairwise dependency between atlases is explicitly modeled as the joint probability of two atlases , creating a segmentation error at a voxel .",
    "we leave these two themes ( i.e. , the minimal reconstruction error and the pairwise dependency between the patches of the atlases ) for future work .      [ 2][]#2 [ 2]#2 , , , , , , et  al . .",
    ", , , , . .",
    ", , , , , , et  al . .",
    ", , , , , , et  al . .",
    ", , , , . .",
    ", , , , , , et  al . .",
    ", , , , , , et  al . . ;",
    "( ): . , , , , .",
    ", , , , . .",
    ", , , , , , et  al . .",
    "; ( ): . , .",
    "( ): . , , , , .",
    "( ): . , , , , , , et  al . . ; ( ):",
    ", , , , . .",
    ", , , , , . .",
    ", , , , , , et  al . .",
    "in : . ; , p. .",
    ", , , , , , et  al . .",
    "; ( ): . , .",
    ". ; ( ): . , , .",
    "( ): . , , , , , .",
    "( ): . , , , , .",
    "; ( ): . , .",
    ", , , , , . .",
    "; ( ): . , .",
    "( ): . , , .",
    ". in : . , p. . ,",
    "; ( ): . , .",
    ". in : ; vol .",
    "; , p. . , . .",
    "( ): . , , , .",
    ", , , , , , et  al . .",
    "; ( ): . . . ;",
    "( ): . , , .",
    "( ): . , , , .",
    ". ; ( ): . ,",
    ". ; ( ): . , , , , .",
    "( ): . , , , , , .",
    "( ): . , , .",
    ", , , , , , et  al . .",
    "in : . ; , p. . .",
    ". ; ( ): . , , .",
    ", , , , , . .",
    ", , , , , . .",
    "; ( ): . , .",
    "( ): . , , , .",
    ", , , , , , et  al . .",
    ", , , , , . ."
  ],
  "abstract_text": [
    "<S> the objective of this study is to develop a patch - based labeling method that cooperates with a label fusion using non - rigid registrations . </S>",
    "<S> we present a novel patch - based label fusion method , whose selected patches and their weights are calculated from a combination of similarity measures between patches using intensity - based distances and labeling - based distances , where a previous labeling of the target image is inferred through a label fusion method using non - rigid registrations . </S>",
    "<S> these combined similarity measures result in better selection of the patches , and their weights are more robust , which improves the segmentation results compared to other label fusion methods , including the conventional patch - based labeling method . to evaluate the performance and the robustness of the proposed label fusion method , we employ two available databases of t1-weighted ( t1w ) magnetic resonance imaging ( mri ) of human brains . </S>",
    "<S> we compare our approach with other label fusion methods in the automatic hippocampal segmentation from t1w - mri .    </S>",
    "<S> our label fusion method yields mean dice coefficients of 0.847 and 0.798 for the two databases used with mean times of approximately 180 and 320 seconds , respectively . </S>",
    "<S> the collaboration between the patch - based labeling method and the label fusion using non - rigid registrations is given in the several levels : ( a ) the pre - selection of the patches in the atlases are improved , ( b ) the weights of our selected patches are also more robust , ( c ) our approach imposes geometrical restrictions , such as shape priors , and ( d ) the work - flow is very efficient . </S>",
    "<S> we show that the proposed approach is very competitive with respect to recently reported methods .    atlas - based segmentation , image registration , patch - based label fusion , hippocampal segmentation , magnetic resonance imaging </S>"
  ]
}