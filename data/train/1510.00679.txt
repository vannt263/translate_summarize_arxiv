{
  "article_text": [
    "longitudinal - space - charge - driven micro - bunching instabilities arising in bunch compressors were predicted and observed over the last decade  @xcite . it was recently proposed to employ such micro - bunching instability mechanism to form attosecond structures on the bunch current distribution for the subsequent generation of coherent radiation pulses  @xcite .",
    "a possible beam line configuration capable of enabling the micro - bunching instability is relatively simple .",
    "it essentially consists of focusing section ( e.g. fodo cells ) where energy modulations due to the lsc impedance accumulate , followed by a longitudinally - dispersive section .",
    "the latter section , by introducing an energy dependent path length , converts the incoming energy modulation into a density modulation .",
    "such an elementary cell is often referred to as a lsc amplifier ( lsca ) .",
    "most of the beamlines studied so far consider a longitudinally - dispersive section arranged as a bunch compression chicane [ or bunch compressor ( bc ) ] ; see fig .",
    "[ lsca - layout ] .",
    "several of these lsca modules are concatenated so to result in a large final density modulation .",
    "we further assume the compression process in the chicane is linear [ the incoming longitudinal phase space ( lps ) does not have any nonlinear correlations ] .",
    "such a modulated beam , when participating in a radiation - generation process , can produce coherent radiation at wavelengths comparable to the spectral range of the final density modulations .",
    "overview of a cascaded longitudinal - space - charge amplifier ( lsca ) composed of several lsca modules .",
    "each lsca module incorporate a focusing channel and a longitudinally dispersive section .",
    "the ( red ) rectangles and ( blue ) ellipses respectively represent dipole and quadrupole magnets . ]",
    "the purpose of this paper is two - fold .",
    "the paper first introduces a fully three dimensional ( 3d ) multi - scale space - charge algorithm adapted from astrophysics  @xcite .",
    "the algorithm is used to discuss some limitations of the one - dimensional lsc impedance model commonly employed in lsca investigations . using the latter benchmarked algorithm",
    ", we then investigate a possible lsca beamline configuration similar to the one studied in  @xcite .",
    "finally , we estimate the generation of undulator radiation seeded by the lcsa .",
    "in contrast to ref .",
    "@xcite our study consider the case of a @xmath1  a 300-mev electron beam produced in a conventional superconducting linac .",
    "charged - particle beams are subject to self interaction via velocity and radiation fields . in absence of radiation processes",
    "( i.e. acceleration ) , the effect of velocity fields ( i.e. space charge ) dominates and its regime varies with the bunch density . under a simple 1d approximation , a comparison of the debye length @xmath2 to the root - mean - squared ( rms ) transverse beam size @xmath3 and mean inter - particle distance @xmath4 ( where @xmath5 is the electronic density ) provides a criterion to assess the importance of space charge effects on the beam dynamics .",
    "when @xmath6 space charge effects are significant and often computed using the mean - field approximation ( i.e. the space charge force is derived from the electrostatic potential associated to the particle distribution ) commonly implemented in particle - in - cell ( pic ) algorithms . however , when @xmath7 , particle - to - particle `` binary '' interactions play an important role and are needed to be accounted for  @xcite .    as the beam is accelerated the transverse and longitudinal space - charge forces reduce respectively as @xmath8 and @xmath9 where @xmath10 is the lorentz factor . at the macroscopic level ,",
    "e.g. for spatial scale comparable to the bunch sizes , the space charge can be accurately described by a mean field approach  @xcite .",
    "however , in high - brightness beams @xmath11 beams with low fractional momentum spread @xmath11 the weakened longitudinal - space charge ( lsc ) force can still influence the beam dynamics at a microscopic level @xmath11 i.e. for spatial scales smaller than the bunch sizes @xmath11 and small density modulations ( e.g. due to noise or imperfections ) can result in lcs - driven energy modulations . in this latter regime ,",
    "the lsc is generally treated with a one - dimensional ( 1d ) model .    to illustrate the main results of the 1-d model",
    ", we consider a simple beam line consisting of a drift with length @xmath12 ( where the beam is transversely contained ) followed by a chicane with longitudinal dispersion @xmath13 .",
    "it is customary to characterize the strength of the micro - bunching instability by associating the density gain defined as @xmath14 where @xmath15 and @xmath16 is the observation wavelength and @xmath17 are respectively the initial and final bunching factors defined as @xmath18 where @xmath19 is the temporal coordinate of the @xmath20-th macroparticle , @xmath0 is the total number of particles and @xmath21 . in the latter equation",
    "we assume the beam s longitudinal density to follow the klimontovich distribution @xmath22 .",
    "the gain for this simple beam line can be shown to be proportional to the impedance @xmath23 @xcite following @xmath24 where @xmath25  ka is the alfvn current , @xmath26 is the rms fractional energy spread , @xmath27 is the chirp , and @xmath28 is the free - space impedance .",
    "the exponential term in eq .  [ gaineq ] induces a high - frequency cut - off of the modulation @xmath29 note , that after traveling through a bc , the modulation wavelength will be shortened by a compression factor @xmath30 .",
    "although the impedance @xmath23 is partially determined by the properties of the wakefields inside the bc  @xcite , the lsc has much stronger effect in amplifying density modulations  @xcite .    for a transversely gaussian cylindrically - symmetric beam",
    "the lsc impedance is given by @xcite @xmath31 where @xmath32 is the free - space impedance , @xmath33 , @xmath34 is the rms beam size and @xmath35 .",
    "similar expression for a transversely uniform beam is provided in @xcite .    the maximum of the eq .",
    "[ imp_ven ] is achieved at @xmath36 , therefore the optimal wavelength of the density modulation will be located around @xmath37",
    "the nature of space charge forces lies in particle - to - particle coulomb interaction .",
    "direct summation of the forces yields to @xmath38 growth where @xmath0 is the number of macroparticles , which makes it impossible to compute at large @xmath0 .",
    "several approximation techniques can be used : mean - field on a grid approximation @xcite , one - dimensional space charge impedance @xcite , analytical sub - beams or ensembles model @xcite , rigid - slice approximation @xcite .",
    "all of those methods reduce the problem s complexity via some approximations which ultimately limits the maximum attainable spatial resolution .",
    "most recent attempt used a three - dimensional - grid space charge algorithm based on a periodic boundary  @xcite .    from another point of view",
    ", space charge problem is very similar to the well - known @xmath0-body problem in celestial mechanics .",
    "one of the most effective algorithms for the gravitational @xmath0-body problem is the so called `` tree '' or barnes - hut ( bh ) algorithm  @xcite , which scales as @xmath39 . in this paper",
    "we present the results obtained using a modified version of the code available at  @xcite .",
    "such approach was successfully employed to simulate early - stage beam dynamics in photocathodes  @xcite and laser ion cooling  @xcite .    in brief",
    ", the bh algorithm initially surrounds the bunch distribution in a cubic cell called a root cell .",
    "the root cell is divided into 8 sub - cells recursively , until it reaches the point where a single sub - cell contains just one particle",
    ". then forces only between nearby cells are calculated directly , and the cells far away from each other are treated as two large macroparticles with the total charge placed in the cell s center of mass .",
    "the process of calculating net forces starts from the root cell and recursively parses the cell hierarchy until it reaches the size of the smallest cell that is predefined as a precision parameter .",
    "thus , the algorithm is significantly faster than a direct summation method",
    ". the bh method does not preserve full hamiltonian , yet for relatively small precision parameter the difference between direct summation is comparably small  @xcite . it should be pointed out in the direct summation part ( for neighboring cells ) the bh algorithm also implement a local smoothing of the potential to avoid singularities  @xcite .    another more efficient fast multipole method ( fmm )",
    "algorithm has been recently developed  @xcite and will be eventually used in further refinement of our work .",
    "though fmm algorithms are more sophisticated and precise , still the bh method is comparably accurate and faster than fmm and it can be embedded in time - stepping integrators @xcite .",
    "for the studies detailed in this paper we used the bh algorithm as an external script within the elegant simulations . at a user - specified axial locations along the accelerator beam line , space charge kicks were applied .",
    "our approach is to follow the quasi - static approximation  @xcite .",
    "the distribution at the defined axial location is recorded and a lorentz transformation to the bunch s rest frame is performed .",
    "the bh algorithm is then utilized to obtain the 3d electrostatic field @xmath40 in the bunch s rest frame .",
    "we should point out that the bh algorithm returns the field directly evaluated at each macro - paticle locations ( so that there is not need for interpolation as in a grid - based algorithm ) .",
    "the electrostatic field is subsequently transformed in the laboratory frame via a lorentz boost .",
    "the resulting electromagnetic fields @xmath41 in the laboratory frame are used to apply the corresponding lorentz force @xmath42 $ ] on each of the macroparticles [ @xmath43 and @xmath44 are respectively the charge and reduced velocity ( @xmath45 ) of the considered macroparticle ] .",
    "the distribution is finally passed back to elegant and tracked up in the given optical lattice to the next space charge kick where the above process repeats .",
    "we henceforth refer to the combination of the bh algorithm with elegant as `` elegant - bh '' .",
    "our implementation relies on an impulse approximation so that only the momentum , i.e. not the position , of the macroparticles is altered by the space charge kick .",
    "we assumed there is no magnetic field in the rest frame .",
    "although this assumption is not strictly valid , it was shown to hold for beams with low energy spread typically generated from photoinjectors  @xcite .    in order to gain confidence in the implemented space charge calculation procedure ,",
    "several validation tests were conducted ; see  [ app : benchmarks ] .",
    "in this section we only focus on the benchmarking of eq .",
    "[ imp_ven ] with elegant - bh .",
    "we considered initial bunch distributions with modulated current profiles of the form @xmath46,\\end{aligned}\\ ] ] where @xmath47 , @xmath48 and @xmath49 are respectively the modulation amplitude and spatial wavenumber , and @xmath50 and @xmath51 are respectively the nominal longitudinal and transverse beam distributions .",
    "the modulation along the axial @xmath52 direction leads to an energy modulation due to the lsc impedance and eventually produces further current modulation depending on the longitudinal dispersion of the beamline . from the definition of the impedance , and",
    "given the fourier - transformed longitudinal electric field @xmath53 and current distribution @xmath54 , the longitudinal impedance can be recovered as @xmath55    a comparison of the simulated lps ( after one space charge kick with elegant - bh ) with the initial one appears in fig .",
    "[ phasespace](a , b ) and demonstrates the salient features of the modulations and especially the @xmath56 shift between the final energy modulations and the initial density modulations ; see fig .",
    "[ phasespace](c ) .",
    "lps distribution for a density - modulated gaussian beam before ( a ) and after ( b ) the application of one space charge kick . corresponding induced energy modulation ( red solid trace ) computed from image ( b ) and current distribution ( blue dash trace ) obtained from image ( a ) ; lower plot ( c).in the upper images @xmath57 refers to the normalized momentum spread .",
    "]    the fourier transform of the initial current distribution was performed using a fast - fourier transform ( fft ) algorithm .",
    "likewise , the mean energy of thin axial slices within the final lps density distribution was computed thereby providing the energy modulation dependence on @xmath52 , @xmath58 .",
    "the extracted energy modulation @xmath58 is fourier transformed to yield @xmath59 from which the axial electric field @xmath60 was inferred .",
    "the resulting impedance evolution as a function of @xmath49 obtained is compared against eq .",
    "[ eq : impedanceretr ] in fig .",
    "[ fig : z ] .",
    "the studies were carried out using different number of macroparticles ( @xmath61\\times10 ^ 6 $ ] ) to ensure the convergence and satisfy the statistical limit  @xcite .",
    "the number of fft bins @xmath62 was also tuned to minimize discretization effects while varying @xmath49 . as the wavenumber @xmath49 value decreases ,",
    "the bunch duration length was increased to ensure the number of macroparticles per bin remains constant and guarantees a sufficient number of modulations occurs within the bunch . in our simulations we set this ratio to be typically @xmath63 .",
    "comparison of the longitudinal space - charge impedance computed from eq .",
    "[ imp_ven ] (  theory \" ) , from eq .",
    "[ imp3deq ] ) (  theory-3d \" ) , with the ones retrieved from simulation with elegant built - in lscdrift element (  elegant \" ) , and elegant - bh (  elegant - bh \" ) . [ fig : z ] ]    figure  [ fig : z ] points to small differences between the lscdrift element in elegant that assumes transverse distribution to be uniform @xcite and eq .  [ imp_ven ] .",
    "the elegant - bh performs full three - dimensional space charge force calculation and therefore inherits both the transverse and longitudinal effects in lsc impedance . such effects were previously recognized  @xcite and are attributed to the radial dependence of the axial space charge field conferring a similar dependence on the impedance . to further explore longitudinal space charge impedance radial dependence we performed an analysis over thin radial slices @xmath64 $ ] where @xmath65 .",
    "the results of such an analysis are summarized in fig .",
    "[ fig : z ] , [ impedance_slice ] for a beam following a transverse gaussian distribution of the form @xmath66 $ ] .",
    "figure [ impedance ] compares the numerical results with the expected radial dependence analytically derived in ref .",
    "@xcite ring derived as eq .",
    "( 35 ) of ref .",
    "@xcite and applied the bessel recursive relation to further simplify eq.(35 ) of the paper .",
    "in addition we explicitly wrote the @xmath67 of ref .",
    "@xcite as @xmath68 .",
    "] @xmath69 , \\end{aligned}\\ ] ] where @xmath70 is the heaviside step function , @xmath71 and @xmath72 are modified bessel functions , @xmath73 is the distribution function . a noteworthy consequence of the observed strong radial dependence for a gaussian transverse distribution is the effective smearing of the axial modulation which will effectively result in weaker integrated energy modulations .     for a fixed value of @xmath49 .",
    "the green and blue traces respectively correspond to the impedance with gaussian transverse distribution from eq .",
    "[ imp3deq ] and elegant - bh .",
    "the parameter @xmath74 is the rms transverse size of the distribution .",
    "[ impedance_slice ] ]    as a final note , we point out that in the case of a parabolic @xmath75 and uniform @xmath76 distribution an analytical form of the impedance can be retrieved [ here @xmath77 , @xmath78 , and @xmath70 are respectively the radius , normalization factor , and heaviside function ] .",
    "it is especially found that the parabolic transverse distribution yields an impedance with weaker dependence on the radius compared to a gaussian transverse distribution ; see fig .",
    "[ impedance_slice ] .",
    "these observations suggest a possible use of transverse electron - beam shaping  @xcite as ways of controlling the micro - bunching instability .",
    "in this section we explore the possible use of a staged lsca beam line to produce micro - bunching structure with spatial scale corresponding to the ultraviolet regime , so @xmath79 nm . for our simulations we considered the configuration available at the fermilab accelerator science & technology ( fast ) facility ( formerly known as asta )",
    "@xcite currently in its commissioning phase at fermilab .",
    "the fast facility is diagrammed in fig .",
    "[ fig : fast ] . in short ,",
    "the beam is produced from a photocathode located in a 1+@xmath80 radiofrequency ( rf ) gun and accelerated to @xmath81  mev by two superconducting tesla accelerating cavities  @xcite .",
    "downstream of the accelerating cavities the beam can be manipulated ( e.g. longitudinally compressed ) and diagnosed in a 20-m transport line before being injected in an ilc type accelerating cryomodule composed of eight superconducting cavities .",
    "the beam , with final energies up to @xmath82  mev , then can be directed into a small - footprint ring [ the integrable optics test accelerator ( iota ) ] or transported to experiments arranged along a @xmath83  m transport line .",
    "conversely , the 70-m beamline , with proper optics , could accommodate the formation of broadband density modulation with uv spectral content ; see fig .",
    "[ fig : fast ]",
    ". +     overview of fast facility and the proposed lsca .",
    "the legend is as follows : `` cavx '' : accelerating cavities , `` bc '' : magnetic chicane bunch compressor , the thin ( red ) rectangles and ( green ) square symbols respectively represent the quadrupole and dipole magnets . ]",
    "horizontal ( blue ) and vertical ( red ) rms beam size evolution in one lsca module .",
    "the envelopes are obtained in the single - particle dynamics limit .",
    "the green diagram indicates the location of the focusing ( qf ) and defocusing ( qd ) quadrupole magnets while the four smaller rectangles ( at distance @xmath84  m ) represent the chicane dipole magnets . ]    a numerical optimization of the electron - beam formation and acceleration to @xmath81  mev was carried out with astra  @xcite for various charges .",
    "the results combined with a mild bunch compression in the 50-mev bunch compressor chicane , could produce bunches with peak current on the order of @xmath1  a and slice parameters gathered in table  [ tab : parameters ]  @xcite .",
    "these parameters were used to generate initial distribution used in all the elegant - bh simulations presented below . for simplicity",
    "we consider all the lsca modules to be similar : they consist of 4 fodo - cell sections each followed by small bending angle chicanes .",
    "the only difference between the modules is the @xmath13 parameters associated to the chicanes as explained below .",
    "the horizontal dispersion introduced by the chicanes is minimal and does not break the periodicity of the fodo cells .",
    "the settings of quadrupole magnets arranged as a fodo cell were optimized using single - particle dynamics simulations .",
    "the corresponding beam size evolution along one lsca module appears in fig .",
    "[ fig : lattice ] .",
    ".[tab : parameters ] beam parameters considered for the lsca simulations using the setup of fig .",
    "[ lsca - layout ] . [ cols=\"<,^,^\",options=\"header \" , ]     to quantitatively assess the properties of undulator radiation produced seeded by a lsca - microbunched beam , we employ the program genesis  @xcite .",
    "the beam parameters are consistent with the beam parameters generated downstream of the lcsa ; see tab .",
    "[ tab : felinput ] . for our simulation",
    "we rescale the bunching factor obtained with @xmath85 macroparticles , see fig .",
    "[ 3stage ] , to the real number of electron in the considered axial slice @xmath86 following @xmath87 where @xmath88 .",
    "this scaled bunching factor obtained for a specific wavelength is then used as an input in the steady state genesis simulation .",
    "the simulated evolution of the radiation pulse energy along the undulator length appears in fig .",
    "[ fig : radiation ] . in the latter figure we considered a wavelength of @xmath89  nm with a scaled bunching factor of @xmath90 ( i.e. a nominal bunching factor of @xmath91 in fig .  [ 3stage ] ) .",
    "our simulations demonstrate that uv pulses with energies on the order of @xmath92  @xmath93j could be reached downstream of a meter - scale section of the undulator three orders of magnitudes above the  shot - noise \" radiation of 9 nj ( achieved with an initial shot - noise bunching factor of @xmath94 ) .",
    "using a grid - less code adapted from astrophysics we have investigated three - dimensional effects in the lsc ( longitudinal space - charge ) impedance and confirmed that the one - dimensional often used lsc impedance model is a good approximation .",
    "additionally we benchmarked the radial dependence of the lsc impedance with the analytical results developed in ref .",
    "@xcite .    finally , we confirmed the possible use of a cascaded lsca ( longitudinal space - charge amplifier ) scheme to produce femtosecond microstructures in the lps ( longitudinal phase space ) with spectral range attaining the ultraviolet domain using electron - beam parameters achievable at fast facility .",
    "we are grateful to dr .",
    "j. barnes ( u. hawaii ) for granting us the use of his open - source version of the bh algorithm and to dr .",
    "m. borland ( anl ) for his help with elegant .",
    "we thank dr .",
    "j. wu ( slac ) for discussing some of the results presented in his paper  @xcite , and dr .",
    "r. li ( jlab ) and dr .",
    "v. litvinenko ( bnl ) for their interests and comments on our work .",
    "this work was supported by the us department of energy ( doe ) under contract de - sc0011831 with northern illinois university .",
    "fermilab is operated by the fermi research alliance llc under us doe contract de - ac02 - 07ch11359 .",
    "to gain confidence in the algorithm developed we benchmarked our simulations in the macroscopic regime and rely on both analytical results and simulations carried out with the astra program @xcite .",
    "transverse ( top plot ) and longitudinal ( lower plot ) electric fields experienced by the macropaticle simulated with elegant - bh ( symbols ) and obtained from eq .",
    "[ fieldeqs ] ( lines ) .",
    ", title=\"fig : \" ] + transverse ( top plot ) and longitudinal ( lower plot ) electric fields experienced by the macropaticle simulated with elegant - bh ( symbols ) and obtained from eq .",
    "[ fieldeqs ] ( lines ) .",
    ", title=\"fig : \" ]    we first consider a 3d homogeneous ellipsoidal bunch with electric field linearly dependent on the position within the charge distribution as  @xcite @xmath95 where @xmath96 , @xmath97 $ ] , @xmath98 are the ellipsoid semiaxes , @xmath99 and @xmath100 is the bunch charge .",
    "comparison of the beam envelope evolution along a 1-m drift .",
    "eq .  [ k - v ] solution ( red ) , is compared against astra ( green ) , and elegant - bh simulation ( blue ) .",
    "the magenta line corresponds to no space charge case . ]    to assess longer - term tracking , we compared the evolution of the 5 mev , 500 a beam envelope over a drift space . for a stationary uniform beam the transverse envelope evolution",
    "is governed by  @xcite @xmath101 where @xmath102 is the rms beam size in @xmath103 , @xmath104 is the corresponding geometric emittance and @xmath105 is a space charge perveance defined ( taken to be an order of @xmath106 ) , for a parabolic current profile , as @xmath107 where @xmath100 is the bunch charge , @xmath108 the peak current , @xmath16 the rf wavelength , and @xmath48 the electron mass .",
    "figure [ envelope ] compares the solution of eq .",
    "[ k - v ] against the beam envelope simulated with elegant - bh .",
    "the geometric emittance was taken to be very low ( @xmath109  m ) for these studies so that when space charge was turned off the beam envelope ( dashed line ) stayed quasi - constant .",
    "finally fig .",
    "[ elastra ] compares the final transverse phase space at @xmath110  m obtained with elegant - bh and astra for the 50 mev , 500 a beam .",
    "these two computer programs despite their very different space charge algorithms are in very close agreement .",
    "the code astra relies on the same quasi - electrostatic approximation as used in elegant - bh but implements a cylindrical - symmetric space charge algorithm using a @xmath111 two - dimensional grid for depositing the charge and solving poisson s equation in the bunch frame  @xcite ."
  ],
  "abstract_text": [
    "<S> longitudinal space charge ( lsc ) effects are generally considered as harmful in free - electron lasers as they can seed unfavorable energy modulations that can result in density modulations with associated emittance dilution . </S>",
    "<S> this `` micro - bunching instabilities '' is naturally broadband and could possibly support the generation of coherent radiation over a broad region of the spectrum . therefore there has been an increasing interest in devising accelerator beam lines capable of controlling lsc induced density modulations . in the present paper </S>",
    "<S> we refine these previous investigations by combining a grid - less space charge algorithm with the popular particle - tracking program elegant . </S>",
    "<S> this high - fidelity model of the space charge is used to benchmark conventional lsc models . </S>",
    "<S> we finally employ the developed model to investigate the performance of a cascaded lsc amplifier using beam parameters comparable to the ones achievable at fermilab accelerator science & technology ( fast ) facility currently under commissioning at fermilab .    </S>",
    "<S> linear accelerator , electron beams , space charge , micro - bunching instabilities , @xmath0-body tree algorithm </S>"
  ]
}