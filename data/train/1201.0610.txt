{
  "article_text": [
    "although the euclidean distance is a simple and convenient metric , it is often not an accurate representation of the underlying shape of the data @xcite .",
    "such a representation is crucial in many real - world applications @xcite , such as object classification @xcite , text document retrieval @xcite and face verification @xcite , and methods that learn a distance metric from training data have hence been widely studied in recent years .",
    "we present a new angle on the metric learning problem based on random forests @xcite as the underlying distance representation .",
    "the emphasis of our work is the capability to incorporate the absolute position of point pairs in the input space without requiring a separate metric per instance or exemplar . in doing so , our method , called random forest distance ( rfd ) ,",
    "is able to adapt to the underlying shape of the data by varying the metric based on the _ position _ of sample pairs in the feature space while maintaining the efficiency of a single metric . in some sense",
    ", our method achieves a middle - ground between the two main classes of existing methods ",
    "single , global distance functions and multi - metric sets of distance functions  overcoming the limitations of both ( see figure [ fig : introcomparison ] for an illustrative example ) .",
    "we next elaborate upon these comparisons .",
    "[ tb ]      the metric learning literature has been dominated by methods that learn a global mahalanobis metric , with representative methods @xcite . in brief , given a set of pairwise constraints ( either by sampling from label data , or collecting side information in the semi - supervised case ) , indicating pairs of points that should or should not be grouped ( i.e. , have small or large distance , respectively ) , the goal is to find the appropriate linear transformation of the data to best satisfy these constraints .",
    "one such method @xcite minimizes the distance between positively - linked points subject to the constraint that negatively - linked points are separated , but requires solving a computationaly expensive semidefinite programming problem .",
    "relevant component analysis ( rca ) @xcite learns a linear mahalanobis transformation to satisfy a set of positive constraints .",
    "discriminant component analysis ( dca ) @xcite extends rca by exploring negative constraints .",
    "itml @xcite minimizes the logdet divergence under positive and negative linear constraints , and lmnn @xcite learns a distance metric through the maximum margin framework .",
    "@xcite formulate metric learning as a quadratic semidefinite programming problem with local neighborhood constraints and linear time complexity in the original feature space .",
    "more recently , researchers have begun developing fast algorithms that can work in an online manner , such as pola @xcite , mlcl @xcite and lego @xcite .",
    "these global methods learn a single mahalanobis metric using the relative position of point pairs : + @xmath1 .",
    "although the resulting single metric is efficient , it is limited in its capacity to capture the shape of complex data .",
    "in contrast , a second class , called multi - metric methods , distributes distance metrics throughout the input space ; in the limit , they estimate a distance metric per instance or exemplar , e.g. , @xcite for the case of mahalanobis metrics .",
    "@xcite extend @xcite by propagating metrics learned on training exemplars to learn a matrix for each unlabeled point as well .",
    "however , these point - based multi - metric methods all suffer from high time and space complexity due to the need to learn and store @xmath2 @xmath3 by @xmath3 metric matrices . a more efficient approach to this second class",
    "is to divide the data into subsets and learn a metric for each subset @xcite .",
    "however , these methods have strong assumptions in generating these subsets ; for example , @xcite learns at most one metric per category , forfeiting the possibility that different samples within a category may require different metrics .",
    "we propose a metric learning method that is able to achieve both the efficiency of the global methods and specificity of the multi - metric methods .",
    "our method , the random forest distance ( rfd ) , transforms the metric learning problem into a binary classification problem and uses random forests as the underlying representation @xcite . in this general form",
    ", we are able to incorporate the position of samples implicitly into the metric and yet maintain a single and efficient global metric . to that end , we use a novel point - pair mapping function that encodes both the position of the points relative to each other and their absolute position within the feature space .",
    "our experimental analyses demonstrate the importance of incorporating position information into the metric ( section [ sec : experiments ] ) .",
    "we use the random forest as the underlying representation for several reasons .",
    "first , the output of the random forest algorithm is a simple `` yes '' or `` no '' vote from each tree in the forest . in our case , `` no '' votes correspond to positively constrained training data , and `` yes '' votes correspond to negatively constrained training data .",
    "the number of yes votes , then , is effectively a distance function , representing the relative resemblance of a point pair to pairs that are known to be dissimilar versus pairs that are known to be similar .",
    "second , random forests are efficient and scale well , and have been shown to be one of the most powerful and scalable supervised methods for handling high - dimensional data @xcite  in contrast to instance - specific multi - metric methods @xcite , the storage requirement of our method is independent of the size of the input data set .",
    "our experimental results indicate rfd is at least 16 times faster than the state of the art multi - metric method .",
    "third , because random forests are non - parametric , they make minimal assumptions about the shape and patterning of the data @xcite , affording a flexible model that is inherently nonlinear . in the next section ,",
    "we describe the new rfd method in more detail , followed by a thorough comparison to the state of the art in section [ sec : experiments ] .",
    "our random forest - based approach is inspired by several other recent advances in metric learning @xcite that reformulate the metric learning problem into a classification problem . however ,",
    "where these approaches restricted the form of the learned distance function to a mahalanobis matrix , thus precluding the use of position information , we adopt a more general formulation of the classification problem that removes this restriction .",
    "given the instance set @xmath4 , each @xmath5 is a vector of @xmath6 features .",
    "taking a geometric interpretation of each @xmath7 , we consider @xmath7 the _ position _ of sample @xmath8 in the space @xmath9 .",
    "the value of this interpretation will become clear throughout the paper as the learned metric will implicitly vary over @xmath9 , which allows it to adapt the learned metric based on local structure in a manner similar to the instance - specific multi - metric methods , e.g. , @xcite .",
    "denote two pairwise constraint sets : a must - link constraint set @xmath10 and @xmath11 are similar@xmath12 and a do - not - link constraint set @xmath13 and @xmath11 are dissimilar@xmath12 . for any constraint @xmath14 ,",
    "denote @xmath15 as the ideal distance between @xmath7 and @xmath11 . if @xmath16 , then the distance @xmath17 , otherwise @xmath18 .",
    "therefore , we seek a function @xmath19 from an appropriate function space @xmath20 : @xmath21 where @xmath22 is some loss function that will be specified by the specific classifier chosen . in our random forests case , we minimize expected loss , as in many classification problems .",
    "so consider @xmath19 to be a binary classifier for the classes @xmath23 and @xmath24 .",
    "for flexibility , we redefine the problem as @xmath25 , where @xmath26 is some classification model , and @xmath27 is a mapping function that maps the pair @xmath14 to a feature vector that will serve as input for the classifier function @xmath28 . to train @xmath28 ,",
    "we transform each constraint pair using the mapping function @xmath29 and submit the resulting set of vectors and labels as training data .",
    "we next describe the feature mapping function @xmath30 .",
    "in actuality , all metric learning methods implicitly employ a mapping function @xmath27 .",
    "however , mahalanobis based methods are restricted in terms of what features their metric solution can encode .",
    "these methods all learn a ( positive semidefinite ) metric matrix @xmath31 , and a distance function of the form @xmath1 , which can be reformulated as @xmath32^{\\sf t}\\vec[({\\mathbf{x}}_i-{\\mathbf{x}}_j)({\\mathbf{x}}_i-{\\mathbf{x}}_j)^{\\sf t}]$ ] , where @xmath33 $ ] denotes vectorization or _ flattening _ of a matrix .",
    "mahalanobis - based methods can thus be viewed as using the mapping function @xmath34 $ ] .",
    "this function encodes only relative position information , and the mahalanobis formulation allows the use of no other features .",
    "however , our formulation affords a more general mapping function : @xmath35 which considers both the relative location of the samples @xmath36 as well as their absolute position @xmath37 .",
    "the output feature vector is the concatenation of these two and in @xmath38 .",
    "the relative location @xmath36 represents the same information as the mahalanobis mapping function .",
    "note , we take the absolute value in @xmath36 to enforce symmetry in the learned metric . the primary difference between our mapping function and that of previous methods is",
    "thus the information contained in @xmath37the mean of the two point vectors .",
    "it localizes each mapped pair to a region of the space , which allows our method to adapt to heterogeneous distributions of data .",
    "it is for this reason that we consider our learned metric to be implicitly position - dependent .",
    "note the earlier methods that learn position - based metrics , i.e. the methods that learn a metric per instance such as @xcite , incorporate absolute position of each instance only , whereas we incorporate the absolute position of each instance pair , which adds additional modeling versatility .",
    "we note that alternate encodings of the position information are possible but have shortcomings .",
    "for example , we could choose to simply concatenate the position of the two points rather than average them , but this approach raises the issue of ordering the points . using @xmath39 would again yield a nonsymmetric feature , and an arbitrary ordering rule would not guarantee meaningful feature comparisons .",
    "the usefulness of position information varies depending on the data set . for data that is largely linear and homogenous",
    ", including @xmath37 will only add noise to the features , and could worsen the accuracy . in our experiments , we found that for many real data sets ( and particularly for more difficult data sets ) the inclusion of @xmath37 significantly improves the performance of the metric ( see section [ sec : experiments ] ) .",
    "[ data sets ]      random forests are well studied in the machine learning literature and we do not describe them in any detail ; the interested reader is directed to @xcite . in brief , a random forest is a set of decision trees @xmath40 operating on a common feature space , in our case @xmath38 . to evaluate a point - pair @xmath14",
    ", each tree independently classifies the sample ( based on the leaf node at which the point - pair arrives ) as similar or dissimilar ( 0 or 1 , respectively ) and the forest averages them , essentially regressing a distance measure on the point - pair : @xmath41 where @xmath42 is the classification output of tree @xmath43 .",
    "it has been found empirically that random forests scale well with increasing dimensionality , compared with other classification methods @xcite , and , as a decision tree - based method , they are inherently nonlinear . hence , our use of them in rfd as a regression algorithm allows for a more scalable and more flexible metric than is possible using mahalanobis methods .",
    "moreover , the incorporation of position information into this classification function ( as described in section [ mappingfun ] ) allows the metric to implicitly adapt to different regions over the feature space . in other words , when a decision tree in the random forest selects a node split based on a value of the absolute position @xmath37 sub - vector ( see eq .",
    "[ eq : map ] ) , then all evaluation in the sub - tree is _ localized _ to a specific half - space of @xmath9 .",
    "subsequent splits on elements of @xmath37 further refine the sub - space of emphasis @xmath9 . indeed , each path through a decision tree in the random forest is localized to a particular ( possibly overlapping ) sub - space .",
    "the rfd is not technically a _",
    "metric _ but rather a _",
    "pseudosemimetric_. although rfd can easily be shown to be non - negative and symmetric , it does not satisfy the triangle inequality ( i.e. , @xmath44 ) or the implication that @xmath45 , sometimes called identity of indiscernibles .",
    "it is straightforward to construct examples for both of these cases .",
    "although this point may appear problematic , it is not uncommon in the metric learning literature .",
    "for example , by necessity , no metric whose distance function varies across the feature space can guarantee the triangle inequality is satisfied .",
    "@xcite similarly can not satisfy the triangle inequality .",
    "our method _ must _ violate the triangle inequality in order to fulfill our original objective of producing a metric that incorporates position data .",
    "moreover , our extensive experimental results demonstrate the capability of rfd as a distance ( section [ sec : experiments ] ) .",
    "in this section , we present a set of experiments comparing our method to state of the art metric learning techniques on both a range of uci data sets ( table [ data sets ] ) and an image data set taken from the corel database .",
    "to substantiate our claim of computational efficiency , we also provide an analysis of running time efficiency relative to an existing position - dependent metric learning method . for the uci data sets , we compare performance at the @xmath46-nearest neighbor classification task against both standard mahalanobis methods and point - based position - dependent methods . for the former ,",
    "we test @xmath46-nn classification accuracy at a range of k - values ( as in figure [ fig : introcomparison ] ) , while the latter relies on results published by other methods authors , and thus uses a fixed @xmath46 . for the image data set , we measure accuracy at @xmath46-nn retrieval , rather than @xmath46-nn classification .",
    "we compare our results to several mahalanobis methods .",
    "the following is an overview of the primary experimental findings to be covered in the following sections .    1 .",
    "rfd has the best overall performance on ten uci data sets ranging from 4 to 649 dimensions against four state of the art and two baseline global mahalanobis - based methods ( figure [ fig : uci1 ] and table [ tbl : ucirank ] ) .",
    "rfd has comparable or superior accuracy to state of the art position - specific methods ( table [ tbl : isd ] ) .",
    "rfd is 16 to 85 times faster than the state of the art position - specific method ( table [ tbl : time ] ) .",
    "4 .   rfd outperforms the state of the art in nine out of ten categories in the benchmark corel image retrieval problem ( figure [ fig : corel ] ) .",
    "we first compare our method to a set of state of the art mahalanobis metric learning methods : rca @xcite , dca @xcite , information - theoretic metric learning ( itml)@xcite and distance metric learning for large - margin nearest neighbor classification ( lmnn ) @xcite . for our method , we test using the full feature mapping including relative position data , @xmath36 , and absolute pairwise position data , @xmath37 , ( rfd ( @xmath47p ) ) as well as with only relative position data , @xmath36 , ( rfd ( @xmath48p ) ) . to provide a baseline , we also show results using both the euclidean distance and a heuristic mahalanobis metric , where the @xmath31 used is simply the covariance matrix for the data .",
    "all algorithm code was obtained from authors websites , for which we are indebted ( _ our code is available on http://www.cse.buffalo.edu/~jcorso_ ) .",
    "we test each algorithm on a number of standard small to medium scale uci data sets ( see table [ data sets ] ) .",
    "all algorithms are trained using 1000 positive and 1000 negative constraints per class , with the exceptions of rca , which used only the 1000 positive constraints and lmnn , which used the full label set to actively select a ( generally much larger ) set of constraints ; constraints are all selected randomly according to a uniform distribution . in each case , we set the number of trees used by our method to 400 ( _ see section [ forestsize ] for a discussion of the effect of varying forest sizes _ ) .",
    "testing is performed using 5-fold cross validation on the @xmath46 nearest - neighbor classification task . rather than selecting a single @xmath46-value for this task , we test with varying @xmath46s , increasing in increments of 5 up to the maximum possible value for each data set ( i.e. the number of elements in the smallest class ) . by varying @xmath46 in this way , we are able to gain some insight into each method s ability to capture the global variation in a data set . when @xmath46 is small , most of the identified neighbors lie within a small local region surrounding the query point , enabling linear metrics to perform fairly well even on globally nonlinear data by taking advantage of local linearity .",
    "however , as @xmath46 increases , local linearity becomes less practical , and the quality of the metric s representation of the global structure of the data is exposed . though the accuracy results at higher @xmath46 values do not have strong implications for each method s efficacy for the specific task of @xmath46-nn classification ( where an ideal @xmath46 value can just be selected by cross - validation ) , they do indicate overall metric performance , and are highly relevant to other tasks , such as retrieval .",
    "figure [ fig : uci1 ] show the accuracy plots for ten uci datasets .",
    "rfd is consistently near the top performers on these various data sets . in the lower dimension case ( iris ) , most methods perform well , and rfd without position information outperforms rfd with position information ( this is the sole data set in which this occurs ) , which we attribute to the limited data set size ( 150 samples ) and the position information acting as a distractor in this small and highly linear case . in all other cases ,",
    "the rfd with absolute position information significantly outperforms rfd without it .",
    "in many of the more more difficult cases ( diabetes , segmentation , sonar ) , rfd with position information significantly outperforms the field .",
    "this result is suggestive that rfd can scale well with increasing dimensionality , which is consistent with the findings from the literature that random forests are one of the most robust classification methods for high - dimensional data @xcite .",
    "table [ tbl : ucirank ] provides a summary statistic of the methods by computing the mean - rank ( lower better ) over the ten data sets at varying @xmath46-values . for all but",
    "one value of @xmath46 , rfd with absolute position information has the best mean rank of all the methods ( and for the off - case , it is ranked a close second ) .",
    "rfd without absolute position information performs comparatively poorer , underscoring the utility of the absolute position information . in summary ,",
    "the results in table [ tbl : ucirank ] show that rfd is consistently able to outperform the state of the art in global metric learning methods on various benchmark problems .        [",
    "cols=\"<,^,^,^,^,^,^,^,^\",options=\"header \" , ]     [ tbl : time ]      we compare our method to three multi - metric methods that incorporate absolute position ( via instance - specific metrics ) : fsm , fssm and isd .",
    "fsm @xcite learns an instance - specific distance for each labeled example .",
    "fssm @xcite is an extension of fsm that enforces global consistency and comparability among the different instance - specific metrics .",
    "isd @xcite first learns instance - specific distance metrics for each labeled data point , then uses metric propagation to generate instance - specific metrics for unlabeled points as well .",
    "we again use the ten uci data sets , but under the same conditions used by these methods authors .",
    "accuracy is measured on the @xmath46-nn task ( @xmath46=11 ) with three - fold cross validation .",
    "the parameters of the compared methods are set as suggested in @xcite .",
    "our rfd method chooses 1% of the available positive constraints and 1% of the available negative constraints , and constructs a random forest with 1000 trees .",
    "we report the average result of ten different runs on each data set , with random partitions of training / testing data generated each time ( see table [ tbl : isd ] ) .",
    "these results show that our rfd method yields performance better than or comparable to state of the art explicitly multi - metric learning methods .",
    "additionally , because we only learn one distance function and random forests are an inherently efficient technique , our method offers significantly better computational efficiency than these instance - specific approaches ( see table [ tbl : time])between 16 to 85 times faster than isd .    the comparable level of accuracy is not surprising .",
    "while our method is a single metric in form , in practice its implicit position - dependence allows it to act like a multi - metric system .",
    "notably , because our method learns using the position of each point - pair rather than each point , it can potentially encode up to @xmath49 implicit position - specific metrics , rather than the @xmath2 learned by existing position - dependent methods , which learn a single metric per instance / position .",
    "rfd is a stronger way to learn a position - dependent metric , because even explicit multi - metric methods will fail over global distances in cases where a single ( mahalanobis ) metric can not capture the relationship between its associated point and every other point in the data .",
    "we also evaluate our method s performance on the challenging image retrieval task because this task differs from @xmath46-nn classification by emphasizing the accuracy of individual pairwise distances rather than broad patterns . for this task",
    ", we use an image data set taken from the corel image database .",
    "we select ten image categories of varying types ( cats , roses , mountains , etc.the classes and images are similar to those used by hoi et al . to validate dca @xcite ) , each with a clear semantic meaning .",
    "each class contains 100 images , for a total of 1000 images in the data set .",
    "for each image , we extract a 36-dimensional low - level feature vector comprising color , shape and texture . for color ,",
    "we extract mean , variance and skewness in each hsv color channel , and thus obtain 9 color features .",
    "for shape , we employ a canny edge detector and construct an 18-dimensional edge direction histogram for the image . for texture , we apply discrete wavelet transformation ( dwt ) to graylevel versions of original rgb images .",
    "a daubechies-4 wavelet filter is applied to perform 3-level decomposition , and mean , variance and mode of each of the 3 levels are extracted as a 9-dimensional texture feature .",
    "we compare three state of the art algorithms and a euclidean distance baseline : itml , dca , and our rfd method ( with absolute position information ) . for itml ,",
    "we vary the parameter @xmath50 from @xmath51 to @xmath52 and choose the best ( @xmath53 ) . for each method",
    ", we generate 1% of the available positive constraints and 1% of the available negative constraints ( as proposed in @xcite ) . for rfd , we construct a random forest with 1500 trees . using five - fold cross validation",
    ", we retrieve the 20 nearest neighbors of each image under each metric .",
    "accuracy is determined by counting the fraction of the retrieved images that are the same class as the image that retrieved them .",
    "we repeat this experiment 10 times with differing random folds and report the average results in figure [ fig : corel ] .",
    "rfd clearly outperforms the other methods tested , achieving the best accuracy on all but the cougar category .",
    "also note that itml performs roughly on par with or worse than the baseline on 7 classes , and dca on 5 , while rfd fails only on 1 , indicating again that rfd provides a better global distance measure than current state of the art approaches , and is less likely to sacrifice performance in one region in order to gain it in another .",
    "in this paper , we have proposed a new angle to the metric learning problem .",
    "our method , called random forest distance ( rfd ) , incorporates both conventional relative position of point pairs as well as absolute position of point pairs into the learned metric , and hence implicitly adapts the metric through the feature space .",
    "our evaluation has demonstrated the capability of rfd , which has best overall performance in terms of accuracy and speed on a variety of benchmarks .",
    "there are immediate directions of inquiry that have been paved with this paper .",
    "first , rfd further demonstrates the capability of classification methods underpinning metric learning .",
    "similar feature mapping functions and other underlying forms for the distance function need to be investigated .",
    "second , the utility of absolute pairwise position is clear from our work , which is a good indication of the need for multiple metrics .",
    "open questions remain about other representations of the position as well as the use of position in other metric forms , even the classic mahalanobis metric .",
    "third , there are connections between random forests and nearest - neighbor methods , which may explain the good performance we have observed .",
    "we have not explored them in any detail in this paper and plan to in the future .",
    "finally , we are also investigating the use of rfd on larger - scale , more diverse data sets like the new mit sun image classification data set .",
    "we are grateful for the support in part provided through the following grants : nsf career iis-0845282 , aro yip w911nf-11 - 1 - 0090 , darpa mind s eye w911nf-10 - 2 - 0062 , darpa cssg d11ap00245 , and nps n00244 - 11 - 1 - 0022 .",
    "findings are those of the authors and do not reflect the views of the funding agencies ."
  ],
  "abstract_text": [
    "<S> metric learning makes it plausible to learn distances for complex distributions of data from labeled data . </S>",
    "<S> however , to date , most metric learning methods are based on a single mahalanobis metric , which can not handle heterogeneous data well . </S>",
    "<S> those that learn multiple metrics throughout the space have demonstrated superior accuracy , but at the cost of computational efficiency . here , </S>",
    "<S> we take a new angle to the metric learning problem and learn a single metric that is able to implicitly adapt its distance function throughout the feature space . this metric adaptation is accomplished by using a random forest - based classifier to underpin the distance function and incorporate both absolute pairwise position and standard relative position into the representation . </S>",
    "<S> we have implemented and tested our method against state of the art global and multi - metric methods on a variety of data sets . </S>",
    "<S> overall , the proposed method outperforms both types of methods in terms of accuracy ( consistently ranked first ) and is an order of magnitude faster than state of the art multi - metric methods ( 16@xmath0 faster in the worst case ) . </S>"
  ]
}