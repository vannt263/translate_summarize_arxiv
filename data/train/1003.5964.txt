{
  "article_text": [
    "we study markov chain monte carlo ( mcmc ) methods for bayesian inference of phylogeny .",
    "we begin by presenting the relevant background material by defining phylogenetic trees , evolutionary models ( in section [ sec : evolutionary - models ] ) , and the associated mcmc methods ( in section [ sec : spr ] ) .",
    "we refer the interested reader to semple and steel @xcite for a more comprehensive introduction to the mathematics of phylogeny . finally , we present our results and discuss related work in section [ sec : our - results ] .",
    "a phylogenetic tree is an unrooted tree @xmath0 on @xmath1 leaves ( called taxa , corresponding to @xmath1 species ) where internal vertices have degree three .",
    "let @xmath2 denote the edges of @xmath0 and @xmath3 denote the vertices . in the phylogenetic reconstruction problem",
    ", we observe a collection of labelings of the leaves of @xmath0 from a set @xmath4 , and our goal is to infer the tree @xmath0 from which they were generated from . for example , if @xmath5 then we are given ( aligned ) dna sequences for @xmath1 species , and we are trying to determine the tree describing the evolutionary history of the present - day species .",
    "the labelings on the leaves of @xmath0 are the projection of labelings on all vertices of @xmath0 , and these labelings of @xmath6 are generated in the following manner .",
    "there is a stochastic process along edges of @xmath0 ( e.g. , modeling the evolutionary process of dna substitutions ) which is defined by a continuous - time markov chain .",
    "thus , for each edge @xmath7 there is a @xmath8 rate matrix @xmath9 and a time @xmath10 , which is called the branch length of @xmath11 . in this paper , as is typical in the phylogenetic setting , we assume there is a single rate matrix @xmath9 that is common to all edges . the rate matrix is assumed to be reversible with respect to some distribution @xmath12 on @xmath4 .",
    "hence , fix @xmath12 as the stationary vector for @xmath9 ( i.e. , @xmath13 ) .",
    "( the matrix @xmath9 is usually scaled so that we expect one `` substitution '' ( i.e. , change ) per unit of time . )",
    "the rate matrix @xmath9 defines a continuous time markov chain , and together with @xmath14 defines a transition matrix on edge  @xmath11 : @xmath15 the matrix @xmath16 is a stochastic matrix of size @xmath17 , and thus defines a discrete - time markov chain , which is time - reversible with stationary distribution @xmath12 , i.e. , @xmath18 , and @xmath19 ( for all @xmath20 ) .",
    "the simplest four - state ( i.e. , @xmath21 ) evolutionary model has a single parameter for the off - diagonal entries of the rate matrix @xmath9 ; this model is known as the jukes - cantor model .",
    "the most general reversible four - state model is the gtr ( general time reversible ) model . for @xmath22 (",
    "often studied for mathematical interest ) , the model is binary and the rate matrix has a single parameter ; this model is known as the cfn ( cavender - farris - neyman ) model .",
    "see felsenstein @xcite or yang @xcite for an introduction to these evolutionary models .",
    "given @xmath0 , the rate matrix @xmath9 and the branch lengths @xmath23 , we then define the following distribution on labelings of the vertices of @xmath0 .",
    "let @xmath24 for @xmath25 .",
    "we first orient the edges of @xmath0 away from an arbitrarily chosen root @xmath26 of the tree .",
    "( we can choose the root arbitrarily since each @xmath16 is reversible with respect to @xmath12 . ) then , the probability of a labeling @xmath27 is @xmath28 the distribution @xmath29 can be generated in an equivalent algorithmic manner .",
    "choose @xmath30 from @xmath12 .",
    "then for each edge @xmath31 , given an assignment for exactly one of the endpoints , say @xmath32 , choose @xmath33 from the distribution defined by the row of @xmath16 corresponding to the label @xmath32 .",
    "let @xmath34 be the marginal distribution of @xmath29 on the labelings of the leaves of @xmath0 ( thus @xmath34 is a distribution on @xmath35 where @xmath1 is the number of leaves of @xmath0 ) .",
    "fix @xmath36 with parameters @xmath37 and @xmath38 as the generating tree .",
    "the goal of phylogeny reconstruction is to reconstruct @xmath36 ( and possibly @xmath37 and @xmath38 ) from @xmath39 ( more precisely , from independent samples from @xmath39 ) .",
    "let @xmath40 denote a set of rate matrices with non - zero entries where @xmath41 .",
    "the set @xmath40 is the set of possible rate matrices .",
    "the set can be arbitrary , usually it is determined by the model considered ( e.g. , for the jukes - cantor model @xmath40 would contain rate matrices whose off - diagonal entries are the same ) .",
    "one often assumes that the rate matrix @xmath37 is known . in this case",
    "we would set @xmath42 . on the other hand",
    ", our results also apply if one sets @xmath40 to be the set of all rate matrices with non - zero entries .",
    "we consider the likelihood of a tree @xmath0 as , the maximum over rate matrices @xmath43 and over assignments of non - zero branch lengths @xmath44 to the edges of @xmath0 , of the probability that the tree @xmath45 generated @xmath46 .",
    "more formally , the maximum expected log - likelihood of tree @xmath0 for distribution @xmath47 is defined by @xmath48 where @xmath49    for a set of characters @xmath50 where @xmath51 , define the log - likelihood of a tree @xmath0 as @xmath52    our goal is to sample from the distribution on the set of phylogenetic trees with @xmath1 leaves where the weight of a tree is @xmath53 . in section [ sec : posterior ]",
    "we will look at the straightforward extension to the setting where we are given a prior on trees and parameters @xmath54 , and our goal is to sample from the posterior distribution .",
    "we analyze a markov chain using transitions made by subtree pruning - and - regrafting ( spr ) .",
    "spr transitions are a natural combinatorial transition , which is also popular in practice . in section [ remarks ]",
    "we discuss several other well - studied choices for the transitions .",
    "here we consider trees weighted by their maximum likelihood . in section [ sec : posterior ] we discuss how the markov chain definition and our main result extends to sampling the posterior distribution .",
    "an spr transition from a tree t works by choosing an ( internal or terminal ) edge @xmath55 .",
    "if @xmath11 is an internal edge we consider one of the two subtrees in @xmath56 , either the subtree @xmath57 containing @xmath58 or the subtree @xmath59 containing @xmath60 .",
    "let @xmath57 denote the selected subtree .",
    "if @xmath11 is a terminal edge , let @xmath57 be the endpoint of @xmath11 that is a leaf .",
    "let @xmath61 denote the tree formed by removing @xmath57 from @xmath0 , in particular , we remove @xmath57 and edge @xmath11 from @xmath0 and `` smooth away '' the vertex @xmath60 ( that is , contract one of the two adjacent edges ) .",
    "we then choose an edge @xmath62 in @xmath61 and we attach @xmath63 onto @xmath62 by adding a new intermediate vertex along @xmath62",
    ". see figure [ fig : spr ] for an illustration .",
    "let @xmath64 denote the tree resulting from the above transition .",
    "is marked by an arrow .",
    "the subtree containing @xmath65 and @xmath66 is pruned , and then regrafted at the edge @xmath62 marked by a starred arrow .",
    "the resulting tree is illustrated.,height=192 ]    we analyze the following markov chain which chooses a random subtree @xmath63 to prune , and then chooses an edge to regraft @xmath63 along based on the maximum likelihood of the resulting tree .",
    "this markov chain is an analogous to heat bath chains studied in statistical physics ( as opposed to metropolis chains ) , e.g. , see @xcite , thus we refer to the below chain as the heat bath spr markov chain .",
    "here is the formal definition of the transitions @xmath67 of the heat bath spr markov chain .    from a tree @xmath68 at time @xmath69 we proceed as follows .    1 .   choose a random subtree @xmath63 of @xmath68 , by choosing a random edge @xmath11 and then choosing one of the two subtrees hanging off of @xmath11",
    "let @xmath61 denote the tree formed by deleting @xmath63 and @xmath11 from @xmath0 .",
    "2 .   for each edge @xmath62 of tree @xmath61 , let @xmath70 where @xmath71 is the tree formed by pruning @xmath63 from @xmath0 and regrafting @xmath63 onto edge @xmath62 . let @xmath72 be the distribution on edges of @xmath61 where @xmath73 and @xmath74 .",
    "sample an edge @xmath62 from the distribution @xmath72 on edges of @xmath61 .",
    "graft @xmath63 onto edge @xmath62 and move to this new tree , i.e. , set @xmath75 .",
    "we now verify that the above markov chain is ergodic and reversible with respect to the distribution @xmath12 on trees where @xmath76 , and thus @xmath12 is also the unique stationary distribution .",
    "let @xmath77 and @xmath78 be neighboring states of the markov chain .",
    "let @xmath63 be the tree that is pruned and regrafted to obtain @xmath78 from @xmath77 .",
    "note that the same tree @xmath63 can be pruned and regrafted to obtain @xmath77 from @xmath78 .",
    "the transition probability from @xmath77 to @xmath78 is the probability of choosing @xmath63 in step @xmath79 times @xmath80 .",
    "similarly the transition probability from @xmath78 to @xmath77 is the probability of choosing @xmath63 in step @xmath79 times @xmath81",
    "( note that @xmath82 is the same in both cases since pruning @xmath63 results in the same tree @xmath61 ) .",
    "the detailed balance condition is satisfied for @xmath76 and hence it is the unique stationary distribution .",
    "let @xmath83 denote the ( total ) variation distance between a pair of probability distributions @xmath46 and @xmath84 defined on the same finite , discrete space , and let @xmath85 denote the @xmath69-step distribution of the markov chain from initial state @xmath86 .",
    "the mixing time @xmath87 is defined as @xmath88 which is the time to reach variation distance @xmath89 of the stationary distribution from the worst initial state .",
    "note , it is straightforward to then `` boost '' so that for any @xmath90 , after @xmath91 steps we are within variation distance @xmath92 of @xmath12 , from the worst initial state ( see aldous @xcite ) .",
    "mcmc algorithms are an important tool for phylogenetic reconstruction .",
    "mrbayes @xcite is a popular program that relies on mcmc methods for bayesian inference of phylogeny .",
    "mrbayes uses a sophisticated variant of mcmc known as metropolis - coupled mcmc @xcite .    for statistical inference problems , such as phylogenetic reconstruction",
    ", it is often easy to design appropriate mcmc algorithms , such as the above markov chain we defined using spr transitions , which converge in the limit over time to the desired posterior distribution .",
    "however , the computational efficiency of these methods rely on their _ fast _ convergence to the posterior distribution .",
    "since theoretical results are typically lacking , heuristic methods are used to measure convergence to the desired distribution . hence , there are often no rigorous guarantees on the scientific computations which rely on the random samples produced by the mcmc methods .",
    "our goal is to provide some theoretical understanding of settings where mcmc methods for phylogenetic reconstruction are provably fast and hence yield accurate results , and settings where the mcmc methods are slow and consequently the samples may be misleading .",
    "there are several works with computational experiments on the convergence rates of mcmc algorithms for phylogenetic reconstruction , e.g. , see the recent works @xcite .",
    "there is relatively little theoretical work .",
    "diaconis and holmes @xcite proved fast convergence of a markov chain to the uniform distribution over phylogenetic trees . recently , several works have shown examples of heterogeneous data where mcmc algorithms are provably slow to converge .",
    "mossel and vigoda @xcite proved slow convergence for a class of examples with data arising from a uniform mixture of a pair of 5-taxa trees ( with different topologies ) .",
    "tefankovi and vigoda @xcite proved slow convergence for a class of mixture examples from a pair of 5-taxa trees that share the same topology but differ in their branch lengths . in these slow mixing results ,",
    "the convergence time is exponential in the number of characters ( i.e. , sequence length ) .    in this paper",
    "we show fast convergence for data from a homogenous source of closely related species . in particular , for data generated from a single tree ( of any size )",
    "when all the branch lengths are sufficiently short , we prove fast convergence .",
    "the requirement of sufficiently short branches is for our proof technique , but it is important to note that the slow mixing results mentioned earlier @xcite require , in an analogous manner , sufficiently short branches . if one searches for the tree with the maximum likelihood ( or maximum a posteriori probability ) our methods show that in our setting of very short branch lengths , the space of trees ( connected by the spr moves ) has no local maxima and hence one can find the optimal tree using hill climbing .    for simplicity , we present our results here for the case where the weight of a tree is the maximum likelihood of generating the given data @xmath93 where the maximum is over a rate matrix @xmath9 ( common to all edges ) and a set of branch lengths @xmath44 . this",
    "is closely related to the posterior distribution when the priors are uniformly distributed .",
    "our results extend to @xmath94-regular priors , which are priors that are lower bounded by some @xmath90 , see section [ sec : posterior ] for a discussion on the extension of our results to sampling the posterior distribution .",
    "we are interested in the mixing time @xmath87 , defined as the number of steps until the chain is within variation distance @xmath89 of the stationary distribution .",
    "we prove that the heat bath spr markov chain converges quickly to its stationary distribution when the data is generated from a tree @xmath36 where all of the branch lengths are sufficiently small , and there are sufficiently many samples generated from @xmath36 . here",
    "is the formal statement of our main result .",
    "[ thm : main ] consider any reversible @xmath95-state model , any phylogenetic tree @xmath36 on @xmath1 taxa and any rate matrix @xmath37 with no zero entries .",
    "for all @xmath96 , there exists @xmath97 , such that for all @xmath98 and any choice of branch lengths @xmath99 for @xmath100 , there exists @xmath101 where the following holds .    for a data set with @xmath102 characters , each chosen independently from the distribution @xmath39 , then , with probability @xmath103 over the data generated , the heat bath spr markov chain has mixing time @xmath104 .",
    "since there is considerable quantification in the above theorem we will take a moment to dissect it at a high - level .",
    "first off , the requirement that @xmath102 comes from needing the data to look very much like the generating distribution @xmath105 .",
    "therefore , how much data we need depends on several quantities , such as the minimum probability of a configuration arising in @xmath47 , which depends on the minimum branch length and the minimum rate in @xmath37 .",
    "hence , @xmath106 depends on @xmath107 and @xmath37 , and is exponential in @xmath1 .",
    "a somewhat related question has been studied by steel and szkely @xcite on how large @xmath108 needs to be so that the maximum likelihood tree is the generating tree @xmath36 . in their results",
    "one also needs @xmath108 to be exponential in @xmath1 .",
    "our proof uses the fact that in the setting of theorem [ thm : main ] , where the branch lengths are sufficiently short , the leading term of the maximum likelihood function is actually maximum parsimony .",
    "such a result is well - known in the mathematical phylogeny community , and was first observed by felsenstein @xcite .",
    "we require a more detailed statement of such a result , which we present in lemma [ lem : opt - weights ] in section [ sec : likelihood ] .",
    "our main technical contribution is a combinatorial proof that , in the setting of theorem [ thm : main ] , spr moves can be used in a greedy manner to quickly find the maximum parsimony tree .",
    "this result is presented in section [ sec : a - analysis ] .",
    "finally , in section [ sec : rapid - mixing ] we show how theorem [ thm : main ] follows in a straightforward manner from these combinatorial results . in section [ sec : posterior ]",
    "we discuss how theorem  [ thm : main ] extends to bayesian inference .",
    "we make some concluding remarks in section [ remarks ] .",
    "to prove theorem [ thm : main ] we will analyze , for every tree @xmath0 , the maximum expected log - likelihood @xmath109 where @xmath105 ( recall that @xmath109 is the maximum expected log - likelihood of @xmath0 maximized over all rate matrices @xmath9 and all edge lengths @xmath44 , see ) . to analyze @xmath109 we will consider the dominant terms of the likelihood function .",
    "we will show that @xmath110 where @xmath111 is the entropy of the stationary distribution of @xmath37 and thus is the same for every @xmath0 . by taking @xmath112",
    "sufficiently small the last term @xmath113 can be ignored .",
    "therefore , the dominant term is @xmath114",
    ". we will prove that the function @xmath115 decreases with each optimal spr move .",
    "hence , since @xmath116 is negative , we then have that @xmath36 has the highest maximum expected log - likelihood , and as the markov chain gets closer to @xmath36 the maximum expected log - likelihood will increase .",
    "theorem [ thm : main ] will then follow in a straightforward manner .",
    "let @xmath0 be a tree with leaves @xmath117 .",
    "let @xmath118 be a partition of the leaves into two parts @xmath119 .",
    "note that we only consider the partition of the leaves without any regard for the internal vertices .",
    "let @xmath120 denote the size of the cut ( i.e. , a subset of edges ) of minimum size that disconnects @xmath121 from  @xmath122 .",
    "tuffley and steel @xcite showed that the quantity @xmath120 is the parsimony score of the character corresponding to @xmath118 ( see also semple and steel ( * ? ? ?",
    "* proposition 5.1.6 ) ) , where the character corresponding to @xmath123 assigns all leaves in @xmath121 some @xmath124 and assigns all leaves in @xmath122 some @xmath125 .",
    "for an edge @xmath7 , the removal of @xmath11 splits @xmath0 into two components .",
    "this induces a partition of the leaves of @xmath0 into two parts .",
    "we will call this partition @xmath126 .",
    "the following is the main technical tool for our results .",
    "the lemma describes the high - order terms of the likelihood function as @xmath127 . throughout this paper",
    ", the asymptotic notations @xmath128 and @xmath129 are parameterized by @xmath130 .",
    "roughly speaking , the lemma shows there is a function @xmath115 which plays a leading role in the maximum likelihood . in words , @xmath115 looks at each partition @xmath118 of leaves in the generating tree @xmath36 realized by cutting a single edge @xmath62 .",
    "it then considers the minimum number of edges in @xmath0 to realize this partition @xmath118 times the branch length of @xmath62 in the generating tree . as mentioned in the introduction , there are earlier results which show that the leading term of the likelihood function is the parsimony score , e.g. , felsenstein  @xcite , and in the below lemma , the function @xmath131 is the leading term of the expected parsimony score .",
    "we require a more detailed statement than we found in the literature .",
    "[ lem : opt - weights ] let @xmath132 be trees with leaves @xmath117 and @xmath37 be a rate matrix reversible with respect to @xmath133 .",
    "assume that the matrix @xmath37 is normalized ( that is , @xmath134 ) and that @xmath37 has no zero entries .",
    "let @xmath36 have branch lengths @xmath135 , where @xmath136 $ ] , for all @xmath100 , where @xmath96 .",
    "let @xmath137 for @xmath105 the following holds : @xmath138 where @xmath139 is the entropy of @xmath133 , and the constant in the @xmath140 is independent of the choice of the @xmath141 ( but does depend on @xmath142 and @xmath143 ) .    as a consequence of the above lemma , to analyze the expected log - likelihood on the tree space , when @xmath112 is sufficiently small , we simply have to consider the function @xmath144 .",
    "in the next subsection we will investigate the combinatorial properties of @xmath131 .    before presenting the proof of lemma [ lem : opt - weights ] we give a brief outline of its proof .",
    "let @xmath47 denote the probability distribution defined by @xmath37 and @xmath36 on assignments of labels from @xmath4 to the leaves . in this generating distribution @xmath47 ,",
    "to prove we only need to consider two types of assignments .",
    "the first type are constant assignments where no substitutions occur and thus all leaves receive the same label @xmath145 , these are denoted as @xmath146 .",
    "the second type are assignments obtained by a substitution along just one edge @xmath62 . in this case",
    ", the cut obtained by deleting edge @xmath62 plays an important role . by deleting @xmath62 from @xmath36 ,",
    "the leaves are partitioned into two sets @xmath121 and @xmath122 , denoted as @xmath147 .",
    "if a substitution only occurs along edge @xmath62 , then the leaves in @xmath121 will receive the same label @xmath145 , and the leaves in @xmath122 will receive another label @xmath148 .",
    "we denote such an assignment by @xmath149 .",
    "any other type of assignment requires at least two substitutions , and hence has probability at most @xmath150 , which is dominated by the @xmath151 term of  .    for any tree @xmath0 , to prove that @xmath109 is lower bounded by the right - hand side of , we compute the expected log - likelihood of @xmath47 for the rate matrix @xmath152 and the set of branch lengths @xmath44 where @xmath153 for every edge @xmath11 .",
    "for each edge @xmath62 and its corresponding assignment @xmath149 , the quantity @xmath154 is the minimum number of edges which require a substitution to obtain the assignment @xmath149 on @xmath0 .",
    "hence , the quantity @xmath144 plays an important role when we sum over all edges @xmath62 of @xmath36 .",
    "in particular , by a calculation ( as detailed in below ) , the expected log - likelihood @xmath155 , for this set of branch lengths @xmath44 , is @xmath156 .",
    "since @xmath157 , this implies the lower bound of  .    to obtain the upper bound of we consider three cases : when the rate matrix @xmath9 has a stationary distribution different from @xmath37 , when there is an edge @xmath11 where @xmath14 is long ( namely @xmath158 ) , and when all edges are short . in the first case of different stationary distributions , by considering the constant assignments it will be easy to establish that there is a difference in the first term of the right - hand side of  . when there is a long edge , then the constant assignments are too unlikely to occur . finally ,",
    "if all edges are shorter than @xmath159 , then , by calculation , we show that the expected log - likelihood is at most the right - hand side of  .",
    "we now present the formal proof of lemma [ lem : opt - weights ] .",
    "we first make some observations about the distribution  @xmath47 .",
    "let @xmath160 denote the transition matrix for @xmath37 , as defined in .",
    "note , for any @xmath11 , any @xmath20 where @xmath161 , we have @xmath162 for any @xmath145 we have @xmath163    for @xmath145 , let @xmath164 denote the constant assignment @xmath165 for all leaves  @xmath60 .",
    "note to achieve @xmath146 in @xmath47 we assign label @xmath166 to the root and then we have no substitutions , or we have at least two edges with substitutions .",
    "thus , @xmath167 for an edge @xmath100 and @xmath20 where @xmath161 , let @xmath168 denote the assignment of label @xmath166 to all leaves in one of the partitions of @xmath169 and label @xmath170 to all leaves in the other partition of @xmath169 . in this case",
    "we have : @xmath171 ( to see why is correct , w.l.o.g . , assume that the root is a leaf in the first partition of @xmath169 , and hence to achieve @xmath172 we need to label the root by @xmath166 and have a substitution on @xmath11 , or at least two edges with substitutions . )",
    "now we compute @xmath173 where @xmath153 for each edge @xmath11 of @xmath0 and @xmath152 .",
    "again we will make some observations about @xmath174 . by the same reasoning as we used for",
    ", we obtain @xmath175 we can obtain assignment @xmath176 on @xmath0 using a substitution on @xmath177 edges , and we can not obtain this assignment with fewer substitutions .",
    "hence , @xmath178 therefore , @xmath179 in order to compute the high - order terms of @xmath173 we do not need to consider labelings other than @xmath146 and @xmath176 ( the other labelings have probability @xmath150 in @xmath47 ) .    combining , , , and we obtain @xmath180 where in the last inequality we used the fact that @xmath37 is normalized .",
    "this proves the lower bound in .",
    "it remains to prove the upper bound in .",
    "we will show that no rate matrix and no assignment of branch lengths can do better than the bound established in  .",
    "let @xmath9 be a rate matrix with stationary distribution @xmath12 .",
    "if @xmath181 then we bound @xmath182 as follows .",
    "first , note that the terms in the sum are negative and hence to obtain an upper bound we will only consider the constant assignments .",
    "second , the probability of constant assignment @xmath146 in @xmath47 is @xmath183 and similarly @xmath184 .",
    "thus @xmath185 where @xmath186 is the k - l divergence of @xmath12 from @xmath133 .",
    "since , by the gibbs inequality , the kl - divergence is positive when @xmath187 , we have established the upper bound in for the case @xmath181 .",
    "now we assume @xmath188 .",
    "let @xmath44 be an assignment of branch lengths to @xmath0 .",
    "let @xmath189 .",
    "suppose that there exists an edge @xmath190 with branch length @xmath191 .",
    "we are going to show that such a @xmath44 has a tiny log - likelihood because of the constant leaf labelings ( i.e. , @xmath192 ) . by , we have @xmath193 , where @xmath194 .",
    "hence , @xmath195 thus @xmath196 as @xmath127 , is smaller than the right - hand side of and we are done .    we are now left with the case in which all edges @xmath190 have branch lengths @xmath197 . since we can generate the leaf labelings starting from any vertex , then by starting at a leaf , we see that : @xmath198 moreover , for @xmath100 , to generate @xmath176 , we need to have substitutions across all edges in a cut that realizes @xmath169 .",
    "since the edges are short this happens with probability @xmath199 where @xmath200 is the size of the cut .",
    "since there are at most @xmath201 such cuts and each has size at least @xmath154 , we have that : @xmath202 hence , @xmath203      in light of lemma [ lem : opt - weights ] , we need to analyze how @xmath115 changes with spr moves . by taking @xmath108 sufficiently large , for each subtree @xmath63 , we will only need to analyze the effect of the optimal spr move for @xmath63 ( optimal in terms of minimizing @xmath204 ) .    the quantity @xmath115 looks at cuts obtained by single edges of @xmath36 .",
    "for a tree @xmath0 , we classify the edges of @xmath36 as good or bad if their corresponding cut in @xmath36 is realizable in @xmath0 by cutting a single edge .",
    "more precisely , let @xmath205 be the set of good edges for @xmath0 .",
    "let @xmath206 .",
    "the following lemma says that for every tree @xmath207 obtained from @xmath0 by an spr move using @xmath63 , if @xmath207 has more bad edges than @xmath0 , then this was not the optimal spr move using @xmath63 .",
    "namely , there is a tree @xmath61 which is also obtained from @xmath0 by an spr move using @xmath63 , and @xmath61 is such that @xmath208 .",
    "( more precisely , each term in @xmath204 is less than or equal to the corresponding term in @xmath209 and there is a term in @xmath204 which is strictly smaller than the corresponding term in @xmath209 ) .",
    "our proof has some similarity to those of bruen and bryant @xcite which connect the parsimony score of a character to the minimum number of spr transitions needed to obtain the character .",
    "[ lem : t ] for every generating tree @xmath36 and all trees @xmath210 where @xmath0 and @xmath207 differ by a prune - and - regraft of a subtree @xmath63 and such that there exists @xmath211 the following holds .",
    "there exists a tree @xmath61 which differs from @xmath0 by a prune - and - regraft of @xmath63 and such that @xmath212 for every partition @xmath118 realized by single edges in @xmath36 and @xmath213 for partition @xmath118 realized by @xmath214 in @xmath36 .",
    "suppose an edge @xmath215 is good for @xmath0 and is bad for @xmath207 .",
    "let @xmath216 be the partition of the leaves induced by @xmath214 in @xmath36 .",
    "thus , in @xmath0 , there is an edge @xmath217 which partitions the leaves into @xmath218 and @xmath219 .",
    "see figure  [ fig : setup ] for an illustration of the setup .",
    "is good for @xmath0.,height=115 ]    let @xmath220 denote the subtree `` hanging off '' of @xmath221 in @xmath0 .",
    "more precisely , after deleting @xmath222 from @xmath0 , let @xmath220 be the subtree containing @xmath221 .",
    "let @xmath218 denote the leaves in @xmath220 .",
    "similarly , let @xmath219 denote the leaves and @xmath223 denote the subtree hanging off of @xmath224 .",
    "let @xmath60 denote the root of the subtree @xmath63 .",
    "first we claim that @xmath225 .",
    "suppose @xmath226 and without loss of generality suppose @xmath227 .",
    "see figure [ fig : f - in - s ] for an illustration of this case .    , this scenario can not occur.,height=144 ]    thus we must be grafting @xmath63 into an edge of @xmath228 .",
    "after such a move , the edge @xmath222 still separates @xmath218 and @xmath219 , and thus @xmath214 is still good . therefore , @xmath225 .    from now on , we assume , without loss of generality , that @xmath229 where @xmath230",
    ". see figure [ fig : tt2 ] .",
    ", this must be the scenario.,height=124 ]    we construct the tree @xmath61 by taking @xmath0 , pruning @xmath63 and then regrafting @xmath63 along edge  @xmath222 , see figure [ fig : t ] .",
    ".,height=144 ]    note that @xmath207 is obtained from @xmath0 by regrafting @xmath63 onto an edge in @xmath223 ( otherwise @xmath214 would be good for @xmath207 ) , see figure [ fig : tww ] .",
    ", @xmath63 is regrafted into @xmath223.,height=163 ]    the following claim says that the tree @xmath61 satisfies the conclusion of the lemma .",
    "[ claim : t ] for every partition @xmath123 of leaves realized by edges of @xmath36 , it holds that : @xmath231    moreover , for the partition @xmath232 ( corresponding to @xmath214 ) , we have that : @xmath233    the proof of the claim proceeds by constructing a cut in @xmath61 realizing @xmath119 by a small modification of a cut in @xmath207 realizing @xmath119 .",
    "assuming the claim , the proof of the lemma is now complete .",
    "we now prove the above claim .",
    "we continue using the setup and notation from the proof of lemma [ lem : t ] in section  [ sec : a - analysis ] .",
    "recall , the claim says that for every partition @xmath123 of leaves realized by edges of @xmath36 that @xmath234 and for the partition @xmath232 , @xmath235 .",
    "first we argue that @xmath235 .",
    "note that @xmath236 since @xmath214 is bad for @xmath207 . on the other hand , @xmath237 since cutting @xmath238 separates @xmath218 and  @xmath219 .",
    "now we just need to argue that @xmath234 .",
    "let @xmath239 be an edge in @xmath36 .",
    "let @xmath123 be the corresponding partition in @xmath36 .",
    "note that if @xmath240 is in the subtree with leaves @xmath218 then @xmath241 on the other hand , if @xmath240 is in the subtree with leaves @xmath219 then @xmath242    consider a minimum cut @xmath243 that realizes @xmath119 in @xmath207 and amongst these minimum cuts is the one with the fewest number of edges in subtrees @xmath244 and @xmath63 .",
    "we claim that @xmath221 is reachable from a leaf of @xmath244 in @xmath245 and that @xmath60 is reachable from a leaf of @xmath63 in @xmath245 .",
    "suppose that @xmath221 is not reachable from a leaf of @xmath244 .",
    "let @xmath246 be the edge in @xmath247 closest to @xmath221 .",
    "we claim that @xmath248 realizes @xmath119 .",
    "if there was a pair of leaves in @xmath244 each in different @xmath249 that are connected in @xmath250 then by the choice of @xmath246 one of those leaves would be connected to @xmath221 in @xmath245 , a contradiction with the assumption that @xmath221 is not reachable from a leaf of @xmath244 in @xmath245 .",
    "thus @xmath121 and @xmath122 are still separated in @xmath244 in @xmath250 ; @xmath121 and @xmath122 are still separated by @xmath251 in @xmath252 since @xmath253 in this subtree ; and @xmath254 ensures that pairs across @xmath222 are separated .",
    "note that @xmath255 and @xmath251 has fewer edges in @xmath244 and @xmath63 , a contradiction with the choice of @xmath66 .",
    "thus @xmath221 is reachable from some leaf of @xmath244 in @xmath245 .",
    "the argument for @xmath63 and @xmath60 is the same .    since a leaf of @xmath63 is reachable from @xmath60 in @xmath245 , then in other words a ( non - empty ) subset of @xmath121 and/or @xmath122 are reachable from @xmath60 .",
    "moreover , since @xmath66 realizes the partition @xmath119 , then a subset of only one of the @xmath249 is reachable from @xmath60 in @xmath245 ; we will say @xmath60 is of type @xmath249 to signify the @xmath249 reachable from @xmath60 .",
    "analogously , we say @xmath256 is of type @xmath249 for the set reachable from @xmath221",
    ".    if @xmath60 and @xmath221 are of the same type @xmath249 , let @xmath257 we claim @xmath251 realizes @xmath119 in @xmath61 . to see this ,",
    "note that if a path ( between a pair of leaves ) exists in @xmath61 and does not exist in @xmath207 then it must include @xmath258 which is the new vertex in @xmath61 where @xmath63 is regrafted , see figure [ fig : t ] for an illustration .",
    "now we argue that such a path can not connect a leaf in @xmath121 with a leaf in @xmath122 in @xmath259 .",
    "note that only a subset of @xmath249 is reachable from @xmath258 in @xmath259 , since @xmath258 can reach the same set of vertices ( outside of @xmath63 ) in @xmath259 as @xmath221 does in @xmath245 , and only a subset of @xmath249 is reachable from @xmath60 in @xmath260 .",
    "finally , since @xmath261 we have that @xmath212 which completes the proof in this case .",
    "now suppose @xmath221 is of type @xmath121 and @xmath60 is of type @xmath122 .",
    "this means a leaf of @xmath63 is in @xmath122 and since @xmath262 , it is also in @xmath218 and we are in case , thus @xmath263 .",
    "note @xmath66 has to separate @xmath221 from @xmath219 by some set of edges @xmath264 .",
    "let @xmath265 .",
    "the new pairs of leaves that are connected in @xmath259 ( but not in @xmath245 ) are either both from @xmath219 and hence @xmath122 , or are connected by a path that exists in @xmath61 and does not exist in @xmath207 . as in the previous case ,",
    "if a path ( between a pair of leaves ) exists in @xmath61 and does not exist in @xmath207 then it must include @xmath258 which is the new vertex in @xmath61 where @xmath63 is regrafted . note that @xmath258 is disconnected from @xmath244 in @xmath259 ( since @xmath254 ) .",
    "the leaves of @xmath223 are from @xmath122 and the leaves of @xmath63 reachable from @xmath60 in @xmath260 are also from @xmath122 .",
    "therefore the new paths do not connect leaves of @xmath121 and @xmath122 .",
    "this completes this case since @xmath255 .",
    "finally , suppose @xmath221 is of type @xmath122 and @xmath60 is of type @xmath121 . in this case",
    "a leaf of @xmath244 is in @xmath122 and is also in @xmath218 and therefore we are again in case , thus @xmath263 .",
    "note @xmath66 has to separate @xmath60 from @xmath219 by some set of edges @xmath264 .",
    "let @xmath266 .",
    "once again , the new pairs of leaves that are connected in @xmath259 ( but not in @xmath245 ) are either both from @xmath219 and hence @xmath122 , or are connected by a path that exists in @xmath61 and does not exist in @xmath207 .",
    "note that @xmath258 is disconnected from the leaves of @xmath63 in @xmath259 .",
    "the leaves of @xmath223 are from @xmath122 and the leaves of @xmath244 reachable from @xmath221 are also from @xmath122",
    ". therefore the new paths in @xmath259 do not connect leaves of @xmath121 and @xmath122 .",
    "this completes this case since @xmath255 .",
    "this completes the proof of the claim .    using lemma [ lem : t ]",
    ", we will prove that for every subtree @xmath63 the optimal spr move using @xmath63 does not increase the number of bad edges , and there is a subtree @xmath63 where the optimal spr move using @xmath63 decreases the number of bad edges .",
    "it will then be straightforward to prove rapid mixing by analyzing the time until the number of bad edges is zero , and hence we have reached @xmath36 .    [",
    "lem : increase ] for all trees @xmath36 , every choice of parameters @xmath267 , for all trees @xmath268 the following holds , where @xmath269 is defined in .    1 .   for any subtree @xmath63 of @xmath0",
    "the following holds .",
    "let @xmath270 be any tree which minimizes @xmath271 amongst the spr neighbors of @xmath0 which differ by a prune - and - regraft of @xmath63 .",
    "then , @xmath272 2 .",
    "there exists a subtree @xmath63 of @xmath0 where the following holds .",
    "let @xmath270 be any tree which minimizes @xmath271 amongst the spr neighbors of @xmath0 which differ by a prune - and - regraft of @xmath63 .",
    "then , @xmath273    part 1 of lemma [ lem : increase ] follows immediately from lemma [ lem : t ] . to prove part 2 we choose a particular ` minimal ' subtree @xmath63 . roughly speaking",
    ", we consider the bad edge @xmath214 that is closest to the leaves in @xmath36 , and take the subtree @xmath63 hanging off of @xmath214 .",
    "if is violated then there exists @xmath274 , and hence by lemma [ lem : t ] , there exists @xmath61 ( which differs from @xmath0 and @xmath270 by a prune - and - regraft of @xmath63 ) such that no cuts increased in size and the cut corresponding to @xmath214 is smaller .",
    "therefore , @xmath275 , contradicting the choice of @xmath270 .",
    "therefore , part 1 holds .",
    "we now prove part 2 .",
    "we first claim that there is an spr move that decreases the number of bad edges .",
    "[ claim : fewer - bad ] for every tree @xmath0 , there is an spr move resulting in a tree @xmath61 where @xmath276    now we argue that part 2 of the lemma follows from the above claim and part  1 .",
    "we then go back to prove the claim .",
    "consider a subtree @xmath63 of @xmath0 .",
    "let @xmath277 denote those trees obtainable from @xmath0 by a prune - and - regraft of @xmath63 .",
    "note , for any @xmath278 , we have that @xmath279 , since when we prune @xmath63 from @xmath0 and @xmath61 we have the same subtree remaining .",
    "let @xmath61 denote the neighboring tree from claim [ claim : fewer - bad ] with fewer bad edges , and let @xmath63 denote the subtree where @xmath278 .",
    "let @xmath280 denote the tree in @xmath277 which minimizes @xmath281 .",
    "as noted above we must have that @xmath279 .",
    "thus , @xmath280 is also the neighbor of @xmath61 that minimizes @xmath281 .",
    "therefore , we can apply part 1 of the lemma for tree @xmath61 and subtree @xmath63 , and conclude that @xmath282 .",
    "combined with we then have that : @xmath283 which proves part 2 .",
    "we now prove claim [ claim : fewer - bad ] .",
    "let @xmath214 in @xmath36 be an edge in @xmath284 that is `` closest '' to the leaves in the following precise sense .",
    "say @xmath214 joins subtrees @xmath285 and @xmath286 in @xmath36 where the number of vertices in @xmath285 is at most the number of vertices in @xmath286 .",
    "then we say the distance of @xmath214 to the leaves is the number of vertices of @xmath285 .",
    "note , by the choice of @xmath214 , @xmath285 contains no bad edges for @xmath0 .",
    "first , note that @xmath285 must contain at least two leaves because , in any tree , any single leaf can be separated from the rest of the leaves by deleting one edge ( which would contradict that @xmath214 is bad ) .",
    "let @xmath287 and @xmath288 denote the two subtrees of @xmath285 hanging from the root of @xmath285 in @xmath36 . both @xmath287 and @xmath288 must exist since @xmath285 contains at least two leaves .",
    "let @xmath218 and @xmath219 denote the leaves in @xmath287 and @xmath288 , respectively .",
    "since @xmath214 is the closest bad edge to the leaves , there is a subtree @xmath220 in @xmath0 whose leaves are @xmath218 , and also a subtree @xmath223 whose leaves are @xmath219 .",
    "moreover , by induction , @xmath289 and @xmath290 . in @xmath0 , by pruning @xmath223 and then regrafting along the edge incident to @xmath220 we obtain a copy of @xmath285 in @xmath0 .",
    "see figure [ fig : claim ] for an illustration .",
    "let @xmath61 be the tree resulting from this spr move .",
    "note , @xmath214 is now a good edge in @xmath61 .     with fewer bad edges.,height=144 ]",
    "it remains to argue that other edges of @xmath36 did not change from good for @xmath0 to bad for @xmath61 .",
    "note , edges in @xmath287 and @xmath288 remain good in @xmath61 since they are realizable in @xmath220 and @xmath223 , respectively .",
    "consider an edge @xmath62 of @xmath36 where @xmath291 .",
    "let @xmath119 be the partition of the leaves realized by @xmath62 in @xmath36 .",
    "note that @xmath216 are in the same partition , since tree @xmath285 is not cut by @xmath62 .",
    "let @xmath292 be the edge in @xmath0 that realizes @xmath119 .",
    "after pruning - and - regrafting @xmath223 ( to form @xmath61 ) , @xmath292 still realizes the partition @xmath119 since @xmath218 and @xmath219 are in the same partition .",
    "hence , @xmath62 is still good for @xmath61 .",
    "therefore , @xmath293 , which completes the proof of the claim .    finally , we prove that when the number of bad edges increases then @xmath115 also increases by a significant amount . as a consequence , in our analysis of the markov chain , by taking @xmath112",
    "sufficiently small , we can focus on how a transition changes @xmath115 and hence on the change in the number of bad edges .",
    "[ lem : gap ] for any trees @xmath0 and @xmath61 which differ by one spr move , if @xmath294 then @xmath295    let @xmath63 be the subtree used to move between @xmath0 and @xmath61 .",
    "let @xmath277 denote those trees obtainable from @xmath0 by a prune - and - regraft of @xmath63 .",
    "note @xmath296 .",
    "consider @xmath270 which minimizes @xmath271 amongst the spr neighbors of @xmath0 which differ by a prune - and - regraft of @xmath63 . since @xmath297 then @xmath270 is also the neighbor of @xmath61 that minimizes @xmath271 .",
    "fix @xmath298 . by part 1 of lemma [ lem :",
    "increase ] , @xmath299      the proof of our main theorem now follows from a straightforward argument .",
    "we show that the heat bath spr markov chain behaves like a local search algorithm , and then a simple coupling argument gives the mixing result .",
    "let @xmath300 denote the space of phylogenetic trees on @xmath1 taxa .",
    "for a tree @xmath301 , and subtree @xmath63 of @xmath0 , let @xmath277 denote those trees obtainable from @xmath0 by pruning - and - regrafting @xmath63 .",
    "let @xmath66 be the constant in the @xmath140 notation of for the chosen @xmath107 and @xmath302 . by choosing @xmath303 (",
    "note that @xmath303 is an upper bound on @xmath112 ) sufficiently small then for every tree  @xmath0 , in , the @xmath304 is smaller than @xmath305 and therefore : @xmath306 for some @xmath307 .    fix a tree @xmath268 and a subtree @xmath63 of @xmath0 . by lemma [ lem : gap ] and , for every @xmath278 where @xmath308 we have : @xmath309    for a character @xmath310 , let @xmath311 . a straightforward application of hoeffding s inequality @xcite and a union bound over @xmath310 implies , for all @xmath90 : @xmath312 let @xmath313 denote a lower - bound on the off - diagonal entries in the rate matrix . for @xmath303 sufficiently small , every labeling of the leaves has probability at least @xmath314 ; this follows from the fact that for every edge , every transition has probability @xmath315 , see for a precise statement .",
    "hence , by choosing @xmath303 sufficiently small ( relative to @xmath316 and the constant in the error term of ) , then for all @xmath310 , @xmath317 .",
    "let @xmath318 then , for @xmath319 , @xmath320 with probability @xmath321 for @xmath108 sufficiently large .",
    "the probability of moving from @xmath0 to @xmath61 after choosing @xmath63 in step 1 is at most : @xmath322 for @xmath108 sufficiently large . therefore , with probability @xmath323 , the chain will move from @xmath0 to some @xmath270 ( where @xmath270 is a tree that can be obtained from @xmath0 by an spr move and such that it minimizes @xmath281 ) , and thus by part 1 of lemma [ lem : increase ] the number of bad edges will not increase . moreover ,",
    "if we choose the subtree @xmath63 satisfying part 2 of lemma [ lem : increase ] then the number of bad edges will decrease .",
    "hence , with probability @xmath324 the number of bad edges decreases by at least one . in expectation , after @xmath325 steps of the chain the number of bad edges will be zero , in which case we have reached @xmath36 . by markov s inequality , with probability @xmath326 after @xmath327 steps we reach @xmath36 .",
    "once we reach @xmath36 the probability of moving to a different tree within @xmath327 steps is at most @xmath328 .",
    "hence the claimed mixing time follows by an elementary coupling argument ( c.f .",
    ", @xcite for an introduction to the coupling technique ) since from any pair of initial trees , both chains ( run independently ) reach @xmath36 at time @xmath327 with probability @xmath329 .",
    "the goal is often to randomly sample from the posterior distribution over trees . to do this , we consider a markov chain whose stationary distribution is the posterior distribution and analyze the chain s mixing time , which is a measure of the convergence time of the chain to its stationary distribution .",
    "let @xmath330 denote a prior density where @xmath331 our results extend to priors that are lower bounded by some @xmath90 as in mossel and vigoda @xcite . in particular , for all trees @xmath0 and all branch lengths  @xmath44 where @xmath332 for all edges @xmath11 , we require @xmath333 .",
    "we refer to these priors as @xmath334-regular priors .",
    "applying bayes law we get the posterior distribution : @xmath335 where @xmath336    each tree @xmath0 then has a posterior weight @xmath337 finally , the posterior distribution @xmath46 on trees is defined as @xmath338 .      to sample from the posterior distribution ,",
    "the markov chain is defined as in section [ sec : spr ] except that in step 2 the weight @xmath339 is now set as @xmath340 defined in .",
    "this ensures that the markov chain is reversible with respect to the posterior distribution , and hence this is the unique stationary distribution .",
    "theorem [ thm : main ] then extends to hold for any priors which are @xmath341-regular the proof easily extends to this case in the following manner .",
    "in particular , we need to modify the statement of lemma [ lem : opt - weights ] so that , for any tree @xmath0 , is achieved for @xmath152 and for every set of branch lengths @xmath44 where @xmath342 for all edges @xmath11",
    ". then we can use the same proof as lemma 21 in mossel and vigoda @xcite to get an analog of to hold for the posterior weights defined in in place of the maximum likelihood function @xmath343 , and the remainder of the proof of theorem [ thm : main ] remains the same .",
    "* nni transitions : * in a nni transition , an internal edge @xmath11 is chosen . since internal vertices have degree three ,",
    "there are four subtrees hanging off of  @xmath11 .",
    "there are three possible ways of attaching these four subtrees to @xmath11 , and an nni transition moves to one of these rearrangements .",
    "there are trees @xmath0 ( different from the generating tree @xmath36 ) where no nni neighbor ( strictly ) improves @xmath115 ; moreover , there are cases where there is also no improvement in the next term of .",
    "we are uncertain as to whether theorem [ thm : main ] holds for a markov chain based on nni transitions",
    ". it would be especially intriguing if there are cases where chains based on nni transitions are slow to converge ( so - called torpidly mixing ) , whereas a chain based on spr transitions is provably fast to converge ( rapidly mixing ) .",
    "* possible future work : * there are now several works with proofs of convergence of mcmc algorithms for phylogenetic reconstruction in certain settings  rapid mixing results in this paper and torpid mixing results in mossel and vigoda @xcite and tefankovi and vigoda @xcite ) .",
    "all of these results require that the branch lengths are sufficiently small so that only the dominant terms of the likelihood function need to be considered .",
    "a natural avenue for extending this paper , is to allow arbitrary branch lengths on the terminal edges .",
    "* rapid or torpid mixing for general pure distributions : * the most tantalizing question to the authors is whether there exists a pure distribution ( i.e. , a single generating tree as in the setting of this paper ) where markov chains based on all of the natural transitions ( e.g. , nni , spr and tbr transitions ) are slow to converge to the stationary distribution ( in other words , they are torpidly mixing ) .",
    "we expect simulations can be quite useful for finding such a bad example , if one exists ; in fact , our previous work @xcite on this topic was inspired by some intriguing findings from some simple simulations .",
    "we are thankful to the anonymous referees for many useful comments on the manuscript .",
    "b. a. berg .",
    "introduction to markov chain monte carlo simulations and their statistical analysis . in _",
    "markov chain monte carlo : innovations and applications _ , eds . , w. s. kendall , f. liang , and j .- s .",
    "wang , world scientific publishing co. , singapore .",
    "pages 1 - 52 , 2005 ."
  ],
  "abstract_text": [
    "<S> this paper studies a markov chain for phylogenetic reconstruction which uses a popular transition between tree topologies known as subtree pruning - and - regrafting ( spr ) . </S>",
    "<S> we analyze the markov chain in the simpler setting that the generating tree consists of very short edge lengths , short enough so that each sample from the generating tree ( or character in phylogenetic terminology ) is likely to have only one mutation , and that there enough samples so that the data looks like the generating distribution . </S>",
    "<S> we prove in this setting that the markov chain is rapidly mixing , i.e. , it quickly converges to its stationary distribution , which is the posterior distribution over tree topologies . </S>",
    "<S> our proofs use that the leading term of the maximum likelihood function of a tree @xmath0 is the maximum parsimony score , which is the size of the minimum cut in @xmath0 needed to realize single edge cuts of the generating tree . </S>",
    "<S> our main contribution is a combinatorial proof that in our simplified setting , spr moves are guaranteed to converge quickly to the maximum parsimony tree . </S>",
    "<S> our results are in contrast to recent works showing examples with heterogeneous data ( namely , the data is generated from a mixture distribution ) where many natural markov chains are exponentially slow to converge to the stationary distribution . </S>"
  ]
}