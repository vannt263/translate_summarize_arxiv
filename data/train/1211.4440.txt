{
  "article_text": [
    "at the 2012 varenna summer school on _ physics of complex colloids _ , i gave a series of lectures on computer simulations in the context of complex liquids .",
    "the lectures were introductory , although occasionally , i would mix in a more general cautionary remark",
    ". it seemed to me that there was little point in writing a chapter in the proceedings on ` introduction to computer simulations ' .",
    "books on the topic exist .",
    "however , i did not quite know what to write instead .",
    "then , over lunch , _ wilson poon _ suggested to me to write something on the limitations of existing simulations methods : where do they go wrong and why ?",
    "i liked the idea very much .",
    "the scope of the present manuscript is a bit broader : after a fairly general ( but brief ) introduction , i will discuss three types of issues :    1 .",
    "computer simulation methods that seem simple  yet require great care 2 .",
    "computer simulation methods that seem reasonable  but are not 3 .   myths and misconceptions    not all issues that i list are of direct relevance for soft matter . however , i hope that the reader will forgive me .",
    "i should also point out that many of the issues that i discuss are very well known ",
    "sometimes they are even trivial .",
    "however , i thought it better to list even the trivial examples , rather than assume that every single one of them is well known to all readers .",
    "some of the issues that i highlight may not be well known , simply because i am mistaken or i have missed a key reference .",
    "if so , i apologise .",
    "i also apologise for the rather black - or - white way in which i present problems .",
    "seen in their original context , the issues are usually more subtle . my aim is to show what can go wrong if techniques are used outside their original context .",
    "over the past 60 years , the speed at which computers perform elementary calculations has increased by a factor 10@xmath0 , and the size of computer memories and the capacity of data storage devices have undergone similarly spectacular increases .",
    "the earliest computer simulations of systems consisting of a few hundred atoms could only be performed on the world s largest computers .",
    "now , anybody who has access to a standard computer for personal use can carry out simulations that would have required a supercomputer only 15 years ago .",
    "moreover , software to carry out computer simulations is readily available .",
    "the fact that the hardware and software thresholds for performing ` normal ' simulations have all but disappeared forces us to think about the role of computer simulations  .",
    "the key question is :  why should one perform a simulation in the first place .",
    "when we look at computer simulations in an applied context , the answer to the question ` why simulation ? ' is simple : they can save time ( and money ) .",
    "increasingly , simulations are used to complement experiment or , more precisely , to guide experiments in such a way that they can focus on the promising compounds or materials .",
    "this is the core of the rapidly growing field of computational materials science and computational ` molecular ' design .",
    "computer simulations allow us to predict the properties of potentially useful substances , e.g. pharmaceutical compounds or materials with unique physical properties .",
    "using computer simulations we can pre - screen candidate substances to minimise the amount of experimental work needed to find a substance that meets our requirements .",
    "in addition , simulations are very useful to predict the properties of materials under conditions that are difficult to achieve in controlled experiments ( e.g. very high temperatures or pressures ) .",
    "computational materials science of the type sketched above is the ` front end ' of a broader scientific endeavour that aims to advance the field of particle - based modelling , thus opening up new possibilities .",
    "much of this development work is carried out in an academic environment where other criteria apply when we wish to answer the question whether a simulation serves a useful purpose .",
    "below , i list several valid reasons to perform a simulation , but i also indicate what reasons i consider less convincing .",
    "let me begin with the latter .",
    "the total number of molecular systems that can , in principle , be simulated is very , very large .",
    "hence , it is not difficult to find a system that nobody else has simulated before .",
    "this may seem very tempting .",
    "it is easy to perform a simulation , create a few nice colour snapshots and compute , say , a radial distribution function .",
    "then , we write a manuscript for a high impact journal and , in the abstract , we write ` here , for the first time , we report molecular dynamics simulations of _",
    "18-bromo-12-butyl-11-chloro-4,8-diethyl-5-hydroxy-15-methoxytricos-6,13-diene-19-yne-3,9-dione _ '  i took the name from wikipedia , and my guess is that nobody has simulated this substance .",
    "then , in the opening sentence of our manuscript we write : ` recently , there has been much interest in the molecular dynamics of _ 18-bromo-12-butyl-11-chloro-4,8-diethyl-5-hydroxy-15-methoxytricos-6,13-diene-19-yne-3,9-dione ... _ ' and , with a few more sentences , a some snapshots and graphs , and a concluding section that mirrors the abstract , the work is done ...    of course , this example is a parody of reality  but only just .",
    "such simulations provide information that answers no existing question  it is like the famous passage in the hitchhikers guide to the galaxy , where the computer ` deep thought ' has completed a massive calculation to answer the question of _ life , the universe and everything_. the answer is 42  but the problem is that nobody really remembers what the question was .",
    "a simulation should answer a question .",
    "but there are different kinds of questions .",
    "i will discuss some of the categories below .",
    "our knowledge of forces between all but the simplest molecules is limited .",
    "moreover , the construction of reliable force - fields is a time - consuming business that combines experimental and theoretical information .",
    "the most widely used force fields are hopefully ` transferable ' .",
    "this means that the interactions between molecules are decomposed into interactions between their constituent atoms or groups , and that the same interactions can be used when these atoms or groups are arranged to form other molecules",
    ". the model may take interactions between charges and polarisability into account but , in the end , the force - field is always approximate .",
    "this is even true when interactions are computed ` on the fly ' using density - functional theory or another quantum - based approach .",
    "therefore , if we wish to apply a force field to a new class of molecules , or in a range of physical conditions for which it has not been tested , we can not assume _ a priori _ that our force - field will perform well : we must compare the predictions of our simulations with experiment .",
    "if simulation and experiment disagree , our force field will have to be improved .",
    "optimising and validating force fields is an important ingredient of computer simulations .",
    "it has been suggested that simulation constitutes a third branch of science , complementing experiment and theory .",
    "this is only partly true .",
    "there is a two - way relation between theory and experiment : theories make predictions for experimental observations and , conversely , experiments can prove theories wrong ",
    "if experiment agrees with theory then this does not demonstrate that the theory is correct but that it is compatible with the observations .",
    "simulations have some characteristics of theory and some of experiment .      as is the case for theory , simulations start with the choice of a model , usually a choice for the hamiltonian ( ` the force field ' ) describing the system and , in the case of dynamical simulations , a choice for the dynamics ( newtonian , langevin , brownian etc ) . with this choice , simulations can ( in principle ) arrive at predictions of any desired accuracy  the limiting factor is computing power",
    ". however , simulations can never arrive at exact results , let alone analytical relations . unlike theories , simulations are therefore not a good tool to summarise our understanding of nature .",
    "however , they can provide important insights : for instance , a simulation can show that a particular model captures the essential physics that is needed to reproduce a given phenomenon .",
    "a case in point is hard - sphere freezing : before the simulations of alder and wainwright and jacobson and wood  @xcite , it was not obvious that systems with hard - sphere interactions alone could freeze .",
    "once this was known , approximate theories of freezing could focus on the simple hard - sphere model  and ` computer experiments ' could be used to test these theories .",
    "this shows two aspects of simulations : a ) it can act as a ` discovery tool ' and b ) it can be used to test predictions of approximate theories .",
    "conversely , exact results from theory are an essential tool to test whether a particular algorithm works : if simulation results ( properly analysed and , if necessary , extrapolated to the thermodynamic limit ) disagree with an exact theoretical result , then there is something wrong with the simulation .",
    "these tests need not be very sophisticated : they can be as simple as computing the average kinetic energy of a system and comparing with equipartition ( for a system of the same size ) , or computing the limiting behaviour of the non - ideal part of the pressure of a system with short - ranged interactions at low densities and comparing with the value expected on the basis of our knowledge of the second virial coefficient .      when comparing simulation with experiment , we do something else : we are testing whether our hamiltonian ( ` force - field ' ) can reproduce the behaviour observed in experiment .",
    "as said before : agreement does not imply that the force field is correct , just that it is ` good enough ' .",
    "once a simulation is able to reproduce the experimental behaviour of a particular system , we can use the computer as a microscope : we can use it to find hints that help us identify the microscopic phenomena that are responsible for unexplained experimental behaviour .",
    "experimentalists and simulators often speak a different ` language ' .",
    "experimental data are usually ( although not always ) expressed in s.i . units .",
    "simulators often use reduced units that can be an endless source of confusion for experimentalists ( see fig .",
    "[ fig : reducedunits ] ) .",
    "there are good reasons to use reduced units in simulations [ e.g. to use a characteristic particle diameter as a unit of length and to use the thermal energy ( @xmath1 ) as a unit of energy ] . however , the units should be clearly defined , such that a conversion to s.i .",
    "units can easily be made .",
    "there is one general rule , or rather a form of numerical ` etiquette ' , governing the comparison between experiment and simulation that is not often obeyed .",
    "the rule is that , if at all possible , simulations should compute directly what is being measured in experiment .",
    "the reason is that it is often not straightforward to convert experimental data into the quantities that are computed in a simulation : the procedure may involve additional approximations and , at the very least , is likely to lead to a loss of information . to give a specific example : scattering experiments do not measure the radial distribution function @xmath2 , rather , they measure @xmath3 over a finite range of wave - vectors . as @xmath2 is related to the fourier transform of @xmath3 , we would need to know @xmath3 for _ all _ wave vectors to compute @xmath2 . in practice ,",
    "experiments probe @xmath3 over a finite window of wave - vectors .",
    "if we would perform a fourier transform within this window , we would obtain an estimate for @xmath2 that contains unphysical oscillations ( and possibly even negative regions ) , due to the truncation of the fourier transform .",
    "of course , procedures exist to mitigate the effects of such truncation errors , yet , if at all possible , simulations should report @xmath3 to save the experimentalist the trouble of having to perform an approximate fourier transform of their data .",
    "there is , of course , a limit to this rule : some corrections to experimental data are specific for one particular piece of equipment .",
    "if simulations would account for these specific instrument effects , they could only be compared to one particular experiment . in that case",
    ", the meeting point should be half way .",
    "computers have become more powerful  but so have experimental techniques ( often for the same reason ) .",
    "many experiments generate huge data streams that are impossible to analyse by hand . for this reason ,",
    "computers play an important role in data analysis .",
    "most of these techniques are not related to computer simulations  but some are .",
    "increasingly , molecular modelling is integrated in experiments .",
    "the experimental data provide constraints that allow us to refine the model .",
    "increasingly , this type of simulation will be embedded in the experimental equipment  a black box that most users will not even see .",
    "the staggering increase in computing power during the past 60 years [ roughly by a factor 10@xmath0  ] , is such that it has not only quantitatively changed computing , but also qualitatively , because we can now contemplate simulations ( e.g. a short simulation of a system the size of a bacterium ) that were not even on the horizon in the early 50 s .",
    "however , in some cases , the speed - up achieved through the use of better algorithms ( e.g. techniques to study rare events ) have been even more dramatic . yet , the algorithms at the core of monte carlo or molecular dynamics simulations have barely changed since the moment that they were first implemented . hence , a computer simulator in the 60 s would have been able to predict fairly accurately on the basis of moore s law , what system sizes and time - scales we can simulate today .",
    "however , he / she ( more ` he ' than ` she ' in the 50 s and 60 s  arianna rosenbluth and mary - ann mansigh are notable exceptions ) would not have been able to predict the tools that we now use to study rare events , quantum systems or free - energy landscapes .",
    "i should add that many algorithmic improvements are not primarily concerned with computing speed but with the fact that they enable new types of calculations ( think of thermostats , barostats , fluctuating box shapes etc ) .",
    "it would be incorrect to measure the impact of these techniques in terms of a possible gain in computing speed .      although this point of view is not universally accepted , scientists are human .",
    "being human , they like to impress their peers . one way to impress your peers is to establish a record .",
    "it is for this reason that , year after year , there have been  and will be  claims of the demonstration of ever larger prime numbers : at present ",
    "2012  the record - holding prime contains more than ten million digits but less than one hundred million digits . as the number of primes is infinite , that search will never end and any record is therefore likely to be overthrown in a relatively short time .",
    "no eternal fame there . in simulations , we see a similar effort : the simulation of the ` largest ' system yet , or the simulation for the longest time yet ( it is necessarily ` either - or ' ) .",
    "again , these records are short - lived .",
    "they may be useful to advertise the power of a new computer , but their scientific impact is usually limited . at the same time , there are many problems that can not be solved with today s computers but that are tantalisingly close .",
    "it may then be tempting to start a massive simulation to crack such a problem before the competition do it .",
    "that is certainly a valid objective , and alder and wainwright s discovery of long - time tails in the velocity auto - correlation function of hard spheres is a case in point .",
    "the question is : how much computer time ( ` real ' clock time ) should we be prepared to spend . to make this estimate ,",
    "let us assume that the project will have unlimited access to the most powerful computer available at the time that the project starts .",
    "let us assume that this computer would complete the desired calculation in @xmath4 years .",
    "somewhat unrealistically , i assume that the computer , once chosen , is not upgraded .",
    "the competition has decided to wait until a faster computer becomes available .",
    "we assume that the speed of new computers follows moore s law .",
    "then , after waiting for @xmath5 years , the time to completion on a new computer will be @xmath6 ( 2.17 years is the time it takes the computer power to increase by a factor of @xmath7 if moore s law holds ) .",
    "the question is : who will win , the group that starts first , or the group that waits for a faster computer to become available : _ i.e. _ is @xmath8 the time @xmath5 that minimises @xmath9 , satisfies : @xmath10 this equation has a solution for positive @xmath5 when @xmath11 years . if the calculation takes less than 2.17 years , the group that starts first wins",
    "otherwise , the group that waits finishes the calculation after @xmath12\\ ] ] years .",
    "of course , this calculation is very oversimplified , but the general message is clear : it is not useful to buy a computer to do a calculation that will take several years .",
    "once more , i should stress that i mean ` wall clock ' time  not processor years .",
    "finally , it is important to realise that moore s law is not a law but an extrapolation that , at some point , will fail .",
    "many of the subtleties of computer simulations are related to the fact that the systems that are being studied in a simulation are far from macroscopic .",
    "the behaviour of a macroscopic system can be imitated , but never really reproduced , by using periodic boundary conditions .",
    "the main advantage of periodic boundary conditions is that they make it possible to simulate a small system that is not terminated by a surface , as it is periodically repeated in all directions . but",
    "even though the use of periodic boundary conditions will eliminate surface effects ( that are very dramatic for small systems ) , there are many other finite - size effects that can not be eliminated quite so easily .",
    "below , i will give a few examples .",
    "but first , a general comment about testing for finite size effects .",
    "if a simulator suspects finite size effects in a simulation , the obvious test is to repeat the same simulation with a system of a larger size , e.g. a system with double the linear dimension of the original system .",
    "the problem with this test is that it is rather expensive .",
    "the computational cost of a simulation of a fixed duration scales ( at least ) linearly with the number of particles . for a 3d system",
    ", doubling the linear dimensions of the system makes the simulation 8 times more expensive .",
    "in contrast , halving the system size makes the simulation 8 times cheaper .",
    "of course , if there is evidence for finite - size effects , then there it is necessary to perform a systematic study of the dependence of the simulation results  and then there is no cheap solution .",
    "a systematic analysis of finite size affects if of particular importance in the study of critical phenomena  @xcite . in general ,",
    "finite size effects will show whenever we study phenomena that are correlated over large distances : these can be static correlations ( as in the case of critical fluctuations ) or dynamic correlations , as in the case of hydrodynamic interactions .",
    "when a particle moves in a fluid , it gradually imparts its original momentum to the surrounding medium . as momentum",
    "is conserved , this momentum spreads in space , partly as a sound wave , partly as an ( overdamped ) shear waves .",
    "the sound wave moves with the speed of sound @xmath13 and will therefore cross a simulation box with diameter @xmath14 in a time @xmath15 .",
    "after that time , a particle will ` feel ' the effect of the sound waves emitted by its nearest periodic images . clearly , this is finite size effect that would not be observed in a bulk fluid .",
    "the time @xmath16 for such spurious correlations to arise is , in practice , relatively short .",
    "if @xmath14 is of the order of 10  nm and @xmath13 is of the order @xmath17 m / s , then @xmath16 is of order 10 ps .",
    "needless to say that most modern simulation runs are much longer than that .",
    "in addition to a sound wave , a moving particle also induces shear flow that carries away the remainder of its momentum .",
    "this ` transverse ' momentum is transported diffusively .",
    "the time to cross the periodic box is of order @xmath18 , where @xmath19 is the kinematic viscosity ( @xmath20 , where @xmath21 is the shear viscosity and @xmath22 the mass density ) . to take water as an example : @xmath23 and hence the time @xmath24 that it takes transverse momentum to diffuse one box diameter ( again ,",
    "i will assume @xmath14 = 10  nm ) is around 10 ps .",
    "what these examples show is that any numerical study of long - time dynamical correlations may require a careful study of hydrodynamic finite - size effects .",
    "below , i will discuss the specific example of hydrodynamic interactions .",
    "however , many of my comments apply ( suitably modified ) to the study of dislocations or the calculation of the properties of systems consisting of particles that interact through long - ranged forces ( e.g. charged or dipolar particles ) .      at large distances ,",
    "the hydrodynamic flow field that is induced by a force acting on a particle in a fluid , decays as @xmath25 .",
    "if we now consider a system with periodic boundary conditions , the hydrodynamic flow fields due to all periodic images of the particle that is being dragged by the external force will have to be added .",
    "it is clear that , just as in the case of the evaluation of coulomb interactions , a naive addition will not work .",
    "it would even seem that the total flow field due to an infinite periodic array of dragged particles would diverge .",
    "this is not the case , and the reason is the same a in the coulomb case : when we compute coulomb interactions in a periodic system , we must impose charge neutrality . similarly , in the case of hydrodynamic interaction , we must impose that the total momentum of the fluid is fixed ( in practice : zero ) .",
    "this means that if we impart a momentum @xmath26 to a given article , then we must distribute a momentum @xmath27 among all other particles .",
    "the result is that , if we start with a fluid at rest , dragging one particle in the @xmath28 direction , creates a back flow of all other particles in the @xmath29 direction .",
    "if there are @xmath30 particles in the system , this is an @xmath31 effect .",
    "but that is not the only finite size effect .",
    "the other effect is due to the fact that the drag force per particle needed to move a periodic array of particles through a fluid is not simply the sum of the forces needed to move a single particle at infinite dilution .",
    "in fact , the force is different ( larger ) by an amount that is proportional to @xmath32 ( roughly speaking , because the hydrodynamic interactions decay as @xmath25 ) .",
    "hence , the mobility ( velocity divided by force ) of a particle that belongs to a periodic array is less than the of an isolated particle in a bulk fluid . as a consequence ( stokes - einstein ) ,",
    "the diffusion coefficient of a particle in a periodic fluid has a substantial finite - size correction that scales as @xmath33 , where @xmath34 is the diameter of the particle .",
    "for a three - dimensional system , the diffusion coefficient therefore approaches its infinite system - size limit as @xmath35 , _",
    "i.e. _ very slowly . by comparison ,",
    "the finite - size correction due to back flow is relatively minor .",
    "periodic boundary conditions impose a specific symmetry on the system under study .",
    "for instance , if we study a fluid using simple - cubic periodic boundary conditions , then a single ` cell ' of this periodic lattice may look totally disordered , yet as it is repeated periodically in all directions , the system should be viewed as a simple cubic crystal with a particularly complex unit cell . as was already well known in the early days of computer simulations , the imposed symmetry of the periodic boundary conditions induces some degree of bond - orientational order in the fluid  @xcite . often , this ( slight ) order has no noticeable effect , but in the case of crystal nucleation it may strongly enhance the nucleation rate .",
    "this is why finite size effects on crystal nucleation are so pronounced .",
    "the shape of the simulation box has an effect on the magnitude of finite size effects . intuitively , it is obvious that this should be the case in the limit that one dimension of the box is much smaller than the others .",
    "for instance , if the simulation box has the shape of a rectangular prism with sides @xmath36 , then the shortest distance between a particle and its periodic image is @xmath37 .",
    "clearly , we want @xmath37 to be sufficiently large that a particle does not ` feel ' the direct effect of its periodic images .",
    "this sets a lower limit for @xmath37 . for a cubic box",
    ", @xmath38 and @xmath39 would have the same value , but for the rectangular prism mentioned above , they will be larger . hence , a large system volume would be needed to suppress finite size effect for a rectangular prismatic box than for a cubic box .",
    "this is one of the reasons why cubic boxes are popular ; the other reason is that it is very easy to code the periodic boundary conditions for cubic boxes .",
    "this second reason explains why cubic boxes are being used at all , because there are other box shapes that result in a larger distance between nearest periodic images for the same box volume .",
    "depending on the criteria that one use , there are two shapes that can claim to be optimal .",
    "the first is the _ rhombic dodecahedron _ ( i.e. the wigner - seitz cell of a face - centred cubic lattice ) . for a given volume , the rhombic dodecahedron has the largest distance between nearest periodic images  or , what amounts to the same thing , it has the largest inscribed sphere .",
    "the other ( more popular ) shape is the _ truncated octahedron _ ( the wigner - seitz cell of a body - centred cubic lattice ) . the truncated octahedron is the most ` spherical ' unit cell that can be used , in the sense that it has the smallest enclosing sphere .",
    "in fact , the ratio of the radii of the enclosing and inscribed spheres of the truncated octahedron is @xmath40 . for a rhombic dodecahedron ,",
    "this ratio is @xmath41 and for a cube it is @xmath42 . in two dimensions",
    "the optimal box shape is a hexagon ( and in 4d it is the wigner - seitz cell of the so - called @xmath43 lattice ) .    in simulations of isotropic fluids ,",
    "any shape of the simulation box can be chosen , provided that it is sufficiently large to make finite - size effects unimportant . however , for ordered phases such as crystals , the choice of the simulation box is constrained by the fact that is has to accommodate an integral number of crystal unit cells . if the crystal under study is cubic , then a cubic simulation box will do , otherwise the simulation box should be chosen such that it is as ` spherical ' as possible , yet commensurate with the unit cell of the crystal under study . note",
    "that this constraint implies that , if a given substance has several crystal polymorphs of lower than cubic symmetry , then different box shapes will be needed to simulate these phases .",
    "moreover , for low symmetry crystals , the shape of the crystal unit cell will , in general , depend on temperature and pressure .",
    "hence , simulations of different thermodynamic state points will require simulation boxes with different shapes .",
    "if the shape of the simulation box is incompatible with the crystal symmetry , the crystal will be strained .",
    "this is easy to verify by computing the stress tensor of the system : if the average stress is not isotropic ( hydrostatic ) , the shape of the simulation box causes a deformation of the crystal . as a consequence",
    ", elastic free energy will be stored in the crystal and it will be less stable than in its undeformed state . not surprisingly , such a deformation will affect the location of phase coexistence curves . the effect of the shape of the simulation box on the crystal under study is not simply a finite size effect : even a macroscopic crystals can be deformed .",
    "however , for a large enough system , it is always possible to choose the number of crystal unit cells in the @xmath44 and @xmath45 directions such that the resulting crystal is almost commensurate with the simulation box .",
    "the remaining difference is a finite size effect .",
    "however , if we have been less careful and have prepared a deformed crystal , then it will stay deformed , if not forever , then at least much longer than the time that we can study in a simulation .      in practice ,",
    "the shape of the simulation box is not chosen by trial and error until the crystal is stress free ( or , more precisely , has an isotropic stress ) . in the early 80 s , parrinello and",
    "rahman  @xcite developed a constant - stress molecular dynamics scheme that treated the parameters characterising the box shape as dynamical variables .",
    "in a simulation , the box shape fluctuates and the average box shape is the one compatible with the imposed stress . if the imposed stress is isotropic , then the parrinello - rahman technique yields the box shape compatible with an undeformed crystal . shortly after its introduction",
    ", the parrinello - rahman technique was extended to monte carlo simulations by najafabadi and yip  @xcite .",
    "more recently , the method of najafabadi and yip was used by filion and coworkers  @xcite to predict the crystal structure of novel materials . in this method ,",
    "small systems are used such that appreciable fluctuations in the shape of the simulation box are possible : this allows one to explore a wide range of possible structures .",
    "potentially , the fluctuations in the shape of the simulation box can become a problem : if the box becomes very anisometric , the nearest - neighbour distance in some directions becomes very small and serious finite size effects are observed .",
    "this problem is always present if fluctuating box shapes are used to simulated liquids ( but , usually , there is no need to use fluctuating box shapes in that case ) . in the case of crystals ,",
    "the problems are most pronounced for small systems . in that case",
    ", the fluctuations of the box shape may have to be constrained . to allow for larger changes in the shape of the crystal unit cell , the system should be mapped onto a new simulation box , once the original box becomes too deformed .",
    "this remapping does not affect the atomic configuration of the system .",
    "liquid crystals are phases with symmetry properties intermediate between those of an isotropic liquid and of a fully ordered , three - dimensional crystal",
    ". the simplest liquid crystal , the so - called _ nematic _ phase , has no long - range translational order , but the molecules are on average aligned along a fixed direction , called the nematic _ director_. like isotropic liquids , nematic phases are compatible with any shape of the simulation box . however , for more highly ordered liquid - crystalline phases , the box shape should be chosen carefully . to give a simple example : the smectic - a phases is similar to the nematic phase in that all molecules are , on average aligned along a director but , unlike the nematic phase , the density of the nematic phase along the director is periodic . in the simplest case one can view the smectic - a phase as a stack of liquid - like molecular layers . clearly , in a simulation",
    ", the boundary conditions should be such that an integral number of layers fits in the simulation box .",
    "this constrains the system size in one direction ( viz . along the director ) , but not along the other two directions .",
    "again , simulations with a flexible box shape can be used to let the system relax to its equilibrium layer spacing . however , as the smectic phase is liquid like in the transverse direction , one should make sure that the box shape in those directions is fixed .",
    "there is a practical reason for using slightly more complex boundary conditions for smectic - a phases : the average areal density in all smectic - a layers is the same , but the number of molecules per layer will fluctuate .",
    "this is a real effect .",
    "however , the time it takes a molecule to diffuse ( ` permeate ' ) from one smectic layer to the next tends to be very long ( it involves crossing a free - energy barrier ) . hence ,",
    "unless special precautions are taken , the distribution of molecules over the various smectic layers will hardly vary over the course of a simulation and hence , the system does not adequately sample the configuration space . this problem can be solved by using so - called ` helical ' boundary conditions .",
    "suppose that we have a smectic phase in a rectangular prismatic simulation box .",
    "we assume that the smectic layers are perpendicular to the @xmath45 axis and have an equilibrium spacing @xmath46 . now consider the next periodic box in the @xmath47-direction .",
    "normally , this box is placed such that the point @xmath48 maps onto @xmath49 .",
    "if we use helical boundary conditions , the box at @xmath37 is shifted by @xmath46 along the @xmath45 direction : hence , @xmath48 maps onto @xmath50 ( see fig .  [",
    "fig : helical ] ) .",
    "the result is that all the smectic layers in the system are now connected laterally into a single layer .",
    "now , fluctuations in the number of particles per layer is easy because it does not require permeation .",
    "similar techniques can be used to allow faster equilibration of columns in the so - called _ columnar _ phase ( a phase that has crystalline order in two directions and liquid - like order in the third ) .",
    "i should point out that helical boundary conditions are not necessarily more ` realistic ' than normal periodic boundary conditions .",
    "in particular , the slow permeation of particles between layers is a real effect .",
    "the simulation of cholesteric liquid crystals poses a special problem .",
    "a cholesteric liquid crystal is similar to the nematic phase in that it has no long - ranged translational order .",
    "however , whereas the director if a nematic phase has a fixed orientation throughout the system , the director of a cholesteric phase varies periodically ( ` twists ' ) in one direction and is constant in any plane perpendicular to the twist direction . for instance , if we choose the twist direction to be parallel to the @xmath45-axis , then the @xmath45-dependence of the director would be of the form @xmath51 where @xmath52 denotes the cholesteric pitch .",
    "ideally , the periodic boundary conditions should be chosen such that the cholesteric pitch is not distorted . in practice , this is often not feasible because typical cholesteric pitches are very long compared to the molecular dimensions . for cholesteric phases of small molecules ( as opposed to colloids ) , pitches of hundreds of nanometers are common .",
    "simulations of systems with such dimensions would be very expensive .",
    "the problem can be alleviated a bit by using twisted periodic boundary conditions . in that case",
    "the system is not simply repeated periodically in the @xmath45-direction ( the pitch axis ) , but it is rotated by an amount that is compatible with the boundary conditions  @xcite . if the simulation box is a square prism , any rotation by a multiple of @xmath53 is allowed .",
    "the minimal twist corresponds to the case where the rotation is @xmath54 . if the simulation box is a hexagonal prism , rotations that are a multiple of @xmath55 ( corresponding to 1/6-th of a pitch )",
    "are allowed .",
    "smaller angles are not possible .    although @xmath56 , the box size needed to accommodate an undeformed cholesteric is usually still too large to be computationally feasible .",
    "hence , cholesterics are usually simulated in an over- or under - twisted geometry and the properties of the undistorted are deduced using thermodynamics .",
    "allen  @xcite has used such an approach to compute the twisting power of chiral additives in a nematic phase .    here",
    ", i outline how a simulation of over- and under - twisted cholesterics can be used to estimate the equilibrium pitch .",
    "to do so , we have to make use of the fact that , for small deformations , the free energy of a cholesteric phase depends quadratically on the degree of over(under)-twist  : @xmath57 where @xmath58 and @xmath59 is the value of @xmath60 for which the system is torque - free and @xmath61 is the volume of the system .",
    "the constant @xmath62 is the so - called ` twist elastic constant ' .",
    "the subscript @xmath63 is there for historical reasons ( in a nematic , two other types of director deformation are possible : ` splay ' and ` bend ' : the associated elastic constants are denoted by @xmath64 and @xmath65 respectively ) . in what follows",
    ", i drop the subscript of @xmath62 . in a periodic system with a box length @xmath39 in the @xmath45-direction , @xmath66 , where @xmath67 is the twist of the system over a distance @xmath39 . in practice",
    ", we will only consider @xmath68 or @xmath69 .",
    "then an infinitesimal change in the helmholtz free energy @xmath70 is given by @xmath71 where @xmath72 is the entropy of the system , @xmath73 the temperature , @xmath74 the pressure , @xmath75 the chemical potential ( per particle ) and @xmath30 the number of particles .",
    "in what follows , i fix @xmath30 and @xmath73 .",
    "it is useful to write @xmath76 as the sum of a volume change due to @xmath77 , a lateral expansion / compression of the system and @xmath78 , the volume change due to deformations in the @xmath45-direction .",
    "note that the total free energy change due to a change in @xmath39 is given by @xmath79dl_z\\;.\\ ] ] we can write this as @xmath80dv_\\parallel= -\\left[p + k(\\xi-\\xi_0)\\xi\\right]dv_\\parallel\\;.\\ ] ] a change in volume at constant pitch ( i.e. constant @xmath39 ) would yield @xmath81 the excess pressure for deformations along the @xmath45-axis is therefore @xmath82    by measuring @xmath83 we can determine @xmath59 .",
    "momentum conservation in classical mechanics follows if the lagrangian of the system is invariant under infinitesimal translations .",
    "this result carries over from a free system in the absence of external forces to a system with periodic boundary conditions . for a non - periodic system",
    ", momentum conservation implies that the centre of mass of the system moves at a constant velocity . in the presence of periodic boundary conditions ,",
    "this statement becomes ambiguous because one should specify how the position of the centre of mass is computed .",
    "clearly if we interpret the centre of mass of the system as the mass - weighted average position of the particles in the simulation box at the origin , then the center of mass motion is not at all conserved .",
    "every time the particle crosses the boundary of the simulation box  and is put back at the other side  the centre of mass undergoes a jump . however",
    ", if we consider the center of mass of the particles that were originally in the ` central ' simulation box , and do not put these particles back in that box when they move to another box , then the velocity of the center of mass of those particles is conserved .",
    "it should be stressed that the very concept of the ` boundary ' of the simulation box is confusing : for normal ( equilibrium ) simulations , we can draw the lattice of simulation boxes wherever we like , hence the boundaries between such boxes can be anywhere in the system . the ` boundary ' therefore has no physical meaning ( the situation is different in non - equilibrium simulations with so - called lees - edwards ` sliding ' boundary conditions ) .    unlike linear momentum ,",
    "angular momentum is not a conserved quantity in systems with periodic boundary conditions .",
    "the basic reason is that the lagrangian is not invariant under infinitesimal rotations .",
    "this invariance ( for spatially isotropic systems ) is at the origin of angular momentum conservation . in periodic systems ,",
    "angular momentum is simply not uniquely defined . to see this ,",
    "consider a system consisting of two particles zero net linear momentum . in a free system",
    ", the angular momentum of this system is uniquely defined as it does not depend on the origin from which we measure the angular momentum .",
    "however , it is easy to see that in a periodic system the apparent angular momentum will be different if we choose the origin of our coordinate system between the two particles in the same simulation box , or between a particle in one simulation box and the periodic image of the other particle . considering only particles in the same simulation box will not help because then the angular momentum will change discontinuously whenever we move a particle that has crossed a boundary back into the original simulation box .",
    "there is another , more subtle , effect of periodic boundary conditions that is not always properly realised .",
    "it has to do with the calculation of fourier transform of spatial correlation function . as an example ( and an important one at that ) , i consider the computation of the structure factor @xmath3 . for simplicity",
    ", i will consider an atomic fluid .",
    "@xmath3 is related to the mean square value of @xmath84 , the fourier component of the number density at wave vector @xmath85 : @xmath86 where @xmath87 note that the structure factor is , by construction , non - negative . in liquid state theory , we often use the fact that the structure factor of a fluid is related to the radial distribution function @xmath2 though @xmath88\\ ; .\\ ] ] in the thermodynamic limit , the volume of the system tends to infinity and the integral does not depend on the size of the integration volume .",
    "however , in a small , periodic system it does .",
    "more importantly , in an isotropic fluid , the radial distribution function is isotropic and we can write @xmath89\\ ; .\\ ] ] for a finite , periodic system , one might be tempted to replace the upper limit of this integration by half the box diameter . however ,",
    "this is very dangerous because the function thus computed is no longer equivalent to the expression in eq .",
    "( [ eq : rhoq2 ] ) .",
    "in particular , the apparent @xmath3 is not guaranteed to be non - negative , even if one only considered those values of @xmath85 that are compatible with the periodic boundary conditions .",
    "one solution to this problem is to extrapolate @xmath2 to larger distances , using a plausible approximation .",
    "however , in general , it is safest to stick with eq .",
    "( [ eq : rhoq2 ] ) , even though it is computationally more demanding .",
    "computer simulations provide a powerful tool to locate first - order phase transitions . however , it is important to account properly for finite size effects .",
    "the safest ( although not necessarily simplest ) way to locate first order phase transitions is to compute the free energy of the relevant phases in the vicinity of the coexistence curve . for a given temperature , this involves computing the free energy of both phases at one ( or a few ) state points and then computing the pressure of the system in the vicinity of these points . in this way",
    ", one can evaluate the free - energy as a function of volume .",
    "coexistence is then determined using a double tangent construction .",
    "the advantage of this procedure is that finite - size effects are relatively small as the two phases are simulated under conditions where no interfaces are present .",
    "however , the approach is rather different from the one followed in experiment where one typically looks for the point where the two phases are in direct contact .",
    "if the interface between the two phases does not move , we have reached coexistence .",
    "there are several reasons why , in simulations , this approach requires great care .",
    "first of all , the creation of a two - phase system involves creating a slab of phase i in contact with a slab of phase ii ( the slabs are obviously periodically repeated ) .",
    "the free energy of such a system is equal to the free energy of the coexisting bulk phases plus the total surface free energy .",
    "a ( potential ) problem is that , if the slabs are not thick enough ( how thick depends on the range of the intermolecular potential and on the range of density correlations ) , the total surface free energy is not equal to that of two surfaces at infinite separation . a second problem",
    ", that is more relevant for monte carlo than for molecular dynamics simulations is that two - phase systems equilibrate slowly .",
    "in particular , coexistence between two phases requires that the pressures are equal . in molecular dynamics simulations ,",
    "the rate of pressure equilibration is determined by the speed of sound  typically such equilibration is rapid .",
    "in contrast , in monte carlo simulations , pressure equilibrates through diffusion , and this is slower .",
    "most likely , our first guess for the coexistence pressure at a given temperature will not be correct and we will see the phase boundary moving",
    ". then we have to adjust the pressure .",
    "however , it is very important that we do not impose an isotropic pressure on the system .",
    "rather , we should vary the volume of the system by changing the box - length in the direction perpendicular to the interface .",
    "the reason is that , in the transverse direction , the surface tension of the two interfaces contributes to the apparent pressure .",
    "hence if the ` longitudinal ' pressure ( i.e. the one acting on a plane parallel to the interfaces ) is denoted by @xmath90 , then the apparent pressure in the perpendicular direction is @xmath91 in other words : the transverse pressure contains a contribution due to the laplace pressure of the interfaces .",
    "the coexistence pressure is @xmath90 , not @xmath92 .    in the above example",
    ", we have considered the case of a liquid - liquid interface where the laplace correction is determined by the surface tension @xmath93 . however , when one of the coexisting phases is a crystalline solid the problems are more severe because the pressure inside a solid need not be isotropic . in that case , the procedure becomes more complicated .",
    "first , one must determine the compressibility of the crystal or , more generally , the relation between the lattice constant of the bulk crystal and the applied isotropic pressure .",
    "then the lateral dimensions of the crystalline slab are chosen such that it is commensurate with a crystal with the correct lattice constant for the applied longitudinal pressure . if the initial guess for the coexistence pressure was incorrect one should change the applied longitudinal pressure  but also the lateral dimensions of the simulation box , such that the crystal again has the correct lattice constant corresponding to the applied pressure .",
    "the rescaling of the lateral dimension of the simulation box should also be performed if we do not fix the longitudinal pressure but @xmath94 . in that case",
    "we do not know a priori what the coexistence pressure will be , but we still must rescale the transverse dimensions of the simulation box to make sure that the stress in the bulk of the crystal is isotropic .    finally , there is a general point that , for a small system , the free energy cost to create two interfaces is not negligible compared to the bulk free energy . for sufficiently narrow slabs the result may be that the system will form a strained homogeneous phase instead of two coexisting phases separated by interfaces",
    ".    in general , simulations that study phase equilibria by preparing two phases separated by interfaces will use biasing techniques to facilitate the formation of a two - phase system . for examples ,",
    "see refs .",
    "@xcite .",
    "( [ eq : deltapgamma ] ) illustrates the surface tension of a liquid - liquid interface can create a difference between the longitudinal and transverse components of the pressure that can be measured in a simulation . in principle , eq .",
    "( [ eq : deltapgamma ] ) can be used to determine the surface tension @xmath93 . however , eq .",
    "( [ eq : deltapgamma ] ) is only valid for the interface between two disordered phases ( e.g. liquid - liquid or liquid - vapour ) .",
    "if one of the phases involved is a crystal , the situation becomes more complicated .",
    "in particular , the laplace pressure is not determined by the surface tension ( which , for a solid - liquid interface is called the ` surface free - energy density ' ) , but by the surface stress . to see why this is so , consider the expression of the surface free energy of an interface with area @xmath95 : @xmath96 the surface stress @xmath97 is the derivative of the surface free energy with respect to surface area : @xmath98 for a liquid - liquid interface , @xmath93 does not depend on the surface area @xmath95 , as the structure of the surface remains the same when the surface is stretched . hence , in that case @xmath99 .",
    "however , for a solid , the structure of the surface is changed when the surface is stretched and hence @xmath93 changes . in that case ,",
    "@xmath100 . as a consequence",
    "it is much more difficult to determine @xmath93 for a solid - liquid interface than for a liquid - liquid interface .",
    "in fact , whereas for a liquid - liquid interface @xmath93 can be obtained from eq .",
    "( [ eq : deltapgamma ] ) , the determination of @xmath93 for a solid - liquid interface requires a free - energy calculation that yields the reversible work needed to create an interface between two coexisting phases .",
    "an example of such a calculation can be found in ref .",
    "@xcite .",
    "classical mechanics and classical statistical mechanics are at the basis of a large fraction of all molecular dynamics and monte carlo simulations .",
    "this simple observation leads to a trivial conclusion : the results of purely classical simulations can _ never _ depend on the value of planck constant and , indeed , the expressions that are used to compute the internal energy , pressure , heat capacity or , for that matter , the viscosity of a system are functions of the classical coordinates and momenta only .",
    "however , there seems to be an exception : the chemical potential , @xmath75 . when we perform a grand - canonical simulation , we fix @xmath75 , @xmath61 and @xmath73 and compute ( for instance ) the average density @xmath101 of the system .",
    "@xmath101 , @xmath61 and @xmath73 do not depend on @xmath102 , but @xmath75 does . to be more precise , we can always write @xmath75 as : @xmath103 where @xmath104 is a purely classical quantity that depends on the interactions between molecules . however , @xmath105 depends on planck constant .",
    "for instance , for an atomic system , @xmath106 where @xmath107 is the thermal de broglie wavelength : @xmath108 for a molecular system , the expression for @xmath105 is of a similar form : @xmath109 where @xmath110 is the part of the molecular partition function associated with the vibrations and rotations ( and , possibly , electronic excitations ) of an isolated molecule .",
    "@xmath110 is a function of @xmath73  but its value depends on @xmath102 .",
    "it would then seem that the results of classical simulations can depend on @xmath102 .",
    "in fact , they do not .",
    "first of all , if we consider a system at constant temperature , the factors involving @xmath102 just add a constant to @xmath75 .",
    "hence , the value of @xmath102 will not affect the location of any phase transitions : at the transition , the chemical potentials in both phases must be equal , and this equality is maintained if all chemical potentials are shifted by a constant amount .",
    "one might object that the density of a system itself depends on @xmath75 and therefore on @xmath102 .",
    "this is true , but in reality it is not a physical dependence : a shift the absolute value of the chemical potential is not an observable property .",
    "one should recall that the chemical potential describes the state of a system in contact with an infinite particle reservoir at a given temperature and density . in experiments ,",
    "such a reservoir can be approximated by a large system , but in simulations it is most convenient to view this reservoir as consisting of the same atoms or molecules , but with all inter - molecular interaction switched off .    to see this , consider two systems at temperature @xmath73 : a system with @xmath30 particles in volume @xmath61 and a reservoir with @xmath111 particles in volume @xmath112 .",
    "we assume that @xmath113 .",
    "the density in the reservoir @xmath114 .",
    "the reservoir and the system can exchange particles .",
    "we now assume that the particle in the reservoir do not interact . to be more precise : we assume that all _ inter_-molecular interaction have been switched off in the reservoir , but all _ intra_-molecular interactions are still present .",
    "this ideal gas is our reference system .",
    "it is straightforward to write down the expression for the partition function of the reservoir for a given number of particles ( say @xmath111 ) : @xmath115 the total partition function ( system plus reservoir ) is : @xmath116 note that all terms in the sum have the same number of factors @xmath117 and @xmath110 .",
    "i take these out and define @xmath118 through @xmath119 note that @xmath118 does not depend on @xmath102 .",
    "now , the probability to find @xmath30 particles in the system is : @xmath120 dividing numerator and denominator by @xmath121 , and using the fact that for @xmath113 , @xmath122 , we can write @xmath123 note that in this expression , the number of particles in the system is controlled by @xmath124 , the number density in the reservoir . @xmath102 has disappeared , as it should .",
    "the concept of a reservoir that contains an ideal gas of molecules that have normal intra - molecular interactions is extremely useful in practice , in particular for flexible molecules . in a grand canonical simulation , we prepare thermally equilibrated conformations of the molecules that we wish to insert . we can then attempt to insert one of these particles into the system that already contains @xmath30 particles .",
    "the probability of insertion is determined by : @xmath125 where @xmath126 measures the interaction of the added particle with the @xmath30 particles already present , but _ not _ the intramolecular interactions of the added particle . note ( again ) that the crucial control parameter is @xmath124 , the hypothetical but purely classical density in the ideal reservoir .",
    "occasionally , the role of planck constant can be a bit more subtle .",
    "we have assumed that the quantised intramolecular motions of the particles do not depend on the inter - molecular interactions . at high densities ,",
    "this approximation may break down .",
    "usually , this means that the distinction between inter and intra - molecular degrees of freedom becomes meaningless .",
    "however , if we insist on keeping the distinction , then we must account for the shift of intra - molecular energy levels due to inter - molecular interactions . in that case ,",
    "@xmath102 necessarily enters into the description .      of course , the examples above are but a small subset of the many subtleties that one may run into when performing a simulation .",
    "my reason for discussing this particular set is that 1 ) they are important and 2 ) they illustrate that one should never use a simulation programme as a ` black box ' .",
    "in the previous section , i discussed aspects of simulations that are more tricky than they might at first seem to be . in the present section ,",
    "i list a few examples of simulations techniques that can not be used because they are intrinsically flawed .      in a monte carlo simulation",
    ", we compute thermal averages of the type @xmath127 in this expression , @xmath95 stands for any ` mechanical ' property of the system ( e.g. the potential energy or the virial ) .",
    "what we can not compute in this way are ` thermal ' properties , such as the free energy of the entropy .",
    "let us take the free energy as an example .",
    "the relation between the helmholtz free energy @xmath70 and the partition function @xmath128 of the system is @xmath129 in what follows , i will focus on the configurational part of the partition function @xmath130 , as the remaining contributions to @xmath128 can usually be computed analytically .",
    "@xmath131 clearly , the integral on the righthand side is not a ratio of two integrals , as in eqn .",
    "[ eq : aav ] .",
    "however , we can write @xmath132 we can rewrite this as @xmath133 and hence it would seem that we _ can _ express the partition function in terms of s thermal average that can be samples . however , the method will not work ( except for an ideal gas , or for similarly trivial systems ) .",
    "the reason is that the most important contributions are those for which @xmath134 is very large , whilst the boltzmann weight ( @xmath135 ) is very small - these parts of configuration space will therefore never be sampled . for systems with hard - core interactions ,",
    "the situation is even more extreme : an important contribution to the average comes for parts of configuration space where @xmath136 and @xmath137 . in other words , there is no free lunch : @xmath130 ( and therefore @xmath70 ) can not be determined by normal monte carlo sampling .",
    "that is why dedicated simulation techniques are needed to compute free energies .",
    "the widom ` particle - insertion ' method is used extensively to compute ( excess ) chemical potentials of the components of a moderately dense fluid .",
    "below i briefly show the derivation of widom s expression . however , an almost identical derivation leads to an expression that relates the chemical potential to the boltzmann factor associated with particle removal . that expression is useless and , in the limit of hard - core interactions , even wrong .",
    "consider the definition of the chemical potential @xmath138 of a species @xmath139 . from thermodynamics",
    "we know that @xmath75 can be defined as : @xmath140 where @xmath70 is the helmholtz free energy of a system of @xmath30 particles in a volume @xmath61 , at temperature @xmath73 . for convenience ,",
    "i focus on a one - component system .",
    "if we express the helmholtz free energy of an @xmath30-particle system in terms of the partition function @xmath141 , then it is obvious that for sufficiently large @xmath30 the chemical potential is given by : @xmath142 .",
    "for instance , for an ideal gas of atoms , @xmath143\\;.\\ ] ] the excess chemical potential of a system is defined as @xmath144}{v\\int d{\\bf r}^{n}\\exp\\left[-\\beta u({\\bf r}^n)\\right]}\\right\\}\\;.\\end{aligned}\\ ] ] we now separate the potential energy of the @xmath145-particle system into the potential energy function of the @xmath30-particle system , @xmath146 , and the interaction energy of the @xmath145-th particle with the rest : @xmath147 . using this separation , we can write @xmath148 as :    @xmath149\\exp\\left[-\\beta\\delta u_{n , n+1}\\right]}{v\\int d{\\bf r}^{n}\\exp\\left[-\\beta u({\\bf r}^n)\\right]}\\right\\ } \\nonumber\\\\ & = & -k_bt\\ln\\left\\{\\frac{\\int d{\\bf r}_{n+1}\\left\\langle\\exp(-\\beta\\delta u_{n , n+1})\\right\\rangle_n}{v}\\right\\}\\;,\\end{aligned}\\ ] ]    where @xmath150 denotes canonical ensemble averaging over the configuration space of the @xmath30-particle system . in other words ,",
    "the excess chemical potential is related to the average of @xmath151 over all possible positions of particle @xmath152 . in a translationally invariant system , such as a liquid",
    ", this average does not depend on the position of the addition particle , and we can simply write @xmath153 the widom method to determine the excess chemical potential is often called the  particle - insertion method \" because it relates the excess chemical potential to the average of the boltzmann factor @xmath154 , associated with the random insertion of an additional particle in a system where @xmath30 particles are already present .    to arrive at the ( incorrect ) ` particle - removal ' expression we simply write @xmath155}{\\int d{\\bf r}^{n+1}\\exp\\left[-\\beta u({\\bf r}^n+1)\\right]}\\right\\}\\;.\\end{aligned}\\ ] ] following the same steps as above ,",
    "we then find : @xmath156 if the potential energy of the system is bounded from above ( and , of course , from below ) then this expression is not wrong , but simply rather inefficient .",
    "the reason why it is inefficient is the same as in the case of sampling partition functions : the most important contribution come from regions of configuration space that are rarely sampled .",
    "if the potential energy function is not bounded from above ( as is the case for hard - core interaction ) , eq .",
    "( [ eqn : widomremoval ] ) simply yields the wrong answer . having said that , particle - insertion and particle - removal can be fruitfully combined in the so - called ` overlapping - distribution ' method  @xcite .",
    "but even the particle insertion method may occasionally yield nonsensical results .",
    "this happens when applying the method to a system at high densities . as an example , let us consider a crystalline material . during a simulation of a perfect crystal containing @xmath30 particles",
    ", we can carry out random particle insertions and we can compute the average boltzmann factor associated with such insertions . the method appears to work , in the sense that it gives an answer .",
    "however , that answer is _ not _ the excess chemical potential of atoms in a crystal lattice .",
    "rather , it is the excess chemical potential of _ interstitial _ particles .",
    "the reason why the method does not yield the expected answer is that in a real crystal , there are always some vacancies .",
    "the vacancy concentration is low ( ranging from around 1:10@xmath157 at melting , to vanishingly values at low temperatures ) . yet , for particle insertion , these vacancies are absolutely crucial : the contribution to the average of @xmath158 of a single insertion in a vacancy far outweighs all the contributions due to insertion in interstitial positions . using a combination of particle insertion and particle removal",
    "@xcite we can obtain information about the equilibrium concentration of vacancies and interstitials .",
    "because there are so few vacancies , a naive grand - canonical simulation of crystal will be inefficient . as the vacancy concentration is low very large systems",
    "are needed to create enough vacancies where particles can be added to the system . of course",
    ", one can perform biased grand - canonical simulations to alleviate this problem , but i am unaware of any attempts to do so  .    because the concentration of vacancies is so low in most ( but not all  @xcite ) crystals ,",
    "one subtlety is often overlooked .",
    "the point is that , because of the presence of vacancies , the number of particles is not the same as the number of lattice sites ( i assume , for simplicity , a one - component bravais lattice ) .",
    "the free energy of the system is then a function of the number of particles _ and _ the number of lattice sites .",
    "we can then write the variation of the free energy at constant temperature as @xmath159 where @xmath160 denotes the number of lattice sites and @xmath161 the corresponding ` chemical potential ' .",
    "i use quotation marks here because @xmath161 is not a true chemical potential : in equilibrium , the number of lattice sites is such that the free energy is a minimum and hence @xmath161 must be zero . however , in a simulation where we constrain @xmath30 and @xmath160 to be the same , @xmath161 is definitely not zero and incorrect predictions of the phase diagram result if this is not taken into account .",
    "there are only few examples where the analysis of the chemical potential associated with lattice sites has been taken into account correctly  @xcite .",
    "i end this paper with a very brief summary some ` urban legends ' in the simulation field .",
    "i should apologise to the reader that what i express are my personal views  not everybody will agree .      in the beginning of this paper",
    "i pointed out that in a number of specific cases the computational gains made by novel algorithms far outweigh the increase in computing power expressed by moore s law .",
    "however , the number of such algorithms is very small .",
    "this is certainly true if we avoid double counting : successful algorithms tend to be re - invented all the time ( with minor modifications ) and then presented by the unsuspecting authors as new ( for example , simpson s rule has recently been reinvented in a paper that has attracted over 150 citations  @xcite ) .",
    "although i have no accurate statistics , it seems a reasonable to assume that the number of new algorithms that is produced every year keeps on growing .",
    "unfortunately , these ` new ' algorithms are often not compared at all with existing methods , or the comparison is performed such that the odds are stacked very much in favour of the new method .",
    "emphatically , i am not arguing against new algorithms ",
    "quite the opposite is true and , in fact , over the past few decades we have seen absolutely amazing novel techniques being introduced in the area of computer simulation .",
    "i am only warning against the ` not invented here ' syndrome .    [",
    "[ molecular - dynamics - simulations - predict - the - time - evolution - of - a - many - body - system ] ] molecular dynamics simulations predict the time evolution of a many - body system ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~    this view is more common outside the field than inside .",
    "however , the outside community is much larger than the tribe of simulators .",
    "the reason why molecular dynamics does not predict the time evolution of a many - body system is that the dynamics of virtually all relevant many - body systems is chaotic .",
    "this means that a tiny error of the phase - space trajectory of the system will grow exponentially in time , such that in a very short time the numerical trajectory will bear no resemblance to the ` true ' trajectory with the same initial conditions . using more accurate algorithms",
    "can postpone this so - called lyapunov instability .",
    "however , doubling the accuracy of the simulation simply shifts the onset by a time @xmath4 .",
    "doubling it again , will gain you another time interval @xmath4 .",
    "the point is that the computational effort required to suppress the lyapunov instability below a certain preset level scales exponentially with simulation time : in practice , no simulation worthy of the name is short enough to avoid the lyapunov instability .",
    "it would seem that this is a serious problem : if molecular dynamics does not predict the time evolution of the system , then what is the use of the method ?    the reason why molecular dynamics simulations are still widely used is that ( most likely ) the trajectories that are generated in a simulation ` post - dict ' rather than ` pre - dict ' a possible real trajectory of the system .",
    "in particular , it can be shown that the widely used verlet algorithm generates trajectories that are a solution to the discretised lagrangian equations of motion .",
    "this means that the algorithm generates a trajectory that starts at the same point as a real trajectory , ends at the same point as that trajectory and takes the same time to move from the starting point to the end point . what molecular dynamics generates is a good approximation to a _",
    "possible _ trajectory , not to the trajectory with the same initial conditions .",
    "the distinction between the two types of trajectories is illustrated in fig .",
    "[ fig : lyapunov ] .",
    "typically , the time between the beginning and end points of a trajectory is much longer than the time it takes for the lyapunov instability to appear .",
    "therefore , the trajectory that we generate need not be close to any real trajectory .",
    "however , if we consider the limit where the time - step goes to zero , then the discretised lagrangian approaches the full lagrangian and the discretised path ( presumably ) approaches the real path .",
    "i should stress that this result holds for the verlet algorithm and , presumably , for a number of verlet - style algorithms .",
    "however , it is not obvious ( to me ) that the molecular dynamics trajectories generated in an event - driven algorithm with hard collisions are necessarily close to a real trajectory for long times . if we can believe molecular dynamics simulations ( and i believe that we can in a ` statistical ' sense ) then there are several excellent reasons to use the technique .",
    "the first is , obviously , that molecular dynamics probes the dynamics of the system under study and can therefore be used to compute transport coefficients , something that a monte carlo simulation can not do .",
    "another practical reason for using molecular dynamics is that it can be ( and , more importantly , has been ) parallellized efficiently .",
    "hence , for large systems , molecular dynamics is almost always the method of choice .",
    "this rule - of - thumb is old and nowhere properly justified .",
    "there are many examples where it appears that the optimal acceptance of monte carlo moves should be substantially lower ( certainly for hard core systems ) .",
    "also , in the mathematical literature  @xcite it is argued ( but in a different context ) that the optimal acceptance of metropolis - style monte carlo moves is probably closer to 25 % ( 23.4 % has been shown to be optimal for a specific  but not a statistical mechanical  example ) .",
    "a very simple example can be used to illustrate this point .",
    "consider a hard particle in an ideal gas .",
    "the number density of the ideal gas is denoted by @xmath101 .",
    "if we move the hard particle over a distance @xmath162 , it sweeps out a volume proportional to @xmath162 .",
    "to make life easy , i will consider a one - dimensional example . in that case",
    "the volume swept out by the hard particle is equal to @xmath162 ( i will assume that the particle itself is much larger than @xmath162 ) .",
    "the probability that a monte carlo move over a distance @xmath162 will be accepted is given by the probability that there will be no ideal gas particles in the volume swept out by the particle : @xmath163 if the trial displacement is @xmath162 , then the average _ accepted _ displacement is @xmath164\\times 0 $ ] and the corresponding mean - squared displacement is @xmath165 of course , this system is trivial because we know that if we sample all possible configurations , the large particle will be distributed uniformly in the volume occupied by the ideal gas . again , in this case , it is plausible that the most efficient monte carlo algorithm is simply the one that makes the large particle ` diffuse ' most rapidly through configuration space .",
    "now consider that we generate trial moves such that @xmath162 is uniformly distributed between @xmath166 and @xmath167 , where @xmath168 denotes the magnitude of the maximum displacement .",
    "the diffusion of the large particle will be fastest for that value of @xmath168 that yields the largest mean - squared displacement .",
    "we can compute this mean - squared displacement analytically : @xmath169}{(\\rho\\delta_m)^3}\\ ; .\\ ] ] as can be seen in fig .",
    "[ fig : acceptance ] , the maximum value of @xmath170 corresponds to an average acceptance @xmath171/(\\rho\\delta_m)$ ] that is around 28 % ( i.e. considerably less than 50% ) .",
    "does it matter ?",
    "probably not very much : the very fact that there is an ` optimal ' acceptance ratio means that the efficiency is fairy flat near this optimum .",
    "still , 25 % is rather different form 50 % .",
    "when in doubt , check it out .",
    "this is a point that i already mentioned above but i repeat it here : in normal ( equilibrium ) monte carlo or molecular dynamics simulations , the origin of the periodic box can be chosen wherever we like and we can remap the periodic boxes at any time during our simulation .",
    "hence , the ` boundary ' of the periodic box is not a physical divide .",
    "again , as said before , this situation changes for some non - equilibrium situations , e.g. those that use lees - edwards sliding boundary conditions  @xcite .",
    "there is another situation where the boundary of the simulation box has ( a bit ) more meaning , namely in the simulation of ionic systems . due to the long - range nature of the coulomb forces ,",
    "the properties of the system depend on the boundary conditions at infinity .",
    "this is not very mysterious : if we have a flat capacitor with a homogeneous polarised medium between the plates , then the system experiences a depolarisation field , no matter how far away the plates are .",
    "however , if the capacitor is short - circuited , there is no depolarisation field .",
    "something similar happens in a simulation of a system of charged particles : we have to specify the boundary conditions ( or , more precisely , the dielectric permittivity ) at infinity . if we choose a finite dielectric constant at the boundaries ( ` finite ' in this context means : anything except infinite )",
    "then the internal energy of the system that we simulate has a polarisation contribution that depends quadratically on the dipole moment of the simulation box .",
    "if we study a dipolar fluid , than the dipole moment of the simulation box does not depend on our choice of the origin of the box .",
    "however , if we study a fluid of charged particles , then the choice of the boundaries does matter .",
    "again , it is nothing mysterious : some crystal faces of ionic crystals are charged ( even though the crystal is globally neutral ) .",
    "the depolarisation field in this crystal will depend on where we choose the boundary ( at a positively or at a negatively charged layer ) , no matter how large the crystal .",
    "if the potential energy @xmath172 of a system is known as a function of the particles coordinates @xmath173 , then it is meaningful to speak about _ the _ energy ` landscape ' of the system : the potential energy of an @xmath30 particle system in @xmath46 dimensions will have minima , saddle points and maxima in the @xmath174 dimensional space spanned by the cartesian coordinates of the particles .",
    "in contrast , it is not meaningful to speak of _ the _ free energy landscape : there are many . in general ,",
    "free energies appear when we wish to describe the state of the system by a smaller number of coordinates than @xmath174 .",
    "of course , using a smaller number of coordinates to characterise the system will result in a loss of information .",
    "its advantage is that it may yield more physical insight  in particular if we use physically meaningful observables as our coordinates .",
    "examples are : the total dipole moment of a system , the number of particles in a crystalline cluster or the radius of gyration of a polymer .",
    "typically , we would like to know the probability to find the system within a certain range of these new variables .",
    "this probability ( density ) is related to the original boltzmann distribution . in what follows",
    ", i will consider the case of a single coordinate @xmath128 ( often referred to as the ` order parameter ' ) .",
    "the generalisation to a set of different @xmath128 s is straightforward .",
    "note that @xmath128 may be a complicated , and often non - linear function of the original particle coordinates @xmath173 .",
    "the probability to find the system in a state between @xmath128 and @xmath175 is @xmath176 , where @xmath177 is given by @xmath178 } { z } \\;,\\ ] ] where @xmath130 , the configurational part of the partition function , is given by @xmath179 we now _ define _ the free energy ` landscape ' @xmath180 as @xmath181 which implies that @xmath182 hence , the @xmath180 plays the same role in the new coordinate system as @xmath146 in the original @xmath174 dimensional system . the free energy @xmath180 may exhibit maxima and minima and , in the case of higher dimensional free - energy landscapes , free - energy minima are separated by saddle points .",
    "these minima and saddle points play an important role when we are interested in processes that change the value of @xmath128 , e.g. a phase transition , or the collapse of a polymer .",
    "the natural assumption is that the rate of such a process will be proportional to the value of @xmath183 at the top of the free - energy barrier separating initial and final states .",
    "however , whilst , for reasonable choose of @xmath128 , this statement is often approximately correct , it is misleading because the height of the free energy barrier depends on the choice of the coordinates . to see this ,",
    "consider another coordinate @xmath184 that measures the progress of the same transformation from initial to final state . for simplicity ,",
    "i assume that i have a one - dimensional free - energy landscape and that @xmath184 is a function of @xmath128 only : @xmath185 .",
    "then it is easy to show that @xmath186 the derivative on the right - hand side is the jacobian associated with the coordinate transformation from @xmath128 to @xmath184 . if @xmath184 is a linear function of @xmath128 , then the jacobian is harmless : it simply adds a constant to the free energy and hence does not affect barrier heights .",
    "however , in the more general case where @xmath184 is a non - linear function of @xmath128 , the choice of the functional form affects the magnitude of the barrier height .",
    "let us consider an extreme ( and unphysical ) examples to illustrate this .",
    "we choose : @xmath187 then @xmath188 in other words : with this choice of coordinates , the barrier has disappeared altogether . in general , the choice of different order parameters will not affect the free energy barrier as drastically as this , but the fact remains : the height of the free energy barrier depends on the choice of the order parameter(s ) @xmath128 .    of course , this dependence of the free - energy barrier on the choice of the order parameter is only an artefact of our description .",
    "it can not have physically observable consequences . and ,",
    "indeed , it does not .",
    "the observable quantity is the rate at which the initial state transforms into the final state ( folding rate , nucleation rate etc . ) and that rate is independent of the choice of @xmath128 .",
    "it is instructive to consider a simple example : the diffusive crossing of a one - dimensional barrier of height @xmath189 and with a flat top of width @xmath190 @xmath191\\ ; , \\ ] ] where @xmath192 is the heaviside step function .",
    "we assume that the diffusion constant at the top of the barrier has a constant value @xmath193 .",
    "moreover , we assume that , initially , the density is @xmath194 on the reactant side , and zero on the product side .",
    "then the initial , steady - state flux across the barrier is given by : @xmath195 now we apply our transformation eq .",
    "( [ eq : jacobiantransformation ] ) . in the region of the barrier",
    ", we then get : @xmath196 this transformation will completely eliminate the barrier .",
    "however , it should not have an effect to the reactive flux .",
    "indeed , it does not , as we can easily verify : the width of the barrier in the new coordinates is @xmath197 and the diffusion constant becomes @xmath198 combining all terms , we get : @xmath199 which is identical to the original flux , as it should be .",
    "there is another problem with free energy barriers : the fact that a coordinate @xmath128 joins two minima in a free energy landscape , does not necessarily imply that a physical path exists . again , we consider a simple example : a two dimensional system of a particle in a rectangular box .",
    "the box is cut obliquely by an infinitely thin , but infinitely high , energy barrier ( see fig .  [",
    "fig : nopath ] ) .",
    "we now choose the @xmath47 coordinate as our order parameter @xmath128 .",
    "the free energy is computed by integrating the boltzmann factor over @xmath201 at constant @xmath128 .",
    "the fact that the boltzmann factor vanishes on one point along a line of constant @xmath128 makes no difference to the integral .",
    "hence , @xmath180 is constant .",
    "the path between @xmath95 ( on the left ) and @xmath200 ( on the right ) appears barrier free . yet",
    ", clearly , there is no physical path from @xmath95 to @xmath200 .      1 .",
    "the construction of the coordinates @xmath128 is a matter of choice that should be guided by physical insight or intuition 2 .",
    "the height of free energy barriers depends on the choice of these coordinates 3 .",
    "the rate of ` barrier - crossing ' processes does _ not _ depend on the choice of the coordinates 4 .",
    "the fact that there is no free - energy barrier separating two states does not necessarily imply that there is an easy physical bath between these states .      as the field of numerical simulation expands ,",
    "new techniques are invented and old techniques are rediscovered .",
    "but not all that is new is true .",
    "there are several examples of methods that had been discredited in the past that have been given a new identity and thereby a new lease on life .",
    "usually , these methods disappear after some time , only to re - emerge again later .",
    "the fight against myths and misconceptions never ends ( including the fight against fallacies that i have unknowingly propagated in this paper ) .",
    "i am grateful to wilson poon for suggesting the topic of this paper .",
    "what i wrote is necessarily very incomplete , but i enjoyed writing it .",
    "i thank patrick varilly for a critical reading of this manuscript and for his many helpful suggestions .",
    "i should stress that all remaining errors and misconceptions are mine alone .",
    "this work was supported by the european research council ( erc ) advanced grant 227758 , the wolfson merit award 2007/r3 of the royal society of london and the engineering and physical sciences research council ( epsrc ) programme grant ep / i001352/1 .",
    "99 , _ j.  chem .",
    "_ , * 27 * ( 1957 ) 1208 . , _ j.  chem",
    "_ , * 27 * ( 1957 ) 1207 . ,",
    "_ a guide to monte carlo simulations in statistical physics _ ,",
    "second edition ( cambridge university press , cambridge ) 2005 . , _ j. stat .",
    "_ , * 15 * ( 1976 ) 299 .",
    ", _ j.  appl .",
    "_ , * 52 * ( 1981 ) 7182 . ,",
    "_ scripta metall .",
    "_ , * 17 * ( 1983 ) 1199 . , _ phys",
    "_ , * 103 * ( 2009 ) 188302 . ,",
    "_ , * 79 * ( 1993 ) 277 . , _ phys . rev .",
    "* 47 * ( 1993 ) 4611 .",
    "a _ , * 25 * ( 1982 ) 1699 .",
    "b _ * 81 * ( 2010 ) 125416 . ,",
    "_ , * 49 * ( 1983 ) 1121 . ,",
    "_ j. comp .",
    "_ , * 22 * ( 1976 ) 245 . ,",
    "_ j. chem .",
    "b _ , * 105 * ( 2001 ) 6722 . , _ a monte carlo method for chemical potential determination in single and multiple occupancy crystals _ , arxiv:1209.3228 ( 2012 ) . ,",
    "natl . acad .",
    "usa _ , * 109 * ( 2012 ) 17886 .",
    "* 109 * ( 2012 ) 17728 .",
    "_ , * 99 * ( 2007 ) 235702 . ,",
    "_ diabetes care _ , * 17 * ( 1994 ) 152 .",
    ", _ annals appl .",
    "_ , * 7 * ( 1997 ) 110 . ,",
    "_ j. phys .",
    "c _ , * 5 * ( 1972 ) 1921 ."
  ],
  "abstract_text": [
    "<S> this paper discusses the monte carlo and molecular dynamics methods . </S>",
    "<S> both methods are , in principle , simple . </S>",
    "<S> however , simple does not mean risk - free . </S>",
    "<S> in the literature , many of the pitfalls in the field are mentioned , but usually as a footnote  and these footnotes are scattered over many papers . </S>",
    "<S> the present paper focuses on the ` dark side ' of simulation : it is one big footnote . </S>",
    "<S> i should stress that ` dark ' , in this context , has no negative moral implication . </S>",
    "<S> it just means : under - exposed . </S>"
  ]
}