{
  "article_text": [
    "radiative energy exchange is critical in determining the structure of the upper convection zone . near the surface of the sun , the energy flow changes from almost exclusively convective below the surface to radiative above the surface .",
    "the interaction between convection and radiation near the surface determines what we observe , drives the convection , and generates the magnetic and non - magnetic activity which heats the chromosphere and corona .",
    "hence , the interaction between convection and radiation has significant impact on both the dynamics of convection and our diagnostics .",
    "escaping radiation cools the plasma that reaches the surface , which produces the low entropy plasma whose buoyancy work drives the convection . radiation transport determines ( with convection and waves ) the mean atmospheric structure .",
    "radiation provides the diagnostics that we use to determine the velocity , density , temperature and magnetic field on the sun .",
    "radiation transport modifies the observable p - mode temperature fluctuations so as to reverse the asymmetry of the intensity vs. velocity spectral peaks .    since the top of the convection zone occurs near the level where the continuum optical depth is one , neither the optically thin nor the diffusion approximations give reasonable results .",
    "we need to solve the 3d , lte , non - gray radiation transfer in our models ( nordlund 1982 ) .",
    "radiation enters the calculation through the radiative heating / cooling term in the energy equation , @xmath0 where the radiative heating / cooling is given by @xmath1 we calculate @xmath2 by a formal solution of the feautrier equations assuming lte so the source function is the planck function , @xmath3 where @xmath4 is the feautrier mean intensity @xmath5     \\ .\\ ] ]",
    "continuous opacity is calculated explicitly using the uppsala package ( gustafsson et al .",
    "1975 ) , for the entire temperature - density range in the simulation and stored in a table . to account for uv opacities not in the original package",
    ", the uv continuous opacity is enhanced below 500 nm by a function of @xmath6 , according to the prescription of magain ( 1983 ) .",
    "line opacities for the mean 1d atmosphere state are calculated using the uppsala odf tables ( gustafsson et al .",
    "1975 ) . for a grid of temperatures of the mean atmosphere state ,",
    "the rosseland mean with and without lines is calculated .",
    "the ratio of full to continuous rosseland opacities is then used to enhance the continuous rosseland opacity at each density in the table for the given temperature .",
    "in addition , for small optical depths , the continuum rosseland mean opacity is corrected by the ratio of the intensity weighted opacity for the 1d plane parallel average atmosphere to the continuum rosseland opacity .",
    "thus the opacity stored in the table is @xmath7 where the correction factor @xmath8 is @xmath9 the continuum rosseland opacity is @xmath10 where @xmath11 is the set of all those wavelengths belonging to the continuum .",
    "the intensity mean is @xmath12    to summarize : the opacity table is calculated from the rosseland mean opacity , based on the continuum opacity alone , @xmath13 .",
    "this is then corrected by the ratio @xmath14 ( eqn  [ kappaeff ] ) , to account for lines and the transition to optically thin radiation , but this ratio is evaluated only for the @xmath15/@xmath16-track of the mean stratification of the simulation ( not for the whole table ) .",
    "the correction factor , @xmath14 , is then regarded as a function of temperature alone and used to correct the continuum rosseland opacities for all densities in the table at each table temperature .",
    "the radiation calculation is greatly sped up by drastically reducing the number of wavelengths at which we solve the feautrier equations .",
    "we make the simplifying approximation of grouping the opacity at each wavelength into 4 bins according to its magnitude ( nordlund 1982 , skartlien 2000 ) .",
    "suppose the opacity is as shown in the toy example ( fig .",
    "[ opac ] ) .",
    "each wavelength is assigned a bin according to the magnitude of its opacity . in this toy example , those wavelengths with opacity between 2.0 and 2.5 are assigned to the first opacity bin with average opacity 2.3 and considered to represent the continuum ( fig  [ opac ] ) . those wavelengths with opacity between 2.5 and 3.0",
    "are assigned to bin two with average opacity 2.7 corresponding to weak lines .",
    "those wavelengths with opacity between 3.0 and 3.5 are assigned to bin three with average opacity 3.2 corresponding to intermediate strength lines . those wavelengths with opacity greater than 3.5",
    "are assigned to bin 4 with average opacity 3.8 corresponding to strong lines . in practice",
    ", we take the opacity bins to have a ratio of a factor of 10 in magnitude ( nordlund 1982 ) , @xmath17 the weight of each opacity bin is the sum of the weights of each wavelength in that bin , @xmath18 where @xmath19 is the non - contiguous set of those wavelengths @xmath20 in bin @xmath21 .",
    "the consequence of this grouping of opacities is that all wavelengths in a given bin have optical depth unity at approximately the same geometrical depth so that integrals over optical depth commute with the sum over wavelengths . specifically , the radiation heating / cooling is @xmath22 where the operator @xmath23 is @xmath24 and @xmath25 is the weighted sum of the planck functions at the wavelengths in bin @xmath21 , @xmath26 this results in a tremendous saving in computational time , since the feautrier equations need only be solved for a few opacity groups .",
    "we choose to use only 4 groups corresponding to the continuum , weak , medium and strong lines .",
    "a major approximation we make is to assume that bin membership of each wavelength is independent of temperature .",
    "this is reasonable to the extent that the ratio of line to continuum opacity is relatively independent of the temperature , which holds for lines of atomic species that are also major electron contributors to the dominant continuous h@xmath27 opacity .",
    "however , it is not a good approximation for the numerous iron lines that produce significant line blocking in the photosphere .",
    "we solve the feautrier equations along 5 rays ",
    "one vertical ray and four slanted rays ( at an angle @xmath28 ) , through each grid point on the surface , using long characteristics ( fig .",
    "[ rays5 ] ) .",
    "the vertical ray has weight 1/4 and the slanted rays together weight 3/4 .",
    "the four slanted rays are rotated by 15 degrees each time step in order effectively probe all the surrounding medium .",
    "each @xmath29 combination is treated in turn . for each",
    ", there is a collection of parallel rays labeled by the surface grid point through which they pass . for the slanted rays ,",
    "the opacity and source function are interpolated to the location of the intersections of the rays with each horizontal plane .",
    "the optical depth along each ray at each horizontal plane is then calculated by integrating along the ray from the surface inward .",
    "since the opacity groups are fixed multiples ( 10 ) of each other , the optical depth needs to be calculated for the continuum only and is then scaled for the other opacity groups .    to obtain accurate integrated intensities the continuum opacity average",
    "is renormalized slightly , with a factor ( close to unity ) obtained by requiring that the emergent intensity , summed over the four bins , should match the wavelength integrated monochromatic intensity , computed in a two - dimensional strip from the model .",
    "a posteriori checks , where similar comparisons are made for 3-d snapshots , have been used to verify the procedure .",
    "it is crucial that the thin surface thermal boundary layer be resolved in order for the correct radiative losses to be obtained .",
    "therefore , in low resolution simulations we interpolate from the hydrodynamic computational grid to a finer grid in the vertical direction for solving the radiation transport . in high resolution simulations",
    "this is not necessary because the thermal boundary layer is already resolved on the dynamic grid .    at large optical depths , @xmath30 , which leads to roundoff errors in the heating @xmath31 .",
    "we therefore solve the feautrier equation directly for @xmath31 , by rewriting it as @xmath32 this ensures that the radiative heating / cooling goes to the correct asymptotic solution at large optical depth .",
    "the boundary conditions are @xmath33    the finite difference form of the feautrier equation is , @xmath34}\\\\ & & + q_{j+1}\\left({{1}\\over{\\tau_{j+1}-\\tau_{j } } }     { { 2}\\over{\\tau_{j+1}-\\tau_{j-1}}}\\right ) = \\\\ & & s_{j-1}\\left({{1}\\over{\\tau_{j}-\\tau_{j-1}}}\\right .",
    "\\left.{{2}\\over{\\tau_{j+1}-\\tau_{j-1}}}\\right )    -s_{j}\\left[\\left({{1}\\over{\\tau_{j}-\\tau_{j-1}}}+    { { 1}\\over{\\tau_{j+1}-\\tau_{j}}}\\right )    { { 2}\\over{\\tau_{j+1}-\\tau_{j-1}}}\\right]\\\\ & & s_{j+1}\\left({{1}\\over{\\tau_{j+1}-\\tau_{j}}}\\right .",
    "\\left.{{2}\\over{\\tau_{j+1}-\\tau_{j-1}}}\\right )    \\ .\\end{aligned}\\ ] ] this has the tri - diagonal form @xmath35    there is a roundoff error problem at small optical depth , because the @xmath36 in @xmath37 becomes so small compared to @xmath38 that it is lost in the noise and the solution becomes indeterminate . as a result",
    ", this formulation can only be used down to optical depths the order of the square root of the machine word length .",
    "the solution is to store the sum of the tridiagonal matrix elements , rather than @xmath37 , in the diagonal slot ( nordlund 1982 , rybicki & hummer 1991 ) , initializing it with @xmath39 the tridiagonal system is solved by the standard elimination procedure , except that the diagonal element @xmath37 is recovered just before the back - substitution step , where it may be obtained from @xmath40 since at that point @xmath41 from the forward elimination .    with these substitutions ,",
    "the solution is accurate for arbitrarily small optical depths .",
    "total radiative heating / cooling at each location where a ray crosses a horizontal coordinate surface is accumulated as the sum over opacity bins ( @xmath42 ) , and angles of the feautrier @xmath43 , @xmath44 the radiative heating / cooling is finally interpolated from the slanted grid back to the cartesian computational grid and added into the expression for the time derivative of the internal energy and the variables are advanced in time .",
    "the interaction between radiative and convective energy transport has a profound effect on the structure , dynamics and diagnostics of the sun .",
    "escaping radiation cools the plasma that reaches the solar surface and produces the low entropy plasma whose buoyancy work drives the convection .",
    "radiative , convective and wave energy transport determines the mean structure of the solar atmosphere .",
    "radiation emerging from the atmosphere provides the diagnostics that we use to determine the velocity , density , temperature and magnetic field on the sun .",
    "radiation transport modifies the observable p - mode temperature fluctuations so as to reverse the asymmetry of the intensity vs. velocity spectral peaks .",
    "solar convection is driven primarily from a thin surface thermal boundary layer by radiative cooling .",
    "fluid that approaches the surface loses its thermal and ionization energy to escaping radiation ( fig  [ parcel_history ] ) .",
    "this reduces its entropy , so gravity pulls it down to form the cores of the downflows .",
    "large entropy fluctuations occur only in these downflows , so that most of the buoyancy work that drives the convection occurs in these downflows .",
    "thus the primary driver of solar convection is radiative cooling from the surface ( stein & nordlund 1998 ) .",
    "the average structure of the solar atmosphere is significantly different from that of 1d models that reproduce the observed solar luminosity and radius .",
    "first , due to 3d radiative transfer effects the average temperature of a 3d model is higher than a 1d model with the same effective temperature . the great temperature sensitivity of the h@xmath45 opacity makes the optical depth of hot gas very large , so it is not observed ( fig  [ trad_tt ] ) .",
    "hence , the actual average gas temperature is higher than the observed radiation temperature .",
    "a hotter atmosphere has a larger pressure scale height and is more extended . in the solar case",
    "this gives an extra 75 km extension to the atmosphere .",
    "second , turbulent pressure gives extra support to the atmosphere , which extends it an additional 75 km .",
    "( fig  [ elev - p ] ) ( rosenthal et al . 1999 ) .",
    "emerging continuum and line radiation provides us with the diagnostic tools to determine the properties of the solar atmosphere .",
    "emergent radiation from the solar surface can be resolved spatially and temporally . in the continuum radiation",
    "we see the granulation .",
    "the spatial spectrum ( fig  [ granulation ] ) gives the power in the different scales of motion .",
    "the intensity distribution tells us about the temperature contrast on the unit optical depth surface .",
    "line radiation gives us much more information .",
    "spectral lines of heavy elements , whose thermal doppler widths are small compared to typical photospheric velocities , provide direct diagnostics of velocity and temperature fluctuations in the photosphere .",
    "non - spatially resolved properties such as average line profiles are useful because they bypass the difficulties associated with atmospheric seeing and instrumental resolution .",
    "their shape critically depends on the solar velocity field  the temperature structure alone gives lines that are too narrow and deep ( fig  [ line_profiles1 ] ( left ) ) .",
    "including the convective overshoot velocities in the photosphere gives excellent agreement with the observed profiles ( fig  [ line_profiles1 ] ( right ) ) .",
    "this observed average profile is the result of spatial and temporal averaging of lines from different locations with different temperatures and line of sight velocities and very different shifts , widths and shapes ( fig  [ line_profiles2 ] ) .",
    "the average line profile results entirely from convection induced temperature and velocity fluctuations , without any need for micro- or macro- turbulence or extra damping ( stein & nordlund 2000 ) .    the surface magnetic field",
    "can also be determined by analyzing stokes component line profiles .",
    "an example of the stokes profiles along a slit across a micropore in the simulation is shown in fig .",
    "[ micropore ] .",
    "the solar p - modes are excited by the work of turbulent pressure and non - adiabatic gas pressure ( entropy ) fluctuations near the top of the convection zone ( fig  [ mode - excitation ] ) .",
    "the turbulent pressure is due to the convective motions .",
    "the entropy fluctuations result from the instantaneous local imbalance between the convective heating and radiative cooling .",
    "p - mode excitation decreases at low frequencies because of the increasing mode mass and decreasing mode compression as the frequency decreases .",
    "excitation decreases at high frequencies because the pressure fluctuations produced by the convection fall off with increasing frequency .",
    "the modes are excited fairly close to the solar surface  the higher the frequency",
    "the closer to the surface is their excitation ( fig  [ mode - excitation ] ) ( stein & nordlund 2001 ) .",
    "the velocity and intensity spectra of the p - modes have asymmetric peaks .",
    "the velocity has more power on the low frequency side of the peak and the intensity has more power on the high frequency side of the peak .",
    "the velocity and intensity measured at a fixed geometrical depth have the same asymmetry , which depends on the locations of the excitation source and the observations ( kumar & basu 1999 , georgobiani et al . 2000 ) .",
    "the intensity asymmetry gets reversed from that of the temperature by radiation effects .",
    "the dominant h@xmath45 opacity is very temperature sensitive .",
    "the oscillation induced temperature fluctuations are larger on the low frequency side of the resonance and produce opacity changes that vary the location of radiation emission ( @xmath46 in a way that reduces the magnitude of the temperature fluctuations more on the low frequency side of the resonance , and thus reverses the asymmetry of the observed temperature fluctuations ( figs  [ v - ttau ] , [ k - z - t ] ) .",
    "in order to make realistic numerical simulations it is necessary to include the relevant realistic physics . in the case of the solar atmosphere",
    "this means including an appropriately realistic treatment of the radiative losses .",
    "many techniques are available to solve for radiation transport .",
    "the problem is to devise a method that is efficient enough to be applied at each time step in a dynamic calculation .",
    "we have described a method developed by nordlund that relies on reducing the number of frequencies that need to be treated to a bare minimum of 4 , by using a multi - group binning of the wavelengths according to their opacity .",
    "in addition a minimal number of rays are employed , but they are rotated to cover the computational domain . because we are only interested in the photosphere , we also can assume lte",
    ". some of the approximations we use , such as assuming that all the opacities have the same depth dependence , can be easily improved .",
    "it was instituted in a time when computer memory was small and the table size needed to be minimized .",
    "it would be nice to replace the approximation of multi - group opacities with an opacity sampling method , so as to include the effect of doppler shifts on the radiation absorption , but the cost will be many more frequencies that need to be solved .",
    "for the sun we are lucky that the radiation heating / cooling time scale is of the same order as the dynamical time scale , so that an explicit solution of the radiation transport is possible . for giant stars , for instance , where the dynamical time scale is much longer than the sun s , explicit solution of the radiation transport will reduce the possible time step size .    for other investigations , other physics will be needed . to include the chromosphere it is necessary to include at least the dominant non - lte effects of scattering and hydrogen ionization .",
    "this is the next project we are working on in collaboration with mats carlsson , viggo hansteen and andrew mcmurray of oslo university .",
    "the work of rfs was supported in part by nasa grant nag 5 9563 , nsf grants ast 9819799 and atm 9988111 .",
    "n was supported in part by the danish research foundation , through its establishment of the theoretical astrophysics center .",
    "the calculations were performed at the national center for supercomputer applications , which is supported by the national science foundation , at michigan state university and at uni@xmath47c , denmark . this valuable support is greatly appreciated ."
  ],
  "abstract_text": [
    "<S> we simulate convection near the solar surface , where the continuum optical depth is of order unity . </S>",
    "<S> hence , to determine the radiative heating and cooling in the energy conservation equation , we must solve the radiative transfer equation ( instead of using the diffusion or optically thin cooling approximations ) . </S>",
    "<S> a method efficient enough to calculate the radiation for thousands of time steps is needed . </S>",
    "<S> we assume lte and a non - gray opacity grouped into 4 bins according to strength . we perform a formal solution of the feautrier equation along a vertical and four straight , slanted , rays ( at four azimuthal angles which are rotated 15 deg . </S>",
    "<S> every time step ) . </S>",
    "<S> we present details of our method . </S>",
    "<S> we also give some results : comparing simulated and observed line profiles for the sun , showing the importance of 3d transfer for the structure of the mean atmosphere and the eigenfrequencies of p - modes , illustrating stokes profiles for micropores , and analyzing the effect of radiation on p - mode asymmetries .    </S>",
    "<S> # 1_#1 _ # 1_#1 _ =    # 1 1.25 in .125 in .25 in    psfig </S>"
  ]
}