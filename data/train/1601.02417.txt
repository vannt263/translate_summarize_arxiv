{
  "article_text": [
    "stellar population synthesis models are very successful in explaining the spectral energy distribution of galaxies in the optical @xcite but they do not account for the characteristic emission lines originating from the excited interstellar gas .",
    "starburst galaxies and galaxies with an active nucleus can produce emission lines so strong that can reach @xmath1 per cent of the continuum flux in certain bands , or as much as 1 mag @xcite . as a result , pure population synthesis models are not enough to account for observations made with broad - band photometric filters .",
    "since future large sky surveys will make photometric observations only , accurate modelling of the emission lines will be essential to estimate physical properties ( including photometric redshifts ) of galaxies precisely .",
    "the purpose of this paper is to empirically quantify correlations between properties of the stellar continuum of galaxy spectra , and the strengths of emission lines .",
    "we also propose a recipe for generating realistic emission lines in the optical regime for stellar continua taken from population synthesis models .",
    "moreover , we present a novel classification method to differentiate between starburst and active galaxies .    results presented in the paper are obtained with the help of three important , widely used machine learning techniques that have just started to gain popularity in astronomical data analysis .",
    "local linear regression using nearest neighbours @xcite has been used for physical parameter estimation based on broad - band photometry .",
    "@xmath0-means clustering , an automatic , unsupervised classification algorithm has been applied successfully , for instance , to classify gamma - ray bursts @xcite .",
    "support vector machines ( svm ) , a supervised classification algorithm has been used for star  galaxy separation @xcite and transient detection @xcite .",
    "we will briefly introduce these methods later in the paper . for a detailed introduction to the field , refer to @xcite .    as with all training set - based empirical methods ,",
    "the validity of our results is limited to the training set s coverage of the parameter space ( in our case the redshift , metallicity , luminosity , continuum and line properties ) .",
    "extrapolation capabilities of empirical techniques to parameter ranges outside the coverage is usually poor compared to theoretical models .",
    "while this certainly constrains the applicability of our results to strong emission line galaxies of the sloan digital sky survey ( sdss ) , the method itself can be easily extended to galaxies outside the investigated sample by augmenting the training set .",
    "the structure of the paper is as follows . in sec .",
    "[ sec : data ] , we explain the sample selection and data reduction methods . sec .",
    "[ sec : emlines ] describes the line reconstruction methods we investigated .",
    "an empirical method for star - forming  active galactic nucleus ( agn ) separation is given in sec .",
    "[ sec : svm ] .",
    "we present a stochastic procedure to generate realistic emission lines for continuum models in sec .",
    "[ sec : recipe ] .",
    "we summarize our findings and outline future work in sec .",
    "[ sec : summary ] .",
    "wavelengths are generally quoted in vacuum .",
    "more information on the data used for this study , additional figures and program source code are available on the web site of the paper .",
    "colour versions of the figures are available in the online version of the paper .",
    "thanks to the large amount of flux - calibrated optical galaxy spectra accumulated by the sdss , precision of galaxy spectrum modelling has been improved significantly during the last decade .",
    "many software tools and libraries exist to generate realistic stellar continua from a prescribed star formation history and various libraries of single stellar population spectra with a wide range of metallicities and initial mass function choices @xcite .",
    "models have also been extended with descriptions of interstellar extinction , the uv  ir balance @xcite and the chemical evolution of the gas from which stars can form @xcite .",
    "emission lines of galaxy spectra carry a large amount of information about the abundance and ionization states of elements in the interstellar gas .",
    "based on ionization ratios of the various elements , the source of primary radiation responsible for the excitation of the interstellar medium ( ism ) can be characterized @xcite the two primary radiation sources are young , hot , massive stars and active galactic nuclei ( agns ) .",
    "their different spectra ( thermal and power law , respectively ) cause different ionization states and ratios of the most common elements which , in turn , produce well measurable , strong , often broad emission lines : the balmer series of hydrogen , [ oii ] , [ oiii ] , [ nii ] , [ sii ] , etc .",
    "population synthesis models do not account for the emission of the ism .",
    "photoionization models @xcite yield accurate line ratios for any primary radiation spectrum and gas composition . to couple stellar population synthesis with models of photoionization , shock - heating of the interstellar gas , emission of the dust etc .",
    ", the star formation history , several interactions between the stellar populations , the active nucleus , the dust and gas content need to be accounted for . for instance , agns are very likely to be responsible for quenching rapid star formation following starburst periods in the galaxy but they also emit ionizing radiation that excites gas , evaporates dust and produces shock waves that heat the ism . also , starburst periods are followed by high supernova activity that enriches the ism with metals , leading to significant chemical evolution which must be reflected in the models of emission lines .",
    "additionally , a recent advancement in stellar population synthesis is the inclusion of stellar rotation and binary evolution effects which have been shown to noticeably influence the strengths of some emission lines @xcite . taking everything into account is not possible without detailed hydrodynamic simulation of the galaxies @xcite or without making significant simplifications to the models . various software , notably pgase and bpass @xcite ,",
    "can be used to generate emission lines on top of stellar continua computed from stellar population synthesis .",
    "the photoionization part of these softwares , however , introduces a large set of free parameters that describe the distribution and composition of the ism . a frequently used way of reducing the number of free parameters is to make theoretical or empirical assumptions .",
    "typical theoretical simplifications include the assumption of spherical symmetry or the use of a common ionization spectrum for all gas clouds @xcite .",
    "if no strict physical considerations can be made , to generate realistic emission lines on top of modelled continua using any photoionization code , one has to estimate the _ a priori _ distribution of model parameters by comparing large ensembles of models with observations .",
    "for instance , the code le phare @xcite uses the relations of @xcite to parametrize emission lines .",
    "another route to take to generate realistic emission lines is to work on an entirely empirical basis .",
    "@xcite demonstrated that stellar continua of sdss galaxies form a 1d sequence and thus , can be characterized by a single numerical value , the ` eclass ` .",
    "the value of ` eclass ` for each galaxy spectrum is obtained by expressing the continuum on a basis derived from principal component analysis ( pca ) .",
    "@xcite showed that strong correlations between the ` eclass ` ( i.e. the stellar continua ) of starburst and agn galaxies exist .",
    "they applied pca to expand emission line equivalent widths ( ews ) of sdss galaxies on a 3d basis and correlate the principal components with the ` eclass ` of the continua .",
    "we take their approach a step further : based on the correlations , we give a recipe to automatically generate emission lines with realistic distribution and refine star - forming  agn separation using the principal components and svm .",
    "we started with the entire spectroscopic galaxy sample of the sloan digital sky survey data release 7 @xcite which we later filtered by signal - to - noise ratio and line strength . as one of our goals was to accurately fit broad agn lines , we measured line parameters ourselves .",
    "pca is widely used to derive a representative basis from optical spectra of galaxies .",
    "when performing pca on emission line galaxies , the eigenspectra are primarily sensitive to the variations in emission line strengths and only secondly to continuum features @xcite .",
    "obviously , the slope of the continuum is correlated with emission lines but the variance of the lines is bigger . to run pca on the pure continua",
    ", one has to mask the regions of emission lines , or eliminate the lines completely by subtracting line models from the measured spectra .",
    "line fits have to be precise enough so that the line - subtracted continua contain minimal residuals .",
    "we reprocessed the entire set of sdss dr7 galaxy spectra according to these requirements with our own implementation of the algorithm detailed in this section .",
    "one frequent method of fitting continua in the optical band is to express the spectrum as a non - negative linear combination of template spectra @xcite while also accounting for the intrinsic attenuation and velocity dispersion .",
    "although more advanced , bayesian and pca - based methods exist @xcite to derive physical properties from the continuum , as we were mainly interested in the emission lines , we retained the former technique for continuum subtraction . first , we corrected for galactic extinction , masked emission lines and fitted the continuum using the templates from @xcite by also fitting the velocity dispersion and intrinsic extinction in parallel .",
    "intrinsic extinction was modelled following @xcite .",
    "metallicity was taken into account by fitting four sets of templates of differing metallicities and choosing the one with minimal reduced @xmath2 .",
    "thus , the fitted metallicity can take one of four values : @xmath3 , @xmath4 , @xmath5 or @xmath6 .",
    "we did not take the nebular continuum emission into account , which , in the case of young starburst galaxies , can contribute a non - negligible flux to the near - infrared part of the spectrum @xcite .",
    "since the entire continuum was fitted with stellar templates only , we expect a slight overestimation of absorption lines , and therefore the overestimation of emission lines for starburst galaxies . on the other hand , within the wavelength coverage of sdss spectroscopy ,",
    "nebular continuum emission is significant only in the case of stellar populations younger than @xmath7  myr or at very low metallicities of @xmath8 @xcite , and only about 0.5  per  cent of our sample potentially fall into this parameter range .    due to discrepancies between continuum models and sdss spectra @xcite ,",
    "the continuum - subtracted spectrum consists of three components : the emission lines , the noise and a slowly changing background that originates from the imperfect models .",
    "since the emission lines and noise are high - frequency components , one can easily eliminate the background by a high - pass filter .",
    "for this purpose , we used a 50    wide rolling median filter .",
    "this was wide enough to leave broad agn lines almost intact , yet remove any residuals of the incorrect background subtraction .",
    "[ fig : contfit ] illustrates this procedure .        once the low - frequency background has been removed , lines are fitted using a technique we call _ noise - limited fitting_. to precisely fit all strong emission lines , including those of active galaxies , we use three increasingly complex line models .    * a single gaussian : @xmath9 * two gaussians centred on the same wavelength but with different variance @xmath10 * two gaussians allowing for a small offset @xmath11    between the centres , different variance @xmath12    while the first model is enough to fit emission lines with typical velocity dispersion , the second model is necessary for lines with broad wings and the third model for asymmetric lines .",
    "our objective is to find the simplest , yet well - fitting model .",
    "overlapping emission lines are  obviously  fitted together , but we do not enforce any correlation on the ews of lines from the same ion . also , the velocity dispersions of the lines , even of those from the same ion , are fitted independently .",
    "first , we fit the lines with the simplest model , subtract it from the measurement and compare the residual within the region of the emission line with the noise in wavelength ranges without lines .",
    "if rms of the residual inside the region of the line is at least two times than elsewhere , we reject the model and attempt to fit the line with a more complex one .",
    "fig  [ fig : linefitting ] illustrates how this technique works on asymmetric broad agn lines",
    ".        tab .",
    "[ table_lines ] summarizes the fitted and subtracted emission lines .",
    "line model fit parameters are available online . in panel ( a ) of fig .",
    "[ fig : bpt_classes ] , we plot the baldwin  phillips  terlevich ( bpt )",
    "diagram of the sample using a colour coding we are going to use throughout the paper .",
    "[ table_lines ]    .list of the fitted nebular emission lines . [ cols=\"<,<,<,<,<,<\",options=\"header \" , ]          it is interesting to compare our line fits to those of @xcite . in the cited work , the authors used a simpler technique of fitting nebular emission lines of sdss galaxies with the primary focus on the signal - to - noise ratio of line measurements and not on the minimization of the residuals after line subtraction .",
    "as a result , their line models can not directly be used to get a pure continuum due to the high residuals of the fitting .    in fig .",
    "[ fig : mpacompare ] , we compare the ews of the most prominent emission lines as derived with our technique and with the method of @xcite . in the case of strong emission lines ,",
    "our measurements of line strengths are very similar to the results of @xcite , but we estimate weak emission lines significantly higher .",
    "this is very likely due to the high - pass filtering applied to the continuum - subtracted spectrum , cf .",
    "[ section_fits ] . yet , between @xmath13 and @xmath14 of our line , ews are within @xmath15 of @xcite , with the exception of h@xmath16 and h@xmath17 where only @xmath18 and @xmath19 , respectively , of the measurements are within @xmath15 . also , @xcite measured weak lines by fitting them together with stronger lines of the same ion , imposing a constraint on line ratios , whereas we fitted these lines independently .",
    "weaker lines can easily become undetectable in noisy regions , hence our fitting method introduces some selection bias .",
    "we selected a smaller sample of @xmath20 galaxies from the entire set of continuum and line - fitted spectra that met the following criteria :    * observed at a signal - to - noise ratio @xmath21 , * all 11 emission lines listed in tab .",
    "[ tab : ewfit ] are measured and non - zero .",
    "these lines are the same as in @xcite .",
    "the sample size was further limited to an easily manageable number by choosing a section of the sky ( right ascension between @xmath22 and @xmath23 ) .",
    "the requirement that all @xmath24 emission lines should be measurable results in a sample containing galaxies with ongoing star formation or possessing an active nucleus only .",
    "[ fig : samplehistograms ] shows the selection effects on the distribution of the apparent and absolute @xmath25-band magnitudes , the redshift and the metallicity .",
    "while the cut in signal - to - noise ratio did produce a cutoff around @xmath26 apparent magnitude and a relative increase of objects towards smaller redshifts , the absolute magnitude distribution shows that our selection method prefers fainter , smaller and younger galaxies .",
    "galaxies with lower metallicities are also selected with higher probability , presumably due to correlations between ongoing strong star formation , metallicity and age .",
    "nevertheless , galaxies with solar and above solar metallicities are still present in the sample .",
    "the sdss  dr7 main galaxy sample , which makes up the majority of our training set , was not selected for morphological type or colour , and thus includes a wide variety of galaxies @xcite . at larger redshifts , however , different environments , e.g. harder radiation fields and higher ionization parameters @xcite , can lead to significantly different emission line characteristics .",
    "certainly , the validity of our results is constrained by parameter ranges covered by the sample . by using a data set that goes beyond the types of galaxies observed by the sdss",
    ", one can easily apply our method to a broader range of galaxies .",
    "principal components of the stellar continuum were derived from the fitted model spectra instead of the measurements directly .",
    "although the precise line modelling would make it possible to subtract emission lines from the original spectra or run pca directly on the measurements by masking out emission lines , due to the limited size of the sample which would make eigenspectra noisy , we choose to use the models instead .",
    "fitted continuum models were taken at rest frame , convolved with the best - fitting velocity dispersion kernel and normalized to have equal flux in the following featureless rest - frame wavelength ranges : @xmath27@xmath28   , @xmath29@xmath30   , @xmath31@xmath32   , @xmath33@xmath34   .",
    "pca was done in the @xmath35@xmath36   range with @xmath37   binning .",
    "the average continuum was subtracted from the individual spectra prior to calculating the covariance matrix .",
    "eigenspectra were determined using the lanczos singular value decomposition ( svd ) algorithm from propack @xcite .",
    "the algorithm calculates only a given number of singular vectors with the largest corresponding singular values .",
    "this was very useful in our case as the spectra consisted of @xmath38 data points , whereas we were interested in the first five principal components only .",
    "the average spectrum and the resulting eigenspectra are plotted in fig .",
    "[ fig : pcavectors ] .",
    "as the average was subtracted , the first eigenspectrum corresponds to the colour of the galaxy .",
    "the following two basis vectors are rather similar at first sight but the third one shows more prominent absorption lines .",
    "they are together very likely to determine the age and metallicity of the galaxy as the @xmath39   - break is very strong in both of them .",
    "the fourth vector probably corresponds to the width of absorption lines thus correlates with velocity dispersion .",
    "the magnitude of the fourth and fifth eigenvalues is similar , and they already mark the start of the plateau in the distribution of eigenvalues , therefore taking more eigenspectra into account does not significantly increase the variance explained by them .",
    "in contrast to what was done by @xcite , we calculate principal components of the _ logarithm _ of emission line ews .",
    "[ fig : linepcavectors ] shows the resulting singular vectors .",
    "taking the logarithm is more useful when one is interested in line ratios instead of absolute line strengths and uses linear methods for the analysis .",
    "we have to mention , however , that using the logarithm of the ews also means that the results presented in the rest of the paper will be valid in the _ logarithmic sense _ only .",
    "lines should not have different signs . ]",
    "our goal was to empirically estimate emission line ews from continuum principal components .",
    "if there exists any correlation between the continuum and emission lines of galaxy spectra , it is clearly non - linear .",
    "global linear methods to analyse the correlations are not useful in this case , yet _ locally linear _ methods still can be used .",
    "let us consider an ensemble of measurements where measured values are split into two sets @xmath40 and @xmath41 , @xmath42 indexing the individual measurements .",
    "for the sake of simplicity , @xmath43 are taken to be scalars whereas @xmath44 are vectors , thus @xmath45 forms a metric space of dimension @xmath46 .",
    "the euclidean metric is often used to measure distances among data vectors of @xmath45 even though it might lack any physical interpretation .",
    "our objective is to characterize known , or predict unknown @xmath43 from the always known @xmath44 vectors . to estimate @xmath43 from @xmath44",
    ", first we find the @xmath0-nearest neighbours of @xmath44 in @xmath45 .",
    "let us denote the set of indices of these nearest neighbours with @xmath47 , where @xmath48 by definition .",
    "then we express @xmath43 in the following form @xmath49 note , that both @xmath50 and @xmath44 are vectors and their dot product is taken in the formula above .",
    "the @xmath51 constants and the @xmath50 coefficients need to be determined individually for every @xmath52 measurement using standard linear regression by minimizing @xmath53 where @xmath42 is still the index of the measurement , @xmath54 runs on the nearest neighbours and @xmath55 is a weight .",
    "the expression of @xmath2 is similar if @xmath43 are vectors instead of scalars but the @xmath56 coefficients become matrices .",
    "errors in @xmath43 and the components of @xmath44 can be incorporated into the value of @xmath57 .",
    "similarly , neighbours in @xmath58 can be ordered by distance from @xmath59 and the inverse of ( the square of ) the distance can be used as a weight in eq .",
    "[ eq : chisquared ] .",
    "local linear regression has many advantages over global non - linear modelling .",
    "first of all , global models are usually either too simple to describe the data or prone to overfitting .",
    "local linear models , on the other hand , are simple and can be used to characterize the local estimation errors .",
    "for instance , one can measure the goodness of the estimation of @xmath43 by the @xmath2 of the local linear fit .",
    "the challenge in local linear fitting is to find the @xmath0-nearest neighbours quickly in large data sets .",
    "spatial indexing , most often a @xmath60-tree index is used for this purpose @xcite .",
    "we applied the local linear regression technique to estimate emission line ews from the stellar continuum principal components . to test whether continuum pcs carry more information regarding the emission lines than broad - band sdss magnitudes",
    ", we will also perform the regression analysis directly on the photometric magnitudes in sec .",
    "[ sec : magfit ] .",
    "further tests are done with randomized samples ( sec .",
    "[ sec : randomfit ] ) to get a picture of the performance of our method .    by using the notation of sec .",
    "[ sec : linreg ] , @xmath44 became the first five continuum principal components and @xmath43 became the log  ews .",
    "emission line log  ews were fitted individually based on the log  ews of the @xmath61 nearest neighbour galaxies in the continuum pca space .",
    "the @xmath2 of the fitting was weighted by the inverse - square distance of the neighbours from the query point .",
    "the value of @xmath61 was chosen as a rule of thumb : we are fitting @xmath62 parameters and the number of data points must be large enough to adequately determine that many parameters but small enough to preserve locality . modifying this parameter within reasonable limits ( e.g. @xmath63 ) does not significantly impact the results .",
    "emission lines we used .",
    "colour coding of data points is the same as in panel ( a ) of fig .",
    "[ fig : bpt_classes ] and reflects the activity class of galaxies . ]",
    "emission lines we used .",
    "colour coding of data points is the same as in panel ( a ) of fig .",
    "[ fig : bpt_classes ] and reflects the activity class of galaxies . ]",
    "[ fig : ewfit ] shows the reconstructed log  ews of emission lines as functions of the directly measured ews .",
    "ews reconstructed from the continuum are in reasonably good agreement with directly measured log  ews .",
    "the relative flux error @xmath64 of the line reconstruction is gaussian but a systematic shift @xmath65 is visible in the case of [ oii ] , [ oiii ] and [ nii ] ( @xmath66 , respectively ) .",
    "the typical value of the relative error is @xmath67 for hydrogen and sulfur , @xmath68 for [ oii ] and [ nii ] , and @xmath69 for [ oiii ] .",
    "3 - 4 of tab .",
    "[ tab : ewfit ] list the outcome of the correlation analysis for the 11 investigated lines using the local linear regression technique .",
    "pearson s product - moment correlation coefficient @xmath70 and the rms error @xmath71 were calculated for each line .",
    "these numbers also show that fits are most accurate for the hydrogen and sulfur lines ( @xmath72 ) whereas oxygen and nitrogen lines are significantly less correlated with direct line measurements .",
    "[ fig : sliceerrors ] shows the dependence of the error of the reconstruction on galaxy properties ( cf .",
    "[ fig : samplehistograms ] for histograms of these ) for select lines .",
    "the brighter and higher metallicity galaxies have a larger fraction of agns and are estimated with higher errors , especially in the case of oxygen and sulfur lines .",
    "objects at higher redshifts generally exhibit decreasing accuracy .",
    "the error of line reconstruction visibly increases towards the limits of our training set .",
    "this is due to the fact that near the edges of the training set there are fewer galaxies and the nearest neighbours used to estimate the emission lines are generally less similar to each other and to the galaxy whose lines are being fitted .",
    "5008   , black  [ nii ] 6585   , grey  [ sii ] 6718   , and blue  h@xmath16 .",
    "see the text for a discussion . ]    as we expected , emission lines can be much better reconstructed from the continuum of star - forming galaxies due to the strong connection between the young stellar population and the ism : young massive stars are responsible for the excitation of interstellar gas clouds .",
    "nevertheless , [ oii ] and [ nii ] lines show a significant scatter even in the star - forming case .",
    "interestingly , sulfur lines can be reconstructed much better .",
    "one intriguing result is that , while [ oiii ] is an important indicator of nuclear activity , its reconstruction from continuum properties in case of agns seems rather problematic .",
    "it is understandable as agn activity correlates much less with the properties of the stellar populations than in the star - forming case . yet , some connections exist as it is visible from [ nii ] and the hydrogen lines .",
    "l c | d d | d d | d d | d d & & & & & + & & & & & + line & @xmath73 [  ] & & & & & & & & +    h@xmath16 & 6565 & @xmath74 & @xmath75 & @xmath76 & @xmath77 & @xmath78 & @xmath79 & @xmath80 & @xmath81 + h@xmath17 & 4863 & @xmath82 & @xmath83 & @xmath84 & @xmath85 & @xmath86 & @xmath87 & @xmath88 & @xmath89 + sii & 6718 & @xmath90 & @xmath91 & @xmath92 & @xmath93 & @xmath94 & @xmath95 & @xmath96 & @xmath97 + sii & 6733 & @xmath98 & @xmath99 & @xmath100 & @xmath101 & @xmath102 & @xmath103 & @xmath104 & @xmath84 + h@xmath105 & 4342 & @xmath106 & @xmath107 & @xmath92 & @xmath108 & @xmath109 & @xmath110 & @xmath111 & @xmath112 + oii & 3727 & @xmath113 & @xmath114 & @xmath115 & @xmath116 & @xmath117 & @xmath118 & @xmath119 & @xmath120 + oiii & 5008 & @xmath121 & @xmath122 & @xmath123 & @xmath124 & @xmath123 & @xmath125 & @xmath126 & @xmath127 + oiii & 4960 & @xmath128 & @xmath92 & @xmath129 & @xmath130 & @xmath131 & @xmath132 & @xmath133 & @xmath134 + nii & 6585 & @xmath135 & @xmath136 & @xmath137 & @xmath103 & @xmath138 & @xmath139 & @xmath140 & @xmath141 + nii & 6550 & @xmath142 & @xmath143 & @xmath144 & @xmath145 & @xmath146 & @xmath147 & @xmath148 & @xmath149 +      to see if continuum pca is any better than directly estimating emission lines from broad - band magnitudes , we performed the above analysis using the sdss photometric magnitudes instead of the principal components .",
    "for this purpose , we used dereddened model magnitudes without any @xmath150-correction .",
    "the lack of @xmath150-correction is not supposed to significantly affect the procedure as the redshift distribution of the sampled galaxies is rather sharp .",
    "while broad - band magnitudes are strongly correlated with continuum principal components , it is still interesting to see how lines are reconstructed from them .",
    "first of all , magnitudes are highly correlated with each other , whereas pca eliminates covariance .",
    "also , observed magnitudes are already ` contaminated ' with emission lines which might result in stronger correlations with ews .",
    "results of line reconstruction from magnitudes are plotted in fig .",
    "[ fig : magfit ] . compared with line reconstruction from pca as plotted in fig .",
    "[ fig : ewfit ] , no clear difference can be seen in terms of scatter , perhaps with the exception of more outliers being visible in the photometric case .",
    "thus , log  ews can be reconstructed from magnitudes almost as well as from the principal components .",
    "quantitative results are listed in col .  5 - 6 of tab .  [",
    "tab : ewfit ] .",
    "we have to emphasize here that our sample contained strong emission line galaxies only , thus the strong correlation between magnitudes and log  ews exists only for our sample and can not be generalized to all galaxies .      to test whether a single global linear model is sufficient to reproduce the lines , we repeated the procedure of estimating log  ews from the continuum principal components as described in sec .",
    "[ sec : pcafit ] but instead of using the 30 nearest neighbour galaxies , we randomly selected 30 galaxies from the entire sample .",
    "another difference was that the @xmath2 of the fit was not weighted by the inverse - square of the distance from the query point to relax the effect of locality . by looking at col .",
    "7 - 8 of tab .",
    "[ tab : ewfit ] , it is somewhat surprising that correlation coefficients and rms errors of the individual lines did not get much worse . by looking at panel ( c ) of fig .",
    "[ fig : bpt_random ] , one can clearly see , however , that that the star - forming branch of the bpt diagram can not be reconstructed this way , and the agn sequence is also greatly distorted .",
    "the conclusion is that emission line log  ews can not be explained by a simple , global linear relationship with continuum principal components .",
    "thus , local fitting from nearest neighbours is necessary to reconstruct the bpt from either continuum principal components or broad - band magnitudes .      as another test",
    ", we shuffled the sample and randomly paired continuum principal components with emission line vectors of other galaxies to break the locality in the pca space .",
    "results are listed in col .",
    "9 - 10 of tab .",
    "[ tab : ewfit ] .",
    "it is not surprising that correlations almost entirely disappear in the shuffled case ( note that @xmath70 values are multiplied by @xmath151 ) .",
    "this supports that information about the emission lines is indeed encoded in the continuum of a galaxy spectrum .",
    "as the bpt diagram is generally used to classify emission line galaxies into star - forming and agn , it is very informative to see how well the various methods can recover it solely from the continuum . the difference among the line estimation methods introduced above is obvious once the bpt diagram is plotted from the reconstructed log  ews , as it was done in fig .",
    "[ fig : bpt_random ] .",
    "local linear fitting of ews using the nearest neighbours and reconstructing lines from broad - band magnitudes give similarly fair , qualitatively correct bpt diagrams while the randomization of the sample disrupts the diagram entirely .    .",
    "see the text for discussion . ]    to further analyse the properties of a reconstructed bpt diagram , we will stick to local linear regression based on the continuum principal components . in fig .",
    "[ fig : bpt_classes ] , we plot the original bpt for reference , the reconstructed diagram for all galaxies , and two diagrams showing agns and star - forming galaxies only , as classified by @xcite .    the first thing to see in panels  ( c )  and  ( d ) of fig .",
    "[ fig : bpt_classes ] is the mixing of weak star - forming galaxies with weak agns in the bottom corner of the reconstructed bpt diagram .",
    "the mixing is caused by the bad reconstructability of the [ oiii ] line which is most likely due to lack of a strong correlation between agn activity level and the stellar continuum .",
    "the mixed , low activity  low star formation rate region is located at the bottom corner of the [ nii]/h@xmath16[oiii]/h@xmath17 bpt diagram .",
    "empirically drawn bpt diagrams are noisy enough to smear pure star - forming galaxies and mixed star - forming / agns together in this part of the bpt so it is an interesting question whether it is possible to segregate galaxies into two distinct classes or not by incorporating information on the stellar continuum into classification model . by visually inspecting the projections of the 5d continuum pca space , one can see that while agns and star - forming galaxies occupy different loci , they can not be clearly separated into two disjoint sets by cuts in any principal component dimensions , nor the distribution of galaxies is bimodal .",
    "we turned to svm , a machine learning algorithm , to determine an empirical segregation plane between the two classes in the continuum - pca  line - pca space .",
    "svm are supervised learning algorithms which can be trained to automatically classify multidimensional data vectors into two disjoint sets @xcite .",
    "the training phase starts with compiling a _ training set _ of data vectors that are tagged as either belonging to class @xmath152 or class @xmath153 . during learning ,",
    "the model will find a hyperplane in the space of data vectors which separates the elements of @xmath152 and @xmath153 with the largest possible margin .",
    "once the model is trained , it can be used to classify any query point into one of the two classes .",
    "we compiled the training set from our emission line galaxy sample by selecting galaxies on the bpt that could be classified with high confidence either as pure star - forming or agn . to select high - confidence agns",
    "only , we picked galaxies above the theoretical maximum starburst line of @xcite : @xmath154}{h\\beta}\\right ) > 0.61 \\left [ \\log_{10}\\left(\\frac{[{n\\textsc{ii}}]}{h\\alpha}\\right)-0.47 \\right]^{-1 } + 1.19.\\ ] ] star - forming galaxies were selected to fall below the empirical starburst line of @xcite : @xmath154}{h\\beta}\\right ) < 0.61 \\left [ \\log_{10}\\left(\\frac{[{n\\textsc{ii}}]}{h\\alpha}\\right)-0.05 \\right]^{-1 } + 1.3,\\ ] ] and at the same time be above the following line , defined by us : @xmath154}{h\\beta}\\right ) > 3 \\log_{10}\\left(\\frac{[{n\\textsc{ii}}]}{h\\alpha}\\right ) + 1.55.\\ ] ] the line was drawn empirically to cut out the most reliably identifiable part of the star - forming population .",
    "curves on fig .",
    "[ fig : bpt_svm ] illustrate these cuts .",
    "we used the first five continuum principal components and the first four log  ew principal components of the training set galaxies as input data vectors to svm . by combining information from the continuum into the training",
    ", we might hope a better separation of the two galaxy types in the mixed lower corner of the bpt than simply from the emission lines .",
    "as svm is a strictly empirical model , we shall not , however , draw far - reaching theoretical conclusions from its outcome .",
    "since our training set was not containing the mixed region , it was directly separable into two disjoint classes by a linear cut .",
    "consequently , data points did not need to be projected into any higher dimensional space by a kernel function , like in most applications of svm , we simply ran it on the @xmath155 dimensional vectors of the continuum + line pca space .    .",
    "see the text for discussion . ]",
    "we plot the results of the svm - based classification in fig .",
    "[ fig : bpt_svm ] . panels ( a ) and ( b ) show the two training set classes ( star - forming and agn , respectively ) with log  ews of the originally measured emission lines . panels ( c ) and ( d ) show the outcome of the svm classification .",
    "even though the mixed region was not included in the training set at all , svm reproduced the empirical segregation line of @xcite surprisingly well , with only about @xmath156 per cent of the sample scattered into the opposite region .",
    "based on our findings , we propose a simple stochastic recipe to generate a realistic distribution of emission lines for stellar population synthesis models that provide the continuum only .",
    "the algorithm works by expressing the model continuum as a linear combination of the basis vectors derived from pca of the continua of sdss galaxies . according to these principal components ,",
    "the model spectrum is classified into one of the @xmath157 continuum classes .",
    "we used @xmath0-means clustering to define the continuum classes , as described in sec .",
    "[ sec : kmeans ] .",
    "let us denote the average continuum vector with @xmath158 and the pca basis vectors with @xmath159 , where @xmath42 indexes the five dimensions of the pca space and @xmath73 goes over the wavelength bins .",
    "continuum classes are given by the centre of mass vectors @xmath160 where @xmath161 indexes the @xmath157 classes .",
    "within each class , model lines are randomly generated from a multivariate gaussian distribution .",
    "the mean line log  ews @xmath162 and the covariance matrices @xmath163 of the distributions are pre - calculated from the real galaxy sample and provided for each of the @xmath157 continuum classes .    the detailed recipe for generating realistic emission lines given a stellar continuum model spectrum is the following .    1 .   rebin the rest - frame model spectrum @xmath164 to the grid of the basis vectors and normalize it as described in sec .",
    "[ sec : contpca ] to get @xmath165 .",
    "2 .   subtract the average continuum @xmath158 from the normalized spectrum .",
    "3 .   express the continuum as a linear combination of the provided basis by calculating the dot products @xmath166 } $ ] 4 .",
    "find the class centre @xmath160 in the continuum pca space that is the closest ( in euclidean distance ) to the vector @xmath167 of the linear coefficients .",
    "take the covariance matrix @xmath163 and mean line log  ew vector @xmath162 of the line distribution within the closest class and generate a random vector of line log  ews from the corresponding multivariate gaussian distribution .",
    "data necessary to generate random lines are published on the paper s web site .",
    "@xmath0-means clustering is a machine learning algorithm that classifies data points based on their distances from cluster centres : points belonging to a cluster must be closer to the centre of mass of that particular cluster than any other clusters-means algorithm basically constructs a voronoi tessellation from the data vectors , with seeds being the centres of mass of the clusters . ] .",
    "this implicit definition of a cluster makes finding the best exact solution a hard problem , but heuristic , randomized algorithms exist that can find a reasonable clustering relatively fast @xcite .",
    "the only inputs of @xmath0-means clustering are the data vectors and @xmath0 , the number of clusters wanted .",
    "the output is the centres of mass of the @xmath0 clusters .",
    "once the latter are known , new points can be classified simply by measuring their distances from the cluster centres and putting them into the one with the closest centre .      to construct our stochastic model of emission lines",
    ", we started from the @xmath168-dimensional vector space of continuum and log  ew principal components of our high signal - to - noise ratio sdss galaxy sample .",
    "first , we classified galaxies into continuum  log  ew classes using the @xmath0-means clustering function of r and the algorithm of @xcite .    to choose the right number of clusters , one has to consider the variance of emission line log  ews as functions of the number of the clusters .",
    "the variance in each cluster is supposed to be decreasing as the number of clusters is growing since clusters are becoming smaller .",
    "the minimum variance is limited by the noise in the data .",
    "the @xmath169 curves for all emission lines are plotted in panel ( a ) of fig .",
    "[ fig : variance ] .",
    "hence , to minimize the variance of line strengths within each class , we chose @xmath170 as all curves get essentially flat above this value . for training sets of different sizes and characteristics ,",
    "a similar analysis of the variance is advisable to determine the input parameter of @xmath0-means clustering .     and fig .",
    "[ fig : bpt_recipe ] .",
    "panel ( c ) illustrates the case of performing both the clustering and classification in the continuum principal component space only .",
    "even with the additional variance due to misclassification , using both the continuum and line log  ew principal components for the clustering is favourable . ]",
    "once @xmath0-means clusters in the continuum - pca  line - pca space are determined in the way described in sec .",
    "[ sec : kmeans ] , we have to model the distribution of emission line log  ews within each cluster . if the number of clusters is sufficiently high , clusters will become small enough that the distribution of emission lines within them can be well modelled by a multivariate gaussian distribution parametrized with @xmath162 and @xmath163 .",
    "we note that a multivariate gaussian distribution , when its entire covariance matrix is known , does not only account for individual line strengths but also for line ratios , including ratios from the same line series .",
    "it is also important to mention that , while we did the @xmath0-means classification of galaxies in the @xmath168-dimensional continuum + log  ew space , stellar population synthesis models yield the continuum coefficients only . as a result , when classifying model continua , we measure distances from cluster centres in the 5d continuum - pca subspace only",
    ". this will introduce some mixing among clusters as determined by @xmath0-means and cause somewhat larger scatter in the randomly generated log  ews than what it would be based solely on the @xmath163 covariance matrices .",
    "this effect is shown in panel ( b ) of fig .",
    "[ fig : variance ] .",
    "it is still worth using the entire @xmath168-dimensional space to run the @xmath0-mean classification because the resulting variances are still lower than using the continuum principal components only , cf . panel ( c ) of fig .",
    "[ fig : variance ] .",
    "also , because the covariance of the lines is treated stochastically , there will be random scatter in line ratios as well .",
    "a direct test of the algorithm is to take the galaxies of our sdss sample , generate emission lines based on their fitted continua and see how well the bpt diagram can be reconstructed .",
    "results of this procedure are plotted in fig .",
    "[ fig : bpt_recipe ] where we also show the original bpt for reference in panel  ( a ) next to the stochastically generated bpt in panel  ( b ) . while the curve of star - forming galaxies and the agn mixing sequence is reproduced reasonably well",
    ", there are also a large number of red data points corresponding to the bottom corner of the original bpt visible in all regions of the plot .    .",
    "while lines were generated from a multivariate distribution randomly , based on the location of the continuum in the pca space , the resulting bpt diagram resembles the original one remarkably well , although more scatter and significant mixing of galaxy types is visible .",
    "colour coding of the data points is based on the original bpt as in panel ( a ) of fig .",
    "[ fig : bpt_classes ] . ]",
    "the recipe outlined above yields line ews only , and is sufficient to reproduce the flux excess caused by emission lines but not line widths . in general ,",
    "line widths should be taken to be equal to the velocity dispersion , at least in the case of star - forming galaxies .",
    "width distributions of broad lines would need to be investigated to generate agn lines with realistic breadth distribution .    as we pointed out in sec .",
    "[ sec : ewdist ] , using only the continuum principal components to generate log  ews introduces additional variance due to the mixing of the classes as defined in the continuum + line space .",
    "additionally , as lines are randomly generated based on a multivariate gaussian distribution , ews and line ratios are not guaranteed to be correct for individual galaxies , but will be for the entire ensemble of mock galaxies .    if the goal is to generate realistic emission lines for individual model continua , we suggest using the local linear regression method as described in sec .  [",
    "sec : pcafit ] . while that technique yields more accurate emission line estimates , it also requires a much larger input data set and more heavyweight algorithms .",
    "we have measured the emission lines of galaxies from sdss  dr7 to analyse the correlation between the emission lines and the stellar continua in the optical wavelength range .",
    "we have developed an algorithm , noise limited fitting , to accurately measure the parameters of broad and asymmetric emission lines , yet avoid overfitting of narrow , symmetric lines .",
    "we have also demonstrated how to correct for discrepancies between theoretical stellar continuum modelling and real measurements by low - pass filtering the residual before emission line fitting .    in sec .",
    "[ sec : emlines ] , we have shown that optical emission line log  ews can be reasonably well reconstructed from both the optical stellar continuum and broad - band magnitudes of galaxies .",
    "the main practical use case of our method is to generate emission lines for stellar continua from stellar population synthesis models , provided that the models fall into the wavelength and physical parameter coverage of our training set . since our sample contained strong emission line galaxies only ( with all @xmath24 prominent lines measured ) , the results can not be generalized to any type of galaxy without extending the training set , but the algorithm still applies .",
    "also , further research is necessary to use our line reconstruction method for galaxies with fewer and weaker lines : correlations between the stellar continuum and the probability of the very presence of weak emission lines need to be taken into account .",
    "another application of our method is to estimate emission lines of photometric galaxies .",
    "the technique readily works for the sdss _ ugriz _ filter set , but the existing training set can be adapted to other filter systems as well . while one simple way to do this is to compute synthetic photometry from the spectra , building a new training set by cross - matching the photometric measurements made with the other filter set to our spectroscopic sample is a better option ( provided that the survey overlaps with the sdss ) , since it would automatically account for the unknown systematics in spectrophotometry . with the outlined modifications , our technique will be of great value for analysing data from large photometric surveys like panstarrs and the lsst .    additionally , by correcting for the contributions of strong emission lines to broad - band magnitudes , our method can be useful in improving template - based photometric redshift estimation algorithms to narrow the performance gap between the theoretical and the empirical approach .    in sec .",
    "[ sec : svm ] , we used a supervised machine learning algorithm , svm , to verify the empirical demarcation line between star - forming galaxies and agns defined by @xcite .",
    "even though we used only extreme starburst galaxies and strong agns to train the algorithm , svm yielded a result very similar to the analytical segregation curve , only about 6  per  cent of galaxies in the bottom corner of the bpt diagram got classified differently . a future application to svm",
    "would be to revisit the seyfert / liner separation as it was done in @xcite .    finally , in sec .",
    "[ sec : recipe ] , we gave a very simple recipe to generate random emission lines with realistic ews on top of stellar continua generated by stellar population synthesis modes .",
    "we have demonstrated that , despite its simplicity , the method can qualitatively reconstruct the bpt .",
    "our model has its application when the objective is not the accurate modelling of the emission lines of individual galaxies but rather generating stochastic mock catalogues with more realistic broad - band magnitudes .",
    "the realization of this work was supported by the hungarian otka nn grants 103244 and 114560 ."
  ],
  "abstract_text": [
    "<S> we analyse the correlations between continuum properties and emission line equivalent widths of star - forming and active galaxies from the sloan digital sky survey . </S>",
    "<S> since upcoming large sky surveys will make broad - band observations only , including strong emission lines into theoretical modelling of spectra will be essential to estimate physical properties of photometric galaxies . </S>",
    "<S> we show that emission line equivalent widths can be fairly well reconstructed from the stellar continuum using local multiple linear regression in the continuum principal component analysis ( pca ) space . </S>",
    "<S> line reconstruction is good for star - forming galaxies and reasonable for galaxies with active nuclei . </S>",
    "<S> we propose a practical method to combine stellar population synthesis models with empirical modelling of emission lines . </S>",
    "<S> the technique will help generate more accurate model spectra and mock catalogues of galaxies to fit observations of the new surveys . </S>",
    "<S> more accurate modelling of emission lines is also expected to improve template - based photometric redshift estimation methods . </S>",
    "<S> we also show that , by combining pca coefficients from the pure continuum and the emission lines , automatic distinction between hosts of weak active galactic nuclei ( agns ) and quiescent star - forming galaxies can be made . </S>",
    "<S> the classification method is based on a training set consisting of high - confidence starburst galaxies and agns , and allows for the similar separation of active and star - forming galaxies as the empirical curve found by kauffmann et al . </S>",
    "<S> we demonstrate the use of three important machine learning algorithms in the paper : @xmath0-nearest neighbour finding , @xmath0-means clustering and support vector machines    [ firstpage ]    methods : data analysis  galaxies : active  galaxies : starburst  galaxies : stellar content . </S>"
  ]
}