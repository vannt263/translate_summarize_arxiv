{
  "article_text": [
    "in a constraint satisfaction problem ( csp ) the question is to decide whether or not it is possible to satisfy a given set of constraints .",
    "constraints are often represented by specifying a relation , which is a set of allowed combinations of values some variables can take simultaneously .",
    "if the constraints allowed in a problem have to come from some set @xmath0 of relations , such a restricted problem is referred to as a _ nonuniform csp _ and denoted @xmath1 .",
    "the set @xmath0 is then called a _",
    "constraint language_. nonuniform csps not only provide a powerful framework ubiquitous across a wide range of disciplines from theoretical computer science to computer vision , but also admit natural and elegant reformulations such as the homomorphism problem and a characterization as the class of problems equivalent to a logic class mmsnp .",
    "many different versions of the csp have been studied across various fields .",
    "these include csps over infinite sets , counting csps ( and related holant problem and the problem of computing partition functions ) , several variants of optimization csps , valued csps , quantified csps , and numerous related problems .",
    "the reader is referred to the recent book @xcite for a survey of the state - of - the art in some of these areas . in this paper",
    "we , however , focus on the decision nonuniform csp and its complexity .",
    "a systematic study of the complexity of nonuniform csps was started by schaefer in 1978 @xcite who showed that for every constraint language @xmath0 over a 2-element set the problem @xmath1 is either solvable in polynomial time or is np - complete .",
    "schaefer also asked about the complexity of @xmath1 for languages over larger sets .",
    "the next step in the study of nonuniform csps was made in the seminal paper by feder and vardi @xcite , who apart from considering numerous aspects of the problem , posed the _ dichotomy conjecture _ that states that for every finite constraint language @xmath0 over a finite set the problem @xmath1 is either solvable in polynomial time or is np - complete .",
    "this conjecture has become a focal point of the csp research and most of the effort in this area revolves to some extent around the dichotomy conjecture .    the complexity of the csp in general and the dichotomy conjecture in particular has been studied by several research communities using a variety of methods , each contributing an important aspect of the problem .",
    "the csp has been an established area in artificial intelligence for decades , and apart from developing efficient general methods of solving csps researchers tried to identify tractable fragments of the problem @xcite .",
    "the very important special case of the csp , the ( di)graph homomorphism problem and the @xmath2-coloring problem have been actively studied in the graph theory community , see , e.g.  @xcite and subsequent works by hell , feder , bang - jensen , rafiey and others .",
    "homomorphism duality introduced in these works has been very useful in understanding the structure of constraint problems .",
    "the csp plays a major role and has been successfully studied in database theory , logic and model theory @xcite , although the version of the problem mostly used there is not necessarily nonuniform .",
    "logic games and strategies are a standard tool in most of csp algorithms .",
    "an interesting approach to the dichotomy conjecture through long codes was suggested by kun and szegedy @xcite .",
    "brown - cohen and raghavendra proposed to study the conjecture using techniques based on decay of correlations @xcite . in this paper",
    "we use the algebraic structure of the csp , which is briefly discussed next .    the most effective approach to the study of the csp turned out to be the _ algebraic approach _ that associates every constraint language with its ( universal ) algebra of polymorphisms .",
    "the method was first developed in a series of papers by jeavons and coauthors @xcite and then refined by bulatov , krokhin , barto , kozik , maroti , zhuk and others @xcite .",
    "while the complexity of @xmath1 has been already solved for some interesting classes of structures such as graphs @xcite , the algebraic approach allowed the researchers to confirm the dichotomy conjecture in a number of more general cases : for languages over a set of size up to 7 @xcite , so called conservative languages @xcite , and some classes of digraphs @xcite .",
    "it also allowed to design the main classes of csp algorithms @xcite , and refine the exact complexity of the csp @xcite .    in this paper",
    "we confirm the dichotomy conjecture for arbitrary languages over finite sets .",
    "more precisely we prove the following    [ the : main ] for any finite constraint language @xmath0 over a finite set the problem @xmath1 is either solvable in polynomial time or is np - complete .",
    "the proved criterion matches the algebraic form of the dichotomy conjecture suggested in @xcite .",
    "the hardness part of the conjecture has been known for long time .",
    "therefore the main achievement of this paper is a polynomial time algorithm for problems satisfying the tractability condition .",
    "more specifically , we suggest such an algorithm for languages that contain all the constant relations of the form @xmath3 , and this implies a general dichotomy due to the results of @xcite .    using the algebraic language we can state the result in a stronger form .",
    "let @xmath4 be a finite idempotent algebra and let @xmath5 denote the union of problems @xmath1 such that every term operation of @xmath4 is a polymorphism of @xmath0 .",
    "problem @xmath5 is no longer a nonuniform csp , and theorem  [ the : main ] allows for problems @xmath6 to have different solution algorithms even when @xmath4 meets the tractability condition .",
    "we show that the solution algorithm only depends on the algebra @xmath4 .",
    "[ the : main2 ] for a finite idempotent algebra that satisfies the conditions of the dichotomy conjecture there is a uniform solution algorithm for @xmath5 .",
    "an interesting question arising from theorems  [ the : main],[the : main2 ] is known as the _ meta - problem _ : given a constraint language or a finite algebra , decide whether or not it satisfies the conditions of the theorems .",
    "the answer to this question is not quite trivial , for a thorough study of the meta - problem see @xcite .",
    "the paper consists of two parts .",
    "the first part of the paper aims at a self - contained introduction into the main ideas of the solution algorithm .",
    "the second part mostly concerns with further development of the algebraic approach and technical proofs of the results , and is significantly more involved .",
    "we start with introducing the terminology and notation for csps that is used throughout the paper and reminding the basics of the algebraic approach .",
    "then in section  [ sec : separation - central ] we introduce the key ingredients used in the algorithm : separating congruences and quasi - centralizer .",
    "then in section  [ sec : algorithm1 ] we apply these concepts to csps , first , to demonstrate how quasi - centralizers help to decompose an instance into smaller subinstances , and , second , to introduce a new kind of minimality condition for csps , _",
    "block minimality_. after that we state the main results used by the algorithm and describe the algorithm itself .",
    "we complete the first part by introducing the main technical construction to give an idea of why the algorithm works .",
    "[ part : outline ]",
    "for a detailed introduction to csp and the algebraic approach to its structure the reader is referred to a very recent and very nice survey by barto et al.@xcite .",
    "basics of universal algebra can be learned from the textbook @xcite . in preliminaries to this paper we therefore focus on what is needed for our result .",
    "the ` combinatorial ' formulation of the csp best fits our purpose .",
    "fix a finite set @xmath7 and let @xmath0 be a _ constraint language _ over @xmath7 , that is , a set  not necessarily finite  of relations over @xmath7 .",
    "the ( _ nonuniform _ ) _ constraint satisfaction problem _ ( _ csp _ ) associated with language @xmath0 is the problem @xmath1 , in which , an _ instance _ is a pair @xmath8 , where @xmath9 is a set of variables ; and @xmath10 is a set of _ constraints _ , i.e.  pairs @xmath11 , where @xmath12 is a tuple of variables from @xmath9 , the _ constraint scope _ , and @xmath13 , the @xmath14-ary _ constraint relation_. we always assume that relations are given explicitly by a list of tuples .",
    "the way constraints are represented does not matter if @xmath0 is finite , of course , but it may change the complexity of the problems for infinite languages . the goal is to find a _ solution _ , that is a mapping @xmath15 such that for every constraint @xmath11 , @xmath16 .",
    "we will often use the set of solutions of a csp instance @xmath17 or its subproblems ( to be defined later ) , viewed either as a @xmath18-ary relation or as a set of mappings @xmath15 .",
    "it will be denoted by @xmath19 , or just @xmath20 if @xmath21 is clear from the context .",
    "jeavons et al .  in @xcite",
    "were the first to observe that higher order symmetries of constraint languages called polymorphisms play a significant role in the study of the complexity of the csp .",
    "a _ polymorphism _ of a relation @xmath22 over @xmath7 is an operation @xmath23 on @xmath7 such that for any choice of @xmath24 we have @xmath25 .",
    "if this is the case we also say that @xmath26 _ preserves _",
    "@xmath22 , or that @xmath22 is _ invariant _ with respect to @xmath26 .",
    "a polymorphism of a constraint language @xmath0 is an operation that is a polymorphism of every @xmath13 .",
    "[ the : algebra - csp ] for constraint languages @xmath27 , where @xmath0 is finite , if every polymorphism of @xmath28 is also a polymorphism of @xmath0 , then @xmath1 is polynomial time reducible to @xmath29 .",
    "( in fact , this can be improved to a log - space reduction . )",
    "listed below are the several types of polymorphisms that occur frequently throughout the paper .",
    "the presence of each of these polymorphisms imposes restrictions on the structure of invariant relations that can be used in designing a solution algorithm .",
    "some of such results we will mention later . + ",
    "_ semilattice _ operation is a binary operation @xmath30 such that @xmath31 , @xmath32 , and @xmath33 for all @xmath34 ; +  @xmath14-ary _ near - unanimity _ operation is a @xmath14-ary operation @xmath35 such that @xmath36 for all @xmath37 ; a ternary near - unanimity operation @xmath38 is said to be a _ majority _ operation , it satisfies the equations @xmath39 ; +  _ maltsev _ operation is a ternary operation @xmath40 satisfying the equations @xmath41 for all @xmath37 ; the _ affine _ operation @xmath42 of an abelian group is a special case of maltsev operations ; +  @xmath14-ary _ weak near - unanimity _ operation is a @xmath14-ary operation @xmath43 that satisfies the same equations as a near - unanimity operations @xmath44 , except for the last one .",
    "the next step in discovering more structure behind nonuniform csps has been made in @xcite , in which universal algebras were brought into the picture .",
    "a _ ( universal ) algebra _ is a pair @xmath45 consisting of a set @xmath7 , the _ universe _ of @xmath4 , and a set @xmath46 of operations on @xmath7 .",
    "operations from @xmath46 together with operations that can be obtained from them by means of composition are called the _ term _ operations of @xmath4 .",
    "algebras allow for a more general definition of csps that is used here .",
    "let @xmath5 denote the class of nonuniform csps @xmath47 , where @xmath48 denotes the set of all relations invariant with respect to all operations from @xmath46 .",
    "note that the tractability of @xmath5 can be understood in two ways : as the existence of a polynomial - time algorithm for every @xmath1 from this class , or as the existence of a uniform polynomial - time algorithm for all such problems .",
    "one of the implications of our results is that these two types of tractability are equivalent . from the formal standpoint we will use the stronger one .",
    "the main structural elements are subalgebras , congruences , and quotient algebras . for @xmath49 and",
    "an operation @xmath26 on @xmath7 by @xmath50 we denote the restriction of @xmath26 on @xmath51 .",
    "algebra @xmath52 is called a _ subalgebra _ of @xmath4 if @xmath53 for any @xmath54 and any @xmath55 .",
    "congruences play a very significant role in our algorithm , and we discuss them in more details .",
    "a _ congruence _ is an equivalence relation @xmath56 .",
    "this means that for any operation @xmath55 and any @xmath57 it holds @xmath58 .",
    "therefore it is possible to define an algebra on @xmath59 , the set of @xmath60-blocks , by setting @xmath61 for @xmath62 , where @xmath63 denotes the @xmath60-block containing @xmath64 .",
    "the resulting algebra @xmath65 is called the _",
    "quotient algebra modulo _ @xmath60 .",
    "the following are examples of congruences and quotient algebras .",
    "+  let @xmath4 be any algebra .",
    "then the equality relation @xmath66 and the full binary relation @xmath67 on @xmath4 are congruences of @xmath4 .",
    "the quotient algebra @xmath68 is @xmath4 itself , while @xmath69 is a 1-element algebra .",
    "+  let @xmath70 be the permutation group on an @xmath71-element set and binary relation @xmath60 is given by : @xmath72 for @xmath73 if and only if @xmath64 and @xmath74 have the same parity as permutations .",
    "then @xmath60 is a congruence of @xmath70 and @xmath75 is the 2-element group .",
    "+  let @xmath76 be an @xmath71-dimensional vector space and @xmath77 its @xmath14-dimensional subspace .",
    "the binary relation @xmath78 given by : @xmath79 if and only if @xmath80 have the same orthogonal projection on @xmath77 , is a congruence of @xmath76 and @xmath81 is @xmath77 .",
    "the ( ordered ) set of all congruences of @xmath4 is denoted by @xmath82 .",
    "this set is actually a lattice . by @xmath83",
    "we denote the set of all quotient algebras of all subalgebras of @xmath4 .",
    "the results of @xcite reduce the dichotomy conjecture to idempotent algebras .",
    "an algebra @xmath45 is said to be _ idempotent _ if every operation @xmath55 satisfies the equation @xmath84 . if @xmath4 is idempotent , then all the constant relations @xmath3 are invariant under @xmath46 . therefore studying csps over idempotent algebras",
    "is the same as studying the csps that allow all constant relations .",
    "another useful property of idempotent algebras is that every block of every its congruence is a subalgebra .",
    "we now can state the algebraic version of the dichotomy theorem .",
    "[ the : algebra - dichot - p1 ] for a finite idempotent algebra @xmath4 the following are equivalent : + ( 1 ) @xmath5 is solvable in polynomial time ; + ( 2 ) @xmath4 has a weak near - unanimity term operation ; + ( 3 ) every algebra from @xmath83 has a nontrivial term operation ( that is not a _ projection _ , an operation of the form @xmath85 ) ; + otherwise @xmath5 is np - complete .    the hardness part of this theorem is proved in @xcite ;",
    "the equivalence of ( 2 ) and ( 3 ) was proved in @xcite and @xcite .",
    "the equivalence of ( 1 ) to ( 2 ) and ( 3 ) is the main result of this paper . in the rest of the paper",
    "we assume all algebras to satisfy conditions ( 2),(3 ) .      leaving aside occasional combinations thereof",
    ", there are only two standard types of algorithms solving the csp . in this section",
    "we give a brief introduction into them .",
    "[ [ csps - of - bounded - width . ] ] csps of bounded width .",
    "+ + + + + + + + + + + + + + + + + + + + + +    algorithms of the first kind are based on the idea of local propagation , that is formally described below . by @xmath86 $ ]",
    "we denote the set @xmath87 . for sets @xmath88 tuples from @xmath89",
    "are denoted in boldface , say , @xmath90 ; the @xmath91th component of @xmath90 is referred to as @xmath92 $ ] .",
    "an @xmath71-ary relation @xmath22 over sets @xmath88 is any subset of @xmath89 . for @xmath93",
    "$ ] by @xmath94 we denote the _ projections _",
    "@xmath95\\zd\\ba[i_k])$ ] , @xmath96 of tuple @xmath90 and relation @xmath22 .",
    "if @xmath97 for each @xmath98 $ ] , relation @xmath22 is said to be a _",
    "subdirect product _ of @xmath89 .",
    "let @xmath17 be a csp instance .",
    "for @xmath99 by @xmath100 we denote the _ restriction _ of @xmath21 onto @xmath101 , that is , the instance @xmath102 , where for each @xmath103 , the set @xmath104 includes the constraint @xmath105 .",
    "the set of solutions of @xmath100 will be denoted by @xmath106 .",
    "unary solutions , that is , when @xmath107 play a special role .",
    "as is easily seen , for @xmath108 the set @xmath109 is just the intersections of unary projections @xmath110 of constraints whose scope contains @xmath111 .",
    "one may always assume that allowed values for a variable @xmath108 is the set @xmath109 .",
    "we call this set the _ domain _ of @xmath111 and assume that csp instances may have different domains , which nevertheless are always subalgebras or quotient algebras of the original algebra @xmath4",
    ". it will be convenient to denote the domain of @xmath111 by @xmath112 .",
    "the domain @xmath112 may change as a result of transformations of the instance .",
    "instance @xmath21 is said to be _",
    "1-minimal _ if for every @xmath108 and every constraint @xmath103 such that @xmath113 , it holds @xmath114 .",
    "instance @xmath21 is said to be _ ( 2,3)-consistent _ if it has a _",
    "( 2,3)-strategy _ , that is , a collection of relations @xmath115 , @xmath116 , @xmath117 satisfying the following conditions : +  for every @xmath116 with @xmath118 and every @xmath119 , @xmath120 ; +  for every @xmath121 , any @xmath122 , and any @xmath123 , there is @xmath124 such that @xmath125 and @xmath126 .",
    "+ we will always assume that a ( 2,3)-consistent instance has a constraint @xmath127 for every @xmath116 , @xmath117",
    ". then clearly @xmath128 .",
    "let the collection of relations @xmath115 be denoted by @xmath129 .",
    "a tuple @xmath90 whose entries are indexed with elements of @xmath99 and such that @xmath130 for any @xmath131 , @xmath117 , will be called _",
    "@xmath129-compatible_. if a ( 2,3)-consistent instance @xmath21 with a ( 2,3)-strategy @xmath129 satisfies the additional condition +  for every constraint @xmath119 of @xmath21 every tuple @xmath132 is @xmath129-compatible , + it is called _",
    "( 2,3)-minimal_. for @xmath133 , @xmath134-strategies , @xmath134-consistency , and @xmath134-minimality are defined in a similar way replacing 2,3 with @xmath135 .",
    "instance @xmath21 is said to be _ minimal _ ( or _ globally minimal _ ) if for every @xmath103 and every @xmath132 there is a solution @xmath136 such that @xmath137 .",
    "any instance can be transformed to a 1-minimal , ( 2,3)-consistent , or ( 2,3)-minimal instance in polynomial time using the standard constraint propagation algorithms ( see , e.g.   @xcite )",
    ". these algorithms work by changing the constraint relations and the domains of the variables eliminating some tuples and elements from them .",
    "we call such a process _ tightening _ the instance .",
    "it is important to notice that if the original instance belongs to @xmath5 for some algebra @xmath4 , that is , all its constraint relations are invariant under the term operations of @xmath4 , the constraint relations obtained by propagation algorithms are also invariant under term operations of @xmath4 , and so the resulting instance also belongs to @xmath5 . establishing minimality amounts to solving the problem and",
    "therefore not always can be easily done .",
    "if a constraint propagation algorithm solves a csp , the problem is said to be of bounded width .",
    "more precisely , @xmath1 ( or @xmath5 ) is said to have _ bounded width _",
    "if for some @xmath14 every @xmath134-minimal instance from @xmath1 ( or @xmath5 ) has a solution .",
    "problems of bounded width are very well studied , see the older survey @xcite and a more recent paper @xcite .",
    "[ @xcite][the : bounded - width - p1 ] for an idempotent algebra @xmath4 the following are equivalent : + ( 1 ) @xmath5 has bounded width ; + ( 2 ) every ( 2,3)-minimal instance from @xmath5 has a solution ; + ( 3 ) @xmath4 has a weak near - unanimity term of arity @xmath14 for every @xmath138 ; + ( 4 ) every algebra @xmath83 has a nontrivial operation , and none of them is equivalent to a module .    [ [ omitting - semilattice - edges - and - the - few - subpowers - property . ] ] omitting semilattice edges and the few subpowers property .",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    the second type of csp algorithms can be viewed as a generalization of gaussian elimination , although , it utilizes just one property also used by gaussian elimination : the set of solutions of a system of linear equations or a csp has a set of generators of size linear in the number of variables .",
    "the property that for every instance @xmath21 of @xmath5 its solution space @xmath19 has a set of generators of polynomial size is nontrivial , because there are only exponentially many such sets , while , as is easily seen csps with @xmath71 variables may have up to double exponentially many different sets of solutions .",
    "formally , an algebra @xmath45 has _",
    "few subpowers _ if for every @xmath71 there are only exponentially many @xmath71-ary relations in @xmath48 .",
    "algebras with few subpowers are well studied , completely characterized , and the csp over such an algebra has a polynomial - time solution algorithm , see , @xcite . in particular , such algebras admit a characterization in terms of the existence of a term operation with special properties , an _ edge _ term .",
    "we however need only a subclass of algebras with few subpowers that appeared in @xcite and is defined as follows .",
    "a pair of elements @xmath139 is said to be a _",
    "semilattice edge _ if there is a binary term operation @xmath26 of @xmath4 such that @xmath140 and @xmath141 , that is , @xmath26 is a semilattice operation on @xmath142 .",
    "[ pro : semilattice - edges - p1 ] if an idempotent algebra @xmath4 has no semilattice edges , it has few subpowers , and therefore @xmath5 is solvable in polynomial time .",
    "semilattice edges have other useful properties including the following one that we use for reducing a csp to smaller problems .",
    "[ lem : multiplication - p1 ] for any idempotent algebra @xmath4 there is a binary term operation @xmath143 of @xmath4 ( think multiplication ) such that @xmath143 is a semilattice operation on any semilattice edge and for any @xmath139 either @xmath144 or @xmath145 is a semilattice edge .",
    "in this section we introduce two of the key ingredients of the algorithm .    [ [ separating - congruences . ] ] separating congruences .",
    "+ + + + + + + + + + + + + + + + + + + + + + +    unlike the vast majority of the literature on the algebraic approach to the csp we use not only term operations , but also polynomial operations of an algebra .",
    "it should be noted however that the first to use polynomials for csp algorithms was maroti in @xcite .",
    "we make use of some ideas from that paper in the next section .",
    "let @xmath146 be a @xmath147-ary term operation of an algebra @xmath4 and @xmath148 .",
    "the operation @xmath149 is called a _ polynomial _ of @xmath4",
    ". the name ` polynomial ' refers to usual polynomials .",
    "indeed , if @xmath4 is a ring , its polynomials as just defined are the same as polynomials in the regular sense .",
    "a polynomial that depends on only one variable is said to be a _",
    "unary _ polynomial .",
    "while polynomials of @xmath4 do not have to be polymorphisms of relations from @xmath48 , congruences and unary polynomials are in a special relationship .",
    "more precisely , an equivalence relation over @xmath4 is a congruence if and only if it is preserved by all the unary polynomials of @xmath4 .",
    "let @xmath4 be an algebra .",
    "for @xmath150 we write @xmath151 if @xmath152 and @xmath153 in @xmath82 implies @xmath154 or @xmath155 ;",
    "if this is the case we call @xmath156 a _ prime interval _ in @xmath82 .",
    "let @xmath151 and @xmath157 be prime intervals in @xmath82 .",
    "we say that @xmath151 can be _ separated _ from @xmath157 if there is a unary polynomial @xmath26 of @xmath4 such that @xmath158 , but @xmath159 .",
    "the polynomial @xmath26 in this case is said to _ separate _",
    "@xmath151 from @xmath157",
    ".    in a similar way separation can be defined for prime intervals in different coordinate positions of a relation .",
    "let @xmath22 be a subdirect product of @xmath160 .",
    "then @xmath22 is also an algebra and its polynomials can be defined in the same way .",
    "let @xmath161 $ ] and let @xmath151 , @xmath157 be prime intervals in @xmath162 and @xmath163 , respectively .",
    "interval @xmath151 can be separated from @xmath157 if there is a unary polynomial @xmath26 of @xmath22 such that @xmath158 but @xmath159 ( note that the actions of @xmath26 on @xmath164 are polynomials of those algebras ) .",
    "the binary relation ` can not be separated ' on the set of prime intervals of an algebra or factors of a relation is easily seen to be reflexive and transitive . under certain mild conditions",
    "it can also be shown to be symmetric in a certain sense ( lemma  [ lem : relative - symmetry ] ) , and so for the purpose of our algorithm it can be treated as an equivalence relation .    [ [ quasi - centralizers . ] ] quasi - centralizers .",
    "+ + + + + + + + + + + + + + + + + + +    the second ingredient introduced here is the notion of quasi - centralizer of a prime interval of congruences .",
    "it is similar to the centralizer as it is defined in commutator theory , albeit the exact relationship between the two concepts is not quite clear , and so we name differently for safety .    for an algebra @xmath4 ,",
    "a term operation @xmath165 , and @xmath166 , let @xmath167 .",
    "let @xmath150 , @xmath168 , and let @xmath169 denote the following binary relation : @xmath170 if an only if , for any term operation @xmath165 , any @xmath171 $ ] , and any @xmath172 such that @xmath92=a$ ] , @xmath173=b$ ] , and @xmath174=\\bb[j]$ ] for @xmath175 , it holds @xmath176 if and only if @xmath177 . the relation @xmath178 is always a congruence of @xmath4 ( lemma  [ lem : delta - properties ] ) and its effect on the structure of algebra @xmath4 is illustrated by the following statement .",
    "[ lem : centralizer - multiplication - p1 ] let @xmath179 , @xmath180 and @xmath181 .",
    "then @xmath182 .",
    "[ fig : central - p1](a),(b ) shows the effect of large quasi - centralizers on the structure of algebra @xmath4 .",
    "dots there represent @xmath183-blocks ( assume @xmath183 is the equality relation ) , ovals represent @xmath184-blocks , let they be @xmath51 and @xmath185 , and such that there is at least one semilattice edge between @xmath51 and @xmath185 .",
    "if @xmath178 is the full relation , lemmas  [ lem : multiplication - p1 ] and  [ lem : centralizer - multiplication - p1 ] imply that for any @xmath186 and any @xmath187 we have @xmath188 , and so @xmath189 is the only element of @xmath185 such that @xmath145 is a semilattice edge ( represented by arrows ) . in other words , we have a mapping that can also be shown injective from @xmath51 to @xmath185 .",
    "we will use this mapping to lift any solution with a value from @xmath51 to a solution with a value from @xmath185 .",
    "we have seen in the previous section that big centralizers impose strong restrictions on the structure of an algebra .",
    "we start this section showing that small centralizers restrict the structure of csps .",
    "[ [ decomposition - of - csps . ] ] decomposition of csps .",
    "+ + + + + + + + + + + + + + + + + + + + + +    let @xmath22 be a binary relation , a subdirect product of @xmath190 , and @xmath191 , @xmath192 .",
    "relation @xmath22 is said to be _",
    "@xmath193-aligned _ if , for any @xmath194 , @xmath195 if and only if @xmath196 .",
    "this means that if @xmath197 are the @xmath183-blocks of @xmath4 , then there are also @xmath14 @xmath198-blocks of @xmath199 and they can be labeled @xmath200 in such a way that @xmath201    [ lem : delta - alignment - p1 ] let @xmath202 be as above and @xmath150 , @xmath203 , with @xmath151 , @xmath157 .",
    "if @xmath156 and @xmath204 can not be separated , then @xmath22 is @xmath205-aligned .",
    "lemma  [ lem : delta - alignment - p1 ] provides a way to decompose csp instances .",
    "let @xmath17 be a ( 2,3)-minimal instance from @xmath5 , in particular , @xmath10 contains a constraint @xmath206 for every @xmath207 , and these relations form a ( 2,3)-strategy for @xmath21 . due to ( 2,3)-minimality the domain of variables from @xmath9",
    "do not have to be @xmath4 itself , but can be subalgebras of @xmath4 .",
    "recall that @xmath112 denotes the domain of @xmath108 .",
    "also , let @xmath99 and congruences @xmath208 for @xmath209 be such that @xmath210 , and for any @xmath211 the intervals @xmath212 and @xmath213 can not be separated in @xmath214 .    denoting @xmath215",
    "we see that there is a one - to - one correspondence between @xmath216 and @xmath217 blocks of @xmath112 and @xmath218 .",
    "moreover , by ( 2,3)-minimality these correspondences are consistent , that is , if @xmath219 and @xmath220 are @xmath221- , @xmath216- and @xmath217-blocks , respectively , such that @xmath222 and @xmath223 , then @xmath224 .",
    "this means that @xmath100 can be split into several instances , whose domains are @xmath216-blocks .",
    "[ lem : central - decomposition - p1 ] let @xmath225 be as above",
    ". then @xmath100 can be decomposed into a collection of instances @xmath226 , @xmath227 such that every solution of @xmath100 is a solution of one of the @xmath228 and for every @xmath108 its domain in @xmath228 is a @xmath216-block .",
    "[ [ irreducibility . ] ] irreducibility .",
    "+ + + + + + + + + + + + + + +    in order to formulate the algorithm properly we need one more transformation of algebras . an algebra @xmath4 is said to be _ subdirectly irreducible _ if the intersection of all its nontrivial ( different from the equality relation ) congruences is nontrivial .",
    "this smallest nontrivial congruence @xmath229 is called the _ monolith _ of @xmath4 , see fig .",
    "[ fig : central - p1](c ) .",
    "it is a folklore observation that any csp instance can be transformed in polynomial time to an instance , in which the domain of every variable is a subdirectly irreducible algebra .",
    "we will assume this property of all the instances we consider .",
    "[ [ block - minimality . ] ] block - minimality .",
    "+ + + + + + + + + + + + + + + + +    lemma  [ lem : central - decomposition - p1 ] allows one to establish a much stronger version of local consistency , block - minimality ; in fact , it is not local anymore .",
    "the definitions below are designed in such a way that to allow for an efficient procedure to establish block - minimality .",
    "this is achieved either by allowing for decomposing a subinstance into instances over smaller domains as in lemma  [ lem : central - decomposition - p1 ] , or by replacing large domains with their quotient algebras .",
    "let @xmath230 be a congruence of @xmath112 for each @xmath108 .",
    "by @xmath231 we denote the instance @xmath232 constructed as follows : the domain of @xmath108 is @xmath233 ; for every constraint @xmath103 , the set @xmath234 includes the constraint @xmath235 , where @xmath12 and @xmath236^{\\al_{v_1}}\\zd\\ba[v_k]^{\\al_{v_k } } ) \\mid \\ba\\in\\rel\\}$ ] .",
    "let @xmath17 be a ( 2,3)-minimal instance and @xmath237 , @xmath238 , @xmath108 , be a collection of congruences .",
    "let @xmath239 denote the set of triples @xmath240 such that @xmath108 , @xmath241 , and @xmath242 .",
    "also , @xmath243 denotes @xmath239 when @xmath244 is the full relation for all @xmath108 . we will omit the superscript @xmath21 whenever it is clear from the context .    for every @xmath245 ,",
    "let @xmath246 denote the set of variables @xmath247 such that @xmath156 and @xmath204 can not be separated in @xmath248 for some @xmath249 with @xmath250 .",
    "let @xmath251 ( and respectively @xmath252 ) denote the set of triples @xmath245 ( respectively , from @xmath253 ) , for which @xmath178 is the full relation .",
    "we say that algebra @xmath112 is _ semilattice free _ if it does not contain semilattice edges .",
    "let @xmath254 denote the maximal size of domains of @xmath21 that are not semilattice free and @xmath255 be the set of variables @xmath108 such that @xmath256 and @xmath112 is not semilattice free .",
    "for an instance @xmath21 we say that an instance @xmath257 is _ strictly smaller _ than instance @xmath21 if @xmath258 . for @xmath259 let @xmath260 if @xmath261 and @xmath262 otherwise .",
    "instance @xmath21 is said to be _ block - minimal _ if for every @xmath263 ( here @xmath264 , @xmath108 ) the following conditions hold :    * for every @xmath103 the problem @xmath265 if @xmath266 , and the problem @xmath267 otherwise , where @xmath268 , is minimal ; * if @xmath269 , then for every @xmath270 the problem @xmath267 , where @xmath271 is minimal .",
    "observe that @xmath246 can be large , even equal to @xmath9 .",
    "however if @xmath266 by lemma  [ lem : central - decomposition - p1 ] the problem @xmath265 splits into a union of disjoint problems over smaller domains , and so its minimality can be established by recursing to strictly smaller problems . on the other hand , if @xmath269 then @xmath265 may not be decomposable .",
    "since we need an efficient procedure of establishing block - minimality , this explains the complications introduced in ( bm1),(bm2 ) . in the first case",
    "@xmath267 can be solved for each tuple @xmath132 .",
    "taking the quotient algebras of the domains guarantees that we recurse to strictly smaller instances . in the second case",
    "@xmath272 is decomposable , and we branch on those strictly smaller subproblems .",
    "[ lem : to - block - minimality - p1 ] let @xmath17 be a ( 2,3)-minimal instance .",
    "then @xmath21 can be transformed to an equivalent block - minimal instance @xmath257 by solving a quadratic number of strictly smaller csps .",
    "[ [ the - algorithm . ] ] the algorithm .",
    "+ + + + + + + + + + + + + +    in the algorithm we distinguish three cases depending on semilattice edges and quasi - centralizers of the domains of variables . in each case",
    "we employ different methods of solving or reducing the instance to a strictly smaller one .",
    "let @xmath17 be a subdirectly irreducible ( 2,3)-minimal instance .",
    "let @xmath273 denote the set of variables @xmath108 such that @xmath274 .",
    "let @xmath275 if @xmath276 and @xmath277 otherwise .",
    "_ semilattice free domains . _",
    "if no domain of @xmath21 contains a semilattice edge then by proposition  [ pro : semilattice - edges - p1 ] @xmath21 can be solved in polynomial time , using the few subpowers algorithm , as shown in @xcite .",
    "_ trivial centralizers . _",
    "if @xmath277 for all @xmath108 , block - minimality guarantees the existence of a solution , and we can use lemma  [ lem : to - block - minimality - p1 ] to solve the instance .",
    "[ the : non - central - p1 ] if @xmath21 is subdirectly irreducible , ( 2,3)-minimal , block - minimal , and @xmath278 , then @xmath21 has a solution .    _",
    "nontrivial centralizers .",
    "_ suppose that @xmath279 .",
    "in this case we consider the problem @xmath280 . for this problem",
    "either @xmath281 , or @xmath282 ; in either case it can be solved by the previous case or by recursion to a strictly smaller problem .",
    "we find a solution @xmath283 of @xmath280 satisfying the following conditions . for every @xmath108 such that @xmath112 is not semilattice free there is @xmath284 such that @xmath285 is a semilattice edge if @xmath277 , or , if @xmath275 , there is @xmath286 such that @xmath142 is a semilattice edge .",
    "then we apply the transformation of @xmath21 suggested by maroti in @xcite . by @xmath287",
    "we denote the instance @xmath288 given by the rule : for every @xmath289 the set @xmath290 contains a constraint @xmath291 .",
    "to construct @xmath292 choose a tuple @xmath293 such that @xmath294^{\\mu^*_v}=\\vf(v)$ ] for all @xmath113 ; this is possible because @xmath283 is a solution of @xmath280 .",
    "then set @xmath295 . by the results of @xcite and",
    "lemma  [ lem : centralizer - multiplication - p1 ] the instance @xmath287 has a solution if and only if @xmath21 does and @xmath296 .",
    "[ the : central - p1 ] if @xmath280 is 1-minimal , then @xmath21 can be reduced in polynomial time to a strictly smaller instance .",
    "a csp instance @xmath17 from @xmath5 a solution of @xmath21 if one exists , ` no ' otherwise solve @xmath21 using the few subpowers algorithm and return the answer transform @xmath21 to a subdirectly irreducible , block - minimal and ( 2,3)-minimal instance @xmath275 for @xmath276 and @xmath277 otherwise @xmath297 _",
    "/ * check the 1-minimality of @xmath298 _",
    "@xmath299  _ / * add a constraint @xmath300 fixing the value of @xmath111 to @xmath64 _ transform @xmath257 to a subdirectly irreducible , ( 2,3)-minimal instance @xmath301 if @xmath302 call solvecsp on @xmath301 and flag @xmath64 if @xmath301 has no solution establish block - minimality of @xmath301 ; if the problem changes , return to step  10 if the resulting instance is empty , flag the element @xmath64 if there are flagged values , tighten the instance by removing the flagged elements and start over use theorem  [ the : central - p1 ] to reduce @xmath21 to an instance @xmath257 with @xmath258 call solvecsp on @xmath257 and return the answer    [ [ comments - on - the - algorithm . ] ] comments on the algorithm .",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + +    using lemma  [ lem : to - block - minimality - p1 ] and theorems  [ the : non - central - p1],[the : central - p1 ] it is not difficult to see that the algorithm runs in polynomial time .",
    "indeed , every time it makes a recursive call it calls on a problem whose non - semilattice free domains have strictly smaller size , and therefore the depth of recursion is bounded by @xmath303 if we are dealing with @xmath5 .    in order to prove theorem  [ the : non - central - p1 ] we introduce @xmath304-strategies that are somewhat similar to ( 2,3)-strategies in the sense that they are also collections of relations defined through some sort of minimality condition and are consistent .",
    "we show how such constructions can be used to prove theorem  [ the : non - central - p1 ] .",
    "let @xmath17 be a subdirectly irreducible , ( 2,3)-minimal and block - minimal instance .",
    "let @xmath112 denote the domain of @xmath108 .",
    "also , let @xmath238 and @xmath305 a @xmath244-block .",
    "let @xmath129 be a collection of relations @xmath306 for every @xmath103 , @xmath245 and such that @xmath307 is its set of coordinate positions .",
    "similar to ( 2,3)-minimality a tuple @xmath308 for some @xmath116 , is called _ @xmath129-compatible _ if for any @xmath309 and @xmath245 it holds @xmath310 , where @xmath311 .",
    "collection @xmath129 is said to be a _",
    "@xmath304-strategy _ with respect to @xmath312 if the following conditions hold for every @xmath103 and @xmath245 ( let @xmath313)-strategy has to satisfy .",
    "a complete and precise list of conditions can be found in section  [ sec : strategies ] or @xcite . ] :    * the relations @xmath314 , where @xmath314 consists of @xmath129-compatible tuples from @xmath115 for @xmath116 , @xmath315 , form a nonempty @xmath316-strategy for @xmath21 ; * for every @xmath317 ( let @xmath318 ) and every @xmath319 it holds : if @xmath320 then @xmath90 extends to an @xmath129-compatible solution of @xmath321 ; otherwise if @xmath266 then @xmath90 extends to an @xmath129-compatible solution of @xmath322 with @xmath323 ; and if @xmath269 then @xmath90 extends to an @xmath129-compatible solution of @xmath324 , where @xmath325 ; * @xmath326 and for any @xmath327 any @xmath129-compatible tuple @xmath328 extends to an @xmath129-compatible tuple @xmath293 .",
    "let @xmath21 be a block - minimal instance , @xmath264 and @xmath329 for @xmath108 .",
    "then as it is not hard to see the collection of relations @xmath330 given by @xmath331 for @xmath103 is a @xmath304-strategy with respect to @xmath332 . also , by ( s3 ) a @xmath333-strategy with @xmath334 gives a solution of @xmath21 .",
    "our goal is therefore to show that a @xmath304-strategy for any @xmath304 can be ` reduced ' , that is , transformed to a @xmath335-strategy for some @xmath336 .",
    "note that this reduction of strategies is where the condition @xmath278 is used . indeed , suppose that @xmath337 .",
    "then by conditions ( s1)(s3 ) we only have information about solutions to problems of the form @xmath338 or something very close to that . therefore this barrier can not be penetrated .",
    "[ part : technicalities ]    we start this part with preliminaries , where apart from additional definitions and notation , we remind some of the results of @xcite related to colored graphs of algebras and relational structures and also some of their properties . in sections",
    "[ sec : maximality][sec : rectangularity ] we advance these results a little further . then in section",
    "[ sec : polynomials - maximality ] we introduce in a more detailed way the method of separating factors in congruence lattices using polynomial operations of the algebra .",
    "this method constitutes the basis for our algorithm .",
    "some preliminary versions of this approach can be found in @xcite . in section  [ sec : centralizer ] we introduce again and study the quasi - centralizer operator on congruence lattices that is similar to the well studied centralizer operator , although the precise relationship between the two is not quite clear . in particular",
    ", it allows to split certain csps into smaller ones . in sections  [ sec : congruence ] and  [ sec : chaining ] we prove two important technical results    in section  [ sec : maximal - solutions ] we give a description of the algorithm , and prove its running time and partially soundness . in very broad strokes the algorithm works as follows .",
    "if none of the domains of @xmath21 contains a semilattice edge in the sense of colored graphs of algebras , then @xmath21 can be solved by the few subpowers algorithm @xcite , as shown in @xcite .",
    "otherwise in most cases the problem can be solved by establishing _ block - minimality _ similar to that in @xcite .",
    "the problematic case when block - minimality does not provide a solution , or rather when it can not be established is roughly speaking when the domains of the instance have nontrivial centers in the sense of the commutator theory . in this case",
    "we show in section  [ sec : theorem-47 ] that a solution of a problem @xmath257 obtained from @xmath21 by replacing some of its domains with quotient algebras modulo their centers allows one to reduce the number of semilattice edges in those domains , and we can recurse to an instance with smaller domains .    the key ingredient of our result is presented in section  [ sec : strategies ] .",
    "there for block - minimal instances we introduce strategies that are in certain aspects similar to strategies used to solve problems of bounded width , but allow us to approach general csps",
    ". then in section  [ sec : affine - consistency ] we show , theorem  [ the : non - central ] , that if for a csp instance @xmath21 satisfying the block - minimality conditions such a strategy exists , one can improve ( tighten ) the strategy to obtain a solution of the quotient problem @xmath257 needed to reduce semilattice edges .",
    "this theorem is the most difficult and technically involved part of the proof .",
    "tightening of a strategy works by ( effectively ) reducing domains of the csp to a class of a maximal congruence , and then repeating the process as long as possible .",
    "the main cases of tightening considered are : when the interval formed by the maximal congruence used and the full congruence is abelian , and when it is non - abelian , sections  [ sec : type-2 ] and  [ sec : type - not-2 ] , respectively . in the two cases we use quite different transformations of the strategy . in the abelian case the argument is based on the rectangularity of relations understood in a general sense , while in the non - abelian case the transformation is similar to that used for bounded width csps in @xcite .",
    "we expand upon many of the definitions and notation given in part  [ part : outline ] . for the sake of convenience we also repeat some of the definitions given in part  [ part : outline ] .      we assume familiarity with the basics of universal algebra and the algebraic approach to the csp . for reference on universal algebra",
    "please use @xcite ; for the algebraic approach see the recent survey @xcite and earlier papers @xcite .    by @xmath86$][not :",
    "n ] we denote the set @xmath87 . for sets @xmath88 tuples from @xmath89",
    "are denoted in boldface , say , @xmath90 ; the @xmath91th component of @xmath90 is referred to as @xmath92$][not : bai ] .",
    "an @xmath71-ary relation @xmath22 over sets @xmath88 is any subset of @xmath89 . for @xmath93",
    "$ ] by @xmath94 we denote the _ projections _",
    "@xmath95\\zd\\ba[i_k])$ ] , @xmath96[not : pr ] of tuple @xmath90 and relation @xmath22 .",
    "if @xmath97 for each @xmath98 $ ] , relation @xmath22 is said to be a _",
    "subdirect product _ of @xmath89",
    ". it will be convenient to use @xmath339[not : ov - a ] for @xmath89 , or for @xmath340 if the sets @xmath9 and @xmath341 are clear from the context . for @xmath342 $ ] or @xmath343 we will use @xmath344[not : ov - a - i ] , for @xmath345 , or if @xmath346 is clear from the context just @xmath339 .",
    "algebras will be denoted by @xmath347 etc . ; we often do not distinguish between subuniverses and subalgebras .",
    "for @xmath348 the subalgebra generated by @xmath51 is denoted @xmath349[not : sg ] .",
    "for @xmath350 the congruence generated by @xmath185 is denoted @xmath351[not : cg ] .",
    "the equality relation and the full congruence of algebra @xmath4 are denoted @xmath66 and @xmath67[not : zz - zo ] , respectively .",
    "often when we need to use one of these trivial congruences of an algebra indexed in some way , say , @xmath352 , we write @xmath353 for @xmath354 .",
    "the set of all polynomials ( unary polynomials ) of @xmath4 is denoted by @xmath355 and @xmath356[not : pol ] , respectively .",
    "we frequently use operations on subalgebras of direct products of algebras , say , @xmath357 . if @xmath26 is such an operation ( say , @xmath14-ary ) then we denote its component - wise action also by @xmath26 , e.g.  @xmath358 for @xmath359 . in the same way we denote the action of @xmath26 on projections of @xmath22 , e.g.  @xmath360 for @xmath342 $ ] and @xmath361",
    "what we mean will always be clear from the context .",
    "we use similar agreements for collections of congruences . if @xmath362 then @xmath363[not : ov - alpha ] denotes the congruence @xmath364 of @xmath22 .",
    "if @xmath342 $ ] we use @xmath365[not : ov - alpha - i ] to denote @xmath366 . if it does not lead to a confusion we write @xmath363 for @xmath365 .",
    "sometimes @xmath367 are specified for @xmath91 from a certain set @xmath342 $ ] , then by @xmath363 we mean the congruence @xmath368}\\al'_i$ ] where @xmath369 if @xmath370 and @xmath371 is the equality relation otherwise .",
    "for example , if @xmath372 then @xmath373 means the factor of @xmath22 modulo @xmath374 .",
    "for @xmath150 we write @xmath151 if @xmath152 and @xmath153 in @xmath82 implies @xmath154 or @xmath155 . in this paper all algebras are finite , idempotent and omit type .",
    "the ( _ nonuniform _ ) _ constraint satisfaction problem _ ( _ csp _ ) associated with a relational structure @xmath375 is the problem @xmath376 , in which , given a structure @xmath377 of the same signature as @xmath375 , the goal is to decide whether or not there is a homomorphism from @xmath377 to @xmath375 . for a class of similar algebras @xmath378 for some set @xmath346 an _",
    "instance _ of @xmath379 is a triple @xmath380 , where @xmath9 is a set of variables ; @xmath381 is a _ type function _ that associates every variable with a _ domain _ in @xmath382 .",
    "finally , @xmath10 is a set of _ constraints _ , i.e.  pairs @xmath11[not : ang ] , where @xmath12 is a tuple of variables from @xmath9 , the _ constraint scope _ , and @xmath383 , a subset of @xmath384 , the _ constraint relation_. the goal is to find a _ solution _ , that is a mapping @xmath385 such that @xmath386 and for every constraint @xmath11 , @xmath16 .",
    "it is easy to see that if @xmath382 is a class containing just one algebra @xmath4 , then @xmath379 can be viewed as the union of @xmath387 for all relational structures @xmath377 invariant under the operations of @xmath4 . to simplify the notation we always write @xmath112 rather than @xmath388 ,",
    "because the mapping @xmath389 is always clear from the context .",
    "this also allows us to simplify the notation for instances to @xmath17[not : cp ] . to allow for transformations of csp described below",
    "we assume that @xmath382 is closed under taking subalgebras and quotient algebras .",
    "the set of solutions of a csp instance @xmath17 will be denoted by @xmath19[not : cs ] , or just @xmath20 if @xmath21 is clear from the context .",
    "for @xmath99 by @xmath100[not : cp - w ] we denote the _ restriction _ of @xmath21 onto @xmath101 , that is , the instance @xmath102 , where for each @xmath103 , the set @xmath104 includes the constraint @xmath105 .",
    "the set of solutions of @xmath100 will be denoted by @xmath106[not : cs - w ] . for @xmath108 and a subalgebra @xmath199 of @xmath112 by @xmath390[not : p - v - b ] we denote the instance @xmath21 with an extra constraint @xmath391 ; note that this is essentially equivalent to reducing the domain of @xmath111 , and this is how we usually consider this construction . for @xmath103 let @xmath392 be a subalgebra of @xmath22 and @xmath393 .",
    "the instance obtained from @xmath21 replacing @xmath185 with @xmath394 is denoted by @xmath395[not : c - to - c ] .",
    "the transformation of @xmath21 by reducing the domain of a variable @xmath108 or reducing a constraint @xmath309 , that is , transforming @xmath21 into @xmath390 or @xmath395 in such a way that the new instance has a solution if and only if @xmath21 does , will be called _ tightening _ of @xmath21 .",
    "let @xmath230 be a congruence of @xmath112 for each @xmath108 .",
    "by @xmath231[not : p - fac ] we denote the instance @xmath232 constructed as follows : the domain of @xmath108 is @xmath233 ; for every constraint @xmath103 , the set @xmath234 includes the constraint @xmath235 .",
    "note that if @xmath382 is closed under taking subalgebras and quotient algebras , then applying a transformation of one of these kinds to an instance from @xmath379 results again in an instance from @xmath379 .",
    "instance @xmath21 is said to be _ minimal _ ( or _ globally minimal _ ) if for every @xmath103 and every @xmath132 there is a solution @xmath136 such that @xmath137 .",
    "instance @xmath21 is said to be _",
    "1-minimal _ if for every @xmath108 and every constraint @xmath103 such that @xmath113 , @xmath396 .",
    "instance @xmath21 is said to be _",
    "( 2,3)-consistent _ if it has a _",
    "( 2,3)-strategy _ , that is , a collection of relations @xmath115[not : r - x ] , @xmath116 , @xmath117 satisfying the following conditions : +  for every @xmath116 with @xmath118 and any constraint @xmath119 , @xmath120 ; +  for every @xmath121 , any @xmath122 and any @xmath123 , there is @xmath124 such that @xmath125 and @xmath126 .",
    "+ we will always assume that a ( 2,3)-consistent instance has a constraint @xmath127 for every @xmath116 , @xmath117 .",
    "then clearly @xmath128 .",
    "let the collection of relations @xmath115 be denoted by @xmath129[not : cr ] .",
    "a tuple @xmath90 whose entries are indexed with elements of @xmath99 such that @xmath130 for any @xmath131 , @xmath117 , will be called _",
    "@xmath129-compatible_. if a ( 2,3)-consistent instance @xmath21 with a ( 2,3)-strategy @xmath129 satisfies the additional condition +  for every constraint @xmath119 of @xmath21 every tuple @xmath132 is @xmath129-compatible , + it is called _",
    "( 2,3)-minimal_. any instance can be transformed to a 1-minimal , ( 2,3)-consistent , or ( 2,3)-minimal instance in polynomial time using the standard constraint propagation algorithms ( see , e.g.  @xcite or @xcite ) .",
    "these algorithms tighten the instance .",
    "we will use the following basic facts from the tame congruence theory @xcite , often without further notice .",
    "let @xmath4 be a finite algebra and @xmath150 with @xmath151 .",
    "@xmath156-minimal set _ is a set minimal with respect to inclusion among the sets of the form @xmath397 , where @xmath398 is such that @xmath158 .",
    "sets @xmath399 are said to be _ polynomially isomorphic _ in @xmath4 if there are @xmath400 such that @xmath401 , @xmath402 , and @xmath403 are identity mappings on @xmath185 and @xmath51 , respectively .",
    "[ lem : minimal - sets ] let @xmath150 , @xmath151 . then the following hold .",
    "+ ( 1 ) any @xmath156-minimal sets @xmath404 are polynomially isomorphic .",
    "+ ( 2 ) for any @xmath156-minimal set @xmath405 and any @xmath398 , if @xmath406 then @xmath407 is an @xmath156-minimal set , @xmath405 and @xmath407 are polynomially isomorphic , and @xmath26 witnesses this fact . + ( 3 ) for any @xmath156-minimal set @xmath405 there is @xmath398 such that @xmath408 , @xmath158 , and @xmath26 is idempotent , in particular , @xmath26 is the identity mapping on @xmath405 .",
    "+ ( 4 ) for any @xmath409 and an @xmath156-minimal set @xmath405 there is @xmath398 such that @xmath408 and @xmath410 .",
    "moreover , @xmath26 can be chosen to satisfy the conditions of item  ( 3 ) .",
    "+ ( 5 ) for any @xmath156-minimal set @xmath405 , @xmath184 is the transitive closure of @xmath411 in fact , as @xmath151 this claim can be strengthen to the following . for any @xmath409 , @xmath184 is the transitive closure of @xmath412 ( 6 ) for any @xmath398 such that @xmath158 there is an @xmath156-minimal set @xmath405 such that @xmath26 witnesses that @xmath405 and @xmath407 are polynomially isomorphic .    for an @xmath156-minimal set @xmath405 and a @xmath184-block @xmath51 such that @xmath413 , the set @xmath414 is said to be an _",
    "@xmath156-trace_. a 2-element set @xmath415 such that @xmath409 , is called an _ @xmath156-subtrace_. the union @xmath416 of the traces from @xmath405 is called the _ body _ of @xmath405 , and @xmath417",
    "is called the _ tail _ of @xmath405 .",
    "depending on the structure of its minimal sets the interval @xmath156 can be of one of the five types , . since we assume the tractability conditions of the dichotomy conjecture , type  does not occur in algebras we deal with .",
    "[ lem : traces ] let @xmath150 and @xmath151 .",
    "then the following hold .",
    "+ ( 1 ) if @xmath418 then every @xmath156-trace is polynomially equivalent to a 1-dimensional vector space .",
    "+ ( 2 ) if @xmath419 then every @xmath156-minimal set @xmath405 contains exactly one trace @xmath420 , and if @xmath421 , @xmath420 contains only 2 elements . also , @xmath422 is polynomially equivalent to a boolean algebra , 2-element lattice , or 2-element semilattice , respectively .    intervals @xmath423 , @xmath424 and @xmath425 are said to be _ perspective _ if @xmath426 , or @xmath427 .",
    "[ lem : perspective - intervals ] let @xmath424 be such that @xmath425 and intervals @xmath423 are perspective .",
    "then @xmath428 and a set @xmath405 is @xmath156-minimal if and only if it is @xmath204-minimal .",
    "we will also use polynomials that behave on a minimal set in a particular way .",
    "[ lem : pseudo - meet ] let @xmath150 , @xmath151 , and @xmath419 .",
    "let @xmath405 be an @xmath156-minimal set and @xmath420 its only trace .",
    "then there is element @xmath429 and a binary polynomial @xmath430 of @xmath4 such that + ( 1 ) @xmath431 for any @xmath432 ; +",
    "( 2 ) for all @xmath432 , the algebra @xmath433 is a semilattice with neutral element  @xmath434 , that is , @xmath435 and @xmath436 .",
    "+ ( 3 ) for any @xmath432 and any @xmath437 , @xmath438 ; + ( 4 ) for all @xmath439 , @xmath440 . +",
    "polynomial @xmath430 is said to be a _",
    "pseudo - meet _ on @xmath405 .",
    "in @xcite we introduced a local approach to the structure of finite algebras .",
    "as we use this approach throughout the paper , we present it here in some details , see also @xcite . for",
    "the sake of the definitions below we slightly abuse terminology and by a module mean the full idempotent reduct of a module .",
    "for an algebra @xmath4 graph @xmath441[not : cg - a ] is defined as follows .",
    "the vertex set is the universe @xmath7 of @xmath4 .",
    "a pair @xmath189 of vertices is an _ edge _ if and only if there exists a congruence @xmath60 of @xmath442 , other than the full congruence and a term operation @xmath26 of @xmath4 such that either @xmath443 is a module and @xmath26 is an affine operation on it , or @xmath26 is a semilattice operation on @xmath444 , or @xmath26 is a majority operation on @xmath444 .",
    "( note that we use the same operation symbol in this case . )",
    "usually , @xmath60 is chosen to be a maximal congruence of @xmath442 .",
    "if there are a congruence @xmath60 and a term operation @xmath26 of @xmath4 such that @xmath26 is a semilattice operation on @xmath444 then @xmath189 is said to have the _",
    "semilattice type_. an edge @xmath189 is of _ majority type _ if there are a congruence @xmath60 and a term operation @xmath26 such that @xmath26 is a majority operation on @xmath444 and there is no semilattice term operation on @xmath444 .",
    "finally , @xmath189 has the _ affine type _ if there are @xmath60 and @xmath26 such that @xmath26 is an affine operation on @xmath443 and @xmath443 is a module ; in particular it implies that there is no semilattice or majority operation on @xmath444 . in all cases",
    "we say that congruence @xmath60 _ witnesses _ the type of edge @xmath189 .",
    "observe that a pair @xmath189 can still be an edge of more than one type as witnessed by different congruences , although this has consequences in this paper .",
    "omitting type  can be characterized as follows .",
    "[ the : connectedness ] an idempotent algebra @xmath4 omits type  ( that is , the variety generated by @xmath4 omits type if and only if @xmath445 is connected for every subalgebra @xmath199 of @xmath4 .",
    "moreover , a finite class @xmath382 of similar idempotent algebras closed under subalgebras and quotient algebras omit type  if and only if @xmath441 is connected for any @xmath446 .    for the sake of the dichotomy conjecture , it suffices to consider _ reducts _ of an algebra @xmath4 omitting type , that is , algebras with the same universe but reduced set of term operations , as long as reducts also omit type .",
    "in particular , we are interested in reducts of @xmath4 , in which semilattice and majority edges are subalgebras .    [ the : adding ] let @xmath4 be an algebra such that @xmath445 is connected for all subalgebras of @xmath199 of @xmath4 , and let @xmath189 be an edge of @xmath441 of the semilattice or majority type witnessed by congruence @xmath60 , and @xmath447 .",
    "let also @xmath448 denote set of term operations of @xmath4 preserving @xmath449 , and @xmath450 .",
    "then @xmath451 is connected for all subalgebras @xmath452 of @xmath453 .",
    "an algebra @xmath4 such that @xmath454 is a subuniverse of @xmath4 for every semilattice or majority edge @xmath189 of @xmath4 is called _ sm - smooth_. if @xmath382 is the class of all quotient algebras of subalgebras of an sm - smooth algebra @xmath4 , it is easy to see that that every @xmath455 is sm - smooth .",
    "although it is not needed in this paper , for any finite class @xmath382 omitting type  there is a class @xmath456 of sm - smooth algebras which are reducts of algebras from @xmath382 , and such that @xmath456 omits type , as well . in the rest of the paper all algebras",
    "are assumed to be sm - smooth .",
    "the next statement uniformizes the operations witnessing the type of edges .",
    "[ the : uniform ] let @xmath382 be a class of similar idempotent algebra closed under taking subalgebras and quotient algebras .",
    "there are term operations @xmath457 of @xmath382 such that for any @xmath446 and any @xmath139 operation @xmath26 is a semilattice operation on @xmath444 if @xmath189 is a semilattice edge ; @xmath430 is a majority operation on @xmath444 if @xmath189 is a majority edge ; @xmath458 is an affine operation on @xmath443 if @xmath189 is an affine edge , where @xmath60 witnesses the type of the edge .",
    "moreover , @xmath457 can be chosen such that    * @xmath459 for all @xmath460 , @xmath446 ; * @xmath461 for all @xmath460 , @xmath446 ; * @xmath462 for all @xmath460 , @xmath446 .",
    "there is a term operation @xmath463 such that for any affine edge @xmath189 and a majority , edge @xmath464 witnessed by congruences @xmath465 and @xmath60 , respectively , @xmath466 and @xmath467 .    unlike majority and affine operations , for a semilattice edge @xmath189 and a congruence @xmath60 of @xmath442 witnessing that",
    ", there can be semilattice operations acting differently on @xmath444 , which corresponds to the two possible orientations of @xmath189 . in every such case by fixing operation @xmath26 from theorem  [ the : uniform ]",
    "we effectively choose one of the two orientations .",
    "in this paper we do not really care about what orientation is preferable .",
    "in @xcite we introduced a stronger notion of edge . a pair @xmath189 of elements of algebra @xmath4",
    "is called a _ thin semilattice edge _ if @xmath189 is a semilattice edge , and the congruence witnessing that is the equality relation . in other words , @xmath140 and @xmath141 .",
    "we denote the fact that @xmath189 is a thin semilattice edge by @xmath468[not : le ] .",
    "thin semilattice edges allow us to introduce a directed graph @xmath469 , whose vertices are the elements of @xmath4 , and the arcs are the thin semilattice edges .",
    "we then can define _ semilattice - connected _ and _ strongly semilattice - connected _ components of @xmath469 .",
    "we will also use the natural order on the set of strongly semilattice - connected components of @xmath469 : for components @xmath470 , we write @xmath471 if there is a directed path in @xmath469 connecting a vertex from @xmath7 with a vertex from @xmath51 . elements from the maximal strongly connected components ( or simply _ maximal components _ ) of @xmath469 are called _ maximal _ elements of @xmath4 and the set of all such elements is denoted by @xmath472[not : max ] . a directed path in @xmath469",
    "is called a _ semilattice path _ or _ s - path_. if there is an s - path from @xmath64 to @xmath74 we write @xmath473[not : sqq ] .",
    "[ pro : good - operation ] let @xmath382 be a finite class of similar idempotent algebras closed under taking subalgebras and quotient algebras .",
    "there is a binary term operation @xmath26 of @xmath382 such that @xmath26 is a semilattice operation on @xmath444 for every semilattice edge @xmath189 of any @xmath446 , where congruence @xmath60 witnesses the type of @xmath189 , and , for any @xmath139 , either @xmath474 or the pair @xmath475 is a thin semilattice edge of @xmath4 .",
    "operation @xmath26 with this property will be denoted by a dot ( think multiplication ) .",
    "let operations @xmath476 be as in theorem  [ the : uniform ] .",
    "a pair @xmath189 from @xmath446 is called a _ thin majority edge _ if ( a ) it is a majority edge , let congruence @xmath60 witness this , ( b ) for any @xmath477 , @xmath478 , ( c ) @xmath479 , and ( d ) there exists a ternary term operation @xmath480 such that @xmath481 . finally , a pair @xmath189 is called a _ thin affine edge _ if ( a ) it is an affine edge , let congruence @xmath60 witness this , ( b ) for any @xmath477 , @xmath478 , ( c ) @xmath482 , ( d ) there exists a ternary term operation @xmath483 such that @xmath484 , and ( e ) @xmath64 is maximal in @xmath442 . note that the operations @xmath485 from theorem  [ the : uniform ] do not have to be majority or affine operations on thin edges ; thin edges do not have to be even closed under @xmath476 .",
    "thin edges of all types are oriented .",
    "we therefore can define yet another directed graph , @xmath486 , in which the arcs are the thin edges of all types .",
    "[ lem : thin ] let @xmath4 be an algebra .",
    "+ ( 1 ) let @xmath189 be a semilattice or majority edge in @xmath4 , and @xmath60 the congruence of @xmath442 witnessing that .",
    "then there is @xmath487 such that @xmath488 is a thin semilattice or majority edge , respectively .",
    "+ ( 2 ) let @xmath189 be an affine edge , and @xmath60 the congruence of @xmath442 witnessing that .",
    "then there are @xmath489 and @xmath487 such that @xmath490 in @xmath63 and @xmath491 is a thin affine edge",
    ".    the following simple properties of thin edges will be useful .",
    "note that a subdirect product of algebras ( a relation ) is also an algebra , and so edges and thin edges can be defined for relations as well .",
    "[ lem : thin - properties ] ( 1 ) let @xmath4 be an algebra and @xmath189 a thin edge .",
    "then @xmath189 is a thin edge in any subalgebra of @xmath4 containing @xmath492 , and @xmath493 is a thin edge in @xmath65 for any congruence @xmath60 . +",
    "( 2 ) let @xmath22 be a subdirect product of @xmath494 , @xmath342 $ ] , and @xmath495 a thin edge in @xmath22 .",
    "then @xmath496 is a thin edge in @xmath497 of the same type as @xmath495 .",
    "we will need stronger versions of lemmas  18 and  20 of @xcite .",
    "let @xmath382 be a finite class of similar idempotent algebras closed under taking subalgebras and quotient algebras .",
    "[ lem : op - s - on - affine ] ( 1 ) let @xmath189 be a thin majority edge of algebra @xmath446 .",
    "there is a term operation @xmath498[not:1-ab ] such that @xmath499 and @xmath500 for all affine edges @xmath464 of all @xmath501 , where the type of @xmath464 is witnessed by congruence @xmath502 .",
    "+ ( 2 ) let @xmath189 be a thin affine edge of algebra @xmath446 .",
    "there is a term operation @xmath503[not : h - ab ] such that @xmath504 and @xmath505 for all affine edges @xmath464 of all @xmath501 , where the type of @xmath464 is witnessed by congruence @xmath502 .",
    "moreover , @xmath506 is a permutation of @xmath507 for any @xmath508 .",
    "+ ( 3 ) let @xmath189 and @xmath464 be thin edges in algebras @xmath509 , respectively . if they have different types",
    "there is a binary term operation @xmath510 such that @xmath511 , @xmath512 .",
    "if both edges are affine then there is a term operation @xmath483 such that @xmath513 and @xmath514 .",
    "\\(1 ) let @xmath515 be a list of all affine edges of algebras in @xmath382 , @xmath516 and @xmath517 the corresponding congruences .",
    "set @xmath518 .",
    "let @xmath22 be the subalgebra of @xmath519 generated by @xmath520 .",
    "pair @xmath189 is also a majority edge , let it be witnessed by a congruence @xmath60 . by theorem  [ the : uniform ] @xmath521 where @xmath487 and @xmath522\\eqc{\\th_{c_id_i}}\\bc[i]$ ] , as @xmath463 is the first projection on @xmath523 and a second projection on @xmath443 .",
    "then as @xmath524 , we get @xmath525 for some @xmath526 such that @xmath527\\eqc{\\th_{c_id_i}}\\bc[i]$ ] .",
    "this means there is a binary term operation @xmath498 such that @xmath528 the result follows .",
    "\\(2 ) we use the notation from item ( 1 ) except @xmath189 now is a thin affine edge and @xmath22 is generated by @xmath529 . by condition ( a ) of the definition of thin affine edges , @xmath530 where @xmath487 and @xmath531\\eqc{\\th_{c_id_i}}\\bd[i]$ ] , as @xmath458 is a maltsev operation on @xmath443 and on @xmath523 .",
    "then as @xmath524 , by condition ( b ) we get @xmath532 for some @xmath533 such that @xmath534\\eqc{\\th_{c_id_i}}\\bd[i]$ ] .",
    "the first result follows .",
    "let now @xmath503 be the term operation we constructed and @xmath535 , @xmath536 $ ] .",
    "since @xmath537 is a module , in particular , it is an abelian algebra and @xmath538 for all @xmath539 , the second result follows .",
    "\\(3 ) follows from @xcite , lemmas  15,18,19,20 .",
    "a directed path in @xmath486 is called an _ asm - path _ , if there is an asm - path from @xmath64 to @xmath74 we write @xmath540[not : sqq - asm ] .",
    "if all edges of this path are semilattice or affine , it is called an _ affine - semilattice path _ or an _ as - path _ , if there is an as - path from @xmath64 to @xmath74 we write @xmath541[not : sqq - as ] .",
    "similar to maximal components , we consider strongly connected components of @xmath486 with majority edges removed , and the natural partial order on such components .",
    "the maximal components will be called _ as - components _ , and the elements from as - components are called _ as - maximal _ ; the set of all as - maximal elements of @xmath4 is denoted by @xmath542[not : amax ] . if @xmath64 is an as - maximal element , the as - component containing @xmath64",
    "is denoted @xmath543[not : as ] .",
    "an alternative way to define as - maximal elements is as follows : @xmath64 is as - maximal if for every @xmath544 such that @xmath541 it also holds that @xmath545 .",
    "finally , element @xmath546 is said to be _ universally maximal _ ( or _ u - maximal _ for short ) if for every @xmath544 such that @xmath540 it also holds that @xmath547 .",
    "the set of all u - maximal elements of @xmath4 is denoted @xmath548[not : umax ] .",
    "[ pro : as - connectivity ] let @xmath4 be an algebra . then + ( 1 ) any @xmath139 are connected in @xmath486 with an undirected path ; + ( 2 ) any @xmath549 ( or @xmath550 , or @xmath551 ) are connected in @xmath486 with a directed path .    item ( 2 ) is only proved in @xcite for maximal and as - maximal elements ; so we prove it here for u - maximal elements as well .",
    "let @xmath552 be maximal elements of @xmath4 such that @xmath490 and @xmath553 . then by proposition",
    "[ pro : as - connectivity ] for maximal elements @xmath554 , and , as @xmath74 is u - maximal , @xmath555 .    since for every @xmath546 there is a maximal @xmath556 such that @xmath490 , proposition  [ pro : as - connectivity ] implies that there is only one u - maximal component .",
    "u - maximality has an additional useful property , it is somewhat hereditary , as it made precise in the following    [ lem : u - max - congruence ] let @xmath199 be a subalgebra of @xmath4 containing a u - maximal element of @xmath4 . then every element u - maximal in @xmath199 is also u - maximal in @xmath4 . in particular ,",
    "if @xmath183 is a congruence of @xmath4 and @xmath199 is a u - maximal @xmath183-block , that is @xmath199 is a u - maximal element in @xmath557 , then @xmath558 .",
    "let @xmath559 be an element u - maximal in @xmath4 , let @xmath560 .",
    "for any @xmath561 with @xmath562 we also have @xmath563 .",
    "finally , since @xmath560 and @xmath564 , we have @xmath565 . for the second part of the lemma we need to find a u - maximal element in @xmath199 .",
    "let @xmath566 .",
    "then as @xmath199 is u - maximal in @xmath557 applying lemma  [ lem : thin ] we get that there is @xmath567 such that @xmath568 . clearly , @xmath569 .",
    "let @xmath4 be an algebra and @xmath546 .",
    "by @xmath570[not : filt ] we denote the set of elements @xmath64 is connected to ( in terms of semilattice paths ) ; similarly , by @xmath571[not : filt - as ] and @xmath572[not : filt - asm ] we denote the set of elements @xmath64 is as - connected and asm - connected to . also , @xmath573 ( @xmath574 , @xmath575 , respectively ) for @xmath576 .",
    "note that if @xmath64 is an as - maximal element then @xmath577 , and @xmath578 for any @xmath544 .",
    "we will need the following statements .",
    "[ lem : to - max ] let @xmath22 be a subdirect product of @xmath579 , @xmath342 $ ] .",
    "+ ( 1 ) for any @xmath132 , @xmath580 with @xmath581 , there is @xmath582 such that @xmath583 and @xmath584 . + ( 2 ) for any @xmath132 , @xmath580 such that @xmath585 is a thin majority edge there is @xmath582 such that @xmath586 is a thin majority edge , and @xmath584 .",
    "+ ( 3 ) for any @xmath132 , @xmath580 such that @xmath585 is a thin affine edge there are @xmath587 such that @xmath588 , @xmath589 is a thin affine edge , and @xmath590 , @xmath584 .",
    "+ ( 4 ) for any @xmath132 , and an s - path ( as - path , asm - path ) @xmath591 with @xmath592 , there is an s - path ( as - path , asm - path , respectively ) @xmath593 such that @xmath594 .",
    "+ ( 5 ) for any @xmath595 ( @xmath596 , @xmath597 ) there is @xmath598 ( @xmath599 , @xmath600 , respectively ) , such that @xmath584 .",
    "in particular , @xmath601-i}\\bb'\\in\\max(\\pr_{[n]-i}\\rel)$ ] ( @xmath601-i}\\bb'\\in\\amax(\\pr_{[n]-i}\\rel)$ ] , @xmath601-i}\\bb'\\in\\umax(\\pr_{[n]-i}\\rel)$ ] , respectively ) .",
    "items ( 1 ) and ( 3 ) are proved in @xcite , and items of ( 4 ) and ( 5 ) are only proved for s- and as - paths , and , respectively , for maximal and as - maximal elements .",
    "items ( 4 ) and ( 5 ) for asm - paths and u - maximal elements follow from  ( 1)(3 ) .",
    "\\(2 ) observe that it suffices to consider binary relations @xmath22 .",
    "indeed , @xmath22 can be viewed as a subdirect product of @xmath602-i}\\rel$ ] .",
    "so , suppose @xmath603 and @xmath604 .",
    "we have @xmath605 and @xmath606 .",
    "let @xmath60 be a maximal congruence of @xmath607 witnessing that @xmath608 is an majority edge .",
    "choose @xmath609 such that @xmath610 and @xmath611 is minimal possible with this condition .",
    "it suffices to prove the lemma for @xmath392 , since @xmath612 and so @xmath613 , and @xmath608 is still a thin majority edge .",
    "this means that @xmath614 can be chosen such that @xmath615 .",
    "also , by taking @xmath616 we may assume by theorem  [ the : uniform ] that @xmath617 .",
    "as is easily seen , the pair @xmath618 is a majority edge as witnessed by congruence @xmath619 where @xmath620 . by the choice of @xmath621 the pair @xmath622 belongs to @xmath623 for any @xmath624 , and it only remains to prove condition ( d ) of the definition of thin majority edges .",
    "let @xmath480 be the operation from condition ( d ) for @xmath608 .",
    "then @xmath625 since @xmath626 by the choice of @xmath622 , there is a term operation @xmath627 such that @xmath628 repeating this for the second and third coordinate positions by finding @xmath629 with @xmath630 we obtain a ternary operation @xmath631 such that @xmath632 confirming property ( d ) .",
    "the following lemma considers a special case of as - components in subdirect products , and is straightforward .",
    "[ lem : as - product ] let @xmath22 be a subdirect product of @xmath633 , @xmath399 as components of @xmath634 , respectively , and @xmath635 .",
    "then @xmath636 is an as - component of @xmath22 .",
    "we complete this section with an auxiliary statement that will be needed later .",
    "[ lem : as - type-2 ] let @xmath151 , @xmath150 , let @xmath51 be a @xmath184-block and @xmath418 .",
    "then @xmath637 is term equivalent to a module . in particular",
    ", every pair of elements of @xmath637 is a thin affine edge in @xmath557 .",
    "as @xmath4 is an idempotent algebra that generates a variety omitting type , and @xmath638 is a simple interval in @xmath82 of type , by theorem  7.11 of @xcite there is a term operation of @xmath4 that is maltsev on @xmath637 . since @xmath184 is abelian on @xmath637 , we get the result .",
    "we make use of the property of quasi-2-decomposability proved in @xcite .",
    "[ the : quasi-2-decomp ] if @xmath22 is an @xmath71-ary relation , @xmath639 $ ] , tuple @xmath90 is such that @xmath640 for any @xmath641 $ ] , @xmath642 , and @xmath643 , there is a tuple @xmath293 with @xmath644 for any @xmath641 $ ] , @xmath642 , and @xmath645 .",
    "one useful implication of the 2-decomposition theorem  [ the : quasi-2-decomp ] is the existence of term operation resembling a majority function .",
    "we state this theorem for finite classes of algebras rather than a single algebra , because it concerns as - components that in subalgebras of products may have complicated structure .",
    "[ the : pseudo - majority ] let @xmath382 be a finite class of finite similar sm - smooth algebras omitting type  .",
    "there is a term operation @xmath646[not : maj ] of @xmath382 such that for any @xmath446 and any @xmath139 , @xmath647 .",
    "in particular , if @xmath64 is as - maximal , then @xmath648 belong to the as - component of @xmath4 containing @xmath64 .",
    "let @xmath649 be a list of all pairs of elements from algebras of @xmath382 , let @xmath650 .",
    "define relation @xmath22 to be a subdirect product of @xmath651 generated by @xmath652 , where for every @xmath98 $ ] , @xmath653 , @xmath654 , @xmath655 .",
    "in other words the triples @xmath656,\\ba_2[3i-2],\\ba_3[3i-2])$ ] , @xmath657,\\ba_2[3i-1],\\ba_3[3i-1])$ ] , @xmath658,\\ba_2[3i],\\ba_3[3i])$ ] have the form @xmath659 , respectively .",
    "therefore it suffices to show that @xmath22 contains a tuple @xmath660 such that @xmath661 $ ] , where @xmath662 .",
    "however , since @xmath663 for any @xmath664 $ ] and @xmath665 , @xmath666 , this follows from the 2-decomposition theorem  [ the : quasi-2-decomp ] .    a function @xmath646 satisfying the properties from theorem  [ the : pseudo - majority ] will be called a _ quasi - majority function_.      let @xmath22 be a subdirect product of @xmath634 .",
    "by @xmath667 , \\rel^{-1}[c']$][not : rel - of - a ] for @xmath668 we denote the sets @xmath669 , respectively , and for @xmath670 we use @xmath671=\\bigcup_{c\\in c}\\rel[c]$ ] , @xmath672=\\bigcup_{c'\\in c'}\\rel^{-1}[c']$ ] , respectively .",
    "binary relations @xmath673 on @xmath634 given by @xmath674\\cap\\rel[b]\\ne\\eps\\}$ ] and @xmath675\\cap\\rel^{-1}[b]\\ne\\eps\\}$][not : tol ] , respectively , are called _ link tolerances _ of @xmath22 .",
    "they are tolerances of @xmath676 , @xmath677 , respectively , that is invariant reflexive and symmetric relations .",
    "the transitive closures @xmath678[not : lnk ] of @xmath679 are called _ link congruences _ , and they are , indeed , congruences .",
    "relation @xmath22 is said to be _ linked _ if the link congruences are full congruences .",
    "[ lem : as - rectangularity ] let @xmath22 be a subalgebra of @xmath633 and let @xmath680 and @xmath681 $ ] . for any @xmath682 such that @xmath189 is thin edge , and any @xmath683\\cap b$ ] , @xmath684 $ ] .",
    "the case when @xmath468 or @xmath189 is affine is considered in @xcite , so suppose that @xmath189 is majority .",
    "let @xmath685 $ ] .",
    "set @xmath686 is nonempty , as @xmath687 . if @xmath688 , there are @xmath689 and @xmath690 such that @xmath691 is a thin edge . by lemma  [ lem : op - s - on - affine](3 )",
    "there is a term operation @xmath510 such that @xmath692 and @xmath693 . then @xmath694 .",
    "the result follows .",
    "[ pro : max - gen ] let @xmath695 be a linked subdirect product and let @xmath696 be as - components of @xmath634 , respectively , such that @xmath697 . then @xmath698 .",
    "[ cor : linkage - rectangularity ] let @xmath22 be a subdirect product of @xmath676 and @xmath677 , @xmath678 the link congruences , and let @xmath696 be as - components of a @xmath699-block and a @xmath700-block , respectively , such that @xmath697",
    ". then @xmath698 .",
    "[ pro : umax - rectangular ] let @xmath22 be a subdirect product of @xmath676 and @xmath677 , @xmath678 the link congruences , and let @xmath701 be an as - component of a @xmath699-block and @xmath702 $ ] ; let @xmath703 . then @xmath698 .",
    "let @xmath704 be a subset of a @xmath700-block @xmath185 .",
    "by the maximality lemma  [ lem : to - max](5 ) @xmath704 contains an as - maximal element @xmath64 of @xmath185 . by the rectangularity corollary  [ cor : linkage - rectangularity ] @xmath705 .",
    "it then suffices to show that @xmath706 .",
    "suppose for @xmath707 it holds @xmath708 .",
    "if @xmath709 , there are @xmath689 and @xmath710 such that @xmath691 is a thin edge . by lemma  [ lem : as - rectangularity ] @xmath711 ; the result follows .",
    "we complete this section with a technical lemma that will be useful later .",
    "[ lem : as - square - congruence ] let @xmath4 be an algebra and @xmath185 its as - component such that @xmath712 , let @xmath713 , and let @xmath184 be a congruence of @xmath22 .",
    "then for some @xmath714 , @xmath715 the pair @xmath716 is as - maximal in a @xmath184-block .",
    "we start with a general claim .    claim . if @xmath717 are such that @xmath718 , then @xmath719 .",
    "let @xmath720 , @xmath721 be given by @xmath722 consider a subdirect product of @xmath723 defined as follows @xmath724 as is easily seen , for a @xmath184-block @xmath51 and a @xmath198-block @xmath686 , @xmath725 if and only if @xmath726 .",
    "as @xmath718 , relation @xmath727 is linked . since @xmath728 is an as - component of @xmath729 and @xmath730 is an as - component of @xmath731 , proposition  [ pro : max - gen ] implies that @xmath732 .",
    "therefore for any @xmath184- and @xmath198-blocks @xmath733 such that @xmath734 , @xmath735 we have @xmath726 . using as - connectivity and lemma  [ lem : thin ] it can also be inferred that @xmath736 .",
    "the result follows .",
    "let @xmath183 be a maximal congruence of @xmath4 and @xmath737 , @xmath738 .",
    "as is easily seen , @xmath739 are maximal congruences of @xmath22 .",
    "there are two cases .",
    "@xmath740 .    by the claim for any @xmath183-blocks @xmath696 such that @xmath741 we also have @xmath742 .",
    "also , using lemma  [ lem : thin ] @xmath743 contains a pair as - maximal in @xmath51 .",
    "choosing @xmath744 we get the result .",
    "@xmath745 .    in this case",
    "consider @xmath746 , @xmath747 , @xmath748 ; note that @xmath453 is a simple idempotent algebra , and as @xmath749 , we have @xmath750 . by @xcite either @xmath453 has an _ absorbing element _ @xmath64 , that is , @xmath751 for any term operation @xmath26 of @xmath453 , whenever for some essential variable @xmath752 of @xmath26 , @xmath753 , or @xmath453 is a module , or the only nontrivial congruences of @xmath453 are @xmath754 , @xmath755 .",
    "since @xmath185 is a nontrivial as - component , the first option is impossible .",
    "if @xmath453 is a simple module , the only congruence that is different from @xmath756 is the skew congruence with @xmath757 as a congruence block .",
    "if @xmath184 is the skew congruence , let @xmath686 be a @xmath758-block different from @xmath28 and @xmath759 a @xmath184-block .",
    "then for any as - maximal pair @xmath760 we have @xmath715 .",
    "so , suppose @xmath761 .",
    "if @xmath762 , choose a @xmath763-block @xmath764 such that @xmath744 ; clearly @xmath696 are @xmath183-blocks .",
    "then for any @xmath184-block @xmath765 and as - maximal element @xmath766 we have @xmath715 as required .",
    "finally , suppose @xmath767 , then @xmath768 .",
    "take a @xmath184-block @xmath51 , @xmath734 , we have @xmath769 for some @xmath183-block @xmath701 .",
    "moreover , by the claim for any @xmath183-block @xmath770 with @xmath771 there is @xmath772 such that @xmath773 . by lemma  [ lem : thin ]",
    "there is an as - component @xmath774 of @xmath51 such that @xmath716 above can be chosen from @xmath774 .",
    "choosing @xmath775 we obtain a required pair .",
    "in this section we introduce and study the relationship between prime intervals in the congruence lattice of an algebra , or in congruence lattices of factors in a subdirect products .",
    "it was first introduced in @xcite and used in the csp research in  @xcite .",
    "we start with several technical results .",
    "they demonstrate the connection between minimal sets of an algebra @xmath4 and the structure of its graph @xmath486 .",
    "let @xmath4 be an algebra and let @xmath776[not : qab ] , @xmath139 , denote the subdirect product of @xmath777 generated by @xmath778 .",
    "[ lem : qab - tolerance ] ( 1 ) @xmath779 .",
    "+ ( 2 ) for any @xmath398 , @xmath780 .",
    "in particular , @xmath781 ; denote this congruence by @xmath183 .",
    "+ ( 3 ) @xmath782 .",
    "+ ( 4 ) let @xmath696 be @xmath183-blocks , and @xmath783 as - components of @xmath696 , respectively , such that @xmath784 and @xmath785 for a polynomial @xmath26",
    ". then @xmath786 .",
    "\\(1 ) follows directly from the definitions .",
    "\\(2 ) take @xmath398 and let @xmath787 for a term operation @xmath430 of @xmath4",
    ". then @xmath788 and @xmath789 .",
    "thus @xmath780 .",
    "\\(3 ) follows from ( 1 ) , and ( 4 ) follows from ( 2),(3 ) , and the rectangularity corollary  [ cor : linkage - rectangularity ] .",
    "we say that @xmath64 is _ @xmath183-maximal _ for a congruence @xmath191 if @xmath64 is as - maximal in the subalgebra @xmath790 .",
    "[ cor : mapping - pairs ] let @xmath191 and @xmath791 . then for any @xmath139 with @xmath792 and any @xmath183-maximal @xmath793 , @xmath794 , with @xmath795 , belonging to the same as - component of @xmath796 ,",
    "there is @xmath398 such that @xmath797 , @xmath798 .",
    "the result follows from lemma  [ lem : qab - tolerance](4 ) .",
    "recall that for @xmath150 with @xmath151 a pair @xmath142 is called an _ @xmath156-subtrace _ if @xmath409 and @xmath439 for some @xmath156-minimal set @xmath405 .",
    "[ cor : max - min - set ] let @xmath191 and @xmath791 , and let @xmath793 , @xmath795 , be @xmath183-maximal . + ( 1 ) if @xmath799 belong to the same as - component of @xmath796 , then @xmath800 is a @xmath801-subtrace . + ( 2 )",
    "if there is a @xmath801-subtrace @xmath802 such that @xmath803 and @xmath804 then @xmath800 is a @xmath801-subtrace as well .",
    "\\(1 ) take any @xmath801-minimal set @xmath405 , and @xmath439 with @xmath792 . by corollary  [ cor : mapping - pairs ] there is @xmath398 with @xmath797 , @xmath798 . by lemma  [ lem : minimal - sets](3 )",
    "@xmath805 is a @xmath801-minimal set .",
    "\\(2 ) as in ( 1 ) one can argue that @xmath806 , that is , @xmath807 .",
    "we then complete by lemma  [ lem : qab - tolerance](4 ) .",
    "[ lem : type23 ] for any @xmath191 with @xmath791 such that @xmath808 for some as - component @xmath686 of an @xmath183-block , the prime interval @xmath791 has type  or .",
    "let @xmath809 for an as - component @xmath686 of an @xmath183-block .",
    "then by corollary  [ cor : mapping - pairs ] there is a polynomial @xmath26 such that @xmath810 and @xmath811 . also , @xmath492 belong to some @xmath801-minimal set .",
    "this rules out types  and .",
    "since @xmath4 omits type @xmath812 , this only leaves types  and .",
    "[ lem : type2-condition ] let @xmath191 with @xmath791 be such that some @xmath183-block contains a semilattice or majority edge .",
    "then the prime interval @xmath801 has type , or .    we need to show that @xmath801 does not have type .",
    "let @xmath51 the @xmath183-block containing a semilattice or majority edge .",
    "then @xmath51 contains a non - abelian subalgebra , which implies @xmath801 is also non - abelian .",
    "let @xmath4 be an algebra , and let @xmath151 and @xmath157 be prime intervals in @xmath82 .",
    "we say that @xmath151 can be _ separated _ from @xmath157 if there is a unary polynomial @xmath398 such that @xmath158 , but @xmath159 .",
    "the polynomial @xmath26 in this case is said to _ separate _",
    "@xmath151 from @xmath157 .",
    "since we often consider relations rather than single algebras , we also introduce separability in a slightly different way .",
    "let @xmath22 be a subdirect product of @xmath160 .",
    "let @xmath161 $ ] and let @xmath813 , @xmath814 be prime intervals in @xmath162 and @xmath163 , respectively .",
    "interval @xmath813 can be separated from @xmath814 if there is a unary polynomial @xmath26 of @xmath22 such that @xmath815 but @xmath816 .",
    "similarly , the polynomial @xmath26 in this case is said to _ separate _",
    "@xmath813 from @xmath814    first , we observe a connection between separation in a single algebra and in relations .",
    "[ lem : separation - separation ] let @xmath22 be the binary equality relation on @xmath4 .",
    "let @xmath817 be viewed as congruences of the first factor of @xmath22 , and @xmath818 as congruences of the second factor of @xmath22 .",
    "prime interval @xmath151 can be separated from @xmath157 as intervals in @xmath82 if and only if @xmath819 can be separated from @xmath820 in @xmath22 .",
    "note that for any polynomial @xmath26 its action on the first and second projections of @xmath22 is the same polynomial of @xmath4 .",
    "therefore @xmath151 can be separated from @xmath157 in @xmath82 if and only if , there is @xmath398 , @xmath158 while @xmath159 .",
    "this condition can be expressed as follows : there is @xmath821 , @xmath822 while @xmath823 , which precisely means that @xmath819 can be separated from @xmath820 in @xmath22 .    in what follows",
    "when proving results about separation we will always assume that we deal with a relation  a subdirect product  and that the prime intervals in question are from congruence lattices of different factors of the subdirect product .",
    "if this is not the case , one can duplicate the factor containing the prime intervals and apply lemma  [ lem : separation - separation ] .",
    "let @xmath22 be a subdirect product of @xmath160 , @xmath342 $ ] , and let @xmath26 be a polynomial of @xmath497 , that is , there are a term operation @xmath430 of @xmath22 and @xmath361 such that @xmath824 .",
    "the tuples @xmath825 can be extended to tuples @xmath826 .",
    "then the polynomial of @xmath22 given by @xmath827 is said to be an _ extension _ of @xmath26 to a polynomial of @xmath22 .",
    "[ lem : min - set - separation ] let @xmath22 be a subdirect product of @xmath160 , @xmath161 $ ] , and @xmath813 , @xmath814 for @xmath828 , @xmath829 .",
    "let also a unary polynomial @xmath26 of @xmath22 separate @xmath813 from @xmath814 .",
    "then @xmath26 can be chosen idempotent and such that @xmath830 is a @xmath831-minimal set .",
    "let @xmath430 be a polynomial separating @xmath831 from @xmath832 .",
    "since @xmath833 , by lemma  [ lem : minimal - sets](6 ) there is an @xmath831-minimal set @xmath405 such that @xmath834 .",
    "let @xmath835 , by lemma  [ lem : minimal - sets](2 ) @xmath9 is a @xmath831-minimal set .",
    "let @xmath458 be a unary polynomial such that @xmath458 maps @xmath9 onto @xmath405 and @xmath836 is the identity mapping .",
    "let also @xmath483 be an extension of @xmath458 to a polynomial of @xmath22 .",
    "then @xmath837 separates @xmath91 from @xmath838 .",
    "now @xmath26 can be chosen to be an appropriate power of @xmath837 .    for a subdirect product @xmath839 the relation `",
    "can not be separated ' on prime intervals of the @xmath352s is clearly reflexive and transitive . if the algebras @xmath352 are maltsev , it is also symmetric ( for partial results see @xcite ) .",
    "moreover , it can be shown that it remains ` almost ' symmetric when the @xmath352s contain no majority edges . in the general case",
    "however the situation is more complicated .",
    "next we introduce conditions that make the ` can not be separated ' relation to some extent symmetric , at least in what concerns our algorithm , as it will be demonstrated in lemma  [ lem : relative - symmetry ] .",
    "let @xmath840 , let @xmath841 be a @xmath842-block for @xmath98 $ ] , and let @xmath843 .",
    "let also @xmath844 be a set of unary polynomials of @xmath22 , @xmath91 an element from @xmath86 $ ] , and @xmath845 with @xmath846 .",
    "let @xmath847 for @xmath848 , @xmath849 , denote the set of pairs @xmath850 such that there is a polynomial @xmath851 satisfying the following conditions : @xmath852 and @xmath853 is a @xmath156-minimal set .",
    "note that these conditions imply that @xmath142 is a @xmath156-subtrace or @xmath854 .",
    "we say that @xmath183 and @xmath184 are _ @xmath844-chained _ in @xmath22 with respect to @xmath855 if for any @xmath848 with @xmath849 , the following conditions hold : + ( g1 ) for a @xmath856-block @xmath774 such that @xmath857 let @xmath858 .",
    "then @xmath859 for any @xmath492 from the same as - component of @xmath860 .",
    "+ ( g2 ) for any @xmath856-block @xmath774 such that @xmath857 , and any @xmath861 , where @xmath858 , there is a sequence @xmath862 in @xmath860 such that @xmath863 for any @xmath864 $ ] .",
    "+ also , if for elements @xmath492 and any @xmath865 there is a sequence of elements satisfying ( g2 ) , we say that @xmath64 and @xmath74 are _ subtrace connected _ ; congruences @xmath866 , congruence classes @xmath332 , and set of polynomials @xmath844 will always be clear from the context in this case . observe that @xmath844-chaining amounts to saying that polynomials from @xmath844 do not allow any congruences of @xmath184-blocks viewed as subalgebras between @xmath183 and @xmath184 , at least where u - maximal elements are concerned .",
    "a unary polynomial @xmath26 is said to be _",
    "@xmath332-preserving _ if @xmath867 .",
    "we call relation @xmath22 _ chained _ with respect to @xmath855 if + ( q1 ) for any @xmath845 , @xmath98 $ ] , such that @xmath846 , congruences @xmath183 and @xmath184 are @xmath868-chained in @xmath22 , where @xmath868 is the set of all @xmath332-preserving polynomials of @xmath22 + ( q2 ) for any @xmath845 , @xmath869 , @xmath161 $ ] , such that @xmath846 , @xmath870 , and @xmath156 can be separated from @xmath204 , congruences @xmath183 and @xmath184 are @xmath871-chained in @xmath22 , where @xmath871 is the set of all @xmath332-preserving polynomials of @xmath22 such that @xmath872 .",
    "+ polynomials from @xmath871 in condition ( q2 ) will be called _ @xmath873-good_.    [",
    "lem : good - polys ] ( 1 ) any constant polynomial from @xmath874 is @xmath873-good . + ( 2 ) if @xmath26 is a @xmath14-ary term function of @xmath22 and @xmath875 are @xmath873-good polynomials , then @xmath876 is @xmath873-good .",
    "+ ( 3 ) let @xmath877 denote @xmath878 for @xmath879 . if @xmath880 then @xmath881 .",
    "+ ( 4 ) if there is a @xmath856-block @xmath774 such that @xmath857 , let @xmath858 , and if @xmath860 contains a nontrivial as - component , then there is a set @xmath882 such that @xmath883 for any @xmath848 , @xmath884 and @xmath420 satisfies conditions ( g1),(g2 ) for @xmath877 .",
    "+ ( 5 ) let @xmath848 , @xmath884 be such that @xmath877 is minimal among sets of this form . then for any @xmath885 there is @xmath886 such that @xmath458 is idempotent and @xmath887 .",
    "items ( 1),(2 ) are straightforward .",
    "\\(3 ) let @xmath888 . then there are polynomials @xmath889 with @xmath890 and @xmath891",
    ". then @xmath892 by item ( 2 ) or definition and @xmath893 .",
    "\\(4 ) take @xmath714 where @xmath185 is a nontrivial as - component in @xmath860 . by ( g2 ) @xmath880 for any appropriate @xmath865 . therefore by ( 3 ) @xmath894 .",
    "\\(5 ) let @xmath880 .",
    "then by ( 3 ) @xmath881 , and therefore by the minimality of @xmath877 we get @xmath895 .",
    "the result follows by definition of @xmath877 .",
    "the next lemma shows how we will use the property of being chained .",
    "[ lem : link - separability ] let @xmath22 be a subdirect product of @xmath494 chained with respect to @xmath855 , where @xmath840 and @xmath841 is a @xmath842-block , and @xmath896 , @xmath897 .",
    "let also @xmath898 be the link congruence of @xmath899 with respect to @xmath900 for some @xmath161 $ ] , and @xmath901 the congruence of @xmath352 generated by @xmath898 .",
    "then for any @xmath902 with @xmath157 it holds @xmath903 for every @xmath904-block @xmath774 u - maximal in @xmath905 .    if @xmath157 then by the choice of @xmath389 there are @xmath906 with @xmath907 .",
    "let @xmath774 be the intersection of @xmath899 with a @xmath389-block .",
    "we apply condition ( q1 ) to @xmath908 and @xmath909 . by condition ( q1 ) for any @xmath910 there is a sequence @xmath911 such that @xmath912 for some @xmath332-preserving polynomial @xmath913 for each @xmath914 $ ] .",
    "this means that @xmath915 , and so @xmath916 .",
    "the following lemma establishes the weak symmetricity of separability relation mentioned before .",
    "[ lem : relative - symmetry ] let @xmath22 be a subdirect product of @xmath579 , @xmath840 , @xmath841 a @xmath842-block such that @xmath22 is chained with respect to @xmath855 ; @xmath917 , @xmath897 . let also @xmath918 , @xmath919 , where @xmath920 , @xmath921 . if @xmath922 has a nontrivial as - component @xmath394 and @xmath156 can be separated from @xmath204 , then there is a @xmath332-preserving polynomial @xmath430 such that @xmath923 and @xmath924",
    ". moreover , for any @xmath925 polynomial @xmath26 can be chosen such that @xmath926 .",
    "as is easily seen , we can assume that @xmath927 are equality relations .",
    "we need to show that there is @xmath430 such that @xmath430 collapses @xmath184 but does not collapse @xmath928 .",
    "first we show that there are @xmath929 such that for any @xmath930 there is a polynomial @xmath931 of @xmath22 such that    * @xmath931 is idempotent ; * @xmath932 ; * @xmath933 , @xmath934 .",
    "we consider two cases .",
    "there is an element @xmath935 from a nontrivial as - component of @xmath704 such that @xmath936 for some @xmath937 , a @xmath184-block such that @xmath938 and @xmath939 .",
    "first , we choose @xmath940 to be any element other than @xmath935 of the nontrivial as - component @xmath394 of @xmath704 containing @xmath935 .",
    "let @xmath941 be a minimal set of @xmath156-subtraces as in lemma  [ lem : good - polys](4 ) for @xmath871 , the set of @xmath873-good polynomials .",
    "we start with the case when @xmath942 .",
    "even more specifically , as @xmath935 is as - maximal in @xmath704 , by the maximality lemma  [ lem : to - max](5 ) @xmath64 can be chosen from @xmath943 .",
    "take an @xmath156-subtrace @xmath944 , such a subtrace exists by condition ( q1 ) .    by @xmath945",
    "we denote the relation generated by @xmath946=x,\\bz[2]=y\\}$ ] , where @xmath90 is an arbitrary element from @xmath392 .",
    "let @xmath947 and @xmath948 .",
    "observe that @xmath727 is exactly the set of quadruples @xmath949 for unary polynomials @xmath26 of @xmath22 and @xmath950 is exactly the set of quadruples @xmath949 for @xmath332-preserving unary polynomials @xmath26 of @xmath22 .",
    "we prove that @xmath950 contains a quadruple of the form @xmath951 ; the result then follows .",
    "let also @xmath952 , @xmath953 ; set @xmath954 , @xmath955 .",
    "note that @xmath956 and @xmath957 , because @xmath958 .",
    "let @xmath678 denote the link congruences of @xmath950 viewed as a subdirect product of @xmath959 and @xmath960 .",
    "note that these congruences may be different from the link congruences of @xmath727 restricted to @xmath961 , @xmath962 , respectively .",
    "we show that @xmath963 for some @xmath964 is as - maximal in a @xmath699-block , @xmath965 is as - maximal in a @xmath700-block , and @xmath966 . by the rectangularity corollary  [ cor : linkage - rectangularity ]",
    "this implies the result .",
    "@xmath967 and @xmath968 .",
    "relation @xmath950 contains tuples @xmath969 , @xmath970 , @xmath971 , @xmath972 for some @xmath973 . indeed , @xmath974 by definition , @xmath975 because @xmath976 , and @xmath977 can be chosen to be the images of @xmath969 and @xmath972 , respectively , under a @xmath332-preserving polynomial @xmath978 such that @xmath979 , @xmath980 and @xmath981 .",
    "such a polynomial exists because @xmath22 is chained and because @xmath156 can be separated from @xmath204 .",
    "this implies that @xmath982 .",
    "let @xmath983 be congruences of @xmath984 generated by @xmath985 and @xmath986 , respectively .",
    "then @xmath987 indeed , in the case of , say , @xmath988 , relation @xmath959 consists of pairs @xmath989 for a @xmath332-preserving unary polynomial @xmath430 of @xmath676 .",
    "since @xmath990 , for any @xmath991 it holds that @xmath992 since @xmath993 are in the same @xmath699-block , @xmath967 .    for @xmath960 and @xmath994",
    "the argument is similar .",
    "observing from the same tuples as before that @xmath982 , we prove @xmath968 by a similar argument .",
    "claim  1 is proved .",
    "let @xmath995 , where @xmath996 is the @xmath184-block containing @xmath492 . then @xmath997 .    by the assumption for any @xmath156-subtrace @xmath998",
    "there is a @xmath332-preserving polynomial @xmath999 satisfying @xmath1000 , @xmath1001 , and @xmath1002 . applying @xmath999 to tuples @xmath1003 , and @xmath1004 for any @xmath1005 such that @xmath1006 , we obtain @xmath1007 .",
    "the second two tuples imply that @xmath1008 , and therefore @xmath1009 for any @xmath1010 .",
    "along with claim  1 this proves the result .",
    "@xmath965 is as - maximal in a @xmath700-block .",
    "if for some @xmath1011 we have @xmath1012 , then , as @xmath1013 generates @xmath389 , for any @xmath204-subtrace @xmath1014 there is a @xmath332-preserving polynomial @xmath1015 with @xmath1016 . applying this polynomial to the tuples witnessing that @xmath1012 we get @xmath1017",
    ". therefore by condition ( q1 ) all tuples of the form @xmath1018 , @xmath1019 , are @xmath700-related .",
    "since by condition ( g1 ) @xmath800 is a @xmath204-subtrace from @xmath1020 , using claim  1 this implies that @xmath1021 , where @xmath1022 .",
    "in particular , @xmath1023 , where @xmath394 is the as - component of @xmath704 containing @xmath799 , is contained in @xmath960 , and is contained in a @xmath700-block .",
    "all elements of @xmath1023 are as - maximal in @xmath1024 .    otherwise , since the inclusion @xmath968 implies that if @xmath1025 then @xmath1026 , by claim  1 we have @xmath1027 .",
    "in particular , @xmath1028 is contained in a @xmath700-block .",
    "since @xmath799 are as - maximal , @xmath965 is as - maximal in this @xmath700-block .",
    "claim  3 is proved .    by the maximality lemma  [ lem : to - max](5 ) there is an element @xmath1029 as - maximal in a @xmath699-block @xmath686 such that @xmath1030 . if @xmath1031 then we are done . otherwise by condition ( g1 ) and",
    "lemma  [ lem : good - polys](3 ) @xmath1032 is an @xmath156-subtrace from @xmath941 , also @xmath1033 because @xmath1034 , and we can replace @xmath492 with @xmath865 . observe that if we show the existence of a polynomial @xmath430 such that @xmath1035 and @xmath1036 , @xmath1037 , this will witness the existence of @xmath480 with @xmath1038 and @xmath1039 , @xmath1040 .",
    "let @xmath1041 .",
    "note that by claim  2 @xmath997 and by the rectangularity corollary  [ cor : linkage - rectangularity ] @xmath1042 .",
    "therefore , again @xmath865 can be chosen as - maximal in @xmath774 .",
    "we use @xmath492 for @xmath865 from now on .",
    "@xmath1043 is as - maximal in @xmath1044 .",
    "let @xmath983 be the link congruences of @xmath1045 , respectively , with respect to @xmath959 ; as @xmath1046 we have @xmath1047 . on the other hand , since @xmath959 consists of pairs of the form @xmath1018 and @xmath156-subtraces , and since @xmath1048 belongs to a block of the transitive closure of @xmath941 , it is easy to see that @xmath1048 is a subset of both a @xmath1049- and @xmath1050-blocks .",
    "indeed , let @xmath1051 and @xmath1052 are such that @xmath1053 .",
    "this means that either @xmath1054 or @xmath1055 . since @xmath1056 by construction ,",
    "in either case we have @xmath1057 .",
    "let @xmath860 be the as - component of @xmath774 containing @xmath64 ; such an as - component exists by the choice of @xmath492 . as @xmath1058 , by the rectangularity corollary  [ cor : linkage - rectangularity ] @xmath1059 .",
    "since @xmath860 is an as - component in @xmath774 , by lemma  [ lem : as - product ] @xmath1060 is an as - component in @xmath1061 .",
    "in particular @xmath1043 is as - maximal in @xmath1061 .",
    "claim  4 is proved .",
    "@xmath1062 .    to prove this claim we find a subalgebra @xmath1024 of @xmath950 such that it is linked enough and both @xmath1043 and @xmath965 belong to as - components of @xmath1063 , respectively , and",
    "then apply the rectangularity corollary  [ cor : linkage - rectangularity ] .",
    "let @xmath46 be the as - component of the @xmath700-block containing @xmath965 . by claim  3",
    "it is either @xmath1028 or @xmath1023 . since @xmath1061 belongs to a @xmath699-block and @xmath1064 , by the maximality lemma  [ lem : to - max](4 ) for any @xmath1065",
    "there are @xmath1066 such that @xmath1067 .",
    "now consider @xmath1068 .",
    "clearly , @xmath1069 . also , since @xmath716 is as - maximal in a @xmath699-block , by the rectangularity corollary  [ cor : linkage - rectangularity ] @xmath1070 , implying @xmath1071 .",
    "if @xmath1072 denote the link congruences of @xmath1063 with respect to @xmath1024 , the observation above implies that the as - components of @xmath1073 containing @xmath1043 and @xmath716 belong to the same @xmath1074-block , and @xmath46 belongs to a @xmath1075-block . therefore again by the rectangularity corollary  [ cor : linkage - rectangularity ] we get @xmath1076 , in particular @xmath1077 .",
    "thus , there is a polynomial @xmath458 such that @xmath1078 and @xmath1079 .",
    "so far we have proved that for any subtrace @xmath942 , where @xmath64 is a fixed element such that @xmath1080 , there is a polynomial @xmath931 satisfying the conditions stated in the beginning of the proof .",
    "claim 6 . for every @xmath156-subtrace @xmath1032 from @xmath1081 ( recall that @xmath1082 ) there is a polynomial @xmath458 such that @xmath1083 and @xmath1079 .",
    "let us consider @xmath941 as a graph ; we can introduce the distance @xmath1084 of element @xmath1085 from @xmath64 . in particular , all elements from @xmath1048 belong to the connected component containing @xmath64 .",
    "let @xmath1086 denote the set of elements at distance at most @xmath91 from @xmath64 .",
    "by what is proved above there is a composition @xmath1087 of polynomials @xmath931 for @xmath1088 such that @xmath1089 . by lemma  [ lem : minimal - sets](2 )",
    "every @xmath332-preserving polynomial maps every @xmath156-subtrace either to a singleton , or to a @xmath156-subtrace from @xmath941 .",
    "therefore by induction we also get @xmath1090 . therefore composing several copies of @xmath1087 collapses @xmath1091 and @xmath1092 and leaves @xmath799 unchanged .",
    "we now can prove the result in case  1 .",
    "we have proved that for any @xmath156-subtrace @xmath1093 from a @xmath184-block @xmath774 such that @xmath1094 , a polynomial @xmath1095 with the required properties exists .",
    "suppose now that @xmath1096 be any such that @xmath1097 .",
    "take any @xmath1098 such that @xmath1099 . by lemmas  [ lem : qab - tolerance ] and  [ lem : good - polys](5 )",
    "there is an idempotent @xmath332-preserving polynomial @xmath430 such that @xmath1100 . if @xmath1035 , we are done , as @xmath430 may serve as @xmath1095",
    "otherwise , as before consider the relation @xmath1101 generated by @xmath1102=x,\\bz[2]=y\\}$ ] , where @xmath90 is an arbitrary element from @xmath392 , and let @xmath1103 , @xmath1104 , @xmath1105 , and the link congruences @xmath1106 of @xmath1107 with respect to @xmath1108 . recall that @xmath394 is the as - component of @xmath704 containing @xmath799 .",
    "consider relation @xmath1109 . since @xmath1110 by ( q1 ) , by lemma  [ lem : as - square - congruence ] there is @xmath1111 such that @xmath1112 is as - maximal in a @xmath1113-block and @xmath1114 . by the maximality lemma  [ lem : to - max](4 ) there is u - maximal @xmath1115 such that @xmath1116 .",
    "this means that for some @xmath332-preserving polynomial @xmath480 it holds @xmath1117 . by what was proved",
    "there is a polynomial @xmath1118 with @xmath1119 and @xmath1120 .",
    "also , there is a @xmath332-preserving polynomial @xmath631 such that @xmath1121 .",
    "finally , this all implies that @xmath1122 for some @xmath1123 , that is , there is a polynomial @xmath1124 with @xmath1125 , and @xmath1126 , @xmath1127 .",
    "case 2 . for every element @xmath935 from a nontrivial as - component of @xmath704 and any @xmath1128",
    "such that @xmath1129 element @xmath64 belongs to a @xmath184-block @xmath996 such that @xmath1130 or @xmath1131 .",
    "we use the same elements @xmath925 , an as - component of @xmath704 . for",
    "any @xmath930 choose @xmath1098 such that @xmath1132 .",
    "( recall that we are assuming @xmath183 and @xmath198 to be equality relations . )",
    "if @xmath1133 , that is , @xmath1134 , choose @xmath1005 to be an arbitrary element from @xmath704 . by lemmas  [ lem : qab - tolerance ] ,  [ lem : good - polys](5 ) and because @xmath22 is chained there is an idempotent @xmath332-preserving polynomial @xmath430 such that @xmath1100 . let @xmath1135 , @xmath1136 . then @xmath1033 and @xmath1137 .",
    "since @xmath430 is @xmath332-preserving , @xmath1138 .",
    "we again as in case  1 consider the relation @xmath945 generated by @xmath1139=x,\\bz[2]=y\\}$ ] , where @xmath90 is an arbitrary element from @xmath392 , @xmath1140 , @xmath1141 , @xmath1142 , and the link congruences @xmath1143 of @xmath1144 with respect to @xmath950 .",
    "now we complete the proof as in the end of case  1 .    finally , we use polynomials @xmath931 to construct a single polynomial that collapses @xmath184 on @xmath995 for every @xmath184-block @xmath996 .",
    "fix @xmath799 and @xmath931 for every pair @xmath1145 , @xmath1146 .",
    "let @xmath1147 be the list of all such pairs , and if @xmath1148 is the pair number @xmath1149 , @xmath1150 denotes @xmath931 .",
    "take a sequence @xmath1151 such that @xmath1152 , @xmath1153 is a subset of @xmath1154 , and , for @xmath1155 , @xmath1156 is a subset of the range of @xmath1157 . since @xmath1158 , there is @xmath1159 such that @xmath1160 contains no pair @xmath1161 for any @xmath1149 . therefore setting @xmath1162 we have that @xmath458 collapses all the pairs @xmath1161 , and @xmath458 acts identically on @xmath800 .",
    "the result follows .",
    "we say that prime intervals @xmath156 and @xmath204 _ can not be separated _",
    "if @xmath156 can not be separated from @xmath204 and @xmath204 can not be separated from @xmath156 . in this section",
    "we introduce and prove the existence of polynomials that collapse all prime intervals in congruence lattices of factors of a subproduct , except for a set of factors that can not be separated from each other .",
    "[ lem : e - related ] ( 1 ) let @xmath4 be an algebra .",
    "if prime intervals @xmath151 and @xmath157 in @xmath82 are perspective , then they can not be separated .",
    "+ ( 2 ) if @xmath151 and @xmath157 from @xmath82 can not be separated , then a set @xmath405 is a @xmath156-minimal set if and only if it is a @xmath204-minimal set .",
    "+ ( 3 ) let @xmath22 be a subdirect product of @xmath4 and @xmath199 , @xmath150 , @xmath1163 such that @xmath151 , @xmath157 , and let @xmath151 and @xmath157 can not be separated . then for any @xmath156-minimal set @xmath405 there is a unary idempotent polynomial @xmath26 such that @xmath408 and @xmath1164 is a @xmath204-minimal set .",
    "\\(1 ) follows from lemma  [ lem : perspective - intervals ] .",
    "( 2 ) let @xmath26 be a polynomial of @xmath4 such that @xmath408 and @xmath158 . since @xmath156 can not be separated from @xmath204 , we have @xmath1165 and therefore @xmath405 contains a @xmath204-minimal set @xmath1166 .",
    "if @xmath1167 , there is a polynomial @xmath430 with @xmath1168 and @xmath1169 . in particular , @xmath1170 , and so @xmath1171 ; a contradiction with the assumption that @xmath204 can not be separated from @xmath156 .",
    "\\(3 ) take an idempotent polynomial @xmath430 of @xmath22 such that @xmath1172 is a @xmath204-minimal set . then , as @xmath204 can not be separated from @xmath156 , @xmath1173 . by lemma  [ lem : minimal - sets](6 )",
    "there is an @xmath156-minimal set @xmath1174 .",
    "let @xmath1175 be polynomials of @xmath22 such that @xmath1176 , @xmath1177 and @xmath1178 , which exist by lemma  [ lem : minimal - sets](1 ) .",
    "then @xmath1179 is such that @xmath1180 , @xmath1181 and therefore @xmath1182 .",
    "then iterating @xmath483 sufficiently many times we get an idempotent polynomial @xmath26 satisfying the same properties .",
    "let @xmath22 be a subdirect product of @xmath579 , and choose @xmath1183 , @xmath1184 $ ] .",
    "let also @xmath98 $ ] , and @xmath845 be such that @xmath846 ; let also @xmath1185 be a @xmath1186-block .",
    "we call an idempotent unary polynomial @xmath26 of @xmath22 _ @xmath1187-collapsing for @xmath855 _ if @xmath26 is @xmath332-preserving , @xmath158 , @xmath1188 for every @xmath869 , @xmath1184 $ ] , with @xmath870 , and such that @xmath156 can be separated from @xmath204 or @xmath204 can be separated from @xmath156 , and @xmath1189 is minimal possible .",
    "[ lem : collapsing ] let @xmath22 , @xmath1190 , and @xmath1186 , @xmath1184 $ ] , be as above and @xmath22 chained with respect to @xmath855 .",
    "let also @xmath917 .",
    "then if @xmath1191 and @xmath1192 contains a nontrivial as - component , then there exists an @xmath1187-collapsing polynomial for @xmath855 .",
    "suppose @xmath1193 , let @xmath1194 and @xmath185 be a nontrivial as - component of @xmath1195 . take a @xmath156-subtrace @xmath1196 such that @xmath1197 . since @xmath22 is chained with respect to @xmath855 , by ( q1 ) and lemma  [ lem : good - polys](5 ) there is a @xmath332-preserving idempotent polynomial @xmath26 of @xmath22 such that @xmath1198 is an @xmath156-minimal set and @xmath1199 .",
    "let polynomial @xmath26 be such that @xmath1200 is minimal possible .",
    "we show that @xmath26 is @xmath1187-collapsible .",
    "let @xmath1184 $ ] and @xmath869 be such that @xmath870 , and @xmath423 can be separated .",
    "since @xmath22 is chained , by lemma  [ lem : relative - symmetry ] there is an idempotent unary @xmath332-preserving polynomial @xmath1201 of @xmath22 such that @xmath1202 is an @xmath156-minimal set with @xmath1203 and @xmath1204 .",
    "then if @xmath1205 , then let @xmath1206 .",
    "we have @xmath1173 , but @xmath1207 implying @xmath1208 , a contradiction with minimality of @xmath1200 .      in this section",
    "we show a connection between the fact that two prime intervals can not be separated , their types , and link congruences .",
    "[ lem:34-links ] let @xmath22 be a subdirect product of @xmath4 and @xmath199 and let @xmath150 , @xmath203 be such that @xmath151 , @xmath157 , and @xmath423 can not be separated .",
    "let also @xmath678 be the link congruences of @xmath347 , respectively .",
    "if @xmath1209 then @xmath1210 , @xmath1211 .",
    "assume as usual @xmath1212 , @xmath1213 .",
    "by lemma  [ lem : e - related](3 ) there is a unary polynomial @xmath26 such that @xmath1214 , @xmath1215 are @xmath1216- and @xmath1217-minimal sets , respectively .",
    "we first study the structure of @xmath1218 and then show how it can be used to prove the lemma . by @xmath1219",
    "we denote the only trace of @xmath1220 ; by @xmath941 we denote the tail of @xmath1220 . by lemma  [ lem : pseudo - meet ]",
    "there is a polynomial @xmath1221 with @xmath1222 and such that @xmath510 is a semilattice operation on @xmath1223 , say , @xmath1224 , and @xmath510 is a semilattice operation on @xmath1225 with @xmath1226 for any @xmath1227 .",
    "there are two cases .",
    "@xmath1228 .",
    "let @xmath1229 be the trace of @xmath1230 and @xmath1231 the tail of @xmath1230 .",
    "we may assume @xmath1232 .",
    "observe first that @xmath510 preserves @xmath1233 . indeed , otherwise @xmath1234 is not a permutation , as @xmath1235 belong to the same @xmath1236-block , and if they do not belong to @xmath1233 then they are all equal , a contradiction with the assumption that @xmath1237 and @xmath1238 can not be separated .",
    "a binary operation on a 2-element set is either a projection , or a semilattice operation .",
    "suppose first that @xmath510 is a projection , say , the first projection on @xmath1233 .",
    "if @xmath1239 , say , @xmath1240 , then @xmath1241 satisfies the conditions : @xmath1242 , that is , @xmath1243 , and @xmath1244 on @xmath1233 ; a contradiction that @xmath204 can not be separated from @xmath156 .",
    "if @xmath1245 , say , @xmath1246 , then @xmath1247 satisfies the conditions : @xmath1244 on @xmath1248 , that is , @xmath1249 , and @xmath1250 on @xmath1233 ; a contradiction that @xmath156 can not be separated from @xmath204 .",
    "therefore , for some @xmath1227 , @xmath1251 .",
    "the operation @xmath1252 is the projection on @xmath1233 and @xmath1253 ; a contradiction again .",
    "suppose now that @xmath510 is a semilattice operation on @xmath1233 .",
    "let @xmath1254 be the neutral element of @xmath510 .",
    "if @xmath1251 for some @xmath1227 , then @xmath1255 is the projection on @xmath1233 , and @xmath1253 .",
    "if @xmath1251 for no @xmath1227 , then we continue as follows .",
    "if @xmath1256 or @xmath1257 belong to @xmath22 , then one of the operations @xmath1258 and @xmath1259 contradicts the assumption that @xmath1260 can not be separated",
    ". therefore @xmath1261 .",
    "suppose that either @xmath1262 or @xmath1263 , where @xmath678 are the link congruences of @xmath347 with respect to @xmath22 .",
    "assume the latter .",
    "then , as @xmath1264 , there is a @xmath1265-trace @xmath1223 such that @xmath1266 .",
    "this means there are @xmath1267 and @xmath1268 with @xmath1269 , and @xmath1270 . take a polynomial @xmath26 of @xmath22 such that @xmath1271 , @xmath1272 are @xmath1273- , and @xmath1265-minimal sets , respectively , and such that @xmath1230 is a @xmath1265-minimal set containing @xmath1223 as a trace and @xmath1274 .",
    "then , as is easily seen , @xmath1218 does not have the form described above .",
    "thus , @xmath1275 and @xmath1276 .",
    "@xmath1277 .    as in case  1 , since @xmath1278 on @xmath1230 , operation @xmath510 preserves every trace of @xmath1230 .",
    "let @xmath1233 be a trace in @xmath1230 .",
    "then @xmath1233 is polynomially equivalent to a one - dimensional vector space over @xmath1279 where @xmath1280 is a prime power .",
    "since @xmath510 is idempotent , it can be represented in the form @xmath1281 , @xmath1282 .",
    "we may assume that @xmath1283 .",
    "indeed , if @xmath1284 then consider @xmath1285 instead of @xmath1221 . otherwise , the operation @xmath1286 satisfies the required conditions .",
    "now we can complete the proof as in case  1 .",
    "the proof of lemma  [ lem:34-links ] also implies    [ cor : type - equal ] let @xmath22 be a subdirect product of @xmath4 and @xmath199 and let @xmath150 , @xmath203 be such that @xmath151 , @xmath157 , and @xmath423 can not be separated",
    ". then @xmath428 .",
    "in this section we introduce an operator on congruence lattices similar to the centralizer in commutator theory , and study its properties and its connection to decompositions of csps .      for an algebra @xmath4 , a term operation @xmath165 , and @xmath166 ,",
    "let @xmath167[not : f - a ] .",
    "let @xmath150 , @xmath168 , and let @xmath169[not : zeta ] denote the following binary relation : @xmath170 if an only if , for any term operation @xmath165 , any @xmath171 $ ] , and any @xmath172 such that @xmath92=a$ ] , @xmath173=b$ ] , and @xmath174=\\bb[j]$ ] for @xmath175 , it holds @xmath176 if and only if @xmath177 .    [ lem : delta - properties ] for any @xmath150 , @xmath168 : + ( 1 ) @xmath178 is an equivalence relation .",
    "+ ( 2 ) @xmath178 is the greatest binary relation @xmath389 satisfying the condition : for any term operation @xmath165 , and any @xmath172 such that @xmath1287,\\bb[j])\\in\\dl$ ] for @xmath1288 $ ] , it holds @xmath176 if and only if @xmath177 . + ( 3 ) @xmath178 is a congruence of @xmath4",
    ". appeared in @xcite , but completely inconsequentially , they did not study it at all .",
    "it is easy to see , thanks to k.kearnes , that @xmath178 is greater than the centralizer of @xmath183 and @xmath184 , but the reverse inclusion is unclear . ]",
    "\\(1 ) @xmath178 is clearly reflexive and symmetric .",
    "suppose @xmath1289 .",
    "let @xmath165 be a term operation , @xmath171 $ ] , and @xmath1290 such that @xmath92=a,\\bc[i]=c$ ] and @xmath174=\\bc[j]$ ] for @xmath175 .",
    "let @xmath1291 be such that @xmath173=b$ ] and @xmath1292=\\ba[j]$ ] for @xmath175 .",
    "then @xmath176 if and only if @xmath177 , which is if and only if @xmath1293 .    \\(2 ) as is easily seen , @xmath389 is reflexive . choosing @xmath1294 that differ in only one position , we show that @xmath1295 .",
    "let us show the reverse inclusion .",
    "let @xmath1296 be as in item ( 2 ) of the lemma , except @xmath1297,\\bb[i])\\in\\zeta(\\al,\\beta)$ ] , rather than @xmath389 .",
    "set @xmath1298 , @xmath1299 , as follows : @xmath1300=\\ba[j]$ ] for @xmath1301 and @xmath1300=\\bb[j]$ ] for @xmath1302",
    ". then @xmath1303 if and only if @xmath1304 .",
    "thus , @xmath176 if and only if @xmath177 .",
    "\\(3 ) by ( 1 ) @xmath178 is an equivalence relation , so , we only need to show it is preserved by term operations .",
    "let @xmath1305 be a term operation and @xmath1306 such that @xmath1297,\\bb[i])\\in\\zeta(\\al,\\beta)$ ] for @xmath1307 $ ] .",
    "let also @xmath1308 and @xmath1309 .",
    "we show that @xmath170 .",
    "take a term operation @xmath165 , @xmath171 $ ] , and @xmath1310 such that @xmath1311=a,\\bb'[i]=b$ ] , and @xmath1312,\\bb'[j])\\in\\zeta(\\al,\\beta)$ ] for @xmath175 . without loss of generality , @xmath1313 .",
    "let also @xmath1314 and @xmath1315\\zd\\ba'[k-1],\\ba[1]\\zd\\ba[m])$ ] , @xmath1316\\zd\\bb'[k-1],\\bb[1]\\zd\\bb[m])$ ] .",
    "then @xmath1317,\\bb''[j])\\in\\zeta(\\al,\\beta)$ ] for all @xmath1318 $ ] .",
    "therefore @xmath1319 if and only if @xmath1320 .",
    "the congruence @xmath178 will be called the _ quasi - centralizer _ of @xmath1190 .",
    "next we prove several properties of quasi - centralizer similar to some extent to the properties of the regular centralizer .",
    "the following statement is one of the key ingredients of the algorithm .",
    "[ pro : full - centralizer ] if @xmath1321 , then @xmath156 has type , and for any @xmath184-blocks @xmath399 such that @xmath1322 in @xmath1323 ( that is @xmath1324 is a thin semilattice edge in @xmath1323 ) and they belong to the same @xmath178-block , there is an injective mapping @xmath1325 such that for any @xmath1326 , @xmath1327 and @xmath1328 for any other @xmath1329 .",
    "clearly , we may assume @xmath1330 .",
    "suppose that @xmath1321 , and suppose first that @xmath1331 .",
    "take any @xmath1332-minimal set @xmath405 , its only trace @xmath1223 , and a pseudo - meet operation @xmath510 on @xmath405 .",
    "then the polynomial @xmath1333 does not collapse @xmath184 , as @xmath1334 , @xmath1335 , while the polynomial @xmath1336 does , a contradiction with the assumption @xmath1321 .",
    "suppose now that @xmath1337 .",
    "then by corollary  [ cor : max - min - set](1 ) for any @xmath139 with @xmath1146 , there is a @xmath1332-minimal set @xmath405 such that @xmath439 .",
    "let @xmath399 be @xmath184-blocks and @xmath1322 in @xmath1323 .",
    "by lemma  [ lem : thin](1 ) for any @xmath546 there is @xmath1329 with @xmath468 .",
    "suppose the statement of the proposition is not true .",
    "then there are two possibilities .",
    "\\1 . for some @xmath186 and @xmath187 , @xmath1338 .",
    "let @xmath26 be a polynomial such that @xmath1339 is a @xmath1332-minimal set and @xmath1340 .",
    "consider @xmath1341 and @xmath1342 .",
    "clearly , @xmath1343 , so @xmath1344 . on the other hand , @xmath1345 , that is , @xmath1346 , as @xmath1347 , a contradiction with the assumption @xmath1348 .    \\2 .",
    "for some @xmath1349 and @xmath1350 , @xmath1351 .",
    "let @xmath26 be a polynomial such that @xmath1339 is a @xmath1332-minimal set and @xmath1340 .",
    "consider @xmath1352 and @xmath1353 .",
    "clearly , @xmath1354 , so @xmath1355 , as @xmath1356 . on the other hand , @xmath1357 , that is , @xmath1358 a contradiction again .",
    "[ cor : centralizer - multiplication ] let @xmath179 , @xmath180 and @xmath1359 .",
    "then @xmath1360 .",
    "we have @xmath1361 and @xmath1362 . by proposition",
    "[ pro : full - centralizer ] @xmath1360 .",
    "recently , payne @xcite designed a polynomial time algorithm for the following class of algebras : every algebra @xmath4 from this class has a congruence @xmath183 such that @xmath557 is a semilattice , and the interactions between @xmath183-blocks satisfy a certain condition .",
    "it seems that lemma  [ pro : full - centralizer ] is similar to what this condition can provide .",
    "an injective mapping between @xmath184-blocks @xmath399 inside a @xmath178-block can also be established whenever @xmath1324 is any thin edge in @xmath1323 , as the following lemma shows .",
    "[ lem : central - mapping ] let @xmath150 such that @xmath1363 and let @xmath399 be @xmath184-blocks from the same @xmath1364-block such that @xmath1324 is a thin edge in @xmath1323 . for any @xmath1365 such that @xmath1366 is a thin edge the polynomial @xmath1367 if @xmath1368 , @xmath1369 if @xmath1366 is majority , and @xmath1370 if @xmath1366 is affine , where @xmath1371 are the operations from lemma  [ lem : op - s - on - affine ] , is an injective mapping from @xmath637 to @xmath1372 .",
    "we can assume that @xmath183 is the equality relation .",
    "suppose @xmath1373 for some @xmath1374 .",
    "since @xmath418 , by corollary  [ cor : max - min - set](1 ) every pair of elements of @xmath51 is an @xmath156-subtrace .",
    "let @xmath1015 be an idempotent unary polynomial such that @xmath1375 , @xmath1376 , and @xmath1377 is an @xmath156-minimal set .",
    "if @xmath1368 , let @xmath1378 . then @xmath1379 on @xmath1380 , that is , @xmath1381 implying @xmath1382 . on the other hand , @xmath1383 on @xmath1380 implying @xmath1384 , a contradiction with the assumption @xmath1385 .    if @xmath1366 is a thin majority edge , set @xmath1386",
    ". then @xmath1387 , and so @xmath1382 .",
    "on the other hand , since @xmath637 is a module , @xmath1388 are affine edges and @xmath183 witnesses that .",
    "therefore @xmath1389 and @xmath1390 , implying @xmath1384 , and we have a contradiction again .    finally , if @xmath1366 is a thin affine edge , we consider the polynomials @xmath1391 and @xmath1392 , @xmath1393 .",
    "again , @xmath1394 , while @xmath1395 since by lemma  [ lem : op - s - on - affine ] @xmath1396 is a permutation .",
    "this implies that @xmath1397 and @xmath1398 , a contradiction .",
    "[ lem : equal - centralizer ] let @xmath150 be such that @xmath151 and @xmath418 , and @xmath1399 . then for any @xmath184-blocks",
    "@xmath696 that belong to the same @xmath1364-block @xmath185 and such that @xmath1400 and @xmath1401 in @xmath1402 , @xmath1403 .",
    "since there is an asm - path from @xmath701 to @xmath770 and back , the result follows from lemma  [ lem : central - mapping ] .",
    "let @xmath4 be an algebra and @xmath150 , @xmath151 .",
    "element @xmath546 is said to be _",
    "@xmath1187-minimal _ if it belongs to an @xmath156-trace .",
    "let @xmath1404[not : emin ] denote the set of all @xmath1187-minimal elements of @xmath4 . by lemma  [ lem : minimal - sets](5 )",
    "@xmath1404 intersects every @xmath183-block from a nontrivial @xmath184-block .",
    "the following lemma shows that @xmath1404 can be much larger than that . due to",
    "the way we will use it in the future the statement of the lemma is not quite straightforward .",
    "[ lem : maximal - minimal ] let @xmath424 be such that @xmath1405 , @xmath151 , intervals @xmath423 can not be separated , and @xmath418 ; let @xmath51 be a @xmath184-block . if @xmath1406 then for any @xmath1407 such that @xmath565 in @xmath51 , @xmath1408 .    in particular , @xmath1409 .",
    "moreover , if @xmath792 , @xmath565 in @xmath790 , and @xmath26 is a polynomial such that @xmath1410 , @xmath397 is an @xmath156-minimal set , and @xmath1223 its trace with @xmath1411 , then there is a polynomial @xmath430 such that @xmath1412 , @xmath1413 is an @xmath156-minimal set , @xmath1414 is its trace containing @xmath74 and @xmath1415 .",
    "let @xmath26 be an idempotent unary polynomial of @xmath4 such that @xmath1411 , a trace in @xmath1339 , a @xmath204-minimal set .",
    "note that @xmath1416 and @xmath158 .",
    "it suffices to consider the case when @xmath189 is a thin edge .",
    "depending on the type of the edge @xmath189 we set @xmath1417 , @xmath1418 , or @xmath1419 , if @xmath189 is semilattice , majority or affine , respectively .",
    "note also that by lemma  [ lem : op - s - on - affine ] @xmath1420 , and therefore if @xmath1421 we have @xmath1377 is a @xmath204-minimal set , and @xmath74 belongs to it .",
    "since @xmath156 and @xmath204 can not be separated , by lemma  [ lem : e - related](2 ) @xmath405 is an @xmath156-minimal set .",
    "hence , there are @xmath1422 such that @xmath1423 and @xmath1424 . since @xmath1425 is an affine edge in @xmath1426 , depending on the type of @xmath189 we have : +  if @xmath468 , then @xmath1427 for @xmath1428 ; +  if @xmath189 is majority , then @xmath1429 , as @xmath1430 for @xmath1428 and by lemma  [ lem : op - s - on - affine](1 ) ; +  if @xmath189 is affine , then by lemma  [ lem : op - s - on - affine](2 ) @xmath1431 is a permutation on @xmath637 , in particular , @xmath1432 .",
    "+ in either case we obtain @xmath1433 , implying @xmath1421 .",
    "for the last claim of the lemma it suffices to notice that if @xmath792 then @xmath1434 for @xmath1435 .      in this section we show that if intervals in congruence lattices of domains in a csp instance can not be separated , they induce certain decomposition of the instance or its subinstances .",
    "the components of this decomposition are instances over smaller domains , which are , actually , blocks of the corresponding quasi - centralizers .",
    "let @xmath22 be a subdirect product of @xmath160 , @xmath161 $ ] , and @xmath362 , @xmath1436 .",
    "the coordinate positions @xmath1260 are said to be _",
    "@xmath1437-aligned in @xmath22 _ if , for any @xmath1438 , @xmath1439 if and only if @xmath1440 . or in other words , the link congruences of @xmath164 with respect to @xmath1441 are no greater than @xmath1442 , respectively .    [",
    "lem : delta - alignment ] let @xmath22 be a subdirect product of @xmath633 , @xmath828 , @xmath813 , for @xmath1428 . if @xmath1237 and @xmath1238 can not be separated from each other , then the coordinate positions 1,2 are @xmath1443-aligned in @xmath22 .",
    "let us assume the contrary , that is , without loss of generality there are @xmath1444 and @xmath1445 with @xmath194 , @xmath1446 , but @xmath1447 .",
    "therefore there is @xmath1448 , a term operation of @xmath677 , @xmath171 $ ] , and @xmath1449 with @xmath1450=c$ ] , @xmath1451=d$ ] and @xmath1452=\\bd[j]$ ] for @xmath175 , such that @xmath1453 but @xmath1454 , or the other way round . extend @xmath430 to a term operation @xmath430 of @xmath22 , and choose @xmath1455 such that @xmath92=a,\\bb[i]=b$ ] , @xmath174=\\bb[j]$ ] for @xmath175 , and @xmath1287,\\bc[j ] ) , ( \\bb[j],\\bd[j])\\in\\rel$ ] for @xmath1288 $ ] . then @xmath1456 if and only if @xmath1457",
    "therefore , there is a polynomial of @xmath22 that separates @xmath1237 from @xmath1238 or the other way round , a contradiction .",
    "let @xmath17 be a ( 2,3)-minimal instance , in particular , for every @xmath116 , @xmath117 , it contains a constraint @xmath1458 .",
    "let @xmath1459 .",
    "we say that @xmath1460 are _",
    "@xmath1461-aligned _ in @xmath21 , where @xmath1462 , @xmath1463 , if they are @xmath1461-aligned in @xmath1464 . for @xmath1465 , @xmath108 ,",
    "instance @xmath21 is said to be _",
    "@xmath363-aligned _ if every @xmath1460 are @xmath1466-aligned .",
    "this means that there are one - to - one mappings @xmath1467 such that whenever @xmath1468 , @xmath1469 .",
    "observe that since @xmath21 is ( 2,3)-minimal , these mappings are consistent , that is , for any @xmath1470 , @xmath1471 .",
    "therefore @xmath21 can be represented as a disjoint union of instances @xmath226 , where @xmath14 is the number of @xmath230-blocks for any @xmath108 and the domain of @xmath108 of @xmath228 is the @xmath91-th @xmath230-block .",
    "let again @xmath17 be a ( 2,3)-minimal instance and let @xmath304 , @xmath238 , @xmath108 , be a collection of congruences .",
    "let @xmath239[not : cw ] denote the set of triples @xmath240 such that @xmath108 , @xmath241 , and @xmath242 .",
    "also , @xmath243 denotes @xmath239 when @xmath264 for all @xmath108 .",
    "we will omit the superscript @xmath21 whenever it is clear from the context .",
    "for every @xmath245 , let @xmath1472 denote the set of triples @xmath317 such that @xmath156 and @xmath204 can not be separated in @xmath248 . slightly abusing the terminology we will also say that @xmath156 and @xmath204 can not be separated in @xmath21 . then let @xmath1473[not : w - v - albeta - beta ] .",
    "we will omit the subscript @xmath304 whenever possible .",
    "the following statement is an easy corollary of lemma  [ lem : delta - alignment ] .    [",
    "the : centralizer - alignement ] let @xmath17 be a ( 2,3)-minimal instance and @xmath263 . for @xmath1474 , where @xmath264 for @xmath108 , let @xmath1475 be such that @xmath156 and @xmath204 can not be separated and @xmath1476",
    ". then @xmath265 is @xmath1477-aligned .",
    "this section contains several technical results that will be used when proving of the soundness of the algorithm .",
    "the main result is the congruence lemma  [ lem : affine - link ] .",
    "lemmas  [ lem : max - nontrivial ] and  [ lem : dirprod - propagation ] are auxiliary and only used in the proof of the congruence lemma  [ lem : affine - link ] .",
    "we start with introducing two closure properties of algebras and their subdirect products , this time under certain polynomials .",
    "we say that a set @xmath7 is _ as - closed _ in algebra @xmath199 , @xmath1478 , if @xmath1479 and , for every @xmath1480 such that @xmath1481 in @xmath199 and @xmath1482 , element @xmath74 also belongs to @xmath7 .",
    "let @xmath22 be a subdirect product of @xmath494 and @xmath727 a subalgebra of @xmath22 .",
    "we say that @xmath727 is _ polynomially closed _ in @xmath22 if for any polynomial @xmath26 of @xmath22 the following condition holds : for any @xmath1483 such that @xmath1484 and for any @xmath1485 such that @xmath1486 in @xmath1487 , the tuple @xmath1488 belongs to @xmath727 .",
    "polynomially closed subalgebras of maltsev algebras are congruence blocks . in the general case",
    "the structure of polynomially closed subalgebras is more intricate .",
    "the intuition ( although not entirely correct ) is that if for some block @xmath51 of a congruence @xmath184 and a congruence @xmath183 with @xmath151 the set @xmath637 contains several as - components , a polynomially closed subalgebra contains some of them and has empty intersection with the rest .",
    "however , since this is true only for factor sets , and we do not even consider non - as - maximal elements , the actual structure is more ` fractal '",
    ".    the following lemma follows from the definitions , lemma  [ lem : thin ] , and the fact that congruences are invariant under polynomials .",
    "[ lem : poly - closed ] ( 1 ) let @xmath22 be a subdirect product of @xmath494 and @xmath984 relations polynomially closed in @xmath22 , and @xmath1489 . then @xmath1490 is polynomially closed in @xmath22 .    in particular ,",
    "let @xmath840 and @xmath841 a u - maximal @xmath842-block .",
    "then @xmath1491 is polynomially closed in @xmath22 .    if @xmath984 are as - closed in @xmath22 , then @xmath1490 is as - closed in @xmath22 . +",
    "( 2 ) let @xmath1492 be polynomially closed in @xmath1493 , @xmath171 $ ] , and let @xmath1494 be pp - defined through @xmath1495 and @xmath1496 , respectively , by the same pp - formula @xmath1497 ; that is , @xmath1498 and @xmath1499 .",
    "let also for every atom @xmath1500 and any @xmath1501 there is @xmath293 with @xmath1502 , and also @xmath1503 .",
    "then @xmath727 is polynomially closed in @xmath22 .",
    "if @xmath1492 is as - closed in @xmath1493 then @xmath727 is as - closed in @xmath22 .",
    "+ ( 3 ) let @xmath22 be a subdirect product of @xmath494 , @xmath840 , @xmath98 $ ] , and let @xmath727 be polynomially closed in @xmath22 .",
    "then @xmath1504 is polynomially closed in @xmath22 .",
    "if @xmath727 is as - closed in @xmath22 then @xmath1504 is as - closed in @xmath1505 .",
    "the first two lemmas in the rest of this section study the structure of binary relations that have in their domains a pair of prime intervals of type  that can not be separated .",
    "they show that if we restrict ourselves to blocks of the link congruences then this structure is very uniform .",
    "the third lemma , lemma  [ lem : affine - link ] ( the congruence lemma ) , is an important technical result . to explain what it amounts to saying consider this : let @xmath1506 be a subdirect product and the link congruence of @xmath453 is the equality relation",
    "then , clearly , @xmath727 is the graph of a mapping @xmath1507 , and the kernel of this mapping is the link congruence @xmath465 of @xmath452 with respect to @xmath727 .",
    "suppose now that @xmath727 is a subalgebra of @xmath22 , a subdirect product of @xmath190 such that @xmath453 is a subalgebra of @xmath4 and @xmath452 is a subalgebra of @xmath199 .",
    "then the restriction of the link congruence of @xmath4 with respect to @xmath22 to @xmath453 does not have to be the equality relation , and similarly the restriction of the link congruence of @xmath199 to @xmath452 does not have to be @xmath465 .",
    "most importantly , the restriction of @xmath1508 , the congruence of @xmath199 generated by @xmath465 , to @xmath452 does not have to be @xmath465 .",
    "the congruence lemma  [ lem : affine - link ] shows , however , that this is exactly what happens when @xmath727 and @xmath1509 satisfy some additional conditions , such as being chained and polynomially closed .    in the next two lemmas let @xmath22 be a subdirect product of @xmath633 , @xmath1510 congruences of @xmath634 and @xmath696 @xmath1511- and @xmath1236-blocks , respectively ; @xmath22 is chained with respect to @xmath1512 and @xmath1513 , @xmath1514 .",
    "let @xmath920 , @xmath921 be such that @xmath918 , @xmath1515 , @xmath1516 , and @xmath423 can not be separated .",
    "let also @xmath1517 , @xmath1518 and @xmath1143 the link congruences of @xmath1519 , respectively , with respect to @xmath1520 .",
    "let @xmath1521 be @xmath1522- , @xmath1523-blocks such that @xmath1524 and @xmath1521 contain nontrivial @xmath184- and @xmath389-blocks @xmath470 , respectively ( that is , @xmath1525 ) .    by lemma  [ lem : equal - centralizer ]",
    "all the @xmath184-blocks @xmath1526 , @xmath1527 in @xmath46 ( respectively , all @xmath389-blocks @xmath1528 , @xmath1529 in @xmath1530 ) are also nontrivial .",
    "note that by lemma  [ lem : delta - alignment ] @xmath1531 and @xmath1532 .",
    "let also @xmath1533 be blocks of @xmath1143 such that @xmath1534 .",
    "the first lemma claims that for the link congruence @xmath1535 there are only two options : either it is a subset of @xmath198 on the @xmath1523-block @xmath1530 , or it contains @xmath1536 on @xmath1537 .",
    "[ lem : max - nontrivial ] suppose that @xmath1538 and that @xmath1535 is nontrivial on the @xmath389-block @xmath51 , that is , there are distinct @xmath1539 with @xmath1540 , or equivalently @xmath1541 is not a subset of @xmath198 on @xmath1542 .",
    "then + ( 1 ) if @xmath1543 then @xmath1544 ; and + ( 2 ) any @xmath1528 with @xmath1529 in @xmath1545 is nontrivial , that is , @xmath1546 . in particular , @xmath1547 and @xmath1548 do not intersect any trivial @xmath184- and @xmath389-blocks , respectively .    since @xmath1531 and @xmath1532 ,",
    "( 2 ) follows by lemma  [ lem : equal - centralizer ] .",
    "also , as @xmath1535 is nontrivial on a @xmath389-block , we obtain ( 1 ) by lemma  [ lem : link - separability ] .",
    "the second lemma amounts to saying that if @xmath1535 is nontrivial on @xmath1530 then it not only contains @xmath389 ( modulo @xmath198 ) , but also that if an element of @xmath46 is related by @xmath22 to some element of a @xmath389-block @xmath51 , it is also related to the entire @xmath51 ( again , modulo @xmath198 ) .    [",
    "lem : dirprod - propagation ] suppose @xmath1544 and sets @xmath470 satisfy one of the following two conditions : + ( 1 ) let @xmath1549 be @xmath184- and @xmath389-blocks , respectively , such that @xmath1550 , or + ( 2 ) let @xmath470 be @xmath184- , and @xmath389-blocks , respectively , and such that @xmath1551 and @xmath1552 . +",
    "then either @xmath1553 , or for any @xmath1554 with @xmath1555\\ne\\eps$ ] we have @xmath1556 .",
    "note that in condition ( 2 ) @xmath686 does not have to contain u - maximal elements of @xmath46 , and similarly @xmath774 does not have to contain u - maximal elements of @xmath1530 .",
    "thus , ( 1 ) is not necessarily a more general condition .",
    "we prove the lemma for condition ( 2 ) , that is , when @xmath1552 .",
    "it will be clear that case ( 1 ) follows from the same argument .",
    "we assume @xmath1557 .",
    "since @xmath51 is a module , it is as - connected . therefore if some element of @xmath51 belongs to an as - component of @xmath774 , the whole set @xmath51 is contained in that as - component . by the rectangularity corollary  [ cor : linkage - rectangularity ] , this means that if @xmath1558 for @xmath1559 , then @xmath1560 , and the result for @xmath51 follows .",
    "now we show that if @xmath1560 for some @xmath687 and @xmath1561 then @xmath1562 for any @xmath1563 and @xmath1564 such that @xmath1565 is a thin edge in @xmath1566 for some @xmath1407 .",
    "as is easily seen this implies the result .",
    "there are 3 possible cases .",
    "@xmath1567 , that is @xmath464 is a thin edge and @xmath1568 , @xmath1569 .",
    "then @xmath1570 .",
    "this case follows from lemma  [ lem : as - rectangularity ] .",
    "@xmath1571 , that is , @xmath1572 is a thin edge in @xmath1573 where @xmath1574 and @xmath1575 .",
    "let @xmath1576 be the unary polynomial of @xmath22 constructed as in lemma  [ lem : central - mapping ] , that is , @xmath1577 , @xmath1578 , or @xmath1579 , depending on the type of @xmath1580 . then by lemma  [ lem : central - mapping ] @xmath1581 is a bijection , and therefore maps @xmath1560 onto @xmath1582 , implying @xmath1583 .",
    "@xmath464 and @xmath1580 are thin edges of the same type .",
    "let @xmath1574 .",
    "similar to case  2 depending on the type of @xmath464 we consider polynomial @xmath1584 , @xmath1585 , or @xmath1586 for some @xmath1407 .",
    "we have @xmath1587 and @xmath1581 is a bijection by lemma  [ lem : central - mapping ] , thus proving that @xmath1588 .",
    "if condition ( 1 ) holds the prove is essentially the same , except we need to use the same starting point as above , and consider pairs from @xmath1589 .",
    "we are now in a position to state and prove the main result of the section .",
    "let again @xmath22 be a subdirect product of @xmath633 , @xmath1510 congruences of @xmath634 and @xmath696 @xmath1511- and @xmath1236-blocks , respectively .",
    "also , let @xmath22 be chained with respect to @xmath1512 and @xmath1513 , @xmath1514 .",
    "let @xmath920 be such that @xmath918 .",
    "this time we do not assume that @xmath418 .",
    "[ lem : affine - link ] suppose @xmath1590 and let @xmath392 be a polynomially closed subalgebra of @xmath1520 and such that @xmath1194 contains an as - component @xmath185 of @xmath1591 and @xmath1592 .",
    "then either + ( 1 ) @xmath1593 , where @xmath1594 $ ] , or + ( 2 ) there is @xmath1595 with @xmath1596 such that intervals @xmath1597 and @xmath1598 can not be separated .",
    "+ moreover , in case ( 2 ) @xmath1599 is the graph of a mapping @xmath1600 such that the kernel of @xmath283 is the restriction of @xmath465 on @xmath1601 .",
    "note that if @xmath1602 , the lemma is trivially true .",
    "let @xmath1603 .",
    "we assume @xmath1604 for any congruence @xmath1605 ; otherwise replace @xmath1236 with @xmath1606 .",
    "let @xmath1607 be the link congruences of @xmath1045 with respect to @xmath392 .",
    "let @xmath1608 be such that @xmath1609 and @xmath465 is maximal among congruences of @xmath677 with this property .",
    "we show that either @xmath1610 or it is one of the congruences in item ( 2 ) of the lemma .",
    "if @xmath465 is the full relation on @xmath1611 , we are done by proposition  [ pro : umax - rectangular ] ; otherwise there are two cases .",
    "case 1 . for some @xmath1612 with @xmath1613 the intervals @xmath1614 can be separated .    in this case",
    "we prove that @xmath465 has to be @xmath1236 and we have option  ( 1 ) of the lemma .",
    "since @xmath22 is chained , by lemmas  [ lem : good - polys](4 ) and  [ lem : collapsing ] there is a set @xmath1615 of @xmath1616-subtraces such that any pair of elements from @xmath1617 belongs to the transitive closure of @xmath420 , and for any @xmath1618 there is a @xmath1619-preserving polynomial @xmath26 such that @xmath1620 , and @xmath1621 .",
    "this means that @xmath185 belongs to the @xmath1622-block of @xmath1591 , where @xmath1622 is the link congruence with respect to @xmath1623",
    ". therefore @xmath1624)\\fac\\eta\\sse\\rel^*\\fac\\eta$ ] .",
    "observe that as @xmath1625 , the link congruence of @xmath1591 with respect to @xmath1520 restricted to @xmath185 contains @xmath1626 .",
    "therefore , we also have @xmath1624)\\sse\\rel^*$ ] .",
    "note that by the assumption @xmath1592 of the lemma both @xmath1627 $ ] and @xmath704 contain a u - maximal element from @xmath1628 . since @xmath1629 $ ] , by lemma  [ lem : u - max - congruence ] we have @xmath1630)$ ] .",
    "therefore @xmath1631 .",
    "we are going to argue that the same inclusion holds for @xmath392 .",
    "but first we show that for any thin semilattice or affine edge @xmath189 of @xmath185 and any @xmath1632)$ ] there is a polynomial @xmath430 such that @xmath1633 , @xmath1621 , and @xmath1036 .",
    "note that since @xmath22 is chained , all such pairs @xmath142 belong to @xmath420 . since every pair of elements of @xmath185 is a @xmath1616-subtrace , again , as @xmath22 is chained , and by lemma  [ lem : good - polys](5 ) this is true for some @xmath1634 $ ] .",
    "suppose @xmath1635 is a thin edge in @xmath1627 $ ] ; by lemma  [ lem : as - rectangularity ] this implies that @xmath1636 .",
    "then as in lemma  [ lem : maximal - minimal ] we find a polynomial satisfying the required properties for @xmath1637 . specifically , @xmath1638 , @xmath1639 , and @xmath1640 , where @xmath463 and @xmath458 are the operations from lemma  [ lem : op - s - on - affine](3 ) , depending on the type of @xmath1635 and @xmath189",
    "now we are back to proving that @xmath1593 .",
    "observe that @xmath1641 is the graph of a bijective mapping @xmath1642 .",
    "take @xmath714 and @xmath1643 such that @xmath1644 , @xmath189 is a thin semilattice or affine edge and @xmath1645 .",
    "let also @xmath1646 .",
    "by what is proved there is a polynomial @xmath26 of @xmath22 such that @xmath1274 , @xmath1647 , and @xmath1621 .",
    "in particular , @xmath1648 . since @xmath1644 and @xmath1649 or @xmath1650 is an affine edge for some @xmath1651 , we obtain @xmath1652 , as @xmath392 is polynomially closed .",
    "since @xmath1653 and @xmath1654 , we get a contradiction with @xmath1645 .",
    "case 2 . for all @xmath1612 with @xmath1613 the intervals @xmath1614 can not be separated .",
    "suppose @xmath1655 . without loss of generality",
    "let @xmath1656 .",
    "then there are @xmath1657 and @xmath1658 such that @xmath1659 .",
    "let @xmath60 any congruence with @xmath1660 .",
    "if @xmath1661 then by lemma  [ lem:34-links ] such @xmath492 do not exists , as long as @xmath1614 can not be separated .",
    "finally , if @xmath1662 , @xmath185 is a singleton by lemma  [ lem : type23 ] , and the result is trivial .",
    "suppose now that @xmath1663 .",
    "in this case @xmath1591 is a module , @xmath1664 implying @xmath1665 .",
    "since @xmath22 is chained @xmath492 can be assumed to be from @xmath1666 , and so @xmath1667 .",
    "also , this implies by proposition  [ pro : umax - rectangular ] that for any @xmath1668-block @xmath774 and the corresponding @xmath1669-block @xmath860 it holds @xmath1670 .",
    "since by the choice of @xmath465 , @xmath1671 , pairs @xmath1672 can be chosen such that @xmath1673 .",
    "we prove that @xmath1674 producing a contradiction with the choice of @xmath465 .    by lemma",
    "[ lem : delta - alignment ] @xmath1675 $ ] is a subset of a @xmath1676-block .",
    "then @xmath1677 , where @xmath1113 is the link congruence of @xmath677 with respect to @xmath22 , and as @xmath22 is chained , by lemma  [ lem : link - separability ] @xmath1678 for any @xmath1535-block @xmath1679 , since @xmath1680 is a module , and therefore @xmath774 is u - maximal in this set .",
    "thus we are in the conditions of lemma  [ lem : dirprod - propagation ] . therefore if @xmath1681 then @xmath1682 for any @xmath1683 for any @xmath1658 and @xmath1684)$ ] .",
    "again , we now extend this property to @xmath392 using the assumption that @xmath22 is polynomially closed . since any pair @xmath1685 with @xmath1686 is a @xmath1687-subtrace , as @xmath22 is chained ,",
    "there is a @xmath1619-preserving polynomial @xmath26 such that @xmath1688 and @xmath1689 .",
    "now , use the pairs @xmath1659 . for",
    "any @xmath1690 with @xmath1691 , let @xmath1692 be such that @xmath1693 , where @xmath458 is the function from theorem  [ the : uniform ] ; such @xmath1694 exists because @xmath1695 is a permutation on every @xmath60-block ( recall that a @xmath60-block is a module in this case ) .",
    "since @xmath22 is chained , there is a polynomial @xmath26 such that @xmath1696 and @xmath1587 for some @xmath1697 .",
    "the mapping @xmath1698 is such that @xmath1699 and @xmath1700 , because , again , @xmath1591 is a module . since @xmath392 is polynomially closed and @xmath1701 we have @xmath1702 ; and as @xmath1092 is arbitrary from @xmath63 , we have @xmath1703 .",
    "thus , we have proved the property for a specific @xmath60-block ; next we extend it to other @xmath60-blocks .",
    "suppose @xmath1704 for some @xmath60-block @xmath774 and a @xmath60-block @xmath860 is such that for some @xmath1705 , @xmath189 is a thin edge and @xmath1706 for some @xmath1707 . then by lemma  [ lem : central - mapping ] mapping @xmath1708 that is defined as @xmath1709 , @xmath1710 , @xmath1711 depending on the type of @xmath189 is injective on @xmath774 .",
    "in particular , if @xmath189 is semilattice or majority then @xmath430 maps @xmath1712 to @xmath1713 , @xmath1714 and @xmath1715 whenever @xmath1716 ; and since @xmath1371 are term operations and all the tuples involved belong to @xmath392 , @xmath1717 . if @xmath189 is affine then @xmath430 maps @xmath1712 to @xmath1718 , and @xmath1719 and @xmath1715 whenever @xmath1716 , and @xmath1720 . in either case , @xmath1669 is nontrivial on @xmath860 , and applying the argument from the previous paragraph we obtain @xmath1721 or @xmath1722 .",
    "therefore @xmath1723 , a contradiction with the choice of @xmath465 .",
    "in this section we first introduce a property of relations which is slightly stronger than chaining ; this is the property that will be used in further proofs .",
    "then we show in lemma  [ lem : s7 ] that this property is preserved under certain transformations of the relation .",
    "we call relation @xmath22 _ strongly chained _ with respect to @xmath855 , where @xmath840 and @xmath841 is a @xmath842-block for @xmath98 $ ] , if + ( q1s ) for any @xmath342 $ ] and @xmath1724 such that @xmath1725 , @xmath183 and @xmath184 are @xmath868-chained in @xmath22 , where @xmath868 is the set of all @xmath332-preserving polynomials of @xmath22[not : q1s ] + ( q2s ) for any @xmath1724 , @xmath869 , @xmath1184 $ ] , such that @xmath1725 , @xmath870 , and @xmath156 can be separated from @xmath204 , the congruences @xmath183 and @xmath184 are @xmath871-chained in @xmath22 , where @xmath871 is the set of all @xmath332-preserving polynomials @xmath430 of @xmath22 such that @xmath872[not : q2s ] + as in the definition of chained relations a polynomial from @xmath871 in condition ( q2s ) will be called _ @xmath873-good_.",
    "we now can state and prove lemma  [ lem : s7 ] that the property to be strongly chained is preserved under certain transformations of @xmath304 and @xmath332 .",
    "we will use it prove that one of the conditions , ( s7 ) , of a @xmath184-strategy ( see section  [ sec : strategies ] ) remains true when the @xmath184-strategy is being transformed .    [",
    "lem : s7 ] let @xmath22 be a subdirect product of @xmath494 , @xmath840 and @xmath841 a @xmath842-block , @xmath98 $ ] , such that @xmath22 is strongly chained with respect to @xmath855 .",
    "let @xmath896 and @xmath897 .",
    "fix @xmath98 $ ] , @xmath1726 , and let @xmath1727 be a @xmath1728-block that is a member of a nontrivial as - component of @xmath1729 .",
    "let also @xmath1730 and @xmath1731 for @xmath175 .",
    "then @xmath22 is strongly chained with respect to @xmath1732 .",
    "let @xmath1733 and @xmath1734 .",
    "take @xmath346 , @xmath838 from the definition of being strongly chained .",
    "let @xmath1735 $ ] ; if @xmath1736 we may consider @xmath22 as a subdirect product of @xmath497 and @xmath1737 , so we assume @xmath1738 and @xmath1739 in ( q2s ) .",
    "let @xmath920 , @xmath1740 be such that @xmath918 , @xmath1741 .",
    "clearly , we may assume @xmath1590 , @xmath1742 , and @xmath1743 .",
    "note that replacing @xmath22 with the @xmath1744-ary relation @xmath1745)\\mid \\ba\\in\\rel\\}$ ] we may assume that @xmath1746 . without loss of generality",
    "assume @xmath1747 . by the assumption @xmath1748",
    ", the classes of @xmath1749 are just elements of @xmath677 , so let @xmath704 be denoted by @xmath935 .",
    "let @xmath185 be the as - component of @xmath704 containing @xmath935 .    to prove the lemma for every @xmath1750 with @xmath1146 we have to identify a set @xmath1751 as in conditions ( g1),(g2 ) , and for every @xmath1752 we need to find a @xmath1753-good polynomial @xmath26 such that @xmath1754 .",
    "in fact , we rather find all the sets @xmath420 minimal among the sets of the form @xmath1751 and that satisfy the conditions of lemma  [ lem : good - polys](4 ) .",
    "note that such minimal sets exist for @xmath855 , as well as , @xmath873-good polynomials by the assumption that @xmath22 is strongly chained with respect to @xmath855 .",
    "we need to change such a set @xmath420 and change the polynomials so that they fit the new requirements .",
    "we divide the proof into two cases , depending on whether or not @xmath1755 is linked .",
    "first , we consider the case when @xmath727 is not linked , this case is relatively easy .",
    "let @xmath1756 be not linked and @xmath678 link congruences of @xmath727 .",
    "then @xmath1757 and either @xmath1758 or @xmath184 is trivial on @xmath1759 .",
    "relation @xmath727 is a subalgebra of @xmath1760 and is polynomially closed in @xmath1761 by lemma  [ lem : poly - closed ] . by the congruence lemma  [ lem : affine - link ]",
    "if @xmath950 is not linked then @xmath727 is the graph of a mapping @xmath1762 .",
    "this means @xmath1757 and @xmath699 is the restriction of a congruence @xmath465 of @xmath676 onto @xmath1763 .",
    "if @xmath1764 then obtain the first option of the conclusion of the claim , otherwise @xmath1765 and we have the second option .    note that if @xmath1758 then any @xmath332-preserving polynomial that maps a pair of @xmath184-related elements from @xmath1766 on a @xmath156-subtrace from @xmath1766 is also @xmath1767-preserving , because @xmath1757 ; the result follows .",
    "if @xmath184 is trivial on @xmath1766 , there is nothing to prove .",
    "therefore we may assume @xmath950 is linked .",
    "we start with choosing a @xmath184-block required in the chaining conditions , and studying some of its properties .",
    "observe that since @xmath935 is as - maximal in @xmath704 , the set @xmath1766 also contains as - maximal elements of @xmath1768 .",
    "therefore by lemma  [ lem : u - max - congruence ] @xmath1769 . let @xmath774 be a @xmath184-block such that @xmath1770 , @xmath1771 ( and so @xmath1772 satisfies the requirements of the chaining conditions ) , and let @xmath1773 . consider @xmath1774 .",
    "note that @xmath1520 is not necessarily a subalgebra .",
    "let @xmath1775 , @xmath98 $ ] , and @xmath1776 . by the maximality lemma  [ lem : to - max](4 )",
    "@xmath1777 is a union of as - components of @xmath860 .",
    "indeed , let @xmath1778 and let @xmath1779 be such that @xmath1780=a$ ] and @xmath1781\\in c$ ] ; let also @xmath1782 with @xmath1481 in @xmath860 .",
    "then by the maximality lemma  [ lem : to - max](4 ) there is @xmath1783 such that @xmath1784=b$ ] and @xmath1785 in @xmath392 .",
    "in particular , @xmath1781\\sqq_{as}\\bb[2]$ ] implying @xmath1786\\in c$ ] . also , by proposition  [ pro : umax - rectangular ] , since @xmath727 is linked and @xmath1787 , we have @xmath1788 , and therefore @xmath1789 . in particular , @xmath1790 is a union of as - components of @xmath860 .",
    "the last inclusion here is because @xmath1791 contains some as - maximal elements of @xmath860",
    ".    first we prove condition ( q1s ) for @xmath335 and @xmath1767 .",
    "claim 2 . for any @xmath1792 such that @xmath492 belong to the same as - component of @xmath1772",
    "there is a @xmath1753-good polynomial @xmath26 with @xmath1793 .",
    "consider relation @xmath1794 , a subdirect product of @xmath1795 , produced from by @xmath1796 , where @xmath1797 , as follows : @xmath1798 it is not difficult to see that @xmath1794 is a subalgebra , and , in particular it contains all the tuples of the form @xmath1799,\\bb[1],\\bb[2]\\zd\\bb[n])$ ] for @xmath293",
    ". let @xmath1800 , and @xmath1801 .",
    "every tuple from @xmath1802 or from @xmath1803 corresponds to a @xmath332- or @xmath1767-preserving polynomial .",
    "therefore it suffices to prove that @xmath1804 .",
    "let @xmath46 be the as - component of @xmath1772 containing @xmath492 ; as observed above @xmath46 is also an as - component of @xmath860 . by the assumption of (",
    "q2s ) @xmath1805 and @xmath1806 for any @xmath1807 , since @xmath1808 .",
    "we consider relation @xmath1809 . as @xmath1810",
    ", @xmath716 is as - maximal in @xmath1811 .",
    "therefore it suffices to show that @xmath1812 is linked when considered as subdirect product of @xmath1811 and @xmath704 . since @xmath1806 for any @xmath1807",
    ", all pairs of this form are linked in @xmath1813 .",
    "then @xmath1814 for any @xmath1815 and some @xmath1816 , and @xmath1817 for some @xmath1818 .",
    "since @xmath1819 , @xmath1820 , and by the maximality lemma  [ lem : to - max](4 ) @xmath1821 can be chosen from @xmath185 , and so this implies that @xmath1822 and @xmath1823 are also linked .",
    "claim  2 is proved .",
    "now we extend the result above to pairs from @xmath1824 .",
    "we prove the result in two steps .",
    "first , we show that for any @xmath1825 and any @xmath1826 there is a sequence of @xmath332-preserving polynomials @xmath1827 such that @xmath1828 form a chain connecting @xmath64 and @xmath74 , @xmath1829 is an @xmath156-minimal set , and @xmath1830 for @xmath171 $ ] .",
    "then we prove that @xmath1827 can be chosen in such a way that @xmath1831 and @xmath1832 .",
    "clearly , it suffices to prove in the case when @xmath74 is as - maximal in @xmath1791 .    by the assumption there are @xmath1833 , @xmath1834 and @xmath873-good polynomials @xmath1835 such that @xmath1829 is a @xmath156-minimal set and @xmath1836 , and also @xmath1837 .",
    "we need to show that @xmath1838 and @xmath1835 can be chosen such that @xmath1830 .",
    "choose @xmath1839 such that @xmath1780=a,\\bb[1]=b$ ] and @xmath1781=\\bb[2]=c$ ] .",
    "this is possible because @xmath1840 .",
    "now let @xmath1841 and @xmath1842 .",
    "by lemma  [ lem : good - polys ] @xmath1843 are @xmath873-good polynomials , and for each of them either @xmath1844 ( @xmath1845 ) is an @xmath156-subtrace , or @xmath1846 ( @xmath1847 ) , that is @xmath1848 ( respectively , @xmath1849 ) .",
    "the polynomials @xmath1843 satisfying the first option form a sequence of @xmath156-subtraces connecting @xmath64 with @xmath1850  by subtraces of the form @xmath1851 ,  and @xmath1850 with @xmath1852  by subtraces of the form @xmath1853 .",
    "also , by theorem  [ the : pseudo - majority ] @xmath1852 belongs to the as - component of @xmath1791 ( and therefore of @xmath860 and @xmath1772 ) containing @xmath74 .",
    "therefore by claim  2 this sequence of polynomials and subtraces can be continued to connect @xmath1852 to @xmath74 . finally , by the same theorem @xmath1854 and @xmath1855 .",
    "for the second step we assume that @xmath64 and @xmath74 are connected with @xmath156-subtraces @xmath1856 , @xmath864 $ ] witnessed by @xmath873-good polynomials @xmath1857 such that @xmath1858 .",
    "we need to show that @xmath1857 can be chosen such that @xmath1859 .",
    "suppose that @xmath1860 for some @xmath864 $ ] .",
    "since @xmath1861 and @xmath935 belong to the same as - component , there is an as - path @xmath1862 in @xmath185 .",
    "we show that if there is a sequence of @xmath156-subtraces @xmath1863 witnessed by polynomials @xmath1864 such that @xmath1865 whenever @xmath1866 , and @xmath1867 , there are also @xmath156-subtraces @xmath1868 such that @xmath1869 and @xmath1870 is in the as - component containing @xmath74 , witnessed by polynomials @xmath1871 such that @xmath1872 and @xmath1873 whenever @xmath1865 .",
    "as is easily seen , it suffices to find a ternary term operation @xmath510 such that @xmath1874 belongs to the as - component containing @xmath74 , and @xmath1875 .",
    "indeed , if such a term operation exists , then we set @xmath1876 , where @xmath90 is as in the first step above , for @xmath1877-\\{i\\}$ ] , and @xmath1878 .",
    "we have @xmath1879 and @xmath1880 whenever @xmath1865 . finally ,",
    "since @xmath1881 belongs to the as - component containing @xmath74 , we can use claim  2 as before to connect @xmath1874 to @xmath74 .",
    "for @xmath1882 we set @xmath1883 where @xmath1884 are such that @xmath1885=\\ba''[1]=a$ ] and @xmath1886=d_{t+1},\\ba''[2]=d_t$ ] .",
    "note that such @xmath1887 exist , because @xmath1788 .",
    "it follows from the assumption about @xmath510 that @xmath1882 is as required .    if @xmath1888 , then @xmath1889 fits the requirements . if @xmath1890 is an affine edge , consider the relation @xmath1891 generated by @xmath1892",
    "let @xmath1893 and @xmath1894 ; then @xmath1895 .",
    "by lemma  [ lem : as - rectangularity ] , as @xmath1890 is a thin affine edge , @xmath1896 .",
    "there is @xmath1092 with @xmath1897 in @xmath199 such that @xmath1898 .",
    "therefore there is a term operation @xmath510 with @xmath1899 and @xmath1875 , as required .",
    "in this section we describe the ` grand scheme ' of solving csps . we start with introducing two preprocessing steps for our algorithm .",
    "we call a csp instance @xmath17 _ subdirectly irreducible _ if it is 1-minimal and @xmath112 is subdirectly irreducible for every @xmath108 .",
    "[ lem : sub - irreducible ] every csp instance can be reduced in polynomial time to an equivalent subdirectly irreducible one .    in this section",
    "all instances we consider are assumed subdirectly irreducible .",
    "the monolith of @xmath112 is denoted by @xmath1900 .",
    "let @xmath17 be a ( 2,3)-minimal instance and for @xmath116 , @xmath117 , there is a constraint @xmath1458 , where @xmath115 is the set of partial solutions on @xmath1901 .",
    "we use the notation from the end of section  [ sec : csp - decomposition ] . recall that @xmath239 denotes the set of triples @xmath240 such that @xmath108 , @xmath241 , and @xmath242 .",
    "if @xmath264 for all @xmath108 , we set @xmath1902 .",
    "also , let @xmath246 to be the set of @xmath247 such that for some @xmath250 the prime intervals @xmath156 and @xmath204 can not be separated in @xmath214 .",
    "let @xmath304 , @xmath238 , @xmath108 , be a collection of congruences .",
    "let @xmath251[not : cwprime ] ( and respectively @xmath252 ) denote the set of triples @xmath245 ( respectively , from @xmath253 ) with @xmath1903 .",
    "we say that algebra @xmath112 is _ semilattice free _ if it does not contain semilattice edges .",
    "let @xmath254[not : size ] denote the maximal size of domains of @xmath21 that are not semilattice free and @xmath255[not : max ] be the set of variables @xmath108 such that @xmath256 and @xmath112 is not semilattice free .",
    "finally , for @xmath259 let @xmath260 if @xmath261 and @xmath262 otherwise .",
    "recall that by @xmath1904 we denote the instance @xmath1905 constructed as follows : the domain of @xmath108 is @xmath1906 ; for every constraint @xmath103 , the set @xmath1907 includes the constraint @xmath1908 .",
    "instance @xmath21 is said to be _ block - minimal _ if for every @xmath263 ( here @xmath264 , @xmath108 )    * for every @xmath103 the problem @xmath265 if @xmath266 , and the problem @xmath267 otherwise , where @xmath268 , is minimal ; * if @xmath269 , then for every @xmath270 the problem @xmath267 , where @xmath271 is minimal .",
    "the definition of block - minimality is designed in such a way that block - minimality can be efficiently established .",
    "observe that @xmath246 can be large , even equal to @xmath9 .",
    "however if @xmath266 by theorem  [ the : centralizer - alignement ] the problem @xmath265 splits into a union of disjoint problems over smaller domains . on the other hand ,",
    "if @xmath269 then @xmath265 may not be decomposable . since we need an efficient procedure of establishing block - minimality , this explains the complications introduced in ( bm1),(bm2 ) .",
    "for an instance @xmath21 we say that an instance @xmath257 is _ strictly smaller _ than instance @xmath21 if @xmath258 .",
    "[ lem : to - block - minimality ] let @xmath17 be a ( 2,3)-minimal instance . then @xmath21 can be transformed to an equivalent block - minimal instance @xmath257 by solving a quadratic number of strictly smaller csps .    to establish block - minimality of @xmath21 , for every @xmath263 ( let @xmath1909 ) , we need to check if the problems given in conditions ( bm1),(bm2 ) are minimal .",
    "if they are then @xmath21 is block - minimal , otherwise some tuples can be removed from some constraint relation @xmath22 ( the set of tuples that remain in @xmath22 is always a subalgebra , as is easily seen ) , and the instance @xmath21 tightened , in which case we need to repeat the procedure with the tightened instance .",
    "therefore we just need to show how to reduce solving those subproblems to solving strictly smaller csps .    for @xmath103 and @xmath132",
    "let @xmath257 be the problem obtained as follows : fix the values of variables from @xmath1910 , or from @xmath1911 in the case of ( bm2 ) to those of @xmath90 .",
    "if the resulting problem is @xmath301 then set @xmath1912 , where @xmath1913 is either empty , if @xmath266 , or @xmath268 , if @xmath269 in ( bm1 ) , or @xmath1914 in ( bm2 ) . in the first case , by theorem  [ the : centralizer - alignement ] @xmath257 is a disjoint union of instances @xmath1915 and @xmath1916 . in the second case the domains of variables from @xmath1910 have cardinality 1 , and the domain of each of the remaining variables either is semilattice free , or is smaller than @xmath254",
    ". finally , in the last case",
    "the domain of each of the variables outside of @xmath1917 is either semilattice free or smaller than @xmath254 .",
    "also , by theorem  [ the : centralizer - alignement ] @xmath1918 is a disjoint union of instances with domains of smaller size . let @xmath226 be these disjoint instances .",
    "then @xmath257 can be reduced to solving the instances @xmath1919 obtained from @xmath257 by restricting @xmath1920 to @xmath228 .",
    "this completes the proof .",
    "let @xmath17 be a subdirectly irreducible ( 2,3)-minimal instance .",
    "let @xmath273[not : centr ] denote the set of variables @xmath108 such that @xmath274 .",
    "let @xmath275 if @xmath276 and @xmath277 otherwise .",
    "we consider several cases and indicate what kind of reductions or solution algorithms we intend to use in each case .",
    "[ [ case-1-semilattice - free - domains . ] ] case 1 : semilattice free domains .",
    "+ + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    if all domains of @xmath21 are semilattice free then @xmath21 can be solved in polynomial time , using the few subpowers algorithm , as shown in @xcite .",
    "[ [ case-2-collapsing - trivial - centralizers . ] ] case 2 : collapsing trivial centralizers . + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    if @xmath277 for all @xmath108 , block - minimality guarantees that a solution exists , and we can use lemma  [ lem : to - block - minimality ] to solve the instance .",
    "[ the : non - central ] if @xmath21 is subdirectly irreducible , ( 2,3)-minimal , block - minimal , and @xmath278 , then @xmath21 has a solution .",
    "[ [ case-3-nontrivial - centralizers . ] ] case 3 : nontrivial centralizers . + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    if @xmath278 , we first solve the problem @xmath1921 , and then use theorem  [ the : central ] to reduce @xmath21 to a strictly smaller instance . an efficient way to establish 1-minimality of @xmath1921",
    "is given in theorem  [ the : algorithm ] .",
    "[ the : central ] if @xmath280 is 1-minimal , then @xmath21 can be reduced in polynomial time to a strictly smaller instance .    with the reductions above a solution algorithm goes as shown in algorithm  [ alg : csp ] , we reproduce it here for convenience .    a csp instance @xmath17 over @xmath382 a solution of @xmath21 if one exists , ` no ' otherwise solve @xmath21 using the few subpowers algorithm and",
    "return the answer transform @xmath21 to a subdirectly irreducible , block - minimal and ( 2,3)-minimal instance @xmath275 for @xmath276 and @xmath277 otherwise @xmath297 / * the global 1-minimality of @xmath298 @xmath299  / * add constraint @xmath300 fixing the value of @xmath111 to @xmath64 transform @xmath257 to a subdirectly irreducible , ( 2,3)-minimal instance @xmath301 if @xmath302 call solvecsp on @xmath301 and flag @xmath64 if @xmath301 has no solution establish block - minimality of @xmath301 ; if the problem changes , return to step  10 if the resulting instance is empty , flag the element @xmath64 if there are flagged values , tighten the instance by removing the flagged elements and start over use theorem  [ the : central ] to reduce @xmath21 to an instance @xmath257 with @xmath258 call solvecsp on @xmath257 and return the answer    [ the : algorithm ] algorithm solvecsp ( algorithm  [ alg : csp ] ) correctly solves every instance from @xmath379 and runs in polynomial time .    by the results of @xcite the algorithm correctly solves the given instance @xmath21 in polynomial time if the conditions of step  1 are true .",
    "lemma  [ lem : to - block - minimality ] implies that steps  4 and  12 can be completed by recursing to strictly smaller instances .",
    "next we show that the for - loop in steps 8 - 14 checks if @xmath297 is globally 1-minimal . for this",
    "we need to verify that a value @xmath64 is flagged if and only if @xmath298 has no solution @xmath283 with @xmath1922 , and therefore if no values are flagged then @xmath298 is globally 1-minimal . if @xmath1922 for some solution @xmath283 of @xmath298 , then @xmath283 is a solution @xmath257 constructed in step  9 . in this case steps  11,12 can not result in an empty instance .",
    "suppose @xmath1923 is not flagged .",
    "if @xmath302 this means that @xmath301 and therefore @xmath257 has a solution . otherwise this means that establishing block - minimality of @xmath301 is successful . in this case",
    "@xmath301 has a solution by theorem  [ the : non - central ] , because @xmath1924 .",
    "this in turn implies that @xmath257 has a solution .",
    "observe also that the set of unflagged values for each variable @xmath108 is a subalgebra of @xmath1925 . indeed , the set of solutions of @xmath298 is a subalgebra @xmath1926 of @xmath1927 , and the set of unflagged values is the projection of @xmath1926 of the coordinate position @xmath111 .    finally , if steps  815 are completed without restarts , steps  16,17 can be completed by theorem  [ the : central ] and recursing on @xmath257 with @xmath258 .    to see that the algorithm runs in polynomial time it suffices to observe that + ( 1 ) the number of restarts in steps  4 and  15 is at most linear , as the instance becomes smaller after every restart ; therefore the number of times steps  415 are executed together is at most linear .",
    "+ ( 2 ) the number of iterations of the for - loop in steps 814 is linear .",
    "+ ( 3 ) the number of restarts in steps  10 and  12 is at most linear , as the instance becomes smaller after every iteration .",
    "+ ( 4 ) every call of solvecsp when establishing block - minimality in steps  4 , and  12 is made on an instance strictly smaller than @xmath21 , and therefore depth of recursion is bounded by @xmath254 in step  4,11,12 and  17 . +",
    "thus a more thorough estimation gives a bound on the running time of @xmath1928 , where @xmath14 is the maximal size of an algebra in @xmath382 .",
    "following @xcite let @xmath17 be an instance and @xmath1929 , @xmath108 .",
    "mappings @xmath1930 , @xmath108 , are said to be _ consistent _ if for any @xmath1931 , @xmath12 , and any tuple @xmath132 the tuple @xmath1932)\\zd p_{v_k}(\\ba[k]))$ ] belongs to @xmath22 .",
    "it is easy to see that the composition of two families of consistent mappings is also a consistent mapping . for consistent idempotent mappings @xmath1930 by @xmath1933[not",
    "p - cp ] we denote the _ retraction _ of @xmath21 , that is , @xmath21 restricted to the images of @xmath1930 . in this case",
    "@xmath21 has a solution if and only if @xmath1933 has , see @xcite .",
    "let @xmath283 be a solution of @xmath280 .",
    "we define @xmath1934 as follows : @xmath1935 , where @xmath1936 , element @xmath1937 is any element of @xmath1938 , and @xmath14 is such that @xmath1939 is idempotent for all @xmath108 .",
    "note that by corollary  [ cor : centralizer - multiplication ] this mapping is properly defined even if @xmath1940 .",
    "[ lem : consistent - mapping ] mappings @xmath1941 , @xmath108 , are consistent .",
    "take any @xmath103 . since @xmath283 is a solution of @xmath280 ,",
    "there is @xmath293 such that @xmath294\\in\\vf(v)$ ] for @xmath113 .",
    "then for any @xmath132 , @xmath1942 , and this product does not depend on the choice of @xmath660 , as it follows from corollary  [ cor : centralizer - multiplication ] .",
    "iterating this operation also produces a tuple from @xmath22 .",
    "we would like to use the above reduction to reduce @xmath21 to a problem @xmath257 such that @xmath258 . if @xmath283 is such that for @xmath1943 there is @xmath284 with @xmath1944 and @xmath1945 , then @xmath1946 .",
    "also , observe that if @xmath1947 , then @xmath1941 is the identity mapping , that is @xmath1948 .",
    "if @xmath112 is semilattice free then @xmath1941 is the identity mapping by proposition  [ pro : good - operation ] .",
    "let @xmath1949 be the set of variables @xmath108 such that @xmath1950 is not semilattice free .",
    "[ lem : good - retraction ] there are consistent mappings @xmath1930 , @xmath108 , such that for any @xmath1951 we have @xmath1952 . moreover",
    ", such mappings can be found solving a linear number of instances of the form @xmath1953 .    since @xmath280 is globally 1-minimal",
    ", for any @xmath1923 there is a solution @xmath283 with @xmath1922 , and it can be found solving the instance @xmath1953 . for every @xmath1951 choose @xmath284 such that there is @xmath1954 and @xmath1955 , @xmath1956 , and let @xmath1957 be a solution of @xmath280 with @xmath1958 .",
    "then @xmath1959 and @xmath1960 or @xmath1961 is the identity mapping for any @xmath1962 .",
    "therefore the composition of the @xmath1963 for all @xmath1962 is as required .",
    "theorem  [ the : central ] now follows by observing that if @xmath1950 is semilattice free then @xmath112 itself is semilattice free .    in order to use theorem  [ the : central ]",
    "we however need to argue that @xmath1933 is a problem over a class of algebras omitting type  .",
    "let @xmath26 be a weak near - unanimity term of the class @xmath382 .",
    "then @xmath1964 is a weak near - unanimity term of @xmath1965 .",
    "moreover , if @xmath4 is semilattice free then @xmath1966 .      in this section",
    "similar to strategies related to the concepts of consistency and minimality we introduce strategies of some sort that will be used to prove theorem  [ the : non - central ] .",
    "we start with some necessary definitions .",
    "let @xmath17 be a ( 2,3)-minimal and block - minimal instance over @xmath382 .",
    "for @xmath263 , if @xmath266 , then @xmath1967 denotes the set of solutions of @xmath265 , and if @xmath269 , then @xmath1968 denotes the set of solutions of @xmath267 for an appropriate @xmath1913 .",
    "let @xmath238 and let @xmath305 be a @xmath244-block , @xmath1969 , @xmath1970 .",
    "let @xmath1971 be a collection of relations such that @xmath306 is a subalgebra of @xmath1972 .",
    "let @xmath119 , @xmath263 , and @xmath313 .",
    "let @xmath90 be a tuple from @xmath1973 for @xmath1974 , or from @xmath1975 , @xmath131 , if @xmath266 , or from @xmath1976 if @xmath269 , where @xmath131 and @xmath1913 is a set specified in the condition of block - minimality .",
    "tuple @xmath90 is said to be _",
    "@xmath129-compatible _ if for any @xmath317 , ( let @xmath1977 ) @xmath1978 or @xmath1979 for an appropriate set @xmath1913 . by @xmath1980[not",
    ": s - r - s - r - prime ] we denote the set of all @xmath129-compatible tuples from the corresponding relation . also , let @xmath1981[not : p - cr ] denote the problem instance obtained from @xmath21 replacing every constraint @xmath1931 with @xmath1982 .",
    "the collection @xmath129 is called a _",
    "@xmath304-strategy _ with respect to @xmath332 if it satisfies the following conditions for every @xmath245 , and every @xmath103 ( let @xmath1983 ) :    * the relations @xmath1984 , where @xmath314 consists of @xmath129-compatible tuples from @xmath115 for @xmath116 , @xmath315 , form a nonempty @xmath316-strategy for @xmath1985 ; * for every @xmath317 ( let @xmath318 ) and every @xmath1986 it holds : if @xmath320 then @xmath90 extends to an @xmath129-compatible solution @xmath283 of @xmath321 ; otherwise if @xmath266 then @xmath90 extends to an @xmath129-compatible solution of @xmath322 with @xmath323 ; and if @xmath269 then @xmath90 extends to an @xmath129-compatible solution of @xmath324 , where @xmath325 ; * @xmath1987 and for any @xmath327 any @xmath129-compatible tuple @xmath1988 extends to an @xmath129-compatible tuple @xmath293 . *",
    "the relation @xmath306 is a subalgebra of @xmath1989 , and @xmath1990 ; if @xmath266 then the relation @xmath1991 is a subalgebra of @xmath106 , and @xmath1992 ; if @xmath269 then for any @xmath1993 the relations @xmath1994 are subalgebras of @xmath1995 , respectively , and @xmath1996 , @xmath1997 , where @xmath1998 and @xmath1999 ; * for every @xmath2000 and every @xmath317 ( let @xmath318 ) with @xmath2001 it holds @xmath2002 , let @xmath2003 denote the subalgebra generated by this set , @xmath2004 is as - closed in @xmath2005 ; * for every @xmath317 with @xmath2006 the set of @xmath129-compatible tuples from @xmath2007 is polynomially closed in @xmath2008 ; * relation @xmath22 is strongly chained with respect to @xmath855 ; if @xmath266 , relation @xmath106 is strongly chained with respect to @xmath855 ; if @xmath269 , for any @xmath1993 the relations @xmath1995 , @xmath1998 , @xmath1999 , are strongly chained with respect to @xmath855 .",
    "conditions ( s1)(s3 ) are the conditions we actually want to maintain when transforming a strategy , and these are the ones that provide the desired results . however , to prove that ( s1)(s3 ) are preserved under transformations of a strategy we also need more technical conditions ( s4)(s7 ) .",
    "we now show how we plan to use @xmath304-strategies .",
    "let @xmath21 be a subdirectly irreducible , ( 2,3)-minimal , and block - minimal instance , @xmath264 and @xmath329 for @xmath108 .",
    "then as is easily seen the collection of relations @xmath2009 given by @xmath331 for @xmath103 is a @xmath304-strategy with respect to @xmath332 .",
    "also , by ( s3 ) a @xmath333-strategy with @xmath334 for all @xmath108 gives a solution of @xmath21 .",
    "our goal is therefore to show that a @xmath304-strategy for any @xmath304 can be ` reduced ' , that is , transformed to a @xmath335-strategy for some @xmath336 .",
    "note that this reduction of strategies is where the condition @xmath278 is used . indeed , suppose that @xmath337 .",
    "then by conditions ( s1)(s7 ) we only have information about solutions to problems of the form @xmath338 or something very close to that . therefore this barrier can not be penetrated .",
    "we consider two cases .",
    "there are @xmath108 and @xmath2010 nontrivial on @xmath305 , @xmath2011 .",
    "this case is considered in section  [ sec : type-2 ] .    for all @xmath108 and @xmath2010 nontrivial on @xmath305 , @xmath2012 .",
    "this case is considered in section  [ sec : type - not-2 ] .",
    "in the remaining part of the paper we prove theorem  [ the : non - central ] .      in this section we consider case  1 of tightening strategies : there is @xmath2013 for some @xmath108 such that @xmath2010 and @xmath2011 .",
    "let @xmath17 be a block - minimal instance with subdirectly irreducible domains , @xmath2014 and @xmath2015 .",
    "we use notation from section  [ sec : maximal - solutions ] .",
    "let also @xmath2016 be a @xmath304-strategy for @xmath332 .",
    "we select @xmath108 and @xmath241 with @xmath2017 , @xmath418 , and an @xmath183-block @xmath2018 .",
    "note that since @xmath418 , @xmath2019 is a module , and therefore @xmath2020 is as - maximal in this set . in this section",
    "we show how @xmath129 can be transformed to a @xmath335-strategy @xmath2021 for @xmath2022 such that @xmath2023 , @xmath2024 for @xmath247 , and @xmath2025 , @xmath2026 .",
    "first of all we identify variables @xmath247 for which @xmath2027 has to be different from @xmath2028 .",
    "since @xmath21 is ( 2,3)-minimal , for every @xmath2029 there is @xmath2030 . for @xmath2031 ( we omit @xmath304 from @xmath246 here ) consider @xmath2032 , @xmath2033 the set of all @xmath129-compatible pairs from @xmath214 , @xmath2034 , and @xmath2035 . by ( s5 ) for @xmath129 we have that @xmath2036 is as - closed in @xmath2037 , where @xmath2038 ; since @xmath418 , this implies @xmath2039 .",
    "also , @xmath2040 , and therefore @xmath2041 are polynomially closed in @xmath2042 , respectively , by ( s6 ) , and @xmath2042 are strongly chained by ( s7 ) . therefore , by the congruence lemma  [ lem : affine - link ] either @xmath2043 or @xmath2044 is the graph of a mapping @xmath2045 .",
    "let @xmath2046 be the set of variables for which the latter holds , and let @xmath2047 be the corresponding congruence of @xmath218 , extension of the kernel of @xmath2048 .",
    "let @xmath2049 and @xmath2050 for @xmath2051 , and @xmath2052 for @xmath2053 .",
    "now we are in a position to define the new strategy .",
    "let @xmath2021 be the following collection of relations .",
    "we omit subscript @xmath304 .",
    "* @xmath2054 ; * for every @xmath103 , @xmath2055 , * * if @xmath266 , @xmath2056 there is a @xmath129-compatible solution @xmath283 of @xmath2057 , @xmath2058 , and @xmath2059 $ ] for @xmath2060 ; * * if @xmath2061 , @xmath2056 there is a @xmath129-compatible solution @xmath283 of @xmath2062 with @xmath2063 , such that @xmath2064 , and @xmath2059 $ ] for @xmath2060 * * if @xmath2065 , @xmath2056 there is a @xmath129-compatible solution @xmath283 of @xmath2062 with @xmath268 , such that @xmath2064 , and @xmath2059 $ ] for @xmath2060 ;    similar to @xmath1980 by @xmath2066 we denote the corresponding sets of @xmath2021-compatible tuples . as is easily seen , the sets of both types are indeed subalgebras of @xmath2067 .",
    "the following three statements show how relations @xmath2068 from @xmath2021 are related to @xmath2007 from @xmath129 .",
    "they amount to saying that either @xmath2068 is the intersection of @xmath2007 with a block of a congruence of the projection of @xmath22 , or @xmath2069 .",
    "recall that for congruences @xmath2028 , @xmath247 , and @xmath2070 by @xmath2071 we denote the collection @xmath2072 .",
    "set @xmath1909 for the rest of section  [ sec : type-2 ] .",
    "[ lem : congruence - restriction ] let @xmath103 , and let @xmath2073 be the set of solutions of @xmath100 if @xmath266 , or the set of solutions of @xmath2074 if @xmath269 .",
    "for every @xmath2075 there is a congruence @xmath2076[not : tau - u ] of @xmath2077 satisfying the following conditions : + ( 1 ) either @xmath2078 or for a @xmath2076-block @xmath1794 it holds @xmath2079 .",
    "+ ( 2 ) for any @xmath2080 the congruence @xmath2081 is the restriction of @xmath2082 , that is @xmath2083 if and only if for some @xmath2084 with @xmath2085 it holds @xmath2086 .",
    "+ ( 3 ) for any @xmath2075 either @xmath2087 , or the algebra @xmath2088 is isomorphic to @xmath2089 .",
    "+ ( 4 ) for any @xmath317 , @xmath2090 , @xmath2091 , let @xmath2092 .",
    "then either @xmath2093 , or for a @xmath2094-block @xmath1794 it holds @xmath2095 and @xmath2096 is the set of u - maximal elements of @xmath2097 .    if , according to item ( 3 ) of the lemma , @xmath2087 , we say that @xmath2076 is the _ full congruence _ ; if the latter option of item ( 3 ) holds we say that @xmath2076 is a _",
    "maximal congruence_.    if @xmath2098 then set @xmath2076 to be @xmath2099 . otherwise consider @xmath2100 as a subdirect product of @xmath112 and @xmath2101 .",
    "this relation is chained by ( s7 ) and @xmath2102 is polynomially closed in @xmath727 by lemma [ lem : poly - closed](2 ) ; apply the congruence lemma  [ lem : affine - link ] to it .",
    "specifically , consider @xmath2103 as a subdirect product of @xmath2101 and @xmath2104 .",
    "if the first option of the congruence lemma  [ lem : affine - link ] holds , set @xmath2105 .",
    "if the second option is the case , choose @xmath2076 to the congruence @xmath465 of @xmath2101 identified in the congruence lemma  [ lem : affine - link ] .",
    "\\(1 ) in this case the result follows by the congruence lemma  [ lem : affine - link ] .",
    "\\(2 ) obvious .",
    "\\(3 ) if @xmath2098 then by item ( 1 ) @xmath2106 , which is isomorphic to @xmath2089",
    ". otherwise consider relation @xmath727 as in the beginning of the proof . by the congruence lemma  [ lem : affine - link ] if @xmath2107 , @xmath2108 .",
    "the result follows .",
    "\\(4 ) if @xmath2094 is the full congruence then by ( s2 ) for @xmath129 we have @xmath2109 and we have the first option . if @xmath2094 is a maximal congruence then by ( r2 ) and item ( 1 ) there is a @xmath2094-block @xmath1794 such that @xmath2110 . by condition ( s2 )",
    "every @xmath2111 can be extended to a solution from @xmath2112 .",
    "in particular , if @xmath2113 then such an extension @xmath283 has to satisfy @xmath2058 . since @xmath2114 is as - maximal in @xmath2115 and @xmath2116 , we have @xmath2117 .",
    "for @xmath103 we use @xmath2118[not : tau - c ] to denote the congruence @xmath2119 .",
    "also for @xmath317 we use @xmath2120 to denote the congruence @xmath2121 .",
    "[ lem : restricted - congruence ] in the notation above let @xmath2122 , @xmath2123 be such that @xmath2124 and @xmath2125 can not be separated from each other . then if @xmath2118 is a maximal congruence , for any polynomial @xmath26 of @xmath22 , @xmath2126 if and only if @xmath2127 for any @xmath2128 .",
    "if @xmath2129 are considered as congruences of @xmath2130 , equal to @xmath2131 , @xmath2132 , respectively , this condition means that @xmath2133 and @xmath2134 can not be separated .",
    "let @xmath2073 be defined as in lemma  [ lem : congruence - restriction ] and @xmath2118 a maximal congruence . take a polynomial @xmath26 of @xmath22 .",
    "as @xmath2135 can not be separated for any @xmath2136 , it suffices to consider just one variable @xmath2128 .",
    "since @xmath21 is a block - minimal instance , the polynomial @xmath26 can be extended from a polynomial on @xmath2130 to a polynomial @xmath1015 of @xmath2073 , and , in particular , to a polynomial @xmath2137 of @xmath2138 .",
    "since @xmath2118 is maximal , by the congruence lemma  [ lem : affine - link ] the intervals @xmath2139 and @xmath2133 in the congruence lattices of @xmath112 and @xmath2130 , respectively , can not be separated in @xmath2138 .",
    "therefore @xmath2140 if and only if @xmath2126 .",
    "since @xmath2139 and @xmath2134 can not be separated in @xmath21 , the first inclusion holds if and only if @xmath2127 , and we infer the result .",
    "[ cor : cr - structure ] for any @xmath317 , @xmath2141 , @xmath2142 , let @xmath2092 , @xmath2143 , and @xmath2144 . then either @xmath2069 , or for a @xmath2145-block @xmath2146 it holds @xmath2147 and @xmath2148 is the set of u - maximal elements of @xmath2149 .",
    "moreover , @xmath2150 .    by lemma  [ lem : congruence - restriction](4 ) either @xmath2093 , or for a @xmath2094-block @xmath1794 it holds @xmath2095 and @xmath2096 is the set of u - maximal elements of @xmath2097 . then considering @xmath2151 as a subdirect product of @xmath2152 and @xmath2153 , the interval @xmath2154 in @xmath2155 can be separated from interval @xmath1687 in @xmath2156 for any @xmath2157 by lemma  [ lem : restricted - congruence ] .",
    "then we use the congruence lemma  [ lem : affine - link ] to conclude that @xmath2158 .",
    "the result follows .",
    "now we are in a position to prove that @xmath2021 is a @xmath335-strategy .",
    "[ the : restricting - strategy ] in the notation above , @xmath2021 is a @xmath335-strategy for @xmath2022 .",
    "we give proofs of most difficult conditions from ( s1)(s7 ) in separate lemmas .",
    "we start with condition ( s6 ) , as it will be needed for other conditions .",
    "[ lem : s6 - 1 ] condition ( s6 ) for @xmath2021 holds .",
    "that is , for every @xmath317 with @xmath2006 the set of @xmath2021-compatible tuples from @xmath2007 is polynomially closed in @xmath2008 .",
    "consider @xmath103 .",
    "let @xmath26 be a polynomial of @xmath22 , and let @xmath2159 be tuples satisfying the conditions of polynomial closeness .",
    "let @xmath1485 be such that @xmath1486 in @xmath1487 . by ( s6 ) for @xmath129",
    ", @xmath1488 is @xmath129-compatible .",
    "it suffices to show that @xmath2160 is in the same @xmath2118 block as @xmath2161 .",
    "however , this is straightforward , because @xmath2162 , and as @xmath1484 , we also have @xmath2163 . since @xmath2164 , it follows @xmath2165 .      in this section",
    "we prove    [ lem : s1 - 1 ] condition ( s1 ) for @xmath2021 holds .",
    "that is , the relations @xmath2166 , where @xmath2167 consists of @xmath2021-compatible tuples from @xmath115 for @xmath116 , @xmath315 , form a nonempty @xmath316-strategy for @xmath2168 .",
    "we start with an auxiliary lemma .",
    "[ lem : module - intersection ] let @xmath4 be an algebra and @xmath2169 and @xmath453 a subalgebra of a @xmath184-block .",
    "let also @xmath2170 be a congruence of @xmath453 such that @xmath2171 is a module .",
    "let @xmath2172 be subalgebras of @xmath453 such that @xmath2173 and @xmath2174 contains a u - maximal element of an @xmath183-block of @xmath453 , @xmath2175 , @xmath2176 , and @xmath2172 are polynomially closed in @xmath4",
    ". then @xmath2177 .",
    "let @xmath2178 be u - maximal in an @xmath183-block of @xmath453 . as @xmath2171 is a module , by lemma  [ lem : u - max - congruence ]",
    "it is u - maximal in the @xmath198-block @xmath2179 for any @xmath2180 , @xmath2181 .",
    "let @xmath567 and @xmath2182 ; let also @xmath2183 in @xmath453 and @xmath2180 any such that @xmath2184 . for any @xmath204-trace @xmath420 that contains @xmath64 and any @xmath2185 , @xmath2186 , there is a polynomial @xmath26 of @xmath4 such that @xmath1410 and @xmath2187 .",
    "since @xmath199 is polynomially closed , for any @xmath2188 such that @xmath2189 , we have @xmath2190 , and @xmath935 is u - maximal in @xmath453 . in a similar way @xmath2191 .",
    "therefore it suffices to show that for any @xmath2183 in @xmath453 for some @xmath2192 and any @xmath2180 , @xmath2184 there is @xmath2193 such that @xmath142 is a @xmath204-subtrace .",
    "indeed , as is proved above @xmath2194 , and therefore @xmath2195 is not contained in a @xmath389-block . since @xmath2171 is a module , this means @xmath2177 .    since @xmath2171 is a module ,",
    "there is a @xmath204-subtrace @xmath2196 such that @xmath2197 .",
    "then by lemma  [ lem : maximal - minimal ] there is also a polynomial @xmath430 such that @xmath1413 is an @xmath204-minimal set and @xmath2198 .",
    "the result follows .",
    "we now can prove lemma  [ lem : s1 - 1 ] .",
    "( of lemma  [ lem : s1 - 1 ] )   we consider the collection of constraints @xmath1458 , @xmath116 , @xmath117 , such that @xmath1984 constitute a @xmath316-strategy for @xmath1985 .",
    "this collection exists by ( s1 ) for @xmath129 .",
    "let @xmath2167 denote the set of @xmath2021-compatible tuples from @xmath314 .",
    "it suffices to show that for any tuple @xmath2199 , @xmath2200 , and any @xmath2201 there is @xmath124 such that @xmath2202 ; then the proof can be completed by ( s3 ) for @xmath2021 ( to be proved later ) . by ( s1 ) for @xmath129 there is @xmath2203 such that @xmath2204 .",
    "consider the relation @xmath22 given by @xmath2205 and let @xmath2206 be the set of @xmath129- and @xmath2021-compatible tuples from @xmath22 , respectively .",
    "as is easily seen , element @xmath124 satisfies the required conditions if and only if @xmath2207 and @xmath2208 , @xmath2209 .    by ( s4 )",
    "@xmath2210 is a subalgebra of @xmath22 ; moreover , by ( s1 ) the binary projections of @xmath2210 contain @xmath2211 , @xmath2212 , @xmath2213 , respectively . also , by lemmas  [ lem : poly - closed](2 ) and  [ lem : s6 - 1 ] @xmath2206 are polynomially closed in @xmath22 .",
    "we consider a number of cases .",
    "@xmath2214 .",
    "if , say , @xmath2215 then @xmath2216 . if @xmath2217 , then by construction and the congruence lemma  [ lem : affine - link ] either @xmath2218 if @xmath2219 is the full congruence , or @xmath2220 otherwise . in either case @xmath2221",
    "similarly , @xmath2222 .",
    "therefore @xmath2223 , and by the maximality lemma  [ lem : to - max](5 ) there is always @xmath935 such that @xmath2224 .",
    "therefore we may assume that @xmath2225 .",
    "if @xmath2217 ( or @xmath2226 , or @xmath2227 ) then let @xmath2228 ( respectively , @xmath2229 , or @xmath2230 ) be as in lemma  [ lem : congruence - restriction ] . if @xmath2215 ( or @xmath2231 ) then let @xmath2232 , @xmath2233 ( more precisely , @xmath2234 ) , and @xmath2235 ( respectively , @xmath2236 ) .",
    "we view all these congruences interchangeably : as congruences of @xmath22 in the natural way and their restrictions to @xmath129-compatible tuples as congruences of @xmath2210 , or as congruences of the corresponding projections of @xmath22 and @xmath2210 . by lemma  [ lem : congruence - restriction ]",
    "if @xmath2145 is one of these congruences , say ,",
    "@xmath2237 for @xmath2238 , then @xmath2145 viewed as a congruence of @xmath115 is either the full congruence on @xmath314 or @xmath2239 .",
    "therefore @xmath2145 viewed as a congruence of @xmath22 is either the full congruence on @xmath2210 , or @xmath2240 in @xmath2241 ; in the latter case we will say that @xmath2145 is maximal .",
    "also let @xmath2242 .",
    "again by lemma  [ lem : congruence - restriction ] @xmath2243 is a module .",
    "let @xmath2244 be the sets of tuples @xmath2245 satisfying @xmath2246=a,\\ba[y]=b$ ] , respectively ; note that @xmath2247 .",
    "we consider several cases of what the congruences introduced earlier can be .",
    "@xmath2248 is the full congruence and @xmath2233 , or @xmath2249 is the full congruence and @xmath2250 .",
    "suppose @xmath2248 is the full congruence , the other option is similar .",
    "subcase 2.1 @xmath2251 is the full congruence . + as @xmath2252 , if @xmath2251 is a full congruence , @xmath2253 is also the full congruence .",
    "therefore , @xmath2254 , and we are done .",
    "subcase 2.2 @xmath2249 is maximal while @xmath2255 is full .",
    "+ since any tuple @xmath2256 also belongs to @xmath2257 in this case , again @xmath2254    subcase 2.3 both @xmath2249 and @xmath2255 are maximal .",
    "+ in this case , as @xmath2258 and all three congruences are maximal , we have @xmath2259 . also , @xmath2255 ( viewed as a congruence of @xmath2260 ) is the link congruence with respect to @xmath2261 , and so @xmath2222 .",
    "this also implies , since @xmath2262 , that @xmath2221 .",
    "subcase 2.4 @xmath2255 is maximal while @xmath2249 is full .",
    "+ let @xmath2263 for @xmath2264 . by the congruence lemma  [ lem : affine - link ] @xmath2265 and @xmath2266 . indeed , otherwise @xmath2267 would be the graph of a mapping @xmath2268 contradicting the assumption that @xmath2248 is the full congruence ; similar for @xmath2269 .",
    "therefore @xmath2270 and since @xmath716 is u - maximal in a @xmath2230-block , @xmath940 can be chosen such that @xmath2271 is u - maximal in a @xmath2255-block",
    ". then by lemma  [ lem : module - intersection ] @xmath2272 and the result follows .",
    "subcase 2.5 .",
    "@xmath2273 and @xmath2274 are full congruences . + again by the congruence lemma  [ lem : affine - link ] @xmath2275 and therefore @xmath2276 .",
    "also , let @xmath727 be the union of all @xmath2251-blocks of @xmath2210 whose intersection with @xmath2277 is nonempty , this is clearly a subalgebra . also , let @xmath2278 .",
    "note that , since @xmath2249 is the full congruence , and therefore @xmath2279 , we have @xmath2280 . then @xmath2281 and @xmath2282 .",
    "then as before the result follows by lemma  [ lem : module - intersection ] .",
    "@xmath2283 are maximal congruences .    in this case @xmath2284 , and depending on whether or not @xmath2255 is maximal we proceed as in cases  2.2 or  2.3 .",
    "if @xmath2255 is a maximal congruence or @xmath2285 or @xmath2251 is the full congruence , the result follows from one of the previous cases .",
    "therefore the only remaining case is    case 4 .",
    "@xmath2285 and @xmath2251 are maximal , while @xmath2286 are not .",
    "let again @xmath2263 for @xmath2264 .",
    "if @xmath266 or @xmath2287 , that is , @xmath2288 for any choice of @xmath1913 in ( r1),(r2 ) , then the required @xmath2289 exists , since @xmath716 can be extended to a solution from @xmath2290 or @xmath2291 , @xmath2292 by construction .",
    "suppose that @xmath269 and @xmath2293 for @xmath2292 .",
    "let @xmath2294 be a subalgebra of the product @xmath2295 that consists of all triples @xmath2296 such that there is a solution @xmath2297 with @xmath2298 , and @xmath2299 .",
    ". by block - minimality @xmath2294 is indeed a subdirect product and by ( s2 ) for @xmath129 we have @xmath2301 and @xmath2302 .",
    "also , by lemma  [ lem : poly - closed](3 ) @xmath2294 is polynomially closed .",
    "relation @xmath2303 is defined in a similar way .",
    "let also @xmath2304 and @xmath2305 .",
    "let @xmath2306=a\\}$ ] , @xmath2307=b\\}$ ] , and @xmath2308 . by the assumption that @xmath2283 are full congruences @xmath2309 .",
    "therefore , if we prove that @xmath2310 , we obtain the result by lemma  [ lem : module - intersection ] .",
    "note that if this is the case , since @xmath2311 , there is also @xmath2312 that is u - maximal in an @xmath2313-block .    to this end",
    "consider the relations @xmath2314 and @xmath1800 . in a similar way we define @xmath2315=a\\}$ ] , @xmath2316=b\\}$ ] . by ( s1 )",
    "there are @xmath2317 and @xmath2318 such that @xmath2319 . also by construction ( r2 )",
    "there are @xmath2320 , @xmath2321 , @xmath2322 and @xmath2323 , such that @xmath2324 , @xmath2325 .",
    "recall that @xmath2037 is a module .",
    "let @xmath389 be the skew congruence of @xmath2326 , that is , a congruence such that @xmath2327 is a @xmath389-block .",
    "let @xmath2328 be the congruence of @xmath1802 given by @xmath2329 if and only if @xmath2330 .",
    "note that @xmath2331 in @xmath2332 .",
    "let @xmath2333 be the @xmath2328-block corresponding to @xmath28 , that is , @xmath2334 . since @xmath2335 and @xmath2336 can be chosen to be u - maximal in a @xmath2328-block , and @xmath2337 , @xmath2338 , by lemma  [ lem : module - intersection ] we have @xmath2339 .",
    "the result follows .      in this section",
    "we prove that @xmath2021 satisfies conditions ( s2 ) and ( s3 ) .",
    "we first prove ( s2 ) and then show what in the proof has to be changed to obtain a proof of ( s3 ) .",
    "as before , let @xmath1909 .",
    "[ lem : s2 - 1 ] @xmath2021 satisfies ( s2 ) .",
    "that is , for every @xmath2340 ( let @xmath2341 ) and every @xmath2342 it holds : if @xmath2343 then @xmath90 extends to an @xmath2021-compatible solution @xmath283 of @xmath2344 ; otherwise if @xmath2345 then @xmath90 extends to an @xmath2021-compatible solution of @xmath2346 , where @xmath2347 ; and if @xmath2348 then @xmath90 extends to an @xmath2021-compatible solution of @xmath2349 , where @xmath325 .",
    "take @xmath119 and @xmath2340 and let @xmath2350 , @xmath2351 , and @xmath2352 .",
    "let @xmath2353 . depending on whether or not @xmath2354 we need to show that @xmath90 can be extended to a solution of @xmath2355 , where @xmath1913 is either empty , if @xmath2343 , or @xmath2356 if @xmath2345 and @xmath2357 , and @xmath268 if @xmath2354 .",
    "the three cases are quite similar so we will unify the proofs as much as possible .",
    "let @xmath2358[not : p - prime - w - prime ] denote the problem @xmath2359 for a set @xmath2360 and @xmath2361[not : s - prime - w - prime ] denote its set of solutions .",
    "then we need to show that @xmath2362 .",
    "first , we will show that there are @xmath2021-compatible solutions of @xmath2363 .",
    "this statement would be trivial , as @xmath2364 contains @xmath2365 , if @xmath1913 was always empty .",
    "otherwise a simple proof is needed .",
    "note that this is the only statement where we consider the three options for @xmath1913 separately .",
    "next , we identify the properties of @xmath2359 required for proving ( s2 ) and show that the problem satisfies them for all choices of @xmath1913 .",
    "the rest of the proof will be given only using these properties ; thus we use the same argument in all the three cases of @xmath1913 .",
    "if @xmath2366 is the full congruence of @xmath2367 for all @xmath2368 , then @xmath2369 and there is nothing to prove .",
    "thus we will always assume that there is @xmath2368 such that @xmath2366 is maximal on @xmath2367 .",
    "[ lem : w - cap - w2 ] the relations @xmath2370 and @xmath2371 are nonempty .    the set @xmath2370 is nonempty , as it contains @xmath2372 , which is nonempty by ( s2 ) for @xmath129 . if @xmath266 , then @xmath2371 contains @xmath2373 or its factor modulo @xmath2374 ( if @xmath2375 ) , which is nonempty .",
    "so , let @xmath245 .",
    "suppose @xmath2343 and so @xmath2376 , and @xmath2377 is a constraint such that @xmath2378 is nontrivial on @xmath2379 and @xmath2380 . by ( s2 ) for @xmath129 tuple @xmath660 can be extended to a solution @xmath283 of @xmath2381 , @xmath2382 .",
    "then @xmath2383 and therefore for any @xmath2384 and any @xmath2385 we have @xmath2386 , that is , @xmath2387 .",
    "suppose now that @xmath2388 .",
    "if @xmath2345 and @xmath2356 , then we apply the argument above to the problem @xmath2389 .",
    "if @xmath2348 and @xmath268 , then we consider the problem @xmath2074 .    for any possible choice of @xmath1913",
    "the sets @xmath2390 satisfy the following conditions .",
    "for the rest of the proof we only need these conditions , and therfore the argument is valid for all choices of @xmath1913 .",
    "first of all if @xmath2375 the set @xmath101 may need to be redefined . by the definition of @xmath101 for every @xmath2225 there are @xmath2391 such that @xmath2392 and @xmath2393 can not be separated in @xmath21 .",
    "if @xmath2394 and @xmath2395 is the only choice for @xmath2396 , variable @xmath43 is removed from @xmath101 .",
    "set @xmath2397 does not have to be modified .",
    "the conditions needed are :    * @xmath2398 is minimal by block - minimality .",
    "* for every @xmath2385 and @xmath2399 any tuple from @xmath2400 , where @xmath2401 , can be extended to a solution from @xmath2402 ; by ( s2 ) .",
    "* for every @xmath2385 and @xmath2399 let @xmath2403 and @xmath2404[not : tau - prime - u - eta - th ] denote the restriction of @xmath2405 on @xmath2406 , that is , @xmath2407 if there are @xmath2408 such that @xmath2409 , @xmath2410 , and @xmath2411 . by lemma  [ lem : congruence - restriction ]",
    "@xmath2404 is either the full congruence on @xmath2412 , or a maximal one . in the latter case @xmath2413 .",
    "* for every @xmath2414 there are @xmath2415 such that @xmath2416 and @xmath2393 can not be separated in @xmath21 .",
    "* for every @xmath2385 , @xmath2399 , and any @xmath2417 , if @xmath2404 is maximal , then for every polynomial @xmath26 of @xmath2418 we have @xmath2419 if and only if @xmath2420 ; by lemma  [ lem : restricted - congruence ] .",
    "we are now in a position to prove lemma  [ lem : s2 - 1 ] .",
    "( of lemma  [ lem : s2 - 1 ] )   recall that we need to prove that any @xmath2353 can be extended to a solution from @xmath2421 . by ( s2 ) @xmath90 can be extended to a tuple @xmath2422 .",
    "we will prove that a required extesion @xmath2423 can be found such that @xmath2424 ( if @xmath660 is chosen well ) .",
    "therefore , we will need to study the relationship of tuples from @xmath2425 extending @xmath90 and the tuples from @xmath2426 .",
    "this is done in claim  1 . since tuples from @xmath2425 are only considered modulo congruences of the form @xmath2405 , while @xmath90 is considered without factoring ,",
    "the main technical hurdle is to ` disentangle ' @xmath90 from the quotient of @xmath2425 . to this end",
    "we consider a congruence @xmath2094 on @xmath2427 that isolates @xmath2021-compatible tuples from there , and then introduce two auxiliary relations @xmath727 and  @xmath1794 .",
    "we would like to define a congruence similar to @xmath2118 on @xmath2428 .",
    "it can not be done in the same straightforward way , since @xmath2429 , so we define it as follows . for @xmath2399 and @xmath2385",
    "we extend the congruences @xmath2404 to congruences of @xmath2428 using @xmath2430 , where @xmath2431 .",
    "then the set @xmath2371 of @xmath2021-compatible tuples from @xmath2370 is a block of @xmath2432 let it be denoted by @xmath1926 . note that @xmath2094 is a congruence of @xmath2428 ,",
    "but the interval @xmath2433 is not necessarily prime . by the observation above and lemma  [ lem : as - type-2 ] @xmath2434 is term equivalent to a module .",
    "we need to prove that there is @xmath2435 such that @xmath2436 and @xmath2437 .",
    "in fact we prove a stronger statement , namely , that for any u - maximal tuple @xmath660 from @xmath2426 there is a solution @xmath283 such that @xmath2436 , @xmath2437 and also @xmath2438 .",
    "however , to formulate it precisely we need two additional constructions .",
    "we need to describe the @xmath2094-blocks that contain tuples extending @xmath90 . in order to do that we separate the variables of @xmath90 from the rest of @xmath2439 by making an extra copy of them , as follows .",
    "let @xmath2440 and @xmath2441 , and @xmath2442 .",
    "let @xmath2443 and its factor @xmath2444 , where @xmath2445 .",
    "let @xmath983 denote the link congruences of @xmath2434 and @xmath2446 with respect to @xmath950 , and let @xmath2447 denote the congruence of @xmath2370 such that @xmath2448 if and only if @xmath2449 . then , as is easily seen , since @xmath2450 is a module , @xmath2451 if and only if there are @xmath2452 such that @xmath2453 and @xmath2454 .",
    "now , we introduce a similar construction for @xmath2418 . the goal is to compare the two .",
    "let @xmath2455 ( recall that @xmath2440 ) and define a relation @xmath2456 as follows : @xmath2457 and let @xmath2458 , where @xmath2459 .",
    "similar to @xmath727 , let @xmath1072 be the link congruences of @xmath2460 and @xmath2461 , where @xmath2462 , with respect to @xmath1802 , and let @xmath2463 denote the congruence of @xmath2372 given by @xmath2464 if and only if @xmath2465 . then immediately by the definition @xmath2466 if and only if there are @xmath2467 and @xmath2468 such that @xmath2453 , @xmath2469 , and @xmath2470 , @xmath2471 .",
    "we are interested in congruences @xmath1049 and @xmath1074 .",
    "the first of them indicates which @xmath2094-blocks extensions of @xmath2472 can belong to .",
    "the second congruence also indicates to which @xmath2094-blocks extensions of @xmath90 to a solution from @xmath2402 can belong to .",
    "clearly , @xmath2473 .",
    "we prove however , that in both cases the set of attainable @xmath2094-blocks is the same .",
    "this essentially means that if a @xmath2094-block can be extended to a solution from @xmath2402 , it can be extended in an almost arbitrary way .",
    "( 1 ) @xmath2474 is a union of @xmath1049-blocks ; + ( 2 ) @xmath2475 ; + ( 3 ) let @xmath686 be a @xmath1074-block and @xmath774 the corresponding @xmath1075-block , then @xmath2476 ; + ( 4 ) for any @xmath2422 such that @xmath2477 is u - maximal in a @xmath1075-block and any @xmath2478 such that @xmath2479 there is @xmath2480 such that @xmath2481 and @xmath2482 .",
    "\\(1 ) it follows by proposition  [ pro : umax - rectangular ] for any @xmath1074-block @xmath2483 and a @xmath1075-block @xmath860 with @xmath2484 , that @xmath2485 .",
    "let @xmath2486 , @xmath2483 be the @xmath1074-block containing @xmath2487 and @xmath860 the corresponding @xmath1075-block . then by the maximality lemma  [ lem : to - max](5 ) there is @xmath2488 such that @xmath2489 and @xmath2490 is u - maximal in @xmath860 .",
    "we assume that @xmath660 satisfies this condition .",
    "let also @xmath686 be the @xmath1049-block containing @xmath2487 .",
    "note that @xmath2491 .",
    "suppose there is @xmath2492 such that @xmath2493 for no @xmath2494 .",
    "we will derive a contradiction .",
    "take some u - maximal tuple @xmath2495 from @xmath1488 .",
    "since @xmath2496 , there is @xmath2497 and @xmath2498 such that @xmath2499 , where @xmath2500 and @xmath2501 .",
    "choose a pair @xmath2502 in such a way that the number of such constraints and triples is minimal .",
    "we will find a polynomial @xmath26 of @xmath2418 such that ( roughly speaking ) @xmath2503 , @xmath2504 , and @xmath2505 differ on fewer constraints and triples .",
    "let @xmath2506 , @xmath2507 .",
    "since the interval @xmath2508 has type , @xmath2509 is a @xmath2508-subtrace .",
    "let @xmath2510 , @xmath2511 , be such that @xmath2139 and @xmath2512 can not be separated in @xmath2513 .    by ( s7 ) for @xmath129 relation @xmath2418",
    "is strongly chained .",
    "since @xmath2514 on @xmath2515 if we consider @xmath2418 as a subdirect product of @xmath2516 and @xmath2517 , @xmath2518 , by lemma  [ lem : collapsing ] there is a @xmath2508-collapsing polynomial @xmath26 of @xmath2418 for @xmath855 . by lemma  [ lem : restricted - congruence ] @xmath2508 can not be separated from @xmath2512 for @xmath2519 . for any @xmath2520 , @xmath2521 ,",
    "consider @xmath2522 .",
    "if @xmath1687 can be separated from @xmath2139 ( or @xmath2139 can be separated from @xmath1687 ) then @xmath2508 can be separated from @xmath1687 ( or the other way round ) . in particular , by lemma  [ lem : collapsing ] @xmath26 can be chosen to satisfy the following conditions + ( a ) @xmath2523 is a @xmath2508-minimal set and @xmath2524 is a @xmath2525-minimal set for @xmath2526 ; + ( b ) for every @xmath2527 , @xmath2528 ; and + ( c ) @xmath26 is idempotent .",
    "+ since @xmath2509 is a @xmath2508-subtrace of @xmath2529 , by condition ( q2s ) of being strongly chained ( s7 ) for @xmath129 polynomial @xmath26 can be chosen such that + ( d ) @xmath2530 , @xmath2531 .",
    "+ moreover , let @xmath2532 be such that there is a tuple @xmath2533 such that @xmath2534 , @xmath2535 , @xmath2536 , and @xmath2537 is u - maximal in @xmath2538 .",
    "such a tuple exists .",
    "indeed , for any @xmath2539 , @xmath2527 , and any @xmath2519 , the interval @xmath2512 and therefore @xmath2540 can be separated from @xmath2541 , or the other way round .",
    "lemma  [ lem : collapsing ] also implies that for any @xmath2542 , @xmath2543 , the interval @xmath2540 can be separated from @xmath2541 , or the other way round .",
    "therefore , by the congruence lemma  [ lem : affine - link ] @xmath2544 . by lemma  [ lem",
    ": maximal - minimal ] polynomial @xmath26 can be chosen such that + ( e ) @xmath2545 .",
    "+ let @xmath2495 be a u - maximal tuple from the @xmath2094-block @xmath2546 , and let @xmath2547 , and @xmath2548 a tuple from @xmath2549 such that @xmath2550 and @xmath2551 ; such a tuple @xmath2548 exists , because @xmath2434 is a module . note that it suffices to prove that @xmath2552 . indeed ,",
    "since @xmath2553 and @xmath2495 agrees with @xmath2548 modulo @xmath2554 for every @xmath2555 and @xmath2556 , for which @xmath660 and @xmath2495 agree , we obtain a contradiction with the choice of @xmath2502 .    to show that @xmath2557 is an @xmath129-compatibile solution take any @xmath2558 and @xmath2559 and let @xmath2560 .",
    "we show that @xmath2561 ; note that this proves not only @xmath129-compatibility , but also that @xmath2557 is a solution : @xmath2562 can be chosen to be @xmath2563 .",
    "let @xmath2564 .",
    "since @xmath2565 , we have @xmath2566 . by ( s2 ) for @xmath129 tuple @xmath2567 can be extended to an @xmath129-compatible solution @xmath2568 from @xmath2418 . by the choice of @xmath26 , property ( b ) , @xmath2569 , and @xmath2570 by definition of @xmath2571 . since @xmath2572 in @xmath2573 , we have @xmath2574 in @xmath2575 , implying by ( s6 ) for @xmath129 that @xmath2576 . as this is true for every constraint @xmath2577",
    ", @xmath2557 is an @xmath129-compatible solution .",
    "\\(2 ) the proof of item ( 1 ) shows in particular that for any @xmath2486 and @xmath2578 such that @xmath2579 , we also have @xmath2580 , as both @xmath2581 and @xmath2582 belong to @xmath1802 . ( 3 ) follows from proposition  [ pro : umax - rectangular ] .",
    "\\(4 ) follows from ( 1 ) and ( 3 ) .",
    "we now can complete the proof of lemma  [ lem : s2 - 1 ] . if we show that @xmath90 can be extended to @xmath2486 such that @xmath2583 and such that @xmath2584 is u - maximal in a @xmath1075-block , claim  2 implies ( s2 ) for @xmath2021 . indeed , suppose there is @xmath2486 satisfying the above conditions . since @xmath2585 ,",
    "there is @xmath2586 such that @xmath2587 . in particular",
    ", this means that @xmath2588 , where @xmath686 is the @xmath1049- , and therefore @xmath1074-block containing @xmath2487 , because @xmath2589 .",
    "then as @xmath2590 by claim  2(4 ) , this means that there is @xmath2591 such that @xmath2592 and @xmath2593 ; that is , @xmath2594 .",
    "next we show such @xmath660 exists .",
    "recall that @xmath2595 denotes the @xmath2094-block of @xmath2596 that contains @xmath2371 , and in particular , @xmath2373 .",
    "first , observe that @xmath2597 indeed , let @xmath2598 be such that @xmath2592",
    ". then @xmath2599 and @xmath2600 belongs to the same @xmath1049-block as @xmath2595 , because @xmath2601 . by claim  2(1 ) @xmath2602 , and as @xmath2603 , this proves the observation .",
    "let @xmath686 be the @xmath1074-block containing @xmath2604 and @xmath774 the corresponding @xmath1075-block . by what is proved above @xmath2605 .",
    "we now only need to show that @xmath2537 can be chosen such that @xmath2606 .",
    "let @xmath78 be the congruence on @xmath2461 given by @xmath2607 if and only if @xmath2608 .",
    "then @xmath2609 is isomorphic to @xmath2610 , in particular , it is a module if @xmath2611 is maximal , and 1-element otherwise .",
    "let @xmath2612 denote the congruence of @xmath2613 given by @xmath2614 if and only if @xmath2615 . as is easily seen ,",
    "if @xmath1530 is a @xmath78-block of @xmath2461 then @xmath2616 is a @xmath2612-block of @xmath2613 .",
    "therefore , as @xmath90 is u - maximal in @xmath2617 , by the maximality lemma  [ lem : to - max](5 ) it can be extended to a u - maximal tuple @xmath2618 in a @xmath78-block @xmath1530 .",
    "since @xmath2619 is a module , by lemma  [ lem : u - max - congruence ] @xmath2618 is also u - maximal in @xmath774 .",
    "the result follows .",
    "condition ( s3 ) can be proved in a similar way , so we just indicate where the proof of lemma  [ lem : s2 - 1 ] has to be changed .    [",
    "lem : s3 - 1 ] @xmath2021 satisfies condition ( s3 ) .",
    "that is , for every @xmath103 , @xmath2620 and for any @xmath327 any @xmath2021-compatible tuple @xmath1988 extends to an @xmath2021-compatible tuple @xmath293 .",
    "if @xmath2621 then corollary  [ cor : cr - structure ] implies that every u - maximal @xmath129-compatible tuple is also @xmath2021-compatible , and the result follows from ( s3 ) for @xmath129 .",
    "suppose that @xmath2622 .",
    "then , as there is a @xmath2021-compatible tuple in @xmath2623 for @xmath2624 , the first part of ( s3 ) follows from the second part .    to prove the second part we show that @xmath2625 satisfy conditions ( x1)(x5 ) , and therefore the argument from the proof of lemma  [ lem : s2 - 1 ] applies in this case as well .",
    "we take @xmath2626 for @xmath2397 and set @xmath2376 .",
    "condition ( x1 ) is trivial ; condition ( x2 ) follows from ( s3 ) for @xmath129 ; and congruences @xmath2404 can be defined in the same way replacing @xmath2397 with @xmath2626 , and they possess the same properties required in ( x3 ) . conditions ( x4),(x5 ) follow from the definitions .",
    "now we use the same argument except that the proof of claim  1 in this case is simpler , because we do not need to show something is a solution ; just that the required tuple belongs to a relation .",
    "we can now complete the proof of theorem  [ the : restricting - strategy ] .",
    "( of theorem  [ the : restricting - strategy ] ) . conditions ( s1)(s3 ) and ( s6 ) are proved in the preceding lemmas .    for ( s4 )",
    "observe that every @xmath2068 is obtained as the intersection of @xmath2007 with a block of @xmath2120 , and therefore is a subalgebra .",
    "also , since @xmath2627 is a module , by lemma  [ lem : u - max - congruence ] @xmath2628 proving the first part of ( s4 ) .    to prove the rest of ( s4 ) let @xmath317 , @xmath318 and @xmath2629 be one of the sets @xmath2630 if @xmath320 , or @xmath2631 for @xmath268 for some @xmath119 or @xmath2632 for some @xmath2633 , if @xmath2634 . as in the proof of condition ( s2 ) we consider the congruence @xmath2094 constructed as in ( [ equ : tau ] ) with @xmath405 in place of @xmath2397 .",
    "let @xmath727 be the @xmath2094-block of @xmath2635 containing @xmath2021-compatible tuples . by ( s4 ) for @xmath129",
    "there is a tuple @xmath2636 that is in @xmath2637 .",
    "since @xmath2638 is a module , by the maximality lemma  [ lem : to - max](4 ) and lemma  [ lem : thin ] there is an as - path @xmath2639 in @xmath2640 such that @xmath2641 .",
    "the tuple @xmath2642 belongs to @xmath2643 and to @xmath2637 .    for ( s5 ) ,",
    "the existence of @xmath2644 follows from ( s3 ) . also , as in the proof of ( s4 ) @xmath2645 .",
    "the result now follows from ( s5 ) for @xmath129 .",
    "finally , ( s7 ) follows from lemma  [ lem : s7 ] .",
    "let @xmath17 be a block - minimal instance , let @xmath129 be a @xmath304-strategy with respect to @xmath332 . take @xmath108 and @xmath2013 with @xmath2010 such that @xmath2646 .",
    "we tighten @xmath129 in two steps . in the first step",
    "we restrict @xmath305 to the subalgebra generated by an as - component of @xmath2647 obtaining a collection of relations that satisfies all the properties of a strategy except ( s5 ) and ( s6 ) . in the second step",
    "we restrict the same domain to one @xmath183-block and restore ( s5 ) and ( s6 ) .",
    "let @xmath686 be an as - component of @xmath2648 , by ( s5 ) @xmath686 is also an as - component of @xmath2019 .",
    "note that if @xmath2649 then by lemma  [ lem : type23 ] any as - component of @xmath2019 is a singleton and step  2 is not needed .",
    "conditions ( s5),(s6 ) in this case are proved as in step  2 .",
    "let @xmath2650 and let @xmath2651 .",
    "we consider the problem @xmath257 obtained from @xmath21 by restricting the domain of @xmath111 to @xmath2652 and the domain of @xmath2653 to @xmath2003 .",
    "we first show that @xmath257 can be converted to a nonempty ( 2,3)-minimal instance that also satisfies some additional conditions .    in order to do",
    "that we introduce a family of binary relations , and then prove that this family is a ( 2,3)-strategy of @xmath257 .",
    "for @xmath2654 , let @xmath2655[not : qxy ] in particular @xmath2656 .",
    "we say that a tuple @xmath90 on a set @xmath2070 ( where @xmath405 can be , e.g.  a subset of @xmath2626 for a constraint @xmath119 , or a subset of @xmath2657 for some @xmath317 ) is _ q - compatible _ if @xmath2658,\\ba[y])\\in\\relo^{xy}$ ] for any @xmath2659 .",
    "[ pro:3-tight ] ( 1 ) for any @xmath2660 and any @xmath2661 there is @xmath2662 such that @xmath2663 and @xmath2664 .",
    "+ ( 2 ) for any @xmath119 let @xmath2210 denote the set of @xmath129-compatible tuples from @xmath22 . for any @xmath327 and any q - compatible @xmath2665",
    ", there is @xmath2666 that is q - compatible , and @xmath2667 .",
    "+ ( 3 ) for any @xmath317 , any @xmath2668 , and any @xmath2669 , where @xmath2670 is the set of solutions of @xmath2671 for some set @xmath1913 from the definition of block - minimality , there is @xmath2672 that is q - compatible and @xmath2673",
    ".    for @xmath2654 let @xmath2674 denote the set of tuples @xmath2675 such that @xmath2676 .",
    "the set @xmath2677 is as - closed in @xmath2678 , and @xmath2679 is as - closed if @xmath2680 .",
    "let @xmath2661 . by the maximality lemma  [ lem : to - max](3 )",
    "either @xmath2674 contains a subdirect product of @xmath686 and @xmath2681 , or @xmath2682 . since @xmath2661 the former option holds .",
    "for the first part of the claim observe that @xmath2683 .",
    "claim 2 . for any @xmath2654",
    ", @xmath2679 is a subdirect product of @xmath2684 .",
    "let @xmath2685 , then there is @xmath1563 with @xmath2686 . by ( s1 ) for @xmath129 , @xmath2687 is ( 2,3)-strategy , and there is @xmath2688 with @xmath2689 ; then @xmath2661 .",
    "we prove ( 2 ) , the proof of ( 3 ) is basically identical , and we explain how to modify this proof to prove ( 1 ) .    by induction on @xmath91",
    "we prove that a q - compatible tuple @xmath2665 can be found for any @xmath327 , @xmath2690 .",
    "moreover , for any q - compatible @xmath2691 , a q - compatible @xmath2692 can be found such that @xmath2693 .",
    "first we consider the case @xmath2694 .",
    "for @xmath1747 the existence of @xmath90 follows from claim  2 .",
    "so , suppose such a tuple exists for any @xmath327 with @xmath2695 .",
    "let @xmath327 , @xmath2696 , @xmath2697 , @xmath2698 , and @xmath2699 is q - compatible .",
    "let also @xmath2700 , @xmath2701 .",
    "without loss of generality assume @xmath2702 , @xmath2703 , @xmath2704 .",
    "consider the relation given by @xmath2705 it suffices to prove that @xmath2706 , where @xmath2707\\in d$ ] for each @xmath2708 $ ] , since this would mean that there is a @xmath2709 with the required properties .",
    "observe first that @xmath2710 . indeed , any @xmath2711 by ( s3 ) can be extended to @xmath2712 ; then the values of the variables @xmath2713 can be chosen by ( 2,3)-consistency and ( s1 ) .",
    "this also implies that @xmath2714 . since @xmath2010 , by ( s7 ) for @xmath129 and the congruence lemma  [",
    "lem : affine - link ] for any @xmath247 the relation @xmath2715 either contains @xmath2716 , or @xmath2717 is the graph of a mapping @xmath2718 .",
    "let the set of variables for which the latter option holds be denoted by @xmath1472 . by construction , for any @xmath2719 , and any @xmath2720",
    ", we have @xmath2721 . for any @xmath2722 ,",
    "the set @xmath2723 is as - closed , and @xmath2724 .",
    "let @xmath2725 and , if @xmath2726 , let @xmath2727)$ ] for any @xmath2728 .",
    "if @xmath2729 , but @xmath2730 , then let @xmath2731 be an extension of @xmath2732 to a @xmath416-compatible tuple from @xmath2733 and set @xmath2734 .",
    "if @xmath2735 , then let @xmath940 be any element of @xmath686 .",
    "then @xmath940 is such that @xmath2736,d)\\in\\rel^{\\{w , v\\},\\cr}\\fac\\al$ ] for any @xmath2737 .",
    "consider the tuple @xmath2738 ; we show that it satisfies the conditions of the 2-decomposition theorem  [ the : quasi-2-decomp ] with @xmath2739 .",
    "note that we can not replace @xmath2740 with @xmath2741 here , because in order to apply the 2-decomposition theorem  [ the : quasi-2-decomp ] @xmath90 has to be as - maximal @xmath2742 , which may not be true . by what is observed before , @xmath2743 , and for any @xmath2744 we have @xmath2745,\\ba[s_2])\\in\\pr_{s_1s_2}\\relo$ ] .",
    "we now show that for any of the remaining pairs of variables @xmath2746 @xmath2747,\\bb[z])\\in\\pr_{xz}\\relo$ ] .",
    "let @xmath2748 and @xmath2749 . if @xmath2750 , then by the inductive hypothesis @xmath2732 can be extended to some value @xmath935 of @xmath2751 such that @xmath2752,c)\\in\\relo^{sy}$ ] for any @xmath2753 .",
    "then there is @xmath2754 such that @xmath2755 .",
    "also , @xmath2756 and @xmath1637 can be chosen such that @xmath2757 .",
    "if @xmath2758 , then find a value @xmath935 for @xmath2751 such that @xmath2759,c)\\in\\relo^{x_i , x_{i+1}}$ ] , and then extend @xmath935 to a tuple on @xmath2760 by induction hypothesis .",
    "the values of @xmath2713 can be set using ( 2,3)-consistency . finally ,",
    "if @xmath2761 , we proceed as in one of the previous cases .    by the 2-decomposition theorem  [ the : quasi-2-decomp ]",
    "there is @xmath2762 such that @xmath2763 in @xmath2764 , @xmath2658,\\ba[z])\\sqq_{as}(\\bb'[x],\\bb'[z])$ ] in @xmath2765 for any @xmath2766 , and @xmath2767 $ ] in @xmath2648 for any @xmath2708 $ ] .",
    "let @xmath678 be the link congruences of @xmath2768 with respect to @xmath2742 .",
    "since @xmath2710 , the link congruences of @xmath2769 with respect to @xmath2770 are smaller than @xmath678 . therefore the @xmath699- and @xmath700-blocks @xmath470 containing @xmath2732 and @xmath2771 $ ] , respectively , are such that @xmath2772 .",
    "choose @xmath2773 such that @xmath2774 in @xmath2770 and @xmath2618 is as - maximal in @xmath1024 .",
    "as is easily seen , such a tuple exists by the rectangularity corollary  [ cor : linkage - rectangularity ] , because , since @xmath1024 is linked , any @xmath2775 such that @xmath2776 is as - maximal in @xmath7 and @xmath2777 $ ] is as - maximal in @xmath51 is as - maximal in @xmath1024 .",
    "now , consider @xmath2778 by the same argument as before , there is @xmath2779 such that @xmath2780 in @xmath2781 and @xmath2782\\in d$ ] for @xmath2708 $ ] . since @xmath2618 is as - maximal in @xmath2781 , we also have @xmath2783 in @xmath2781 .",
    "therefore there is @xmath2784 such that @xmath2785,c)\\in\\relo^{xx_{i+1}}$ ] for every @xmath2786 . by the 2-decomposition theorem  [ the : quasi-2-decomp ]",
    "applied to @xmath2210 , there is @xmath2787 such that @xmath2788 and @xmath2789 $ ] .",
    "finally , since @xmath90 is as - maximal in @xmath2770 , there is an as - path from @xmath2618 to @xmath90 in @xmath2770 and we complete the proof by the maximality lemma  [ lem : to - max](4 ) .",
    "next , we consider the case @xmath2790 .",
    "let @xmath2791 , @xmath2792 and @xmath2793 .",
    "note that by reordering the variables we may assume that if @xmath2794 then @xmath2795 . by the induction hypothesis there is @xmath2796 such that @xmath2731 belongs to @xmath2797 and is q - compatible , in particular , @xmath2798 .",
    "we consider the tuple @xmath2799 and relation @xmath2800 .",
    "we have @xmath2801 . for any @xmath2802",
    "$ ] we have @xmath1287,c)\\in\\relo^{x_jv}$ ] by the choice of @xmath935 . if @xmath2803 then there is @xmath2804 such that @xmath2759,c')\\in\\rel^{\\{x_i , v\\},\\cr}$ ] . by ( s3 ) for @xmath129 , @xmath2759,c')$ ] extends to a tuple from @xmath2210 , therefore @xmath2759,c)\\in\\pr_{x_iv}\\rel'$ ] .",
    "if @xmath2794 , then there is also some @xmath2805 .",
    "then since @xmath1287,\\ba[i])\\in\\relo^{x_jx_i}$ ] , we have @xmath2806)=\\kp_{x_i}(\\ba[x_i])=c$ ] .",
    "therefore there is @xmath2804 such that @xmath2759,c')\\in\\rel^{\\{x_i , v\\},\\cr}$ ] and we continue as before . by the 2-decomposition theorem  [ the : quasi-2-decomp ] there is @xmath1783 such that @xmath2807 and @xmath2808 $ ] in @xmath2648 , that is , @xmath294\\in d$ ] .",
    "therefore there is @xmath2809 such that @xmath2810 and @xmath2811^\\al\\in d$ ] , as required",
    ".    item ( 3 ) can be proved in the same way , as @xmath21 is block - minimal . for ( 1 )",
    "we need to make two changes .",
    "first , we apply the argument above for @xmath1747 and stop before the last application of the 2-decomposition theorem  [ the : quasi-2-decomp ] .",
    "second , we need to consider the case when extending a pair from @xmath2679 by a value of @xmath111 .",
    "more precisely , let @xmath2661 , @xmath2654 , we need to find @xmath2796 such that @xmath2798 and @xmath2812 , @xmath2813 .",
    "let @xmath2814 by ( 2,3)-consistency and construction @xmath2815 , where @xmath2816 .",
    "the relation @xmath2817 then satisfies the conditions : @xmath2818 where @xmath2819 . by the 2-decomposition theorem  [ the : quasi-2-decomp ]",
    "there is a tuple @xmath2820 such that @xmath2821 , that is , @xmath2822 .",
    "therefore @xmath727 contains a tuple @xmath2823 for some @xmath935 with @xmath2824 .",
    "this @xmath935 is as required .",
    "let @xmath301 be the problem obtained from @xmath257 as follows : establish ( 2,3)-minimality and , for any @xmath317 , establish minimality of @xmath2825 , where @xmath1913 is one of the sets specified in the definition of block - minimality , until the instance does not change any longer .",
    "let @xmath2826 be the domains of @xmath247 for @xmath301 , for @xmath103 let @xmath2827 denote the corresponding constraint relation of @xmath301 ; for @xmath317 let @xmath2828 denote the set of solutions of @xmath2829 ; finally @xmath2830 denote the set of tuples from @xmath2007 extending to a solution of @xmath2829 .",
    "the next corollary follows straightforwardly from proposition  [ pro:3-tight ] , because establishing ( 2,3)-minimality or minimality never eliminates an as - maximal q - compatible tuples .",
    "[ cor:23-minimality ] the sets @xmath2826 , @xmath2827 , @xmath2828 , and @xmath2830 contain all the as - maximal q - compatible tuples from @xmath2003 , @xmath22 , @xmath2831 , and @xmath2007 , respectively .",
    "now we can show that the collection of relations @xmath2832 is almost a @xmath304-strategy .",
    "[ the : non - as - restriction ] the collection of relations @xmath2833 constructed as above satisfies all the conditions of a @xmath304-strategy with respect to @xmath332 , except ( s5 ) and ( s6 ) .",
    "condition ( s1 ) follows from corollary  [ cor:23-minimality ] .",
    "conditions ( s2),(s3 ) follow from corollary  [ cor:23-minimality ] and construction ( establishing block - minimality ) . for ( s4 )",
    "every relation @xmath2830 is a subalgebra in @xmath2007 and therefore in @xmath2008 by construction .",
    "moreover , as by proposition  [ pro:3-tight ] @xmath2830 contains an element as - maximal in @xmath2007 , we have @xmath2834 .",
    "finally , condition ( s7 ) follows from ( s7 ) for @xmath129 .",
    "we will need another property of @xmath301 .",
    "unfortunately , q - compatible tuples are not very helpful in establishing properties ( s5),(s6 ) , since those are properties of u - maximal fragments of relations .",
    "therefore we need to extend q - compatibility to u - maximal elements .",
    "similar to q - compatibility we make the following definition . for @xmath2654 , let @xmath2835[not : pxy ] in particular @xmath2836 . note that these relations are different from @xmath2837 in that they consist of u - maximal elements and pairs , rather than as - maximal as @xmath2837 .",
    "we say that a tuple @xmath90 on a set @xmath2070 ( where @xmath405 can be , e.g.  a subset of @xmath2626 for a constraint @xmath119 , or a subset of @xmath2657 for some @xmath317 ) is _ p - compatible _ if @xmath2658,\\ba[y])\\in\\relp^{xy}$ ] for any @xmath2659 .",
    "let @xmath2838 be the instance obtained as follows : first , restrict the domains and relations of @xmath21 to the sets of p - compatible tuples they contain ; let the new relation for @xmath103 be denoted by @xmath2839 .",
    "second , establish ( 2,3)-minimality and block - minimality of the resulting instance . let @xmath2840 denote the relations induced by @xmath2838 . note that the domains and relations of @xmath2838 are not necessarily subalgebras .",
    "[ lem : step-1-as - closeness ] let @xmath103 , @xmath317 .",
    "+ ( 1 ) relations @xmath2841 are nonempty , and @xmath2842 , @xmath2843 , @xmath2844 .",
    "+ ( 2 ) relations @xmath2845 and @xmath2846 are as - closed in @xmath2007 , and in @xmath2847 , respectively ( recall that @xmath2848 is the set of @xmath129-compatible tuples from @xmath2849 ) .",
    "\\(1 ) the inclusions @xmath2842 , @xmath2843 , @xmath2850 follow from the construction , as @xmath2851 . on the other hand ,",
    "as every q - compatible tuple from @xmath22 belongs to @xmath2839 , the nonemptyness follows by corollary  [ cor:23-minimality ] .",
    "\\(2 ) first we observe that for any @xmath2654 the relation @xmath2852 , and therefore @xmath2853 , is as - closed in @xmath2211 .",
    "this can be done in the same way as in the proof of proposition  [ pro:3-tight ] .",
    "let @xmath2854 and @xmath2855 be such that @xmath2856 .",
    "we need to find @xmath1563 such that @xmath2857 , @xmath2858 .",
    "let @xmath2859 which is a subalgebra of @xmath2860 .",
    "since @xmath2854 there is @xmath687 with @xmath2861 . by ( s1 ) for @xmath129 we have @xmath2862 , moreover , @xmath2856 in @xmath2863 . by the maximality lemma  [ lem : to - max](4 ) there is @xmath2864 such that @xmath2865 and @xmath2866 in @xmath727 .",
    "therefore @xmath2867 .",
    "it suffices to prove the statement for relations of the form @xmath2845 , because relations @xmath2868 are pp - definable through @xmath2845 , and we can use lemma  [ lem : poly - closed](2 ) . since @xmath2852 are as - closed , every relation @xmath2869 is also as - closed in @xmath2870 .",
    "we prove by induction that this property is preserved as ( 2,3)-minimality and block - minimality is being established .",
    "the observation about the relations @xmath2869 establishes the base case . for the induction step ,",
    "let @xmath2871 and @xmath2872 denote the current state of the corresponding relations , and they are as - closed .",
    "there are two cases for the induction step .    in the first case",
    "we make a step to enforce ( 2,3)-minimality , that is , for some @xmath2660 we check whether or not some @xmath2873 can be extended by @xmath2874 such that @xmath2875 and @xmath2876 .",
    "let @xmath2873 be such that there are @xmath2874 with @xmath2875 , @xmath2876 , and let @xmath2877 such that @xmath2856 in @xmath2878 .",
    "then there is @xmath2879 such that @xmath2880 , @xmath2881 .",
    "similar to part ( 1 ) let @xmath2882 we have @xmath2883 by ( s1 ) for @xmath129 , and @xmath2884 . by the maximality lemma  [ lem : to - max](4 ) we may assume that @xmath2885 in @xmath727 . since @xmath2886 are as - closed , we have @xmath2887    in the second case we solve a subproblem of the form @xmath2888 .",
    "let @xmath318 , let @xmath2872 be the corresponding set of solutions .",
    "take @xmath103 and @xmath2385 , let @xmath2889 .",
    "suppose @xmath2890 be such that there is a solution @xmath2891 extending @xmath2892 , and let @xmath2893 is such that @xmath1785 in @xmath2894 .",
    "we need to show that @xmath2895 is extendible to a solution from @xmath2872 .",
    "let @xmath2896 be a solution extending @xmath2895 .",
    "since @xmath2897 by the maximality lemma  [ lem : to - max](4 ) we may assume that @xmath2898 in @xmath2899 .",
    "since by the induction hypothesis @xmath2900 is as - closed , the result follows .      in this step",
    "we tighten the ` near - strategy ' @xmath2833 in a way similar to that from section  [ sec : type-2 ] .",
    "we start with showing that the domains of all variables in @xmath2901 have to be tightened .",
    "[ lem : binary - connections ] for every @xmath2902 there is a congruence @xmath2903 with @xmath2904 , and such that @xmath2905 is aligned with respect to @xmath2906 , that is , for any @xmath2907 , @xmath2908",
    "if and only if @xmath2909 .    it suffices to show that the link congruences @xmath678 of @xmath2910 viewed as a subdirect product of @xmath2911 are such that @xmath2912 and @xmath2913 . since @xmath2225 there are @xmath2914 such that @xmath2915 and @xmath2139 and @xmath204 can not be separated . by lemma  [ lem:34-links ]",
    "it follows that @xmath2912 and @xmath1211 .",
    "we set @xmath2916 . since @xmath2917 is isomorphic to @xmath2019 , @xmath2904 .",
    "let @xmath2025 , @xmath2918 for @xmath2902 , and @xmath2919 for @xmath2920 .",
    "lemma  [ lem : binary - connections ] implies that there is an isomorphism @xmath2921 .",
    "choose an as - maximal @xmath2922-block @xmath51 , an element of @xmath686 from step  1 and set @xmath2026 , @xmath2923 for @xmath2920 , and @xmath2924 for @xmath2920 .",
    "let @xmath298 be the problem instance obtained from @xmath301 as follows : first restrict the domain of @xmath2225 in @xmath301 to @xmath2925 , then establish the ( 2,3)-minimality of the resulting problem , and finally , establish the minimality of all problems of the form @xmath2829 for @xmath317 , where @xmath1913 is a set specified in the definition of block - minimality for @xmath21 .",
    "let @xmath2926 be the following collection of relations ;    * @xmath2927 ; * for every @xmath103 , @xmath2055 , @xmath2928 , where @xmath1520 is the constraint relation of @xmath298 obtained from @xmath22 .",
    "[ lem : step-2-relations ] ( 1 ) for every constraint @xmath103 , and every @xmath2929 such that @xmath2930\\in\\nu_u(d)$ ] for @xmath2931 there is a tuple @xmath2932 such that @xmath2933 and @xmath2934\\in b'_u$ ] for @xmath2931 .",
    "+ ( 2 ) let @xmath103 , @xmath2935 , @xmath2936 , and @xmath2937 such that @xmath2930\\in\\nu_u(d)$ ] for @xmath2938 .",
    "then there is @xmath2939 such that @xmath2940 and @xmath2934\\in b'_u$ ] for @xmath2941 .",
    "+ ( 3 ) let @xmath2935 and @xmath2936 .",
    "let @xmath2942 be the set of solutions of @xmath2943 , where @xmath2376 if @xmath320 , and is one of the sets specified in the definition of block - minimality otherwise .",
    "for every solution @xmath2944 such that @xmath2945\\in\\nu_u(d)$ ] for @xmath2946 there is a solution @xmath2947 such that @xmath2948 for @xmath2949 and @xmath2950 for @xmath2946 .",
    "\\(1 ) let @xmath2951 and @xmath2952 .",
    "if @xmath2953 there is nothing to prove ; assume @xmath2954 .",
    "it suffices to consider @xmath2955 where @xmath2956 if @xmath2957 and @xmath2958 otherwise .",
    "so , we assume @xmath2959 for all @xmath2957 . then for any @xmath2960 and any @xmath2961 such that @xmath2962\\in b_{u_1},\\bd[u_2]\\in b_{u_2}$ ] we have @xmath2963=\\nu_{u_2}\\circ\\nu_{u_1}^{-1}(\\bd[u_1])$ ] .",
    "therefore we may assume that @xmath2964 , say , @xmath2965 .",
    "considering @xmath2827 as a subalgebra of @xmath2966 , the result follows by the congruence lemma  [ lem : affine - link ] . indeed , since there is a @xmath2967-collapsing polynomial @xmath26 of @xmath22 , that is , @xmath2968 , there are no @xmath2969 with @xmath2970 such that @xmath2971 can not be separated from @xmath1687 .",
    "\\(2 ) and ( 3 ) are proved in essentially the same way .    to show that @xmath298 has the desirable properties , in particular , it is nonempty",
    ", we consider a collection of unary and binary relations similar to @xmath2837 from step  1",
    ". for @xmath2654 let @xmath2972 denote the following sets : @xmath2973[not : txy ]    a tuple @xmath90 over a set of variables @xmath2070 is said to be _ t - compatible _ if for any @xmath2659 , @xmath2658,\\ba[y])\\in\\reli^{xy}$ ] .",
    "the following lemma provides the main structural result necessary for proving that @xmath2926 is a @xmath2974-strategy .",
    "[ lem : step-2-nonempty ] let @xmath1794 be one of the relations @xmath22 , @xmath2007 , @xmath2975 , and @xmath2976 the corresponding relations @xmath2827 , @xmath2830 , or @xmath2977 , and @xmath1520 , @xmath2978 , or @xmath2979 , respectively , for some @xmath103 and @xmath317 , where @xmath1913 is a set from the definition of block - minimality ; and let @xmath405 be its set of coordinate positions . + ( 1 ) every q - compatible @xmath2980 such that @xmath2930\\in b'_u$ ] for @xmath2981 is also t - compatible .",
    "+ ( 2 ) @xmath2595 contains all the as - maximal t - compatible tuples from @xmath1803 .",
    "+ ( 3 ) if @xmath2982 , then @xmath2983 is as - closed in @xmath2984 .",
    "\\(1 ) by corollary  [ cor:23-minimality ] , if , say @xmath2217 and @xmath2661 are such that @xmath2985 , then @xmath2986 , which can be proved as in the proof of proposition  [ pro:3-tight](1 ) . therefore , it suffices to prove that if @xmath2987 , then @xmath2988 .",
    "this can be done in the same way as in the proof of proposition  [ pro:3-tight ] .",
    "let @xmath2661 , we need to find @xmath2989 such that @xmath2812 , @xmath2813 .",
    "let @xmath2990 which is a subalgebra of @xmath2991 . by ( 2,3)-consistency of @xmath301 @xmath2992 .",
    "let @xmath2817 .",
    "since each of @xmath2680 , @xmath2993 , @xmath2994 is polynomially closed in the corresponding constraint relation @xmath2995 , or @xmath2996 of @xmath21 , @xmath727 is polynomially closed in @xmath2997 as well , and so is @xmath950 in @xmath2998 let @xmath2999 , by the congruence lemma  [ lem : affine - link ] either @xmath3000 or there is @xmath3001 such that @xmath3002 is the graph of a mapping @xmath3003 . in the former case we are done , because then @xmath3004 , and therefore @xmath2861 for some @xmath2989 .",
    "the latter case is not possible , because by the congruence lemma  [ lem : affine - link ] there is @xmath3005 such that @xmath3006 , and @xmath2139 and @xmath1687 can not be separated .",
    "this however is not the case , since @xmath2987 .",
    "\\(2 ) similar to proposition  [ pro:3-tight ] and corollary  [ cor:23-minimality ] it suffices to prove that for any @xmath3007 , any t - compatible @xmath3008 can be extended to a t - compatible @xmath3009 .",
    "in fact , since @xmath1803 contains all the q - compatible tuples , and therefore all the t - compatible tuples from @xmath1794 , it suffices to prove the statement for @xmath1794 , rather than for @xmath1803 .",
    "we show that for any @xmath3010 tuple @xmath90 can be extended to a t - compatible tuple @xmath3011 . by proposition  [ pro:3-tight ]",
    "there is a q - compatible @xmath2488 with @xmath3012 .",
    "if @xmath3013 or @xmath3014 , we can set @xmath3015 .",
    "suppose that @xmath3016 and @xmath2225 .",
    "then we proceed similar to part ( 1 ) .",
    "let @xmath3017 , let @xmath3018 by ( 2,3)-consistency of @xmath301 and proposition  [ pro:3-tight ] @xmath3019 , and by corollary  [ cor:23-minimality ] @xmath3020 , where @xmath1802 is the set of all t - compatible ( equivalently , q - compatible ) tuples from @xmath3021 .",
    "let @xmath2817 .",
    "since each of @xmath3022 is polynomially closed in @xmath3023 and @xmath3024 is polynomially closed in itself , by lemma  [ lem : poly - closed](2 ) @xmath727 is polynomially closed in @xmath3025 as well , and so is @xmath950 in @xmath3026 let @xmath3027 .",
    "now we can finish the proof in the same way as in part ( 1 ) .",
    "\\(3 ) let @xmath3028 .",
    "observe first , that every tuple from @xmath3029 is p - compatible ( see section  [ sec : step-1 ] ) . if we prove that @xmath2978 contains every p - compatible tuple @xmath90 from @xmath2830 such that @xmath2930\\in b'_u$ ] for every @xmath2981 , by lemma  [ lem : step-1-as - closeness](2 ) the result follows .",
    "as in the proof of lemma  [ lem : step-1-as - closeness ] we proceed by induction on the restriction of the problem @xmath301 being converted to a ( 2,3)-minimal and block - minimal instance .",
    "let @xmath2827 and @xmath2830 denote the relations associated with the instance @xmath301 .",
    "let @xmath2839 and @xmath2869 denote the relations obtained from @xmath2827 and @xmath2830 in the first step of converting @xmath301 to @xmath298 , that is , restricting the domains .",
    "by lemma  [ lem : step-2-relations ] relations @xmath3030 contain all the necessary p - compatible relations .",
    "this provides the base case . for the induction step",
    "we again consider two cases .",
    "we denote the current constraint relations by @xmath3031 and the ones from the ( 2,3)-strategy by @xmath3032 .    in the first case we enforce ( 2,3)-minimality for @xmath2660 .",
    "let @xmath2873 be a p - compatible tuple .",
    "then there is @xmath3033 such that @xmath3034 , @xmath3035 are p - compatible . as in the proof of item ( 1 ) of this lemma",
    ", we can argue that @xmath3036 can be assumed .",
    "if @xmath3037 , the pairs @xmath3038 are as required .",
    "otherwise , @xmath3039 can be chosen from @xmath3040 by lemma  [ lem : step-2-relations ] .    in the second case",
    "let @xmath2385 and @xmath3041 ; we solve a problem of the form @xmath3042 , let @xmath3043 be the set of solutions of this problem .",
    "let also @xmath3044 .",
    "we need to show that for any p - compatible @xmath3045 with @xmath2930\\in b'_u$ ] for @xmath3046 the tuple @xmath2892 can be extended to a p - compatible solution @xmath3047 .",
    "since @xmath2937 , the tuple @xmath2892 can be extended to a u - maximal solution @xmath3048 .",
    "if @xmath3049 or @xmath3016 , solution @xmath283 is as required . otherwise by lemma  [ lem : step-2-relations ] @xmath283 can be chosen p - compatible and such that @xmath3050 for @xmath3051 ; that is @xmath3047 by the induction hypothesis .",
    "now we are ready to prove that @xmath2926 is a @xmath335-strategy .",
    "[ the : step-2-strategy ] @xmath2926 is a @xmath335-strategy with respect to @xmath2022 .",
    "( s1 ) follows directly from the construction , since the relations @xmath3052 result from establishing ( 2,3)-minimality of @xmath298 , and they are nonempty by lemma  [ lem : step-2-nonempty](1 ) . conditions ( s2 ) and ( s3 ) are also by construction .",
    "condition ( s4 ) also holds by construction , as all the relations of the form @xmath2978 are subalgebras .",
    "also , each of them contains a q - compatible element , which is as - maximal in @xmath2007 , implying that @xmath3053 .    for ( s5 )",
    "the existence of @xmath3054 for @xmath247 follows from the construction , and the as - closeness of @xmath3055 follows from lemma  [ lem : step-2-nonempty](3 ) .",
    "condition ( s6 ) follows from lemma  [ lem : step-2-nonempty](3 ) and ( s6 ) for @xmath129 as well .",
    "finally , condition ( s7 ) holds by lemma  [ lem : s7 ] .    10    eric allender , michael bauland , neil immerman , henning schnoor , and heribert vollmer .",
    "the complexity of satisfiability problems : refining schaefer s theorem . in _ mfcs _ , pages 7182 , 2005 .",
    "libor barto .",
    "the dichotomy for conservative constraint satisfaction problems revisited . in _ lics _ , pages 301310 , 2011 .",
    "libor barto .",
    "the constraint satisfaction problem and universal algebra . , 21(3):319337 , 2015 .",
    "libor barto .",
    "the collapse of the bounded width hierarchy .",
    ", 26(3):923943 , 2016 .",
    "libor barto and marcin kozik .",
    "absorbing subalgebras , cyclic terms , and the constraint satisfaction problem . , 8(1 ) , 2012 .",
    "libor barto and marcin kozik .",
    "constraint satisfaction problems solvable by local consistency methods . , 61(1):3:13:19 , 2014 .",
    "libor barto , marcin kozik , and todd niven .",
    "the csp dichotomy holds for digraphs with no sources and no sinks ( a positive answer to a conjecture of bang - jensen and hell ) .",
    ", 38(5):17821802 , 2009 .",
    "libor barto , marcin kozik , and ross willard . near unanimity constraints have bounded pathwidth duality . in",
    "_ lics _ , pages 125134 , 2012 .",
    "libor barto , andrei a. krokhin . , and ross willard .",
    "polymorphisms , and how to use them . in _ the constraint satisfaction problem : complexity and approximability [ result of a dagstuhl seminar ] _ , pages 144 , 2017 .",
    "libor barto , and marcin kozik .",
    "polymorphisms , and how to use them . in _ the constraint satisfaction problem : complexity and approximability [ result of a dagstuhl seminar ] _ , pages 4577 , 2017 .",
    "joel berman , pawel idziak , petar markovi , ralph mckenzie , matthew valeriote , and ross willard .",
    "varieties with few subalgebras of powers . , 362(3):14451473 , 2010 .",
    "jonah brown - cohen and prasad raghavendra .",
    "correlation decay and tractability of csps . in _",
    "icalp _ , pages 79:179:13 , 2016 .",
    "andrei a.  bulatov .",
    "three - element maltsev algebras . , 71(3 - 4):469500 , 2002 .",
    "andrei a. bulatov . a dichotomy theorem for constraints on a three - element set . in _ focs _ ,",
    "pages 649658 , 2002 .",
    "andrei  a. bulatov .",
    "tractable conservative constraint satisfaction problems . in _ lics _ , pages 321330 , 2003 .",
    "andrei  a. bulatov . a graph of a relational structure and constraint satisfaction problems . in _",
    "lics _ , pages 448457 , 2004 .",
    "andrei  a. bulatov . a dichotomy theorem for constraint satisfaction problems on a 3-element set .",
    ", 53(1):66120 , 2006 .",
    "andrei  a. bulatov .",
    "complexity of conservative constraint satisfaction problems .",
    ", 12(4):24 , 2011 .",
    "andrei  a. bulatov .",
    "conservative constraint satisfaction re - revisited .",
    ", 82(2):347356 , 2016 .",
    "andrei  a. bulatov .",
    "graphs of finite algebras , edges , and connectivity .",
    "corr abs/1601.07403 ( 2016 ) .",
    "andrei  a. bulatov .",
    "graphs of relational structures : restricted types . in _ lics _ , pages 642651 , 2016 .",
    "andrei  a. bulatov .",
    "constraint satisfaction problems over semilattice block maltsev algebras . ,",
    "abs/1701.02623 , 2017 ( accepted to lics 2017 ) .",
    "andrei  a. bulatov . a dichotomy theorem for nonuniform csps . ,",
    "abs/1703.03021 , 2017 .",
    "andrei  a. bulatov and vctor dalmau . a simple algorithm for maltsev constraints .",
    ", 36(1):1627 , 2006 .",
    "andrei  a. bulatov and peter jeavons .",
    "algebraic structures in combinatorial problems .",
    "technische universitt dresden , math - al-4 - 2001 , 2001    andrei  a. bulatov , peter jeavons , and andrei  a. krokhin . classifying the complexity of constraints using finite algebras .",
    ", 34(3):720742 , 2005 .",
    "andrei  a. bulatov , andrei  a. krokhin , and benoit larose .",
    "dualities for constraint satisfaction problems . in _ complexity of constraints - an overview of current research themes [ result of a dagstuhl seminar ] _ , pages 93124 , 2008 .",
    "andrei  a. bulatov and matthew valeriote .",
    "recent results on the algebraic approach to the csp . in _ complexity of constraints - an overview of current research themes [ result of a dagstuhl seminar ] .",
    "_ , pages 6892 , 2008 .    s.  burris and h.p .",
    ", volume  78 of _ graduate texts in mathematics_. springer - verlag , new york - berlin , 1981 .    hubie chen and benoit larose . asking the metaquestions in constraint tractability . , abs/1604.00932 , 2016 .",
    "vctor dalmau and andrei  a. krokhin .",
    "majority constraints have bounded pathwidth duality .",
    ", 29(4):821837 , 2008 .",
    "rina  dechter . .",
    "morgan kaufmann publishers , 2003 .",
    "tomas  feder and moshe y.  vardi .",
    "monotone monadic snp and constraint satisfaction . in _",
    "stoc _ , pages 612622 , 1993 .",
    "tomas  feder and moshe y.  vardi .",
    "the computational structure of monotone monadic snp and constraint satisfaction : a study through datalog and group theory .",
    ", 28:57104 , 1998 .",
    "ralph freese and matthew valeriote . on the complexity of some maltsev conditions . , 19(1):4177 , 2009 .",
    "georg gottlob , gianluigi greco , and francesco scarcello .",
    "treewidth and hypertree width . in _ tractability : practical approaches to hard problems _ , cambridge university press , pages 338 , 2014 .",
    "pavol  hell and jaroslav  neetil . on the complexity of @xmath2-coloring .",
    ", 48:92110 , 1990 .    pavol  hell and jaroslav  neetil .",
    "graphs and homomorphisms , volume  28 of _ oxford lecture series in mathematics and its applications_. oxford university press , 2004 .",
    "david  hobby and ralph n.  mckenzie . ,",
    "volume  76 of _ contemporary mathematics_. american mathematical society , providence , r.i . , 1988 .",
    "pawel  m. idziak , petar markovic , ralph mckenzie , matthew valeriote , and ross willard .",
    "tractability and learnability arising from algebras with few subpowers .",
    ", 39(7):30233037 , 2010 .",
    "peter g.  jeavons , david  a. cohen , and marc gyssens . closure properties of constraints . , 44(4):527548 , 1997 .",
    "peter g.  jeavons . on the algebraic structure of combinatorial problems .",
    ", 200:185204 , 1998 .",
    "peter g.  jeavons , david a.  cohen , and martin c.  cooper . constraints , consistency and closure . , 101(1 - 2):251265 , 1998 .",
    "keith kearnes .",
    "idempotent simple algebras . in _",
    "logic and algebra ( pontignano , 1994 ) _ , lecture notes in pure and appl . math .",
    "180 , pages 529572 , 1996 .",
    "phokion kolaitis and moshe vardi .",
    "a game - theoretic approach to constraint satisfaction . in _",
    "aaai _ , pages 175 - 181 , 2000 .",
    "phokion kolaitis .",
    "constraint satisfaction , databases , and logic . in _",
    "ijcai _ , pages 1587 - 1595 , 2003 .",
    "marcin kozik .",
    "weak consistency notions for all the csps of bounded width . in _ lics _ , pages 633641 , 2016 .",
    "andrei a. krokhin and stanislav zivny ( eds . ) .",
    "the constraint satisfaction problem : complexity and approximability .",
    ", vol .  7 , schloss dagstuhl - leibniz - zentrum fuer informatik , 2017 .    gbor kun and mario szegedy . a new line of attack on the dichotomy conjecture . ,",
    "52:338367 , 2016 .",
    "benoit larose , cynthia loten , and claude tardif .",
    "a characterisation of first - order constraint satisfaction problems . , 3(4 ) , 2007 .",
    "petar markovi .",
    "the complexity of csps on a 4-element set . personal communication , 2011 .",
    "mikls marti .",
    "malcev on top .",
    "manuscript , available at http://www.math.u - szeged.hu/~mmaroti / pdf/200x%20maltsev% + 20on%20top.pdf , 2011 .",
    "mikls marti .",
    "tree on top of malcev .",
    "manuscript , available at http://www.math.u - szeged.hu/~mmaroti / pdf/200x%20tree% + 20on%20top%20of%20maltsev.pdf , 2011 .",
    "mikls marti and ralph mckenzie .",
    "existence theorems for weakly symmetric operations . , 59(3 ) , pages 463 - 489 , 2008 .",
    "ralph n.  mckenzie , george  mcnulty , and walter  taylor . .",
    "wadsworth  brooks / cole , monterey , california , 1987 .    ian payne . a csp algorithm for some subvarieties of maltsev products . oral communication , 2016 .",
    "thomas j.  schaefer .",
    "the complexity of satisfiability problems . in _ stoc _ , pages 216226 , 1978 .",
    "dmitriy zhuk . on key relations preserved by a weak near - unanimity function . in _",
    "ismvl _ , pages 6166 , 2014 .",
    "dmitriy zhuk .",
    "on csp dichotomy conjecture . in _",
    "arbeitstagung allgemeine algebra aaa92 _ , page  32 , 2016 .",
    "dmitriy zhuk .",
    "the proof of csp dichotomy conjecture for 5-element domain . in _",
    "arbeitstagung allgemeine algebra aaa91 _ , 2016 .",
    "@xmath86 $ ] , + @xmath3056 , + @xmath3057 , + @xmath3058 , + @xmath3059 , + @xmath11 , + @xmath66 , @xmath67 , + @xmath363 , + @xmath365 , + @xmath178 , + @xmath2076 , + @xmath2118 , + @xmath2404 , + @xmath92 $ ] , + @xmath339 , + @xmath344 , + @xmath542 , + @xmath543 , + @xmath273 , + @xmath3060 , + @xmath3061 , + @xmath570 , + @xmath571 , + @xmath572 , + @xmath441 , + @xmath503 , + @xmath678 , + @xmath646 , + @xmath472 , + @xmath255 , + @xmath1933 , + @xmath17 , + @xmath19 , + @xmath100 , + @xmath2358 , + @xmath390 , + @xmath395 , + @xmath231 , + @xmath1985 , + @xmath3062 , + @xmath355 , @xmath356 , + @xmath497 , + @xmath2837 , + @xmath776 , + @xmath115 , + @xmath129 , + @xmath667 , \\rel^{-1}[c']$ ] , + @xmath19 , + @xmath106 , + @xmath349 , + @xmath3063 , + @xmath2361 , + @xmath254 , + @xmath498 , + @xmath673 , + @xmath2972 , + @xmath548 , + @xmath239 , + @xmath246 , + @xmath251 , + @xmath3064 ,"
  ],
  "abstract_text": [
    "<S> in this paper we prove the dichotomy conjecture on the complexity of nonuniform constraint satisfaction problems posed by feder and vardi is expanded for improved readability . </S>",
    "<S> also a gap in this proof is patched . </S>",
    "<S> +  section `` auxiliary lemmas '' is split into two sections , sections  [ sec : congruence ] and  [ sec : chaining ] , and moved forward . </S>",
    "<S> +  the proof of theorem  [ the : non - central ] is reorganized and expanded for improved readability . ]    </S>",
    "<S> [ theorem]corollary [ theorem]proposition [ theorem]problem [ theorem]lemma [ theorem]remark [ theorem]observation    h  s # 1#1_fin p # 1var(#1 ) # 1sg(#1 ) # 1#2sg_#1(#2 ) # 1cg(#1 ) # 1rbcomp(#1 )    = = = = = = =    # 1(_#1,_#1 )    = = = = = =    p *o *    # 1(#1 ) # 1(#1 ) # 1(#1 ) # 1(#1 ) =    = # 1#1 # 1#1 # 1 # 1#2#1 _ 1#1 _ # 2 = \\ # 1height7pt depth3pt width.4pt # 1/ # 1 # 1#2    (    c # 1 + # 2    )    # 1#2#3    (    c # 1 + # 2 + # 3    )    # 1#2#3#4    (    c # 1 + # 2 + # 3 + # 4    )    </S>",
    "<S> # 1#2#3#4#5#6    (    c # 1 + # 2 + # 3 + # 4 + # 5 + # 6    )    = # 1 - 1.7mm^#1 # 1 - 0.2mm^#1 # 1#2#3    (    ccc 1&2&3 + # 1&#2&#3    )    = =    = = = = = = = = = = = = =    = eufm10 scaled 1200 = eufm6 12= 12=12= = msbm10 = msbm8 11=11= 11==msbm10 scaled 1200 13=13= 13==``0b4e = ' ' 0d3f </S>"
  ]
}