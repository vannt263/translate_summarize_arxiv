{
  "article_text": [
    "mars ( _ magic analysis and reconstruction software _ ) is a collection of root - based @xcite programs written in c++ for the analysis of data from gamma - ray cherenkov telescopes .",
    "mars has been developed during the last decade within the magic collaboration , and is currently the official analysis package of magic , an imaging atmospheric cherenkov telescope ( iact ) located on the island of la palma ( spain ) .",
    "a second magic telescope , which is presently in its commissioning phase , will soon allow to carry out observations in stereoscopic mode , thus enhancing significantly the performance of the instrument @xcite .",
    "mars is also being used in the analysis of monte carlo - simulated data of large arrays of iacts , aimed at the study of the possible configurations of the next - generation ground - based gamma - ray observatory dubbed cta ( cherenkov telescope array @xcite ) .",
    "the data analysis chain implemented in mars is divided into several steps , each of which is performed by an independent program which takes as input the output of one or more of the previous stages .",
    "the initial input to mars are the raw data recorded by the telescopes , consisting of binary files containing the full information available per pixel ( digitized signal amplitude vs. time ) for every triggered event , plus ascii files containing regular reports from the different telescope subsystems ( like the telescope drive , the trigger system or the weather station ) . throughout the analysis chain ,",
    "the data are organized in root trees containing a set of `` parameter containers '' for every entry .",
    "typically , the core of a mars program @xcite is an event loop which executes an ordered list of tasks ( the `` task list '' ) for every event in the input file . besides the task list , every loop is associated to a `` parameter list '' .",
    "it contains pointers to all the parameter containers holding the input data needed by the tasks , and to the containers where the tasks store the results of their calculations .",
    "the first program in the analysis chain is called _ callisto _ , and its main purpose is to calibrate the raw data . after subtraction of the pedestal offsets , several algorithms are available in mars for extracting the signal of each pixel . since the upgrade of the data acquisition to 2",
    "gsample / s in early 2007 , the standard method has become the integration around the peak of a cubic spline built from the raw digitized pulse . besides the integrated signal , the arrival time of the pulse is computed , as the position of the rising edge of the spline at 50@xmath0 of the peak value .",
    "_ callisto _ then equalizes the response of the different camera pixels to account for differences in gain ( flatfielding ) , and introduces relative offsets to correct for deviations in signal arrival times . for these purposes ,",
    "_ callisto _ makes use of dedicated pedestal and calibration runs , and also of pedestal and calibration events interleaved with the ordinary data , which help to track possible drifts in the pedestal baseline and in the gains .",
    "an absolute calibration procedure , based on the f - factor method @xcite , is also applied to convert the reconstructed signal amplitudes into physically meaningful units ( photoelectrons ) .",
    "after calibration , the next step in the analysis chain is the parametrization of each shower image by a small set of parameters which describe in a compressed way its orientation , shape and timing properties . among these quantities",
    "are the hillas parameters , which are basically the moments up to second order of the light distribution on the camera . obviously , before calculating the moments of the light distribution , a `` cleaning '' has to be performed in order to remove pixels which most likely do not contain light from the shower , and whose `` signals '' are just the result of the fluctuations of the light of the night sky .",
    "these tasks are performed in mars by the program called _",
    "star_.    in _ star _ , the arrival time of the light at each pixel is used along with the signal amplitude both in the cleaning procedure and in the calculation of some of the image parameters @xcite .",
    "the decision to accept a certain pixel as part of the image relies on the strength of the signal and on its contemporaneity with those in neighboring pixels . as for time - related image parameters",
    ", it has been shown recently @xcite that the evolution of the arrival time of the light along the major axis of the shower image can be used to improve the performance of magic - i operated as a standalone cherenkov telescope , allowing to halve the rate of residual background events .    during this stage of analysis ,",
    "the ring - shaped images from isolated muons are identified , and their brightness and broadness are analyzed in order to provide information on the overall light collection efficiency of the telescope and on the optical point spread function of the mirror dish .",
    "this information is needed to tune the monte carlo simulation used for later analysis .",
    "up to the image parametrization ( _ callisto _ and _ star _ ) , the mars analysis chain runs over the data of each telescope separately . at this point",
    ", we have two sets of _ star _ files , one per telescope , which contain two different views of the same showers .",
    "a program called _ superstar _ reads in the two streams of files and identifies the matching pairs of events .",
    "it then calculates the parameters which define the shower axis ( direction and impact point ) from the simple intersection of two planes , each of them defined by one of the recorded images ( plus the position and orientation of the corresponding telescope ) . in the case of a 2-telescope system like magic , there is only one solution for the geometry of the shower axis , and its accuracy depends on the relative positions of the telescopes and the shower : the more parallel the two images on the camera planes are , the larger the uncertainties in the reconstructed parameters . as of now , only images with a relative angle of at least @xmath1 are used in the stereo analysis , but work is going on to improve the reconstruction of the rest of events through the analysis of image shapes ( along the lines of the _ disp _ method @xcite ) , which constrain the distance between the image center of gravity and the point on the camera which corresponds to the shower direction .",
    "once the shower axis is determined , an estimate of the height of the shower maximum is made from the angle at which the image center of gravity is viewed from each telescope .",
    "_ superstar _ also calculates the impact parameter of the shower with respect to each telescope , and obtains an estimate of the energy of the primary ( assuming it is a gamma - ray ) by using simple monte carlo - generated lookup tables of the energy versus image size , impact parameter , atmospheric depth of the shower maximum and zenith angle .",
    "the standard procedure in mars to suppress the unwanted background showers produced by charged cosmic rays makes use of a multivariate classification method known as random forest ( rf ) @xcite . for every event ,",
    "the algorithm takes as input a set of image parameters , and produces one single parameter as output , called _ hadronness _ , which is in the range from 0 to 1 .",
    "a low value of _ hadronness _ indicates the event is a good gamma candidate .",
    "only events with _ hadronness _ below a certain cut value will be used for the subsequent steps of the analysis . the mars program in charge of the learning phase of the rf",
    "is called _ osteria _ , which takes as input a set of _ star _",
    "files from monte carlo gamma rays and another one of real magic data from observations of a sky region devoid of any gamma - ray source ( hence containing almost exclusively background events ) .",
    "the rf can take as input parameters both global shower parameters from the stereo reconstruction ( like the height of the shower maximum or the estimated energy ) and image parameters of each one of the telescopes ( e. g. the hillas parameters ) .",
    "it must be noted that the rf method can be used not only to classify events into different populations , but also to estimate the value of an unkown continuous quantity , like the energy of the primary gamma - ray , which is correlated with the rf input parameters .",
    "this is in fact the default method for energy estimation that we have been using in the mars analysis of single - telescope ( magic - i ) observations .",
    "the differential energy spectrum of the observed gamma - rays is estimated by the _ fluxlc _",
    "program of the mars package . after a cut in _ hadronness _ ( @xmath2 ) , the gamma - ray excess is determined by counting all events within an angular distance @xmath3 of the source direction ] , and subtracting from it an estimate of the number of background events . for the case of _ wobble _ observations ( in which the telescope is pointed @xmath4 away from the source ) ,",
    "the so - called false - source method @xcite , can be used for background estimation . for on - source observations ( for which the candidate source is located in the center of the camera ) , an additional sample of off data ( with no gamma - ray source on the field of view ) is needed for this purpose .    the excess of events is obtained in bins of estimated energy and divided by the total effective observation time @xmath5 and by the gamma - ray effective area for each energy bin @xmath6 .",
    "the effective area after all cuts is calculated using a test sample of monte carlo gamma - rays ( which must be statistically independent of the monte carlo sample used by _",
    "osteria _ for training the background suppression ) .",
    "the effective area depends on the direction in local coordinates of the observed gamma - rays , mainly due to the variation with the zenith distance ( _ zd _ ) of the air mass along the pointing direction , but also due to magnetic field effects and to the relative orientation of the shower and the system of two telescopes , which introduce a dependence on the azimuth ( _ az _ ) as well . the effective area in an energy bin is therefore obtained as a weighted average @xmath7 , where the weights @xmath8 are proportional to the observation times spent in each bin of azimuth and zenith traversed by the source .",
    "different cuts @xmath9 and @xmath3 are tried in the standard analysis to test the stability of the derived spectrum : a significant variation of the result would indicate that the cut efficiencies ( and hence the effective areas ) are not well reproduced by the monte carlo simulation , therefore casting doubts on the reliability of the measurement .",
    "the errors on the spectral points include statistical errors on the number of excess events and the uncertainty of the effective area . the spectrum at this point is calculated in bins of estimated energy and might , therefore , differ from the true gamma - ray energy spectrum especially around the energy threshold .",
    "the calculation of the energy spectrum in bins of true energy , a procedure which is called unfolding , is presented in the following .",
    "measurements of the gamma - ray energy are systematically distorted due to the fact that the detectors are not ideal ( e.g.  have finite resolution ) and the true energy is not directly measured .",
    "the distortions due to biases and finite resolution can be written in the form : @xmath10 where @xmath11 is the estimated energy , @xmath12 is the true energy , @xmath13 describes the detector response ( the migration matrix ) , @xmath14 is the measured distribution and @xmath15 is the true undistorted distribution .",
    "the aim is to determine @xmath15 , given @xmath14 and @xmath13 .",
    "there are various approaches to solve this problem .",
    "one of the solutions ( called deconvolution ) is to invert the matrix @xmath13 .",
    "although technically correct , this is often useless due to large correlations between adjacent bins , which imply large fluctuations of their contents .",
    "this fact is the basis of the unfolding methods with regularization @xcite . in these methods",
    "one considers two terms : one term , @xmath16 , expressing the degree of agreement between the prediction @xmath17 and the measurement @xmath14 , and another term , @xmath18 , which is a measure of the smoothness of @xmath15 .",
    "a solution for @xmath15 is obtained by minimizing the expression @xmath19 for a fixed regularization parameter @xmath8 .",
    "large values of @xmath8 , corresponding to no regularization , often produce noisy unfolded distributions that perfectly fit the data .",
    "very small values of @xmath8 will , on the other hand , overemphasize the regularization , leading to larger deviation from the measurement but a very smooth unfolded distribution .",
    "so , the proper choice of @xmath8 is very important . in the magic software ,",
    "a variety of methods is available which differ in the way regularization is implemented ( see for instance @xcite ) .",
    "another approach consists in assuming a parametrization of the true distribution @xmath15 and then comparing @xmath17 with the measured distribution @xmath14 .",
    "this is called _",
    "forward unfolding_. the main difference to the previous methods is that an assumption about the true distribution has to be made .",
    "moreover , no explicit regularization is done in the _",
    "forward unfolding_. on the other hand , the result of the _ forward unfolding _ is just the best fit with corresponding errors using the _ a priori _ assumed parametrization , but no spectral points scattered around the unknown real distribution can be provided . in the mars analysis ,",
    "the various unfolding methods are used for each observation , and the consistency of the results is checked . only when results of different unfolding methods agree , the result of the unfolding is considered trustworthy .    for the estimation of light curves ( gamma - ray flux - in a given energy range - versus time ) ,",
    "no unfolding of the type just described is used .",
    "a simple correction factor is applied to the effective area in the selected energy range , to account for the spillover of events with true energies outside it , under the assumption of a given spectral shape ( usually of power - law type ) for the energy spectrum .",
    "in cases in which the exact location of a gamma - ray source is not known in advance , a blind search in the whole field of view of the telescope(s ) can be performed within mars using the program _",
    "celestina_.    the reconstructed directions of all events ( in camera coordinates ) surviving the _ hadronness _ cut are converted into celestial coordinates ( right ascension , declination ) according to the pointing position of the telescope and the time stamp of each event .",
    "a sky map of reconstructed gamma - ray incidence directions is thus obtained , which contains also the residual background of cosmic ray events . in order to subtract it",
    ", we need to know the camera acceptance for the background events , and project it on the sky in exactly the same way , i.e. using the same projection functions , and with the same telescope orientations and time stamps used for the observation being analyzed .    the most general way to obtain the acceptance for the background is to use an off observation ( no source in the field of view ) . alternatively , for the search for point - like sources of unknown ( or uncertain ) location within the telescope field of view , one can use the same data runs containing the signal to estimate the background acceptance with one of the following methods :    \\1 ) if the data are taken in wobble - mode , the camera is divided into two halves , out of which one half always contains the candidate source and the second half the false - source ( i.e. , the position on the camera opposite to the source with respect to the camera center ) , whenever the telescope is pointing at the wobble direction `` w1 '' . in the case of the wobble pointing `` w2 '' ( which is defined such that , on the sky , the assumed source location is the middle point between w1 and w2 ) , the opposite assignment is used . in this way two signal and two background halves are obtained which are normalized to each other using the relative observation time .",
    "obviously for this method we need to know the _",
    "approximate _ location of the gamma - ray source ( within 0.1@xmath20 or so ) , since we need to know which camera half contains only background at any time .",
    "\\2 ) a different method starts by filling a 2-d histogram of the reconstructed arrival directions in camera coordinates .",
    "subsequently , two new histograms , @xmath21 and @xmath22 , are obtained by folding it with a gaussian distribution of width @xmath23 ( being @xmath24 the width of the gamma - ray point - spread function of the telescope ) , and @xmath25 respectively .",
    "a first estimate of the acceptance for the background is obtained as  @xcite @xmath26 assuming a point like gamma - ray source at an unkown instantaneous position in the camera , its effect can be approximated by a gaussian distribution with a width @xmath24 .",
    "thus the instantaneous arrival directions at camera position @xmath27 are given by @xmath28 where @xmath15 is the instantaneous rate of gamma - rays from the source , @xmath29 is the instantaneous background rate at camera position @xmath30 and @xmath31 is the gamma - ray source position . additionally the function @xmath32 is a bi - dimensional gaussian distribution centered at @xmath33 with correlation matrix @xmath34 , being @xmath35 the 2x2 identity matrix . in addition",
    "we assume that @xmath29 can be described as the sum of a set of bi - dimensional gaussians , all with a correlation distance larger than a given @xmath36 fulfilling @xmath37 . under those conditions and",
    "taking @xmath38 , eq .",
    "[ eq : conv ] is approximated by @xmath39 where the approximation error is of order @xmath40 , which we experimentally found to be @xmath41 .",
    "the subtraction of gaussian functions in eq .",
    "[ eq : conv 3 ] is bounded from above by @xmath42 close to the instantaneous gamma - ray position and goes to zero exponentially as @xmath43 far from the source position . taking this into account and comparing equation [ eq : conv 1 ] and [ eq : conv 3 ]",
    "we conclude that the latter is a good approximation for the background for skymap estimates because of the signal suppression due to the subtraction term in eq .",
    "[ eq : conv 3 ] .",
    "finally , to correct the residuals distortions of the background due to the folding procedure , a factor depending on the distance to the camera center is applied which guarantees that locally the normalization is the correct one .",
    "additionally , this correction introduces a further suppression factor at the source position .    for a strong source , this method of estimating the background acceptance overestimates the background rate ( and hence underestimates the signal rate ) at the source position , but is anyway sufficient for the purpose of estimating the location of the gamma - ray emission and for blind searches of point - like sources in the fov .",
    "an overview of the methods implemented in the mars package for the analysis of data from the magic cherenkov telescopes has been presented .",
    "the analysis chain is ready to process the stereoscopic data which will become available once the second magic telescope becomes fully operational .",
    "results on the expected performance based on monte carlo simulations are presented in a separate contribution @xcite .",
    "r.  brun , f.  rademakers , _ root - an object oriented data analysis framework _ , proceedings aihenp96 workshop , lausanne , sep .",
    "1996 , nucl .",
    "inst . & meth .",
    "res . a 389 ( 1997 ) 81 - 86 .",
    "see also http://root.cern.ch/."
  ],
  "abstract_text": [
    "<S> with the commissioning of the second magic gamma - ray cherenkov telescope situated close to magic - i , the standard analysis package of the magic collaboration , mars , has been upgraded in order to perform the stereoscopic reconstruction of the detected atmospheric showers . </S>",
    "<S> mars is a root - based code written in c++ , which includes all the necessary algorithms to transform the raw data recorded by the telescopes into information about the physics parameters of the observed targets . </S>",
    "<S> an overview of the methods for extracting the basic shower parameters is presented , together with a description of the tools used in the background discrimination and in the estimation of the gamma - ray source spectra .    </S>",
    "<S> gamma - ray astronomy , cherenkov detectors , data processing </S>"
  ]
}