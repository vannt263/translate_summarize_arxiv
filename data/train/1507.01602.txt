{
  "article_text": [
    "recent supernova ( sn ) cosmological measurements have greatly reduced both the statistical and systematic uncertainty in our knowledge of the accelerated expansion of the universe ( the latest such efforts are presented in * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "despite these improvements , the frameworks currently in use are not statistically optimal .",
    "as we build larger supernova samples , these frameworks will become increasingly inadequate .",
    "this paper offers an improved technique for deriving constraints on cosmological parameters from sn measurements ( peak magnitude , light - curve shape and color , host - galaxy mass ) .",
    "although this paper uses sn cosmology as an example , researchers from other fields may find this type of framework useful .",
    "our work is particularly relevant for researchers confronting partially known uncertainties , selection effects , correlated measurements , and outliers .",
    "the rest of this introduction summarizes the problems with existing methods and describes in general terms the basic requirements for greater accuracy .",
    "section  [ sec : proposedframework ] describes the framework in detail , and section  [ sec : simulateddata ] quantitatively examines the performance of the method on simulated data . in section  [ sec : realdata ] , we demonstrate the performance on real sn observations , then conclude in section  [ sec : conclusions ] with future directions .",
    "current cosmological constraints are derived from time series of photometric measurements in multiple bands ( light curves ) and spectroscopy . before obtaining sn distances , the light curves must be fit with a model such as salt2 @xcite .",
    "salt2 models each photometric observation in the observer frame with a combination of a mean sn spectral energy distribution ( sed ) ( scaled by a normalization parameter ) , the first component of the sed variation ( scaled by a shape parameter @xmath0 ) , and the mean color variation in magnitudes ( which is scaled by a color parameter @xmath1 ) .",
    "the template is also shifted in time to match the observations with a date - of - maximum parameter .",
    "( in this work , we restrict our attention to the salt2 empirical model , which is the best validated and most widely used such model . )",
    "@xcite and @xcite trained the salt2 model in an initial ( separate ) step before the light - curve fitting , using a dataset with well - measured spectra and light curves that partially overlaps with the sn data used for cosmological distances .",
    "after measuring a light - curve shape parameter ( @xmath2 ) , a light - curve color parameter ( @xmath3 ) , and a light - curve normalization ( @xmath4 , the rest - frame @xmath5-band flux ) , we construct a distance modulus estimate as    @xmath6    @xmath7 and @xmath8 are the light - curve shape standardizationcoefficient and color standardizationcoefficient , respectively .",
    "they quantify the empirical relations that sne with broader rest - frame optical light curves or bluer rest - frame colors are intrinsically more luminous @xcite .",
    "@xmath9 captures residual luminosity correlations with host - galaxy mass , discussed more in section  [ sec : hostgalaxy ] .",
    "@xmath10 is the absolute magnitude in the rest - frame @xmath5-band ( for a given @xmath11 ) .",
    "all of these coefficients are nuisance parameters for cosmological purposes",
    ".    we can then construct a @xmath12 to use for cosmological fitting ( for illustrative purposes only , we assume here that all of the sn observations are uncorrelated ) :    @xmath13    @xmath14 captures the measurement uncertainties from the light - curve fit .",
    "salt2 handles @xmath15-corrections implicitly , as it is a rest - frame spectral model that fits photometry in the observer frame . limitations of the salt2 model are important to add , such as its inability to simultaneously model intrinsic color variation and extinction with one @xmath1 parameter ( discussed more below ) . while salt2 does include a simple estimate of the dispersion around its model , including this dispersion does not give a @xmath12 per degree of freedom of 1 when performing cosmological fits .",
    "@xmath16 is a term that captures this sample - dependent unexplainedvariance in the sn distribution ( sometimes called `` intrinsic dispersion '' ) .",
    "finally , @xmath17 captures dispersion due to gravitational lensing and incoherent peculiar velocities . in current cosmological analyses ( those since",
    "* ) , an iteration is performed between estimating the standardizationcoefficients , estimating @xmath16 , and rejecting outlying sne . , and we address it now to contrast against the proposed framework for , e.g. , fitting nonlinear @xmath18 standardizations . finding the @xmath7 and @xmath8 values that minimize this @xmath12 is not the same as minimizing the dispersion of the hubble diagram . nor",
    "does it eliminate the correlation between @xmath18 and hubble diagram residuals .",
    "the residuals at the best - fit @xmath7 and @xmath8 are expected to show a correlation with the observed @xmath18 , as uncertainties will preferentially scatter the observed values of @xmath18 away from the distribution means and it is only the values without this scatter that should be uncorrelated with hubble diagram residuals . ]",
    "there are several ways in which sn datasets are imperfect .",
    "outliers , selection effects , nonlinear correlations , partially known uncertainties , and heterogeneity each complicate analyses .",
    "the proposed framework will address each of these complications , but first we discuss the limitations of current work .    obtaining either spectra or very high - quality",
    "light curves are the only ways to ensure a transient source is a sn  ia . even at moderate redshifts ,",
    "both of these techniques are observationally expensive , and non - ia sne will inevitably contaminate the sample .",
    "a similar issue arises if sne are of type ia , but are peculiar , or the redshift is incorrect .",
    "the analysis should thus accommodate some amount of non - ia sne , which have dissimilar colors , decline rates , and absolute magnitudes .",
    "the iterative outlier fit described above converges well for the sorts of contaminating distributions we expect when the samples are relatively pure @xcite .",
    "when the samples are large ( several hundred ) , or impure ( @xmath19)conditions the field is beginning to face  the outliers can dominate the other sources of uncertainty in the fit .",
    "@xcite presented a powerful bayesian technique for simultaneously modeling the distributions of normal sne and outliers , but does not confront many complexities of the data , including the luminosity standardizationsand selection effects .",
    "selection effects , the tendency for surveys to select against the faintest sne , sculpt the observed distribution of sne ( this is frequently referred to as malmquist bias , * ? ? ?",
    "if not taken into account , this selection will bias both the cosmological parameter estimation and the standardizationcoefficients .",
    "there are sn - to - sn variations in the selection efficiency , even within the same survey and for the same redshift ( e.g. , due to seeing , host - galaxy contamination , or moonlight ) .",
    "these are deterministic but difficult - to - model sources of variation .",
    "noise also plays a role , as a sn right at the detection threshold may stochastically scatter above or below it .",
    "thus , the detection efficiency transitions to zero smoothly as a function of apparent brightness . in most sn cosmological analyses ( based on equation  [ eq : chi2fit ] ) ,",
    "the treatment of selection effects is performed outside the statistical framework , in the form of survey simulations followed by an ad - hoc redshift - dependent adjustment of the @xmath4 to approximately cancel the estimated bias @xcite .",
    "bayesian analyses face a related challenge : selection effects also influence the distribution of light - curve width and color with redshift , which can amplify selection effects if not modeled @xcite . however , these frequentist and bayesian analyses both require knowledge of the true population distribution ( as a function of redshift ) to get accurate results .",
    "the @xmath0 and @xmath1 standardizationsin equation  [ eq : mbcorr ] are linear .",
    "however , nonlinear decline - rate and color standardizationsare statistically justified @xcite .",
    "@xcite , but virtually all the sne used for cosmology are bluer than this . ]",
    "our union2 result @xcite was derived from subdividing the sample by the best - fit latent variables ( see section  [ sec : latentvariables ] ) .",
    "the subdivisions showed very similar cosmological results , but subdivision tests are statistically weak ( statistical uncertainties on the difference are @xmath20 times larger than the uncertainty on the whole sample ) . including these nonlinear standardizationsin the fit would be preferable for evaluating their impact and",
    "would remove any bias created by the assumption of linearity .",
    "unfortunately , neither the @xcite , nor the @xcite frameworks were able to incorporate these nonlinear standardizationsin a fully self - consistent way .",
    "type ia hubble diagrams show more dispersion in distance than can be explained with measurement uncertainty alone .",
    "as noted above , the framework must include a model of the unexplaineddispersion , and should not assume that all of this dispersion is in the independent variable ( magnitude ) .",
    "in other words , @xmath21 is really @xmath16 .",
    "sn variation ( beyond light - curve width and color ) , is presently only crudely modeled by current light - curve fitters and especially affects the measured color @xcite , resulting in color measurements that mix extinction and sn differences in only partially understood ways .",
    "when using equation  [ eq : chi2fit ] , there is no way to fit for the unexplaineddispersion simultaneously with the other parameters .",
    "improvement is needed here , as the unexplaineddispersion interacts with the modeling of selection effects , the outlier rejection , and fitting @xmath7 and @xmath8 .",
    "currently , we are constrained to use ad - hoc methods , such as performing many fits with a randomized unexplained - dispersion matrix , and computing the distributions of cosmological parameters fit to fit @xcite .",
    "the impact of these variations is currently subdominant to the total uncertainty @xcite , but this may not be true in future samples and a precise way to evaluate the cosmological impact is desirable .",
    "@xcite took a step in the right direction by using a bayesian hierarchical model to simultaneously fit for cosmological parameters and unexplaineddispersion , but their model can not accommodate calibration uncertainties , outliers , nonlinear standardizations , or selection effects .",
    "future sn cosmology analyses will confront additional difficulties , such as heterogeneity .",
    "even very homogeneous sn imaging surveys ( such as the dark energy survey , * ? ? ?",
    "* ; * ? ? ?",
    "* ) will gain heterogeneity as expensive observational resources , such as near - ir measurements or high - quality spectroscopy , will only be available for a subset of objects .",
    "a frequentist , `` object - by - object '' uncertainty analysis such as equation  [ eq : chi2fit ] can not make efficient use of this information .      in light of these problems",
    ", this paper offers an improved technique incorporating a more sophisticated , bayesian model of the data . properly making use of heterogeneous information ( like measurements that are only available for a subset of objects ) requires a model of the sn population in which the parameters of the distribution are treated as unknowns .",
    "in addition , the model of the unexplaineddispersion should allow for uncertainty in both size and functional form .",
    "we discuss the details of our procedure for parameterizing these possibilities in section  [ sec : intdisp ] .",
    "only a bayesian framework can accommodate more exotic possibilities , such as very large numbers of nuisance parameters ( each possibly non - zero and having initially unknown size ) , as it can make use of a hierarchical prior around zero .",
    "one could imagine many possibilities for these parameters ( e.g. , color - standardizationcoefficient , @xmath8 , as a function of host - galaxy - inclination angle ) ; we do not pursue these in this work , but we do note that they could be built into the general framework",
    ".    however , not all of the improvements we propose require bayesian statistics ; some are due to the improvements to the data likelihood ( and could thus fit into a frequentist framework ) .",
    "first , we introduce a modified approach to fitting for residual correlations with host - galaxy mass , described in section  [ sec : hostgalaxy ] .",
    "second , like @xcite , we handle outliers with a mixture model , described in section  [ sec : nonia ] , which offers improved robustness .",
    "third , to account for selection effects , our proposed framework uses a probabilistic model of selection as described in section  [ sec : selection ] , modifying the classical likelihood to include selection directly .",
    "this cleanly estimates and marginalizes the hyperparameters of the true population distributions simultaneously with other parameters , propagating all uncertainties .",
    "fourth , in section  [ sec : indpriors ] , we discuss our approach to fitting for the changing sn independent variable distribution with redshift ( population drift ) simultaneously with other parameters . finally , our new framework can accommodate nonlinear standardizations(section  [ sec : brokenlinear ] ) .",
    "a frequentist framework can , in principle , include nonlinear standardizations , but it is computationally challenging .",
    "minimum for each latent variable and recording the best one . ]    both the old and new techniques can handle correlations due to systematic uncertainties ( such as correlated peculiar velocities and photometric calibration uncertainties ) , assuming the sizes of these uncertainties are known .",
    "the modifications to the old framework to include correlations are detailed in @xcite .",
    "we implement these correlations with nuisance parameters , as discussed in section  [ sec : systerrs ] .",
    "the model must also allow for population drift ( whether due to selection effects , or changes in the sn population with redshift ) , or risk a significant bias on cosmological parameters .",
    "population drift can also be handled well with either framework , as equation  [ eq : chi2fit ] handles each object independently ( if the measurements are uncorrelated object to object ) and our new framework solves for population drift simultaneously with other parameters ( section  [ sec : indpriors ] ) .",
    "there are two disadvantages to our approach .",
    "first , the more sophisticated model requires more cpu time ( now measured in many hours , rather than minutes ) .",
    "second , it is not necessarily possible to generate a unique distance modulus for each sn as in equation  [ eq : mbcorr ] .",
    "the true - independent - variable priors ( section  [ sec : indpriors ] ) must be treated in bins smaller than the other parameters of interest ( e.g. , bins of @xmath22 in redshift for cosmological parameters ) .",
    "however , no one set of assumptions will exactly cover all use cases ( e.g. , tests for isotropy ) .",
    "approximate sets of sn distances are possible , but we leave this for future work .",
    "our proposed framework surpasses previous analysis efforts by bringing together components that simultaneously address each of the limitations discussed above .",
    "we call our framework unity ( unified nonlinear inference for type - ia cosmology ) .",
    "the required model needs to contain thousands of nonlinear fit parameters ( as motivated in the following sections ) , which poses a problem for many statistical techniques . for example",
    ", there is no practical way to analytically marginalize over every parameter except the parameter(s ) of interest .",
    "we thus must draw random samples from the posterior distribution ( monte carlo sampling ) , and use those samples to estimate the posteriors .",
    "a natural tool for this sampling is hamiltonian monte carlo ( hmc ) .",
    "hmc samples efficiently , with short correlation lengths sample to sample , even for large numbers of fit parameters . to this end , we use stan @xcite through the pystan interface @xcite .",
    "stan automatically chooses a mass matrix , and speeds up sampling efficiency even further by using a variant of hmc sampling called the `` no - u - turn '' sampler .",
    "stan also incorporates automatic , analytic differentiation for computing the gradient of the log - likelihood , making the implementation of the model simple and readable .",
    "we show a probabilistic graphical model of our framework in figure  [ fig : dag ] , and show a table of parameters in table  [ tab : paramlist ] .",
    "llr[h ] absolute magnitude for @xmath23 & @xmath10 & [ sec : currentapproach ] + cosmological model ( flat @xmath24cdm ) & @xmath25 & [ sec : currentapproach ] + latent variables & @xmath26 , @xmath27 & [ sec : latentvariables ] + host - mass standardizationcoefficients & @xmath28 , @xmath29 & [ sec : hostgalaxy ] + outlier distribution & @xmath30 , @xmath31 & [ sec : nonia ] + sample limiting magnitudes ( fixed ) & @xmath32 , @xmath33 , @xmath34 , @xmath35 & [ sec : selection ] + latent - variable hyperparameters & @xmath36 , @xmath37 , @xmath38 , @xmath39 , @xmath40 & [ sec : indpriors ] + light - curve color and shape standardizationcoefficients & @xmath41 , @xmath42 , @xmath43 , @xmath44 & [ sec : brokenlinear ] + ` sample' ( unexplained ) dispersion & @xmath45 , @xmath46 , @xmath47 , @xmath48 , @xmath49 & [ sec : intdisp ] + systematic uncertainties & @xmath50 & [ sec : systerrs ] [ tab : paramlist ]      @xcite offers an excellent discussion of linear regression with error bars in both dependent and independent variables .",
    "we briefly summarize here . consider the case of fitting a straight line ( slope @xmath51 , intercept @xmath5 ) in two dimensions ( @xmath52 , the dependent variable vs @xmath53 , the independent variable ) with uncertainties in both @xmath53 and @xmath52 ( @xmath54 and @xmath55 , assumed uncorrelated and gaussian for simplicity ) .",
    "the generative model for an observed @xmath52 ( `` @xmath56 '' ) is @xmath57 and similarly for @xmath58 @xmath59 where @xmath60and @xmath61are the value for the measurement if no uncertainty is present , and @xmath62 . when there is no significant uncertainty in @xmath53 , equation  [ eq : xtrueexample ] is unnecessary , and we have a simple least - squares regression .",
    "when uncertainty is present in both variables , we can substitute for @xmath61 , but @xmath60remains . for a fit with two independent variables ,",
    "there are two latent variables representing the true position on the line ( now a plane ) .",
    "the same logic holds for more than one observation , in which case there are ( number  of  observations)@xmath63(number  of  independent  variables ) latent variables . for the standard @xmath0 and @xmath1 standardizations , this results in @xmath64 additional parameters",
    ". parameters .",
    "because of the potential of misassociation , this situation might be faced by surveys measuring many host - galaxy redshifts after the sne have faded , such as the dark energy survey . ]    in a frequentist analysis , if measurement uncertainties are believed to be gaussian and the @xmath0 and @xmath1 standardizationsare linear , the likelihood can be analytically maximized for each of these parameters @xcite .",
    "this technique enables the proper handling of these nuisance parameters without explicitly including them in the fit .",
    "similarly , in a bayesian analysis , if the measurement uncertainties are gaussian ( or a gaussian mixture ) , the standardizationsare linear , and the priors on these parameters are flat or gaussian ( or a gaussian mixture ) , these nuisance parameters can be analytically marginalized @xcite , providing a similar computational efficiency boost ( as was done in * ? ? ?",
    "in this work , we violate these assumptions ; therefore , we must keep these @xmath64 nuisance parameters in the fit ( @xmath26 and @xmath27 ) .",
    "@xcite first found evidence that hubble residuals in current light - curve fitters are correlated with host - galaxy environment .",
    "this finding later reached high statistical significance in larger samples @xcite .",
    "the current method for including this effect in cosmological analyses fits two separate absolute magnitudes for low - mass - hosted ( @xmath65 ) and high - mass - hosted galaxies @xcite .",
    "@xcite found evidence that most of this effect is due to the age of the progenitor system ( see also indirect evidence in * ? ? ? * ) .",
    "this effect , confirmed independently by @xcite , implies that sne hosted by high - stellar - mass galaxies may become more like low - stellar - mass - hosted sne at higher redshift ( when progenitors were young in all galaxies ) .",
    "however , newer versions of salt2 combined with different sample selections may not show as strong an age effect @xcite .",
    "we therefore do not assume a constant mass - standardization(@xmath9 ) ; instead we use a modified version of the model in @xcite ( similar to the model of * ? ? ?",
    "* )    @xmath66 \\;. \\label{eq : deltaofz}\\end{aligned}\\ ] ]    those authors proposed host - mass - standardizationevolution predicts the mass - standardizationcoefficient will approach zero at high - redshift ; we instead assume it smoothly approaches a possibly non - zero quantity , @xmath29 .",
    "we take a flat prior on @xmath67 from 0 to 1 , allowing the mass standardizationto be constant or declining with redshift , and spanning all of the claims in the literature .      for non - ia contamination",
    ", we use the mixture - model framework of @xcite .",
    "this framework models the observed distribution around the modeled mean as a sum of gaussians , where at least one gaussian ( the normal ia distribution ) is tightly clustered , and an outlying distribution is comparatively dispersed . although the assumption of a gaussian contaminating distribution is a strong one , it makes little difference in practice .",
    "as the outlying distribution is broader than the inlying distribution , any outlying point will be treated as an outlier . for the relatively pure spectroscopically",
    "confirmed sn datasets in use today , modeling the outlying distribution accurately has little impact on the rest of the parameters in the model .",
    "because of this , and as a test of the framework , we perform our fits assuming an outlier distribution that is a unit multinormal ( @xmath68 ) in @xmath69 ( centered on the ia distribution for that redshift ) , which is different from the simulated data we generate to test the framework ( section  [ sec : simulateddata ] ) .",
    "the relative normalizations of the core and outlying distributions can be chosen object by object ( from spectroscopic or other classification evidence ) , or set to be the same for every object .",
    "we fit for the fraction of outliers assuming it is the same for all objects ( @xmath30 ) , and place a broad log - normal prior on this quantity of @xmath70 ( an outlier fraction of @xmath71 plus or minus 50% ) .",
    "these assumptions work well with union2.1 , as discussed in section  [ sec : modelwithoutl ] , but of course they can be adjusted for other datasets .",
    "if the luminosity distribution of sne ia turns out to be significantly non - gaussian ( for example , the bimodal model of * ? ? ?",
    "* ) , additional gaussian components can be added ( with redshift - dependent normalizations ) to give smaller uncertainties and capture possible population drift .",
    "we leave this and more complex models of the non - ia distribution for future work , but these extensions fit easily into this framework .",
    "we present the details of our selection model in appendix  [ sec : detailsselectioneffects ] , but outline the important points here .",
    "the standard method for incorporating a selection cut is to truncate the data likelihood at the cut and divide by the selection efficiency ( e.g. , @xcite , see also @xcite for a discussion of selection effects and non - detections in the context of linear regression ) . in sn cosmology ,",
    "the truncation is not sharp , but is instead probabilistic , as discussed in section  [ sec : currentlimits ] .",
    "we assume that the observation likelihood is truncated by an error function .",
    "far from the selection limit , a sn is found or missed with probability one or zero ; for sne near the selection limit , the probability transitions smoothly .",
    "an error function reasonably matches the efficiency curves of e.g. , @xcite .",
    "surveys also do not select only on one measured variable .",
    "we assume our cut is a plane in three - dimensional space , spanning the dependent variable and both independent variables . in our example",
    ", this is magnitude ( salt2 @xmath72 ) , shape ( salt2 @xmath0 ) , and color ( salt2 @xmath1 ) ; sne with @xmath73 are less than 50% likely to be found ( and more than 50% likely to be found if @xmath74 ) .",
    "the width of the cut is @xmath75 ; sne observed at @xmath76 are considered 16%(+ ) or 84%(@xmath77 ) likely to be found .",
    "@xmath72 and @xmath1 are the primary variables responsible for selection effects in sn searches .",
    "for example , sne found in the rest - frame @xmath5-band have a limit in @xmath72 ( @xmath78 ) , while sne selected in the rest - frame @xmath79-band have a limit in @xmath80 or @xmath81 .",
    "we note that for selection in just @xmath72 , bluer ( more - negative @xmath1 ) and slower - declining sne ( larger @xmath0 ) will be selected , as these correlate with brighter @xmath72 .",
    "that is , the only effect that a magnitude - based @xmath82 selection ignores is that slower - declining sne are more likely to be found , irrespective of the maximum brightness , as they stay above the detection threshold longer .",
    "a simple simulation shows that this effect is very small compared to selection on @xmath82 , even for cadences as large as ten rest - frame days .",
    "another bias related to selection effects is the bias due to larger uncertainties on fainter sne ( e.g. , * ? ? ?",
    "simple simulations show that our bayesian framework has much less susceptibility to this bias , and the uncertainty bias is much smaller than the one due to missing faint sne altogether .",
    "as this is a bayesian framework , we must select priors on the true @xmath0 and @xmath1 latent parameters ( see @xcite for a discussion of gaussian priors , and @xcite for a gaussian - mixture prior ) .",
    "these priors must be chosen very carefully .",
    "if the prior mean is wrong , then every distance will also be incorrect in a correlated direction .",
    "the variance of the prior has an impact as well .",
    "if the prior variance is larger than the population variance , then the true latent parameters will be scattered about the mean more than they should , and the slope of the line will be biased towards zero .",
    "the converse will bias the slope of the lines away from zero .",
    "the mean and variance of the prior are the most important parameters to estimate accurately , thus gaussians are normally adequate . in sn cosmology",
    ", these priors must also be redshift - dependent as the sn population can drift with redshift .",
    "the optimal way to ensure the proper size and redshift - dependence of the priors is to fit for the prior parameters ( the `` hyperparameters '' ) simultaneously with every other parameter .",
    "we selected skew normal distributions for the @xmath1 priors ( allowing the distribution to be skewed ) , and gaussians for the @xmath0 priors .",
    "the prior must be able to vary in redshift more rapidly than the cosmological fit in order to not introduce a bias .",
    "what we propose here more than meets this mild requirement , but there is no harm in allowing the hyperparameters to mimic more closely the redshift dependence of the @xmath0 and @xmath1 distributions . for each sample",
    ", we fit for the mean of the distributions as a function of redshift with a linear spline .",
    "we use up to four spline nodes ( the @xmath37 and @xmath39 , for @xmath0 and @xmath1 , respectively ) , equally spaced in redshift over the range of a sample , with linear interpolation between these nodes .",
    "we take non - informative flat priors on the means of the distributions and on the log of the standard deviations ( the standard deviations for each sample @xmath83 are @xmath36 and @xmath38 ) . and @xmath84 .",
    "] for the shape parameter @xmath85 of the skew normals , we take a flat prior on @xmath86 , which is also allowed to vary in redshift in the same way as the distribution mean .",
    "this prior forces the skew normal to approach a gaussian for samples with few objects .",
    "( the superscript `` s@xmath77n '' here is used to distinguish these skew - normal variables from the sn standardizationcoefficients . )    for simplicity , we assume that the true @xmath0 and @xmath1 distributions are uncorrelated ( the observed distributions of @xmath0 and @xmath1 show little correlation ) . we do note that ignoring correlations will bias the fit if any significant ( @xmath87 ) correlations are present .      with the true values of the independent variables explicit in the model , it becomes trivial to have nonlinear standardizations . for this work ,",
    "we suggest a broken - linear relationship , allowing red / blue and small-/large-@xmath0 sne to have different size standardizationcoefficients ( @xmath42/@xmath41 and @xmath43/@xmath44 , respectively ) .",
    "we take a flat prior on the angle of each line segment , but transform to the average slope and the difference in slopes for display purposes : @xmath88 , @xmath89 , @xmath90 , and @xmath91 .",
    "although the @xmath0 and @xmath1 values of the break could be fit parameters , we do not do this for our primary fits . for the moment",
    ", we split the sample at @xmath0 and @xmath1 of 0 .",
    "as the unexplaineddispersion is parameterized in the model , it can be marginalized .",
    "we do not know what functional form to assume , so we use a flexible parameterization . each sn sample",
    "is allowed its own unexplaineddispersion , allowing poorer - quality samples to be naturally deweighted .",
    "we must also distribute the unexplaineddispersion over @xmath72 , @xmath0 , and @xmath1 , while accounting for possible correlations .",
    "first , we split the variance of the unexplaineddispersion into @xmath46 , @xmath47 , and @xmath92 ( the fraction of the unexplainedvariance in @xmath72 , @xmath0 , and @xmath1 , respectively ) , which are constrained to sum to one .",
    "then , we scale each of these by 1 , @xmath93 , and @xmath94 . the values @xmath95 and @xmath96 approximately scale out @xmath7 and @xmath97 , respectively , where the negative sign for @xmath8 corresponds to the sign convention in equation  [ eq : mbcorr ] .",
    "( note that using @xmath7 and @xmath97 directly would cancel the @xmath7 or @xmath8 dependence when computing a marginalized distance uncertainty for each sn , so this would be inappropriate . )",
    "we also scale the variance by the unexplaineddispersion for each sample , @xmath98 .",
    "finally , we form a covariance matrix out of this \\{@xmath72 ,  @xmath0 ,  @xmath1 } unexplainedvariance , allowing the off - diagonals to be scaled by parameters @xmath49 , as follows    @xmath99    we take a non - informative `` lkj '' prior on the correlation distribution @xcite , with @xmath100 , as well as a flat prior on @xmath101 .      many effects result in correlated measurements in sn cosmology . the most notable such effect results from common calibration paths : sne from a given dataset share systematics such as telescope bandpass and photometric calibration uncertainties .",
    "other effects include correlated uncertainties in milky way extinction maps , and correlated peculiar velocities . in standard analyses ,",
    "these effects are propagated into a covariance matrix @xcite .    in order to speed up the monte - carlo sampling ,",
    "we leave each correlating factor explicit as a parameter ( similar to * ? ? ?",
    "* ) , @xmath102 ( where @xmath103 ranges over all systematic uncertainties ) , while leaving the data uncorrelated sn to sn .",
    "these two approaches coincide exactly for a linear model with gaussian uncertainties @xcite .",
    "the @xmath102 parameters capture the deviations of a measured quantity , like a zeropoint or a filter bandpass , from the estimated value . for each quantity",
    ", we numerically compute the derivative of the light - curve fit @xmath104 with respect to that quantity , giving each @xmath105 , @xmath106 , and @xmath107 .",
    "this lets us marginalize out @xmath102 , with a gaussian prior around zero set by the estimated size of each systematic uncertainty .",
    "our analysis framework must pass through careful testing using simulated data before it can be applied to real data . to this end , we generate thirtysimulated datasets that incorporate many characteristics of real data . as our analysis takes the salt2 light - curve fits as inputs , this is the level at which we generate simulated data .",
    "* we generate four simulated datasets spanning the redshift ranges 0.020.05 , 0.050.4 , 0.21.0 , and 0.71.4 . *",
    "each simulated dataset has 250 sne , except the highest - redshift , which has 50 . *",
    "we generate the @xmath0 population from a unit normal distribution , centered on zero . *",
    "we draw the population @xmath1 values from the sum of a gaussian distribution of width 0.1 magnitudes , and an exponential with rate @xmath108 .",
    "we center the distribution on zero .",
    "* we assume that the unexplaineddispersion covariance matrix is correct in salt2 , and that only dispersion in @xmath72 ( gray dispersion ) remains .",
    "the statistical model does not have access to this information , and fits for the full unknown matrix , overestimating the uncertainties on @xmath0 and @xmath1 , and thus slightly biasing @xmath7 and @xmath8 away from zero ( see section  [ sec : indpriors ] ) .",
    "( this is not a unique problem for our framework ; the old technique would have the same bias . ) * we assume that the uncertainties on @xmath72 , @xmath0 , and @xmath1 are 0.05 , 0.5 , and 0.05 , and are uncorrelated .",
    "in addition , we take 0.1 magnitudes of unexplaineddispersion , @xmath109 magnitudes of lensing dispersion @xcite , and 300 km / s peculiar velocity uncertainty . all",
    "are approximated as gaussian and independent sn to sn .",
    "* @xmath7 and @xmath8 are assumed to be constant , with values 0.13 and 3.0 , respectively .",
    "@xmath10 is set to @xmath110 and @xmath25 is set to 0.3 ( flat @xmath24cdm model ) .",
    "* for the host - mass relation , we always take @xmath28 to be 0.08 magnitudes , and select @xmath67 uniformly from the range 0 to 1 . *",
    "we assume 3% of the sne are outliers , and draw their observed distribution centered around the normal ia @xmath72 for that redshift , and around zero in @xmath0 and @xmath1 .",
    "the spread is 1 , 2 , and 0.5 in @xmath72 , @xmath0 , and @xmath1 respectively , and we assume these distributions are gaussian and uncorrelated . *",
    "each sample has zeropoint uncertainties of size 0.01 , 0.01 , 0.01 , and 0.02 ( highest - redshift sample ) magnitudes .",
    "the uncertainties are taken to be independent sample to sample . *",
    "the datasets have selection effects in @xmath72 , with width 0.2 magnitudes .",
    "the selection cuts are chosen for 50% completeness at redshifts 0.08 , 0.25 , 0.6 , and 1.45 .",
    "note that this selects from the population @xmath0 and @xmath1 distributions in a redshift - dependent way .",
    "( we randomly draw from the population distributions and pass them through the simulated selection effects until the required number of sne are generated . ) * we assume the redshift distribution of sne scales linearly with redshift ( starting from the minimum redshift of each sample ) .",
    "this is quantitatively incorrect ( the real scaling will depend on the cosmological volume , cosmological time dilation , and the sn rate ) , but does produce sn samples where many sne are removed by the magnitude cuts , allowing a good test of our selection effect modeling .    the redshift distribution of the four simulated datasets are shown in figure  [ fig : simdata ] before selection effects ( gray - tinted histograms ) and as observed .",
    "we show the observed color distributions in figure  [ fig : simcolor ] .",
    "this figure shows outliers in gray ( knowledge that the statistical framework does not have access to ) , and the general trend towards bluer sne at higher redshift due to selection effects .",
    "figure  [ fig : simhr ] shows the hubble diagram residuals from the input cosmology with the best - fit ignoring selection effects ( @xmath111 ) also shown .    after generating thirtycomplete sets ( with all four sn samples ) , we supply the generated salt2 result files to the framework .",
    "table [ tab : simsummary ] summarizes the key results . as expected , @xmath7 , @xmath8 show bias away from zero , but",
    "any bias on @xmath25 is small .",
    "ccc @xmath7 & 0.130 & 0.143 @xmath112 0.004 + @xmath8 & 3.000 & 3.076 @xmath112",
    "0.016 + @xmath10 & @xmath113 & @xmath7719.117 @xmath112 0.003 + @xmath25 & 0.300 & 0.298 @xmath112 0.005",
    "[ tab : simsummary ]    we also run some simulated datasets fitting for both @xmath25 and the dark energy equation of state parameter @xmath114 ( assumed to be constant in redshift ) . and @xmath115 ; these priors would better preserve the gaussian sn likelihood .",
    "the cosmological results are similar with flat priors on @xmath25 and @xmath114 , so we use flat priors on these parameters for simplicity .",
    "we constrain @xmath25 to be between 0 and 1 , and @xmath114 to be between @xmath116 and 0 .",
    "] we see no evidence of bias on @xmath114 , and mild evidence of bias on the mean @xmath25 : @xmath117 .",
    "in this penultimate section , we demonstrate our framework on real data , namely , the union2.1 compilation @xcite .",
    "this compilation is a useful dataset for demonstrating the impact of the more - sophisticated analysis , as union2.1 provides light - curve fits for outliers ( the newer joint light - curve analysis , * ? ? ?",
    "* did not publish these sne ) .",
    "our cosmological fits include @xmath25 and assume a flat universe .",
    "this fit is qualitatively similar to the assumption of a constant equation - of - state parameter @xmath114 including a cmb or bao constraint , in that both fits probe the deceleration parameter @xmath118 . as fitting @xmath25 only requires sn data , it is a cleaner analysis for our purposes here .    in order to identify the effect of each feature of the analysis on the inferred results , we incrementally transition from the original union2.1 frequentist framework to the analysis proposed in this work .",
    "the results of each step are shown in figure  [ fig : analysissteps ] .",
    "we conducted this part of the analysis blinded , using real data only after the code was validated on simulated data .",
    "the initial version of unity required the unexplaineddispersion in @xmath72 to be fixed , which the improved selection effect model now presented in appendix  [ sec : detailsselectioneffects ] does not require . with the improvements in place ,",
    "after a second round of blinding - unblinding , we found only a small change in @xmath25 between the two versions , 0.009 ( @xmath119 ) .",
    "first , we show the results of a frequentist calculation , based on the same assumptions as @xcite and using its 580 sne ( top line in figure  [ fig : analysissteps ] ) with salt2 light - curve fits .",
    "all systematic uncertainties from the covariance matrix are included . to reproduce the @xcite results ,",
    "we include only a redshift - independent host - mass standardization . and @xmath8 for computational efficiency , our new results are very slightly different : 0.001 in the @xmath25 confidence interval . ] as a cross - check",
    ", we also try a hybrid frequentist / bayesian model , in which the @xmath12 from equation  [ eq : chi2fit ] is converted into a likelihood as @xmath120 and then @xmath10 , @xmath7 , @xmath8 , and @xmath9 are marginalized over ( this is similar to the method used in * ? ? ?",
    "we obtain essentially the same results as a purely frequentist fit .      for the next step ,",
    "we keep all data the same , but transition to a bayesian model for the data ( the credible intervals are shown as the second line in figure  [ fig : analysissteps ] ) .",
    "this model includes the sn population terms ( described in section  [ sec : indpriors ] and necessary for a bayesian analysis ) and the union2.1 systematic uncertainties , but does not include our proposed treatment of selection effects , outliers , multi - dimensional unexplaineddispersion , or the redshift - dependent host - mass standardization .",
    "other than the type of inference and these differences , this fit is identical to the first fit .",
    "the error bars shrink by , but the central value changes very little .",
    "as the data are the same for this fit and the last one , the gain in statistical power comes from the ability of a bayesian hierarchical model to make better use of heterogeneous information .",
    "will have no constraining power , but a bayesian model will .",
    "the difference between the bayesian and frequentist union2.1 fits is thus a measure of how inhomogeneous the uncertainties are within a given redshift range for each sn sample . ]      next , we return to the frequentist framework , but include the redshift - dependent mass standardizationas described in section  [ sec : hostgalaxy ] ( third line in figure  [ fig : analysissteps ] ) .",
    "we remove the @xcite covariance matrix term that corresponds to systematic uncertainty on the mass standardization .",
    "the best fit shifts to a higher @xmath25 ( brighter standardized magnitudes on average at high redshift ) because the high - host - mass half of the high - redshift sne has less standardizationto fainter magnitudes .",
    "this step can be conducted through frequentist or bayesian inference , and we show both analyses .      in this next fit , we continue with the same data and model as the last subsection ( redshift - dependent host - mass standardization ) , but again transition to bayesian inference , including the population terms ( fourth line of figure  [ fig : analysissteps ] ) .",
    "the results are similar to the frequentist results , but the bayesian fit is more agnostic about the value of @xmath29 ( essentially unconstrained ) , so the fit shifts less than the frequentist one to higher @xmath25 .      remaining in the bayesian framework , our next addition is the multi - dimensional unexplaineddispersion .",
    "we first remove the existing union2.1 unexplaineddispersion ( which is only in @xmath72 ) . by effectively increasing the uncertainties on the color",
    ", we increase the color - standardizationcoefficient @xmath8 .",
    "thus the color standardizationnow moves bluer ( bluer due to selection effects ) high - redshift sne fainter , decreasing the fitted @xmath25 ( the fourth line from the bottom in figure  [ fig : analysissteps ] ) .",
    "we now take advantage of our explicit @xmath121 and @xmath122 values to include nonlinear color standardizations  parameterized by @xmath123 and @xmath124 .",
    "we remove the union2.1 covariance terms that describe color - standardizationsystematics ( between the multivariate unexplaineddispersion and the nonlinear standardizations , these systematic uncertainties are likely much lower ) .",
    "the color standardizationis now strongly nonlinear ( discussed further in section  [ sec : otherparams ] ) , with redder sne requiring a larger coefficient than bluer sne .",
    "this moves the fitted @xmath25 ( third line from the bottom in figure  [ fig : analysissteps ] ) back in the opposite direction from the previous step .",
    "next , we include in the fit all twelve outlier sne removed by the union sigma clipping in union2.1 ( a new total of 592 ) . instead of excluding these , we add our mixture model for handling outlier sne .",
    "we also remove the union2.1 systematic uncertainties on outlier rejection .",
    "the results are quite similar to the previous step , indicating that the union sigma - clipping worked well with the 2% contamination that was present ( second line from the bottom in figure  [ fig : analysissteps ] ) .",
    "ccc[h ] nearby sne & @xmath125 18.5 @xmath112 0.5 & 18.6 @xmath126 + caln / tololo & @xmath125 19.0 @xmath112 0.5 & 19.3 @xmath127 + scp nearby & @xmath125 19.0 @xmath112 0.5 & 19.3 @xmath127 + sdss & @xmath128 22.1 @xmath112 0.5 ( ab ) & 22.6 @xmath129 + snls & @xmath130 24.3 @xmath112 0.5 ( ab ) & 25 @xmath131 + other mid - redshift & @xmath125 24 @xmath112 0.5 & 24.5 @xmath132 + high - redshift ground & @xmath133 23.8 @xmath112 0.5 & 25.0 @xmath134 + hst acs & @xmath135 25.0 @xmath112 0.5 ( vega ) & 26.1 @xmath136    [ tab : selection ]    finally , we model selection effects . for simplicity ,",
    "we approximate all selection as occurring in rest - frame @xmath5-band ( @xmath137 , @xmath138 ) , and leave a more detailed analysis to future work .",
    "for many of the most important samples in union2.1 , this is not a bad approximation .",
    "for example , the sloan digital sky survey sne @xcite were selected in @xmath139 , @xmath128 , and @xmath130-band @xcite . at redshift @xmath140 ( the distant end of the survey )",
    ", @xmath128-band corresponds to rest - frame @xmath5-band .",
    "the supernova legacy survey sne were selected in @xmath130-band @xcite , which matches rest - frame @xmath5-band for the highest - redshift sne with small distance uncertainties ( @xmath141 ) .",
    "for some surveys , rest - frame @xmath5-band selection is a poor approximation .",
    "many of the nearby sne were selected from unfiltered surveys ( approximately rest - frame @xmath125-band ) , but these mostly galaxy - targeted surveys have generally weak selection effects in magnitude ( discussed below ) .",
    "some distant sn surveys @xcite had selections that were different ( bluer ) than rest - frame @xmath5-band . at least for the hst - discovered sne , selection effects are small for",
    "most of the redshift range ( also discussed more below ) .",
    "we estimate the selection effects for each sample as follows ( summarized in table  [ tab : selection ] ) .",
    "nearby sne are generally limited by spectroscopic followup , for example the @xmath142 magnitude limit for cfa discussed in @xcite ( although this is unfiltered , we approximate it as @xmath125-band ) .",
    "we take this limit as typical .",
    "the caln / tololo survey @xcite and the scp nearby search @xcite extend out to higher redshift ; the limiting magnitude in this case is @xmath143 @xcite .",
    "we take the magnitude limit for sdss from @xcite and the limit for snls from @xcite . together , these samples make up most of the mid - redshift weight . for the other mid - redshift samples , we take a limit of @xmath125 = 24 , judged from the approximate rolloff of the sn population in redshift . for the high - redshift ground - discovered samples",
    ", we assume the surveys were 50% complete at @xmath131 ; this gives a limit of 23.8 in @xmath133-band .",
    "finally , for the hst - discovered sne , we take a limit from @xcite of @xmath135-band @xmath144 ( vega ) . in all cases ,",
    "we take the width of the selection to be @xmath145 magnitudes ( i.e. , a sn 0.5 magnitudes brighter than the mean cut has an 84% chance of being selected ; a sn 0.5 magnitudes fainter has a 16% chance ) . as a cross - check ,",
    "we coherently shift each estimated magnitude limit fainter by 0.5 magnitudes , representing an extreme limit of how inaccurate our estimations are likely to be .",
    "the @xmath25 credible interval shifts by only 0.006 .    we remove the union2.1 covariance matrix terms for malmquist bias before computing the fit shown in the bottom line of figure  [ fig : analysissteps ] .",
    "the @xmath25 credible interval shifts to lower @xmath25 , as the distant sne with significant selection effects are standardized fainter .",
    "the central value of this final fit closely matches the original union2.1 result , but we see that our new , smaller ( by compared to the union2.1 analysis ) credible interval shows an increase in statistical power .",
    "it is worth reiterating that the list of improvements to make was established before the results were known ; we did not set out to simply achieve a similar result to union2.1 .",
    "the scatter of the intermediate results generally validates the size of the union2.1 systematics estimates for these effects that we can now properly include in the model .",
    "we now present the results for important nuisance parameters and their relation to @xmath25 in the form of 1d and 2d credible regions . in both cases ,",
    "our credible regions are derived by using kernel density estimation with a gaussian kernel on the mcmc samples,3,000 samples from sixteen chains .",
    "the @xcite @xmath125 statistics are @xmath146 , indicating good convergence . ] then solving for the contour level that encloses 68.3% ( inner shaded regions ) and 95.4% ( outer shaded regions ) of the posterior .",
    "figure  [ fig : mass ] shows the significant degeneracy between both host - mass standardizationparameters and @xmath25 , illustrating that neither one should be neglected .",
    "the mean value of the estimated fraction of outliers is similar to the 12/592 found by the union sigma clipping .",
    "this parameter has no significant degeneracy with any parameter for the spectroscopically confirmed datasets in union2.1 , confirming that outlier rejection is not a significant concern at this high level of purity . as an additional cross - check , instead of assuming",
    "the outlier distribution is centered on the sn ia distribution , we fit for it . including six parameters in the model for the mean and dispersion in \\{@xmath72 , @xmath0 , @xmath1 } ( taken to be uncorrelated , and assuming a constant distribution with redshift ) leaves the error bar unchanged but shifts the credible region by 0.009 in @xmath25 .",
    "if future versions of the unity framework are run on samples with larger contamination , a more flexible outlier parameterization can be matched with the increased number of outliers in the fit ( e.g. , * ? ? ?",
    "figure  [ fig : intalphabeta ] shows the degeneracy between the fraction of the unexplainedvariance in @xmath0 and @xmath7 , and similarly @xmath1/@xmath8 . including these unexplaineddispersion parameters",
    "increases the uncertainty and the mean value for @xmath7 and @xmath8 .",
    "( here , @xmath7 and @xmath8 represent the mean standardizationcoefficient . )",
    "the model prefers most of the unexplaineddispersion in @xmath72 and @xmath1 , rather than @xmath0 .",
    "we also see statistical evidence of non - zero @xmath123 and @xmath124 ( recall that @xmath123 is the @xmath0 standardizationcoefficient for broad - light - curve sne minus the coefficient for narrow sne ; @xmath124 is similarly defined for red minus blue sne ) : @xmath123 is @xmath147and @xmath124 is @xmath148 .",
    "both have a correlation with @xmath25 , although the correlation with @xmath124 is larger .",
    "we note , at least for this compilation of sne and salt2 - 1 , that blue sne still have a non - zero @xmath8 : @xmath149 , and red sne have a @xmath8 of @xmath150 .",
    "this value is significantly less than 4.1 ( the value expected if all reddening were due to the mean extinction law of the milky way diffuse interstellar medium ) . in our standard analysis , letting the division be a fit parameter yields a division at @xmath151 ; the uncertainties on @xmath41 significantly increase . ]",
    "in this work , we propose unity , a unified bayesian model for handling outliers , selection effects , shape and color standardizations , unexplaineddispersion , and heterogeneous observations . we demonstrate the method with the union2.1 sn compilation , and show that our method has smaller uncertainties , but results that are consistent with the union2.1 analysis .",
    "the advantages of unity will likely be even larger in upcoming datasets , as scarce followup resources will introduce heterogeneity , and enlarged samples may reduce the cosmological - parameter statistical uncertainties below the size of our improvements .",
    "there are several future directions for this research",
    ". we could allow the unexplaineddispersion covariance matrix to vary with other parameters ( @xmath0 , @xmath1 , redshift , or rest - frame wavelength range ) .",
    "we could decompose the unexplaineddispersion into a sum of gaussians as in the model of @xcite .",
    "we could use gaussian process regression @xcite to handle the redshift - dependent priors on @xmath0 and @xmath1 .",
    "our model also lets us include more than one light - curve fit for each sn , with the covariance matrix between different light - curve fitters parameterized .",
    "we could even make use of the hierarchical model to constrain `` exotic possibilities , '' as sketched in section  [ sec : desiredprops ] .",
    "all of these are straightforward modifications of what we present here , but our proposed model is already superior to current sn cosmological analysis frameworks .",
    "we believe these concepts will also be useful for other applications .",
    "we thank alex kim , marisa march , masao sako , rachel wolf , and the referee for their feedback on this manuscript .",
    "this work was supported in part by the director , office of science , office of high energy physics , of the u.s .",
    "department of energy under contract no .",
    "de - ac02 - 05ch11231 .",
    "this research used resources of the national energy research scientific computing center , a doe office of science user facility supported by the office of science of the u.s .",
    "department of energy under contract no .",
    "de - ac02 - 05ch11231 .",
    "64 natexlab#1#1    , r. , lidman , c. , rubin , d. , et  al .",
    "2010 , , 716 , 712    , k. , aldering , g. , amanullah , r. , et  al .",
    "2012 , , 745 , 32    , j.  p. , kessler , r. , kuhlmann , s. , et  al .",
    "2012 , , 753 , 152    betancourt , m.  j. 2013 , arxiv , 1304    , m. , kessler , r. , guy , j. , et  al .",
    "2014 , , 568 , a22    , c.  r. , stritzinger , m. , phillips , m.  m. , et  al .",
    "2014 , , 789 , 32    , m. , aldering , g. , antilogus , p. , et  al .",
    "2013 , , 770 , 108    , m.  j. , wolf , c. , & zahid , h.  j. 2014 , , 445 , 1898    , n. , gangler , e. , aldering , g. , et  al .",
    "2011 , , 529 , l4    , a. , guy , j. , sullivan , m. , et  al .",
    "2011 , , 192 , 1    , b. , kessler , r. , frieman , j.  a. , et  al .",
    "2008 , , 682 , 262    , b. 2005 , international journal of modern physics a , 20 , 3121    , r.  j. 2012 , , 748 , 127    , r.  j. , & kasen , d. 2011 , , 729 , 55    , r.  j. , sanders , n.  e. , & kirshner , r.  p. 2011",
    ", , 742 , 89    gelman , a. , carlin , j. , stern , h. , et  al . 2013 , bayesian data analysis , third edition , chapman & hall / crc texts in statistical science ( taylor & francis )    gelman , a. , & rubin , d.  b. 1992 , statistical science , 7 , pp .",
    "457    , o. , rodney , s.  a. , maoz , d. , et  al .",
    "2014 , , 783 , 28    gull , s. 1989 , in fundamental theories of physics , vol .  36 , maximum entropy and bayesian methods , ed . j.  skilling ( springer netherlands ) , 511518    , j. , astier , p. , baumont , s. , et  al .",
    "2007 , , 466 , 11    , j. , sullivan , m. , conley , a. , et  al .",
    "2010 , , 523 , a7    , m. , phillips , m.  m. , suntzeff , n.  b. , et  al .",
    "1996 , , 112 , 2398    , m. , & pinto , p.  a. 1999 , , 117 , 1185    , m. , phillips , m.  m. , suntzeff , n.  b. , et  al .",
    "1996 , , 112 , 2408    , m. , challis , p. , jha , s. , et  al .",
    "2009 , , 700 , 331    , r. , kunz , m. , bassett , b. , et  al .",
    "2012 , , 752 , 79    hoffman , m.  d. , & gelman , a. 2011 , arxiv , 1111    . 2014 , journal of machine learning research , 15 , 1593    , j.  a. , marriner , j. , kessler , r. , et  al .",
    "2008 , , 136 , 2306    , d.  e. , & linder , e.  v. 2005 , , 631 , 678    , d.  o. , riess , a.  g. , & scolnic , d.  m. 2015 , arxiv e - prints    , b.  c. 2007 , , 665 , 1489    , p.",
    "l. , hicken , m. , burke , d.  l. , mandel , k.  s. , & kirshner , r.  p. 2010",
    ", , 715 , 743    , r. , becker , a.  c. , cinabro , d. , et  al .",
    "2009 , , 185 , 32    , r. , guy , j. , marriner , j. , et  al .",
    "2013 , , 764 , 48    , r.  a. , aldering , g. , amanullah , r. , et  al .",
    "2003 , , 598 , 102    , m. , rubin , d. , aldering , g. , et  al .",
    "2008 , , 686 , 749    , m. , bassett , b.  a. , & hlozek , r.  a. 2007 , , 75 , 103508    , h. , smith , m. , nichol , r.  c. , et  al .",
    "2010 , , 722 , 566    lewandowski , d. , kurowicka , d. , & joe , h. 2009 , journal of multivariate analysis , 100 , 1989    malmquist , k. 1922 , on some relations in stellar statistics , arkiv fr matematik , astronomi och fysik ( almqvist & wiksells )    , k.  s. , narayan , g. , & kirshner , r.  p. 2011",
    ", , 731 , 120    , m.  c. , trotta , r. , berkes , p. , starkman , g.  d. , & vaudrevange , p.  m. 2011 , , 418 , 2308    , j. , bernstein , j.  p. , kessler , r. , et  al .",
    "2011 , , 740 , 72    , j. , guy , j. , kessler , r. , et  al .",
    "2014 , , 793 , 16    , k. , sullivan , m. , conley , a. , et  al .",
    "2012 , , 144 , 59    , m.  m. 1993 , , 413 , l105    rasmussen , c.  e. , & williams , c. 2006 , gaussian processes for machine learning ( mit press )    , a. , scolnic , d. , foley , r.  j. , et  al .",
    "2014 , , 795 , 44    , a.  g. , strolger , l .- g . , casertano , s. , et  al .",
    "2007 , , 659 , 98    , m. , copin , y. , aldering , g. , et  al .",
    "2013 , , 560 , a66    , m. , aldering , g. , kowalski , m. , et  al .",
    "2015 , , 802 , 20    , s.  a. , riess , a.  g. , strolger , l .- g .",
    ", et  al . 2014 , , 148 , 13    , d. , knop , r.  a. , rykoff , e. , et  al . 2013 , , 763 , 35    , c. , aldering , g. , antilogus , p. , et  al . 2015 , , 800 , 57    , d. , rest , a. , riess , a. , et  al .",
    "2014 , , 795 , 45    , d.  m. , riess , a.  g. , foley , r.  j. , et  al .",
    "2014 , , 780 , 37    .",
    "2014 , pystan : the python interface to stan , version 2.5.0    , m. , conley , a. , howell , d.  a. , et  al .",
    "2010 , , 406 , 782    , n. , rubin , d. , lidman , c. , et  al .",
    "2012 , , 746 , 85    , j.  l. , schmidt , b.  p. , barris , b. , et  al .",
    "2003 , , 594 , 1    , r. 1998 , , 331 , 815    , x. , filippenko , a.  v. , ganeshalingam , m. , et  al .",
    "2009 , , 699 , l139    , w.  m. , miknaitis , g. , stubbs , c.  w. , et  al .",
    "2007 , , 666 , 694",
    "our model is a two - component mixture model , where the outlier component is a gaussian in @xmath72 , @xmath0 , and @xmath1 , and the normal sne ia component is a gaussian in @xmath72 , @xmath0 , and @xmath1 , truncated by selection effects .",
    "the full likelihood for a single sn is given by the sum of the core distribution    @xmath152 , \\left [ \\begin{array}{l } { m_{b i}^{\\mathrm{true } } \\xspace}+ \\delta m_b\\\\   { x_{1 i}^{\\mathrm{true } } \\xspace}+   \\delta x_1\\\\ { c_{i}^{\\mathrm{true } } \\xspace}+ \\delta c \\end{array } \\right ] , \\",
    "c^{\\mathrm{ext}}(z_i ) + c^{\\mathrm{obs}}_i + c^{{\\mathrm{samp}}}_i \\right ) { \\:}{p(\\mathrm{detect}|\\{{m_{b i}^{\\mathrm{obs } } \\xspace } , { x_{1 i}^{\\mathrm{obs } } \\xspace } , { c_{i}^{\\mathrm{obs } } \\xspace}\\})\\xspace } } { ( \\epsilon=0.01 ) +   { p(\\mathrm{detect})\\xspace } } ( 1 - f^{\\mathrm{outl}})\\\\\\ ] ]    with the outlier distribution    @xmath153 , \\left [ \\begin{array}{l } { m_{b i}^{\\mathrm{true } } \\xspace}+ \\delta m_b\\\\   { x_{1 i}^{\\mathrm{true } } \\xspace}+   \\delta x_1\\\\ { c_{i}^{\\mathrm{true } } \\xspace}+ \\delta c \\end{array } \\right ] , \\   ( \\mathbbm{1 }   )",
    "\\right ) f^{\\mathrm{outl } } \\;.\\ ] ]    @xmath154 and @xmath155 are described in equations  [ eq : fracdetobs ] and [ eq : psel ] , respectively .",
    "@xmath156 is not a free parameter ; instead it is completely determined by other parameters and is given by    @xmath157    @xmath158\\{@xmath72 , @xmath0 , @xmath1 } are the contributions from the systematic uncertainty terms , e.g. , @xmath159    the broken - linear slopes are defined as    @xmath160    @xmath161    and @xmath162 is given by equation  [ eq : deltaofz ] .",
    "we take the following priors on all parameters :    @xmath163",
    "in this section , we detail the approach we take for modeling selection effects in unity .",
    "we start with a general likelihood containing missing observations in the case when both the number of observed objects ( @xmath164 ) and the number of missed objects ( @xmath165 ) are exactly known :      as described in section  [ sec : selection ] , we assume that the efficiency smoothly varies with @xmath167 : @xmath168 where @xmath169 is the gaussian cdf . of course , we do not know any of the parameters for each of the missing observations .",
    "@xmath155 is thus marginalized over the entire distribution when it is not referencing a specific observation .",
    "we now make the counterintuitive approximation that the redshift of each missed sn is exactly equal to the redshift of a detected sn .",
    "this approximation is accurate because the sn samples have , on average , enough sne that the redshift distribution is resonably sampled .",
    "we now refactor equation  [ eq : fracdetect ] to consider each detected sn :      the combinatoric factor trivially becomes @xmath171 . to minimize the number of parameters in the cosmological fit",
    ", we now seek to marginalize over @xmath171 from 1 to @xmath172 .",
    "it is common ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) to take a flat prior on @xmath173 ; for reasons that will become clear in a moment , we force this prior to zero faster than this by multiplying this @xmath174 prior by a weak exponential decay @xmath175 where @xmath176 is a small positive number .",
    "thus , the marginalization becomes :      which is equal to the geometric series @xmath178 which sums to @xmath179 this expression highlights the benefit of this prior .",
    "if a flat prior on @xmath173 is assumed ( @xmath180 ) , then the likelihood can be poorly behaved in regions of parameter space where the efficiency is poor ( even if care is taken in the log likelihood to correctly handle the asymptotes of the log of the efficiency ) . running unity on union2.1 with @xmath176 either 0 or 0.01",
    "makes virtually no difference , but stan has difficulty with many of the simulated datasets ( which we constructed with severe malmquist bias as a test , see section  [ sec : simulateddata ] ) for @xmath180 , so we make @xmath181 our default choice .",
    "we now need the efficiency as a function of the parameters .",
    "we derived the following expression by analytically computing the variance , then expanding to first order in @xmath182 ( this approximation is good to better than one percent in the variance for our distributions ) . for simplicity",
    ", we use the same expression for @xmath1 , although the @xmath1 distribution is skew - normal instead of normal .",
    "( changing the assumed intrinsic color distribution to normal , rather than skew - normal , changes @xmath25 by only 0.001 , so this approximation is not a significant concern . )",
    "the first line contains the measurement and unexplaineddispersion in @xmath72 , the dispersion of the selection cut , and the dispersion due to the host - galaxy relation .",
    "the second and third lines give the dispersion due to the @xmath184 and @xmath185 relations , respectively .",
    "using the same approximations , we derived an expression for the mean of the ( unstandardized ) magnitude distribution      in this case , our approximations are valid to a few hundredths of a magnitude .",
    "we then compute the selection efficiency assuming that the distribution of magnitudes is gaussian @xmath187 this approximation is not completely valid , as there is a tail to faint magnitudes of red sne , but for the central part of the distribution ( which is the part that is cut into by severe malmquist bias ) , it is a good approximation ."
  ],
  "abstract_text": [
    "<S> while recent supernova cosmology research has benefited from improved measurements , current analysis approaches are not statistically optimal and will prove insufficient for future surveys . </S>",
    "<S> this paper discusses the limitations of current supernova cosmological analyses in treating outliers , selection effects , shape- and color - standardizationrelations , unexplaineddispersion , and heterogeneous observations . </S>",
    "<S> we present a new bayesian framework , called unity ( unified nonlinear inference for type - ia cosmology ) , that incorporates significant improvements in our ability to confront these effects . </S>",
    "<S> we apply the framework to real supernova observations and demonstrate smaller statistical and systematic uncertainties . </S>",
    "<S> we verify earlier results that sne ia require nonlinear shape and color standardizations , but we now include these nonlinear relations in a statistically well - justified way . </S>",
    "<S> this analysis was primarily performed blinded , in that the basic framework was first validated on simulated data before transitioning to real data . </S>",
    "<S> we also discuss possible extensions of the method . </S>"
  ]
}