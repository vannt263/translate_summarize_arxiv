{
  "article_text": [
    "various methods are in use for identifying and replacing cosmic - ray hits in ccd data .",
    "the most straightforward approach is to obtain multiple exposures of the same field ( or multiple non - destructive readouts during a single exposure ; e.g. , fixsen et al .  2000 ) . in general",
    ", a given pixel will suffer from a cosmic - ray hit in only one or two of the exposures , and remaining exposures can be used to obtain its replacement value ( e.g. , zhang 1995 ) .",
    "methods for combining multiple exposures have reached a high degree of sophistication , particularly those developed for dithered _ hubble space telescope _ ( hst ) data ( e.g. , windhorst , franklin , & neuschaefer 1994 , freudling 1995 , fruchter & hook 1997 ) .    however , there are circumstances when cosmic - ray identification in single exposures is required or desirable",
    ". the object of interest may be varying or moving on short timescales , and in the case of long - slit spectra the positions and intensities of sky lines and object spectra may change ( e.g. , croke 1995 ) .",
    "furthermore , pixels can be hit by cosmic - rays in more than one exposure , and some affected pixels may remain after combining individual images .",
    "cosmic - ray removal in individual exposures may also be desirable if the images are shifted with respect to each other by a non - integer number of pixels , or if the seeing varied significantly between the exposures ( see rhoads 2000 ) .",
    "finally , multiple exposures are simply not always available .",
    "methods for identifying cosmic - rays in single images or spectra include median filtering ( e.g. , qzap by m.  dickinson ) , filtering by adapted point spread functions ( psfs ) ( e.g. , rhoads 2000 ) , trained neural networks ( salzberg et al .",
    "1995 ) , and interpolation of neighbouring pixels ( e.g. , the cosmicrays task in the iraf package ) . all these methods effectively remove small cosmic - rays from well sampled data .    the most widely used methods are based on some form of median filtering , and usually include adaptations to exclude stars and emission lines from the list of cosmic - rays .",
    "however , problems arise when cosmic - rays affect more than half the area of the filter , or the psf is smaller than the filter .",
    "the size of the filter is therefore a trade - off between detecting large cosmic - rays and limiting contamination by structure on the scale of the psf .    in this paper ,",
    "a new algorithm for rejecting cosmic - rays in single exposures is described .",
    "it is based on laplacian edge detection , which is a widely used method for highlighting boundaries in digital images ( see , e.g. , gonzalez & woods 1992 ) .",
    "the strength of the method is that it relies on the sharpness of the _ edges _ of cosmic - rays rather than the contrast between entire cosmic - rays and their surroundings .",
    "therefore , it is largely independent of the morphology of cosmic - rays .",
    "this property is very useful , and forms the basis for a robust discrimination between poorly sampled point sources and cosmic - rays .",
    "the laplacian of a 2-d function is a second - order derivative defined as @xmath0 the laplacian is commonly used for edge detection in digital images . in this application",
    "the image is convolved with the laplacian of a 2-d gaussian function of the form @xmath1 where @xmath2 and @xmath3 is the standard deviation .",
    "the second - order derivative with respect to @xmath4 has the form @xmath5 the laplacian has zero - crossings at @xmath6 , and the locations of edges are found by identifying zero - crossings in the convolved image .",
    "the standard deviation can be tuned to the smoothness of the edge , and by using a range of values for @xmath3 both sharp and smooth edges can be identified ( marr & hildreth 1980 ) .",
    "cosmic - rays have very sharp edges , and the convolution kernel should be most sensitive to variations on small scales . the appropriate discrete implementation of eq .",
    "[ laplace.eq ] has the form @xmath7 the average value of a laplacian image ( obtained by convolving an image with the kernel given in eq .",
    "[ kernel.eq ] ) is zero , and smooth structure in the image is removed .",
    "a straightforward convolution of eq .",
    "[ kernel.eq ] with a ccd image produces negative cross patterns around high pixels . as a result , connected",
    "cosmic - ray pixels suffer from attenuation by the negative cross patterns of their neighbors .",
    "hence before convolution the original image @xmath8 needs to be subsampled .",
    "the results are independent of the subsampling factor , and a factor two is computationally least expensive : @xmath9/2),{\\rm int}([j+1]/2)},\\ ] ] with @xmath10 the size of the original image and @xmath11 .",
    "the laplacian of the subsampled image is @xmath12 with @xmath13 denoting convolution .",
    "the laplacian of the edge of a cosmic - ray is negative on the outside and positive on the inside of the cosmic - ray .",
    "therefore , by setting all negative values in the laplacian image to zero cosmic - ray affected pixels are retained and their negative cross patterns are removed : @xmath14 finally , the image is resampled to its original resolution : @xmath15 with @xmath16 .",
    "the process is illustrated in fig .",
    "[ explain.plot ] .",
    "a small section of a 2d long slit spectrum is shown in ( a ) .",
    "panel ( b ) shows the same image , subsampled by a factor six and convolved with the laplacian kernel given in eq .",
    "[ laplace.eq ] .",
    "edges are at the locations of zero - crossings . in panel",
    "( c ) all negative values are set to zero . finally , the image is block averaged by a factor six ( panel d )",
    ". the cosmic - ray stands out clearly .",
    "because the spectrum is smooth on scales of @xmath17 pixel its laplacian is close to zero .",
    "= 7.6 cm    the numerical value associated with each edge is the difference between the two neighbouring pixels , and the resampled laplacian of an image @xmath8 consisting of a smooth background @xmath18 with superposed noise and cosmic - rays is approximately @xmath19 with @xmath20 the subsampling factor that was used .",
    "the laplacian thus retains the flux in high pixels and removes the local background , making it very useful for identifying cosmic - rays .",
    "= 7.6 cm    to identify cosmic - rays in the laplacian image the value of each pixel is compared to the expected noise at that location .",
    "the noise characteristics of the laplacian image are not the same as in the original , and all negative poisson fluctuations in the original image are ( close to ) zero in the laplacian image .",
    "these effects are demonstrated in fig .",
    "[ his.plot ] for a simulated image containing @xmath21 @xmath22 cosmic - rays .",
    "as expected , the distribution of pixel values near zero is strongly distorted by the laplacian .",
    "however , the positive tail of the distribution ( i.e. , the region where cosmic - rays are found ) remains virtually unchanged .",
    "therefore the noise properties of the original image can be used for identifying cosmic - rays in @xmath23 , which greatly simplifies the analysis .",
    "the noise model is constructed by convolving the original image with a median filter : @xmath24 where @xmath25 is the gain in electrons / adu , @xmath26 is the readnoise in electrons , and @xmath27 is a @xmath28 median filter . for long slit spectroscopic data the algorithm offers the option of fitting and subtracting sky lines and/or object spectra .",
    "these fits provide the basis for the long slit noise model , which is optimized by applying eq .",
    "[ noise.eq ] to the residuals from the fits .",
    "the laplacian image is divided by the noise model to obtain the deviations from the expected poisson fluctuations : @xmath29 cosmic - rays are identified by selecting pixels in @xmath30 that are above a given threshold @xmath31 .    for single - pixel cosmic - rays on a smooth background",
    "the detection probability depends on the noise in the background @xmath32 only .",
    "the error in the background estimate scales as @xmath33 , with @xmath34 the number of pixels . since",
    "four neighbouring pixels are used to determine the laplacian of a given pixel , the width of the distribution of cosmic - rays is increased by @xmath35 ( see fig .  [ his.plot ] ) . as an example , if a detection threshold of @xmath36 is applied , @xmath37% of @xmath38 peaks in the original image will be marked as cosmic - rays , @xmath39% of @xmath36 peaks , and @xmath40% of @xmath41 peaks .",
    "the detection probability of cosmic - rays larger than a single pixel depends on the number of connected pixels and the pixel - to - pixel variation within the cosmic - ray . in general the laplacian",
    "( and hence the detection probability ) is lowest for cosmic - rays with small pixel - to - pixel variations . in the limiting case of a cosmic - ray with negligible pixel - to - pixel variation @xmath42 with @xmath43 the number of cosmic - ray pixels adjacent to pixel @xmath44 .",
    "pixels on the corners of large cosmic - rays have at most two adjacent pixels , and the laplacian always retains at least @xmath45% of their flux .",
    "therefore , ( arbitrarily ) large cosmic - rays can be removed by applying the rejection process iteratively . before each iteration , pixels flagged as cosmic - rays in previous iterations are replaced by the median of surrounding `` good '' pixels.acd      the laplacian gives the difference between one pixel and its neighbours , and contains no information on the nature of detected features .",
    "real astronomical objects produce signal in the laplacian image because of poisson noise and because their intrinsically smooth intensity profiles are sampled by the pixels .",
    "this `` sampling flux '' is generally small , and will not produce spurious detections as long as it does not exceed the predicted poisson fluctuations ( see eq .",
    "[ noise.eq ] , [ sigmap.eq ] ) .",
    "however , for bright objects the sampling flux can be significant , in particular if the point spread function ( psf ) is not well sampled .",
    "sampling flux is removed from @xmath30 in two steps .",
    "first , all structure that is smooth on scales of @xmath46 pixels is removed by a @xmath28 median filter : @xmath47 this procedure very effectively removes sampling flux resulting from extended bright objects ( including point sources if the psf is well sampled ) . because of the large size of the filter cosmic - rays and the noise properties of @xmath30 remain unaffected .    next ,",
    "sampling flux resulting from critically sampled ( or even undersampled ) point sources is removed .",
    "as is well known , it is very hard to distinguish cosmic - rays from stars and emission lines in marginally sampled data , because they can have very similar pixel - to - pixel variations within an area @xmath48 pixels .",
    "point sources are distinguished from cosmic - rays by their symmetry .",
    "an image only containing symmetric fine structure on scales of @xmath49 pixels is constructed and compared to the laplacian image .",
    "this `` fine structure image '' @xmath50 is created from the original image by a combination of median filters : @xmath51 \\circ m_7 \\right),\\ ] ] where @xmath52 is an @xmath10 median filter .",
    "the second term serves to remove large scale structure from @xmath50 .",
    "an important property of @xmath50 is that central pixels of undersampled point sources do not vanish , but are replaced by the median of the surrounding pixels .",
    "the laplacian image is divided by the fine structure image , and cosmic - rays are selected as those pixels which have @xmath53 _ and _ @xmath54 , with @xmath55 defining the minimum contrast between the laplacian image and the fine structure image .",
    "figure  [ stars.plot ] demonstrates the procedure .",
    "artificial images of three stars and a cosmic - ray are shown in the top row .",
    "one stellar image is slightly oversampled ( @xmath56 pixels ) , the second is critically sampled ( @xmath57 pixels ) , and the third is slightly undersampled ( @xmath58 pixels ) .",
    "the contrast between the cosmic - ray and its local background is identical to the contrast between the central pixel of the undersampled star and its local background . as a result ,",
    "the highest pixels in their laplacian images @xmath23 ( shown in the second row ) have very similar values .",
    "the third row shows fine structure images @xmath50 .",
    "the cosmic - ray has very low signal in @xmath50 , whereas the stars retain a significant fraction of their flux because of their symmetry .",
    "the bottom row shows the laplacian images divided by the fine structure , @xmath59 . only pixels with @xmath54",
    "are retained .",
    "the critically sampled star has @xmath60 , and @xmath61 for the undersampled star .",
    "the cosmic - ray has @xmath62 , and is easily distinguished from undersampled point sources .",
    "= 7.6 cm    in general , the appropriate value of @xmath55 depends on the sampling of a given point source , its s / n ratio , and whether it lies on the center of a pixel or close to the edge .",
    "these effects can be simulated by creating artificial psfs with varying sampling , s / n ratios , and subpixel positions , and calculating @xmath63 for each star .",
    "figure [ sim.plot ] shows the dependence of @xmath63 on the sampling , expressed as the full width at half maximum ( fwhm ) of stars ( in pixels ) .",
    "the width of the shaded region demonstrates the ( maximum ) effects of varying s / n ratio and subpixel position .",
    "these simulations demonstrate that the value of @xmath63 , and hence the appropriate choice of @xmath55 , depends mainly on the sampling . for data that are well sampled",
    "@xmath64 is appropriate ; hence this is the default value in the algorithm . for undersampled data higher values of @xmath55 are needed to discriminate point sources and cosmic - rays ; as an example , data taken with the wide field chips in hst s wfpc2 camera require @xmath65 .",
    "= 7.6 cm      the basic algorithm detects cosmic - rays and rejects point sources from the initial list .",
    "in addition , the program l.a.cosmic allows a lower detection threshold to be used for pixels neighbouring those already flagged as cosmic - rays .",
    "it also replaces cosmic - rays by the median of surrounding `` good '' pixels , and offers the option of applying the algorithm iteratively . on a sun ultrasparc 1 ( 200mhz )",
    "the iraf implementation of l.a.cosmic requires approximately 65s per iteration for an image of @xmath66 pixels .",
    "the run time scales linearly with the number of pixels .",
    "the algorithm was tested on a variety of real and artificial data sets , consistently producing very good results .",
    "the examples given here serve to illustrate its performance .",
    "figure [ example1.plot](a ) shows a well sampled artifical image containing 500 stars , 100 galaxies , and 227 cosmic - rays .",
    "stars have @xmath67 pixels , equivalent to , for example , fwhm@xmath68 seeing with @xmath69 pixels . all cosmic - rays are @xmath70 above the sky background .",
    "the reconstruction by l.a.cosmic is shown in ( b ) . panel ( c ) shows the input cosmic - ray image , and panel ( d ) shows the cosmic - rays found by l.a.cosmic .",
    "the program found 222 of the 227 cosmic - rays ( 98% ) .",
    "importantly , only 1 of the 500 stars ( 0.2% ) and none of the galaxies was inadvertently identified as a cosmic - ray .    for well sampled imaging data",
    "the performance is similar to median filtering methods such as qzap ( by m.  dickinson ) .",
    "sophisticated median filtering recovers close to 100% of cosmic - rays that are smaller than the filter size , but breaks down if the cosmic - ray is larger than the filter , and/or the fwhm of the psf is smaller than the filter .",
    "cosmic - rays in images obtained with wfpc2 on hst are notoriously difficult to remove , because of their large number and the undersampling of the psf .",
    "nevertheless , the algorithm described here performs very well on wfpc2 data .",
    "the method is insensitive to the size of cosmic - rays , and the undersampling of the psf can be taken into account by setting the parameter @xmath71 ( see sect .  [ sampling.sec ] ) .",
    "figure [ example2.plot](a ) shows part of a 2400s wf observation in @xmath72 of galaxy cluster ms1137 + 67 .",
    "the reconstruction of the image by l.a.cosmic is shown in ( b ) .",
    "+ virtually all cosmic - rays are removed , and none of the real objects is mistaken for a cosmic - ray .",
    "the small panels show examples of stars and galaxies in wf chips , extracted from wfpc2 observations of various targets .",
    "the algorithm leaves stars intact , and is able to remove arbitrarily large cosmic - rays .",
    "the reliability of cosmic - ray identification can be tested by comparing the results of l.a.cosmic on single images to `` true '' cosmic - ray images created from multiple exposures .",
    "the test used one of the cr ",
    "split wfpc2 images of the cluster ms205304 ( @xmath73 ) . as a result of its low galactic latitude",
    "approximately 50% of @xmath74 objects are stars .",
    "the reduction of these data is described in van dokkum et al .",
    "the algorithm found 5638 ( 98.1% ) of 5750 cosmic - ray affected pixels deviating more than @xmath41 from the background , and 4687 ( 99.1% ) of 4729 pixels deviating more than @xmath75 .",
    "the number of false positives , i.e. , pixels inadvertently marked as cosmic - rays , is 72 ( 1.2% ) at @xmath76 , and only 1 ( 0.02% ) at @xmath77 .",
    "these numbers compare favorably to cosmic - ray rejection algorithms based on morphological classification by neural networks ( salzberg et al .",
    "1995 ) .",
    "the algorithm optimized for spectroscopic long - slit data is very similar to the implementation for imaging data .",
    "the main difference is that the program offers the possibility of fitting and subtracting sky lines and the object spectrum before convolution with the laplacian kernel .",
    "an example ( an 1800s long slit spectrum of a galaxy , obtained with the low resolution imaging spectrograph on the w. m. keck telescope ) is shown in fig .",
    "[ example3.plot ] .",
    "note that the laplacian is very effective in removing the fringe pattern that is present after subtracting strong sky lines .",
    "the fine structure image @xmath50 is used to identify emission lines and other sharp features in the spectra , in similar fashion as the identification of undersampled stars in imaging data .",
    "= 16.5 cm    = 16.5 cm    = 16.5 cm",
    "cosmic - rays in single images or spectra can be removed by a variation of laplacian edge detection .",
    "the procedure is robust , and requires very few user - defined parameters .",
    "the method rejects cosmic - rays of arbitrary size and distinguishes undersampled point sources from cosmic - rays with high confidence .",
    "it is implemented in the program l.a.cosmic , which can be obtained from http://www.astro.caltech.edu/~pgd/lacosmic/ .",
    "i thank martin zwaan for his contributions in the initial phase of this study , and josh bloom for discussion and comments . the insightful comments and suggestions of the referee , james rhoads ,",
    "improved the paper .",
    "the author acknowledges support by nasa through hubble fellowship grant hf-01126.01 - 99a awarded by the space telescope science institute , which is operated by the association of universities for research in astronomy , inc .",
    ", for nasa under contract nas 5 - 26555 .",
    "croke , b. f. w. 1995 , , 107 , 1255 fixsen , d. j. , offenberg , j. d. , hanisch , r. j. , mather , j. c. , nieto - santisteban , m. a. , sengupta , r. , & stockman , h. s. 2000 , , 112 , 1350 freudling , w. 1995 , , 107 , 85 fruchter , a. s. , & hook , r. n. 1997 , in applications of digital image processing xx , a. g. tescher , ed . , spie , p. 120",
    "gonzalez , r. c. , & woods , r. e. 1992 , digital image processing ( reading , addison - wesley ) marr , d. , & hildreth , e. 1980 , proc .",
    "lond . , b207 , 187 rhoads , j. e. 2000 , , 112 , 703 salzberg , s. , chandar , r. , ford , h. , murthy , s. k. , & white , r. 1995 , , 107 , 279 van dokkum , p. g. , franx , m. , kelson , d. d. , & illingworth , g. d. 2001 , apj , 553 , l39 windhorst , r. a. , franklin , b. e. , & neuschaefer , l. w. 1994 , , 106 , 798 zhang , c. y. 1995 , in astronomical data analysis software and systems iv , asp conference series , vol .",
    "77 , r. a. shaw , h. e. payne , and j. j. e. hayes , eds ."
  ],
  "abstract_text": [
    "<S> conventional algorithms for rejecting cosmic - rays in single ccd exposures rely on the contrast between cosmic - rays and their surroundings , and may produce erroneous results if the point spread function ( psf ) is smaller than the largest cosmic - rays . </S>",
    "<S> this paper describes a robust algorithm for cosmic - ray rejection , based on a variation of laplacian edge detection . </S>",
    "<S> the algorithm identifies cosmic - rays of arbitrary shapes and sizes by the sharpness of their edges , and reliably discriminates between poorly sampled point sources and cosmic - rays . </S>",
    "<S> examples of its performance are given for spectroscopic and imaging data , including _ </S>",
    "<S> hubble space telescope </S>",
    "<S> _ wfpc2 images . </S>"
  ]
}