{
  "article_text": [
    "for an important class of multi - scale problems , a separation of scales prevails between the ( microscopic , detailed ) level of description of the available model , and the ( macroscopic , continuum ) level at which one would like to observe and analyze the system . consider , for example , a kinetic monte carlo model of bacterial growth @xcite .",
    "a stochastic model describes the probability of an individual bacterium to run or  tumble \" , based on the rotation of its flagellae . technically , it would be possible to simply evolve the detailed model and observe the macroscopic variables of interest ( e.g.  cell density ) , but this could be prohibitively expensive .",
    "it is known , however , that , under certain conditions , one could write a deterministic equation for the evolution of the macroscopic observable ( here _ bacteria concentration _ , the zeroth moment of the evolving distribution ) on macroscopic space and time scales , but it is hard to obtain an accurate closed formula explicitly .    the recently proposed _ equation - free framework _",
    "@xcite can then be used instead of stochastic time integration in the entire space - time domain .",
    "this framework is built around the central idea of a _ coarse time - stepper _ , which is a time-@xmath0 map from coarse variables to coarse variables .",
    "it consists of the following steps : ( 1 ) _ lifting _ , i.e.  the creation of _ appropriate _ initial conditions for the microscopic model ; ( 2 ) _ evolution _ , using the microscopic model and ( possibly ) some constraints ; and ( 3 ) _ restriction _ , i.e.  the projection of the detailed solution to the macroscopic observation variables .",
    "this coarse time - stepper can subsequently be used as  input \" for time - stepper based algorithms performing macroscopic numerical analysis tasks .",
    "these include , for example , time - stepper based bifurcation codes to perform bifurcation analysis for the _ unavailable _ macroscopic equation @xcite .",
    "this approach has already been used in several applications @xcite , and also allows to perform other system level tasks , such as control and optimization @xcite .    when dealing with systems that would be described by ( in our case , unavailable )",
    "_ partial _ differential equations ( pdes ) , one can also reduce the _ spatial _ complexity . for systems with one space dimension , the _ gap - tooth scheme _",
    "@xcite was proposed ; it can be generalized in several space dimensions .",
    "a number of small intervals , separated by large gaps , are introduced ; they qualitatively correspond to mesh points for a traditional , continuum solution of the unavailable equation . in higher space dimensions",
    ", these intervals would become _ boxes _ around the coarse mesh points , a term that we will also use throughout this paper .",
    "we construct a coarse time-@xmath0 map as follows .",
    "we first choose a number of macroscopic grid points .",
    "then , we choose a small interval around each grid point ; initialize the fine scale , microscopic solver within each interval consistently with the macroscopic initial condition profiles ; and provide each box with appropriate boundary conditions .",
    "subsequently , we use the microscopic model in each interval to simulate until time @xmath0 , and obtain macroscopic information ( e.g.  by computing the average density in each box ) at time @xmath0 .",
    "this amounts to a coarse time-@xmath0 map ; the procedure is then repeated .",
    "the resulting scheme has already been used with lattice - boltzmann simulations of the fitzhugh  nagumo dynamics @xcite and with particle - based simulations of the viscous burgers equation @xcite .    to increase the efficiency of time integration",
    ", one can use the gap - tooth scheme in conjuction with any method - of - lines time integration method , such as projective integration @xcite .",
    "we then perform a number of gap - tooth steps of size @xmath0 to obtain an estimate of the time derivative of the unavailable macroscopic equation .",
    "this estimate is subsequently used to perform a time step of size @xmath1 .",
    "this combination has been termed _",
    "patch dynamics _ @xcite .    in this paper",
    ", we will study the patch dynamics scheme for a model diffusion homogenization problem . here , the microscopic equation is a diffusion equation with a spatially periodic diffusion coefficient with small spatial period @xmath2 , while the macroscopic ( effective ) equation describes the averaged behaviour . in the limit of @xmath2",
    "going to zero , this effective equation is the classical homogenized equation .",
    "our goal is to approximate the effective equation by using only the microscopic equation in a set of small boxes . in @xcite",
    ", we already studied the gap - tooth scheme for periodic reaction - diffusion homogenization problems .",
    "we showed that the gap - tooth scheme approximates a finite difference scheme for the homogenized equation , when the averaged gradient is constrained at the box boundaries .",
    "however , generally , a given microscopic code only allows us to run with a set of predefined boundary conditions .",
    "it is highly non - trivial to impose macroscopically inspired boundary conditions on such microscopic codes , see e.g.  @xcite for a control - based strategy .",
    "therefore , we circumvent this problem here by introducing buffer regions at the boundary of each small box , which shield the _ short - term _ dynamics within the computational domain of interest from boundary effects .",
    "one then uses the microscopic code with its _ built - in _ boundary conditions . in this paper",
    ", we study the resulting _ gap - tooth scheme with buffers _ , which was introduced in @xcite , when used inside a patch dynamics scheme , and analyze the relation between buffer size , time step and accuracy for a model diffusion homogenization problem .",
    "the analysis in this context is important , because we can clearly show the influence of the microscopic scales on the accuracy of the solution for this model problem .",
    "however , we emphasize that the real advantage of the method lies in its applicability for non - pde microscopic simulators , e.g.  kinetic monte carlo or molecular dynamics .",
    "it is worth mentioning that many numerical schemes have been devised for the homogenization problem .",
    "hou and wu developed the multi - scale finite element method that uses special basis functions to capture the correct microscopic behaviour @xcite .",
    "schwab , matache and babuska have devised a generalized fem method based on a two - scale finite element space @xcite .",
    "runborg et al .",
    "@xcite proposed a time - stepper based method that obtains the effective behaviour through short bursts of detailed simulations appropriately averaged over many shifted initial conditions .",
    "the simulations were performed over the whole domain , but the notion of effective behaviour is identical . in their recent work ,",
    "e and engquist and collaborators address the same problem of simulating only the macroscopic behaviour of a multiscale model , see e.g.  @xcite . in what they call the heterogeneous multiscale method ,",
    "a macroscale solver is combined with an estimator for quantities that are unknown because the macroscopic equation is not available",
    ". this estimator subsequently uses appropriately constrained runs of the microscopic model @xcite .",
    "it should be clear that patch dynamics does exactly this : by taking a few gap - tooth steps , we estimate the time derivative of the unknown effective equation , and give this as input to an ode solver , such as projective integration .",
    "the difference in their work is that , for conservation laws , the macro - field time derivative is estimated from the _ flux _ of the conserved quantity ; their generalized godunov scheme is based on this principle .",
    "this paper is organized as follows . in section [ sec : problem ] , we describe the model homogenization problem . in section [ sec : dudt ] , we show how to use the gap - tooth scheme to approximate the time derivative of the unavailable macroscopic equation .",
    "we prove a consistency result and propose a simple heuristic to obtain a sufficient buffer size .",
    "we also discuss to what extent the results depend on the specific setting of our model problem . in section",
    "[ sec : patch ] , we describe the full patch dynamics algorithm and give some comments on stability . section [ sec : numeric ] contains some numerical examples which illustrate the accuracy and efficiency of the proposed method , and we conclude in section [ sec : conclusions ] .",
    "as a model problem , we consider the following parabolic partial differential equation , @xmath3\\\\ u_{\\epsilon}(x,0)=u^0(x ) \\in",
    "l^2([0,1]),\\qquad u_{\\epsilon}(0,t)=u_{\\epsilon}(1,t)=0 ,   \\end{split}\\ ] ] where @xmath4 is uniformly elliptic and periodic in @xmath5 and @xmath2 is a small parameter .",
    "we choose homogeneous dirichlet boundary conditions for simplicity .    according to classical homogenization theory @xcite , the solution to ( [ eq : model_equation ] )",
    "can be written as an asymptotic expansion in @xmath2 , @xmath6 where the functions @xmath7 , @xmath8 are periodic in @xmath5 . here , @xmath9 is the solution of the _ homogenized equation _",
    "@xmath10\\\\   u_0(x,0)=u^0(x ) \\in l^2([0,1 ] ) , \\qquad u_0(0,t)=u_0(1,t)=0 , \\end{split}\\ ] ] the coefficient @xmath11 is the constant effective coefficient , given by @xmath12 and @xmath13 is the periodic solution of @xmath14 the so - called",
    "_ cell problem_. the solution of ( [ eq : cell_problem ] ) is only defined up to an additive constant , so we impose the extra condition @xmath15 from this cell problem , we can derive @xmath16 .",
    "we note that in one space dimension , an explicit formula is known for @xmath11 , @xcite , @xmath17^{-1}.\\ ] ]    these asymptotic expansions have been rigorously justified in the classical book @xcite , see also @xcite . under the assumptions made on @xmath18 , one obtains strong convergence of @xmath19 to @xmath20 as @xmath21 in @xmath22)\\times c([0,t))$ ] .",
    "indeed , we can write @xmath23)}\\le c_0\\epsilon,\\ ] ] uniformly in @xmath24 .    it is important to note that the gradient of @xmath25 is given by @xmath26 from which it is clear that the micro - scale fluctuations have a strong effect on the local detailed gradient .",
    "using the gap - tooth scheme , we will approximate the homogenized solution @xmath9 by a local spatial average , defined as @xmath27 it can easily be seen that that @xmath28 is a good approximation to @xmath9 in the following sense .",
    "[ lem : averaging_error ] consider @xmath19 to be the solution of ( [ eq : model_equation ] ) , and @xmath20 to be the solution of the associated homogenized equation ( [ eq : hom_eq ] ) .",
    "then , assuming @xmath29 the difference between the homogenized solution @xmath9 and the averaged solution @xmath28 is bounded by @xmath30)}\\le   c_1 h^2+c_2\\epsilon^{1-p}.\\ ] ]    for a proof , we refer to ( * ? ? ?",
    "* lemma  3.1 ) .",
    "note that this error bound can be improved if we have more knowledge about the convergence of @xmath31 to @xmath32 ( e.g.  in @xmath33)$ ] ) .",
    "we devise a scheme for the evolution of the averaged behaviour @xmath28 , while making only use of the given detailed equation ( [ eq : model_equation ] ) .",
    "moreover , we assume that a time integration code for ( [ eq : model_equation ] ) has already been written and is available with a number of _ standard _ boundary conditions , such as no - flux or dirichlet .",
    "we also assume that the order @xmath34 of the unavailable macroscopic equation ( the highest spatial derivative ) is known . a strategy to obtain this information is given in @xcite .",
    "so , we know that the macroscopic equation is of the form @xmath35 where @xmath36 denotes the time derivative and @xmath37 denotes the @xmath38-th spatial derivative .      suppose we want to obtain the solution of ( [ eq : unknown ] ) on the interval @xmath39 $ ] , using an equidistant , macroscopic mesh @xmath40 . for convenience ,",
    "we define a macroscopic comparison scheme , which is a space - time discretization for ( [ eq : unknown ] ) in the assumption that this equation is known .",
    "we will denote the numerical solution of this scheme by @xmath41 . here",
    ", we choose as a comparison scheme a forward euler / spatial finite difference scheme , which is defined by @xmath42 where @xmath43 denotes a suitable finite difference approximation for the @xmath38-th spatial derivative .",
    "since equation ( [ eq : unknown ] ) is not known explicitly , we construct a gap - tooth scheme to approximate the comparison scheme ( [ eq : comparison ] ) .",
    "we denote the solution of the gap - tooth scheme by @xmath44 .",
    "the gap - tooth scheme is now constructed as follows .",
    "consider a small interval ( box , _ tooth _ ) of length @xmath45 around each mesh point , as well as a larger _ buffer _ interval of size @xmath46 .",
    "( see figure [ fig : gaptooth_buffers ] . )",
    "we will perform a time integration using the microscopic model ( [ eq : model_equation ] ) in each box of size @xmath47 , and we provide this simulation with the following initial and boundary conditions .    a schematic representation of the gap - tooth scheme with buffer boxes .",
    "we choose a number of boxes of size @xmath45 around each macroscopic mesh point @xmath48 and define a local taylor approximation as initial condition in each box .",
    "simulation is performed inside the larger ( buffer ) boxes of size @xmath47 , where some boundary conditions are imposed . ]",
    "[ [ initial - condition ] ] initial condition + + + + + + + + + + + + + + + + +    we define the initial condition by constructing a local taylor expansion , based on the ( given ) box averages @xmath49 , @xmath50 , at mesh point @xmath48 and time @xmath51 , @xmath52,\\ ] ] where @xmath34 is the order of the macroscopic equation .",
    "the coefficients @xmath53 , @xmath54 are the same finite difference approximations for the @xmath38-th spatial derivative that would be used in the comparison scheme ( [ eq : comparison ] ) , whereas @xmath55 is chosen such that @xmath56 for example , when @xmath57 , and using standard ( second - order ) central differences , we have @xmath58 the resulting initial condition was used in @xcite , where it was derived as an interpolating polynomial for the box averages .    [ [ boundary - conditions ] ] boundary conditions + + + + + + + + + + + + + + + + + + +    the time integration of the microscopic model in each box should provide information on the evolution of the _ global _ problem at that location in space .",
    "it is therefore crucial that the boundary conditions are chosen such that the solution inside each box evolves _ as if it were embedded in the larger domain_. we already mentioned that , in many cases , it is not possible or convenient to impose macroscopically - inspired constraints on the microscopic model ( e.g.  as boundary conditions ) .",
    "however , we can introduce a larger box of size @xmath46 around each macroscopic mesh point , but still only use ( for macro - purposes ) the evolution over the smaller , inner box .",
    "the simulation can subsequently be performed using any of the _ built - in _ boundary conditions of the microscopic code . lifting and ( short - term ) evolution ( using _ arbitrary _ available boundary conditions )",
    "are performed in the larger box ; yet the restriction is done by processing the solution ( here taking its average ) over the inner , small box only .",
    "the goal of the additional computational domains , the _ buffers _ , is to buffer the solution inside the small box from the artificial disturbance caused by the ( repeatedly updated ) boundary conditions .",
    "this can be accomplished over _ short enough _ time intervals , provided the buffers are _ large enough _ ; analyzing the method is tantamount to making these statements quantitative .",
    "the idea of a buffer region was also introduced in the multiscale finite element method of hou ( oversampling ) @xcite to eliminate boundary layer effects ; also hadjiconstantinou makes use of overlap regions to couple a particle method with a continuum code @xcite .",
    "if the microscopic code allows a choice of different types of microscopic boundary conditions , selecting the size of the buffer may also depend on this choice .",
    "[ [ the - algorithm ] ] the algorithm + + + + + + + + + + + + +    the complete gap - tooth algorithm to proceed from @xmath51 to @xmath59 is given below :    1 .",
    "* lifting * at time @xmath51 , construct the initial condition @xmath60 , @xmath50 using the box averages @xmath49 , as defined in ( [ eq : local_taylor ] ) .",
    "* simulation * compute the box solution @xmath61 , @xmath62 , by solving equation ( [ eq : model_equation ] ) in the interval @xmath63 $ ] with _ some _ boundary conditions up to time @xmath64 .",
    "the boundary conditions can be anything that the microscopic code allows .",
    "* restriction * compute the average @xmath65 over the _",
    "inner , small box only_.    it is clear that this procedure amounts to a map of the macroscopic variables @xmath66 at time @xmath51 to the macroscopic variables at time @xmath67 , i.e.  a  coarse to coarse \" time @xmath0-map .",
    "we write this map as follows , @xmath68 where we introduced the time derivative estimator @xmath69 the superscript @xmath34 denotes the highest spatial derivative that has been prescribed by the initialization scheme ( [ eq : local_taylor ] ) .",
    "the accuracy of this estimate depends on the buffer size @xmath47 , the box size @xmath45 and the time step @xmath0 .      to analyze convergence , we solve the detailed problem approximately in each box .",
    "because @xmath70 , we can resort to the homogenized solution , and bound the error using equation ( [ eq : strong_conv ] ) .",
    "it is important to note that we use the homogenized equation for analysis purposes only .",
    "the algorithm uses box averages of solutions of the detailed problem ( [ eq : model_equation ] ) , so it does not exploit more knowledge of the homogenized equation than the order @xmath34 .",
    "we choose to study convergence in the case of dirichlet boundary conditions , but we will show numerically that the results do not depend crucially on the type of boundary conditions .",
    "we first relate the gap - tooth time - stepper as constructed in section [ subsec : gap - tooth ] to a gap - tooth time - stepper in which the microscopic equation has been replaced by the homogenized equation .",
    "[ lem : equivalent_box_problem ] consider the model equation , @xmath71 where @xmath4 is periodic in @xmath5 and @xmath72 , with initial condition @xmath73 and dirichlet boundary conditions @xmath74 for @xmath75 , this problem converges to the homogenized problem @xmath76 with initial condition @xmath77 and dirichlet boundary conditions @xmath78 and",
    "the solution of ( [ eq : model_eq_repeated])-([eq : bc_r ] ) converges pointwise to the solution of ( [ eq : h_r])-([eq : h_bc_r ] ) , with the following error estimate @xmath79)}\\le c_3\\epsilon.\\ ] ]    this is a standard result , whose proof can be found in e.g.  @xcite .",
    "we now define two gap - tooth time - steppers .",
    "let @xmath80 be a gap - tooth time - stepper that uses the detailed , homogenization problem ( [ eq : model_eq_repeated])-([eq : bc_r ] ) inside each box , and @xmath81 be a gap - tooth time - stepper where the homogenization problem for each box has been replaced by the homogenized equation ( [ eq : h_r])-([eq : h_bc_r ] ) .",
    "the box initialization is done using a quadratic polynomial as defined in ( [ eq : specific_initial ] )",
    ".    we can apply ( * ? ? ?",
    "* lemma  4.2 ) to bound the difference between @xmath82 and @xmath83 .",
    "consider @xmath84 and @xmath85 as defined in ( [ eq : gaptooth_detailed ] ) and ( [ eq : gaptooth_homogenized ] ) , respectively .",
    "assuming @xmath86 , @xmath87 , @xmath88 , @xmath89 , we have @xmath90 and therefore @xmath91    again , note that the error estimate can be made sharper if additional knowledge of the convergence of @xmath31 to @xmath32 is available .",
    "it can easily be checked that the averaged solution @xmath28 also satisfies the diffusion equation ( [ eq : h_r ] ) .",
    "therefore , we define the comparison scheme ( [ eq : comparison ] ) for the model problem as @xmath92.\\label{eq : comparison_hom } \\end{aligned}\\ ] ]    the following theorem compares the gap - tooth time derivative estimator @xmath93 with the finite difference time derivative used in ( [ eq : comparison_hom ] ) .",
    "[ thm : diff_wrt_fd ] consider the gap - tooth time - stepper for the homogenized equation , as defined by ( [ eq : gaptooth_homogenized ] ) , and the corresponding comparison scheme ( [ eq : comparison_hom ] ) . assuming @xmath94 , and defining the error @xmath95 we have the following result for @xmath96 , @xmath97 , @xmath98    first",
    ", we solve the equation ( [ eq : h_r])-([eq : h_bc_r ] ) analytically inside each box , with initial condition given by ( [ eq : local_taylor ] ) .",
    "using the technique of separation of variables , we obtain @xmath99 where @xmath100 this can be simplified to @xmath101 which yields the following solution , @xmath102 when taking the average over a box of size @xmath45 , we obtain , @xmath103 with @xmath104 determined by @xmath105 the coefficients @xmath104 tend to @xmath106 in absolute value as @xmath107 . to obtain the time derivative estimate @xmath108",
    ", we proceed as follows : @xmath109 where we introduced @xmath110 .",
    "it can easily be checked ( e.g.  using maple ) that @xmath111 which already shows that the gap - tooth scheme is consistent in this limit .",
    "obtaining an error bound in terms of @xmath112 is somewhat more involved .",
    "we split @xmath113 as follows , @xmath114 with @xmath115 and @xmath116 defined as @xmath117 we now show that @xmath118 approaches the correct estimate exponentially .",
    "some algebraic manipulation results in @xmath119 therefore , we have @xmath120 @xmath121 it remains to show the asymptotic behaviour of @xmath116 .",
    "@xmath122 @xmath123 the combination of ( [ eq : proof_first ] ) and ( [ eq : proof_second ] ) proves the theorem .",
    "the error bound ( [ eq : error_bound ] ) clearly shows an exponential decay of the error as a function of @xmath124 when the microscopic problem is replaced by the effective equation .",
    "the restriction ( here performed by taking the box average ) also affects the accuracy of the estimate .",
    "ideally , one would just use the effective function value at @xmath125 inside each box ( this corresponds to @xmath126 ) , but when microscopic scales are present , this value is generally impossible to obtain .",
    "we illustrate this result numerically .",
    "consider the model problem ( [ eq : h_r ] ) with @xmath127 as a microscopic problem on the domain @xmath39 $ ] with homogeneous dirichlet boundary conditions and initial condition @xmath128 . to solve this microscopic problem",
    ", we use a second order finite difference discretization with mesh width @xmath129 and ` lsode ` as time - stepper .",
    "the concrete gap - tooth scheme for this example is defined by the initialization ( [ eq : specific_initial ] ) .",
    "we compare a gap - tooth step with @xmath130 and @xmath131 with the reference estimator @xmath132 .",
    "figure [ fig : error_estimate_ex3.4 ] shows the error with respect to the finite difference time derivative as a function of @xmath47 ( left ) and @xmath0 ( right ) .",
    "it is clear the convergence is in agreement with theorem [ thm : diff_wrt_fd ] .",
    "the stagnation for large buffer sizes is due to the finite accuracy of the microscopic solver .",
    "we are now ready to state the general consistency result .",
    "[ thm : consistency ] let @xmath133 be a gap - tooth time - stepper for the homogenization problem ( [ eq : model_eq_repeated])-([eq : bc_r ] ) , as defined in ( [ eq : gaptooth_detailed ] ) , and @xmath134 a comparison finite difference scheme as defined in ( [ eq : comparison_hom ] ) .",
    "then , assuming @xmath135 , we have , @xmath136    this simply follows by combining theorem [ thm : diff_wrt_fd ] with lemma [ lem : equivalent_box_problem ] .",
    "formula ( [ eq : consistency ] ) shows the main consistency properties of the gap - tooth estimator .",
    "the error decays exponentially as a function of buffer size , but the optimal accuracy of the estimator is limited by the presence of the microscopic scales .",
    "therefore , we need to make a trade - off to determine an optimal choice for @xmath47 and @xmath0 .",
    "the smaller @xmath0 , the smaller @xmath47 can be to reach optimal accuracy ( and thus the smaller the compational cost ) , but smaller @xmath0 implies a larger optimal error .",
    "this is illustrated in the following numerical example .",
    "[ ex:3.6 ] consider the model problem ( [ eq : model_eq_repeated ] ) with @xmath137 as a microscopic problem on the domain @xmath39 $ ] with homogeneous dirichlet boundary conditions and initial condition @xmath128 .",
    "this diffusion coefficient has also been used as a model example in @xcite . to solve this microscopic problem",
    ", we use a second order finite difference discretization with mesh width @xmath138 and ` lsode ` as time - stepper .",
    "the concrete gap - tooth scheme for this example is defined by the initialization ( [ eq : specific_initial ] ) .",
    "we compare a gap - tooth step with @xmath139 and @xmath131 with the reference estimator @xmath140 , in which the effective diffusion coefficient is known to be @xmath127 .",
    "figure [ fig : error_estimate_ex3.6 ] shows the error with respect to the finite difference time derivative as a function of @xmath47 ( left ) and @xmath0 ( right ) .",
    "it is clear that the convergence is in agreement with theorem [ thm : consistency ] .",
    "we see that smaller values of @xmath0 result in larger values for the optimal error , but the convergence towards this optimal error is faster .",
    "when performing time integration using patch dynamics , one must determine a macroscopic mesh width @xmath141 , an inner box size @xmath45 , a buffer box size @xmath47 and a time step @xmath0 .",
    "these method parameters need to be chosen adequately to ensure an accurate result .",
    "since the gap - tooth estimator approximates the time derivative that would be obtained through a method - of - lines discretization of the macroscopic equation , the macroscopic mesh width @xmath141 can be determined by macroscopic properties of the solution only , enabling reuse of existing remeshing techniques for pdes .",
    "the box width @xmath45 has to be sufficiently large to capture all small scale effects , but small enough to ensure a good spatial resolution . here",
    ", we just choose @xmath70 .",
    "in our simplified setting , where the microscopic model is also a partial differential equation , we are free to choose @xmath0 , which allows us to illustrate the convergence properties of the method . however , in practical problems , the choice of @xmath0 will be problem - dependent , since it will need to be chosen large enough to deduce reliable information on the macroscopic time derivative .",
    "therefore , we focus on determining the buffer width @xmath47 , assuming that all other parameters have already been fixed . from theorem [ thm :",
    "consistency ] , it follows that the desired value of @xmath47 depends on the effective diffusion coefficient @xmath11 , which is unknown .",
    "we thus need to resort to a heuristic .",
    "consider the model problem ( [ eq : model_eq_repeated])-([eq : bc_r ] ) inside one box , centered around @xmath142 , with @xmath143 , with initial condition @xmath144 .",
    "the diffusion coefficient is given by ( [ eq : diff_coeff ] ) , see example [ ex:3.6 ] .",
    "denote the solution of this problem by @xmath145 , and define @xmath146 with @xmath139 and @xmath147 $ ] .",
    "figure [ fig : f_avg_ifv_t ] ( left ) shows @xmath148 for a number of values of @xmath24 .",
    "we clearly see how the error in the estimator propagates inwards from the boundaries .",
    "the same function is plotted on the right , only now the microscopic model is the reaction - diffusion equation @xmath149 again with @xmath18 defined as in ( [ eq : diff_coeff ] ) . in the presence of reaction terms",
    ", @xmath148 is no longer constant in the internal region .",
    "based on these observations , we propose the following test for the quality of the buffer size , @xmath150 figure [ fig : test_heuristic ] shows this heuristic , together with the error , as a function of @xmath47 for @xmath151 and @xmath152 .",
    "error of the gap - tooth estimator ( dashed ) and heuristic error estimate ( solid ) as a function of buffer size for the model equation ( [ eq : model_eq_repeated ] ) with diffusion coefficient ( [ eq : diff_coeff ] ) for @xmath151 and @xmath152 . ]",
    "it is clear that the computed quantity in ( [ eq : heuristic ] ) is proportional to the error for sufficiently large @xmath47 .",
    "however , this heuristic is far from perfect , since the simulations inside each box can converge to a steady state due to the dirichlet boundary conditions .",
    "if this steady state is reached in a time interval smaller than @xmath0 , equation ( [ eq : heuristic ] ) will underestimate the error , resulting in an insufficient buffer size @xmath47 getting accepted .",
    "however , as soon as the problem - dependent parameters @xmath153 and ` tr ` have been determined , this heuristic can be used during the simulation to check whether the currently used buffer size is still sufficient .",
    "[ [ other - boundary - conditions ] ] other boundary conditions + + + + + + + + + + + + + + + + + + + + + + + + +    in section [ subsec : consistency ] , we studied the convergence of the gap - tooth estimator both analytically and numerically in the case of dirichlet boundary conditions .",
    "we will now show numerically that the results obtained in that section do not depend crucially on the type of boundary conditions .",
    "consider again the diffusion problem ( [ eq : model_eq_repeated ] ) , with the diffusion coefficient defined as in ( [ eq : diff_coeff ] ) , see also example [ ex:3.6 ] .",
    "we construct the gap - tooth time derivative estimator @xmath154 as outlined in section [ subsec : gap - tooth ] , but now we use no - flux instead of dirichlet boundary conditions . in each box , we then solve the following problem , @xmath155 the concrete gap - tooth scheme that is used , as well as the corresponding finite difference comparison scheme , are defined by the initialization ( [ eq : specific_initial ] ) .",
    "figure [ fig : err_ifv_buffers_noflux ] shows the error with respect to the finite difference time derivative @xmath156 .",
    "we see qualitatively the same behaviour as for dirichlet boundary conditions .",
    "in general , the choice of boundary conditions might influence the required buffer size . in the ideal case , where the boundary conditions are chosen to correctly mimic the behaviour in the full domain",
    ", we can choose @xmath157 .",
    "then there is no buffer and the computational complexity is , in some sense , optimal . for reaction - diffusion homogenization problems ,",
    "this can be achieved by constraining the averaged gradient around each box edge @xcite . in situations",
    "where the correct boundary conditions are not known , or prove impossible to implement , one is forced to resort to the use of buffers .    [ [ microscopic - simulators ] ] microscopic simulators + + + + + + + + + + + + + + + + + + + + + +    it is possible that the microscopic model is not a partial differential equation , but some microscopic simulator , e.g.  kinetic monte carlo or molecular dynamics code .",
    "in fact , this is the case where we expect our method to be most useful . in this case , the _ lifting _ step , i.e.  the construction of box initial conditions , becomes more involved . in general",
    ", the microscopic model will have many more degrees of freedom , the _ higher order moments _ of the evolving distribution .",
    "these will quickly become slaved to the governing moments ( the ones where the lifting is conditioned upon ) , see e.g.  @xcite .",
    "the crucial assumption in theorem [ thm : consistency ] is that the solution in each box evolves according to the macroscopic equation . for a microscopic simulation",
    ", this will usually mean that we need to construct an initial condition in which , for example , a number of higher order moments are already slaved to the governing moments ( so - called _ mature _ initial conditions ) .",
    "to this end , it is possible to perform a constrained simulation before initialization to create such _ mature _ initial conditions @xcite .",
    "if this is not done , the resulting evolution may be far from what is expected , see @xcite for an illustration in the case of a lattice - boltzmann model .",
    "once a good gap - tooth time derivative estimator has been constructed , it can be used as a method - of - lines spatial discretization in conjunction with any time integration scheme . consider for concreteness the forward euler scheme for ( [ eq : unknown ] ) , given by @xmath158 where @xmath159 is defined as in ( [ eq : der_est ] ) .",
    "theorem [ thm : consistency ] establishes the consistency of the gap - tooth estimator . in order to obtain convergence",
    ", we also need to prove stability . for this purpose",
    ", we define the class @xmath160 of discrete functions with bounded divided differences up to order @xmath34 on the numerical grid @xmath161 , @xmath162 ; @xmath163 , @xmath164 , as @xmath165 where @xmath34 is the highest spatial derivative present in equation ( [ eq : unknown ] ) , @xmath166 is the finite difference operator of order @xmath153 on a mesh of width @xmath141 , and @xmath167 is independent of @xmath168 and @xmath141 .",
    "we can then make use of ( * ? ? ?",
    "* theorem  5.5 ) to state the following result .",
    "( see also ( * ? ? ?",
    "* theorem  4.5 ) in the case of constrained gradient boundary conditions . )",
    "consider the patch dynamics scheme ( [ eq : fe_patch ] ) and the corresponding finite difference comparison scheme ( [ eq : fe_comparison ] ) .",
    "assume that @xmath169 , @xmath170 , @xmath171 , @xmath172 and the comparison scheme ( [ eq : fe_comparison ] ) is stable , then we have @xmath173 in the limit where @xmath174    thus the patch dynamics scheme is stable if the finite difference comparison scheme is stable .",
    "we note that , although this result is very general , its applicability is limited due to the assumption that @xmath175 , which has to be checked separately .",
    "therefore , this result does not prevent the patch dynamics scheme to become unstable , due to e.g.  an insufficient buffer size @xmath47 . however , we can study the stability of the patch dynamics scheme numerically by computing the eigenvalues of the time derivative estimator as a function of @xmath47 .",
    "consider the homogenization diffusion equation ( [ eq : model_eq_repeated ] ) with the diffusion coefficient @xmath18 given by ( [ eq : diff_coeff ] ) .",
    "the homogenized equation is given by ( [ eq : h_r ] ) with @xmath127 .",
    "in this case , the time derivative operator @xmath176 in the comparison scheme ( [ eq : fe_comparison ] ) has eigenvalues @xmath177 which , using the forward euler scheme as time - stepper , results in the stability condition @xmath178 it can easily be checked that the operator @xmath179 is linear , so we can interpret the evaluation of @xmath154 as a matrix - vector product .",
    "we can therefore use any matrix - free linear algebra technique to compute the eigenvalues of @xmath154 , e.g.  arnoldi . we choose to compute @xmath154 and @xmath176 on the domain @xmath39",
    "$ ] with dirichlet boundary conditions , on a mesh of width @xmath180 and with an inner box width of @xmath130 .",
    "we choose @xmath181 and compute the eigenvalues of @xmath154 as a function of @xmath47 .",
    "the results are shown in figure [ fig : spectrum_ifv_h ] .",
    "spectrum of the estimator @xmath154 ( dashed ) for the model equation ( [ eq : model_eq_repeated ] ) with diffusion coefficient ( [ eq : diff_coeff ] ) for @xmath182 and @xmath183 , and the eigenvalues ( [ eq : ref_eigvals ] ) of @xmath176 ( solid ) . ]",
    "two conclusions are apparent : since the most negative eigenvalue for @xmath154 is always smaller in absolute value than the corresponding eigenvalue of @xmath176 the patch dynamics scheme is always stable if the comparison scheme is stable .",
    "moreover , we see that , with increasing buffer size @xmath47 , the eigenvalues of @xmath154 approximate those of @xmath176 , which is an indication of consistency .",
    "we will consider two example systems to illustrate the method .",
    "the first example is a system of two coupled reaction - diffusion equations , which models co oxidation on a heterogeneous catalytic surface . due to the reaction term ,",
    "the proof of theorem [ thm : consistency ] is strictly speaking not valid , but nevertheless the conclusions are the same .",
    "the second example is the kuramoto ",
    "sivashinsky equation .",
    "this fourth - order non - linear parabolic equation is widely used e.g.  in combustion modeling .",
    "the patch dynamics scheme with buffers also works in this case , showing the more general applicability of the method .",
    "all computations were performed in python , making use of the scipy package @xcite for scientific computing .",
    "consider the following system of two coupled reaction - diffusion equations , @xmath184 with @xmath185 this equation models the spatiotemporal dynamics of co oxidation on microstructured catalysts , which consist of , say , alternating stripes of two different catalysts , such as platinum , pt , and palladium , pd , or platinum and rhodium , rh @xcite .",
    "the goal is to improve the average reactivity or selectivity by combining the catalytic activities of the different metals , which are coupled through surface diffusion . in the above model",
    ", @xmath186 corresponds to the surface concentration of co , @xmath187 is a so - called surface reconstruction variable and @xmath188 is an experimentally fitted sigmoidal function .",
    "details can be found in @xcite .    in this model @xmath189 and @xmath190 and the time - scale ratio parameter @xmath191",
    "are physical parameters that incorporate the experimental conditions : partial pressures of o@xmath192 and co in the gas phase , temperature , as well as kinetic constants for the surface . here",
    ", we will study a domain of length @xmath193 with a periodically varying medium : a striped surface that can be thought of as consisting of equal amounts of pt and rh , with stripe width @xmath194 .",
    "the medium is then defined by @xmath195 this particular choice of parameters is taken from @xcite , where an effective bifurcation analysis for this model was presented . for these parameter values ,",
    "the effective equation ( given by ( [ eq : co_eq])-([eq : co_nonlin ] ) with @xmath196 supports travelling waves .",
    "it was shown in @xcite that this conclusion remains true for the given heterogeneity .",
    "this was done by computing the effective behaviour as the average of a large number of spatially shifted realization of the wave . here , using the gap - tooth scheme , the solution is spatially averaged inside each box , but the notion of effective behaviour is identical .",
    "we choose the small scale parameter @xmath197 .",
    "the macroscopic comparison scheme for the effective equation ( [ eq : co_eq]-[eq : co_nonlin])-([eq : co_hpar ] ) is defined as a standard second order central difference discretization in space on a macroscopic mesh of width @xmath198 , combined with a forward euler time - stepper .",
    "the time - step is chosen as @xmath199 , which ensures stability .",
    "the patch dynamics scheme for the detailed equation ( [ eq : co_eq]-[eq : co_par ] ) is then obtained by using a gap - tooth estimator for the time derivative using the initialization ( [ eq : specific_initial ] ) with the same forward euler time - stepper .",
    "[ [ accuracy ] ] accuracy + + + + + + + +    we perform a numerical simulation for this model on the domain @xmath200 $ ] using the patch dynamics scheme .",
    "the gap - tooth parameters are given by @xmath201 , @xmath202 and @xmath203 .",
    "inside each box , we used a finite difference approximation in space , with mesh width @xmath204 and ` lsode ` as time - stepper .",
    "the initial condition is given by @xmath205\\\\ 0 , &   \\text{else } \\end{cases }   \\end{aligned } \\qquad   \\begin{aligned }   w(x,0)&= &   \\begin{cases}0.5 - 0.05 x , & x \\le 8,\\\\ 0.07 x -0.46 , & 8<x\\le 18,\\\\ -0.1 x + 2.6 , & x > 18 . \\end{cases }   \\end{aligned}\\ ] ] the results are shown in figure [ fig : co_reaction_results ] .",
    "we clearly see both the initial transient and the final travelling wave solution . for comparison purposes ,",
    "the same computation was performed using the finite difference comparison scheme for the effective equation .",
    "we also computed an `` exact '' solution for the effective equation using a much finer grid ( @xmath206 and @xmath207 .",
    "figure [ fig : co_reaction_errors ] shows the errors of the patch dynamics simulation with respect to the finite difference simulation of the effective equation and the `` exact '' solution , respectively .",
    "we clearly see that the patch dynamics scheme is a very good approximation of the finite difference scheme , and the error with respect to the exact solution is dominated by the error of the finite difference scheme .",
    "error of a patch dynamics simulation for equation ( [ eq : co_eq]-[eq : co_par ] ) with respect to the  exact \" solution of the effective equation ( top ) and a finite difference comparison scheme ( bottom ) .",
    "the error is dominated by the error of the finite difference scheme . ]",
    "[ [ efficiency ] ] efficiency + + + + + + + + + +    time integration using the patch dynamics scheme is more efficient than a complete simulation using the microscopic model , since the microscopic model is used only in small portions of the space - time domain ( the patches ) . an obvious ( but not always correct ) way to study",
    "the efficiency is to compare the size of the total space - time domain with the size of the patches . in this example , the simulations are only performed in 6% of the spatial domain .",
    "of course , when it is possible to apply physically correct boundary conditions around the inner box , the buffer boxes are not necessary , and the boxes would only cover 0.2 % of the space domain . for reaction - diffusion homogenization problems , we showed that buffer boxes are not required when we constrain the average gradient at the box boundary @xcite . the gain in the spatial dimension",
    "is determined by the separation in spatial scales .",
    "it can be large when the macroscopic solution is smooth ( few macroscopic mesh points are needed ) and propagation of boundary artefacts is slow ( small buffer box is sufficient ) .",
    "note that in higher spatial dimensions , this gain can be even more spectacular .",
    "the gain in the temporal dimension can be determined similarly . in the example of section [ sec:5.1 ] ,",
    "the gap - tooth step was chosen as @xmath208 , whereas for macroscopic time integration , the forward euler scheme was used with @xmath199 . therefore , in the temporal dimension , we gain a factor of @xmath209 . in more realistic applications , when the microscopic model is not a partial differential equation , we expect this gain to be smaller , since additional computational effort will be required to remove the errors that were introduced during the lifting step , e.g. in the form of constrained simulation @xcite .",
    "consider the kuramoto ",
    "sivashinsky equation @xmath210,\\ ] ] with periodic boundary conditions .",
    "this equation is frequently used in the modelling of combustion and thin film flow . for the parameter value @xmath211",
    ", it has been shown that the equation supports travelling wave solutions , see e.g.  @xcite .",
    "for the purpose of this example , both the microscopic and the macroscopic model are given by ( [ eq : kur ] ) .    to obtain the macroscopic comparison scheme , we discretize the second and fourth order spatial derivatives using second order central differences , on a macroscopic mesh of width @xmath212 , combined with a forward euler time integrator with time - step @xmath213 . this small macroscopic time - step arises due to the stiffness of the effective equation .",
    "we can accelerate time - stepping by wrapping a so - called _ projective integration method _ around the forward euler scheme @xcite .",
    "this scheme works as follows .",
    "first , we perform a number of forward euler steps , @xmath214 here , @xmath215 . the parameters @xmath38 and @xmath216 determine the stability region of the resulting time - stepper .",
    "an analysis of these methods is given in @xcite .",
    "it can be checked that , for this equation , choosing @xmath217 and @xmath218 results in a stable time - stepping scheme .",
    "the patch dynamics scheme is constructed by replacing the time derivative @xmath219 by a gap - tooth estimator @xmath220 , obtained by the initialization ( [ eq : local_taylor ] ) , where we choose the order of the taylor expansion to be @xmath221 .",
    "the coefficients @xmath222 , @xmath54 are determined by the macroscopic comparison scheme . inside each box ,",
    "equation ( [ eq : kur ] ) is solved , on a mesh of width @xmath223 , subject to dirichlet and no - flux boundary conditions , using ` lsode ` as time - stepper .",
    "we fixed the box width @xmath224 .",
    "[ [ consistency - and - efficiency ] ]   consistency and efficiency + + + + + + + + + + + + + + + + + + + + + + + + + + + +    because of the fourth order term , theorem [ thm : consistency ] is not proven .",
    "therefore , we numerically check the consistency of the estimator , by computing the gap - tooth estimator @xmath225 as a function of @xmath47 for a range of values for @xmath0 , and comparing the resulting estimate with the time derivative of the comparison scheme . as an initial condition",
    ", we choose @xmath226 .",
    "the results are shown in figure [ fig : cons_kur ] ( left ) .",
    "we see qualitatively the same behaviour as in section [ subsec : consistency ] for diffusion problems .",
    "there are two main differences .",
    "first , in this case the convergence is no longer monotonic , which explains the sharp peaks in the error curves .",
    "also , because boundary artefacts travel inwards much faster , the gain will be much smaller .",
    "indeed , the figure suggests that a good compromise between accuracy and efficiency would be to choose @xmath227 and @xmath228 .",
    "the reason for this behaviour is that the macroscopic equation contains reasonably fast time scales .",
    "note that this is also the reason why the finite difference comparison scheme is forced to take small time - steps .    for this choice of the parameters ,",
    "the computations have to be performed in 60% of the spatial domain .",
    "however , for a forward euler step , we only need to simulate in 1/25000 of the time - domain .",
    "using the projective integration scheme therefore gives us a total gain factor of about 80000 in time .",
    "again , we note that in real applications , this spectacular gain will partly be compensated by the additional computational effort that is required to create appropriate initial conditions .",
    "we can draw two main conclusions .",
    "the scheme allows to simulate higher order macroscopic equations , and the gain in the space domain is heavily dependent on the separation of scales in the macroscopic equation .",
    "[ [ accuracy-1 ] ] accuracy + + + + + + + +    we perform a numerical simulation for this model on the domain @xmath229 $ ] using the patch dynamics scheme . the gap - tooth parameters are given by @xmath224 , @xmath228 and @xmath230 . inside each box , we used a finite difference approximation in space , with mesh width @xmath231 and ` lsode ` as time - stepper .",
    "the initial condition is given by @xmath232,\\\\   -1 + 5(x-0.8\\pi ) , & x\\in [ 0.8\\pi,1.5\\pi ] , \\\\   2.5 - 7(x-1.5\\pi ) , & x\\in [ 1.5\\pi,2\\pi ] , \\end{cases}\\ ] ] the results are shown in figure [ fig : kur_reaction_results ] .",
    "we clearly see both the initial transient and the final travelling wave solution . for comparison purposes ,",
    "the same computation was performed using the finite difference comparison scheme for the effective equation .",
    "figure [ fig : kur_reaction_errors ] shows the errors of the patch dynamics simulation with respect to the finite difference simulation .",
    "we see that during the transient phase the error oscillates somewhat , but once the travelling wave is steady the error increases linearly , due to a difference in the approximated propagation speed .",
    "note that the error is significantly larger than for example 5.1 , due to the fact that the estimator is less accurate , but also because the macroscopic time - step is much smaller , resulting in a larger number of estimations .",
    "error of a patch dynamics simulation for equation ( [ eq : kur ] ) with respect to the a finite difference comparison scheme for the effective equation .",
    "we see that this error grows monotonic once the travelling wave has been reached , due to a slight difference in propagation speed . ]",
    "we described the patch dynamics scheme for multi - scale problems .",
    "this scheme approximates an unavailable _ effective _ equation over macroscopic time and length scales , when only a microscopic evolution law is given ; it only uses appropriately initialized simulations of the microscopic model over small subsets ( patches ) of the space - time domain .",
    "because it is often not possible to impose macroscopically inspired boundary conditions on a microscopic simulation , we propose to use buffer regions around the patches , which temporarily shield the internal region of the patches from boundary artefacts .",
    "we analytically derived an error estimate for a model homogenization problem with dirichlet boundary conditions .",
    "the numerical results show that the algorithm is more widely applicable .",
    "we showed the scheme is capable of giving good approximations for reaction - diffusion systems , as well as for fourth order pdes , such as the kuramoto ",
    "sivashinsky equation . as such",
    ", these results are far more general than those of @xcite , which are restricted to reaction - diffusion problems due to the special choice of boundary conditions .",
    "we emphasize that , although analyzed for homogenization problems , the real advantage for the methods presented here lies in their applicability for microscopic models that are not pdes , such as kinetic monte carlo , or molecular dynamics .",
    "experiments in this direction are currently being pursued actively .",
    "giovanni samaey is a research assistant of the fund for scientific research - flanders .",
    "this work has been partially supported by grant iuap / v/22 and by the fund of scientific research through research project g.0130.03 ( gs , dr ) , and an nsf / itr grant and afosr dynamics and control , dr . s. heise ( igk ) .                    c.w .",
    "gear and i.g .",
    "projective methods for stiff differential equations : problems with gaps in their eigenvalue spectrum . , 24(4):10911106 , 2003 . can be obtained as nec report 2001 - 029 , ` http://www.neci.nj.nec.com/homepages/cwg/projective.pdf ` .",
    "g.  hummer and i.g . kevrekidis .",
    "coarse molecular dynamics of a peptide fragment : free energy , kinetics and long - time dynamics computations .",
    ", 118(23):1076210773 , 2003 .",
    "can be obtained as physics/0212108 at arxiv.org .",
    "i.g . kevrekidis .",
    "coarse bifurcation studies of alternative microscopic / hybrid simulators . plenary lecture , cast division , aiche annual meeting , los angeles , 2000 .",
    "slides can be obtained from ` http://arnold.princeton.edu/~yannis/ ` .",
    "kevrekidis , c.w .",
    "gear , j.m .",
    "hyman , p.g .",
    "kevrekidis , o.  runborg , and c.  theodoropoulos .",
    "equation - free multiscale computation : enabling microscopic simulators to perform system - level tasks .",
    ", 1(4):715762 , 2003 .",
    "makeev , d.  maroudas , a.z .",
    "panagiotopoulos , and i.g . kevrekidis .",
    "coarse bifurcation analysis of kinetic monte carlo simulations : a lattice - gas model with lateral interactions .",
    ", 117(18):82298240 , 2002 .",
    "g.  samaey , i.g .",
    "kevrekidis , and d.  roose . damping factors for the gap - tooth scheme . in s.",
    "attinger and p.  koumoutsakos , editors , _ multiscale modelling and simulation _ , volume  36 of _ lecture notes in computational science and engineering _ , pages 93102 .",
    "springer , 2004 .",
    "siettos , a.  armaou , a.g .",
    "makeev , and i.g .",
    "microscopic / stochastic timesteppers and coarse control : a kinetic monte carlo example .",
    ", 49(7):19221926 , 2003 .",
    "can be obtained as nlin.cg/0207017 at arxiv.org .",
    "siettos , m.d .",
    "graham , and i.g . kevrekidis .",
    "coarse brownian dynamics for nematic liquid crystals : bifurcation , projective integration and control via stochastic simulation . , 118(22):1014910157 , 2003 . can be obtained as cond - mat/0211455 at arxiv.org .      c.  theodoropoulos , k.  sankaranarayanan , s.  sundaresan , and i.g .",
    "coarse bifurcation studies of bubble flow lattice - boltzmann simulations . , 59:23572362 , 2003 . can be obtained as nlin.ps/0111040 from arxiv.org ."
  ],
  "abstract_text": [
    "<S> an important class of problems exhibits smooth behaviour on macroscopic space and time scales , while only a microscopic evolution law is known . for such time - dependent multi - scale problems , </S>",
    "<S> an  equation - free \" framework has been proposed , of which patch dynamics is an essential component . </S>",
    "<S> patch dynamics is designed to perform numerical simulations of an unavailable macroscopic equation on macroscopic time and length scales ; it uses appropriately initialized simulations of the available microscopic model in a number of small boxes ( patches ) , which cover only a fraction of the space - time domain . to reduce the effect of the artificially introduced box boundaries , we use buffer regions to  shield \" the boundary artefacts from the interior of the domain for short time intervals . </S>",
    "<S> we analyze the accuracy of this scheme for a diffusion homogenization problem with periodic heterogeneity , and propose a simple heuristic to determine a sufficient buffer size . </S>",
    "<S> the algorithm performance is illustrated through a set of numerical examples , which include a non - linear reaction - diffusion equation and the kuramoto  sivashinsky equation . </S>"
  ]
}