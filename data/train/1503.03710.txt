{
  "article_text": [
    "for the investigation and understanding of processes involving small - scale magnetic features in the solar photosphere it is essential to obtain detailed information about the underlying magnetic field .",
    "this can be done through simulations or observations . in the case of observations one can choose among several possibilities to study the properties of the field .",
    "proxymagnetometry , for instance , exploits the intensity variations caused by the magnetic field to detect magnetic features and follow their evolution ( @xcite or @xcite ) .",
    "other methods use ( spectro)polarimetry : due to the zeeman effect , magnetic fields induce polarization in spectral lines and thus spectropolarimetric observations can yield insights into the physics of the solar atmosphere . for the interpretation of the data one can apply sophisticated computer codes which solve the radiative transfer equation and determine the physical conditions under which the light was emitted .",
    "our group uses the sir code ( stokes inversion based on response functions , see @xcite and @xcite ) for the inversion of spectropolarimetric measurements .",
    "sir retrieves not only the atmospheric parameters ( temperature @xmath1 , line - of - sight velocity @xmath2 , magnetic field strength @xmath3 , and magnetic field angles ) , but also their stratifications along the line of sight .",
    "this is done by computing synthetic stokes spectra from an initial guess model , comparing them to the observations , and modifying the model until the synthetic profiles fit the observed ones ( i.e. , the @xmath4 values become minimum ) . for this fitting procedure",
    "a marquardt algorithm is used .",
    "sometimes the algorithm is unable to find the global minimum of the @xmath4 function and the code fails to converge .",
    "the original sir code can only invert one pixel at a time , while modern solar polarimeters provide us with an enormous wealth of data consisting of millions of pixels within a time series .",
    "for the inversion of such huge amounts of data we parallelized the sir code ( see section [ sec : par ] ) .",
    "we also introduced a new input / output strategy ( section [ sec : io ] ) and implemented the possibility of using multiple initial model atmospheres to solve rare cases of non - convergence ( section [ sec : multinit ] ) .",
    "the achieved speedup is discussed in section [ sec : speedup ] and the conclusions are summarized in section [ sec : conclusion ] .",
    "we included mpi ( message passing interface ) routines in the sir code , enabling the usage of a cluster computing system for the inversion .",
    "figure [ fig : flow ] shows the workflow of the parallel sir code .",
    "a master - slave topology was incorporated , i.e. , one master process performs all input / output and distributes the work to slave processes .",
    "this is possible since the pixels are treated separately and inverted independently of each other . in order to achieve a high speedup",
    ", we had to modify the input and output modules of sir ( see next section ) . except for that",
    ", the functionality and numerical setup of the original sir code remains the same .          while the serial sir code uses ascii input and output files for each single pixel",
    ", we had to implement a more sophisticated format to better handle large amounts of data .",
    "we chose the fits ( flexible image transport system , see @xcite ) standard as it is widely spread among the scientific community and easy to use . the following ( partially optional )",
    "changes regarding the input / output were made compared to the serial version of the sir code :    * input of the observed stokes spectra via fits files . * optional input of a pixel mask for the inclusion and exclusion of single pixels . *",
    "optional inversion of a time sequence using the same settings for each time step . * optional use of a different wavelength grid and stray light profile for each pixel .",
    "* output of all inversion results via fits files .",
    "we introduced a so - called ` init ` file enabling the user to control the new features of the parallel sir code .",
    "the control file of the original sir code remains the same and still contains the main settings of the inversion , such as the names of the atomic data and abundance files , the atmospheric parameters to be retrieved , and the number of nodes for each physical quantity .",
    "the current state of the inversion ( number of inverted pixels , number of pixels to be inverted , elapsed time , estimated time of the whole inversion ) is written to a text file called ` progress ` to inform the user about the inversion progress .    to prevent data loss in case of the failure of a process , the results are periodically written to the output files .",
    "the frequency of this backup is specified in the ` init ` file .      for certain combinations of input data ( spectra , initial models )",
    ", the sir code may fail to converge .",
    "moreover , experience shows that in regions with weak polarization signals the solution may depend on the initial guess model . in order to avoid non - convergence and improve the best - fit @xmath4-values",
    ", we implemented the possibility of using multiple initializations .",
    "if this option is selected , a set of different initial model atmospheres is created in a permutative way and the inversion of each pixel is repeated using all these models . in the end , the solution providing the best fit ( i.e. , the lowest @xmath4 ) is selected and used for the output .",
    "the values of the initial models are defined by the user and should cover the parameter space as densely as possible . in particular , the initial gradients of @xmath3 , @xmath2 , and field inclination can be specified , both in sign and in magnitude . trying different combinations of the parameters",
    "increases the reliability of the inferences , especially when it comes to determining the sign of the gradients from noisy and/or coarsely sampled stokes profiles    tests have shown that the code often converges very well with just one initialization .",
    "the advantage of different initializations is that they resolve rare cases of non - convergence and also ensure that the correct solution is chosen among weak and strong fields , large and small inclinations to the vertical , etc .",
    "thus , they usually lead to better @xmath4-values .",
    "the quality of a parallelization can be measured in terms of the speedup , @xmath5 , defined as @xmath6 where @xmath7 is the execution time for only one processor ( in our case , running the serial version of the sir code ) , and @xmath8 is the execution time using @xmath9 processors . in the ideal case , the relationship is linear , i.e. , @xmath10 . in practice , however , the speedup is limited by non - parallelizable operations , such as file input / output or memory access .",
    "figure [ fig : speedup ] displays the speedup of the parallel sir code .",
    "we measured the execution times for the same pixels and settings using a different number of mpi processes on the cluster system of the instituto de astrofsica de andaluca . in order to obtain the reference value @xmath7 we applied the serial sir code to the same pixels .",
    "it is remarkable that the speedup is superlinear in each measurement .",
    "this behavior is most probably caused by cache effects : if @xmath9 is large enough , the capacity of the accumulated cache will be sufficient to hold enough data of the program as to reduce the memory access time , thus leading to an increased speedup .",
    "in addition , the input / output operations are reduced to a minimum in the parallel sir code .",
    "these operations are very time consuming because they involve disk access , so avoiding them significantly increases the code performance .",
    "sir is an advanced tool for the numerical inversion of the radiative transfer equation .",
    "it enables the user to deduce physical quantities within the solar photosphere and their gradients from observed stokes spectra . in order to facilitate the application of the code to modern high - resolution data sets we improved its runtime performance by fully parallelizing it",
    "this improvement goes along with other new features , e.g. , the implementation of new input / output routines for direct access to fits files",
    ". the new version of sir can be run on high - performance clusters to invert large datasets within a reasonable time span .",
    "the most important improvements with respect to the original sir code are :    * the parallelization enabling the inversion of more than one pixel per call using several processor cores . * reading the input spectra from standardized fits files . * writing all output data to standardized fits files . *",
    "excluding single pixels from the inversion via the usage of a pixel mask .",
    "* inversion of a whole time sequence in one call . * periodic backup of output results in order to prevent data loss . * using different initial model atmospheres to improve the fits .",
    "most of these features are controlled via the newly introduced ` init ` file .",
    "information about the current status of a running inversion is written to a file called ` progress ` .",
    "the speedup of the parallel sir code compared to the original version shows a superlinear trend .",
    "this is a remarkable behavior for a parallel program .",
    "already a linear speedup would indicate a proper implementation of the parallelization ( i.e. no systematic errors were made during the conceptual design phase of the parallelization as well as during the programming phase ) .",
    "the superlinear trend is most probably linked to the significant input / output optimizations and beneficial cache effects .",
    "the user of the parallel sir code can optionally apply a new strategy of inversion . instead of running the inversion with only one initial model atmosphere ,",
    "a set of different models covering the range of meaningful parameter values can be employed to invert each pixel .",
    "the solution providing the best fit to the data is selected and stored as output .",
    "first tests have already shown the validity of this approach .",
    "the parallel version of sir can be downloaded from http://spg.iaa.es/downloads . in the future",
    ", we also plan to parallelize sirgauss and sirjump ( @xcite ) . these codes implement gaussian perturbations and discontinuities of the atmospheric parameters along the line of sight , respectively , and can be used to invert spectra from sunspot penumbrae and the quiet sun .",
    "this work was funded by the austrian science fund ( fwf ) : p23618 ( dynamics of magnetic bright points ) , the llp erasmus program of the e.c . , the frderungsstipendium of the university of graz , and the spanish ministerio de economa y competitividad through grants aya2012 - 39636-c06 - 05 and esp2013 - 47349-c6 - 1-r , including a percentage from european feder funds .",
    "d.u . wants to acknowledge the special support given by project j3176 ( spectroscopic and statistical investigations on mbps ) .",
    "j.j . is thankful to the ad ( sterreichischer austauschdienst ) and the mmt ( ministry of education , youth and sports , czech republic ) for supporting research stays in austria .",
    "s.t . and d.u .",
    "are also thankful to the ad and the msmt for supporting research stays in the czech republic .",
    "the authors gratefully acknowledge support from nawi graz .",
    "bellot rubio , l.  r.  2003a , in : j. trujillo bueno & j. snchez almeida ( eds ) . _ the fine structure of the penumbra : from observations to realistic physical models _",
    "solar polarization ( asp - cs ) , 307 , p. 301",
    "2003b , sir user s guide , kiepenheuer institut fr sonnenphysik , freiburg , germany pence , w.  d. , chiappetti , l. , page , c.  g. , shaw , r.  a. , & stobie , e.  2010 , _",
    "a&a _ 524 , aa42 1992 , _ apj _ 398 , 375 schssler , m. , shelyag , s. , berdyugina , s. , vgler , a. , & solanki , s.  k.  2003 , _ apj ( letters ) _ 597 , l173 steiner , o. , hauschildt , p.  h. , & bruls , j.  2001 , _",
    "a&a _ 372 , l13"
  ],
  "abstract_text": [
    "<S> magnetic fields are one of the most important drivers of the highly dynamic processes that occur in the lower solar atmosphere . </S>",
    "<S> they span a broad range of sizes , from large- and intermediate - scale structures such as sunspots , pores and magnetic knots , down to the smallest magnetic elements observable with current telescopes . on small scales , </S>",
    "<S> magnetic flux tubes are often visible as magnetic bright points ( mbps ) . </S>",
    "<S> apart from simple @xmath0 magnetograms , the most common method to deduce their magnetic properties is the inversion of spectropolarimetric data . </S>",
    "<S> here we employ the sir code for that purpose . </S>",
    "<S> sir is a well - established tool that can derive not only the magnetic field vector and other atmospheric parameters ( e.g. , temperature , line - of - sight velocity ) , but also their stratifications with height , effectively producing 3-dimensional models of the lower solar atmosphere . in order to enhance the runtime performance and the usability of sir we parallelized the existing code and standardized the input and output formats . </S>",
    "<S> this and other improvements make it feasible to invert extensive high - resolution data sets within a reasonable amount of computing time . </S>",
    "<S> an evaluation of the speedup of the parallel sir code shows a substantial improvement in runtime . </S>"
  ]
}