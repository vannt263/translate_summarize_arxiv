{
  "article_text": [
    "regression is the hammer in the toolbox for any professional quant . it is widely used and sheer force",
    "can often yield amazing results .",
    "however , regression goes far beyond the simple concept of fitting a line into a cloud of points .",
    "regression is closely related to conic programming and while keeping the mathematical details at a minimum we discuss this connection in section @xmath0 .",
    "this makes regression a versatile tool for portfolio optimisation as we are able to apply constraints and bounds .    in section @xmath1",
    "we address the closely related regularisation problem . in the context of portfolio optimisation regularisation terms mimic trading costs .",
    "such penalties help to tame the underlying optimisation problem .    in section @xmath2",
    "we discuss typical problems in the management of equity portfolios .",
    "we discuss some common practical concepts and their implementation as a conic program .",
    "we sketch how to generate data - driven estimators for future returns in section @xmath3 .",
    "finally we demonstrate using real world data how to construct common portfolios using the tools and concepts introduced in previous sections .",
    "the core regression problem is to model the linear relationship between @xmath4 explanatory variables @xmath5 and the dependent variable @xmath6 .",
    "the columns of @xmath7 are the explanatory variables @xmath8 .",
    "we find coefficients @xmath9 such that the weighted sum @xmath10 has minimal euclidean distance to @xmath11 , @xmath12 the term @xmath13 is the _",
    "residual_. the @xmath0-norm of the residual is @xmath14 .",
    "note that the @xmath0-norm resembles a scaled standard deviation of the vector @xmath15 if this vector is centered ( mean zero ) .",
    "equation ( [ leastsquare ] ) is an _ unconstrained least squares problem _ as we are minimizing ( the square root of ) the sum of squared residuals .",
    "it is more common in literature to minimise the square of the @xmath0-norm , @xmath16 obviously , the problems in equation ( [ leastsquare ] ) and equation ( [ leastsquare2 ] ) have the same solution . throughout this article",
    "we assume @xmath7 has more rows than columns .",
    "we call such systems overdetermined .",
    "underdetermined systems are rare in practical applications in finance and require the application of techniques introduced in section @xmath1 to make their solution unique .",
    "the residual has to be orthogonal to the range of @xmath7 .",
    "this geometric insight is the base for the most powerful algorithms but also the core idea underlying the normal equations revealing an explicit solution for this unconstrained problem @xmath17 please avoid solving those equations directly or even worse by computing the inverse of @xmath18 explicitly .",
    "this can go terribly wrong , in particular if @xmath7 has almost linear dependent columns . leaving those numerical reasons aside",
    "there is no elegant way to state bounds and constraints on @xmath19 using this approach .",
    "note that solving those equations and then applying constraints by modifying the unconstrained solution leads to very suboptimal results in many cases .",
    "the desired flexibility is achieved by embedding regression in a more general and powerful concept known as conic programming . for the purpose of this paper",
    "it is enough to understand quadratic and rotated quadratic cones .",
    "we define an @xmath20-dimensional _ quadratic cone _ as a subset of @xmath21 , @xmath22 the geometric interpretation of a quadratic ( or second - order ) cone is shown in fig .",
    "[ fig : qcone ] for a cone with three variables , and illustrates how the exterior of the cone resembles an ice - cream cone .",
    "a convex set @xmath23 is called a convex cone if for any @xmath24 we have @xmath25 . from the definition ( [ quadcone ] )",
    "it is clear that if @xmath26 then obviously @xmath27 , which justifies the notion quadratic cone .",
    "an @xmath20-dimensional rotated quadratic cone is defined as @xmath28 the two cones are equivalent under an orthogonal transformation , so we only need the first one , but having both is convenient and results in simpler formulations .",
    "often regression problems are solved using quadratic optimisation . in equation ( [ leastsquare2 ] ) we compute explicitly the inner product of @xmath29 , @xmath30 any convex quadratic programming problem can be reformulated as a conic programming problem , but the latter class of optimization problems is much more general and yields a more flexible modelling tool .",
    "some simple examples include :    * @xmath31 . * @xmath32 * @xmath33 * @xmath34    more examples can be found in the mosek modeling guide @xcite .",
    "a core idea of modern optimisation is to lift a problem in space of a higher dimension in which it has a standard structure much more convenient for modern solvers .",
    "this strategy applies to regression problems , too .",
    "this may seem counterintuitive but opens a range of new possibilities .",
    "we use the epigraph formulation ( e.g. , minimizing @xmath35 is equivalent to minimize @xmath36 such that @xmath37 ) for equation ( [ leastsquare ] ) to establish the existence of a cone , @xmath38 note that the constraint describes a quadratic cone , e.g. , @xmath39 . for equation ( [ leastsquare2 ] )",
    "we use a rotated cone , @xmath40 and hence @xmath41 .",
    "mosek is commercial optimisation solver for large - scale convex and integer conic optimisation .",
    "the solver implements the _ homogeneous embedding _",
    "algorithm @xcite , which has proven to be very robust and reliable .",
    "for example , it handles infeasible models in a graceful manner , providing either an optimal solution or a _ certificate _ that the problem is infeasible or unbounded .",
    "the different cones supported by the conic solver in mosek are    * the whole @xmath21 . * the nonnegative orthant @xmath42 .",
    "* quadratic cones .",
    "* rotated quadratic cones . * the cone symmetric positive semidefinite matrices .",
    "semidefinite cones add significant flexibility and allows modeling of a vast class of problems , see @xcite , but is outside the scope of this paper .      in a brief intermezzo",
    "we give a first function using python and the new fusion interface of mosek to implement the problem @xmath43    .... from mosek.fusion import *    def _ _",
    "rotqcone__(model , expr1,expr2,expr3 ) :      model.constraint(expr.vstack(expr1,expr2,expr3 ) ,                        domain.inrotatedqcone ( ) )    def _ _",
    "lsq__(model , name , x , w , y ) :      # append the variable v to the model      v = model.variable(name , 1 , domain.unbounded ( ) )          # ( 1/2 , v , xw - y ) \\in qr      residual = expr.sub(expr.mul(densematrix(x),w),y )      _ _ rotqcone__(m,0.5,v , residual )      return v        def lsqposfullinv(x , y ) :      # define a model      m = model('lsqpos ' )             # weight - variables      w = m.variable('w ' , x.shape[1 ] , domain.greaterthan(0.0 ) )                                 # e'*w = 1      m.constraint(expr.sum(w ) , domain.equalsto(1.0 ) )               # variable for sum of squared residuals      v = _",
    "_ lsq__(m,'ssqr',x , w , y )           model.objective(objectivesense.minimize , v )      model.solve ( )           return w.level ( ) ....    fusion is a new high - level interface for mosek .",
    "we construct a model and append variables and constraints on the fly .",
    "please note that the model is passed by reference , e.g. adding a variable in the lsq function will modify the model used in the call .",
    "if the columns of @xmath7 are nearly dependent ( i.e. , high correlations between the explanatory variables ) , regularisation stabilises the computational results , which are otherwise unreliable and highly sensitive to small perturbations and rounding errors .",
    "such effects are responsible for the bad reputation of ( quantitative ) portfolio optimisation amongst some practioners , compare with @xcite . in practice it has often been observed that the optimal portfolio takes extreme leverage and alternate positions dramatically when input data is modified .",
    "regularisation can help to tame an optimiser .",
    "practioners should be alarmed by potential instabilities in their portfolio optimisation process .",
    "regularisation is often combined with constraints that rule out certain solution , e.g.  further below we will discuss how to control leverage in an equity portfolio . a combination of both and common sense works best in practice .",
    "here we shall explain how to incorporate regularisation terms in least squares problems .",
    "in the context of portfolio optimisation we can interpret regularisation terms as trading costs .",
    "often we reoptimise portfolios when new data is available .",
    "the current state of the portfolio is described by a vector @xmath44 .",
    "trades @xmath45 are induced by changes in the coefficients @xmath46 @xmath47 obviously we want to avoid rather abrupt and dramatic changes as they result in large costs",
    ".    there are several potential choices for a trading cost model :    * quadratic costs , e.g. @xmath48 .",
    "this choice avoids large trades and tends to overestimate trading costs for large trades .",
    "known as ridge regression or tikhonov regularisation . * linear costs , e.g. @xmath49 .",
    "this choice is giving preference to sparse updates in @xmath46 but does not match the nonlinear effects of eating into an order book .",
    "known as sparse regression or lasso .",
    "* subquadratic costs , e.g.  @xmath50 .",
    "this choice is motivated by empiric density distributions of the order book , compare with @xcite .",
    "the combination of such models is possible . combining quadratic and linear costs",
    "is known as an elastic net in modern statistics .",
    "the regularisation term is included in this minimisation , @xmath51 for some suitably chosen matrix , @xmath52 . in many cases ,",
    "this matrix is chosen as the identity matrix @xmath53 , giving preference to solutions with smaller norms .",
    "for the unconstrained problem the modified normal equations , @xmath54 reveal the proximity to shrinkage for the scaled covariance matrix @xmath18 . in the constrained case ,",
    "a closed - form solution is once again usually not available .",
    "we solve the problem by introducing an additional rotated quadratic cone @xmath55      the regularisation term is now the @xmath56-norm rather than the @xmath0-norm , giving preference to sparse solutions with smaller norms , @xmath57 the @xmath56-norm of a vector @xmath58 is @xmath59    we solve the problem by appending @xmath4 quadratic cones of dimension @xmath0 , @xmath60_i ) \\in { \\mathcal{q}}^2,\\ , i=1,\\ldots , m . \\end{array}\\ ] ]    we construct a sparse regression using python and the new fusion interface of mosek @xmath61_i ) \\in { \\mathcal{q}}^2,\\quad i=1,\\ldots , m\\\\             & \\sum_{i=1}^m w_i = 1\\\\             & { \\mathbf{w}}\\geq 0 .",
    "\\end{array}\\ ] ]    .... from mosek.fusion import *    def _ _",
    "qcone__(model , expr1,expr2 ) :      model.constraint(expr.vstack(expr1,expr2 ) ,                        domain.inqcone ( ) )         def _ _",
    "abs__(model , name , expr ) :",
    "t = model.variable(name , int(expr.size ( ) ) ,                          domain.unbounded ( ) )                          # ( t_i , w_i ) \\in q2   or abs(w_i ) < = t_i      for i in range(0 , expr.size ( ) ) :          _ _ qcone__(model , t.index(i),expr.index(i ) )           return t    def lsqposfullinvpenalty(x , y , gamma , lamb , w0 ) :       # define a model      m = model('lsqsparse ' )              # weight - variables       w = m.variable('w ' , x.shape[1 ] , domain.greaterthan(0.0 ) )         # e'*w = 1      m.constraint(expr.sum(w ) , domain.equalsto(1.0 ) )               # variable for sum of squared residuals      v = _ _ lsq__(m,'ssqr',x , w , y )           # variable sum[abs(gamma*(w - w0 ) ) ]      p = expr.mul(densematrix(gamma),expr.sub(w,w0 ) )      t = expr.sum(__abs__(m , ' abs(weights ) ' , p ) )               model.objective(objectivesense.minimize ,                       expr.add(v , expr.mul(lamb , t ) ) )      model.solve ( )            return w.level ( )   ....      this choice is motivated by empiric investigations of orderbook data .",
    "note that this problem is not a reformulated quadratic problem .",
    "it is one of the classic examples revealing the power and flexibility of conic programming , @xmath63_i\\rvert}^{3/2},\\ ] ] which is equivalent to @xmath64_i\\right ) \\in { \\mathcal{q}}^2,\\ , i=1,\\ldots , m\\\\ & \\left(s_i , z_i , t_i\\right ) \\in { \\mathcal{q}_r}^3,\\ , i=1,\\ldots , m\\\\ & \\left(\\frac{1}{8},t_i , s_i\\right ) \\in { \\mathcal{q}_r}^3,\\ , i=1,\\ldots , m . \\end{array}\\ ] ] we are now using @xmath65 cones to describe this problem .",
    "we solve common problems in portfolio management using techniques introduced above . in all examples discussed below",
    ", the matrix @xmath5 describes a time series of @xmath20 consecutive historic returns of @xmath4 risky assets , each row index of @xmath7 corresponding to an investment period , and each column index to an asset .",
    "we search for an _ optimal _ combination of those assets .",
    "different objectives , expectations , constraints , risk appetite , and trading costs , etc .",
    "result in a variety of formulations used in practice .",
    "an investor wishes to manage a portfolio in @xmath4 risky assets .",
    "the investor allocates fractions @xmath66 of the risk capital @xmath67 in asset @xmath68 over an investment period @xmath69 $ ] ( one hour , day , week , month , ... ) , at the end of which he / she is prepared to adjust the positions again .    at time",
    "@xmath70 the update in @xmath19 is induced by changes in the underlying input data for the portfolio problem .",
    "the vector @xmath71 describes the time series of @xmath20 consecutive portfolio returns .",
    "a portfolio return is the weighted sum of the @xmath4 linear returns @xmath72 where @xmath73 is the return of asset @xmath68 over the @xmath74-th historic investment period .",
    "an index tracking portfolio minimises the distance ( or tracking error ) to a given portfolio or index , e.g.  a return time series @xmath75 .",
    "@xmath76 which is equivalent to @xmath77 we track the portfolio by fully investing the capital @xmath67 with long positions only .",
    "please note that the accumulated returns of both portfolios may differ dramatically .",
    "a potential remedy is to use accumulated returns for both the assets and the portfolio or index .      although one could avoid being exposed to risk by not investing at all , minimum variance portfolios got popular .",
    "such portfolios can be constructed by noting that they track a return time series with @xmath78 . from a theoretical perspective",
    ", it should not make sense to invest in such portfolios , but in practice they are observed to perform quite competitively , hence their popularity .",
    "the best known investment model is the @xmath56-period mean - variance model of markowitz . in this model",
    "we maximise the expected portfolio return while keeping the estimated risk at or below a predefined level by carefully diversifying across various available assets .",
    "an investor wishes to actively manage a portfolio in @xmath4 risky assets .",
    "the investor holds fixed positions @xmath66 in asset @xmath68 over an investment period @xmath69 $ ] ( one hour , day , week , month , ... ) , at the end of which he / she is prepared to adjust the positions again .",
    "the expected return of asset @xmath68 is @xmath79 $ ] .",
    "@xmath80 is the random variable describing the return per unit position in asset @xmath68 over the investment period @xmath69 $ ] .",
    "the expectations need to be replaced by estimates @xmath81\\ ] ] this is usually done via methods described in section @xmath3 using historical prices and other data available at time @xmath82 .",
    "hence the expected portfolio return is @xmath83 hence we solve this problem @xmath84 the problem is more interesting once we remove the long only constraint . the solution will most likely almost explode as the optimiser identifies some dramatic risk - offsetting positions .",
    "we have discussed this before in the context of regularisation .",
    "a common approach is to control the leverage directly .",
    "this can be done with bounds on the @xmath56-norm of @xmath19 . for a portfolio with short positions ,",
    "@xmath85 we control the @xmath56-norm of @xmath19 by introducing @xmath4 cones , e.g. , @xmath86 and hence @xmath87 to construct a popular @xmath88 portfolio with a short position of up to @xmath89 . ]",
    "we set @xmath90 a market neutral investor may prefer to work with weights not inducing a long bias .",
    "such investors often use @xmath91 and @xmath92 to bound the size of the long and the offsetting short position . for practical portfolios",
    "we often need additional constraints on individual coefficients and subsets of assets , e.g. , belonging to certain sectors .      in the previous sections",
    "we have seen how regularisation can be an effective tool in the presence of unreliable data .",
    "alternatively we can design a _",
    "robust _ portfolio that explicitly takes the uncertainty into account .",
    "suppose that the data is uncertain , but belongs to a simple known uncertainty set .",
    "we can then form a robust estimator that optimises the _ worst - case _ realisation of the model over the simple uncertainty set .",
    "for sufficiently simple uncertainty sets this amounts to a tractable optimisation problem , that is not much harder to solve than the non - robust version .",
    "for example , suppose that the vector @xmath93 of expected returns is uncertain , but known to lie inside an ellipsoid @xmath94 where @xmath95 is a symmetric matrix with nonnegative eigenvalues and @xmath96 is the center of the ellipsoid , i.e. , we characterise @xmath97 by a ( known ) transformation of the unit - ball .",
    "such uncertaintity sets arise naturally as confidence regions of statistical estimators .    the _ worst - case return",
    "_ is then given by the minimum of @xmath98 over @xmath97 , i.e. , as @xmath99 when @xmath100 the last term is minimised by choosing @xmath101 , in other words , @xmath102 a portfolio maximising the worst - case return over @xmath97 can then be computed by solving @xmath103",
    "in the previous section we have already introduced the concept of an expected return for an asset .",
    "quantitative portfolio management esssentially relies on the assumption that the common disclaimer of previous returns and their lack of indicative power for the future is not true .",
    "trading autocorrelations in asset returns is one of the most common quantitative investment strategies .    to simplify the technical discussion ,",
    "we assume we have a time series of returns @xmath104 .",
    "note that practioners tend to use volatility adjusted and hence homoscedastic returns .",
    "the goal is to predict @xmath105 as a linear function of historic data available up to this point in time , i.e. , on @xmath106 and any subsequent returns are assumed to be predicted by the same linear function applied to their own analogous data history ( with an appropriate shift in time ) .",
    "we could setup the system the most unconstrained model @xmath107 a common alternative is to use simple linear functions of historic data @xmath108 moving averages are often chosen as linear functions of historic data , so that ( [ movav ] ) is in fact obtained as a restriction of model ( [ gen ] ) to @xmath19 taking values only in a certain linear subspace .",
    "this dimensionality reduction allows for @xmath19 to be computed more accurately than under the unconstrained model ( [ gen ] ) , since the constrained model is provided with more data relative to the number of degrees of freedom .",
    "another method to increase the number of data points relative to the number of degrees of freedom is to transform the data obtained from different assets in such a way as to make them all appear on the same scale , so that all the data can be used together .",
    "this results in more robust estimators of @xmath19 .    of course , we are by no means restricted to use moving averages .",
    "there are numerous interesting ideas oscillating around .",
    "common sense combinded with the regularisation techniques in section [ sec : regularisation ] can construct very competitive trading systems driven by data .",
    "in this section we sketch typical tasks in portfolio management . our ultimate goal here is to demonstrate how mosek can help in common research problems .",
    "we download equity data from yahoo finance using the popular pandas library for python . for the experiments we use adjusted close prices to reflect stock splits , dividends , etc .",
    "we have selected a universe of our @xmath3 favorite american companies , with symbols shown below .",
    "[ cols= \" < , < \" , ]     once fetched we write the data into a csv file to simplify any further analysis .    ....",
    "import pandas.io.data as web import datetime as dt import pandas as pd    def fetchdatafromyahoo(symbols ) :      s = dt.datetime(2010 ,   1 ,   1 )      e = dt.datetime(2012 , 12 , 31 )      return pd.dataframe (          { symb : web.get_data_yahoo(symb , s , e)[\"adj close \" ]           for symb in symbols } )    if _ _ name _ _ = = ' _ _ main _ _ ' :      # fetch individual stocks and the s&p index      symbols = [ \" gs \" , \" aapl \" , \" ibm \" , \" goog \" , \" t \" , \" ^gspc \" ]      fetchdatafromyahoo(symbols).to_csv(\"data.csv \" ) ....      a common task in quantitative portfolio management is to find a portfolio that would have been optimal in the past . obviously , this may bear limited information for the future but we shall avoid this discussion here .",
    "we bypass how often a manager should update a portfolio and how to model the costs that come with rebalancing a portfolio .",
    "such questions are relevant in practice but beyond the scope of this paper .",
    "let us now consider fully invested portfolios without short positions .",
    "this translates into non - negative coefficients @xmath46 in a linear combination of @xmath3 stocks .",
    "we are reusing the functions defined above .",
    "first we compute the minimum variance of a portfolio .",
    "the variance of a portfolio return time series @xmath109 is @xmath110 in all but the very slowest trading quantitative trading strategies , the order of fluctuations of returns is at least one order of magnitude larger than th order of the mean .",
    "it is therefore common to make the approximating assumption that @xmath111 , so that the last problem resembles again a least squares problem @xmath112 in a second question we compute the set of @xmath3 weights minimizing the variance of the tracking error @xmath113 where @xmath114 is the return vector of an index .",
    "we also compute the @xmath115 portfolio for our universe , e.g. applying the same weight to each asset .",
    "the results we observe obviously depend on the learning period and in particular on the selected universe of assets . for our universe and the range of dates ( 2010,2011,2012 )",
    "we get the following result for the minimum variance portfolio    .... goog     0.05 t        0.67 aapl     0.03 gs       0.00 ibm      0.25 ....    and the index tracker    .... goog     0.10 t        0.30 aapl     0.12 gs       0.18 ibm      0.30 ....    note that the minimum variance portfolios tries to invest heavily into at&t but avoids goldman sachs altogether .",
    "the index tracker is slightly more balanced in its positions .",
    "we also demonstrate how to apply some simple portfolio diagnostic and report an annualized sharpe ratio and the observed standard deviation of portfolio returns in this period .",
    "the observed annualized sharpe ratio is    ....",
    "1/n              0.74 index            0.51 min variance     0.93 tracking         0.77 ....    for the standard deviations of returns we get    .... 1/n              0.012 index            0.012 min variance     0.009 tracking         0.011 ....    .... import pandas as pd import moseksolver as ms    def computereturn(ts ) :      ts = ts.dropna ( )      return ts.diff ( ) / ts.shift(1 )    def lsqposfull(x , y ) :      return pd.series(index=x.columns ,                        data = ms.lsqposfull(x.values , y.values ) )    def annualizedsharperatio(ts ) :      return 16*ts.mean()/ts.std ( )    if _ _ name _ _ = = ' _ _ main _ _ ' :      # load data from csv files      data = pd.read_csv(\"data.csv \" , index_col=0 ,                                      parse_dates = true )        stocks = data[[\"goog\",\"t\",\"aapl\",\"ibm\",\"gs \" ] ]      index = data[\"^gspc \" ]        retstocks = stocks.apply(computereturn).fillna(value=0.0 )      retindex = computereturn(index).fillna(value=0.0 )        rhszero = pd.timeseries(index=retstocks.index , data=0.0 )        wmin = lsqposfull(x = retstocks , y = rhszero )      wtrack = lsqposfull(x = retstocks , y = retindex )        d = dict ( )      d[\"minimum variance \" ] = ( retstocks * wmin).sum(axis=1 )      d[\"index \" ] = retindex      d[\"1/n \" ] = retstocks.mean(axis=1 )      d[\"tracking \" ] = ( retstocks * wtrack).sum(axis=1 )      frame = pd.dataframe(d )        # apply some diagnostics      print frame.apply(annualizedsharperatio )      print frame.std ( ) ....",
    "conic programming provides the flexibility needed to solve challenging regression problems .",
    "such problems arise not only in finance but rather in any quantitative discipline dealing with data . in this paper we discussed in particular portfolio optimisation .",
    "mosek modeling manual , mosek aps , 2013 .",
    "available online from http://www.mosek.com/resources/doc .",
    "michaud , r.o . , _ efficient asset management _ , wiley , 1998 almgren , r. , thum , c. , hauptmann e. , and li , h. , equity market impact .",
    "_ risk _ , 18(7 , july):5762 , 2005 .",
    "ye , y. , todd , m.j . , mizuno , s. , an @xmath116-iteration homogeneous and self - dual linear programming algorithm .",
    "_ mathematics of operations research _ , pages 53 - 67 , 1994 .",
    "ben - tal , a. , nemirovski , a. _ lectures on modern convex optimization : analysis , algorithms , and engineering applications .",
    "_ mps / siam series on optimization , siam , 2001 .",
    "boyd , s. , vandenberghe , l. , _ convex optimization . _ cambridge university press , 2004 .",
    "meucci , a. , linear vs. compounded returns .",
    "common pitfalls in portfolio management , _ garp risk professional _ , pages 49 - 51 , april 2010 , available at ssrn http://papers.ssrn.com/abstract=1586656"
  ],
  "abstract_text": [
    "<S> regression is widely used by practioners across many disciplines . </S>",
    "<S> we reformulate the underlying optimisation problem as a second - order conic program providing the flexibility often needed in applications . using examples from portfolio management and quantitative trading we solve regression problems with and without constraints . </S>",
    "<S> several python code fragments are given . </S>"
  ]
}