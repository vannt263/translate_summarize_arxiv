{
  "article_text": [
    "after a molecule is irradiated with light from the visible or uv parts of the spectrum , several photophysical processes can take place.@xcite these can be classified into radiative and radiationless processes and are best represented in a jabonski diagram ( see figure  [ fig : jablonski ] ) . in radiative processes ,",
    "the molecule interacts with light and absorbs ( absorption ) or emits ( stimulated and spontaneous emission ) a photon .",
    "emission can be further subdivided into fluorescence and phosphorescence , depending on whether the system emits from an electronic singlet or triplet state , respectively .",
    "radiationless processes are usually divided into internal conversion ( ic ) , which is the transfer of population between electronic states of the same spin multiplicity , and intersystem crossing ( isc ) , which involves a change of the electronic spin .",
    "oftentimes , these processes occur in cascades after the incidental absorption of a photon . one typical chain of processes is absorption followed by ic to the lowest singlet state ( as in kasha s rule@xcite ) , followed by isc to the triplet manifold , followed by ic to the lowest triplet state , from where the system may return to the electronic ground state by phosphorescence .    ) , fluorescence ( f ) , and phosphorescence ( p ) ; wavy arrows show radiationless processes : internal conversion ( ic ) and intersystem crossing ( isc ) . ]",
    "the non - radiative processes of ic and isc are of fundamental importance in photochemistry and photobiology .",
    "ic is ubiquitous in the non - adiabatic excited - state dynamics of polyatomic molecules because polyatomic molecules possess many degrees of freedom and a large number of electronic excited states , allowing for regions of degeneracy or close degeneracy in their potential energy surfaces ( pes ) .",
    "intersections of two or more pes are usually refered to as conical intersections;@xcite these conical intersections are precisely the funnels which facilitate efficient non - adiabatic transitions from an upper to a lower pes , which is ic .",
    "ic is , for example , encountered in the process of visual perception , in particular during phototransduction . during this process",
    ", the retinal chromophore of the opsin protein absorbs a photon and subsequently undergoes ultrafast ic facilitated by conical intersections , leading to photoisomerization@xcite which changes the conformation of the protein and induces a neural signal .",
    "ultrafast ic is also responsible for avoiding harmful photochemical reactions of dna@xcite and proteins,@xcite , protecting organisms from uv radiation .",
    "ic is also present in the photochemistry of small molecules , for example o@xmath0 and o@xmath1,@xcite so@xmath0,@xcite no@xmath0@xcite and other nitrogen oxides.@xcite the absorption of sunlight by these molecules and the subsequent photochemistry are central to atmospheric chemistry and the study of the environment and pollution.@xcite    isc is a key ingredient in molecular photophysics@xcite and hence it plays an important role in many areas of research .",
    "for example , concepts like optical switching,@xcite reverse saturable absorption@xcite or light - induced magnetism@xcite are related to isc in the field of molecular electronics .",
    "the interconversion between electric energy and light ( in artificial photosynthesis@xcite and oleds@xcite ) , magnetic data storage@xcite and a number of biomimetic technologies@xcite also rely on isc .",
    "isc has also biochemical relevance as it is a key step in many biochemical reactions ( e.g. , oxygen binding to carrier proteins  @xcite ) , harmful photochemical reactions of dna strands , and has found application in phototherapies ( e.g. , photodynamical therapy@xcite ) .",
    "furthermore , isc is relevant to the study of combustion processes , where open - shell atoms ( like oxygen ) and radicals play a central role , in organic photochemistry , e.g. , in @xmath2$]-cycloadditions,@xcite and in biomimetic catalysis.@xcite    due to its increasing relevance in different disciplines , the number of studies on isc has proliferated in the last years .",
    "the study of photo - induced processes in transition - metal complexes,@xcite where isc should be prominent due to the presence of the heavy metal atoms , has received special attention .",
    "chergui@xcite has recently reviewed the photophysics of different transition metal complexes , paying particular attention to the timescale of isc .",
    "intriguingly , the reported isc timescales range from extremely fast , e.g. , 30  fs for the @xmath3^{2+}$ ] complex,@xcite to about 800  ps in @xmath4.@xcite this large spread is difficult to explain simply by the type of central atom , since for example the heavier pd is expected to induce more efficient isc than fe .",
    "femtosecond time scales for isc have been also observed in transition metal complexes based on ruthenium,@xcite rhenium,@xcite osmium,@xcite and other metals.@xcite more recently , also the role of isc in organic molecules has captured the attention of researchers .",
    "examples of molecules where isc is important range from aldehydes@xcite and small aromatic compounds like benzene,@xcite naphthalene , anthracene and their carbonylic derivatives@xcite to nitrocompounds.@xcite furthermore , isc has been reported for thio - substituted,@xcite aza - substituted,@xcite bromo - substituted@xcite and canonical nucleobases.@xcite    from a theoretical point of view , isc can be explained by the interaction of states of different multiplicity by spin - orbit coupling ( soc ) , which is a relativistic effect.@xcite it arises from the interaction of the magnetic field induced by the orbital momentum of an electron and the magnetic dipole related to the intrinsic electron spin .",
    "since the orbital momentum depends on the nuclear charges , soc is stronger in molecules possessing heavy atoms . for systems lacking heavy atoms ,",
    "soc has been historically regarded as negligible and hence isc was believed to show much smaller reaction rates than ic.@xcite however , the actual isc rate depends not only on the size of the socs , but also on the density of states , and the particular shape of the excited - state potential energy landscapes , most importantly the location and accessibility of surface crossing regions ( e.g. , between singlets and triplets ) .",
    "this is the reason why an _ a priori _ assessment of isc rates is difficult and experiments have found that isc can occur on very different time scales ( from fs to ns ) , apparently not correlated with the magnitude of socs . in this context , theoretical methodologies are particularly useful to disclose the factors that determine isc in a general framework .",
    "for relatively slow isc processes , the calculation of isc rate constants using landau - zener theory,@xcite fermi s golden rule@xcite or marcus - jortner theory@xcite is well established . for ultrafast isc processes  where the system is very far from equilibrium  a dynamical treatment describing the motion on the pes and taking into account the kinetic processes that lead the system towards the relevant crossing region is mandatory . encompassing the experimental discoveries involving isc , the last decades have seen a surge of excited - state nuclear dynamics studies describing isc .",
    "a number of studies have used quantum wavepacket dynamics , where inclusion of soc is straightforward ; however , these studies are usually restricted to few degrees of freedom .",
    "examples include dihalogens in argon matrices,@xcite transition - metal complexes,@xcite and collision reactions.@xcite further quantum dynamical studies investigated isc in benzene,@xcite hydrogen fluoride,@xcite and sulphur dioxide.@xcite full - dimensional dynamical studies can be performed using extensions of the trajectory surface hopping methodology .",
    "different schemes have been employed to investigate isc in collision reactions like @xmath5,@xcite @xmath6,@xcite @xmath7,@xcite or @xmath8@xcite as well as in the dynamics of o@xmath0 on al surfaces.@xcite trajectory surface hopping was also used to treat isc in molecules like sulphur dioxide,@xcite acrolein,@xcite acetone,@xcite pentanal,@xcite 2-butene,@xcite 6-thioguanine,@xcite cytosine,@xcite uracil,@xcite as well as few transition - metal complexes.@xcite    the present contribution aims at describing and reviewing the available approaches described in the literature to treat isc in trajectory surface hopping methods , paying special attention to the general surface hopping method recently developed by the authors,@xcite which allows treating non - adiabatic ic and isc on the same footing .",
    "this methodology is especially well suited to investigate ultrafast isc ( on timescales up to a few ps ) , because long timescales are usually too expensive for nuclear dynamics approaches . in this",
    "regard , our methodology can be considered complementary to other non - dynamical treatments of isc,@xcite which are not well applicable to ultrafast processes , but work well for slower reactions .",
    "our methodology has been recently implemented in a completely new sharc surface hopping dynamics code .",
    "the sharc program suite , which contains the dynamics code itself and a number of setup , interface and analysis tools , is available online free of charge.@xcite    the rest of the paper is then organized as follows .",
    "the next section introduces generally the surface hopping method and describes different ways in which soc has been introduced to account for isc .",
    "then , section  3 describes step - by - step a way how to arrive at a generally applicable , computationally feasible and satisfactorily accurate methodology for the description of excited - state molecular dynamics including isc .",
    "finally , section  4 summarizes the presented methodology and gives an outlook on future developments in this field .",
    "the basic equation for excited - state dynamics simulations is the time - dependent schrdinger equation , where the hamiltonian includes all non - adiabatic and potential couplings between the electronic states of interest . simulating the motion of a quantum wavepacket according to this hamiltonian by numerically integrating the time - dependent schrdinger equation",
    "is usually termed quantum dynamics.@xcite this approach includes all quantum - mechanical effects like tunneling , coherence and the splitting of the wavepacket and can deliver quantitative results given accurate pes.@xcite however , the necessity to know _ a priori _ the full multi - dimensional pes is a severe bottleneck of the method , rendering quantum dynamics in full dimensionality unfeasible for systems with many degrees of freedom .",
    "there exist a number of approximations that allow treating an increasing number of degrees of freedom , e.g.  the `` multi - configurational time - dependent hartree '' method ( mcdth),@xcite its variants `` gaussian - based mctdh'',@xcite `` multilayer mctdh''@xcite and `` variational multi - configurational gaussians'',@xcite and the unrelated `` full multiple spawning '' method.@xcite alternatively , the dimensionality problem can be tackled with trajectory surface hopping non - adiabatic dynamics .",
    "the concept of surface hopping was originally devised by tully@xcite and greatly improved later by his `` fewest - switches criterion''.@xcite given its wide acceptance and broad applicability , it has been reviewed extensively since then , see for example references@xcite .",
    "surface - hopping approximates the motion of the nuclear wavepacket on the excited - state pes by an ensemble of a large number of independent , classical trajectories .",
    "the nuclear motion is determined by newton s equations , where the force acting on the nuclei is the gradient of one particular electronic state ( the _ active _ state ) .",
    "non - adiabatic population transfer between the electronic states can lead to instantaneous switches of the active state .",
    "this switching  the eponymous `` hopping ''  is conducted stochastically based on the rate of change of the electronic populations@xcite and is accompanied by an adjustment of the kinetic energy in order to preserve the total energy .",
    "surface - hopping methods can deliver a wealth of information about the excited - state dynamics of molecules .",
    "the ensemble ansatz allows obtaining branching ratios between different reaction channels .",
    "time - dependent excited - state populations indicate the evolution of the system across different states , enabling to propose kinetic models .",
    "the geometries at which surface hops occurred can be used to infer surface crossing points , both conical intersections and singlet - triplet crossings ( or crossing points between states of any multiplicity ) . by calculating observables along with the trajectories and taking the ensemble average ,",
    "it is even possible to directly correlate the results with experimental observations .",
    "compared to other dynamics methodologies , surface hopping has a number of advantages,@xcite which justify its popularity : ( i ) the classical mechanics ansatz for the nuclear motion makes the method conceptually simple and easy to implement .",
    "( ii ) the trajectories need only local information on the electronic states ( i.e. , energies , gradients , couplings ) .",
    "thus , surface hopping allows for on - demand ( `` on - the - fly '' ) calculation of the electronic properties , which makes a treatment of all nuclear degrees of freedom possible without the need to construct the full multi - state pes beforehand .",
    "( iii ) each trajectory is independent from the rest of the ensemble .",
    "hence , the trajectories can be trivially parallelized .",
    "the fact that all degrees of freedom can be included in the simulation allows surface hopping to describe large systems , which is likely the reason of its widespread use .",
    "another strength of on - the - fly methods is that they allow going beyond the so - called linear vibronic coupling@xcite and linear vibronic spin - orbit coupling@xcite approaches , where the relevant matrix elements are only approximated by some truncated power series around a reference geometry . in trajectory surface",
    "hopping methods , the availability of the full geometry dependence of the electronic properties makes it automatically possible to describe effects like the promotion of soc by excitation of symmetry - reducing vibrational modes .",
    "unfortunately , the classical approximation has the price that some quantum - mechanical effects are not treated properly .",
    "for example , nuclear vibration is not quantized , which means that nuclear interference effects are neglected and zero - point energy is formally not treated correctly .",
    "additionally , because of the independent - trajectory ansatz , quantum coherence between the electronic states is not properly taken into account",
    ". the latter effect can be partially mitigated using so - called decoherence corrections ; the interested reader is referred to the according literature.@xcite tunneling effects can also not be described with surface hopping although there exist several approaches to alleviate this deficiency , see , e.g. , references@xcite .",
    "the original surface hopping method was formulated to consider only non - adiabatic couplings@xcite between electronic states of the same multiplicity and has been therefore intensively used to describe excited state dynamics involving ic . by incorporating soc into the surface hopping procedure , dynamical studies can be extended to also describe isc . in the following , we list",
    "the different concepts which  to our knowledge  have been described in the literature , ordered by how consistently isc is described with regard to ic :    * on the simplest level , hopping between electronic states of different multiplicity is performed `` manually '' .",
    "this can be done by exploring first the deactivation mechanism within , e.g. , the singlet manifold with regular surface hopping and then identifying singlet - triplet crossing regions , where isc is assumed to occur .",
    "these regions then serve as a starting point for an independent simulation in the triplet manifold .",
    "this approach was used in the 70s by warshel and karplus,@xcite but is still in use nowadays for the description of exceptionally difficult systems.@xcite * on the next level , regular surface hopping can be combined with hopping probabilities between states of different multiplicities calculated only at crossing points based on landau - zener theory.@xcite although in this way hoppings due to ic and hoppings due to isc are treated inconsistently , this approach has been used to some extent in describing collision reactions.@xcite * a further improvement is the proper inclusion of spin - orbit couplings in the equation of motion which governs the evolution of the electronic populations and hence the hopping probabilities .",
    "this allows in principle to have isc in every time step of the simulation , not just at singlet - triplet crossings . in the simplest variant ,",
    "the propagation is carried out using electronic states which are eigenstates of the total spin ( @xmath9 ) and spin projection ( @xmath10 ) operators . in this paper",
    "we term these states `` mch '' states ( referring to the `` molecular coulomb hamiltonian '' , see below for a detailed discussion ) , while in the literature they are also referred to as `` spin - diabatic '' states.@xcite surface - hopping using these states has been adopted in several cases , either assuming a constant value for the soc matrix elements@xcite or with geometry - dependent soc.@xcite * finally , the most advanced schemes to describe isc employ a diagonalization of the electronic hamiltonian including soc , and basically conduct tully s surface hopping using the obtained eigenstates . because the full electronic hamiltonian is diagonal in the basis of these states , here we label it the `` diagonal '' basis ( also called `` spin - adiabatic '' elsewhere@xcite ) .",
    "the diagonal electronic basis offers a number of advantages , which will be discussed in detail below .",
    "this approach has been used already in 2004 to describe the @xmath8 reaction@xcite and recently saw a number of applications.@xcite a general on - the - fly implementation of surface hopping in this fashion is available in the sharc suite.@xcite    in passing we note that similar methodologies using the equivalents of the mch@xcite or diagonal@xcite electronic bases have also been developed in different contexts to describe other processes , like interactions of electromagnetic fields with molecular dipole moments .",
    "the following section is devoted to explain exclusively the two last approaches to isc surface hopping , since only these offer a consistent description of isc versus ic .",
    "in the following , we provide a step - by - step derivation of the main working equations necessary to perform trajectory surface hopping simulations focussing on the application to isc problems .",
    "we start giving an overview over the workflow of a surface hopping simulation .",
    "then , we develop the equation of motion for the electronic wavefunction , which will be our main concern here , since isc arises from coupling of electronic states of different multiplicity . afterwards ,",
    "we discuss which electronic basis functions should be used in the propagation of the wavefunction , and the implications of this choice , in particular with respect to the integration of the equations of motion and the gradients used for the nuclear dynamics .",
    "surface - hopping is a special type of molecular dynamics ( md ) . in md , the nuclear motion  which should be ideally described by quantum mechanics ",
    "is approximated with classical mechanics .",
    "the nuclear equation of motion is in this case given by newton s second law , which for the nuclear position @xmath11 of atom @xmath12 reads as : @xmath13 here , @xmath14 is the mass of atom @xmath12 and @xmath15 is the gradient of the energy of the electronic state @xmath16 ( we shall call this state the _ active _ state ) with respect to the position of atom @xmath12 ; the energy depends on the geometry @xmath17 of all atoms . in the standard formulation of md",
    ", at each time step only the gradient @xmath18 needs to be evaluated , e.g. , by electronic structure methods , and performing the md simulation consists of solely integrating equation  . integration from time @xmath19 to time",
    "@xmath20 can be effectively done with the velocity - verlet algorithm,@xcite which can be expressed by the following equations : @xmath21\\delta t,\\label{eq : vv : v}\\end{aligned}\\ ] ] where @xmath22 is the acceleration of atom @xmath12 and @xmath23 is the velocity of atom @xmath12 .    in order to incorporate non - adiabatic effects by means of the surface hopping scheme , a prescription of how to choose the correct active state @xmath16 at each time step",
    "is required .",
    "this choice is based on the evolution of an electronic wavefunction along the nuclear trajectory .",
    "accordingly , for every time step the following steps need to be carried out :    1 .   for the current nuclear position @xmath24 , the necessary electronic properties ( e.g. , electronic hamiltonian and non - adiabatic couplings ) are determined .",
    "2 .   from these properties ,",
    "the electronic wavefunction @xmath25 is propagated .",
    "3 .   from the electronic wavefunction ,",
    "the hopping probabilities @xmath26 are calculated and the active state @xmath16 is determined stochastically .",
    "the gradient of @xmath27 is used to calculate the new geometry @xmath28 .",
    "based on this scheme , it can be seen that the evolution of @xmath29 and @xmath17 are coupled . in the following subsection",
    ", we shall focus on the evolution of @xmath29 and the hopping probabilities @xmath26 which can be derived from @xmath29 .",
    "we expand the electronic wavefunction @xmath30 ( we omit the explicit time - dependence for brevity ) by using @xmath31 : @xmath32 where @xmath33 runs over all electronic states in the _ model space_. in order to arrive at a computationally tractable problem , one usually includes only a few states in the model space ( e.g.  the few lowest electronic states of each multiplicity for simulations of isc dynamics ) , chosen in a way that the model space describes the total electronic wavefunction reasonably well for the processes under investigation .    in order to obtain the electronic equation of motion , we insert expression into the electronic time - dependent schrdinger equation , @xmath34 and project on @xmath35 : @xmath36 here , @xmath37 is the electronic hamiltonian operator , which we will define more precisely below .",
    "note that in the following we refer to the electronic hamiltonian simply by the `` hamiltonian '' , as nuclei are treated classically and hence there is no nuclear hamiltonian .    by using @xmath38 , and after rearranging and dividing by @xmath39 , one obtains : @xmath40    \\langle\\psi_\\alpha|\\psi\\rangle .",
    "\\label{eq : eom_general}\\ ] ] this equation is generally valid regardless the particular choice of the ( complete ) basis @xmath41 , which we will call the `` representation '' in the following .",
    "the matrix representation of the hamiltonian in a given basis `` rep '' will be denoted by bold @xmath42 in the remainder of the text , and the hamiltonian matrix elements by @xmath43 . for simplicity in the notation ,",
    "the subscript `` el '' will by omitted in all electronic hamiltonian matrices and matrix elements .",
    "we also define the wavefunction coefficient vector @xmath44 containing the elements @xmath45 and @xmath46 , and the temporal coupling matrix @xmath47 containing the elements @xmath48 . with these definitions ,",
    "equation   can be written very compactly in the following matrix equation : @xmath49    \\mathbf{c}^\\text{rep}.    \\label{eq : eom}\\ ] ] note that @xmath50 , where @xmath51 is the non - adiabatic coupling matrix with elements @xmath52 and @xmath53 is the nuclear velocity vector .",
    "the basis in which matrix representations of operators are expressed are given by a superscript of the matrix .",
    "the reasons and implications of the choice of the representation of the electronic states are discussed in the following .      in a purely quantum - mechanical treatment of the nuclear motion the particular choice of the electronic basis",
    "does not influence the results , as long as the space spanned by the basis functions does not change .",
    "in contrast , due to its semiclassical nature , the results of surface hopping are not invariant to the choice of the electronic basis,@xcite as will be explained below .    for the purpose of this paper , it is useful to discuss three types of representations , in which @xmath42 and @xmath51 have different properties . we start by considering the molecular coulomb hamiltonian ( mch ) , which contains only the kinetic energy of the electrons and coulombic interactions within the molecule , but neither external fields ( e.g. , electric fields ) nor relativistic effects ( e.g. , soc ) : @xmath54    + \\sum\\limits_{i > j } \\frac{1}{r_{ij}}+\\sum\\limits_{a > b}\\frac{z_az_b}{r_{ab}}.\\ ] ] here , the indices @xmath55 and @xmath56 run over the electrons , @xmath12 and @xmath57 over the nuclei , @xmath58 is the nuclear charge , @xmath59 is the distance between two particles , and atomic units have been used .",
    "the basis spanned by the ( few lowest ) eigenstates of the mch hamiltonian is denoted here as the _ mch representation_. in quantum chemistry , the mch states are often called `` adiabatic '' , but here we shall refrain from using this term since it can lead to ambiguity once socs are introduced . since the mch is spin - independent and thus commutes with @xmath9 and @xmath10 , the mch states are also eigenstates of these operators ; hence , they are usually labelled by their @xmath60 and @xmath61 values . furthermore , because states of different @xmath60 or @xmath61 values are not coupled by the mch , generally only a single multiplicity has to be considered in the dynamics ( in most cases , singlet states due to their prevalence in closed - shell organic molecules ) . in the mch representation , the matrix @xmath62 ( with matrix elements @xmath63 ) is diagonal , but the elements of the non - adiabatic coupling matrix @xmath64 are not zero ( since the basis functions change with nuclear position ) and may locally become very large . since nearly all electronic structure codes have been implemented to calculate mch states , this representation is the natural one to perform on - the - fly dynamics simulations .",
    "let us now consider additional terms in the hamiltonian , in particular terms which are not included in the hamiltonian employed by standard quantum chemistry software .",
    "these additional terms together with the mch form the total hamiltonian , @xmath65 where @xmath66 represents the additional terms that are responsible for the process under investigation .",
    "these could be , for example , the interaction between molecular dipole moments and an external electric field @xmath67 , which allows describing absorption and stimulated emission of electromagnetic radiation .",
    "for the purpose of this contribution  the description of isc ",
    "@xmath66 is equal to the spin - orbit operator .",
    "details on the calculation of soc are beyond of the scope of this work and can be found elsewhere.@xcite upon inclusion of additional terms , the matrix representation of the total hamiltonian in the mch representation @xmath68 ( now with matrix elements @xmath69 ) is not diagonal anymore , since the eigenstates of the mch and the eigenstates of the total hamiltonian are , in general , not identical .",
    "importantly , the off - diagonal couplings in @xmath68 are usually delocalized over the pes  a fact not optimal for surface hopping , since delocalized couplings can lead to a non - zero transition probability also far away from crossing regions .",
    "such a situation necessitates a much larger number of trajectories to sample the process correctly because surface hops may occur in a much larger phase space volume .",
    "besides introducing off - diagonal elements in the hamiltonian , the spin - orbit operator lifts the degeneracy between states with the same spatial wavefunction and same @xmath60 but different @xmath61 ( the _ components _ of a multiplet ) .",
    "as a consequence , the investigation of isc requires to take into account all components of the relevant spin multiplets explicitly and each multiplet of spin @xmath60 will contribute @xmath70 states to the model space in the simulation .",
    "importantly , in surface hopping simulations , the sum of the transition probabilities into all multiplet components should be independent of rotation of the molecule in the laboratory frame . as shown by granucci et al.,@xcite this requirement",
    "is not fulfilled by surface hopping in the mch representation ( including socs as the non - diagonal elements of @xmath68 ) , which is a problem of the mch representation in the presence of socs . in other words ,",
    "if socs are included , the mch basis should be regarded as sub - optimal for surface hopping .",
    "a solution to this problem is to choose a different basis ",
    "one in which the total hamiltonian matrix is diagonal .",
    "this can be achieved by a unitary transformation from the mch basis to what we call the _ diagonal basis _ : @xmath71 henceforth , we exclusively discuss matrix representations of the _ total _ hamiltonian , so that @xmath42 always has matrix elements @xmath72 .    by definition ,",
    "the matrix representation of the total hamiltonian in the diagonal representation @xmath73 is diagonal . @xmath74",
    "all couplings between the diagonal states are described by the non - adiabatic couplings @xmath75 . since the non - adiabatic couplings only become large when two pes are close to each other , the requirement that all couplings are localized is fulfilled .",
    "additionally , the diagonalization solves the problem of rotational invariance of the multiplet components , since the eigenstates of the hamiltonian do not depend on the molecular orientation : any rotation of the spin quantization axis could be described by a unitary transformation of the hamiltonian @xmath76 , which is similar to the original hamiltonian and hence has the same eigenvalues . since the diagonal representation ( also refered to as  fully adiabatic  in reference@xcite ) solves the problems of coupling localization and rotational invariance , and also best describes the energetics of the system , it can be regarded as the optimal representation to perform surface hopping for isc .",
    "for completeness , we also discuss the so - called `` diabatic '' representation.@xcite this representation is defined by having time- or geometry - independent basis functions ( also called `` crude adiabatic '' basis@xcite ) , which means that a diabatic basis has @xmath77 and likewise @xmath78 .",
    "the coupling between diabatic states is described by off - diagonal terms in the hamiltonian .",
    "this basis has the advantage that no diverging non - adiabatic couplings need to be considered , and the couplings in the hamiltonian are easier to treat numerically .",
    "another merit of using this electronic basis is that experimental observables are not strongly geometry - dependent and therefore , dynamical results in a diabatic basis facilitate discussion with respect to experiments .",
    "the disadvantage of this basis is that , in general , it is not clear whether strictly diabatic states for polyatomic molecules",
    "exist@xcite and only a `` quasi - diabatic '' basis can be constructed , where most non - adiabatic couplings are small .",
    "an additional problem of the usage of a diabatic basis is the need to first diabatize the adiabatic states obtained from quantum chemistry , a procedure which is usually not possible with on - the - fly techniques .",
    "hence , diabatic basis functions are in general not applicable to surface hopping simulations , at least not for full - dimensional treatments of larger molecules using the on - the - fly approach .",
    "the three electronic representations discussed before are illustrated in figure  [ fig : bases ] , which show examples for pes of a model system .",
    "on the left side , a two - state system is shown . in panel ( a ) , two diabatic states , say @xmath79 and @xmath80 , show a crossing in the center of the plot . for the purpose of this example , we assume an arbitrary total energy ( indicated by a dashed line ) , which is not sufficient to reach the crossing and therefore access the right potential well . hence , in a surface hopping simulation using these underlying potentials , the system would stay exclusively in the left minimum . in panel ( b ) , the same states are plotted in the mch representation . now the electronic wavefunction character is not preserved and hence the states are called @xmath81 and @xmath82 ( by energetic ordering ) .",
    "these states show a crossing strongly avoided , which lowers the energy barrier and makes accessing the right minimum classically allowed . in this representation , a classical dynamics simulation ( e.g. , with surface hopping ) , would visit both minima .",
    "the comparison of panels ( a ) and ( b ) clearly exemplifies the fact that the electronic representation has a direct influence on classical trajectories , which is one of the reasons why the results of surface hopping are indeed not invariant to the representation .",
    "panel ( c ) shows that in the absence of additional couplings the mch representation is identical with the diagonal representation .",
    "the distinction between mch and diagonal representation comes into play only if @xmath83 .    on the right side of figure",
    "[ fig : bases ] , we show an exemplary three - state system ( two singlets and one triplet ) , which are coupled by soc . in panel",
    "( d ) , the diabatic pes of the @xmath79 and @xmath80 are unchanged compared to ( a ) , since the socs only appear as off - diagonal elements of the hamiltonian .",
    "the same holds true for panel ( e ) , which is identical to ( b ) except for the addition of the triplet state . only when transforming from the mch to the diagonal representation ( panel ( f ) )",
    "the pes are affected by soc .",
    "importantly , soc lifts the degeneracy of the triplet components , giving rise to five states in total",
    ". a trajectory will explicitly depend on which triplet component it is moving in , again showing that the choice of the representation directly influences the result of classical trajectories , and that the diagonal representation performs best in this regard . together with the fact that the diagonal representation optimally localizes all couplings in @xmath42 and @xmath51 , we conclude that this representation is indeed optimal for surface hopping .",
    "one should note , however , that the validity of other representations depends crucially on the strength of the coupling between the electronic states .",
    "if the socs are large , a large effect on the form of the pes can be expected and the diagonal representation is mandatory .",
    "for very weak soc , the pes are only weakly deformed and other representations should yield approximately the same results , which justifies the usage of , e.g. , the mch representation in some forms of surface hopping including additional couplings.@xcite      currently there is no quantum chemistry program able to calculate all necessary properties needed for surface hopping in the diagonal basis . while gradients of diagonal states including soc are already described for semi - empirical wavefunctions,@xcite no such gradients are available up to now for ab initio electronic structure methods and neither are the corresponding non - adiabatic couplings . furthermore , quantum chemistry in the diagonal basis including socs ( see references  @xcite and references therein ) is in many cases significantly more expensive than quantum chemistry in the mch basis .",
    "the higher cost is related to the fact that the spin - orbit hamiltonian does not commute with @xmath9 or @xmath10 and hence it is not block - diagonal . additionally , more demanding basis sets are usually required@xcite for quantum chemical calculations in the diagonal basis than for mch ones .    as a consequence ,",
    "quantum chemistry in the mch basis is nowadays the most advanced one .",
    "a number of quantum chemistry software suites have efficient implementations of analytical gradients , non - adiabatic couplings and soc matrix elements,@xcite which can be employed for the on - the - fly calculations of surface hopping .",
    "hence , a pragmatical approach for trajectory surface hopping methods is to combine quantum chemical data in the mch representation with surface hopping in the diagonal representation .",
    "this is the essence of the ab initio molecular dynamics methodology sharc,@xcite recently developed in our group .",
    "the basic idea is to construct the matrix representation of the total hamiltonian in a _ small set of relevant mch states _ ( the model space ) and diagonalize the hamiltonian only in this small basis .",
    "the socs between the model space states and all remaining states are neglected , making this a form of quasi - degenerate perturbation theory ( `` qdpt '' , see , e.g. , reference  @xcite ) .",
    "the obtained eigenstates are approximations to the true eigenstates of @xmath84 , but for small soc this is a good approximation .    in the following , we describe how to perform surface hopping in a diagonal basis obtained from qdpt , as it is implemented in the sharc code.@xcite      to make surface hopping in the diagonal representation practical , one needs a suitable equation of motion for the diagonal coefficients @xmath85 and a corresponding expression for the hopping probabilities @xmath86 based on the mch quantities @xmath87 and @xmath64 .",
    "additionally , one needs to construct the diagonal gradient @xmath88 from the mch gradients .",
    "we start with the equation of motion   in the mch basis : @xmath89    \\mathbf{c}^{\\text{mch}}.\\label{eq : eom_mch}\\ ] ] the diagonal wavefunction coefficients @xmath85 can be easily obtained from @xmath90 , using the transformation matrix @xmath91 : @xmath92 inserting the latter into equation ( [ eq : eom_mch ] ) and pre - multiplying with @xmath93 , we obtain : @xmath94\\mathbf{u }    \\mathbf{c}^{\\text{diag } }    -\\mathbf{u}^\\dagger\\frac{\\mathrm{d } \\mathbf{u}}{\\mathrm{d } t }    \\mathbf{c}^{\\text{diag}},\\label{eq : eom_diag}\\ ] ] note how the last term on the right - hand side arises since the transformation matrix @xmath91 implicitly depends on time via the time dependence of the hamiltonian . given a coefficient vector @xmath95 and the matrices @xmath87 and @xmath64 ,",
    "equation   can be integrated using standard runge - kutta - type numerical methods , or using the exponential operator method for sufficiently short time steps : @xmath96    \\mathbf{c}^{\\text{diag}}(t ) ,    \\label{eq : one - step - prop}\\ ] ] where we omitted the explicit time - dependence of @xmath91 , @xmath87 and @xmath64 for brevity .",
    "however , in this scheme the term @xmath97 leads to serious numerical difficulties .",
    "first , the unitary matrix @xmath91 is not uniquely defined by equation    each eigenvector could be multiplied by a complex phase factor @xmath98 and still be an eigenvector to the same eigenvalue .",
    "this non - uniqueness makes it impossible to calculate @xmath97 from finite differences , because @xmath91 is not continuous .",
    "second , @xmath97 may become large if two mch states cross and the norm of their mutual coupling tends to zero , which can generally occur in all systems . using shorter time steps @xmath99 alleviates the problem , but the numerical precision of usual floating point calculations limits the size of the time step .",
    "furthermore , if the mutual coupling is zero , @xmath97 diverges .",
    "these problems can be easily circumvented by integrating ( for small @xmath99 ) the equation of motion in the mch basis  , @xmath100    \\mathbf{c}^{\\text{mch}}(t),\\ ] ] and only then inserting equation  : @xmath101    \\mathbf{u}(t )    \\mathbf{c}^{\\text{diag}}(t ) .",
    "\\label{eq : three - step - prop}\\ ] ] in this way , one obtains a propagation equation which is fully equivalent to  , but where @xmath97 is not explicitly involved . note that this equation describes a propagation which proceeds in three distinct steps :    1 .   transforming @xmath102 to @xmath103 , 2 .",
    "propagating @xmath103 to @xmath104 , and 3 .   transforming @xmath104 to @xmath105 .",
    "we call this approach the _ three - step propagator _ , and write it in short as @xmath106 where @xmath107 is the propagator matrix in the mch basis , which acts on the mch coefficients at time @xmath19 to propagate it to time @xmath20 .",
    "we note here that @xmath107 could also be calculated differently from equation  , for example using the local diabatization procedure of granucci et al.@xcite the condition that the time step @xmath99 is short enough can be fulfilled by choosing a shorter time step for the electronic propagation than for the nuclear propagation and linearly interpolating the electronic properties ( see appendix a for the corresponding equations ) .",
    "the three - step - propagator methodology has a number of advantageous properties .",
    "first , it accomplishes our main goal , i.e. , formulating the propagation of the diagonal coefficients based on mch quantities .",
    "second , it is unitary ( the matrix exponential of an anti - hermitian matrix is always unitary ) , and thus the wavefunction norm is automatically conserved during the propagation . and third , the numerical computation of @xmath97 is avoided , providing a much more stable propagation with respect to the time step and the involved couplings in the hamiltonian .",
    "the following example shows the numerical superiority of the three - step propagator over the more nave single - step method in equation  .",
    "we consider a simple one - dimensional system consisting of two harmonic oscillators coupled by a constant off - diagonal term @xmath108 ( atomic units ) : @xmath109 the initial position of the system is set at @xmath110 in the upper diagonal state and the reduced mass is @xmath111 .",
    "we simulate a single pass of a trajectory through the crossing region and record the total change in the electronic populations depending on the strength of @xmath108 .",
    "we performed the simulations with equation   and a time step of @xmath112  fs .",
    "for comparison we also used equation  , with different time steps between @xmath113 and @xmath114  fs . in order to show that controlling the complex phases of the columns of @xmath91 is imperative when using equation  , results with and without phase control ( using the algorithm outlined in appendix b ) are shown .",
    "figure  [ fig : ex_1 ] shows the population of the initially empty state ( @xmath115 ) after passing the crossing . according to landau - zener theory ,",
    "for sufficiently small couplings , the population after the crossing @xmath116 should be proportional to @xmath117 .",
    "the three - step propagator shows the expected proportionality of @xmath116 and @xmath117 , even though a comparatively long time step was employed .",
    "even if @xmath108 is set equal to zero the three - step propagator delivers the correct result of zero population transfer .",
    "the one - step propagator data shows that equation   only performs well when the coupling @xmath108 is large , while for smaller couplings , population transfer is systematically overestimated .",
    "the use of comparatively smaller time steps helps in the case of small couplings , but even the shortest time step of @xmath114  fs fails for @xmath118 @xmath119 when using the one - step propagator .",
    "when @xmath108 tends to zero , equation   predicts that the population @xmath116 tends to one , which is of course unphysical .",
    "not controlling the phase of @xmath91 leads to a completely erratic behaviour and a much too large population transfer , which is basically independent from @xmath108 .",
    "the message from this figure is that the one - step propagator is very dangerous to use in the presence of very small couplings .",
    "this is a very serious problem in isc simulations because , even though a limited number of soc matrix elements may be large , the problematic small soc matrix elements are generally present in all systems . especially in small molecules , the selection rules of soc",
    "render some matrix elements equal to zero , and the el - sayed rule@xcite predicts that socs between states with very similar wavefunction character are small .",
    "therefore , the use of the three - step propagator method as outlined above is recommended to avoid the problems in the wavefunction propagation in such situations .",
    "the use of the matrix exponential for the propagation of the coefficients is not compatible with the original expression for the hopping probabilities given by tully.@xcite in the diagonal representation , this expression contains @xmath120 , which according to equation  [ eq : eom_diag ] explicitly depends on @xmath97 , giving rise to the numerical problems mentioned above .",
    "consequently , it is necessary to obtain a different expression for the hopping probabilities @xmath121  yet based on the fewest switches criterion .",
    "here we use a variant of the equation derived in reference  @xcite , where the hopping probability @xmath121 is just a function of the old and new coefficients and the propagator matrix : @xmath122      } {        \\left|          c^{\\text{diag}}_\\beta(t )        \\right|^2        -\\re\\left [          c^{\\text{diag}}_\\beta(t+\\delta t )          \\left(p^\\text{diag}_{\\beta\\beta}\\right)^ *          \\left (            c^{\\text{diag}}_\\beta(t )          \\right)^ *        \\right ]      } .",
    "\\label{eq : probabilities}\\ ] ] negative hopping probabilities are set to zero , as is @xmath123 . the equation can be derived similarly as in reference@xcite , but using @xmath124 instead of @xmath125 .",
    "one advantage of equation   over the one in reference@xcite is that the denominator in equation   does not tend to zero when the population transfer becomes large , giving more accurate results .",
    "moreover , equation   has the nice property that the hopping probabilities are not affected by the non - uniqueness of the transformation matrix @xmath91 .",
    "hence , no phase adjustment between @xmath126 and @xmath127 is necessary at all in the sharc methodology .",
    "after the propagation for a particular time step has been performed , equation   can be directly used to calculate hopping probabilities . to choose the active state for the next time step , a random number @xmath59 from the interval @xmath128",
    "is selected .",
    "a hop to state @xmath33 is performed , if @xmath129 i.e. , if the random number @xmath59 lies in an interval with a width proportional to the hopping probability .",
    "equations  , and define all that is needed to perform the electronic part of the surface hopping algorithm , namely to determine the active state for the next time step .",
    "the remaining necessary element of an algorithm for surface hopping in the diagonal representation is the construction of the gradient of the diagonal states .",
    "we start with the derivative of a matrix element of the total hamiltonian in the diagonal basis : @xmath130 by applying the product rule to the left - hand side and using the fact that the @xmath131 are the eigenfunctions of @xmath84 , equation   can be rearranged to@xcite @xmath132 where @xmath133 and @xmath134 are eigenvalues of the total hamiltonian and @xmath135 is a matrix element of the non - adiabatic coupling matrix @xmath136 ( note that the elements of @xmath136 are itself vectors in the space of the nuclear distortions ) .",
    "importantly , this equation contains @xmath137 , which is the diagonal gradient necessary for the dynamics .    the left - hand side of equation   can be written in terms of the mch states and the transformation matrix @xmath91 as @xmath138 the critical term in this equation is the derivative of the additional hamiltonian terms with respect to the nuclear displacements @xmath139 .",
    "if  as in the present case  @xmath140 is a spin - orbit operator , then this derivative is ( up to our knowledge ) not available from standard ab initio software .",
    "however , due to the short - range nature of the spin - orbit interaction,@xcite the derivative @xmath139 is expected to be small , and is hence ignored .",
    "the remainder of equation   can thus be written as @xmath141 as the @xmath142 are the eigenfunctions of @xmath143 , we can use an analogue form of equation   to arrive at @xmath144.\\ ] ] if we define the general gradient matrix in an arbitrary representation @xmath145 with matrix elements @xmath146 then we can write the above equation compactly as @xmath147    equations   and give a rule how to obtain the diagonal gradients and non - adiabatic couplings from the mch gradients and non - adiabatic couplings . from an algorithmic point of view , the diagonal vector properties can be obtained in the following steps :    1 .",
    "obtain the energies @xmath148 , gradients @xmath149 and non - adiabatic couplings @xmath150 from quantum chemistry .",
    "2 .   construct @xmath151 from these quantities using equation  .",
    "3 .   transform @xmath151 into the diagonal basis using equation  .",
    "4 .   obtain the diagonal gradients @xmath152 .",
    "if needed , obtain the non - adiabatic coupling vectors in the diagonal basis @xmath153 .",
    "as one can see from the last paragraphs , the gradients in the diagonal basis are linear combinations of the mch gradients and the non - adiabatic coupling vectors . therefore , even if only a single diagonal gradient is needed , several mch gradients and coupling vectors need to be obtained from quantum chemistry . compared to dynamics in the mch basis , where only a single gradient needs to be computed at each time step , for dynamics in the diagonal basis , in principle ,",
    "all gradients are required , adding computational cost to the simulation .    as a consequence of",
    "the above - said , the surface hopping procedure needs the non - adiabatic coupling vectors for two distinct steps : the wavefunction propagation and the gradient transformation .",
    "unfortunately , the calculation of non - adiabatic couplings is presently only available in some quantum chemistry codes .",
    "if non - adiabatic couplings are not available , it is still possible to calculate the propagator matrix @xmath154 using other schemes , see , e.g. , references  @xcite .",
    "however , for the gradient transformation no alternative schemes without non - adiabatic couplings are available , and , as an approximation @xmath150 has to be neglected in equations   and .",
    "this introduces an error which is largest near weakly - avoided crossings ( precisely where @xmath150 is large ) .",
    "figure  [ fig : ex_2 ] shows the total energy of two exemplary trajectories , .",
    "the initial velocities of all atoms were zero , except for the terminal hydrogen atoms , which had velocities of 0.008  a.u .  out of the molecular plane and in opposite directions , thus giving some initial momentum for torsion around the c = c double bond.@xcite ] one calculated with equations   and and another where @xmath150 is neglected .",
    "as it can be seen in this extreme case , neglecting the contribution of the mch non - adiabatic coupling vectors to the diagonal gradients leads to a violation of energy conservation already after a few fs .",
    "hence , whenever possible it is recommended to include the non - adiabatic couplings in the gradient calculations or , if these are not included , one should check the total energy conservation carefully .          to summarize , given some initial geometry @xmath24 , velocity @xmath155 , acceleration @xmath156 , coefficients @xmath157 and active state @xmath158 , the following steps should be performed to propagate the dynamics to time @xmath20 :    1 .",
    "use equations   and to find the new geometry @xmath28 .",
    "2 .   obtain @xmath87 , @xmath64 and the gradients @xmath159 from quantum chemistry software .",
    "3 .   find @xmath91 from equation  .",
    "use equations   and to find @xmath160 .",
    "use equations   and to find the new velocity @xmath161 .",
    "use equation   to find the propagator @xmath162 and the new coefficients @xmath163",
    "use equation   to find the hopping probabilities @xmath121 and equation   to find the new active state @xmath164",
    "if a hop occured , ensure total energy conservation by adjusting @xmath161 as in regular surface hopping ( see , e.g. , references  @xcite ) .",
    "apply some form of decoherence correction@xcite to the diagonal coefficients @xmath163 .",
    "a few comments regarding the different electronic state representations encountered in this workflow are appropriate at this point .",
    "first , it should be mentioned that using mch quantum chemistry data to perform dynamics in the diagonal basis is actually an approximation based on a qdpt treatment and hence neglects the coupling to states outside the model space . moreover",
    ", the fully consistent diagonal gradients could only be calculated if the derivatives of the socs were known . however , in view of the current state - of - the - art of quantum chemistry ,",
    "dynamics directly in the diagonal basis is not possible because the necessary properties are not available .",
    "second , while the diagonal representation is optimal for surface hopping dynamics , it is not optimal for the interpretation of the results , since the character and spin of the diagonal states is geometry - dependent . therefore , it is usually advantageous to transform the results ( e.g. , populations ) back into the mch basis , where the states can be characterized by their @xmath60 and @xmath165 quantum numbers .",
    "this facilitates , for example , the distinction between ic and isc processes , which are otherwise equivalent in the diagonal picture .",
    "of course , this _ a posteriori _ transformation to mch states is reasonable only for systems with soc small enough so that the @xmath166 coupling scheme is valid . third , a transformation of the results from the mch into a `` spectroscopic '' basis ( an approximate diabatic basis where spectroscopic observables depend strongly on the state , but weakly on geometry , e.g. , states of @xmath167 and @xmath168 character ) is even more convenient than the mch basis to facilitate the interpretation of the results and is recommended as long as an _ a posteriori _ diabatization scheme can be devised for the system .",
    "in this contribution it has been shown how spin - orbit coupling ( soc ) can be treated on the same footing as non - adiabatic coupling in semi - classical surface hopping trajectory methods . to this aim",
    ", a general and accurate approach relying on the diagonalization of the electronic hamiltonian including all potential couplings has been described .",
    "this methodology was coined `` surface hopping including arbitrary couplings '' ( sharc ) in our original publication@xcite because it is not limited to soc , but can treat all kinds of couplings in the same fashion .",
    "an on - the - fly implementation of this methodology is available in the sharc molecular dynamics suite.@xcite    while the sharc methodology is generally applicable to very large systems ( due to the classical nuclear dynamics approach ) , the size of the systems for which isc can be studied is actually limited by the availability of suitable quantum chemistry methods .",
    "these methods need to provide accurate excitation energies , analytical gradients , soc matrix elements , and non - adiabatic couplings ( or equivalent properties like overlap matrices@xcite ) for several excited states at once .",
    "if laser interactions are considered in the framework of sharc ( few applications are found in the literature so far@xcite ) , then the quantum chemistry also needs to provide transition dipole moments .",
    "additionally , the quantum chemical methods should be able to give a balanced and accurate description of all states over the whole potential energy surface , which usually requires multi - configurational wavefunctions .",
    "these requirements are currently fulfilled for several implementations@xcite of the multi - configurational self - consistent field ( mcscf ) method@xcite and for multi - reference configuration interaction ( mrci ) as implemented in columbus.@xcite using mcscf or mrci , already a number of isc dynamics simulations have been reported using sharc.@xcite    the progress of general ab initio molecular dynamics schemes like sharc strongly depends on the development of electronic structure methods that can go beyond mcscf , which is one of the most popular methods for on - the - fly excited - state dynamics .",
    "a obvious step further is complete - active - space perturbation theory ( e.g. , caspt2@xcite ) , which offers very good accuracy ( oftentimes better than mrci ) and performance ( usually much faster than mrci ) .",
    "few surface hopping studies based on caspt2 have been reported already,@xcite albeit no isc dynamics simulation has been published until now , since no current implementation of caspt2 can provide all necessary quantities .",
    "other promising electronic structure methods are , e.g. , the approximately size - consistent mrci variant linear - response - theory multi - reference average - quadratic coupled - cluster ( lrt - mraqcc)@xcite or density matrix normalization group ( dmrg ) approaches.@xcite furthermore , it will be possible to employ time - dependent density functional theory ( tddft ) in isc dynamics studies with the help of recent developments,@xcite although care has to be taken that the excited - state potential energy surfaces are described correctly in the case of strongly multi - configurational state character .",
    "semi - empirical electronic structure methods for excited states@xcite are very efficient in comparison to ab initio or tddft methods and can be applied as well to isc dynamics simulations .",
    "there is already an implementation equivalent to sharc,@xcite which has been applied to study isc dynamics on thioguanine.@xcite additionally , semi - empirical calculations of isc dynamics already have been carried out using a conventional surface hopping approach,@xcite i.e. , without the advantages provided by the sharc methodology as outlined in this contribution . in any case , the availability of tddft and semi - empirical methods for surface hopping will open wide opportunities to describe larger molecules or achieve longer propagation times than it is currently feasible with multi - configurational wavefunction methods .",
    "a further challenge in trajectory surface methods is to include an efficient and accurate description of solvents and complex molecular environments in the dynamics .",
    "considerable effort in this direction has already been made for standard surface hopping using mixed quantum - mechanics / molecular - mechanics ( qm / mm ) methods , in which the main chromophore is treated quantum - chemically and the environment with force fields.@xcite    finally , in order to relate the computational results to experimental data , not only the excited - state dynamics has to be simulated , but also the subsequent processes occuring during the experimental probing , i.e. , it is necessary to actually simulate the experimental observables .",
    "a typical example is transient absorption spectroscopy,@xcite which can be simulated by including highly excited states and the corresponding transition dipole moments in the calculations .",
    "however , an accurate description of these highly excited states is far from trivial .",
    "another typical probing technique is based on ionization of the studied molecule , yielding for example time - dependent photo - electron spectra.@xcite in order to simulate such ionizations , it is necessary to describe the wavefunctions of the neutral system , the ionized species as well as the outgoing electron ; from these wavefunctions , the corresponding wavefunction overlaps as well as the associated transition dipole moments need to be calculated .",
    "this is quite a formidable task that has not yet been achieved in full , so that a detailed understanding of molecular ionization is still out of reach .",
    "therefore , further developments are necessary to achieve the ultimate goal of simulating all the processes involved in actual experiments from the beginning to the end .",
    "yet , given the increasing interest in dynamical processes including isc , it is expected that the coming years will see an increasing number of surface hopping trajectory method simulations .",
    "this work is supported by the austrian science fund ( fwf ) through the project p25827 .",
    "the authors are specially thankful to the past and present members of the development team of sharc ",
    "m.  richter , j.  gonzlez - vzquez , i.  sola , m.  oppel and m.  ruckenbauer  for their many contributions and discussions , and also to the many colleagues who through their questions and suggestions have contributed to improve sharc from the first to the current implementation .",
    "we are also indebted to t.  mller , t.  hoffmann - ostenhof , m.  persico and g.  granucci for inspiring discussions .",
    "the cost actions cm1204 ( xlic ) and cm1305 ( ecostbio ) are thanked for promoting different collaborative applications related to sharc .",
    "finally , the vienna scientific cluster ( vsc ) is gratefully acknowledged for generous allocation of computer time .",
    "equation   contains the propagation matrix @xmath107 in the mch basis . for small @xmath99",
    ", this matrix can be calculated from equation  . for too large @xmath99 , it is possible to split the interval into @xmath169 subintervals @xmath170 . here , we give the corresponding equations for the calculation of @xmath107 using subintervals .",
    "the propagator can be calculated by linearly interpolating @xmath171 and @xmath172 , using @xmath173,\\\\    \\mathbf{h}_i= &    \\mathbf{h}^{\\text{mch}}(t ) + \\frac{i}{n }    \\left (      \\mathbf{h}^{\\text{mch}}(t+\\delta t)-\\mathbf{h}^{\\text{mch}}(t )    \\right)\\label{eq : ham_propn},\\\\    \\mathbf{t}_i= &    \\mathbf{t}^{\\text{mch}}(t ) + \\frac{i}{n }    \\left (      \\mathbf{t}^{\\text{mch}}(t+\\delta t)-\\mathbf{t}^{\\text{mch}}(t )    \\right),\\end{aligned}\\ ] ] where the matrix elements of @xmath172 are @xmath174 ( classical tully scheme@xcite ) or @xmath175 ( hammes - schiffer - tully scheme@xcite ) .",
    "using the local diabatization scheme,@xcite the propagator is , instead , given by @xmath176,\\\\    \\mathbf{h}_i= &    \\mathbf{h}^{\\text{mch}}(t ) + \\frac{i}{n }    \\left (      \\mathbf{h}^{\\text{mch}}_{\\text{tra } }      -\\mathbf{h}^{\\text{mch}}(t )    \\right)\\label{eq : ham_propl},\\\\    \\mathbf{h}^{\\text{mch}}_{\\text{tra}}= &      \\mathbf{s}^{\\text{mch}}(t , t+\\delta t )      \\mathbf{h}^{\\text{mch}}(t+\\delta t )      \\mathbf{s}^{\\text{mch}}(t , t+\\delta t)^\\dagger,\\end{aligned}\\ ] ] where @xmath177 is the matrix representation of @xmath178 in the basis of the states at time @xmath19 .",
    "the overlap matrix @xmath179 has elements @xmath180      a hermitian matrix @xmath171 can always be diagonalized .",
    "its eigenvectors form the rows of a unitary matrix @xmath91 , which can be used to transform between the original basis and the basis of the eigenfunctions of @xmath181 : @xmath182    however , the condition that @xmath91 diagonalizes @xmath171 is not sufficient to define @xmath91 uniquely .",
    "each normalized eigenvector can be multiplied by a complex number on the unit circle and still remains a normalized eigenvector .",
    "we define a second transformation matrix @xmath183 , where @xmath184 is a diagonal matrix with elements @xmath185 ( i.e. , an eigenvector of @xmath186 is the same eigenvector of @xmath91 times a complex phase ) . by this definition , @xmath184 is unitary ( @xmath187 ) and commutes with @xmath188 , since two diagonal matrices always commute . with this properties",
    "it can be shown by @xmath189 that also @xmath186 diagonalizes @xmath171 and produces the same eigenvalues .    in most libraries for numerical diagonalization of hermitian matrices ,",
    "the eigenvector phases given in @xmath184 are either uncontrolled ( so that the phases depend on the details of the implementation ) or are fixed by some constraints ( e.g. , the first non - zero element of the eigenvector is made real - valued ) . however , by these conditions the eigenvector phases are not continuous in time  a small change in geometry from @xmath24 to @xmath28 may lead to a large jump in some eigenvector phases . since the transformation matrix with discontinuous phases",
    "@xmath190 is itself discontinuous , it is not differentiable .",
    "thus , it is not possible to calculate the antihermitian term @xmath191 from equation  , neither analytically nor by finite differences .",
    "attempting to calculate finite differences anyways will lead to a result that is not antihermitian and generally overestimates the size of the matrix elements of the differential .",
    "thus , attempting to use equation   for the propagation of the wavefunction and relying on the finite - difference calculation of @xmath191 without making the eigenvector phases ( approximately ) continuous will lead both to overestimated population transfer  possibly at any time  and to violation of the conservation of the wavefunction norm .    in order to facilitate the calculation of @xmath191",
    ", it is necessary to control the phase of the transformation matrix @xmath91 .",
    "specifically , this means that the phases of @xmath127 have to be aligned to the phases of @xmath126 .",
    "hence , given @xmath126 and @xmath192 , we need to find @xmath184 , which allows to obtain the phase - aligned transformation matrix @xmath127 : @xmath193 choosing @xmath194 would trivially accomplish the goal of phase alignment , since then @xmath195",
    ". however , this @xmath196 does not commute with @xmath197 .",
    "hence , we propose the following ansatz for @xmath196 : @xmath198    =    \\hat{\\mathcal{o } }    \\hat{\\mathcal{c } }    \\mathbf{v}.    \\label{eq : continuation}\\ ] ] here , the operator @xmath199 ensures that @xmath196 is orthogonal / unitary ( @xmath187 ) and @xmath200 ensures that @xmath196 commutes with @xmath188 ( @xmath201 ) .",
    "the commutation property can be achieved by defining @xmath202 where @xmath203 is the projection operator on the @xmath55-th eigenspace @xmath204 of @xmath197 : @xmath205 here , the vectors @xmath206 are the eigenvectors of @xmath197 . because @xmath188 is by definition diagonal , the elements of @xmath207 can be written very compactly as @xmath208 it is easy to show that with this definition @xmath209 .",
    "the property @xmath187 can be achieved if the operator @xmath199 orthonormalizes @xmath207 .",
    "the optimal orthonormalization scheme here is lwdin s symmetric orthonormalization,@xcite since it changes @xmath207 as little as possible.@xcite    the above - described algorithm leads for @xmath210 to @xmath211 .",
    "however , for finite @xmath99 , one has to take some care .",
    "for the special case that the eigenvalues are non - degenerate ( @xmath212 for all @xmath213 ) , one can show that @xmath214 using @xmath215 and reducing the @xmath216 gives : @xmath217 where @xmath218 is the @xmath33-th column vector of @xmath91 .",
    "it is important to stress here that this only holds if @xmath219 is real - valued , which will in general only be approximately true if no root flipping occurred between @xmath19 and @xmath20 ( i.e. , the @xmath33-th eigenvector at time @xmath20 is the same as the @xmath33-th eigenvector at time @xmath19 ) .",
    "thus , for finite timesteps @xmath99 we have to require that any root flipping is removed from @xmath220 .",
    "this can be accomplished by a simple algorithm that takes the matrix @xmath221 and brings it into diagonally dominant form by reordering its columns .    finally , it is crucial for the algorithm that @xmath99 is small .",
    "a criterion for smallness can be found from the antihermicity property of @xmath191 .",
    "this term can be calculated by finite differences as @xmath222 the antihermicity of @xmath191 requires that its diagonal elements be zero , and hence it can be followed that the diagonal elements of @xmath223 need to be close to 1 .",
    "hence , we can choose a threshold @xmath224 and require that @xmath225 if the condition is not fulfilled , a smaller value of @xmath99 is required .      1 .",
    "numerically diagonalize : @xmath226 .",
    "2 .   calculate @xmath220 .",
    "3 .   bring @xmath221 into diagonally dominant form by exchanging columns .",
    "4 .   obtain the matrix @xmath207 from equation  .",
    "orthonormalize @xmath207 by lwdin s symmetric orthonormalization.@xcite the result is @xmath196 .",
    "6 .   obtain the phase - controlled matrix @xmath227 .",
    "check whether condition   holds .",
    "if not , divide the interval @xmath228 $ ] into subintervals , linearly interpolate @xmath171 and carry out steps  1 to 6 for each subinterval . if the subintervals would be shorter than a given threshold , do not subdivide ( termination of the recursive algorithm ) .    finally , it should be stated that the algorithm outlined above also considers that the hamiltonian can have degenerate eigenvalues . in this case , the mixing angles between the degenerate states are also not uniquely defined , in addition to the eigenvector phases . in step  4 ,",
    "the operator @xmath200 ( see equation  ) keeps off - diagonal elements of @xmath221 corresponding to degenerate eigenfunctions , which leads to the removal of the arbitrariness in the mixing angles .",
    "h.  lischka , r.  shepard , i.  shavitt , r.  m. pitzer , m.  dallos , t.  mller , p.  g. szalay , f.  b. brown , r.  ahlrichs , h.  j. bhm , a.  chang , d.  c. comeau , r.  gdanitz , h.  dachsel , c.  ehrhardt , m.  ernzerhof , p.  hchtl , s.  irle , g.  kedziora , t.  kovar , v.  parasuk , m.  j.  m. pepper , p.  scharf , h.  schiffer , m.  schindler , m.  schler , m.  seth , e.  a. stahlberg , j .-",
    "zhao , s.  yabushita , z.  zhang , m.  barbatti , s.  matsika , m.  schuurmann , d.  r. yarkony , s.  r. brozell , e.  v. beck , , j .-",
    "blaudeau , m.  ruckenbauer , b.  sellner , f.  plasser , j.  j. szymczak : columbus , an ab initio electronic structure program , release 7.0 ( 2012 ) .",
    "f.  aquilante , l.  de  vico , n.  ferr , g.  ghigo , p .-  .",
    "malmqvist , p.  neogrdy , t.  b. pedersen , m.  pitok , m.  reiher , b.  o. roos , l.  serrano - andrs , m.  urban , v.  veryazov , r.  lindh : _ j. comput",
    "_ , * 31 * , 224 ( 2010 ) ."
  ],
  "abstract_text": [
    "<S> intersystem crossing is a radiationless process that can take place in a molecule irradiated by uv - vis light , thereby playing an important role in many environmental , biological and technological processes . </S>",
    "<S> this paper reviews different methods to describe intersystem crossing dynamics , paying attention to semiclassical trajectory theories , which are especially interesting because they can be applied to large systems with many degrees of freedom . </S>",
    "<S> in particular , a general trajectory surface hopping methodology recently developed by the authors , which is able to include non - adiabatic and spin - orbit couplings in excited - state dynamics simulations , is explained in detail . </S>",
    "<S> this method , termed sharc , can in principle include any arbitrary coupling , what makes it generally applicable to photophysical and photochemical problems , also those including explicit laser fields </S>",
    "<S> . a step - by - step derivation of the main equations of motion employed in surface hopping based on the fewest - switches method of tully , adapted for the inclusion of spin - orbit interactions , is provided . </S>",
    "<S> special emphasis is put on describing the different possible choices of the electronic bases in which spin - orbit can be included in surface hopping , highlighting the advantages and inconsistencies of the different approaches .    biblabel[1]#1 . </S>"
  ]
}