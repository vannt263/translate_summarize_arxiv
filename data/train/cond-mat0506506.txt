{
  "article_text": [
    "the calculation of the expectation value of some operator @xmath0 in a system in contact with a heath - bath of temperature @xmath1 @xmath2 is the usual task of equilibrium statistical mechanics . here @xmath3 and @xmath4 are , respectively , the energy and the value of @xmath0 associated to the @xmath5-th configuration , and the sum runs over all possible configurations .",
    "these expectation values are usually impossible to calculate analytically , but there are many techniques to approximate expectation values in the canonical ensemble .",
    "some of them are quite powerful and general , like high - temperature expansions and renormalization group techniques .",
    "a different approach , quite successful in many applications , is the numerical simulation ( `` monte carlo simulation '' ) of the ensemble @xcite .",
    "this paper is concerned with the histogram method , introduced years ago to extrapolate the results of a monte carlo simulation conducted at a point in parameter space for instance , some given temperature and magnetic field , to a range of those parameters .",
    "it was formulated by by ferrenberg and swendsen @xcite , although there are some earlier proposals @xcite . for completeness ,",
    "a short description of this technique follows : assume for instance that one has a model where the only control parameter is the temperature , and wants to compute the behavior of some function @xmath6 of the energy @xmath7 . at some given @xmath1 one performs a monte carlo simulation using any given algorithm that generates @xmath8 configurations with the correct probability , given by their boltzmann weight , measures @xmath9 for each configuration , and calculates finally the average value @xmath10 .",
    "this average may be taken directly , or going through the preliminary construction of a normalized histogram @xmath11 for the energies found in the simulation .",
    "one can write then @xmath12 which is approximation to eq .",
    "( [ expectval ] ) with @xmath13 .",
    "this equation can also written in terms of the density of states @xmath14 @xmath15 comparing eqs .",
    "( [ gethistogram ] ) and  ( [ density ] ) it is clear that @xmath11 is proportional to @xmath16 , and so an approximation for the density of states ignoring normalization for the moment is given by @xmath17 .",
    "notice that @xmath14 is a property of the system itself , independent of temperature .    with an approximated density of states at hand the results of the simulation",
    "are extended to other temperatures .",
    "( [ density ] ) written for a different temperature @xmath18 gives @xmath19 and one says that the histogram @xmath11 has been _",
    "in general , with the histogram method results obtained at a given point in the space of control parameters can be extrapolated to a neighborhood of that point .",
    "however , the implementation of the method can be cumbersome for models with more than one parameter , because the size of the histograms generated becomes too large .",
    "for instance , an ising model in a simple cubic lattice , with nearest - neighbor , next - nearest - neighbor and magnetic couplings has a 3d parameter space .",
    "when applying the histogram method to this system one faces the problem of handling a histogram with a total number of bins that rapidly becomes impossible to accommodate in the computer s physical memory .",
    "for instance , for a very modest size @xmath20 , one needs to store some @xmath21 possible values for each of the 3 couplings , and this gives a histogram with around @xmath22 bins . working with 4 byte integers ( which may be insufficient for very large runs ) gives a memory requirement around 250 gbytes , realizable in large workstations and supercomputers , but usually beyond the reach of the commodity machines used by many scientist today @xcite .    among possible solutions one could coarse - grain the binning of the histogram (",
    "this is unavoidable if one is dealing with continuous variables , like in the _ xy _ or heisenberg models ) ; one could also store a record of the operators of interest for all configurations generated by the monte carlo algorithm ( this has been recommended for hamiltonians with continuous variables @xcite ) . here",
    "i propose a different option that arises from two simple facts : one , most of the quantities one is interested in calculating can be expressed in terms of moments of the same operators that constitute the hamiltonian .",
    "two , the reweighting function can be easily expanded in a power series .",
    "then , the physical quantities one wants to estimate at different values of the couplings can be obtained as power series in the increments of said couplings , using the moments of the operators obtained at some fixed point in parameter space as coefficients .",
    "a similar approach was proposed in ref .",
    "@xcite , using cumulants instead of moments ; this approach via moments is bit simpler . here",
    "i also show some details of implementation needed to insure larger ranges of numerical convergence .",
    "to fix ideas , i shall use a simple example , namely , the ising model with zero magnetic field .",
    "the hamiltonian is @xmath23 assume now that one calculates the expectation value of some power of the magnetization , say @xmath24 , at some given temperature @xmath1 .",
    "define for convenience the adimensional energy operator @xmath25 and the couplings @xmath26 . from eq .",
    "( [ expectval ] ) one gets @xmath27 now , if one wants to calculate this same expectation value at some other temperature , one could store the histogram for @xmath28 and then reweight it .",
    "but one can also write the desired expectation value @xmath29 and expand the exponential containing @xmath30 in a taylor series @xmath31 for finite systems the order of the sums can be safely interchanged , giving @xmath32 \\sum_i { m_i^2 \\theta_i^n \\exp(k \\theta_i ) } } }   { \\sum_{n=0}^\\infty{[(k - k^\\prime)^n / n ! ]   \\sum_i { \\theta_i^n \\exp(k \\theta_i)}}}.\\ ] ] one can now divide numerator and denominator by the partition function @xmath33 and find that the terms at the end of both expressions are the expectation values ( moments , in short ) , of @xmath34 and @xmath35 , respectively , taken at @xmath36 . denoting @xmath37",
    "one gets @xmath38",
    "since the expansion of the exponential function is convergent everywhere , there is no _ a priori _ limitation for this approach .",
    "but it is clear that one can never actually calculate all the required moments , and a truncation needs to be applied .",
    "this immediately introduces very strong bounds in the applicability of the method , since for large @xmath39 the two sums in the previous expression require the inclusion of higher and higher moments if reasonable results are going to be obtained .",
    "a discussion about the number of moments needed to insure certain range of convergence is given later on .",
    "once the series are truncated , one faces a more serious difficulty : consider again the @xmath40 example , and assume that a simulation has been conducted in a lattice with @xmath41 spins . since @xmath42 is an extensive quantity ,",
    "@xmath24 is of order @xmath43 , and the range of @xmath36 where some degree of numerical convergence can be achieved is quite small . to find a way around this problem at least partially , begin by working with densities instead of with the original operators",
    "going back to our example , define @xmath44 and @xmath45 .",
    "the previous expression is rewritten as @xmath46 now it is clear that , since @xmath47 is of order one , one may expect numerical convergence of the _ strongly truncated _",
    "series up to @xmath48 which is a very narrow range ; here ` strongly truncated ' means a series with a few terms , say , less than 20 .",
    "this is actually a very conservative bound , since the @xmath49 in the denominators improve numerical convergence ( and guarantees it for the infinite series ) .",
    "the convergence of the truncated series can be improved if one notices that the desired moments are taken from a sharply peaked distribution .",
    "the combination of the fast increasing density of states @xmath50 and the fast decreasing boltzmann weight implies the existence of a narrow distribution @xmath51 that is , the histogram in @xmath52 , centered in some value @xmath53 .",
    "going back now to eq .",
    "( [ momentofm2 ] ) , one may see that the zero values of the operators appearing in the energy ( and therefore in the energy density ) can be easily shifted .",
    "for instance , if one shifts the density @xmath52 by some value @xmath54 , the expectation value for @xmath55 becomes @xmath56 since the factors of @xmath57 cancel in the fraction .",
    "now , if the value one chooses for @xmath54 is close to the center of the distribution , the moments one gets for @xmath58 are going to be numerically small and become smaller the higher the moment and the larger the lattice , simply because of the narrowness of the originating distribution . retracing the steps taken going from eqs .",
    "( [ start ] ) to  ( [ finish ] ) one gets the final expression for @xmath59 as @xmath60 where both numerator and denominator series have been truncated to @xmath61 terms . now the fast growth in the @xmath62 coefficients is partially balanced by a fast decrease in the values of @xmath63 and @xmath64 , and in this way the applicability of the method is extended to a much wider range in couplings .",
    "it is not too difficult to calculate the range of expected convergence of the extrapolation .",
    "in fact , for temperatures away from the critical point the width of @xmath51 is order @xmath65 , from where one gets a range of convergence for the extrapolation of @xmath66 which comes from estimating @xmath67 .",
    "close to the critical point the width of @xmath68 increases , and scales as @xmath69 . from here",
    "one estimates then a range of convergence @xmath70 here @xmath71 and @xmath72 are the exponents for specific heath and correlation distance close to the critical point , and @xmath73 is the dimensionality . for a small @xmath71",
    "this is still a much wider range than the one gotten when no shifts are used .",
    "notice that for the 2d ising model one replaces @xmath74 by @xmath75 and gets an scaling @xmath76    notice finally that the example given here , that extrapolates for @xmath55 , can be easily extended to any other lattice operator .",
    "a numerical test of the method was done for the two - dimensional ising model in square lattices of sizes 16 , 32 and 64 , with the hamiltonian given in eq .",
    "( [ ising2d ] ) .",
    "two monte carlo simulations were carried out using the wolff algorithm  @xcite , at a temperature of @xmath78 , close to the critical temperature for the model .",
    "all moments of the form @xmath79 and @xmath80 for @xmath81 were recorded .",
    "first a short run with no shifts in either @xmath52 or @xmath82 was done , using @xmath83 , @xmath84 and @xmath85 wolff iterations for @xmath86 , @xmath87 and @xmath88 , respectively , after discarding transients of @xmath89 , @xmath90 and @xmath91 iterations .",
    "the running time for this set of simulations was about @xmath92 seconds in a 2.4 ghz pentium 4 processor .",
    "the exact solutions for the energy and the specific heath were obtained from the analytic free energy for finite lattices found by kaufman  @xcite .",
    "( 1 ) shows the results of the extrapolation for the adimensional energy density @xmath47 using either 14 or 15 moments  @xcite , when no shift in @xmath52 has been implemented , compared with the exact results .",
    "it is clear that the range of applicability of the extrapolation is extremely narrow , as expected from eq .",
    "( [ rangenoshift ] ) .",
    "that estimate gives here @xmath93 and @xmath94 .",
    "this estimate is quite conservative , and the figure gives ranges of numerical convergence which are 2 to 3 times longer .",
    "the second simulation was a larger run where the results for @xmath47 and @xmath95 from the first were used as reference values @xmath54 and @xmath96 for the shifts .",
    "the total numbers of wolff iterations were @xmath97 , @xmath98 and @xmath99 for @xmath86 , @xmath87 and @xmath88 , respectively , after transients of @xmath89 , @xmath90 and @xmath100 iterations were discarded .",
    "the total time for this set of simulations was about @xmath101 seconds with the same processor .",
    "data were divided in 20 blocks in order to generate error estimates .",
    "extrapolation for energy and specific heath were calculated .",
    "the results for the energies are given in fig .",
    "( 2 ) , those for specific heath in fig .",
    "( 3 ) , and in both figures a comparison with the exact results is given .",
    "it is clear that the range of applicability of the extrapolation is larger , and actually a bit larger than the estimation made in eq .",
    "( [ rangecritical ] ) , which gives @xmath102 and @xmath103 .",
    "two important points should be remarked : first , for @xmath47 the direction in which the extrapolated curves deviate from the correct results , for low @xmath1 , depends on the number of moments taken into account ; they deviate upwards when one uses 14 moments , and downwards when using 15 moments .",
    "a similar behavior is found for @xmath104 , except that now the two extrapolations deviate in different directions _ at both ends _ of the range of convergence .",
    "this gives a very simple way of bounding the range of convergence of the algorithm .",
    "second , the statistical errors in the extrapolations grow as one moves away from the simulated temperature , but the effect of this growth is smaller than the effect of the change in the number of included moments . the behavior of both types of errors are given in fig .",
    "( 4 ) , which shows the difference between extrapolated and exact energies for @xmath105 .",
    "the behavior for errors is similar for the specific heath .",
    "notice that the statistical errors in the extrapolated results actually become smaller for temperatures a bit below the point where the simulation was carried out ; this curious phenomenon has been studied in full histogram extrapolations @xcite .",
    "the moments of @xmath82 were used to generate an extrapolated estimation of the susceptibility @xmath106 , defined by @xmath107 .",
    "this expression is used instead of the true susceptibility @xmath108 which in a numerical experiment does not give the expected peak close to the critical temperature @xcite . fig .",
    "( 5 ) shows a comparison between the extrapolated @xmath106 and values obtained in other individual simulations .",
    "these were obtained at their nominal temperatures using the wolff algorithm .",
    "it is remarkable how the extrapolated results manage to reproduce reasonable well the peak in the susceptibility . here",
    "one can also notice that the order of the approximation again decides in which direction the extrapolated results deviate form the actual values , and so a simple comparison between the 15- and 16-moments expansions gives bounds for the region of convergence of the method .",
    "as mentioned before , this algorithm becomes attractive especially in cases where one has to deal with hamiltonians composed of several operators , where the sizes of the histograms needed for reweighting may overflow the available memory . as",
    "a simple example consider again the 2-dimensional nearest - neighbor ising model , but now with a magnetic field . the hamiltonian is @xmath109 giving a boltzmann weight @xmath110 where the additional definitions @xmath111 and @xmath112 have been introduced .",
    "consider now a simulation carried out at some temperature and magnetic field .",
    "assuming that one wants to extrapolate the expectation value of some operator @xmath0 , one gets @xmath113 as before , it is better to change all operators into their densities , defining @xmath44 and @xmath114 .",
    "also , the density @xmath52 should be shifted so that its distribution is centered close to zero ( this is unnecessary for @xmath115 , since its distribution is symmetric around @xmath116 ) . performing these operations and the taylor expansions for the exponential containing @xmath39 and @xmath117 , one gets , repeating the same steps that gave eq .",
    "( [ finalexpansion ] ) , the following expression @xmath118 one should pay attention here to the fact that for low temperatures the histogram @xmath119 becomes bimodal in @xmath115 , and the assumption of a distribution with a single narrow peak is no longer valid .",
    "however , close to the critical point the width in @xmath115 of such histogram remains small , and one can still get by with the first few moments .",
    "occasionally , it may be convenient to work in terms of @xmath82 , whose distribution remains unimodal .",
    "the data obtained from the previous simulations were now used to generate the behavior of the magnetization and the susceptibility at non - zero values of @xmath120 . for the magnetization one gets , after truncation @xmath121 an analogous expression is obtained for @xmath122 , and from here the true susceptibility can be computed .",
    "the results are shown in fig .",
    "( 6 ) , which shows : ( a ) magnetization vs.  @xmath120 for @xmath86 , @xmath87 and @xmath88 at the critical temperature @xmath123 , and ( b ) magnetization vs.  @xmath120 for @xmath124 at @xmath125 , @xmath126 and @xmath127 . in all cases",
    "the magnetization has been extrapolated from the simulations that were carried out at @xmath128 and @xmath129 . in a slight departure from what was done before , here the denominator in eq .",
    "( [ two_pars ] ) was calculated using 16 moments while the sums in the numerator were truncated to @xmath130 or @xmath131 moments .",
    "the individual points have been calculated using a modified version of the wolff algorithm , were the acceptance ratio depends on the change of energy due to a cluster flipping in the presence a magnetic field @xmath120 .",
    "it is clear from the figure that the expansion in moments reproduces quite well the behavior of the magnetization for each temperature and lattice size , and in particular it manages to show the large growth of @xmath115 with @xmath120 as @xmath1 is reduced .",
    "the splits in the extrapolation curves correspond to the separation of the @xmath130- and @xmath131-moment extrapolations , and mark the end of the ranges of convergence . for small lattices",
    "these splits do not appear in the @xmath120 range tested here .    finally , figs .",
    "( 7 ) and  ( 8) show the true susceptibility @xmath108 as a function of @xmath120 , for @xmath132 and @xmath86 , @xmath87 and @xmath88 , and for @xmath105 and @xmath125 , @xmath126 and @xmath127 . it should be noticed that the extrapolation manages to cover quite well the whole peak in @xmath108 .",
    "the results for @xmath105 and different temperatures also show an excellent agreement between extrapolations and individual simulations , and show how the method can really extrapolate in more than one parameter .",
    "notice that , as expected , @xmath108 grows as @xmath1 is reduced , even below @xmath133 ; for @xmath128 the true susceptibility is just proportional to @xmath134 .",
    "otherwise , the behavior the extrapolated quantities _ vis a vis _ the individual simulations at @xmath135 is in all respects analogous the results found before : a very good correspondence for small @xmath120 that is , close to where the simulation was carried out , followed by a large deviation , which depends on the number of moments included in the extrapolation .",
    "this paper shows how to implement the histogram method for extrapolation of results of a monte carlo simulation using the moments of the histogram .",
    "this approach has several advantages over the direct method histogram construction and posterior reweighting , and over the method of storing configurations for their reweighting ( named `` histogram on the fly '' in ref .",
    "@xcite ) . to start with",
    ", the resulting expressions for the extrapolated quantities are given by very simple and conceptually appealing formulas .",
    "second , the ranges of applicability of the method become evident simply by changing the number of moments included in the extrapolation .",
    "third , the amount of computer memory and physical storage needed are so small that one may without any problem generate several repetitions of the simulations so as to generate in a simple way the error estimates for the extrapolated quantities . and",
    "finally , this approach eliminates completely the need to choose a binning size in cases of continuous variables .",
    "one needs however to balance these benefits against the cost of the extra approximation involved in the method .",
    "after all , replacing a full histogram for its first few moments necessarily reduces precision .",
    "how many moments one really needs to keep in any given simulation so that not too much information is lost is an issue that has to be considered with some care . on the one hand , it is clear that increasing too much the number of stored moments not only defeats one of the motivations for this approach , which is to work with a limited memory , but also necessarily runs into the limits of reliability imposed by the statistical errors of the simulation . on the other , not keeping enough moments implies a waste of simulation time . as a first approach to the answer to this question",
    "one can consider the following estimation , done here for a one - coupling hamiltonian : consider the preliminary run needed for the estimation of @xmath53 .",
    "this preliminary run can also be used to obtain a rough estimate of the width @xmath136 of the distribution .",
    "now , the order of magnitude of the moments @xmath137 will be around @xmath138 , and so the terms needed in an estimation with a shifted coupling look like ( see eq .  ( [ finalexpansion ] ) ) @xmath139 it is not difficult to show , using a steepest descent approximation , that as a function of @xmath140 this expression behaves as a gaussian centered in @xmath141 , with a width given by @xmath142 and height @xmath143 .",
    "therefore one gets @xmath144 the conclusion is then the following : given an initial estimation of the width @xmath136 of the distribution , and assuming that a certain maximum extrapolation range @xmath145 is going to be used , the main contribution to the extrapolation comes from the moments with @xmath140 around @xmath146 .",
    "besides , one finds that the moments with @xmath140 such that @xmath147 are basically irrelevant .",
    "the numerical results shown here display a much larger dependence on the number of moments used than on the statistical spread of the data , suggesting that several more moments may have been used in the extrapolation before reaching the limits given by statistical spread .     and",
    "the dotted line gives the exact results obtained from the kauffman solution .",
    "the solid lines give 14- and 15-moment extrapolations using values from a simulation at @xmath129 ( indicated by the vertical line ) . here",
    "the moments are taken without using any shifts ( @xmath149).,width=642 ]     and @xmath105 .",
    "the dotted line gives the exact results obtained from the kaufman solution .",
    "the thick solid lines give 14- and 15-moment extrapolations using values from a simulation at @xmath129 ( indicated by the vertical line ) .",
    "the thin solid lines give the error bars for the extrapolations . here",
    "the moments are taken using values of @xmath54 of @xmath150 for @xmath105 and @xmath151 for @xmath148.,width=642 ]    , @xmath87 and @xmath88 .",
    "the dotted lines give the exact results obtained from the kaufman solution .",
    "the thick solid lines give 13- and 14-moment extrapolations using values from a simulation at @xmath129 ( indicated by the vertical line ) .",
    "the thin solid lines give the error bars for the extrapolations .",
    "here the moments are taken using values of @xmath54 of @xmath152 for @xmath20 , @xmath150 for @xmath105 , and @xmath151 for @xmath148.,width=491 ]    .",
    "the solid line gives the difference between the extrapolated energy and the exact kaufman solution .",
    "the error bars correspond to the extrapolation . here",
    "15 moments were used . here",
    "@xmath153.,width=491 ]    , calculated using @xmath82 , for the 2-d ising model with @xmath86 , @xmath87 and @xmath88 .",
    "the points are from independent simulations , carried out at their nominal temperatures , an the dotted line is given only as a guide to the eye .",
    "the solid lines correspond to extrapolations from a simulation at @xmath129 , using 15 and 16 moments.,width=491 ]     for the 2-d ising model .",
    "the lines give the values extrapolated from a simulation at @xmath129 , @xmath128 , and the points , with their error bars , correspond to individual simulations carried out at their nominal @xmath1 and @xmath120 values .",
    "( a ) : results for @xmath154 , with sizes @xmath86 ( triangles ) , @xmath87 ( squares ) and @xmath88 ( round marks ) .",
    "the split visible for the @xmath148 line correspond to the separation between the 14- and the 15-moments extrapolations .",
    "( b ) results for @xmath105 , with temperatures @xmath155 ( triangles ) , @xmath129 ( squares ) and @xmath125 ( round marks ) . in both cases",
    "the extrapolated statistical errors come out smaller than the thickness of the lines.,width=491 ]     vs.  @xmath120 for the 2-d ising model .",
    "the lines give the values extrapolated from a simulation at @xmath129 , @xmath128 , and the points , with their error bars , correspond to individual simulations carried out at their nominal @xmath1 and @xmath120 values .",
    "results shown here are for @xmath154 , with sizes @xmath86 ( triangles ) , @xmath87 ( squares ) and @xmath88 ( round marks ) .",
    "the split visible for the @xmath148 line correspond to the separation between the 14- and the 15-moments extrapolations .",
    "the extrapolated statistical errors come out smaller than the thickness of the lines.,width=491 ]     vs.  @xmath120 for the 2-d ising model .",
    "the lines give the values extrapolated from a simulation at @xmath129 , @xmath128 , and the points , with their error bars , correspond to individual simulations carried out at their nominal @xmath1 and @xmath120 values .",
    "results shown here are for @xmath105 , with temperatures @xmath155 ( triangles ) , @xmath129 ( squares ) and @xmath125 ( round marks ) .",
    "the extrapolated statistical errors come out smaller than the thickness of the lines.,width=491 ]                    it may be argued that there is no need for such a large array to be stored , since in practice many bins will never get hit because the corresponding combination of values for the three operators ( nearest - neighbor , next - nearest - neighbor and magnetic ) is not allowed .",
    "this observation is correct , but in general it may be quite difficult to know beforehand which combinations of lattice operators are allowed and which are not , or even how many are allowed .",
    "it is then not possible to request the correct amount of computer memory at the start of a simulation .",
    "a possible solution is to request new memory locations only when needed , but then one is never sure about the maximum lattice size that can be safely explored .            since the numerator in the extrapolation of @xmath156 contains moments of the form @xmath157 , one can run @xmath140 up to @xmath130 when @xmath158 moments are kept . for simplicity ,",
    "the same bound @xmath61 is used for the denominator . similarly , for the extrapolation of @xmath159 one can run @xmath140 up to @xmath131 when @xmath158 moments are kept ."
  ],
  "abstract_text": [
    "<S> this paper shows a simple implementation of the histogram method for extrapolations in monte carlo simulations , using the moments of the operators that define the energy , instead of their histogram . </S>",
    "<S> this implementation is suitable for extrapolation over several operators , a type of calculation that is hindered by computer memory limitations . </S>",
    "<S> examples of this approach are given for the 2-d ising model . </S>"
  ]
}