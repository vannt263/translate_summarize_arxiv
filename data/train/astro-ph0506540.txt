{
  "article_text": [
    "gaussian density field play a major role in cosmology .",
    "there is now strong evidence that the large - scale structure of the universe originated from the growth , by gravitational instability , of primordial density fluctuations .",
    "observations of the temperature fluctuations of the cosmic microwave background ( cmb ) indicate that these primordial fluctuation were gaussian .",
    "the formation of evolution of large - scale structure in the universe is a complex problem that requires a numerical approach .",
    "typically , one creates a realization of the density fluctuations at early time , and uses a numerical algorithm to evolve this fluctuation all the way to the present ( or to some redshift of interest ) .",
    "since it is impossible to simulate the entire universe ( which might very well be infinite ) , we normally assume that the universe is periodic at large scales .",
    "we can then divide the universe into identical cubes of volume @xmath1 , and we only need to simulate one cube .",
    "this approximation is valid as long as the box size @xmath2 is much larger than any existing large - scale structure in the universe .",
    "we can rephrase this by saying that the box must contain a `` fair '' sample of the universe .",
    "the density field can be represented in two different ways . in the _ eulerian representation _ , the box is divided into @xmath3 cells , and the density contrast @xmath4 is calculated at the center of each cell . in the _ lagrangian representation _ , @xmath5 equal - mass particles are laid down on a cubic grid inside the box , and are then displaced in order to represent the density fluctuation .",
    "the choice of representation depends on the particular algorithm that will be used to evolve the system from these initial conditions .",
    "a gaussian density field can be represented as a superposition of plane waves of wavevectors @xmath6 and complex amplitudes @xmath7 , where the superscript `` cont '' stands for _ continuous _ , indicating that all values of @xmath6 are allowed .",
    "the amplitudes are related to the power spectrum @xmath8 by @xmath9 .",
    "however , there is a lot of confusion in the literature about the constant of proportionality between @xmath10 and @xmath8 , and even the _ units _ of @xmath7 can vary from one author to another .",
    "we will clarify this issue in  2 .",
    "note : equation  ( [ deltap ] ) is a convenient simplification .",
    "as we will discuss later , in a truly gaussian random field , the amplitudes @xmath11 are determined only in a statistical sense .",
    "their real and imaginary parts are separately given by a gaussian distribution whose variance is proportional to @xmath8 .",
    "however , using equation  ( [ deltap ] ) greatly simplifies the derivation presented in  2 , without affecting the results .",
    "we assume that the universe is periodic over a comoving cubic volume @xmath1 .",
    "the density contrast @xmath4 can be decomposed into a sum of plane waves .",
    "@xmath12    where @xmath13 is the comoving position .",
    "the wavevectors @xmath6 are given by @xmath14    where the fundamental wavenumber is @xmath15    the superscript `` @xmath16 '' indicates that the amplitudes @xmath17 form a discrete spectrum , that is , they are defined for particular , discrete values of @xmath6 . would not satisfy the periodic boundary conditions ] the factor @xmath18 is not necessary at this point , and could be absorbed into the definition of @xmath17 .",
    "we introduce it to make the notation consistent with  3 . to make @xmath19 real , the coefficients",
    "@xmath17 must satisfy the _ reality condition _ : @xmath20    our first challenge is to relate the discrete sum in equation  ( [ waves ] ) to the continuous sum of modes present in the real universe , and to express the amplitudes @xmath17 in terms of the power spectrum @xmath8 .",
    "to do so , we will consider the rms fluctuation of the density at a certain scale @xmath21 , and match the expressions obtained in the discrete and continuous limits .",
    "consider a sphere of radius @xmath21 centered at @xmath22 .",
    "the mass inside that sphere is given by @xmath23d^3r = \\bar\\rho v_{\\rm sph}+{\\bar\\rho\\over n^3 } \\int_{{\\rm sph}(\\rbf_0)}d^3r\\sum_\\kbf\\delta_\\kbf^{\\rm disc}e^{-i\\kbf\\cdot\\rbf } \\,,\\ ] ]    where @xmath24 is the average density , @xmath25 is the volume of the sphere , and the integral is computed over that volume .",
    "the relative mass excess in the sphere is given by @xmath26    we introduce the following change of variables , @xmath27    in @xmath28-space , the sphere is now located at the origin , and equation  ( [ dmm ] ) becomes @xmath29    we now square this expression , and get @xmath30 \\biggl[\\int_{\\rm sph(0)}d^3z\\sum_{\\kbf'}\\delta_{\\kbf'}^{\\rm disc } e^{-i\\kbf'\\cdot\\rbf_0}e^{-i\\kbf'\\cdot\\zbf}\\biggr]\\,.\\ ] ]    the variance of the density contrast at scale @xmath21 is obtained by averaging the above expression over all possible locations @xmath22 of the sphere inside the computational box , @xmath31    the integral over @xmath32 reduces to @xmath33    we substitute this expression in equation  ( [ sx2 ] ) , and use the kronecker  @xmath4 to eliminate the summation over @xmath34 .",
    "equation  ( [ sx2 ] ) reduces to @xmath35 ^ 2\\,,\\ ] ]    where we used equation  ( [ reality ] ) to get @xmath36 .",
    "the remaining integral can be evaluated easily ( see appendix a ) .",
    "equation  ( [ sx2b ] ) reduces to @xmath37    where @xmath38      the real universe is of course not periodic , in which case all values of @xmath6 are allowed . to convert the expressions derived in  2.1 from the discrete limit to the continuous one , consider any function @xmath39 that is summed over all allowed values of @xmath6 . in the discrete limit",
    ", we have @xmath40    where `` v.e . ''",
    "represent a _ volume element _ in @xmath6-space , which is a cube of volume @xmath41 centered around an allowed value of @xmath6 ( with @xmath42 ) .",
    "assuming that the function @xmath43 does not vary significantly over one volume element , we can pull it inside the integral , @xmath44    of course , the effect of integrating over the volume element , and then summing over all volume elements , is to effectively integrate over all @xmath0-space , so equation  ( [ sumfkdisc2 ] ) reduces to @xmath45    we can rewrite this expression as @xmath46    where the continuous and discrete functions are related by @xmath47    using these formulae , we can rewrite equation  ( [ waves ] ) as @xmath48    where @xmath49    let us now convert equation  ( [ sx2c ] ) into an integral , as we did for equation  ( [ sumfkdisc ] ) .",
    "we get @xmath50 ) into equation  ( [ sx2d ] ) , and get @xmath51 to the power spectrum @xmath8 .",
    "the relation is given by @xcite as @xmath52    this relation is obtained by performing an integration over angles , using the fact that @xmath53 is a function of @xmath54 only .",
    "we can `` undo '' this integration , simply by dividing equation  ( [ sx2e2 ] ) by @xmath55 .",
    "we get    @xmath56    comparing equations  ( [ sx2d ] ) , ( [ sx2e ] ) , and  ( [ sx2f ] ) , we get @xmath57    this gives us the relation between @xmath8 , @xmath17 , and @xmath58 .",
    "notice the @xmath8 is neither the square of @xmath17 nor the square of @xmath58 .",
    "both @xmath8 and @xmath58 have dimensions of a volume while @xmath17 is dimensionless .",
    "equations  ( [ sx2e2 ] ) and ( [ sx2f ] ) define the normalization of the power spectrum .",
    "when using any power spectrum obtained from the literature , _ it is essential to check that these relations are satisfied_. variations by factors of @xmath59 between different papers are quite common .",
    "using the formalism described in  2 , we now want to compute the density harmonics @xmath60 .",
    "we first lay down inside the computational volume @xmath32 a regular cubic grid of size @xmath3 , with grid spacing @xmath61 .",
    "the coordinates @xmath62 of the grid points are given by @xmath63    the presence of a grid results in a discretization of space , which in turns modifies the structure of the @xmath0-space . in equation  ( [ wavevect1 ] ) , the values of @xmath6 form an infinite cubic grid in @xmath0-space , since the indicies @xmath64 , @xmath65 , @xmath66 can take any integer value from @xmath67 to @xmath68",
    ". however , the discretization of space limits the number of modes .",
    "consider a mode with wavenumber @xmath69    where @xmath70 , @xmath71 , and @xmath72 are integers .",
    "the exponential in equation  ( [ waves ] ) becomes @xmath73\\cdot[\\alpha,\\beta,\\gamma]k_0\\delta } = e^{-i\\kbf\\cdot\\rbf}e^{-i[un , vn , wn]\\cdot[\\alpha,\\beta,\\gamma](2\\pi / n ) } \\nonumber\\\\ & = & e^{-i\\kbf\\cdot\\rbf}e^{-2\\pi i[u , v , w]\\cdot[\\alpha,\\beta,\\gamma ] } = e^{-i\\kbf\\cdot\\rbf}\\,.\\end{aligned}\\ ] ]    hence , the modes @xmath34 and @xmath6 are _",
    "inseparable_. they represent a plane wave with the same effective wavenumber .",
    "consequently , we will consider a finite @xmath0-space , in which the values @xmath64 , @xmath65 , @xmath66 do not run from @xmath67 to @xmath68 , but instead are limited to the range 0 to @xmath74 .",
    "hence , in @xmath0-space , the density harmonics @xmath75 are also defined on a regular cubic grid of size @xmath3 .",
    "the wavevectors are given by @xmath76    in doing so , we are simply neglecting high - frequency modes .",
    "this is justified since the discreteness of the grid in @xmath77-space prevents us from resolving any structure that these modes represent .",
    "hence , by using a grid in @xmath77-space , we are effectively performing a filtering of the density fluctuation at the scale of @xmath78 , and such filtering eliminates high - frequency modes .",
    "the fourier transform and inverse fourier transform are given respectively by @xmath79    notice that equation  ( [ fft2 ] ) is the same as equation  ( [ waves ] ) , with a slight change of notation : @xmath80 .",
    "we introduce the notation @xmath81    equation  ( [ fft ] ) becomes @xmath82\\cdot[\\alpha,\\beta,\\gamma ] } = \\sum_{\\alpha,\\beta,\\gamma=0}^{n-1}\\delta_{\\alpha\\beta\\gamma } e^{2\\pi il\\alpha / n}e^{2\\pi im\\beta / n}e^{2\\pi in\\gamma / n } \\nonumber \\\\ \\label{mode1 } & = & \\sum_{\\alpha,\\beta,\\gamma=0}^{n-1 } \\left(\\cos{2\\pi l\\alpha\\over n}+i\\sin{2\\pi l\\alpha\\over n}\\right ) \\left(\\cos{2\\pi m\\beta\\over n}+i\\sin{2\\pi m\\beta\\over n}\\right ) \\left(\\cos{2\\pi",
    "n\\gamma\\over n}+i\\sin{2\\pi n\\gamma\\over n}\\right)\\,.\\end{aligned}\\ ] ]    after expansion , this expression becomes @xmath83    where we define @xmath84    consider now the mode @xmath85 .",
    "we replace @xmath64 by @xmath86 in equation  ( [ mode1 ] ) , and get @xmath87    since @xmath88 is an integer , the first exponential is always unity , and equation  ( [ mode2 ] ) reduces to @xmath89    comparing equations ( [ mode1 ] ) and ( [ mode2b ] ) , we see that the effect of replacing @xmath64 by @xmath86 amounts to a change of sign of the first sine function . in equations ( [ deltaeee])([deltaooo ] ) , that sine appears only in the @xmath90 s for which the first subscript is `` @xmath91 . ''",
    "hence , these @xmath90 s will change sign , and equation  ( [ dlmn ] ) will become @xmath92    we can directly generalize to the other indicies , or combinations of them . replacing @xmath65 by @xmath93",
    "changes the sign of the @xmath90 s for which the second subscript is `` @xmath91 , '' and replacing @xmath66 by @xmath94 changes the sign of the @xmath90 s for which the third subscript is `` @xmath91 . ''",
    "hence , @xmath95    hence , 8 different , but related harmonics can be represented by various combinations of 8 numbers : @xmath96 , @xmath97 , @xmath98 , @xmath99 , @xmath100 , @xmath101 , @xmath102 , and @xmath103 .",
    "this implies that the fourier transform of a real field defined on a grid @xmath3 can be represented by @xmath104 real numbers stored on a similar grid , even though the fourier transform @xmath105 ) is complex .",
    "notice also that the 8 `` related '' modes are located , in @xmath0-space , at the verticies of a rectangular box centered on the center of the @xmath0-space grid ( @xmath106 ) .",
    "this is illustrated in figure  [ cube1 ] .",
    "-0.5 in 0.3 in -space .",
    "the 3 axes correspond to the 3 indicies @xmath64 , @xmath65 , @xmath66 , which run from 0 to @xmath74 , with @xmath107 in this case .",
    "the dots indicate the particular mode @xmath108 and the seven related modes .",
    "notice that only one of these modes is located in the first octant , indicated by the dashed lines.,title=\"fig:\",width=595 ] -0.7 in    from equations ( [ dlmn ] ) and ( [ dnlmn])([dnlnmnn ] ) , we see that related modes form 4 pairs of complex conjugates : @xmath109      consider first the modes for which the indicies @xmath64 , @xmath65 , and @xmath66 are neither 0 nor @xmath110 . in equations ( [ dlmn2])([dlnmnn2 ] ) , the amplitudes @xmath90 are provided by the power spectrum . from equation  ( [ pdelta ] )",
    ", we get @xmath111 ) provides the correct normalization of the power spectrum . however , there are two problems with this equation .",
    "first , it provides no mean of determining the phases of the complex numbers @xmath112 , and second , choosing random phases would result in a field that is not gaussian . in a truly gaussian field ,",
    "equation  ( [ standard ] ) is only valid in a statistical sense .",
    "the correct approach is to compute the real and imaginary parts of @xmath112 independently , by drawing them from a gaussian distribution , @xmath113^{1/2}\\,,\\\\ \\label{imaginary } { \\rm im}\\,\\hat\\delta_\\kbf^{\\rm disc } & = & g_2(0,1)n^3\\left[{p(k)\\over2v_{\\rm box}}\\right]^{1/2}\\,,\\end{aligned}\\ ] ]    where @xmath114 and @xmath115 are random numbers drawn from a gaussian distribution with mean  0 and standard deviation  1 .",
    "this ensures that the resulting field is gaussian .",
    "equations  ( [ real ] ) and  ( [ imaginary ] ) provide us with the left - hand - sides of equations  ( [ dlmn2])([dlnmnn2 ] ) . by equating these expressions with equations  ( [ dlmn ] ) , ( [ dlnmn ] ) , ( [ dlmnn ] ) , and ( [ dlnmnn ] ) , and considering the real and imaginary parts separately , we get 8 equations ,    @xmath116    where    @xmath117    altogether , we get two separate systems of 4 equations and 4 unknowns . written in matrix form ,",
    "these systems are : @xmath118=\\left[\\matrix { r_1\\cr r_2\\cr r_3\\cr r_4\\cr}\\right]\\,,\\qquad { \\bf m}\\left[\\matrix { \\hat\\delta_{eeo}\\cr\\hat\\delta_{eoe}\\cr\\hat\\delta_{oee}\\cr\\hat\\delta_{ooo}\\cr } \\right]=\\left[\\matrix { \\phantom{-}i_1\\cr -i_2\\cr \\phantom{-}i_3\\cr -i_4\\cr}\\right]\\,,\\ ] ]    where the matrix * m * is given by @xmath119\\,.\\ ] ]    the inverse of the matrix @xmath120 is simply @xmath121 .",
    "hence , the @xmath90 s are given by @xmath122={{\\bf m}\\over4}\\left[\\matrix { r_1\\cr r_2\\cr r_3\\cr r_4\\cr}\\right]\\,,\\qquad \\left[\\matrix { \\hat\\delta_{eeo}\\cr\\hat\\delta_{eoe}\\cr\\hat\\delta_{oee}\\cr\\hat\\delta_{ooo}\\cr } \\right]={{\\bf m}\\over4}\\left[\\matrix { \\phantom{-}i_1\\cr -i_2\\cr \\phantom{-}i_3\\cr -i_4\\cr}\\right]\\,,\\ ] ]      consider now the case where one of the indicies , say @xmath64 , is equal to either 0 or @xmath110 .",
    "these cases correspond to values of @xmath123 located on a face of the first octant in @xmath0-space .",
    "the problem becomes simpler . with @xmath124 , equation ( [ mode1 ] )",
    "reduces to @xmath125    after expansion , this expression becomes @xmath126    where @xmath127    consider now the mode @xmath128 .",
    "we replace @xmath65 by @xmath93 in equation  ( [ mode3 ] ) , and get @xmath129    since @xmath130 in an integer , the first exponential is always unity , and equation  ( [ mode3b ] ) reduces to @xmath131    comparing equations  ( [ mode3 ] ) and  ( [ mode3c ] ) , the only difference is a change of sign of the first sine function . in equations  ( [ deltaee])([deltaoo ] ) , that sine appears only in the @xmath90 s for which the first subscript is `` @xmath91 . ''",
    "hence , these @xmath90 s will change sign , and equation  ( [ d0mn ] ) will becomes @xmath132    similarly , we can easily show that replacing @xmath66 by @xmath94 results in a change of sign of the @xmath90 s for which the second subscript is `` @xmath91 . ''",
    "hence , we get @xmath133    -0.5 in 0.3 in -space .",
    "the dots indicate the particular mode @xmath134 and the three related modes.,title=\"fig:\",width=595 ] -0.7 in    these 4 modes are located at the verticies of a rectangle in @xmath0-space , as shown in figure  [ cube2 ] .",
    "they form two pairs of complex conjugates , @xmath135    by equating these expressions with equations  ( [ d0mn ] ) and ( [ d0mnn ] ) , and considering the real and imaginary parts separately , we get 4 equations , @xmath136    where @xmath137    again , the numbers @xmath138 , @xmath139 , @xmath140 , and @xmath141 are determined from equations  ( [ real ] ) and  ( [ imaginary ] ) .",
    "the solutions are @xmath142    consider now the case @xmath143 .",
    "equation ( [ mode1 ] ) reduces to @xmath144    after expansion , this expression becomes @xmath145    where @xmath146    we find the same expressions as for the case @xmath124 , the only differences being the extra factor of @xmath147 in the definitions of the @xmath90 s .",
    "hence , the solutions  ( [ deltaee2])([deltaoo2 ] ) are still valid in this case .",
    "these modes are shown in figure  [ cube2b ] .",
    "-0.5 in 0.3 in -space .",
    "the dots indicate the particular mode @xmath148 , where @xmath149 , and the three related modes.,title=\"fig:\",width=595 ] -0.7 in    we have only considered the cases when the first index , @xmath64 , is either 0 or @xmath110 , but these results can be generalized to the other indicies @xmath65 and @xmath66 as well , since the entire problem has cubic symmetry .",
    "consider now the case when two of the indicies , say @xmath64 and @xmath65 , are equal to either 0 or @xmath110 .",
    "these cases corresponds to values of @xmath123 located on an edge of the first octant in @xmath0-space . with @xmath150 , equation ( [ mode1 ] )",
    "reduces to @xmath151    this expression becomes @xmath152    where @xmath153    consider now the mode @xmath154 .",
    "we replace @xmath66 by @xmath94 in equation  ( [ mode4 ] ) , and get @xmath155    since @xmath156 in an integer , the first exponential is always unity , and equation  ( [ mode4b ] ) reduces to @xmath157    comparing equations  ( [ mode4 ] ) and  ( [ mode4c ] ) , the only difference is a change of sign of the sine function . in equations  ( [ deltae ] ) and  ( [ deltao ] ) , that sine appears only in the expression for @xmath158 .",
    "hence , equation  ( [ d00n ] ) becomes @xmath159    -0.5 in 0.3 in -space .",
    "the dots indicate the particular mode @xmath160 and its related mode.,title=\"fig:\",width=595 ] -0.7 in    these two modes are complex conjugates , @xmath161    they are shown in figure  [ cube3 ] . by equating equation  ( [ d00n ] ) and ( [ d00n2 ] ) , and considering the real and imaginary parts separately , we get @xmath162    where @xmath163    the numbers @xmath138 and @xmath139 are determined from equations  ( [ real ] ) and  ( [ imaginary ] ) .",
    "consider now the case @xmath143 , @xmath164 , the case @xmath124 , @xmath165 , and the case @xmath166 .",
    "we can easily show that the solutions  ( [ deltae2 ] ) and  ( [ deltao2 ] ) are still valid , using the same approach as in  3.2 .",
    "again , the only difference will be extra factors of @xmath147 in the definitions of @xmath167 and @xmath158 .",
    "these modes are shown in figure  [ cube3b ] . using the cubic symmetry",
    ", we can then show that the solutions  ( [ deltae2 ] ) and  ( [ deltao2 ] ) applies to all cases for which two of the three indicies @xmath64 , @xmath65 , @xmath66 are equal to 0 or @xmath110 ( 12 combinations ) .",
    "-0.5 in 0.3 in -space .",
    "the dots indicate the particular modes @xmath168 , @xmath169 , and @xmath170 , where @xmath149 , and their related modes.,title=\"fig:\",width=595 ] -0.7 in      finally , we consider the cases when all indicies are equal to 0 or @xmath110 .",
    "these cases corresponds to values of @xmath123 located in a corner of the first octant in @xmath0-space . with @xmath171 , equation ( [ mode1 ] )",
    "reduces to @xmath172    where the subscript @xmath70 stands for `` uniform , '' since the mode 000 corresponds to a null wavenumber , or an infinite wavelength .",
    "notice that since @xmath173 is real , @xmath174 is real as well .",
    "hence , for this mode , there is no imaginary part , and @xmath174 is determined form equation  ( [ real ] ) .",
    "this mode is shown in figure  [ cube4 ] .",
    "-0.5 in 0.3 in -space .",
    "the dot indicates the particular mode @xmath175 .",
    "for that particular mode , we ignore equation  ( [ deltau ] ) and set @xmath176 instead.,title=\"fig:\",width=595 ] -0.7 in    consider now the case @xmath143 , @xmath164 , @xmath177 .",
    "again , we can easily show that the solution  ( [ deltau ] ) is still valid , using the same approach as in ",
    " 3.2 and  3.3 . the only difference will be an extra factor of @xmath147 in the expression for @xmath174 .",
    "using the cubic symmetry , we can then show that the solution  ( [ deltau ] ) applies to all cases for which the three indicies @xmath64 , @xmath65 , @xmath66 are equal to 0 or @xmath110 ( 8 combinations ) .",
    "-0.5 in 0.3 in -space .",
    "the dots indicate the particular modes @xmath178 located at corners of the first octant , excluding the mode @xmath179 . for these modes , equation  ( [ deltau ] ) applies.,title=\"fig:\",width=595 ] -0.7 in    notice that there is a fundamental difference between the mode @xmath180 and the other 7 modes , @xmath181 , @xmath182 , @xmath183 , @xmath184 , shown in figures  [ cube4 ] and [ cube4b ] , respectively .",
    "the mode @xmath180 represents a perturbation of infinite wavelength , that is , a constant . clearly that constant must be zero , otherwise the mean value of @xmath185 integrated over the entire volume would be nonzero , and this would violate the assumption that the volume contains a fair sample of the universe",
    "therefore , for the mode @xmath180 , _ and that mode only _ , we do not compute the amplitude @xmath186 from the power spectrum , but instead set that amplitude equal to zero .",
    "we can now count the number of independent quantities necessary to represent all the density harmonics .",
    "consider first the modes @xmath187 for which the indicies are neither 0 nor @xmath110 . excluding these values ,",
    "each index can take @xmath188 different values , which gives us @xmath189 modes . as we showed in  3.1 ,",
    "these modes come in groups of 8 , and within each group the complex values of the harmonics can be expressed as combinations of 8 real numbers @xmath96 , @xmath97 , @xmath183 , @xmath103 .",
    "hence , it takes a total of @xmath189 real numbers to represent these modes .",
    "consider now the modes for which one of the indicies is equal to 0 or @xmath110 .",
    "there are 6 possibilities , and for each one , the remaining two indicies can take @xmath188 values each ( all values except 0 and @xmath110 ) .",
    "this gives us @xmath190 modes . as we showed in  3.2 ,",
    "these modes come in groups of four , and within each group the complex values of the harmonics can be expressed as combinations of four real numbers @xmath191 , @xmath192 , @xmath193 , and @xmath194 .",
    "hence , it takes a total of @xmath190 real numbers to represent these modes .",
    "next , consider the modes for which two of the indicies are equal to 0 or @xmath110 .",
    "there are 12 possibilities , and for each one , the remaining index can take @xmath188 values ( all values except 0 and @xmath110 ) .",
    "this gives us @xmath195 modes .",
    "as we showed in  3.3 , the amplitude these modes form complex conjugates pairs , and each pair can be represented by two real numbers @xmath167 , and @xmath158 .",
    "hence , it takes a total of @xmath195 real numbers to represent these modes .",
    "finally , consider the modes for which all three indicies are equal to 0 or @xmath110 .",
    "there are 8 such modes .",
    "as we showed in  3.4 , these modes are real , hence it takes 8 real numbers to represent them . the total number of variables necessary to represent all the density harmonics is therefore @xmath196    it takes @xmath104 numbers to represent the fourier transform of a cube @xmath3 of real numbers , in spite of the fact that the fourier transform is complex .",
    "indeed , it is common for fast fourier transform ( fft ) subroutines to take a tridimensional array of number and to overwrite that array with the fourier transform .",
    "this is the case for the fft subroutines of _ numerical recipes _",
    "when these subroutines compute the fourier transform of a cube @xmath3 , the results are written in the same cube , and _ the actual numbers stored in the cube are precisely the @xmath197 s , @xmath198 s , @xmath199 s , and @xmath174 s derived in this section_. hence it is possible to generate the density harmonics directly in @xmath0-space , using the above formulae , store these numbers at the appropriate locations inside an @xmath3 cubic array , and then invoke the _ numerical recipes _",
    "inverse fft subroutines to generate the density field .    the _ numerical recipes _",
    "convention for storing the density harmonics is the following : consider a 3d array a , with indicies running from 0 to @xmath74 .",
    "we loop over all modes located in the first octant in @xmath0-space : @xmath200 .    1 .   for modes with @xmath201 ( the general case ) ,",
    "the numbers @xmath202 , @xmath203 , @xmath183 , @xmath204 are stored in a @xmath205 cube located at a(2l,2m,2n ) , a(2l,2m,2n+1 ) , @xmath183 , a(2l+1,2m+1,2n+1 ) .",
    "2 .   for modes with @xmath124 ,",
    "the numbers @xmath206 , @xmath207 , @xmath208 , @xmath209 are stored at a(0,2m,2n ) , a(0,2m,2n+1 ) , a(0,2m+1,2n ) , and a(0,2m+1,2n+1 ) , respectively . for modes with @xmath143 ,",
    "they are stored at a(1,2m,2n ) , a(1,2m,2n+1 ) , a(1,2m+1,2n ) , and a(1,2m+1,2n+1 ) , respectively .",
    "this is easily generalized to the other faces ( @xmath164 , @xmath165 , @xmath177 , @xmath210 ) .",
    "3 .   for modes with @xmath150 ,",
    "the numbers @xmath211 and @xmath212 are stored at a(0,0,2n ) and a(0,0,2n+1 ) , respectively . for modes with @xmath124 , @xmath165 , they are stored are stored at a(0,1,2n ) and a(0,1,2n+1 ) , respectively .",
    "this is easily generalized to the other edges .",
    "the number @xmath174 is stored in a @xmath205 cube located in the corner of the array , at a(0,0,0 ) , a(0,0,1 ) , @xmath183 , a(1,1,1 ) .",
    "then , the value of a(0,0,0 ) is set to 0 , since this represents the mode @xmath179 .",
    "with the expressions derived in  2 , we have all the ingredients necessary to compute the density field on a grid .",
    "the steps are the following :    1 .   choose a particular power spectrum @xmath8 , a box size @xmath2 , and a grid size @xmath213 .",
    "this determines the fundamental wavenumber @xmath42 .",
    "the allowed modes are given by equation  ( [ kallowed ] ) .",
    "2 .   for all modes with @xmath214 , group these modes in groups of 8 , and for each group ,",
    "calculate the quantities @xmath202 , @xmath203 , @xmath183 , @xmath204 using equations  ( [ rone])([ifour ] ) and  ( [ sol1 ] ) .",
    "the quantities @xmath138 , @xmath139 , @xmath183 , @xmath215 are determined from equations  ( [ real ] ) and  ( [ imaginary ] ) .",
    "3 .   for all modes located on a face ( one of the indicies @xmath216 equal to 0 or @xmath110 ) , group these modes in groups of four , and for each group , calculate the quantities @xmath206 , @xmath207 , @xmath208 , @xmath209 using equations  ( [ roneb])([itwo ] ) and  ( [ deltaee2])([deltaoo2 ] ) .",
    "4 .   for all modes located on an edge ( two of the indicies @xmath216 equal to either 0 or @xmath110 ) , group these modes in groups of two , and for each group , calculate the quantities @xmath211 and @xmath212 , using equations  ( [ deltae2])([itwo ] ) . 5 .   for the modes located in a corner ( all indicies @xmath216 equal to either 0 or @xmath110 ) ,",
    "calculate the quantity @xmath174 using equation  ( [ deltau ] ) . for",
    "the mode @xmath175 , replace the value of @xmath174 by 0 .",
    "6 .   store",
    "the quantities @xmath202 , @xmath183 , @xmath204 , @xmath206 , @xmath207 , @xmath208 , @xmath209 , @xmath211 , @xmath212 , @xmath174 in a 3d , @xmath3 array , at the proper locations .",
    "these depends on the convention used by the fft subroutines .",
    "compute the inverse fft of the 3d array .",
    "the result will be the density field @xmath19 .      in the lagrangian representation , the density field",
    "is represented by a distribution of equal - mass particles .",
    "we start by laying down @xmath5 particles on a cubic grid with grid spacing @xmath217 inside the computational volume @xmath32 .",
    "the mass of the particles are given by @xmath218 , such that the mean density inside the box is equal to the mean background density @xmath24 .",
    "the particles are then displaced in order to represent the initial density field .",
    "this approach is valid only in the _ linear regime _",
    ", defined by @xmath219 . in this regime ,",
    "the particle displacements @xmath220 are significantly smallar than the initial separation @xmath221 between the particles , and can be computed using the zeldovich approximation @xcite .",
    "the displacements are given by @xmath222    where @xmath223 is the position of particle @xmath224 before it is displaced , and @xmath225 is the position after .",
    "notice that the reality condition  ( [ reality ] ) ensures that @xmath226 is real .",
    "this method is straightforward , but can rapidly become unpractical .",
    "equation  ( [ direct ] ) involves a sum over @xmath104 modes , and that sum must be performed for each of the @xmath227 particles . since in typical cosmological simulations",
    "@xmath228 is chosen to be @xmath110 , the number of operations scales like @xmath229 .",
    "if it takes 5 minutes to set up initial conditions with @xmath230 particles , it will take 5.3 hours for @xmath231 particles , 2 weeks for @xmath232 particles , and 2.5 years for @xmath233 particles ! an alternative method , which scales like @xmath104 , was proposed by @xcite .",
    "essentially , this approach uses the fact that the displacement of each particle is proportional to its peculiar acceleration , that can be calculated with a n - body simulation algorithm such as pm ( particle - mesh ) or @xmath234 ( particle - particle / particle - mesh ) . with this method ,",
    "the number of operations scales roughly as @xmath104 .",
    "i refer the reader to @xcite and @xcite for details .",
    "it is worth noting that , unlike equation  ( [ direct ] ) , the approach of @xcite is approximative , and the high - frequency modes , near the nyquist frequency @xmath235 , are often poorly represented by the particle distribution .",
    "our next task in to filter the density field at some scale @xmath236 .",
    "the choice of scale must obey two conditions : @xmath237 and @xmath238 .",
    "the first condition is required by the discreteness of the grid and the second by the assumption of periodic boundary conditions .",
    "the filtered density field @xmath239 at scale @xmath236 is given by @xmath240    where @xmath241 is the filter function .",
    "we will use a gaussian filter given by @xmath242    this filter function satisfied the normalization condition , @xmath243    as long as @xmath238 .",
    "it is well known that filtering in real space is equivalent to a multiplication in @xmath0-space .",
    "however , it is useful to redo the derivation , to ensure that we have all the correct factors of @xmath59 , @xmath104 , and so on .",
    "first , we express the filter as an inverse fourier transform , @xmath244    we substitute equations  ( [ fft2 ] ) and  ( [ fft3 ] ) in equation  ( [ deltaf ] ) , and get @xmath245    the integral is equal to @xmath246 ( see eq .  [ [ dkk ] ] ) , and we use the kronecker @xmath4 to eliminate the sum over @xmath34 .",
    "we get @xmath247    we now need an expression for @xmath248 . this function is the fourier transform of the filter , @xmath249    we rewrite this expression as @xmath250    the factor @xmath251 represents the volume element around each point @xmath252 in the @xmath3 grid . since we assume @xmath237 , we can approximate the sum as an integral over the volume of the box ( or , equivalently , regard the sum as a numerical approximation for the integral ) .",
    "hence , @xmath253    since we assume periodic boundary conditions , we are free to locate the origin anywhere inside the box . for instance , we can locate it in the center of the box .",
    "since @xmath238 , the integrant becomes negligible at the edge of the box .",
    "we can then extend the integration domain to all space , @xmath254    where this expression _ no longer assumes boundary conditions_. the integral in equation  ( [ intall ] ) can be found in any textbook of fourier transforms , @xmath255    hence , @xmath256    we substitute this expression in equation  ( [ deltaf3 ] ) , and get @xmath257    hence , to obtain a filtered density field , we generate the density harmonics using the method described in  3 , and then multiply them by the factor @xmath258 _ before _ taking the inverse fourier transform .",
    "this paper presents in great detail the techniques used for generating gaussian density fields .",
    "these techniques are well - known among experts in cosmological numerical simulations , but the specific details of the implementation are often difficult to find in the literature . also , the notation tends to vary significantly from one author to another .",
    "the consequences is that any new researcher moving into this field has to either spend a great deal of effort rederiving all the technical details , or else rely on existing codes and use them as black boxes .",
    "the goal of this document is to improve the situation by presenting in a comprehensive form the basic theory behind the generation of gaussian random fields .",
    "i am very thankful to yehuda hoffman , patrick mcdonald , matthew pieri , cdric grenon , and matthew craig for reading this manuscript and making valuable comments .",
    "this work was supported by the canada research chair program and nserc .",
    "consider the following integral , @xmath259    where the domain of integration is a sphere of radius @xmath21 centered at the origin .",
    "we consider a spherical coordinate system centered at the origin , with the @xmath260-axis pointing in the direction of @xmath6 .",
    "equation  ( [ a1 ] ) becomes @xmath261    where @xmath262 , @xmath263 , and @xmath264 is the angle between @xmath6 and @xmath28 .",
    "the integrations over @xmath265 and @xmath264 are trivial .",
    "we get @xmath266_0^\\pi = 2\\pi\\int_0^r dy\\,y^2\\left[{e^{iky}-e^{-iky}\\over iky}\\right ] = 4\\pi\\int_0^r dy\\,{y\\sin ky\\over k}\\,.\\ ] ]"
  ],
  "abstract_text": [
    "<S> this document describes analytical and numerical techniques for the generation of gaussian density fields , which represent cosmological density perturbations . </S>",
    "<S> the mathematical techniques involved in the generation of density harmonics in @xmath0-space , the filtering of the density fields , and the normalization of the power spectrum to the measured temperature fluctuations of the cosmic microwave background , are presented in details . </S>",
    "<S> these techniques are well - known amongst experts , but the current literature lacks a formal description . </S>",
    "<S> i hope that this technical report will prove useful to new researchers moving into this field , sparing them the task of reinventing the wheel . </S>"
  ]
}