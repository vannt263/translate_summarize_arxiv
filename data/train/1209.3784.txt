{
  "article_text": [
    "techniques for constructing 1d stellar models continually evolve in order to encompass more realistic physics .",
    "a stellar structure model is computed with a given set of physical assumptions and boundary conditions .",
    "stellar evolution models with convective envelopes require an approximation for convection to define the structure within the convection zone .",
    "current stellar models with convective envelopes are not accurate near the surface .",
    "this is largely due to the lack of a proper description for inefficient convection .    the mixing length theory ( mlt ; * ?",
    "* ) is the most commonly used approximation for convection in 1d stellar models .",
    "mlt represents the range of turbulent eddy - sizes with a single scale length that is proportional to the pressure scale height .",
    "the so - called  mixing length \" is @xmath0 , where @xmath1 is a free parameter .",
    "this prescription is able to accurately model the stellar structure where convection is efficient and the temperature gradient is nearly adiabatic . in the superadiabatic layer ( sal ) near the surface , however , the energy transport transitions from convective to radiative and mlt breaks down .",
    "note that some mlt treatments ( see e.g. , * ? ? ?",
    "* ) include an additional free parameter that sets the ratio between the eddy size and the distance it travels .",
    "other approximations for convection exist , such as the treatment of @xcite , but it , too , contains a length scale which has to be modeled . in this region of inefficient convection and convective overshoot",
    "we are unable to accurately model stellar structure .",
    "one of the major limitations of using mlt or similar treatments of convection in stellar models is that it effectively renders the stellar radius to be a free parameter . in 1d models with a given set of physics",
    ", the mixing length parameter @xmath1 determines the specific entropy of the convection zone , which in turn sets the radius of the model .",
    "in addition to the approximation for convection , stellar models require an atmospheric boundary condition .",
    "many stellar evolution codes force the atmospheric structure to be the eddington relation , although other model atmospheres can be used as well . in the case of the eddington relation ,",
    "the atmosphere is purely radiative , and does not include the effect of convective overshoot .",
    "this , too , contributes to the inaccuracy of near - surface layers in stellar models .    a promising strategy for improving our understanding of inefficient convection is to use 3d radiation hydrodynamic ( rhd ) large eddy simulations ( les ) to calculate a more realistic stratification . pioneered by",
    ", such simulations account for both the realistic transfer of energy through convective gas dynamics and radiative transfer in the sal where energy transport changes from convection to radiation .",
    "simulations provide a realistic stratification that self - consistently couples the convective envelope to the radiative atmosphere .",
    "simulating convection has been feasible for several decades , and a number of groups ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* etc . ) have performed 3d simulations of convection .",
    "simulations have been used to study 3d penetrative convection both above and below convective envelopes and have also been compared with 1d stellar and atmosphere models .",
    "several codes are currently being used by various groups to simulate near surface convection .",
    "these codes include stagger , co5bold @xcite , muram , antares @xcite , and our code , which is based on the code of @xcite .",
    "each of these codes has been developed independently , and can be quite different in their numerical treatment of radiative transfer , subgrid scale models , advection schemes , as well as input physics such as equations of state and opacity .",
    "simulations have been successfully applied to the outer convection zone in the sun and in a select group of individual stars .",
    "such simulations have led to improved p - mode oscillation frequencies in the outer layers of the models where errors in the sound speed contribute to discrepancies between the observed and model frequencies . including some turbulent effects has lead to improved frequencies in standard solar models as well as @xmath2 botis and @xmath1 centauri @xcite .",
    "simulating individual stars has been useful for understanding how convection affects stellar structure in particular cases , and a natural extension of this strategy is to simulate surface convection across the hr diagram .",
    "some progress has been made in parameterizing the turbulent dynamics in the sal in this way .",
    "for example , and @xcite have undertaken extensive efforts to map the mixing efficiency ( or effective @xmath1 for mlt ) using 2d rhd simulations , and constructing 1d envelope models by matching the specific entropy of the models and simulations .",
    "recently , @xcite used 3d simulations to map convective efficiency in a range of the hr diagram that includes main - sequence stars and giants . @xcite",
    "have also attempted to extract a mixing length parameter from simulations by matching averaged 3d simulation stratifications to 1d envelope models and modifying the turbulent pressure .",
    "simulations have also been applied to the formation of spectral lines and interferometric observables .",
    "famously used 3d spectral synthesis to study solar line profiles for abundance analysis , but similar techniques have since been used on the sun and other stars .",
    "while these applications have been largely successful , the accuracy of simulations is limited by what physical processes are included , and in what manner they are represented numerically .",
    "one way to get a handle on the uncertainty is through comparing different approximations for the same physical process .",
    "encouragingly , comparisons by @xcite , and more recently , show that existing codes are in good agreement for simulations of the sun .",
    "there are , however , apparent differences in the thermal structure . because there are numerous differences between each of the codes ,",
    "the source of the differences can not be traced to a particular method or approximation . and have looked at the effect of gray and non - gray opacities in 3d simulations , but their comparisons necessarily used the same radiative transfer method .",
    "the goal of this work is to examine the extent to which the radiative transfer method affects the resulting thermal structure and gas dynamics of the simulation , while keeping the rest of the physics the same . in sections [ sec : code ] and [ sec : rt ]",
    "we describe our code and the two radiative transfer schemes that we have implemented .",
    "section [ sec : compare ] compares results from simulations computed with each of the solvers .",
    "stellar convection zones can span many scale heights ( the solar convection zone exceeds 20 pressure scale heights ) and evolve over a range in timescales .",
    "the thermal relaxation time of an entire convection zone is too large to be simulated entirely with local rhd les , so the simulation domain is limited to several scale heights near the surface .",
    "energy transport transitions from fully convective at the bottom of the computational domain , to fully radiative at the top .",
    "the radiation hydrodynamics code is based on the code of @xcite .",
    "it solves the equations of hydrodynamics as described by @xcite , but the radiative term is computed using either the 3d eddington approximation or long - characteristic ray integration .",
    "radiative transfer is treated with the diffusion approximation in the lower part of the domain ( @xmath3 ) where it is valid .",
    "two popular simplifications to the governing equations are the boussinesq and anelastic approximations . in both cases ,",
    "sound waves are filtered out which relaxes the time step restriction imposed by the cfl condition .",
    "neither of these two approximations are suitable for simulating realistic stellar surface convection .",
    "the boussinesq approximation is not valid because it does not permit strong stratification and the mach number must be small .",
    "the anelastic approximation , which can be used in a heavily stratified flows , is valid only in the deep convection zone but is unsuitable for convection near the sal where the mach number is high .",
    "instead , we solve the fully compressible navier - stokes equations :    @xmath4    @xmath5    @xmath6 + \\rho \\vec{v}\\cdot\\vec{g } + q_{\\rm rad}\\ ] ]    where @xmath7 is the total energy density and @xmath8 , @xmath9 , @xmath10 , @xmath11 , and @xmath12 are the density , velocity , pressure , specific internal energy , and gravitational acceleration , respectively .",
    "the viscous stress tensor for a newtonian fluid is @xmath13 .",
    "the radiative term is computed using one of the two radiative transfer schemes described in section [ sec : rt ] . explicitly coupling the radiative term , , as a source term in the hydrodynamics equations",
    "imposes a restriction on the time step .",
    "switching radiative transfer solvers changes the method for computing , but does not ease the restriction .",
    "the nature of stellar convection makes it impossible to directly simulate the range in dynamical scales .",
    "les resolve the scales where most of the turbulent energy transport takes place , however , it is necessary to account for the energy transport on unresolved scales .",
    "we accomplish this by adjusting the dynamic viscosity to account for sub - grid scale stresses according to @xcite .    where possible , we keep the physics of the simulation consistent with that of the 1d stellar evolution code yrec .",
    "the code uses opal equation of state and opacity tables @xcite , and the @xcite tables for low temperature opacities .",
    "the two simulations presented in this work use rosseland mean opacity computed from the tables .",
    "the opacity and equation of state are both for the gs98 mixture @xcite .",
    "further , we treat radiative transfer in local thermodynamic equilibrium ( lte ) with gray opacities , but these are not limitations of the methods ; both can be extended to account for non - gray effects using methods described by , , and .",
    "there are numerous methods for the treatment of multidimensional radiative transfer ( see @xcite and references therein for a review of various methods ) .",
    "radiative transfer in 3d was first presented by @xcite .",
    "today , the most commonly used techniques for 3d radiative transfer are long- @xcite and short- @xcite characteristic methods .",
    "both of these methods share the same strategy for 3d spatial coverage , wherein they combine 1d solutions along a few selected rays to sample all @xmath14 steradians . in the following sections we describe the methods of long - characteristic ray integration and the 3d eddington approximation , which represent two fundamentally different approaches to achieve spatial coverage .",
    "domain coverage is important because the transfer of radiation is not a local problem in the sal .",
    "perhaps the most significant challenge for any 3d radiative transfer solver is to adequately account for the local angular variation of ( see section [ sec : raygeom ] ) .",
    "the two methods that we compare approximate 3d domain coverage in very different ways .",
    "ray integration techniques estimate by solving the transfer equation along 1d characteristics , but they have potentially poor spatial coverage that is achieved through combining a few 1d solutions . achieving complete domain coverage in this manner is not computationally feasible , so characteristic methods are necessarily undersampled .",
    "the 3d eddington approximation approaches the problem entirely differently . in it ,",
    "radiative transfer and domain coverage are approximated at the outset through moment equations that are closed at the first order . in the following sections we investigate the extent to which these two approximations affect the structure of the sal .",
    "the accuracy of the spatial coverage in moment methods such as the 3d eddington approximation can be enhanced by taking higher order moments , which is analogous to improving the spatial coverage of ray integration methods with additional characteristics .      as an alternative to characteristic based ray integration methods",
    ", the radiative transfer equation can be approximated through moment equations as described by @xcite :    @xmath15    and the net radiative heating or cooling is : @xmath16    the 3d eddington approximation has been used in codes applied to other astrophysical regimes ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) , although to our knowledge our code is the only application of it to simulations of near - surface convection .",
    "the eddington approximation describes isotropic radiation exactly in both optically thin and thick regions , and is not equivalent to the diffusion approximation in optically thin regions @xcite .",
    "further , although we use the planck function as the source function , the 3d eddington approximation does not strictly require lte .",
    "the 3d eddington approximation has advantages over other methods , afforded by its simplicity and speed .",
    "one of the advantages of the 3d eddington approximation is that the nature of its formulation alleviates concern that a nearby source or sink of energy will be missed as a result of limited domain coverage .",
    "this is not to say that the spatial domain is fully sampled ( it is still defined by first order moments ) , but it is complete in that it includes information from all other points and not just those that would be sampled by characteristics .",
    "the angular resolution is limited by the first order moments , but it is sensitive to the complete domain because of the iterative nature of the numerical solvers . at a particular location at an instant in time , the local computed from ray integration only includes information from along the characteristics , which could potentially miss an important source or sink .",
    "two grid points that are not connected by a ray can only influence each other indirectly . in simulations of convection in the sal",
    ", this risk is largely mitigated by the time evolution , or by rotating the undersampled bundle of rays in a manner similar to @xcite .",
    "complete domain sensitivity can be ensured by iterating on the ray solution , but this adds to the already high computational cost .",
    "the 3d eddington approximation achieves domain coverage without requiring such methods .",
    "the second advantage is that the 3d eddington approximation can be solved with a simple and fast numerical method .",
    "this is in a large part because the solution is computed directly on the hydrodynamic grid , and there is no need to define additional grids for radiative transfer along each characteristic . aside from the computational convenience of having the radiation and hydrodynamic solvers",
    "share the same grid , errors introduced from interpolation are also avoided .",
    "interpolation is likely not the dominant source of error , and is almost certainly smaller than the error introduced by the 3d eddington approximation for spatial coverage or the undersampled numerical quadrature , so avoiding interpolation is primarily a performance advantage .",
    "interpolations in ray integrations can be avoided altogether by casting rays so that they always intersect the hydrodynamic grid , but flexibility in ray placement would be lost , resulting in reduced domain sensitivity .      solving large sets of partial differential equations has been dealt with in great detail , and there exists a rich body of work from which we can develop solvers for the anisotropic inhomogeneous helmholtz equation ( see @xcite and references therein ) . the 3d eddington approximation , in conjunction with assuming lte to set the source function , results in a linear relationship for the mean intensity , @xmath17 . in principle , equation ( [ eqn : edd ] ) can be written as a large linear system and solved directly , but this is not done in practice because of the enormous computational cost .",
    "much faster iterative ( relaxation ) methods are used instead .    while classical relaxation techniques are sufficient to solve equation ( [ eqn : edd ] ) , methods with better convergence properties , such as alternating - direction - implicit ( adi ) and multigrid methods , reduce the computational burden significantly .",
    "multigrid methods are particularly powerful , as they can render the computational cost proportional to the number of grid points @xcite . in the following sections we describe two solvers that we use in the code .",
    "note that the two methods are exactly equivalent in that they produce solutions to equation ( [ eqn : edd ] ) that agree to within the specified error threshold . because the solvers result in the same solution , selecting a solver is based on numerical stability and parallel performance considerations .",
    "first introduced by @xcite and @xcite , adi methods are useful on regularly spaced multidimensional grids .",
    "both @xcite and @xcite describe the method in detail .",
    "each adi iteration is comprised of three one - dimensional implicit problems , obtained by splitting the terms in equation [ eqn : edd ] according to spatial dimension . for each spatial dimension ,",
    "the derivatives are treated implicitly only for that dimension .",
    "the terms corresponding to each dimension represent a series of tridiagonal linear systems , for which there are many fast solvers ( e.g. * ? ? ?",
    "the systems are solved sequentially in ` sweeps ' along each dimension .",
    "completing the three directional sweeps provides an improved estimate of the solution .",
    "the final solution is achieved by iterating until the desired error threshold is reached .",
    "the convergence properties of the adi technique are sensitive to the initial guess , asymmetry of the flow , and the problem size .",
    "our tests show that convergence is not always linear with problem size , which can become cost - prohibitive for very large grids .",
    "unlike the ray integration scheme , the adi solver does not present a natural parallelism that is as easy to exploit .",
    "although each tridiagonal system within a directional sweep is independent , the successive iterations can result in very high communication costs . to achieve scalability on distributed memory machines",
    ", we use a process - scheduling algorithm with asynchronous communication to overlap computation and communication .",
    "while it is not our intent to discuss parallel algorithms in detail , we point out that @xcite and @xcite discuss strategies for parallel adi algorithms .",
    "we have also implemented a so - called _ optimal algorithm _ using a geometric multigrid method .",
    "such methods solve partial differential equations using a recursive procedure applied to a hierarchy of grids .",
    "multigrid solvers achieve better convergence rates by reducing low - frequency errors on coarser grids and interpolating the solution to finer grids @xcite .",
    "the solution is mapped between grids using smoothing , restriction , and interpolation operators .",
    "the two major advantages of this method are stability and scalability .",
    "the multigrid method is much more stable than adi in regions of anisotropic flow .",
    "the adi method requires a good initial guess for the solution .",
    "using the solution at the previous time step for the initial guess is usually is sufficient , but if the flow is highly anisotropic , the adi method can fail to converge .",
    "unlike the adi solver , the multigrid solver does not require a good initial guess for the solution .",
    "this makes the solver very stable , even for highly turbulent flows , such as granulation in giants and early type stars .",
    "the scalability of the solver is _ optimal _ in the sense that in scales linearly with problem size .",
    "that is , is solves the equation with operational cost proportional to the number of unknowns .",
    "our tests confirm that the solution is achieved with @xmath18 operations without a good initial guess .",
    "although not strictly required , a good initial guess improves the speed of the solver .",
    "our multigrid method is based on the ` full multigrid ' solver described by @xcite , modified to solve the anisotropic inhomogeneous helmholtz equation in 3d , with periodic boundary conditions on the horizontal walls and neumann boundary conditions at the top .",
    "it employs w - cycle structure for multigrid cycles , and gauss - seidel smoothing with red - black ordering . as yet , our multigrid solver is not parallelized for distributed memory , which limits its use to shared memory machines , however , a full parallel version of this solver can be implemented following the strategy outlined by @xcite .",
    "ray integration methods are attractive because they solve the integro - differential radiative transfer equation along rays ( or characteristics ) , which provides a robust solution along a 1d path . extending the solution to 3d",
    ", however , requires solving the transfer equation along many ray paths that cover every direction .",
    "good domain coverage can be achieved when many rays are used , but the computational cost of this is typically too high . to alleviate the computational burden ,",
    "only a few rays are used .",
    "in contrast to the simplicity of the 3d eddington approximation , long - characteristic ray integration is comprised of a ray integration step and a spatial integration step that must be carried out at each location in the computational domain . the first part of the solution is to perform the 1d radiative transfer calculations at various angles through the domain . the second part of the solution is to integrate the result from the 1d rays at each grid point over the unit sphere with numerical quadrature .",
    "the details of how these two steps are implemented can have an effect on the final solution .",
    "we discuss our implementation in sections [ sec : rayrad ] and [ sec : raygeom ] below .    in terms of computational performance ,",
    "our 3d eddington solvers outperform the ray integrators ( see section [ sec : performance ] for a detailed comparison ) , but ray integration presents a natural parallelism that can be exploited . in modern computing , scalability is often more important than the inherent cost of the algorithm . and",
    "@xcite describe parallel algorithms for ray integration that can be applied to distributed memory machines using domain decomposition .",
    "the good performance over a large number of distributed memory compute nodes makes ray integration an attractive option for modern codes .      following the description of @xcite",
    ", we adopt the @xcite representation of the transfer equation for the numerical solution :    @xmath19    where @xmath20 is the source function ( taken to be the planck function ) , @xmath21 $ ] and @xmath22 and @xmath23 are the outgoing and incoming specific intensities at optical depth @xmath24 .",
    "the local heating / cooling is computed by integrating in each direction :    @xmath25    and the contribution to the net radiative heating or cooling for the ray is @xmath26    we use the hermitian differencing method of @xcite , which achieves 4th order accuracy while maintaining essentially the same cost as a 2nd order scheme .",
    "we found similar results for the final when using the 2nd and 4th order schemes , but the sensitivity on the result may depend on the spatial resolution of the simulation , as well as the method for interpolating between the hydrodynamic and radiation grids ( discussed below ) .",
    "we define all ray characteristics to begin at the top of the box and integrate into higher optical depth .",
    "rays are cast in directions defined by two angles @xmath27 .",
    "the @xmath28 angle is measured with respect to the vertical direction , and @xmath29 is the azimuth angle .",
    "each ray direction corresponds to a bundle of parallel rays that traverse the computational domain . in order to compute the formal solution along a given characteristic , the source function and optical depth must be known at each point along the ray . from this , the radiative heating or cooling is computed at each of the points where the source function and optical depth are known .",
    "because the ray integration is performed along lines that are not usually coincident with the hydrodynamic grid ( the vertical ray is an exception ) , the required thermodynamic variables must be mapped from the hydrodynamic grid to the radiation grid .",
    "the hydrodynamic grid is defined by the regular 3d cartesian mesh that specifies the locations of zone - centered quantities .",
    "the temperature , density , and opacity are tracked on this grid .",
    "the radiation grid is defined by the intersection points of a parallel ray bundle with the hydrodynamic grid .",
    "intersection points occur in 2d planes between the zone centers of the hydrodynamic grid , so a 2d interpolation is required at each intersection to determine the required thermodynamic quantities for ray integration .",
    "figure [ fig : gridmapping ] shows a schematic with one ray intersecting the hydrodynamic grid at a steep and shallow angle .",
    "a ray always has a vertical component ( we do not use periodic rays ) , so the final solution only requires points in the horizontal planes of the hydrodynamic grid . very shallow rays can traverse long distances between successive intersections of the horizontal planes of the hydrodynamic grid , so we include intersections of the vertical planes as well to ensure that each ray is adequately sampled before performing the feautrier integration . the intersections with vertical planes are only included if the distance to the next horizontal plane is large .",
    "this restriction avoids having points that are spatially very close together .",
    "the result is that the forward mapping ( from the hydrodynamic to radiation grid ) includes most intersections of the ray with the hydrodynamic grid , but the reverse mapping ( from the radiation to hydrodynamic grid ) only includes intersections of the ray with horizontal planes of the hydrodynamic grid .",
    "the mapping between the two grids introduces a smoothing to the solution twice .",
    "first , the hydrodynamic quantities ( in this case @xmath30 and @xmath31 ) must be interpolated to points along the ray bundles .",
    "the second smoothing occurs with the reverse transformation of interpolating the computed back to the hydrodynamic grid .",
    "the smoothing effect can be somewhat mitigated by employing higher order interpolation schemes , such as bicubic or distance weighted parabolas , but this will add to the computational expense .",
    "after the ray integration step , the contribution to the radiative heating or cooling is known for each ray direction , and the result of all rays at each grid point must be integrated over the unit sphere . to completely cover the 3d domain",
    ", rays need to be cast along every line of sight over @xmath32 steradians , at every point in the grid .",
    "this is far too computationally demanding , so we use only a few rays which are integrated over @xmath32 steradians using a quadrature rule .",
    "there are numerous quadrature rules available ( for example , see @xcite or @xcite ) and the choice of rule may affect the total radiative flux in the simulation .    for local rhd simulations we can take advantage of azimuthal symmetry by spacing rays at fixed intervals of @xmath29 , and the integration reduces to a 1d quadrature along the azimuth , and a second 1d quadrature along the cosine - angle .",
    "if the rays equally spaced in azimuth , the weights of rays with the same @xmath28 are equal , and the unit sphere integration is reduced to a one dimensional calculation . using a quadrature rule ,",
    "the integration is a weighted sum of the radiative heating at each grid point .",
    "adding to the number of rays improves the accuracy of the unit sphere integration , and achieving good spatial coverage is important for accurately calculating the local and total energy flux .",
    "typically only a few rays are used to keep the computational expense manageable .",
    "for example , the stagger code uses 5 rays which are rotated by 15 degrees every time step @xcite , or 9 rays in recent work .",
    "the solution is quite sensitive to integration over @xmath28 because the vertical energy flux is the largest contributor to the total flux .",
    "if the ray directions are not constrained by the hydrodynamic grid , the theta angle of the rays can be chosen to correspond to a desired quadrature rule . in this work we use gauss - radau quadrature @xcite with one vertical ray and four rays inclined at @xmath33 , which is the same as that used in the stagger code ( in @xcite ) .",
    "the vertical ray has a weight of @xmath34 and the four inclined rays have a combined weight of @xmath35 .",
    "spatial coverage is critical for radiative transfer in simulations of near - surface convection .",
    "a radiative transfer solver must have good spatial coverage because of the large asymmetries that convection introduces in the flow , and because the sal spans the transition from optically thick to thin where radiative transfer becomes non - local .",
    "the cost of good spatial coverage can be problematic for 3d rhd simulations , so approximations are made to the angular resolution to keep the computational costs affordable .",
    "the 3d eddington approximation simplifies spatial coverage through moments , while they ray integration relies on numerical quadrature . in both cases",
    "the result can be inaccurate if the function is highly variable or asymmetric .",
    "both of these properties exist for the radiative heating in the sal and pose a challenge for any affordable 3d radiative transfer method .",
    "the stellar flux is predominantly vertical ( introducing large asymmetry in the function ) and large horizontal variation can occur from the high contrast of hot upflowing granules and cool inter - granular lanes .",
    "the way that radiative transfer schemes deal with this is a large source of uncertainty and limits the absolute accuracy of the methods .",
    "for example , spatial quadrature rules based on different sets of polynomials will assign different weights to the vertical and horizontal rays , which can result in different estimates for the total energy fluxes from the same opacity and source function .",
    "this is a significant source of uncertainty , and one that can only be eliminated by using a very large number of rays .    to show how the ray integration method is sensitive to spatial coverage ,",
    "we compute using the long - characteristic ray solver with @xmath36 rays , on a snapshot from the thermally relaxed 3d eddington simulation .",
    "note that the number of rays is far in excess of what is typical or affordable for a simulation . in the simulations ,",
    "the result of the ray calculation is integrated over the unit sphere to achieve the net , which is then applied to the navier stokes equations . in this case , however , we average over azimuth and present the local as a function of cosine - angle .",
    "figure [ fig : localqrad ] presents several examples of the local corresponding to three different regions of surface granulation at the @xmath37 surface .",
    "we present the local in dimensionless units , normalized to the total stellar flux .",
    "even with 65 rays , the variation in local is not always well resolved .",
    "( -80,150 ) ( -233,150 ) ( -3,88 ) ( -155,88 )    the curve in the center panel of figure [ fig : localqrad ] shows for the center of a granule , where the local flux is dominated by the vertical ray .",
    "this is expected , as it is the hot upflows that contribute the majority of the stellar flux . because the center of a granule is hot and surrounded by hot gas",
    ", the heating from horizontal directions is quite small relative to the vertical flux . in upflowing regions such as this ,",
    "the large variation of the local function can make it difficult to determine the local energy flux if only a few rays are used .    in the narrow intergranular lanes ,",
    "the gas is cool and surrounded by much hotter upflows . here , the local energy flux is still dominated by the vertical direction , but the magnitude of the flux is much smaller than in the hot upflow .",
    "although there is still a net heat flux vertically , nearby upflows are heating the gas from shallower ( horizontal ) angles .",
    "the intergranular lanes show a large asymmetry of the local function , and the local flux can change sign at small angles",
    ". both of these properties can be troublesome for a sparsely sampled quadrature rule .",
    "regions of mixed flow , such as a small upflow that is near to an intergranular lane , show characteristics of both the hot and cold extremes described previously .",
    "the mixed flow example presented in figure [ fig : localqrad ] shows a similar vertical flux as in the downflow region , but has significant heating from angles far from vertical .",
    "furthermore , the variation in heating as a function of angle varies considerably over small angular increments .",
    "the local flux is much smaller than that from the center of a large granule , but the local function is still very asymmetric and dominated by the vertical direction .    the three examples in figure [ fig : localqrad ] show the angular variation in at an instant in time , and do not represent the bulk flow . because of the highly variable nature of the local profile , placing rays to adequately sample the vertical flux may be important for accurately determining the radiative energy flux .",
    "our comparison in section [ sec : compare ] of the moment - based 3d eddington approximation with the under - sampled ray integration method shows that they result in largely equivalent stratifications through the stellar sal .",
    "current 3d rhd simulations are limited by computational power , so it is prudent to compare the costs of these two methods that produce equivalent results .",
    "numerical solvers for moment based methods are fast , and offer significant computational savings .    in our experience",
    ", the 3d eddington solvers typically out - perform the ray integrators by a significant margin .",
    "figure [ fig : performance ] shows the time - to - solution for simulation domains of varying size .",
    "the radiation solvers are applied only to the top of the simulation domain where the temperature gradient is significantly superadiabatic .",
    "the cases presented here correspond to a simulations with a superadiabatic domains that are 65 zones deep and with varying horizontal sizes .",
    "all simulation runs for the comparison were performed on the same hardware using a single processor .",
    "the ray integration solver presented in figure [ fig : performance ] is our most economical one , which uses 5 rays with bilinear interpolation .",
    "note that the cost of additional rays is not simply proportional to the number of rays because shallow rays traverse a longer path through the simulation domain .",
    "a significant improvement in performance could be realized by adopting the scheme described by @xcite , where only ray intersections with horizontal planes are included , and by aligning the azimuthal angle of the rays with the hydrodynamic grid , thereby reducing interpolations to one dimension .",
    "the smaller computational cost of the one dimensional interpolations comes with the consequence of reduced domain sensitivity because the azimuth angle of the rays could no longer be rotated each time step . because the ray integrator is not iterative , for a given ray configuration the amount of computational work is linearly proportional to the size of the grid . increasing the horizontal extent of the simulation domain results in the expected linear increase in computational cost .",
    "similarly , the cost of both the adi and multigrid solvers for the 3d eddington equation show a roughly linear proportionality with grid size .",
    "a good initial guess is necessary for the adi method to achieve linear scaling , but no such guess is necessary for the multigrid method .",
    "the iterative 3d eddington solvers have a tolerance parameter that defines how close the numerical solution matches equation ( [ eqn : edd ] ) we see a performance benefit by adjusting the tolerance parameter from @xmath38 to @xmath39 .",
    "the speed difference between the moment and characteristics methods can make a tangible difference .",
    "given that the computational cost of a 3d radiation hydrodynamics simulation is typically dominated by the radiation solver , the transport of radiation is simplified , for example , by limiting the domain coverage , or by limiting the frequency coverage to a few opacity bins .",
    "the computational cost savings afforded by moment based methods , which appear to offer similar domain coverage as under - sampled ray integration , could be used to better cover the frequency domain using opacity binning or sampling techniques .",
    "we have implemented the two methods described in section [ sec : rt ] for computing radiative heating and cooling in a 3d les .",
    "while differences in the methods are clear , the only way to determine their effect on the thermal structure and gas dynamics from solving the navier - stokes equations is to use them in simulations .",
    "because is essential in determining the thermal structure , we can not compare methods on the same simulation snapshot at an instant in time .",
    "instead , we compare statistics gathered from long runs of simulations computed with each radiative transfer solver .    in this section we compare results of two simulations : one computed with the 3d eddington approximation using the adi solver ( described in section [ sec:3deddington ] ) , and the other with long - characteristic ray integration ( described in section [ sec : rayint ] ) .",
    "the two simulations have the same composition ( @xmath40 , @xmath41 ) , energy flux ( @xmath42 ) , and surface gravity ( @xmath43 ) .",
    "both simulations span @xmath44 with a resolution of @xmath45 .",
    "we started each simulation from the same state and evolved them until they achieved a new thermal relaxation based on their respective radiative models .",
    "statistics were gathered after thermal relaxation .",
    "the following sections compare various space- and time - averaged quantities from the two simulations .",
    "figures show the mean values with standard error as a function of height in the simulation domain .",
    "the zero point is defined as the location where the average temperature is equal to the effective temperature .",
    "we use the following definitions for statistical quantities .",
    "@xmath46    where the quantity has been averaged over a time @xmath31 in a box of horizontal cross - sectional area @xmath47 , and @xmath48 is a time after the simulation has relaxed .",
    "the time average is over a sufficient interval to obtain statistical convergence .",
    "the rms of the same quantity is : @xmath49      the purpose of the radiative transfer method is to transfer energy within the simulation domain , and determine how energy is ultimately removed ( the stellar flux ) .",
    "the local contribution to radiative heating or cooling comes from applying the radiative transfer solver to the inhomogeneous medium .",
    "different radiative transfer methods can remove the same total energy from a given stratification , but the energy may be removed in different ways . in this case , the effective temperature ( measured as @xmath50 ) remains unchanged , but the thermal structure is different .",
    "this effect would appear as a different transition from convective to radiative energy transport and would affect the shape of the superadiabatic gradient ( @xmath51 ) .",
    "we refer to this as the ` radiative efficiency ' .",
    "the radiative efficiency determines the rate of transition from convective to radiative energy transport .",
    "a more ` efficient ' method will start to be super - adiabatic deeper in the star , and will have a higher peak in the superadiabatic gradient .",
    "figure [ fig : qrad ] compares the radiative heating averaged over space ( horizontal ) and time .",
    "the integral of this function over height is the total energy flux .",
    "both methods have essentially the same energy flux ( their effective temperatures differ by only 30 k , or 0.5% ) . the radiative transfer method has no effect on the adiabatic structure where the diffusion approximation is valid , so the 3d eddington and ray integration methods have the same deep stratification .",
    "convection carries the energy flux in the optically thick region , and is not directly affected by the differences in radiative transfer schemes .",
    "( -465,180 )    the superadiabatic gradient in figure [ fig : sal ] shows a corresponding change .",
    "a rising parcel of hot gas becomes superadiabatic at greater depth below the sal in the ray method compared with 3d eddington . at the peak of the sal",
    ", however , the 3d eddington method radiates more efficiently resulting in a higher peak .",
    "this means that below the sal , the ray method is more efficient at transferring energy radiatively , but becomes slightly less efficient throughout and above the sal peak .",
    "the differences are subtle but induce changes to some flow properties ( figure [ fig : wrms ] ) and the mean stratification ( figure [ fig : rho ] ) in the superadiabatic part of the domain .",
    "the superadiabatic gradient of the 3d eddington simulation is more negative throughout the atmosphere .",
    "figure [ fig : rho ] shows the density stratification as a function of temperature .",
    "both simulations have the same stratification in the convective region and differ only in the sal and optically thin atmosphere .",
    "the stratifications agree in the deep region because the two radiative transfer methods compute the same total radiative flux for a given stratification .",
    "the energy transfer in the deep region is entirely convective and is indirectly affected by the radiative energy transport closer to the surface .",
    "the details of the radiative energy transport schemes are different in each simulation , so the shallow region near the top has relaxed to a different state .",
    "the result is that the temperature and density structures of the simulations are distinct .",
    "the density and temperature profiles diverge as the temperature gradient becomes significantly superadiabatic .",
    "the densities differ by a factor of approximately @xmath52 within the sal ( at @xmath53 ) , and by a factor of approximately @xmath54 in the atmosphere ( at @xmath55 ) .",
    "note that this discrepancy is similar to the range exhibited in the comparison of solar simulations by @xcite .",
    "the differences are likely caused by the different radiative efficiencies . while the two simulations have the same total energy flux ( the integral of over height ) , their cooling profiles in figure [ fig : qrad ] distinct .",
    "simulations contain many numerical and physical aspects that can affect the results .",
    "the thermal structures for solar simulations computed using different codes with a variety of physical inputs and parameters are indeed different .",
    "the stratifications in figure [ fig : rho ] are within the range of what is seen when comparing results from different codes [ for example see figure 1 from @xcite ] . except for the radiative transfer ,",
    "all parameters that define the two simulations are the same , so the change in stratification seen here is due entirely to the different radiative transfer schemes .",
    "both radiative transfer methods result in sal structures that are realistic .",
    "although we can not determine which is more accurate , these results provide a measure of the accuracy of 3d radiative transfer schemes in simulations .    the thermal structure of the atmosphere is often presented as the variation of temperature with optical depth . in stellar models ,",
    "this so - called relation is imposed as a boundary condition .",
    "typically , the eddington relation is used for computing stellar models , i.e. ,    @xmath56    which is purely radiative , and does not include the effects of convective overshoot .",
    "this is one of the reasons that stellar models are inaccurate near the surface .",
    "taking relations from simulations and using them in stellar models is a simple way to include overshoot .",
    "we find that the simulated relation is sensitive to the radiative transfer scheme . while similar to figure [ fig : rho ] which shows structural differences in the sal , figure [ fig : ttau ] highlights the differences at small @xmath24 .",
    "several analytic and semi - empirical relations are included in figure [ fig : ttau ] for reference .",
    "the simulations deviate from the purely radiative eddington relation because they include the effects of convective overshoot and turbulence .",
    "these differences are expected for realistic atmospheres , as demonstrated by the semi - empirical @xcite and @xcite models .",
    "simulations computed by @xcite also show changes in relations as a result of convection .",
    "one of the consequences of convective overshoot is a shift in the location of the mean surface with respect to mean optical depth .",
    "the surface from the 3d eddington simulation is very close to @xmath57 , while the ray integration simulation is at slightly smaller ( @xmath58 ) optical depth .",
    "the slight differences in the turbulent properties of the simulations ( which is a result of the different entropy profiles from using different radiative transfer models ) produces slightly different positions of the surface .",
    "a shift in the surface is not entirely surprising considering that semi - empirical relations have mean surface at much smaller @xmath24 .",
    "the simulations both produce plausible relations . while distinct from each other , they are both within the range of solar semi - empirical relations .",
    "both simulations are closest to the analytic eddington relation at optical depths near to or greater than unity , but deviate from it higher in the atmosphere . at small optical depth ( @xmath59 ) the ray simulation is closest to the relation of @xcite , while the 3d eddington simulation appears to be similar to @xcite .",
    "the convective velocities in the sal result in added support in the form of turbulent pressure .",
    "stellar models computed with mixing length theory do not include the effects of turbulent pressure .",
    "the added pressure from turbulence modifies the hydrostatic balance and is an important consideration for improving stellar models .",
    "velocity statistics remain largely unchanged between the simulations .",
    "figure [ fig : wrms ] shows that the rms of the vertical velocity as a function of height is nearly the same in both the ray and 3d eddington simulations .",
    "the rms vertical velocities are identical below the peak of the sal , and show very minor differences above .",
    "this is because the velocities are generated in the adiabatic convectively unstable region , and both simulations have the same adiabat .",
    "as seen in figure [ fig : wrms ] , they can only start to deviate from each other in the sal and convective overshooting regions where the different radiative transfer schemes have altered the stratification .",
    "convection provides a significant source of support in the sal .",
    "turbulent pressure is defined as : @xmath60 where @xmath61 is the rms of the vertical velocity .",
    "turbulent pressure is small in the adiabatic region where gas pressure is high , reaches a maximum in the sal , and drops quickly in the atmosphere where gas density is low .",
    "the two simulations show a relatively small change in from 13% to 14% when the radiative transfer model is changed .",
    "again , this is primarily a result of the differences in thermal structure ( the density is different for a given temperature ) since we see little change in the rms velocity .    while the radiative transfer scheme is the sole cause for the differences in figure [ fig : pturb ] , turbulent pressure is also sensitive to other aspects of the simulation . as was the case with the mean stratification in figure [ fig : rho ] ,",
    "the change in turbulent pressure caused by the different radiative transfer schemes is within the range of what is seen in simulations computed using different codes .",
    "for example , shows ranging from 16% to 18% between solar simulations computed with the stagger , co5bold , and muram codes .",
    "we used 3d radiation hydrodynamic simulations to compute the thermal structure near the surface of stars where energy transport transitions from fully convective to fully radiative .",
    "since convection is multidimensional , achieving proper domain coverage is essential in providing accurate radiative transfer .",
    "radiative transport in 3d is computationally demanding , and to keep computational costs manageable , we make approximations to either the transfer equation or to domain coverage .",
    "our convection code includes two radiative transfer schemes that fundamentally differ in their methods for domain coverage .",
    "the commonly used long - characteristic ray integration provides accurate solutions along individual rays , but lack of computational power necessitates under - sampling the domain and precludes proper 3d coverage .",
    "the highly variable and asymmetric nature of makes it difficult to accurately sample the full 3d domain unless a great many rays are used , which is currently computationally cost prohibitive .",
    "our experience with undersampled ray integration suggests that it is important to consider the placement of the rays with respect to the highly asymmetric local flux , as the total flux may be sensitive to how well the local flux is sampled by the rays .",
    "we contrast the ray method with the 3d eddington approximation , which is derived from moment equations closed at the level of first order , and has some computational advantages over long characteristic ray integration .",
    "we find good general agreement in mean quantities from simulations computed with the 3d eddington approximation and the long - characteristic ray integration method .",
    "both simulations have the same adiabatic structure in the convective interior , and the same energy flux .",
    "they do , however , differ in radiative efficiency as a function of depth .",
    "the differences in energy transport primarily affects the thermal structure of the sal and atmosphere , while leaving the gas dynamics largely unchanged .",
    "the most significant differences we find are in the mean temperature stratification through the sal and the relation in the atmosphere . although the relations are distinct , they both compare well with semi - empirical solar relations .",
    "limb - darkening measurements may lead to improved constraints on the solar relation .",
    "we note that results from ray integration and the 3d eddington approximation may differ in the photosphere beyond the domain of the simulations studied here .",
    "further study is necessary to determine whether there are differences in the photosphere of the 3d rhd simulations , and to what extent any differences have on observable quantities , such as features derived from spectral line synthesis using structures computed from the 3d simulations .",
    "simulations computed with the 3d eddington approximation and under - sampled long - characteristic ray integration both provide similar thermal structures that self - consistently couple the region of efficient adiabatic convection to the atmosphere . indeed , the differences seen by changing the radiative transfer scheme are within the range of results of solar simulations computed using different codes .",
    "we therefore conclude that both radiative transfer techniques give rise to robust results for the angular resolution afforded by current computational power .",
    "the authors thank the anonymous referee for insightful comments and suggestions that have helped to improve the paper .",
    "jt is supported by a pgs - d scholarship of the natural sciences and engineering research council of canada and by nasa atfp grant # nnx09aj53 g to sb .",
    "this work was also supported in part by the facilities and staff of the yale university faculty of arts and sciences high performance computing center .                                                                        ,",
    "b. , ludwig , h .- g . , & steffen , m. 1999 , in astronomical society of the pacific conference series , vol .",
    "173 , stellar structure : theory and test of connective energy transport , ed .",
    "a.  gimenez , e.  f. guinan , & b.  montesinos , 225      , b. , allard , f. , ludwig , h .-",
    "g . , homeier , d. , & steffen , m. 2011 , in astronomical society of the pacific conference series , vol .",
    "448 , astronomical society of the pacific conference series , ed . c.  johns - krull , m.  k. browning , & a.  a. west , 855                , y.  k. , kim , y .- c . ,",
    "robinson , f.  j. , demarque , p. , & chan , k.  l. 2007 , in astronomical society of the pacific conference series , vol .",
    "362 , the seventh pacific rim conference on stellar astrophysics , ed .",
    "y.  w. kang , h .- w .",
    "lee , k .- c .",
    "leung , & k .- s .",
    "cheng , 306                                  , a. 1985 , in progress in stellar spectral line formation theory ; proceedings of the advanced research workshop , trieste , italy , september 4 - 7 , 1984 ( a86 - 37976 17 - 90 ) .",
    "dordrecht , d. reidel publishing co. , 1985 , p. 215 - 224 .",
    "research supported by the rumudvalget and statens naturvidenskabelige forskningsrad of denmark . , ed .",
    "j.  e. beckman & l.  crivellari , 215224          ,  . , & stein , r.  f. 2000 , in astronomical society of the pacific conference series , vol .",
    "203 , iau colloq .",
    "176 : the impact of large - scale surveys on pulsating star research , ed .",
    "l.  szabados & d.  kurtz , 362372        , l. , kervella , p. , dib , s. , & hauschildt , p. 2011 , in sf2a-2011 : proceedings of the annual meeting of the french society of astronomy and astrophysics , ed .",
    "g.  alecian , k.  belkacem , r.  samadi , & d.  valls - gabaud , 235239      , l. , stein , r.  f. , melo , s. , et  al .",
    "2011 , in sf2a-2011 : proceedings of the annual meeting of the french society of astronomy and astrophysics , ed .",
    "g.  alecian , k.  belkacem , r.  samadi , & d.  valls - gabaud , 407410                                          , r. , christensen - dalsgaard , j. , nordlund , a. , & stein , r. 1997 , in astrophysics and space science library , vol .",
    "225 , score96 : solar convection and oscillations and their relationship , ed . f.  p. pijpers , j.  christensen - dalsgaard , & c.  s. rosenthal , 7376      , r. , stein , r.  f. , christensen - dalsgaard , j. , & nordlund ,  . 1999 , in astronomical society of the pacific conference series , vol .",
    "173 , stellar structure : theory and test of connective energy transport , ed .",
    "a.  gimenez , e.  f. guinan , & b.  montesinos , 233"
  ],
  "abstract_text": [
    "<S> we examine the effect of different radiative transfer schemes on the properties of 3d simulations of near - surface stellar convection in the superadiabatic layer , where energy transport transitions from fully convective to fully radiative . </S>",
    "<S> we employ two radiative transfer schemes that fundamentally differ in the way they cover the 3d domain . </S>",
    "<S> the first solver approximates domain coverage with moments , while the second solver samples the 3d domain with ray integrations . by comparing simulations that differ only in their respective radiative transfer methods , we are able to isolate the effect that radiative efficiency has on the structure of the superadiabatic layer . we find the simulations to be in good general agreement , but they show distinct differences in the thermal structure in the superadiabatic layer and atmosphere . </S>"
  ]
}