{
  "article_text": [
    "the widely used neighbor - joining algorithm @xcite has been extensively analyzed and compared to other tree construction methods .",
    "previous studies have mostly focused on empirical testing of neighbor - joining .",
    "examples include the comparison of neighbor - joining with quartet @xcite and maximum likelihood @xcite methods , comprehensive comparisons of multiple programs @xcite , and detailed testing of the limits of the neighbor - joining algorithm @xcite .",
    "these studies have concluded that neighbor - joining is effective for many problems , and have recommended the algorithm .",
    "for example , in @xcite it is remarked that `` quartet - based methods are much less accurate than the simple and efficient method of neighbor - joining '' . in a recent study , tamura et al .",
    "@xcite conclude that there are `` bright prospects for the application of the nj and related methods in inferring large phylogenies . ''",
    "furthermore , new methods are now almost always compared with neighbor - joining to establish an improvement in performance @xcite . in other words ,",
    "neighbor - joining has become the standard by which new phylogenetic algorithms are compared , and continues to surface as an effective candidate method for constructing large phylogenies .",
    "this is remarkable , considering the simplicity of the neighbor - joining algorithm .",
    "we begin with a review of the neighbor - joining algorithm and a very brief description of basic concepts involved .",
    "the definitions and notation are based on @xcite .",
    "the reader unfamiliar with the concepts described below should consult this reference for full details .    throughout the text a _",
    "phylogenetic @xmath0-tree _",
    "@xmath1 denotes a binary tree describing the evolutionary relationships between a set of taxa @xmath0 , which label the leaves of the tree .",
    "we will also use the term _ phylogenetic tree _ when the set @xmath0 is clear from the context .",
    "a _ cherry _ of @xmath1 is a pair of leaves ( or taxa ) @xmath2 such that the path from @xmath3 to @xmath4 in @xmath1 has length exactly 2 ( i.e. @xmath5 have a common `` parent '' in @xmath1 ) .",
    "a split @xmath6 of @xmath0 is a bipartition @xmath7 and @xmath8 .",
    "in general we will use splits of @xmath0 induced by removing an internal edge of @xmath1 ( which will result in creating two disconnected trees , one with leaf set @xmath9 and the other with leaf set @xmath10 ) .",
    "a dissimilarity map on @xmath0 is a map @xmath11 satisfying @xmath12 , @xmath13 and @xmath14 for all @xmath15 .",
    "a tree metric , or an additive dissimilarity map , is a dissimilarity map @xmath16 for which there exists a tree @xmath1 with edge lengths @xmath17 such that @xmath18 where @xmath19 is the set of edges in @xmath20 on the path from @xmath3 to @xmath4 in @xmath1 .",
    "we note that for an additive dissimilarity map , the tree topology and edge lengths @xmath21 are uniquely defined .",
    "+ we are now ready to give the full description of neighbor - joining :    1 .   given a set of taxa @xmath0 and a dissimilarity map @xmath22 ( this is a map that satisfies @xmath23 and @xmath24 ) , compute the _ q - criterion _ for @xmath16 @xmath25 then select a pair @xmath26 that minimize @xmath27 as motivated by the following theorem : + [ thm : saitou ] let @xmath28 be the tree metric corresponding to the tree @xmath1 .",
    "the pair @xmath26 that minimizes @xmath29 is a cherry in the tree .",
    "2 .   if there are more than three taxa , replace the putative cherry @xmath30 and @xmath31 with a leaf @xmath32 , and construct a new dissimilarity map where @xmath33 .",
    "this is called the _ reduction step_. 3 .",
    "repeat until there are three taxa .",
    "although the @xmath34-criterion is easy to compute , the formula seems , at first glance , somewhat contrived and mysterious .",
    "however , the formulation of the @xmath34-criterion is not accidental and has many useful properties .",
    "for example , it is linear in the distances , is permutation equivariant ( the input order of the taxa do nt matter ) , and it is _ consistent _ , i.e. , it correctly finds the tree corresponding to a tree metric .",
    "bryant @xcite has shown that the @xmath34-criterion is in fact the unique selection criterion satisfying these properties .",
    "gascuel and steel @xcite in an excellent review , provide a very precise mathematical answer to `` what does neighbor - joining do ? '' , via a proof that neighbor - joining is a greedy algorithm which `` decreases the whole tree length '' as computed by pauplin s formula @xcite .",
    "these results motivate the neighbor - joining algorithm , but they do not offer any insight into its performance with dissimilarity maps that are not tree metrics .",
    "more importantly , they do not address the central question of the behavior of neighbor - joining on dissimilarity maps that arise from maximum likelihood estimation of distances between sequences in multiple alignments .",
    "there is one result that addresses precisely these issues :    neighbor - joining has @xmath35 radius @xmath36 .",
    "this means that if the distance estimates are at most half the minimal edge length of the tree away from their true value then neighbor - joining will reconstruct the correct tree .",
    "atteson s theorem shows that neighbor - joining is _ statistically consistent_. informally , this means that neighbor - joining reconstructs the correct tree from dissimilarity maps estimated from sufficiently long multiple alignments .",
    "this has been a widely used justification for the observed success of neighbor - joining , and is regarded as the definitive explanation for `` when does neighbor - joining work ? '' @xcite .",
    "however , as noted in @xcite , atteson s condition frequently fails to be satisfied even when neighbor - joining is successful .",
    "this is also remarked on in @xcite : `` in practice , most distances are far from being nearly additive [ satisfying atteson s condition ] .",
    "thus , although important , optimal reconstruction radius is not sufficient for an algorithm to be useful in practice . ''",
    "our main result is an explanation of why neighbor - joining is useful in practice .",
    "we obtain our results using a new consistency theorem ( theorem [ thm : main ] in section 4 ) . roughly speaking , our theorem states that neighbor - joining is successful ( globally ) when it works correctly ( locally ) for the quartets in the tree .",
    "thus , theorem [ thm : main ] provides a crucial link between neighbor - joining and quartet methods , a connection that is first developed in section 3 .",
    "we also show that atteson s theorem is a special case of our theorem .    in section 5 we present a proof of atteson s conjecture on the optimal edge radius of neighbor - joining . for a dissimilarity map @xmath16",
    "whose @xmath37 distance to a tree metric @xmath28 is less than @xmath38 , we prove that the output @xmath39 of neighbor - joining applied to @xmath16 will contain all edges of @xmath1 of length at least @xmath40 , i.e. , neighbor - joining has @xmath37 edge radius @xmath41 .",
    "we say that @xmath39 contains the edge @xmath42 if there exists an edge @xmath43 such that the split of the taxa induced by removing @xmath44 from @xmath39 is the same as that induced by removing @xmath42 from @xmath1 .",
    "this result is tight , as @xcite provides a counterexample for edge radius larger than @xmath41 .",
    "the methods we employ for this result are virtually the same as the ones used in the proof of theorem 16 , although the proof is non - constructive and based on an averaging argument .",
    "we conclude with a simulation study that establishes the practical significance of our theorems in section 6 .",
    "in this section we provide a few preliminary observations that are necessary for our results .",
    "we begin by reviewing a lemma from @xcite , namely that there is an alternative to the reduction step ( 2 ) in the neighbor joining algorithm .",
    "condition ( 2 ) : if there are more than three taxa , replace the putative cherry @xmath30 and @xmath31 with a leaf @xmath32 , and construct a new dissimilarity map where @xmath45 .",
    "notice that the only difference between ( 2 ) and ( 2 ) consists of addition of the @xmath46 term . on a tree metric , the first version of the algorithm corresponds to replacing a cherry by a single node",
    "whose distance to the rest of the tree is the average of the distances of the two collapsed nodes . in the second version ,",
    "the reduction step is equivalent with replacing the cherry by its `` root '' , i.e. , the point where the path between the cherry nodes connects to the rest of the tree .",
    "we say the dissimilarity map @xmath47 is a _ shift _ of @xmath16 if and only if there exists a fixed @xmath40 and a distinguished taxon @xmath30 , such that @xmath48 for all @xmath49 and @xmath50 for all @xmath51 .",
    "[ lem : shifting ] shifting does not affect the outcome of neighbor - joining .",
    "* proof * : this follows from the observation that shifting by @xmath40 around @xmath30 changes the value of @xmath52 by exactly @xmath53 , for all pairs @xmath54 .",
    "moreover , the result of collapsing taxa @xmath54 in the shifted dissimilarity map is the same as the result of collapsing the same taxa in the initial dissimilarity map , or an @xmath40 shift of it . by these two observations , at each step neighbor - joining will collapse the same pairs as before the shift .",
    "the two versions of neighbor - joining are equivalent : they produce trees with the same topology .",
    "* proof * : collapsing @xmath54 by the second reduction method gives a dissimilarity map that is a @xmath55-shift of the one produced by collapsing by the first type of reduction step .",
    "it is important to notice that the operation of shifting a real tree metric @xmath28 by @xmath40 around taxon @xmath30 corresponds exactly to modifying the length of the leaf edge of @xmath1 corresponding to @xmath30 by exactly @xmath40 .",
    "so in effect we can allow negative leaf edges since shifting around all leaves by a large enough constant will make them positive , while the outcome of the algorithm is the same .",
    "of course , the statement of our edge radius results does not make sense in the case of negative edge lengths .",
    "however , the only negative edges are the leaf edges , and in that case the statements we make are vacuous .",
    "they hold trivially since neighbor - joining reconstructs the bipartition consisting of one taxon vs. the rest of the taxa set correctly , regardless of the input .    in the remainder of the paper , by a tree metric",
    "we will mean a shift of a tree metric , i.e. a metric corresponding to a tree where leaf edges are allowed to be negative .",
    "we now show that for four taxa , neighbor joining is equivalent to the _ four point method _ @xcite .",
    "we will use the notation @xmath56 to denote the tree topology on the set @xmath57 where the pairs @xmath58 and @xmath59 form cherries separated by a middle edge .",
    "when @xmath60 are leaves ( internal or external ) of a tree @xmath1 , we will say that @xmath56 is a quartet of @xmath1 if the topology induced by @xmath1 on the four nodes is that indicated by @xmath56 .",
    "[ prop : fourtaxa ] let @xmath61 and @xmath62 be a dissimilarity map .",
    "the neighbor - joining algorithm will return the tree @xmath56 where @xmath63 .",
    "this result can be easily derived using the @xmath34-criterion , but we prefer to motivate it using an alternative formulation of the neighbor - joining criterion formulated in @xcite .    for a dissimilarity map @xmath16 , let @xmath64 note that for a quartet @xmath56 in a tree @xmath1 with corresponding tree metric @xmath28 , @xmath65 is double the length of the internal edge in the quartet . in @xcite this is called a `` neighborliness '' measurement .",
    "[ thm : zcriterion ] if @xmath28 is the tree metric corresponding to a phylogenetic @xmath0-tree @xmath1 and @xmath66 then the pair @xmath26 that maximizes @xmath67 is a cherry in the tree .    *",
    "proof * : let @xmath68 .",
    "the sum in @xmath69 is over unordered pairs of @xmath70 .",
    "observe that for any @xmath16 @xmath71 where @xmath72 does not depend on @xmath3 or @xmath4 .",
    "the theorem now follows directly from theorem [ thm : saitou ] .",
    "although the naive computation of the _ @xmath73-criterion _ requires quadratic time , the equivalence with the @xmath34-criterion shows that each entry in the @xmath73-matrix is just a sum of a linear number of distances .",
    "one may therefore wonder why the @xmath73-criterion is worth mentioning at all .",
    "we outline a number of reasons why the @xmath73-criterion may be a more natural way to formulate the neighbor - joining selection criterion .",
    "for example , note that in the case of four taxa @xmath60 , the @xmath73-criterion is just @xmath74 and proposition [ prop : fourtaxa ] follows immediately from theorem [ thm : zcriterion ] .",
    "the @xmath73-criterion also highlights the fact that for a tree metric , the neighbor - joining selection criterion does not depend on the length of edges adjacent to leaves .",
    "this is remarked on in the proof of the consistency of neighbor - joining in @xcite .",
    "furthermore , for a dissimilarity map @xmath16 , @xmath75 is precisely the difference between the balanced minimum length of @xmath16 with respect to the star tree , and the length with respect to the tree containing the cherry @xmath58 with the remaining taxa unresolved ( see figure 1 in @xcite and the accompanying discussion ) .",
    "finally , the @xmath73-criterion highlights the connection between neighbor - joining and quartet methods .",
    "recall that the naive quartet method consists of choosing a quartet for each four taxa using the four point method ( proposition [ prop : fourtaxa ] ) , and then returning the tree consistent with all the quartets ( if such a tree exists ) .",
    "this leads us to    [ defn : quartetconsistency ] a dissimilarity map @xmath16 is _ quartet consistent _ with a tree @xmath1 if for every @xmath76 , @xmath77 .",
    "by definition , the naive quartet method will reconstruct a tree @xmath1 from a dissimilarity map @xmath16 if @xmath16 is quartet consistent with @xmath1 .",
    "we note that this is essentially the same as the addtree method @xcite , with the minor difference that addtree always outputs a tree , albeit potentially the wrong one if @xmath16 is not quartet consistent with @xmath1 .    in the next section",
    "we will prove the following extension of proposition [ prop : fourtaxa ] :    [ thm : fourtoseven ] if @xmath78 and @xmath79 is a dissimilarity map that is quartet consistent with a binary tree @xmath1 then the neighbor - joining algorithm applied to @xmath16 will construct a tree with the same topology as @xmath1 .",
    "furthermore , if @xmath80 then there exists @xmath81 such that if @xmath82 will reconstruct a tree with the same topology as @xmath1 .",
    "as we have pointed out , neighbor - joining is equivalent to the naive quartet method and addtree for @xmath83 .",
    "theorem [ thm : fourtoseven ] states that neighbor - joining is at least as good as the naive quartet method for trees with at most @xmath84 taxa , and is in fact robust to small changes in the metric .",
    "let @xmath1 be the 5 leaf tree shown in figure 1 that corresponds to the tree metric @xmath28 , and consider the distorted dissimilarity map @xmath16 @xmath85 note that @xmath16 is not quartet consistent with @xmath1 , because @xmath86 .",
    "however it is easy to verify that neighbor - joining constructs a tree with the same topology as @xmath1 .",
    "the example shows that neighbor - joining can construct the correct tree even when the naive quartet method and addtree fail .",
    "the next example shows that theorem [ thm : fourtoseven ] fails for trees with more than @xmath84 taxa .",
    "let @xmath1 be the 8 leaf tree shown in figure 2 and let @xmath28 be its corresponding tree metric .",
    "@xmath87 consider the distorted dissimilarity map @xmath88 that is quartet consistent with @xmath1 . it is easy to see that @xmath89 , while @xmath90 .",
    "therefore the function @xmath27 is not minimized at one of the cherries of @xmath1 , and the neighbor - joining algorithm applied to @xmath16 outputs a tree different from @xmath1 , in which @xmath54 form a cherry .    fortunately , there is a single extra condition which ensures that neighbor - joining correctly reconstructs a tree . in what follows",
    "we say that a leaf @xmath91 is _ interior to a quartet _ @xmath56 in a tree @xmath1 if none of @xmath92 , @xmath93 , @xmath94 , or @xmath95 are quartets in @xmath1 .",
    "[ fig : quartetadditivity ]        [ def : quartetadditivity ] a dissimilarity map @xmath96 is _ quartet additive _ with a tree @xmath1 if for every @xmath97 with @xmath91 interior to @xmath56 , and @xmath98 not interior to @xmath56 such that @xmath99 is not a quartet of @xmath1 , we have @xmath100 ( see figure 3 ) .",
    "we conclude with three basic lemmas that are important in the next section .",
    "the proofs are left as an exercise for the reader .",
    "quartet consistency and additivity are both invariant with respect to the shifting operation .    [ spectator ] for any @xmath101 , @xmath102    the spectator lemma",
    "is used to prove    [ spectator1 ] for any @xmath103 , @xmath104 where @xmath105 .",
    "[ thm : main ] if @xmath106 is quartet consistent and quartet additive with a tree @xmath1 , then neighbor - joining applied to @xmath16 will construct a tree with the same topology as @xmath1 .",
    "the proof of the theorem consists of two main parts .",
    "first , we show that when the reduction step collapses a pair of taxa @xmath107 which form a cherry in @xmath1 , then the dissimilarity metric given by reducing @xmath16 is quartet consistent and additive with the tree @xmath39 obtained by clipping off the cherry @xmath107 and labeling its former root ( now a leaf ) with the new taxon thus created in the reduction step . in other words ,",
    "the node obtained by collapsing @xmath107 in @xmath16 is assigned to the location of the common ancestor of @xmath91 and @xmath98 in the true tree @xmath1 .",
    "note that this only makes sense when @xmath91 and @xmath98 do indeed form a cherry , as this is the only case in which their common ancestor is well defined .",
    "the second part of the inductive proof is showing that given @xmath16 quartet consistent and quartet additive with a tree @xmath1 , the optimal pair for the reduction step is guaranteed to form a cherry in @xmath1 .",
    "this clearly completes the inductive argument .",
    "we proceed with the first step .",
    "quartet consistency is maintained when reducing a cherry of the reference tree .",
    "formally , given a pair of taxa @xmath108 which form a cherry in @xmath1 , the result of collapsing @xmath107 in @xmath16 is quartet consistent with the topology given by deleting the leaf edges leading to @xmath91 and @xmath98 in @xmath1 and assigning the new member of the set of taxa to the new leaf thus formed in @xmath1 .",
    "* proof * : without loss of generality , we may assume that we are collapsing taxa @xmath54 into taxon @xmath109 by using the first type of reduction step .",
    "for a set @xmath110 , we let @xmath111 be the topology induced by @xmath1 on @xmath112 .",
    "note that for @xmath113 and @xmath114 , the two topologies @xmath115 and @xmath116 are isomorphic under the map @xmath117 defined by @xmath118 for @xmath119 and @xmath120 .",
    "we furthermore notice that @xmath121 is quartet consistent with @xmath122 for @xmath123 since @xmath16 is quartet consistent with @xmath1",
    ". therefore @xmath121 will be quartet consistent with @xmath39 under identifying @xmath98 or @xmath91 with @xmath109 .",
    "we note again that this property holds _ if and only if _ @xmath107 form a cherry in @xmath1 .",
    "now note that the reduced distance metric @xmath47 on the set @xmath124 is in fact a linear combination of the two dissimilarity maps @xmath125 and @xmath126 under identifying @xmath109 with @xmath98 in @xmath127 and @xmath91 in @xmath128 ( we define the restriction of the dissimilarity map to a subset of its domain in the obvious way ) .    the last piece of the proof involves noticing that the condition of quartet consistency with respect to a topology @xmath1 is a set of linear inequalities ( defined by @xmath1 ) , on the values @xmath129 , or `` linear in @xmath16 '' for short . concretely",
    ", this means that any linear combination of dissimilarity maps that are quartet consistent with a topology @xmath1 will also be quartet consistent with @xmath1 .",
    "as noted above , both @xmath125 and @xmath126 are quartet consistent with @xmath39 , while @xmath47 is a linear combination of the two under the obvious isomorphisms ( in fact @xmath47 is the mean of @xmath125 and @xmath126 ) .",
    "we conclude that @xmath47 is quartet consistent with @xmath39 .",
    "+    quartet additivity is maintained when reducing a cherry of the reference tree .",
    "formally , given a pair of taxa @xmath108 which form a cherry in @xmath1 , the result of collapsing @xmath107 in @xmath16 is quartet additive with respect to the topology given by deleting the leaf edges leading to @xmath91 and @xmath98 in @xmath1 and assigning the new member of the set of taxa to the new leaf thus formed in @xmath1 .",
    "* proof * : we note that quartet additivity is also a property that is linear in @xmath16 .",
    "the proof proceeds identically with the previous lemma .",
    "* proof of theorem [ thm : main ] * : by the above lemmas , it suffices to prove that at any step , the pair of taxa which maximize the @xmath73-criterion form a cherry .",
    "we argue by contradiction .",
    "let us consider a pair @xmath130 such that @xmath58 is a pair of taxa which maximizes @xmath131 , but does not form a cherry in @xmath1 . throughout the proof , and in the remainder of the paper , we multiply @xmath131 by @xmath132 to simplify the formulas .",
    "_ case 1 _ : suppose @xmath3 or @xmath4 are part of a cherry . without loss of generality ,",
    "assume that leaf @xmath3 forms a cherry with leaf @xmath133 and let @xmath134 .",
    "then :    @xmath135 applying lemma [ spectator1 ] to the second summand , we have : @xmath136    since @xmath93 is a quartet in @xmath1 for any @xmath91 , by consistency @xmath137 for all @xmath91 and therefore @xmath138 , a contradiction .",
    "[ fig : case2 ]        _ case 2 _ : neither @xmath3 nor @xmath4 are part of a cherry .",
    "then , we have a situation as in figure 4 .",
    "let @xmath139 be the set of leaves on the subtree nearest @xmath3 along the path from @xmath3 to @xmath4 and , similarly , let @xmath140 be the set of leaves on the subtree nearest @xmath4 . without loss of generality , we assume that @xmath141 and let the pair @xmath142 be a cherry in @xmath1 . let @xmath143",
    ". then @xmath144 by lemma [ spectator1 ] , @xmath145    first note that if @xmath146 is a leaf that is not in @xmath139 or in @xmath140 ( i.e. , the paths from @xmath3 to @xmath91 and @xmath4 to @xmath91 intersect the path from @xmath3 to @xmath4 ) , then @xmath147 for any leaf @xmath98 by quartet consistency .",
    "thus we restrict our attention to the leaves in @xmath139 and @xmath140 .",
    "let @xmath148 . then , since @xmath141 , it follows that @xmath149 and we choose a subset of @xmath140 that is the same size as @xmath150 .",
    "in particular , there exists @xmath151 such that @xmath152 .",
    "let @xmath153 , @xmath154 and @xmath155 . then :    @xmath156   \\\\ & & +                \\frac{2}{3}[w(bi : jx ) - w(ij : bx)].\\end{aligned}\\ ] ]    since @xmath157 and @xmath158 are all quartets in @xmath1 , by consistency each term is positive .",
    "therefore @xmath159 and so @xmath160 , a contradiction .",
    "theorem [ thm : fourtoseven ] follows from the observation that quartet consistency suffices in the proof of theorem [ thm : main ] when @xmath78 .",
    "details are omitted .",
    "[ cor : main ] neighbor - joining has @xmath35 radius of at least @xmath36 .",
    "following atteson s results from @xcite for the reverse inequality , we conclude that neighbor - joining has @xmath35 radius equal @xmath36 .",
    "* proof * : it is easy to see that if @xmath28 is a tree metric and @xmath16 is a metric with @xmath161 where @xmath162 is the length of edge @xmath42 in @xmath1 , then @xmath16 is quartet consistent and quartet additive with @xmath1 .",
    "the next corollary extends the visibility lemma from @xcite .",
    "a taxon @xmath31 is _ visible _ from @xmath30 with respect to a dissimilarity map @xmath16 if @xmath163    [ cor : visibility ] if @xmath16 is quartet consistent with a tree t and @xmath164 is a cherry of @xmath1 , then @xmath31 is visible from @xmath30 with respect to @xmath16 .",
    "* proof * : this follows directly from the first step of the proof of theorem [ thm : main ] .",
    "+ the visibility lemma is the key to developing a fast neighbor joining algorithm ( fnj ) that has optimal run time complexity @xmath165 @xcite . in fact , we can conclude that    [ cor : fnj ] if @xmath16 is quartet consistent and quartet additive with respect to a tree @xmath1 then fnj will reconstruct @xmath1 from @xmath16 with run time complexity @xmath165 ( which is also the size of the algorithm input ) .",
    "in this section we prove a strengthening of the following conjecture about the edge radius of the neighbor - joining algorithm :    let @xmath1 be a phylogenetic @xmath0-tree with associated tree metric @xmath28 , and let @xmath42 be an edge of @xmath1 of length @xmath162 . if @xmath16 is a dissimilarity map whose @xmath37 distance to @xmath28 is less than @xmath166 , then neighbor - joining applied to @xmath16 will reconstruct the edge @xmath42 correctly , i.e. , the tree @xmath39 output by neighbor - joining will contain an edge @xmath44 which induces the same split in the tree @xmath39 as @xmath42 induces in @xmath1 .    since the necessary @xmath35 error bound needed for the neighbor - joining algorithm to reconstruct an edge correctly is @xmath41 of the length of the edge , we say that the edge radius of neighbor - joining is @xmath41 .",
    "this result is optimal . in @xcite",
    ", atteson presents an example where the statement fails for @xmath35 error larger than @xmath166 .    for ease of exposition , in what follows we will drop the requirement that the input trees are binary . in other words",
    ", we will allow internal nodes of degree higher than three . note that an internal node of degree at least @xmath167 corresponds to one or more internal edges of length @xmath168 in a binary tree .",
    "we also continue to allow negative leaf edges .",
    "since in this section we are only concerned with recovering splits corresponding to edges of at lest a certain length in the reference tree , edges of zero size can easily be allowed as our requirements for reconstructing them become null .",
    "also , since leaf edges are recovered correctly by design ( they correspond to trivial splits ) , negative leaf edges can easily be allowed without affecting the analysis .",
    "this is also a consequence of lemma [ lem : shifting ] .",
    "let @xmath1 be a tree and @xmath42 a non - leaf edge of length @xmath21 in @xmath1 , corresponding to the split @xmath6 of @xmath0 .",
    "we say that a dissimilarity map @xmath16 is _",
    "@xmath6-consistent _ with respect to the tree metric @xmath28 if the following conditions hold    * @xmath169 for all pairs @xmath170 and all pairs @xmath171 , * @xmath172 for all pairs @xmath173 and @xmath174 .",
    "we are ready to state the main theorem of the section    [ thm : edge_radius ] if @xmath16 is an @xmath6-consistent dissimilarity map with respect to the tree @xmath1 and the tree metric @xmath175 , then the neighbor - joining algorithm applied to @xmath16 will output a tree @xmath39 which contains @xmath6 among its edge - induced splits .",
    "this implies more than atteson s conjecture since we are not imposing a lower bound on the estimated distances between taxa situated on the same side of the split .",
    "this observation is crucial ; we show in theorem 34 that atteson s condition as originally stated in @xcite does not hold inductively .",
    "as we will see , lemma 7 in @xcite fails if one is only trying to recover a specific edge in the tree , because non - neighboring pairs may be collapsed during the agglomeration steps .",
    "the proof of theorem 25 is based on two propositions . in proposition 26 , we show that agglomerating a pair of elements in @xmath9 or a pair of elements in @xmath10 preserves @xmath6-consistency",
    ". it therefore suffices to show that at every step of the algorithm , the @xmath73-criterion is maximized for a pair that lies either in @xmath9 or in @xmath10 .",
    "this is shown in proposition 27 by an averaging argument .",
    "we will assume , by way of contradiction , that there is a pair of leaves @xmath58 with @xmath176 , @xmath177 and @xmath178 maximal . to obtain a contradiction , we will assume without loss of generality that @xmath179 and show that , on average , @xmath180 where the average is taken over all pairs @xmath181 .",
    "consequently , there must be at least one pair of elements @xmath182 such that @xmath183 .",
    "[ collapse ] given an @xmath6-consistent dissimilarity map @xmath16 , with respect to a tree @xmath1 , collapsing a pair of taxa @xmath184 will result in a metric @xmath47 which is @xmath185-consistent with respect to a tree @xmath39 . here",
    "@xmath186 is the set of taxa obtained by replacing @xmath54 by the collapsed node @xmath109 in @xmath9 .",
    "* proof * : as before , we assume without loss of generality that we are using the first variant of the reduction step . now shift the new dissimilarity map @xmath47 by @xmath187 around the new taxon @xmath109 .",
    "again , this can be done without affecting the outcome of the algorithm . in effect , this is equivalent to defining the distances with respect to @xmath109 in the following manner : @xmath188    now let @xmath42 be the edge in @xmath1 corresponding to the @xmath6 split .",
    "let @xmath21 be its length .",
    "let @xmath189 be the path in @xmath1 that joins @xmath91 and @xmath98 .",
    "then @xmath190 and let @xmath191 be the internal point of @xmath1 where a path from @xmath42 reaches @xmath189 . consider the new tree @xmath39 where the taxa @xmath91 and @xmath98 are removed and the new taxon @xmath109 is placed exactly at the internal point @xmath191 . @xmath192 and @xmath186 are defined in the obvious way and @xmath47 is defined by collapsing @xmath54 in @xmath16 according to the reduction described above .",
    "let @xmath193 be the subtrees of @xmath1 hanging off the path @xmath189 and let @xmath194 be the one that contains @xmath42 .",
    "we now observe that @xmath195 and @xmath196 for @xmath197 . in this case",
    "the errors remain the same . for @xmath198 , and",
    "therefore @xmath199 , we observe that @xmath200 therefore @xmath201    now for all @xmath3 let @xmath202 be the point of the path @xmath189 that is the root of the subtree @xmath203 .",
    "then for any @xmath204 , so @xmath205 for @xmath206 or @xmath207 ,    @xmath208/2=\\ ] ] @xmath209/2-\\delta_{t}(o , o_{i})<\\ ] ] @xmath210    therefore @xmath47 is @xmath185-consistent with respect to @xmath39 and @xmath39 `` contains '' the edge @xmath42 .",
    "now assume that the pair @xmath58 which maximizes @xmath178 is such that @xmath211 . without loss of generality , we assume that @xmath179 .",
    "@xmath212 that is , there exist @xmath213 such that @xmath214 .",
    "we prove the proposition by comparing the differences between the dissimilarity values and the true tree metric @xmath28 , with counts of the contested edge in the averaging step .",
    "the calculation is elementary but tedious , and requires a few lemmas and some notation :    let @xmath215 be the set of all dissimilarity maps @xmath62 on a set @xmath0 .",
    "we represent a linear function @xmath216 by @xmath217 similarly , if @xmath218 is the set of all tree metrics on a set @xmath0 , we represent a linear function @xmath219 by @xmath220 more explicitly , @xmath221 is the coefficient of @xmath162 in @xmath222 , when the metric @xmath28 corresponds to the edge lengths @xmath21 .",
    "if @xmath1 is obvious from the context , we will write @xmath223 as @xmath224 .    for a tree @xmath1 , note that an edge @xmath42 divides the leaves into two sets .",
    "for a given tree leaf @xmath3 , we define @xmath225 as the set of leaves on the same side of @xmath42 as @xmath3 and @xmath226 as the set of leaves on the far side of @xmath42 from @xmath3 . by a slight abuse of notation",
    ", we will also use @xmath225 and @xmath226 to denote the number of elements in their respective sets when such use does not give rise to confusion .",
    "[ beta ] let @xmath26 be leaves in a tree @xmath1",
    ". then    @xmath227    * proof * : for a tree metric @xmath28 , @xmath228 is twice the length of the splitting path if @xmath229 is a quartet of @xmath1 and negative the length of the path otherwise .",
    "hence , if an edge @xmath42 is on the path from @xmath30 to @xmath31 , then there is no quartet @xmath229 such that @xmath42 is on the splitting path .",
    "hence , the edge @xmath42 is only counted negatively , once for every element @xmath230 and @xmath231 .",
    "there are exactly @xmath232 such pairs @xmath107 .",
    "if @xmath42 is not on the path from @xmath30 to @xmath31 , then for any pair of elements @xmath233 , @xmath229 are exactly the quartets of @xmath1 of the form @xmath234 with @xmath42 is on the splitting path .",
    "consequently , @xmath235 .",
    "[ lowerbound ] let an edge @xmath42 define a split @xmath6 and assume @xmath179 . then @xmath236    * proof * : this is equivalent to showing that @xmath237 and for any other edge @xmath238 , @xmath239 .",
    "note that since @xmath42 is never on the path between @xmath240 and @xmath241 for any pair @xmath242 , @xmath243 is the same for any choice of @xmath244 . also , @xmath42 is on the path between @xmath3 and @xmath4 , so by application of lemma [ beta ] : @xmath245 \\\\                         & = & { |a| \\choose 2}[|b|(|b| - 1 ) + ( |a| - 1)(|b|    - 1 ) ] \\\\                         & = & { |a| \\choose 2}(|b| - 1)(n - 1 ) .",
    "\\\\\\end{aligned}\\ ] ]    let @xmath246 be either vertex of the edge @xmath42 .",
    "assume we have an edge @xmath247 such that @xmath44 is in the subtree spanned by @xmath10 , denoted @xmath248 $ ] .",
    "then @xmath44 is never on the path between @xmath240 and @xmath241 , so @xmath249 for any pair @xmath242 .",
    "if @xmath44 is on the path between @xmath3 and @xmath4 , then @xmath250 , so clearly @xmath251 . if @xmath44 is not on the path between @xmath3 and @xmath4 , then @xmath252 and @xmath253 .",
    "the proof of the final case that needs to be considered , namely @xmath254 $ ] consists of a trivial , yet slightly lengthy , counting argument .",
    "we only present a brief sketch .",
    "again , in the case when @xmath44 is on the path between @xmath3 and @xmath4 , then @xmath250 , so clearly @xmath251 . for @xmath44 not on the path from @xmath3 to @xmath4 , let @xmath255 .",
    "let @xmath256 . then",
    "a simple counting argument shows that @xmath257 , whereas for @xmath258 we have @xmath259 .",
    "since @xmath260 , this concludes the proof .",
    "[ alpha ] let @xmath26 be elements of the leaf set @xmath0 of size @xmath261 . then",
    ": @xmath262",
    "* proof * : the term @xmath263 occurs in all @xmath264 @xmath265 terms in @xmath266 , each time with a coefficient of @xmath267 . to compute @xmath268",
    ", we note that @xmath269 occurs in all @xmath270 terms of the form @xmath271 with a coefficient of @xmath36 .",
    "the same holds for @xmath272 .",
    "lastly , @xmath273 for @xmath274 occurs only in one term , @xmath265 , with coefficient @xmath267 .    [ 8cases ] let @xmath275 and @xmath276 .",
    "we have    1 .",
    "@xmath277 + 2 .",
    "@xmath278 + 3 .   @xmath279 + 4 .",
    "@xmath280 + 5 .",
    "@xmath281 + 6 .",
    "@xmath282 + 7 .   @xmath283 + 8 .",
    "@xmath284 +    there are @xmath285 and @xmath286 of each of these terms , respectively .",
    "* proof * : let @xmath287 note that @xmath288 we provide the proof for the first case , where @xmath182 ( the other cases are similar ) .",
    "let @xmath289 , then : @xmath290 + { |a'| \\choose 2}(-1 ) \\\\",
    "& = & \\frac{1}{2}(n-|a|)\\left[|a|-n+1\\right ] \\quad =    \\quad -{|b| \\choose 2}.\\end{aligned}\\ ] ] identities ( 1)(8 ) now follow after some elementary algebra and lemma [ alpha ] .",
    "@xmath291    * proof * : let @xmath16 be an @xmath6-consistent metric and set @xmath292 . note that for all @xmath293 , @xmath294 for all cases where @xmath295 or @xmath296 , together with the signs of the terms in the lemma [ 8cases ] and the definition of @xmath6-consistency .",
    "it follows that @xmath297 and the lemma follows by summing the terms appearing in lemma [ 8cases ] .    * proof of proposition 27 and theorem 25 * : by lemma 29 and 32 it suffices to show that @xmath298 this inequality follows from the fact that we chose @xmath179 and consequently @xmath299 .",
    "thus , the pair of leaves that maximize @xmath300 are both in @xmath9 .",
    "the theorem now follows from proposition 26 .",
    "we conclude by stating that our analysis holds trivially for the fast neighbor - joining algorithm of @xcite .",
    "this follows from the observation that for an @xmath6-consistent dissimilarity map @xmath16 , no pair @xmath54 with @xmath173 and @xmath174 can maximize the @xmath301 criterion , and therefore the maximizing pair , which has to be visible from both of its members , has both taxa on the same side of the partition @xmath6 .",
    "[ cor : edge_fnj ] if @xmath16 is an @xmath6-consistent dissimilarity map with respect to a tree @xmath1 , then fnj applied to @xmath16 will reconstruct a tree @xmath39 which contains @xmath6 among its set of edge - induced splits .",
    "we conclude with a final comment on @xmath6-consistency and our proof of theorem 25 .",
    "[ thm : chinese_counter ] let @xmath28 be a tree metric and @xmath16 a dissimilarity map whose @xmath37 distance to @xmath28 is less than @xmath302 where @xmath303 is the length of some edge in @xmath1",
    ". then it may be that an intermediate tree produced during the agglomeration steps of the neighbor - joining algorithm has @xmath35 distance greater than @xmath302 to any tree metric .    * proof * : consider the phylogenetic tree @xmath1 in figure [ fig : chinese ] , with leaf set @xmath304 where @xmath305 .",
    "suppose that the leaf edges corresponding to @xmath306 all have length @xmath307 .",
    "the lengths of the other visible edges , i.e. the ones not belonging to @xmath308 are as in figure [ fig : chinese ] . also suppose that the edges on the subtree @xmath308 have total length @xmath309 , where we will let @xmath40 become arbitrarily small .",
    "[ fig : chinese ]        consider the following dissimilarity map @xmath16 with @xmath310 :    1 .",
    "@xmath311 2 .",
    "@xmath312 for @xmath313 3 .",
    "@xmath314 for @xmath315 4 .",
    "@xmath316 for @xmath317 5 .",
    "@xmath318 for @xmath319 6 .",
    "@xmath320 for @xmath319 7 .",
    "@xmath321 for @xmath319 8 .",
    "@xmath322 for @xmath323    minimizing the neighbor - joining @xmath34 criterion is equivalent to maximizing @xmath324 where @xmath325 .",
    "first we show that for large enough @xmath261 , small enough @xmath40 and with @xmath326 , the pair that maximizes @xmath327 is @xmath58 .",
    "note that for @xmath108 , @xmath328 , which converges to a constant as @xmath329 .",
    "however , as @xmath330 , @xmath331 . therefore for small enough @xmath40 and large enough @xmath261 , @xmath58 will dominate any pair @xmath332 . since @xmath326 and @xmath333 ,",
    "using a similar argument as above we can also conclude that the optimum pair must consist of two leaves from @xmath334 .",
    "finally , we need to show that @xmath335 where either @xmath336 or @xmath21 is equal to @xmath30 or @xmath31 .",
    "note that for any @xmath337 , @xmath338 the first and second summands are constants in @xmath261 , while the third is composed of @xmath261 sub - terms which are roughly equal , up to small variations of size at most @xmath339 , depending on the location of @xmath246 in @xmath308 .",
    "since we can choose @xmath40 arbitrarily small , we can therefore ignore this error .",
    "now place a fictitious node @xmath340 at the root of @xmath308 ( the right hand side of the edge of length @xmath303).then letting @xmath341 , we see that asymptotically , @xmath342 here we extend the definition of @xmath16 to @xmath340 by extending @xmath28 to @xmath340 in the natural way and defining the error @xmath343 for pairs involving @xmath340 in the same way as for other leaves in @xmath0 .",
    "it is now easy to verify that    1 .",
    "@xmath344 , 2 .",
    "@xmath345 , 3 .",
    "@xmath346 , 4 .",
    "@xmath347 .",
    "therefore asymptotically , @xmath58 will be collapsed in the first step of neighbor - joining applied to @xmath16 .",
    "now consider the reduced distance matrix @xmath348 , where the leaves @xmath3 and @xmath4 are replaced by a new leaf @xmath349 .",
    "that is , @xmath350 .",
    "we restrict our attention to the set @xmath351 for an arbitrary leaf of @xmath91 of @xmath0 .",
    "since the total length of @xmath308 is @xmath339 , we can in fact approximate expressions involving @xmath352 by @xmath353 up to @xmath339 error .",
    "we do so for the sake of simplicity .",
    "simple calculations now give @xmath354 @xmath355 @xmath356 @xmath357 and thus : @xmath358    now suppose that there is some additive tree metric @xmath359 such that @xmath360 . then by adding this to the above equality we obtain that @xmath361 and similarly @xmath362 this contradicts the four point condition necessary for @xmath359 to be a tree metric .",
    "therefore , we have given an example of a dissimilarity map @xmath16 and a tree metric @xmath28 with an edge of length @xmath303 , such that @xmath363 , and yet the @xmath37 distance of the reduced dissimilarity map after the first agglomeration step from _ any _ tree metric is greater than @xmath302 .",
    "the significance of theorem 34 is that it shows that an inductive proof of atteson s conjecture is not possible without relaxing the hypothesis .",
    "thus , the partial result of @xcite and the proof of @xcite are incorrect . at the same time , theorem [ thm : chinese_counter ] also identifies an undesirable property of neighbor - joining which is very common among greedy optimization algorithms .",
    "we hope that further investigations in this direction can yield more robust versions of the algorithm .",
    "we performed a series of simulations to test how frequently theorem 16 explains the success of the neighbor - joining algorithm .",
    "trees with 20 taxa were generated by agglomerating pairs at random .",
    "we generated 35 such trees and set their edge lengths to 0.1 .",
    "we then used ` seq - gen ` @xcite to build 100 alignments with the jukes cantor model for each of 28 sequence lengths between 100 and 10,000 base pairs . from these we obtained dissimilarity maps using the ` dnadist ` program from the phylip package @xcite .",
    "our java api then computed the @xmath364-matrix for each dissimilarity map , tested the consistency and additivity conditions against the true tree , checked to see if the dissimilarity map satisfied atteson s criterion ( theorem 2 ) , and computed the neighbor - joining tree .",
    "the results are summarized in figure [ fig : graph ] .",
    "we note that our conditions of additivity and consistency are satisfied for sequence lengths an order of magnitude smaller than required for atteson s criterion to hold .",
    "moreover , even when the additivity and consistency conditions are not satisfied for every quartet , they do hold true for upwards of 99% and 94% of quartets respectively , even at sequence length 100 ( figure 7 ) . hence , applying an averaging argument similar to the one we employed in the proof of atteson edge radius conjecture , we may obtain `` on average '' conditions that explain even more of the cases where neighbor - joining succeeds .",
    "[ fig : graph ]        [ fig : graph2 ]",
    "radu mihaescu was supported by a national science foundation graduate fellowship , and partially by the fannie and john hertz foundation .",
    "lior pachter was partially supported by nih grant r01hg2362 and nsf grant ccf0347992 .",
    "dan levy was supported by nih grant gm68423 .                        o  gascuel , _ a note on sattath and tversky s , saitou and nei s , and studier and keppler s algorithms for inferring phylogenies from evolutionary distances _ , molecular biology and evolution * 11 * ( 1994 ) , no .  6 , 961963",
    ".                    gj  olsen , h  matsuda , r  hagstrom , and r  overbeek , _ fastdnaml : a tool for construction of phylogenetic trees of dna sequences using maximum likelihood _",
    ", computational applied biosciences * 10 * ( 1994 ) , 4148 ."
  ],
  "abstract_text": [
    "<S> we show that the neighbor - joining algorithm is a robust quartet method for constructing trees from distances . </S>",
    "<S> this leads to a new performance guarantee that contains atteson s optimal radius bound as a special case and explains many cases where neighbor - joining is successful even when atteson s criterion is not satisfied . </S>",
    "<S> we also provide a proof for atteson s conjecture on the optimal edge radius of the neighbor - joining algorithm . </S>",
    "<S> the strong performance guarantees we provide also hold for the quadratic time fast neighbor - joining algorithm , thus providing a theoretical basis for inferring very large phylogenies with neighbor - joining . </S>"
  ]
}