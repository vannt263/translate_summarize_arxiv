{
  "article_text": [
    "this paper presents design , implementation , and preliminary performance results of a new data acquisition system ( daq ) , based on the field programmable gate array ( fpga ) technology , for the compass experiment .",
    "compass  @xcite is a fixed target experiment at cern with a usual data rate of approximately 2000mb / s during 10  second on - spill with 45  second off - spill .",
    "its present daq system was built during years 1999 - 2001 and now is ready for modernization with the fpga technology . since the fpga technology started to be cost - effective and developed enough in recent years",
    ", the usage for event building purposes is now solvable at reasonable cost , and thus the new fpga based daq can be designed , analysed , implemented , and deployed .",
    "the data acquisition and test environment(date )  @xcite software package and usage of fpga - based cards has been widely studied .",
    "thanks to these studies , development of the new daq did not start from zero , but more likely took advantage of work already done in the field of daq software development . the development aim is to bring daq design closer to state of the art software and hardware designs , and thus improve performance and reliability .",
    "improved reliability of the system should be achieved thanks to the movement of event building to hardware and more extensive usage of the oop .    in the last few years",
    "a growing number of tools , which use distributed information management system ( dim ) , were made for the compass experiment , and as consequence usage of dim package for communication was recommended .",
    "state machines used in the present daq were analyzed and reworked for use as a basis for main processes of the new daq .",
    "in order to develop a new daq , we started by studying the present one , which is based on the date software package originally developed for the alice experiment at cern .",
    "it is written in the c programming language and it uses the dim library for communication .",
    "the dim is a multi - platform library that serves for an asynchronous 1  to  many communication through the ethernet .",
    "extensive state machines implemented in state management interface ( smi++ ) are part of this system . both dim and smi++",
    "were originally developed for the dephi experiment at cern .",
    "state machines in the present daq were taken as a basis for the new daq state machines but were significantly reworked to take into account the new daq architecture and implemented in the c++ programming language .    the qt framework is a cross - platform application framework which is used both for the development of graphical user interfaces ( gui ) and for non - gui programs .",
    "development of the qt toolkit by the trolltech company started in 1999 .",
    "now it is developed by digia .",
    "the qt framework is distributed under gnu lgpl , gnu gpl , and commercial developer license copyright licenses .",
    "the qt framework was chosen originally as a tool to easily make gui , but its role in design changed soon after start of the development .",
    "now it is used in all parts of the new daq designs .",
    "it is very useful thanks to its extensive support for multi - threading , databases ( sql ) , xml processing , file access , work with multimedia , and possibility to easily deploy developed software on a wide range of platforms such as : windows , symbian , mac os x , x11 , embedded linux etc .",
    "the standard qt sdk includes also development environment called qt creator .",
    "the qt creator consists of code editor , distributed revision control , and performance testing tools like the valgrind and the cachegrind .",
    "subversion was used for version control .",
    "the fpga technology is key part of the new daq design .",
    "fpga chips are special integrated circuits whose behavior can be changed in the field by uploading a new firmware .",
    "usability of this technology has grown in the past few years , because chip density increased and the cost per programmable block dropped .",
    "this technology provides very good flexibility , which is very important in usage for physical experiments .",
    "the ipbus package is used for communication with fpgas .",
    "it was developed for the level one trigger update of the cms experiment .",
    "this package consists of firmware part and software part .",
    "the firmware part mediates access to registers and memory of a fpga card through ethernet when properly loaded .",
    "the software part is implemented in c++ and contains all classes needed for a connection to the interface of the firmware  part .",
    "for good understanding of the changes in the new daq , it is necessary to start with a description of the present daq .",
    "its basic structure is shown in figure  [ obr - old ] .",
    "it consists of three main parts : the data taking part , the event building part , and the control part .",
    "the data taking part incorporates detectors , frontend electronics , and data preprocessing .",
    "the event building part incorporates thirty readout buffer computers ( robs ) and twenty computers for the event building ( eb ) all interconnected through the ethernet switch .",
    "the control part is then built mainly from ordinary pcs with the scientific linux cern , the date package , and several monitoring utilities ( coool , murphytv , etc . ) .",
    "an idea of the new daq is based on the reworked event building part as shown in figure  [ obr - arch ] .",
    "the data taking part is the same as in the present daq .",
    "the event building part , on the other hand , is changed to incorporate new fpga cards shown in figure  [ obr - fpga ] .",
    "these cards will be used with two different roles in two layers .",
    "the first layer of fpgas has the role of multiplexers .",
    "the second layer consists of only one card , which fulfills the event building role .",
    "it prepares full events in a special format .",
    "events are then sent to readout computers , where they are readout , transformed to the date format , and stored temporarily on local disks , before transfer to the cern advanced storage manager ( castor ) .",
    "the reworked design of the event building part allowed using a smaller control system .",
    "additionally , the system can also utilize more computing power for monitoring thanks to movement of the event building to fpgas .",
    "the last but not the least important change is usage of a new design of state machines , which introducing second run state with tolerance to errors .",
    "the software part of the new daq consists of master , slave - control , slave - readout , runcontrol gui , messageloger , and messagebrowser .",
    "the master process acts as the middleman between a user interface and slave processes .",
    "all communication is done through the dim .",
    "the master process keeps track of states of all slave processes .",
    "the expected message rate per slave is 10 - 100hz .",
    "furthermore , the master process has incorporated the main part of error handling and a connection to a configuration database .",
    "if the slave process needs any information from the database , it must send a request to the master process .",
    "all software parts and connections between them are shown in figure  [ obr - com ] .",
    "the slave - control process fulfills a role of the supervisor for fpga cards .",
    "it uses the ipbus technology to gain access to registers and memory of the fpga card .",
    "its task is to configure the fpga , keep track of fpga s resources , and inform the master process about the state of the connected fpgas .",
    "it can run on any computer connected to same network as the fpga card , which it should control , and to the network with a computer on which the master process runs .",
    "it is expected that it will run on one of the readout computers and that for interconnection of readout computers and fpga cards a dedicated network will be used .",
    "the slave - readout process is the largest and the most resource demanding process in the  new  daq .",
    "it is a multithread process that serves for control of readout activities .",
    "the main threads are : informer , readout , fifo , processor .",
    "the informer thread uses a set of dim services and commands for communication with the master process .",
    "it sends information about a state of the whole slave - readout process and processes commands .",
    "the readout thread is responsible for readout of connected devices and preparation of readout data .",
    "all data sources are derived from a common abstract class ; thus it is easy to add a new type of device to the system .",
    "this construction significantly increases flexibility of the system .",
    "an slink spillbuffer card is used as the only data source in the present prototype .",
    "the spillbuffer card is an fpga based pci - express card that serves for buffering of a data stream from data producers before loading them to a computer memory .",
    "the readout thread is also responsible for arming and disarming data sources .",
    "checks of data consistency are also made during readout .",
    "the fifo thread is responsible for storing events in the date format , before they are processed .",
    "transfers of events from the readout thread to the fifo thread and from the fifo thread to the processor thread are made through signal - slot connections , and they are done by blocks of about 1000 events .",
    "these block transfers allow reduction of the computer resource cost of data exchanges between different threads .",
    "the main purpose processor thread s is to store date on local disks , additionally it also distributes events based on the set filter to other outputs .",
    "four basic outputs are defined in the  new  daq prototype : fileoutput , screenoutput , monitoringoutput , and terminatoroutput .",
    "all these outputs have their own threads , but only the fileoutput can pause processing when it can not process data fast enough .",
    "the terminatoroutput s role is taking care of disposing events after all other outputs are done with them .",
    "the screenoutput and the monitoringoutput serve for monitoring purposes .",
    "the gui process as the only one visible to standard users is the most complicated one from the design point of view .",
    "its structure is designed and developed with great emphasis on ergonomics and flexibility .",
    "it provides different sets of information for a normal user and an expert user .",
    "it is prepared as fully customizable .",
    "it can run in two modes : runcontrol and monitoring .",
    "only one runcontrol gui is allowed in the system for a better control of the system behavior .",
    "the number of running monitoring guis is not limited .",
    "the messagebrowser and the messagelogger support programs  @xcite are the last part of the  new  daq software design .",
    "the messagelogger s task is to receive all messages from all parts of the system and store them in the database .",
    "messagebrowser is a visualization tool for browsing through these messages .",
    "it has extensive filtering capabilities that allow to find quickly the desired messages .",
    "several tests were made to prove viability of the designed solution . at first the dim communication speed was tested .",
    "the graph in figure  [ obr - ms ] demonstrates that with sizes bigger than 2 kb , processes communicating through the dim can almost fully saturate a network bandwidth .",
    "the maximum frequency reached during tests exceeded 200khz , which is much more than needed .",
    "the second set of tests was aimed on testing new readout functions .",
    "tests were carried out on one server with quadcore 3ghz cpu , 4 gb ram , 1 tb hdd , scientific linux cern  5  os 32-bit and two spillbuffer cards .",
    "the graph in figure  [ obr - rs ] shows maximum speeds reached with maximum settable event sizes at given trigger rates .",
    "the red vertical line in the graph shows the expected size of events in the next run of the compass experiment .",
    "we found that the maximum throughput of used slinks is the only limiting factor of the  new  daq prototype in this event sizes region .",
    "demands and restrictions on the data acquisition system were extracted from the initial studies of the present data acquisition software of the compass experiment at cern .",
    "the  new  daq design was based on these demands and restrictions .",
    "prototype versions of all processes were implemented in c++ using of the qt library .",
    "the performed tests proved the viability of the designed solution .",
    "thanks to given results the system was approved for deployment in 2014 .",
    "the work on this project has been supported in part by the following grants : msmt la08015 and sgs 11/167 .",
    "it is being also supported by the maier - leibnitz - labor , garching and the dfg cluster of excellence `` origin and structure of the universe '' .",
    "10    m. bodlak , et al .",
    "_ developing control and monitoring software for the data acquisition system of the compass experiment at cern_. acta polytechnica : scientific journal of the czech technical university in prague .",
    "prague , ctu , 2013 , issue 4 .",
    "available at : http://ctn.cvut.cz/ap/    m. bodlak , et al .",
    "_ new data acquisition system for the compass experiment_. journal of instrumentation .",
    "2013 - 02 - 01 , vol . 8 , issue 02 , c02009-c02009 .",
    "doi : 10.1088/1748 - 0221/8/02/c02009 .",
    "available at : http://stacks.iop.org/1748-0221/8/i=02/a=c02009?key=crossref.a76044facdf29d0fb21f9eefe3305aa5"
  ],
  "abstract_text": [
    "<S> this paper discusses the present data acquisition system ( daq ) of the compass experiment at cern and presents development of a new daq . </S>",
    "<S> the new daq must preserve present data format and be able to communicate with fpga cards . </S>",
    "<S> parts of the new daq are based on state machines and they are implemented in c++ with usage of the qt framework , the dim library , and the ipbus technology . </S>",
    "<S> prototype of the system is prepared and communication through dim between parts was tested . </S>",
    "<S> an implementation of the ipbus technology was prepared and tested . </S>",
    "<S> the new daq proved to be able to fulfill requirements . </S>"
  ]
}