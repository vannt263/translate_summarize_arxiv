{
  "article_text": [
    "gravitational lensing reveals the mass distribution of the universe by detecting deflections of photons in the gravitational potential generated by the mass . along most lines of sight",
    ", we can best measure the _ gradient _ of the deflection , characterized by an apparent shear and magnification of background sources .",
    "the lensing shear is detectable as a coherent alignment induced on nominally randomly - oriented resolved background galaxies .",
    "reliable measurement of this shear opens the door to a wealth of astrophysical and cosmological information , including the most direct measures of the dark components of the universe .",
    "see @xcite and @xcite for recent reviews of the power of this weak gravitational lensing technique .",
    "the full power of the weak lensing technique can only be realized , however , if we are able to infer the shear from real image data without significant systematic error .",
    "this apparently straightforward measurement is complicated by several factors :    * the shear is weak , amounting to @xmath2 change in a galaxy s axis ratio on a typical cosmological line of sight . in a full - sky experiment , it is possible to measure shear with statistical errors below 1 part in @xmath1 of this 2% systematic errors must be extremely small else they will dominate the error budget . * the galaxy is viewed through an instrument ( possibly including the atmosphere ) which convolves the lensed appearance with a point spread function ( psf ) that typically induces larger coherent shape changes than the gravitational lensing , and can vary with time and with position on the sky .",
    "this instrumental effect must be known and removed . *",
    "the received image of the galaxy is pixelized , meaning it has finite sampling .",
    "even if the sampling meets the nyquist criterion so that the image is unambiguous , our shear extraction algorithm must handle the sampling and any other signatures of the detector . *",
    "the unlensed appearance of any individual galaxy is unknown , and galaxies have an infinite variety of intrinsic shapes .",
    "no finite parameterization can fully describe the unlensed galaxies . *",
    "the received image includes photon shot noise and additional noise from the detector .",
    "the shear inference must maintain exceptionally low bias even when targeting galaxies with signal - to - noise ratio @xmath315 if we are to extract the bulk of the shear information available from typical optical sky images .",
    "@xcite , @xcite , @xcite , and @xcite document a series of challenges in which the community was invited to infer the shear from simulated sky images , as a means of assessing our abilities to measure shear in the face of the above difficulties .",
    "these publications also summarize the impressive variety of techniques that have been proposed for shear inference .",
    "a useful parameterization for errors in shear inference is ( using a simplified scalar notation ) that the measured shear @xmath4 is related to the true shear via @xmath5 @xcite calculate that ambitious weak - shear surveys must obtain multiplicative errors @xmath6 to retain their full statistical power .",
    "the additive bias @xmath7 , which can arise when the psf or other element of the analysis chain is not symmetric under 90rotation , must be kept below @xmath8 , which is 100300@xmath9 smaller than the typical psf ellipticity .",
    "the literature contains no demonstrations of robust shear algorithms yielding @xmath10 at @xmath11 .",
    "@xcite demonstrates the ability to attain @xmath6 at high @xmath12 , overcoming all but the last of the problems itemized above .",
    "this `` fdnt '' method has a rigorous formulation for noiseless data .",
    "it has , however , proven more difficult to derive a shear inference that is rigorously correct in the presence of noise . @xcite",
    "derive the lowest - order noise - induced bias in galaxy - shape estimates that are produced via maximum - likelihood fitting to parametric galaxy models .",
    "but it is not clear that this correction yields the necessary accuracy on real data .",
    "the most common approach to biases induced by noise ( or other systematic errors ) has been to use simulated sky data to infer @xmath13 and then apply a correction to the real - sky result .",
    "the accuracy of this approach is of course limited by the extent to which the simulated data reproduces the salient characteristics of the real sky .",
    "@xcite propose a somewhat more general scheme of calibrating shape - measurement biases vs a few parameters of the galaxy and measurement , _",
    "e.g. _ the @xmath12 level , resolution , sersic index , etc . , and then applying bias corrections on a galaxy - by - galaxy basis . but @xcite note that this galaxy - by - galaxy bias correction is inaccurate at low @xmath12 , and it is better to determine a single overall correction to the shear using prior high-@xmath12 information on a random subsample of the source population .",
    "all these avenues lead us back to the situation of requiring prior empirical high-@xmath12 information on the underlying source galaxy population in order to produce the noise - bias corrections .",
    "once we need an empirical prior on galaxy information , we should look to bayesian techniques to produce a rigorously correct shear estimator .",
    "the lensfit  method of ( * ? ? ?",
    "* lensfit ) produces a bayesian posterior distribution @xmath14 for the ellipticity of galaxy @xmath15 given its pixel data @xmath16 , assuming that galaxies take a known functional form and given a prior distribution of  and the other parameters of the presumed galaxy model .",
    "but in lensfit  the inference of applied _ shear _  from an ensemble of these posterior densities for galaxy _ shapes _ is done using some _ ad hoc _ weighting and averaging schemes .",
    "testing of the lensfit  codes on simulated data in @xcite yields @xmath17 at @xmath18 , necessitating an empirical multiplicative correction to shears derived from real data .    in this paper we will derive a rigorous bayesian treatment of the inference of weak _ shear _ , not just galaxy shapes , from pixel data .",
    "the general approach is outlined in section 2 .",
    "then we examine three ways to apply this approach to real data : section  [ method1 ] examines bayesian model - fitting ( bmf ) approaches and extends the lensfit  bayesian method to shear estimation .",
    "section  [ method2 ] then shows how to apply bayesian techniques without assuming a parametric model for unlensed galaxies , yielding an adaptation of the venerable ( * ? ? ?",
    "* ksb ) weighted - moment method that treats convolution , sampling , and noise rigorously .",
    "we consider this bayesian fourier - domain ( bfd ) method to be our most promising algorithm for high - accuracy shear inference . in section  [ nulltests ] we explore whether the fdnt method that is successful at high @xmath12 can be embedded in a bayesian framework for accuracy at finite @xmath12 . in sections",
    "[ compare ] and [ conclude ] we compare to some extant shear - measurement algorithms and conclude .",
    "we begin by assuming that we wish to infer the posterior distribution of a constant shear  from an image containing data  that can be subdivided into statistically independent subsets @xmath16 , each covering a single galaxy @xmath19 . for a prior probability @xmath20 of the shear ,",
    "the standard bayesian formulation for the posterior is @xmath21 our fundamental assumption is that the posterior @xmath22 will be well approximated by a quadratic taylor expansion in , _",
    "i.e.  _  the posterior will be gaussian in .",
    "this assumption will fail when the number of galaxies is small and the shear is poorly constrained , but should become valid when we combine information from a large number of galaxies on a weak shear . in appendix  [ cubic ] we give a prescription for including 3rd - order terms in  as perturbations , since terms @xmath23 are necessary if the estimate of  is to be accurate to @xmath0 part in @xmath24 for @xmath25 .",
    "the bayesian formulation ( [ bayes1 ] ) produces an exact posterior distribution of the shear .",
    "the full posterior distribution could be propagated into cosmological inferences , but most current analyses require instead an estimator @xmath26 for the shear ( and an uncertainty ) . by adopting a quadratic taylor expansion for @xmath27",
    "we implicitly assume that the maximum of the posterior distribution is coincident with the mean of the posterior , so it would be natural to adopt the location @xmath28 of this posterior peak as a shear estimator .",
    "below we will consider whether this estimate is biased .    for quadratic order , we need the 6 scalars that make up the scalar @xmath29 , vector @xmath30 , and symmetric @xmath31 matrix @xmath32 defined as : @xmath33 the dependence of the posterior on  can now be expressed as @xmath34 \\cdot { \\mbox{\\boldmath $ g$}}.\\ ] ] if we presume that the data are much more informative than the prior on @xmath35 , we may drop the @xmath36 and find that the posterior for the shear is gaussian with covariance matrix @xmath37 and mean @xmath28 defined via @xmath38 note that we have _ not _ made any assumption about the gaussianity of the likelihood @xmath39 for each galaxy , nor about any priors , etc . ; only about the posterior of the applied shear .      before describing methods of calculating @xmath40 and its derivatives ,",
    "we discuss generalization of ( [ pg ] ) to non - constant shear fields .",
    "once the quantities @xmath41 and @xmath32 are calculated for each galaxy , the posterior for any shear model can be calculated as long as the model predicts shears in the regime where ( [ pquad ] ) holds .",
    "consider a model with parameter vector  which predicts shear values @xmath42 at each galaxy .",
    "we can slightly modify our formulation and proceed as before to derive the posterior @xmath43 @xmath44 \\cdot   { \\mbox{\\boldmath $ g$}}_i({\\mbox{\\boldmath $ a$}}),\\ ] ] if @xmath35 is a linear function of @xmath45 ( and if the prior is approximated as quadratic ) , then the solution for the maximum - posterior @xmath45 is a closed - form matrix equation .",
    "one potentially interesting application is a fourier decomposition @xmath46 . if the source galaxies are uniformly distributed on the plane and we can make the approximation that @xmath47 then dependence of the posterior on the fourier coefficients becomes @xmath48 \\notag\\\\    & + \\frac{1}{4}\\sum_\\mu { \\mbox{\\boldmath $ a$}}_\\mu \\cdot { { \\mbox{$\\bf c$}}}^{-1}_g \\cdot { \\mbox{\\boldmath $ a$}}_\\mu^\\star , \\end{aligned}\\ ] ] with @xmath49 as from ( [ cg ] ) .",
    "this posterior separates into a gaussian over each 2-component @xmath50 with identical covariance @xmath51 on each of the real and imaginary parts of each fourier coefficient and a simple @xmath52 matrix solution for the most probable @xmath50 .",
    "a similarly simple posterior could be derived for any decomposition of the shear field into orthogonal functions .",
    "bayesian estimation of @xmath53-point correlations of a shear field should also be similarly straightforward , at least in the limit where galaxy shape noise and measurement noise are dominant over the sample variance of the shear field .",
    "we leave this derivation for future work .",
    "is the mean @xmath54 from an unbiased estimator of the true shear ?",
    "the bayes formalism does not guarantee that the mean of the posterior is an unbiased estimator .",
    "it does assure , however that the posterior @xmath55 converges to the input value if the posterior is narrow , _",
    "i.e. _ the bayesian posterior is not _",
    "_    define @xmath56 as the expectation of the summand in over the population of target galaxies , and define @xmath57 for each galaxy we can define @xmath58 and @xmath59 .",
    "when we ignore the prior @xmath20 as weakly informative relative to the data from a large number @xmath53 of galaxies , the expectation of the mean @xmath60 of the posterior @xmath55 in becomes @xmath61   + o(n^{-2}).\\end{aligned}\\ ] ] the last line arises from expanding @xmath62 and using @xmath63 @xmath64    as @xmath65 , @xmath66 and the posterior narrows to a delta function at @xmath67 . to the extent that our quadratic approximation is valid , bayes theorem demands that this equal the true input .",
    "we find then that the bias for a finite set of galaxy is , to leading order in @xmath68 , @xmath69.\\ ] ] the first bracketed term is roughly a multiplicative bias ( not quite , because the distributions of  will depend weakly on ) .",
    "if we have @xmath70 , then this multiplicative bias on shear is @xmath71 .",
    "this bias will be @xmath72 smaller than the statistical error @xmath73 that arises from shape noise in a weak lensing measurement .",
    "the forms of  and  suggest that @xmath74 in magnitude , so the second term can be expected to scale as @xmath75 .",
    "in addition , this term involving covariance between  and  will vanish by symmetry at @xmath76 if the psf and noise are isotropic .",
    "therefore we expect this bias to have another factor of @xmath77 or of @xmath78 , the psf ellipticity , in front of it , leading to an additive bias of perhaps @xmath79",
    ". this will again always be below shape noise and insignificant for shear statistics constrained by @xmath80 galaxy measurements .",
    "these terms do represent a kind of noise bias on the mean of the shear posterior taken as a shear estimator . the principal difference from previous techniques , however , is that the size of this bias scales as the square of the measurement error on the _ shear _ , and is not affected by measurement errors on individual galaxy shapes .",
    "implementation of the bayesian method depends on assigning a probability @xmath39 to the pixel data given the shear . to do",
    "so we introduce some finite set @xmath81 of quantities describing the appearance of galaxy @xmath15",
    ". we must be able to assign a likelihood @xmath82 of the pixel data  being produced by a galaxy with properties .",
    "we also need to know the distribution of @xmath83 for the true galaxy population viewed through shear",
    ". then we can assign @xmath84 the derivatives with respect to  needed to define @xmath85 and @xmath32 in ( [ pqr ] ) all propagate purely to the prior @xmath86 inside the integral .    in the next two sections",
    ", we will consider first a model - fitting approach , in which the galaxy properties  are assumed to predict all of the observed pixel data values ; and a model - free scheme , in which the pixel data are compressed to a smaller set  of moments that will serve as our galaxy properties . in either case , the essential requirements are that :    1 .   we have a rigorous means to assign a likelihood @xmath87 , and 2 .   the distribution of real galaxies properties  changes under application of shear , and that we can determine this dependence @xmath88_i.e .",
    "_ there is a detectable and known signature of shear upon the galaxy population .",
    "if galaxy @xmath15 is assumed to be fully described by a model with a finite number of parameters , all the instrumental signatures are known , and there is a known noise model for the pixel data , then one can calculate the likelihood of the full pixel data vector @xmath89 . here",
    "we divide  into three subsets :    * @xmath90 is a vector of observed parameters that are altered under the action of lensing shear , _",
    "i.e. _ the ellipticity of the galaxy model .",
    "we presume that there is an exactly known transformation under the action of shear from intrinsic source parameters to the observed parameters , @xmath91 .",
    "such is the case , for example , when @xmath92 is the 2-component ellipticity of a galaxy with self - similar elliptical isophotes and  is any of the common representations of the shear linear transformation matrix .",
    "we leave the form of this transformation free at this point to accommodate any convention for the definition of the ellipticity @xmath92 and the shear @xmath35 .",
    "we do , however , require that the transformation be reversible : @xmath93 .",
    "* @xmath94 is the center of the galaxy , or more generally any parameters whose prior distribution @xmath95 can be taken as uniform both before and after the application of shear to the sky .",
    "we hence will not make @xmath94 an argument of our priors .",
    "* @xmath96 are other parameters of the model , which we take to be invariant under the action of shear on the image .",
    "examples would be the half - light radius , surface brightness , and sersic index of a simple elliptical sersic - profile galaxy model , _",
    "e.g. _ as used in @xcite .",
    "the shear - conditioned probability for single galaxy becomes @xmath97 where @xmath98 is the prior distribution the galaxy parameters given the shear .",
    "the shear enters the posterior only through this term .",
    "conservation of probability under shear requires that @xmath99 where @xmath100 is the _ unlensed _ distribution of galaxy ellipticities , and the last term is the jacobian of the ellipticity transformation @xmath101 . for an isotropic universe ,",
    "the unlensed prior should be a function only of the amplitude @xmath102 , not the orientation . given the unlensed prior , we can make a taylor expansion in the shear : @xmath103 once the transformation @xmath104 is specified , the functions  and  can be derived in terms of @xmath105 and its first two derivatives with respect to @xmath106 .",
    "the quantities needed from each galaxy for the bayesian posterior in are @xmath107 note that @xmath29 would be the bayesian evidence for @xmath16 in the absence of lensing shear .    the operative procedure for obtaining the bayesian",
    "shear estimate is :    1 .   determine the unlensed prior @xmath105 from a high-@xmath12 imaging sample , and perform the taylor expansion in knowing the ellipticity transformation equation .",
    "2 .   for each observed galaxy ,",
    "compute the six distinct integrals in ( [ int1 ] ) with the likelihood over the ellipticity and structural parameters to get @xmath108 and @xmath32 .",
    "3 .   sum over galaxies to obtain @xmath109 in . 4 .",
    "sum over galaxies to obtain the shear estimate @xmath28 as in .",
    "the shear posterior has this mean ( and maximum ) and covariance matrix @xmath37 .",
    "note that the division by @xmath109 occurs after the summation over galaxies , _",
    "i.e.  _  we do not generate ellipticity or shear estimators on a galaxy - by - galaxy basis .",
    "also note that for galaxies with very noisy data , @xmath110 is very weakly dependent on galaxy properties and hence on shear : @xmath111 equations  [ pqr ] then show that  and  both tend to zero .",
    "the low-@xmath12 galaxy hence has no influence on the shear likelihood .",
    "it will therefore be unnecessary to make cuts on galaxy size or @xmath12 ratio to obtain a successful measurement .",
    "as long as the source selection is made on a quantity ( such as total flux ) that is unaffected by galaxy shape or lensing shear , we avoid selection biases .    the only approximation made in this derivation was that of weak shear , namely that is accurate over the range of permitted by the data . if the unlensed ellipticity distribution is characterized by a scale of variation @xmath112 , this means we are assuming that @xmath113 .",
    "extension to multiple exposures of the same galaxy is trivial : the pixel data @xmath16 for galaxy @xmath15 may be the union of @xmath53 distinct exposures information , @xmath114 assuming that different exposures have statistically independent errors , we have @xmath115",
    "if the exposures are in different filter bands , then the most general formulation is that @xmath116 and @xmath96 are the unions of distinct structural parameters @xmath117 and @xmath118 for each band @xmath119 , and the prior must specify the joint distribution of galaxies appearances in all observed bands .",
    "an alternative formulation to the above is to integrate over the source ellipticity @xmath120 instead of the lensed ellipticity @xmath121 , which puts the derivatives with respect to shear in the likelihood instead of the prior : @xmath122 in this case the quantities needed for the shear posterior are @xmath123 p_0 ( e^s_i , { \\mbox{\\boldmath $ \\theta$}}_i ) \\\\ { \\mbox{$\\bf r$}}_i & \\equiv   \\int d{\\mbox{\\boldmath $ e$}}^s_i \\ , d{\\mbox{\\boldmath $ x$}}_i\\,d{\\mbox{\\boldmath $ \\theta$}}_i   \\left [ \\left.{\\boldsymbol{\\nabla_g}}{\\boldsymbol{\\nabla_g}}{\\mbox{$\\mathcal{l}$}}({\\mbox{\\boldmath $ d$}}_i   |{\\mbox{\\boldmath $ e$}}^s_i\\oplus g ,    { \\mbox{\\boldmath $ \\theta$}}_i ) \\right|_{{\\mbox{\\boldmath $ g$}}=0}\\right ] p_0 ( e^s_i , { \\mbox{\\boldmath $ \\theta$}}_i ) \\notag\\end{aligned}\\ ] ] we would expect equations  ( [ int1 ] ) to be the more computationally efficient approach , since the derivatives of the prior with respect to shear can be pre - calculated once , whereas ( [ int1b ] ) require calculating 5 shear derivatives of the likelihood for every target galaxy .",
    "furthermore the isotropy and parity symmetries of the unlensed sky simplify the shear derivatives of the prior .",
    "a numerical test with a simplified model demonstrates the accuracy and feasibility of the bayesian shear estimates in the presence of highly non - gaussian likelihoods for the ellipticities of individual galaxies .",
    "we take a minimal set of galaxy properties to be @xmath124 , the two components of a ( post - lensing ) true galaxy shape .",
    "we take an absolute minimal data vector @xmath125 for each galaxy to be a measurement of the ellipticity , ignoring centroid and any structural parameters . for each galaxy",
    "we :    * draw a source ellipticity @xmath120 from an isotropic unlensed distribution truncated to @xmath126 and defined by @xmath127 ^ 2 \\exp\\left[-(e^s)^2/2\\sigma_{\\rm prior}^2\\right].\\ ] ] the additional factor of @xmath128 atop the gaussian ensures the prior has two continuous derivatives at the @xmath129 boundary . *",
    "generate a lensed ellipticity @xmath91 for a constant shear , using the full non - euclidean transformation for ellipticity under shear _",
    "e.g. _ as described by @xcite . *",
    "obtain a measurement @xmath130 by drawing from a gaussian distribution with a variance of @xmath131 per axis .",
    "this measurement error is made non - gaussian by truncation to @xmath132 .",
    "furthermore we model biases in the measurement process by centering the gaussian at a value @xmath133 for some multiplicative error @xmath134 and additive error @xmath135 . in the numerical tests",
    "below , we adopt @xmath136 and @xmath137 .    the likelihood @xmath138 is a known truncated , biased function .",
    "the measurement error distribution is asymmetric with non - zero mean , and strongly dependent upon the intrinsic ellipticity  characteristics which induce biases in most extant shear - estimation methods .      the integrals in ( [ int1 ] )",
    "are evaluated using a grid - based approach adapted from @xcite .",
    "we define a set of sampled points , starting by evaluating the integrand of @xmath29 in ( [ int1 ] ) at a random point in @xmath121 .",
    "we construct a square grid with initial resolution @xmath139 centered on the initial sample .",
    "we then iterate this process :    1 .",
    "evaluate the integrand at all grid points that neighbor existing members of the sample .",
    "2 .   determine the maximum integrand value @xmath140 among all sampled points .",
    "discard any sampled point with integrand @xmath141 .",
    "we iterate this process until no new samples are added on an iteration .",
    "if the number of surviving above - threshold samples is @xmath142 , we halt the process .",
    "otherwise we decrease the grid spacing @xmath139 by a factor of @xmath143 by adding a new grid point at the center of each previous grid square .",
    "we then repeat the above iteration .",
    "the grid is refined until we reach the desired number of above - threshold samples or until we reach a minimum resolution .",
    "we can now calculate the integrals in ( [ int1 ] ) for each galaxy by summing over the sampled points @xmath117 : @xmath144 and evaluate @xmath30 and @xmath32 by summing over the same samples , reusing the calculated @xmath145 , changing only the last terms as per the integrands in ( [ int1 ] ) .      for all tests we fix @xmath146 , @xmath147 , and @xmath148 . for each parameter",
    "set we simulate at least @xmath149 galaxies to reduce the shape noise below our desired accuracy .",
    "the left plot in fig .  [ recovery ] shows the relative error @xmath150 for different values of @xmath151 and @xmath152 .",
    "the shaded region is the desired relative shear error of @xmath153 .",
    "we recover @xmath35 to this desired precision for all values of @xmath152 as long as @xmath151 is below @xmath154 , even when the shear measurement error is as large as @xmath155 , as one might obtain for real galaxies with @xmath156 .",
    "the number of likelihood evaluations per galaxy is between 50 and 200 for all cases tested .",
    "we also use a jacknife method to measure the statistical uncertainty in the shear estimator ( [ barg ] ) from each simulation . the measured uncertainty in the shear",
    "is found to agree ( to 12% ) with the covariance matrix @xmath37 derived in ( [ cg ] ) from the bayesian framework .",
    "the toy model illustrates the validity of the weak - shear bayesian formalism in the face of non - euclidean shear transformations and messy ( but known ) shape measurement errors .    the right - hand plot in figure  [ recovery ] plots the bayesian shear measurement error vs the per - galaxy ellipticity measurement error @xmath152 , for the case @xmath157 . for comparison we plot in blue",
    "the shear estimated for the same simulated data using the lensfit  estimator described in section  2.5 of @xcite .",
    "a galaxy weighting function is allowed in lensfit : we assume equal weighting for our simulated galaxies . the fully bayesian shear estimator attains the desired @xmath158 while the lensfit  estimator does not .",
    "note that @xcite present a different lensfit  estimator which has been applied to the canada - france - hawaii lens survey",
    ".      the primary difficulty of implementation of these bayesian shear measurement methods will be the need to construct high - dimensional priors .",
    "we will be tempted to reduce the dimensionality of the galaxy parameter space . under what circumstances",
    "can we omit a parameter from our bayesian calculation and still obtain a rigorously correct result ? consider the simple case where a galaxy property set is supplemented by a parameter @xmath159 which can take discrete values @xmath160 with probability @xmath161 the posterior contribution from a single galaxy is @xmath162 if we are unaware of this parameter or choose to ignore it , we will have a prior marginalized over @xmath159 and probably assign a likelihood that is also an average over the @xmath159 cases .",
    "our posterior calculation will then yield @xmath163 this can differ from the correct ( [ correct ] ) unless either the prior or data likelihood is independent of @xmath159 .",
    "in other words : _ the prior must specify the distribution of all galaxy parameters that the likelihood depends upon . _",
    "we illustrate such bias by dividing the galaxies in our toy model into two populations @xmath164 and @xmath165 with distinct @xmath166 and @xmath152 .",
    "galaxies are assigned to type b at random with some probability @xmath167 an observer ignorant of the existence of type a and type b galaxies would infer a prior and a measurement - error distribution that are found by averaging over the full population as in  ( [ avg ] ) . fig .",
    "[ pop ] shows the accuracy of the bayesian shear estimate under these ( mistaken ) assumptions .",
    "we choose @xmath168 , @xmath169 , @xmath170 , and vary @xmath171 . as expected a shear bias ( up to 15% ) appears as @xmath171 becomes more distinct from @xmath172 the shear bias decreases when type b galaxies become rarer and when their measurement error ( hence likelihood function ) become indistinguishable from type a.     of the b population .",
    "the a population has measurement error @xmath170 .",
    "the intrinsic ellipticity dispersions for a and b galaxies are 0.1 and 0.3 , respectively .",
    "the shear bias from the unrecognized structural parameter vanishes when the error distributions match and @xmath173 becomes independent of galaxy type .",
    "it is also reduced as the fraction @xmath174 of the population in type b is decreased.,width=307 ]    for this bayesian model - fitting method , an example of a galaxy parameter that can be ignored is color , which does not affect the likelihood function of single - band pixel data as long as the other parameters @xmath175 completely specify the single - band appearance of the galaxy .",
    "the accuracy of the bayesian inference may be improved , however , if we can include measured color in the data vector and include color dependence in the prior , _ e.g. _ by distinguishing late- and early - type galaxies .",
    "in model - fitting , ignoring parameters that _ do _ affect the likelihood of pixel values can produce bias .",
    "an example would be assuming a fixed bulge - to - disk ratio when fitting a population of galaxies that has varying ratios .",
    "unfortunately there is no known finite parameterization for real galaxies appearances , and hence it is not possible to create a formally correct bayesian model - fitting shear method for real galaxies .",
    "the means by which incomplete galaxy models can bias shear measurements are illustrated and explained by @xcite , @xcite , and @xcite .",
    "the potential for shear biases from unrecognized galaxy characteristics is not limited to model - fitting methods .",
    "for example in the model - free moment - based method described in the next section , the bayesian formalism will break down if the likelihood of the moments depends on the detailed structure of the underlying galaxy . as noted above",
    ", we need to marginalize over any galaxy parameter that appears in the likelihood expression for the data .",
    "acknowledging that we can not construct a model of galaxy structure with which to predict all pixel values , we can instead compress the pixel data into a small number of quantities that carry most of the information on any shear applied to the source .",
    "we will call the compressed quantities `` moments '' since we propose that they be intensity - weighted moments .",
    "this method will hence resemble the venerable @xcite shear - measurement methodology , but with critical changes to eliminate the approximations inherent to ksb and a rigorous bayesian formulation to eliminate noise - induced biases .",
    "we choose to reduce the pixel data for any galaxy image to a small vector @xmath176 of derived quantities which we will select to be sensitive to shear .",
    "the  must be chosen such that one can propagate the pixel noise model to the moment vector .",
    "if @xmath177 are the moments calculated from the pixel data for galaxy @xmath15 , we must be able to assign a likelihood @xmath178 of producing the measured moments given that the galaxy has true ( noiseless ) moments . in this case",
    "the contribution to the shear posterior from galaxy @xmath15 is @xmath179 where @xmath180 is the prior distribution of moments of a galaxy centered at  given a local shear .",
    "the taylor expansion of the prior can be written as @xmath181 and then the quantities needed from each galaxy for the bayesian posterior in are @xmath182    now the operative procedure for obtaining the bayesian shear is :    1 .",
    "determine the prior @xmath180 from a high-@xmath12 imaging sample , and perform the taylor expansion in . here",
    "@xmath183 is the vector from the coordinate origin of the moments to the center of the galaxy .",
    "the derivatives of this prior under shear must be obtained by simulating the action of shear on each member of the high-@xmath12 ensemble defining the prior .",
    "appendix  [ momentcalcs ] shows that the derivatives of the moments  are equal to a set of higher - order moments , which can hence be measured directly from the high-@xmath12 sample .",
    "there is no longer any explicit ellipticity parameter describing each galaxy to represent the shear - dependent aspects of that galaxy .",
    "2 .   for each observed galaxy , measure the moments @xmath177 of that galaxy about some pre - selected coordinate origin and determine the likelihood function @xmath184 .",
    "we have no further need of the pixel data for the galaxy after this compression .",
    "3 .   compute the six distinct integrals in ( [ int1c ] ) over the moment space @xmath185 to get @xmath108 and @xmath32 .",
    "this is the computationally intensive step .",
    "4 .   sum over galaxies to obtain @xmath109 in . 5 .",
    "sum over galaxies to obtain the shear estimate @xmath28 as in .",
    "the shear posterior has this mean ( and maximum ) and covariance matrix @xmath37 .      to make things more concrete ,",
    "we propose that the compressed quantities  be intensity - weighted moments of the galaxy image .",
    "we will evaluate these in fourier domain where , in the absence of aliasing , the exact correction for the effect of the point spread function ( psf ) on the observed galaxy image is a simple division .",
    "this yields our bayesian fourier - domain ( bfd ) algorithm .",
    "the moment vector could be @xmath186 here @xmath187 and @xmath188 are the fourier transforms of the observed image and the psf , respectively , and @xmath189 is a window function applied to the integral to bound the noise , in particular confining the integral to the finite region of @xmath190 in which @xmath188 is non - zero , as detailed in @xcite .",
    "there is a specific weight that will offer optimal @xmath12 for a given galaxy@xmath191psf pair , but any properly bounded weight with finite 2nd derivatives produces a valid shear method .",
    "one can select a single weight function for a full survey and retain good @xmath12 as long as the psf does not vary widely in size . in real data",
    "the integrals revert to sums over the @xmath190-space values sampled by a discrete fourier transform ( dft ) of the pixel data @xmath192 .",
    "the first motivation for this choice is that these moments are linear in the observed pixel data and therefore meet the requirement that we be able to construct a moment noise model @xmath193 from the known pixel noise model .",
    "in fact if the noise in the pixels is independent of the pixel values , then the covariance matrix @xmath194 of the moments is independent of the value of , and also independent of any other properties of the galaxy .",
    "such is the case for the background - limited conditions typical of faint - galaxy imaging .",
    "if the noise is stationary , than all galaxies with the same psf will have the same @xmath194 .",
    "even if the pixel noise is not gaussian , the central limit theorem implies that the moments , which are sums over many independent pixels , will tend toward a gaussian distribution .",
    "we therefore can take @xmath195 furthermore if the psf is ( nearly ) isotropic , then the azimuthal symmetries of our chosen basis set guarantee that @xmath194 will be ( nearly ) diagonal , with the exception of a covariance between the two monopole moments @xmath196 and @xmath197 .",
    "one departure from common shear - measurement practices is that calculating @xmath177 from pixel data for @xmath15 does not involve any iterative procedures such as centroiding , since iteration usually produce non - analytic likelihoods . in section  [ nulltests ]",
    "we look for feasible approximations to the propagation of errors into some iterative compressed quantities .",
    "we are also tempted to reduce the dimensionality of our prior and speed up marginalization by working with the normalized ratios @xmath198 , @xmath199 , @xmath200 , and @xmath201 that figure prominently in ksb , then dropping @xmath196 and @xmath197 from our data vector .",
    "the probability distribution for such ratios of gaussian deviates is known @xcite , but depends on the mean value and variance of the denominator , so the moment likelihood function would still depend on @xmath196 and @xmath197 . as per the discussion in section  [ hidden ]",
    ", we would still need to include these quantities in the prior and marginalize over them , foiling our plan to simplify the prior .",
    "we choose the straightforward path of compressing the pixel data to un - normalized moments .",
    "what is the motivation for choosing this particular set of linear moments ?",
    "any choice of well - defined compressed data vector @xmath185 will yield a _ valid _",
    "bayesian shear estimator under this method , but the choices will differ in the _ precision _ to which they determine the shear  from a given galaxy sample .",
    "we want  to include quantities that unambiguously capture most of the impact of shear upon the pixel image .",
    "the quadrupole moments @xmath202 and @xmath203 respond at first order to shear .",
    "they are also sensitive at first order to the galaxy size and flux , and at second order to translation of the galaxy image , so we add the monopole and dipole moments @xmath196 , @xmath197 , @xmath204 , and @xmath205 , sensitive to flux , size , and translation in first order , to yield less degenerate shear information for each galaxy .",
    "the inclusion of @xmath197 furthermore would admit generalizing the bayesian formalism to infer the weak lensing magnification @xmath206 along with the 2 shear components .",
    "we defer testing of a full implementation of this method for a later publication , but we do outline the necessary steps and possible economies .    the biggest astrophysical challenge will be to produce the prior , which is a function of the six  components  which can be reduced to 5 dimensions because the isotropy of the universe requires the unlensed prior to be invariant under coordinate rotation . at each point in the 5-dimensional space ,",
    "we require 5 shear derivatives of the prior as well as the unsheared prior , so the we must construct a 6-dimensional function on a 5-dimensional space , and for each source galaxy integrate the posterior over all 6 dimensions of .",
    "note that this bfd method will be much faster than the bmf method even at equal dimensionality , because bfd requires the evaluation of only one gaussian @xmath207 at each point of the integration , whereas bmf requires evaluation of the full likelihood of the pixel data of a model .    since galaxy - evolution theory will not be able in the foreseeable future to provide an _ a priori _ distribution of galaxy appearances , the prior will always have to be empirical .",
    "the prior can be established by obtaining high-@xmath12 data on a sample of the sky .",
    "note that the  values depend upon the choice of weight function @xmath208 to suit the observational psf , and implicitly depend upon the filter passband used for the observations , so the prior is best constructed from deep integrations using the same instrument as the main survey .",
    "the number of high-@xmath12 galaxies necessary to adequately define the prior is an important issue for future study .",
    "the prior can be generated by some kernel density estimation over the empirical moments @xmath209 where @xmath206 indexes the members of the high-@xmath12 template galaxy set . in ( [ posterior2 ] ) , however , we see that the prior is already being convolved with the likelihood function for a target galaxy . hence if the we are using target galaxies of sufficiently low @xmath12 that @xmath210,\\ ] ] where we need @xmath211 , the moments for the template galaxy if it were sheared by @xmath35 . the posterior contribution for galaxy @xmath15 becomes @xmath212.\\ ] ] we perform a taylor expansion on this shear - conditioned probability to obtain our required properties : @xmath213_{{\\mbox{\\boldmath $ m$}}_\\mu } \\cdot    { \\boldsymbol{\\nabla_g}}{\\mbox{\\boldmath $ m$}}_\\mu , \\\\",
    "{ \\mbox{$\\bf r$}}_i & =   \\sum_\\mu    { \\boldsymbol{\\nabla_g}}{\\mbox{\\boldmath $ m$}}_\\mu \\cdot   \\left [ \\frac{\\partial^2}{\\partial { \\mbox{\\boldmath $ m$}}^2 }    { \\mbox{$\\mathcal{l}$}}\\left({\\mbox{\\boldmath",
    "$ m$}}_i | { \\mbox{\\boldmath $ m$}}\\right)\\right]_{{\\mbox{\\boldmath $ m$}}_\\mu } \\cdot    { \\boldsymbol{\\nabla_g}}{\\mbox{\\boldmath $ m$}}_\\mu \\notag\\\\   & +   \\sum_\\mu \\left [ \\frac{\\partial}{\\partial { \\mbox{\\boldmath $ m$ } } }    { \\mbox{$\\mathcal{l}$}}\\left({\\mbox{\\boldmath",
    "$ m$}}_i | { \\mbox{\\boldmath $ m$}}\\right)\\right]_{{\\mbox{\\boldmath $ m$}}_\\mu } \\cdot    { \\boldsymbol{\\nabla_g}}{\\boldsymbol{\\nabla_g}}{\\mbox{\\boldmath $ m$}}_\\mu , \\notag\\end{aligned}\\ ] ] where all moments and derivatives are taken at @xmath76 .",
    "the determination of @xmath214 from the data for template galaxy @xmath206 is straightforward in fourier domain , and is given in appendix  b.    now we adopt the multivariate gaussian likelihood ( [ gausslikelihood ] ) for the moments .",
    "we also can define @xmath215 to be the moments that we would assign to template galaxy @xmath206 if it were translated to @xmath183 ( relative to the target galaxy s coordinate origin ) and rotated by @xmath216 . because the unlensed sky is isotropic , we can assume that the true prior contains replicas of template galaxy @xmath206 at all  and @xmath216 .",
    ", essentially adopting a prior that we have indeed found a galaxy and its center is within our postage stamp .",
    "this avoids the problem of divergent position marginalization noted in @xcite . ]",
    "the parity invariance of the unlensed sky also implies that we can place a mirror image of each template galaxy in the prior as well .",
    "appendix  [ momentcalcs ] shows how to calculate moments for these transformed versions of a template galaxy .    for notational simplicity we will subsume the parity flip into the integration over rotation @xmath216 .",
    "the taylor - expanded posterior derived from the template sample now becomes : @xmath217 \\cdot { \\mbox{$\\bf c$}}_i^{-1 } \\cdot { \\boldsymbol{\\nabla_g}}{\\mbox{\\boldmath $ m$}}_\\mu({\\mbox{\\boldmath $ x$}},\\phi ) \\\\",
    "{ \\mbox{$\\bf r$}}_i & =   \\sum_\\mu \\int d{\\mbox{\\boldmath $ x$}}\\ , d\\phi\\ ,   { \\mbox{$\\mathcal{l}$}}_{i\\mu}({\\mbox{\\boldmath $ x$}},\\phi ) \\left\\ { \\left [ { \\mbox{\\boldmath $ m$}}_i - { \\mbox{\\boldmath $ m$}}_\\mu({\\mbox{\\boldmath $ x$}},\\phi ) \\right ] \\cdot { \\mbox{$\\bf c$}}_i^{-1 } \\cdot { \\boldsymbol{\\nabla_g}}{\\boldsymbol{\\nabla_g}}{\\mbox{\\boldmath $ m$}}_\\mu({\\mbox{\\boldmath $ x$}},\\phi ) \\right . \\notag \\\\     &   \\phantom{\\sum_\\mu \\int d{\\mbox{\\boldmath $ x$}}\\ , d\\phi\\ , { \\mbox{$\\mathcal{l}$}}_{i\\mu}({\\mbox{\\boldmath $ x$}},\\phi ) } \\left . + { \\boldsymbol{\\nabla_g}}{\\mbox{\\boldmath $ m$}}_\\mu({\\mbox{\\boldmath $ x$}},\\phi ) \\cdot { \\mbox{$\\bf c$}}_i^{-1 } \\cdot",
    "{ \\boldsymbol{\\nabla_g}}{\\mbox{\\boldmath $ m$}}_\\mu({\\mbox{\\boldmath $ x$}},\\phi ) \\right\\ } \\notag \\\\ { \\mbox{$\\mathcal{l}$}}_{i\\mu}({\\mbox{\\boldmath $ x$}},\\phi ) & \\equiv   \\exp\\left\\ { -\\frac{1}{2 }   \\left [ { \\mbox{\\boldmath $ m$}}_i - { \\mbox{\\boldmath $ m$}}_\\mu({\\mbox{\\boldmath $ x$}},\\phi ) \\right ] \\cdot { \\mbox{$\\bf c$}}_i^{-1 } \\cdot \\left [ { \\mbox{\\boldmath $ m$}}_i - { \\mbox{\\boldmath $ m$}}_\\mu({\\mbox{\\boldmath $ x$}},\\phi ) \\right ] \\right\\ }   \\notag\\end{aligned}\\ ] ]    the computational challenge of this bayesian fourier - domain shear inference is the high multiplicity of this calculation : for every target galaxy @xmath15 , we collect 6 sums over every template galaxy @xmath206 , with each term of each sum being an integral of a gaussian function of the three dimensions plus parity flip of @xmath218 .",
    "there are obvious efficiencies to be gained in this calculation by pruning the template set to those with significant contributions to the sums .",
    "furthermore we recall that all science will come from sums over a large number of target galaxies , so we can subsample the template set when computing the posterior for individual target galaxies , if we can do so without inducing systematic biases on @xmath219 .",
    "a substantial speedup of the bayesian shear calculation is enabled if we can approximate @xmath209 as linearly dependent on , in which case two of the three dimensions of the integrals in equations  ( [ final2 ] ) reduce to linear algebra .",
    "appendix  [ momentcalcs ] shows how to determine these derivatives for the template galaxies .",
    "we leave the testing of a practical implementation of equations  ( [ final2 ] ) and the investigation of the required size of the template galaxy sample to further work .",
    "the bfd method improves on the bmf method by eliminating the approximation that target galaxies are described by a low - dimensional model .",
    "we paid a price , however , in losing the convenience of having the action of shear be fully described by alteration of just the two components of .",
    "this allowed us to derive the lensed prior solely from derivatives with respect to @xmath106 of the unlensed prior @xmath220 in this section we ask whether null - testing methods can be used to make a model - free bayesian shear inference with the simplicity of a known shear transformation @xmath221 we conclude below that this is difficult .",
    "readers uninterested in the null - testing approach can safely skip this section .",
    "windowed centroiding procedures assign a center  to a galaxy by translating the galaxy until the windowed first moments are nulled .",
    "the galaxy is assigned a centroid that is the inverse of the translation needed to null the moments . in the fourier domain",
    "null test ( fdnt ) method @xcite , this is extended by shearing as well as translating the galaxy ( after correcting for seeing ) until we null the moments @xmath222 and @xmath203 in .",
    "the galaxy is assigned a shape @xmath116 that is the inverse of the shear that produces the null .",
    "the moment vector for galaxy @xmath15 is hence a function @xmath223 of the four - dimensional transformation @xmath224 and we assign the galaxy a shape and centroid @xmath225 such that @xmath226 .",
    "this approach assures a well - determined transformation of the measured shape @xmath116 under an applied shear , and there is no need of a galaxy model .",
    "@xcite demonstrates shear inferences errors of @xmath0 part in @xmath1 on low - noise data using fdnt .",
    "the application of rigorous bayesian formalism to fdnt is foiled , however , because there is no straightforward means of propagating the pixel noise model to a likelihood @xmath227 of measuring a null at @xmath228 when the underlying galaxy has true null at @xmath229 .",
    "it is possible , however , to approximate @xmath230 in the case where the measured shape and centroid are close to the true ones . at sufficiently high @xmath12 of the target galaxy",
    ", the likelihood will be confined to such regions and the bayesian formulation with this approximation will become accurate .",
    "the measured moments @xmath177 for galaxy @xmath15 when transformed by @xmath229 can be written as @xmath231 where @xmath209 is the true underlying moment and @xmath232 is the variation induced by measurement noise .",
    "since @xmath223 is a linear function of the pixel data , the likelihood @xmath233 $ ] is calculable and close to gaussian .",
    "our first approximation is to linearize @xmath209 about the @xmath234 that nulls it : @xmath235 second we assume that @xmath236 is invariant in the neighborhood of @xmath228 and that this measurement error has a multivariate gaussian likelihood @xmath237 defined by a covariance matrix @xmath194 and zero mean .",
    "then via the nulling transformation @xmath228 is @xmath238    if we again construct the prior from a template set of galaxies indexed by @xmath206 , having ellipticities @xmath239 , and uniformly distributed in position @xmath240 with respect to the target galaxy s position , then the contribution to the posterior from target galaxy @xmath15 is the sum over template galaxies : @xmath241.\\ ] ] the integration over the two spatial dimensions @xmath240 of the gaussian argument @xmath242 is analytic . to complete the implementation of the bayesian framework we need to find the taylor expansion of with respect to",
    "the right - hand side depends implicitly on the applied shear  because the template galaxy s shape @xmath239 is transformed by applied shear and enters into @xmath243 . to be thorough",
    "we should also account for the variation of the derivative vector @xmath244 with applied shear .",
    "doing so is straightforward but not instructive so we omit the algebra here .",
    "we find therefore that there is a high-@xmath12 approximation to the bayesian shear estimator in the case of iterative null tests , but that this requires knowing the prior distribution not only of the galaxies ellipticities @xmath92 but also of the derivatives @xmath245 of the null tests with respect to shear and translation .",
    "hence even in the high-@xmath12 approximation , we have not found a way to produce a simpler model - free derivatives of the prior than in bfd .",
    "we will therefore choose to pursue bfd first , as it demands no approximations beyond the weak - shear taylor expansion of the posterior and does not require searching for nulled moments .",
    "the bmf shear measurement that we propose bears very close resemblance to lensfit .",
    "lensfit  is described as `` bayesian galaxy shape measurement '' and differs from our bmf method which is derived as a bayesian _ shear _ determination .",
    "the consequence is that bmf does not assign shapes ( ellipticities ) to galaxies , instead computing the likelihood - weighted derivatives of the prior for each galaxy as per ( [ int1 ] ) , and combining to yield shear as per ( [ cg ] ) and ( [ barg ] ) .",
    "lensfit  already does the hard computational work of our bmf algorithm , namely the integration of the data likelihood times the prior over the parameters of the model space .",
    "hence lensfit  serves as an example of the feasibility of our bmf method . at a minimum level of realism ,",
    "the galaxy model must include two ellipticity components , two centroid components , and  including a galaxy flux , size , and a measure of concentration such as the sersic index , for 7 parameters .",
    "isotropy reduces the unlensed prior to 6 dimensions .",
    "the posterior requires integration over 7 dimensions .",
    "@xcite reduce the dimensionality of the likelihood integral by analytic marginalization over flux ( which requires a particular choice of prior ) and linearization of the model dependence on . @xcite use a bulge / disk ratio in place of a sersic index for concentration .",
    "their work hence demonstrates the feasibility of computing the bayesian integrals over a 7-dimensional model space .",
    "the lensfit  implementations simplify the prior substantially by separating the dependence on variables . a numerical approach to constructing an accurate fully - coupled prior from high-@xmath12 observations",
    "remains to be demonstrated .",
    "there are reasons to suspect that this minimal model does not describe the true galaxy population sufficiently well to achieve @xmath6 , in particular because galaxies with radial gradients in ellipticity induce biases in shear inferences when fit by models without gradients @xcite .",
    "the computational difficulty will grow , with an exponential increase in the number of likelihood evaluations , as additional parameters are needed in the model and hence in the prior and the integrations this will lead us to favor the bfd method .",
    "model - fitting will remain useful , however , in cases of incomplete pixel information on the galaxy , _",
    "e.g. _ from cosmic rays , in which case the models can serve as a sparse dictionary for the pixel data .      the bayesian fourier domain ( bfd ) method is model - free , in common with many moment - based schemes for shear inference , the best - known of which is from ( * ? ? ? *",
    "bfd shares with ksb and its brethren the approach that the galaxy pixel data can be compressed to a few simple moments which transmit most of the information on lensing shear of the image .",
    "the bfd method , however , differs fundamentally in explicit use of a prior high-@xmath12 moment distribution , as opposed purely to summations over properties of the normal-@xmath12 images .",
    "there are fundamental differences between bfd and ksb that give the former a rigorous treatment of the effects of psfs and noise :    * the bfd method accumulates moments in fourier domain , admitting an exact correction for the joint effects of the psf and shear on the images , avoiding the need for ksb s gaussian - based approximations . * the bfd method does not require an iterative centroiding procedure , meaning the full likelihood of the observed moments remains known even at low @xmath12 .",
    "positional uncertainties are treated by bayesian integration over all possible positions of the galaxy . *",
    "the `` polarizability '' that ksb calculates for each galaxy is effectively replaced by integration of the target galaxy s moment likelihood over the shear derivatives of the prior .",
    "the bfd approach is exact in the presence of noise whereas the single - galaxy polarizabilities are biased by noise .",
    "a consequence of this is the absence of an ellipticity assignment to individual galaxies in bfd .",
    "the non - bayesian method bearing the closest resemblance to bfd is described by @xcite and its predecessor papers . like bfd ,",
    "zhang s method is equivalent to accumulating moments in fourier domain , and emphasizes that a shear inferred from the ratio of two sums over the galaxy population  an average `` signal '' divided by an average `` responsivity''is less biased by noise than a shear inferred from a sum of single - galaxy ratios _ a la _ ksb .",
    "a critical difference is that zhang s method takes moments of the power spectrum @xmath246 rather than the fourier amplitude @xmath247 .",
    "this makes the method insensitive to the choice of centroid .",
    "it also , however , amplifies the noise relative to the signal and the rectified noise must be very precisely removed from the power spectrum .",
    "neither zhang nor ksb have an intrinsic means of appropriately weighting the galaxies for the shear information that they contain , which occurs naturally in the bfd method .",
    "this means they require some form of weighting or selection in order to keep the low-@xmath12 galaxies from ruining the @xmath12 of the shear inference .",
    "weighting and selection can themselves induce biases in the inferred shear .",
    "finally , zhang s method is formulated only for a gaussian weight function @xmath248 , which formally requires integration over regions of @xmath190-space with infinite noise in any real image .",
    "high shear fidelity on simulated images has been achieved by `` stacking '' methods , which sum galaxy images before analysis @xcite .",
    "these work by essentially creating a single high-@xmath12 image with an unlensed source that must approach circularity .",
    "noise - induced biases are therefore avoided and the number of parameters needed to approximate the mean galaxy is greatly reduced .",
    "these stacking methods have practical drawbacks when the psf and/or the lensing shear vary across the image .",
    "there is also a deeper problem in the need to assign an origin to each galaxy to build the stack . at this stage",
    "the galaxies individual low @xmath12 levels are still present and noise - induced biases , primarily a suppression of the shear inferred from the stack , are important .",
    "the bfd method will avoid this problem .",
    "we have shown how the exact bayesian formulation of shear inference from a collection of galaxy images can be turned into a practical measurement technique in the limit of weak shear , by accumulating each target galaxy s contribution to the first terms of the power - law expansion of the posterior @xmath249 .",
    "we can expect this rigorously derived treatment of noise to yield highly accurate shears even at low @xmath12 , and also make it possible to suppress selection biases in the shear inference .",
    "we confirm the ability of the algorithm to provide part - per - thousand shear inference at low @xmath12 , in the case of a highly simplified model of galaxy measurement .",
    "the bayesian derivation leads to a shear estimator that departs in significant ways from most previously proposed methods .",
    "ellipticities ( shapes ) are not assigned to individual galaxies ; biases are avoided by combining a large ensemble of low-@xmath12 galaxies into a single shear estimator .",
    "another important element is the marginalization over galaxy position rather than selecting a centroid .",
    "these elements have been used seperately in previous methods , but not together .",
    "there are two clear routes to coupling the bayesian treatment of noise with an exact treatment of the effects of the psf and sampling on the -space moments .",
    "exact corrections for psf and sampling are possible and the method is model - free if the images are fully sampled . the likelihood of the ( compressed ) data given the underlying moment vector is a well - defined multivariate gaussian in the common case of background - limited observations .",
    "we propose to apply the method to the zeroth , first , and second moments of the galaxies .",
    "measuring these 6 moments will be fast and foolproof  no iteration is required .",
    "the prior distribution of moments will be 5-dimensional because of isotropy .",
    "we show how the prior can be constructed and integrated using empirical moment measurements on high-@xmath12 images obtained from long integrations on a small subset of the sky area in a given survey .",
    "this integration is likely to be the most computationally intensive step of an implementation of the bfd method .",
    "the required size of this template subsample is an important issue for future study .",
    "both the bmf and bfd methods require empirical inputs in the form of distributions of real galaxies over some galaxy property vector galaxy ellipticities , sersic indices , etc . in the bmf case , and",
    "seeing - corrected galaxy moments in the bfd case .",
    "also in either case one must know how this empirical distribution changes under application of lensing shear ( and magnification ) . in the bmf case ,",
    "this typically is a simple shift of galaxy ellipticity parameters . in the bfd case , the derivatives of galaxy moments under shear are simply higher - order moments derived in appendix  [ momentcalcs ] .",
    "hence bfd is truly model - free in the sense that it is not necessary to characterize the full surface - brightness distributions of real galaxies  just the empirical distribution of a finite set of galaxy moments .",
    "both the bmf and bfd methods easily treat the cases of multiple exposures of a single galaxy , spatially varying shear and psfs , and are extensible to the inference of lensing magnification as well as shear .",
    "while we defer testing of implementations of these methods to a future publication , the absence of approximations in the derivation of these methods , particularly the bfd method , gives great hope of achieving shear inference at better than part - per - thousand accuracy , as is required for future ambitious weak lensing surveys .",
    "both authors were supported by department of energy grant de - sc0007901 .",
    "gmb additionally acknowledges support from national science foundation grant ast-0908027 and nasa grant nnx11ai25 g .",
    "we are grateful to sarah bridle , bhuvnesh jain , mike jarvis , marisa march , and lance miller for conversations that have helped guide this work .",
    "we thank the referee , whose comments on this submission led us to significantly better presentation and understanding of the method described herein .",
    "bernstein , g.  m.  2010 , , 406 , 2793    bernstein , g. , & gruen , d. 2013 , in preparation    bridle , s. , balan , s.  t. , bethge , m. , et al .",
    "2010 , , 405 , 2044    heymans , c. , van waerbeke , l. , bacon , d. , et al .",
    "2006 , , 368 , 1323    hoekstra , h. , & jain , b.  2008 , annual review of nuclear and particle science , 58 , 99    huterer , d. , takada , m. , bernstein , g. , & jain , b.  2006 , , 366 , 101    kacprzak , t. , zuntz , j. , rowe , b. , et al .",
    "2012 , , 427 , 2711    kaiser , n. , squires , g. , & broadhurst , t.  1995 , , 449 , 460    kitching , t.  d. , balan , s.  t. , bridle , s. , et al .",
    "2012 , , 423 , 3163    kuijken , k.  1999 , , 352 , 355    lewis , a.  2009 , , 398 , 471    massey , r. , heymans , c. , berg , j. , et al .",
    "2007 , , 376 , 13    melchior , p. , & viola , m.  2012 , , 424 , 2757    miller , l. , kitching , t.  d. , heymans , c. , heavens , a.  f. , & van waerbeke , l.  2007 , , 382 , 315    miller , l. , heymans , c. , kitching , t.  d. , et al .",
    "2013 , , 429 , 2858    refregier , a. , kacprzak , t. , amara , a. , bridle , s. , & rowe , b.  2012 , , 425 , 1951    seitz , c. , & schneider , p.  1997",
    ", , 318 , 687    voigt , l.  m. , & bridle , s.  l.  2010 , , 404 , 458    weinberg , d.  h. , mortonson , m.  j. , eisenstein , d.  j. , et al .",
    "2013 , , 530 , 87    zhang , j.  2011 , , 11 , 41    zuntz , j. , kacprzak , t. , voigt , l. , et al .",
    "2013 , , 434 , 1604",
    "here we take the expansion for @xmath249 to third order in @xmath77 , and calculate the perturbation to the maximum and mean of the posterior relative to the second order ( gaussian ) result in section  [ weakapprox ] .",
    "we adopt a slightly different notation by first expanding the transformed prior as @xmath250 \\notag \\\\   & \\phantom{{}= { } } + \\frac{g^3}{6}\\left [ s_1(e ) \\cos\\delta\\phi + s_3(e )",
    "\\cos     3\\delta\\phi \\right].\\end{aligned}\\ ] ] both the unlensed prior and the shear transformation formula must be invariant under rotation of coordinates , so the sheared prior must be a function only of the ellipticity amplitude @xmath251 , the shear amplitude @xmath252 , and the angle @xmath253 between them .",
    "sine terms are absent because the shear transformation law should be invariant under parity flip .",
    "the functions @xmath254 and @xmath255 of galaxy ellipticity @xmath106 can be expressed as algebraic combinations of derivatives of @xmath256 and of the shear addition law .",
    "these expressions are complex and not enlightening , and in practice a numerical estimate is likely to be faster than the algebraic calculation anyway , so we omit the algebraic forms . throughout this appendix",
    "we also omit the additional galaxy parameters  which will also be arguments of @xmath256 and the five derivative functions .    adopting the complex notation @xmath257 , and designating @xmath216 as the azimuthal angle of",
    ", the posterior likelihood of shear for galaxy @xmath119 becomes @xmath258 , \\\\",
    "\\left\\ { \\begin{array}{c } p_j \\\\ q_j \\\\ r_{0j } \\\\ r_{2j}\\\\ s_{1j } \\\\",
    "\\end{array } \\right\\ } & \\equiv   \\int e\\,de \\ ,",
    "p({\\mbox{\\boldmath $ d$}}_j | { \\mbox{\\boldmath $ e$ } } ) \\left\\{\\begin{array}{c } p_0 ( e ) \\\\",
    "q(e ) \\exp(i\\phi ) \\\\",
    "r_0(e )   \\\\",
    "r_2(e ) \\exp(2i\\phi ) \\\\",
    "s_1(e ) \\exp(i\\phi ) \\\\",
    "s_3(e ) \\exp(3i\\phi ) \\\\ \\end{array }",
    "\\right\\ } \\notag\\end{aligned}\\ ] ]    after taking the logarithm of the posterior in ( [ cubicpi ] ) to third order in @xmath77 , we sum over galaxies to get the ( log of ) the total shear posterior probability : @xmath259 , \\\\",
    "-q & =   \\sum \\frac{q_j}{p_j } , \\label{qsum } \\\\ -r_0 & =   \\sum \\left ( \\frac{r_{0j}}{p_j }     - \\frac{1}{2}\\frac{q_j q_j^\\ast}{p_j^2}\\right ) , \\\\",
    "-r_2 & =   \\sum \\left ( \\frac{r_{2j}}{p_j }     - \\frac{1}{2}\\frac{q_j^2}{p_j^2}\\right ) , \\\\",
    "-s_1 & =   \\sum \\left ( \\frac{s_{1j}}{p_j }     - 3\\frac{r_{0j } q_j}{p_j^2 }    - \\frac{3}{2}\\frac{r_{2j }   q_j^\\ast}{p_j^2 }    + \\frac{3}{2}\\frac{q_j^2 q_j^\\ast}{p_j^3}\\right ) , \\\\",
    "-s_3 & =   \\sum \\left ( \\frac{s_{3j}}{p_j }     - \\frac{3}{2}\\frac{r_{2j }   q_j}{p_j^2 }    + \\frac{1}{2}\\frac{q_j^3}{p_j^3}\\right ) .",
    "\\label{s3sum}\\end{aligned}\\ ] ] all sums are over the source galaxy index @xmath119 .",
    "note that in the absence of applied shear , and with a circularly symmetric psf , there is no preferred direction in the  plane , and the expectation value of @xmath260 and @xmath261 are all zero",
    ". only @xmath262 , therefore , remains finite in this limit .",
    "the other sums will be at most @xmath263 , although we will retain all terms in case the psf can break the symmetry of the unsheared observations .",
    "the posterior ( [ cubicposterior ] ) is simpler if we rotate to the frame where @xmath264 is real and the covariance matrix is diagonal . if the original @xmath264 has phase @xmath265 , then we set @xmath266 as an aside , we note that if the measurement process ( including psf ) has no preferred direction , then the applied shear  sets the only axis of the system ( which is @xmath216 ) , and a consequence will be that @xmath267 .    at quadratic order , ( [ cubicposterior ] ) implies a gaussian posterior distribution in  with both maximum and mean at @xmath268 and independent errors on the components @xmath269 and @xmath270 of the shear in this rotated frame , equivalent to equations  ( [ barg ] ) and ( [ cg ] ) .",
    "we treat the cubic terms in ( [ cubicposterior ] ) as perturbations to the gaussian by assuming the @xmath271 at any @xmath77 for which the gaussian likelihood is significant .",
    "this approximation can be restated as @xmath272 giving @xmath273 \\exp\\left [ \\frac{-(y - y_0)^2}{2\\sigma^2_y}\\right ] \\left\\ { 1 - \\frac{1}{6 } { \\rm re } \\left [ \\tilde s_1^\\ast ( x+iy )   + \\tilde s_3^\\ast ( x+iy)^3\\right]\\right).\\ ] ] the cubic term shifts the peak of the gaussian posterior slightly , and adds some skew which shifts the expectation value further . the expectation value of shear under this posterior can be integrated to give @xmath274 in each case , the @xmath275 terms in parentheses arise from the skewness imposed on @xmath55 .",
    "omitting them gives the location of the maximum of the posterior .    to obtain some understanding of this result",
    ", we take the case when the mean shear is determined to high accuracy , so the skewness becomes unimportant . since we expect @xmath276 and @xmath277 to be smaller than their @xmath269 counterparts , and",
    "also @xmath278 , the perturbation from cubic terms is expected to be dominated by a shift of the gaussian likelihood to @xmath279 the main effect of the cubic term is therefore a slight shift of the shear posterior toward or away from the origin . we have not verified whether this abbreviated form is sufficiently accurate in cases with anisotropic psfs , so the full form ( [ expectation ] ) should be used .    to summarize , the procedure for estimating the shear using terms to 3rd order in @xmath77 is :    1 .   from the unlensed ellipticity distribution @xmath256 and the shear transformation law , calculate the functions @xmath254 and @xmath255 of @xmath106 defined in equation  ( [ qrs ] ) .",
    "2 .   for each source galaxy @xmath119 , integrate over  as per equations  ( [ cubicpi ] ) to obtain @xmath280 and @xmath281 .",
    "3 .   sum over source galaxies as per equations  ( [ qsum])([s3sum ] ) to get @xmath282 , and @xmath261 .",
    "4 .   rotate by the phase of @xmath264 to diagonalize the covariance matrix of the shear posterior and obtain transformed .",
    "phases of the @xmath283 components are changed and the shear component variances @xmath284 and @xmath285 are obtained as per equations  ( [ cubicrotate ] ) .",
    "the maximum and mean of the quadratic solution in the rotated system are given by equations  ( [ quadraticsoln ] ) .",
    "the perturbation to the expectation value of the posterior due to cubic terms is in equations  ( [ expectation ] ) .",
    "rotate back to original coordinate system .",
    "to implement the bayesian fourier - domain shear technique of section  [ method2 ] , we need to calculate the first two derivatives of the moment vector in with respect to shear for each template galaxy .",
    "it is also helpful to know how these moments change under rotation , translation , and parity transformations , since the symmetries of the unlensed sky suggest that any template galaxy can be replicated with these transformations .",
    "we start by writing the moments generally as @xmath286 @xmath247 is the fourier transform of the pre - seeing galaxy image , and is related to the sky - plane surface brightness @xmath287 by the usual @xmath288 consider a new galaxy image which is an affine transformation of the original image , specified by a linear amplification @xmath289 followed by translation by @xmath290 : @xmath291 standard fourier manipulations give @xmath292 the transformed moments are @xmath293 f_\\alpha\\left [ \\left({\\mbox{$\\bf a$}}^t\\right)^{-1}{\\mbox{\\boldmath $ k$}}\\right ] e^{i{\\mbox{\\boldmath $ k$}}\\cdot{\\mbox{\\boldmath $ x$}}_0}. \\label{momenttransform}\\end{aligned}\\ ] ]      we define a two - component shear @xmath294 of a galaxy image with the flux - conserving transformation @xmath295 it is convenient to adopt a complex notation at this point : @xmath296 with this notation the action of shear @xmath297 becomes @xmath298 can now be restated in the complex notation for the case of a shear transformation : @xmath299 we are interested in the 2 scalar and 2 complex moments defined as @xmath300 the shear derivative operators can be rewritten as @xmath301 now the derivatives of the moments with respect to shear are obtained by applying these operators to the moment definition ( [ momentcomplex ] ) after substituting in the shear wavevector transformation ( [ shearcomplex ] ) . for each moment , the derivatives can be expressed as @xmath302 \\\\ { \\boldsymbol{\\nabla}}_g{\\boldsymbol{\\nabla}}_g m_\\alpha & = \\int d^2k\\ , \\tilde i(k ) \\left [ w(k\\bar k )    c_\\alpha(k )   + w^\\prime(k\\bar",
    "k ) d_\\alpha(k ) + w^{\\prime\\prime}(k\\bar k ) e_\\alpha(k ) \\right ] . \\label{mderivs}\\end{aligned}\\ ] ] table  [ mtable ] summarizes the results of propagating the shear derivatives into our weight and moment functions .",
    "all of the moments and their derivatives are simple weighted polynomial moments of the galaxy fourier transform .                  in our adopted complex notation ,",
    "the effect of rotating the galaxy by angle @xmath216 is to send @xmath347 in the argument of @xmath348 in .",
    "the monopole moments @xmath349 and @xmath197 are unchanged , while the dipole and quadrupole moments @xmath350 and @xmath351 acquire factors @xmath352 and @xmath353 , respectively .",
    "the rotational behavior of all the shear derivatives of the moments can also be easily assessed by applying the phase factors to all powers of @xmath190 and @xmath354 in the elements of table  [ mtable ] .",
    "a parity flip sends @xmath355 for all of the integrands of the moments and their derivatives in table  [ mtable ] .",
    "the moments @xmath350 and @xmath351 are conjugated , meaning that @xmath205 and @xmath203 change sign , while the other moments are unchanged .",
    "a translation of the galaxy by @xmath290 adds a factor @xmath356 to @xmath247 in the integrand of all the moments ( and their derivatives ) . in general the integrations of all the moments and their shear derivatives",
    "would need to be repeated .",
    "we may , however , elect to approximate the effect of translation on the moments and their shear derivatives by linearizing about @xmath357 .",
    "in this case we are interested in @xmath358 , etc .",
    "the derivative of any moment or its derivatives with respect to @xmath359 can be obtained by adding a factor of @xmath360 to all the functions in table  [ mtable ] .",
    "similarly the @xmath361 derivative adds a factor @xmath362 to the integrands .",
    "if we adopt the linearization of the moments with translation , then for each template galaxy we need a substantial number of real - valued quantities : ( 6 moments ) @xmath9 ( 1 moment @xmath191 5 derivatives for  and ) @xmath9 ( 1 value @xmath191 2 translation derivatives ) for a total of 108 numbers per template .",
    "the actual number of integrals we need to perform is much less than this since many elements are repeated in table  [ mtable ] . recall too that these template moments that define the prior only need to be evaluated once for the experiment , and the integrations are expressed as standard linear algebra routines .",
    "evaluation of these quantities will not be a significant computational burden ."
  ],
  "abstract_text": [
    "<S> we derive an estimator of weak gravitational lensing shear from background galaxy images that avoids noise - induced biases through a rigorous bayesian treatment of the measurement . </S>",
    "<S> the derived shear estimator disposes with the assignment of ellipticities to individual galaxies that is typical of previous approaches to galaxy lensing . </S>",
    "<S> shear estimates from the mean of the bayesian posterior are unbiased in the limit of large number of background galaxies , regardless of the noise level on individual galaxies . </S>",
    "<S> the bayesian formalism requires a prior describing the ( noiseless ) distribution of the target galaxy population over some parameter space ; this prior can be constructed from low - noise images of a subsample of the target population , attainable from long integrations of a fraction of the survey field . </S>",
    "<S> we find two ways to combine this exact treatment of noise with rigorous treatment of the effects of the instrumental point - spread function and sampling . </S>",
    "<S> the bayesian model fitting ( bmf ) method assigns a likelihood of the pixel data to galaxy models ( e.g. sersic ellipses ) , and requires the unlensed distribution of galaxies over the model parameters as a prior . the bayesian fourier domain ( bfd ) </S>",
    "<S> method compresses the pixel data to a small set of weighted moments calculated after psf correction in fourier space . </S>",
    "<S> it requires the unlensed distribution of galaxy moments as a prior , plus derivatives of this prior under applied shear . </S>",
    "<S> a numerical test using a simplified model of a biased galaxy measurement process demonstrates that the bayesian formalism recovers applied shears to @xmath0 part in @xmath1 accuracy as well as providing accurate uncertainty estimates . </S>",
    "<S> bfd is the first shear measurement algorithm that is model - free and requires no approximations or _ ad hoc _ assumptions in correcting for the effects of psf , noise , or sampling on the galaxy images . </S>",
    "<S> these algorithms are good candidates for attaining the part - per - thousand shear inference required for hemisphere - scale weak gravitational lensing surveys . </S>",
    "<S> bmf has the drawback that shear biases will occur since galaxies do not fit any finite - parameter model , but has the advantage of being robust to missing data or non - stationary noise . </S>",
    "<S> both bmf and bfd methods are readily extended to use data from multiple exposures and to inference of lensing magnification . </S>"
  ]
}