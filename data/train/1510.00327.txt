{
  "article_text": [
    "or @xmath144  ( @xmath145 ) together with a threshold detector  ( thd ) .",
    "( b )  schematic of alice s on - line measurement when she uses a coherent light source .",
    "alice firstly prepares a strong coherent light , after that she splits it by using a bs with transmittance @xmath146 , and monitors the intensity of the coherent light in mode b with a conventional power meter  ( pm ) .",
    ", width=415 ]    as we have explained in the assumption a1 in the main text , alice needs to estimate the upper and the lower bounds on the vacuum emission probability for each bit value @xmath147 ( @xmath148 and @xmath149 ) in the actual experiments . here",
    ", we propose how to estimate @xmath148 and @xmath149 for the following two particular cases .",
    "( i ) the first case is that alice sends identical pulses when she chooses the same bit value . in this case",
    ", alice performs an off - line measurement for the estimation .",
    "( ii ) the second case is that alice employs a coherent light source . in this case , we employ an on - line monitoring of the intensity of the sending light ( see fig .  1  ( b ) ) .",
    "note that this method can be applied to the case even if the photon number distribution is neither independent nor identical for each of the sending pulses .",
    "the following are the detailed explanations for ( i ) and ( ii ) .",
    "\\(i ) first , we propose a method to estimate @xmath148 and @xmath149 under the case that alice sends identical pulses if she chooses the same bit value _ i.e. , _",
    "@xmath150 is satisfied for any @xmath151 with @xmath152 , where @xmath153 is defined in eq .",
    "( 1 ) in the main text . for later convenience ,",
    "we denote @xmath154 by the state when alice chooses the bit value @xmath155 .",
    "below , we explain how to estimate the bounds on the vacuum emission probability of @xmath154 when alice has a threshold detector .",
    "we consider to perform an off - line measurement to estimate the vacuum emission probability of @xmath154 because the coherence between each photon number state of @xmath156 is destroyed if alice performs an on - line monitoring of the photon number of each pulse . in this measurement , if alice has a threshold detector with unit efficiency and no dark count , it is simple to obtain the bounds on the vacuum emission probability , because the number of the vacuum obtained in the measurement is the same as the number of the vacuum input to the threshold detector . however , actual threshold detectors do not satisfy these conditions , and hence we use the _ detector decoy method _  @xcite for the estimation of the vacuum emission probability of @xmath154 . in this method ,",
    "alice firstly places a beam splitter of transmittance @xmath157 before the threshold detector , and counts the number of events where the vacuum outcome occurred ( this number is denoted by @xmath158 ) among the number of emitted signals from alice s source ( this number is denoted by @xmath159 ) . after obtaining @xmath158",
    ", she repeats the same procedures with a beam splitter of transmittance @xmath144 ( @xmath160 ) , and obtains @xmath161 among @xmath162 ( see fig.1  ( a ) ) . with @xmath163 for @xmath164",
    ", we have the following equation in the limit of asymptotically large @xmath165 : @xmath166 ,    \\label{ddm}\\end{aligned}\\ ] ] where @xmath167 is a povm element that corresponds to no click in the detector . here",
    ", we assume that the povm of the threshold detector with transmittance @xmath168 which contains two elements @xmath169 ( this element corresponds to the click event in the detector ) , and @xmath167 is given by @xmath170 and @xmath171 , where @xmath172 and @xmath173 denote a detection efficiency and a dark count rate , respectively . in eq .",
    "( [ ddm ] ) , @xmath156 can be written as @xmath174 with the fock bases @xmath175 without loss of generality , because the off diagonal elements do not affect the measurement outcomes . by substituting the formulas of @xmath167 and @xmath156 into eq .",
    "( [ ddm ] ) , @xmath163 can be rewritten as @xmath176 note that if we replace @xmath163 with @xmath177 in eq .",
    "( [ condition ] ) by using the hoeffding inequality  @xcite or the multiplicative chernoff bound  @xcite , we can take into the finite - size effect @xmath178 . by using eq .",
    "( [ condition ] ) for @xmath164 , we have that the upper and the lower bounds on the vacuum emission probability are respectively described as @xmath179 and @xmath180    \\(ii ) next , we consider how to estimate @xmath148 and @xmath149 for each bit value @xmath147 when alice employs a coherent light source _ i.e. , _ she knows the photon number distribution of each of the pulses as the poissonian .",
    "note that this method here can be applied to the case even if the photon number distribution is not identical and independent for each of the sending pulses . in order to estimate the vacuum emission probability for the @xmath11 sending pulse ( @xmath103 )",
    ", alice firstly prepares a strong coherent light @xmath181 with @xmath182 , and she splits it by using a beam splitter with transmittance @xmath183 ( @xmath184 ) as @xmath185 .",
    "the light in mode a is the @xmath11 sending light to bob after the phase modulation , and the light in mode b is an on - line monitoring light whose intensity is monitored by a conventional power meter . by this on - line monitoring , she obtains knowledge on the intensity of the coherent light before the beam splitter as @xmath186  ( see fig.1  ( b ) ) for all @xmath18 ( @xmath187 ) .",
    "once alice knows from the monitoring the range of @xmath188 for all @xmath18 , we have that the bounds on the vacuum emission probability of the sending light in mode a are described as @xmath189    in the above estimations ( ( i ) and ( ii ) ) , we have ignored any side - channels on the source _",
    "i.e. , _ we explained the estimation methods for @xmath149 and @xmath148 under the assumption that alice s laboratory is perfectly protected from the environment outside .",
    "however , in the actual implementations , this assumption is not guaranteed because of eve s side - channel attacks such as trojan - horse attacks ( tha )  @xcite .",
    "therefore , in order to certify the assumption a1 in the practical implementations , we need to estimate @xmath149 and @xmath148 including the trojan horse light , and we explain this issue in what follows . in this attack , eve injects a bright light pulse in the coherent state @xmath190 into alice s apparatus through the optical fiber , and she obtains a back - reflected light containing the information on the phase modulator . recently , in order to prevent a particular tha , _ passive architecture method _ was proposed  @xcite . in this method",
    ", alice places an optical isolator , an attenuator , and an optical filter in order to suppress the intensity of the incoming light to her apparatus .",
    "suppose that @xmath191 be the intensity of the back - reflected light from her apparatus , the upper and the lower bounds on the vacuum emission probability ( denoted by @xmath192 and @xmath193 , respectively ) are given by the following modifications to @xmath194 and @xmath195 @xmath196 respectively .",
    "therefore , the vacuum emission probability can be estimated even when the particular trojan horse light affects on the vacuum emission probability .",
    "here , we derive eq .",
    "( 5 ) in the main text , which is the vacuum emission probability of @xmath199 . this",
    "is calculated as @xmath200\\\\ & = ||{}_{\\u{b}}{\\left\\langle 0|\\phi^\\pm_{k } \\right\\rangle}_{\\u{a_n , b}}||^2\\\\    & = \\frac{1}{2\\pm d_{k}}\\big|\\big|    \\sum_{w}\\big(\\sqrt{c^{(k)}_{w,0}}{}_{\\u{b}}{\\left\\langle 0|\\varphi^{(k)}_{w,0 } \\right\\rangle}_{\\u{b } } \\hat{u}^{(k)}_0{| w^{(k)}_0 \\rangle}_{\\u{a_n } } \\pm { } \\sqrt{c^{(k)}_{w,1}}{}_{\\u{b}}{\\left\\langle 0|\\varphi^{(k)}_{w,1 } \\right\\rangle}_{\\u{b } } \\hat{u}^{(k)}_{1}{| w^{(k)}_1 \\rangle}_{\\u{a_n}}\\big)\\big|\\big|^2 .",
    "\\label{p+-deriv}\\end{aligned}\\ ] ] if @xmath201 is chosen such that @xmath202 becomes parallel to @xmath203 , and the inner product of these two states becomes positive , eq .",
    "( [ p+-deriv ] ) leads to @xmath204 , where we use @xmath205 = \\big|\\sum_{w}\\sqrt{c^{(k)}_{w , a_k}}{}_{\\u{b}}{\\left\\langle 0|\\varphi^{(k)}_{w , a_k } \\right\\rangle}_{\\u{b}}\\big|^2 $ ] .",
    "here , we derive eq .  ( 10 ) in the main text , which is the upper bound on @xmath94 when @xmath110 occurs for some or every @xmath18 . in so doing ,",
    "we construct a stochastic trial . for this",
    ", we introduce the random variable for the @xmath207 trial @xmath208 as @xmath209 here , @xmath99 corresponds to the number of those instances with @xmath110 among the @xmath75 pulses . as explained in the assumption a1 , since alice does not know the exact probabilities of emitting the vacuum state for both bits , @xmath99 can not be obtained in the actual experiments .",
    "what alice knows about @xmath99 is just a range , which @xmath99 lies in : @xmath210 now , to obtain the upper bound on @xmath94 , we use the chernoff bound  @xcite . from this inequality , @xmath211\\leq \\epsilon \\label{chernoff}\\end{aligned}\\ ] ] is obtained for any @xmath212 $ ] , where @xmath213 . here , the parameter @xmath101 is given by @xmath214 ,   \\label{epsilon}\\end{aligned}\\ ] ] where @xmath215 .",
    "( [ chernoff ] ) means that @xmath216 holds with the probability @xmath217 . here",
    ", @xmath218 represents the probability that alice s @xmath64 basis measurement outcome on the @xmath119th virtual qubit is @xmath76 conditioned on the vacuum emission .",
    "this is calculated by using eq .",
    "( 5 ) in the main text and eq .  ( [ rv ] ) as @xmath219 finally , by considering the upper bound on eq .",
    "( [ fraction ] ) , we obtain the upper bound on eq .",
    "( [ resultchernoff ] ) as @xmath220 where the maximization of @xmath99 is taken over the constraint in eq .",
    "( [ n_vac ] ) .",
    "as we have explained on page 1 in the main text , when alice has more detailed characteristics of the source , we can relax the assumption * a3 * to accommodate any classical correlations among the sending states .",
    "in general , a classically correlated @xmath0-pulse state when alice chooses an @xmath0-bit string as @xmath221 is expressed as @xmath222 here , @xmath16 ( @xmath103 ) denotes the parameter to determine the @xmath11 sending state .",
    "@xmath12 denotes a probability distribution to determine the realization of the @xmath0-pulse state @xmath223 , and we do not need to characterize @xmath12 except for the normalization condition @xmath13 . in order to accommodate the classical correlations , alice needs to guarantee that the following two conditions are satisfied for any realizations @xmath224 ( @xmath225 denotes an internal parameter of alice s source to determine the realization of the @xmath0-pulse state ) .",
    "the two conditions are ( i ) the upper bound on the number of photons contained in the state @xmath223 except for a probability @xmath8 , and ( ii ) the upper and the lower bounds on the vacuum emission probability of each pulse @xmath226 for both bits @xmath227 .    as an example of satisfying the conditions ( i ) and ( ii )",
    ", here we consider the case where alice knows that the sending @xmath0 pulses are coherent states for any @xmath225 , and the mean photon number of all the sending states for alice s choice of the bit @xmath228 lies in the range @xmath229 $ ] .",
    "for deriving the phase error rate , we introduce a virtual protocol , which is the same as the actual protocol from eve s viewpoint . in this protocol , before sending the @xmath0-pulse state to bob , alice randomly chooses a particular realization of the sending states in the tensor product state according to the probability distribution @xmath230 , and let @xmath231 denote the phase error rate for the @xmath0-pulse state with the realization @xmath225 . from the convexity structure of eq .",
    "( [ separable ] ) , the phase error rate of @xmath232 can be written as @xmath233 and from eq .",
    "( [ coherentphase ] ) , we trivially obtain the following inequality @xmath234 below , we first derive @xmath235 , and then we consider the upper bound on the r.h.s of eq .",
    "( [ coherentphaseerror ] ) . in order to derive @xmath235 , we use eq .",
    "( [ eph2 ] ) , and obtain the upper bound on @xmath231 as @xmath236 where @xmath237 denotes the number of photons contained in the state @xmath238 , and from eq .",
    "( [ resultnvac2 ] ) , @xmath239 in eq .",
    "( [ ephxi ] ) is given by @xmath240 where @xmath241 and @xmath98 .",
    "@xmath242 denotes the upper ( lower ) bound on the vacuum emission probability among the @xmath0-pulse state for the bit value @xmath228 conditioned that the internal parameter of alice s source takes the value of @xmath225 .",
    "the upper bound on @xmath235 , which is also the upper bound of @xmath55 , can be readily obtained by taking the upper bound on @xmath243 as @xmath244 here , @xmath245 is the maximal number of photons contained in the @xmath0 pulses over all @xmath225 , which is determined such that @xmath246 holds for @xmath247 denoting @xmath248 , and the maximization of @xmath249 is taken over the range @xmath250 .",
    "99 c. h. bennett and g. brassard , in _ proceedings of ieee international conference on computers , systems , and signal processing _ ( ieee , new york , 1984 ) , pp . 175179 .",
    "a. k. ekert , phys .",
    "lett . * 67 * , 661 ( 1991 ) . c. h. bennett , phys .",
    ". lett . * 68 * , 3121 ( 1992 ) .",
    "d. bru , phys .",
    "lett . * 81 * , 3018 ( 1998 ) .",
    "k. inoue , e. waks , and y. yamamoto , phys .",
    "* 89 * , 037902 ( 2002 ) .",
    "v. scarani _ et al _ , phys .",
    "lett . * 92 * , 057901 ( 2004 ) .",
    "n. gisin , g. ribordy , h. zbinden , d. stucki , n. brunner , and v. scarani , arxiv : quant - ph/0411022 . s. l. braunstein and p. van loock , rev . mod . phys . * 77 * , 513 ( 2005 ) . c. weedbrook _ et al _ , rev .",
    "phys . * 84 * , 621 ( 2012 ) .",
    "p. w. shor and j. preskill , phys .",
    "lett . * 85 * , 441 ( 2000 ) .",
    "lo , arxiv : quant - ph/0102138 . k. tamaki , m. koashi , and n. imoto , phys .",
    "lett . * 90 * , 167904 ( 2003 ) .",
    "c . boileau _",
    "et al _ , phys .",
    "lett . * 94 * , 040503 ( 2005 ) .",
    "k. tamaki and h .- k .",
    "lo , phys .",
    "a * 73 * , 010302(r ) ( 2006 ) .",
    "m. koashi _",
    "et al _ , arxiv:0804.0891 .",
    "k. wen , k. tamaki , and y. yamamoto , phys .",
    "lett . * 103 * , 170503 ( 2009 ) .",
    "m. tomamichel _",
    "et al _ , nature commun . * 3 * , 634 ( 2012 ) .",
    "k. tamaki , g. kato , and m. koashi , arxiv:1208.1995v1 .",
    "t. moroder _",
    "et al _ , phys .",
    "lett . * 109 * , 260501 ( 2012 ) .",
    "et al _ , nature photon . *",
    "9 * , 163 - 168 ( 2015 ) .",
    "t. sasaki , y. yamamoto , and m. koashi , nature * 509 * , 475 ( 2014 ) .",
    "et al _ , arxiv:1505.02481v1 .",
    "h. takesue _ et al _ , nature photon .",
    "* 9 * , 827 - 831 ( 2015 ) .",
    "et al _ , phys . rev .",
    "* 114 * , 180502 ( 2015 ) . y .-",
    "et al _ , arxiv:1505.08142 .",
    "et al _ , nature photon . *",
    "9 * , 832 - 836 ( 2015 ) .",
    "m. tomamichel , and a. leverrier , arxiv:1506.08458 .",
    "et al _ , phys .",
    "a * 77 * , 042311 ( 2008 ) .",
    "lo , m. curty , and b. qi , phys .",
    "lett . * 108 * , 130503 ( 2012 ) .",
    "et al _ , nature commun . * 5 * 3732 ( 2014 ) .",
    "k. tamaki _",
    "et al _ , phys .",
    "a * 90 * , 052314 ( 2014 ) .",
    "+ a. mizutani _ et al _ , new j. phys .",
    "* 17 * , 093011 ( 2015 ) .",
    "m. lucamarini _",
    "et al _ , phys .",
    "x * 5 * , 031030 ( 2015 ) .",
    "et al _ , phys .",
    "a * 88 * , 062322 ( 2013 ) .",
    "et al _ , phys .",
    "a * 73 * , 022320 ( 2006 ) .",
    "m. koashi , arxiv:0505108 .",
    "r. renner , security of quantum key distribution , ph.d .",
    "thesis , eth zurich ( 2005 ) .",
    "d. gottesman _ et al _ , quantum inf .",
    "comput . * 4 * , 325 ( 2004 ) .",
    "h. chernoff , ann .",
    "math . sat . *",
    "23 * , pp.493 - 507 ( 1952 ) .",
    "et al _ , phys .",
    "a * 92 * , 032305 ( 2015 ) .",
    "et al _ , new j. phys . *",
    "16 * , 123030 ( 2014 ) .",
    "note that the phase of the coherent light needs not be randomized .",
    "t. moroder , m. curty , and n. l@xmath251tkenhaus , new j. phys .",
    "* 11 * , 045008 ( 2009 ) .",
    "w. hoeffding , j. amer .",
    "* 58 * ( 301 ) , 13 - 30 ( 1963 ) ."
  ],
  "abstract_text": [
    "<S> recently , a new type of quantum key distribution , called the round - robin differential - phase - shift ( rrdps ) protocol [ nature 509 , 475 ( 2014 ) ] , was proposed , where the security can be guaranteed without monitoring any statistics . in this paper </S>",
    "<S> , we investigate source imperfections and side - channel attacks on the source of this protocol . </S>",
    "<S> we show that only three assumptions are needed for the security , and no detailed characterizations of the source or the side - channel attacks are needed . </S>",
    "<S> this high robustness is another striking advantage of the rrdps protocol over other protocols .    </S>",
    "<S> quantum key distribution ( qkd ) enables two distant parties ( alice and bob ) to generate a key , which is secret from any eavesdropper ( eve ) . since the invention of the first qkd protocol , bennett brassard 1984 protocol  @xcite , </S>",
    "<S> there have been proposed many qkd protocols for both discrete variable protocols  @xcite and continuous variable protocols  @xcite . </S>",
    "<S> one of the most important tasks in the security proof is to derive an upper bound on the information leakage to eve . </S>",
    "<S> conventionally , it has been believed that the information leakage can be estimated by monitoring some statistics by alice and bob during the quantum communication part of the qkd protocol   @xcite . </S>",
    "<S> recently , a new type of protocol , the round - robin differential - phase - shift ( rrdps ) protocol  @xcite was proposed and surprisingly , the information leakage of this protocol is estimated without any monitoring , but it depends only on the state prepared by alice . </S>",
    "<S> this property leads to some practical advantages , such as the better tolerance on the bit error rate and the fast convergence in the finite key regime  @xcite . </S>",
    "<S> this protocol has attracted intensive attentions from theoretical works  @xcite , and proof - of - principle experiments have been demonstrated  @xcite .    in practice , there are some issues to be addressed to guarantee the security of the rrdps protocol when it is actually implemented . </S>",
    "<S> these issues arise because there is a gap between the properties of the actual devices used in qkd systems and the mathematical model that the security proofs assume , which is also the case for all qkd protocols . </S>",
    "<S> therefore , to bridge this gap is crucial for the implementation security , and many works have been devoted in this direction  @xcite . in the case of the rrdps protocol , all the security analyses including the original proof  @xcite and the recent works  @xcite have made ideal assumptions on alice s light source ( for instance , phase modulations are assumed to be perfect and any side - channel attacks are excluded ) . therefore , to consider the security proof accommodating source flaws is indispensable toward a practical and secure implementation of the rrdps protocol .    in this paper , we extend the security proof of  @xcite to accommodate the source flaws . </S>",
    "<S> surprisingly , we found that the security can be guaranteed based only on the three assumptions on alice s source . </S>",
    "<S> these assumptions are on the probability of emitting the vacuum state , on the probability that @xmath0 light pulses contain more than a particular number of photons , and on the independence among the sending states . </S>",
    "<S> importantly , no assumptions on the phase modulation or detailed specifications of imperfections and side - channel attacks on the source are needed . even with these imperfections and side - channels , </S>",
    "<S> we show that the rrdps protocol can distribute the key over longer distances . </S>",
    "<S> these results show that the rrdps protocol is highly robust against the source flaws , which is another striking advantage of this protocol over other protocols .    before explaining the security of the rrdps protocol with the flawed sources , we summarize the assumptions we made on the devices . </S>",
    "<S> first , as for alice s side , she employs blocks of @xmath0 light pulses , and applies phase modulation @xmath1 ( @xmath2 ) to each of the pulses depending on a randomly chosen bit @xmath3 . </S>",
    "<S> the assumptions on alice s sending states are summarized as follows . </S>",
    "<S> + * a1*. for every light pulse , the probability of the vacuum emission for the bit value @xmath4 is upper and lower bounded by @xmath5 and @xmath6 , respectively ( see section 1 in the supplementary material for the discussions on the estimation of these bounds for some experimental setups ) . + </S>",
    "<S> * a2*. the @xmath0 pulses contain in total at most @xmath7 photons except for the probability @xmath8 . + </S>",
    "<S> * a3*. there is no quantum and classical correlation among the sending states , and the system that purifies each of the sending states is possessed by alice .    </S>",
    "<S> we note that when more detailed characteristics of the source is available , we can relax the assumption * a3 * to accommodate any classical correlations among the sending pulses . in general , </S>",
    "<S> a classically correlated @xmath0-pulse state is written as @xmath9 , where @xmath10 denotes an internal parameter in the source to decide the @xmath11-pulse state . here </S>",
    "<S> , the probability distribution @xmath12 can be arbitrary as long as it satisfies @xmath13 . </S>",
    "<S> if alice knows the upper and the lower bounds on the vacuum emission probability of the state @xmath14 and the upper bound on the probability that the photon number contained in @xmath15 exceeds a certain threshold for any realization of @xmath16 ( @xmath17 ) , then we can prove the security even if the pulses are classically correlated in any manner . </S>",
    "<S> as an example of such a case , we discuss the security when each of the sending pulse is in a coherent state for any @xmath16 and for any @xmath18 ( see section 4 in the supplementary material for more detail ) . in the following discussion </S>",
    "<S> , we assume that alice has no knowledge about such detailed characterizations , and we prove the security based only on the assumptions * a1 * , * a2 * and * a3*.    we emphasize that we do not make any assumptions on phase modulations . </S>",
    "<S> obviously , in order to generate a secret key , @xmath19 and @xmath20 need to be controlled such that the resulting bit error rate is low enough . </S>",
    "<S> however , for the security proof , this precise control over the phase modulation is not needed : our security proof holds not only when the actual value of phase modulations @xmath21 do not coincide with @xmath22 , but also when alice has no knowledge about @xmath19 and @xmath20 . </S>",
    "<S> the assumption * a2 * requires that @xmath23\\leq e_{\\u{src}}$ ] must be satisfied , where @xmath24 denotes the number of photons included in the @xmath11 pulse , which would be obtained if we measured it , and the l.h.s represents the probability that the total photon number existing in the @xmath0 pulses exceeds @xmath7 . </S>",
    "<S> we also emphasize that we do not make the single - mode assumption on the pulse , and the mode can depend on the bit value . </S>",
    "<S> this includes , for instance , the following cases : ( 1 ) the polarization of the pulse depends on the chosen bit value and ( 2 ) eve performs a trojan - horse - attack ( tha )  @xcite , where she injects a strong light pulse to alice s source to obtain some information on the source from the back - reflected pulse .    from the assumption of the independence among the sending states described in * a3 * , </S>",
    "<S> the @xmath11 sending state is expressed as a partial trace over the system @xmath25 of the following state @xmath26 , where @xmath27 are non - negative real numbers satisfying @xmath28 , @xmath29 is an arbitrary unitary operator on the system @xmath25 , @xmath30 are orthonormal bases of the ancilla system , and @xmath31 are orthonormal bases to diagonalize the density operator of the sending state @xmath32 note that the system @xmath25 that purifies each of the sending states is possessed by alice . </S>",
    "<S> then , for each trial , alice sends @xmath33 to bob over the quantum channel . </S>",
    "<S> note that in the original protocol  @xcite , alice sends @xmath34 in each trial , where @xmath35 is the number operator for the @xmath11 pulse , and @xmath36 is the @xmath0-pulse state ( contains at most @xmath7 photons ) before performing a perfect phase modulation ( @xmath37 ) .    </S>",
    "<S> as for the assumptions on bob s side , they are the same as those made in the original security proof  @xcite , that is , bob uses detectors that can discriminate among the vacuum , a single - photon , and multi photons , and bob has a random number generator ( rng ) . using devices with these assumptions , we describe bob s actual procedures in what follows . note that bob s actual procedures are the same as those in the original protocol  @xcite . </S>",
    "<S> bob first splits @xmath0 incoming pulses into two trains of pulses , shifts backwards only one train by @xmath38 that is chosen randomly from @xmath39 . then bob lets each of the first @xmath40 pulses in the shifted train interfere with each of the last @xmath40 pulses in the other train with a 50:50 beam splitter , and performs a photon measurement with the two detectors . </S>",
    "<S> each of these detectors corresponds to the bit value of 0 and 1 , respectively . </S>",
    "<S> bob takes note of the bit value when he observes a single - photon in the original @xmath0 pulses in total , and otherwise he discards the data . also </S>",
    "<S> , he records in which time slot he obtained the single - photon , and he announces this time slot and @xmath38 over the classical channel . from those information , alice obtains a sifted key @xmath41 , where @xmath42 denotes the time slot of the single - photon detection . </S>",
    "<S> bob repeats this process for many blocks containing @xmath0 pulses .    under the assumptions listed above </S>",
    "<S> , we prove the security of the rrdps protocol with the source flaws . </S>",
    "<S> we note that , for simplicity of the analysis , we consider that the number of blocks containing @xmath0 pulses sent is asymptotically large . in the proof , we construct a virtual protocol that can not be distinguished from the actual protocol from eve s viewpoint . in this virtual protocol </S>",
    "<S> , alice first prepares her virtual qubit vira , ancilla qubits and system b in the following state @xmath43 and sends only system b to bob over the quantum channel . here , this state is in the tensor product due to the assumption * a3 * , and we define @xmath44 as the @xmath45 basis state .    </S>",
    "<S> next , we explain bob s measurement procedures for the virtual protocol . as explained above , in the actual protocol , bob performs an interference measurement on @xmath46 and @xmath47 pulses , where a difference of @xmath48 and @xmath49 is randomly chosen by bob s rng ( _ i.e. , _ </S>",
    "<S> @xmath50 ) . in the virtual protocol , </S>",
    "<S> however , bob does not perform such an interference measurement , but performs the measurement to determine which pulse contains a single - photon among the incoming @xmath0 pulses . in this virtual measurement , </S>",
    "<S> the index @xmath48 is determined by the location of the single photon ( @xmath51 ) , and the other index @xmath49 is determined as @xmath52 where @xmath38 is randomly chosen from the rng , and @xmath53 is randomly chosen from 0 or 1 by bob . after obtaining the pair @xmath54 , he announces @xmath54 to alice over the classical channel . note that eve has a perfect control over @xmath48 because she can freely choose which pulse contains a single - photon , but she can not control @xmath49 at all because @xmath49 contains the randomness bob locally chooses . the reason why bob can choose @xmath49 as eq .  </S>",
    "<S> ( [ randomj ] ) is that the probability distributions of obtaining @xmath48 and @xmath49 if bob postselects the successful detection event ( _ i.e. , _ only a single - photon is detected from the @xmath0 pulses ) are exactly the same for both actual and virtual protocols for any eavesdropping  @xcite . </S>",
    "<S> this means that the classical information available to eve is the same between the two protocols . </S>",
    "<S> therefore , combined with the equivalence between the virtual and actual protocols in alice s side , we are allowed to discuss the security based on the virtual protocol . in the virtual protocol , alice keeps all the @xmath0 virtual qubits and the ancilla qubits when bob obtains the successful detection .    </S>",
    "<S> the quantity we use to measure the leaked information is the so - called phase error rate  @xcite , which is related with the smooth max - entropy  @xcite . with the phase error rate @xmath55 , the key rate per transmission of one pulse </S>",
    "<S> is expressed as  @xcite @xmath56/l,\\end{aligned}\\ ] ] where @xmath57 denotes the single - photon detection probability in bob s measurement , @xmath58 is an error correction efficiency , and @xmath59 denotes the bit error rate in the protocol and @xmath60 as the binary entropy function . here , @xmath61 represents the fraction of bits to be shortened in the privacy amplification step . </S>",
    "<S> once the sifted bits are shortened according to this fraction , the phase error information that eve used to have becomes totally useless for her guessing the generated key .    </S>",
    "<S> our goal below is to estimate the upper bound on the phase error rate . for the estimation , we need to define the phase error rate , but before we give its definition , it is convenient to rewrite eq .  </S>",
    "<S> ( [ virstate ] ) as @xmath62,$ ] where we define @xmath63 as the @xmath64 basis state , + @xmath65 and @xmath66 . here , </S>",
    "<S> . stands for complex conjugate . </S>",
    "<S> the key parameter in the security proof is the vacuum emission probability of @xmath67 , which is defined by @xmath68 and given by ( see section 2 in the supplementary material for the detail ) @xmath69 here @xmath70 and @xmath71 denote the vacuum emission probabilities of @xmath72 and @xmath73 , respectively . in the virtual protocol , </S>",
    "<S> alice s task is to guess the outcome of the @xmath64 basis measurement on the @xmath74 virtual qubit . </S>",
    "<S> the position of the @xmath74 virtual qubit is randomly chosen from the @xmath75 virtual qubits according to eq .  </S>",
    "<S> ( [ randomj ] ) . </S>",
    "<S> then , the phase error rate is defined as a fraction that alice obtains the measurement outcome @xmath76 in her @xmath64 basis measurement on her @xmath74 virtual qubit that is randomly chosen from the @xmath75 virtual qubits . in the phase error rate estimation , </S>",
    "<S> we consider the worst case scenario that if the total photon number contained in the @xmath0 pulses exceeds @xmath7 , bob surely detects such an event as a successful detection , and alice obtains the measurement outcome @xmath76 on her @xmath74 virtual qubit . by combining this worst case scenario and thanks to the randomness of @xmath49 from eq .  </S>",
    "<S> ( [ randomj ] ) , the phase error rate is given by @xmath77 where @xmath78 denotes the number of the virtual qubits resulted in the measurement outcome of @xmath76 among the @xmath75 virtual qubits .    in the following , </S>",
    "<S> we explain how to estimate the upper bound on @xmath78 . here , we use the fact that the statistics of the @xmath64 basis measurement on the system vira is not affected by any operations conducted on the system b. therefore , in order to estimate the upper bound on @xmath78 , we are allowed to perform the photon number measurement ( pnm ) on all the @xmath75 sending pulses in system b in eq .  </S>",
    "<S> ( [ virstate ] ) . </S>",
    "<S> this pnm is an off - line measurement , and is not performed in either of the actual and virtual protocols . </S>",
    "<S> let us denote by @xmath79 and @xmath80 the outcome of the pnm of the @xmath81 @xmath82 sending pulse and the @xmath64 basis measurement outcome performed on alice s @xmath81 virtual qubit , respectively . </S>",
    "<S> from these measurement results @xmath83 , we estimate the upper bound on @xmath78 . for the later convenience , </S>",
    "<S> we decompose @xmath78 into @xmath84 where @xmath85 denotes the number of @xmath86 that satisfies @xmath87 and @xmath88 .    </S>",
    "<S> now , we calculate the upper bound on eq .  </S>",
    "<S> ( [ defeph2 ] ) . </S>",
    "<S> first , we consider to upper bound @xmath89 . in so doing , we consider two worst case scenarios . </S>",
    "<S> the first worst case scenario is that if the @xmath81 sending state includes more than zero - photon ( _ i.e. , _ </S>",
    "<S> @xmath90 ) , we regard @xmath91 as @xmath76 . </S>",
    "<S> the second one is that @xmath7 photons are distributed over the @xmath75 pulses such that the number of pulses that contain no photon is minimized . with these two worst case scenarios , </S>",
    "<S> @xmath89 is upper bounded by @xmath92 where @xmath93 denotes the number of @xmath86 that satisfies @xmath90 among the @xmath75 pulses . in eq .  </S>",
    "<S> ( [ anu ] ) , the first and the second inequalities are due to the first and the second worst case scenarios , respectively .    </S>",
    "<S> next , we show the upper bound on @xmath94 , which is given by ( see section 3 in the supplementary material for the detail ) @xmath95 @xmath96 where @xmath97 and @xmath98 . </S>",
    "<S> note that @xmath99 and @xmath100 are related with a failure probability @xmath101 ( see eq .  </S>",
    "<S> ( 17 ) in the supplementary material ) of the chernoff bound  @xcite . </S>",
    "<S> below , we explain the above results in more detail .    </S>",
    "<S> \\(i ) the first case is that @xmath102 is satisfied for all @xmath18 ( @xmath103 ) . from eq .  </S>",
    "<S> ( [ p+- ] ) , we obtain @xmath104 , and hence @xmath105 . </S>",
    "<S> this means that if @xmath106 , @xmath107 is @xmath108 and never be @xmath76 . by combining the results in eqs .  </S>",
    "<S> ( [ anu ] ) and ( [ resultnvac1 ] ) , the phase error rate is upper bounded by @xmath109 note that this upper bound is exactly the same as the one in the original security proof  @xcite .    </S>",
    "<S> \\(ii ) the second case is that @xmath110 occurs for some or every @xmath18 . </S>",
    "<S> first , we give an example of how this situation arises . </S>",
    "<S> suppose that eve performs a tha where she injects a strong pulse to alice s source to obtain some information on the source from the back - reflected light . to prevent this tha </S>",
    "<S> , alice needs to suppress the intensity of the back - reflected light , which can be accomplished by installing some optical filters or optical isolators  @xcite . </S>",
    "<S> however , one can not perfectly suppress the intensity , and moreover optical components , such as phase modulators , may have polarization dependence  @xcite , which leads to the situation of @xmath111 . </S>",
    "<S> this means that even if @xmath106 , we can not conclude @xmath112 . </S>",
    "<S> therefore , @xmath94 results in a non - zero value , and @xmath55 is increased compared with the one in the case  ( i ) . in the case  </S>",
    "<S> ( ii ) , by combining eqs . ( </S>",
    "<S> [ anu ] ) and ( [ resultnvac2 ] ) , the phase error rate can be obtained as @xmath113 here , we define @xmath114 .    </S>",
    "<S> we emphasize that the phase error rate given in eqs .  </S>",
    "<S> ( [ eph1 ] ) and ( [ eph2 ] ) are derived only from the three assumptions : * a1 , a2 * and * a3*. this property is one of the striking features of the rrdps protocol because other protocols usually need more detailed specifications of imperfections  @xcite and eve s side - channel attacks on the source  @xcite . in particular , </S>",
    "<S> the practical qkd systems are threatened by the tha  @xcite , and the recent work quantitatively shows that the key generation rate of the bb84 protocol is compromised by this attack  @xcite . </S>",
    "<S> more specifically ,  @xcite shows that when the mean photon number of the back - reflected light is @xmath115 , the achievable distance of the secure key generation is decreased down to only 10 km , while it is about 150 km without the tha . </S>",
    "<S> the reason for this drastic degradation is that the phase error rate is exponentially increasing with the distance  @xcite . in the rrdps protocol , however , even if eve performs the tha with @xmath115 , the increase of @xmath7 is only about @xmath116 . </S>",
    "<S> therefore , the increase of @xmath55 ( _ e.g. , _ </S>",
    "<S> @xmath117 ) is about @xmath118 regardless of the distance , implying that only small amount of the additional privacy amplification is needed . </S>",
    "<S> this shows the robustness that the rrdps has against the side - channel attacks on the source .     per pulse versus distances @xmath119 . </S>",
    "<S> the solid line is for the case  ( i ) : @xmath120 is satisfied for all @xmath18 , and the dashed line is for the case  ( ii ) : @xmath121 occurs for some or every @xmath18.,width=264 ]    based on the above security proof , we show the key generation rate simulation results for the cases  ( i ) and ( ii ) . in the simulation </S>",
    "<S> , we assume that alice uses a weak coherent light source with the mean photon number @xmath122 when she chooses the bit 0(1 )  @xcite . </S>",
    "<S> we set the channel transmittance as @xmath123 . in the detection side </S>",
    "<S> , we assume the detection efficiency and the dark count probability as @xmath124 and @xmath125 , respectively . with these parameters , the successful detection probability that bob detects the single - photon and the bit error rate are assumed to be given by @xmath126 and @xmath127 , respectively . </S>",
    "<S> here , @xmath128 , and @xmath129 is an overall misalignment error of the optical system , and we assume that @xmath129 is 5% . </S>",
    "<S> also , we set @xmath58 as 1.16 .    </S>",
    "<S> first , we show the simulation result for the case  ( i ) . in this case , the mean photon number for both bits are the same @xmath130 . under the above conditions , we plot the key rate @xmath131 with @xmath132 by the solid line in fig . </S>",
    "<S> 1 , where @xmath131 is optimized over the choice of @xmath133 and @xmath7 through the relation @xmath134 .    next , we show the simulation result for the case  ( ii ) . </S>",
    "<S> we assume that @xmath135 lies in the range @xmath136 $ ] . in this case , the upper and the lower bounds on @xmath137 are given by @xmath138 ( @xmath139 ) and @xmath140 ( @xmath141 ) , respectively . under these conditions , we plot the key rate @xmath131 with @xmath132 by the dashed line in fig . </S>",
    "<S> 1 , where @xmath131 is optimized over the choice of @xmath142 , @xmath7 and @xmath101 through the relation @xmath143 . </S>",
    "<S> this dashed line shows that even if @xmath110 occurs for some or every @xmath18 , the degradation of the key generation rate is not so compromised . </S>",
    "<S> this result also shows the robustness of the rrdps protocol against source flaws .    to conclude </S>",
    "<S> , we have shown the security of the rrdps protocol with imperfect light sources and side - channel attacks on alice s source . in our security analysis , </S>",
    "<S> the characterization of alice s source is simple in the sense that if alice monitors only @xmath7 , the vacuum emission probability and the independence among the sending states , the amount of privacy amplification needed can be obtained . </S>",
    "<S> this means that the security of the rrdps protocol can be guaranteed without detailed specifications of the source imperfections and side - channel attacks on the source . </S>",
    "<S> moreover , we found that if the probabilities of emitting the vacuum state are the same for both bits , the phase error rate is exactly the same as the one in the original paper  @xcite . </S>",
    "<S> even if these probabilities differ , the performance of the key generation rate is not significantly compromised . </S>",
    "<S> these results show that the rrdps protocol is highly robust against imperfections and side - channel attacks on the source , which is another practical advantage that this protocol has over other protocols .    </S>",
    "<S> the authors thank h .- k . </S>",
    "<S> lo , m. koashi , h. takesue , t. sasaki , t. yamamoto , k. azuma , l. qian , r. ikuta , s. kawakami and g. kato for fruitful discussions . </S>",
    "<S> am and ni acknowledge support from the jsps grant - in - aid for scientific research(a ) 25247068 . </S>",
    "<S> this work was in part funded by impact program of council for science , technology and innovation ( cabinet office , government of japan ) . </S>"
  ]
}