{
  "article_text": [
    "recent research efforts have examined the protocol parameters of popular swarming peer - to - peer content distribution systems , in order to identify their impact on system performance and robustness .",
    "such efforts have mainly focused on the protocol algorithms that are believed to be the major factors affecting system behavior , such as bittorrent s piece and peer selection strategies  @xcite .    however , the actual manner by which peers form connections and the overlay is constructed has been largely overlooked .",
    "as shown by urvoy _",
    "et al . _",
    "@xcite , the time needed to distribute content in bittorrent is directly affected by the overlay topology . moreover , ganesh _ et al . _",
    "@xcite evaluated the impact of the overlay structure on the spread of epidemics , which can be viewed as a special case of robustness in peer - to - peer file replication . to the best of our knowledge",
    ", there has been no study that specifically investigated optimal overlay construction strategies for content replication .    in this paper , we evaluate two such strategies in the bittorrent protocol .",
    "we first present and evaluate the _ tracker strategy _ , which most bittorrent implementations use by default to guide new connection establishment .",
    "we identify a concrete shortcoming , namely the strategy s tendency to cause peer clustering and potential network partitions , which might have an adverse impact on system robustness . to address this",
    ", we introduce an alternative , the _ preemption strategy _ , which dictates giving preference to certain new peer connection requests .",
    "we evaluate the properties of overlays generated by both strategies using extensive simulations , focusing on flash crowd scenarios , when the system is under high load and more vulnerable to churn .    indeed ,",
    "the flash crowd phase as it is the most critical phase for a torrent , as there is a single seed . in case some peers become disconnected from this initial seed , they will experience a much higher download completion time .",
    "moreover , a poorly structured overlay may result in a slower propagation of the pieces , thus a lower overall performance .",
    "however , in this study , we focus on the overlay property rather than on its impact on performance .    based on our results ,",
    "we identify the _ maximum number of outgoing connections _ as a parameter that significantly affects the structure and properties of the generated overlay .",
    "this parameter is currently used in bittorrent to enforce a hard upper limit on the number of connections a peer can initiate .",
    "we define metrics that characterize the overlay structure , and compute these metrics for various values of the number of maximum outgoing connections per peer .",
    "the contributions of this work include the following .    1 .",
    "we show that , for the default bittorrent overlay construction strategy , there is no single value of the maximum number of outgoing connections that optimizes all considered metrics .",
    "in addition , a value between @xmath0 and @xmath1 clearly offers a better choice than the usual default value of @xmath2 .",
    "we also show that our proposed preemption strategy outperforms the default one for all metrics . for this strategy ,",
    "a maximum number of outgoing connections that is simply equal to the maximum peer set size ( number of neighbors ) presents the best choice . as a result , our proposed strategy , while simple and easy to implement , removes the need to set the maximum number of outgoing connections in an ad - hoc manner , thereby simplifying the protocol .",
    "the rest of this paper is organized as follows . in section  [ sec : terminology ] we define the terms we use .",
    "we present the tracker and preemption strategies in section  [ sec : strategies ] .",
    "section  [ sec : methodology ] then describes our experimental methodology , while our results on the properties of overlays generated with both strategies are presented in section  [ sec : results ] .",
    "section  [ sec : related ] describes related work , and we conclude and outline future work in section  [ sec : conc ] .",
    "in this section , we present the terms used to describe the bittorrent overlays .",
    "* peer set : * each peer maintains a list of other peers to which it has open tcp connections .",
    "this list is called the peer set , also known as the neighbor set .",
    "neighbor _ of peer @xmath3 is a peer that belongs to @xmath3 s peer set .",
    "* maximum peer set size : * the upper limit on the number of peers that can be in the peer set .",
    "it is a configuration parameter of the protocol .    *",
    "average peer set size : * a torrent - wide metric calculated by summing up the peer set size for each peer in the torrent , and dividing by the total number of peers .",
    "* incoming and outgoing connections : * when a peer @xmath4 initiates a tcp connection to peer @xmath5 , we say that @xmath4 has an _ outgoing _ connection to @xmath5 , and that @xmath5 has accepted an _ incoming _ connection from @xmath4 .",
    "note that all connections are really bidirectional , they are just flagged as incoming or outgoing .",
    "this flag has no impact on the actual data transfer , however , it is used to decide whether a new outgoing connection can be established , as explained in section  [ sec : bittorrent - overview ] .    *",
    "maximum number of outgoing connections : * the upper limit on the number of outgoing connections a peer can establish .",
    "this is a configuration parameter of the protocol .",
    "we first present the overlay construction strategy bittorrent follows , then propose an alternative based on preempting existing connections .      a piece of content to be distributed with bittorrent is first divided into multiple pieces .",
    "a _ metainfo file _ is then created by the content provider , which contains all the information necessary for the download , including the number of pieces , hashes that are used to verify the integrity of received data , and the ip address and port number of the tracker . to join a torrent ,",
    "a peer retrieves the metainfo file out of band , usually from a well - known web site .",
    "@xmath3 then contacts the tracker who returns a random subset of other peers already participating in the download ; we call this subset the _ initial peer set_. a typical number returned by many tracker implementations is @xmath6 , which is also what we use for our simulations .    after receiving this initial peer set ,",
    "the new peer attempts to initiate new connections , under the following two constraints : 1 ) a peer is not allowed to establish more than a fixed number of outgoing connections , typically @xmath2 , and 2 ) a peer can not maintain in total more than a fixed number of open connections , typically @xmath6 ( the maximum peer set size ) .",
    "the latter limit is imposed to avoid performance degradation due to competition among tcp flows , while the former serves to ensure that some connection slots are kept open for new peers that will join later . in this manner",
    ", the initial peer set can be augmented later by connections initiated by remote peers .    whenever the peer set size falls below a given threshold ( typically @xmath0 ) , a peer contacts the tracker again and asks for more .",
    "to avoid overwhelming the tracker with such requests , there is usually a minimum interval between two such consecutive messages .",
    "finally , each peer contacts the tracker periodically ( typically once every @xmath1 minutes ) to indicate that it is still present in the network .",
    "if no heartbeat is received for more than @xmath7 minutes , the tracker assumes the peer has left the system , and does not include it in future initial peer sets .",
    "the potential shortcoming of the default strategy can be seen by considering the effect of the maximum number of outgoing connections . a small number for this parameter will allow peers who have recently joined the system to connect to older ones , whereas a large number will cause peers to be more connected to others that joined around the same time .",
    "thus , we expect that , when increasing this value , we will observe the formation of clusters of peers that joined close together in time . for very large values , close to the maximum peer set size , this could even cause the creation of mostly disjoint cliques that share data within themselves , thereby compromising the robustness of the system to churn .",
    "if the connecting peer between two cliques were to disconnect , we would have the creation of partitions in the system .",
    "our results bear out this hypothesis .    to address this issue",
    ", we propose an alternative strategy based on preempting existing connections .",
    "the only difference from the default strategy manifests itself when a peer @xmath4 wants to establish a connection to a peer @xmath5 that has already reached its maximum peer set size . in the default strategy",
    "such a connection attempt would simply be rejected . with preemption ,",
    "however , peer @xmath5 will accept the new connection after dropping an existing one , if and only if @xmath4 has discovered @xmath5 from the tracker ( as opposed to through other means , e.g. , peer exchange ) .",
    "thus , an implementation of the preemption strategy would be exactly the same as the default one , with the following modification .",
    "when peer @xmath8 joins a torrent , it receives the ip addresses of several existing peers including peer @xmath9 .",
    "let us assume that @xmath8 attempts to initiate a connection to peer @xmath9 . if @xmath9 has not reached its maximum peer set size , the connection is accepted with no further action .",
    "however , if @xmath9 has already reached its maximum peer set size , it will either 1 ) accept the connection from @xmath8 , after tearing down an existing connection , if @xmath8 discovered @xmath9 s ip address from the tracker , or 2 ) refuse the connection in any other case .",
    "the rationale behind this strategy is the goal of introducing some randomness in the connection establishment process , to help convergence to the maximum peer set size as fast as possible and prevent cliques .",
    "the default strategy gives preference to connections from peers who joined close in time , especially at the beginning of the download .",
    "the preemption strategy attempts to spread connections uniformly over the peers delivered in the peer lists by the tracker , without being affected by external peer connection mechanisms ( e.g. , peer exchange ) .",
    "note that , if @xmath9 decides to accept the new connection , it selects the connection to close at random among all the connections that were initiated by remote peers ( the incoming connections ) . in case",
    "there is no such connection , it selects any connection at random .",
    "the rationale behind this is to maximize the probability that the remote peer can quickly recover from such an unexpected connection drop . indeed , in case the remote peer @xmath9 has reached its maximum number of outgoing connections , closing an incoming connection from peer @xmath10 ( an outgoing connection for @xmath10 ) will allow @xmath10 to quickly either establish a new outgoing connection .",
    "if @xmath9 were to close an outgoing connection , then @xmath10 would only be able to wait for a new incoming connection request .",
    "an additional useful heuristic ( which we do not currently employ in our simulations ) when selecting connections to close would be to never close a connection to a peer that is currently unchoked or is actively sending data .",
    "our preemption strategy assumes that @xmath9 somehow knows whether @xmath8 has received its address from the tracker .",
    "the easiest way to implement this functionality is to set a specific bit in the bittorrent handshake message sent from @xmath8 to @xmath9 .",
    "there are unused reserved bits in the handshake message that can be used for this purpose .",
    "as @xmath8 is untrusted , @xmath9 will never accept more than a few percents of preempted peers , typically @xmath11 of the peer set ( yet in our evaluation , we put no limit on the number of accepted preempted peers ) .",
    "this way , a misbehaving or evil peer will not be able to harm a regular peer by making him drop all its connections using preemption with fake peers .    consequently , to implement the preemption strategy ,",
    "one only needs to modify clients , but not the tracker .",
    "moreover , as this new strategy is based on a specific bit set in the handshake message , it is backward compatible with existing bittorrent clients .",
    "indeed , the default behavior of a bittorrent client that receives a handshake with an unknown bit set is to ignore this bit .",
    "before presenting our results , we first outline our experimental setup and describe the simulation parameters .",
    "we then characterize the peer arrival and departure distributions we consider in this study , and present the metrics used to evaluate the properties of the overlay .      in order to investigate the properties of the overlays generated by the two strategies",
    ", we developed a simulator that captures the evolution of the overlay structure over time as peers join and leave the torrent .",
    "the simulator source code is publicly available  @xcite , and it follows the protocol as it is implemented in the official bittorrent client version 4.0.2 .",
    "we do not model the peer and piece selection strategies used in data exchange , since we focus on the construction and robustness properties of the overlay instead .",
    "we believe that simulations , rather than physical experiments , are a more appropriate vehicle for evaluating these properties , for three main reasons .",
    "first , the bittorrent overlay can not be explored using a crawler , as is the case for other peer - to - peer systems , such as gnutella  @xcite .",
    "this is because the protocol itself does not offer a generic distributed mechanism for peer discovery , i.e. , there is no way to make a bittorrent peer ( that does not support the peer exchange extension ) to provide any information about the peers in its peer set . as several bittorrent clients do not support this extension , the information we would get from public torrents would be largely incomplete .",
    "second , we can not analyze existing traces collected at various trackers , since a peer never shares with the tracker its connectivity with other peers in the swarm .",
    "lastly , we could instead set up our own controlled testbed , e.g. , on planetlab , running real experiments and collecting statistics .",
    "however , running such experiments is harder and more time consuming than running simulations , and it will not bring significantly more insights than simulations . indeed ,",
    "a frequent argument against bittorrent simulations , namely the fact that it is challenging to accurately model the system dynamics , is arguably not applicable in our case , since we focus exclusively on the overlay construction , which is far easier to model than bittorrent s data exchange .    in any case",
    ", we have validated our simulation results by comparing them against results from real experiments on a controlled testbed .",
    "these experiments are not presented here due to space limitations , but can be found in our technical report  @xcite .      following observations by guo _",
    "et al . _",
    "@xcite , we model peer arrivals and departures with an exponential distribution .",
    "we split simulated time into _",
    "slots_. slot @xmath12 , where @xmath13 , is defined as the simulated time elapsed between time @xmath14 minutes and time @xmath15 minutes .",
    "we focus on a flash crowd scenario , where most peers arrive soon after the beginning of the torrent s lifetime .",
    "thus , within each time slot @xmath12 , the number of new peers that join the torrent is @xmath16 and @xmath17 .",
    "each peer stays connected to the torrent for a random period of time uniformly distributed between @xmath18 and @xmath0 simulated minutes . under these assumptions ,",
    "@xmath19 peers will arrive during the first @xmath18 minutes , @xmath20 peers during the next @xmath18 minutes , @xmath21 peers between the @xmath22 and @xmath23 minute , and the remaining @xmath24 peers during the fourth 10-minute period .",
    "no peers will arrive after the first @xmath2 minutes of the simulation . as a result",
    ", there will be more peer arrivals than departures during the first two time slots , and vice versa starting from the third time slot .",
    "the evolution of the torrent size that results from this model corresponds to a typical real torrent , based on previous studies  @xcite .",
    "the typical lifetime of a bittorrent peer is in the order of several hours , while the torrent lifetime ranges from several hours to several months . in our simulations ,",
    "the average peer and torrent lifetimes are around @xmath25 and @xmath26 simulated minutes respectively .",
    "as we only focus on the overlay construction during the flash crowd , considering longer lifetimes would not give any new insights .",
    "indeed , as our results show , the peer arrival and departure order have a significant impact on the overlay , unlike the duration of their presence in the torrent .",
    "we use three simple metrics to evaluate the structure of an overlay , which we believe capture different important overlay properties well .",
    "first , the _ bottleneck index _ is defined as the ratio of the number of connections between the first @xmath6 peers ( equal to the maximum peer set size ) to join the torrent ( including the initial seed ) and the rest of the peers , over the maximum possible number of such connections ( @xmath27 ) .",
    "this index provides an indication of the presence of a bottleneck between the first set of participating peers and the rest of the torrent .",
    "the existence of such a bottleneck would arguably adversely impact both the content distribution speed and robustness of the overlay .",
    "note that a lower bottleneck index implies a worse bottleneck .",
    "the second metric we use is the _ average peer set size_. a larger average peer set size implies a larger number of neighbors , which should lead to more opportunities of finding a peer that is willing to exchange data and higher resilience to churn .",
    "lastly , we measure the _ overlay diameter _ as the maximum number of hops in the torrent .",
    "a small diameter indicates that a piece can reach any peer within a few hops .",
    "therefore , this metric also serves to evaluate the diversity of pieces in the system , which has been shown to lead to efficient piece replication  @xcite .",
    "in our simulations , we use the official bittorrent client s default parameter values and set the maximum peer set size to @xmath6 and the minimum number of neighbors to @xmath0 .",
    "we then vary the maximum number of outgoing connections @xmath28 from @xmath29 to @xmath6 with a step of @xmath29 .",
    "we evaluate the properties of overlays generated using both the default and the preemption strategies .",
    "figure  [ fig : all - metrics ] plots the three metrics we consider over the maximum number of outgoing connections .",
    "we observe that , for the tracker strategy ( solid line ) , there is no value of @xmath28 that optimizes all three metrics . the highest bottleneck index , which would result in a more robust overlay , as well as a relatively small overlay diameter are both achieved for @xmath28 around @xmath0 .",
    "however , the optimal average peer set size occurs for @xmath28 equal to @xmath6 . as a result ,",
    "the common practice to set @xmath28 to half of the maximum peer set size ( thus making it @xmath2 ) is by no means the best choice .",
    "rather , since average peer set size approaches its maximum for @xmath28 equal to @xmath1 , we propose setting the maximum number of outgoing connections between @xmath0 and @xmath1 , which achieves a better trade - off for the three metrics we consider .    in addition",
    ", we see in figure  [ fig : all - metrics - diameter ] that the overlay diameter for the tracker strategy is @xmath30 when @xmath28 is set to @xmath6 .",
    "this means that the peer graph is partitioned into two separate subgraphs .",
    "we also observe that the bottleneck index increases for @xmath28 values up to @xmath0 and decreases for larger values .",
    "to explain these results we focus now on the actual connections among peers in the overlay .",
    "figure  [ fig : connectivity - nopreempt ] plots these connections for the tracker strategy , captured after @xmath18 simulated minutes , i.e. , after the arrival of @xmath19 peers ( see section  [ sec : simulation - parameters ] ) , for four distinct values of @xmath28 : @xmath0 , @xmath2 , @xmath31 , and @xmath6 . the results are shown in the form of a _ connectivity matrix _ , where a dot at @xmath32 means that peers @xmath12 and @xmath33 are neighbors .",
    "we observe that , for lower values of @xmath28 , there exists good connectivity among peers , with some clustering being observed for those who joined the torrent first .",
    "however , when increasing @xmath28 further , we see the formation of a small cluster that consists of the first @xmath6 peers ( same as the maximum peer set size ) .",
    "this clustering becomes clearer for increasingly larger values of @xmath28 , to the point where , for @xmath28 equal to the maximum peer set size , those first @xmath6 peers form a completely separate partition from the rest of the overlay .",
    "the creation of two separate partitions will definitely be harmful to system robustness , as the seed and the first peers , who already have most of the pieces , will be unable to share them with the rest of the system .",
    "we attempt to explain the reason behind this clustering with an example . in the following , peer @xmath34 is the @xmath35 peer to join the torrent . for @xmath28",
    "equal to @xmath2 ( see fig .",
    "[ fig : connectivity - nopreempt-40 ] ) , all of peer @xmath36 s neighbors belong to the first @xmath37 peers who joined the torrent .",
    "the reason is that when peer @xmath36 arrives , it establishes outgoing connections to all other @xmath38 peers already in the system .",
    "it then waits for new arrivals in order to establish the remaining @xmath39 connections it still needs to reach its maximum peer set limit .",
    "those missing connections are satisfied after the arrival of another @xmath40 peers on average , @xmath41 .",
    "similarly , when peer @xmath42 arrives , it establishes up to @xmath2 outgoing connections .",
    "however , @xmath42 now needs to wait for the arrival of a larger number of peers in order to establish its remaining @xmath2 incoming connections , because the probability that its ip address is returned by the tracker to new peers decreases as the number of peers in the torrent increases .",
    "this explains why , as compared to @xmath36 , the neighbors of @xmath42 belong to a larger set of peers ( @xmath43 ) .",
    "this leads us to believe that an alternative strategy that introduces some randomness into the connection establishment process would exhibit better behavior . with that in mind , let us now look at the properties of an overlay built using our proposed preemption strategy .",
    "as shown in figure  [ fig : all - metrics ] ( dashed line ) , such an overlay exhibits better characteristics than the one generated with the tracker strategy , for the three metrics we consider . moreover , a value @xmath28 equal to the maximum peer set size clearly gives the best results for all three metrics .",
    "in addition , looking at the connectivity matrices of the overlay built with the preemption strategy captured after @xmath18 simulated minutes ( shown in figure  [ fig : connectivity - preempt ] ) , we observe good connectivity among peers for all value of @xmath28 , without the clustering effects observed with the tracker strategy .    thus , the preemption strategy obviates the need to heuristically select the maximum number of outgoing connections allowed at each peer , as the best overlay structure is always attained when that parameter is equal to the maximum peer set size .",
    "in addition , the proposed strategy outperforms the default one for all considered metrics .",
    "therefore , the preemption strategy , while simple and easy to implement , offers a strong alternative to the one used by most bittorrent clients .",
    "there has been a fair amount of work on the performance and robustness of bittorrent systems , most of which is complementary to ours .",
    "bram cohen , the protocol s creator , first described its main mechanisms and their design rationale  @xcite .",
    "several measurement studies attempted to characterize the protocol s properties by examining real bittorrent traffic .",
    "et al . _",
    "@xcite measured several peer characteristics derived from the tracker log of the red hat linux 9 iso image , including the proportion of seeds and leechers and the number and geographical spread of active peers .",
    "they observed that , while there is a correlation between upload and download rates , the majority of content is contributed by only a few leechers and the seeds .",
    "pouwelse _ et al . _",
    "@xcite studied the content availability , integrity , and download performance of torrents on a once - popular tracker website .",
    "et al . _",
    "@xcite additionally examined bittorrent sharing communities and found that sharing - ratio enforcement and the use of rss feeds to advertise new content may improve peer contributions .",
    "at the same time , guo _ et al . _",
    "@xcite demonstrated that the rate of peer arrival and departure from typical torrents follows an exponential distribution and that performance fluctuates widely in small torrents .",
    "they also proposed inter - torrent collaboration as an incentive for leechers to stay connected as seeds after the completion of their download . a more recent study by legout _ et al . _",
    "@xcite examined peer behavior by running extensive experiments on real torrents .",
    "they showed that the rarest - first and choking algorithms play a critical role in bittorrent s performance , and claimed that the use of a volume - based tit - for - tat algorithm , as proposed by other researchers  @xcite , is not appropriate .",
    "there have also been some simulation studies attempting to better understand bittorrent s system properties .",
    "et al . _",
    "@xcite performed an initial investigation of the impact of different peer arrival rates , peer capacities , and peer and piece selection strategies .",
    "et al . _",
    "@xcite utilized a discrete event simulator to evaluate the impact of bittorrent s core mechanisms and observed that rate - based tit - for - tat incentives can not guarantee fairness .",
    "they also showed that the rarest - first algorithm outperforms alternative piece selection strategies .",
    "lastly , tian _ et al . _",
    "@xcite studied peer performance toward the end of the download and proposed a new peer selection strategy that enables more peers to complete their download , even after the departure of all the seeds .",
    "our work differs from all previous studies in its approach and results .",
    "we performed extensive simulations to examine the impact of the overlay construction strategy on system properties and robustness .",
    "our results showcase the importance of the maximum number of outgoing connections and propose a concrete improvement to the protocol .",
    "in this paper , we introduce a new preemptive overlay construction strategy for bittorrent .",
    "we evaluate it along with the default bittorrent tracker strategy for a flash crowd scenario , based on three different metrics .",
    "our results show that the tracker strategy is quite sensitive to the maximum number of outgoing connections , which does not seem to have a single value that optimizes all metrics .",
    "in addition , a value between @xmath0 and @xmath1 offers a better choice than the current bittorrent default of @xmath2 . on the other hand ,",
    "the proposed preemption strategy outperforms the default one for all three metrics considered .",
    "furthermore , there is a clear optimal choice for the maximum number of outgoing connections ( equal to the maximum peer set size ) , a fact that removes the need to set this parameter in an ad - hoc manner .",
    "these results already provide some initial insights into how the default tracker strategy behaves and how to improve it using preemption",
    ". however , many questions remain open for future work .",
    "first , while we have introduced specific metrics for evaluating the properties of the overlay structure , and we have discussed how these metrics are linked to the system s robustness , we have not formally quantified their impact .",
    "this is a necessary step in understanding how the overlay structure actually affects system properties .",
    "in addition , it would be interesting to investigate whether the preemption strategy can be exploited by an attacker in order to disconnect peers from torrents .    finally , while we have examined the tracker strategy and its preemption - based alternative ,",
    "there exist other strategies based on gossiping , e.g. , peer exchange , which are also promising .",
    "some preliminary results in that direction show that such strategies produce an overlay with large diameter and low bottleneck index , but they achieve the best average peer set size .",
    "it would be interesting to better understand the trade - offs involved in such gossiping techniques , and incorporate some of their features into our preemption strategy .",
    "we want to thank matthieu latapy for his suggestions on the use of preemption , and christos gkantsidis for his helpful comments ."
  ],
  "abstract_text": [
    "<S> swarming peer - to - peer systems play an increasingly instrumental role in internet content distribution . </S>",
    "<S> it is therefore important to better understand how these systems behave in practice . </S>",
    "<S> recent research efforts have looked at various protocol parameters and have measured how they affect system performance and robustness . </S>",
    "<S> however , the importance of the strategy based on which peers establish connections has been largely overlooked .    </S>",
    "<S> this work utilizes extensive simulations to examine the default overlay construction strategy in bittorrent systems . </S>",
    "<S> based on the results , we identify a critical parameter , the maximum allowable number of outgoing connections at each peer , and evaluate its impact on the robustness of the generated overlay . </S>",
    "<S> we find that there is no single optimal value for this parameter using the default strategy . </S>",
    "<S> we then propose an alternative strategy that allows certain new peer connection requests to replace existing connections . </S>",
    "<S> further experiments with the new strategy demonstrate that it outperforms the default one for all considered metrics by creating an overlay more robust to churn . </S>",
    "<S> additionally , our proposed strategy exhibits optimal behavior for a well - defined value of the maximum number of outgoing connections , thereby removing the need to set this parameter in an ad - hoc manner .    </S>",
    "<S> bittorrent , overlay construction , preemption , robustness , outgoing connections </S>"
  ]
}