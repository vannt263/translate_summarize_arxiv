{
  "article_text": [
    "an important task that often arises in stellar dynamics is the construction of self - consistent equilibrium models of galaxies that have a given density profile @xmath1 and , optionally , satisfy certain kinematic constraints .",
    "self - consistency means that the gravitational potential is determined by the distribution of the mass in the galaxy via the poisson equation .",
    "equilibrium models satisfy the collisionless boltzmann equation with a steady - state distribution function . in practice",
    ", we usually require the models to evolve very slowly compared to the dynamical ( crossing ) timescale .    there exist numerous methods for creating ( near-)equilibrium galaxy models of varying complexity and geometry . after reviewing of these approaches in section  [ sec : overview ] , with a particular focus on the methods suitable for disc galaxies , we concentrate on the schwarzschild orbit superposition method . up to now ,",
    "it was mostly applied to elliptical galaxies or to the inner parts of the milky way .",
    "we describe the challenges that need to be met in its extension to highly flattened , non - axisymmetric stellar systems with figure rotation , and present our implementation in section  [ sec : method_details ] . then in section  [ sec : tests ] we apply it to construct models of some analytical density profiles that are frequently used in the literature , in particular , comparing several published methods for creating equilibrium models of axisymmetric disc galaxies , and create models of barred disc galaxies based on the density distributions taken from @xmath0-bodysimulations .",
    "we discuss our results and possible future applications in section  [ sec : discussion ] , and summarize in section  [ sec : conclusions ] .",
    "the focus of this paper is on disc galaxies , therefore we restrict our review to the methods suitable for such systems which are typically multicomponent ( include a strongly flattened disc , which may or may not be axisymmetric , a rather spherical halo component , and a bulge or a bar that might well be triaxial ) .",
    "most of the methods specifically tailored for disc galaxies produce axisymmetric models that are close but not exactly in equilibrium .",
    "@xcite introduced a method based on the locally maxwellian approximation to the velocity distribution function and a prescribed density distribution for each component .",
    "it used the spherical ( for the halo ) and axisymmetric ( for the bulge ) jeans equations and an approximation of constant radial - to - vertical velocity dispersion ratio for the disc together with epicyclic approximation for the azimuthal component of velocity dispersion . in this method ,",
    "all components are spherical except , in some parts of the analysis , the disc ; later @xcite generalized this method to allow for axisymmetric halo and bulge , while using an approximate method to squeeze the shape of velocity ellipsoid proportionally to the flattening of the potential .",
    "a drawback of this approach is the use of maxwellian velocity distribution function , which may not always be appropriate for an equilibrium solution @xcite .",
    "@xcite used a different approach , starting from a suitable anzatz for the distribution functions of each component , which used two classical integrals  energy and @xmath2-component of angular momentum for the spheroidal components , and added the third approximate integral ( energy of vertical motion ) for the disc .",
    "the density profile corresponding to the given distribution function was then computed iteratively , taking into account the potentials of all components .",
    "@xcite modified this scheme to allow for a cuspy density profile and a central massive black hole , while retaining analytic expressions for the distribution functions . however , with this approach the density profile of the halo and bulge are determined implicitly and are hard to prescribe ; an improvement introduced by @xcite instead derived the isotropic distribution function for the given density profile numerically , using the eddington inversion formula in a spherically - symmetric approximation of the total potential . a similar approach ( iterative solution for the potential for given analytically described distribution functions for each component )",
    "is employed in the widely used besanon model of milky way @xcite .",
    "binney and collaborators advocate the use of actions as arguments of distribution function ( e.g. * ? ? ?",
    "* ) ; however , their models are not designed to be self - consistent dynamically and instead focus on the fitting of kinematic properties of observed stellar populations in the milky way disc .",
    "another possible approach is to build up the composite system by introducing the components of gravitational potential one by one , in the adiabatic approximation . in the first such implementation by @xcite ,",
    "one begins with @xmath0-bodyrealizations of two separate analytic spherical equilibrium models for bulge and halo , superimposing them on top of each other and allowing them to relax .",
    "this first stage , however , induces non - negligible changes to the original density profiles as they reach the new equilibrium in the joint gravitational potential .",
    "then the analytically defined disc potential is grown adiabatically , without actually adding any disc particles , but allowing the particles in the spheroidal components to adjust to the combined potential .",
    "finally , the disc is populated with particles using the locally maxwellian distribution function .",
    "@xcite improve this method by constructing the spheroidal components from an exact distribution function derived from an anisotropic generalization of eddington inversion formula , using the monopole terms of potential of all three components",
    ". then only the non - spherical part of the disc potential is adiabatically introduced into the live @xmath0-bodysystem of bulge plus halo , and finally the disc particles are populated from a more accurate distribution function , avoiding the maxwellian approximation .",
    "this method offers little control over the shape of the halo or bulge ( which slightly flatten during adiabatic contraction ) , but yields close - to - equilibrium configurations even for rather `` warm '' discs .",
    "all of the above mentioned methods are designed for axisymmetric potentials only , often make an implicit assumption that the motion of stars in the disc component is integrable ( e.g.  in the torus construction method of * ? ? ? * ) , and usually have a rather restricted choice for the mass and velocity profiles of various components .",
    "it has long been recognized that non - axisymmetric features in galactic discs , such as bars , spiral arms and rings , give rise to a variety of phenomena associated with resonances and chaotic orbits ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "many studies have been devoted to the detailed analysis of orbital structure of barred disc galaxies described by analytical potentials ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) or @xmath0-bodymodels ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) . to address the question which of the many kinds of orbits actually contribute to the self - consistent potential , so - called response models are constructed , following the method developed by @xcite .",
    "it starts from an assumption for the gravitational potential ( including non - axisymmetric perturbations and a value for pattern speed ) , then the periodic orbits in the given potential are computed and superimposed to obtain the `` response density '' profile .",
    "the parameters of the potential are then iteratively adjusted until the response density matches the potential . a number of indicators are used to determine self - consistency , including the amplitude and phase of various angular harmonics as functions of radius .",
    "this technique has been applied to barred spiral galaxies ( e.g. * ? ? ?",
    "* ) ; a modification introduced in @xcite allowed to vary the relative contribution of different groups of orbits ( binned in energy ) in the solution , similar to the schwarzschild method ( see below ) .",
    "an advantage of this method is that it uses the knowledge of the orbital structure of non - axisymmetric galaxies ; nevertheless , it still is limited by the assumptions of the functional form of potential and perturbation , and has been only used in two dimensions .",
    "a completely different and very generic alternative is offered by combining @xmath0-bodysimulations ( which by definition are dynamically self - consistent , even though not necessarily stationary ) with some adjustment method to bring the model towards the required properties .",
    "the made - to - measure ( m2 m ) method , introduced by @xcite , deals with a fixed , pre - determined potential , and adjusts the weights of individual particles in the course of simulation to match the prescribed observable properties .",
    "@xcite and @xcite extended this method to rotating potentials and included a likelihood - based treatment of kinematic observational constraints .",
    "this implementation also has an option of adjusting the gravitational potential together with the evolving density ( using a spherical - harmonic expansion ) , thus making the resulting model dynamically self - consistent .",
    "@xcite improved the method by introducing a new scheme for adjusting particle weights , which has later been incorporated into other codes . @xcite and @xcite developed two more implementations of m2 m method , applicable also to disc galaxies @xcite .",
    "another class of methods based on `` guided '' @xmath0-bodysimulations are the iterative methods of @xcite and @xcite . in these approaches ,",
    "the evolution of a live @xmath0-bodysystem is followed for a certain time ( an episode ) , and then the velocities of particles are adjusted according to some scheme , to match the required properties of the system .",
    "the whole process is repeated iteratively until a convergence is reached .",
    "both m2 m and iterative methods are very flexible and capable of dealing with any geometry ( although the method of @xcite is restricted to axisymmetry ) ; they are however rather costly in terms of computational demand .    finally , the orbit superposition method , introduced by @xcite , has been widely used in the last decade to create stellar - dynamical models of external galaxies . there exist several implementations for axisymmetric geometry @xcite and one for non - rotating triaxial potentials with cores @xcite , which are capable of dealing with a variety of observational constraints and perform a model search to find the best - fitting parameters of the potential and their uncertainties .",
    "there are also implementations targeted for a more theoretical usage ( without observational constraints ) , e.g.  @xcite .",
    "all these studies considered galactic models that are not too far from spherical , i.e.  they could be axisymmetric or triaxial , but not strongly flattened .",
    "applications to barred disc galaxies are rather scarce : @xcite and @xcite considered two - dimensional models for the motion in the galactic plane of a barred potential , and several studies @xcite concentrated on the models of milky way bulge , without attempting to construct a model for the entire disc .    in this paper , we present a publicly available implementation of the schwarzschild method suitable to deal with multicomponent , arbitrarily flattened , non - axisymmetric potentials with figure rotation .",
    "it is a further development of the computer code smile , described in detail in @xcite . in the present version ,",
    "it remains `` a theorist s tool '' , in the sense that it does not include the possibility to deal with observational kinematic constraints ; however , it offers a very generic framework suitable for all types of galaxies , and in the future we plan an observational extension of the code .",
    "to construct a self - consistent equilibrium model with the schwarzschild method , one takes the following steps :    1 .",
    "choose a model for the gravitational potential .",
    "2 .   compute a large number ( typically @xmath3 ) of orbits in this potential , sampling , in as much as possible , the entire phase space .",
    "each orbit is computed for many ( @xmath4 ) dynamical times and its properties are stored in a discretized way ( see section  [ sec : solution ] ) .",
    "3 .   the model is constructed as a weighted superposition of these structural blocks ( orbits ) , with the weights being computed as a solution to some optimization problem .",
    "if the method is used in the observational context , then a series of models with varied parameters of the potential is constructed , and the likelihood of each model in fitting the observational data is used to derive the confidence ranges of the potential parameters .",
    "we describe these steps in detail in the following sections , focusing on the particular features that are necessary to deal efficiently with models of disc galaxies .      at the very least ,",
    "a flexible and accurate method for representing an arbitrary potential of a highly flattened system is required . of course",
    ", one may use a combination of analytical potential - density models which approximate the target system , such as a miyamoto  nagai disc or a ferrers triaxial bar , which have been used in many previous studies ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "this approach may well capture important properties of the system , but it is difficult to control the systematic errors from parametric models . on the other hand ,",
    "approximating the potential by a suitably chosen basis - set expansion is a more general approach , although it is not trivial to do it efficiently for a strongly flattened system .",
    "most work that has been done in this direction is based on the spherical - harmonic expansion of both density and potential up to a given order @xmath5 in the angles , and expressing the radial dependence of expansion coefficients as a sum over basis functions @xcite , or as explicit functions of radius @xcite .",
    "this technique , especially in its last variant , offers a very good approximation of the potential of systems which are not too far from spherical ( i.e.  for elliptical galaxies ) , but becomes increasingly inefficient for disky systems as the order of angular expansion , necessary to resolve the thinness of the disc , increases ( for instance , @xcite used @xmath6 ) .    on the other hand , for strongly flattened systems",
    "it is more natural to work in cylindrical coordinates @xmath7 rather than spherical @xmath8 . for two - dimensional systems",
    ", an efficient basis set may be constructed using appropriately scaled bessel functions @xcite .",
    "the third dimension may be added in several different ways .",
    "@xcite presents a basis set for density models separable in @xmath9 , while @xcite generalize this approach for other coordinate systems besides cylindrical .",
    "@xcite resorts to a numerical solution of the sturm  liouville equation to obtain the basis functions in @xmath10 , while using harmonic expansion in @xmath11 and @xmath2 ( the latter in a finite - size sheet ) .",
    "@xcite employ a similar approach with both @xmath10 and @xmath2 basis functions being expressed by suitably transformed polynomials , tailored to a given lowest - order density distribution . in a special case of a separable axisymmetric density profile in cylindrical coordinates",
    ", @xcite and @xcite used an approximation based on the splitting of the potential into a separable exactly representable flattened part and a spherical - harmonic expansion for the remaining weakly non - spherical part .",
    "finally , in @xmath0-bodysimulations often a three - dimensional cylindrical grid is used ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) ; however , it usually employs a low - order ( linear ) interpolation for force computation , which might be insufficient for high - accuracy orbit integration .    given a good experience of working with a non - parametric representation of spherical - harmonic expansion coefficients as spline functions in scaled radius , we decided to use a similar approach for flattened systems in cylindrical coordinates .",
    "namely , we represent the potential as a sum of fourier terms in the azimuthal angle @xmath11 , with the coefficients of expansion being smooth functions in the meridional plane @xmath9 , that is , two - dimensional cubic splines in suitably scaled coordinates .",
    "we refer to the appendix for a more technical description and accuracy tests of this potential approximation .",
    "overall , its performance is good enough to be used for approximating an arbitrary flattened non - axisymmetric mass distribution .",
    "moreover , in multicomponent models we may choose the most suitable potential representation for each component , for instance , the cylindrical spline for the disc galaxy and the spherical - harmonic spline expansion for the halo .",
    "the core feature of the schwarzschild method is that it automatically picks up the orbits that are most suitable for representing the target density profile .",
    "nevertheless , the efficiency of the method and the very existence of the solution do depend on the procedure employed to sample the initial conditions of the orbit library . as an extreme example , suppose we wish to create a spherical system in dynamical equilibrium using purely radial orbits ( even though it is guaranteed to undergo a violent radial - orbit instability , this does not invalidate the concept of equilibrium solution ) . if we pick up initial velocities with random orientations , for instance using the isotropic distribution function , the chances to find a purely radial orbit are zero . on the other hand ,",
    "if we use a spherical jeans equation with the velocity anisotropy coefficient @xmath12 equal to unity ( where @xmath13 and @xmath14 are the velocity dispersion in the radial and tangential directions , respectively ) , then all our orbits will be radial .",
    "we could also start all orbits with zero velocities , and do not even need to seed the initial positions of the orbits to follow the required density profile  the solution obtained with the schwarzschild method will converge to it , as long as we ensure that there are sufficiently many ( not necessarily all ) radial orbits in the orbit library . as another example , using isotropic velocities in a rotationally - supported disc galaxy would be much less efficient than , for instance , launching orbits with some small velocity dispersion about the mean circular velocity ; however , if this velocity dispersion is too small for a given thickness of the disc , a self - consistent model could not be constructed either .",
    "this suggests that the choice of initial conditions is an important ingredient of the model , and should , in as much as possible , correspond to the target system to be constructed . in the traditional approach ,",
    "used in nearly all previous studies ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) , one takes a small number of discrete values of energy @xmath15 and populates the initial conditions from several `` start - spaces '' at each energy .",
    "stationary start - space @xcite consists of points covering the equipotential surface with zero initial velocities ; principal - plane start - spaces contain points with one coordinate ( say , @xmath2 ) and two complementary velocity components ( @xmath16 ) being zero , and the remaining component @xmath17 assigned to yield the required total energy . in the axisymmetric case , it is sufficient to sample the positions in the meridional plane on the zero - velocity curve for the given values of energy and angular momentum ( e.g. * ? ? ?",
    "* ) . for models with figure rotation",
    ", @xcite proposed a @xmath18 start space , with initial conditions taken along the intermediate ( @xmath19 ) axis and with velocity directed at the angle @xmath20 in the @xmath21 plane .",
    "all these methods place initial conditions on some sort of regular grid , which may not always be a good choice .",
    "for instance , with @xmath22 orbits we only have @xmath23 grid nodes per each dimension ( the grid of initial conditions for triaxial models is usually three - dimensional ) , which leads to excessive granularity of the orbit library .",
    "as shown by @xcite , such models are not in perfect equilibrium and demonstrate a noticeable evolution in the course of @xmath0-bodysimulations at early times .",
    "an alternative approach , used in the aforementioned paper , is to assign initial conditions randomly , for instance , sampling them from an isotropic distribution function computed with the eddington inversion formula ( e.g. * ? ?",
    "* equation  4.46 ) for a spherical potential ",
    "density pair that approximates the real , non - spherical model . in this approach ,",
    "the positions of particles are first seeded in accordance with the true three - dimensional density profile of the model , then the velocities are assigned by drawing them from the eddington distribution function .    in the present implementation",
    ", we introduced several additional methods for generating the initial conditions for velocities , aside from the eddington sampler .",
    "the first two are based on the jeans equations for the spherical and axisymmetric systems .",
    "the former is rather trivial , and its only improvement over the eddington sampler is the facilitation of creating models with strong radial or tangential velocity anisotropy .",
    "the axisymmetric jeans equations are used in the anisotropic formulation of @xcite : the velocity dispersion ellipsoid is assumed to be aligned with the cylindrical coordinate system , and the anisotropy coefficient in the meridional plane @xmath24 is assumed to be constant .",
    "these assumptions are rather strong and moreover they are not satisfied for realistic galaxies ; for an alternative method of solving the axisymmetric jeans equations under assumption of radial alignment of velocity ellipsoid see @xcite .",
    "nevertheless , for the purpose of generation of initial conditions this simple choice is sufficient . aside from the anisotropy coefficient @xmath25 ,",
    "the other free parameter is the degree of rotation support @xmath26 : the mean azimuthal streaming velocity is given by @xmath27 . with this definition",
    ", @xmath28 corresponds to no net rotation and @xmath29 corresponds to equal velocity dispersions in @xmath10 and @xmath11 directions .",
    "another approach , which could more tailored to the particular properties of the potential , is based on the knowledge of periodic orbit families .",
    "first , one constructs a `` periodic orbit map '' , which consists of the initial conditions for various periodic orbit families ( most importantly , prograde loop orbits ) in the range of values of jacobi constant @xmath30 from the bottom of the potential well to the corotation .",
    "then one seeds initial conditions for the actual orbit library by picking them from the map and adding a random perturbation to the velocity components , to diversify the orbit library . we have experimented with this approach , but did not find a noticeable improvement over the simpler method based on the axisymmetric jeans equations",
    "; therefore , in the rest of the paper we use only the latter .      after computing the entire orbit library ,",
    "the next step in the schwarzschild method is to obtain the weights of orbits , such that the weighted superposition of density distributions of each orbit reproduces the target density profile of the model .",
    "additionally , one often requires that some other constraints be satisfied , for instance , fitting the line - of - sight velocity profiles from the model to the observed values .",
    "the present implementation allows only for very rudimentary kind of kinematic constraints : one can specify the profile of velocity anisotropy coefficient @xmath31 as a function of radius .",
    "we will not use this feature for the models of discs , and will set @xmath32 for the haloes .    the density profile of the model can be represented in a discretized way either as an array of masses of cells in a spatial grid , or , as suggested in @xcite , as an array of coefficients describing the basis - set or spline spherical - harmonic expansion of the potential corresponding to this density . since spherical - harmonic expansions are poorly suited for highly flattened systems , we use the former , traditional approach of partitioning the configuration space into a three - dimensional grid , computing masses of each grid cell @xmath33 by integrating the target density profile over the volume of the cell , and recording the fraction of time @xmath34 that each orbit spends in each cell . for elliptical galaxies , a grid based on concentric shells in radius and a certain partitioning in angles",
    "is typically used ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) . for flattened systems we instead use a grid aligned with cylindrical coordinates ( covering the region @xmath35 with @xmath36 rectangular cells , and split into @xmath37 cells in the azimuthal direction , equidistantly in @xmath11 ) .",
    "the grid nodes in the meridional plane are assigned in such a way that the total mass in each slab ( @xmath38 and a similar expression for @xmath39 ) is the same for each slice in @xmath2 direction or cylindrical shell in @xmath10 direction .",
    "of course , if the density profile is not separable in @xmath9 then the masses of each cell are not equal , but they usually vary only by a factor of few .    the self - consistent solution for orbit weights @xmath40 is given by the matrix equation @xmath41 , @xmath42 .",
    "this is not just a standard linear - algebra problem , as we require the solution vector @xmath40 to be non - negative ; in this formulation it is called a linear programming problem . in practice ,",
    "an exact solution may not always be feasible ; moreover , it is worthwhile to apply some sort of non - linear regularization to improve the smoothness of the solution . a suitable formulation that meets these requirements is the quadratic programming problem :",
    "minimize @xmath43 while keeping @xmath44 . here",
    "@xmath45 is the deviation in the mass of @xmath46-th cell from its required value .",
    "the penalty function @xmath47 is split into two parts : one is responsible for minimizing the deviations from the self - consistent solution ( which would have @xmath48 ) , the other regularizes the orbit weights and optionally imposes additional penalties for using particular types of orbits ( e.g.  orbits with negative @xmath2-component of angular momentum , or chaotic orbits ) .    for the first task",
    ", several methods have been suggested in the past ( here @xmath49 are adjustable parameters ) :    1 .",
    "@xmath50 ( e.g. * ? ? ?",
    "* ) ; 2 .",
    "@xmath51 ( least - square minimization , used in * ? ? ?",
    "* ; * ? ? ?",
    "* ) ; 3 .",
    "@xmath52 .",
    "the first method is easily implemented in the context of linear optimization problem by introducing @xmath53 additional non - negative variables @xmath54 such that @xmath55 ; thus the penalty function is just proportional to the sum of these variables ( of which at most one is non - zero for each constraint ) .",
    "similarly , in the second method , which traditionally has been solved using the non - negative least - squares method @xcite , the introduction of the same additional variables transforms it to a quadratic optimization problem with @xmath56 , which we have found to be more numerically efficient .",
    "finally , the last method can also be reformulated as a linear optimization problem with twice larger number of equations .",
    "all these methods are available in smile ; we usually use a combination of first two methods , so that small deviations in cell masses are penalized linearly and large  quadratically .    the regularization method that we use for the second task",
    "just aims to achieve an uniform distribution of orbit weights : @xmath57 where @xmath58 is the weight prior ( in the case of uniformly sampled initial conditions it is just the mean weight of an orbit in the model ) , and @xmath59 is the regularization coefficient . adjusting the values of @xmath60 and @xmath59 , one may vary the relative severity of constraint violation versus irregularities in the distribution of orbit weights . in practice ,",
    "for a well - behaved model with a sufficiently large number of orbits ( @xmath61 ) , we expect all constraints to be satisfied exactly , thus only the second term in @xmath47 remains nonzero .",
    "however , as we have discovered while working with potential approximations constructed from @xmath0-bodysnapshots , sometimes the mass of several cells could be computed from the density model with a rather large error and can not be satisfied by the schwarzschild solution . in this case",
    "it may be better to sacrifice a few cells in order to keep the model reasonably smooth .",
    "an extension over the previous version of smileis the full support for multicomponent models .",
    "this is implemented as follows : the orbits are computed in a combination of several potential models ( e.g.  triaxial ferrers bar plus an exponential disc plus a spherical hernquist halo ) , and the solution of the self - consistent problem uses an arbitrary subset of these density models ( e.g. the first two for the `` disc '' component and the last for the `` halo '' component , which are constructed independently and may use different methods for seeding the initial conditions ) . while multicomponent schwarzschild models have been used before @xcite , the present implementation is much more general and versatile .",
    "this extension required some modifications in the jeans and eddington initial condition samplers , to distinguish between the total potential of the entire model and the intrinsic density profile of a particular component .",
    "in the first test , we construct composite models of an axisymmetric disc galaxy with a bulge and a halo , using several different methods : magalie @xcite , a descendant of hernquist s ( 1993 ) buildgal code ; mkgalaxy @xcite ; galactics @xcite , which is the latest version of the method of @xcite ; galic @xcite ; and smile .",
    "all these codes are publicly available : the first two as part of nemo toolbox @xcite , the third as part of amuse framework @xcite , and the last two at the authors websites .",
    "( dashed line ) , @xmath62 ( dotted line ) and @xmath63 ( dot  dashed line ) , normalized by the value of vertical velocity dispersion for an isolated isothermal exponential disc : @xmath64 , where @xmath65 are the disc mass , scale radius and scaleheight .",
    "+ thicker lines are the initial models , thinner lines with shorter dashes are the models evolved for 100 time units .",
    "+ also shown ( in solid lines ) are radial velocity profiles corresponding to the value of toomre parameter @xmath66 ( in the second panel ) and to the solution of axisymmetric jeans equation with @xmath67 ( in the last panel , served as initial conditions for orbit library ) . ]    the first complication that we encountered is the different specifications of galaxy parameters in these codes .",
    "all methods employ various parametrization of three components  disc , bulge and halo density profiles , with fixed but sometimes incompatible functional forms , and in several cases , specified only indirectly and non - intuitively : for instance , instead of component masses galactics uses the depth of gravitational potential , and the disc scalelength in galic is determined by its mass and an obscure halo spin factor .",
    "after some experimentation , we have selected the following parameters , which produced nearly identical mass models for all codes : an exponential disc with density profile @xmath68 ; a bulge with scale radius @xmath69 and either srsic profile with the index @xmath70 , or hernquist profile ; and a navarro  frenk  white ( nfw ) halo with cutoff at 10 scalelengths , or an equivalent hernquist halo .",
    "the masses and sizes of these components are : @xmath71 , @xmath72 , @xmath73 , @xmath74 ( for the srsic profile ) , @xmath75 , @xmath76 ( depending on the functional form of cutoff ) , and halo scale radius of either 5 ( for nfw ) or 10 ( for hernquist ) . the rotation curve of this model is shown on fig .",
    "[ fig : rotcurve_axi ] .",
    "the choice of disc thickness implies a moderately warm disc , and the masses and scale radii of spheroidal components give them a rather large contribution to the total gravity : both factors aim at avoiding disc instabilities , but at the same time stress the necessity to take into account the gravity of all mass components when constructing the disc distribution function .",
    "exponential disc is the standard option for all these codes , but the density profile of the spheroidal components is constructed differently : mkgalaxy and galactics imply that the density profile follows the equipotential surfaces , which are somewhat flattened in the central parts .",
    "consequently , the @xmath77 axis ratio of the bulge is close to 0.8 in these codes , so we adopted this value for the other methods .",
    "the halo axis ratio varies from @xmath78 in the centre to about 0.8 at @xmath79 ( the maximum of disc rotation curve ) and then approaches unity as @xmath10 increases further . for smilewe have incorporated this spatially variable flattening into the input density profile ; the other two codes do not allow variable flattening and we have assumed a spherical halo for them .",
    "the velocity dispersion of bulge and halo was required to remain isotropic .",
    "most differences between codes are manifested in the velocity distribution of the disc component .",
    "the models constructed with these five methods all had @xmath80 particles in the disc / bulge / halo components , and were checked for stability by evolving them for 100 time units with the @xmath0-body code gyrfalcon @xcite ; the softening length was set to @xmath81 for disc and bulge and @xmath82 for halo particles , and the timestep was @xmath83 .",
    "[ fig : disk_kinem_axi ] shows the radial profiles of three diagonal components of velocity dispersion tensor in cylindrical coordinates ",
    "thicker lines for the initially constructed models , and thinner lines for the evolved models .",
    "the velocities are rescaled in such a way that the vertical velocity dispersion of an isolated isothermal exponential disc would appear as a constant line equal to unity .",
    "parameter for the disc component of the axisymmetric models built with different methods . ]",
    "first thing to note is that the codes produce a diversity of velocity profiles , determined by different constraints . to assign the radial velocity dispersion , magalie and mkgalaxy use toomre @xmath84 parameter , galactics assumes its exponential dependence on radius , and galic and smilesolve axisymmetric jeans equation .",
    "the vertical velocity dispersion is simply taken from an isolated isothermal disc in magalie and mkgalaxy , resulting in a too low value in the centre and in the outermost part of the disc ( where there is a substantial contribution to the gravity from the bulge and the halo , correspondingly ) .",
    "smileand galic take this contribution into account , while galactics is halfway between these options .",
    "galic enforces @xmath85 , while other codes determine @xmath62 from other considerations , resulting generally in @xmath86 .",
    "we note that the initial conditions for the orbit library in smileare assigned with @xmath87 ( with the choice of @xmath67 ) , however the actual orbit integration results in a different velocity structure , which we do not constrain .",
    "adding such constraints is not difficult , but as figs  [ fig : disk_kinem_q ] and [ fig : disk_kinem_axi ] ( solid line in the bottom panel ) show , neither a constant @xmath84 nor a constant @xmath88 are good choices for the target velocity dispersion profile , thus raising the question of the most natural requirements for it .",
    "the results of the simulations are also quite diverse . the models that assumed the vertical velocity dispersion to be equal to that of a self - gravitating isothermal disc ( magalie and mkgalaxy )",
    "have quickly increased it in the central parts , while the disc thickness correspondingly dropped in the centre . in all models ,",
    "the vertical thickness and velocity dispersion of the disc component has slowly but steadily grown over time , presumably as a result of two - body relaxation @xcite , and due to slowly developing disc instabilities .",
    "magalie and galic did not preserve the initial profiles of @xmath89 and @xmath62 ( the former code  only in the outer parts ) .",
    "the biggest limitation of the latter code stems from enforcing @xmath90 ( or , in other words , assuming the streaming parameter @xmath29 ) : while there are other possible choices in the code , none corresponds to the actual variation of @xmath26 seen in other models .",
    "it might be better not to fix the value of @xmath62 in this approach .",
    "galactics generated a model reasonably close to equilibrium , and smilefared best in this aspect .",
    "note that in the latter model the velocity dispersion profile is considerably higher at large radii than in other methods .",
    "in terms of computer resources , magalie and galactics take a few minutes to create the models , mkgalaxy takes about an hour , smiletakes a few cpu hours ( for the total number of @xmath91 orbits in our models ) .",
    "galic took about 100 cpu hours for 100 iteration steps , but since the model taken after 10 iterations is essentially the same as after 100 , a more truthful execution time is about 10 cpu hours .",
    "galic used @xmath92  gb of memory , while smileneeded about 1  gb , and the other codes much less .",
    "the results of this test demonstrate that smileis capable of creating multicomponent systems in almost perfect equilibrium ; a big improvement over previously used codes .",
    "it is important to note that , unlike other codes considered here , it allows an arbitrary density profile for ( any number of ) mass components , although in the present version it does not impose any constraints on the velocity structure .      as a second test ,",
    "we attempt to construct models of mildly flattened , cuspy density profiles , typical for elliptical galaxies , having a varying degree of figure rotation .",
    "we consider a @xmath93 @xcite model with axis ratios @xmath94 , which rotates about its short axis .",
    "this is one of the models that was studied in @xcite in the context of orbit analysis .",
    "the distinct feature of moderately cuspy ( @xmath93 ) triaxial dehnen models is the rich network of resonant and thin of motion in three directions satisfy a resonant relation @xmath95 with integer @xmath96 . ]",
    "orbits , which are clearly seen on frequency map plots ( e.g.  @xcite , fig .  9 , or @xcite , fig .  2 ) .",
    "orbits associated with these resonances have a variety of shapes and are important ingredients of self - consistent models , replacing regular box orbits that appear in models with constant - density cores ( the non - resonant box orbits are generally chaotic in cuspy potentials ) .",
    "the effect of rotation on regular box and thin orbits is the so - called `` envelope doubling '' @xcite , caused by changing the sign of the coriolis force as the orbit travels with positive or negative angular momentum . @xcite",
    "have shown that this effect does not stabilize the chaotic orbits by converting them into regular ones that avoid passing through the centre , as has been suggested by @xcite : on the contrary , the fraction of chaotic orbits in rotating models is higher than in non - rotating ones ( cf . * ? ? ?",
    "* ) , and increases with pattern speed , although some of them become converted to regular tube - like orbits when the rotation is high enough .",
    "thus , the question raised by @xcite is whether the self - consistent models could be constructed for moderate to high pattern speeds , and we address this question below",
    ".    , labelled by their corotation radius .",
    "thick lines are the initial models , and thin lines show models evolved for 1000 time units .",
    "the original models had a variable @xmath97 axis ratio , ranging from 0.75 in the central part to 1 beyond the corotation radius .",
    "evolved models largely maintained their initial shape , although becoming somewhat rounder ( this effect was most noticeable for models with extreme angular momentum ) . ]    , correspondingly ) . ]",
    "@xcite for triaxial dehnen models with figure rotation , seen along the intermediate ( @xmath19 ) axis , plotted as a function of distance to the centre @xmath98 ; half of the mass lies within @xmath99 .",
    "this parameter characterizes the amount of streaming motion , normalized to the total mean - square velocity ; a value of 0.1 separates slow from fast rotators . in the `` default '' models with no kinematic constraints ,",
    "streaming motion is generally proportional to the pattern speed , but there is a lot of freedom in it : for two additional models with the same pattern speed but maximizing or minimizing the angular momentum , it varied in a much wider range ( the latter actually was counter - rotating with the figure of potential , which is shown by a negative value of @xmath100 ) . ]    we take several values for the pattern speed ( see table  1 in that paper ) , corresponding to the corotation radius @xmath101 equal to 20 , 10 , 5 and 2 , and construct schwarzschild models with @xmath91 orbits , @xmath102 constraints , and the initial conditions generated using either eddington or axisymmetric jeans equation ( the latter produces more orbits that rotate in the same sense as the figure of potential , but the results did not differ significantly between these two approaches for these mildly flattened models ) .",
    "it was quickly discovered that the model can not maintain elongated shape beyond corotation , so we modified the density profile to have a variable @xmath103 axis ratio , which was kept at the value 0.75 up to @xmath104 , and further out gradually changed towards unity ( fig .",
    "[ fig : axis_ratio ] ) ; furthermore , we did not attempt to constrain the azimuthal distribution of mass outside @xmath101 .",
    "we confirmed that the degree of chaoticity of all major orbit families in general increased with the pattern speed .",
    "considering the orbit population in the region @xmath105 , which encloses roughly half of total mass , we found that all models except the most rapidly rotating one contain around 40% short - axis tubes and 20% resonant and thin orbits , while in the most rapidly rotating model nearly 80% orbits are short - axis tubes .",
    "we then evolved @xmath0-bodyrepresentations of each model for 1000 time units with gyrfalcon , using @xmath106 particles and a softening length of 0.01 .",
    "we measured the shape and orientation of the models , using both fourier analysis of the surface density and the method of inertia tensor ( see * ? ? ?",
    "* for a discussion of its variants ) .",
    "the models turned out to be rather stable : by the end of the simulation all of them largely retained their shape and pattern speed ( fig .",
    "[ fig : patternspeed_dehnen ] ) , the latter changed by at most 15% ( recall that the most rapidly rotating model has performed around 40 full revolutions by that time ) .",
    "we also briefly explored how the pattern speed is related to the angular momentum of our models . with the default settings , the total angular momentum turned out to be roughly proportional to the pattern speed .",
    "for the model with @xmath107 we created two additional solutions that minimized and maximized the total angular momentum , adding corresponding terms into the penalty function ( e.g. * ? ? ? * ) .",
    "the former resulted in a model where the streaming velocity and pattern speed were directed in the opposite sense , while in the latter case almost all orbits rotated in the same direction ( fig .",
    "[ fig : angmom_lambda_dehnen ] ) . both of these models were confirmed to be reasonably stable in @xmath0-bodysimulations ; the model with maximum streaming motion actually had increased the pattern speed by @xmath108 .",
    "the axis ratios of these models by the end of simulation were closer to unity than for the `` default '' models , although they still retained distinctly triaxial shapes .",
    "for the next test , we consider an analytic potential model with a miyamoto  nagai disc , a ferrers bar and a plummer bulge , with the same parameters as in @xcite ; similar models were previously explored in @xcite , etc .",
    ", in the context of orbit analysis , while @xcite has constructed two - dimensional ( in the equatorial plane ) schwarzschild models for a similar density profile ( without the bulge component ) .",
    "the pattern speed is chosen so that the corotation radius is just beyond the end of the bar .",
    "we combined the density profiles of all three components into one model and did not require the orbits to fit each of them separately , as in section  [ sec : axisymmetric ] .",
    "we considered several choices for the number of orbits ( up to @xmath109 ) and density constraints ( up to @xmath110 ) , as well as for the generation of initial conditions ( using axisymmetric jeans equation with different choices of @xmath25 , and launching orbits from the vicinity of stable periodic orbits ) .",
    ", as a function of orbit index ( sorted in energy ) .",
    "in the ideal case , it should be narrowly spread around @xmath111 , but in this case this happens only at small or large energies ; around the energy corresponding to the end of the bar the model barely manages to satisfy the constraints by using only a few orbits with relatively high weights .",
    "this usually indicates troubles in finding a self - consistent solution . ]",
    "the results of all these experiments suggest that there is something unrealistic about the density model that we attempt to construct self - consistently .",
    "while the models with a coarse spatial grid could be constructed , the distribution of orbit weights in the solution turns out to be very uneven , especially in the region around the end of the bar ( fig .",
    "[ fig : weights ] ) .",
    "furthermore , a detailed inspection of the surface density map of the schwarzschild model revealed that it did not exactly match the analytic model , having sharper edges at the end of the bar , even though their discretized versions were equal .",
    "an attempt to refine the spatial grid resulted in the model becoming infeasible , no matter how many orbits we tried . on the other hand , when we restricted the orbits to a two - dimensional plane and fitted the surface density , as in @xcite , the model was feasible and matched the projected density very well ; however , with zero velocity in @xmath2 direction it is not in a dynamical equilibrium .",
    "the model also turned out to be unstable when tested by an @xmath0-bodysimulation and quickly ( within one rotation period ) transformed itself into a rounder and more slowly - rotating shape , with a less prominent bar .",
    "we repeated the experiment with a model that lacked a central bulge , and it also demonstrated a similar slowdown of pattern speed ( by some 30% after five rotation periods ) , while the bar became shorter and narrower .",
    "we thus rule out the possibility that the bulge was the reason for this evolution .      in the previous sections , we used analytically defined potential  density pairs to create our schwarzschild models , while in this section we will use densities and potentials extracted from @xmath0-bodysimulations .",
    "the latter approach is , of course , much more realistic than the former , because the components are fully self - consistent instead of rigid , and , furthermore , because they have grown naturally under the influence of the total gravity of their system .",
    "thus their shapes and mass distributions can be much more complex than what simple analytic formulae can describe .",
    "as simulations have shown , barred galaxies are not steady - state systems ( for a review see * ? ? ?",
    "* and references therein ) .",
    "the bar region is ready to emit angular momentum , while the resonant regions in the outer disc and particularly in the halo are ready to absorb it @xcite so that there is a redistribution of angular momentum within the galaxy , as a result of which a number of the properties of the galaxy change @xcite .",
    "thus bars become longer and stronger and their pattern speed decreases with time .",
    "thus barred galaxies will necessarily have some non - stationarity and this goes against the assumption of a steady state ( at least in the rotating frame ) , implied by the schwarzschild method .",
    "they therefore present an additional challenge for this method .",
    "can such models be built ? and , if yes , can their evolution match that of the density distribution we are trying to model , or at least provide some useful information about secular evolution ?",
    "these interesting questions will the subject of a future paper , so that only a short summary of the results relevant to the schwarzschild modelling will be given here .    although it is now well established that barred galaxies evolve , it is still unclear how strong this evolution is . simulations have shown that the extent to which the angular momentum is redistributed , and therefore how important the corresponding changes in the galactic properties are , depends on the properties of the simulated galaxy .",
    "it is thus difficult , if at all possible , to use simulations to set constraints on evolution .",
    "furthermore , observations show no consensus , since their results advocate evolution ranging from relatively little @xcite to quite important ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "it is therefore necessary to consider both weak and strong secular evolution models .",
    "we will here attempt to model two examples of barred galaxies , extracted from simulations chosen so as to have as different secular evolutions as possible ; one being very little ( model a ) and the other quite strong ( model b ) .",
    "these two simulations are similar to the md and mh ones considered by @xcite , having the same initial mass distributions for the halo and disc , i.e. the same rotation curves ( see fig .  1 of that paper ) and the same disc - to - halo mass ratio",
    ". thus the halo of model b is much more centrally concentrated than that of model a. we take a snapshot from each of the two simulation at a time very near the beginning of its secular evolution phase and apply the schwarzschild method to construct a steady - state , two - component dynamical model , using as constraints only the density distribution of both the disc and the halo .",
    "these are derived in a non - parametric way from the particle positions in the original snapshot . for the disc",
    "we also need to include figure rotation , i.e. we need an estimate for the pattern speed . since we want to test whether it is possible to build models in the absence of kinematic information , we can not use the @xcite method to obtain the pattern speed @xmath112 .",
    "instead , we tried values in a range encompassing the `` correct '' one , i.e. the value obtained from the simulations .",
    "the original @xmath0-bodymodels had @xmath113 disc particles and @xmath114 halo particles . in order to reduce the noise and transient features in the disc component",
    ", we followed @xcite and @xcite and stacked five consecutive snapshots from the original simulation , after rotating them so as to align their bar major axes .",
    "the potential of the disc was represented with a cylindrical spline expansion with @xmath115 azimuthal harmonics . for the halo we used a spline spherical - harmonic expansion , keeping only the monopole term for model a ( which was found to be nearly - spherical ) , and additionally the quadrupole terms for model b ( which is mildly triaxial in the central parts , see @xcite ) .",
    "we used @xmath109 orbits for each component , with the disc and halo density model discretized into @xmath116 and @xmath117 cells , respectively .",
    "the library of orbits for the halo component were created using the isotropic eddington distribution function computed for a spherical approximation of the true density profile , while for the disc component we used the axisymmetric jeans equations , with the meridional anisotropy parameter @xmath118 .",
    "a comparison of the latter with the kinematic properties of the disc in the original simulation snapshot shows that the assumption of constant @xmath25 is clearly not very good : it varies from @xmath119 in the centre to @xmath120 at large radii .",
    "even so , we were able to construct schwarzschild models for both cases a and b. these have a kinematic structure which is very similar to that of the original model , if the pattern speed is the `` correct '' one .",
    "apparently , for these models there is not much freedom in the solution , so that even without any additional kinematic constraints ( apart from adopting the `` correct '' pattern speed value ) they turned out to be close to the original models .",
    "the feasibility of constructing a schwarzschild model does not imply anything about its stability properties , or about the amount of secular evolution it will have once it is allowed to evolve .",
    "note that this angular momentum exchange , and therefore evolution , can occur only if both the disc and the halo are represented as `` live '' particles , as opposed to a static potential .    to test the evolution",
    ", we converted the schwarzschild models to @xmath0-bodyrepresentations using the same number of particles as the original snapshots .",
    "we then evolved them using two simulation codes : gadget-2 @xcite and gyrfalcon ; the results were quite similar ( cf .",
    "* ) , except that the gadget snapshots need to be re - centred .",
    "below we use the data from the gyrfalcon simulations .",
    "the simulations were run for 800 time units ( same units as in @xcite ) ; the original models performed about 12 full revolutions during this time .",
    "we first tested the internal stability of each disc component by performing simulations following the evolution of each disc in the static potential of its host rigid halo , represented by a spline - interpolated spherical - harmonic expansion .",
    "for this , we used the external potential feature in gyrfalcon with the potential computed using the smilepot library , essentially the same as in the original schwarzschild model .",
    "the absence of any slowdown ( fig .",
    "[ fig : pattern ] , dotted lines ) confirms that the models are indeed stable .",
    "the second test involves the full , two - component system .",
    "we first evolved the simulation snapshots and give the results for their pattern speed in fig .",
    "[ fig : pattern ] ( solid lines ) . that of model a did not substantially change over the course of the simulation , while that of model b decreased roughly by a third .",
    "we then evolved the schwarzschild models and found a surprisingdiversity of behaviour .",
    "models with pattern speeds higher than the `` correct '' value ( i.e. the value obtained from the simulation ) tend to slow down more rapidly , especially in the case a. models with pattern speeds lower than `` correct '' evolved less , but in opposite directions for the two cases .",
    "models with the `` correct '' pattern speed evolved rather little .",
    "thus , the evolution of model a is very similar to that of the snapshot it was built to represent .",
    "however , we found also little evolution for model b , i.e. this schwarzschild model evolved much less than the snapshot it was built to represent . from @xcite , we expect this difference to be linked to the properties of the halo rather than the disc . to test this , we created a `` hybrid '' model with the disc taken from the original simulation , and the halo created with the schwarzschild method .",
    "this model showed little evolution , similar to the purely schwarzschild model .",
    "we are examining the reasons for this behaviour in a separate study .",
    "in this paper , we have used the schwarzschild orbit superposition method to construct several quite different self - consistent equilibrium galactic models .",
    "this method is very general and powerful , but one has to keep in mind several considerations .",
    "first , the basic assumption behind this and virtually every other method for constructing dynamical models is that the system under study is in a stationary state .",
    "this needs not be the case , for instance , if we model non - axisymmetric disc galaxies , in which a complex interplay between local and global instabilities , resonances , dynamical friction and other mechanisms leads to constant evolution , even in the absence of dissipation .",
    "diffusion of chaotic orbits may also play a role in driving the secular evolution of both elliptical ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) and disc galaxies ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "thus the models that we intend to be in a steady state , may turn out to evolve considerably , undermining our assumption . in application to real galaxies , it might be possible to create a model that matches all existing observations , but we can not ensure that its evolution will be the same as for the original galaxy .",
    "the example of section  [ sec : models_nbody ] shows that we could construct a nearly stationary model , while the original @xmath0-bodysimulation ( not a real galaxy , though ) continued to evolve substantially .",
    "the latter example also reminds about another conceptual problem : we always use a certain set of constraints in our methods , but there might exist other possible factors that we do not take into account , but that may distinguish between otherwise similar models having different internal structure and dynamics .",
    "an obvious example is the non - uniqueness of deprojection of a non - spherical galaxy @xcite , or the insufficiency of using only the first two velocity moments to constrain the mass distribution , which could be alleviated by taking the full line - of - sight velocity distribution ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) . in section  [ sec : models_nbody ]",
    ", we only used the information about particle positions , not velocities , to construct a model which turned out to be quite close to the original one in terms of velocity profiles ; nevertheless , had we imposed additional kinematic constraints , the model could have different properties .",
    "this also highlights another complication , specific to the schwarzschild method .",
    "namely , it provides a solution that satisfies the given constraints in the best possible way , but such a solution may not be unique . in practice",
    ", this is circumvented by adding some regularization procedures @xcite , but a rigorously justified method for choosing one particular solution out of many is missing .    yet",
    "another issue is related to the difficulties in interpreting the outcome of schwarzschild modelling in terms of convergence , illustrated by the model of section  [ sec : barreddisc ] .",
    "our practical experience suggests that for a well - behaved model , with a large margin of feasibility and the number of orbits exceeding the number of constraints by a large factor ( @xmath121 , i.e.  an `` underconstrained '' model ) , regularization tends to create a narrowly peaked distribution of orbit weights .",
    "conversely , if there are only a small number of orbits that get a high weight , this usually indicates that the required constraints are hard or impossible to satisfy exactly , implying that the chosen density profile might not be possible to realize with a self - consistent distribution function .",
    "note , however , that a poor choice of initial conditions can also result in bad convergence , and that the inclusion of additional ( e.g.  kinematic ) constraints may interfere with the ability of the solution to exactly match the discretized density profile ; for this reason , the schwarzschild code of @xcite tolerates a few percent relative error in cell masses .",
    "there are many different methods for constructing equilibrium models of disc galaxies , which we have reviewed in section  [ sec : overview ] , and tested some of them in section  [ sec : axisymmetric ] , but very few are suitable for non - axisymmetric ( e.g.  barred ) galaxies , and no other implementation of schwarzschild method is capable to deal with full three - dimensional models of multicomponent triaxial galaxies with figure rotation .",
    "although our code in the current version is not intended for creating models based on observational data , it nevertheless presents a first step towards this task .",
    "most models of external galaxies and even the milky way are created using the approximation of axisymmetry , which may introduce substantial biases in recovered galaxy parameters , such as the mass - to - light ratio @xcite and the mass of the central supermassive black hole @xcite .",
    "moreover , the assumption of constant coefficient @xmath25 of velocity anisotropy in the meridional plane , commonly used in axisymmetric jeans analysis @xcite , is clearly violated for most models that we have considered .",
    "thus having a more flexible modelling method will be increasingly important for the current and forthcoming large galactic surveys , such as atlas@xmath122 @xcite or califa @xcite , that yield a wealth of kinematic data for a large sample of galaxies . from the theoretical side ,",
    "the interaction of non - axisymmetric discs with triaxial haloes presents a number of interesting effects ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) , thus a flexible schwarzschild method for creating such composite models is a valuable asset .",
    "simulations have shown that galactic discs are prone to bar instabilities @xcite , with a growth rate which is function of many galaxy properties , such as halo , bulge , or gas mass , velocity dispersion in the disc etc .",
    "( see * ? ? ?",
    "* for a review ) .",
    "thus such discs are not stationary .",
    "yet in section  [ sec : axisymmetric ] , we showed that the smilesoftware is capable of constructing axisymmetric multicomponent models of disc galaxies .",
    "how are these two statements compatible ?",
    "it is interesting to note that , although we did not set any kinematic constraints , all the disc  bulge  halo models webuilt have high velocity dispersions in the disc , as can be seen in fig .",
    "[ fig : disk_kinem_q ] .",
    "for all models , the minimum @xmath84 value is between 1.4 and 1.7 , and occurs at radii between one and three disc scalelengths .",
    "moreover , at radii less than one and more than three disc scalelengths , the @xmath84 values are much larger ( see fig .  [",
    "fig : disk_kinem_q ] ) .",
    "this ensures that the bar forms very slowly @xcite and the model is sufficiently close to stationarity for a schwarzschild model to be possible .    the fact that , in the absence of kinematical constraints , the schwarzschild method finds a relatively hot disc as a solution , underlines the necessity of such constraints when modelling real galaxies and also suggests that it may not be possible to model cold discs using this method , unless the bar instability is slowed down sufficiently by the halo , bulge or gas .",
    "this leaves a sufficiently large range of axisymmetric disc galaxies to which the schwarzschild method can be applied , including the lenticulars , the early - type spirals , and in general any hot discs .      in subsection",
    "[ sec : dehnen ] , we built models for cuspy triaxial ellipsoids , which can be used to represent elliptical galaxies . while we have not attempted an extensive exploration of the relevant parameter space ,",
    "our results indicate that , from the dynamical point of view , cuspy triaxial elliptical galaxies may exist in a broad range of pattern speeds .",
    "observational studies indicate that elliptical galaxies fall into two classes  slow and fast rotators , with the former more likely to be triaxial @xcite . in terms of the kinematic rotation parameter @xmath100 introduced in that paper ,",
    "our models cover the whole range from slow to fast rotators ( fig .",
    "[ fig : angmom_lambda_dehnen ] ) .",
    "if we consider only models with no other constraint than the density distribution and the degree of figure rotation , then we find a rough general trend in the same sense as observations , i.e. more triaxial galaxies have smaller @xmath100 values . if , however , we introduce further constraints , such as minimizing , or maximizing the global angular momentum , then the difference in the @xmath100 value is much bigger than that due to a change of the pattern speed .",
    "thus it becomes clear that further work on such models is necessary , e.g. to extend the axisymmetric schwarzschild models of @xcite and answer whether it is possible to have strongly triaxial configurations with considerable figure rotation and large rotation parameters .      as a next step",
    ", we attempted to use the schwarzschild method to construct models of galaxies composed of a disc , a halo and a strong bar component .",
    "the potential and density of each of these components were given by analytic functions , as in orbital structure studies .",
    "although we made a large number of trials , we failed to construct a stable , self - consistent such model .",
    "more than one explanations can come to mind for this .",
    "one possibility is that the simple superposition of a number of rigid components may be far from a reasonable dynamical system . indeed ,",
    "all these components interact gravitationally and that could substantially modify their density distributions . for example",
    ", it is known that discs do not stay axisymmetric in the presence of bars , and form spirals , rings , density minima / maxima around some lagrangian points , etc . , while haloes will not stay spherically symmetric at small radii if the potential of the thin discs dominates in the inner parts of the galaxy .",
    "a second alternative , which to our eyes is the most likely one , is that , as discussed in @xcite and @xcite , the vertical mass distribution of ferrers ellipsoids is unrealistic .",
    "the real shape of bars is much more complex than a spheroid , having two components , one long and thin ( both horizontally and vertically ) and the other short and thick @xcite .",
    "the latter is also known as the boxy or peanut bulge , or the barlens . since the orbits in the bar potential are able reproduce this complex bar shape ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) , they may not be able to reproduce the simple ellipsoidal shape of the ferrers bars as well .",
    "a further argument in favour of this alternative is the fact that it has been possible to make two - dimensional models of barred galaxy potentials , as shown both by @xcite and in section  [ sec : barreddisc ] .",
    "moreover , in section  [ sec : models_nbody ] we have been able to make a schwarzschild model for barred galaxies having a realistic vertical distribution .",
    "we also attempted to build schwarzschild models for two @xmath0-body snapshots taken at the beginning of the secular evolution phase of the bar and using only the densities as a constraint .",
    "one of the two cases was specifically chosen from a simulation which showed hardly any bar evolution , while the other , on the contrary , was chosen from a simulation with a very strong evolution . for the former we were able to build a self - consistent model , which , when evolved , followed the evolution of the snapshot .",
    "for the latter , however , although we could build a self - consistent model , its evolution was considerably less than that of the simulation .",
    "this presumably means that , of all the velocity distributions compatible with the density distribution in the simulation , in absence of kinematical constraints , the schwarzschild model found the one which was nearest to stationarity ( see also the corresponding discussion in section  [ subsubsec : discuss - axisym ] ) .",
    "this may set some limits to the applicability of the schwarzschild method to barred galaxies , if barred galaxies are found to have non - negligible evolution .",
    "indeed , as shown by @xcite , the resonances in the halo absorb a large fraction of the angular momentum emitted from the bar region .",
    "since no kinematic constraints can be set on the haloes , the schwarzschild method may tend to provide self - consistent models fulfilling all the density constraints as well as some kinematic constraints for the disc , but whose evolution may be totally different from that of the real galaxy . thus more work is necessary here before the schwarzschild method can be massively applied to barred galaxies , including our own milky way .",
    "we have presented an implementation of the schwarzschild orbit superposition method for creating equilibrium dynamical models of non - spherical stellar systems .",
    "this is a further development of the publicly available smilecode @xcite , with the major new and improved features primarily targeting disc galaxies : a new general - purpose potential approximation in terms of two - dimensional spline - interpolated fourier expansion in cylindrical coordinates , which is accurate even for very flattened systems , full support for multicomponent systems and for figure rotation .",
    "the software is suitable not only for constructing self - consistent models with given properties , but also for analysing the orbital structure of a given potential , either specified analytically or taken from an @xmath0-bodysimulation ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "this opens up new possibilities for studying the properties of orbits relevant for the formation of bars , rings , spiral arms , etc . , which traditionally have been explored by integrating the motion of test particles in a given analytic potential @xcite , and could now be improved by taking these particles from a self - consistent model while retaining the smooth potential for the orbit calculation .",
    "one may even use several snapshots from an @xmath0-bodysimulation to construct a time - dependent smooth potential approximation and use it for orbit integration @xcite . to facilitate these applications , the module for computing potential and forces",
    "is presented as a separate library smilepot , with c and python interfaces and bindings to other stellar - dynamical software tools : nemo @xcite , amuse @xcite and galpy @xcite .",
    "we have confirmed the possibility of constructing steady - state models of disc galaxies , both axisymmetric and barred , with the schwarzschild method .",
    "we compared several existing codes for creating composite axisymmetric disc ",
    "halo models and found that smileperforms very well in this task , producing models that are closest to equilibrium .",
    "while elliptical galaxies are not the main subject of this paper , we also considered models resembling triaxial elliptical galaxies with density cusps and figure rotation .",
    "we have shown that they may exist in a wide range of pattern speeds and angular momenta , and are stable over many rotation periods .",
    "on the other hand , a barred disc model with an analytically defined potential , extensively used for orbit analysis in previous studies , turned out to be impossible to realize self - consistently , and the closest approximation to it was quite unstable dynamically .",
    "nevertheless , there exist models of barred disc galaxies embedded in nearly - spherical haloes , that appear to be in almost steady state .",
    "we have constructed two such models using density profiles extracted from @xmath0-bodysimulations , utilizing only information about particle positions .",
    "these models were shown to be reasonably stationary , and their kinematical properties were similar to the original @xmath0-bodymodels if the pattern speed matched these original simulations .",
    "interestingly , one of the original @xmath0-bodymodels demonstrated considerable evolution ( slowdown and growth of the bar ) , while the corresponding schwarzschild model evolved much less .",
    "we explore the reasons for this difference in a future work .",
    "* acknowledgements : * ev is grateful for the hospitality of laboratoire dastrophysique de marseille during his visit , thanks john magorrian and other participants of the 2nd gaia challenge meeting for stimulating discussions , and acknowledges support from the national aeronautics and space administration under grant no .",
    "nnx13ag92 g .",
    "ea acknowledges financial support to the dagal network from the people programme ( marie curie actions ) of the european union s seventh framework programme fp7/20072013/ under rea grant agreement number pitn - ga-2011 - 289313 , from the cnes ( centre national detudes spatiales  france ) and from the pncg ( programme national cosmologie et galaxies  france ) .",
    "ea also acknowledges hpc resources from genci ",
    "tgcc / cines ( grants x2013047098 and x2014047098 ) and from the mesocentre of aix  marseille universit ( program difomer ) .",
    "allen j. , palmer p. , papaloizou j. , 1990 , mnras , 242 , 576    athanassoula e. , 1992 , mnnras , 259 , 328    athanassoula e. , 2002 , mnras , 569 , 83    athanassoula e. , 2003 , mnras , 341 , 1179    athanassoula e. , 2005 , mnras 358 , 1477    athanassoula e. , 2007 , mnras , 377 , 1569    athanassoula e. , 2012 , mnras , 426 , l46    athanassoula e. , 2013 , in j. falcn - barroso j. and knapen j.h .",
    ", eds , _ secular evolution of galaxies _ , cambridge university press , cambridge , p. 305",
    "athanassoula e. , 2015 , in laurikainen e. , peletier r. , gadotti d. , eds . , _",
    "galactic bulges _ ; astrophysics and space science library , vol.418 , springer ( arxiv:1503.04804 )    athanassoula e. , bienaym o. , martinet l. , pfenniger d. , 1983 , a&a , 127 , 349    athanassoula e. , laurikainen e. , salo h. , bosma a. , 2014 , mnras , submitted ( arxiv:1405.6726 )    athanassoula e. , misiriotis a. , 2002 , mnras , 330 , 35    athanassoula e. , sellwood j. a. , 1986 , mnras , 221 , 213    barnes j. , 1988 , apj , 331 , 699    berentzen i. , heller c. , shlosman i. , fricke k. , 1998 , mnras , 300 , 49    berentzen i. , shlosman i. , jogee s. apj , 637 , 582    binney j. , mcmillan p. , 2011",
    ", mnras , 413 , 1889    binney j. , tremaine s. , 2008 , _ galactic dynamics _ , 2nd edn . , princeton univ . press ,",
    "princeton , nj    bissantz n. , debattista v. , gerhard o. , 2004 , apj , 601 , l155    boily ch .",
    ", kroupa p. , pearrubia j. , 2001 , new astron .",
    ", 6 , 27    bovy j. , 2015 , apjs , 216 , 29    brown m. , papaloizou j. , 1998 , mnras , 300 , 135    cappellari m. , 2008 , mnras , 390 , 71    cappellari m. , emsellem e. , bacon r. , 2007 , mnras , 379 , 418    cappellari m. , emsellem e. , krajnovi d. , 2011 , mnras , 413 , 813    capuzzo - dolcetta r. , leccese l. , merritt d. , vicari a. , 2007 , apj , 666 , 165    cheung , e. et al .",
    "2013 , apj , 779 , 162    clutton - brock m. , 1972 , ap&ss , 16 , 101    clutton - brock m. , 1973 , ap&ss , 23 , 55    cohl h. , tohline j. , 1999 , apj , 527 , 86    coln p. , valenzuela o. & klypin a. , 2006 , apj , 644 , 687    contopoulos g. , grosbl p. , 1988 ,",
    "a&a , 197 , 83    contopoulos g. , grosbl p. , 1989 ,",
    "a&ar , 1 , 261    contopoulos g. , harsoula m. , 2013 , mnras , 436 , 1201    contopoulos g. , papayannopoulos t. , 1980 , a&a , 92 , 33    cretton n. , de zeeuw t. , van der marel r. , rix h .- w . , 1999 ,",
    "apjs , 124 , 383    cuddeford p. , 1993 ,",
    "mnras , 262 , 1076    debattista v. , sellwood j. , 2000 , apj , 543 , 704    deibel a. , valluri m. , merritt d. , 2011 , apj , 728 , 128    dehnen w. , 1993 , mnras , 265 , 250    dehnen w. , 2000 , aj , 119 , 800    dehnen w. , 2000 , apj , 536 , l39    dehnen w. , 2002 , j.comp.phys . , 179 , 27    dehnen w. , 2009 , mnras , 395 , 1079    dehnen w. , binney j. , 1998 , mnras , 294 , 429    de lorenzi f. , debattista v. , gerhard o. , sambhus n. , 2007 , mnras , 376 , 71    de zeeuw t. , merritt d. , 1983 , apj , 267 , 571    earn d. , 1996 , apj , 465 , 91    elmegreen b. , elmegreen d. , knapen j. , buta r. , block d. , puerari i. , 2007 , apj , 670 , 97    emsellem e. , cappellari m. , krajnovi d. , et al . , 2007 , mnras , 379 , 401    fortin p. , athanassoula e. , lambert j .- c .",
    ", 2011 , a&a , 531 , 120    fragkoudi f. , athanassoula e. , bosma a. , iannuzzi f. , 2015 , mnras , 450 , 229    fux r. , 2001 , a&a , 373 , 511    gebhardt k. , richstone d. , kormendy j. , et al . , 2000 ,",
    "aj , 119 , 1157    gerhard o. , binney j. , 1985 , mnras , 216 , 467    gerhard o. , binney j. , 1996 , mnras , 279 , 993    gradshteyn i. , ryzhik i. , 1965 , _ tables of integrals , series and products _",
    ", 4th edn . , academic press , new york    hfner r. , evans n. , dehnen w. , binney j. , 2000 , mnras , 314 , 433    harsoula m. , kalapotharakos c. , 2009 , mnras , 394 , 1605    hasan h. , pfenniger d. , norman c. , 1993 , apj , 409 , 91    hernquist l. , 1993 , apjs , 86 , 389    hernquist l. , ostriker j. , 1992 , apj , 386 , 375    hohl f. 1971 , apj , 168 , 343    holley - bockelmann k. , weinberg m. , katz n. , 2005 , mnras , 363 , 991    hunt j. , kawata d. , 2013 , mnras , 430 , 1928    hunt j. , kawata d. , martel h. , 2013 , mnras , 432 , 3062    iannuzzi f. , athanassoula e. , 2015 , mnras , 450 , 2514    kalapotharakos c. , patsis p. , grosbl p. , 2010 ,",
    "mnras , 408 , 9    kandrup h. , siopis c. , 2003 , mnras , 345 , 727    kaufmann d. , contopoulos g. , 1996 , a&a , 309 , 381    kazantzidis s. , magorrian j. , moore b. , 2004 , apj , 601 , 37    kim t. , sheth k. , gadotti d. , et al . , 2015 , apj , 799 , 99    kormendy j. , kennicutt r. , 2004 , ara&a , 42 , 603    kuijken k. , dubinski j. , 1995 , mnras , 277 , 1341    lablanche p .- y .",
    ", cappellari m. , emsellem e. , et al .",
    ", 2012 , mnras , 424 , 1495    lawson c. , hanson r. , 1974 , _ solving least - squares problems _ , prentice",
    " hall , nj    little b. , carlberg r. , 1991a , mnras , 250 , 161    little b. , carlberg r. , 1991b , mnras , 251 , 227    long r. , mao s. , 2010 , mnras , 405 , 301    long r. , mao s. , shen j. , wang y. , 2013 , mnras , 428 , 3478    lynden - bell d. , kalnajs a. j. , 1972 , mnras , 157 , 1    mcglynn t. , 1984 , apj , 281 , 13    machado r. , athanassoula e. , 2010 , mnras , 406 , 2386    mcmillan p. , dehnen w. , 2007 , mnras , 378 , 541    manos t. , athanassoula e. , 2011 , mnras , 415 , 629    manos t. , machado r. , 2014 , mnras , 438 , 2201    merritt d. , fridman t. , 1996 , apj , 460 , 136    merritt d. , saha p. , 1993",
    ", apj , 409 , 75    merritt d. , valluri m. , 1996 , apj , 471 , 82    monari g. , antoja t. , helmi a. , 2013 , arxiv:1306.2632    muzzio j. , 2006 , celest .",
    ", 96 , 85    oneill j.  k. , dubinski j. , 2003 , mnras , 346 , 251    onken c. , valluri m. , brown j. , et al . , 2014 , apj , 791 , 37    patsis p. , skokos ch .",
    ", athanassoula e. , 2002 , mnras , 337 , 578    prez i. , aguerri j.  a.  l. , mndez - abreu j. , 2012 , a&a , 540 , a103    pelupessy i. , van elteren a. , de vries n. , mcmillan s. , drost n. , portegies zwart s. 2013 , a&a , 557 , a84    pfenniger d. , 1984a , a&a , 134 , 373    pfenniger d. , 1984b , a&a , 141 , 171    pfenniger d. , friedli d. , 1991 , a&a , 252 , 75    pfenniger d. , friedli d. , 1993 , a&a , 270 , 561    portegies zwart s. , mcmillan s. , van elteren e. , pelupessy i. , de vries n. , 2013 , comput .",
    "commun . , 184 , 3 , 456    qian e. , 1993 , mnras , 263 , 394    richstone d. , tremaine s. , 1988 , apj , 327 , 82    robin a. , reyl c. , derrire s. , picaud s. , 2003 , a&a , 409 , 523    robijn f. , earn d. , 1996 , mnras , 282 , 1129    rodionov s. , athanassoula e. , sotnikova n. , 2009 , mnras , 392 , 904    romero - gmez m. , masdemont j. , athanassoula e. , garca - gmez c. , 2006 , a&a , 453 , 39    romero - gmez m. , athanassoula e. , antoja t. , figueras f. , 2011 , mnras , 418 , 1176    snchez s. , kennicutt r. , gil de paz a. , et al . , 2012 , a&a , 538 , 8    schwarzschild m. , 1979 , apj , 232 , 236    schwarzschild m. , 1982 , apj , 263 , 599    schwarzschild m. , 1993 , apj , 409 , 563    sellwood j. , 2003 , apj , 587 , 638    sellwood j. , 2013 , apj , 769 , l24    sellwood j. , valluri m. , 1997 , mnras , 287 , 124    sheth k. , elmegreen d. , elmegreen b. , et al . , 2008 ,",
    "apj , 675 , 1141    siopis c. , 1998 , _ nonuniqueness and structural stability of self - consistent models of elliptical galaxies _ , phd thesis , univ .",
    "florida    skokos ch . , patsis p. , athanassoula e. , 2002 , mnras , 333 , 847    springel v. , 2005 , mnras , 364 , 1105    syer d. , tremaine s. , 1996 , mnras , 282 , 223    teuben p. , 1995",
    ", in shaw r. a. , payne h. e. , hayes j. j. e. , eds , asp conf .",
    "77 , astronomical data analysis software and systems iv .",
    ", san francisco , p. 398",
    "teuben p. , sanders r. , 1985 , mnras , 212 , 257    thakur p. , jiang i .-",
    "g . , das m. , chakraborty d.k .",
    ", ann h.b . , 2007 , a&a , 475 , 821    thomas j. , jesseit r. , naab t. , saglia r. , burkert a. , bender r. , 2007 , mnras , 381 , 1672    tremaine s. , weinberg m. , 1984 , apj , 282 , l5    valluri m. , merritt d. , 1998 , apj , 506 , 686    valluri m. , merritt d. , emsellem e. , 2004 , apj , 602 , 66    van den bosch r. , van de ven g. , verolme e. , cappellari m. , de zeeuw t. , 2008 , mnras , 385 , 647    van den bosch r. , de zeeuw t. , 2010 , mnras , 401 , 1770    valenzuela o. , klypin a. , 2003 , mnras , 345 , 406    vasiliev , e. 2013 , mnras , 434 , 3174    vasiliev e. , athanassoula e. , 2012 , mnras , 419 , 3268    voglis n. , stavropoulos i. , kalapotharakos c. , 2006 , mnras , 372 , 901    wang y. , zhao h. , mao s. , rich r. , 2012 , mnras , 427 , 1429    wang y. , mao s. , long r. , shen j. , 2013 , mnras , 435 , 3437    weinberg m. , 1999 , aj , 117 , 629    widrow l. , dubinski j. , 2005 , apj , 631 , 838    widrow l. , pym b. , dubinski j. , 2008 , apj , 679 , 1239    wozniak h. , pfenniger d. , 1997 , a&a , 317 , 14    yurin d. , springel v. , 2014 , mnras , 444 , 62    zemp m. , gnedin o. , gnedin n. , kravtsov a. 2011 , apjs , 197 , 30    zhao h .- s .",
    ", 1996a , mnras , 278 , 488    zhao h .- s . , 1996b , mnras , 283 , 149",
    "to evaluate the potential at an arbitrary point in cylindrical coordinates @xmath7 , we may use the following algorithm ( see @xcite , section 2.6.2 for razor - thin discs and @xcite for axisymmetric discs with arbitrary vertical profile ) .",
    "let the density be represented by a fourier series @xmath123 so that @xmath124 the potential generated by this density is represented as @xmath125 with each term in the expansion            the spline potential expansion in cylindrical coordinates is initialized by computing the coefficients @xmath127 either from a given analytic density profile , or from an @xmath0-bodysnapshot , on a two - dimensional grid in @xmath9 covering a rectangle @xmath128 . to improve resolution at small radii",
    ", we use logarithmic scaling of coordinates ( @xmath129 , and similar for @xmath2 ) , and to reduce the approximation error at large radii , we scale the potential by a factor @xmath130 , so that for large @xmath9 the scaled coefficient for @xmath131 tends to a constant . here",
    "@xmath132 is a characteristic radial scale of the system .",
    "the evaluation of potential , forces and density at an arbitrary point within the box is done by computing interpolating splines or their derivatives . outside the box",
    ", density is assumed to be zero , and the potential and forces are computed using a quadrupole approximation to the mass distribution .",
    "[ fig : accuracy ] demonstrates that for strongly flattened models , the cylindrical spline expansion is superior to the spherical - harmonic expansion , although if the potential is initialized from an @xmath0-bodysnapshot , the accuracy is mainly limited by discreteness noise ."
  ],
  "abstract_text": [
    "<S> we present an implementation of the schwarzschild orbit superposition method which can be used for constructing self - consistent equilibrium models of barred or non - barred disc galaxies , or of elliptical galaxies with figure rotation . </S>",
    "<S> this is a further development of the publicly available code smile ; its main improvements include a new efficient representation of an arbitrary gravitational potential using two - dimensional spline interpolation of fourier coefficients in the meridional plane , as well as the ability to deal with rotation of the density profile and with multicomponent mass models . </S>",
    "<S> we compare several published methods for constructing composite axisymmetric disc  bulge  </S>",
    "<S> halo models and demonstrate that our code produces the models that are closest to equilibrium </S>",
    "<S> . we also apply it to create models of triaxial elliptical galaxies with cuspy density profiles and figure rotation , and find that such models can be found and are stable over many dynamical times in a wide range of pattern speeds and angular momenta , covering both slow- and fast - rotator classes . </S>",
    "<S> we then attempt to create models of strongly barred disc galaxies , using an analytic three - component potential , and find that it is not possible to make a stable dynamically self - consistent model for this density profile . </S>",
    "<S> finally , we take snapshots of two @xmath0-bodysimulations of barred disc galaxies embedded in nearly - spherical haloes , and construct equilibrium models using only information on the density profile of the snapshots . </S>",
    "<S> we demonstrate that such reconstructed models are in near - stationary state , in contrast with the original @xmath0-bodysimulations , one of which displayed significant secular evolution .    </S>",
    "<S> galaxies : structure  galaxies : spiral  methods : numerical </S>"
  ]
}