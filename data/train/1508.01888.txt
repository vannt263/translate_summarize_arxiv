{
  "article_text": [
    "wang - landau sampling ( wls ) @xcite is increasingly becoming an important tool for simulating a wide range of slow - relaxing , glassy systems which are not tractable by more conventional techniques such as molecular dynamics ( md ) or monte carlo ( mc ) sampling using metropolis algorithm . to date",
    ", wls has been applied to a wide variety of systems ranging from random bond and random field systems @xcite , atomic fluid @xcite and clusters @xcite , liquid crystals @xcite , polymers @xcite and proteins @xcite , to lipid membranes in explicit solvent @xcite . in md and mc , one frequently encounters the problem that the system gets trapped in some local minimum due to the presence of large barriers on the energy landscape @xcite .",
    "wls ( and related entropic sampling techniques @xcite ) , on the other hand , circumvents this problem by sampling from the density - of - states ( dos ) instead of the boltzmann distribution .",
    "since there are no energy barriers to overcome , the system readily moves back and forth between the high and low energy regions of phase space , thereby ensuring efficient sampling . due to the effectiveness of such multicanonical techniques , related methods such as replica - exchange multicanonical algorithm @xcite and statistical - temperature monte carlo @xcite are very efficient for simulating systems with rough energy landscapes .    although wls is initially believed to be free from the problem of slow relaxation , there is increasing evidence that wls is subjected to another kind of slowing down when applied to continuous systems . in an early study ,",
    "brown and schultess @xcite reported that for the ferromagnetic heisenberg model , wls is expensive when sampling from rare configurations close to the ground state .",
    "jayasri et al .",
    "@xcite , in their study of liquid crystals , reported that wls becomes extremely slow even for moderately large systems because the system often gets stuck in certain regions of configuration space . in their study of polypeptides and lenard - jones clusters using wls , poulain et al .",
    "@xcite also reported similar trappings of their systems .",
    "to examine the nature of these trappings , we consider two systems .",
    "the first is the two - dimensional @xmath0 square - lattice , frustrated @xmath1 model , @xmath2 where @xmath3 ( @xmath4 ) are @xmath1 spins , @xmath5 denotes summation over nearest - neighbor pairs .",
    "periodic boundary condition is used for both lattice dimensions .",
    "@xmath6 are identical independent random variables sampled from a gaussian distribution with zero mean and unit variance .",
    "single - spin mc moves are used .",
    "the second system is an 8-mer poly - alanine molecule in a medium with dielectric constant @xmath7 .",
    "we used the amber99-bs0 force - field @xcite and simulated using a modified version of the mosaics package @xcite .",
    "torsion angle moves were used .",
    "we choose these two systems as illustrations because they are simple enough but yet possess rough energy landscapes with many local minima .",
    "wls studies of the poly - alanine molecule have also been reported by poulain et al .",
    "@xcite .",
    "simulations were performed using the standard wls algorithm @xcite . in wls",
    ", the quantity of interest is the density - of - states @xmath8 , or the number of all possible states at the energy @xmath9 .",
    "once @xmath8 is known , the partition function can be calculated , @xmath10 where @xmath11 is the boltzmann constant and @xmath12 is the temperature , and most thermodynamic quantities can be obtained from @xmath13 .",
    "wls estimates @xmath8 via a random walk in energy space .",
    "trials for a state with energy @xmath14 to one with energy @xmath15 are accepted according to the transition probability , @xmath16 if @xmath8 is the true dos , eq . ( [ eq.transition_rule ] )",
    "obeys detailed balance .",
    "however , @xmath8 is initially unknown , and one makes a guess for it . whenever an energy @xmath9 is visited according to the transition rule eq .",
    "( [ eq.transition_rule ] ) , the dos is updated as @xmath17 where @xmath18 is called the modification factor .",
    "the role of the modification factor is to make gradual refinement of the initially inaccurate dos .",
    "one begins the simulation with a large @xmath18 ( usually @xmath19 ) and gradually lowers it , in stages , to 1 .",
    "when @xmath20 is reached , detailed balance for eq .",
    "( [ eq.transition_rule ] ) is recovered , and one obtains the true dos for @xmath8 . in practice ,",
    "one works with @xmath21 to prevent numerical overflow , and the update rule is @xmath22 . in our simulations",
    ", we start from @xmath23 and lowers the modification factor according to @xmath24 upon completing the @xmath25th stage of simulation .    in the original formulation of wls",
    ", one computes an energy histogram and uses its ` flatness ' as a criterion to proceed to the next stage of simulation .",
    "however , as this criterion has been found to be quite arbitrary by several subsequent studies @xcite , we use the criterion discussed in @xcite to lower @xmath26 .",
    "another modification we adopted here is the one suggested by zhou et al .",
    "@xcite that for continuous systems the dos should be linearly interpolated if the energy falls between the centers of two energy bins .",
    "hence in our analysis the dos is piecewise linear .",
    "the case of piecewise constant dos will be discussed at the end of this paper .",
    "figs . [ fig.spike](a ) and ( b ) show examples of the dos where the system exhibits signs of being trapped for the @xmath1 model and poly - alanine molecule , respectively .",
    "the main feature is the high spikes , which are formed because the random walker stayed for an inordinate amount of time in a single energy bin , resulting in most of the modification factor @xmath26 being accumulated there .",
    "we have checked that the system is capable of proposing new configurations with fairly large changes in energy with the mc step size we have used ( c.f .",
    "[ fig.trapped_vs_normal](b ) and discussion below ) . nevertheless , during the period of time when the random walker is stuck in a spiked bin , we found that all its mc moves result in small energy changes .",
    "the reason is not in a choice of small mc step size , but is due to the fact that the random walker has wandered close to a stationary point in configuration space . to ascertain that the random walker is close to a stationary point , we computed its energy gradient and found it to be very small indeed .",
    "[ fig.schematic ] is a schematic diagram illustrating the mechanism of trapping and how a spike develops .",
    "suppose , as shown in the inset , the system is at a local minimum with configuration @xmath27 and energy @xmath9",
    ". let @xmath9 lie within the bin @xmath28 as shown .",
    "as the random walker is at a local minimum , the proposed energy @xmath29 must be @xmath30 , and the change in energy is small because the first derivative vanishes . due to the steepness of the dos , the acceptance ratio @xmath31 $ ] is very small , the move is mostly rejected , and @xmath26 is added to the bin @xmath28 .",
    "this process repeats itself , with the dos at bin @xmath28 constantly increasing but the configuration hardly changing .",
    "if the system can propose a move to an energy , say @xmath32 or higher , then the move may be accepted and the random walker can escape the trap .",
    "but this is highly improbable due to the vanishing of the gradient .",
    "the situation becomes more serious as system size increases because one usually increases the bin width in order to cover a wider energy range and reduce computational cost ; however , the change in energy produced by single - spin or set of small torsion angle moves remains similar , and therefore becomes smaller relative to the increasing bin width .",
    "[ fig.trapped_vs_normal](a)-(c ) illustrate , for the @xmath1 model ( @xmath33 ) , typical behavior of a trapped trajectory , compared against ` normal ' ( i.e. , not trapped ) behavior .",
    "the trapped segment is taken from a continuous period of time the random walker is inside a spiked bin ( @xmath34 steps in this case ) .",
    "the normal segment is of similar length and taken from along the same trajectory but starting at a slightly earlier time before the random walker gets trapped . to monitor the configuration of the system , we computed the autocorrelation function , @xmath35 , \\label{eq.02}\\ ] ] where @xmath36 denotes the number of mc steps that have elapsed since the start of the segment .",
    "the results are shown in fig . [ fig.trapped_vs_normal](a ) .",
    "for the trapped segment , @xmath37 remains close to unity throughout , meaning that its configuration hardly changes ; for the normal segment , @xmath37 decays to zero very quickly .",
    "the inset in ( a ) plots the component of the force @xmath38 with the largest magnitude ( i.e. infinity norm ) versus @xmath36 .",
    "the force on the trapped segment is almost zero throughout . fig .",
    "[ fig.trapped_vs_normal](b ) is a scattered plot showing the proposed energy change @xmath39 versus the proposed angle change @xmath40 .",
    "as mentioned above , with the mc step size we are using , the random walker is able to , under normal conditions , propose new configurations with fairly large changes in energy , as shown by the large dispersion of blue points ( i.e. normal segment ) .",
    "however , when trapped , @xmath39 is very small compared to the normal segment , and is distributed asymmetrically with very few energy - lowering moves .",
    "the acceptance rate is @xmath411% and @xmath4160% for the trapped and normal segments , respectively .",
    "the energy distribution of the accepted moves are shown in fig . [ fig.trapped_vs_normal](c ) .",
    "for the trapped segment , the histogram is very narrow and asymmetric , with almost only energy - lowering moves being accepted .",
    "we also examined other cases of trappings , both for the @xmath1 model ( varying over a range of mc step sizes ) and the alanine peptide molecule , and found the above behavior to be general in both systems .",
    "spikes are usually formed during the early stages of the simulation when the dos is still rough . a small random bump on the dos like the one in fig .",
    "[ fig.schematic ] can serve as a ` seed ' for spike growth if the random walker accidentally visits a local minimum ( or maximum , where similar arguments apply ) whose energy happens to lie within the same energy bin as the bump .",
    "spikes do not necessarily have to form in the same bin everytime .",
    "this is because there are other local minima / maxima that reside in other energy bins .",
    "in addition , as shown in the inset of fig .",
    "[ fig.schematic ] , the random walker can sample other configurations , such as @xmath42 , with the same energy @xmath9 .",
    "this means that , spiking does not always occur in an energy bin where a spike was previously observed",
    ". therefore spiking events are highly unpredictable .",
    "a large amount of simulation time is wasted when the random walker is trapped because it spends less time sampling other parts of configuration space . when a spike is discovered at the end of one s simulation one",
    "should discard the results knowing it suffers from bad sampling , as shown later in our calculation of specific heat capacity .",
    "a simple fix to the problem would be to vary the energy bin width and/or sampling step size .",
    "unfortunately , it is not possible to know _ a priori _ the appropriate bin width and step size to choose to avoid spiking ( if at all possible ) , unless inordinately large step sizes are used in conjunction with small bin widths .",
    "even then , this is not a feasible general solution , as large moves make it difficult to sample low energy basins , while using small bin widths is impractical , especially for systems with large energy ranges .",
    "here , we introduce a general solution . we propose running multiple trajectories of wls in parallel , each starting from a different random seed ( or initial condition ) . periodically , one randomly pairs the configuration of each trajectory with a new dos from another trajectory .",
    "if the random walker happens to be trapped in a spike , this swapping resets the configuration to a ` safe ' region of energy space and stops the spike from growing further .",
    "the idea is similar to that of replica - exchange monte carlo @xcite , where a low temperature state trapped in a local minimum is swapped with a higher temperature one , enabling it to escape and sample other regions of configuration space .",
    "swapping between different wl random walkers also ensures that the sampling is uniform in energy space .",
    "our method is simple to implement and completely general , applicable to any energy binning or sampling step size .",
    "the dos from all the trajectories can be averaged at the end of the simulation so no computational resources are wasted .",
    "recently , vogel et al .",
    "@xcite proposed a parallel wl method to extend wls to large - scale problems . in their method",
    ", different random walkers in overlapping energy windows are run in parallel and occasionally exchanged so as to allow the entire energy range to be sampled simultaneously and quickly .",
    "the purpose of our current work , on the other hand , is to use parallelization and swapping as a way to prevent trapping .",
    "in addition , each of our random walker samples the entire energy range , and we do not define a separate transition probability for the exchange of two random walkers .",
    "the method of vogel et al . may also be effective in spike prevention .",
    "however , the general focus and actual implementation of the two works are different .",
    "we tested our algorithm on the frustrated @xmath1 model .",
    "let @xmath43 and @xmath44 denote , respectively , the configuration and dos of the @xmath45th trajectory , where @xmath46 denotes the random seed of each trajectory .",
    "every @xmath47th mc step , a shuffling algorithm randomly permutates the trajectory index @xmath48 , and assign @xmath49 as the new configuration of @xmath44 .",
    "the main factors affecting the efficacy of the algorithm are the time interval between swaps @xmath50 and the total number of trajectories @xmath51 .",
    "swapping should be as frequent as possible so that spikes do not have the chance to build up . using more trajectories",
    "reduces the probability of swapping two trajectories which are simultaneously trapped in the same energy bin . on the other hand , as we implemented the algorithm using message passing interface , the swapping process requires communication between different processors and incurs computational overhead , so one should also try to keep @xmath12 large and @xmath51 small .    as our swapping between trajectories",
    "is accepted with probability 1 , strictly speaking , it violates the transition rule of wls .",
    "however , as the number of swaps we performed is very small compared to the entire length of the trajectory , no serious error is introduced , as shown by our numerical experiments below .",
    "in our simulations , we consider one set of @xmath6 for each @xmath52 @xcite , and study the effects of @xmath12 , @xmath51 , and random shuffling on the prevention of spike occurrences .",
    "the energy binning for the dos is chosen such that the bins are narrow enough to support the energy distribution @xmath53 near zero temperature .",
    "such narrow bin widths easily induce spiking in the original wls algorithm .",
    "admittedly , the original wls might not induce spiking for other choices of bin widths , but we did not perform an exhaustive study on this issue , due to the unpredictability of spiking , as previously discussed .",
    "all @xmath51 trajectories are launched from the same initial configuration .",
    "each @xmath26 stage is simulated for @xmath54 mc steps , and @xmath26 is halved after each stage .",
    "we then counted the percentage of the @xmath51 trajectories that have spiked dos after the tenth @xmath26 stage .",
    "the results are summarized in table [ table.count_spikes ] . for each @xmath52 , we studied @xmath55 and @xmath56 where @xmath57 means no swapping ( i.e. original wls ) . each entry in the table shows the percentage of spiked dos in the order @xmath58 . for @xmath57 ,",
    "more than half of the @xmath51 trajectories exhibits spiking . for each of the rest of the @xmath51-@xmath12 entries ,",
    "the percentage is averaged over five runs where each run uses a different seed for the random shuffler .",
    "as expected , large @xmath51 ( 32 ) and small @xmath12 ( 250 ) is the most effective in preventing spike formation . between @xmath51 and @xmath12 ,",
    "the latter is more important in preventing spikes .",
    "we found that is it important to keep @xmath59 because otherwise swapping is ineffective .",
    "increasing @xmath51 has a comparatively more gradual albeit still significant effect in preventing spikes .",
    "we checked the accuracy of the dos of our swapping algorithm by computing the specific heat capacity per spin , @xmath60 , for @xmath33 . from the five runs of @xmath61 , @xmath62",
    ", we took one run and continued the swapping simulation until @xmath63 @xcite .",
    "the @xmath60 of all 32 trajectories were calculated and averaged , giving @xmath64 .",
    "the value of @xmath21 in any spiked bin is replaced by the average of its two neighboring bins .",
    "the same is repeated for @xmath57 , and results of replica - exchange monte carlo calculations are used as benchmark .",
    "the results are shown in fig . [ fig.cv](a ) . @xmath62 and replica - exchange agree very well , even at low temperatures as shown in the inset .",
    "on the other hand , the @xmath64 of @xmath57 suffers from large fluctuations .",
    "we found that the trajectories of @xmath57 can be separated into two types : ( i ) those with no spikes in their dos give a @xmath64 that have successfully converged , as shown by the red ( labelled ` converged ' ) curve in fig .",
    "[ fig.cv](b ) .",
    "( ii ) trajectories with spikes on their dos sometimes spend entire or even a few @xmath26 stages confined either within the spiked bin itself or ` bouncing ' between the spike and edge of the dos .",
    "when the random walker managed to escape , the @xmath26 has already been lowered so much that the current modification factor does not give effective improvement to the dos , and thus the dos is effectively frozen at an earlier @xmath26 stage .",
    "the @xmath64 computed from these trajectories are therefore unconverged , as shown by the blue ( labelled ` unconverged ' ) curve in fig . [",
    "fig.cv](b ) .",
    "our observation also explains why the annealing method by poulain et al .",
    "@xcite was successful .",
    "by re - increasing the @xmath26 , their random walker is allowed to redo those earlier @xmath26 stages when it was trapped .",
    "as mentioned above , the phenomenon of trapping is highly dependent on how the simulation is being set up , i.e. the kind of system , the energy binnings , the mc step size etc .",
    "we would like to highlight two scenarios where we think there is an increased likelihood of encountering trapping .",
    "the first is when it is preferable to use a small mc step size to achieve a good acceptance rate . in our study of the poly - alanine molecule",
    ", we found that the molecule sometimes fold into very tight conformations where small mc step sizes are necessary to enable the molecule to gently unfold ( large moves will give rise to the ` lever - arm ' effect resulting in steric clashes ) . if small step sizes are used , then one needs to be aware of the trapping mechanism we have discussed above .",
    "the second scenario is when one is interested in low temperature behavior , which in wls means sampling from low - lying energy states . to illustrate",
    ", we ran 200 independent , non - swapping trajectories for the @xmath1 model ( @xmath33 ) discussed above . at the end of the @xmath65th @xmath26 stage , we checked if there is a spike in their dos , and if yes , the energy bin at which the spike occurs .",
    "the energy distribution of the spike locations is shown in fig .",
    "[ fig.spike_distribution ] .",
    "spiking occurs predominantly at an energy range near to the ground state at @xmath66 .",
    "this energy range corresponds roughly to the temperature @xmath67 . in the inset of fig .",
    "[ fig.spike_distribution ] , the energy probability distribution @xmath68 at @xmath67 is shown , and we see that the distribution is supported on an energy region where spiking is dominant . hence , one should be aware of the possiblity of trapping when one investigates low temperature phenomena .",
    "on the other hand , trapping might not be so important when one studies high temperature behavior .",
    "we use the same @xmath1 model as example . from fig .",
    "[ fig.cv ] , we see that the transition temperature is around @xmath69 . in the inset of fig .",
    "[ fig.spike_distribution ] , we plot the @xmath70 at @xmath69 .",
    "it is seen that the distribution lies quite far away from the energy region where spiking occurs .",
    "hence , one might impose a low energy threshold to prevent the random walker from visiting low energy states if one is only interested in obtaining the transition temperature .    in our algorithm , swapping between trajectories occur with probability 1 .",
    "as mentioned , this violates detailed balance .",
    "one way to rectify this is to treat the swapping as a mc step by itself .",
    "the acceptance probability for the swap has been proposed by vogel et al .",
    "@xcite , @xmath71)}{g_i(e[y ] ) } \\frac{g_j(e[y])}{g_j(e[x])}\\right ] , \\label{eq : vogelswap}\\ ] ] where @xmath72 and @xmath73 are the configurations of trajectories @xmath25 and @xmath74 before the swap , and @xmath75 $ ] and @xmath76 $ ] are their energies , respectively .",
    "@xmath77)$ ] is the dos of trajectory @xmath25 at energy @xmath75 $ ] .",
    "hence , every few steps , a swap can be attempted and accepted according to eq .",
    "( [ eq : vogelswap ] ) . this way , detailed balance is obeyed and the swapping interval @xmath12 can be made quite small .",
    "if the system under study is small enough for many multiple trajectories to be simulated on a single processor , one should indeed adopt eq .",
    "( [ eq : vogelswap ] ) . however , for large systems where one assigns different trajectories to different processors , one need to take into account the computational overhead coming from the communication among the processors during swapping .",
    "it may then be too expensive to use eq .",
    "( [ eq : vogelswap ] ) to swap since frequent swapping will slow the computation down . on the rare occasion when a swap is attempted ,",
    "it is best to let the swap succeed as we have done in this paper .",
    "although theoretically less rigorous , our method is faster .",
    "bouzida et al .",
    "has also shown within the context of the acceptance ratio method that occasional and infrequent violation of detailed balanced does not incur serious error @xcite .",
    "our calculation of the specific heat capacity also shows that there is no discernible error incurred from this violation of detailed balance during swapping .",
    "lastly , we discuss the case of piecewise constant dos alluded to earlier .",
    "the original wls algorithm takes the value of @xmath21 as constant within each energy bin .",
    "this will not give rise to any spiking , as without linear - interpolation the mechanism of fig .",
    "[ fig.schematic ] no longer holds .",
    "however , for piecewise constant dos the energy bins at the very edge of the dos will usually only be visited after the first few @xmath26 stages have been completed . by the time the random walker drops into these bins ,",
    "the difference in @xmath21 between these bins and the neighboring , higher - energy ones is already so large that @xmath78 $ ] is effectively zero , and the random walker stays a long time in these bins to let the dos ` catch up ' before it can escape .",
    "this leads to another form of trapping .",
    "the swapping algorithm presented here is also applicable to this problem encountered by piecewise constant dos .",
    "although one should in principle average the results over the distribution of @xmath6 , as the system is approximately self - averaging at the large @xmath52 we are considering , we choose instead to focus calculations on other aspects .",
    "the @xmath26 schedule is as follows . from @xmath79 to @xmath80 , @xmath81 mcs per spin ; @xmath82 to @xmath83 , @xmath84 ; @xmath85 to @xmath86 , @xmath87 ; @xmath88 to @xmath89 , @xmath90 ; @xmath91 to @xmath92 , @xmath93 .      .reducing spikes in the dos by swapping .",
    "@xmath51 : number of trajectories .",
    "@xmath12 : number of mc steps ( per spin ) between swaps .",
    "each @xmath51-@xmath12 entry is ordered @xmath58 , and shows the percentage of spiked dos averaged over five different runs of the random shuffler .",
    "parenthesis indicates the standard deviation . for @xmath12=@xmath94 ( no swapping )",
    "only one run was performed for each @xmath51 and @xmath52 . [ cols=\"^,^,^,^,^,^,^ \" , ]      model ( @xmath33 ) and ( b ) the 8-mer poly - alanine . for both",
    ", we performed ten stages of wls where each stage is simulated for @xmath81 updates per spin / angle , and the modification factor @xmath26 is halved at at each stage .",
    "shown are the dos s from a single trajectory at the end of the tenth stage . ]",
    "model ( @xmath33 ) . ( a ) autocorrelation function and infinity norm of force along the segments .",
    "( b ) scatter plot of proposed energy change @xmath39 versus proposed angle change @xmath40 .",
    "( c ) energy distribution of accepted moves . ]     model for a fixed set of @xmath6 ( @xmath33 ) .",
    "the @xmath64 for @xmath62 and @xmath57 is calculated by averaging over 32 trajectories . for replica - exchange monte carlo ( circles ) , @xmath64 is computed by averaging over 25 independent runs .",
    "inset : close - up view near zero temperature of @xmath62 ( filled circles ) and replica - exchange ( empty circles ) .",
    "error bars indicate the standard deviation .",
    "the bars for replica - exchange are smaller than the circles .",
    "( b ) for @xmath57 . converged : @xmath64 , averaged over 14 converged trajectories . unconverged : @xmath64 , averaged over 18 unconverged trajectories .",
    "error bars indicate standard deviation . ]"
  ],
  "abstract_text": [
    "<S> we study the mechanism behind dynamical trappings experienced during wang - landau sampling of continuous systems reported by several authors . </S>",
    "<S> trapping is caused by the random walker coming close to a local energy extremum , although the mechanism is different from that of critical slowing down encountered in conventional molecular dynamics or monte carlo simulations . </S>",
    "<S> when trapped , the random walker misses entire or even several stages of wang - landau modification factor reduction , leading to inadequate sampling of configuration space and a rough density - of - states even though the modification factor has been reduced to very small values . </S>",
    "<S> trapping is dependent on specific systems , the choice of energy bins , and monte carlo step size , making it highly unpredictable . </S>",
    "<S> a general , simple , and effective solution is proposed where the configurations of multiple parallel wang - landau trajectories are inter - swapped to prevent trapping . </S>",
    "<S> we also explain why swapping frees the random walker from such traps . </S>",
    "<S> the efficacy of the proposed algorithm is demonstrated . </S>"
  ]
}