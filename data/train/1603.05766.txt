{
  "article_text": [
    "a permutation test is a type of non - parametric randomization test in which the null distribution of a test statistic is estimated by randomly permuting the class labels of the observations .",
    "permutation tests are highly attractive because they make no assumptions other than that the observations are independent and identically distributed under the null hypothesis .",
    "they are often used when standard distributional assumptions are doubtful or when the null distribution of the test statistic is simply intractable .",
    "this article also considers monte carlo tests , by which we mean simulation procedures in which pseudo - random instances of a test statistic are generated from its null distribution .",
    "the idea of permutation tests was first described by fisher ( 1935 ) , with the assumption that all possible permutations would be enumerated .",
    "the idea of limiting the computations to a subset of permutations , randomly drawn from the set of possible permutations , was first examined by dwass ( 1957 ) .",
    "the idea of monte carlo tests seems to have been first suggested by barnard ( 1963 ) .",
    "each of these three original papers included an expression for the exact @xmath0-value arising from the randomization test .",
    "none of the expressions were suitable for practical computation at the time , however , and the results on randomly drawn permutations seem to have been largely forgotten by the literature .",
    "dwass ( 1957 ) in particular is not easily readable by applied statisticians , and we have not seen the exact @xmath0-value expression from dwass ( 1957 ) repeated in any subsequent paper . even recent reviews that cite dwass ( 1957 ) do not reproduce the exact @xmath0-value ( ernst , 2004 ) .",
    "recent decades have seen an enormous development of bootstrap and re - sampling inference techniques ( efron , 1982 ; efron and tibshirani , 1993 ; davison and hinkley , 1997 ; manly , 1997 ) .",
    "a key concept of this research is the idea that the distribution of an estimator or test statistic can be estimated by an empirical re - sampling distribution .",
    "while this research has been tremendously valuable for a multitude of purposes , we believe it has had an unfortunate influence on the implementation of permutation tests . rather than using the exact @xmath0-value expressions from the original papers mentioned above , it has become common practice to use estimators of @xmath0-values in place of genuine probabilities .",
    "this estimation approach is recommended in many textbooks ( higgins , 2004 ; efron and tibshirani , 1993 ; good , 1994 ; mielke and berry , 2001 ) .",
    "some recent papers have given confidence intervals for permutation @xmath0-values ( ernst , 2004 ) , again re - inforcing the idea of @xmath0-value calculation as an estimation problem .",
    "the view is often expressed that the correct @xmath0-values can be estimated to any required precision by drawing a sufficiently large number of permutations .",
    "this article points out this is only true up to a point .",
    "we show that substituting unbiased estimators for exact @xmath0-values often increases the type i error rate of the test .",
    "a similar concern was raised by onghena and may ( 1995 ) and edgington and onghena ( 2007 ) . we also show that , when a very large number of simultaneous tests is to be done , @xmath0-values can never be estimated with sufficient precision to avoid serious type i error problems at the family - wise level .",
    "meanwhile , exact @xmath0-values that do control the type i error rate correctly are readily available for little or no additional computational cost .    with the development of large genomic data sets and modern computing facilities ,",
    "permutation tests have become one of the most commonly used statistical tools in modern biostatistical and genomic research .",
    "a google scholar search for  gene \" and  permutation test \" finds nearly 8000 genomic articles , likely an underestimate of the number of relevant articles .",
    "permutations are almost always randomly drawn rather than exhaustively enumerated .",
    "we were motivated to write this article because of the number of times we have seen permutation @xmath0-values computed incorrectly in the genomic literature .",
    "many published algorithms and software tools return permutation  @xmath0-values \" that are really estimates of @xmath0-values , i.e. , @xmath3-values . in most cases , published @xmath0-values obtained from permutation tests",
    "are understated by about @xmath1 , where @xmath2 is the number of permutations .",
    "the situation is similar when monte carlo simulation is used to assign @xmath0-values . of particular concern is the tendency of many public software packages to return @xmath3-values that can be exactly zero .",
    "it is obvious that a permutation test could never yield an exactly zero @xmath0-value if all permutations were exhaustively enumerated , and it makes no inferential sense to assert that the @xmath0-value can be reduced to zero by considering only a subset of the permutations .",
    "most concerning of all is the potential for multiple testing procedures to be applied to @xmath3-values that are exactly zero .",
    "this has the potential to lead to grossly misleading results at the family - wise level , in which the results are judged to be significant at fantastically strong levels , even when all of the null hypotheses are true .",
    "this article contains only a modest amount of novel statistical theory .",
    "we provide a new computational solution for evaluating exact @xmath0-values when permutations are drawn at random .",
    "our main aim is to clarify the need to evaluate exact @xmath0-values , and to make the relevant results more accessible to the genomic community .",
    "randomization tests are used in the following context . a test statistic @xmath4",
    "has been calculated from the data at hand .",
    "we would like to use the null hypothesis tail probability @xmath5 of the observed test statistic as the @xmath0-value , but this probability can not be directly computed . in a general sense , the purpose of randomization tests is to estimate @xmath6 .",
    "the purpose of this section is to point out that @xmath0-value calculation must take into account not just the estimate of @xmath6 but also the margin of error of this estimate .",
    "simply replacing @xmath6 with an unbiased estimator can result in a failure to correctly control the type i error rate .    if the test statistic @xmath4 is continuously distributed , then @xmath6 will be uniformly distributed on @xmath7 under the null hypothesis . to control the type i error rate at level @xmath8 ,",
    "if @xmath6 was known , the null hypothesis would be rejected when @xmath9 . in other words , @xmath10 under the null hypothesis .",
    "now suppose that @xmath3 is an unbiased estimator of @xmath6 .",
    "it is often true that @xmath11 , because @xmath12 occurs with positive probability even when @xmath13 . in general @xmath14 to consider a concrete case , suppose that @xmath2 monte carlo data sets are generated under the null hypothesis , and suppose that @xmath15 where @xmath16 is the number of monte carlo test statistics greater than or equal to @xmath4 . then @xmath17 is binomially distributed with size @xmath2 and success probability @xmath6 .",
    "plainly , @xmath3 is an unbiased estimator of @xmath6 .",
    "furthermore , @xmath3 converges to @xmath6 as the number of monte carlo data sets @xmath18 .",
    "this is all conditional on the observed data however . to compute the size of the resulting monte carlo hypothesis test",
    ", we have to average over all possible data sets that might have been observed .",
    "since @xmath19 is binomial and @xmath6 is uniform , the unconditional distribution of @xmath17 is a special case of beta - binomial .",
    "in fact , it is easy to show that @xmath3 follows a discrete uniform distribution on the values @xmath20 : @xmath21 for all @xmath22 .",
    "hence the type i error rate of the monte carlo test that arises from using @xmath3 as a working @xmath0-value is @xmath23 this expression can be greater or less than the nominal size @xmath8 .",
    "the discreteness of @xmath3 however ensures that @xmath24 for most values of @xmath8 near zero , and @xmath25 for most values of @xmath8 near 1 ( figure a ) . since @xmath26 for most experiments , the true type i error rate @xmath27 exceeds @xmath8 for most practical values of @xmath2 and @xmath8",
    "the type i error rate always exceeds @xmath8 when @xmath28 for some integer @xmath29 , or when @xmath30 .",
    "in fact @xmath27 is never less than @xmath31 regardless of how stringent the desired rate @xmath8 is chosen .",
    "this demonstrates an unintuitive principle .",
    "inserting an unbiased estimator of a @xmath0-value for the true @xmath0-value does not generally lead to a test of the same size .",
    "rather , the type i error rate of the resulting randomized test is usually greater than that which would arise from using the true @xmath0-value . to achieve a randomized test of the correct size",
    ", we must in effect substitute for the true @xmath0-value an estimator with positive bias .",
    "the moral is that @xmath0-values must be directly evaluated as probabilities , not treated as if they were unknown parameters to be estimated in a statistical model .    ,",
    "arising from using @xmath3 as a working @xmath0-value ( y - axis ) versus the nominal size @xmath8 ( x - axis ) when @xmath32 .",
    "the equality line , @xmath33 , is shown in blue .",
    "the type i error rate is generally above the nominal rate for @xmath34 .",
    ", width=316,height=326 ]",
    "if only one hypothesis is to be tested , mis - calculating a @xmath0-value probability by a small amount will often be of little consequence . in genomic research , however , it is typically the case that many tests are to be conducted .",
    "when the number of tests is large , any systematic under - estimation of @xmath0-values can lead to dangerously wrong conclusions at the family - wise level .",
    "suppose for example that 50,000 tests are to be conducted , one for each transcript in a transcriptome perhaps , and suppose that the resulting @xmath0-values are to be adjusted by bonferroni or holm s methods ( holm , 1979 ) .",
    "if each @xmath0-value is under - estimated by just 1/50,000 , then it is highly likely that at least one null hypothesis will be rejected at any reasonable significance level , even if none of the null hypotheses are false . in this case",
    "the family - wise type i error rate is radically wrong , even though the type i error rate is only very slightly under - estimated for each individual test .",
    "this situation can arise easily if a permutation test is conducted for each gene on a microarray platform . to give an example ,",
    "suppose that permutation @xmath3-values are computed from @xmath35 sample permutations for each of 30,000 genes , where the total number of distinct permutations possible is much larger than 1000 .",
    "suppose that a working @xmath0-value is computed for each gene as @xmath15 , where @xmath16 is the number of permutations yielding a test statistic at least as extreme as that observed from the original data .",
    "clearly @xmath15 is an unbiased estimate of the tail probability for the test statistic under the null distribution induced by permutating samples . yet",
    "then the number of exact zero values will be around 30 , even when there are no differentially expressed genes .",
    "these 30 zero values will remain statistically significant regardless of multiple testing procedure or significance level applied .",
    "the basic problem here is that the family - wise error rate depends on the relative accuracy on the @xmath0-values , rather than on additive errors . for the smallest @xmath0-values ,",
    "the error may be large in relative terms even when it is small in absolute terms .",
    "when a non - zero @xmath0-value is mis - estimated as zero , the relative error is 100% .",
    "it is helpful to consider first the case of monte carlo tests , which have much in common with permutations tests , but are mathematically simpler .",
    "suppose @xmath36 is the observed test statistic for a given hypothesis for a given experiment .",
    "the basic assumption of monte carlo tests is that it is possible to generate independent random datasets under the null hypothesis @xmath37 .",
    "typically , this is done by simulation using pseudo - random numbers .",
    "suppose @xmath2 such datasets are simulated under the null hypothesis , each yielding a distinct test statistic @xmath38 . in principle , the ideal @xmath0-value is @xmath39 but this is unknown . to compute @xmath6 exactly it would be necessary to generate an infinite number of simulated datasets , but only a finite number @xmath2 are available .    for simplicity , we assume that the test statistic @xmath4 is continuous , so that @xmath6 is uniform on the unit interval and all the @xmath38 are distinct .",
    "let @xmath16 be the number of times out of @xmath2 that @xmath40 .",
    "the previous section showed that using the unbiased estimator @xmath41 in place of @xmath6 leads to an invalid test that does not correctly control the type i error rate at the required level .",
    "a more valid approach is to compute the tail probability directly for the monte carlo results . from the point of view of the randomization test ,",
    "the test statistic is @xmath16 rather than @xmath36 , and the required tail probability is @xmath42 .",
    "the previous section showed that , under the null hypothesis , the marginal distribution of @xmath16 over all possible data sets is discrete uniform on the integers from @xmath43 .",
    "hence the exact monte carlo @xmath0-value is @xmath44 in effect , the randomization test replaces the unknown tail probability @xmath6 with a biased estimator @xmath45 , the amount of positive bias being just enough to allow for the uncertainty of estimation and to produce a test with the correct size .",
    "this @xmath0-value calculation is presented in a number of textbooks on randomization tests including davison and hinkley ( 1997 ) , manly ( 1997 ) and edgington and onghena ( 2007 ) .",
    "now we consider permutation tests , a type of re - sampling randomization test .",
    "the basic setup for a permutation test is as follows .",
    "we observe data pairs @xmath46 , @xmath47 , where the @xmath48 are independent data observations and the @xmath49 are labels that classify the observations into two or more groups .",
    "the aim of a permutation test is to test the association between @xmath50 and @xmath51 .    a suitable test statistic @xmath4 is computed from the @xmath46 .",
    "this might be a two - sample @xmath4-statistic , for example , but it could in principle be any statistic designed to test for differences between the data groups .",
    "write @xmath36 for the observed value of the statistic .",
    "the idea of a permutation test is to assign a @xmath0-value to @xmath36 by randomly permuting the class labels @xmath49 a large number of times .",
    "then the empirical distribution of the test statistics @xmath52 from the permuted data estimates the null distribution of the test statistic .",
    "the null hypothesis @xmath37 being tested is that the @xmath48 are independently and identically distributed , versus an alternative hypothesis in which the distribution of @xmath48 differs between groups .    for simplicity",
    ", we will assume that the @xmath48 are all distinct , so that permutation yields distinct values of the test statistic unless the partition of @xmath50 values into groups is identical .",
    "we assume that there are @xmath53 possible distinct values of the test statistic , not counting the original value , and that all are equally likely to arise under the permutation distribution .",
    "the original idea of permutation tests was that all possible permutations would be enumerated ( fisher , 1935 ) .",
    "however @xmath53 can be very large indeed for moderate to large sample sizes , so that complete enumeration may be impractical .",
    "in this situation , it is common practice to examine a random subset of the possible permutations .",
    "it is important to distinguish two possible scenarios .",
    "the random permutations may be drawn without replacement , so that all permutations are distinct . or permutations may be drawn with replacement , so that the same permutation may be used more than once .",
    "we consider the first scenario now .",
    "the second scenario is the topic of the next section .",
    "suppose that a random sample @xmath54 permutations is drawn , without repetition , such that each permutation yields a distinct test statistic @xmath52 , different from the original statistic .",
    "then the situation is essentially the same as for monte carlo tests considered in the previous section .",
    "the argument used in the previous section to derive the monte carlo @xmath0-value applies again , showing that the exact permutation @xmath0-value is @xmath55 , where @xmath56 is the number of @xmath52 greater than @xmath36 .",
    "this result includes the situation in which all @xmath53 possible distinct permutations are evaluated .",
    "the exhaustive permutation @xmath0-value is @xmath57 , where @xmath58 is the total number of distinct statistic values exceeding @xmath36 .",
    "we now consider the case in which permutations are randomly drawn with replacement .",
    "each permutation is randomly generated independently of previous permutations or of the original data configuration .",
    "this is by far the most common way that permutation tests are used in practice , especially in the genomic literature .",
    "this scenario requires careful treatment from a mathematical point of view , because of the possibility that the random permutations may include repetitions of the same permutations and indeed of the original data .",
    "suppose that an independent random sample of @xmath2 permutations is drawn with replacement .",
    "the resulting test statistics @xmath52 may include repeat values , including possibly the original observed value @xmath36 . the exact @xmath0-value is now slightly less than @xmath45 , because of the possibility that the original data is included at least once as one of the random permutations .",
    "write @xmath16 for the number of permutations out of @xmath2 yielding test statistics at least as extreme as @xmath36 .",
    "we wish to evaluate the exact permutation @xmath0-value @xmath59 for any given @xmath56 .",
    "we do so using a formal conditional approach .",
    "write @xmath60 for the total number of possible distinct statistic values exceeding @xmath36 , again an unknown quantity , and note @xmath61 .",
    "although @xmath62 is in principle the ideal permutation @xmath0-value , it is unknown in the scenario we now consider .",
    "if the null hypothesis is true , then @xmath60 follows a discrete uniform distribution on the integers @xmath63 .",
    "conditional on @xmath64 , @xmath16 follows a binomial distribution with size @xmath2 and probability @xmath62 .",
    "hence @xmath65 where @xmath66 is the cumulative probability function of the binomial distribution .",
    "this expression is essentially the same as proposition  1 of dwass ( 1957 ) , although dwass did not seem to intend it for practical computational use .",
    "although not very difficult to derive , this exact @xmath0-value has not been repeated to our knowledge elsewhere in the literature .",
    "equation ( [ eq : permcdf ] ) provides a formula for the exact @xmath0-value , but the summation may not be practical to evaluate explicitly if @xmath53 is very large .",
    "hence we explore an approximation that can be evaluated quickly . replacing the summation with an integral , and using a continuity correction , yields @xmath67",
    "this shows that @xmath68 , and also that @xmath69 converges to @xmath70 as @xmath53 increases .",
    "the last integral in equation ( [ eq : two ] ) is easily evaluated using numerical integration algorithms .",
    "we have found it convenient to use gaussian quadrature .",
    "the valid but conservative @xmath0-value @xmath70 has been recommended by a number of authors including davison and hinkley ( 1997 ) , manly ( 1997 ) and ernst ( 2004 ) .",
    "the extent to which @xmath70 over - estimates the exact @xmath0-value depends on @xmath53 .",
    "when @xmath71 , @xmath70 over - estimates the 0.05 @xmath0-value by about 2% , but smaller @xmath0-values are over - estimated by greater relative amounts ( figure  [ fig : puvspe]b ) .",
    "when @xmath53 is small , @xmath70 can be very conservative ( figure  [ fig : puvspe]a ) .     to the exact @xmath0-value .",
    "panel ( a ) is for @xmath72 and ( b ) is for @xmath71 .",
    "the number of permutations is @xmath35 in each case , and values are plotted for all possible values of @xmath56 .",
    ", title=\"fig:\",width=273,height=273 ]   to the exact @xmath0-value .",
    "panel ( a ) is for @xmath72 and ( b ) is for @xmath71 .",
    "the number of permutations is @xmath35 in each case , and values are plotted for all possible values of @xmath56 .",
    ", title=\"fig:\",width=273,height=273 ]      the number @xmath53 of possible distinct values of the test statistic is not simply a function of the number of permutations , but also depends on the form of the test statistic and on the sample sizes . this is because different permutations can lead to the same test statistic , especially for two - sided tests with balanced samples .",
    "consider a comparison between two groups of sizes @xmath73 and @xmath74 .",
    "in this situation it is usual to sample permutations by randomly assigning @xmath73 of the indices @xmath29 to group 1 and the remaining @xmath74 to group 2 . if the test statistic is one - sided , or",
    "if @xmath75 , then each permutation will generally yield a distinct test statistic . in that case",
    ", the number of distinct values of the permuted statistics is @xmath76 for example , a one - sided test with @xmath77 gives @xmath78 .",
    "the integral approximation ( [ eq : two ] ) provides an excellent approximation to the exact @xmath0-values ( table  [ tab : twogroups ] ) .",
    ".exact and approximate @xmath0-values for a one - sided test between two groups of size five using @xmath79 random permutations .",
    "[ cols=\"^,^,^,^,^ \" , ]     [ tab : twogroups ]    if a two - sided test statistic is used , for example the absolute value of a @xmath4-statistic , and if the two groups are of equal size @xmath80 , then each permutation gives the same value of the test statistic as the corresponding permutation with the two groups reversed . in this case",
    ", the total number of distinct test statistics possible is @xmath81 .",
    "if there are three or more groups of unequal sizes then @xmath82 is the multinomial coefficient @xmath83 where @xmath84 is the number of groups .",
    "if some of the group sizes @xmath85 are equal , then some permutations will in general give equal test statistics , so the calculaton of @xmath53 will need to consider the particular configuration of samples sizes .",
    "the approach posited in section  5 , of drawing permutations without repeating previous values of the test statistic , turns out to be a surprisingly difficult combinatorial programming exercise .",
    "hence this approach is seldom used ",
    "so much so that we have never seen it in the genomic literature .",
    "nevertheless , this is the superior approach to permutation tests .",
    "sampling without replacment gives rise to a simple easily understood exact @xmath0-value in the form of @xmath70 .",
    "even more importantly , it is possible to show that sampling permutations without replacement gives more statistical power than sampling with replacement for any given number of permutations @xmath54 .",
    "our first recommendation then is that more attention be given to this problem by computer scientists and combinatorialists , to provide biostatisticians with efficient numerical algorithms to sample permutations without replacement .",
    "our second recommendation is that `` unbiased '' estimators of @xmath0-values such as @xmath3 should not be used , because they ca nt be guaranteed to control the type i error rate .",
    "although the risk involved in using @xmath3 in place of the exact @xmath0-value may be modest in many applications , there is no justification for using an invalid @xmath0-value when a valid @xmath0-value , in the form of @xmath70 , is readily available for no extra cost .",
    "our third recommendation is that users might consider using the exact @xmath0-value @xmath69 , at the cost of a trivial amount of extra computation .",
    "our algorithm to compute @xmath69 is implemented as the function permp in the software package statmod for r available from http://www.r-project.org .",
    "the exact value @xmath69 gives a worthwhile gain in statistical power over @xmath70 when the number of permutations @xmath2 performed is a more than negligible proportion of the total number possible @xmath53 .",
    "a referee asked us to warn users that the number of permutations @xmath2 should not be chosen too small . while this is true , the urgent need to avoid small",
    "@xmath2 disappears when the exact @xmath0-value @xmath69 is used in place of @xmath3 , because @xmath69 ensures a valid statistical test regardless of sample size or the number of permutations .",
    "when exact @xmath0-values are used , the only penalty for choosing @xmath2 small is a loss of statistical power to reject the null hypothesis .",
    "this is as it should be : more permutations should generally provide greater power .",
    "the same referee asked us to comment on the difference between permuting genes and permuting samples .",
    "one obvious difference between genes and samples is that there are generally more of the former than the latter , so that @xmath53 is likely to be astronomically large when genes are permuted .",
    "this implies that @xmath70 is likely to be a good approximation for @xmath69 in this context .",
    "we have avoided discussing gene permutation in this article however because gene permutation has another obvious problem .",
    "permutation assumes that the items being permuted are statistically independent , whereas genes usually can not be assumed independent in genomic applications ( goeman and bhlman , 2007 ; wu et al , 2010 ) . in general",
    ", we recommend permuting samples rather than permuting genes when there is a choice .",
    "onghena , p. and may , r.b .",
    "( 1995 ) pitfalls in computing and interpreting randomization test @xmath0 values : a commentary on chen and dunlap .",
    "_ behaviour research methods , instruments , & computers _ , * 27 * , 408411 ."
  ],
  "abstract_text": [
    "<S> permutation tests are amongst the most commonly used statistical tools in modern genomic research , a process by which @xmath0-values are attached to a test statistic by randomly permuting the sample or gene labels . yet </S>",
    "<S> permutation @xmath0-values published in the genomic literature are often computed incorrectly , understated by about @xmath1 , where @xmath2 is the number of permutations . </S>",
    "<S> the same is often true in the more general situation when monte carlo simulation is used to assign @xmath0-values . </S>",
    "<S> although the @xmath0-value understatement is usually small in absolute terms , the implications can be serious in a multiple testing context . </S>",
    "<S> the understatement arises from the intuitive but mistaken idea of using permutation to estimate the tail probability of the test statistic . </S>",
    "<S> we argue instead that permutation should be viewed as generating an exact discrete null distribution . </S>",
    "<S> the relevant literature , some of which is likely to have been relatively inaccessible to the genomic community , is reviewed and summarized . a computation strategy is developed for exact @xmath0-values when permutations are randomly drawn . </S>",
    "<S> the strategy is valid for any number of permutations and samples . </S>",
    "<S> some simple recommendations are made for the implementation of permutation tests in practice .    </S>",
    "<S> _ keywords : _ permutation test , monte carlo test , @xmath0-values , multiple testing , microarray . </S>"
  ]
}