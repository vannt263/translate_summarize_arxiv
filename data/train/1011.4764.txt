{
  "article_text": [
    "in the last few decades , density functional theory ( dft )  @xcite became a method of choice for the calculation of the electronic structure of physical systems with a relatively large number ( hundreds to about a thousand ) of atoms .",
    "within dft , one has to self - consistently solve the kohn - sham equations  @xcite for the wave functions @xmath0 and energies @xmath1 @xmath2 where @xmath3 is the potential of the core ions , @xmath4 is the electrostatic ( hartree ) potential of the electronic charge density distribution @xmath5 and @xmath6 is the exchange correlation potential which , under the local density approximation ( lda ) , depends only on charge density at a given point in space .",
    "there is a strong interest to develop methods where the cost of solving the system of equations ( [ eq : eqa1 ] ) would depend linearly on the number of atoms in the system .",
    "such methods are based either on the representation of dft equations in localized orbital basis sets @xcite or on the division of the system into small fragments.@xcite these methods are still computationally demanding due to necessity of evaluating all the wave functions of occupied states in each iteration until the self - consistency is reached .    a different class of ( empirical ) methods has been developed in the semiconductor physics community , where the main philosophy is to directly construct the kohn - sham hamiltonian [ the left hand side of eq .",
    "( [ eq : eqa1 ] ) ] . in the empirical and semiempirical pseudopotential method ( epm and sepm ) , the total potential is considered as a sum of pseudopotentials of individual atoms , that are obtained either by fitting to the bandstructure of a bulk semiconductor @xcite or extracted from ab - initio calculations of the bulk .",
    "@xcite such pseudopotentials are then used to construct the hamiltonian of the nanostructure of interest .",
    "@xcite a more recent approach is the charge patching method ( cpm),@xcite where the electronic charge density is constructed from charge density contributions of individual atoms  so called motifs . the motifs are extracted from calculations on small prototype systems , where the atoms have a similar bonding environment as in the system of interest . for a range of inorganic and organic semiconducting systems,@xcite the charge density and the potential obtained from the cpm closely match the ones that would be obtained from a full self - consistent dft calculation .",
    "the construction of the hamiltonian in the methods mentioned above ( epm , sepm and cpm ) is quick and its cost scales linearly with the size of the system .",
    "once the kohn - sham hamiltonian is constructed , one has to solve its eigenvalue problem . for semiconducting systems ,",
    "the spectral region of interest is the one in the vicinity of the band gap .",
    "therefore , one needs to solve for these electronic states only .",
    "this can be achieved using the folded spectrum method.@xcite the folded spectrum method ( implemented in plane wave representation of the wave functions ) scales linearly with the size of the system when a fixed number of states is required .",
    "however , in many calculations , one is interested in a fixed energy window of the order of several @xmath7 below or above the band gap , since this is the spectral region that determines the electronic transport properties of the system .",
    "the number of states in such an energy window also increases linearly with the size of the system and consequently the overall computational cost within the folded spectrum method increases quadratically with the system size . in this paper",
    ", we present a different strategy for the diagonalization of the hamiltonian .",
    "it is based on the idea of representing the hamiltonian in a localized and physically well motivated basis .",
    "the whole system is divided into many small fragments , that are not necessarily disjoint , and the eigenstates of the fragments are chosen as the basis for the representation of the hamiltonian . in some sense , this approach combines the ideas from the literature on using the localized basis sets and the division of the system into fragments",
    ". we will refer to this method as overlapping fragments method ( ofm ) .",
    "we have developed this methodology with a particular focus towards its application to understanding the electronic states in semiconducting polymer materials .",
    "these materials are to a large extent disordered and there is a strong need for large supercell calculations that would provide reliable information about the degree of localization of electronic states , the density of states and eventually the electronic transport properties.@xcite for such systems , the atomic structure can be reliably generated from classical molecular dynamics ( md),@xcite but the challenge remains to calculate the electronic structure .",
    "the current method excellently complements our recently developed cpm for the construction of the hamiltonian of organic semiconducting materials .",
    "we present the details of the implementation of the methodology in sec .",
    "[ sec : sec2 ] . in sec .",
    "[ sec : sec3 ] , we illustrate the method to diagonalize the hamiltonian obtained from cpm in the case of alkanes and describe the main points that one should address when performing such a calculation . finally , in sec .",
    "[ sec : sec4 ] , the method is illustrated by an application to one of the most widely studied organic polymers ",
    "poly(3-hexylthiophene ) ( p3ht ) .",
    "in this section we describe the details of the ofm and its implementation on parallel computers .",
    "the input to our computation is the atomic structure of the system and its potential obtained from cpm , while the output gives the transfer integrals @xmath8 and the wave function overlaps @xmath9 between the pairs of states @xmath10 and @xmath11 , which are the @xmath12-th wave function of the fragment @xmath13 and the @xmath14-th wave function of the fragment @xmath15 .",
    "each fragment consists of a molecule ( its choice will be discussed later ) embedded in a cuboid box .",
    "the potential is stored on all the @xmath16 cpus available for computation , as schematically illustrated in fig .",
    "[ fig : figa1 ] .",
    "the computation consists of two main parts ( fig .",
    "[ fig : figa1 ] ) : the calculation of basis wave functions and the calculation of @xmath17 and @xmath18",
    ". we allocate @xmath19 cpus to each of the fragments , where @xmath19 is typically some small number ( for example @xmath20 or @xmath21 ) .",
    "the calculation of the basis wave functions stemming from a given fragment is performed as follows .",
    "the charge density of the fragment is obtained using the charge patching method by adding the charge density motifs of each of the atoms in the fragment .",
    "the hartree potential of the fragment is then evaluated from the solution of the poisson equation with periodic boundary conditions , and the exchange correlation potential is obtained from the lda formula .",
    "in such a way , one obtains the hamiltonian of the fragment , which is then diagonalized using the escan code,@xcite which implements the preconditioned conjugated gradient minimization algorithm with the plane wave basis set .",
    "the basis wave functions @xmath10 stemming from each fragment @xmath13 are therefore obtained . at this stage",
    ", we also calculate @xmath22 ( where @xmath23 is the kohn - sham hamiltonian of the whole system , not just the fragment ) , which will be later required for the evaluation of @xmath17 . to achieve this , one first has to send the required real space grid values of the potential to the @xmath24 cpus allocated for fragment @xmath13 .",
    "the @xmath22 operation is then performed using one of the main subroutines from the escan code .",
    "one should note that the speed of the calculation of basis wavefunctions can be further improved by using some localized basis set instead of plane waves .",
    "let @xmath25 be the number of fragments in the system and @xmath26 .",
    "we divide the fragments into @xmath27 series , as illustrated in fig .",
    "[ fig : figa1 ] .",
    "the calculations on the fragments from the same series are performed in parallel , where each fragment uses its @xmath19 allocated cpus ( see fig .  [",
    "fig : figa1 ] ) .",
    "such calculations are repeated for all @xmath28 series of fragments .",
    "the code for performing the above tasks was written by making good use of the existing codes for performing the charge patching calculations , solving the poisson equation and the escan code .",
    "these were integrated into a single code to avoid reading and writing to disk of the input and output files , such as charge densities and potentials , which can be quite large . for the storage of the calculated basis wave functions @xmath10",
    ", their reciprocal space representation is used .",
    "each fragment will have only a few basis functions , as discussed below , and therefore the required memory for their storage is not very big .",
    "each of the existing codes has been already parallelized using message passing interface ( mpi ) .",
    "further parallelization with respect to fragments , described above , was achieved by using the ` mpi_split ` command and changing the ` mpi_comm_world ` communicator in the existing codes to a local communicator ( among the @xmath19 cpus ) defined by the ` mpi_split ` command .",
    "the main part of the calculation consists of the calculation of the transfer integrals @xmath17 and the wave function overlaps @xmath18 between the pairs of states @xmath10 and @xmath11 . since the wave function @xmath10 is well localized to the fragment @xmath13 , one naturally introduces an approximation to consider only the transfer integrals and wave function overlaps for the states @xmath10 and @xmath11 , such that the fragments @xmath13 and @xmath15 are not too distant in space . the exact criterion for this",
    "will be formulated later in the paper .",
    "let @xmath29 be the number of pairs of fragments @xmath30 for which @xmath17 and @xmath18 need to be evaluated .",
    "for each pair , we allocate @xmath19 cpus where the calculation is performed .",
    "the pairs are divided into @xmath31 series , in a similar manner as fragments ( fig .",
    "[ fig : figa1 ] ) . to perform the calculation of @xmath17 and @xmath18 for pair @xmath30 on its allocated @xmath19 cpus",
    ", one needs to receive the wave functions @xmath10 , @xmath32 , @xmath11 and @xmath33 , which are stored on different groups of @xmath19 cpus , the ones associated with fragments @xmath13 and @xmath15 . with the wave functions available on the allocated group of cpus , the overlap element @xmath18 is straightforwardly calculated from the overlap of @xmath10 and @xmath11 , while @xmath17 is calculated as the overlap of either @xmath10 and @xmath33 or @xmath32 and @xmath11 . in a similar manner as for fragments , the calculations for pairs from the same series are performed in parallel ( fig .  [ fig : figa1 ] ) , and then sequentially repeated for all @xmath34 series of pairs .    with @xmath18 and @xmath17 elements at hand ,",
    "the final step is to find the electronic states by solving the generalized eigenvalue problem @xmath35 as will be shown , a limited number of basis wave functions is sufficient for rather accurate results .",
    "therefore , the dimension of the matrices @xmath18 and @xmath17 is not very large .",
    "consequently , in our current implementation of the methodology , this part is performed as a postprocessing step by using the standard lapack@xcite single processor routines .",
    "for very large systems or basis sets , we use scalapack.@xcite one can in principle also exploit the fact that the matrices @xmath17 and @xmath18 are sparse and use parpack@xcite which is well suited in that case .",
    "we note that a method exploiting to some extent similar ideas has been recently proposed by mcmahon and troisi ,  @xcite in the context of the calculation of electronic structure of semiconducting polymers .",
    "their method is also based on the partitioning of the system into fragments and calculating the transfer integrals and basis wave function overlaps . in their method ,",
    "the transfer integrals are however evaluated from the calculation of the system of two fragments in vacuum , which is inevitably an approximation . in our case ,",
    "on the other hand , the transfer integrals are evaluated from the kohn - sham hamiltonian of the whole system .",
    "such transfer integrals therefore fully include all the other environmental factors surrounding the two fragments . in the case of disordered polymers",
    "we therefore do include the variations of both on - site energies and hopping integrals due to random electrostatic potential .",
    "in this section , we would like to illustrate the methodology by applying it to the alkane polymer system . as a test system , we choose 20 alkane chains , each one being 20 monomers long ( 1240 atoms altogether ) .",
    "we generate the atomic structure of the disordered chain from classical md using a simulated annealing procedure .",
    "the cff91 force field,@xcite as implemented in the lammps code@xcite is used in the simulation .      the main task necessary to successfully apply",
    "the described methodology is to find the best way for the division of the system into fragments .",
    "a seemingly natural way is to cut the polymer into monomers , and to passivate the broken bond in each monomer by the hydrogen atom . in the case of alkanes",
    ", this would lead to the division of each @xmath15-units long alkane chain into @xmath15 ch@xmath36 molecules .",
    "there is however a concern whether the basis set formed from the eigenstates of monomer fragments would be sufficient to reliably describe the wave function of the whole system , in particular in the region of the broken bond .",
    "a way around this problem is to choose a basis set formed from overlapping dimer fragments , illustrated in fig .",
    "[ fig : figa2]a .",
    "in such a way @xmath37units long alkane chain is divided into @xmath38 c@xmath39h@xmath40 molecules .",
    "the main advantage of this way of the division of the system into fragments is that each bond in the system is fully encompassed by at least one fragment .",
    "we expect further improvement in the results when the system is divided into trimer fragments ( c@xmath41h@xmath42 molecules ) . on the other hand",
    ", one should keep in mind that the choice of the fragments that are too large is not advantageous from the computational point of view , as the wave functions of all fragments need to be evaluated .    to test the accuracy of the methodology",
    ", we have also solved the eigenvalue problem of the whole hamiltonian in the plane wave basis set with kinetic energy cutoff of 60  ry , using the escan code . in fig .",
    "[ fig : comp_fr_pw ] , we compare the eigenenergies of all occupied states obtained with the plane wave basis set @xmath43 and the eigenenergies obtained with the basis of fragment wave functions @xmath44 .",
    "we include in the basis set all occupied states of the fragment , which constitutes four , seven and ten states for the cases of monomer , dimer and trimer fragment , respectively .",
    "as one might have expected , the results from using the basis of monomer fragments are not so accurate . in the lowest part of the spectrum ,",
    "they are shifted by more than 200  mev from the results obtained in plane wave basis , while in the part of the spectrum near the top of the valence band the errors are of the order of 1  ev .",
    "the basis of dimer fragments is already quite satisfactory with eigenvalue errors in the 10  mev range in the lowest part of the spectrum , and in the 30  mev range near the top of the valence band .",
    "the basis of trimer fragments gives excellent results with errors less than 1  mev in the lowest part of the spectrum and errors less than 10  mev near the top of the valence band .",
    "based on the results presented so far , we can conclude that the eigenfunctions of trimer fragments are an excellent basis for the representation of the hamiltonian of the system .",
    "since all the occupied states are calculated accurately , one can also imagine of using this approach for a full self - consistent dft calculation without the use of the cpm .",
    "however , for the present purpose , there is a strong interest to reduce the basis set as much as possible , since the reduction of the number of wave functions per fragment by a factor of @xmath45 , reduces the time for their calculation by a factor of @xmath45 , reduces the number of wave function overlaps and overlap integrals that need to be calculated by a factor of @xmath46 and reduces the computational time for the final diagonalization step by a factor of @xmath47 .",
    "the selection of fragment eigenstates which will be included in the basis set is based on physical intuition .",
    "for the lowest part of the spectrum , one expects that taking just the few lowest states of the trimer ( whose eigenstates are shown in fig .",
    "[ fig : figa6 ] ) should give quite accurate results .",
    "one can see from fig .",
    "[ fig : figa7 ] that even a single wave function per trimer gives quite satisfactory results , with a systematic error of the order of 30  mev only .",
    "this is not so surprising since the lowest state of the trimer is separated from the next one by about 3  ev ( see fig .",
    "[ fig : figa6 ] ) and therefore it is the only state that strongly contributes to the wave functions in the lowest part of the spectrum . with the inclusion of more states ,",
    "the results converge towards the results obtained in plane wave basis .",
    "this is fully expected from the variational principle that states that the energy of any state formed from the finite basis set must be larger than the exact one and converges towards the exact one as the space spanned by the basis set is further increased .",
    "when one is interested in the part of the spectrum near the top of the valence band , one expects , based on physical intuition , that these states are formed from the highest occupied states of the fragment .",
    "however , in this case there is no exact principle that requires the states to converge ( either from the top or bottom ) toward the exact values as more highest occupied states of the fragment are added to the basis set .",
    "indeed , we see from fig .  [",
    "fig : figa8 ] that the results obtained with one and five basis states per fragment are on the opposite side of the line with exact results .",
    "furthermore , the results obtained with two , three or four highest occupied states per fragment , appear to have large basis set superposition errors and yield a completely different spectrum , where it is not even possible to correlate the eigenstates with the exact ones ( these results are therefore not shown ) .",
    "the origin of such behavior comes from the energy level structure of the trimer fragment ( fig .",
    "[ fig : figa6 ] ) .",
    "there are quite a few states near the highest occupied state and until all of them are included in the basis set , it is not possible to get a good description of the energy level structure .    from these results",
    ", we may speculate about the general rule for the choice of basis states when one is interested in the states at the top of the valence band .",
    "one should make a cutoff based on energies of fragment states at the place where there is a substantial gap in their energies .",
    "however , it is difficult to predict in advance how many homos are necessary . while in the case of alkanes at least 5 homos are required to get reasonably accurate results ( fig .",
    "[ fig : figa8 ] ) , in the case of thiophenes a single homo yields quite good results , as shown in sec .",
    "[ sec : sec4 ] .",
    "of course , the inclusion of all occupied states certainly leads to a good basis set .",
    "we find that it is often useful and practical to test the basis set convergence on some small systems ( e.g. , a single chain ) where direct dft calculation for the whole system is possible , before using the current method to calculate large systems .",
    "it is also of substantial interest to determine which of the calculated states will be occupied and which not and consequently identify the fermi level of the system . in the case",
    "when all occupied states of the fragments are used as basis set , it is trivial to occupy the states of the whole system based on the number of electrons in the system . in the case",
    "when only a few homos of the fragments are taken into account , there is no such obvious procedure .",
    "nevertheless , in practice we find it easy to recognize the homo - lumo gap using the following procedure .",
    "we calculate @xmath48 , where @xmath23 is the hamiltonian of the whole system and @xmath49 the homo of the fragment .",
    "we then find the first gap in the density of states above @xmath50 .",
    "that gap corresponds to the homo - lumo gap .",
    "all states below that gap are then occupied , while the states above are empty .",
    "an important factor that determines the accuracy of the calculation on the one hand and its speed on the other hand is the choice of pairs of fragments that are taken into account .",
    "we define the distance between fragments @xmath13 and @xmath15 as the minimal distance between an atom in fragment @xmath13 and an atom in fragment @xmath15 . a pair of fragments @xmath30 is included in the calculation if the distance between them is smaller than some cutoff @xmath51 .",
    "all the results presented so far have been obtained with @xmath51 ( overcautiously ) set to 7 .",
    "it is of interest to find the optimal value of @xmath51 which gives accurate eigenstates while minimizing the number of fragment pairs in the calculation .",
    "the dependence of the energies in the lowest part of the spectrum on @xmath51 is presented in fig .",
    "[ fig : figa9 ] , which shows that @xmath51=5  gives fully converged eigenstates .      the computational time for the dominant part of the calculation in the described methodology scales linearly with the size of the system in the size range considered in this paper , if the states in the fixed energy window are required , for the following reasons .",
    "the number of fragments is proportional to the size of the system , while the number of basis wave functions per fragment remains the same .",
    "therefore , the time necessary to calculate all the basis wave functions is proportional to the number of fragments and consequently scales linearly with the size of the system .",
    "furthermore , the number of fragment pairs with distance less than a certain predefined @xmath51 is also proportional to the number of atoms .",
    "for example , in the case of alkanes for @xmath52 , the number of pairs is approximately ten times larger than the number of atoms . as a consequence ,",
    "the cpu time for these two parts of the calculation scales linearly with the size of the system , as shown in figs .",
    "[ fig : figa10 ] and [ fig : figxx ] .",
    "the final diagonalization step , on the other hand , formally scales as @xmath53 with the size of the system .",
    "however , in the system size range that we consider this step takes a much smaller amount of time than the first two steps , as demonstrated in fig .",
    "[ fig : figxx ] ( right panel ) . as a result ,",
    "in this range of system dimensions , the total computational effort scales linearly with system size , as can be seen in figs .",
    "[ fig : figa10 ] and [ fig : figxx ] .",
    "the main motivation behind the development of this methodology was the lack of appropriate methods for the efficient calculation of the electronic structure of disordered conjugated polymers , where large supercells are required to provide insight into the physical properties of the system .",
    "therefore , in this section , we test the applicability of the method to the calculation of hole states in p3ht , a widely studied polymer for applications in organic electronics .    we compare the eigenenergies obtained using ofm with the ones obtained by diagonalizing the cpm hamiltonian using the plane wave basis set with kinetic energy cutoff of 60  ry ( which is done using the escan code ) . for this test",
    ", we consider the system of 5 p3ht chains , each one being 20 thiophene rings long ( which makes 2510 atoms altogether ) . the atomic structure of the system was generated from classical md , using a simulated annealing procedure , as in our previous work.@xcite we make a comparison for ten different random realizations of the system , differing by initial conditions in md simulation .",
    "we choose the basis of overlapping trimer fragments . in the fragments the side hexyl chains",
    "have been replaced by propyl chains .",
    "this replacement is motivated by the well known fact that wave functions in the region near the band edge that determine the electronic properties are localized on the main chain and not the alkyl side chains .",
    "such a division into fragments would certainly not be sufficient to describe the part of electronic spectrum where the electronic states stemming from alkyl chains contribute to the density of states .",
    "that region is however far from the band gap region and is not of any physical interest .",
    "we further note that such a replacement by no means implies that the presence of hexyl side chains is ignored , in terms of their effects on the atomic structure of the system and the electrostatic potential in the full system hamiltonian @xmath23 as constructed using the cpm .",
    "we performed the test for different sizes of the basis set , consisting of @xmath15 top homos of each fragment ( where @xmath54 ) .",
    "the results gathered from all ten random realizations are presented in fig .",
    "[ fig : figb1 ] .",
    "the results obtained with @xmath55 are already quite accurate .",
    "the eigenenergy error for the states closest to the top of the valence band is of the order of 30  mev and increases to 120  mev as one goes 0.7  ev further away .",
    "the results are the most accurate for @xmath56 when the eigenenergy error is in the 10 - 50mev range .",
    "one should note that there is no exact principle that requires the eigenenergies to converge towards the `` exact '' ones as the basis set is increased and therefore there is no guarantee that a larger basis set would improve the results .",
    "indeed , we find that for @xmath57 the results become worse than for @xmath56 ( which can be evidenced by a larger dispersion of points and the presence of points both below and above the line ) . finally , as one goes beyond @xmath57 certain states enter the band gap region and it becomes impossible even to establish a correspondence between the eigenstates from plane wave calculation with eigenstates from ofm calculation .",
    "we would like to point out that our methodology strongly reduces the size of the basis set needed to represent the hamiltonian of the system and for that reason makes the diagonalization part of the calculation the least demanding one . in the case of 2510 atom p3ht system ,",
    "the basis of top three homos per fragment consists of 270 elements and yields eigenenergies with errors in the 10 - 50 mev range . on the other hand ,",
    "if the same system were considered using some typical basis of gaussian orbitals , such as 6 - 31g@xmath58 , the size of the basis set would be 19720 . in the case of alkanes ,",
    "the gain is somewhat smaller . in our method with 5 homos per fragment , that yields eigenenergy errors below 50  mev , we use 1800 basis wavefunctions to represent the 1240 atom alkane system . on the other hand , the 6 - 31g@xmath58 basis set for the same system",
    "consists of 7680 wavefunctions .",
    "we have introduced the ofm for the calculation of eigenstates of the single - particle hamiltonian .",
    "the method is based on the partitioning of the system into mutually overlapping fragments , the representation of the hamiltonian in the basis of eigenstates of these fragments and the diagonalization of the obtained generalized eigenvalue problem .",
    "we have illustrated the method by applying it to find the eigenstates of the hamiltonian of organic polymers obtained from the cpm .",
    "the method is expected to be more general  it would be very interesting to test the method in other systems , such as for example inorganic nanostructures , inorganic alloys or any other organic structures - either ordered or disordered .",
    "the method is expected to be especially useful for understanding the properties of electronic states in the near - band gap tail of the density of states of statically or dynamically disordered systems , where large statistics is necessary to get reliable information . in this kind of systems",
    "the method would provide detailed information about the density of states in the tail , the wave function localization properties and consequently the electronic transport in the system .",
    "furthermore , the method directly yields a parametrization of the hamiltonian in a localized basis set and as such can be used as a starting point to build simple , but insightful tight - binding models of disordered systems .",
    "finally , the method is naturally parallelizable and can make excellent use of parallel computing architectures , which have become the dominant paradigm in modern computing .",
    "this work was supported by the dms / bes / sc of the u.s .",
    "department of energy under contract no .",
    "de - ac02 - 05ch11231 .",
    "it used the resources of national energy research scientific computing center ( nersc ) and the incite project allocations within the national center for computational sciences ( nccs ) . in the last stages of this work ,",
    "nv was supported by the ministry of science and technological development of the republic of serbia , under project no .",
    "on171017 , and the european commission under eu fp7 projects prace-1ip , hp - see and egi - inspire ."
  ],
  "abstract_text": [
    "<S> we present a method for the calculation of electronic structure of systems that contain tens of thousands of atoms . </S>",
    "<S> the method is based on the division of the system into mutually overlapping fragments and the representation of the single - particle hamiltonian in the basis of eigenstates of these fragments . in practice , for the range of system size that we studied ( up to tens of thousands of atoms ) , the dominant part of the calculation scales linearly with the size of the system when all the states within a fixed energy interval are required . </S>",
    "<S> the method is highly suitable for making good use of parallel computing architectures . </S>",
    "<S> we illustrate the method by applying it to diagonalize the single - particle hamiltonian obtained using the density functional theory based charge patching method in the case of amorphous alkane and polythiophene polymers . </S>"
  ]
}