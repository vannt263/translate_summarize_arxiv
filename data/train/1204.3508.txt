{
  "article_text": [
    "we begin by quoting the introduction from the groundbreaking paper @xcite of eisenbud and harris :    * `` one of the most potent methods in the theory of ( complex projective algebraic ) curves and their linear systems since the work of castelnuovo has been degeneration to singular curves ... most problems of interest about curves are , or can be , formulated in terms of ( families of ) linear series .",
    "thus , in order to use degenerations to reducible curves for studying smooth curves , it is necessary to understand what happens to linear series in the course of such a degeneration , and in particular , to understand what structure on a reducible curve plays the part of a linear series . ''",
    "this has been very successful in practice and has led to important advances in the study of algebraic curves ( see @xcite for an overview ) ; we mention for example brill - noether theory  @xcite , the geometry of the moduli space of curves  @xcite , and weierstrass points and their monodromy  @xcite . in view of the deligne - mumford compactification of @xmath11 and the stable reduction theorem  @xcite",
    ", it is particularly natural to consider degeneration of smooth curves to stable ( or more generally semistable ) curves .",
    "eisenbud and harris were able to settle a number of longstanding open problems with their theory of limit linear series on such curves , and the theory has undergone numerous developments and improvements in the last 25 years",
    ". however , the theory of limit linear series only applies , for the most part , to a rather restricted class of reducible curves , namely those of _ compact type _",
    "( i.e. , nodal curves whose dual graph is a tree ) .    in @xcite",
    ", the second author introduced a new framework for degenerating linear series on curves , degenerating linear series on a regular semistable family of curves to a linear series on the _ dual graph _ of the special fiber .",
    "this theory , which is closely related to tropical geometry and also to the theory of berkovich analytic spaces , is more or less orthogonal to the eisenbud - harris theory , in that it works best for special fibers which are _ maximally degenerate _ , meaning that the dual graph has first betti number equal to the genus of the generic fiber .",
    "specializing linear series to the dual graph provides no information whatsoever when the special fiber is of compact type . intriguingly , both the eisenbud - harris theory and the second author s theory from @xcite lead to simple proofs of the celebrated brill - noether theorem of griffiths - harris ( see @xcite ) .",
    "the aim of the present paper is to introduce a theoretical framework suitable for generalizing both the eisenbud - harris theory of limit linear series and the second author s theory of specialization from curves to graphs .",
    "the main new object of study is what we call a _",
    "metrized complex of algebraic curves _ over an algebraically closed field @xmath0 ; this is , roughly speaking , a finite metric graph @xmath1 together with a collection of marked complete nonsingular algebraic curves @xmath2 over @xmath0 , one for each vertex @xmath3 ( with a marked point on @xmath2 for each edge of @xmath1 incident to @xmath3 ) .",
    "we define divisors , linear equivalence of divisors , and rank of divisors on metrized complexes of curves and establish a riemann - roch theorem for metrized complexes of curves which combines the classical riemann - roch theorem over @xmath0 with its graph - theoretic and tropical analogues proved in @xcite . for a curve @xmath4 defined over a non - archimedean field @xmath5 , together with a strongly semistable model @xmath6 for @xmath4 over the valuation ring @xmath7 of @xmath5 ,",
    "we define a corresponding metrized complex @xmath8 of curves over the residue field @xmath0 of @xmath5 and a specialization map @xmath9 from divisors on @xmath4 to divisors on @xmath8 preserving degrees and linear equivalence .",
    "we then establish generalizations of the specialization lemma from @xcite and its weighted graph analogue from @xcite , showing that the rank of a divisor can not go down under specialization from @xmath4 to @xmath8 . as an application",
    ", we establish a concrete link between specialization of divisors from curves to metrized complexes and the eisenbud - harris theory of limit linear series . using this link",
    ", we formulate a generalization of the notion of limit linear series to curves which are not necessarily of compact type and prove , among other things , that any degeneration of a @xmath10 in a regular family of semistable curves is a limit @xmath10 on the special fiber .",
    "as mentioned above , the specialization theory from @xcite works best in the case where the family is maximally degenerate ; in other cases , the dual graph of the family forgets too much information .",
    "this loss of information was partially remedied in @xcite by looking at vertex - weighted graphs , where the weight attached to a vertex is the genus of the corresponding irreducible component of the special fiber .",
    "the theory of metrized complexes of curves offers a richer solution in which one keeps track of the ( normalization of the ) irreducible components @xmath2 of the special fiber themselves , and not just their genera .",
    "from the point of view of non - archimedean geometry , this corresponds to retracting divisors on @xmath4 to the skeleton @xmath12 , a metric graph canonically embedded in the berkovich analytic space @xmath13 , but also keeping track , for points retracting to a vertex of @xmath12 , of the tangent direction in which the vertex is approached .",
    "this is quite natural from the valuation - theoretic point of view : the metric graph @xmath12 associated to a strongly semistable model @xmath6 is a canonical subset of the berkovich analytic space @xmath13 , and the curve @xmath2 over @xmath0 is naturally identified ( for each @xmath14 ) with the fiber over @xmath3 of the canonical retraction map @xmath15 ( which sends a continuous valuation of arbitrary rank in the huber adic space @xmath16 to its canonical rank-1 generalization ) , c.f .",
    "* remark 2.6 ) . though we could possibly ( with quite a bit of additional effort ) have formulated many of our theorems and proofs without mentioning berkovich spaces , it would have resulted in a significant loss of elegance and clarity , and in any case berkovich s theory seems ideally suited for the point of view taken here .",
    "we do not , however , require any non - trivial facts from huber s theory of adic spaces , so we will not mention them again even though they are certainly lurking in the background .",
    "there are a number of connections between the ideas in the present paper and tropical geometry ; these will be explored in more detail in future work .",
    "for example , the theory of morphisms between metrized complexes of curves studied in @xcite sheds interesting new light on the question of which morphisms between tropical curves are liftable .",
    "the theory developed in @xcite shows that there is a close connection between metrized complexes of curves and `` exploded tropicalizations '' in the sense of ( * ? ? ?",
    "* definition 2.9 ) ; we plan to say more about this in the future as well .",
    "as noted by payne in @xcite , exploded tropicalizations can be thought of as an algebraic analogue of the `` exploded torus fibrations '' studied by parker from a symplectic viewpoint @xcite .",
    "it could be interesting to explore connections between _ loc .",
    "cit . _ and the present work .",
    "the ideas in the present paper also have diophantine applications to the study of rational points on curves over number fields ( specifically , to the method of coleman - chabauty ) .",
    "indeed , eric katz and david zureick - brown have recently proved a result similar to theorem  [ thm : mcclifford ] below ( clifford s theorem for metrized complexes ) , and they use this result to answer a question of m.  stoll .",
    "a special case of the main result in @xcite is the following .",
    "let @xmath4 be a smooth projective geometrically irreducible curve of genus @xmath17 over @xmath18 and assume that the mordell - weil rank @xmath19 of the jacobian of @xmath4 is less than @xmath20 . fix a prime number @xmath21 and let @xmath6 be a proper ( not necessarily semistable ) regular model for @xmath4 over @xmath22 .",
    "then ( letting @xmath23 denote the smooth locus of @xmath24 ) @xmath25    we discuss the theorem of katz and zureick - brown in more detail in section  [ chabautysection ] below , explaining how limit linear series on metrized complexes of curves can be used to illuminate their proof and put it into a broader context .",
    "we set the following notation , which will be used throughout this paper .    a finite edge - weighted graph with vertex set @xmath26 and edge set @xmath27    a compact metric graph ( geometric realization of an edge - weighted graph @xmath28 )    a complete and algebraically closed non - trivially valued non - archimedean field    the valuation ring of @xmath5    the residue field of @xmath5    a smooth , proper , connected algebraic curve defined over @xmath5    the berkovich analytification of @xmath29    a proper and flat semistable @xmath7-model for @xmath4 , usually assumed to be strongly semistable    a smooth , proper , connected algebraic curve over @xmath30 ( one for each vertex @xmath31 )    a metrized complex of algebraic curves over @xmath30    the geometric realization of @xmath32    the metrized complex associated to a strongly semistable @xmath7-model @xmath33 of @xmath4    a nodal curve defined over @xmath30    an irreducible component of @xmath34    the regularization of the nodal curve @xmath34    the group of divisors on the metrized complex @xmath32    a divisor on @xmath32    an effective divisor on @xmath32    a rational function on @xmath32    a divisor on @xmath2    an effective divisor on @xmath2    a rational function on @xmath1 , usually the @xmath1-part of a rational function @xmath35 on @xmath32    a rational function on @xmath2 , usually the @xmath2-part of a rational function @xmath35 on @xmath32    the outgoing slope of @xmath36 along an edge ( or tangent direction ) @xmath37    the rank function on @xmath38    the restricted rank function with respect to a collection @xmath39 of subspaces of @xmath40    the retraction map from @xmath41 to the skeleton @xmath42 of @xmath33    the specialization map from @xmath43 to @xmath44    the marked points of @xmath2 in the metrized complex @xmath32    the point of @xmath45 corresponding to the edge ( or tangent direction ) @xmath37    the sum in @xmath46 of the points of @xmath45      we now discuss the contents of this paper in more detail .",
    "an _ edge - weighted graph _",
    "@xmath28 is a connected multigraph , possibly with loop edges , having vertex set @xmath26 and edge set @xmath27 , and endowed with a weight ( or length ) function @xmath47 .",
    "metric graph _",
    "@xmath1 is the geometric realization of an edge - weighted graph @xmath28 in which each edge @xmath37 of @xmath28 is identified with a line segment of length @xmath48 .",
    "we call @xmath28 a _ model _ for @xmath1 . subdividing an edge of @xmath28 in a length - preserving fashion",
    "changes the model but not the underlying metric graph .",
    "let @xmath0 be an algebraically closed field .. ] a _ metrized complex @xmath32 of @xmath0-curves _ consists of the following data :    * a connected finite graph @xmath28 with vertex set @xmath26 and edge set @xmath27 .",
    "* a metric graph @xmath1 having @xmath28 as a model ( or equivalently , a length function @xmath49 ) . * for each vertex @xmath3 of @xmath28 , a complete , nonsingular , irreducible curve @xmath2 over @xmath0 .",
    "* for each vertex @xmath3 of @xmath28 , a bijection @xmath50 between the edges of @xmath28 incident to @xmath3 ( with loop edges counted twice ) and a subset @xmath51 of @xmath52 .",
    "the _ geometric realization _",
    "@xmath53 of @xmath32 is defined to be the union of the edges of @xmath28 and the collection of curves @xmath2 , with each endpoint @xmath3 of an edge @xmath37 identified with the corresponding marked point @xmath54 .",
    "see figure  [ fig : mcsmall ] . when we think of @xmath53 as a set , we identify it with the disjoint union of @xmath55 and @xmath56",
    "thus , when we write @xmath57 , we mean that @xmath58 is either a non - vertex point of @xmath1 ( a _ graphical point _ of @xmath32 ) or a point of @xmath52 for some @xmath14 ( a _ geometric point _ of @xmath32 ) .",
    "the _ genus _ of a metrized complex of curves @xmath32 , denoted @xmath59 , is by definition @xmath60 , where @xmath61 is the genus of @xmath2 and @xmath62 is the first betti number of @xmath1 .    given a metrized complex @xmath32 of @xmath0-curves , there is an associated semistable curve @xmath34 over @xmath0 obtained by gluing the curves @xmath2 along the points @xmath54 ( one intersection for each edge @xmath37 of @xmath28 ) and forgetting the metric structure on @xmath1 .",
    "conversely , given a semistable curve @xmath34 over @xmath0 together with a positive real number for each node ( which we call a `` length function '' ) , one obtains an associated metrized complex of @xmath0-curves by letting @xmath28 be the dual graph of @xmath34 , @xmath1 the metric graph associated to @xmath28 and the given length function , @xmath2 the normalization of the irreducible component @xmath63 of @xmath34 corresponding to @xmath3 , and @xmath45 the preimage in @xmath2 of the set of nodes of @xmath34 belonging to @xmath63 .",
    "let @xmath5 be a complete and algebraically closed non - archimedean field with residue field @xmath0 and let @xmath29 be a smooth , proper , connected algebraic curve .",
    "there is a metrized complex @xmath64 canonically associated to any strongly semistable model @xmath6 of @xmath4 over the valuation ring @xmath7 of @xmath5 : the special fiber @xmath24 of @xmath6 is a semistable curve over @xmath0 , and one defines the length of an edge @xmath37 of the dual graph of @xmath24 to be the _ modulus _ of the open annulus @xmath65 , where @xmath66 is the singular point of @xmath24 corresponding to @xmath37 and @xmath67 is the canonical reduction map .",
    "equivalently , there is a local analytic equation for @xmath66 of the form",
    "@xmath68 with @xmath69 in the maximal ideal of @xmath7 , and the length of @xmath37 is @xmath70 .",
    "the corresponding metric graph @xmath71 is called the _ skeleton _ of @xmath6 , and there is a canonical retraction map @xmath72 , where @xmath13 denotes the berkovich analytification of @xmath4 . by restricting to @xmath73 and then extending by linearity , we obtain a specialization map @xmath74 .",
    "if @xmath7 is a discrete valuation ring and the fibered surface @xmath75 is regular , then one can use intersection - theoretic methods to define and study specialization of divisors from curves to graphs .",
    "for example , in @xcite , using intersection theory , a specialization homomorphism @xmath76 was defined , where @xmath28 is the dual graph of @xmath24 , with the property that @xmath77 and @xmath78 are linearly equivalent as divisors on @xmath12 for all @xmath79 . in the present paper ,",
    "we focus exclusively on @xmath80 and its generalization to metrized complexes of curves , though in principle all of our results can be translated ( when @xmath7 is a discrete valuation ring and @xmath6 is regular ) into results about this alternative specialization map .    a _ divisor _ on a metrized complex of curves",
    "@xmath32 is an element @xmath81 of the free abelian group on @xmath53 .",
    "thus a divisor on @xmath32 can be written uniquely as @xmath82 where @xmath83 , all but finitely many of the @xmath84 are zero , and the sum is over all points of @xmath55 as well as @xmath52 for @xmath14 .",
    "the _ degree _ of @xmath81 is defined to be @xmath85 .    to a divisor on @xmath32 , we can naturally associate a divisor @xmath86 on @xmath1 , called the _",
    "@xmath1-part _ of @xmath87 , as well as , for each @xmath14 , a divisor @xmath88 on @xmath2 ( called the _",
    "@xmath2-part _ of @xmath87 ) .",
    "the divisor @xmath88 is simply the restriction of @xmath87 to @xmath2 , i.e. @xmath89 , and @xmath86 is defined as @xmath90 where @xmath91 denotes the coefficient of @xmath58 in @xmath81 .    in particular , the degree of @xmath81 equals the degree of @xmath86 .",
    "one could equivalently define a divisor on @xmath32 to be an element of the form @xmath92 of @xmath93 such that @xmath94 for all @xmath3 in @xmath26 .",
    "the specialization map @xmath80 can be enhanced in a canonical way to a map from divisors on @xmath4 to divisors on @xmath8 .",
    "the fiber @xmath95 of the retraction map @xmath96 over a vertex @xmath14 can be canonically identified with @xmath97 , the fiber of the reduction map @xmath98 over the smooth locus @xmath99 of @xmath2 .",
    "we define @xmath100 by setting @xmath101 and we extend this by linearity to a map @xmath102 .    intuitively speaking , for points @xmath103 of @xmath73 which reduce to smooth points of @xmath24 , the map @xmath104 keeps track of the reduced point @xmath105 , while if @xmath103 reduces to a singular point of @xmath24 then @xmath104 instead keeps track of the retraction of @xmath103 to the skeleton of the open annulus @xmath106 , which is canonically identified with the relative interior of the corresponding edge of @xmath12 .    a _ nonzero rational function _",
    "@xmath35 on a metrized complex of curves @xmath32 is the data of a rational function @xmath36 on @xmath1 and nonzero rational functions @xmath107 on @xmath2 for each @xmath31 .",
    "( we do _ not _ impose any compatibility conditions on the rational functions @xmath36 and @xmath107 . )",
    "we call @xmath36 the _ @xmath1-part _ of @xmath35 and @xmath107 the _ @xmath2-part _ of @xmath35 .    the _ divisor _ of a nonzero rational function @xmath35 on @xmath32",
    "is defined to be @xmath108 where @xmath109 is defined as follows :    * if @xmath110 , then @xmath111 , where @xmath112 is the sum of the slopes of @xmath36 in all tangent directions emanating from @xmath58 . * if @xmath113 , then @xmath114 . * if @xmath115 , then @xmath116 , where @xmath117 is the outgoing slope of @xmath36 at @xmath3 in the direction of @xmath37 .    if @xmath86 ( resp .",
    "@xmath88 ) denotes the @xmath1-part ( resp .",
    "the @xmath2-part ) of @xmath118 , then @xmath119 @xmath120    divisors of the form @xmath118 are called _ principal _ , and the principal divisors form a subgroup of @xmath121 , the group of divisors of degree zero on @xmath32 .",
    "two divisors in @xmath38 are called _ linearly equivalent _ if they differ by a principal divisor .",
    "linear equivalence of divisors on @xmath32 can be understood quite intuitively in terms of `` chip - firing moves '' . to state this formally , for each vertex @xmath3 of @xmath28 , let @xmath122 be the sum of the @xmath123 points in @xmath45 and",
    "let @xmath124 be the minimum length of an edge @xmath37 incident to @xmath3 .",
    "also , for an edge @xmath37 having @xmath3 as an endpoint and a positive real number @xmath125 , let @xmath126 be the unique point of @xmath37 at distance @xmath127 from @xmath3 .",
    "then it is not hard to show that linear equivalence of divisors on @xmath32 is the equivalence relation generated by the following three kinds of `` moves '' :    1 .",
    "( firing on @xmath2 ) choose a vertex @xmath3 and replace the divisor @xmath88 with a linearly equivalent divisor @xmath128 on @xmath2 .",
    "2 .   ( firing a vertex )",
    "choose a vertex @xmath3 and a positive real number @xmath129 and replace @xmath88 with @xmath130 and @xmath86 with @xmath131 .",
    "3 .   ( firing a non - vertex )",
    "choose a non - vertex @xmath132 and a positive real number @xmath127 less than the distance from @xmath133 to the nearest vertex and replace @xmath86 by the divisor @xmath134 , where @xmath135 are the two points at distance @xmath127 from @xmath133 .",
    "the motivation for our definitions of @xmath9 and @xmath118 come from the following fundamental relation , a consequence of the non - archimedean poincar - lelong formula due to thuillier ( see  5 of @xcite ) .",
    "let @xmath136 be a nonzero rational function on @xmath4 and let @xmath35 be the corresponding nonzero rational function on @xmath8 , where @xmath137 is the restriction to @xmath1 of the piecewise linear function @xmath138 on @xmath13 and @xmath139 for @xmath14 is the normalized reduction of @xmath136 to @xmath2 ( cf .  ",
    "[ section : reductionofrationalfunctions ] ) .",
    "then @xmath140    in particular , we have @xmath141 .",
    "a divisor @xmath142 on @xmath32 is called _ effective _ if @xmath143 for all @xmath58 ( or , equivalently , if the @xmath1-part @xmath144 and the @xmath2-parts @xmath145 of @xmath146 are effective for every @xmath31 )",
    ". the _ rank _",
    "@xmath147 of a divisor @xmath148 is defined to be the largest integer @xmath149 such that @xmath150 is linearly equivalent to an effective divisor for all effective divisors @xmath146 of degree @xmath149 on @xmath32 ( so in particular @xmath151 if and only if @xmath81 is linearly equivalent to an effective divisor , and otherwise @xmath152 ) .",
    "if @xmath153 denotes the usual rank function @xmath154 on @xmath43 , there is an important semicontinuity result relating @xmath155 to @xmath156 :    [ thm : introspecialization ] for all @xmath79 , we have @xmath157    since @xmath158 , theorem  [ thm : introspecialization ] is a strengthening of the analogous specialization result from @xcite . in conjunction with a simple combinatorial argument , theorem",
    "[ thm : introspecialization ] also refines the specialization lemma for vertex - weighted graphs from @xcite .",
    "we also state and prove a version of theorem  [ thm : introspecialization ] in which one has _",
    "equality _ rather than just an inequality .",
    "one can naturally associate to a rank @xmath19 divisor @xmath159 on @xmath4 not only a divisor @xmath160 on @xmath8 , but also a collection @xmath161 of @xmath162-dimensional subspaces of @xmath40 , where @xmath163 is the reduction to @xmath2 of all functions in @xmath164 ( c.f .",
    "section  [ section : reductionofrationalfunctions ] for a discussion of reduction of rational functions ) . if @xmath165 , where @xmath166 is any @xmath0-subspace of the function field @xmath167 , then for @xmath168 we define the _ @xmath169-restricted rank _ of @xmath87 , denoted @xmath170 , to be the largest integer @xmath149 such that for any effective divisor @xmath171 of degree @xmath149 on @xmath32 , there is a rational function @xmath35 on @xmath32 whose @xmath2-parts @xmath107 belong to @xmath166 for all @xmath14 , and such that @xmath172 .",
    "( in terms of the `` chip - firing moves '' described above , one has to be able to make @xmath173 effective using only type ( 1 ) moves corresponding to functions belonging to one of the spaces @xmath166 , together with moves of type ( 2 ) or ( 3 ) . ) the following variant of theorem  [ thm : introspecialization ] will be proved as theorem  [ thm : limitseriesgeneral ] below :    with notation as above , the @xmath174-restricted rank of the specialization of @xmath159 is equal to the rank of @xmath159 , i.e. , @xmath175 .",
    "the theory of divisors and linear equivalence on metrized complexes of curves generalizes both the classical theory for algebraic curves and the corresponding theory for metric graphs and tropical curves found in @xcite .",
    "the former corresponds to the case where @xmath28 consists of a single vertex @xmath3 and no edges and @xmath176 is an arbitrary smooth curve .",
    "the latter corresponds to the case where the curves @xmath2 have genus zero for all @xmath14 . since any two points on a curve of genus zero are linearly equivalent , it is easy to see that the divisor theories and rank functions on @xmath32 and @xmath1 are essentially equivalent .",
    "more precisely , ( i ) two divisors @xmath81 and @xmath177 on @xmath32 are linearly equivalent if and only if their @xmath1-parts @xmath86 and @xmath178 are linearly equivalent on @xmath1 , and ( ii ) for every @xmath179 we have @xmath180 . in the presence of higher genus curves among the @xmath2 , the divisor theories on @xmath1 and @xmath32 can be very different .",
    "in addition , different choices of @xmath45 can drastically change both the linear equivalence relation and the rank function .    as with the corresponding specialization theory from @xcite , the main utility of theorem  [ thm : introspecialization ]",
    "is that the rank function @xmath181 on a metrized complex of curves is surprisingly well - behaved ; for example , it satisfies an analogue of the riemann - roch formula . in order to state this result",
    ", we need to define the canonical class .",
    "a _ canonical divisor _ on @xmath32 , denoted @xmath182 , is defined to be any divisor linearly equivalent to @xmath183 , where @xmath184 is a canonical divisor on @xmath2 and @xmath122 is the sum of the @xmath123 points in @xmath45 .",
    "the @xmath1-part of @xmath182 is @xmath185 , and the @xmath2-part of @xmath182 is @xmath186 .",
    "the following result generalizes both the classical riemann - roch theorem for algebraic curves and the riemann - roch theorem for metric graphs :    [ thm : introrr - metrizedcomplexes ] let @xmath32 be a metrized complex of algebraic curves over @xmath0 and @xmath182 a divisor in the canonical class of @xmath32 . for any divisor @xmath148 ,",
    "we have @xmath187    the proof of theorem  [ thm : introrr - metrizedcomplexes ] makes use of a suitable notion of _ reduced divisors _ for metrized complexes of curves .    taken together , theorems [ thm : introspecialization ] and [ thm : introrr - metrizedcomplexes ] have some interesting consequences .",
    "for example , the specialization theorem implies that the specialization to @xmath8 of any canonical divisor on @xmath4 has degree @xmath188 and rank at least @xmath189 ( where @xmath190 ) , while the riemann - roch theorem easily implies that any such divisor on @xmath8 belongs to the canonical divisor class .",
    "thus we have :    [ cor : introcanonspec ] for any canonical divisor @xmath191 on @xmath4 , its specialization @xmath192 belongs to the canonical divisor class on @xmath8 .",
    "in particular , corollary  [ cor : introcanonspec ] implies that @xmath193 is a canonical divisor on @xmath1 .",
    "this fact was proved in @xcite , for discretely valued @xmath7 , by a completely different argument based on the adjunction formula for arithmetic surfaces .",
    "it does not seem easy to prove the general ( not necessarily discretely valued ) case using arithmetic intersection theory , since there does not seem to be a satisfactory theory of relative dualizing sheaves and adjunction in the non - noetherian setting .",
    "our theory of linear series on metrized complexes of curves has close connections with the eisenbud - harris theory of limit linear series for strongly semistable curves of compact type , and suggests a way to generalize the eisenbud - harris theory to more general semistable curves .",
    "a proper nodal curve @xmath34 over @xmath0 is of _ compact type _ if its dual graph @xmath28 is a tree . for such curves , eisenbud and harris",
    "define a notion of ( crude ) _",
    "limit @xmath10 _ , which we discuss in detail in section  [ sec : limitcompact ] below .",
    "a _ crude limit _",
    "@xmath194 on @xmath34 is the data of a ( not necessarily complete ) degree @xmath195 and rank @xmath19 linear series @xmath196 on @xmath63 for each vertex @xmath14 such that if two components @xmath197 and @xmath63 of @xmath34 meet at a node @xmath133 , then for any @xmath198 @xmath199 where @xmath200 denotes the @xmath201 term in the vanishing sequence of a linear series @xmath194 at @xmath133 .",
    "a crude limit series is _ refined _ if all the inequalities in the above definition are equalities .",
    "for simplicity , all limit linear series in the remainder of this introduction will be crude",
    ".    we can canonically associate to a proper strongly curve @xmath34 a metrized complex @xmath202 of @xmath0-curves , called the _ regularization _ of @xmath34 , by assigning a length of @xmath203 to each edge of @xmath28 , and we write @xmath63 for the irreducible component of @xmath34 corresponding to a vertex @xmath14 .",
    "( this is the metrized complex associated to any regular smoothing @xmath6 of @xmath34 over any discrete valuation ring @xmath7 with residue field @xmath0 . )",
    "[ thm : introlls ] let @xmath202 be the metrized complex of curves associated to a proper strongly semistable curve @xmath204 of compact type .",
    "then there is a bijective correspondence between the following :    * crude limit @xmath10 s on @xmath34 . *",
    "equivalence classes of pairs @xmath205 , where @xmath206 , @xmath163 is an @xmath162-dimensional subspace of @xmath207 for each @xmath14 , and @xmath87 is a divisor of degree @xmath195 supported on the vertices of @xmath202 with @xmath208 .",
    "here we say that @xmath209 if there is a rational function @xmath35 on @xmath202 such that @xmath210 and @xmath211 for all @xmath14 , where @xmath107 denotes the @xmath2-part of @xmath35 .",
    "theorem  [ thm : introlls ] , combined with our riemann - roch theorem for metrized complexes of curves , provides an arguably more conceptual proof of the fact ( originally established in @xcite ) that limit linear series satisfy analogues of the classical theorems of riemann and clifford .",
    "the point is that @xmath212 for all @xmath213 and therefore upper bounds on @xmath214 which follow from riemann - roch imply corresponding upper bounds on the restricted rank @xmath215 .    motivated by theorem  [ thm : introlls ] , we propose the following definition .",
    "let @xmath34 be a proper strongly semistable ( but not necessarily compact type ) curve over @xmath0 with regularization @xmath202 .",
    "limit @xmath10 _ on @xmath34 is an equivalence class of pairs @xmath216 as above , where @xmath163 is an @xmath162-dimensional subspace of @xmath207 for each @xmath14 , and @xmath87 is a degree @xmath195 divisor on @xmath202 with @xmath208 .    as a partial justification for this definition",
    ", we prove that if @xmath7 is a discrete valuation ring with residue field @xmath0 and @xmath75 is a regular arithmetic surface whose generic fiber @xmath4 is smooth and whose special fiber @xmath34 is strongly semistable , then for any divisor @xmath159 on @xmath4 with @xmath217 and @xmath218 , our specialization machine gives rise in a natural way to a limit @xmath10 on @xmath34 ( see theorem  [ thm : regularlimitseries ] below for a precise statement , and theorem  [ thm : limitseriesgeneral ] for a more general statement ) .",
    "let @xmath0 be an algebraically closed field of arbitrary characteristic and let @xmath32 be a metrized complex of @xmath0-curves , as defined in section  [ section : overview ] .",
    "if @xmath219 is a subgroup of @xmath220 containing the lengths of all edges of @xmath28 , we write @xmath221 for the subgroup of @xmath222 consisting of all divisors @xmath81 such that the support of the @xmath1-part of @xmath87 consists entirely of @xmath219-_rational points _ of @xmath1 ( i.e. , points of @xmath1 whose distances to the vertices of @xmath28 are in @xmath223 ) .",
    "recall from section  [ section : overview ] that the _ rank _ @xmath147 of a divisor @xmath81 on @xmath32 is the largest integer @xmath149 such that @xmath150 is linearly equivalent to an effective divisor for all effective divisors @xmath146 of degree @xmath149 on @xmath32 .",
    "if @xmath219 is any subgroup of @xmath220 containing the lengths of all edges of @xmath28 , one can define an analogous rank function @xmath224 for divisors in @xmath225 by restricting the effective divisors @xmath146 in the above definition to lie in @xmath225 . by corollary  [ cor : f - widthg ] , @xmath226 for any divisor @xmath227 , so the restriction in the definition of @xmath224 does not affect the rank of divisors .",
    "let @xmath34 be a ( reduced ) connected projective nodal curve over @xmath30 with irreducible components @xmath228 .",
    "we can associate to @xmath34 a metrized complex @xmath202 , called the _ regularization _ of @xmath34 , as follows . the underlying metric graph @xmath229 has model the dual graph @xmath230 of @xmath34 . recall that the vertex set @xmath231 of @xmath232 consists of vertices @xmath233 ( in bijection with the irreducible components of @xmath34 ) and the edges of @xmath232 are in bijection with singular points of @xmath34 .",
    "( note that @xmath232 might have loop edges . )",
    "the length of all the edges in @xmath229 are equal to one .",
    "the @xmath30-curve @xmath234 in @xmath202 is the normalization of @xmath235 for @xmath236 .",
    "the collection @xmath237 is the set of all @xmath30-points of @xmath234 which lie over a singular point of @xmath34 in @xmath238 . by the definition of the dual graph ,",
    "these points are in bijection with the edges adjacent to @xmath239 in @xmath232 .    if @xmath34 is _ strongly semistable _ , so that @xmath232 does not have any loop edge and @xmath240 , the rank function @xmath241 on @xmath242 can be reformulated as follows .",
    "let @xmath243 be the picard group of @xmath34 , and consider the restriction map @xmath244 .",
    "for any line bundle @xmath245 on @xmath34 , and @xmath246 , denote by @xmath247 the restriction of @xmath245 to @xmath63 .",
    "two line bundles @xmath245 and @xmath248 in @xmath243 are said to be _ combinatorially equivalent _ if there exists a function @xmath249 such that @xmath250 in @xmath251 for any vertex @xmath3 of @xmath252 ( in a regular smoothing of @xmath34 , c.f .",
    "section  [ sec : limitseries ] for the definition , the role of @xmath136 is to specify a particular twist of @xmath245 by a divisor supported on the irreducible components of @xmath34 . ) in particular , two line bundles @xmath245 and @xmath248 in @xmath243 with @xmath253 are combinatorially equivalent . in the above definition",
    ", @xmath254 is defined in analogy with ( [ eq : divf2 ] ) as follows : @xmath255 where @xmath256 is the point of @xmath2 labelled with the edge @xmath257 .",
    "note that the function @xmath249 in the definition of combinatorially equivalent line bundles above is unique up to an additive constant .",
    "for such an @xmath136 , we denote by @xmath258 any line bundle @xmath248 in @xmath243 such that @xmath250 for all @xmath246 .    for a line bundle @xmath245 on @xmath34 , define the _ combinatorial rank _ of @xmath245 , denoted @xmath259 , to be the maximum integer @xmath19 such that for any effective divisor @xmath260 on @xmath232 of degree @xmath19 , there is a line bundle @xmath248 combinatorially equivalent to @xmath245 with @xmath261 for all @xmath14 . in particular , if no non - negative integer @xmath19 with the above property exists , the combinatorial rank of @xmath245 will be equal to @xmath262 .",
    "the combinatorial rank of @xmath245 clearly depends only on the combinatorial equivalence class of @xmath245 .",
    "let @xmath81 be a divisor in @xmath242 with @xmath63-part @xmath88 .",
    "we denote by @xmath263 any line bundle on @xmath34 whose restriction to @xmath63 is @xmath264 for each vertex @xmath3 of @xmath232 .",
    "[ prop : combinrank ] let @xmath34 be a strongly semistable curve over @xmath30 and let @xmath202 be the corresponding metrized complex .",
    "then :    1 .",
    "two divisors @xmath81 and @xmath177 in @xmath242 are linearly equivalent iff @xmath263 and @xmath265 are combinatorially equivalent .",
    "2 .   for any divisor @xmath266 ,",
    "the combinatorial rank of @xmath263 is equal to @xmath267    the first part follows by definition . to see the second part ,",
    "let @xmath19 be the combinatorial rank of @xmath263 .",
    "it follows from corollary  [ cor : f - widthz ] that @xmath268 .",
    "thus , it will be enough to show that @xmath269 .",
    "we first prove that @xmath270 .",
    "let @xmath146 be an effective divisor in @xmath242 with @xmath1-part @xmath144 and @xmath63-part @xmath145 .",
    "by the definition of the combinatorial rank , there exists a function @xmath271 such that @xmath272 since @xmath273 , this implies the existence of a global section @xmath107 of @xmath274 such that @xmath107 has order of vanishing at least @xmath275 at any point @xmath58 of @xmath63 .",
    "let @xmath36 be the rational function defined by @xmath136 on @xmath1 .",
    "( recall that @xmath276 and @xmath136 is integer affine with slope @xmath277 on each edge @xmath257 . ) for the rational function @xmath35 on @xmath202 defined by @xmath36 and @xmath278 , one has @xmath279 .",
    "this shows that @xmath280 .",
    "we now prove that @xmath281 .",
    "let @xmath282 be a line bundle on @xmath34 defined by @xmath81 .",
    "let @xmath27 be an effective divisor of degree @xmath283 on @xmath232 , and let @xmath146 be any effective divisor in @xmath242 with @xmath1-part equal to @xmath27 .",
    "then there exists a rational function @xmath35 with @xmath284 such that @xmath285 .",
    "in particular , the @xmath1-part @xmath36 of @xmath35 is linear on each edge of @xmath232 and @xmath286 , which shows that up to an additive constant , the set @xmath287 of all functions @xmath36 with these properties is finite .",
    "let @xmath288 denote the finite set @xmath289 .",
    "let @xmath290 , and for @xmath291 , let @xmath292 be the subset of @xmath293 defined by all collections of effective divisors @xmath145 of degree @xmath294 such that there exists a rational function @xmath35 on @xmath202 with @xmath1-component @xmath36 satisfying @xmath295 .",
    "( here @xmath296 denotes the @xmath297 symmetric product of a curve @xmath4 . )",
    "now let @xmath298 be the union over all @xmath291 of @xmath292 .",
    "then one sees easily that :    * each @xmath292 is zariski - closed in @xmath299 .",
    "( use the fact that @xmath292 is the projection of a zariski closed subset of a product of proper curves . ) * @xmath300 .",
    "therefore there exists @xmath291 such that @xmath301 .",
    "in other words , we can suppose that the @xmath1-part @xmath36 of all the rational functions @xmath35 giving @xmath302 , when the effective divisors @xmath145 vary , is constant ( and we have @xmath303 ) .",
    "if we fix a corresponding twist @xmath304 , then @xmath305    since @xmath27 was an arbitrary effective divisor of degree @xmath283 on @xmath232 , we obtain the desired inequality .",
    "our aim in this section is to formulate and prove a riemann - roch theorem for metrized complexes of @xmath0-curves .",
    "let @xmath32 be a metrized complex of algebraic curves over @xmath30 . for each vertex @xmath14 ,",
    "let @xmath61 be the genus of @xmath2 and let @xmath306 be the genus of @xmath32 . for each curve @xmath2 ,",
    "let @xmath184 denote a divisor of degree @xmath307 in the canonical class of @xmath2 . denote by @xmath122 the divisor in @xmath2 consisting of the sum of the @xmath123 points in @xmath45 .",
    "canonical class of @xmath32 _ is defined to be the linear equivalence class of the divisor @xmath308    [ rem : canonicalsemi - stable ] let @xmath34 be a strongly semistable curve .",
    "the definition of the canonical class @xmath182 in @xmath202 is compatible in a natural sense with the definition of the dualizing sheaf ( or sheaf of logarithmic @xmath203-forms ) @xmath309 .",
    "indeed , if @xmath310 denotes the normalization of @xmath34 , and @xmath311,@xmath312 denote the points of @xmath4 above the singular point @xmath313 of @xmath34 for @xmath314 , then sections of the sheaf @xmath309 on an open set @xmath315 consist of all the meromorphic 1-forms @xmath316 on @xmath4 which are regular everywhere on @xmath315 except for possible simple poles at @xmath317 , with @xmath318 for all @xmath37 . from this , it is easy to see that the restriction of @xmath309 to each component @xmath63 of @xmath34 is the invertible sheaf @xmath319 corresponding to @xmath320 for any canonical divisor @xmath184 on @xmath63 .    for a divisor @xmath81 on @xmath32 , let @xmath321 denote the rank of @xmath81 as defined in section  [ section : overview ] .",
    "[ thm : rr - metrizedcomplexes ] let @xmath32 be a metrized complex of @xmath0-curves and @xmath182 a divisor in the canonical class of @xmath32 . for every divisor @xmath148 , we have @xmath187    let @xmath34 be a strongly semistable curve of genus @xmath20 over @xmath0",
    ". for any @xmath322 , let @xmath259 be the combinatorial rank of @xmath245 as defined in section  [ sec : basics ] . as a corollary of theorem  [ thm : rr - metrizedcomplexes ] , remark  [ rem : canonicalsemi - stable ] , and proposition  [ prop : combinrank ] , we have :    for any @xmath323 , @xmath324    the riemann - roch theorem has a number of well - known formal consequences which can be transported to our situation .",
    "for example , we obtain the following analogue of clifford s bound for the rank of a special divisor .",
    "( a divisor @xmath81 on a metrized complex @xmath32 is called _ special _ if @xmath325 is linearly equivalent to an effective divisor . )",
    "[ thm : mcclifford ] for any special divisor @xmath81 on a metrized complex @xmath32 , @xmath326 .",
    "our riemann - roch theorem seems to be rather different from the classical riemann - roch theorem on semistable curves .",
    "we refer to  @xcite for a discussion of riemann s and clifford s theorems for linear series on semistable curves , and for examples showing the failure of clifford s theorem for @xmath327 with @xmath322 ( even for line bundles in the compactified picard scheme of @xmath34 ) .",
    "the rest of this section is devoted to the proof of theorem  [ thm : rr - metrizedcomplexes ] .",
    "our proof follows and extends the original arguments of  @xcite in the proof of riemann - roch theorem for graphs .",
    "in particular , we are going to first extend the notion of reduced divisors to the context of metrized complexes of algebraic curves , and then study the minimal non - special divisors .",
    "let @xmath328 be a fixed base point of @xmath1 .",
    "we introduce the notion of @xmath328-reduced divisors and show that each equivalence class of divisors on @xmath32 contains a quasi - unique @xmath328-reduced divisor , in a precise sense to be defined immediately preceding theorem  [ thm : reduced.divisors ] below .    for a closed connected subset @xmath298 of @xmath1 and a point @xmath329 ( the topological boundary of @xmath298 ) , the number of `` outgoing '' tangent directions at @xmath3 ( i.e.",
    ", tangent directions emanating outward from @xmath298 ) is denoted by @xmath330 ; this is also the maximum size of a collection of internally disjoint segments in @xmath331 with one end at @xmath3 .",
    "if in addition we have @xmath14 , we denote by @xmath332 the divisor in @xmath2 associated to the outgoing edges at @xmath3 ; this is by definition the sum of all the points @xmath54 of @xmath2 indexed by the edges @xmath37 leaving @xmath298 at @xmath3 . in what follows",
    "we refer to a closed connected subset @xmath298 of @xmath1 as a _ cut _ in @xmath1 .",
    "let @xmath81 be a divisor on @xmath32 with @xmath1-part @xmath86 and @xmath2-part @xmath88 , and let @xmath298 be a cut in @xmath1 .",
    "a boundary point @xmath333 is called _ saturated _ with respect to @xmath81 and @xmath298 if    * @xmath334 and @xmath335 ; or * @xmath336 for some @xmath31 and @xmath337 is equivalent to an effective divisor on @xmath2 .    otherwise , @xmath338 is called _ non - saturated_. a cut @xmath298 is said to be saturated if all its boundary points are saturated .",
    "( when talking about saturated and non - saturated points , we will sometimes omit the divisor @xmath87 or the set @xmath298 if they are clear from the context . )",
    "the divisor @xmath81 is said to be _",
    "@xmath328-reduced _ if the following three properties are satisfied :    * for all points @xmath339 of @xmath1 , @xmath340 , i.e. , all the coefficients of @xmath86 are non - negative except possibly at the base point @xmath328 .",
    "* for all points @xmath341 ( @xmath342 if @xmath328 does not belong to @xmath26 ) , there exists an effective divisor @xmath145 linearly equivalent to @xmath88 on @xmath2 . * for every cut @xmath298 of @xmath1 which does not contain @xmath328 , there exists a non - saturated point @xmath333 .",
    "[ rmk : burningalg ] there is an efficient `` burning algorithm '' for checking whether or not a given divisor @xmath87 on @xmath32 which satisfies ( i ) is @xmath328-reduced .",
    "the algorithm can be described informally as follows ( compare with @xcite or @xcite ) .",
    "imagine that @xmath1 is made of a flammable material , and light a fire at @xmath328 .",
    "the fire begins spreading across @xmath1 in a continuous manner and can only be blocked at a point @xmath343 if one of the following holds :    * @xmath334 and the number of burnt directions coming into @xmath58 exceeds @xmath344 .",
    "( one should imagine @xmath344 firefighters standing at @xmath58 , each of whom can block fire in one incoming direction . ) * @xmath336 for some @xmath31 and @xmath88 minus the sum of the marked points corresponding to burnt directions is not equivalent to any effective divisor on @xmath2 .",
    "it is straightforward to check , following the same ideas as the proof of ( * ? ? ?",
    "* algorithm 2.5 ) , that @xmath87 is @xmath328-reduced if and only if the fire eventually burns through all of @xmath1 .",
    "we omit the details since we will not need this result in the sequel .",
    "we now show that every divisor @xmath81 on @xmath32 is linearly equivalent to a quasi - unique @xmath328-reduced divisor @xmath345 .",
    "the quasi - uniqueness is understood in the following sense : the @xmath1-part @xmath346 of @xmath345 is unique , and for all @xmath14 , the divisor class @xmath347 $ ] on @xmath2 defined by the @xmath3-part of @xmath345 is unique .",
    "[ thm : reduced.divisors ] let @xmath32 be a metrized complex of @xmath30-curves and @xmath328 a base point of @xmath1 . for every divisor @xmath148",
    ", there exists a quasi - unique @xmath328-reduced divisor @xmath345 such that @xmath348 .",
    "let @xmath349 be the set of all divisors @xmath177 linearly equivalent to @xmath81 such that :    * all the coefficients of the @xmath1-part @xmath178 of @xmath177 are non - negative at every point of @xmath1 except possibly at @xmath328 .",
    "* for each point @xmath341 , the @xmath3-part @xmath128 of @xmath177 has non - negative rank on @xmath2 . *",
    "the coefficient of @xmath328 in @xmath178 is maximal with respect to the two properties above .",
    "one shows as in  ( * ? ? ?",
    "* proof of theorem 2 ) or ( * ? ? ? * proof of proposition 3.1 ) that there is a divisor @xmath177 linearly equivalent to @xmath81 on @xmath32 with the property that the coefficient of every point @xmath350 is non - negative and the coefficient of @xmath178 at each point @xmath14 ( which coincides with the degree of @xmath128 ) is at least @xmath61 .",
    "( the intuitive idea is to repeatedly fire @xmath328 and then use further chip - firing moves to spread chips wherever needed on @xmath1 , assuring that each @xmath14 gets at least @xmath61 chips and that no @xmath132 except for @xmath328 remains in debt . ) by the ( classical ) riemann - roch theorem , each @xmath128 has non - negative rank on @xmath2 , which shows that @xmath349 is non - empty .",
    "define @xmath351 as the set of all @xmath352 for which there exists @xmath353 whose @xmath1-part is @xmath178 .",
    "each divisor @xmath354 has degree @xmath355 , and all divisors in @xmath351 have the same coefficient at @xmath328 .",
    "thus the number @xmath356 is independent of the choice of a divisor @xmath178 in @xmath351 . as a consequence ,",
    "@xmath351 inherits a natural topology from the topology of @xmath1 , since it can be embedded as a subset of @xmath357 , and is compact .",
    "let @xmath358 be the subset of @xmath359 defined by @xmath360 equipped with the total order defined by the lexicographical rule @xmath361 iff @xmath362 and @xmath363 .",
    "one considers a map @xmath364 defined as follows . for each divisor @xmath365 , consider the multiset @xmath366 of points in @xmath367 where each point @xmath368 appears in this multiset exactly @xmath369 times .",
    "define @xmath370 to be the point of @xmath358 defined by the multiset of distances @xmath371 for @xmath372 , ordered in an increasing way .",
    "it is straightforward to verify that the map @xmath287 is continuous .",
    "since @xmath351 is compact and @xmath287 is continuous , there exists a divisor @xmath373 in @xmath351 such that @xmath287 takes its minimum value at @xmath373 , i.e. , @xmath374 .",
    "let @xmath345 be an element of @xmath349 whose @xmath1-part is @xmath373 .",
    "* claim : * the divisor @xmath375 is @xmath328-reduced .    properties ( i ) and ( ii ) above are clearly satisfied .",
    "the only point one needs to check is that every cut @xmath298 which does not contain @xmath328 has a non - saturated point on its boundary . for the sake of contradiction , suppose this is not the case , and let @xmath298 be a closed connected set violating this condition .",
    "this means that the following hold :    * for all @xmath376 , @xmath377 . * for each @xmath378 , @xmath379 has non - negative rank on @xmath2 , i.e. , there exists a rational function @xmath107 on @xmath2 such that @xmath380 .    by the definition of @xmath381 , there exists an @xmath382 such that for each vertex @xmath333 , there are closed segments @xmath383 emanating from @xmath58 with the following properties :    * for @xmath333 and @xmath384 , the half - open segments @xmath385 are disjoint from @xmath298 and from each other and do not contain @xmath328 . *",
    "each segment @xmath386 has length @xmath387 , for @xmath333 and @xmath384 .",
    "these data give rise to a rational function @xmath388 which is identically zero on @xmath298 , is linear of slope @xmath262 on each interval @xmath386 for @xmath338 and @xmath389 , and takes the constant value @xmath390 at all points of @xmath391 .",
    "consider the divisor @xmath392 on @xmath32 , where @xmath35 is the rational function on @xmath32 consisting of the rational function @xmath36 on @xmath1 and the rational functions @xmath107 on @xmath2 .",
    "letting @xmath393 be the @xmath1-part of @xmath394 , one verifies that @xmath395 and @xmath393 lie in @xmath349 and @xmath351 , respectively , and that @xmath396 , contradicting the choice of @xmath373 .",
    "this proves the claim and hence the existence part of the theorem .",
    "it remains to prove the quasi - uniqueness .",
    "assume for the sake of contradiction that there are linearly equivalent @xmath328-reduced divisors @xmath81 and @xmath177 on @xmath32 such that either @xmath397 or @xmath88 and @xmath128 are not linearly equivalent on @xmath2 for some @xmath14 .",
    "then there exists a non - constant rational function @xmath35 on @xmath32 such that @xmath398 .",
    "if @xmath36 is constant then we obtain an immediate contradiction , so we may assume that @xmath36 is non - constant .",
    "without loss of generality , we may assume that @xmath36 does not take its maximum at @xmath328 ( otherwise , we can interchange the role of @xmath81 and @xmath177 ) .",
    "let @xmath298 be a connected component of the set of all points where @xmath36 takes its maximum .",
    "note that @xmath399 . for all points @xmath338",
    ", the slope of @xmath36 at any outgoing segment @xmath386 emanating from @xmath3 is at most @xmath262 .",
    "since @xmath81 is @xmath328-reduced , there exists a point @xmath338 such that either @xmath334 and @xmath400 , or @xmath401 for some @xmath31 and the divisor @xmath402 has negative rank . in the first case , @xmath403 , contradicting the assumption that the coefficient of @xmath178 is non - negative at @xmath339 . in the second case , @xmath404 , which implies that @xmath128 has negative rank , a contradiction .",
    "one can presumably give an `` iterated dhar algorithm '' for algorithmically finding a @xmath328-reduced divisor equivalent to a given divisor @xmath87 by combining the ideas in the proof of theorem  [ thm : reduced.divisors ] with the ideas behind ( * ? ? ?",
    "* algorithm 2.12 ) .",
    "let @xmath32 be a metrized complex of algebraic curves .",
    "for each @xmath14 , let @xmath405 be the set of all _ minimal non - special _",
    "divisors on @xmath2 : @xmath406    recall from ( * ? ? ?",
    "* iv , example 1.3.4 ) that a divisor @xmath159 on a smooth projective curve @xmath407 of genus @xmath20 over @xmath30 is called _ special _ if @xmath408 . by riemann - roch ,",
    "every divisor of degree at most @xmath409 on @xmath407 is special , and if @xmath410 then @xmath159 is special if and only if @xmath411 .",
    "moreover , every non - special divisor dominates a minimal non - special divisor .",
    "this explains the term `` minimal non - special divisor '' .",
    "similarly , define the set of minimal non - special divisors on @xmath32 as @xmath412 in this section we provide an explicit description of the minimal non - special divisors on metrized complexes of algebraic curves , generalizing the corresponding description of minimal non - special divisors on graphs and metric graphs from  @xcite .",
    "an _ acyclic orientation _ on @xmath1 is an acyclic orientation on some model of @xmath1 , i.e. , a decomposition of @xmath1 into closed directed edges with disjoint interiors such that no directed cycles are formed . given an acyclic orientation @xmath413 on @xmath1 , we denote by @xmath414 the number of tangent directions emanating from @xmath58 which are compatible with @xmath413 .",
    "note that for all but finitely many points of @xmath1 , @xmath415 . for @xmath14 , we denote by @xmath416 the set of edges incident to @xmath3 which ( locally near @xmath3 ) are oriented outward from @xmath3 .",
    "a point @xmath58 with @xmath417 is called a _",
    "sink_. it is well known and easy to prove that every acyclic orientation contains at least one sink ( start at any point and follow the orientation until you get stuck , which must eventually happen by acyclicity ) .    given a collection of minimal non - special divisors @xmath418 for each @xmath31 , together with an acyclic orientation @xmath413 of @xmath1 , define a corresponding divisor @xmath419 by the formula @xmath420 where @xmath421 is the sum of all points @xmath422 for which the @xmath413-orientation on @xmath37 points away from @xmath3 .",
    "the @xmath1-part of @xmath423 is @xmath424 and the @xmath2-part of @xmath423 is @xmath425 . if @xmath426 is a ( loopless ) model of @xmath1 such that the orientation @xmath413 of @xmath1 is induced by an acyclic orientation @xmath427 on the edges of @xmath428 , then the degree of @xmath429 is given by @xmath430 +   \\sum_{v\\in v } g_v   = g(\\gamma)-1+\\sum_v g_v = g({\\mathfrak{c } } ) -1.\\end{aligned}\\ ] ]    a divisor @xmath431 of the form @xmath432 is called a _",
    "moderator _ on @xmath32 .",
    "( this terminology comes from @xcite . )",
    "given a moderator @xmath433 , the _ dual moderator _",
    "@xmath434 is defined to be @xmath435 , where @xmath436 is obtained from @xmath413 by reversing the orientation of every oriented segment .",
    "it is easy to see that @xmath437 belongs to the canonical class on @xmath32 .",
    "the following two lemmas are essentially what we need for the proof of theorem  [ thm : rr - metrizedcomplexes ] .",
    "[ lem : non - special1 ] for any acyclic orientation @xmath413 of @xmath1 and any collection @xmath438 of minimal non - special divisors on @xmath2 , the moderator @xmath439 is a minimal non - special divisor on @xmath32 .",
    "suppose for the sake of contradiction that there is a rational function @xmath35 on @xmath32 such that @xmath440 .",
    "let @xmath426 be a ( loopless ) model of @xmath1 such that the orientation @xmath413 of @xmath1 is induced by an acyclic orientation @xmath427 on the edges of @xmath428 .",
    "let @xmath298 be the closed subset of @xmath1 consisting of all the points of @xmath1 where the @xmath1-part @xmath36 of @xmath35 takes its maximum value .",
    "it is easy to see that @xmath441 , since at a hypothetical point @xmath442 we would necessarily have @xmath443 , contradicting the assumption on @xmath35 .    note that since @xmath444 , for any edge @xmath37 of @xmath428 either @xmath298 contains @xmath37 entirely or @xmath298 does not intersect the interior of @xmath37 .",
    "consider now the restriction of the orientation @xmath413 to the induced subgraph @xmath445 $ ] .",
    "the resulting directed graph @xmath446 $ ] is acyclic and therefore contains a sink vertex @xmath447 .",
    "* claim : * @xmath448 .",
    "it suffices to prove that no sink vertex of the directed graph @xmath427 belongs to @xmath298 , so assume for the sake of contradiction that @xmath449 is a sink vertex of @xmath427 .",
    "there are two cases to consider :    * if @xmath450 , then @xmath451 ( since @xmath36 achieves its maximum value at @xmath452 and we supposed that @xmath440 ) , contradicting the assumption that @xmath453 is a minimal non - special divisor on @xmath454 . *",
    "if @xmath455 , then by definition the coefficient of @xmath452 in @xmath456 is at most @xmath262 , from which it follows that the coefficient of @xmath452 in @xmath457 is negative , a contradiction .",
    "this proves the claim .    by our choice of @xmath458 and the definition of @xmath298",
    ", @xmath36 has strictly negative slope along all outgoing edges at @xmath447 , and it has slope zero along all other edges incident to @xmath447 .",
    "this shows in particular that @xmath459 .",
    "there are now two different cases to consider , both of which will lead to a contradiction ( and hence complete our proof of the lemma ) :    * if @xmath460 , then @xmath461 , contradicting the choice of the rational function @xmath35 on @xmath32 . *",
    "if @xmath462 , then for each edge @xmath37 incident to @xmath447 we have @xmath463 , with strict inequality if @xmath37 is an outgoing edge at @xmath447 in @xmath427 ( because @xmath447 is a sink of the oriented graph @xmath464 $ ] ) . by the definition of @xmath465 , we infer that @xmath466 , which shows that @xmath467 is not effective , since @xmath468 is minimal non - special .",
    "this contradicts our assumptions on @xmath35 .    for @xmath469",
    ", we denote by @xmath470 the set of all acyclic orientations of @xmath1 with a unique sink at @xmath328 , i.e. , such that @xmath328 has out - degree zero and all other points of @xmath1 have out - degree at least one .",
    "[ lem : reduced ] let @xmath81 be a @xmath328-reduced divisor on @xmath32",
    ". then @xmath471 if and only if the following two conditions hold :    * the coefficient @xmath472 of @xmath86 at @xmath328 is non - negative . * if @xmath473 , the divisor @xmath474 on @xmath475 has non - negative rank .",
    "more precisely , if the above conditions do not both hold , then there exists a moderator @xmath476 with @xmath477 such that @xmath478 .",
    "the intuitive idea is that one constructs the moderator @xmath476 using the burning algorithm described in remark  [ rmk : burningalg ] .",
    "beginning with a @xmath328-reduced divisor @xmath81 , burn through @xmath1 following the algorithm and keep track of the direction in which the fire spreads ; reversing all the arrows defines an acyclic orientation @xmath477 . if @xmath479 is the corresponding moderator , one checks that @xmath478 outside @xmath328 , and if @xmath81 is not effective then @xmath478 everywhere .",
    "a more rigorous version of this argument is as follows .",
    "first suppose that @xmath480 , and in the case @xmath473 that there exists a rational function @xmath481 on @xmath475 such that @xmath482 .",
    "we infer that @xmath483 , and since each @xmath88 for @xmath484 is of non - negative rank , there exists a rational function @xmath107 on @xmath2 such that @xmath485 .",
    "let @xmath35 be a rational function on @xmath32 consisting of a constant rational function on @xmath1 and @xmath107 on @xmath2 for @xmath14 .",
    "we obviously have @xmath486 , which implies that @xmath487 .    for the other direction ,",
    "assume that @xmath488 if @xmath489 , and that @xmath474 has negative rank if @xmath473 . to show that @xmath490 , by lemma  [ lem : non - special1 ] it will be enough to show the existence of an acyclic orientation @xmath477 and a set of minimal non - special divisors @xmath491 such that @xmath492 .",
    "let @xmath493 be the union of @xmath26 and all the points in the support of @xmath86 .",
    "note that in both cases above , @xmath494 .",
    "let @xmath495 be the corresponding model of @xmath1 .",
    "we are going to recursively define an orientation @xmath496 of @xmath428 and the collection @xmath497 by handling at each step the orientation of all the edges incident to a vertex @xmath498 and the minimal non - special divisor @xmath499 in the case @xmath14 .",
    "we start by considering the vertex @xmath494 .",
    "the orientations of all the edges incident to @xmath328 are defined so that @xmath500 ; in other words , all these oriented edges are incoming at @xmath328 .",
    "note that in the case @xmath489 , we have @xmath501 . in the case @xmath473 , since @xmath502 it follows from the riemann - roch theorem for @xmath475 that there exists a minimal non - special divisor @xmath503 such that @xmath504 .",
    "suppose that the orientation of all edges adjacent to vertices @xmath505 has been defined , and that for all @xmath506 with @xmath507 , a minimal non - special divisor @xmath508 on @xmath509 has been given .",
    "let @xmath510 be a connected component of the induced subgraph @xmath511 $ ] .",
    "since @xmath81 is @xmath328-reduced and @xmath510 is a cut not containing @xmath328 , there exists a point @xmath512 on the boundary of @xmath510 which is non - saturated .",
    "( note that @xmath512 also lies in @xmath493 . )",
    "this means that either :    * @xmath513 and @xmath514 ; or * @xmath515 and @xmath516 has negative rank .",
    "all outgoing edges from @xmath510 adjacent to @xmath512 have already been oriented ( and are outgoing from @xmath512 by the definition of the orientation @xmath413 ) .",
    "orient all other edges incident to @xmath512 in such a way that they are all incoming at @xmath512 .",
    "note that @xmath517 and so in case ( 1 ) , @xmath518 in case ( 2 ) , since @xmath519 , it follows from the riemann - roch theorem for @xmath2 that there exists a minimal non - special divisor @xmath499 such that @xmath520 this shows that @xmath521 . by the definition of the orientation @xmath413 we must have @xmath522 .",
    "therefore , by the definition of the orientation @xmath413 at @xmath512 and the choice of @xmath523 , we have @xmath524 .",
    "let @xmath413 be the orientation of @xmath1 just constructed , and let @xmath525 be the collection of minimal non - special divisors on @xmath2 defined above . by the definition of @xmath413 ,",
    "the only vertex of @xmath493 with out - degree zero is @xmath328 and thus @xmath413 belongs to @xmath470 .",
    "we clearly have @xmath526 as well , which completes the proof .    as a corollary of the above lemma",
    ", we obtain :    [ cor : non - special2 ] any minimal non - special divisor @xmath81 on @xmath32 is linearly equivalent to a moderator .",
    "fix @xmath527 .",
    "let @xmath81 be a minimal non - special divisor on @xmath32 and let @xmath345 be the @xmath328-reduced divisor linearly equivalent to @xmath81 .",
    "by lemma  [ lem : reduced ] , there exists a moderator @xmath479 such that @xmath528 .",
    "the effective divisor @xmath529 has degree zero , and so must be equal to zero .",
    "the proof of theorem  [ thm : rr - metrizedcomplexes ] can now be completed using ( a slight simplification of ) the idea behind the proof of riemann - roch theorem for graphs given in @xcite .",
    "the key is the following formula , which provides a useful description of the rank of @xmath81 in terms of minimal non - special divisors .",
    "we denote by @xmath530 ( resp .",
    "@xmath531 ) the sum of non - negative ( resp .",
    "non - positive ) coefficients in @xmath81 .",
    "( note that @xmath532 ) .",
    "[ prop : magicformula ] for any divisor @xmath81 on @xmath32 , we have @xmath533    fix @xmath534 , and let @xmath146 be the non - negative part of @xmath535 , which is of degree @xmath536",
    ". then @xmath537 , since @xmath538 and @xmath539 imply that @xmath540 .",
    "this shows that @xmath541 .    to prove the opposite inequality ,",
    "let @xmath146 be an effective divisor of degree @xmath542 such that @xmath543 .",
    "by lemma  [ lem : reduced ] , there exists @xmath544 such that @xmath545 , or equivalently , @xmath546 .",
    "in particular , @xmath547 , which proves the proposition .",
    "to finish the proof of theorem  [ thm : rr - metrizedcomplexes ] , note that @xmath548 and observe that @xmath549 . if @xmath550 is linearly equivalent to the moderator @xmath551 , c.f .",
    "corollary  [ cor : non - special2 ] , then @xmath552 is linearly equivalent to the dual moderator @xmath553 , and so belongs to @xmath554 .",
    "thus , by proposition  [ prop : magicformula ] , we have @xmath555",
    "let @xmath5 be a complete and algebraically closed non - archimedean field with non - trivial absolute value @xmath556 , @xmath7 the valuation ring of @xmath557 , and @xmath30 its ( algebraically closed ) residue field .",
    "let @xmath558 be the value group of @xmath557 .",
    "let @xmath4 be a smooth , proper , connected curve over @xmath557 and let @xmath41 be the berkovich analytic space associated to @xmath4 .",
    "( we assume the reader is familiar with the theory of berkovich analytic curves , see e.g. ( * ? ? ?",
    "* section 5 ) which contains everything we need . )",
    "our first goal will be to define a metrized complex @xmath8 associated to a strongly semistable @xmath7-model @xmath6 for @xmath4 .",
    "we then define a specialization homomorphism from @xmath43 to @xmath44 and prove a specialization inequality which refines lemma 2.8 and corollary 2.11 from @xcite . finally , we give some applications to specialization of canonical divisors , brill - noether theory , and weierstrass points as in _ loc .",
    "_      recall that a connected reduced algebraic curve over @xmath0 is called _ semistable _ if all of its singularities are ordinary double points , and is called _ strongly semistable _ if in addition its irreducible components are all smooth .",
    "a _ ( strongly ) semistable model _ for @xmath4 is a flat and integral proper relative curve @xmath6 over @xmath7 whose generic fiber is isomorphic to @xmath4 and whose special fiber @xmath24 is a ( strongly ) semistable curve .    given a semistable model @xmath6 for @xmath4 , there is a canonical associated reduction map @xmath67 which is defined using the natural bijection between @xmath73 and @xmath559 .",
    "this extends naturally to a map @xmath560 .",
    "we define a metrized complex associated to a strongly semistable model @xmath6 for @xmath4 as follows .",
    "let @xmath28 be the dual graph of @xmath24 , so that vertices of @xmath28 correspond to irreducible components of @xmath24 and edges of @xmath28 correspond to intersections between irreducible components . if @xmath313 is the ordinary double point of @xmath24 corresponding to an edge @xmath37 of @xmath28 , the _ formal fiber _",
    "@xmath561 is isomorphic to an open annulus @xmath562 .",
    "we define the _ length of the edge @xmath37 _ to be the length of the skeleton of @xmath562 , i.e. , the _ modulus _ @xmath563 of @xmath564 .",
    "( the modulus of an open annulus is well - defined independent of the choice of such an analytic isomorphism . ) in this way , we have defined a metric graph @xmath71 associated to @xmath6 together with a model @xmath28 .",
    "the irreducible components @xmath2 of @xmath24 correspond bijectively to the vertices @xmath3 of @xmath28 , and we let @xmath565 be the finite set of double points of @xmath24 contained in @xmath2 , so that there is a natural bijection between @xmath566 and the edges of @xmath28 incident to @xmath3 . in this way we have defined a metrized complex @xmath8 canonically associated to @xmath6 .",
    "one can show that essentially every metrized complex of curves comes from this construction .",
    "the following result is proved in ( * ? ? ?",
    "* theorem 3.24 ) .",
    "[ thm : graph.to.curve ] let @xmath32 be a metrized complex of @xmath0-curves whose edge lengths are contained in the value group of @xmath5 .",
    "there exists a smooth , proper , connected curve @xmath4 over @xmath5 and a semistable model @xmath6 for @xmath4 such that @xmath567 .",
    "it is sometimes useful to define skeleta and metrized complexes in terms of semistable vertex sets rather than semistable models .",
    "( by ( * ? ? ?",
    "* theorem 5.38 ) , there is a bijective correspondence between the latter two objects . )",
    "a _ semistable vertex set _ for @xmath13 is a finite set @xmath26 of type 2 points of @xmath13 such that the complement of @xmath26 in @xmath13 is isomorphic ( as a @xmath5-analytic space ) to the disjoint union of a finite number of open annuli and an infinite number of open balls .",
    "( such a disjoint union is called the _ semistable decomposition _ of @xmath13 associated to @xmath26 . )",
    "any finite set of type 2 points of @xmath13 is contained in a semistable vertex set ( ( * ? ? ?",
    "* proposition 5.27 ) ) .",
    "the _ skeleton _",
    "@xmath568 of @xmath13 with respect to a semistable vertex set @xmath26 is the union ( inside @xmath13 ) of @xmath26 and the skeletons of each of the open annuli in the semistable decomposition associated to @xmath26 . using the canonical metric on the skeletons of these open annuli ,",
    "@xmath1 can be naturally viewed as a ( finite ) metric graph contained in @xmath13 ( see ( * ? ? ?",
    "* definition 5.17 ) for more details ) .",
    "the skeleton @xmath1 comes equipped with a natural model @xmath28 whose vertices are the points of @xmath26 and whose edges correspond bijectively to the open annuli in the semistable decomposition associated to @xmath26 .",
    "a semistable vertex set @xmath26 is called _ strongly semistable _ if the graph @xmath28 has no loop edges . every semistable vertex set is contained in a strongly semistable vertex set .    given a strongly semistable vertex set @xmath26 for @xmath13",
    ", there is a canonical corresponding metrized complex @xmath569 of @xmath0-curves .",
    "indeed , we have already defined a metric graph @xmath568 corresponding to @xmath26 , together with a corresponding model @xmath28 .",
    "for @xmath14 , let @xmath2 be the unique smooth projective curve over @xmath0 with function field @xmath570 .",
    "( for @xmath571 of type 2 , recall that the residue field @xmath572 of the completed residue field @xmath573 of @xmath58 has transcendence degree one over @xmath0 .",
    ") it remains to specify , for each @xmath14 , a bijection @xmath574 from the edges of @xmath28 incident to @xmath3 to a subset @xmath45 of @xmath52 .",
    "given such an edge @xmath37 , we define @xmath575 to be the point of @xmath52 corresponding to the tangent direction at @xmath3 defined by @xmath37 .",
    "( recall from ( * ? ? ?",
    "* paragraph 5.67 ) that if @xmath58 is of type 2 , there is a canonical bijection between @xmath576 and the set of discrete valuations on @xmath577 which are trivial on @xmath0 . )",
    "[ rmk : modelcompatibility ] passing to a larger semistable vertex set is compatible with linear equivalence of divisors and does not change the rank of divisors .",
    "one can thus associate a canonical group @xmath578 to @xmath13 , defined as @xmath579 for any semistable vertex set @xmath26 , together with a canonical rank function @xmath580 .",
    "one can define in a similar way semistable vertex sets and skeleta for an affine curve @xmath581 ( see ( * ? ? ? * definition 5.19 ) ) . in this case",
    ", one must also allow a finite number of punctured open balls in the semistable decomposition and the skeleton is a topologically finite but not necessarily finite length metric graph  it will contain a finite number of infinite rays corresponding to the points of @xmath582 , where @xmath4 is the projective completion of @xmath581 .",
    "there is a canonical embedding of @xmath12 in the berkovich analytification @xmath13 of @xmath4 , as well as a canonical retraction map @xmath583 .",
    "in addition , there is a canonical reduction map @xmath560 sending @xmath73 surjectively onto the closed points of @xmath24 .",
    "the retraction map @xmath584 induces by linearity a specialization map @xmath74 which is studied in @xcite .",
    "we can promote this to a map @xmath585 whose target is the larger group @xmath44 as follows . if @xmath586 satisfies @xmath587",
    "then either @xmath103 is the unique point of @xmath13 with @xmath588 equal to the generic point of @xmath2 , or else @xmath588 is a nonsingular closed point of @xmath2 .",
    "the map @xmath589 is obtained by linearly extending the map @xmath590 defined by @xmath591      in this section , we show that if @xmath81 is a principal divisor on @xmath4 , then @xmath592 is a principal divisor on @xmath8 .",
    "in fact , we show a more precise result ( theorem  [ thm : plspecialization ] below ) .",
    "let @xmath571 be a point of type 2 .",
    "given a nonzero rational function @xmath136 on @xmath4 , choose @xmath593 such that @xmath594 . define @xmath595 to be the image of @xmath596 in @xmath597 .",
    "although @xmath598 is only well - defined up to multiplication by an element of @xmath599 , its divisor @xmath600 is canonical and the resulting map @xmath601 is a homomorphism .",
    "we call @xmath598 the _ normalized reduction _ of @xmath136 .",
    "if @xmath602 is a @xmath5-linear subspace of @xmath603 , the collection of all possible reductions of nonzero elements of @xmath602 , together with @xmath604 , forms a @xmath30-vector space @xmath605 . for later use",
    "we note the following elementary lemma , which says that @xmath606 :    [ lem : dimensionreduction ] let @xmath4 be a smooth proper curve over @xmath5 , and @xmath607 a point of type 2 .",
    "the @xmath30-vector space @xmath605 defined by the reduction to @xmath572 of an @xmath162-dimensional @xmath5-subspace @xmath608 has dimension @xmath609 .",
    "the inequality @xmath610 follows from the observation that if @xmath611 are linearly dependent in @xmath602 , with @xmath612 for all @xmath613 , then the reductions @xmath614 are linearly dependent in @xmath605 .    to prove @xmath615 , choose a @xmath5-basis @xmath616 for @xmath602 consisting of elements of norm @xmath203 and let @xmath617 in @xmath605 be the corresponding reductions",
    "it is not true that @xmath617 necessarily form a basis of @xmath605 : for example , if @xmath136 and @xmath20 are linearly independent functions of norm @xmath203 and @xmath618 is any scalar with @xmath619 , then @xmath136 and @xmath620 are linearly independent but they have the same reduction .",
    "however , by the following procedure one can construct another basis @xmath621 of @xmath602 with @xmath622 for all @xmath613 such that the reductions @xmath623 are linearly independent over @xmath30 .",
    "define @xmath624 , and recursively define @xmath625 as follows : among all the rational functions of the form @xmath626 with @xmath627 for all @xmath628 , choose one , call it @xmath629 , whose norm is minimal .",
    "note that @xmath630 so such an element exists by compactness .",
    "let @xmath631 be a scalar with @xmath632 and define @xmath633 .",
    "it is clear that the @xmath634 form a basis of @xmath602 .",
    "we claim that the reductions @xmath623 form a basis of @xmath605 . indeed , if not then there exists a minimal index @xmath613 and scalars @xmath635 with @xmath636 for @xmath637 such that @xmath638 . but",
    "this implies that @xmath639 , contradicting the choice of @xmath629 .",
    "we recall the following useful result from ( * ? ? ?",
    "* theorem 5.69 ) .",
    "[ thm : pl ]",
    "let @xmath136 be a nonzero rational function on @xmath4 , let @xmath581 be an open affine subset of @xmath4 on which @xmath136 has no zeros or poles , and let @xmath640 .",
    "let @xmath26 be a semistable vertex set for @xmath581 , and let @xmath641 be the corresponding skeleton .",
    "then :    1 .",
    "@xmath642 where @xmath643 is the retraction .",
    "2 .   @xmath287 is piecewise linear with integer slopes , and @xmath287 is linear on each edge of @xmath644 .",
    "if @xmath58 is a type-@xmath645 point of @xmath13 and @xmath646 corresponds to the discrete valuation @xmath647 on @xmath648 , then @xmath649 .",
    "@xmath287 is harmonic at all @xmath650 .",
    "let @xmath651 , let @xmath37 be the ray in @xmath644 whose closure in @xmath13 contains @xmath58 , let @xmath652 be the other endpoint of @xmath37 , and let @xmath653 be the tangent direction represented by @xmath37",
    ". then @xmath654 .",
    "to each nonzero rational function @xmath136 on @xmath4 and each strongly semistable model @xmath6 for @xmath4 , one can associate a rational function @xmath35 on @xmath8 whose @xmath1-part @xmath137 is the restriction to @xmath655 of the piecewise linear function @xmath656 on @xmath13 and whose @xmath2-part is the normalized reduction @xmath107 ( which is well - defined up to multiplication by a non - zero scalar ) . instead of @xmath657 because our convention is that @xmath658 is the sum of the outgoing slopes of @xmath287 at @xmath447 .",
    "one could equally well take the opposite convention , defining @xmath658 to be _ minus _ the sum of the outgoing slopes of @xmath287 at @xmath447 , and then defining @xmath287 to be @xmath657 .",
    "such a modification would also necessitate a change of sign in our definition of @xmath659 . ]    as an application of theorem  [ thm : pl ] , we obtain the following important formula :    [ thm : plspecialization ] for every nonzero rational function @xmath136 on @xmath4 , @xmath660    let @xmath159 be the support of @xmath661 in @xmath4 .",
    "we apply theorem  [ thm : pl ] to @xmath662 , the invertible rational function @xmath136 on @xmath581 , and a semistable vertex set @xmath663 for @xmath581 which contains @xmath26 .",
    "let @xmath664 and @xmath665 .",
    "since @xmath26 is a semistable vertex set for @xmath4 , the closure of @xmath666 in @xmath644 is a disjoint union of metric trees @xmath667 . for each tree @xmath668 ,",
    "denote by @xmath669 all the points in @xmath670 which are in the closure of rays in @xmath668 , and let @xmath671 .",
    "denote by @xmath672 the unique point of @xmath673 .",
    "in addition , if @xmath674 , let @xmath675 .    for each @xmath676 , the restriction of @xmath677 to @xmath668 is harmonic at every point of @xmath678 by ( 4 ) . by ( 5 )",
    ", @xmath138 is linear in a sufficiently small neighborhood of @xmath679 in @xmath668 , and has ( constant ) slope @xmath680 along the unique tangent direction in this interval toward the point @xmath672 .",
    "we infer that the order of @xmath681 at @xmath672 is equal to @xmath682 . by ( 1 )",
    ", @xmath287 is constant on any connected component of @xmath683 . by ( 4 )",
    ", the restriction @xmath36 of @xmath287 to @xmath1 satisfies @xmath684 .",
    "since @xmath685 is linear on each edge of @xmath1 by ( 2 ) , it follows that @xmath686 .",
    "fix @xmath676 and suppose that @xmath674 .",
    "for any tangent direction @xmath687 , by ( 3 ) we have @xmath688 .",
    "since @xmath287 is locally constant on @xmath683 , we infer that @xmath689 for any @xmath690 not corresponding to a direction in @xmath644 .",
    "this shows that @xmath691 is supported on @xmath692 . by ( 3 ) , for any point @xmath693 in @xmath694 , corresponding to a tangent direction @xmath695 , we have @xmath696 .",
    "this shows that the coefficient of @xmath693 in @xmath118 is zero .",
    "for a point @xmath697 , let @xmath698 be the closure in @xmath644 of the connected component of @xmath699 which contains all the points @xmath679 with @xmath700 . by ( 1 ) and ( 4 )",
    ", @xmath287 is harmonic at any point of @xmath701 , and is linear of slope @xmath702 in a sufficiently small neighborhood of @xmath703 in @xmath704 along the unique tangent direction in this interval toward the point @xmath672 . by ( 3 ) , we infer that @xmath705 . we conclude that @xmath706 .",
    "in particular , it follows that @xmath141 .",
    "fix a strongly semistable @xmath7-model @xmath6 for @xmath4 and let @xmath8 be the metrized complex associated to @xmath6 .",
    "the following is a variant of lemma 2.8 and corollary 2.11 from @xcite :    [ lem : bakspeclem ] for every divisor @xmath79 , @xmath707    let @xmath708 .",
    "it suffices to prove that if @xmath709 , then @xmath710 as well .",
    "the base case @xmath711 is obvious .",
    "now suppose @xmath712 , so that @xmath713",
    ". then there exists an effective divisor @xmath714 with @xmath715 . since @xmath9 is a homomorphism and takes principal ( resp .",
    "effective ) divisors on @xmath4 to principal ( resp .",
    "effective ) divisors on @xmath716 , we have @xmath717 , so that @xmath718 as well .",
    "we may therefore assume that @xmath719 . for each @xmath31 ,",
    "let @xmath720 be a subset of size @xmath721 and denote by @xmath722 the union of the @xmath723 . by theorem  [ thm :",
    "f - width ] , @xmath722 is a rank - determining set in @xmath32 .",
    "let @xmath146 be an effective divisor of degree @xmath149 with support in @xmath722 . for each @xmath724",
    ", there exists a point @xmath725 whose reduction is @xmath58 , so there is an effective divisor @xmath27 of degree @xmath149 on @xmath4 with @xmath726 . by our assumption on the rank of @xmath159 , @xmath727 , and so @xmath728 . since this is true for any effective divisor of degree @xmath149 with support in @xmath722 , and since @xmath722 is rank - determining , we infer that @xmath729 as desired .",
    "there are many examples where the inequality in theorem  [ lem : bakspeclem ] can be strict .",
    "for example , if @xmath730 for all @xmath14 then @xmath731 and thus the examples of strict inequality from @xcite apply . at the other extreme ,",
    "if @xmath732 is smooth ( so that @xmath28 is a point ) then the specialization inequality becomes the well - known semicontinuity statement @xmath733 , where @xmath734 is the reduction of @xmath159 , and it is clear that such an inequality can be strict ; for example , take @xmath735 where @xmath4 has genus at least @xmath203 and @xmath736 are distinct points with the same reduction in @xmath737 .",
    "in this section we use the specialization lemma for divisors on metrized complexes to provide a framework for obtaining stronger versions of the weighted specialization lemma from  @xcite . our key technical tool for this will be the `` @xmath738-function '' on a metrized complex . to help motivate the definition , we first study an analogous @xmath738-function which controls the rank of divisors on connected sums .",
    "suppose the underlying graph of a metrized complex @xmath32 has a bridge edge @xmath739 , and denote by @xmath740 and @xmath741 the two metrized complexes obtained by removing the edge @xmath37 from @xmath32 ( @xmath239 is a vertex of @xmath742 ) .",
    "denote by @xmath743 and @xmath744 the points of @xmath740 and @xmath741 , respectively , corresponding to the edge @xmath37 .",
    "we say that @xmath32 is a _ connected sum _ of @xmath740 and @xmath741 .",
    "there is an addition map @xmath745 which associates to any pair of divisors @xmath746 the divisor @xmath747 on @xmath32 whose restriction to each @xmath742 is @xmath748 .",
    "the following proposition provides a precise description of the @xmath32-rank of @xmath749 in terms of the two rank functions @xmath750 and @xmath751 . in order to state the result",
    ", we introduce a function @xmath752 defined by the condition that @xmath753 is the smallest integer @xmath754 such that @xmath755 .",
    "( by the riemann - roch theorem for @xmath741 , @xmath738 is well - defined . )",
    "[ prop : connectedsumrankformetrizedcomplexes ] with notation as above , we have @xmath756    we prove the equality of the two sides of equation   by showing that the inequalities @xmath757 and @xmath758 both hold . by theorem  [ thm : f - width ] , we can assume that all the effective divisors we consider below are supported on geometric points ( i.e. , on points of the curves @xmath2 ) .",
    "@xmath759 let @xmath19 be the right - hand term in and let @xmath146 be an effective divisor of degree @xmath19 on @xmath32 supported on geometric points .",
    "we need to show the existence of a rational function @xmath35 on @xmath32 such that @xmath760 .",
    "there is a ( unique ) decomposition of @xmath146 as @xmath761 with @xmath762 and @xmath763 effective divisors of degree @xmath764 and @xmath149 , respectively , having support on geometric points . by the definition of @xmath738",
    ", there exists a rational function @xmath765 on @xmath741 such that @xmath766 . by the choice of @xmath19 as the minimum in equation",
    ", we have @xmath767 , so there exists a rational function @xmath768 on @xmath740 such that @xmath769 .",
    "we can in addition suppose that the @xmath770-part of @xmath768 takes value zero at @xmath771 .",
    "up to adding a constant to the @xmath770-part of @xmath768 , we can define a rational function @xmath35 which restricts to @xmath768 and @xmath765 on @xmath740 and @xmath741 , respectively , and which is linear of slope @xmath772 on the oriented edge @xmath773 in @xmath1 . for this rational function",
    ", we clearly have @xmath774    @xmath775 it will be enough to show that for each @xmath776 , the inequality @xmath777 holds .",
    "let @xmath778 .",
    "we can obviously restrict to the case @xmath779 .",
    "for each effective divisor @xmath763 of degree @xmath149 supported on geometric points of @xmath741 , let @xmath780 be a rational function on @xmath741 with the property that the coefficients of @xmath781 outside @xmath782 are all non - negative , and such that in addition , the coefficient of @xmath744 in @xmath781 is maximized among all the rational functions with this property .",
    "denote by @xmath783 the coefficient of @xmath744 in @xmath781 and let @xmath784 be an effective divisor of degree @xmath149 on @xmath741 , supported on geometric points of @xmath741 , for which @xmath785 is minimal , i.e. , @xmath786 note that by the choice of @xmath754 , for an effective divisor @xmath763 of degree @xmath149 supported on geometric points of @xmath741 and the rational function @xmath780 , we have @xmath787 , which shows that @xmath788 . by the definition of @xmath738 , it follows that @xmath789 .    by the definition of @xmath790 , for any rational function @xmath765 on @xmath741 with the property that @xmath791 has non - negative coefficients outside @xmath744 ,",
    "the coefficient of @xmath744 in @xmath792 is at most @xmath793 .",
    "let @xmath762 be an effective divisor of degree @xmath794 on @xmath740 supported on geometric points .",
    "there exists a rational function @xmath35 on @xmath32 such that @xmath795 .",
    "let @xmath768 and @xmath765 be the restrictions of @xmath35 to @xmath740 and @xmath741 , respectively . by the preceding paragraph ,",
    "the coefficient of @xmath744 in @xmath791 is at most @xmath772 .",
    "since the coefficient of @xmath744 in @xmath796 is non - negative , the @xmath1-part of @xmath35 has slope at least @xmath753 along the tangent direction emanating from @xmath797 which corresponds to @xmath744 .",
    "since the coefficients of @xmath118 at the interior points of the edge @xmath798 are all non - negative , it follows that the slope of the @xmath1-part of @xmath35 along the tangent direction emanating from @xmath771 on the edge @xmath798 is at most @xmath772 , which by the assumption @xmath795 implies that the coefficient of @xmath743 in @xmath799 must be at least @xmath753 .",
    "it follows that @xmath800 .",
    "since @xmath762 was an arbitrary effective divisor of degree @xmath801 supported on geometric points of @xmath740 , it follows that @xmath802 , and the claim follows .    in the same spirit ,",
    "consider two metric graphs @xmath770 and @xmath803 , and suppose that two distinguished points @xmath804 and @xmath805 are given .",
    "the _ wedge _ or _ direct sum _ of @xmath806 and @xmath807 , denoted @xmath808 , is the metric graph obtained by identifying the points @xmath771 and @xmath797 in the disjoint union of @xmath770 and @xmath803 .",
    "denote by @xmath809 the image of @xmath771 and @xmath797 in @xmath810 .",
    "( by abuse of notation , we will use @xmath3 to denote both @xmath771 in @xmath770 and @xmath797 in @xmath803 . )",
    "we refer to @xmath811 as a _ cut - vertex _ and to @xmath812 as the decomposition corresponding to the cut - vertex @xmath3 .",
    "note that there is an addition map @xmath813 which associates to any pair of divisors @xmath814 and @xmath815 in @xmath816 and @xmath817 the divisor , @xmath818 on @xmath810 defined by pointwise addition of coefficients in @xmath814 and @xmath815 .",
    "let @xmath819 , @xmath820 , and @xmath821 be the rank functions in @xmath822 , and @xmath823 , respectively . for any non - negative integer @xmath149 , denote by @xmath824 , or simply @xmath753 , the smallest integer @xmath754 such that @xmath825 .",
    "then for any divisor @xmath814 in @xmath816 , we have ( by an entirely similar argument ) @xmath826    the above formalism is very handy for studying metric graphs such as the chain of cycles used in  @xcite . in particular , the lingering lattice paths studied in  @xcite in connection with a tropical proof of the brill - noether theorem can be understood in a natural way as values of @xmath738-functions .",
    "the @xmath738-function formalism is also useful for studying limit linear series , see for example the proof of theorem  [ thm : limitseries ] below .",
    "we now define a partial analogue of the @xmath738-function introduced above for a general metrized complex @xmath32 and provide an analogue of proposition  [ prop : connectedsumrankformetrizedcomplexes ] .",
    "consider a divisor @xmath81 on @xmath32 with @xmath2-part @xmath88 for @xmath14 .",
    "for every vertex @xmath3 of @xmath28 , define the function @xmath827 as follows . for any @xmath828",
    ", @xmath829 is the smallest integer @xmath830 such that there exists a divisor @xmath831 of degree @xmath832 supported on the points of @xmath833 such that @xmath834 . for any effective divisor @xmath835 on @xmath28 ,",
    "define @xmath836 note that the definition of @xmath738 depends on the data of the divisors @xmath837 .",
    "[ prop : wrank3 ] let @xmath32 be a metrized complex of algebraic curves over @xmath0 . for any divisor @xmath81 on @xmath32 with @xmath1-part @xmath86 , we have @xmath838 where the minimum is over all effective divisors @xmath27 on @xmath28 .",
    "fix an effective divisor @xmath27 supported on the vertices of @xmath28 .",
    "we need to prove that @xmath839 for the sake of contradiction , suppose this is not the case , i.e. , that @xmath840 . since @xmath841 , luo s theorem ( which is a special case of theorem  [ thm : f - width ] ) implies that there exists a divisor @xmath842 of degree @xmath843 supported on @xmath844 such that @xmath845    consider all the effective divisors on @xmath32 of the form @xmath846 , where each @xmath145 is an effective divisor of degree @xmath847 on @xmath2 .",
    "note that @xmath846 has degree @xmath848 , so that by the definition of the rank function , for any choice of effective divisors @xmath145 on @xmath2 there exists a rational function @xmath35 on @xmath32 such that @xmath849 .",
    "denote by @xmath36 and @xmath107 the different parts of @xmath35 , so in particular we have @xmath850 one can assume as in the proof of proposition  [ prop : combinrank ] that the slope of @xmath36 along the edges incident to each vertex of @xmath28 is fixed .",
    "this shows the existence of the divisor @xmath851 supported on the points @xmath833 such that @xmath852 has rank at least @xmath853 on @xmath2 . by the definition of @xmath854",
    ", @xmath831 has degree at least @xmath855 . since the degree of @xmath831 is the sum of the slopes of @xmath36 along the edges adjacent to @xmath3 , which is by definition @xmath856 , for each @xmath857 we obtain @xmath858 , i.e. , @xmath859 .",
    "in addition , for each non - vertex point @xmath860 we must have @xmath861 .",
    "this implies that @xmath862 , a contradiction .",
    "let @xmath557 be a complete and algebraically closed non - archimedean field with non - trivial absolute value @xmath556 , @xmath7 the valuation ring of @xmath557 , and and @xmath0 its residue field .",
    "let @xmath558 be the value group of @xmath557 .",
    "let @xmath4 be a smooth , proper , and connected @xmath557-curve and fix a semistable @xmath7-model @xmath6 . let @xmath863 denote the skeleton of @xmath6 together with the weight function @xmath864 defined by @xmath865 .",
    "let @xmath866 .",
    "following  @xcite , we define a metric graph @xmath867 by attaching @xmath61 loops of arbitrary positive length at each point @xmath868 ( see @xcite for a discussion of the intuition behind this construction . )    any divisor @xmath159 in @xmath1 defines a divisor on @xmath867 with the same support and coefficients ( by viewing @xmath1 as a subgraph of @xmath867 ) . by an abuse of notation , we will also denote this divisor by @xmath159 . however , we distinguish the ranks of @xmath159 in @xmath1 and @xmath867 by using the notation @xmath869 for the former and @xmath870 for the latter . following  @xcite ,",
    "the _ weighted rank _",
    "@xmath871 of @xmath159 is defined by @xmath872 . applying the formalism of the @xmath738-function from the previous subsection ,",
    "we obtain the following useful formula for @xmath871 :    [ prop : wrank ] for every @xmath873 , we have @xmath874    proceeding by induction , we are reduced to the case @xmath875 .",
    "this case follows from ( [ eq : wrank2 ] ) applied to @xmath876 , @xmath803 a circle , @xmath877 , @xmath878 , and @xmath879 , since in this case one has @xmath880 , @xmath881 , and @xmath882 for @xmath883 .",
    "the following result is a generalization to metric graphs @xmath1 , and to smooth curves @xmath4 over not necessarily discrete non - archimedean fields , of the corresponding statement for graphs which was obtained by different methods in  @xcite .",
    "[ thm : weightedmetricspecialization ] for every divisor @xmath79 , we have @xmath884 .",
    "let @xmath885 and note that the @xmath1-part @xmath86 of @xmath81 is equal to @xmath78 .",
    "applying proposition  [ prop : wrank3 ] , we obtain @xmath886    for each vertex @xmath3 of @xmath28 , define the function @xmath887 by @xmath888 for @xmath889 and @xmath890 for @xmath891 . if @xmath27 is an effective divisor supported on vertices of @xmath28 , define @xmath892 .    by the definition of @xmath854 and clifford s theorem for the curve @xmath2 , for any integer @xmath828",
    "we have @xmath893 . combining this with",
    ", we get the inequality @xmath894 note that for @xmath895 , we have @xmath896 and so , whatever the other coefficients of @xmath27 are , we have @xmath897 in other words , in taking the minimum in , one can restrict to effective divisors @xmath27 with @xmath898 for all @xmath3 , i.e. , @xmath899 .",
    "finally , applying , theorem  [ lem : bakspeclem ] , and corollary  [ prop : wrank ] , we obtain the inequality @xmath900      we give some direct applications of the results of this section .",
    "let @xmath191 be a canonical divisor on the curve @xmath29 . by theorem  [ lem : bakspeclem ]",
    ", we have @xmath901 . by the riemann - roch theorem for metrized complexes ( theorem  [ thm : rr - metrizedcomplexes ] ) ,",
    "the divisor @xmath902 has degree zero and non - negative rank , and thus @xmath903 .",
    "in particular , we have @xmath904 .",
    "as mentioned in the introduction , for discretely valued @xmath7 the fact that @xmath904 follows from the adjunction formula for arithmetic surfaces .",
    "but it does not seem straightforward to generalize that argument to the not necessarily discretely valued case .",
    "the following result is an immediate consequence of theorem  [ thm : graph.to.curve ] combined with theorem  [ lem : bakspeclem ] .",
    "[ cor : bnexistence ] let @xmath30 be a field and let @xmath905 be nonnegative integers .",
    "if the brill - noether number @xmath906 is nonnegative , then for every metrized complex @xmath32 of @xmath30-curves with @xmath907 , there exists a divisor @xmath908 such that @xmath909 .    in particular , combining the original specialization lemma from @xcite with theorem  [ thm : graph.to.curve ] yields a new proof of ( * ? ? ?",
    "* theorem 3.20 ) , which says that if @xmath910 then for every metrized graph of genus @xmath20 there exists @xmath911 such that @xmath912 .",
    "the present proof is more direct in that one does not need the approximation arguments given in lemma 3.17 and corollary 3.18 of _ loc .",
    "_    the notion of brill - noether rank on metric graphs introduced in  @xcite and the corresponding specialization lemma extend to the context of metrized complexes as well .",
    "let @xmath32 be a metrized complex of @xmath30-curves , and let @xmath913 be the subset of all divisors of degree @xmath195 and rank at least @xmath19 .",
    "define @xmath914 to be the largest integer @xmath754 such that for every effective divisor @xmath171 of degree @xmath915 on @xmath32 , there exists @xmath916 such that @xmath917 . if @xmath918 , define @xmath919 .",
    "if @xmath6 is a strongly semistable @xmath7-model of a proper smooth curve @xmath29 such that @xmath920 , and @xmath921 denotes the brill - noether locus of @xmath4 , then we have the inequality @xmath922 .",
    "let @xmath32 be a metrized complex of @xmath30-curves .",
    "we say that a point @xmath58 in @xmath32 is a _ weierstrass point _ if @xmath923 . by theorem  [ lem : bakspeclem ] , the specialization of a weierstrass point on @xmath4 is a weierstrass point on @xmath32 .",
    "and by theorem  [ thm : graph.to.curve ] combined with theorem  [ lem : bakspeclem ] , any metrized complex of @xmath30-curves of genus at least two has at least one weierstrass point .",
    "our aim in this section is to compare our divisor theory on metrized complexes with the eisenbud - harris theory of limit linear series for curves of compact type @xcite .",
    "as we will see , our comparison results lead naturally to a generalization of the notion of limit linear series to nodal curves which are not necessarily of compact type .",
    "note that since eisenbud and harris work over a discrete valuation ring , in order to compare our theory to theirs we will sometimes restrict to this setting ; we note , however , that most of our results hold over the valuation ring of an arbitrary non - trivially valued non - archimedean field .",
    "we start by reviewing some basic facts and definitions concerning the degeneration of linear series in families .",
    "let @xmath924 be a smooth projective curve over @xmath30 . recall that a linear series @xmath194 of ( projective ) dimension @xmath19 and degree @xmath195 , or simply a @xmath10 , over @xmath924 consists of a pair @xmath925 with @xmath245 an invertible sheaf of degree @xmath195 on @xmath924 and @xmath602 a subspace of @xmath926 of @xmath0-dimension @xmath609 .",
    "let @xmath927 be a regular smoothing of a strongly semistable curve @xmath34 over a discrete valuation ring @xmath7 with fraction field @xmath928 .",
    "this means that @xmath929 is proper , @xmath930 is regular , the generic fiber @xmath931 of @xmath929 is smooth , and the special fiber of @xmath929 is @xmath34 .",
    "denote by @xmath932 the dual graph of @xmath34 and let @xmath933 be the set of irreducible components of @xmath34 .",
    "any line bundle @xmath934 on @xmath931 extends to @xmath930 .",
    "the restriction of any two extensions @xmath935 and @xmath936 of @xmath934 to the special fiber @xmath34 are combinatorially equivalent ( c.f . section  [ sec : mcnodal ] ) .",
    "the first part is a well - known consequence of the regularity of @xmath930 ( see for example ( * ? ? ?",
    "* chapter ii , 6.5(a ) and 6.11 ) ) . for the second part ,",
    "note that any two extensions @xmath935 and @xmath937 of @xmath938 differ by a divisor supported on the special fiber @xmath34 .",
    "in other words , there exist integers @xmath939 for each vertex @xmath3 of the dual graph of @xmath34 such that @xmath940 .",
    "it is now easy to see that , in the notation of section  [ sec : mcnodal ] , @xmath941 and @xmath942 differ by the divisor of the function @xmath943 which sends @xmath3 to @xmath939 .",
    "consider now a @xmath10 @xmath944 on @xmath931 and choose an extension @xmath945 of @xmath938 to @xmath930 . since cohomology commutes with flat base change",
    ", there is a natural isomorphism @xmath946 and @xmath947 corresponds to a free @xmath7-submodule h of @xmath948 such that @xmath949 .",
    "the restriction @xmath950 of @xmath602 to the special fiber @xmath34 is an @xmath162-dimensional subspace of @xmath951 .",
    "this shows the existence of the limit of a @xmath10 once the extension @xmath245 of @xmath938 is fixed .",
    "however , since the extension is not unique , the limit pair @xmath952 is not unique .",
    "if one were to restrict to a single such extension , there would inevitably be a loss of important information ; this can be seen , for example , in the study of limits of ramification points and in the study of limits of smooth hyperelliptic , and more generally , smooth @xmath195-gonal curves , see for example  @xcite .",
    "some of the difficulties in formulating a good notion of limits for linear series are already manifest in the atypical behavior of linear series on reducible curves , since ( as mentioned earlier ) they do not satisfy many of the classical theorems which govern the behavior of ( global sections of ) linear series on irreducible curves .    the eisenbud - harris theory of limit linear series on curves of compact type provides a way to keep track of the geometry in the limit by choosing an _ aspect _ of the limit for each irreducible component , with some extra conditions relating these different aspects at nodes ( see below for a precise definition ) .",
    "we refer to  @xcite for recent refinements of the eisenbud - harris theory , and to  @xcite for generalizations of this theory to certain curves not of compact type .",
    "we recall the definition of limit linear series for curves of compact type , following  @xcite .",
    "we first need to recall the sequence of orders of vanishing of a @xmath10 @xmath953 at a point on a smooth projective curve @xmath924 over @xmath0 . for any closed point @xmath133 on @xmath924 and any section @xmath954 , denote by @xmath955 the order of vanishing of @xmath136 at @xmath133 . the orders of vanishing at @xmath133 of all the sections of @xmath945 in @xmath602 define a sequence of integers @xmath956 .",
    "( this sequence is obtained by induction : let @xmath957 be the section in @xmath602 with the highest order of vanishing , and define @xmath958 inductively as a section in @xmath602 with the highest possible order of vanishing at @xmath133 among all sections which are linearly independent of the first @xmath613 sections @xmath959 .",
    "then @xmath960 . )",
    "let @xmath34 be a strongly semistable curve over @xmath30 , let @xmath932 be the dual graph of @xmath34 , and for any @xmath31 , let @xmath63 be the corresponding irreducible component of @xmath34 .",
    "when @xmath28 is a tree , the curve @xmath34 is called of _ compact type _ : in this case , @xmath961 is compact .",
    "( recall that in general , we have an exact sequence of algebraic groups @xmath962    let @xmath34 be a curve of compact type .",
    "a _ crude limit _",
    "@xmath10 @xmath194 over @xmath34 is by definition the data of a @xmath10 @xmath963 over @xmath63 for each vertex @xmath14 , called the @xmath63-_aspect _ of @xmath194 , such that the following property holds : if the two components @xmath197 and @xmath63 of @xmath34 meet at a node @xmath133 corresponding to an edge @xmath964 in @xmath27 , then @xmath965 for all @xmath966 .",
    "a crude limit linear series is a _ refined limit linear series _ if all the inequalities in are equalities .",
    "we are now going to associate to @xmath194 a degree @xmath195 divisor on the regularization of @xmath34 ( c.f .",
    "section  [ sec : mcnodal ] for the definition ) . roughly speaking ,",
    "this amounts to choosing a divisor of degree @xmath195 on each @xmath63 in the divisor class of @xmath196 .",
    "however , the global divisor on @xmath202 defined by such a collection of divisors does not have degree @xmath195 . to fix this problem",
    ", we need to choose a root @xmath967 for the tree @xmath28 and modify the local divisors using the root .",
    "this is done as follows .",
    "let @xmath1 be the metric graph associated to @xmath28 and let @xmath202 be the regularization of @xmath34 . for each vertex @xmath3 of @xmath28",
    ", let @xmath968 be a divisor of degree @xmath195 on @xmath63 in the divisor class defining @xmath969 ( i.e. , @xmath970 ) .",
    "the subspace @xmath971 can be naturally regarded as a subspace of @xmath972 .",
    "let @xmath967 be a fixed vertex of @xmath28 and let @xmath973 denote @xmath28 considered as a rooted tree with root @xmath967 . for any vertex @xmath974 in @xmath28 , consider the unique path from @xmath447 to @xmath967 in @xmath28 and let @xmath975 be the edge adjacent to @xmath447 along this path .",
    "let @xmath976 be the node of @xmath197 corresponding to the edge @xmath975 .",
    "consider the divisor @xmath81 of degree @xmath195 on @xmath202 defined by    @xmath977    we will see below that @xmath81 has rank at least @xmath19 in @xmath202 . in order to derive a more precise characterization of crude limits in terms of a suitable rank function , we need to introduce a refined notion of rank on a metrized complex which takes into account the spaces @xmath163 .",
    "let @xmath32 be a metrized complex of algebraic curves , @xmath1 the underlying metric graph with model @xmath28 , and @xmath978 the corresponding family of smooth projective curves over @xmath30 .",
    "suppose we are given , for each @xmath14 , a non - empty @xmath30-linear subspace @xmath166 of @xmath40 .",
    "we denote by @xmath979 the collection of all @xmath166 .",
    "define the _",
    "@xmath979-rank _ of a divisor @xmath81 on @xmath32 , denoted @xmath980 , to be the maximum integer @xmath19 such that for any effective divisor @xmath146 of degree @xmath19 , there exists a nonzero rational function @xmath35 on @xmath32 , with @xmath2-parts @xmath981 for all @xmath14 , such that @xmath982 .",
    "the following proposition provides an upper bound for @xmath983 in terms of the maximal dimension of @xmath166 for @xmath857 .",
    "[ prop : basic ] let @xmath984 then for any divisor @xmath81 on @xmath32 , we have @xmath985 .",
    "if @xmath986 for some @xmath3 , then either @xmath987 ( if @xmath988 ) or @xmath989 ( otherwise ) , and the proposition holds . for the sake of contradiction , suppose now that @xmath990 .",
    "let @xmath3 be a vertex with @xmath991 .",
    "for any effective divisor @xmath145 of degree @xmath992 on @xmath2 , there exists a rational function @xmath35 on @xmath32 with @xmath981 such that @xmath993 .",
    "taking @xmath1-parts shows that @xmath994 . for a generic choice of @xmath145 , we can assume as in the proof of proposition  [ prop : combinrank ] that the slopes of @xmath36 on the edges adjacent to @xmath3 are fixed .",
    "for the divisor @xmath995 , this shows that for any choice of @xmath145 on @xmath2 , there exists an element @xmath981 with @xmath996 .",
    "this contradicts the assumption that @xmath997 , since @xmath166 can define a linear system of projective dimension at most @xmath998 on @xmath2 .",
    "in section  [ sec : rank - csum ] , we provided a formula for the rank of a divisor on a metrized complex @xmath32 which is a connected sum of two metrized complexes @xmath740 and @xmath741 .",
    "we now state a straightforward generalization of proposition  [ prop : connectedsumrankformetrizedcomplexes ] to restricted ranks , which will be used in the next section .",
    "suppose that the underlying graph of @xmath32 has a bridge edge @xmath999 and let @xmath740 and @xmath741 be the two metrized complexes obtained by removing the edge @xmath37 .",
    "let @xmath770 , @xmath803 , and @xmath1 be the underlying metric graphs of @xmath740 , @xmath741 , and @xmath32 respectively ( with @xmath239 a vertex of @xmath1000 ) .",
    "denote by @xmath743 and @xmath744 the points of @xmath740 and @xmath741 , respectively , corresponding to the edge @xmath37 .",
    "let @xmath979 be a family of spaces of rational functions @xmath166 for vertices @xmath3 of @xmath1 , and denote by @xmath1001 ( resp .",
    "@xmath1002 ) the collection of those @xmath166 for @xmath3 a vertex of @xmath770 ( resp .",
    "@xmath803 ) .",
    "[ prop : connectedsumrankformetrizedcomplexes2 ] let @xmath1003 be the sum of divisors @xmath1004 and @xmath1005 on @xmath740 and @xmath741 , respectively . for a non - negative integer @xmath149 , define @xmath753 to be the smallest integer @xmath754 such that @xmath1006 .",
    "then @xmath1007      we retain the terminology from the previous sections .",
    "let @xmath34 be a curve of compact type , @xmath932 the dual graph , @xmath202 the regularization of @xmath34 , and let @xmath194 be a collection of @xmath10 s @xmath1008 on @xmath63 , one for each @xmath14 .",
    "fix a root vertex @xmath1009 and divisors @xmath1010 such that @xmath1011 , and let @xmath81 be the divisor defined by  . denote by @xmath1012 the family of all @xmath1013 .",
    "[ thm : limitseries ] the following two assertions are equivalent :    * @xmath194 is a crude limit @xmath10 on @xmath34 . *",
    "@xmath1014 .",
    "denote by @xmath1015 all the children of @xmath967 in the rooted tree @xmath973 .",
    "for each @xmath1016 , denote by @xmath1017 and @xmath672 the @xmath30-points of @xmath1018 and @xmath1019 , respectively , which correspond to the edge @xmath1020 .",
    "proof of @xmath1021 : let @xmath194 be a crude limit @xmath10 and let @xmath1022 be a non - negative integer .",
    "let @xmath1023 be a subspace of dimension @xmath992 , and denote by @xmath979 the collection of @xmath1024 and @xmath163 for @xmath1025 in @xmath26 .",
    "we will prove that @xmath1026 .",
    "the result then follows by taking @xmath1027 .    by proposition  [ prop : basic ]",
    ", we have @xmath1028 , so it will be enough to prove the reverse inequality @xmath1029 .",
    "the proof proceeds by induction on @xmath1030 , and by applying proposition  [ prop : connectedsumrankformetrizedcomplexes2 ] . for the base case of our induction",
    ", we have @xmath1031 , and thus @xmath1032 and @xmath1033 .",
    "now suppose that the claim holds for all metrized complexes on at most @xmath1034 vertices .",
    "for each @xmath1016 , denote by @xmath1035 the rooted tree at @xmath1036 obtained by removing the edge @xmath1037 from @xmath28 , and let @xmath1000 be the metric graph obtained from @xmath1035 by taking all edge lengths to be @xmath203 .",
    "let @xmath742 be the sub - metrized complex of @xmath202 with underlying metric graph @xmath1000 and curves @xmath63 for @xmath3 a vertex of @xmath1035 , and denote by @xmath748 the restriction of @xmath81 to @xmath742 , i.e. , @xmath1038 for all vertices @xmath3 of @xmath1035 .",
    "denote by @xmath1039 the family of all @xmath163 for @xmath3 a vertex of @xmath1035 .",
    "let @xmath1040 be the @xmath738-function associated to the bridge edge @xmath1037 , so that @xmath1041 is the smallest integer @xmath754 such that @xmath1042 .",
    "repeatedly applying proposition  [ prop : connectedsumrankformetrizedcomplexes2 ] reduces the calculation of @xmath1043 to the calculation of the restricted ranks of certain divisors on the metrized complex @xmath1019 ( with a single vertex @xmath967 and a unique curve @xmath1019 ) with respect to the subspace @xmath1044 ; more precisely , @xmath1045 we are thus led to prove that each term @xmath1046 in the above formula , for non - negative integers @xmath1047 , is bounded below by @xmath998 .",
    "we may clearly assume that @xmath1048 .    for each @xmath1016 , @xmath1049 .",
    "_ proof of the claim .",
    "_ by definition , the subspace @xmath1050 of @xmath1051 consisting of all global sections of @xmath1052 having an order of vanishing at least @xmath1053 at @xmath1054 has dimension @xmath1055 .",
    "let @xmath1056 be the divisor defined on @xmath742 by the data of the linear series @xmath1057 , for @xmath3 a vertex of @xmath1035 , and the root @xmath1036 , as in  .",
    "note that @xmath1058 .",
    "let @xmath1059 be the collection of @xmath1050 and @xmath163 , for @xmath1060 a vertex of @xmath1035 . by the induction hypothesis applied to the subcurve of @xmath34 consisting of all curves",
    "@xmath63 for @xmath3 a vertex of @xmath1035 and the crude limit linear series @xmath1061 , we have @xmath1062 . on the other hand , by the definition of @xmath1050",
    ", we have @xmath1063 and thus @xmath1064 by the definition of @xmath1065 , we infer that @xmath1049 , which proves the claim .",
    "to finish the proof of @xmath1021 , note that since @xmath194 is a crude limit @xmath10 , we have @xmath1066 this shows that the space of all global sections of @xmath1067 with an order of vanishing at least @xmath1068 at @xmath1069 has codimension at most @xmath1047 .",
    "the intersection of all these spaces with @xmath1024 has dimension at least @xmath1070 , which shows that @xmath1071 .",
    "proof of @xmath1072 : by corollary  [ cor : f - widthz ] , in calculating @xmath1073 we can restrict to effective divisors in @xmath242 . in this case , since @xmath28 is a tree , we can suppose that all the rational functions on @xmath1 which appear in the calculation of @xmath1074 arise via linear interpolation from integral functions @xmath1075 . since @xmath28 is a tree , the data of an integral function @xmath1076 on @xmath26 is equivalent , up to an additive constant , to an assignment of labels @xmath1077 to each oriented edge @xmath1078 of @xmath28 such that @xmath1079 for any @xmath1080 .",
    "( set @xmath1081 . ) in what follows , we denote by @xmath1082 the unique parent of a vertex @xmath1083 in the rooted tree @xmath973 .",
    "suppose now that @xmath1084 .",
    "we first observe that , for any other choice of a root vertex @xmath1085 , if @xmath177 denotes the corresponding divisor on @xmath202 defined as in   then the two divisors @xmath81 and @xmath177 differ by the principal divisor @xmath118 , where @xmath35 is a rational function with @xmath1-part @xmath1076 and constant @xmath63-part for all @xmath14 .",
    "thus @xmath1086 , so it will be enough to prove the validity of condition   for the root @xmath967 and a child @xmath447 of @xmath967 among @xmath1087 .",
    "denote by @xmath976 and @xmath1088 the @xmath30-points of @xmath197 and @xmath1019 , respectively , corresponding to the edge @xmath1089 , and let @xmath1090 . for any effective divisor @xmath1091 , where @xmath1092 and @xmath1093 are effective divisors of degree @xmath1094 and @xmath613 on @xmath1019 and @xmath197 , respectively",
    ", there must exist a rational function @xmath35 with @xmath1095 for all @xmath452 such that @xmath1096 .",
    "for any two adjacent vertices @xmath452 and @xmath66 in @xmath28 , let @xmath1097 as above . since for any vertex @xmath1098 , @xmath1099 has degree zero , a simple induction starting from the leaves and going towards the root shows that @xmath1100 .",
    "this in particular implies that @xmath1101 and @xmath1102 . for a generic choice of @xmath1103 and @xmath1093",
    ", we can assume as in the proof of proposition  [ prop : combinrank ] that @xmath1104 is a constant .",
    "in other words , there exists an integer @xmath1105 such that the sublinear system of @xmath1106 ( resp . ,",
    "@xmath1107 ) which consists of those sections with an order of vanishing at least @xmath1108 ( resp .",
    "@xmath1109 ) at @xmath1088 ( resp .",
    "@xmath976 ) has projective dimension at least @xmath1094 ( resp .",
    "@xmath613 ) . by the definition of the sequences @xmath1110 and @xmath1111 , this simply means that @xmath1112 and @xmath1113 .",
    "it follows that @xmath1114 which is condition   for the two irreducible components @xmath1019 and @xmath197 of @xmath34 .",
    "let @xmath30 be of characteristic zero .",
    "then @xmath194 is a refined limit series iff @xmath1115 and all the ramification points of @xmath196 are smooth points of @xmath63 for all @xmath857 .",
    "this is a direct consequence of theorem  [ thm : limitseries ] above and the plcker formula , c.f .",
    "* proposition 1.1 ) .",
    "we note that the _ a priori _ dependence of the family @xmath1012 on the @xmath63-aspects @xmath196 can be removed , and recovered from the condition on the rank , in the following sense . for any crude limit @xmath10 @xmath194 on @xmath34 with @xmath63-aspect @xmath963 , choose a divisor @xmath1116 with @xmath1117 .",
    "two divisors @xmath87 and @xmath1118 in @xmath242 are called _ combinatorially equivalent _ if they differ by the divisor of a rational function @xmath35 on @xmath202 with all @xmath107 constant .",
    "the following result is essentially a reformulation of theorem  [ thm : introlls ] from the introduction and easily implies the result stated there .",
    "let @xmath34 be a curve of compact type and @xmath202 the regularization of @xmath34 .",
    "then there is a bijective correspondence between the following :    * pairs @xmath1119 consisting of a crude limit @xmath10 @xmath194 on @xmath34 and a collection of divisors @xmath88 on @xmath63 with @xmath1120 for any irreducible component @xmath63 of @xmath34 ; and * pairs @xmath1121)$ ] , where @xmath206 , @xmath163 is an @xmath162-dimensional subspace of @xmath207 for each @xmath14 , and @xmath1122 $ ] is the combinatorial linear equivalence class of a divisor @xmath1123 of degree @xmath195 on @xmath202 with @xmath208 .",
    "in particular , the data of a crude limit @xmath10 on @xmath34 is equivalent to the data of a pair @xmath1124)$ ] with @xmath1125 .",
    "we already know by theorem  [ thm : limitseries ] that any crude limit @xmath10 gives a pair @xmath1124)$ ] with @xmath1125 .",
    "let @xmath1012 be a collection of @xmath162-dimensional subspaces @xmath1126 for @xmath14 , and let @xmath81 be a divisor of degree @xmath195 in @xmath242 with @xmath1127 we show the existence of a @xmath1128 @xmath1129 on @xmath63 for each @xmath14 such that the collection @xmath1130 defines a crude limit @xmath10 on @xmath34 , and such that @xmath81 is ( combinatorially ) linearly equivalent to the divisor @xmath1131 associated to @xmath194 by  .",
    "let @xmath86 ( resp .",
    "@xmath88 ) denote the @xmath1-part ( resp .",
    "@xmath63-part ) of @xmath87 . since @xmath1 has genus zero , for any vertex @xmath3 in @xmath1132 there exists a rational function @xmath137 on @xmath1 such that @xmath1133 .",
    "define @xmath1134 , where @xmath1135 is defined as in ( [ eq : divf2 ] ) .",
    "we claim that @xmath1136 ; this amounts to showing that @xmath1137 for any @xmath1138 .",
    "if we denote by @xmath1139 the subspace of @xmath163 consisting of all rational functions in @xmath163 with this property , it will be enough show that @xmath1140 .",
    "first , we note that for any rational function @xmath1141 on @xmath1 with @xmath1142 , we have @xmath1143 .",
    "indeed , @xmath1142 implies that for any edge @xmath37 adjacent to @xmath3 , the slope of @xmath137 in the tangent direction corresponding to @xmath37 is bounded above by the sum of the coefficients @xmath1144 of the points @xmath452 lying on the connected component of @xmath1145 which contains the edge @xmath37 .",
    "this sum is precisely the slope of @xmath137 in the tangent direction corresponding to @xmath37 .    for any effective divisor @xmath27 of degree @xmath19 on @xmath63 , let @xmath146 denote the corresponding divisor on @xmath202 .",
    "since @xmath1125 , there exists a rational function @xmath1146 such that @xmath1147 . since @xmath1148 , the preceding remark implies that @xmath1149 . by the definition of @xmath118",
    ", we conclude that @xmath1150 , and in particular @xmath1151 belongs to @xmath1139 .",
    "since this holds for any @xmath27 , we infer that the linear series on @xmath63 defined by @xmath1139 has ( projective ) dimension at least @xmath19 and so @xmath1139 has dimension at least @xmath609 , thus @xmath1152 .",
    "we conclude that @xmath963 is a @xmath10 on @xmath63 , and thus the collection of @xmath196 for @xmath14 defines a crude limit @xmath10 @xmath194 on @xmath34 . if @xmath1131 is the divisor associated to @xmath194 by  , it is straightforward to check that @xmath1131 and @xmath81 differ by the divisor of a rational function @xmath35 on @xmath202 whose @xmath63-parts are all constant and whose @xmath1-part is the linear interpolation of an integer - valued function @xmath1153",
    ".      let @xmath32 be a metrized complex of algebraic curves over @xmath30 , @xmath1 the underlying metric graph with model @xmath932 , and @xmath978 the corresponding collection of smooth projective curves over @xmath30 .",
    "we define a _ ( crude ) limit @xmath10 _ on @xmath32 to be an equivalence class of pairs @xmath1154 consisting of a divisor @xmath81 of degree @xmath195 on @xmath32 and a collection @xmath1012 of @xmath162-dimensional subspaces @xmath1155 , for @xmath1156 , such that @xmath1157 .",
    "two pairs @xmath205 and @xmath1158 are considered equivalent if there is a rational function @xmath35 on @xmath32 such that @xmath210 and @xmath211 for all @xmath14 , where @xmath107 denotes the @xmath2-part of @xmath35 .    since @xmath1159 for all @xmath1012 as above and all @xmath168",
    ", it follows immediately from theorem  [ thm : rr - metrizedcomplexes ] that for any limit @xmath10 on @xmath32 we have if @xmath1160 or @xmath1161 , then @xmath1162 ( riemann s inequality ) , and if @xmath87 is _ special _ then @xmath1163 ( clifford s inequality ) . for curves of compact type ,",
    "these inequalities are established ( by a completely different proof ) in @xcite .",
    "[ thm : limitseriesgeneral ] let @xmath4 be a smooth proper curve over @xmath5 , @xmath6 a strongly semistable model for @xmath4 , and @xmath8 the metrized complex associated to @xmath6 .",
    "let @xmath159 be a divisor on @xmath4 and let @xmath1164 , for @xmath1165 , be a @xmath10 on @xmath4 .",
    "for any vertex @xmath14 , define @xmath163 as the @xmath30-vector space defined by the reduction to @xmath40 of all the rational functions in @xmath947 ( c.f .",
    "section  [ section : reductionofrationalfunctions ] ) , and let @xmath1166 .",
    "then the pair @xmath1167 defines a limit @xmath10 on @xmath8 .    by lemma  [ lem : dimensionreduction ] ,",
    "all the subspaces @xmath163 have dimension @xmath609 over @xmath30 . by proposition  [ prop : basic ]",
    ", we only have to show that @xmath1168 . by theorem  [ thm : f - width ] , it suffices to show that for any effective divisor @xmath1169 of degree @xmath19 supported on a subset @xmath1170 of @xmath8 with @xmath1171 of size @xmath721 , there exists a rational function @xmath35 on @xmath8 such that @xmath1172 for all @xmath14 and @xmath1173 . for any such @xmath146 , there exists an effective divisor of degree @xmath19 on @xmath4 such that @xmath726 . since @xmath1174 is a @xmath10 on @xmath4 , there exists a rational function @xmath1175 such that @xmath1176 .",
    "let @xmath35 be the corresponding rational function on @xmath8 ( as in the paragraph preceding theorem  [ thm : plspecialization ] ) .",
    "we conclude that @xmath1177 .",
    "since @xmath1178 , this shows that @xmath1179 as desired .    for the regularization @xmath202 of a strongly semistable curve @xmath34 over @xmath30 , theorem  [ thm : limitseriesgeneral ] can be reformulated as follows .",
    "let @xmath1180 be a regular smoothing of @xmath34 over a discrete valuation ring @xmath7 and let @xmath1181 be a @xmath10 over the generic fiber @xmath931 of @xmath929 .",
    "consider an extension @xmath245 of @xmath1174 to @xmath930 , and let @xmath1182 be the restriction of @xmath245 to @xmath34 .",
    "let @xmath81 be a divisor on @xmath202 in the linear equivalence class of @xmath1183 , where @xmath1184 is as in section  [ sec : basics ] .",
    "there exists a family @xmath1185 of @xmath162-dimensional subspaces @xmath1126 such that @xmath1186 .",
    "in addition , @xmath163 can be explicitly constructed as follows . for any vertex @xmath3 , choose a rational function @xmath1187 on @xmath202 such that the divisor @xmath1188 is @xmath3-reduced and let @xmath1189 be the @xmath1-part of @xmath1190 . consider the extension @xmath1191 of @xmath934 to @xmath930 and let @xmath1192 be the closure of @xmath947 in @xmath1193 .",
    "define @xmath1194 and @xmath1195 . finally , for any @xmath14 let @xmath1196 be the @xmath3-reduced divisor linearly equivalent to @xmath81 , and define @xmath1197 .",
    "[ thm : regularlimitseries ] let @xmath34 be a strongly semistable curve over @xmath30 and @xmath202 the regularization of @xmath34 . for any regular smoothing @xmath1198 of @xmath34 over a discrete valuation ring @xmath7 , @xmath1199",
    "as defined above is a limit @xmath10 on @xmath34 .",
    "in addition , for each vertex @xmath857 we have @xmath1200 , so that @xmath1201 defines a @xmath1202 on the irreducible component @xmath63 of @xmath34 .",
    "we conclude this section with the following strengthening of theorem  [ thm : limitseriesgeneral ] which will be used in  [ chabautysection ] .",
    "[ thm : limitseriesgeneral2 ] let @xmath4 be a smooth proper curve over @xmath5 , @xmath6 a strongly semistable model for @xmath4 , and let @xmath8 be the metrized complex associated to @xmath6 .",
    "let @xmath159 be a divisor on @xmath4 and set @xmath1203 .",
    "let @xmath1164 be a @xmath10 on @xmath4 and let @xmath1166 be as in the statement of theorem  [ thm : limitseriesgeneral ] .",
    "let @xmath1204 be an effective divisor of degree @xmath37 supported on the smooth locus of the special fiber of @xmath6 , and define @xmath1205 , where @xmath1206 is the restriction of @xmath1204 to @xmath2 .",
    "suppose that @xmath1207 for all @xmath3 .",
    "then the pair @xmath1208 is a limit @xmath1209 on @xmath8 .    in the view of theorem  [ thm : f - width ] , the proof is similar to the proof of theorem  [ thm : limitseriesgeneral ] , by requiring each subset @xmath720 to be disjoint from the support of @xmath1206 . for any effective divisor @xmath171 of degree @xmath19 supported on @xmath1210 ,",
    "the proof of theorem  [ thm : limitseriesgeneral ] shows that there exists a rational function @xmath35 such that @xmath1211 .",
    "we claim that in fact @xmath1212 , which implies that @xmath1213 is a limit @xmath1209 on @xmath8 as desired . to see this ,",
    "let @xmath1214 be the @xmath1-part of @xmath1215 and note that since @xmath1216 and @xmath1217 by hypothesis , it suffices to prove that the @xmath2-part of @xmath118 is at least the @xmath2-part of @xmath1218 for all @xmath14 , i.e. , @xmath1219    if @xmath1220 , then since @xmath1221 is disjoint from @xmath1222 we have @xmath1223 , and since @xmath1221 is disjoint from @xmath1224 we have @xmath1225 .",
    "thus ( [ eq : limitseriesgeneral2 ] ) holds in this case since @xmath1226 implies that @xmath1227 . on the other hand , if @xmath1228 , then @xmath1229 and thus ( [ eq : limitseriesgeneral2 ] ) holds because by assumption we have @xmath1230 and in particular @xmath1231 .",
    "thus ( [ eq : limitseriesgeneral2 ] ) is valid for all @xmath1232 as desired .      given a divisor @xmath87 of degree @xmath195 and rank @xmath19 on @xmath32 ,",
    "one may ask if there exists a collection @xmath1233 , with @xmath1234 an @xmath162-dimensional subspace of @xmath1235 for all @xmath613 , such that @xmath1236 . ( recall that we always have @xmath1237 . )",
    "if so , we say that @xmath87 can be _ completed to a limit @xmath10 _ on @xmath32 .",
    "moreover , theorem  [ thm : limitseriesgeneral ] shows that if @xmath4 is a smooth proper curve over @xmath5 , @xmath1238 is a @xmath10 on @xmath4 , and @xmath8 is the metrized complex associated to a strongly semistable model @xmath6 for @xmath4 , then the associated pair @xmath1167 ( which we call the _ specialization _ of @xmath1239 ) is a limit @xmath10 on @xmath8 .",
    "we say that a limit @xmath10 @xmath1239 on a metrized complex @xmath32 over @xmath0 is _ smoothable _ if there exists a smooth proper curve @xmath4 over @xmath5 such that @xmath1240 for some strongly semistable model @xmath6 of @xmath4 and @xmath1239 arises the specialization of a limit @xmath10 on @xmath4 .",
    "note that by ( * ? ? ?",
    "* theorem 3.24 ) , every @xmath1241-rational metrized complex @xmath32 over @xmath0 is of the form @xmath1240 for some smooth proper curve @xmath4 over @xmath5 and some strongly semistable model @xmath6 of @xmath4 , where _ @xmath1241-rational _ means that the edge lengths in @xmath28 all belong to the value group of @xmath5 .    in this section ,",
    "we show by example that not every divisor @xmath87 of degree @xmath195 and rank @xmath19 on a metrized complex @xmath32 can be completed to a limit @xmath10 , and not every limit @xmath10 on a @xmath1241-rational metrized complex @xmath32 is smoothable .",
    "[ ex : notcompletable ] consider the weighted graph @xmath1 depicted in figure  [ fig : nog12 ] ( with arbitrary edge lengths ) , and let @xmath32 be a metrized complex whose underlying weighted metric graph is @xmath1 ( so each @xmath234 has genus @xmath203 and @xmath2 has genus @xmath1242 ) . for any point @xmath133 in @xmath1243 , consider the degree @xmath645 divisor @xmath1244 .",
    "we claim that @xmath81 has rank @xmath203 on @xmath32 but can not be completed to a limit @xmath1245 .",
    "the fact that @xmath81 has rank @xmath203 is straightforward and left to the reader . assume for the sake of contradiction that there exists a limit @xmath1245 @xmath1246 on @xmath32 .",
    "let @xmath1247 ( resp .",
    "@xmath1248 ) be the points of @xmath1249 ( resp .",
    "@xmath1250 ) corresponding to the three edges of @xmath1 .",
    "fix @xmath1251 , choose a point @xmath1252 in @xmath1253 and let @xmath1254 . for any rational function @xmath35 on @xmath32 such that @xmath1096 , the fact that @xmath1253 has genus one implies that @xmath1255 ,",
    "since there is no rational function on @xmath1253 whose divisor is @xmath1256 .",
    "therefore @xmath1257 .",
    "restricting @xmath35 to @xmath2 gives a rational function @xmath1258 on @xmath2 with @xmath1259 .",
    "since @xmath1246 is by assumption a limit @xmath1245 , we must have @xmath1260 .",
    "but a simple calculation shows that the @xmath1258 are linearly independent , implying that @xmath1261 , a contradiction .",
    "suppose the residue field @xmath0 of @xmath5 has characteristic different from @xmath645 .",
    "then there exists a metrized complex @xmath32 over @xmath0 ( with all curves @xmath2 isomorphic to @xmath1262 ) and a divisor @xmath87 of degree 2 and rank 1 on @xmath32 which can not be completed to a limit @xmath1245 .",
    "indeed , any hyperelliptic metric graph which can not be realized as the skeleton of a hyperelliptic curve over @xmath5 provides an example of this phenomenon ( and one can construct many examples of such metric graphs , using the characterization of those hyperelliptic metric graphs which can be lifted to a hyperelliptic curve over @xmath5 given in  @xcite and  @xcite . ) here is a sketch of the argument .",
    "it is not difficult to show that a limit @xmath1245 on a metrized complex @xmath32 gives rise , in a natural way , to a finite harmonic morphism of degree two ( in the terminology of  ( * ? ? ?",
    "* definition 2.22 ) ) from @xmath32 to a metrized complex of genus zero . by the lifting result ( * ? ? ?",
    "* corollary 1.5 ) , such a finite harmonic morphism can be lifted to a degree two map from a smooth proper curve @xmath29 with associated metrized complex @xmath32 to @xmath1262 , which implies that the underlying metric graph of @xmath32 is the skeleton of a hyperelliptic curve over @xmath5 .",
    "[ ex : notsmoothable ] this phenomenon occurs already in the compact type case : the original paper of eisenbud - harris on limit linear series @xcite provides an example ( example 3.2 of _ loc .",
    "_ ) of a limit @xmath1263 which can not be smoothed ; we recall their example here .",
    "the metrized complex @xmath32 in question is associated to a semistable curve @xmath34 with two components meeting transversely at a point @xmath133 ; one of the components is a hyperelliptic curve @xmath924 of genus at least @xmath1264 and the other component @xmath1265 has genus zero .",
    "the point @xmath133 is a ramification point of the @xmath1245 on @xmath924 , and without loss of generality we may assume that @xmath133 corresponds to the point @xmath1242 on @xmath1266 .",
    "the dual graph @xmath28 of @xmath34 has two vertices @xmath1267 and @xmath1268 connected by a single edge , which may take to be of length one in @xmath1 .",
    "now define a divisor @xmath87 on @xmath32 by setting @xmath1269 for the point @xmath1270 .",
    "if we define @xmath1271 , where @xmath1272 and @xmath1273 is the span of @xmath1274 ( with @xmath1275 a local parameter at @xmath1242 on @xmath1276 ) , then by ( * ? ? ?",
    "* example 3.2 ) and theorem  [ thm : limitseries ] above , the pair @xmath1239 defines a limit @xmath1263 on @xmath32 .",
    "( it is also not hard to show this directly using our definitions . )",
    "this limit @xmath1263 can not be smoothed .      in this section , we explain how limit linear series on metrized complexes of curves can be used to illuminate the proof of a recent theorem due to e. katz and d. zureick - brown @xcite and put it into a broader context .",
    "let @xmath928 be a number field and suppose @xmath4 is a smooth , proper , geometrically integral curve over @xmath928 of genus @xmath17 .",
    "let @xmath1277 be the jacobian of @xmath4 , which is an abelian variety of dimension @xmath20 defined over @xmath928 .",
    "if the mordell - weil rank @xmath19 of @xmath1278 is less than @xmath20 , coleman @xcite adapted an old method of chabauty to prove that if @xmath1279 is a prime which is unramified in @xmath928 and @xmath1280 is a prime of good reduction for @xmath4 lying over @xmath133 , then @xmath1281 . here",
    "@xmath1282 denotes the special fiber of a smooth proper model for @xmath4 over the completion @xmath1283 of @xmath1284 at @xmath1280 and @xmath1285 .",
    "stoll @xcite improved this bound by replacing @xmath188 with @xmath1286 .",
    "lorenzini and tucker @xcite ( see also @xcite ) proved the same bound as coleman without assuming that @xmath4 has good reduction at @xmath1280 ; in their bound , @xmath1287 is replaced by @xmath1288 where @xmath6 is a proper regular model for @xmath4 over @xmath1283 and @xmath1289 is the smooth locus of the special fiber of @xmath6 .",
    "katz and zureick - brown combine the improvements of stoll and lorenzini - tucker by proving :    [ thm : katz - zb ] let @xmath928 be a number field and suppose @xmath4 is a smooth , proper , geometrically integral curve over @xmath928 of genus @xmath17 .",
    "suppose the mordell - weil rank @xmath19 of @xmath1278 is less than @xmath20 , and that @xmath1279 is a prime which is unramified in @xmath928 .",
    "let @xmath1280 be a prime of @xmath1284 lying over @xmath133 and let @xmath6 be a proper regular model for @xmath4 over @xmath1283",
    ". then @xmath1290    in order to explain the main new idea in the paper of katz and zureick - brown , we first quickly recall the basic arguments used by coleman , stoll , and lorenzini - tucker .",
    "( see @xcite for a highly readable and more detailed overview . )",
    "assume first that we are in the setting of coleman s paper , so that @xmath1291 , @xmath1279 is a prime which is unramified in @xmath928 , and @xmath4 has good reduction at the prime @xmath1292 lying over @xmath133 . fix a rational point @xmath1293 ( if there is no such point , we are already done ! ) .",
    "coleman associates to each regular differential @xmath1294 on @xmath4 over @xmath1295 ( the @xmath1292-adic completion of @xmath928 ) a `` definite @xmath133-adic integral '' @xmath1296 .",
    "if @xmath1297 denotes the vector space of all @xmath1294 such that @xmath1298 for all @xmath1299 , coleman shows that @xmath1300 .",
    "locally , @xmath133-adic integrals are obtained by formally integrating a power series expansion for @xmath1294 with respect to a local parameter . using this observation and an elementary newton polygon argument",
    ", coleman proves that @xmath1301 where @xmath1302 is the minimum over all nonzero @xmath1294 in @xmath1297 of @xmath1303 ; here @xmath1304 denotes the reduction of a suitable rescaling @xmath1305 of @xmath1294 to @xmath1282 , where the scaling factor is chosen so that @xmath1305 is regular and non - vanishing along the special fiber @xmath1282 .",
    "if we choose any nonzero @xmath1306 , then the fact that the canonical divisor class on @xmath1282 has degree @xmath188 gives @xmath1307 which yields coleman s bound .",
    "stoll observed that one could do better than this by adapting the differential @xmath1294 to the point @xmath1308 rather than using the same differential @xmath1294 on all residue classes .",
    "define the _ chabauty divisor _",
    "@xmath1309 then @xmath1310 and @xmath1311 are both equivalent to effective divisors , so by clifford s inequality ( applied to the smooth proper curve @xmath1282 ) we have @xmath1312 . on the other hand , by the semicontinuity of @xmath1313 under specialization we have @xmath1314 .",
    "combining these inequalities gives @xmath1315 which leads to stoll s refinement of coleman s bound .",
    "lorenzini and tucker observed that one can generalize coleman s bound to the case of bad reduction as follows .",
    "let @xmath6 be a proper regular model for @xmath4 over @xmath1283 and note that points of @xmath1316 specialize to @xmath1288 .",
    "one obtains by a similar argument the bound @xmath1317 where @xmath1302 is the minimum over all nonzero @xmath1294 in @xmath1297 of @xmath1303 ; here @xmath1304 denotes the reduction of ( a suitable rescaling of ) @xmath1294 to the unique irreducible component of the special fiber of @xmath6 containing @xmath1308 and @xmath1300 as before . choosing a nonzero @xmath1306 as in coleman s bound , the fact that the relative dualizing sheaf for @xmath6 has degree @xmath188 gives the lorenzini - tucker bound .    in order to combine the bounds of stoll and lorenzini - tucker , we see that it is natural to form the chabauty divisor @xmath1318 and try to prove , using some version of semicontinuity of @xmath1313 and clifford s inequality , that its degree is at most @xmath1286 .",
    "this is the main technical innovation of katz and zureick - brown , so we state it as a theorem :    [ thm : katz - zb_degree_bound ] the degree of @xmath1310 is at most @xmath1286 .    combining theorem  [ thm : katz - zb_degree_bound ] with yields theorem  [ thm : katz - zb ] . as noted by katz and zureick - brown ,",
    "if one makes a base change from @xmath1295 to an extension field @xmath1319 over which there is a regular semistable model @xmath1320 for @xmath4 dominating the base change of @xmath6 , then the corresponding chabauty divisors satisfy @xmath1321 .",
    "( here @xmath1322 is defined relative to the @xmath1319-vector space @xmath1323 ; one does not want to look at the mordell - weil group of @xmath1277 over extensions of @xmath928 . ) in order to prove theorem  [ thm : katz - zb_degree_bound ] , we may therefore assume that @xmath33 is a regular semistable model for @xmath4 ( and also that the residue field of @xmath1319 is algebraically closed ) .",
    "let @xmath1324 .",
    "we now explain how to prove that @xmath1325 when @xmath33 is a semistable regular model using limit linear series on metrized complexes of curves .",
    "our proof is different from ( and arguably streamlined than ) the one given in @xcite .",
    "let @xmath1326 .",
    "we can identify @xmath1327 with an @xmath1328-dimensional space @xmath1329 of rational functions on @xmath4 in the usual way by identifying @xmath1330 with @xmath1331 for a canonical divisor @xmath191 on @xmath4 .",
    "the divisor @xmath1310 on @xmath1289 defines in a natural way a divisor @xmath1332 of degree @xmath195 on the metrized complex @xmath1333 associated to @xmath33 , where @xmath88 is the restriction of @xmath1310 to @xmath2 .",
    "we promote the divisor @xmath1334 to a limit linear series @xmath1335 on @xmath1333 by defining @xmath163 to be the reduction of @xmath1329 to @xmath2 for each @xmath1156 . by the definition of @xmath1310",
    ", each element of @xmath163 vanishes to order at least @xmath1302 at each point @xmath1308 in @xmath1336 . by corollary  [ cor : introcanonspec ] and theorem  [ thm : limitseriesgeneral2 ] ,",
    "@xmath945 is a limit @xmath1337 on @xmath1333 . in particular",
    ", we must have @xmath1338 . on the other hand ,",
    "clifford s inequality for metrized complexes ( theorem  [ thm : mcclifford ] ) implies that @xmath1339 . combining these inequalities gives @xmath1325 as desired",
    "we retain the terminology from section  [ sec : basics ] .",
    "let @xmath32 be a metrized complex of algebraic curves , @xmath1 the underlying metric graph , @xmath932 a model of @xmath1 and @xmath1340 the collection of smooth projective curves over @xmath30 corresponding to @xmath32 .",
    "in this section , we generalize some basic results concerning rank - determining sets  @xcite from metric graphs to metrized complexes by following and providing complements to the arguments of  @xcite ( to which we refer for a more detailed exposition ) .",
    "let @xmath722 be a set of geometric points of @xmath32 ( i.e. , a subset of @xmath1341 ) .",
    "the set @xmath722 is called _ rank - determining _ if for any divisor @xmath81 on @xmath32 , @xmath321 coincides with @xmath1342 , defined as the largest integer @xmath149 such that @xmath150 is linearly equivalent to an effective divisor for all degree @xmath149 effective divisors @xmath146 on @xmath32 with support in @xmath722 . in other words , @xmath722 is rank - determining if in the definition of rank given in section  [ sec : basics ] , one can restrict to effective divisors @xmath146 with support in @xmath722 .",
    "the following theorem is a common generalization of ( a ) luo s theorem  @xcite ( see also  @xcite ) that @xmath26 is a rank - determining set for any loopless model @xmath932 of a metric graph @xmath1 and ( b ) the classical fact ( also reproved in @xcite ) that for any smooth projective curve @xmath407 of genus @xmath20 over @xmath30 , every subset of @xmath1343 of size @xmath1344 is rank - determining .",
    "[ thm : f - width ] let @xmath32 be a metrized complex of algebraic curves , and suppose that the given model @xmath28 of @xmath1 is loopless . let @xmath1345 be a subset of size @xmath721 and let @xmath1346 . then @xmath722 is a rank - determining subset of @xmath32 .",
    "let @xmath81 be a divisor on @xmath32 .",
    "for any point @xmath1347 , let @xmath1348 be the quasi - unique @xmath103-reduced divisor on @xmath32 linearly equivalent to @xmath81 , and denote by @xmath1349 ( resp .",
    "@xmath1350 ) the @xmath1-part ( resp .",
    "@xmath2-part ) of @xmath1348 .",
    "the condition @xmath1353 is equivalent to requiring that @xmath1354 for every effective divisor @xmath146 of degree @xmath203 on @xmath32 . for @xmath1355 , the divisor",
    "@xmath1356 has non - negative rank if and only if @xmath1351 ( by lemma  [ lem : reduced ] ) .",
    "similarly , for @xmath14 and @xmath1357 , the divisor @xmath1358 has non - negative rank in @xmath32 if and only if @xmath1359 and @xmath1360 has non - negative rank on @xmath2 ( by lemma  [ lem : reduced ] ) . these are clearly equivalent to ( 1 ) and ( 2 ) .",
    "[ lem : rank - determ ] a subset @xmath1361 which has non - empty intersection with each @xmath1362 is rank - determining if and only if for every divisor @xmath81 of non - negative rank on @xmath32 , the following two assertions are equivalent :      in view of lemma  [ lem : rankone ] , for a rank - determining set the two conditions ( i ) and ( ii ) are equivalent .",
    "suppose now that ( i ) and ( ii ) are equivalent for any divisor @xmath81 on @xmath32 .",
    "by induction on @xmath19 , we prove that @xmath1367 if and only if for every effective divisor @xmath146 of degree @xmath19 with support in @xmath722 , @xmath1368 .",
    "this will prove that @xmath722 is rank - determining .",
    "let @xmath81 be a divisor with the property that @xmath1371 for every effective divisor @xmath146 of degree @xmath609 with support in @xmath722 .",
    "fix an effective divisor @xmath146 of degree @xmath19 with support in @xmath722 . by the base case @xmath1369",
    ", the divisor @xmath150 has rank at least @xmath203 on @xmath32 because @xmath1372 for any @xmath1373 .",
    "thus @xmath1374 for any point of @xmath53 .",
    "this holds for any effective divisor @xmath146 of degree @xmath19 with support in @xmath722 , and so from the inductive hypothesis we infer that @xmath1375 has rank at least @xmath19 on @xmath32 . since this holds for any @xmath57",
    ", we conclude that @xmath81 has rank at least @xmath609 .",
    "let @xmath81 be a divisor of degree @xmath195 and non - negative rank on @xmath32 , and let @xmath86 and @xmath88 be the @xmath1 and @xmath2-parts of @xmath87 , respectively .",
    "define @xmath1376 note that @xmath1377 is a non - empty subset of the symmetric product @xmath1378 of @xmath195 copies of @xmath1 .",
    "consider the _ reduced divisor _",
    "map @xmath1379 which sends a point @xmath1380 to @xmath1349 , the @xmath1-part of the @xmath103-reduced divisor @xmath1381 .",
    "the following theorem extends  ( * ? ? ?",
    "* theorem 3 ) to divisors on metrized complexes .",
    "this is based on an explicit description of the reduced divisor map @xmath1382 in a small neighborhood around any point of @xmath1 , similar to the description provided in  ( * ? ? ?",
    "* theorem 3 ) in the context of metric graphs .",
    "we merely give the description by providing appropriate modifications to  ( * ? ? ?",
    "* theorem 3 ) , referring to _ loc .",
    "_ for more details .",
    "let @xmath103 be a point of @xmath1 and let @xmath1383 be a ( unit ) tangent direction in @xmath1 emanating from @xmath103 . for @xmath382",
    "sufficiently small , we denote by @xmath1384 the point of @xmath1 at distance @xmath387 from @xmath103 in the direction of @xmath1383 .",
    "we will describe the restriction of @xmath1382 to the segment @xmath1385 $ ] for sufficiently small @xmath382 .",
    "one of the two following cases can happen :          we note that there is a maximum saturated cut @xmath298 ( i.e. , containing any other saturated cut ) with the property described in ( 2 ) ( see the proof of  ( * ? ? ?",
    "* theorem 3 ) for details ) . in the following @xmath298",
    "denotes the maximum saturated cut with property ( 2 ) . in this case",
    ", there exists an @xmath1388 such that for any @xmath1392 , the reduced divisor @xmath1393 has the following description ( the proof mimics that of  ( * ? ? ?",
    "* theorem 3 ) and is omitted ) .",
    "let @xmath1394 be all the different tangent vectors in @xmath1 ( based at the boundary points @xmath1395 , respectively ) which are outgoing from @xmath298 .",
    "( it might be the case that @xmath1396 for two different indices @xmath613 and @xmath628 ) .",
    "let @xmath1397 be small enough so that for any point @xmath333 and any tangent vector @xmath1398 to @xmath1 at @xmath58 which is outgoing from @xmath298 , the entire segment @xmath1399 $ ] lies outside @xmath298 and does not contain any point of the support of @xmath86 .    for any @xmath1400 and any positive integer @xmath1401",
    ", we will define below a rational function @xmath1402 on @xmath1 .",
    "appropriate choices of @xmath1403 and @xmath1401 will then give the ( @xmath1384)-reduced divisor @xmath1404 , for any @xmath1405 , where @xmath1406 is the rational function on @xmath32 given by @xmath1407 on @xmath1 and @xmath1408 on each @xmath2 .",
    "* @xmath1411 takes value zero at any point of @xmath298 ; * on any outgoing interval @xmath1412 $ ] from @xmath298 , @xmath1411 is linear of slope @xmath262 ; * the restriction of @xmath1411 to the interval @xmath1413 $ ] is linear of slope @xmath1414 ; * @xmath1411 takes value @xmath1415 at any other point of @xmath1416      it remains to determine the values of @xmath1401 and @xmath1419 .",
    "once the value of @xmath1401 is determined , @xmath1419 will be defined as @xmath1420 so that the point @xmath1421 coincides with the point @xmath1384 .",
    "we consider the following two cases , depending on whether or not @xmath103 is a vertex of @xmath28 :    * if @xmath1422 , then @xmath1423 .",
    "( note that since @xmath298 is saturated with respect to @xmath1424 , we have @xmath1425 and thus @xmath1426 . ) * if @xmath1427 for a vertex @xmath857 , let @xmath1428 be the outgoing edges at @xmath3 with respect to @xmath298 , and consider the points @xmath1429 in @xmath1362 indexed by these edges .",
    "suppose in addition that @xmath1430 is the edge which corresponds to the tangent direction @xmath1431 . since @xmath298 is a saturated cut with respect to @xmath1432 , the divisor @xmath1433 has non - negative rank in @xmath2 .",
    "define @xmath1401 to be the largest integer @xmath1434 such that @xmath1435 has non - negative rank .",
    "now for any @xmath1436 , the divisor @xmath1393 is @xmath1437-reduced .",
    "( the argument is similar to ( * ? ? ? * proof of theorem 3 ) . )",
    "it follows immediately that the reduced divisor map is continuous on the interval @xmath1438 , and the result follows .",
    "so it suffices to prove that @xmath1440 and @xmath1441 .",
    "since cardinality of @xmath723 is @xmath721 , @xmath723 is rank - determining in @xmath2 .",
    "therefore , ( ii ) implies @xmath1441 .",
    "we now show that @xmath1441 implies @xmath1442 .",
    "let @xmath229 be the set of all @xmath1443 such that @xmath1444 .",
    "by the continuity of the map @xmath1382 , @xmath229 is a closed subset of @xmath1 .",
    "in addition , since @xmath1352 has rank at least one on @xmath2 and @xmath1445 for every vertex @xmath1446 , we have @xmath1447 .",
    "this shows that @xmath1448 is a disjoint union of open segments contained in edges of @xmath28 .",
    "suppose for the sake of contradiction that @xmath1449 , and let @xmath1450 be a non - empty segment contained in the edge @xmath257 of @xmath28 such that @xmath1451 .      to see this , note that for any point @xmath1453 $ ] and any tangent direction @xmath1383 for which @xmath1454 $ ] for all sufficiently small @xmath382 , we are always in case ( 1 ) in the description of @xmath1382 .",
    "otherwise , there would be an integer @xmath1455 such that @xmath1456 for all sufficiently small @xmath1391 .",
    "in particular , this would imply ( by the definition of @xmath1457 ) that @xmath1458 , which implies that @xmath1459 , a contradiction .",
    "this proves the claim .",
    "a case analysis ( depending on whether @xmath103 and @xmath1460 are vertices or not ) shows that for a point @xmath1461 , the cut @xmath1462 is saturated for @xmath1463 .",
    "since @xmath1464 , and @xmath298 does not contain @xmath1265 , this contradicts the assumption that @xmath1465 is @xmath1265-reduced .        fix a rank - determining set @xmath1468 as in theorem  [ thm : f - width ] . since @xmath722 is rank - determining and any effective divisor @xmath146 with support in @xmath722 obviously belongs to @xmath225 , to prove the equality of @xmath1469 and @xmath321 it will be enough to show that the two statements @xmath1470 and @xmath487 are equivalent .",
    "obviously , the former implies the latter , so we only need to show that if @xmath487 then @xmath1470 .",
    "let @xmath3 be a vertex of @xmath28 and @xmath1471 the @xmath3-reduced divisor linearly equivalent to @xmath81 .",
    "by lemma  [ lem : reduced ] , @xmath487 is equivalent to @xmath1472 .",
    "now let @xmath81 be an element of @xmath225 with @xmath1473 .",
    "since @xmath31 and @xmath223 contains all the edge - lengths in @xmath28 , it is easy to see that @xmath81 and @xmath1196 differ by the divisor of a rational function @xmath35 with support in @xmath1474 .",
    "in other words , @xmath1475 in @xmath225 . since @xmath1196 is linearly equivalent to an effective divisor in @xmath225 ( with constant rational function on @xmath1 ) , we conclude that @xmath1476 .",
    "[ cor : f - widthz ] let @xmath202 be the regularization of a strongly semistable curve @xmath34 over @xmath30 .",
    "let @xmath945 be a line bundle on @xmath34 corresponding to a divisor @xmath148 .",
    "then @xmath1477 .",
    "e. katz and d. zureick - brown , _ the chabauty - coleman bound at a prime of bad reduction and clifford bounds for geometric rank functions_. to appear in compositio math .",
    "preprint available at arxiv.org/1204.3335 .          w. mccallum and b. poonen , _ the method of chabauty and coleman _ , june 14 , 2010 .",
    "preprint , http://www-math.mit.edu/~poonen/papers/chabauty.pdf , to appear in panoramas et synthses , socit math .",
    "de france .",
    "g. mikhalkin and i. zharkov , _ tropical curves , their jacobians and theta functions_. contemporary mathematics 465 : proceedings of the international conference on curves and abelian varieties in honor of roy smith s 65th birthday ."
  ],
  "abstract_text": [
    "<S> a _ metrized complex of algebraic curves _ over an algebraically closed field @xmath0 is , roughly speaking , a finite metric graph @xmath1 together with a collection of marked complete nonsingular algebraic curves @xmath2 over @xmath0 , one for each vertex @xmath3 of @xmath1 ; the marked points on @xmath2 are in bijection with the edges of @xmath1 incident to @xmath3 . </S>",
    "<S> we define linear equivalence of divisors and establish a riemann - roch theorem for metrized complexes of curves which combines the classical riemann - roch theorem over @xmath0 with its graph - theoretic and tropical analogues from @xcite , providing a common generalization of all of these results . for a complete nonsingular curve @xmath4 defined over a non - archimedean field @xmath5 , together with a strongly semistable model @xmath6 for @xmath4 over the valuation ring @xmath7 of @xmath5 , </S>",
    "<S> we define a corresponding metrized complex @xmath8 of curves over the residue field @xmath0 of @xmath5 and a canonical specialization map @xmath9 from divisors on @xmath4 to divisors on @xmath8 which preserves degrees and linear equivalence . </S>",
    "<S> we then establish generalizations of the specialization lemma from @xcite and its weighted graph analogue from @xcite , showing that the rank of a divisor can not go down under specialization from @xmath4 to @xmath8 . as an application </S>",
    "<S> , we establish a concrete link between specialization of divisors from curves to metrized complexes and the eisenbud - harris theory @xcite of limit linear series . using this link </S>",
    "<S> , we formulate a generalization of the notion of limit linear series to curves which are not necessarily of compact type and prove , among other things , that any degeneration of a @xmath10 in a regular family of semistable curves is a limit @xmath10 on the special fiber . </S>"
  ]
}