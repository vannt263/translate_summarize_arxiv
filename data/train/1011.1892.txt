{
  "article_text": [
    "content distribution is today at the core of the services provided by the internet . however , distributing content to a large audience is costly with a classical client - server or cdn solution .",
    "this is the reason why content providers start to move to 2p content distribution that enables to significantly reduce their cost without penalizing the experience of users .",
    "one striking example is murder , a extension to update the twitter infrastructure .",
    "however , whereas current 2p content distribution solutions like bittorrent are very efficient , they generate a huge amount of traffic on inter - isp links @xcite .",
    "indeed , in bittorrent , each peer that downloads a given content is connected to a small subset of peers picked at random among all the peers that download that content .",
    "in fact , even though peers in the same isp are downloading the same content they are not necessarily connected to each other . as a consequence ,",
    "peers unnecessarily download most of the content from peers located outside of their isp .",
    "therefore , even if current 2p content replication solutions significantly reduce content provider costs , they can not be promoted as a global solution for content replication as they induce huge costs for isps . in particular , the current trend for isps is to block 2p traffic  @xcite .",
    "one solution to this problem is to use 2p locality .",
    "the goal of 2p locality is to constrain 2p traffic within isps boundaries in order to minimize the amount of inter - isp traffic .    the seminal work of karagiannis et al .",
    "@xcite is the first one to suggest the use of locality in a 2p system in order to reduce the load on inter - isp links .",
    "they show on real traces the potential for locality ( in particular spatial and temporal correlation in the requests for contents ) and , based on simulation on a bittorrent tracker log , they evaluate the benefit of several architectures and in particular a 2p architecture exploiting locality .",
    "more recently , xie et al .",
    "@xcite proposed p4p , an architecture to enable cooperation between 2p applications and isps .",
    "they show by performing large field tests that p4p enables reduction of external traffic for a monitored isp and enables a reduction on the peers download completion time .",
    "choffnes et al .",
    "@xcite proposed ono , a bittorrent extension that leverages on a cdn infrastructure to localize peers in order to group peers that are close to each other .",
    "they show the benefit of ono in terms of peers download completion time and that ono can reduce the number of ip hops and as hops among peers .    with those works",
    ", there is no doubt that 2p locality has some benefits and that there are several ways to implement it .",
    "however , two fundamental questions are left unanswered by those previous works .    _",
    "how far can we push locality ? _ in all proposed solutions the number of inter - isp connections is kept high enough to guarantee a good robustness to partitions , i.e. , a lack of connectivity among set of peers resulting in a poor download completion time .",
    "however , this robustness is at the expense of a larger inter - isp traffic .",
    "how far can we push locality without impacting the robustness to partition of the 2p protocol ?",
    "_ what is , at the scale of the internet , the reduction of traffic that can be achieved with locality ?",
    "_ it might be argued that 2p locality will bring little benefits at the scale of the internet .",
    "indeed , in case most isps have just a few peers , there will be little inter - isp traffic reduction by keeping the traffic local to those isps .",
    "therefore , the question is , what is the distribution of peers per isp in the internet , and what would be the inter - isp bandwidth savings achieved with a locality policy .",
    "previous works looking at inter - isp bandwidth savings either consider indirect measurements ( like the distribution of the number of as between any two peers with a direct connection @xcite ) , partial measurements ( like the monitoring of a specific isp ) , or simulations ( like comparing various content distribution scenarios based on the location of peers obtained from a tracker log ) .",
    "for instance , xie et al .",
    "@xcite reported results on inter - isp savings with p4p for a _ single _ isp .",
    "the answers to those questions will be fundamental when 2p content replication will be used by content providers for large scale distribution .",
    "in that case , it is likely that isps will need to know the amount of inter - isp traffic they can save with locality , and that they will request content providers to minimize this traffic due to 2p applications accordingly .",
    "at the same time , the content providers will need a clear understanding of the impact of this reduction of traffic on their customers .",
    "our contribution in this paper is to answer those questions by running extensive large scale experiments ( with up to @xmath0 real bittorrent clients ) in a controlled environment , and by using real data we crawled in the internet on @xmath1 torrents representing @xmath2 unique peers spread among @xmath3 ases .",
    "our work can be summarized with the two following key contributions .",
    "\\i ) we show that we can push locality much further than what was previously proposed , which enables to reduce by several orders of magnitude the inter - isp traffic and to keep the peers download completion time low .",
    "in particular , we show on experiments including real world data that the reduction of inter - isp traffic and the peers download completion time are not significantly impacted by the torrent size , the number of peers per isp , and the churn .",
    "finally , we propose new strategies to improve the efficiency and robustness of our locality policy on challenging scenarios defined from real world torrents .",
    "\\ii ) we show that at the scale of the @xmath1 torrents we crawled , isps can largely benefit from locality . in particular ,",
    "whereas all the torrents crawled generated @xmath4 petabytes of inter - isp traffic , high locality could have saved up to @xmath5 , i.e. , @xmath6 petabytes , of inter - isp traffic .",
    "this result is significantly different from the inter - isp bandwidth savings reported by xie et al",
    "indeed , they reported a reduction of inter - isp traffic with p4p around @xmath7 , but for a single isp with a single large torrent . thus , they did not evaluate the reduction of traffic at the scale of the internet , but for a single isp .",
    "the result we report is an estimation for @xmath1 real torrents spread among @xmath3 ases , thus capturing the variety of torrent sizes and distribution of peers per as we can find in the internet .",
    "the remaining of this paper is organized as follows .",
    "we define the locality policy we use for our evaluation in section  [ sec : method - locality ] , then we describe our experimental setup , and define metrics in section  [ method ] .",
    "we discuss the impact of the number of inter - isp connections in section  [ locality ] and focus on a small number of inter - isp connections in section  [ small ] . in section",
    "[ sec : real - world - scenarios ] , we present results obtained from a large crawl of torrents in the internet . in section  [ work ] , we discuss the related work . finally , we conclude in section  [ sec : conclusion ] .",
    "in this paper , we make an experimental evaluation of the two questions discussed in the introduction . to do so , we introduce in the following a locality policy that we use to perform our evaluation .",
    "we do not claim our locality policy to be a definitive solution that should be deployed .",
    "instead , it is a simple implementation that we used for our evaluation .",
    "yet , we identified two important strategies that we recommend to consider , even in a modified form , for any implementation of a locality policy .    in the following , we refer to _ policy _ when the tracker does not implement our locality policy , but the regular random policy .",
    "we say that a connection is _ inter - isp _ when two peers in two different isps have established a direct connection , and that it is _ intra - isp _ when the two peers are from the same isp .",
    "the goal of our _ locality policy _ is to limit the number of inter - isp connections , the higher the locality , the smaller the number of inter - isp connections .",
    "we say that an inter - isp connection is _ outgoing _ ( resp .",
    "_ incoming _ ) for an isp if the connection was initiated by a peer inside ( resp . outside ) this isp .",
    "however , once a connection is established it is fully bidirectional .    in order to control the number of inter - isp connections , we assume that the tracker can map each peer to its isp .",
    "how this mapping is performed is orthogonal to our work .",
    "for instance , the tracker can simply map peers to ases using precomputed mapping information obtained from bgp tables @xcite . in case",
    "the as level is not appropriate for isps , the tracker can use more sophisticated information as the one offered by , for instance , the p4p infrastructure @xcite .",
    "the only one parameter of our locality policy is the _ maximum number of outgoing inter - isp connections per isp_. the tracker maintains for each isp the number of peers outside this isp that it returned to peers inside , along with the identity of the peers inside . this way",
    "the tracker maintains a reasonable approximation of the number of outgoing inter - isp connections for each isp .",
    "when a peer @xmath8 asks the tracker for a new list of peers , the tracker will : map this peer to the isp @xmath9 it belongs to ; return to this peer a list of peers inside @xmath9 ; if the maximum number of outgoing inter - isp connections per isp is not yet reached for @xmath9 , return one additional peer @xmath10 outside @xmath9 and increment by one the counter of the number of outgoing connections for @xmath9 .",
    "we also add a randomization factor to distribute the outgoing connections evenly among the peers of each isp , in order to avoid a single point of failure in case the peer receiving those outgoing connections for a given isp decides to leave .",
    "each regular client contacts periodically , typically every @xmath11 minutes , the tracker to return statistics . each time a peer leaves the torrent",
    ", it contacts the tracker so that it can remove this peer from the list of peers in the torrent . in case",
    "the client does not contact the tracker when it leaves ( for instance , due to a crash of the client ) , the tracker will automatically remove the peer after a predefined period of time , typically @xmath12 minutes , after the last connection of the peer to the tracker .",
    "our locality policy uses this information to maintain an up - to - date list of the number of outgoing inter - isp connections per isp .",
    "when the tracker implements our locality policy , it applies the locality policy to all peers except the initial seed .",
    "because the goal of the initial seed is to improve diversity , the tracker selects the neighbors of the initial seed using the policy .",
    "however , we apply the locality policy to all the other seeds , that is all the leechers that become seed during the experiments .",
    "note that the traffic generated by the initial seed is negligible compared to the aggregated traffic of the torrent , when the torrent is large enough .",
    "our locality policy controls the number of outgoing inter - isp connections per isp .",
    "when a peer @xmath8 from the isp @xmath9 opens a new connection to a peer @xmath10 from the isp @xmath13 , the connection is outgoing for @xmath9 , but incoming for @xmath13 .",
    "as both outgoing and incoming connections account for the total number of inter - isp connections , it is important to define a strategy for the selection of peer @xmath10 returned by the tracker to peer @xmath8 .",
    "we define two strategies to select this peer @xmath10 . in the first strategy ,",
    "the default one , @xmath10 is selected at random among all peers outside @xmath9 . while this strategy is straightforward , it has the notable drawback that the largest isps have a higher probability to have a peer selected than other ones .",
    "therefore , large isps will have more incoming connections than small ones .",
    "thus , it is likely that in this case , as connections are bidirectional , the inter - isp traffic will be higher for large isps ( we confirm this intuition in section  [ sec : impact - locality - real ] ) . in the second strategy that we call round robin ( rr ) ,",
    "the tracker selects first the isp with a round robin policy and then selects a peer at random in the selected isp .",
    "this way , the probability to select a peer in a given isp is independent of the size of this isp .    in scenarios with a same number of peers for each isp , both strategies are equivalent .",
    "therefore , as all the experiments in section  [ locality ] and  [ small ] consider a homogeneous number of peers for each isp , we only present the results with the default strategy .",
    "we perform a detailed evaluation of the rr strategy in section  [ sec : real - world - scenarios ] .",
    "one issue with a small number of inter - isp connections is the higher probability to have partitions in the torrent . indeed ,",
    "if peers who have inter - isp connections leave the torrent and no new peer joins the isp , then this isp will form a partition . in order to repair partitions",
    "we introduce an additional strategy called partition merging ( pm ) strategy .",
    "the problem of partition in is not specific to our locality policy , but any locality policy favors its apparition .",
    "the implementation of the partition merging strategy is the following . on the client side , each leecher monitors the pieces received by all its neighbors using the regular have messages .",
    "if during a period of time randomly selected in @xmath14 $ ] , with @xmath15 initialized to @xmath16 , the leecher can not find any piece it needs among all its neighbors ( i.e. , each neighbor has a subset of the pieces of the leecher ) , it recontacts the tracker with a pm flag , which means that the leecher believes there is a partition and that it needs a connection to a new peer outside its isp . in case of large torrents",
    ", there might be an implosion of requests at the tracker .",
    "this issue , known as the _ feedback implosion problem _ in the literature , has been extensively studied and can be solved using several techniques @xcite . however , a detailed description of a feedback implosion mechanism for the pm strategy is beyond the scope of this paper .    on the tracker side ,",
    "the tracker maintains for each isp a flag that indicates whether it answered a request from a peer with the pm flag within the last @xmath17 minutes , i.e. , the tracker returned to a peer of this isp a peer outside .",
    "the tracker will return at most one peer outside each isp every @xmath17 minutes in order to avoid exploiting this strategy to bypass the locality policy .",
    "the detailed evaluation of the impact of the initial values of the timers is beyond the scope of this study .",
    "the choice of the values is a tradeoff between reactivity and erroneous detection of partitions . in this study",
    ", we set @xmath16 and @xmath17 to one minute , and we show that it efficiently detects partitions without significantly increasing the inter - isp traffic .    this strategy might be abused by an attacker . indeed , as the pm strategy detects partitions relying on the accuracy of the have messages sent by neighbors , an attacker might generate dummy have to prevent peers of an isp to detect a partition .",
    "however , this is not an issue in the context of our study , as we work on a controlled environment , without attackers .",
    "in addition , we do nt believe this is a major issue for the following two reasons .",
    "first , an attacker must be a neighbor of all the peers of an isp to attack it .",
    "however , with the locality policy , the attacker must be in the isp it wants to attack , otherwise it has a very low probability to become one of the isp s peers neighbor .",
    "that makes the attack hard to deploy at the scale of a torrent .",
    "second , instead of relying on the monitoring of have messages , a peer can rely on pieces it receives .",
    "for instance , a peer can combine the current pm strategy with the additional criterion that it also generates a pm request to the tracker in case it does not receive any new piece within a @xmath18 minutes interval .",
    "it is beyond the scope of this study to perform a detailed analysis of variations of the pm strategy , which has to be addressed in future work .",
    "as this strategy has no impact on our experiments when there is no partition , we present results in section  [ locality ] and  [ small ] without the pm strategy unless explicitly specified , that is when there is a partition and that the pm strategy changes the result .",
    "we perform a detailed analysis of the pm strategy in section  [ sec : real - world - scenarios ] .",
    "our locality policy is designed to keep traffic local to isps .",
    "however , we are not restricted to isps , and our locality policy can keep traffic local to any network region as long as the tracker is aware of the regions and has a means to map peers to those regions . for instance , a tracker can use information offered by a dedicated infrastructure like the p4p infrastructure @xcite . in particular , when we focus on real world scenarios in section  [ sec : real - world - scenarios ] , we will use ases instead of isps .",
    "in this section , we describe our experimental setup , and the metrics that we consider to evaluate our experiments .      in this paper , we have run large scale experiments to evaluate the impact of our locality policy on inter - isp traffic and download completion time .",
    "we have run experiments instead of simulations for two main reasons .",
    "first , it is hard to run realistic ( packet level discrete ) 2p simulations with more than a few thousand of peers due to the large state generated by each peer and the packets in transit on the links .",
    "moreover , at that scale , simulations are often slower than real time .",
    "second , the dynamics of is subtle and not yet deeply understood .",
    "running simulations with a simplified version of may hide fundamental properties of the system .    in the following ,",
    "we consider experiments with up to @xmath0 peers .",
    "there are two main reasons for the choice of this scale .",
    "first , torrents in the order of @xmath0 peers are considered large torrents .",
    "as one of the important questions we answer in this paper is _",
    "what is , at the scale of the internet , the reduction of traffic that can be achieved with locality ?",
    "_ , we deemed important to experiments with torrents that are considered to be large today .",
    "in particular , large torrents have a unique distribution of peers per as . by running large scale experiments",
    ", we were able to evaluate the impact of realistic peer distribution per as in section  [ sec : real - world - scenarios ] .",
    "second , the maximum peer set size on the most popular clients is between @xmath19 and @xmath20 ( it is @xmath21 in this paper ) .",
    "considering the impact of locality for torrents in the order of a few hundreds of peers would have biased favorably our results .",
    "indeed , a locality policy can be considered as a constraint on the connectivity graph among peers .",
    "considering small torrents with a large peer set would have artificially improved the connectivity among peers .",
    "for this reason large torrents in the order of @xmath0 peers represent a more challenging and convincing scenario .",
    "as we will see during the presentation of our results , we observe behaviors that can only be pointed out using real experiments at large scale , with up to @xmath0 peers .",
    "we now describe the experimentation platform on which we run all our experiments , the bittorrent client that we use in our experiments , and how we simulate an inter - isp topology on top of the platform .",
    "we obtain all our results by running large scale experiments with a real bittorrent client .",
    "we run all our experiments on a dedicated experimentation platform .",
    "a typical node in this platform has bi or quad - core amd opteron cpu , @xmath22 to @xmath23 gb of memory , and a gigabit ethernet connectivity .",
    "the platform we used consists of @xmath24 nodes .",
    "once a set of nodes is reserved , no other experiment can run on parallel on those nodes . in particular , there is no virtualization on those nodes .",
    "therefore , experiments are totally controlled and reproducible .",
    "we use on the nodes a linux kernel 2.6.18 that allows a much larger number of simultaneous opened files or tcp connections than what we use in our experiments .",
    "the bittorrent client used for our experiments is an instrumented version of the mainline client @xcite , which is based on version @xmath25 of the official client @xcite .",
    "this instrumented client can log specific messages received and sent . unless specified otherwise , we use the default parameters of this client .",
    "in particular , each peer uploads at @xmath26kb / s to @xmath23 other peers , and the maximum peer set size is @xmath21 .",
    "we will vary the upload capacity when studying the impact of heterogeneous upload capacities in section  [ locality ] ( see section  [ sec : exper - param - locality ] for a description of our heterogeneous scenario ) .",
    "we also use the choke algorithm in seed state of the official client in its version @xmath25 .",
    "this algorithm is somewhat different , as it is fairer and more robust than the one implemented in most bittorrent clients today .",
    "however , as it only impacts the seed , we do not believe this algorithm to have a significant impact on our results .",
    "our client does not implement a gossiping strategy to discover peers , like peer exchange ( pex ) used in the vuze client .",
    "it is easy to make pex locality aware .",
    "for instance , peer @xmath27 must only send using pex neighbors to peer @xmath28 that are within the same isp as peer @xmath28 .",
    "however , it is beyond the scope of this study to make a detailed discussion of this issue .",
    "we use the following default parameters for our experiments , unless otherwise specified .",
    "peers share a content of @xmath20 mb that is split into pieces of @xmath29 kb . by default ,",
    "all peers including the initial seed start within the first @xmath30 seconds of the experiments . however",
    ", we will also vary this parameter in section  [ sec : evaluation - churn - real ] when studying the impact of churn ( see section  [ sec : evaluation - churn - real ] for a description of our scenario with churn ) .",
    "once a leecher has completed its download , it stays @xmath18 minutes as seed and then leaves the torrent .",
    "we have chosen @xmath18 minutes because it is long enough to give enough time for peers to upload the last pieces they have downloaded before becoming a seed .",
    "however , @xmath18 minutes is short enough to do not artificially increase the capacity of service of the torrent , as @xmath18 minutes is small compared to the optimal download completion time ( @xmath31 minutes ) .",
    "the initial seed stays connected for the entire duration of the experiment .",
    "we run all our experiments with up to @xmath20 bittorrent clients per physical node .",
    "therefore , for torrents with @xmath20 , @xmath32 , and @xmath0 peers , we use respectively @xmath33 , @xmath34 , and @xmath20 nodes for the leechers , plus one node for the seed and the tracker . each client on a same node uses a different port to allow communication among those clients .",
    "we have performed a benchmarking test to find how many clients we can run on a single node without a performance penalty that we identify with a decrease in the client download time for a reference content of @xmath20 mb .",
    "we have found that we can run up to @xmath35 clients uploading at @xmath26kb / s on a single node without performance penalty . to be safe ,",
    "we run no more than @xmath20 clients uploading at @xmath26kb / s on one node , or @xmath22mb / s of bittorrent workload .",
    "when we vary the upload capacity of clients in section  [ locality ] , we will then adapt the number of clients per node so that the aggregated upload capacity per node is never beyond @xmath22mb / s .",
    "we remind that our goal is to evaluate the impact of the number of inter - isp connections on inter - isp traffic and peers performance . therefore , we simulated an inter - isp topology on top of the experimentation platform we use to run our experiments .",
    "we explain , in the following , how we simulated this topology and how representative it is of the real internet .    for all our experiments ,",
    "we assume that we have a set of stub - isps that can communicate among each other . on top of this topology , we consider two scenarios .",
    "the first scenario is when all stub - isps have a single _ peering _ link to each other , thus the topology of the network is a full mesh .",
    "we refer to a peering link as a link for which an isp does not pay for traffic",
    ". however , the peering technology is expensive to upgrade so isps are interested in reducing the load on those links . indeed , the cost to upgrade the capacity of the equipments increases much faster than the capacity .",
    "the second scenario is when each stub - isp is connected with a _ transit _ link to a _",
    "single _ transit - isp .",
    "all peers are in stub - isps .",
    "therefore , there is no traffic with a source or a destination in the transit - isp .",
    "we refer to a transit link as a link on which traffic is billed according to the @xmath36th percentile .",
    "therefore , isps are interested in reducing the bursts of traffic on those links .",
    "we observe that both scenarios are simply a different interpretation of a same experiment , as all peers are in stub - isps and the traffic flows from one stub - isp to another one . in the following , we refer to _ inter - isp link _ when our discussion applies to both peering and transit links .    in our experiments ,",
    "the notion of isps and inter - isp links is virtual , as we run all our experiments on an experimentation platform . to simulate the presence of a peer in a given isp , before each experiment",
    ", we create a static mapping between peers and isps .",
    "we use this mapping to compute offline the traffic that is uploaded on each inter - isp link of the stub - isps .",
    "for instance , imagine that peer @xmath37 is mapped to the isp @xmath27 and peer @xmath38 is mapped to the isp @xmath28 . all the traffic sent from @xmath37 to @xmath38",
    "is considered as traffic uploaded by the isp @xmath27 to the isp @xmath28 with a peering link in the first scenario or with a transit link via the transit isp in the second scenario .",
    "our experiments are equivalent to what we would have obtained in the internet with real isps and inter - isp links except for latency .",
    "rao et al .",
    "@xcite showed that the latency would not significantly change our results because : i ) we limit the upload capacity on each client , thus the rtt is not the limiting factor for the end - to - end throughput ; ii ) the choking algorithm is insensitive to latency by design , as computes the throughput of neighbors ( used to unchoke them ) over a @xmath34 seconds interval , which should alleviate the impact on of the tcp ramp up  @xcite due to latency .",
    "we experiment with and without bottlenecks in the network . by default",
    ", there is no bottleneck in the network because the aggregated traffic generated by our experiments is always significantly lower than the bottleneck capacity of the experimentation platform .",
    "however , we also create artificial bottlenecks on inter - isp links to evaluate their impact on inter - isp traffic and performances ( see section  [ bottleneck ] for the description of how we limit the inter - isp link capacity ) .",
    "it is important to evaluate the impact of bottlenecks on inter - isp links because the choking algorithm selects peers according to their throughput .",
    "therefore , bottlenecks may significantly change bittorrent s behavior .    for each experiment",
    ", there is a single initial seed and we select at random in which isp the initial seed is located .",
    "we decided to focus on the case of a single initial seed because locality is the most challenging when there are a single seed and many leechers . indeed , in that case , inter - isp communications can not be avoided . however , once there are multiple seeds spread in isps , the performance will be higher and the inter - isp traffic will be lower . therefore , whatever the seed distribution per isp is , that will be a more favorable case than the case of a single initial seed we address in that paper .",
    "finally , we have not considered a hierarchy of transit - isps .",
    "we show in section  [ sec : estim - local - benef - real ] that there is a huge amount of inter - isp traffic generated by . even if the proposed locality policy already significantly reduces this traffic , optimizations for the transit - isps still makes sense .",
    "we keep the detailed evaluation of the optimization of the traffic in a hierarchy of transit isps for future work .",
    "to evaluate our experiments , we consider three metrics : the content replication overhead , the @xmath36th percentile , and the peer slowdown .    * overhead * for each stub - isp",
    ", we monitor the number of pieces that are uploaded from this stub - isp to any other stub - isp during the experiment .",
    "then , to obtain the per - isp content replication overhead , we normalize the amount of data uploaded by the size of the content for the experiment .",
    "thus , we obtain the overhead in unit of contents that crosses an inter - isp link .",
    "we call this metric the content replication overhead , or overhead for short , because with the client - server paradigm , isps with clients only would not upload any byte .",
    "we use the overhead as a measure of load on peering links .",
    "* 95th percentile * to obtain the @xmath36th percentile of the overhead , we compute the overhead by periods of @xmath18 minutes and then consider the @xmath18 minutes overhead corresponding to the @xmath36th percentile . the @xmath36th percentile is the most popular charging model used on the internet @xcite .",
    "* slowdown * we define the ideal completion time of a peer as the time for this peer to download the content at a speed equivalent to the average of the maximum upload capacity of all peers .",
    "this is the best completion time , averaged over all peers , that can be achieved in a 2p system in which each peer always uploads at its maximum upload capacity .",
    "the slowdown is the experimental peer download completion time normalized by the ideal completion time .",
    "for instance , imagine that all peers have the same maximum upload capacity of @xmath26kb / s .",
    "an average peer slowdown of @xmath33 for @xmath0 peers means that there is an optimal utilization of the peers upload capacity , or that the peers are , on average , as fast as a client - server scenario in which we have @xmath0 servers , one server per client sending at @xmath26kb / s .    in the following ,",
    "we give the average slowdown per isp .",
    "variability of peers slowdown is inherent to the dynamics , but we do not want this variability ( that is not shown by the average ) to be worse with the locality policy than with the policy .",
    "therefore , we validated for each experiment and each isp that the deviation from the average slowdown for the slowest peers is similar with the locality and policies ( for brevity , we only show this validation for the case of churn , see section  [ sec : evaluation - churn - real ] ) .",
    "thus , the average slowdown per isp is enough to evaluate the impact of the locality policy on peers .",
    "the goal of this section is to explore the relation between the number of inter - isp connections and the overhead and slowdown . in particular",
    ", we will evaluate how far we can push locality ( that is , how much we can reduce the number of inter - isp connections ) to obtain the smallest overhead attainable and what is the impact of this reduction on the slowdown .      for this series of experiments",
    ", we set the torrent size to @xmath32 peers , the number of isps to @xmath34 , and the content size to @xmath20 mb .",
    "therefore , there are @xmath20 peers per isp in all the experiments of the first series .",
    "to analyze the impact of the number of inter - isp connections on , we then vary the number of outgoing inter - isp connections between @xmath23 and @xmath39 by step of @xmath23 , and between @xmath40 and @xmath41 by steps of @xmath40 . as we consider , in this section , scenarios with the same number of peers for each isp , the total number of inter - isp connections per isp will be on average twice the number of outgoing inter - isp connections .",
    "we run experiments for each of the three following scenarios .    *",
    "homogeneous scenario with a slow seed * in this scenario both the initial seed and the leechers can upload at a maximum rate of @xmath26kb / s .",
    "as we have mentioned earlier , we run @xmath20 leechers per node , and we run the initial seed and the tracker on an additional node . according to the definition of locality policy from section  [ sec : defin - local - policy ] , each peer has the same probability to have a connection to the initial seed , whichever isp it belongs to .",
    "for instance , as the initial seed has a peer set of @xmath21 , with @xmath34 isps , each isp has in average @xmath42 peers with a connection to this initial seed .",
    "* heterogeneous scenario * we experiment with leechers with heterogeneous upload capacities and a fast initial seed .",
    "in each isp , one third of the peers uploads at @xmath26kb / s , one third uploads at @xmath19kb / s , and one third uploads at @xmath20kb / s . for simplicity",
    ", we run all the leechers with the same upload capacity on the same node . because we have determined that the hard drives can not sustain a workload higher than @xmath22mb / s , we run only @xmath26 clients per node . for bittorrent to perform optimally , the initial seed uploads at @xmath20kb / s , as fast as the fastest leechers .",
    "each peer has the same probability to have a connection to the initial seed , whichever isp it belongs to .",
    "we experiment with heterogeneous upload capacities for three reasons .",
    "the first reason is that non - local peers may be faster than local ones so the local peers may unchoke inter - isp connections more often than intra - isp connections , thus making the reduction of the number of inter - isp connections inefficient to reduce inter - isp traffic .",
    "the second reason is that local peers may be faster than non - local ones so inter - isp connections may be rarely used to download new pieces , thus degrading performances .",
    "the third reason is that in case of heterogeneous upload capacities inside an isp , if fast peers are those with the inter - isp connections , slower peers may not be given pieces to trade among themselves , also degrading performances .",
    "our main goal is to evaluate the impact of the natural clustering of peers in case of heterogeneous upload capacities @xcite . as legout et al .",
    "@xcite show that the three - class upload capacity scenario is enough to observe clustering among peers , we restrict ourselves to this simple scenario .",
    "we discuss further this issue in section  [ sec : conclusion ] .",
    "* homogeneous scenario with a fast seed * we experiment with leechers that upload at @xmath26kb / s and an initial seed that uploads at @xmath20kb / s .",
    "we run this additional experiment in order to understand whether the results obtained with the heterogeneous scenario are due to the fast initial seed or due to the heterogeneous capacities of leechers .",
    "first , we evaluate the impact of the number of inter - isp connections on overhead and @xmath36th percentile .",
    "then , we evaluate the impact of the number of inter - isp connections on slowdown .",
    "we observe in fig .",
    "[ overhead - locality ] that for the two scenarios with a well provisioned initial seed , i.e. , the homogeneous fast seed and the heterogeneous scenarios , the overhead increases linearly with the number of outgoing inter - isp connections . indeed , when there is no congestion in the network and a uniform repartition of the upload capacity of peers in each isp , the probability to unchoke a peer outside his own isp is linearly dependent on the number neighbors this peer has outside his own isp , thus it is linearly dependent on the number of outgoing inter - isp connections .",
    "we evaluate the impact of network bottlenecks in section  [ bottleneck ] .    the bittorrent arrows in fig .",
    "[ overhead - locality ] and  [ slowdown - locality ] represent the value of respectively overhead and slowdown achieved by bittorrent in the same scenario .",
    "indeed , with @xmath32 peers and @xmath34 isps of @xmath20 peers , each peer has @xmath43 of connections inside his own isp with the policy .",
    "therefore , with each isp will have @xmath44 inter - isp connections , @xmath45 of those connections being outgoing .",
    "thus corresponds to the case with @xmath45 outgoing inter - isp connections in our experiments .",
    "for all three scenarios , our locality policy enables to reduce by up to two orders of magnitude the traffic on inter - isp links .",
    "indeed , we see in fig .",
    "[ overhead - locality ] that for @xmath45 outgoing inter - isp connections , the case of the policy , the overhead is close to @xmath46 , and for @xmath23 outgoing inter - isp connections the overhead is close to @xmath33 for all three scenarios .",
    "surprisingly , we observe in fig .",
    "[ overhead - locality ] that between @xmath40 and @xmath47 outgoing inter - isp connections , there is a higher overhead for the homogeneous scenario with a slow seed than for the two other scenarios with a fast seed . indeed , as there is a lower piece diversity with a slow seed , peers in a given isp will have to use more their inter - isp connections , thus a higher overhead , in order to download pieces that are missing in their own isp .",
    "we do not observe the same issue with a fast seed because this fast initial seed is fast enough to guarantee a high piece diversity even for a small number of outgoing inter - isp connections .",
    "we also observe a linear relation between the number of outgoing inter - isp connections and the @xmath36th percentile as well as a significant reduction of the @xmath36th percentile for a small number of outgoing inter - isp connections in fig .",
    "[ peak - locality ] .",
    "however , we observe that the @xmath36th percentile for the heterogeneous scenario is much larger than for the two other scenarios .",
    "this is because in the heterogeneous scenario there are two third of the peers that are faster than @xmath26 kb / s , which is the upload capacity of all the peers for the two other scenarios .",
    "therefore , we see that even if the total amount of traffic crossing inter - isp links is not significantly impacted by the distribution of the upload capacity of peers ( see fig .",
    "[ overhead - locality ] ) , this distribution might have a major impact on the @xmath36th percentile that is used for charging traffic on transit links .    in summary",
    ", we have shown that a small number of outgoing inter - isp connections leads to a major reduction of the overhead and @xmath36th percentile up to two order of magnitude .",
    "in addition , @xmath23 outgoing inter - isp connections give the minimum attainable overhead of @xmath33 . in the next section ,",
    "we explore what is the impact of such a high reduction on the peers slowdown .          the most striking result we observe in fig .",
    "[ slowdown - locality ] is that , whereas for @xmath23 outgoing inter - isp connections the overhead is optimal ( only one copy of content uploaded per isp ) and reduced by two orders of magnitude compared to the policy , the slowdown remains surprisingly low .",
    "indeed , fig .",
    "[ slowdown - locality ] shows that the number of outgoing inter - isp connections has no significant impact on peers slowdown for the two scenarios with a fast seed ( heterogeneous and homogeneous with a fast seed ) and a negligible impact for more than @xmath48 outgoing inter - isp connections for the homogeneous scenario with a slow seed .",
    "this result is remarkable when one considers the huge saving a small number of outgoing inter - isp connections enables for the overhead and @xmath36th percentile .    for the homogeneous scenario with a slow seed , the slowdown increases by at most @xmath49 for @xmath23 outgoing inter - isp connections compared to the case with the policy .",
    "this increase is due to a poor piece diversity , which can be avoided by having a fast initial seed as shown by the two scenarios with a fast seed in fig .",
    "[ slowdown - locality ] .",
    "moreover , even if a @xmath49 increase is not negligible , it has to be considered as the worst case .",
    "indeed , as we will show in section  [ bottleneck ] , in case of congestion on inter - isp links , the slowdown may even improve with a small number of outgoing inter - isp connections compared to the policy , because that will foster peers to exchange with peers in the same isp , thus avoiding congested paths .    in conclusion",
    ", we see that the peer slowdown remains surprisingly low even for a small number of outgoing inter - isp connections .",
    "we have seen in the previous section that a small number of outgoing inter - isp connections dramatically reduces the overhead and @xmath36th percentile , and that the slowdown remains low in most cases .    whereas this result is encouraging",
    ", one may wonder if it is possible to minimize the overhead while keeping the slowdown low in more complex scenarios .",
    "therefore , we focus in the following on @xmath23 outgoing inter - isp connections , which leads to the lowest attainable overhead in our experiments in section  [ sec : locality - impact - overhead ] , and we evaluate the overhead and slowdown when we vary the characteristics of the torrent ( torrent size and number of peers per isp ) , or the characteristics of the network ( limitation of the capacity of the inter - isp links ) .",
    "we consider for the remainder of this paper the homogeneous scenario with a slow seed . indeed",
    ", we did not observe a significant impact of the heterogeneous upload capacity of the peers on our results in section  [ locality ] .",
    "moreover , it is hard if not impossible to obtain a realistic upload distribution of peers per torrent when one do not control the clients run by peers .",
    "indeed , we know three different methods to measure the upload capacity of a peer . they all suffer from fundamental flaws .",
    "all those flaws come from the fact that the most popular clients limit the number of upload slots and the number of torrents they actively participate to according to the configured upload capacity .",
    "the first method uses the measurement of the have messages , which gives the download speed of peers .",
    "however , the upload and download speeds are not correlated ( clearly the aggregate upload speed must be equal to the aggregate download speed , but we can not conclude on the upload speed distribution ) because the number of upload slots depends on the configured upload capacity in the client , but the number of download slots depends on the neighborhood . therefore ,",
    "measuring the download speed of a peer does not give much information on its upload speed .",
    "the second method consists in downloading data from peers , thus making a direct upload speed measurement .",
    "however , this measurement is for a single upload slot . in the client for instance ,",
    "a peer uploading at @xmath26kb / s to another peer might , in fact , have between @xmath50 to @xmath19 different upload slots , and might participate between @xmath33 to @xmath51 different torrents .",
    "thus , the real upload speed of a peer is much different from what is measured in a single upload slot .",
    "the third method consists in using probing techniques to find the actual physical upload capacity of the peer .",
    "however , as we already discussed , even if the physical upload capacity is an upper bound , the actual upload speed of a peer in a given torrent might be vastly different .    in summary",
    ", for this second series of experiments , we consider a scenario with @xmath23 outgoing inter - isp connections , a content of @xmath20 mb , peers with homogeneous upload capacities , and a slow seed .",
    "then , we vary the torrent size , the number of peers per isp , and the inter - isp link capacity .",
    "we vary only one parameter at a time per experiment .",
    "we consider , in this section , scenarios with the same number of peers per isp .",
    "therefore , on average , the number of incoming inter - isp connections will be equal to the number of outgoing inter - isp connections .    in the following , we do not present results for the @xmath36th percentile , as they do not show any significant new insights compared to the results for the overhead .      in this section ,",
    "we make experiments with torrents with @xmath20 , @xmath32 , and @xmath0 peers , and @xmath34 isps .        in fig .",
    "[ overhead - slow - size ] upper plot , we see that for a small number of outgoing inter - isp connections the overhead is close to one independently of the torrent size , whereas for the policy it increases linearly with the torrent size .    for the torrent with @xmath20 peers ,",
    "as there are 10 isps , there are only 10 peers per isp .",
    "this scenario is interesting because a locality policy only makes sense when there are enough peers inside each isp to be able to keep traffic local .",
    "this scenario shows the gain that can be achieved for a small number of peers per isp . with a torrent of @xmath20 peers",
    ", we save @xmath7 of overhead as compared to bittorrent . with a torrent of @xmath0 peers",
    ", we save @xmath52 of overhead as compared to bittorrent .",
    "to see the impact of this dramatic overhead reduction on slowdown , we focus on fig .",
    "[ overhead - slow - size ] lower plot .",
    "we see that the slowdown is @xmath53 higher than with the policy for a torrent with @xmath20 peers . for @xmath32 and @xmath0 peers ,",
    "the slowdown is @xmath54 higher than with the policy .    in summary , we observe that with @xmath23 outgoing inter - isp connections , the overhead is optimal and almost independent of the torrent size , which is at the cost of an increase by around @xmath55 of the slowdown .      in this section ,",
    "we evaluate @xmath34 , @xmath20 , @xmath32 and @xmath56 peers per isp . to vary the number of peers per isp , we vary the number of isps with a constant torrent size of @xmath0 peers . therefore , to obtain @xmath34 , @xmath20 , @xmath32 and @xmath56 peers per isp , we consider @xmath32 , @xmath20 , @xmath34 , and @xmath22 isps .",
    "we observe in fig .",
    "[ overhead - slow - nr - peers ] lower plot that there are many outliers points for the scenario with @xmath20 peers per isp .",
    "in fact , this scenario is the only one in section  [ small ] that creates partitions .",
    "therefore , we also present the result of this experiment with the partition merging ( pm ) strategy presented in section  [ sec : part - merg - strat ] .",
    "indeed , we see that the pm strategy solves the issue in fig .",
    "[ overhead - slow - nr - peers ] .",
    "we note that the results for all the other experiments remain unchanged with the pm strategy , as they do not create partitions .",
    "a detailed evaluation of the pm strategy is performed in section  [ sec : impact - locality - real ] . in the following ,",
    "we only consider the results obtained with the pm strategy for the scenario with @xmath20 peers per isp .",
    "[ overhead - slow - nr - peers ] upper plot shows that with @xmath23 outgoing inter - isp connections , the overhead remains close to @xmath33 for any number of peers per isp , whereas it increases linearly with the policy . however , this overhead is slightly higher for the scenarios with @xmath34 and @xmath56 peers per isp .",
    "we also observe on fig .",
    "[ overhead - slow - nr - peers ] lower plot that the slowdown is close to the one of for @xmath34 and @xmath56 peers per isp and around @xmath55 higher than the one of for @xmath20 and @xmath32 peers per isp .",
    "this non - monotonic behavior is explained by the tradeoff that involves two main factors impacting the performance of in this scenario . on the one hand ,",
    "as the initial seed has a maximum of @xmath21 connections to other peers , at most @xmath21 isps can have a direct connection to the initial seed .",
    "all isps without direct connection to the initial seed have to get all the pieces of the content from other isps .",
    "therefore , there is a higher utilization of the inter - isp connections and a higher slowdown because the few inter - isp connections available to guarantee a high piece diversity represent a bottleneck . on the other hand ,",
    "when the number of peers per isp decreases , the number of isps increases because the torrent size is constant , thus the global number of inter - isp connections increases .",
    "therefore , the overhead increases too , but the slowdown decreases because there is a sufficient number of inter - isp connections to guarantee a high piece diversity .    in summary",
    ", we observe that with @xmath23 outgoing inter - isp connections , the overhead is optimal and almost independent of the number of peers per isp , which is at the cost of an increase by at most @xmath55 of the slowdown .      to explore the impact of inter - isp link capacity , we consider torrents with @xmath32 peers and @xmath34 isps .",
    "we vary the inter - isp link capacity from @xmath39kb / s to @xmath20kb / s by steps of @xmath26kb / s and from @xmath57kb / s to @xmath47kb / s by steps of @xmath57kb / s . however , local peers can upload to their local neighbors ( in the same isp ) at @xmath26kb / s without crossing a link with limited capacity . for this experiment ,",
    "all the bittorrent clients that run on the same node are located in the same virtual isp , so limiting the upload capacity of the node is equivalent to limiting that inter - isp link capacity .",
    "for an inter - isp link capacity of @xmath47kb / s , all the clients that are located on a same node can upload outside this isp at their full capacity without any congestion .",
    "therefore , it is equivalent to the case with no inter - isp link bottleneck .",
    "we use the tool traffic controller ( tc ) , that is part of the iproute@xmath22 package , to limit the upload capacity of each node on which we run experiments .",
    "we deploy our own image of gnu / linux , on which we have superuser privileges , on all the nodes we want to limit the upload capacity . limiting the upload capacity on each node allows us to reproduce internet s bottlenecks in a controlled environment .",
    "we see in fig .",
    "[ fig : overhead_slow_bottleneck ] upper plot that with @xmath23 outgoing inter - isp connections the overhead remains close to @xmath58 for any inter - isp link capacity .",
    "for the policy , the overhead increases with the inter - isp link capacity .",
    "the reason is that bittorrent , due to the choke algorithm , will prefer to exchange data with local peers when there is congestion on the inter - isp links , because those local peers are not on a congested path , thus a larger download speed . for high inter - isp link capacity , those links are no more congested , therefore the capacity does not impact anymore the overhead achieved by the policy .",
    "we observe in fig .  [",
    "fig : overhead_slow_bottleneck ] lower plot that with congestion on inter - isp links , a small number of outgoing inter - isp connections improves the peers slowdown .",
    "indeed , for an inter - isp link capacity lower than @xmath40 kb / s , the scenario with the policy becomes slower than the scenario with @xmath23 outgoing inter - isp connections .",
    "the benefit of a small number of outgoing inter - isp connections on the slowdown is significant for highly congested inter - isp links . for an inter - isp link capacity of @xmath39kb / s ,",
    "the scenario with with @xmath23 outgoing inter - isp connections is more than @xmath59 faster than with the policy .    in summary ,",
    "the overhead is almost independent of the inter - isp link capacity for @xmath23 outgoing inter - isp connections , whereas it significantly increases with the inter - isp link capacity for the policy .",
    "in addition , when inter - isp links are congested , we observe a lower slowdown with the locality policy than with the policy .",
    "we discuss the impact of this result in the next section .",
    "we have focused on @xmath23 outgoing inter - isp connections and showed that the overhead is close to @xmath33 in most scenarios and almost independent of the torrent size , the number of peers per isp , and the congestion on inter - isp links .",
    "but , most surprisingly , the slowdown remains close to the one of the policy in most cases . in some scenarios ,",
    "the overhead can be around @xmath55 larger than with the policy .",
    "whereas an increase by @xmath55 can not be considered negligible , this is a very positive result for two main reasons .",
    "first , we remind that our main goal in this section was to minimize the overhead .",
    "we achieved up to three orders of magnitude reduction in the overhead compared to the policy ( see fig .",
    "[ overhead - slow - size ] for a torrent with @xmath0 peers ) .",
    "there is a price to pay for such a huge reduction , which is an increase by at most @xmath55 in the slowdown .",
    "we deem this increase to be reasonable considering the savings it enables . however , we have also run experiments with @xmath39 outgoing inter - isp connections that are not shown here for brevity , but that are available in a technical report @xcite .",
    "we found that with @xmath39 outgoing inter - isp connections , the slowdown is always close to the one of at the price of a small increase in the overhead that is close to @xmath34 in most of the cases .",
    "however , even with this increase in the overhead , the savings compared to the policy are still huge , up to two orders of magnitude in our experiments .",
    "second , the increase we report on the slowdown is the worst one that can be achieved .",
    "indeed , all our experiments ( except the ones presented in section  [ bottleneck ] ) are performed without congestion in the network .",
    "however , we have shown in section  [ bottleneck ] that in case of congestion , our locality policy can reduce the slowdown compared to the policy . therefore , on a real network , the slowdown with our locality policy is likely to be equivalent or even better than the one of the policy .",
    "it is important to understand why still performs very well even in case of a small number of inter - isp connections , i.e. , with a high constraint in the connectivity among peers .",
    "we discuss here some avenues worth exploring on the possible reasons for the excellent resilience of to connectivity constraints .",
    "the rarest first piece selection strategy used in is known to guarantee a high piece diversity @xcite .",
    "therefore , in case of a small number of inter - isp connections , the piece selection strategy succeeds to make the best use of the available inter - isp capacity in order to download new pieces within the isps .",
    "once new pieces are downloaded within an isp , they are replicated fast because the connectivity among peers within an isp is good . a simple way to look at",
    "this problem is to consider peers with connections outside their isp as kind of proxies of the initial seed .",
    "those proxies will request the rarest pieces to their neighbors , so they will efficiently download new pieces . then , those proxies will serve those new pieces to peers within their isp , like a seed would do . as each isp has on average four outgoing inter - isp connections , that is four proxies ,",
    "the aggregated capacity of service of those proxies is close to the one of the initial seed . in summary",
    ", the locality policy corresponds to a way to efficiently distribute the capacity of the initial seed in isps while minimizing the inter - isp traffic .",
    "up to now , we have defined scenarios intended to understand the evolution of the overhead and slowdown with a small number of outgoing inter - isp connections when one varies one parameter at a time .",
    "those scenarios are not intended to be realistic , but to shed light on some specific properties achieved with a small number of outgoing inter - isp connections .    in this last series of experiments , we use real world data to build realistic scenarios . in particular",
    ", we will experiment with measured distribution of the number of peers per as for real torrents . in the remaining of this section ,",
    "we focus on inter - ases rather than on inter - isps traffic for two reasons .",
    "first , the information to perform the mapping between ip addresses and ases is publicly available , whereas there is no standard way to map ip addresses or ases to isps .",
    "second , isps may consist of several ases .",
    "there is no way to find where an isp wants to keep traffic local .",
    "indeed , this is most of the time an administrative decision that depends on peering and transit relations among its own ases and the rest of the internet .",
    "however , making the assumption , as we do , that isps want to keep traffic local to ases is reasonable , even if there are some cases in which isps want to define locality at a smaller or larger scale than the as level .",
    "therefore , we believe that our assumption is enough to give a coarse approximation of the potential benefits of a small number of outgoing inter - as connections at the scale of the internet .    in the following , we present the crawler we designed to get real world data",
    ". then we present the results of experiments with real torrent characteristics .",
    "finally , we give an estimation of the savings that would have been achieved using our locality policy on all the torrents we crawled .      in order to get real world data , on the @xmath60 of december 2008",
    ", we have collected @xmath61 torrent files on _ www.mininova.com _ that is considered one of the largest index of torrent files in the internet .",
    "all those torrent files were collected during a period of six hours . out of these @xmath61 torrent files , we have removed duplicate ones ( around @xmath62 of the files ) and all files for torrents that do not have at least @xmath33 seed and @xmath33 leecher .",
    "our final set of torrent files consists of @xmath1 files .",
    "we have implemented an efficient crawler that takes as input our set of torrent files and that gives as output the list of the peers in each of the torrents represented by those files .",
    "we identify a peer by the couple _",
    "( ip , port ) _ where _ ip _ is the ip address of the peer and _ port _ is the port number on which the client of this peer is listening .",
    "our crawler , which consists of two main tasks , runs on a single server ( intel core2 cpu , 4 gb of ram ) .",
    "the first task takes each torrent file sequentially .",
    "it connects first to the tracker requesting @xmath32 peers in order to receive the largest number of peers the tracker can return .",
    "indeed , the tracker returns a number of peers that is the minimum between the number of peers requested and a predefined number .",
    "the tracker returns a list of @xmath63 peers , @xmath63 usually ranging from @xmath19 to @xmath57 .",
    "the tracker also returns the current number of peers in the torrent .",
    "then , the task computes how many independent requests @xmath64 must be performed in order to retrieve at least @xmath65 of the peers in the torrent when each request results is @xmath63 peers retrieved at random from the tracker .",
    "the second task starts a round of @xmath64 parallel instances of a dummy client , each client started on a different port number , whose only one goal is to get a list of peers from the tracker .",
    "once a round is completed , the task removes all duplicates _ ( ip , port ) _ , makes sure that indeed @xmath65 of the peers of the torrent were retrieved , and saves the list of couples _ ( ip , port)_. in case , less than @xmath65 of the peers were discovered during the first round , an additional round is performed",
    ". the second task can start many parallel instances of the dummy client for different torrents at the same time .",
    "as the task of the dummy client is simple , we can run several thousands of those clients at the same time on a single machine .    at the end of this second task we crawled @xmath1 torrents within 12 hours",
    ", the largest torrents being crawled in just a few seconds , and we identified @xmath2 unique peers .    finally , we map each of the unique collected peers to the as it belongs to using bgp information collected by the routeviews project @xcite .",
    "we found that the unique peers are spread among @xmath3 ases .",
    "even if this way to perform the mapping may suffer from inaccuracy @xcite @xcite , it is appropriate for our purpose .",
    "indeed , we do not need to discover as relationship or routing information , we just need to find to which as each peer belongs to .",
    "even if some mappings are inaccurate , they will not significantly impact our results , as we consider the global distribution of peers among all ases .",
    "[ btlocal_n_peers ] shows the distribution of peers for all torrents per as .",
    "we observe that most ases have few peers .",
    "this simple but highly efficient crawler enables to capture a representative snapshot , at the scale of the internet , of the peers using to share contents the day of our crawl .",
    "there are , however , two limitations to our crawler .",
    "first , we only crawled torrents collected on mininova .",
    "even if mininova is one of the largest repository for torrent files , it contains few asian torrents .",
    "therefore , that means that our results present a lower bound of the benefit that can be achieved with high locality . indeed , asian torrents are usually large and , due to the geographical locality inherent to such torrents , spread among fewer ases than an average torrent . therefore , asian torrents have a larger potential for locality than other torrents .",
    "second , we are aware that a fraction of the peers advertised by trackers are fake peers .",
    "indeed , copyright holders ( or representative ) join torrents to monitor peers in order to issue dmca takedown notices to downloaders @xcite .",
    "also tracker operators may add fake peers in order pollute the information gathered by copyright holders .",
    "finally , some peers are identified as deviant , which means that they do not look like regular peers @xcite . however , even if the amount of fake peers accounts for a few percents of the overall peers , considering the large amount of torrents and peers crawled , we do not believe those fake peers to significantly bias our results .      in section  [ small ] , we performed experiments with a homogeneous number of peers per as .",
    "however , real torrents have an heterogeneous number of peers per as , which may adversely impact the overhead reduction we observed with a small number of outgoing inter - isp connections .    in order to evaluate the impact of a real distribution of peers per as on our experiments , we selected three different torrents from our crawl with different characteristics .",
    "we call those three torrents the _ reference torrents_. the first torrent , that we call _ torrent 1 _ , is a torrent for a popular movie in english language",
    ". this torrent represents the case of torrents with a worldwide interest .",
    "it has @xmath66 peers spread among @xmath67 ases , the largest as consisting of @xmath68 peers .",
    "the second torrent , called _ torrent 2 _ , is a torrent for a movie in italian language .",
    "this torrent has @xmath69 peers spread among @xmath70 ases , the largest as consisting of @xmath71 peers .",
    "this torrent is typical of torrent with local interest . in particular",
    ", this torrent spans less ases than _ torrent 1 _ , and the largest as , belonging to the largest italian isp , represents more than half of the peers of the torrent .",
    "the last torrent , called _ torrent 3 _ , is a torrent for a game .",
    "it has @xmath72 peers spread among @xmath73 ases , the largest as consisting of @xmath74 peers .",
    "this torrent is used to evaluate middle sized torrents with few potential savings with a locality policy , as there are few peers per as .",
    "we have run experiments with the same parameters as the ones of the homogeneous scenario described in section  [ sec : exper - param - locality ] .",
    "in particular , we have the initial seed and all leechers that upload at a maximum rate of 20kb / s , and a content of @xmath20 mb .",
    "however , we consider scenarios with the same number of ases and peers per as as the three real torrents considered . in the following , we focus on experiments performed with the characteristics of _ torrent 1 _ , as the experiments with the characteristics of the two other torrents lead to the same conclusions .",
    "we also validated that the exact location of the initial seed ( that is selected at random ) does not significantly impact our results .",
    "therefore , we present the results for a single run for _ torrent 1_.            fig .",
    "[ sig_noverhead ] shows the overhead per as , ordered by number of peers , for _ torrent 1_. as expected , the overhead increases linearly with the number of peers per as for the policy ( squares ) .",
    "we observe that the overhead for the scenario with @xmath23 outgoing inter - as connections is one order of magnitude lower than the one of for the largest ases .",
    "however , the overhead is still large for the largest ases .",
    "in fact , due to the heterogeneity in the number of peers per as , as explained in section  [ sec : round - robin - strategy ] , the largest as will have more incoming inter - as connections than small ones . therefore , large ases will have a larger number of inter - as connections , thus a larger overhead than small ases .",
    "the solution to this problem is to use the round robin ( rr ) strategy introduced in section  [ sec : round - robin - strategy ] .",
    "indeed , fig .",
    "[ sig_noverhead ] shows that the overhead is significantly reduced with the rr strategy ( cross ) for large ases without penalizing small ases .",
    "however , we see in fig .",
    "[ sig_nslowdown ] that the slowdown for the largest ases increases significantly compared to the other scenarios . indeed , as the rr strategy spreads uniformly the incoming inter - as connections on all ases , each as will have on average @xmath42 inter - as connections in total ( @xmath23 outgoing and @xmath23 incoming ) .",
    "therefore , for the largest ases , only few peers will have an inter - as connection .",
    "once those peers leave the torrent after their completion , the largest as will become partitioned with a large number of peers waiting for new pieces from the initial seed .",
    "thus , a larger slowdown .    to solve this issue",
    ", we made experiments with the partition merging ( pm ) strategy that is supposed to repair partitions quickly ( see section  [ sec : part - merg - strat ] ) .",
    "indeed , we see in fig .",
    "[ sig_nslowdown ] that the scenario with @xmath23 inter - as outgoing connections and the pm+rr strategies ( plus ) gives the best slowdown over all the scenario using a locality policy , close to the one of the policy .",
    "this significant improvement is at the cost of a small increase in the overhead , see fig .",
    "[ sig_noverhead ] ( plus ) , but the overhead remains up to two orders of magnitude lower than with the policy .    to show that the pm strategy does not impact our results when there is no partition , we consider a scenario with @xmath23 outgoing inter - as connections and the pm strategy only .",
    "we see in fig .",
    "[ sig_noverhead ] that the overhead of this scenario ( triangle ) is almost indistinguishable from the scenario without the pm strategy ( circle ) .",
    "we observe in fig .",
    "[ sig_nslowdown ] that the slowdown for both scenarios is also indistinguishable .",
    "therefore , the pm strategy does not bias our results by artificially increasing the number of inter - as connections .    in summary ,",
    "the pm+rr strategies solve issues with real torrents and enable huge overhead reduction and a low slowdown .",
    "in this section , we run all our experiments with the characteristics of _ torrent 1_. in particular , we consider scenarios with the same number of ases and peers per as as _",
    "torrent 1_. to evaluate the impact of churn , we start a first set of @xmath66 peers using a uniform random distribution within the first @xmath30 seconds in a first experiment , and within the first @xmath75 seconds in a second experiment . then , when each of those peers completes its download , we start a new peer from a second set of @xmath66 peers . hence , we model the three phases of a real torrent s life : flashcrowd , steady phase , and end phase @xcite .",
    "the first phase , the flashcrowd , occurs while all peers of the first set join the torrent .",
    "the second phase , the steady phase , occurs when the number of peers in the torrent remains constant .",
    "this is when peers in the first set start to complete and that peers in the second set are started to replace those peers in order to keep the torrent size constant to @xmath66 peers .",
    "the last phase , the end phase , occurs at the end of the torrent s life , when the last peers complete their download and no new peer joins the torrent .",
    "this is when there is no more peers in the second set to compensate departure of peers .",
    "large torrents , like _ torrent 1 _ , represent the most challenging scenario in case of churn . indeed , small torrents will have just one to a few peers per as . therefore , as most connections among peers will be inter - as , the locality policy will not significantly constrain the peers connectivity graph . consequently , this graph will be random , unlike with a large torrent whose graph is clustered per as , thus a better robustness to as isolation in case of churn .",
    "we see in fig .",
    "[ fig : sig_churnreference ] left plot that the maximum overhead is reduced by one order of magnitude with @xmath23 outgoing inter - as connections compared to the policy .",
    "moreover , the locality policy does not significantly degrade the average and maximum slowdown and even improves the minimum slowdown as shown by fig .",
    "[ fig : sig_churnreference ] right plot .    in summary ,",
    "even with churn the overhead is reduced and the slowdown remains low independently of the churn period with @xmath23 outgoing inter - as connections .",
    "we have also run many other experiments with churn , not shown for brevity .",
    "we considered : i ) churn on a 600s window with real distributions of peers per as ; ii ) churn on 60s , 600s , and 6000s windows with a homogeneous distribution of peers per as with @xmath0 peers and @xmath34 or @xmath32 ases @xcite .",
    "all those additional experiments confirm our conclusion .",
    "finally , addressing more complex churn scenarios , e.g. , considering non uniform arrival pattern of peers , is an interesting subject that will be best evaluated using a real deployment .",
    "therefore , we keep this problem for future work .      in this section , we want to estimate the benefits our locality policy would have had on the torrents we crawled . in our crawl , @xmath76 torrents and @xmath77 ases can not benefit from a locality policy , because there is at most one peer per as per torrent .",
    "however , we want to show that despite most of the torrents and ases can not benefit from a locality policy , the implementation of a locality policy at the scale of the internet would be highly beneficial .    in order to make the estimation of the benefits of our locality policy , we make two assumptions .",
    "first , we estimate the inter - as traffic in all the torrents we crawled by assuming that all the peers we found start downloading the content at the same time and stay connected to the torrent for the entire duration of their download .",
    "indeed , we have not captured temporal information , which means that we do not know how long each peer stayed in each torrent . however , it is hard to know if we underestimate or overestimate the potential for locality of those peers . indeed , for torrents in a flash crowd phase , most peers are leechers and the population increases with time .",
    "for those torrents , we are likely to underestimate the benefits of our locality policy . for torrents in an end phase ,",
    "most peers are seeds and the population is decreasing , therefore , it is likely that we overestimate the benefits of our locality policy .",
    "we believe our assumption to be reasonable and to provide , on average , at least a coarse estimation of the inter - as traffic generated by all the peers we crawled .",
    "second , we assume that peers have the same probability to exchange data with any peer in its peer set . therefore , we assume that peers have the same upload capacity and that there is no network bottleneck that bias the peer selection with the choke algorithm . here again , it is hard to assess the exact impact of this assumption on the accuracy of our results , but we believe that , considering the large number of torrents we crawled , our estimation of the inter - as traffic is reasonable .",
    "we have explored , in section  [ locality ] , a scenario with three classes of upload capacity spread uniformly over all peers .",
    "we have shown that the results obtained for this scenario do not significantly differ from a homogeneous scenario .",
    "however , we did not explore scenarios with realistic peers upload capacity distribution .",
    "in fact , it is hard , if not impossible , to obtain this information at the scale of the internet ( see section  [ small ] ) .",
    "the clustering of peers observed by legout et al .",
    "@xcite shows that when peers in a given isp have similar upload capacity , they will automatically keep the traffic local , because they will cluster together .",
    "however , it is unlikely , due to the distribution of peers within a large number of isps , that the tracker will return many peers within a same isp when there is no locality policy . therefore , even in that case",
    ", it is unlikely that the traffic matrix will be much different from the one for which we assume the same upload capacity for all peers . in the case",
    "peers have heterogeneous upload capacities within isps , we can assume that connections among isps will be performed at random , as when there is no assumption on the peers upload capacity .    moreover , the clustering observed by legout et al .",
    "@xcite appears only when there is high piece diversity .",
    "as soon as piece diversity becomes lower , there is no more clustering even if the efficiency of bittorrent is preserved .",
    "this is this kind of phenomenon we observe with locality . indeed , even if upload distribution is supposed to foster communications among peers with the same upload capacity , this is by no mean an absolute constraint because , as soon as piece diversity decreases , clusters among peers are broken and any peer can communicate with any other peer @xcite .    in summary , we believe that our findings will not be fundamentally different by taking into account peers upload capacity .        in order to estimate the benefits of our locality policy , we first estimate the inter - as traffic generated with the policy , then we estimate the overhead savings enabled by our locality policy .    to estimate the inter - as traffic generated by the torrents we assume that the probability that a peer in a given as will upload data to a peer in another as is only a function of the number of inter - as connections of the ases and that there is no congestion on inter - as links .",
    "in particular , for a torrent of size @xmath78 , an as @xmath27 of size @xmath79 , and a content of size @xmath80 , the inter - as traffic uploaded from @xmath27 is @xmath81 .",
    "while this model is simple , we see in fig .",
    "[ fig : sig_savings ] upper plot that it matches well the inter - as traffic uploaded from each as that we measured for the three reference torrents .",
    "then , for each as and each torrent , we compute using the simple model the inter - as traffic .",
    "to estimate the inter - as traffic generated by the torrents we crawled with the locality policy with pm+rr , we use the overhead savings we obtained with experiments with the three reference torrents .",
    "indeed , we see in fig .  [",
    "fig : sig_savings ] lower plot , that the overhead savings of our locality policy with pm+rr compared to the policy depends on the number of peers per as , but not on the torrent size .",
    "therefore , we use the average overhead savings computed on the three reference torrents for each as size to compute the reduction of inter - as traffic .",
    "we also made the same experiments without the pm+rr strategy to estimate the inter - as traffic with our locality policy without those strategies , and we observed that the savings depend on the number of peers per as , as well .",
    "[ fig : sig_savings ] lower plot shows that even with a small number of peers per as , the overhead savings are already high .",
    "for instance , with @xmath18 peers per as , the overhead with our locality policy is @xmath5 lower than the one with the policy .",
    "now , we focus on the impact of those savings at the scale of all the torrents we crawled . we see in fig .  [",
    "fig : sig_traffic ] upper plot the cumulative inter - as traffic for each torrent we crawled . the @xmath20 ( resp .",
    "@xmath0 ) largest torrents generate @xmath82 ( resp .",
    "@xmath83 ) of the inter - as traffic .",
    "the ideal policy corresponds to the inter - as traffic generated when only one copy of the content is uploaded per as and per torrent .",
    "we see that the cumulative inter - as traffic with the policy is @xmath4 petabytes , and that with @xmath23 outgoing inter - as connections it is @xmath84 petabytes ( and @xmath85 petabytes with the pm+rr strategies ) , which is only @xmath86 larger ( @xmath87 with pm+rr ) than what the ideal policy achieves .",
    "therefore , our locality policy enables a significant reduction of the inter - as traffic at the scale of the internet .",
    "the @xmath19 ( resp .",
    "@xmath88 ) largest ases represent @xmath89 ( resp .",
    "@xmath90 ) of the total inter - as traffic .",
    "interestingly , we see in fig .  [",
    "fig : sig_traffic ] lower plot , that the ases with the largest inter - as traffic are also the ones that benefit from the most significant inter - as traffic reduction with our locality policy .",
    "we checked manually the @xmath19 largest ases to make sure that they do not belong to copyright holders ( or piracy tracking companies ) to be sure that most of the peers in those ases are real peers @xcite .    in summary ,",
    "a high locality policy can reduce by up to @xmath5 the inter - as traffic for the @xmath1 real torrents we crawled spread across @xmath3 ases .",
    "karagiannis et al .",
    "@xcite first introduced the notion of locality in the context of 2p content replication .",
    "they show monitoring the access link of an edge network and running simulations using a log collected from a tracker for a single torrent @xcite that peer - assisted locality distribution is an efficient solution for both the isps and the end - users .",
    "p4p @xcite is a project whose aim is to provide a light - weight infrastructure to allow cooperation between 2p applications and isps .",
    "xie et al .",
    "presented small scale experiments ( with between @xmath91 and @xmath92 planetlab nodes ) on two specific scenarios .",
    "they also reported on a field test experiment around @xmath7 of inter - isp traffic savings with p4p for a single isp and a single large torrent .",
    "aggarwal et al .",
    "@xcite present an architecture that is similar by some aspects to p4p .",
    "the authors define the notion of _ oracle _ that are supplied by isps in order to propose a list of neighbors to peers .",
    "they perform their evaluation on gnutella using simulations and small scale experiments with 45 gnutella nodes .",
    "another approach that requires no dedicated infrastructure is ono @xcite .",
    "ono clusters users based on the assumption that clients redirected to a same cdn server are close .",
    "the authors have developed an ono plugin for the vuze client .",
    "the authors reported measurement results collected from @xmath93 users of the ono plugin over a @xmath34 month period .",
    "they reported up to @xmath94 performance increase in average peer download completion time .",
    "however , the authors did not give an explicit inter - isp traffic reduction , but showed a reduction of the path length between peers in terms of ip and as hops .",
    "bindal et al .",
    "@xcite present the impact of a deterministic locality policy on isps peering links load and on end - users experience .",
    "the authors considered simulations on a scenario with @xmath95 isps with @xmath19 peers each , thus a torrent of @xmath96 peers .",
    "lin et al .",
    "@xcite introduce elp that aims to keep traffic local to isps .",
    "they provide a model that gives bounds on the inter - isp traffic , and they validate elp experimentally on planetlab with a maximum of 60 peers .",
    "in contrast to previous works like p4p @xcite and ono @xcite that provide very valuable results focusing on in the wild measurements or deployments , our work fills a gap by providing a systematic and rigorous evaluation of by doing controlled experiments .",
    "indeed , our work significantly differs from those previous ones , by being the first one to extensively evaluate the impact of key parameters like the number of inter - isp connections , the torrent size , the distribution of peers per isp , the inter - isp bottlenecks , the churn rate , and the peers upload capacity using large scale experiments and real world data .",
    "in particular , we considered @xmath1 real torrents spread across @xmath3 ases ( it was a single large torrent and a single as for the p4p field test @xcite ) and showed that using only four inter - isp connections ( it was @xmath97 of inter - isp connections for the p4p field tests ) we could reduce the inter - isp traffic at the scale of the internet by up to @xmath5 .",
    "piatek et al .",
    "@xcite discuss pitfalls for an isp - friendly locality policy and isps traffic engineering constraints . in particular , piatek et al .",
    "discuss three main issues : client side only localization might not work , localization might adversely impact robustness and efficiency , isps have conflicting interests .",
    "the two first issues do not apply to our work as we consider a tracker based locality policy , and as we have designed and evaluated the partition merging strategy to prevent robustness issues . concerning the last issue on isps conflicting interests , it is beyond the scope of this study to evaluate the economical benefit for tier-1 isps to keep traffic local .",
    "our work shows that if isps want to apply a locality policy to traffic , it is doable and it will significantly reduce the traffic on inter - isp links .",
    "cuevas et al .",
    "@xcite is by several aspects close to our work .",
    "indeed , the authors also collected a large trace and explored the impact of high locality .",
    "however , their work significantly differs by other aspects .",
    "the core of their evaluation study is a mathematical model , whereas we performed extensive large scale experiments .",
    "they specifically focused on peers upload distribution , whereas we focused on the systematic evaluation of fundamental parameters like torrent size , or inter - isp bottlenecks .",
    "finally , they do not explore the second question of this work _ what is , at the scale of the internet , the reduction of traffic that can be achieved with locality ? _ in summary , our work is complementary to the one of cuevas et al .",
    ", as it validates some of the assumptions they made in the modeling of bittorrent locality , in particular the good piece diversity with locality , which is fundamental to observe stratification in their model .",
    "our work is intended to be complimentary to previous works @xcite by answering the two fundamental questions : how far can we push locality ?",
    "what is at the scale of the internet the reduction of inter - isp traffic that can be achieved with locality ?    in this paper , we have performed an extensive evaluation of the impact of a small number of inter - isp connections on overhead and slowdown .",
    "we have run experiments with up to @xmath0 real clients in a variety of scenarios , including scenarios based on real data crawled from @xmath1 torrents representing @xmath2 unique peers spread among @xmath3 ases .",
    "our main findings are that a small number of inter - isp connections will dramatically reduce the overhead and keep the slowdown low independently of the torrent size , the number of peers per isp , the upload capacity of peers , or the churn .",
    "we have introduced two new strategies called round robin and partition merging that make the use of a small number of inter - isp connections feasible for real torrents of the internet .    however",
    ", we do not advocate for such small number of inter - isp connections in real deployments .",
    "indeed , selecting a very small number of inter - isp connections is a design choice . for client companies ,",
    "it is not an option to increase the peers slowdown , even by just a few percents , in order to further reduce the load on inter - isp links , because it will lead to a decrease in the number of users of this client .",
    "conversely , content providers , might want to optimize the inter - isp traffic in order to convince isps to do not block their traffic .    in this work",
    ", we intend to increase confidence in locality by showing that even in case of high locality still performs extremely well , and that with high locality the inter - isp traffic reduction can be up to @xmath5 on the torrents we crawled , which is @xmath6 petabytes of data .",
    "we want to thank thierry turletti , giovanni neglia , anwar al - hamra , thrasyvoulos spyropoulos for helpful feedback .",
    "experiments presented in this paper were carried out using the grid5000 experimental testbed , an initiative from the french ministry of research through the aci grid incentive action , inria , cnrs and renater and other contributing partners ( see https:// www.grid5000.fr ) .",
    "24 natexlab#1#1[2]#2 , , , , in : , .",
    ", , , , , in : , .",
    ", , , , , , in : , .",
    ", , , in : , . , , .",
    ", , , ( ) . , . . ,",
    ", , , , in : , ( eds . ) , , . , , in : , . , , ( ) . , , , , , in : , . , , , , , inria sophia antipolis , france , .",
    ", , , , in : , .",
    ", , , , , , in : , . , , , ( ) .",
    ", , , , in : , . , , , , in : , .",
    ", , , , , , , in : . , , , , ( ) . , , , , , , , , in : , .",
    ", , , , ( ) . , , , , , , in : , .",
    ", , , , , , ( ) ."
  ],
  "abstract_text": [
    "<S> peer - to - peer ( p2p ) locality has recently raised a lot of interest in the community . </S>",
    "<S> indeed , whereas p2p content distribution enables financial savings for the content providers , it dramatically increases the traffic on inter - isp links .    to solve this issue , the idea to keep a fraction of the p2p traffic local to each isp </S>",
    "<S> was introduced a few years ago . since then </S>",
    "<S> , p2p solutions exploiting locality have been introduced . </S>",
    "<S> however , several fundamental issues on locality still need to be explored . </S>",
    "<S> in particular , how far can we push locality , and what is , at the scale of the internet , the reduction of traffic that can be achieved with locality ?    in this paper , we perform extensive experiments on a controlled environment with up to @xmath0 bittorrent clients to evaluate the impact of high locality on inter - isp links traffic and peers download completion time .    </S>",
    "<S> we introduce two simple mechanisms that make high locality possible in challenging scenarios and we show that we save up to several orders of magnitude inter - isp traffic compared to traditional locality without adversely impacting peers download completion time . </S>",
    "<S> in addition , we crawled @xmath1 torrents representing @xmath2 unique peers spread among @xmath3 ases . </S>",
    "<S> we show that whereas the torrents we crawled generated @xmath4 petabytes of inter - isp traffic , our locality policy implemented for all torrents could have reduced the global inter - isp traffic by up to @xmath5 .    </S>",
    "<S> bittorrent , locality , experiments , measurements </S>"
  ]
}