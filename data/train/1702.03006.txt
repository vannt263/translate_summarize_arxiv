{
  "article_text": [
    "off - policy learning constitutes an important class of reinforcement learning problems , where the goal is to learn about a designated target policy while behaving according to a different policy . in recent years",
    ", off - policy learning has garnered a substantial amount of attention in policy evaluation tasks . when safety and data frugality is paramount , the ability to evaluate a policy without actually following it can be invaluable ( cf . ) .",
    "learning a large number of off - policy predictions is also considered important for model learning , options learning ( ) , scalable life - long learning ( ) , and knowledge representation ( ) .",
    "a number of computationally scalable algorithms have been proposed that can learn off - policy without requiring to access or estimate the model of the environment and in that sense are _ model - free _ ( , , , , , , , , , , , , ) .",
    "a core component of these algorithms is a classical monte carlo technique called importance sampling ( , ) , where samples are scaled by the likelihood ratio of the two policies , also known as the _ importance sampling _ , so that they appear to be drawn from the target policy .",
    "although importance sampling plays a key role in correcting the discrepancy between the policies , the highly varying nature of importance sampling ratios often results in large estimation variance ( , , , , ) . some off - policy algorithms avoid importance sampling using a model of the environment or combine model - based estimation with importance sampling based estimation . due to performing model estimation in addition to value function estimation",
    ", these algorithms tend to be computationally more complex ( , , , , , ) .",
    "multi - step learning is one of the most important components of modern temporal - difference learning algorithms . through multi - step learning",
    ", temporal - difference learning algorithms can vary smoothly across a large spectrum of algorithms , including both one - step and monte carlo methods .",
    "the influence of multi - step learning is the greatest when parametric function approximation is used . in this case",
    ", solutions produced by multi - step learning can be much superior to those produced by one - step learning ( ) .",
    "unfortunately , the problem of large variance with importance sampling is also the most severe in multi - step learning ( , ) .",
    "consequently , multi - step off - policy learning remains problematic and largely unfulfilled .",
    "an obvious approach to solve the problem of multi - step off - policy learning would then be to develop an algorithm that avoids using importance sampling ratios .",
    "the absence of these ratios will presumably reduce the estimation variance , making long - term multi - step learning tenable .",
    "only a few model - free algorithms have been proposed to learn off - policy without using importance sampling ratios ( , , ) .",
    "however , all these algorithms were introduced either for one - step learning ( ) or for learning with lookup table representation ( , ) , that is , without using parametric function approximation .",
    "multi - step learning does not have a lasting influence on performance in this case .",
    "our key contribution is to develop an algorithmic technique based on modulating the amount to which the estimates of the subsequent states are used , a concept known as _ bootstrapping _",
    ", in an action - dependent manner .",
    "it results in an action - dependent bootstrapping parameter , which is a generalization of the state - dependent bootstrapping parameter used in prior works ( , ) . for action - value estimation , we show that importance sampling ratios can be eliminated by varying the action - dependent bootstrapping parameter for different state - action pairs in a particular way . using this technique , we introduce a new algorithm called _ abq _ that can achieve much less estimation variance compared to the state - of - the - art off - policy algorithm .",
    "abq is the first to effectively achieve multi - step function approximation solutions for off - policy learning without explicitly using importance sampling ratios",
    ". a prior algorithm , tree backup ( ) , can be retrieved as a special case of our algorithm .",
    "furthermore , we show that off - policy algorithm , retrace ( ) , can also be derived and extended to the case of function approximation with stability using the action - dependent bootstrapping technique .",
    "in this section , we formulate the problem of multi - step off - policy learning with parametric function approximation and establish notations . consider an agent in a dynamical environment with a finite state space @xmath0 and action space @xmath1 . at each time",
    "@xmath2 , if the present state is @xmath3 and the agent takes action @xmath4 , then the next state @xmath5 is @xmath6 with probability @xmath7 , and the agent receives a random reward @xmath8 with mean @xmath9 and finite variance upon the state transition .",
    "a randomized stationary policy @xmath10 specifies the probability @xmath11 of taking action @xmath12 at state @xmath13 . of our interest is a given policy @xmath10 , referred to as the target policy , and the performance of the agent if it follows @xmath10 .",
    "specifically , our interest in this paper is to estimate the action - value function of @xmath10 , defined as the expected sum of discounted rewards for any initial state - action pair @xmath14 : @xmath15 where @xmath16 is a discount factor , and @xmath17 signifies that all subsequent actions follow    in off - policy learning , the goal is to estimate @xmath18 from the observations @xmath19 obtained by the agent while it follows a ( stationary randomized ) policy @xmath20 .",
    "we call @xmath21 the behavior policy .",
    "( the case @xmath22 is the on - policy case . )",
    "we shall assume that @xmath21 induces an irreducible markov chain on the state - action space , whose unique invariant distribution we denote by @xmath23 .",
    "important to multi - step learning are multi - step bellman equations satisfied by the action - value function @xmath18 .",
    "we review here such equations for the well - known td(@xmath24 ) , where @xmath25 $ ] is the bootstrapping parameter .",
    "let @xmath26 be the transition probability matrix of the markov chain on @xmath27 induced by the target policy @xmath10 , and let @xmath28 be the vector of expected rewards for different state - action pairs : @xmath29_{sa } \\deq r(s , a)$ ]",
    ". for @xmath25 $ ] , define the multi - step bellman operator @xmath30 by @xmath31 for all @xmath32 , where @xmath33 is the identity matrix .",
    "then @xmath18 satisfies the multi - step bellman equation @xmath34 , where @xmath35 stands for the action - value function in vector notation .",
    "we approximate the action - value function as a linear function of some given features of state - action pairs : @xmath36 , where @xmath37 is the parameter vector to be estimated and @xmath38 is the feature vector for state @xmath13 and action @xmath12 . in matrix notation",
    "we write this approximation as @xmath39 , where @xmath40 is the feature matrix with the rows being the feature vectors for different state - action pairs : @xmath41_{sa , : } = \\x(s , a)\\tr$ ] .",
    "the multi - step solution to the off - policy learning problem with function approximation can be found by solving the fixed point equation : @xmath42 ( when it has a solution ) , where @xmath43 is the projection matrix with @xmath44 being a diagonal matrix with diagonal elements @xmath45 .",
    "the mean squared projected bellman error ( mspbe ) corresponding to this equation is given by : @xmath46 where @xmath47 , for any @xmath48 . the multi - step asymptotic td solution associated with the fixed - point equation and",
    "the above mspbe can be expressed as @xmath49 , when @xmath50 is an invertible matrix , and @xmath50 and @xmath51 are given by @xmath52",
    "under the rubric of temporal - difference learning fall a broad spectrum of methods . on one end of the spectrum",
    ", we have one - step methods that fully bootstrap using estimates of the next state and use only the immediate rewards as samples . on the other end of the spectrum",
    ", we have monte carlo methods that do not bootstrap and rather use all future rewards for making updates .",
    "many multi - step learning algorithms incorporate this full spectrum and can vary smoothly between one - step and monte carlo updates using the bootstrapping parameter @xmath24 . here",
    "@xmath53 determines the degree to which bootstrapping is used in the algorithm . with @xmath54 , these algorithms achieve one - step td updates , whereas with @xmath55 , they effectively achieve monte carlo updates . to contrast with one - step learning , multi - step learning",
    "is generally viewed as learning with @xmath56 in td methods .",
    "multi - step learning impacts the efficiency of estimation in two ways .",
    "first , it allows more efficient estimation compared to one - step learning with a finite amount of samples .",
    "one - step learning uses the minimal amount of samples , have relatively less variance compared to monte carlo updates , but produces biased estimates .",
    "typically , with a finite amount of samples , a value of @xmath24 between 0 and 1 reduces the estimation error the most ( ) .",
    "second , when function approximation is used and @xmath18 does not lie in the approximation subspace , multi - step learning can produce superior asymptotic solutions compared to one - step learning .",
    "as @xmath57 increases , the multi - step bellman operator approaches the constant operator that maps every @xmath58 to @xmath18 .",
    "this in general leads to better approximations , as suggested by the monotonically improving error bound of asymptotic solutions ( ) in the on - policy case , and as we demonstrate for the off - policy case in figure [ fig : asymp - bias ] .    ,",
    "shown here for 50 randomly constructed mdps . in these mdps , we used 100 states , 5 actions , and 40 features .",
    "the rewards , probabilities , and feature values ( binary ) were chosen uniformly randomly . ]",
    "although multi - step learning is desirable with function approximation , it is more difficult in the off - policy case where the detrimental effect of importance sampling is most pronounced . for this reason ,",
    "off - policy learning without importance sampling ratios is a naturally appealing and desirable solution to this problem .",
    "prior works on off - policy learning without the ratios ( e.g. , , ) are given in the lookup table case where the benefit of multi - step learning does not show up , because regardless of @xmath57 , the asymptotic solution is @xmath18 .",
    "it is in the case of function approximation that multi - step off - policy learning without importance sampling ratios is most needed .",
    "to set the stage for our work , we describe in this section the canonical multi - step off - policy learning update with importance sampling ratios , and how the ratios introduce variance in off - policy temporal - difference ( td ) updates .",
    "a td update is generally constructed based on stochastic approximation methods , where the target of the update is based on returns . here",
    "we consider the off - line update for off - policy td learning .",
    "although not practical for implementation , off - line updates are useful and develop the foundation for deriving practical and computationally efficient algorithms ( sutton & barto 1998 , seijen et al .",
    ". an off - line td update for off - policy action - value estimation based on multi - step returns can be defined as : @xmath59 where @xmath60 is the step - size parameter , and @xmath61 is a fixed weight vector . here , @xmath62 is the multi - step target , known as @xmath57-return , defined as the sum of td errors weighted by powers of @xmath63 and products of importance sampling ratios : @xmath64 the td error @xmath65 is defined as @xmath66 , with @xmath67 .",
    "the term @xmath68 is a product of importance sampling ratios @xmath69 , which accounts for the discrepancy due to using the behavior policy instead of the target policy throughout the trajectory .",
    "note that , the update defined by ( [ eqn : off - policy - q - lambda ] ) is a forward - view update , that is , it uses samples that only become available in the future from the time the state of the updated estimate is visited .",
    "we call this update _ the off - policy q@xmath70update_. it can be shown that the asymptotic multi - step solution corresponding to off - policy q@xmath70is given by @xmath71 , ( [ eqn : a ] ) , and ( [ eqn : b ] ) , when @xmath50 is invertible .",
    "all existing multi - step off - policy algorithms with importance sampling are of this form or a variant .",
    "when @xmath72 , no importance sampling ratios are involved , and this update reduces to that of off - policy expected sarsa ( , , ) .",
    "this one - step update is also closely related to the one - step q - learning update , where a greedy nonstationary target policy is used instead of a fixed stationary one .",
    "the importance sampling ratios play a role when @xmath73 , and their influence , including the detrimental impact on variance , is greater with larger @xmath57 .",
    "the product @xmath74 of off - policy q@xmath70 in ( [ eqn : l - return ] ) can become as large as @xmath75 .",
    "such an exponential growth , when occurred even momentarily , can have large impact on the variance of the estimate .",
    "if the value of @xmath57 is small or very close to zero , the large variance ensuing from the product may be avoided , but it would also be devoid of much of the benefits of multi - step learning .",
    "in this section , we introduce the idea of action - dependent bootstrapping and how it can be used to avoid importance sampling ratios in off - policy estimates . for that , first we introduce an action - dependent bootstrapping parameter @xmath76 $ ] , which is allowed to vary between different state - action pairs .",
    "a closely related idea is state - dependent bootstrapping used by sutton and singh ( ) and sutton et al .",
    "( ) for state - value estimation , and by maei and sutton ( ) for action - value estimation . in those works",
    ", the degree of bootstrapping was allowed to vary from one state to another by the state - dependent bootstrapping parameter @xmath77 $ ] but was not used as a device to reduce the estimation variance .",
    "the variability of the parameter @xmath78 can be utilized algorithmically on a moment - by - moment basis to absorb the detrimental effect of importance sampling and in general to control the impact of importance sampling .",
    "let us use the notational shorthand @xmath79 , and define a new @xmath57-return by replacing the constant @xmath57 in ( [ eqn : l - return ] ) with variable @xmath78 : @xmath80 where @xmath81 .",
    "notice that each importance sampling ratio in ( [ eqn : l - return - two ] ) is factored with a corresponding bootstrapping parameter : @xmath82 .",
    "we can mitigate an explicit use of importance sampling ratios by setting the action - dependent bootstrapping parameter @xmath78 in the following way : @xmath83 where @xmath84 is a constant .",
    "note that @xmath85 is upper - bounded by @xmath86 , which is defined as follows : @xmath87 the product @xmath88 can then be rewritten as : @xmath89 , dispelling an explicit presence of importance sampling ratios from the update .",
    "it is easy to see that , under our proposed scheme , the effective bootstrapping parameter is upper bounded by 1 : @xmath90 , and at the same time all the products are also upper bounded by one : @xmath91 , largely reducing variance .    to understand how @xmath92 influences @xmath78 let us use the following example , where there are only one state and three actions @xmath93 available .",
    "the behavior policy probabilities are @xmath94 and the target policy probabilities are @xmath95 for the three actions , respectively .",
    "figure [ fig : zeta - tuning - and - asymp - sol ] ( left ) shows how the action - dependent bootstrapping parameter @xmath57 for different actions change as @xmath92 is increased from 0 to @xmath86 .",
    "initially , the bootstrapping parameter @xmath57 increased linearly for all actions at a different rate depending on their corresponding behavior policy probabilities .",
    "the @xmath96 in the factor @xmath97 comes into effect with @xmath98 , and the largest @xmath57 at @xmath99 gets capped first .",
    "eventually , with large enough @xmath92 , that is , @xmath100 , all @xmath57s get capped .",
    "algorithms with constant @xmath57 are typically studied in terms of their parameters by varying @xmath57 between @xmath101 $ ] , which would not be possible for an algorithm based on the above scheme as @xmath57 is not a constant any more . for our scheme ,",
    "the constant tunable parameter is @xmath92 , which has three pivotal values : @xmath102 $ ] . for parameter studies",
    ", it would be convenient if @xmath92 is scaled to another tunable parameter between @xmath103 $ ] .",
    "but in that case , we have to make a decision on what value @xmath104 should transform to . in the absence of a clear sense of it , a default choice would be to transform @xmath104 to 0.5 .",
    "one such scaling is where we set @xmath92 as a function of another constant @xmath105 in the following way : @xmath106 and then vary @xmath107 between @xmath103 $ ] as one would vary @xmath57 . here",
    "@xmath108 . in this case ,",
    "@xmath109 , and @xmath110 correspond to @xmath111 , and @xmath86 , respectively .",
    "note that @xmath107 can be written conversely in terms of @xmath92 as follows : @xmath112 the top margin of figure [ fig : zeta - tuning - and - asymp - sol ] ( left ) shows an alternate x - axis in terms of @xmath107 .     and",
    "@xmath107 on @xmath78 for three different actions under the action - dependent bootstrapping scheme .",
    "as @xmath92 is increased , the parameter @xmath57 for different actions increase at a different rate and get capped for different values of @xmath92 . *",
    "right * : the effect of @xmath57 on gq@xmath70solutions and @xmath107 on abq@xmath113solutions .",
    "multi - step ( @xmath73 ) off - policy q@xmath70solutions are superior to the one - step ( @xmath72 ) solution .",
    "abq@xmath113solutions can also achieve a similar multi - step advantage with @xmath114 . ]    to form an update using this proposed modification to @xmath57 , let us use the following notational shorthands , @xmath115 we use @xmath116 to denote the @xmath57-return defined by ( [ eqn : l - return - two ] ) with the bootstrapping parameter set according to @xmath117 : @xmath118 where @xmath119 , @xmath120 , and @xmath121 . the off - line forward - view update with @xmath116 as the target",
    "can be written as : @xmath122 the asymptotic solution corresponding to this update , which we call the _",
    "solution , is with @xmath123 assuming @xmath124 is invertible .",
    "the derivation is given in appendix a.1 . here",
    "@xmath125 is a diagonal matrix with @xmath126 being the diagonal elements .",
    "this is a multi - step solution when the bootstrapping parameter @xmath126 does not uniformly reduce to zero .",
    "the drawback of this scheme is that we can not achieve @xmath127 for all state - action pairs , which would produce the off - policy monte carlo solution .",
    "it is the cost of avoiding importance sampling ratios together with its large variance issue .",
    "however , much of the multi - step benefits can still be retained by choosing a large @xmath107 .    to illustrate that abq@xmath113solutions can retain much of the multi - step benefits , we used a two - state off - policy task similar to the off - policy task by sutton et al .",
    "( ) . in this task",
    ", there were two states each with two actions , @xmath128 and @xmath129 , leading to one of the two states deterministically .",
    "more specifically , @xmath130 .",
    "there is a deterministic nonzero reward @xmath131 ; all other transitions have reward zero .",
    "the discount factor @xmath132 was 0.9 .",
    "the feature vectors were set as @xmath133 and @xmath134 .",
    "the behavior policy was chosen as @xmath135 to break away from the uniform distribution of the original problem .",
    "the target policy was chosen as @xmath136 .",
    "we produced different asymptotic solutions defined by ( [ eqn : aabq ] ) and ( [ eqn : babq ] ) , choosing different constant @xmath107 between @xmath103 $ ] .",
    "we compared abq@xmath113solutions with off - policy q@xmath70solutions in terms of the mean squared error ( mse ) @xmath137 normalized by @xmath138 .",
    "the results are given in figure [ fig : zeta - tuning - and - asymp - sol ] ( right ) .",
    "off - policy q@xmath70solutions with @xmath73 in this task are substantially better than the one - step solution produced with @xmath72 .",
    "the abq@xmath113solutions can not be as good as the off - policy q(1 ) solution , as we already anticipated , but much of the benefits of multi - step off - policy solutions can be attained by choosing a large value of @xmath107 . although the tunable parameter @xmath107 of abq was set to be a constant , the effective bootstrapping parameter @xmath126 was different for different state - action pairs .",
    "therefore , abq solutions can not be obtained simply by rescaling the constant @xmath57 of off - policy q@xmath70 . the algorithm in principle",
    "can be used with either @xmath107 or @xmath92 as the tunable parameter .",
    "if we tune with @xmath139 $ ] , we will have to first use ( [ eqn : psi - to - zeta ] ) to obtain @xmath140 , and then ( [ eqn : nu - shorthand ] ) and ( [ eqn : lambda - shorthand ] ) to obtain @xmath141 on a moment - by - moment basis .",
    "computing @xmath140 from @xmath107 requires knowing @xmath104 and @xmath86 which are often known , for example , when the policies are in @xmath142-greedy form or fixed and known beforehand .",
    "in other cases , tuning with @xmath92 directly can be more convenient . as the scaled parameter @xmath143 reflects more clearly the qualitative behavior of abq , we use it as the tunable parameter in this work .",
    "in this section , we develop a computationally scalable and stable algorithm corresponding to the abq@xmath113solution . the update ( [ eqn : abq - for ] ) given earlier",
    "can not be computed in a scalable manner , because forward - view updates require an increasing amount of computation as time progresses . moreover , off - policy algorithms with bootstrapping and function approximation may be unstable ( sutton & barto 1998 ) , unless machinery for ensuring stability is incorporated .",
    "our goal is to develop a stable update corresponding to abq@xmath113solutions while keeping it free from an explicit use of importance sampling ratios .",
    "first , we produce the equivalent backward view of ( [ eqn : abq - for ] ) so that the updates can be implemented without forming explicitly the @xmath57-return . as we derive in appendix a.2 ,",
    "these updates are given by @xmath144 here , @xmath145 is an accumulating trace vector .",
    "the above backward - view update achieves equivalence with the forward - view of ( [ eqn : abq - for ] ) only for off - line updating , which is typical for all algorithms with accumulating traces .",
    "equivalence for online updating could also be achieved by following the approach taken by van seijen et al .",
    "( 2014 , ) , but we leave that out for simplicity .",
    "we take the approach proposed by maei ( ) to develop a stable gradient - based td algorithm .",
    "the key step in deriving a gradient - based td algorithm is to formulate an associated mean squared projected bellman error ( mspbe ) and produce its gradient , which can then be sampled to produce stochastic updates .",
    "the mspbe for the update ( [ eqn : abq - for ] ) is given by : @xmath146 here , the bellman operator corresponding to the bootstrapping matrix @xmath125 is defined for all @xmath32 as @xmath147 then the gradient can be written as : @xmath148 where @xmath149 , @xmath150 and @xmath151 are defined in the following way : @xmath152 when this gradient is known , the gradient - descent step would be to add the following to the parameter vector : @xmath153 in model - free learning , the gradient is not available to the learner .",
    "however , we can form a stochastic gradient descent update by sampling from this gradient .",
    "for that , we can express @xmath149 and @xmath151 in an expectation form , and estimate the vector @xmath154 at a faster time scale .    in appendix a.3 , we derive the resulting stochastic gradient corrected algorithm in details , which we call _ the abq@xmath113algorithm_. this algorithm is defined by the following online updates : @xmath155 the iteration ( [ eqn : abq - w ] ) carries out stochastic gradient - descent steps to minimize the mspbe ( [ eqn : mspbe ] ) , and it differs from ( [ eqn : abq - back ] ) as it includes a gradient - correction term @xmath156 .",
    "this correction term involves an extra vector parameter @xmath157 .",
    "note that no importance sampling ratios are needed in the update of @xmath157 or in the gradient - correction term .",
    "the vector @xmath157 is updated according to ( [ eqn : abq - h ] ) at a faster timescale than @xmath158 by using a second step - size parameter @xmath159 when both step sizes are diminishing .",
    "one can achieve that by letting @xmath160 , for instance .",
    "in practice , when stability is not a problem , smaller values of @xmath161 often lead to better performance ( ) .",
    "we empirically evaluate abq@xmath113on three policy evaluation tasks : the two - state off - policy task from section 5 , an off - policy policy evaluation adaptation of the mountain car domain ( sutton & barto 1998 ) , and the 7-star baird s counterexample ( , ) . in the first two tasks we investigated whether abq@xmath113can produce correct estimates with less variance compared to gq@xmath70 ( ) , the state - of - the - art importance sampling based algorithm for action - value estimation with function approximation .",
    "we validate the stability of abq@xmath113 in the final task , where off - policy algorithms without a stability guarantee ( e.g. , off - policy q@xmath70 ) tend to diverge .",
    "although the mdp involved in the two - state task is small , off - policy algorithms may suffer severely in this task as the importance sampling ratio , once in a while , can be as large as 9 .",
    "we simulated both gq@xmath70and abq@xmath70on this task for 10000 time steps , starting with @xmath162 .",
    "we averaged the mse @xmath163 for the last 5000 time steps .",
    "we further averaged this quantity over 100 independent runs .",
    "finally , we divided this error by @xmath138 to obtain the normalized mse ( nmse ) .",
    "figure [ fig : two - state - and - mountaincar ] ( left ) shows curves for different combinations of the step - size parameters : @xmath164 $ ] and @xmath165 $ ] .",
    "performance is shown in the estimated nmse , with the corresponding standard error for different values of @xmath57 and @xmath107 . with @xmath166 , the error of gq@xmath70increased sharply due to increased influence of importance sampling ratios .",
    "it clearly depicts the failure to perform effective multi - step learning by an importance sampling based algorithm when @xmath57 is large .",
    "the error of abq@xmath113decreased substantially for most step - size combinations as @xmath107 is increased from 0 to 0.5 , and it decreased slightly for some step - size combinations as @xmath107 was increased up to @xmath110 .",
    "this example clearly shows that abq@xmath113can perform effective multi - step learning while avoiding importance sampling ratios . on the other hand , the best performance of gq@xmath70was better than abq@xmath113for the smallest value of the first step size ( i.e. , @xmath167 ) .",
    "when the step size was too small , gq@xmath70 in fact benefited from the occasional large scaling from importance sampling , whereas abq@xmath113remained conservative in its updates to be safe .    and",
    "abq@xmath113on a two - state off - policy policy evaluation task .",
    "performance is shown in normalized mean squared error with respect to different values of @xmath57 for gq@xmath70and @xmath107 for abq@xmath113 .",
    "different curves are for different combinations of step - size values . gq@xmath70produces large mse when large @xmath57 is used .",
    "abq@xmath113tolerates larger values of @xmath143 and thus can better retain the benefits of multi - step learning compared to gq@xmath70 . :",
    "comparison of empirical performance of gq@xmath70and abq@xmath113on an off - policy policy evaluation task based on the mountain car domain .",
    "each curve shows how learning progresses in terms of estimated normalized mean squared error as more episodes are observed .",
    "different learning curves are for different values of @xmath57 for gq@xmath70and @xmath107 for abq@xmath113 . all of them are shown for a particular combination of step - size values .",
    "the spikes in gq@xmath70 s learning curves are the result of the occasional large values of importance sampling ratios , increasing the variance of the estimate for gq@xmath70as large values of @xmath57 are chosen .",
    "abq@xmath113 , on the other hand , can achieve lower mean squared error with larger values of @xmath107 by reducing the estimation variance . ]    the mountain car domain is typically used for policy improvement tasks , but here we use it for off - policy policy evaluation .",
    "we constructed the task in such a way that the importance sampling ratios for gq can be as large as 30 , emphasizing the variance issue regarding ratios . in this task ,",
    "the car starts in the vicinity of the bottom of the valley with a small nonzero speed .",
    "the three actions are : _ reverse throttle _ , _ no throttle _ , and _",
    "forward throttle_. rewards are -1 at every time step , and state transitions are deterministic .",
    "the discount factor @xmath132 is 0.999 .",
    "the policies used in the experiments were based on a simple handcrafted policy , which chooses to move forward with full throttle if the velocity of the car was nonzero and toward the goal , and chooses to move away from the goal with full throttle otherwise .",
    "both the target policy and the behavior policy are based on this policy but choose to randomly explore the other actions differently . more specifically , when the velocity was nonzero and toward the goal , the behavior policy probabilities for the actions _ reverse throttle _ ,",
    "_ no throttle _ , and _ forward throttle _ are @xmath168 , and the target policy probabilities are @xmath169 , respectively . in the other case ,",
    "the behavior and the target policy probabilities are @xmath170 and @xmath171 $ ] , respectively .",
    "we set the policies this way so that episodes complete under both policies in a reasonable number of time steps , while the importance sampling ratio may occasionally be as large as @xmath172 .",
    "the feature vector for each state - action pair contained 32 features for each action , where only the features corresponding to the given action were nonzero , produced using tile coding with ten 4@xmath1734 tilings .",
    "each algorithm ran on the same 100 independent sequences of samples , each consisting 10,000 episodes .",
    "the performance was measured in terms of the mean - squared - error ( mse ) with respect to the estimated value @xmath174 of 30 chosen state - action pairs .",
    "these pairs were chosen by running the agent under the behavior policy for 1 million time steps , restarting episodes each time termination occurs , and choosing 30 pairs uniformly randomly from the last half million time steps .",
    "the ground truth values for these 30 pairs @xmath175 were estimated by following the target policy 100 times from those pairs and forming the average .",
    "the mean - squared error from @xmath175 was normalized by @xmath176 .",
    "we use the mountain car off - policy task to illustrate through learning curves how @xmath57 and @xmath107 affect gq@xmath70and abq@xmath113 , respectively .",
    "figure [ fig : two - state - and - mountaincar ] ( right ) shows the learning curves of abq@xmath113and gq@xmath70with respect to mean squared errors for three difference values of @xmath57 and @xmath107 : 0 , 0.4 , and 0.8 , and a particular step - size combination : @xmath177   @xmath178 and @xmath179 .",
    "these learning curves are averages over 100 independent runs",
    ". the standard errors of abq s estimated mse here are smaller than the width of the curves shown .",
    "abq achieved a significantly lower mse with @xmath114 than with @xmath180 . on the other hand",
    ", gq performed unreliably with larger @xmath57 . with @xmath181",
    ", the learning curves are highly varying from each other due to occasionally having the largest ratio value 30 , affecting the update at different time steps .",
    "some learning curves even became unstable , causing the mse to move away further and further with time , and affecting the average mse , which explains the spikes .",
    "when @xmath182 was chosen , all learning curves became unstable in few steps .",
    "is stable on baird s counterexample for different values of @xmath107 . ]    in the 7-star baird s counterexample , adopted from white ( ) , step sizes were set as @xmath183 and @xmath184 , and the bootstrapping parameter @xmath107 was chosen evenly between @xmath185 and @xmath110 .",
    "the mean squared projected bellman error ( mspbe ) was estimated by averaging over 50 runs . as shown in figure [ fig : baird ] , abq@xmath113performed stably with all values of @xmath107 used .",
    "this validates empirically the gradient correction in abq@xmath113 .",
    "abq@xmath113is a result of this new idea of varying the bootstrapping parameter in an action - dependent manner so that an explicit presence of importance sampling ratios are mitigated from the update . however , it is not the only action - dependent bootstrapping scheme one can devise .",
    "it is possible to bound the product @xmath186 by using other action - dependent bootstrapping schemes .",
    "different schemes not only allow us to derive new algorithms , they may also be used to understand some existing algorithms better . here",
    ", we show how the retrace algorithm by munos et al .",
    "( 2016 ) can be understood in terms of a particular way of setting the action - dependent bootstrapping parameter .",
    "retrace is a tabular off - policy algorithm that approaches the variance issue by truncating the importance sampling ratio .",
    "we show that such truncations can be understood as varying the action - dependent bootstrapping parameter in a particular manner , first , by constructing a forward - view update with a different action - dependent bootstrapping scheme than abq s , second , by deriving the asymptotic solution corresponding to that forward - view update , and third , by showing that the equivalent backward - view update is the same as the retrace algorithm . for generality , we take these steps in the linear function approximation case and incorporate gradient corrections for stability . the resulting algorithm ,",
    "we call _ ab - trace@xmath113 _ is a stable generalization of retrace .",
    "we construct a new forward - view update similar to ( [ eqn : abq - for ] ) with @xmath187 , where @xmath97 is redefined as @xmath188 . here",
    ", we treat @xmath189 and @xmath190 .",
    "then we can directly use appendix a.1 to derive its asymptotic solution : @xmath191 where the diagonal elements of @xmath125 are @xmath192 for different state - action pairs .",
    "a stable forward - view update with gradient correction corresponding to the above asymptotic solution can be derived by directly using the results of appendix a.3 .",
    "the resulting algorithmn , ab - trace@xmath113 , is given by the following updates : @xmath193 note that , the factor @xmath194 in the eligibility trace vector update can be rewritten as : @xmath195 from here , it is easy to see that , if the feature representation is tabular and the gradient correction term is dropped , then the ab - trace algorithm reduces to the retrace algorithm .",
    "finally , we remark that the action - dependent bootstrapping framework provides a principled way of developing stable and efficient off - policy algorithms as well as unifying the existing ones , where ab - trace and its connection to retrace is only one instance .",
    "a closely related algorithm is tree backup by precup et al .",
    "this algorithm can also be produced as a special case of abq@xmath113 , if we remove gradient correction , consider the feature vectors always to be the standard basis , and @xmath196 to be always set to a constant , instead of setting it in an action - dependent manner . in the on - policy case , the tree backup algorithm fails to achieve the td(1 ) solution , whereas abq achieves it with @xmath197 .",
    "our work is not a trivial generalization of this prior work .",
    "the tree backup algorithm was developed using a different intuition based on backup diagrams and was introduced only for the lookup table case .",
    "not only does abq@xmath113extend the tree backup algorithm , but the idea of action - dependent bootstrapping also played a crucial role in deriving the abq@xmath113algorithm with gradient correction in a principled way .",
    "another related algorithm is retrace , which we have already shown to be a special case of the ab - trace algorithm .",
    "the main differences are that retrace was introduced and analyzed in the case of tabular representation , and thus retrace is neither stable nor shown to achieve multi - step solutions in the case of function approximation .    yet another class of related algorithms are where the bootstrapping parameter is adapted based on past data , for example , the works by white and white ( 2016b ) and mann et al .",
    "( 2016 ) . beside adapting on a state - action - pair basis ,",
    "the main difference between those algorithms and the ones introduced here under the action - dependent bootstrapping framework is that our algorithms adapt the bootstrapping parameter using only the knowledge of policy probabilities for the current state - action pair whereas the algorithms in the other class involve a separate learning procedure for adapting @xmath57 and hence are more complex .",
    "in this paper , we have introduced the first model - free off - policy algorithm abq@xmath113that can produce multi - step function approximation solutions without requiring to use importance sampling ratios .",
    "the key to this algorithm is allowing the amount of bootstrapping to vary in an action - dependent manner , instead of keeping them constant or varying only with states .",
    "part of this action - dependent bootstrapping factor mitigates the importance sampling ratios while the rest of the factor is spent achieving multi - step bootstrapping .",
    "the resulting effect is that the large variance issue with importance sampling ratios is readily removed without giving up multi - step learning .",
    "this makes abq@xmath113more suitable for practical use .",
    "action - dependent bootstrapping provides an insightful and well - founded framework for deriving off - policy algorithms with reduced variance .",
    "the same idea may be applied to state - value estimation .",
    "the ratios can not be eliminated completely in this case ; nevertheless , reduction in the variance can be expected . according to an alternative explanation based on backup diagrams ( precup et al .",
    "2000 ) , abq updates may be seen as devoid of importance sampling ratios , while the action - dependent bootstrapping framework can now provide us a clearer mechanistic view of how updates without importance sampling ratios can perform off - policy learning .",
    "the convergence of this algorithm can be analyzed similarly to the work by karmakar and bhatnagar ( ) for diminishing step sizes and yu ( ) for constant step sizes , by using properties of the eligibility traces and stochastic approximation theory .",
    "investigating the possibility to include true online updates ( ) is also an interesting direction for future work .",
    "= .30 cm dann , c. , neumann , g. , peters , j. ( 2014 ) .",
    "policy evaluation with temporal differences : a survey and comparison .",
    "_ journal of machine learning research , 15_:809883 .",
    "= .30 cm baird , l.  c. ( 1995 ) .",
    "residual algorithms : reinforcement learning with function approximation . in _ proceedings of the 12th international conference on machine learning _ , pp .",
    "3037 .",
    "= .30 cm dudk , m. , langford , j. , li , l. ( 2011 ) .",
    "doubly robust policy evaluation and learning . in _ proceedings of the 28th international conference on machine learning _ , pp .",
    "10971104 .",
    "= .30 cm geist , m. , scherrer , b. ( 2014 ) .",
    "off - policy learning with eligibility traces : a survey .",
    "_ journal of machine learning research , 15_:289333 .",
    "= .30 cm hallak , a. , tamar , a. , munos , r. , mannor , s. ( 2015a ) . generalized emphatic temporal difference learning : bias - variance analysis .",
    "_ arxiv preprint _ arxiv:1509.05172 .",
    "= .30 cm hallak , a. , schnitzler , f. , mann , t. , mannor , s. ( 2015b ) .",
    "off - policy model - based learning under unknown factored dynamics . in _ proceedings of the 32nd international conference on machine learning _ , pp .",
    "711719 .",
    "= .30 cm hammersley , j. m. handscomb , d. c. ( 1964 ) .",
    "monte carlo methods , _ methuen & co. ltd .",
    "_ , london , pp .",
    "40 ,     = .30 cm harutyunyan , a. , bellemare , m. g. , stepleton , t. , munos , r. ( 2016 ) .",
    "q ( @xmath198 ) with off - policy corrections . _",
    "arxiv preprint _ arxiv:1602.04951 .",
    "= .30 cm karmakar , p. , bhatnagar , s. ( 2015 ) .",
    "two timescale stochastic approximation with controlled markov noise and off - policy temporal difference learning .",
    "_ arxiv preprint _ arxiv:1503 .",
    "+ 09105 .",
    "= .30 cm jiang , n. , li , l. ( 2015 ) .",
    "doubly robust off - policy evaluation for reinforcement learning .",
    "_ arxiv preprint _ arxiv:1511.03722 .",
    "= .30 cm koller , d. , friedman , n. ( 2009 ) . _ probabilistic graphical models : principles and techniques_. mit press , 2009 .",
    "= .30 cm li , l. , munos , r. , szepesvari , c. ( 2015 ) . toward minimax",
    "off - policy value estimation . in _ proceedings of the eighteenth international conference on artificial intelligence and statistics _",
    ", pp . 608616 .",
    "= .30 cm liu , j.  s. ( 2001 ) .",
    "_ monte carlo strategies in scientific computing_. berlin , springer - verlag .",
    "= .30 cm maei , h.  r. , sutton , r.  s. ( 2010 ) .",
    "gq@xmath70 : a general gradient algorithm for temporal - difference prediction learning with eligibility traces . in _ proceedings of the third conference on artificial general intelligence _ , pp .",
    "atlantis press .",
    "= .30 cm maei , h.  r. ( 2011 ) .",
    "_ gradient temporal - difference learning algorithms_. phd thesis , university of alberta .",
    "= .30 cm mahmood , a.  r. , van hasselt , h. , sutton , r.  s. ( 2014 ) .",
    "weighted importance sampling for off - policy learning with linear function approximation . in _ advances in neural information processing systems 27",
    "_ , montreal , canada .",
    "= .30 cm mahmood , a.  r. , sutton , r.  s. ( 2015 ) .",
    "off - policy learning based on weighted importance sampling with linear computational complexity . in",
    "_ proceedings of the 31st conference on uncertainty in artificial intelligence_.     = .30 cm mahmood , a.  r. , yu , h. , white , m. , sutton , r.  s. ( 2015 ) .",
    "emphatic temporal - difference learning .",
    "_ european workshop on reinforcement learning 12_,_arxiv preprint _ arxiv:1507 .",
    "+ 01569 .",
    "= .30 cm mann , t.  a. , penedones , h. , mannor , s. , hester , t. ( 2016 ) .",
    "adaptive lambda least - squares temporal difference learning .",
    "arxiv preprint arxiv:1612.09465 .",
    "= .30 cm paduraru , c. ( 2013 ) . _ off - policy evaluation in markov decision processes _ , phd thesis , mcgill university .",
    "= .30 cm precup , d. , sutton , r.  s. , singh , s. ( 2000 ) .",
    "eligibility traces for off - policy policy evaluation . in _ proceedings of the 17th international conference on machine learning _ , pp .  759766 .",
    "morgan kaufmann .",
    "= .30 cm precup , d. , sutton , r.  s. , dasgupta , s. ( 2001 ) .",
    "off - policy temporal - difference learning with function approximation . in _ proceedings of the 18th international conference on machine learning_.     = .30 cm munos , r , stepleton , t , harutyunyan , a , bellemare , m.  g. ( 2016 ) .",
    "safe and efficient off - policy reinforcement learning . in _ proceedings of neural information processing systems_.     = .30 cm rubinstein , r.  y. ( 1981 ) .",
    "_ simulation and the monte carlo method _ , new york , wiley .",
    "= .30 cm sutton , r.s . , singh , s.p .",
    "( 1994 ) . on bias and step size in temporal - difference learning . in _ proceedings of the eighth yale workshop on adaptive and learning systems _ , pp",
    "91 - 96 .",
    "= .30 cm sutton , r.  s. , barto , a.  g. ( 1998 ) .",
    "_ reinforcement learning : an introduction_. mit press .",
    "= .30 cm sutton , r. s. , precup , d. , singh , s. ( 1999 ) . between mdps and semi - mdps : a framework for temporal abstraction in reinforcement learning . _ artificial intelligence _ , 112(1 ) , 181211 .",
    "= .30 cm sutton , r. s. , mahmood , a. r. , precup , d. , van hasselt , h. ( 2014 ) . a new q@xmath70with interim forward view and monte carlo equivalence . in _ proceedings of the 31st international conference on machine",
    "learning_. jmlr w&cp 32(2 ) .",
    "= .30 cm sutton , r. s. , mahmood , a. r. , white , m. ( 2016 ) . an emphatic approach to the problem of off - policy temporal - difference learning . _ journal of machine learning research 17 _ , ( 73):129 .",
    "= .30 cm thomas , p. s. ( 2015 ) .",
    "_ safe reinforcement learning_. phd thesis , university of massachusetts amherst .",
    "= .30 cm thomas , p. s. , brunskill , e. ( 2016 ) .",
    "data - efficient off - policy policy evaluation for reinforcement learning .",
    "_ arxiv preprint _ arxiv:1604.00923 .",
    "= .30 cm tsitsiklis , j. n. , van roy , b. ( 1997 ) .",
    "an analysis of temporal - difference learning with function approximation .",
    "_ ieee transactions on automatic control _ , 42(5 ) , 674690 .",
    "= .30 cm van hasselt , h. ( 2011 ) .",
    "_ insights in reinforcement learning : formal analysis and empirical evaluation of temporal - difference learning algorithms_. phd thesis , universiteit utrecht .",
    "= .30 cm van hasselt , h. , mahmood , a.  r. , sutton , r.  s. ( 2014 ) .",
    "off - policy td@xmath70with a true online equivalence . in _ proceedings of the 30th conference on uncertainty in artificial intelligence _ ,",
    "quebec city , canada .",
    "= .30 cm van seijen , h. , & sutton , r.  s. ( 2014 ) .",
    "true online td(@xmath57 ) . in _ proceedings of the 31st international conference on machine learning_. jmlr w&cp 32(1):692700 .",
    "= .30 cm van seijen , h. , mahmood , a.  r. , pilarski , p.  m. , machado , m.  c. , sutton , r.  s. ( 2016 ) .",
    "true online temporal - difference learning",
    ". _ journal of machine learning research 17 _ ( 145):140 .",
    "= .30 cm white , a. , modayil , j. , sutton , r.  s. ( 2012 ) .",
    "scaling life - long off - policy learning . in _ proceedings of the second joint ieee international conference on development and learning and on epigenetic robotics _",
    ", san diego , usa .     = .30 cm white , a. ( 2015 ) .",
    "_ developing a predictive approach to knowledge_. phd thesis , university of alberta .",
    "= .30 cm white , a. , white , m. ( 2016a ) .",
    "investigating practical , linear temporal difference learning . in _ proceedings of the 2016 international conference on autonomous agents & multiagent systems _ , 494502 .",
    "= .30 cm white , m. , white , a. ( 2016b ) .",
    "a greedy approach to adapting the trace parameter for temporal difference learning . in _ proceedings of the 2016 international conference on autonomous agents & multiagent systems _",
    ", 557565 .",
    "= .30 cm yu , h. ( 2012 ) .",
    "least squares temporal difference methods : an analysis under general conditions .",
    "_ siam journal on control and optimization , 50_(6 ) , 33103343 .",
    "= .30 cm yu , h. ( 2015 ) . on convergence of emphatic temporal - difference learning .",
    "_ arxiv preprint _ arxiv:1506.02582 ; a shorter version appeared in the 28th annual conference on learning theory ( colt ) 2015 .",
    "= .30 cm yu , h. ( 2016 ) .",
    "weak convergence properties of constrained emphatic temporal - difference learning with constant and slowly diminishing stepsize . _ journal of machine learning research 17_(220):158 .",
    "we follow the approach taken by sutton et al .",
    "( 2016 ) to derive the asymptotic solution .",
    "the key - step in their approach is to derive the expected update corresponding to the stochastic update .",
    "the off - line backward - view update defined by ( [ eqn : abq - for ] ) can be rewritten as : @xmath199    with @xmath61 held fixed , the expected update direction for ( [ eqn : abq - for ] ) is given by the expectation of @xmath200 with respect to the stationary markov chain @xmath201 induced by @xmath21 .",
    "specifically , let @xmath202 denote expectation with respect to this stationary markov chain .",
    "we calculate the expectation @xmath203 ( for any fixed @xmath204 ) as : @xmath205 here the matrix @xmath206 is such that @xmath207_{sa , : } \\deq \\e(s , a)$ ] .",
    "we can write @xmath208 recursively as : @xmath209_{sa , s'a ' } \\x(s',a')\\tr}\\\\ & +   \\g \\sum_{s'a ' } p_\\pi(s',a'|s , a ) \\l_\\zeta(s',a ' ) \\e(s',a')\\tr\\\\ & = \\paran { \\x(s , a)\\tr - \\g \\sum_{s',a'}[\\p_\\pi]_{sa , s'a ' } \\x(s',a')\\tr } +   \\g \\sum_{s'a ' } [ \\p_\\pi \\l_{\\zeta}]_{sa , s'a ' } \\e(s',a')\\tr.\\end{aligned}\\ ] ] therefore , we can write @xmath210 recursively as : @xmath211 it then follows that @xmath212 the proof of @xmath213 = \\b_\\zeta$ ] is similar , and we omit it here .",
    "thus we have shown that the expected update corresponding to ( [ eqn : abq - for ] ) is : @xmath214 = \\a ( \\b_\\zeta - \\a_\\zeta \\w ) .\\end{aligned}\\ ] ] when @xmath124 is invertible , @xmath215 is the desired solution that ( [ eqn : abq - for ] ) aims to attain in the limit .",
    "note , however , that this expected update @xmath216 may not be stable , which is a common problem with many off - policy temporal - difference learning algorithms .",
    "a modification to ( [ eqn : abq - for ] ) , such as gradient correction , is needed to ensure stability , which is attained by the abq@xmath113algorithm described in section 6 .",
    "using the forward - view update given by ( [ eqn : abq - for ] ) , the total update can be given by : @xmath217 therefore , the backward - view update can be written as : @xmath218 the eligibility trace vector @xmath145 can be written recursively as : @xmath219",
    "the key step in deriving a gradient - based td algorithm , as proposed by maei ( ) , is to formulate an associated mean squared projected bellman error ( mspbe ) and produce its gradient , which can then be sampled to produce stochastic updates .          now to derive the stochastic updates for abq@xmath113 , let us consider a double - ended _",
    "stationary _ markov chain induced by @xmath21 , @xmath223 @xmath224 .",
    "let @xmath202 denote expectation with respect to the probability distribution of this stationary markov chain .",
    "fix @xmath204 to be any integer .",
    "then we can write the first term @xmath149 in @xmath225 in expectation form as follows : @xmath226 where @xmath227 is a well - defined random variable and can be written recursively as : @xmath228      therefore , a stochastic update corresponding to the expected gradient - descent update can be written as : @xmath231 the vector @xmath154 can be estimated from samples by lms but at a faster time scale and with a larger step - size parameter @xmath161 : @xmath232 it can be shown that with @xmath61 held fixed , under standard diminishing step - size rules for @xmath233 , the @xmath234 produced by the above updates converges to @xmath235"
  ],
  "abstract_text": [
    "<S> to estimate the value functions of policies from exploratory data , most model - free off - policy algorithms rely on importance sampling , where the use of importance sampling ratios often leads to estimates with severe variance . </S>",
    "<S> it is thus desirable to learn off - policy without using the ratios . </S>",
    "<S> however , such an algorithm does not exist for multi - step learning with function approximation . in this paper </S>",
    "<S> , we introduce the first such algorithm based on temporal - difference ( td ) learning updates . </S>",
    "<S> we show that an explicit use of importance sampling ratios can be eliminated by varying the amount of bootstrapping in td updates in an action - dependent manner . </S>",
    "<S> our new algorithm achieves stability using a two - timescale gradient - based td update . a prior algorithm based on lookup table representation called tree backup </S>",
    "<S> can also be retrieved using action - dependent bootstrapping , becoming a special case of our algorithm . in two challenging off - policy tasks , we demonstrate that our algorithm is stable , effectively avoids the large variance issue , and can perform substantially better than its state - of - the - art counterpart . </S>"
  ]
}