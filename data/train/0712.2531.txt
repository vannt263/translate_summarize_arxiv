{
  "article_text": [
    "the free energy ( or potential of mean force ) is the thermodynamic force driving structural processes such as conformational changes of macromolecules in aqueous solution , ligand binding at the active site of an enzyme , protein - protein association , etc .",
    "the free energy gives information about both the rate at which these processes occur and the mechanism by which they occur .",
    "this makes free energy calculations a central issue in biophysics .",
    "molecular dynamics ( md ) simulations provide a tool for performing such calculations on a computer in a way which is potentially both precise and inexpensive ( e.g.  @xcite ) .",
    "since a free energy is in essence the logarithm of a probability density function ( see  ( [ eq : free ] ) below for a precise definition ) it can in principle be calculated by histogram methods based on the binning of an md trajectory .",
    "this direct approach , however , turns out to be unpractical in general because the time scale required for the trajectory to explore all the relevant regions of configuration space is prohibitively long .",
    "probably the best known and most widely used technique to get around this difficulty is the weighted histogram analysis method ( wham )  @xcite . following  @xcite , wham adds artificial biasing potentials to maintain the md system in certain umbrella sampling windows .",
    "wham then recombines in an optimal way the histograms from all the biased simulations to compute the free energy .",
    "wham is much more efficient than the direct sampling approach , and generalizations such as  @xcite alleviate somewhat the problem of where to put the umbrella windows ( usually , this requires some _ a  priori _ knowledge of the free energy landscape ) . in practice",
    ", however , wham remains computationally demanding and it only works to compute the free energy in 2 or 3 variables .",
    "an interesting alternative to wham is metadynamics  @xcite . in essence",
    "metadynamics is a way to use an md trajectory to place inverted umbrella sampling windows on - the - fly and use these windows both to bias the md simulation and as histogram bins to sample the free energy directly ( thereby bypassing the need of further histogram analysis in each window ) .",
    "both wham and metadynamics compute the free energy directly by histogram methods , but an alternative approach is possible . unlike the free energy which is a global quantity , its negative gradient ( known as the mean force ) can be expressed in terms of a local expectation and thereby computed at a given point in the free energy landscape .",
    "this is the essence of the blue moon sampling strategy  @xcite and it offers the possibility to calculate first the mean force at a given set of locations , then use this information to reconstruct the free energy globally . in one dimension , this approach is known as thermodynamic integration and it goes back to kirkwood  @xcite . in higher dimensions , however , this way to compute free energies has been impeded by two issues .",
    "the first is where to place the points at which to compute the mean force , and the second is how to reconstruct the free energy from these data    in this paper , we propose a method , termed single - sweep method , which addresses both of these issues in two complementary but independent steps . in a first step ,",
    "we use the temperature - accelerated molecular dynamics ( tamd ) proposed in  @xcite ( see also  @xcite ) to quickly sweep through the important regions of the free energy landscape and identify points in these regions where to compute the mean force . in the second step",
    "we then reconstruct the free energy globally from the mean force by representing the free energy using radial - basis functions , and adjusting the parameters in this representation via minimization of an objective function .",
    "the single - sweep method is easy to use and implement , does not require _ a  priori _ knowledge of the free energy landscape , and can be applied to map free energies in several variables ( up to four , as demonstrated here , and probably more ) .",
    "the single - sweep method is also very efficient , especially since the mean force calculations can be performed using independent calculations on distributed processors ( i.e. using grid computing facilities  @xcite ) .",
    "the reminder of this paper is organized as follows . in sec .",
    "[ sec : theory ] , we describe the two steps of the single - sweep method in detail , starting with the second one for convenience . in sec .",
    "[ sec : app1 ] we illustrate the method on a simple two - dimensional example .",
    "this example is then used for comparison with metadynamics in sec .",
    "[ sec : metadynamics ] . in sec .",
    "[ sec : ad ] we use the single - sweep method to compute the free energy of alanine dipeptide ( ad ) in solution in two and in four of its dihedral angles . finally , concluding remarks are made in sec .",
    "[ sec : conclu ] and the details of the md calculation on ad are given in appendix  [ sec : md ]",
    "we shall consider a molecular system with @xmath0 degrees of freedom whose position in configuration space  @xmath1 will be denoted by @xmath2 .",
    "we also introduce a set of @xmath3 collective variables @xmath4 which are functions of @xmath2 such as torsion angles , interatomic distances , etc .",
    "if @xmath5 denotes the potential energy of the system and @xmath6 its temperature , the free energy @xmath7 in the variables @xmath8 is defined as @xmath9 so that @xmath10 is , up to a proportionality constant , the probability density function ( pdf ) of the variables  @xmath8 .",
    "as mentioned in the introduction , the negative gradient of the free energy , @xmath11 , is known as the mean force , and it can be computed locally at point  @xmath12 via calculation of an expectation ( see  ( [ eq : meanforceapprox ] ) below ) . in this section , we shall suppose that we have obtained an estimate of @xmath13 at points @xmath14 , and we focus on the reconstruction of the free energy @xmath7 from these data . a specific way to pick these points and compute @xmath15 will be given in sec .",
    "[ sec : tamd ] , but it is worth pointing out that the reconstruction method proposed here works with data set collected in any other ways .    our reconstruction method uses a radial - basis function representation for the free energy  @xmath7 with centers at @xmath16  @xcite : @xmath17 here @xmath18 is a constant used to adjust the overall height of @xmath19 but is otherwise irrelevant , @xmath20 denotes the euclidean norm in  @xmath21 , and @xmath22 where @xmath23 is a radial - basis function ; a convenient choice is to use the gaussian packet @xmath24 though other radial - basis functions ( multiquadric , sobolev splines , wendland , etc .",
    "@xcite ) can be used as well , see sec .",
    "[ sec : ad ] . in ( [ eq : radialbasis ] ) the heights @xmath25 and the radial - basis function width @xmath26 are adjustable parameters which we determine by minimizing over @xmath25 and @xmath27 the following objective function , which measures the discrepancy between the negative gradient of the function @xmath28 in ( [ eq : radialbasis ] ) at the centers @xmath29 , @xmath30 , and the mean force @xmath31 estimated at these centers : @xmath32 before explaining how we perform this minimization , let us give several reasons why the radial - basis representation  ( [ eq : radialbasis ] ) for @xmath7 is natural and convenient . first , the centers @xmath29 in  ( [ eq : radialbasis ] ) do not have to lie on a regular grid , which permits to use mean force data collected anywhere .",
    "second , the representation  ( [ eq : radialbasis ] ) can be used in any dimension .",
    "third , this representation has very good convergence properties , i.e. a small number of centers gives an accurate representation of  @xmath7 .",
    "in fact , unlike standard representations based e.g. on linear interpolation on a regular grid , the rate of convergence in @xmath33 of the representation in  ( [ eq : radialbasis ] ) can be made independent of @xmath3 ( a feature which the radial - basis representations share with sparse grids  @xcite ) .",
    "going back to the minimization of @xmath34 , it can be performed as follows . for fixed @xmath27 , the  @xmath35 minimizing ( [ eq : objective ] ) solve the following linear algebraic system @xmath36 where @xmath37 and @xmath38 are given by @xmath39 given the centers @xmath29 and the estimates @xmath40 of the mean force at these centers , the coefficients @xmath41 and @xmath42 can be easily computed , and the linear system ( [ eq : linalg ] ) can be solved by any standard technique , e.g. gaussian elimination .",
    "once the solution  @xmath43 of  ( [ eq : linalg ] ) is determined , to find the optimal @xmath44 satisfying @xmath45 we compute the residual @xmath46 for increasing values of @xmath27 starting from the distance between the centers .",
    "more sophisticated procedures could be used to minimize @xmath46 over @xmath27 , but the brute force method that we used proved to be efficient enough because computing successive solutions of ( [ eq : linalg ] ) for various  @xmath27 is very fast . to measure the error in the approximation",
    ", we used the residual per center defined as @xmath47 which reaches its minimum value at the same @xmath44 as @xmath46 .",
    "overall , the procedure is simple and inexpensive since the determination of @xmath35 at fixed  @xmath27 is computationally straightforward and cheap , and can be easily repeated to perform the one - dimensional minimization over  @xmath27 .",
    "one caveat that we should mention , however , is that the condition number of the matrix @xmath37 increases rapidly when the number of centers and/or @xmath27 increase .",
    "this is a known problem of radial - basis functions  @xcite . to avoid any problems , we capped the admissible condition number at @xmath48 and , in situations where this threshold value was reached while @xmath49 was still decreasing , picked for @xmath44 the corresponding value of @xmath27 .",
    "these situations only occurred in the two - dimensional example ( see sec .",
    "[ sec : app1 ] ) when a lot of centers were used ( 500 or more , i.e. much more than what will be used in the ad example ) , and even in these cases , such a large condition number did not lead to any noticeable loss of accuracy in the results ( even though the coefficients @xmath35 were then very large ) .",
    "we also observed that , given a number of centers  @xmath29 and a value of  @xmath27 , the condition number is typically lower when the dimension of @xmath12 is larger .",
    "finally , we observed that the condition number was much lower with the wendland radial - basis function ( see ( [ eq : wend ] ) in sec .",
    "[ sec : ad ] ) than with the gaussian radial - basis function  ( [ eq : kernel ] ) .",
    "it remains to explain how to identify the centers @xmath50 and estimate the mean force at these points .",
    "following  @xcite , we will do so using the extended system @xmath51 & \\quad + \\text{thermostat terms at          $ \\beta^{-1}$ }      \\end{aligned }      \\\\[20pt ]      \\displaystyle\\gamma \\dot \\zz = \\kappa ( \\ttheta(\\xx ) - \\zz ) + \\sqrt{2 \\gamma        \\bar \\beta^{-1}}\\ , \\eeta(t )    \\end{cases}\\ ] ] where @xmath52 is the mass matrix , @xmath53 is a white - noise , i.e. a gaussian process with mean 0 and covariance @xmath54 , and @xmath55 , the friction coefficient @xmath56 and the artificial inverse temperature @xmath57 are parameters whose role we explain now .",
    "the system in  ( [ eq : tamd ] ) describes the motion of @xmath2 and @xmath12 over the extended potential @xmath58 as shown in  @xcite , by adjusting the parameter @xmath59 so that @xmath60 and the friction coefficient @xmath61 so that @xmath12 moves slower than @xmath2 , one can generate a trajectory @xmath62 in @xmath63-space which effectively moves at the artificial temperature @xmath64 on the free energy computed at the physical temperature @xmath6 . by taking @xmath65 , the @xmath62 trajectory visits rapidly the regions where the free energy is relatively low ( i.e. within a range of a few  @xmath64 ) even if these regions are separated by barriers which the system would take a long time to cross at the physical temperature @xmath6 .",
    "this gives us a way to determine automatically where are the relevant regions in free energy space .",
    "in  @xcite , the extended system in  ( [ eq : tamd ] ) was proposed to sample the free energy landscape directly . here",
    ", we make a different use of  ( [ eq : tamd ] ) : we utilize the trajectory  @xmath62 to rapidly sweep through @xmath12-space and generate the centers @xmath16 used in the radial - basis representation  ( [ eq : radialbasis ] ) .",
    "specifically , we start from @xmath66 , then deposit a new center @xmath29 along @xmath62 each time @xmath62 reaches a point which is more than a prescribed distance  @xmath67 away from all the previous centers , where @xmath67 is a parameter controlling the density of the covering by the centers ( the smaller @xmath67 , the higher the number of centers deposited ) . at the same time , at each of these centers  @xmath29 , we launch a simulation of  ( [ eq : tamd ] ) with @xmath68 fixed , i.e we use @xmath69         & \\quad + \\text{thermostat terms at $ \\beta^{-1}$ }      \\end{aligned}\\ ] ] and compute : @xmath70 the calculations of these time averages are independent of each other , and hence they can be distributed , using ( ideally ) at least one processor per center @xmath29 , an approach that optimally fits with the purposes of grid computing  @xcite .",
    "the estimator in  ( [ eq : meanforceapprox ] ) has the advantage of being simple , but it introduces an error due to the finiteness of  @xmath71 .",
    "this error can be decreased by using  @xmath71 in  ( [ eq : tamd2 ] ) and  ( [ eq : meanforceapprox ] ) larger than @xmath59 in  ( [ eq : tamd ] ) , or even eliminated by using constrained instead of restrained simulations and using the blue - moon estimator for the mean force  @xcite .",
    "once the centers @xmath72 have been deposited and the estimates @xmath73 of the mean force at these centers have been obtained , we use the reconstruction procedure explained in sec.[sec : reconstruct ] and compute the optimal set of coefficients @xmath35 and the optimal @xmath44 to use in the representation  ( [ eq : radialbasis ] ) for  @xmath7 .",
    "we conclude this section by stressing that using the extended dynamics  ( [ eq : tamd ] ) to sweep through @xmath12-space and deposit the centers  @xmath29 is very different than using it to sample @xmath7 directly , which makes our approach very different from wham or metadynamics .",
    "unlike with sampling , revisiting twice a region in @xmath12-space is unnecessary and even undesirable since no new center will be deposited .",
    "the accuracy of the reconstruction depends on the number of centers and the accuracy at which the mean force is computed in  ( [ eq : meanforceapprox ] ) much more than the precise locations where the centers are deposited .",
    "an important practical consequence is that it is rather straightforward to pick the parameters @xmath59 and @xmath61 in  ( [ eq : tamd ] ) since the final result is robust against variations in these parameters .    ) by forward euler with a time - step @xmath74 for @xmath75 steps ( white curve ) shown above the contour plot of the mueller potential ( with @xmath76 level sets evenly distributed between @xmath77 and @xmath78 in a scale where the minimum of the potential is @xmath77 ) .",
    "the red circles are the locations of the centers deposited along the trajectory using @xmath79 . in this run , @xmath80 centers were deposited.,width=312 ]",
    "since , given the location of the centers @xmath29 , the mean force estimation at these points is quite standard , as a first illustration we use a two - dimensional example for which @xmath81 and @xmath82 where @xmath5 is the mueller potential  @xcite . in this case , there is no need to extend the system as in  ( [ eq : tamd ] ) , and the temperature accelerated dynamics simply reduces to ( setting @xmath83 by appropriate rescaling of time ) @xmath84 fig .",
    "[ fig:1 ] shows a tamd trajectory generated by solving  ( [ eq : tamdex ] ) by forward euler with the initial condition @xmath85 and a time - step of @xmath86 for @xmath75 time - steps at @xmath87 ( for comparison the energy barrier between the two main minima of the mueller potential is about @xmath88 ) .",
    "also shown are the centers @xmath89 obtained by depositing a new center along the trajectory each time the trajectory reaches a point which is @xmath79 away for all the previous centers . in this run ,",
    "@xmath80 centers were deposited . at the centers",
    ", we used @xmath90 as estimate of the `` mean force '' ( i.e. there is no sampling error in the present example ) .",
    "we then used these data to reconstruct the free energy as explained in sec .",
    "[ sec : reconstruct ] .",
    "[ fig : muelsweepres ] shows the residual per center @xmath49 defined in  ( [ eq : resid ] ) .",
    "the optimal @xmath27 for this run was @xmath91 and the condition number at this @xmath44 was @xmath92 .",
    "the level sets of the reconstructed potential are shown in fig .",
    "[ fig:2 ] and compared to those of the original mueller potential , while fig .",
    "[ fig : muelsweeptrj1 ] compares the values of the original and reconstructed mueller potential along the tamd trajectory shown in fig .",
    "[ fig:1 ] . as a simple estimate of the error",
    ", we used : @xmath93 where @xmath94 denotes the reconstructed potential and @xmath95 is the domain in which the original potential remains less than @xmath96 above its minimum value .",
    "the error defined in  ( [ eq : error1 ] ) for this calculation was @xmath97 .",
    "these results , which are already very good , can be improved by diminishing @xmath67 and thereby increasing the number of centers without having to increase the length of the tamd trajectory .",
    "for example , by taking @xmath98 , we obtained @xmath99 centers in a trajectory still @xmath100 steps long .",
    "using these centers to reconstruct the mueller potential , we obtained @xmath101 .",
    "the level sets of the reconstructed and original potential defined in fig .",
    "[ fig:2 ] now overimposed so perfectly that they could not be distinguished on the scale of fig .",
    "[ fig:2 ] ( data not shown ) .",
    "the optimal @xmath27 for this calculation was @xmath102 , at which value the residual was @xmath103 and the condition number was @xmath104 .",
    "finally , we note that the result can also by improved by keeping the same distance @xmath98 between centers but increasing the length of the tamd trajectory .",
    "for instance , increasing the number of steps to @xmath105 produced a reconstruction with an error @xmath106 ( data not shown ) .",
    "defined in  ( [ eq : resid ] ) for the reconstruction of the mueller potential with the @xmath107 steps single - sweep trajectory shown in fig .",
    "[ fig:1 ] .",
    "the optimal @xmath27 for this run was @xmath91.,width=312 ]    ) ( black curve ) .",
    "here we use the @xmath80 centers shown in fig .",
    "[ fig:1 ] .",
    "the optimal @xmath27 is @xmath91 , see fig .",
    "[ fig : muelsweepres ] .",
    "we show 29 level sets evenly distributed between @xmath77 and @xmath78 .",
    "the level sets of the reconstructed potential and the original one are in so close agreement that they can only be distinguished in some localized regions ( e.g. near the saddle point between the two minima in the lower right corner ) . , width=312 ]",
    "because metadynamics  @xcite also uses an extended dynamical system for @xmath2 and @xmath12 and the gaussian packet  ( [ eq : kernel ] ) to represent @xmath7 , the single - sweep method bears similarities with it . yet",
    ", there is an essential difference between the two methods . unlike the single - sweep method , metadynamics",
    "does not use the mean force , and estimates @xmath7 by direct sampling , which turns out to be a less efficient way to proceed .",
    "let us elaborate on this claim .",
    "recall that metadynamics uses an extended system like  ( [ eq : tamd ] ) but where the equation for @xmath12 is replaced by  @xcite @xmath108 here @xmath6 is now the physical temperature of the system , and @xmath59 and @xmath61 are parameters playing the same role as in  ( [ eq : tamd ] ) .",
    "the integral term in  ( [ eq : zzmeta ] ) is a flooding term ( with @xmath109 controlling the flooding rate ) which deposits gaussian packets  @xmath110 on the energy landscape wherever @xmath62 goes , thereby progressively leveling the effective free energy landscape felt by  @xmath62 .",
    "the negative of the integral of the gaussian packets deposited then gives an approximation of the free energy . for a trajectory with @xmath111 time - steps of size  @xmath112 ,",
    "the time - discretized approximation of this integral reads ( compare  ( [ eq : radialbasis ] ) ) @xmath113 where @xmath18 is a constant used to adjust the height of @xmath19 .",
    "steps single - sweep trajectory shown in fig .",
    "[ fig:1 ] .",
    "the green line shows the absolute value of the difference between the two.,width=312 ]    despite the fact that  ( [ eq : freemeta ] ) uses gaussian packets which are radial - basis functions , the representation  ( [ eq : freemeta ] ) is very different from the standard radial - basis representation  ( [ eq : radialbasis ] ) used in the single - sweep method . in particular , there are no coefficients @xmath25 to adjust in  ( [ eq : freemeta ] )",
    "this has the important consequence that , instead of requiring a single sweep across @xmath12-space to get an accurate estimate of the free energy , metadynamics requires that the trajectory revisits many times the same locations in @xmath12-space to deposit centers ( i.e. @xmath111 in  ( [ eq : freemeta ] ) must be much larger than @xmath33 in  ( [ eq : radialbasis ] ) to achieve the same accuracy ) .",
    "this is because the leveling out achieved by the integral term in  ( [ eq : zzmeta ] ) and , hence , the convergence of the representation  ( [ eq : freemeta ] ) , only occur statistically  @xcite ( in contrast , the mean force data used at each center in the single sweep method contains already all the statistical information needed at that center ) .",
    "this is consistent with metadynamics being in essence an histogram method , albeit one where the histogram windows are adjusted on - the - fly .",
    "steps overimposed on the original mueller potential.,width=312 ]    what this entails in terms of efficiency can be illustrated on the two - dimensional mueller example considered before . in this example , to generate the metadynamics trajectory we used  ( [ eq : tamdex ] ) with flooding terms added as in  ( [ eq : zzmeta ] ) , consistent with what was done in ref .",
    "@xcite to test the efficiency of metadynamics in a similar set - up .",
    "[ fig : muelmetaxy ] shows the metadynamics trajectory obtained by integrating  ( [ eq : zzmeta ] ) for @xmath75 timesteps with a time - step of @xmath114 ( same as in the single - sweep method for the results shown in figs .",
    "[ fig:1 ] to  [ fig : muelsweepres ] ) . as can be seen in fig .",
    "[ fig : muelmetaxy ] , this number of timesteps was enough for the trajectory to visit the important regions of the potential . the reconstructed free energy from this calculation is compared in fig .",
    "[ fig:6 ] to the original one .",
    "the metadynamics result is also compared in fig .  [ fig:6b ] to the one obtained by the single - sweep method with @xmath80 centers .",
    "the error  ( [ eq : error1 ] ) for this metadynamics calculation was @xmath115 , i.e. almost two orders of magnitude higher than with the single - sweep method .",
    "[ fig : muelmetatrj1 ] shows the original and reconstructed mueller potential along the metadynamics trajectory ( blue and red lines , respectively ) , together with the absolute value of their difference ( green line ) . by comparing figs .",
    "[ fig : muelsweeptrj1 ] and  [ fig : muelmetatrj1 ] , it can be seen that the discrepancy between the original and reconstructed potential is much larger with metadynamics than with the single - sweep method on trajectories of the same length .",
    "note that these results clearly indicates that it is not sufficient that the metadynamics trajectory visits once a region on phase space to get an accurate representation of the free energy in this region .",
    "this was already noted in refs .",
    "@xcite .",
    "steps with a time - step of @xmath74 ( same as in figs.[fig:1 ] and  [ fig:2 ] ) .",
    "we only use 10 level sets evenly distributed between @xmath77 and @xmath78 because the differences between the maps are much bigger than with the single - sweep method and drawing more level sets makes the figure difficult to read .",
    "( there are only seven black level sets in the energy reconstructed by metadynamics because it levels off around @xmath116.),width=312 ]     steps and a time - step of @xmath74 .",
    "other representation of these contourplots were already shown in figs .",
    "[ fig:2 ] and  [ fig:6 ] respectively .",
    "the map reconstructed by the single - sweep method is very close to the map of the original mueller potential .",
    "the colormaps used in both panels are the same and the reconstructed potentials are shifted so that their minimum is @xmath77 ; the white region in the left panel is where the energy is above @xmath96 and is not shown ( the result of metadynamics shown in the right panel levels off around @xmath116 which is why there is no white).,width=312 ]     steps and a time - step of @xmath74 .",
    "other representation of these contourplots were already shown in figs .",
    "[ fig:2 ] and  [ fig:6 ] respectively .",
    "the map reconstructed by the single - sweep method is very close to the map of the original mueller potential .",
    "the colormaps used in both panels are the same and the reconstructed potentials are shifted so that their minimum is @xmath77 ; the white region in the left panel is where the energy is above @xmath96 and is not shown ( the result of metadynamics shown in the right panel levels off around @xmath116 which is why there is no white).,width=312 ]    we were able to improve the metadynamics result by extending the simulation to @xmath117 steps .",
    "the covering of the important regions in the potential was now extensive ( data not shown ) , and the reconstructed potential ( data not shown ) looked visually better than the one obtained with the shorter trajectory . yet",
    "the error  ( [ eq : error1 ] ) was @xmath118 , i.e. still two orders of magnitude larger than the highest error we obtained with the single - sweep method using a 10 times shorter trajectory .",
    "we did not attempt to go to longer runs with metadynamics because the memory term in  ( [ eq : zzmeta ] ) makes such simulations increasingly expensive ( their cost scales as the square of the number of timesteps ) .",
    "it should also be stressed that in all these calculations , we optimized the parameters @xmath119 , @xmath27 and @xmath6 the best we could .",
    "this optimization , however , turns out to be complicated since there is no systematic way to perform it because , unlike with the single - sweep method , there is no objective function to minimize in metadynamics .",
    "the results shown in figs .  [ fig : muelmetaxy][fig : muelmetatrj1 ] were obtained with @xmath120 , @xmath121 and @xmath122 .    to be fair , we should conclude this comparison by mentioning that the simplicity of the mueller potential example tends to exaggerate the gain that the single sweep method provides over metadynamics .",
    "indeed , in realistic situations , the single - sweep method also requires to compute the mean force via  ( [ eq : meanforceapprox ] ) , an operation which was unnecessary in the mueller example since the force was readily available . computing the mean force adds an extra cost to the method .",
    "it is worth stressing again , however , that the computation of the time averages in  ( [ eq : meanforceapprox ] ) can be distributed over several processors .",
    "this means that in the ideal situation where the user has at least one processor per center , the effective time to compute all of the mean forces is the same as the one for computing a single one of these forces , i.e. we have perfect scalability .",
    "metadynamics can be parallelized per replica as well , as was proposed in refs .",
    "@xcite , but not as straightforwardly and not with perfect scalability .",
    "indeed , in all of these versions of metadynamics , the simulated replica are never completely independent from each other .",
    "steps metadynamics shown in fig .",
    "[ fig : muelmetaxy ] .",
    "the green line shows the absolute value of the difference between the two .",
    "the green line here should be compared with the one in fig .",
    "[ fig : muelsweeptrj1 ] for the single - sweep method : the discrepancy between the original and reconstructed potential is always larger with metadynamics than with the single - sweep method.,width=312 ]",
    "in this section , we use the single - sweep method to reconstruct the free energy of the solvated alanine dipeptide ( ad ) molecule in two and four torsion angles at @xmath123  k. while ad is not an example of biochemical interest _ per  se _ , we study it because it has been extensively used as a benchmark example for free energy calculations in the literature  @xcite . on top of this",
    "the system is simple enough that we can use it to systematically investigate how the accuracy of the reconstruction method depends on the number of centers and how robust the method is with respect to statistical errors in the input data for the mean forces .",
    "another question we investigate in this section is the robustness of the method against the choice of radial - basis functions . specifically , we compare results obtained using the gaussian packet  ( [ eq : kernel ] ) and the wendland function @xmath124 where @xmath125 if @xmath126 , and @xmath127 otherwise .",
    "( [ eq : wend ] ) is another well - known example of radial - basis function which has the pleasant property that it is compactly supported .",
    "this property is appealing in the calculations since it limits the range over which centers interact in  ( [ eq : objective ] ) .",
    "all md simulations reported below were performed with a version of the moil code  @xcite suitably modified by us , and the amber / opls  @xcite force field ( for details of the md set - up see appendix  [ sec : md ] ) .",
    "we use the standard dihedral angles @xmath128 and @xmath129 . at  @xmath123  k ,",
    "the system is confined in a region of the @xmath130 space with @xmath131 by energy barriers higher than @xmath6 . in order to overcome these barriers and sweep through the whole @xmath132",
    "^ 2 $ ] space , we generated a trajectory by using  ( [ eq : tamd ] ) with @xmath133 , @xmath134  kcal / mol / rad@xmath135 , a friction coefficient @xmath136  kcal@xmath137ps / mol / rad@xmath135 and an artificial temperature @xmath138  kcal / mol . with this choice of the parameters , the important regions of the @xmath132 ^ 2 $ ] space",
    "were visited in @xmath139 steps ( @xmath140  ps in the time units of the md variables ) .",
    "the time series of @xmath128 and @xmath129 along this trajectory are shown in fig .",
    "[ fig : adtrj ] . variations in @xmath59 , @xmath61 and @xmath141 led to qualitatively similar tamd trajectories , indicating that the the method is robust with regard to the choice of these parameters .",
    "sets with a different number  @xmath33 of centers were deposited along the tamd trajectory afterwards by processing this trajectory using various distances  @xmath67 between the centers . specifically , we generated sets of @xmath142 , @xmath143 , @xmath144 , @xmath145 , @xmath146 and @xmath147 centers using , respectively , @xmath148 , @xmath149 , @xmath150 , @xmath151 , @xmath152 , @xmath153 .     and @xmath129 along the @xmath140  ps long tamd trajectory for the solvated alanine dipeptide ( ad ) . , width=312 ]",
    "given a set of @xmath33 centers @xmath154 , we computed the mean forces via @xmath33 independent md simulations with restraints at @xmath155 , i.e. by simulating  ( [ eq : tamd2 ] ) in the isokinetic ensemble at @xmath123  k , and estimated the mean force via  ( [ eq : meanforceapprox ] ) with @xmath156  kcal / mol / rad@xmath135 .",
    "this value of @xmath157 was high enough since we checked that the reconstructed free energy remained invariant with higher values of  @xmath157 ( we did so up to @xmath158  kcal / mol / rad@xmath135 ) .",
    "we then used this data in the reconstruction procedure explained in sec .",
    "[ sec : reconstruct ] .",
    "note that since the free energy in the @xmath130 angle is periodic , we have to periodically extend the centers for the representation .",
    "this amounts to changing the representation in  ( [ eq : radialbasis ] ) into @xmath159 where @xmath160 is the unit vector in @xmath21 . in practice ,",
    "only few periodic replica of the centers are needed ( i.e. @xmath161 for @xmath162 ) because the radial - basis functions centered at the centers further away from the cell under consideration make negligible contributions to the result in this cell .",
    "we first detail our result with this choice of parameters to pick an example which led to a good balance between accuracy and efficiency .",
    "other choices of parameters are discussed below .",
    "thus , fig .",
    "[ fig:7 ] shows the reconstructed free energy map obtained with @xmath163 ( @xmath145 centers ) and by computing the mean forces from  ( [ eq : meanforceapprox ] ) with @xmath164  ps .",
    "the optimal @xmath27 in this calculation was @xmath165 . in the figure",
    ", the minimum of the free energy is set at @xmath166  kcal / mol , and contour levels are plotted at @xmath167  kcal / mol , @xmath168  kcal / mol and then every @xmath168  kcal / mol .",
    "the centers are represented as white circles , and the mean forces at the centers as arrows .     and @xmath129 dihedral angles at @xmath123  k calculated with the single - sweep method by using @xmath145 centers deposited at a distance of @xmath163 from each other .",
    "units for the free energy are kcal / mol , and contour levels are plotted at @xmath167  kcal / mol , @xmath168  kcal / mol , and then every @xmath168  kcal / mol .",
    "the optimal @xmath27 in this reconstruction was @xmath169 .",
    "the centers are represented as white circles .",
    "at every center , the corresponding mean force vector is also shown .",
    "mean forces were calculated by using  ( [ eq : meanforceapprox ] ) with @xmath156  kcal / mol / rad@xmath135 and @xmath164  ps.,width=312 ]    since the free energy map depends on the force field used , comparison with results in the literature is difficult . to assess the accuracy of our result self - consistently , we compared it with the free energy calculated by computing the pdf of @xmath128 and @xmath129 from a direct md simulation ( dmds ) of about @xmath170  ns .",
    "while this trajectory does not cover all the @xmath132 ^ 2 $ ] space , it covers the important regions and allows for an unbiased estimation of the free energy in these regions which can be used as benchmark .",
    "the left panel in fig .",
    "[ fig:8 ] shows the contour levels of the free energy from the single - sweep ( black lines ) and that from dmds ( red lines ) .",
    "the contour levels are plotted at @xmath171  kcal / mol ( dotted lines ) , every @xmath167  kcal / mol from @xmath167 to @xmath172  kcal / mol , and then every @xmath173  kcal / mol . as can be seen , single - sweep results agree remarkably well with those of the dmds .    in terms of cost , to generate the result shown in fig .",
    "[ fig:7 ] , we had to make one simulation run of @xmath140  ps to generate the tamd trajectory , plus @xmath145 independent runs of @xmath174  ps distributed on different nodes ( the additional cost of estimating the parameters @xmath35 and @xmath44 to use in  ( [ eq : radialbasis ] ) is insignificant ) .",
    "this makes for a total of @xmath175  ns of absolute simulation time .",
    "however , after distribution , the effective simulation time needed is only @xmath142  ps . on top of this , we show below that a good estimate of the free energy can be obtained with as low as 90 centers ( i.e. with an absolute simulation time of @xmath176  ns and the same effective simulation time ,  @xmath142  ps ) . for comparison , in ref .",
    "@xcite ensing  _ et al .",
    "_ report a @xmath172  ns calculation performed with metadynamics to estimate the free energy of ad in @xmath128 and @xmath129 .",
    "it is not clear how well this metadynamics calculation can be parallelized to reduce its effective cost ( it was not parallelized in ref .",
    "in addition , the result of this metadynamics calculation is unlikely to be as accurate as the one in fig .",
    "[ fig:7 ] ( in ref .  @xcite",
    "no comparison like the one shown in fig .",
    "[ fig:8 ] is provided )     centers , the right panel the one with @xmath147 centers .",
    "the contour levels of the free energy are plotted at @xmath171  kcal / mol ( dotted lines ) , from @xmath167 to @xmath177  kcal / mol separated by @xmath167  kcal / mol , and then separated by @xmath173  kcal / mol.,width=325 ]      next we analyze how robust are the results with respect to the statistical error in the mean force data and the choice of radial - basis function .",
    "we also analyze convergence in function of the number of centers . as reference value , we take the free energy reconstructed with @xmath178 ( @xmath147 centers ) and @xmath179  ps of time averaging in  ( [ eq : meanforceapprox ] ) .",
    "the map of the free energy calculated with these parameters ( data not shown ) is visually very similar to the one shown in fig .",
    "[ fig:7 ] , but it is more accurate . the residual error can be estimated from the right panel of fig .",
    "[ fig:8 ] which shows the contour levels of the free energy from the single - sweep ( black lines ) and that from dmds ( red lines ) : these level sets coincide up to statistical errors in the dmds , indicating that the free energy provided by the single sweep method with @xmath147 centers and @xmath179  ps can indeed be taken as an `` exact '' benchmark .",
    "and @xmath129 reconstructed with gaussian functions using @xmath147 centers and @xmath179  ps . the figures in the different panels correspond to various number of centers and length of time averaging for the mean forces , as indicated .",
    "units are kcal / mol .",
    "note that the scale of the colormap is different from the one in fig .",
    "[ fig:7 ] . in particular , the differences are mostly below @xmath167  kcal / mol with @xmath144 centers and @xmath174  ps simulations already.,width=312 ]    fig .",
    "[ fig : diffsad ] shows the differences between the map of the reference free energy reconstructed with @xmath178 ( @xmath147 centers ) and @xmath179  ps and those reconstructed with less centers and shorter restrained simulations .",
    "the largest errors are in the regions corresponding to the highest peaks of the free energy ( these are also the regions were the least centers were deposited ) .",
    "the differences never exceed @xmath180  kcal / mol with @xmath142 centers and @xmath164  ps and they fall mostly below @xmath167  kcal / mol with @xmath144 centers and @xmath164  ps already .",
    "we also compared the quality of the reconstruction of the free energy when using gaussian  ( [ eq : kernel ] ) and wendland  ( [ eq : wend ] ) basis functions .",
    "[ fig : resad ] shows the residual per center versus the number of centers for ad , by using gaussian ( filled symbols ) and wendland ( empty symbols ) basis functions , using @xmath164  ps ( diamonds ) and @xmath179  ps ( circles ) long restrained simulations to estimate the mean forces . at equal values of @xmath33 and @xmath181 , the reconstruction is slightly more accurate with gaussian than with wendland functions , though these differences turn out to be quite small in terms of the free energy maps themseves ( data not shown ) .     and @xmath129 angles .",
    "data are from calculations with different time averaging length , using gaussian ( g ) and wendland ( w ) basis functions.,width=312 ]    using longer simulations for the mean force ( which means a smaller random error on these forces ) also improves the results . with @xmath147 centers and @xmath179  ps long simulations for the mean forces , the maps reconstructed with gaussian and wendland basis functions were almost identical ( data not shown ) , and they were not significantly different from the map shown in fig .",
    "[ fig:7 ] .",
    "these results , however , were obtained at very different values of optimal  @xmath27 : @xmath182 with gaussians and @xmath183 with wendland functions .",
    "the condition numbers at the optimal @xmath27 were @xmath184 and @xmath185 , respectively , which is low .",
    "note that the same trends here described were observed in a periodic test case for which the potential was known exactly ( data not shown ) .      as a second more challenging test , we computed the free energy of ad in the four torsion angles , @xmath128 , @xmath129 , @xmath186 , and  @xmath187 .",
    "a tamd trajectory of @xmath188  ps was generated by using  ( [ eq : tamd ] ) with @xmath189 , @xmath134  kcal / mol / rad@xmath135 , an artificial temperature @xmath190  kcal / mol , friction coefficients @xmath136  kcal@xmath137ps / mol / rad@xmath135 for @xmath128 and @xmath129 and @xmath83  kcal@xmath137ps / mol / rad@xmath135 for @xmath186 and @xmath187 .",
    "the md potential keeps the amide planes in _",
    "trans _ configuration , and so @xmath186 and @xmath187 were varying in the range @xmath191 $ ] . in @xmath188",
    "ps , the tamd trajectory covered well the accessible state space for @xmath128 , @xmath129 , @xmath186 and @xmath187 , in the sense that the time series for these angles were similar in their respective state space to those shown in fig .",
    "[ fig : adtrj ] ( notice however that extensive coverage of the four - dimensional space is unlikely in so short a run ) . along the tamd trajectory ,",
    "@xmath192 centers at a distance of @xmath193 were deposited . at these centers , the mean forces @xmath40 were computed by using  ( [ eq : meanforceapprox ] ) with @xmath156  kcal / mol / rad@xmath135 and @xmath164  ps ( i.e. the absolute time of simulation was about @xmath194  ns , but the effective time after distribution was @xmath195  ps only ) .",
    "we used these @xmath40 in the objective function  ( [ eq : objective ] ) to finally get the representation  ( [ eq : radialbasis ] ) of the four - dimensional free energy  @xmath196 .",
    "the optimal @xmath27 in this representation was @xmath197 and the condition number at this value of @xmath27 was @xmath198 .    , @xmath129 , @xmath186 angles obtained from the marginal in these angles of the pdf associated with the free energy in four angles @xmath196 .",
    "data are represented for @xmath199 $ ] .",
    "note that the scale of the colormap is different from the one in fig .",
    "[ fig:7],width=312 ]    since a full graphical representation of  @xmath200 is not possible , we did several tests to validate our result .",
    "[ fig:9 ] shows the three dimensional free energy @xmath201 obtained from the marginal in these angles of the pdf associated with @xmath200 .",
    "this marginal was calculated _ a  posteriori _ by numerical integration over @xmath187 of @xmath202 with the full @xmath200 reconstructed by the single - sweep method .",
    "the map is reasonable , and shows nontrivial features in all three directions .",
    "[ fig:10 ] shows the two dimensional free energy @xmath203 obtained from the marginal in these angles of the pdf associated with @xmath196 .",
    "the map is in remarkably good agreement with the one in fig .",
    "[ fig:7 ] .    as a further test of accuracy ,",
    "we re - calculated the mean force using  ( [ eq : tamd2 ] ) and  ( [ eq : meanforceapprox ] ) using a different set of centers than those used in  ( [ eq : radialbasis ] ) .",
    "then we estimated the relative error between these mean forces and the ones obtained by taking the negative gradient of the reconstructed  @xmath196 using the original set of centers and mean forces : @xmath204 where @xmath205 are the new centers and @xmath206 are the mean forces at these centers .",
    "the new centers were 20 points chosen at random in the domains @xmath207 $ ] ,  @xmath208 $ ] .    , @xmath129 angles obtained from the marginal in these angles of the probability density associated with the free energy in four angles @xmath196 .",
    "contour levels are as in fig .",
    "[ fig:7 ] .",
    "note the remarkable agreement between this map and the one shown in fig .",
    "[ fig:7].,width=312 ]    fig .",
    "[ fig : randtest ] , top panel , shows , for each of these centers , the distance from the closest of the @xmath192 centers ( black line ) .",
    "data are compared to the minimal distance between the @xmath192 centers ( red dashed line ) .",
    "this result shows that , with @xmath193 , these centers fill properly the four dimensional domain in the sense that every new center is always a distance about  @xmath67 to one of the original centers .",
    "[ fig : randtest ] , middle panel , shows the relative error @xmath209 for @xmath210 ( black solid line ) , when @xmath164  ps long restrained simulations are used to compute the mean forces .",
    "the mean value of @xmath209 ( black dashed line ) is @xmath211 , with standard deviation @xmath212 and maximum value @xmath213 . for comparison , the mean value of the relative residual per center ( red dashed line ) is @xmath212 , with standard deviation @xmath214 and maximum value @xmath215 ( red dashed - dotted line ) .",
    "[ fig : randtest ] , bottom panel , shows @xmath209 when @xmath179  ps long restrained simulations are used to compute the mean forces . in this case , the mean value of @xmath209 ( black dashed line ) is @xmath216 , with standard deviation @xmath217 and its maximum value is @xmath218 . for comparison ,",
    "the mean value of the relative residual per center ( red dashed line ) is @xmath212 , with standard deviation @xmath214 and maximum value @xmath219 ( red dashed - dotted line ) .",
    "these results show that , in points away from the original centers , the reconstructed free energy is as accurate as it is at the centers , which is clearly the best we can hope for .     centers ( black line ) , compared with the minimal distance between the @xmath192 centers ( red line ) .",
    "middle and lower panel , relative error @xmath209 defined in  ( [ eq : relerror ] ) for mean forces computed respectively from @xmath174 and @xmath220  ps restrained simulations : the error @xmath209 ( black solid line ) and its mean value ( black dashed line ) , compared with the mean value of the relative residual per center for the @xmath192 centers set ( red dashed line ) and its maximum value ( red dashed - dotted line).,width=312 ]     centers ( black line ) , compared with the minimal distance between the @xmath192 centers ( red line ) .",
    "middle and lower panel , relative error @xmath209 defined in  ( [ eq : relerror ] ) for mean forces computed respectively from @xmath174 and @xmath220  ps restrained simulations : the error @xmath209 ( black solid line ) and its mean value ( black dashed line ) , compared with the mean value of the relative residual per center for the @xmath192 centers set ( red dashed line ) and its maximum value ( red dashed - dotted line).,width=312 ]",
    "in summary , we have proposed a method for the calculation of free energies which is simple , accurate , and efficient .",
    "unlike standard histogram methods such as wham and metadynamics , the single - sweep method uses the mean force computed at a set of centers to reconstruct the free energy .",
    "this set of centers is determined using tamd to rapidly sweep through the important regions of the free energy , and the mean forces at these centers are estimated in a standard way via the computation of a conditional expectation using time - averaging along restrained or constrained simulations . from these data , the free energy @xmath7",
    "is then reconstructed globally by minimization of an objective function to determine the coefficients in a radial - basis function representation of @xmath7 .",
    "if convenient , this reconstruction step can use data for the centers and the mean forces obtained by other means than tamd .",
    "compared with histogram methods and metadynamics , the single - sweep technique combines several advantages :    * it does not require _ a  priori _ knowledge of the free energy since it uses tamd to find the important regions in the landscape automatically .",
    "* the most costly step of the calculation , namely the computation of the mean forces at the centers , can be straightforwardly distributed on different , independent , processors . *",
    "the reconstruction step is variational , i.e. the optimal coefficients in the free energy representation are determined automatically , which limits the number of parameters to adjust beforehand . *",
    "the results can be easily monitored for convergence , and systematically improved if desired .",
    "in particular , new centers can be added on top of previous ones along the same tamd trajectory to increase the accuracy without having to repeat the previous calculation . *",
    "the method can be used in more than 2 dimensions and its computational complexity is the same regardless of the dimension .",
    "we believe that these features make the single - sweep method appealing to calculate the free energy of systems more complicated but also more interesting than the ones studied in this paper .",
    "we thank giovanni ciccotti and david chandler for carefully reading the manuscript ; weinan e for pointing out sparse grid methods which prompted us to test our method in four dimensions ; ron elber and anthony west for their help with the moil code ; sara bonella , simone meloni , michele monteferrante and maddalena venturoli for useful discussions ; and finally , eric darve for suggesting the test using  ( [ eq : relerror ] ) .",
    "this work was partially supported by nsf grants dms02 - 09959 and dms02 - 39625 , and by onr grant n00014 - 04 - 1 - 0565 .",
    "all md simulations were performed with the moil code  @xcite , and the amber / opls @xcite force field as implemented in the code .",
    "a starting structure for the ad molecule ( ch@xmath221-co - nh - c@xmath222hch@xmath221-co - nh - ch@xmath221 ) was solvated in a box of @xmath223 water molecules of volume @xmath224 .",
    "periodic boundary conditions were used .",
    "van der waals interactions were truncated at @xmath225   .",
    "electrostatic interactions were treated with the particle mesh ewald method  @xcite with real space cutoff @xmath225   , a grid of @xmath226 points , and @xmath172-th order _",
    "b_-splines for the interpolation of the structure factor ( in order to be in the high accuracy range  @xcite ) .",
    "the tip3 model  @xcite was used for the water molecules .",
    "non - bonded interaction lists were updated every @xmath194 steps .",
    "all chemical bonds in the system were kept fixed with the shake algorithm  @xcite .",
    "amide planes were restrained to be always in _",
    "trans _ configuration .",
    "the velocity verlet algorithm was used for the dynamics of the cartesian variables with time - step @xmath168  fs , and all velocities were scaled at every step to keep the temperature at @xmath123  k. in order to obtain the initial configuration for the temperature accelerated md simulation ( tamd ) , the system was first equilibrated for @xmath88  ps by keeping the solute molecule fixed ( i.e. by zeroing forces and velocities of its atoms ) and by assigning to all water atoms at every step velocities sampled from a maxwell distribution at @xmath123  k. then , the whole system was simulated for @xmath227  ps for equilibration .",
    "the torsion angles used in the simulations are defined by the quadruplets of atoms ( c , n , c@xmath222,c ) and ( n , c@xmath222,c , n ) for @xmath128 and @xmath129 , and ( o , c , n , c@xmath222 ) and ( c@xmath222,c , n , h ) for @xmath186 and @xmath187 . in the tamd simulation ,",
    "the equations of motion of the collective variables were integrated with the forward euler scheme with time - step @xmath168  fs , @xmath136  kcal@xmath137ps / mol / rad@xmath135 for @xmath128 and @xmath129 and @xmath83  kcal@xmath137ps / mol / rad@xmath135 for @xmath186 and @xmath187 .",
    "the force constant for the restraint potential was @xmath134  kcal / mol / rad@xmath135 , and the effective temperature such that @xmath228  kcal / mol .",
    "the cartesian coordinates of water and ad atoms were saved during the tamd simulation . in this way , for every center @xmath29 deposited along the trajectory in collective variables space",
    ", there is a corresponding configuration @xmath229 of the system in cartesian space such that @xmath230 .",
    "we used these configurations as initial conditions for the restrained simulations at the centers .",
    "data for the mean force calculations were accumulated after further relaxation of the system for @xmath231  ps ."
  ],
  "abstract_text": [
    "<S> a simple , efficient , and accurate method is proposed to map multi - dimensional free energy landscapes . </S>",
    "<S> the method combines the temperature - accelerated molecular dynamics ( tamd ) proposed in [ maragliano & vanden - eijnden , chem . </S>",
    "<S> . lett . * 426 * , 168 ( 2006 ) ] with a variational reconstruction method using radial - basis functions for the representation of the free energy . </S>",
    "<S> tamd is used to rapidly sweep through the important regions of the free energy landscape and compute the gradient of the free energy locally at points in these regions . </S>",
    "<S> the variational method is then used to reconstruct the free energy globally from the mean force at these points . </S>",
    "<S> the algorithmic aspects of the single - sweep method are explained in detail , and the method is tested on simple examples , compared to metadynamics , and finally used to compute the free energy of the solvated alanine dipeptide in two and four dihedral angles . </S>"
  ]
}