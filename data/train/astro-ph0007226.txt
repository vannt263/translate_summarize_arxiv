{
  "article_text": [
    "in direct - summation n - body methods , the computational time @xmath2 scales with the square of the particle number @xmath3 , @xmath4 .",
    "this relation inevitably leads to bottlenecks when computing large - n galaxy models .",
    "while it is still impossible to model galaxies star by star over sensible time - laps , alternative algorithms have been developed over a number of years which ease the computer requirements at the expense of the exact @xmath5 summation , yet provide an adequate treatment of newtonian galactic dynamics .",
    "examples of such techniques are the tree method ( barnes & hut 1986 , dav , dubinski & hernquist 1997 ) , and the multi - grid or nested grid particle mesh - codes like pandora ( villumsen 1989 ) , hydra ( pearce & couchman 1997 ) , superbox , or combinations of the methods like the adaptive refinement tree ( art ) ( kravtsov , klypin & khokhlov .",
    "1997 ) , which can cope with very inhomogeneous matter distributions and have high spatial resolution at the density maxima .    while the hierarchical tree - method is independent of the geometry of the problem , its main disadvantage is the limitation in particle number and the softening needed to avoid undesired two - body relaxation .",
    "in contrast , the main advantage of a particle - mesh technique is the ability to use very high particle numbers ( up to several millions on desk - top computers ) , because the cpu - time scales only linearly with the number of particles , and with @xmath6 , where @xmath7 is the number of grid - cells .",
    "high particle numbers keep the statistical noise low .",
    "the disadvantage of a grid - based method , however , is the dependency on the geometry of the grid . but with increasing spatial resolution , the geometry of the cells becomes less important .",
    "the only limitation in resolving phenomena is the size of one grid - cell .",
    "a general discussion and comparison of various numerical schemes will be found in sellwood ( 1987 ) , and  in the context of direct @xmath8-body simulations  in spurzem ( 1999 ) .    the basic idea behind superbox , as originally conceived by r. bien ( bien et al .",
    "1991 ) , is to increase the resolution only at places where it is necessary , while simultaneously keeping the computational overhead as small as possible by using a fixed ( i.e.  not adaptive ) nested grid - architecture .",
    "accuracy is improved by the use of nested high - resolution sub - grids and a linear force interpolation to the exact position of the particle inside a cell .",
    "two higher - resolution sub - grids are introduced : the medium - resolution grid contains an entire galaxy , and the high - resolution grid treats its core . both grids stay focused on the galaxy , moving through the local universe that is contained in the coarse outermost grid .",
    "superbox has already been used successfully in a variety of investigations , namely in the study of the high velocity encounter of the two similar early - type galaxies ngc4782/4783 by madejski & bien ( 1993 ) , in the survey of encounters between elliptical galaxies by wassmer et al .",
    "( 1993 ) , and in the research on tidal disruption of satellite dwarf galaxies by kroupa ( 1997 ) and klessen & kroupa ( 1998 ) . a version of superbox exists that includes sticky particles as a simple model of the dynamics of cold molecular gas clouds ( fellhauer 1996 ) .    in this article we provide an implementation and benchmarks for the superbox algorithm . in section  [ sec : method ] , we lay out the mathematics behind the algorithm and give details of how the potential is mapped on the different grids .",
    "we then move on to test the code : section  [ sec : conserv ] deals with the conservation of energy and angular momentum , while section  [ sec : relax ] discusses relaxation .",
    "section  [ sec : memcpu ] contains profiling information about storage and cpu - time requirements .",
    "comparison with a direct - summation @xmath9-body code is made in section  [ sec : fin_valid ] . in section  [ sec : dynfric ] we show  as an example  the good agreement of satellite decay with chandrasekhar s formula for dynamical friction , and close with conclusions in section  [ sec : conc ] .",
    "detailed discussions of the particle - mesh ( pm ) technique can be found in eastwood & brownrigg ( 1978 ) , hockney & eastwood ( 1981 ) and sellwood ( 1987 ) .",
    "briefly , the array of mass densities , @xmath10 , is derived by counting the number of particles in each cartesian grid cell @xmath11 , i.e. by using the simple particle - in - cell ( ngp = `` nearest grid point '' ) algorithm .",
    "all particles belonging to one galaxy @xmath12 have the same mass , @xmath13 .",
    "an alternative would be to use a cloud - in - cell technique , which is known to improve momentum and energy conservation , in which the mass of the particle is distributed proportionally among the neighbouring cells .",
    "this is , however , not necessary , since the number of particles is large .",
    "poisson s equation is solved for this density array to get the grid - based potential , @xmath14 , which becomes , @xmath15 where @xmath8 denotes the number of grid - cells per dimension ( @xmath16 ) , and @xmath17 is some green s function . to avoid this @xmath18 procedure , the discrete fast fourier transform ( fft ) is used , for which @xmath19 , @xmath20 being an integer .",
    "the stationary green s function is fourier transformed once at the beginning of the calculation , and only the density array is transformed at each time - step : @xmath21 the two resulting arrays are multiplied cell by cell and transformed back to get the grid - based potential , @xmath22 the potential is differentiated numerically to estimate the accelerations for each particle , each of which is pushed forward on its orbit using the leapfrog scheme ( see fig .  [ super ] and sections below ) .",
    "the simplest green s function is adopted , in which the side of a grid cell has unit length : @xmath23 the value of @xmath24 is somewhat arbitrary , and @xmath25 is often used ( see e.g. sellwood 1987 ) .",
    "numerical tests performed with superbox show that for high particle numbers , @xmath26 yields a slightly slower drift in total energy with time ( see also section  [ sec : conserv ] ) than @xmath27 or 1.5 , while for low particle numbers ( compared to the number of grid - cells ) @xmath27 is the better choice .",
    "the reason for this is that for high particle numbers the collective force dominates over the particle  particle ( pairwise ) force . on the other hand , for low particle numbers ( only one or a few particles are together in the same cell ) pairwise forces are more dominant , and it is better to exclude self - gravity ( i.e. a particle feels its own force inside its cell ) , with @xmath27",
    "this is consistent with analytical arguments by d.  pfenniger ( private communication ) .",
    "he shows that in one dimension , @xmath28 minimises the power at the grid wave - number @xmath29 for the kernel ( compare with eq .",
    "[ f2.0c ] ) @xmath30 he finds that the power is exactly cancelled at the wavenumber @xmath29 , and for finite @xmath31 can also be cancelled for a value of @xmath32 close to @xmath33 .",
    "for @xmath34 the power at high frequencies increases , while for @xmath35 some wavenumbers @xmath36 are filtered out . in this sense",
    ", @xmath37 optimises the kernel .",
    "however , the 3d - problem is slightly different since forces instead of the potential are used .",
    "the artificial wavenumbers induced by the grid , that are to be minimised , are then much more numerous .",
    "this problem would need further addressing .",
    "+ the fft - algorithm gives the exact solution of the grid - based potential for a periodical system .",
    "for the exact solution of an isolated system , which is what we are interested in , the size of the density - array has to be doubled ( @xmath38 ) , filling all inactive grid cells with zero density , and extending the green s function in the empty regions in the following way : @xmath39 this provides the _ isolated solution _ of the potential in the simulated area between @xmath40 and @xmath41 .",
    "in the inactive part the results are unphysical . to keep storage as low as possible ,",
    "only a @xmath42-array is used for transforming the densities , and a @xmath43-array is used for the green s function . for",
    "a detailed discussion see eastwood & brownrigg ( 1978 ) and also hockney & eastwood ( 1981 ) .",
    "+ the fft - routine incorporated in superbox is a simple one - dimensional fft and is taken from werner & schabach ( 1979 ) and press et al .",
    "it is fast and makes the code portable and not machine specific . the low - storage algorithm to extend the fft to 3 dimensions , to obtain the 3-d - potential ,",
    "is taken from hohl ( 1970 ) .",
    "the performance of superbox can be increased by incorporating machine - optimised fft routines .      in this section",
    "we explain the force calculation performed in superbox , and compare it with standard methods .",
    "we follow closely the notation of hockney & eastwood ( 1981 ) and couchman ( 1999 ) to document the differences .    with the mass density as an example",
    "we show , in a formal way , how its values on a 3d mesh are obtained . using the @xmath44-functional for the particle shape function , a particle distribution @xmath45 is given by @xmath46 where @xmath47 is a summation index running over all particles , and",
    "@xmath48 is the position vector of particle @xmath47 . as smoothing kernel",
    "we select here @xmath49 @xmath50 denotes a vector of smoothing lengths @xmath51 in three coordinate directions .",
    "@xmath52 is a three dimensional generalisation of the standard top - hat function @xmath53 hence the smoothed mass - density field is @xmath54 where @xmath55 denotes the particle mass , and the @xmath56-operator a convolution as defined by the equation above .",
    "mathematically we get from @xmath57 a so - called mesh sampled functional @xmath58 on a three dimensional mesh by @xmath59 using the three - dimensional comb or sampling function defined as @xmath60 where @xmath11 are indices of grid cells , whose centres are located at the vector points @xmath61 . from the functional @xmath62 a finite set of discrete mesh - sampled density values @xmath63 is obtained , which are defined at the centres of the grid cells .",
    "for each cell centre or mesh point they are computed by integrating @xmath64 over an arbitrarily shaped and sized volume containing just this and only this mesh point .",
    "the standard discrete fft procedure ( see above ) is applied to the set of numbers @xmath65 in order to determine the grid - based potential @xmath66 .",
    "@xmath67 is a set of numbers resulting from the fft and represents the mesh sampled functional @xmath68 , where @xmath69 is a true smooth gravitational potential .",
    "the set of values @xmath67 is obtained from @xmath70 by integrating over volumes containing single mesh points , just in the same way as explained above for @xmath71 .",
    "we define the one - dimensional two - point difference operator for @xmath72 direction in the standard way ( hockney & eastwood 1981 , p. 163 ) , @xmath73 to keep the notation clearer we remain for the moment in one dimension .",
    "a first order difference approximation to the x - component of the acceleration vector is given by @xmath74 sampling this on the mesh yields @xmath75 if this is integrated over volumes containing a single mesh point , again exactly as described above for the cases of @xmath71 and @xmath76 , a set of accelerations @xmath77 defined at the mesh point centres results : @xmath78 here we have assumed that @xmath79 is selected so as to match with the mesh point distances . in our notation",
    "the set of values @xmath80 is denoted by @xmath81 .",
    "the corresponding vector components for the acceleration in @xmath82 and @xmath83 direction are analogous . in the standard particle - mesh schemes ,",
    "the accelerations between the mesh centres are obtained by using the same smoothing kernel as for the density , i.e. @xmath84 the use of the @xmath44-functional for the particle shape and the top - hat function for smoothing gives the rather crude standard ngp scheme , where the acceleration on a particle is constant in each cell and has a discontinuity at the cell boundaries .",
    "a possible improvement regarding energy and momentum conservation is to use a so - called cloud - in - cell or cic scheme , where the shape function of particles is a top - hat function , and the assignment function is a triangle function ( see hockney & eastwood 1981 ) .",
    "however , as one can also see in the cited book , such schemes suffer from force anisotropies , despite having very good conservation properties ( i.e. the magnitude and direction of the force error depends on whether one goes parallel to the mesh coordinates or not ) .",
    "+ therefore a non - standard scheme is applied in superbox .",
    "it is ngp in nature , provides a very good energy and angular momentum conservation and a significant improvement for force anisotropies .",
    "note that the rather involved mathematical formalism above will later yield significant hindsight what is special with superbox .",
    "the notation follows closely hockney & eastwood s and couchman s .",
    "+ we begin with a taylor expansion of the acceleration ( for example the @xmath72-component ) centred on @xmath85 , the position of the centre of cell @xmath11 : @xmath86 where @xmath87 denotes any higher order terms in @xmath88 , @xmath89 , @xmath90 or combinations thereof .",
    "the displacements @xmath88 , @xmath89 and @xmath90 should not be linked or confused with the mesh spacings @xmath91 , @xmath92 , @xmath93 .",
    "they are free and should provide an interpolated expression for @xmath94 at any point inside a given mesh cell , e.g. a particle s position .",
    "we then use the difference approximations @xmath95 + we may now generate a mesh sampled @xmath96 in the standard way and integrate this over any volume containing one grid cell centre to obtain a set of acceleration values @xmath97 given by the following expressions : @xmath98 note that we generally take @xmath99 i.e.  the cell - length is assumed to be equal along the three axes and unity . the accelerations in @xmath82- and @xmath83-direction are calculated analogously .",
    "+ at first glance the interpolation scheme eq .",
    "[ eq:2.2 ] for the acceleration seems to be closely related to the procedure used in a standard cloud - in - cell ( cic ) scheme . in one dimension ,",
    "cic and superbox methods can be more easily compared to each other . for @xmath100 one",
    "has @xmath101 where @xmath102 denotes the cell - index .",
    "clearly this is different , because cic uses accelerations in _ two _ neighbouring cells , while superbox takes acceleration and its derivative only in _",
    "one _ cell .",
    "therefore we propose to consider superbox as an ngp type scheme , although a second order interpolated acceleration is used , because nowhere the acceleration of the neighbouring cell is entering into the equations .",
    "though of ngp nature , @xmath94 in superbox behaves steadily when crossing cell boundaries along the @xmath72-axis ( and @xmath103 , @xmath104 correspondingly on their respective axes ) .",
    "in contrast to cic our scheme is not steady in any other direction .",
    "however , the errors induced by that are much smaller than in a standard ngp scheme due to the above higher order interpolation , and are perfectly tolerable as will be shown throughout this paper .    the salient feature of superbox regarding the force anisotropies can be understood by considering the force at a distance @xmath105 from a particle located at the centre of a cell .",
    "to lowest order the superbox force - error @xmath106 is then @xmath107 where @xmath108 is the displacement vector from the cell centre , and we have neglected all terms of second order in @xmath91 , @xmath92 , or @xmath93 in a taylor series expansion of the potential differences . in other words to lowest order the superbox force error points to the exact centre of the cell .",
    "thus , compared with standard ngp schemes , we get a very precise force - calculation in superbox , as shown in figs .",
    "[ forcex ] and [ forcexy ] .",
    "+    = 8.5 cm    = 8.5 cm    the orbits of the particles are integrated forward in time using the leapfrog scheme .",
    "for example , for the @xmath72-components of the velocity , @xmath109 , and position , @xmath72 , vectors of particle  @xmath110 , @xmath111 where @xmath31 denotes the @xmath31th time - step and @xmath112 is the length of the integration step .",
    "+      for each galaxy , 5  grids with  3 different resolutions are used .",
    "this is made possible by invoking the additivity of the potential ( fig .",
    "[ gitter ] ) .",
    "= 8.0 cm = 8.cm    the five grids are as follows :    * grid 1 is the high - resolution grid which resolves the centre of the galaxy .",
    "it has a length of @xmath113 in one dimension . in evaluating the densities , all particles of the galaxy within @xmath114",
    "are stored in this grid .",
    "* grid 2 has an intermediate resolution to resolve the galaxy as a whole .",
    "the length is @xmath115 , but only particles with @xmath114 are stored here , i.e. the same particles as are also stored in grid  1 . *",
    "grid  3 has the same size and resolution as  grid 2 , but it only contains particles with @xmath116 . *",
    "grid  4 has the size of the whole simulation area ( i.e. local universe with @xmath117 ) , and has the lowest resolution .",
    "it is fixed .",
    "only particles of the galaxy with @xmath118 are stored in grid 4 .",
    "* grid  5 has the same size and resolution as grid  4 .",
    "this grid treats the escaping particles of a galaxy , and contains all particles with @xmath119 .",
    "grids  1 to  3 are focused on a common centre of the galaxy and move with it through the local universe , as detailed below .",
    "all grids have the same number of cells per dimension , @xmath8 , for all galaxies .",
    "the boundary condition , requiring two empty cells with @xmath120 at each boundary , is open and non - periodic , thus providing an isolated system .",
    "this however means that only @xmath121 active cells per dimension are used .",
    "+ to keep the storage requirement low , all galaxies are treated consecutively in the same grid - arrays , whereby the particles belonging to different galaxies can have different masses .",
    "each of the  5 grids has its associated potential @xmath122 computed by the pm technique from the particles of one galaxy located as described above .",
    "the accelerations are obtained additively from the  5 potentials of each galaxy in turn in the following way : @xmath123 \\cdot    \\theta(r_{\\rm out}-r ) \\\\    & + & \\theta(r - r_{\\rm out } ) \\cdot \\phi_{4 } + \\phi_{5}\\ ,    \\nonumber \\\\",
    "\\phi(r_{\\rm core } ) & = & \\phi_{1 } + \\phi_{3 } + \\phi_{5 } \\nonumber    \\\\    \\phi(r_{\\rm out } ) & = & \\phi_{2 } + \\phi_{3 } + \\phi_{5 } \\nonumber\\end{aligned}\\ ] ] where @xmath124 for @xmath125 and @xmath126 otherwise .",
    "this means :    * for a particle in the range @xmath114 , the potentials of grids 1 , 3 and 5 are used to calculate the acceleration . * for a particle with @xmath127 , the potentials of grids  2 , 3  and 5  are combined . * and finally ,",
    "if @xmath119 then the acceleration is calculated from the potentials of grids  4 and  5 . * a particle with @xmath128",
    "is removed from the computation .",
    "due to the additivity of the potential ( and hence its derivatives , the accelerations ) the velocity changes originating from the potentials of each of the galaxies can be separately updated and accumulated in the first of the leap - frog formulas eq .",
    "[ f2.2a ] .",
    "the final result does not depend on the order by which the galaxies are taken into account and it could be computed even in parallel , if a final accumulation takes place .",
    "after all velocity changes have been applied in all galaxies , the positions of the particles are finally updated ( see fig .  [ super ] ) .",
    "+ as long as the galaxies are well separated , they feel only the low - resolution potentials of the outer grids .",
    "but as the galaxies approach each other their high - resolution grids overlap , leading to a high - resolution force calculation during the interaction .      two alternative schemes to position and track the inner and middle grids can be used .",
    "the most useful scheme centres the grids on the density maximum of each galaxy at each step .",
    "the position of the density maximum is found by constructing a sphere of neighbours centred on the densest region , in which the centre of mass is computed .",
    "this is performed iteratively .",
    "the other option is to centre the grids during run - time on the position of the centre of mass of each galaxy using all its particles remaining in the computation .",
    "it is shown in fig .",
    "[ gitter ] that only spherical regions of the cubic grids contain particles ( except for grid 5 ) .",
    "particles with eccentric orbits can cross the border of two grids , thus being subject to forces resolved differently .",
    "no interpolation of the forces is done at the grid - boundaries .",
    "this keeps the code fast and slim , but the grid - sizes have to be chosen properly in advance to minimise the boundary discontinuities . as shown in section  [ sec : relax ] , this leads to some additional but negligible relaxation - effects , because the derived total potential has insignificant discontinuities at the grid - boundaries ( wassmer 1992 ) .",
    "the best way to avoid these edge - effects is to place the grid - boundaries at places where the slope of the potential is not steep .",
    "[ edge ] shows that , as long as the grid - sizes are chosen properly , there are no serious effects at the grid - boundaries . only in the example shown in the bottom - right panel",
    "the innermost grid was chosen too small , leading to a low particle number per grid - cell . performing such computations with @xmath129",
    "leads to spurious results , as explained in section  [ sec : green ] .",
    "nevertheless the profile is smooth at the grid - boundary .",
    "superbox employs model units , with the gravitational constant in model units being @xmath130 owing to historical reasons .",
    "a flag specifies if the user wants to input and output data in physical units ( i.e. kpc , m@xmath131 , km / s , myr ) . scaling to and from physical units",
    "is achieved via the formulae : @xmath132 where @xmath133 is the length , @xmath134 the mass , @xmath135 the time , @xmath136 the velocity and @xmath137 the gravitational constant .",
    "the model length unit is taken to be @xmath138 for the length of @xmath139 of galaxy  1 .",
    "the corresponding physical length scale , @xmath140 , is taken from the input data that specifies the length of this grid .",
    "the physical mass of the first galaxy , @xmath141 , is taken to be unity in model units , @xmath142 .",
    "the integration step - size , @xmath143 , is specified by the user .",
    "the step - size in model units , @xmath144 , follows from eq .",
    "[ eq : scaling ] .",
    "+ converting factors for each grid of all galaxies are calculated to get the forces and accelerations , due to the fft and the differentiation of the potentials requiring a cell - length of unity .",
    "in order to check how well energy and angular momentum are conserved , calculations with isolated plummer - spheres in virial equilibrium with different particle numbers , time - steps and grid - resolutions are presented here . to have a non - vanishing angular momentum vector in @xmath83-direction for the isolated galaxy model ,",
    "all particle orbits are taken to have the same direction in the @xmath145-plane .",
    "this procedure does not change any other properties of the plummer - model , but makes it possible to check for relative changes in angular momentum .",
    "calculating the correct potential energy of a stellar system requires summing all two - body interactions between all particles .",
    "this is quite impossible for @xmath146 . by using the available grid - based approximation and adding up only the mean potential values of the cells for each particle , a useful estimate of the total potential energy",
    "is obtained .",
    "if , on the other hand , the deviation from the centre of the cell and contributions from the neighbouring cells were taken into account to obtain a more accurate estimate , then cpu - time would have to be used for an arguably purposeless endeavour .",
    "for simplicity , in superbox the total potential energy is computed without any interpolation inside grid cells ( as it was used for the acceleration ) ; only the potential value of the particle s cells are taken into account to compute the potential energy .",
    "the total potential energy at the @xmath31th time - step is thus @xmath147 where @xmath148 is the sum of the potentials of all grids and galaxies used to calculate the force on particle @xmath102 at the @xmath31-th time - step , or in other words , all potentials which contribute to the leap - frog update of the velocity in eq .",
    "[ f2.2a ] .",
    "@xmath149 is the mass of the particle ( equal for all particles belonging to the same galaxy ) .",
    "the total kinetic energy is also calculated only approximately during runtime .",
    "this comes about because in the leapfrog integration - scheme the velocities are half a time - step behind the positions . within our integration scheme the time - centred interpolation for the kinetic energy would be @xmath150 where @xmath151 is the @xmath152-component of the velocity vector of particle @xmath102 at time - step @xmath31 . in superbox",
    "the philosophy is to keep the amount of storage as small as possible , so that only the current velocities are stored . to keep the error in @xmath153 as small as possible , particle kinetic energies are calculated before and after the velocity vectors are updated in one time - step . from these two values the arithmetic average",
    "is taken : @xmath154 this still implies an additional error of the order of @xmath155 , but keeps storage low and the code fast .    to quantify the performance of superbox in terms of conservation of total energy , @xmath156 , calculations with different time - steps , particle number and grid resolution are done .",
    "we consider the relative change @xmath157 , where @xmath158 , and @xmath159 is the reference time .",
    "it is chosen to be zero when the adjustment to equilibrium after setting up the discrete rendition of the galaxy is accomplished .",
    "max@xmath160 denotes the largest deviation in energy that occurs during a computation ( see fig .",
    "[ run6e ] ) .    table  [ tab : deltat ] shows that deviations in @xmath161 are less than 0.5  per cent , as long as the time - step , @xmath162 , where @xmath163 is the half - mass crossing - time of the plummer - model .",
    "we consider @xmath164 to be a safe choice . in theory",
    "( see hockney & eastwood 1981 ) the error of the leapfrog integrator should decrease as @xmath165 for @xmath166 , but as is evident from table  [ tab : deltat ] , other error sources become prominent at a sufficiently small time step .",
    "+    .maximum deviation in total energy , max@xmath167 after @xmath168 for different time - steps using @xmath169 particles and @xmath170 grids per dimension .",
    "[ cols=\"<,^\",options=\"header \" , ]     [ tab : deltat ]    fig .",
    "[ run6e ] shows the time evolution of the change in total energy for a particular calculation .",
    "a linear drift fits the data well , which holds true in computations extending over 50 crossing - times .",
    "the slope of the energy - drift is 0.002  per  cent per crossing - time .",
    "the dispersion in energy is artificial due to the crude calculation of potential energy . over a hubble time , which corresponds to @xmath171",
    "if the plummer model galaxy is assumed to have @xmath172  yr , the resulting energy error is 0.3  per cent .",
    "+ this linear drift is intrinsic to a pm code ( see hockney & eastwood , their fig .",
    "9.4 ) , and its strength depends mainly on the choice of @xmath24 in the green s function . @xmath24 determines the strength of the gravitational interaction of particles in the same cell , and also the self - gravitation of a particle ( see section  [ sec : green ] ) .",
    "additional errors arise through the limited grid - resolution and the approximations adopted in evaluating the energies .",
    "this gives an additional oscillation around the value of the linear drift seen in fig .",
    "[ run6e ] .",
    "increasing the number of particles per galaxy to @xmath173 leads to little further improvement in max@xmath174 with @xmath170 .",
    "the decrease of the error levels off if the mean number of particles per cell becomes sufficiently large .",
    "however , changing the grid resolution from @xmath170 to 64 cells per dimension gives an improvement by a factor of at least 4 , with the decrease in error still progressing for @xmath175 ( fig .",
    "[ is_emax ] ) .",
    "this is due to the estimate of the true potential by our grid - based potential , and thus of the potential energy , improving with increasing @xmath8 .",
    "it also shows that increasing the number of grid - cells while keeping the number of particles low ( with @xmath129 ) does not improve energy conservation ( e.g.  @xmath176 , @xmath177 ) .      to calculate the absolute value of the total angular momentum of the galaxy , @xmath178 , the same technique as for the kinetic energy",
    "is applied .",
    "that is , the arithmetic mean of the two velocity values ( before and after the velocity update ) is calculated for each velocity component to obtain an estimate of the velocity vector that is in - phase with the position vector .    the time evolution of @xmath179 for one particular calculation is shown in fig .  [ run6a ] .",
    "as with @xmath180 , computations over @xmath181 show insignificant deviations from the linear drift .",
    "the slope of the drift is about 0.003  per cent per crossing - time .",
    "conservation of @xmath178 does not depend on @xmath112 as long as the time - step is small enough ( @xmath182 as for energy in section  [ sec : is_energy ] ) .",
    "but it is highly dependent on the grid - resolution . changing from @xmath170 to 64 grids per dimension",
    "improves the change in angular momentum by at least a factor of 10 . from fig .",
    "[ is_amax ] it can be seen that max@xmath183 is quite independent of @xmath9 .",
    "galaxies have two - body relaxation times of the order of @xmath184  gyr , and show little or no relaxation over a hubble time even in their inner parts .",
    "therefore , a programme which models galaxies has to be collision - less .",
    "since no particle - mesh code can be entirely free of relaxation , we have to check on which time - scales superbox provides reliable results .    following standish & aksnes ( 1969 ) ,",
    "the following experiment is performed : a number of equal - mass and fixed particles is distributed homogeneously inside a sphere of radius @xmath185 with a constant density distribution .",
    "a second group of particles is distributed on the surface of this sphere .",
    "they are allowed to move through the centre and leave the sphere on the opposite side . to make sure they leave the sphere ,",
    "they are given an initial non - zero radial velocity component towards the centre of the sphere .",
    "the points where the moving particles leave the sphere are noted and the calculation is stopped after all moving particles have left the sphere . for every particle , its deflection angle @xmath47 is obtained from @xmath186    where @xmath187 and @xmath188 are the vectors from the centre of the sphere to the initial and final position of the particle ( see fig .  [ angle ] ) .",
    "the mean deflection angle , @xmath189 , of all particles is computed and the relaxation time , @xmath190 , is calculated from @xmath191 here @xmath192 is the mean time the moving particles require to travel through the sphere . +",
    "the number of moving particles is chosen to be @xmath193 , which gives a sufficiently accurate estimate for @xmath190 .",
    "the number of fixed particles , @xmath194 , and the size of the inner mesh , @xmath195 , are varied .",
    "grids with @xmath196 grid - cells per dimension are used .",
    "for a certain combination of @xmath194 and @xmath195 , 100  calculations with different random number seeds ( both for the fixed and moving particles ) are performed . in all cases , @xmath197 ( see also fig .  [ gitter ] ) .",
    "[ trelp ] shows the ratio @xmath198 as a function of @xmath194 .",
    "if one grid contains the whole sphere ( @xmath199 ) a linear dependence of @xmath200 on @xmath201 fits the results very well .",
    "such a dependency is predicted for large particle numbers by standard relaxation theory ( spitzer & hart 1971 ; binney & tremaine 1987 ) . for @xmath202 , @xmath203 . since @xmath204  yr for a typical galaxy ,",
    "the relaxation time is one order of magnitude larger than a hubble time .",
    "hence galaxies can be modelled with superbox provided @xmath173 particles per galaxy .",
    "these results are not substantially changed if the particles have to cross a grid boundary .",
    "as an example , the case @xmath205 is shown in fig .  [ trelp ] . compared to the one - grid case ,",
    "@xmath190 is reduced by about 20  per cent nearly independently of @xmath194 .",
    "hence , grid boundaries do not decrease @xmath190 significantly .",
    "the relaxation time also drops if the number of grid - cells is increased : due to the better resolution , forces from particles in adjacent cells become larger , increasing the relaxation . as an example the case with 128 cells per dimension is shown in fig .",
    "[ trelp ] .",
    "the relaxation times are a factor of @xmath206 smaller compared to the case with @xmath170 . assuming that all particles within a cell are located at the cell centre , and treating the deflection of the moving particles as a pure n - body problem , we may obtain an analytical estimate of the relaxation in superbox . a consideration similar to the one described in binney & tremaine ( 1987 ) p.  187",
    "ff shows that the relaxation time should depend in the following way on @xmath207 and @xmath7 : @xmath208 with @xmath209 . from the experiments described in this section we obtain a value for the constant of proportionality @xmath210 .",
    "together with this value , eq .",
    "[ trelax ] gives an estimate of the relaxation time of superbox . from this result",
    "we can quantify , for a given grid resolution and computational time , the minimum number of particles that should be used to exclude any unwanted relaxation effects .",
    "it is again obvious that calculations with a high number of grid - cells should be done only with a sufficiently large particle number to ensure @xmath211 .",
    "the memory requirement of superbox scales both linearly with the particle number , @xmath9 , and with the number of grid - cells , @xmath212 . for the particle array , 24  byte per particle ( 4  bytes per phase - space variable )",
    "are needed .",
    "the total amount of memory for different particle numbers and grid - resolutions is shown in fig .",
    "[ mem ] .",
    "= 14.0 cm    the memory required for a superbox calculation can be estimated from @xmath213 the first term on the right - hand side of eq .",
    "[ f5.1 ] comes from the 5  grids ( section  [ sec : grid ] ) .",
    "the second term comes from the array needed for the fft , and the last term comes from the array required to store the fourier - transformed green s function .",
    "the memory usage of the grids is independent of the number of galaxies , since they are treated consecutively in the same grid - arrays .",
    "the overhead contains the arrays of the superbox parameters ( e.g. grid sizes ) , the centre of mass and density , and output data such as energies , angular momenta and lagrangian radii , for each galaxy . increasing the number of galaxies",
    ", while keeping the total particle and grid number constant , reduces the relative overhead contribution ( eq .",
    "[ f5.1a ] ) slightly due to these large arrays scaling only with the number of particles per galaxy .",
    "the time - step cycle of superbox is divided into three main routines ( fig .",
    "[ super ] ) .",
    "firstly , in getrho the mass density of the grids is calculated .",
    "secondly , the fft routine computes the potential on the grids .",
    "thirdly , the pusher routine contains the force calculation , the position and velocity updating , and collection of the output data .",
    "these three routines need about 99  per cent of the total cpu time .",
    "[ cpu ] shows the amount of cpu - time per step , @xmath214 , needed for the different routines .",
    "all data are derived on a pentium ii 400mhz processor with linux as the operating system and the gnu ",
    "g77 fortran compiler",
    "( with options @xmath215o3 @xmath215m486 ) for a model single galaxy .    for the getrho and pusher routines , @xmath216 , while for the fft routine , @xmath217 ( @xmath218 ; fig .  [ cpu2 ] ) , which is by far the dominant contribution .",
    "the resultant cpu time per step for galaxy @xmath102 is : @xmath219 as another example , for a pentium  200mhz mmx , @xmath220  sec / step for @xmath221 particles in one galaxy and @xmath222 grids .",
    "the cpu - time needed for a computation with @xmath223 galaxies is derived by adding the individual times , @xmath224",
    "demonstration of the conservation of energy and angular momentum is a necessary but not sufficient condition for validating any particle - mesh code .",
    "additional validation of the code comes from an inter - comparison of results obtained with entirely different numerical techniques .",
    "such a comparison is available in the study of the tidal dissolution of small satellite galaxies orbiting in an extended galactic dark halo ( klessen & kroupa 1998 ) .",
    "such an application of superbox is rather extreme in that the jump in resolution from the middle grid ( 0.29  kpc / cell length ) containing the small satellite to the outermost grid ( 25  kpc / cell length ) containing the local universe is very large .    in that study ,",
    "two superbox computations are compared with calculations done using a direct but softened n - body integrator on the special hardware device named grape  3 connected with a sun - ultra  20 .",
    "the superbox calculation uses @xmath225 grids , has @xmath226 satellite particles , and treats the live galactic dark halo with @xmath227 particles .",
    "the grape computation uses @xmath228 satellite particles with the galactic dark halo being an analytic isothermal potential .",
    "both calculations proceed for many thousands of time steps , corresponding to a time interval of many  gyr , until beyond disruption of the satellite .",
    "the results are in nice agreement , yielding essentially the same behaviour of the satellite , apart from expected ( small ) differences in exact disruption time .",
    "of interest is also a comparison in cpu times required for the calculations , keeping in mind the very different number of particles used : with superbox it takes  0.57 days on an ibm  risc/6000 workstation to compute 1  gyr using @xmath229 particles , and it takes 0.36  days with grape using @xmath230 particles ( with an @xmath231 scaling ) .    in the above calculations , the satellite mass is too small for the orbit to be affected by dynamical friction .",
    "a comparison of the orbital decay through dynamical friction of a massive satellite is of interest with analytical estimates , because this allows an altogether independent verification if superbox treats collective behaviour on larger scales correctly .",
    "this is discussed in section  [ sec : dynfric ] .",
    "an object moving through a homogeneous distribution of much lighter masses induces a trailing over - density .",
    "this over - density attracts the object which , as a result , is decelerated ( chandrasekhar 1943 ) .    the orbital decay of a satellite galaxy or globular cluster orbiting within a larger galaxy is an astrophysical process relevant , for example , to the rate at which a satellite population is depleted and to the built - up of galactic bulges . in the local group , dynamical friction affects the orbit of the magellanic clouds , which is important for tracing their origin ( see westerlund 1997 and kroupa & bastian 1997 for summaries ) . it may also change the orbit of the sagittarius dwarf spheroidal galaxy ( ibata & lewis 1998 ; gomez - flechoso et al .  1999 ) and other nearby companions , depending on their masses .",
    "understanding and proper application of dynamical friction is thus a very important issue .",
    "the question if chandrasekhar s formula ( eq .  [ eqn : eom1 ] below ) can be applied to orbits within finite and inhomogeneous density distributions has been the issue of a significant debate throughout the 1970 s and the 1980 s .",
    "the result is that for satellite masses that are relatively small compared to the large galaxy , the formula is a good approximation ( bontekoe & van albada 1987 ; zaritsky & white 1988 ; velazquez & white 1999 ) .",
    "massive satellites induce non - local perturbations in the larger galaxy that are not taken account of in the derivation of eq .",
    "[ eqn : eom1 ] , and in the collision of two galaxies of comparable mass analytical estimates become intractable , and the self - consistent numerical experiment must be resorted to ( e.g. madejski & bien 1993 ) . in order to do this we must , however , have reason to trust the numerical results .    to demonstrate the reliability of our results , we compare the orbital evolution of a satellite galaxy orbiting in an extended dark halo computed with the fully self - consistent superbox - code , with the evolution resulting from the by now well - established chandrasekhar approximation ( eq .  [ eqn : eom1 ] ) .      for the numerical experiment a compact spherical satellite galaxy",
    "is injected into an extended isothermal dark parent halo .",
    "the numerical rendition of both systems is described in detail in kroupa ( 1997 ) , and only a short description is given here .",
    "the parent halo is assumed to extend to @xmath232  kpc with a core radius @xmath233  kpc and a total mass @xmath234 , corresponding to a circular velocity @xmath235  km / s .",
    "a particle takes 588  myr to cross the 33  per cent mass diameter .",
    "the inner , middle and outer grids are centred on the density maximum and have edge lengths of  50 , 188  and 700  kpc , respectively .",
    "the model is allowed to relax to virial equilibrium , after which state it has a slightly more compact configuration with a circular velocity at a radius of 150  kpc of 245km / s , corresponding to a mass within that radius of about @xmath236 . due to a mild radial orbit instability",
    "the halo is also slightly prolate .",
    "plummer density distributions are taken for the satellites , each with a plummer radius @xmath237  kpc and a cutoff radius of 15  kpc .",
    "the innermost and middle grids are centred on the satellite s density maximum and have edge lengths of  10 and 40  kpc , respectively .",
    "the outer grid is the same as for the halo .",
    "three satellite masses are used , @xmath238 .",
    "the respective crossing times of the 33  per cent mass diameter are  @xmath239 , 32 and 12  myr .    for the calculation ,",
    "@xmath240 grid cells per dimension are used ( only 28  being active , see section  2.3 ) , with @xmath227 particles in the parent halo , and @xmath241 satellite particles . for the halo",
    "the resolution is thus 1.79  kpc / cell - length for @xmath242  kpc , 6.71  kpc / cell - length for 25  kpc @xmath243  kpc and 25  kpc / cell - length for 94  kpc @xmath244  kpc . for the satellite",
    "the resolution is 0.36  kpc / cell - length for @xmath245  kpc , 1.43  kpc / cell - length for 5  kpc @xmath246  kpc and 25  kpc / cell - length for 20  kpc @xmath247  kpc , where @xmath248 is the distance from the satellite s density maximum .",
    "the integration step size is @xmath249 .",
    "the satellite is allowed to relax to virial equilibrium before being placed into the parent halo at an initial radius @xmath250  km / s perpendicular to the radius vector , @xmath251 .",
    "the satellite s galactocentric distance is @xmath252 , and its velocity is @xmath253 and @xmath254 are the position vectors of the density maxima of the satellite and halo , respectively , and @xmath255 and @xmath256 are the velocity vectors of the satellite s and halo s density maxima , respectively .",
    "the equation of motion of a satellite in a stationary and rigid isothermal parent halo is @xmath257,\\label{eqn : eom3}\\end{aligned}\\ ] ] where @xmath258 is the acceleration in an isothermal halo , and @xmath259 is the deceleration due to dynamical friction , in which @xmath260  is the gravitational constant , @xmath261 $ ] is the halo density and erf@xmath262 is the error function with @xmath263 . a derivation of chandrasekhar s dynamical friction formula can be found in binney & tremaine ( 1987 ) .",
    "the numerical value of the coulomb logarithm , ln@xmath264 , is somewhat ill - defined .",
    "it is calculated by integrating particle deflections over impact parameters ranging from a minimum ( @xmath265 ) to a maximum ( @xmath266 ) effective value .",
    "the minimum impact parameter is taken here to be @xmath267  kpc .",
    "the maximum impact parameter , however , is something like the distance over which @xmath268 falls off significantly , and is thus less - well defined .",
    "an upper limit is @xmath269  kpc .",
    "it can also be estimated by assuming @xmath270 . with @xmath271  kpc , @xmath272  kpc . if , on the other hand , @xmath273 , then with @xmath274  kpc , @xmath275  kpc .",
    "once the satellite orbit decays to @xmath276  kpc , then @xmath277  kpc , while @xmath278  kpc .",
    "the coulomb logarithm thus lies in the range ln@xmath279  1 to  4 , and the above argument suggests that it may be a monotonically decreasing function of declining @xmath280 .",
    "apart from the somewhat arbitrary value of the coulomb logarithm , the analytic derivation of eq .",
    "[ eqn : eom3 ] assumes a maxwellian velocity distribution in the halo , neglects the self gravity of the wake induced by the satellite s gravitational focusing , and the motion of the deflected halo particles is assumed to be governed only by the satellite  the gravitational field of the parent halo is neglected .",
    "nevertheless , eq .  [ eqn : eom3 ] has been shown to provide reliable results provided @xmath281 and @xmath282 ( binney & tremaine 1987 and references therein ) .",
    "the superbox model described in section  [ sec : superb_dynfr ] conforms with these restrictions .    for the comparison with superbox , @xmath283  km / s , @xmath284  kpc , and @xmath285 and @xmath286 .",
    "eq .  [ eqn : eom1 ] is rewritten to four coupled first - order differential equations , and integrated numerically using the runga - kutta method , with a sufficiently small step size to ensure stability of the solution .      since the coulomb logarithm is ill defined , it is necessary to first calibrate the numerical solution to eq .",
    "[ eqn : eom1 ] using one superbox calculation .",
    "[ fig : vr1 ] shows the decay of the orbit of the satellite with @xmath287 according to superbox and eq .",
    "[ eqn : eom1 ] under different assumptions for ln@xmath288 .    for the solution shown as the lower - dotted-@xmath280 curve in fig .",
    "[ fig : vr1 ] , ln@xmath289 .",
    "the superbox result requires a smaller coulomb logarithm .",
    "tests show that ln@xmath290 leads to good agreement . to show a possible upper limit to the solution of the equation of motion ,",
    "the case ln@xmath291 is plotted as the upper - dotted-@xmath280 curve . for this case , ln@xmath292 initially , and it decreases with @xmath280 .",
    "the figure also shows the time - varying distance along the x - axis between the density maxima of the satellite and the halo .",
    "the damped oscillation is nicely evident , and the period of the orbit is initially 3.2  gyr .",
    "the lower panel of fig .",
    "[ fig : vr1 ] plots the solutions for @xmath293 .",
    "the satellite in the superbox calculation retains an approximately constant velocity , as is expected from the theory of dynamical friction , the solutions from which are plotted with different lines corresponding to the cases discussed above .",
    "the overall conclusion is that the superbox result is consistent with theoretical expectations , provided ln@xmath290 .",
    "that this finding extends to other satellite masses is shown in fig .",
    "[ fig : vr2 ] . in all cases ,",
    "the satellites have lost less than 20  per cent of their mass by the end of the calculation .",
    "= 12.0 cm = 16.5 cm    = 12.0 cm = 16.3 cm    it is notable that one single value for the coulomb logarithm applies to the whole radial range as well as to all three satellites , suggesting that non - local perturbations of the extended halo do not significantly alter the orbit of the satellites .",
    "this finding is in nice agreement with the results for ln@xmath288 by bontekoe & van albada ( 1987 ) and velazquez & white ( 1999 ) , and support their finding that chandrasekhar s approximation yields a useful description of orbital evolution if ln@xmath294 is used .",
    "further calculations with more grid cells and a more detailed study will be needed to show if the oscillations in @xmath280 and @xmath293 seen in figs .  [ fig : vr1 ] and  [ fig : vr2 ] , as well as in similar figures in the literature ( e.g. fig .",
    "3 in bontekoe & van albada 1987 ) are physical , i.e. if they are manifestations of the dependency of @xmath259 ( eq .  [ eqn : eom3 ] ) on @xmath295 and @xmath296 .",
    "superbox is an unconventional particle - mesh code that uses moving sub - grids to track and resolve high - density peaks in the particle distribution .",
    "this extension avoids the limitation in spatial resolution encountered with standard particle mesh codes that employ only a single grid .",
    "the code is efficient in that the computational overhead is kept as slim as possible .",
    "the code is also memory efficient by using only one set of grids to treat galaxies in succession .    in this paper",
    "we have explained the algorithms used for force evaluation , grid positioning and orbit integration . the nearest - grid - point scheme ( ngp )",
    "is used to compute the density on a grid .",
    "the potential is obtained by fft , from which accelerations at the position of each particle within a cell are calculated using second - order central - difference quotients with linear interpolation to the position of particles inside that cell .",
    "such a scheme has been identified as a special higher - order ngp scheme and is competitive with the cloud - in - cell ( cic ) scheme regarding the precision and continuity of the forces across grid boundaries .",
    "together with the nested sub - grids , this leads to precise and reliable force calculations at the location of each particle .",
    "the sub - grids are positioned at each time - step on the density maximum or at the centre of mass of a galaxy , the former method being the more useful . for orbit integration",
    "the leap - frog scheme is used .",
    "conservation of energy and angular momentum is excellent , and numerical relaxation is significantly longer than a hubble time for a galaxy with a crossing time of about @xmath297  yr and particle numbers exceeding @xmath193 .",
    "cpu - timing and memory consumption are such that calculations of galaxy encounters involving many @xmath298 particles are possible on present - day desk - top computers with 20 mb ram or more ( see fig .",
    "[ mem ] ) . on the other hand , it is clear that using the resources of massively parallel supercomputers will significantly increase the capabilities of superbox .",
    "the most serious limitation of superbox lies in the inability to resolve newly formed self - gravitating systems , because the grid structure is decided on at the beginning of a computation .",
    "superbox has presently no scheme to allow the inclusion of additional grids during a calculation .",
    "such objects can form in tidal arms and may be the precursors of some dwarf satellite galaxies .",
    "this limitation will be reduced as the number of grids that can be used increases owing to advances in computer technology .",
    "current and future developments of superbox would include for example incorporating an individual time - step scheme per grid and galaxy .",
    "we intend to parallelise the code to run on cray  t3e super - computers .",
    "furthermore , additional grid - levels will be introduced to reduce the jump in resolution between the present middle and outer grids , and/or to further increase the resolution of the central regions of a galaxy .",
    "finally , the current sticky - particle algorithm of superbox can be extented ( e.g.  to include star formation ) .",
    "problems that are now being tackled with superbox include computations of the tidal interactions of satellite and disk galaxies ( j.m .",
    "penarrubia , in preparation ) , and the possible formation of spheroidal satellite galaxies from stellar super clusters ( fellhauer et al . ) .",
    "fellhauer & kroupa ( 2000 ) report on a study of the dynamical evolution of clusters of dozens to hundreds of young massive and compact star clusters ( i.e. _ stellar super clusters _ ) in a tidal field , in an attempt to understand the evolution of such objects observed in hst images of the antennae galaxies ( see e.g. lanon et al .",
    "2000 ) . also , the parameter survey of dwarf galaxies orbiting in a massive dark halo is being completed ( kroupa , in preparation ) , to identify regions in parameter space that may lead to dsph - like systems without dark matter .",
    "furthermore , collapse calculations are being performed to study the properties of the resulting object after violent relaxation and secular relaxation thereafter ( boily , in preparation ) .",
    "p.k . and h.b .",
    "acknowledge financial support by sfb 328 and c.b , by sfb439 ( at the university of heidelberg ) from the german science foundation ( dfg ) .",
    "support and advice on computational aspects of hlrs stuttgart is gratefully acknowledged .",
    "+ superbox is available at +"
  ],
  "abstract_text": [
    "<S> we present superbox , a particle - mesh code with high resolution sub - grids and an ngp ( nearest grid point ) force - calculation scheme based on the second derivatives of the potential . </S>",
    "<S> superbox implements a fast low - storage fft - algorithm , giving the possibility to work with millions of particles on desk - top computers . </S>",
    "<S> test calculations show energy and angular momentum conservation to one part in @xmath0 per crossing - time . </S>",
    "<S> the effects of grid and numerical relaxation remain negligible , even when these calculations cover a hubble - time of evolution . </S>",
    "<S> as the sub - grids follow the trajectories of individual galaxies , the code allows a highly resolved treatment of interactions in clusters of galaxies , such as high - velocity encounters between elliptical galaxies and the tidal disruption of dwarf galaxies . </S>",
    "<S> excellent agreement is obtained in a comparison with a direct - summation n - body code running on special - purpose grape  3 hardware . </S>",
    "<S> the orbital decay of satellite galaxies due to dynamical friction obtained with superbox agrees with chandrasekhar s treatment when the coulomb logarithm @xmath1 .    </S>",
    "<S> methods : numerical  galaxies : evolution  galaxies : interactions  galaxies : kinematics and dynamics </S>"
  ]
}