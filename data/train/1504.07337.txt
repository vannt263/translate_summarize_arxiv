{
  "article_text": [
    "stars in galaxies and dark matter in the universe can be modeled in phase - space as self - gravitating collisionless fluids obeying the vlasov - poisson equations : @xmath5 where @xmath6 represents the phase - space density at position @xmath7 and velocity @xmath8 , @xmath9 is the gravitational potential , and @xmath10 is the gravitational constant .    in general , these equations do not have simple analytical solutions .",
    "they are therefore often solved numerically .",
    "the most widely used numerical scheme is the @xmath2-body approach and there exist many different implementations , which mainly differ from each other in the way poisson equation is solved ( see , e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* for reviews on the subject ) .",
    "the @xmath2-body method attempts to sample the phase - space density by an ensemble of dirac functions that represent particles interacting with each other through gravitational force . in order to avoid numerical artefacts due to the @xmath11 divergence of the force at small distances ,",
    "the gravitational potential is usually replaced by an effective one so that the force is smoothed at scales smaller than a softening parameter @xmath12 .",
    "this procedure corresponds to assuming that the particles are clouds of size @xmath13 interacting with each other .    approximating the phase - space density with macro - particles , however , has its own limitation . in particular ,",
    "the close @xmath2-body encounter is one of the most notable sources of numerical artefacts , in addition to more subtle collective effects induced by the discrete nature of the distribution of the particles ( see , e.g. * ? ? ?",
    "* ; * ? ? ?",
    "? * ; * ? ? ?",
    "* ; * ? ? ?",
    "of course , the time integration scheme and the way to solve the poisson equation numerically are well - known sources of errors , even though not particular to the @xmath2-body method .",
    "there are several previous studies that discussed the limitations of the @xmath2-body results , including underestimating strong numerical artefacts , particularly in the cold case where the initial velocity dispersion is null ( see , e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) , and long - term nonlinear resonant modes induced by the discrete nature of the particles ( see , e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "we also note that it is not yet obvious that the fine inner structure of dark matter halos is completely understood from physical and even numerical points of view , despite numerous intensive convergences studies of the @xmath2-body approach ( see , e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "it is therefore highly desired to develop alternative numerical methods to the traditional @xmath2-body approach so that one can understand better its validity and fundamental limitations .    in the cold case , relevant to the current paradigm of cold dark matter scenario ,",
    "the phase - space distribution function is supported by a three - dimensional sheet evolving in six - dimensional phase - space , which can be partitioned in a continuous way with an ensemble of tetrahedra as proposed in recent works ( see , e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "unfortunately , the increasing complexity of the structure of the system during evolution requires more and more sampling elements , and the computational cost becomes prohibitive after several dynamical time - scales .    in this article , we consider the warm case , in which the system presents a non - negligible initial local velocity dispersion component relative to gravitational potential energy . in this case",
    ", the phase - space distribution function has to be sampled on a 6-dimensional mesh , which makes again the computational cost very high .",
    "therefore , we shall restrict to spherical systems , hence reducing the actual number of dimensions of the dynamical setup to three .",
    "there exist many methods to solve the vlasov - poisson equations in the warm case , mainly developed in plasma physics .",
    "one of the most famous solvers is the splitting algorithm of @xcite and its numerous extensions ( see , e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* but this list is far from complete ) .",
    "this algorithm , that we shall adopt below , exploits directly the liouville theorem : the phase - space density @xmath14 is conserved along motion .",
    "then the equations of the dynamics during each time step are divided into `` drift '' and `` kick '' parts according to hamiltonian dynamics and are solved backwards : @xmath15 where @xmath16 is computed from @xmath17 . in practice",
    "the phase - space distribution function is sampled on a mesh , and each step is performed by using tracer particles located at mesh sites and following the equations of motion split as above .",
    "resampling of @xmath17 , @xmath18 and finally the phase - space distribution function at the next time step is performed by using an interpolation , e.g. based on the spline method .",
    "the splitting scheme was applied for the first time in astronomy in early 1980 s , to one dimensional systems @xcite , galactic disks @xcite and spherical systems @xcite .",
    "nevertheless , it has been almost forgotten since then except for a few contributions ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) that include a recent preliminary investigation of the algorithm in full 6-dimensional phase - space @xcite .",
    "as mentioned above , however , solving fully six - dimensional phase - space problems with sufficient accuracy is still very unrealistic now . in this article , therefore , we focus on spherical systems , where phase - space is only three dimensional : the three coordinates of interest are the radial position @xmath19 , the radial velocity @xmath20 and the angular momentum @xmath21 . following earlier works performed in the framework of one dimensional gravity ( see , e.g. , *",
    "* ) , we carry out a detailed comparison between an @xmath2-body code , gadget @xcite , and an improved version of the splitting algorithm implementation by @xcite , vlasolve .",
    "our goal is to check how well the particle distribution in gadget traces the phase - space density obtained from vlasolve , and to see how the results depend on various parameters of the simulations , in particular the number of particles in the @xmath2-body simulations and the spatial resolution in the vlasov code .",
    "we would however like to emphasize here that the purpose of this article is not to compare the performance of the two codes from the view - point of computational cost .",
    "while a fairly good physical insight is obtained through visual inspection of the resulting phase - space density plots , we also present a more quantitative comparison .",
    "to do so , we introduce correlators and entropic estimators based on a likelihood approach , ans ask whether the @xmath2-body simulations can be considered as local poisson realizations of the vlasov code phase - space density .    because of our restrictive choice of the geometry of the system , it is important to simulate spherical configurations that are known to be stable against small anisotropic perturbations induced by the shot noise of the particles .",
    "indeed , we shall use the public treecode gadget without any specific modification to enforce spherical dynamics .",
    "although an alternative approach consisting in enforcing pure radial dynamics in gadget ( see , e.g. , * ? ? ?",
    "* ) may facilitate comparisons with the vlasov code , we do not adopt this approach in order to avoid any possible subtle biases in the analyses .    in this respect ,",
    "the hnon sphere @xcite is particularly suited for our purpose since it is known to preserve well its spherical nature during the course of dynamics even when being simulated with a @xmath2-body technique and , in particular , it is not prone to radial orbit instability ( see , e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "in this configuration , the initial phase - space distribution function is isotropic and gaussian distributed in velocity space and given by @xmath22 with @xmath23 , the total mass of the system .",
    "in the simulations discussed in this article , we work in units where @xmath24 , and the initial radius of the hnon sphere and its total mass are chosen to be @xmath25 which fixes @xmath26 in equation ( [ eq : henons ] ) once the virial ratio is given .",
    "we shall consider `` warm '' and `` cold '' settings , which correspond to the initial virial ratio @xmath27 of @xmath28 and @xmath29 , respectively , where @xmath30 and @xmath31 are the total kinetic and potential energy of the system .",
    "the two classes of initial conditions exhibit distinct features , in particular concerning the metastable state to which the system relaxes through phase mixing .",
    "the warm system builds a core - halo structure , with the halo displaying a power - law profile @xmath32 ( see , e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "in contrast , the cold system develops a more concentrated smaller core ( see , e.g. , * ? ? ? * ; * ? ? ? * ) , but never reaches a strictly stationary regime because a significant fraction of the mass acquires positive energy and escapes from the system ( see , e.g. , * ? ? ? * ; * ? ? ?",
    "* ; * ? ? ?",
    "this article is organized as follows . in   [ sec : thesimus ] we describe our vlasov solver , vlasolve .",
    "section [ sec : gadpres ] provides information about the @xmath2-body runs and the parameters used in gadget . in ",
    "[ sec : sphericity ] , we check that the @xmath2-body simulations stay indeed spherical during evolution .",
    "section [ sec : visu ] presents a visual inspection of the phase - space density , which is followed by a quantitative statistical analysis in   [ sec : statana ] . finally , ",
    "[ sec : discussion ] summarizes and discusses our present results .",
    "under spherical symmetry , the vlasov equation reads @xmath33 where @xmath20 is the radial component of the velocity , @xmath21 is the angular momentum , @xmath34 is the mass inside a sphere of radius @xmath19 .",
    "our code vlasolve solves equation ( [ eq : vl ] ) numerically with the splitting algorithm , following closely @xcite .",
    "phase space is discretized into a rectangular mesh of size @xmath35 for @xmath36 , @xmath37 , and @xmath38 .",
    "more specifically , we use a logarithmically equal interval for @xmath19 , a linearly equal interval for @xmath20 .",
    "the @xmath39-bin of the angular momentum slice corresponds to the interval @xmath40 $ ] and is represented by @xmath41 .",
    "we modify the splitting algorithm using the fact that the angular momentum is an invariant of the hamiltonian system .",
    "hence , one may treat each slice with a different value of @xmath21 in phase - space independently , except for gravitational coupling via the poisson equation .",
    "we include the inertial component of the force , @xmath42 , in the `` drift '' step ( equations [ eq : ck1 ] and [ eq : ck3 ] ) , while the `` kick '' step ( equation [ eq : ck2 ] ) corresponds solely to gravitational force : @xmath43 , \\\\",
    "f^{**}(r , v , j)&=&f^*(r , v+ g m_r / r^2 \\delta t , j ) , \\\\",
    "f(r , v , j ,",
    "t+\\delta t)&=&f^{**}[r^*(-\\delta t/2),v^*(-\\delta t/2),j],\\end{aligned}\\ ] ] where @xmath44 and @xmath45 solve analytically the motion in absence of gravity starting from coordinates @xmath46 in phase - space ( see , e.g. , * ? ? ?",
    "* ) : @xmath47 ^ 2 + j^2 } { 2    h_{\\rm k}}},\\\\ { v}^*(h ) & = & { \\rm sgn}(v ) \\sqrt{2 h_{\\rm k}-    \\frac{j^2}{{r^*(h)}^2}},\\end{aligned}\\ ] ] with @xmath48 ( when @xmath49 , these equations are valid until @xmath50 ) .",
    "because a non - zero angular momentum bends the trajectories in @xmath51 space , the drift step requires a two - dimensional interpolation of the phase - space distribution function in @xmath51 space , while the kick step , which only modifies the velocities , can be completed with a one - dimensional interpolation .",
    "we follow @xcite , and carry out the interpolations using third - order splines . in this interpolation scheme , however , the positivity of the phase - space distribution function is not warranted , and numerical aliasing and diffusion effects are expected when the phase - space distribution function varies over scales of the order of , or smaller than , the mesh element size .    in order to reduce such numerical artefacts ,",
    "we modify equation ( [ eq : henons ] ) as follows : @xmath52 , \\quad r \\leq r_{\\rm h } , \\label{eq : apodization}\\end{aligned}\\ ] ] with @xmath53 . then we recompute @xmath54 in equation ( [ eq : henons ] ) so that the total mass remains unity .",
    "this apodization slightly changes the actual values of the virial ratio to @xmath55 and @xmath56 , although we shall still denote them by @xmath1 and @xmath57 just for simplicity .",
    "it may also modify the long - term dynamical properties of the original hnon sphere relative to what is expected .",
    "this is why we check again the extent to which the spherical nature of the system is retained in the @xmath2-body simulations (   [ sec : sphericity ] ) .",
    "adopting a logarithmic binning for @xmath19 is well suited for tracing small - scale features around the center of the system .",
    "this implies , however , that radii smaller than a finite minimum value @xmath58 are missing from the computing domain . a conventional trick to overcome",
    "the problem is to assume a reflecting boundary at @xmath59 ( see , e.g .. * ? ? ?",
    "* ; * ? ? ?",
    "* ) . usually ,",
    "a systematic time - lag between orbits in this method is neglected : particles reaching the reflective kernel boundary instantly travel the @xmath60 distance through the central region , while they should actually take a finite time depending on their radial velocity and angular momentum . in vlasolve , we improve the reflecting sphere method by taking into account the actual time spent by particles travelling inside the region @xmath61 , which is made easily possible by neglecting the gravitational force .",
    "technical details about the implementation are provided in appendix  [ sec : monr0 ] .    to complete algorithmic details , appendix  [ sec : para ]",
    "discusses the hybrid parallelization of vlasolve with openmp and mpi libraries .    in this paper , we perform 4 simulation runs with different resolutions , each for @xmath3 and @xmath1 ( table  [ tab : resovla ] ) . to cover the dynamical range of interest , the computing mesh uses @xmath62 , @xmath63 and @xmath64 .",
    "the maximum amplitude of the velocity is @xmath65 and 4 for @xmath66 and @xmath57 , respectively . with this choice of the parameters ,",
    "the computational domains are sufficiently large to contain all the system up to the end of the simulations , which corresponds to @xmath67 for @xmath66 and @xmath68 for @xmath3 .",
    "as will be illustrated later in phase - space density plots , these final epochs are sufficient for the system to have relaxed at the coarse level to a meta - stable state through mixing . strictly speaking ,",
    "this is not the case in the @xmath3 case because a fraction of the mass escapes from the system ( see , e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) , as already mentioned in the introduction .",
    "we adopt a constant time step @xmath69 throughout each simulation .",
    "just to stay on the conservative side , we choose a resolutely small value of @xmath69 , despite the increased computational cost .",
    "note however that excessively small time step might artificially increase diffusion effects related to successive interpolations of the phase - space distribution function @xcite .    in appendix",
    "[ sec : resoeffects ] , a comparison among all the simulations is performed for @xmath3 .",
    "it indicates that diffusion and aliasing effects discussed earlier are indeed significant , despite the apodization of initial conditions , but do not seem to affect the dynamical properties of the system .",
    "note that is tempting to undersample angular momentum space since @xmath21 is an invariant of the dynamics .",
    "however , we show in this appendix that it is not wise to do so , because it can provoke nonlinear instabilities after a few dynamical times .",
    "we perform the @xmath2-body simulations using the latest version of the gadget-2 code @xcite .",
    "only the treecode part of this `` treepm '' algorithm is employed .",
    "the particle number is varied from @xmath70 to @xmath71 for @xmath3 and @xmath1 .",
    "we also run an additional simulation with @xmath4 for @xmath3 .",
    "we choose the parameters for gadget runs as follows :    * the softening length of the gravitational force is set as @xmath72 , that is about @xmath73 of the initial mean interparticle distance @xmath74 ( this estimate neglects the effects of the apodization [ eq : apodization ] ) . * in gadget",
    ", each particle has its individual time step bounded by @xmath75 $ ] , where @xmath76 is the acceleration of the particle and @xmath77 is a control parameter .",
    "we choose @xmath78 and @xmath79 . *",
    "the tolerance parameter controlling the accuracy of the relative cell - opening criterion ( parameter designed by errtolforceacc in the documentation of gadget , see equation 18 of * ? ? ?",
    "* ) is set as @xmath80 .",
    "appendix  [ app : instab ] presents the effects of changing these parameters on the phase - space distribution function for simulations with @xmath81 particles and a virial ratio of @xmath3 .",
    "these analyses , performed at @xmath82 , confirm that the parameters used for the simulations of this paper are reasonable .",
    "interestingly , changing the softening length by large factors does not influence much the results , as already noticed previously in the literature ( see , e.g. * ? ? ?",
    "* ) , as long as it is kept small enough .",
    "before presenting comparisons between gadget and vlasolve , it is necessary to make sure that the sphericity of the system is preserved in the gadget simulations because our vlasov runs are performed assuming exact spherical symmetry .",
    "figure [ fig : sphe ] shows , for different values of the number of particles @xmath2 , the evolution with time of the ratios @xmath83 and @xmath84 , where @xmath85 are the eigenvalues of the inertia tensor of the particle distribution .",
    "the dashed regions correspond to the one sigma zone obtained from an ensemble of 100 local poisson realizations of the spherical density @xmath86 , which is estimated from interpolation over spherical shells from the gadget particles . from the measurements in fig .",
    "[ fig : sphe ] , deviations from spherical symmetry due to the particle shot noise can be roughly scaled to @xmath87 where @xmath88 and @xmath89 are the variances of @xmath83 and @xmath84 obtained from the dispersion over the 100 realizations .",
    "note that equation ( [ eq : spherr ] ) is not intended to be accurate .",
    "the asphericity due to discreteness should depend on details of the density profile , as shown in fig .",
    "[ fig : sphe ] .",
    "while it would be possible to compute in a perturbative way the quantities in equation ( [ eq : spherr ] ) from statistical analysis of the inertia tensor assuming @xmath90 and using error propagation formulae , this is a cumbersome exercise far beyond the scope of this paper .",
    "we also note that another possible source of errors comes from the position of the center of the system .",
    "indeed , an inaccurate determination of the center obviously worsens the apparent agreement with spherical symmetry . in the measurements presented in fig .",
    "[ fig : sphe ] , the inertia matrix is not computed with respect to the center of gravity of the particle distribution , which can be affected by the fact that some particles can get far away from the system through @xmath2-body relaxation . instead , we determine the center of the system using an iterative procedure trying to optimize the match of the phase - space distribution function with that of the vlasov code , as detailed in   [ sec : cordef ] .",
    "this procedure is not free from errors either , and may contribute to the fluctuations observed in the curves of fig .",
    "[ fig : sphe ] .    inspection of fig .",
    "[ fig : sphe ] shows that the measured ratios @xmath83 and @xmath84 behave differently in the @xmath66 and @xmath3 simulations . in the @xmath66 case ,",
    "the agreement of the measurements with the poisson prediction is in general good , with a slight trend to ellipticity , except for the top red curve and the bottom green curve where the deviation from spherical symmetry is larger than the poisson expectation .",
    "still , in the case of @xmath66 , the system remains to a very good approximation spherical for all values of @xmath2 , given the expected deviations due to pure statistical noise .",
    "the curves representing the eigenvalue ratios are more steady for @xmath3 than for @xmath66 , which might be slightly puzzling at first sight . however , a very plausible explanation of this difference is that the initial velocity dispersion is larger for @xmath66 than for @xmath3 , hence adding a more prominent random component to the time behavior of the deviation from sphericity .",
    "regarding @xmath3 , deviations from spherical symmetry are clearly more significant compared to local poisson expectations after @xmath91 , roughly the collapse time of the sphere .",
    "while the @xmath70 run exhibits a deviation larger than 10 percent , spherical symmetry is confirmed to be a good approximation for @xmath92 .",
    "finally , we also check deviations from spherical symmetry for subsets of particles in excursions corresponding to @xmath93 , where @xmath94 is the phase - space distribution function measured in the @xmath95 vlasolve runs . for each value of the virial ratio ,",
    "two thresholds @xmath96 are chosen such that the excursions contained initially about 90 and 60 percent of the total mass ( see bottom panels of fig .",
    "[ fig : entro ] below ) .",
    "given the uncertainties in the measurements , the above conclusions still hold : the properties of the deviations from spherical symmetry , that we do not show here for simplicity , do not indeed depend significantly on radius .",
    "we only notice a slight improvement in the @xmath66 case when considering particles in the excursions .",
    "now we are ready to perform direct comparisons between the vlasov and @xmath2-body simulation results . for this purpose",
    ", we consider the phase - space density at different epochs ( figs .",
    "[ fig:0v5_12 ] to [ fig:0v1_all ] below ) . to be more specific",
    ", we plot the constant angular momentum slice of @xmath97 at @xmath98 , and its integral over the angular momentum : @xmath99 figures  [ fig:0v5_12 ] and [ fig:0v5_allj ] plot @xmath100 and @xmath101 , respectively , for the vlasolve and gadget simulations of the warm case , @xmath66 . in both figures ,",
    "snapshots at @xmath102 , 50 , 80 and 100 are plotted from left to right .",
    "the panels correspond to the vlasolve runs with @xmath103 and @xmath104 , the gadget runs with @xmath105 , @xmath106 and @xmath107 , from top to bottom .    the overall conclusion of the visual inspection of figs .",
    "[ fig:0v5_12 ] and [ fig:0v5_allj ] is that the vlasov solver and the @xmath2-body code exhibit very good agreement with each other , probably even much more than expected . in particular , both results present a remarkably similar instability in the region @xmath108 , even in details , showing a surprising reliability of the conventional @xmath2-body approach for these particular initial conditions .",
    "however , before reaching this conclusion , one has to take into account several limiting factors .",
    "in particular , we should bear in mind the fact that the vlasolve simulations are subject to significant diffusion , which smears out fine details of the phase - space distribution function .",
    "this diffusion effect is clearly visible at @xmath109 , when comparing the outer filamentary structures observed in the vlasov simulations to the @xmath2-body result .",
    "putting aside this coarse - graining effect , the structures are exactly similar in both the @xmath2-body and vlasov simulations at @xmath110 , even including small gaps in the phase - space distribution function related to nonlinear instabilities that start building up .",
    "these instabilities grow further at later epochs .",
    "they are considerably smeared out in the @xmath104 vlasolve simulation but unquestionably present .",
    "adding resolution in @xmath51 space ( at the cost of resolution in @xmath21 ) improves the agreement with gadget , which confirms that the instabilities observed in the gadget simulations are physical and not of numerical nature .",
    "figure [ fig:0v5_12 ] indicates that lowering the number of particles in the @xmath2-body simulations may be interpreted as a coarse - graining : it makes finer details more fuzzy but still keeps global features of the phase - space density correctly .",
    "we also note that using a small number of slices in @xmath21 in the vlasov solver does not seem to alter the dynamical properties of the system despite the considerable level of aliasing it introduces .",
    "the situation is more complicated for the cold case , @xmath3 ( figs .",
    "[ fig:0v1_12 ] and [ fig:0v1_all ] ) . up to @xmath111 , the above conclusions for @xmath66 are still valid . however , some instabilities emerge at @xmath111 in the gadget simulations with @xmath112 particles as well as the @xmath113 vlasov run . until this epoch ,",
    "the @xmath114 and the @xmath104 simulations agree perfectly with each other ( modulo the smearing effects already discussed above ) and present a smooth phase - space density without any sign of instability . on the other hand ,",
    "the other simulations exhibit slightly irregular phase - space density .",
    "such a trend is easily seen in fig .",
    "[ fig:0v1_12 ] , even though not so obvious in the @xmath113 vlasov simulation .",
    "these irregularities appear as well in the @xmath114 simulations but at later epochs , and then develop in a dramatic way .",
    "a careful inspection of successive snapshots of the simulations indeed suggests that the onset of these irregular patterns comes later with increasing @xmath2 .",
    "as discussed in appendices  [ app : instab ] and [ app : resvlaeff ] , these instabilities result from the discrete nature of the system in the @xmath2-body case , and from the aliasing effect due to sparse - sampling of the angular momentum space in the vlasov code . since the pattern of the instabilities changes significantly from one simulation to another unlike the @xmath66 case , they should be due to numerical , not physical , origin .    as shown in appendix  [ app : instab ] , their presence is very insensitive to the choice of softening , time step or parameters controlling force accuracy in gadget .",
    "they can therefore be reduced only by increasing the number of particles and the resolution in the gadget and vlasolve simulations , respectively .",
    "it is important to notice that even the @xmath4 result might be insufficient to describe properly the system at late epochs . in the @xmath104 vlasov simulation",
    ", the phase - space distribution function seems to be rather smooth at all times and the system is free of instability , contrarily to the @xmath66 case .",
    "however , it is difficult at this point to know if actual physical instabilities build up at late times in the @xmath3 case , because diffusion in the vlasov simulation might prevent the appearance of some unstable modes .    while the irregular patterns observed in figs .",
    "[ fig:0v1_12 ] and [ fig:0v1_all ] are definitely of numerical nature , the fact that they develop so easily may indicate that the system is prone to react nonlinearly to small perturbations .",
    "uneven gaps between the filaments of the phase - space density can be observed at @xmath82 ( third column of fig .",
    "[ fig:0v1_12 ] ) , even in the @xmath104 vlasov simulation , and one might expect that they correspond to seeds of actual physical instabilities . in this respect , the system might actually develop , at some point , physical unstable modes . these results are quite suggestive of what was obtained previously with a spherical shell code for cold and self - similar systems @xcite .",
    "even with our @xmath4 particle simulation , it is not clear whether these unstable modes dominate over collective effects due to discreteness .",
    "a better understanding of the phenomenon would require a convergence study using even higher - resolution simulations .",
    "to perform a more accurate analysis , one can try to quantify to which extent the particle distribution in the @xmath2-body simulations can be considered as a local poisson process of the phase - space density calculated in the semi - lagrangian code .",
    "to do so , we use , in addition to entropic measurements described further , the following correlators , @xmath115 with @xmath116^k , \\label{eq : cor2 } \\\\",
    "\\kappa_k & = & \\int [ f(\\omega)]^{k+1 } { \\rm d}\\omega .",
    "\\label{eq : cor3}\\end{aligned}\\ ] ] in these equations , @xmath117 is a positive integer , @xmath94 the vlasolve phase - space density , @xmath118 the total mass , @xmath119 and @xmath120 , where @xmath121 , @xmath122 and @xmath123 are respectively the radial position , radial velocity and angular momentum of each particle of the gadget simulation .    for a point set randomly sampling a smooth density distribution @xmath124 , the probability density @xmath125 of having a given particle at phase - space position @xmath126 is independent from the rest of the particle distribution and is simply proportional to @xmath127 : @xmath128 the density probability of having @xmath2 particles at respective positions @xmath129 , @xmath130 , @xmath131 , @xmath132 is given by @xmath133 ensemble averaging of @xmath134 under the law @xmath124 then reads @xmath135^k\\ { \\cal p}(\\omega_1,\\cdots,\\omega_n)\\ { \\rm d}\\omega_1 \\cdots { \\rm d}\\omega_n , \\nonumber \\\\   & & \\\\   & = & \\frac{m}{n } \\sum_{i=1}^n \\int_{\\omega } \\frac{1}{m } [ f(\\omega_i)]^{k } g(\\omega_i ) { \\rm d}\\omega_i , \\nonumber \\\\     & & \\quad \\quad \\quad \\quad \\times \\prod_{j \\neq i } \\int_{\\omega_j } \\frac{g(\\omega_j)}{m } { \\rm d}\\omega_j \\\\   & = &   \\int [ f(\\omega)]^{k } g(\\omega ) { \\rm d}\\omega,\\end{aligned}\\ ] ] and @xmath136^{k } g(\\omega ) { \\rm d}\\omega}{\\int [ f(\\omega)]^{k+1 } { \\rm d}\\omega}.   \\label{eq : ensavck}\\ ] ] hence , if the distributions @xmath124 and @xmath94 coincide , i.e. , in our case , if gadget actually poisson samples the vlasolve phase - space density , one obtains @xmath137 after ensemble averaging .    when increasing @xmath117 , more weight is given to regions in phase - space corresponding to larger values of @xmath94 .",
    "for a point process totally anticorrelated with @xmath94 , @xmath138 cancels , while its largest possible value is given by @xmath139 , when all the particles stay in the region where @xmath94 is maximal .",
    "an important issue is to compute properly the center of the system position in the gadget simulations . in order to do this",
    ", we find the coordinate origin _ maximizing _",
    "@xmath140 , even though the result of such a procedure can potentially lead to @xmath141 , to optimize the match between concentrations of particles and local extrema of @xmath94 .",
    "the variance of @xmath138 can also be calculated in an analogous way to @xmath142 : @xmath143,\\end{aligned}\\ ] ] which reduces to @xmath144 when @xmath94 and @xmath124 coincide . in practice",
    ", we shall use the following estimator for this statistical error : @xmath145 , \\label{eq : varck}\\ ] ] where @xmath146 and @xmath134 are directly estimated from the @xmath2-body simulation .",
    "the log - likelihood that the gadget particle distribution locally poisson samples the vlasolve phase - space density @xmath94 can be written , following the reasoning that leads to equation ( [ eq : lll ] ) , @xmath147 .",
    "\\label{eq : simplogl}\\ ] ] however , the region @xmath148 where @xmath149 being of finite extent , one expects @xmath150 as soon as a particle escapes @xmath148 , which is very likely , due for instance to @xmath2-body relaxation .",
    "furthermore , the vlasov solver does not guaranty the positivity of @xmath94 . to take into account in a fair way both",
    "the defects of the @xmath2-body and the vlasov simulations , it is better to restrict to a region @xmath151 where @xmath94 is strictly positive : @xmath152 the log - likelihood of having @xmath153 particles in the region @xmath151 and the rest outside it ( leaving the freedom of the remaining particles to span all the space outside @xmath151 ) is given by a binomial law : @xmath154,\\ ] ] where @xmath155 is the fractional mass inside @xmath151 in the vlasolve simulation . hence , equation ( [ eq : simplogl ] ) simply becomes @xmath156 + \\ln { \\cal l}_{\\rm b}(q_{\\rm th},\\nu ) ,   \\label{eq : loglcor}\\ ] ] where @xmath157 is the number of particles of the @xmath158 simulation inside @xmath151 and @xmath159 .",
    "note that the distribution of particles which maximizes the first term in equation ( [ eq : loglcor ] ) corresponds again to the case where all the particles of @xmath151 stay in the region where @xmath94 is maximal , similarly to the case when the correlator @xmath138 is equal to its maximum possible value . clearly , this situation is not typical , but it is in fact the most likely to consider when it can take place : this is why we maximize @xmath140 to estimate the center of the @xmath2-body system , even though it might turn to be larger than unity .    the expectation value of @xmath160 under the law @xmath94 can be obtained by ensemble averaging : @xmath161 { \\rm d}\\omega , \\label{eq : likf}\\\\ s_{\\rm b}(f_{\\rm th } ) & \\equiv & -\\frac{1}{\\nu n }   \\sum_{q=0}^{n } { \\cal l}_{\\rm b}(q,\\nu ) \\ln { \\cal l}_{\\rm b}(q,\\nu).\\end{aligned}\\ ] ] in the limit @xmath162 , the quantity @xmath163 reduces to the gibbs entropy of the system , which explains the choice of notations . moreover ,",
    "if @xmath90 and if the fractional mass @xmath155 inside the domain of interest @xmath164 is of order of unity , which is the case for our analyses , the term @xmath165 is in practice negligible compared to @xmath163 , so @xmath166 depends only weakly on the total number of particles , as expected .    the variance of @xmath160 can be calculated likewise @xmath167 \\\\                   & \\simeq & \\frac{1}{\\nu n } \\left\\ { \\int_{d_{\\rm th}}\\frac{f(\\omega)}{m_{\\rm th } } \\ln^2\\left [ \\frac{f(\\omega)}{m_{\\rm th } } \\right ] { \\rm d}\\omega - \\nu [ s(f_{\\rm th})]^2 \\right\\},\\nonumber \\\\ & &   \\label{eq : errstat}\\end{aligned}\\ ] ] where we have neglected , following the arguments developed earlier , the contributions of @xmath168 to the error .    to understand better the interest of using the statistics given by equation ( [ eq : loglcor ] )",
    ", one can introduce the difference between the measured value of the log - likelihood and its expectation under the law @xmath94 : @xmath169,\\ ] ] where @xmath170 is given by expression ( [ eq : loglcor ] ) calculated for @xmath171 extracted from a gadget simulation .",
    "the quantity @xmath172 estimates the magnitude of the difference between the underlying smooth phase - space density @xmath124 sampled by gadget and the vlasolve phase space density , @xmath94 : its ensemble average other many gadget realizations indeed reads , when neglecting the binomial term in equation ( [ eq : loglcor ] ) , @xmath173 \\ln \\left [ \\frac{f(\\omega)}{m_{\\rm th } } \\right ] { \\rm d } \\omega.\\ ] ] under the assumption that the @xmath2-body simulation poisson samples the distribution @xmath94 , the magnitude of @xmath172 should be of the same order of @xmath174 .",
    "top panels of fig .",
    "[ fig : entro ] show the quantity @xmath163 as a function of time for the various vlasolve simulations we performed and two values of @xmath96 chosen such that approximately 90 percent and 60 percent of the total mass is initially inside the excursion @xmath164 , respectively .",
    "the quantity @xmath163 is a casimir invariant that is an integral over a function of @xmath94 and should thus be conserved during runtime if the code was perfect .",
    "this not the case because of diffusion and aliasing effects in @xmath51 space : deviation from conservation of @xmath175 happens shortly after collapse time . then there is a strong mixing phase during which @xmath175 increases , then possibly decreases , according to the value of @xmath96 , and finally reaches an approximate plateau .",
    "deviation from conservation of @xmath175 naturally happens sooner when resolution in @xmath51 space is smaller .",
    "resolution in @xmath21 space does not have much influence on @xmath176 because angular momentum is an invariant of the dynamics .",
    "however , as clearly shown in ",
    "[ sec : visu ] and in appendix  [ app : resvlaeff ] for @xmath3 , we already know that sparse sampling in @xmath21 space is not recommended since it can introduce some instabilities in the dynamics , even though this effect does not affect much our likelihood measurements .",
    "middle panels of fig .",
    "[ fig : entro ] show the quantity @xmath177 measured in gadget from the particles belonging to the excursion @xmath164 as a function of time , where @xmath160 is given by equation ( [ eq : loglcor ] ) . for a given value of the threshold @xmath96 ,",
    "if the gadget simulations would actually behave like poisson realizations of the vlasolve ones , all the colored curves should be close to the solid line , which corresponds to @xmath175 .",
    "this is clearly not the case for small @xmath96 ( upper group of curves ) , except a early times .",
    "increasing the number of particles in the @xmath2-body simulation improves the agreement with the vlasov code for @xmath66 but does not seem to have a convincing impact in the @xmath3 case : for @xmath178 , all the @xmath2-body simulations converge to the same plateau somewhat below the vlasov code result . on the contrary , for @xmath179 and @xmath3 , the agreement between gadget and vlasolve is striking at all times , except may be for the @xmath70 simulation during the strong mixing phase .",
    "note also , that at late times , all the @xmath2-body simulations converge which each other , independently of @xmath96 and @xmath180 , except again for the @xmath70 simulation with @xmath3 , but we know that this latter presents significant deviations from spherical symmetry and should be probably discarded for the analyses performed here .    to complete the analyses and understand better the results obtained for the log - likelihood , the fractional mass inside the excursions @xmath93 is shown in bottom panels of fig .",
    "[ fig : entro ] .",
    "again , this quantity is a casimir , so it should not change with time in the idealistic case . in practice , while it is difficult to predict the effects of aliasing on the @xmath181 mass inside @xmath164 , diffusion effects are more likely to decrease it , especially by dilution of filamentary structures that build up during the course of dynamics . in the @xmath66 case ,",
    "most of the disagreement between gadget likelihood and its expectation given by vlasolve can be understood in terms of fractional mass : effects related to the discrete nature of the @xmath2-body simulations seem to spread particles away from @xmath164 .",
    "however this process is subtle and seems to remain local as suggested by visual inspection of figs .",
    "[ fig:0v5_12 ] and [ fig:0v5_allj ] .",
    "we also checked that it does not affect dramatically the projected density , @xmath86 .    in the @xmath3 case , the interpretation of the results is slightly more complicated . for @xmath179 ,",
    "the gadget fractional mass inside the excursion @xmath164 behaves similarly as in the @xmath66 case as a function of particle number . on the other hand , when examining the quantity @xmath182 , the @xmath2-body measurements converge with each other and with vlasolve much better , especially after relaxation .",
    "this means that particles left in @xmath164 are redistributed in a non trivial way , such that the effects of the excursion mass loss are compensated . for @xmath183 ,",
    "even the @xmath4 gadget sample disagrees with the vlasolve simulation .",
    "clearly , the vlasov simulation becomes quickly defective in regions where @xmath94 is small . on the other hand , convergence of the gadget simulations at late times",
    "might be misleading .",
    "indeed , we noticed from visual inspection of figs .",
    "[ fig:0v1_12 ] and [ fig:0v1_all ] that some instabilities appeared in all of them as soon as @xmath184 , although later when @xmath2 is larger .",
    "interestingly , the measurements in the @xmath105 and @xmath4 simulations are nearly indistinguishable from each other , which is a sign that we are nevertheless close to numerical convergence",
    ".    entropic measurements of fig .",
    "[ fig : entro ] are confirmed , at least partly , by fig .",
    "[ fig : correlators ] .",
    "in particular , a depression of which the depth depends on the number of particles in the @xmath2-body simulation appears on all the curves . when increasing @xmath2 , the amplitude of the depression decreases and the occurrence of its maximum amplitude is delayed , independently of the actual dynamical state of the system . again , it can certainly be attributed to collective effects due to poisson noise .",
    "overall agreement between @xmath2-body and vlasov codes improves when increasing the number of particles in the @xmath2-body simulation . for @xmath66 ,",
    "this is rather independent of @xmath117 in equation ( [ eq : cor1 ] ) , i.e. of the fact of putting more or less weight to overdense regions in phase - space . in the @xmath3 case ,",
    "putting aside the depression of which the depth depends on the number of particles , the correlator @xmath140 starts to decrease with time at @xmath185 .",
    "this can be mainly attributed to defects in the vlasov simulation in underdense regions as discussed earlier . for @xmath186 , which gives more weight to higher values of the phase - space density",
    ", the correlator indeed stays steady as a function of time ( again putting aside the @xmath2-dependent depression ) .",
    "however , one notices for @xmath187 a net increase with time of the correlator for the simulation with @xmath70 particles , but let us remind that this simulation presents significant deviations from spherical symmetry .",
    "in this paper we have compared the phase - space distribution function traced by the particle distribution in gadget simulations to the results obtained with our new vlasov code vlasolve for spherical systems , an improved version of the splitting algorithm of @xcite . for the specific comparison , we have chosen ( apodized ) hnon spheres , which are known to be insensitive to radial orbit instability and in particular to preserve the spherical nature of the system . the latter property is confirmed from simulations run with three - dimensional @xmath2-body codes .",
    "we considered two values of the initial virial ratio of the spheres , @xmath66 and @xmath3 , corresponding to `` warm '' and `` cold '' configurations , respectively .",
    "we have plotted detailed structures of the phase - space distribution functions varying the spatial / mass resolution of the numerical code in a systematic fashion .",
    "we have conducted further a quantitative analysis by introducing two new statistical tools .",
    "the first one is of entropic nature and corresponds to the log - likelihood quantifying to which extent the @xmath2-body results represent a local poisson sampling of the vlasov phase - space density .",
    "the second tool is a correlator of order @xmath117 , proportional to the integral over phase - space of the product between the vlasov phase - space density raised to the power @xmath117 and the particle distribution function .",
    "the overall conclusion is that both the vlasov and @xmath2-body methods agree remarkably well with each other , both from the visual and statistical points of view , if sufficient resolution is employed . given the completely different numerical approaches to collisionless dynamics , this is not trivial at all , and the degree of agreement that we have shown for the first time is perhaps even better than what had been expected before .",
    "this is reassuring for numerous previous results that have been almost exclusively obtained from the @xmath2-body method .",
    "nevertheless there are still unsolved subtle issues in details :    * when performing a visual inspection of the phase - space distribution function in the cold case , @xmath3 , although still good at the coarse level , we find that the level of agreement between the @xmath2-body and the vlasov codes worsens at small scales after a few dynamical times .",
    "this is mainly due to collective effects induced by the shot noise of the particles in the @xmath2-body simulations ( and not to close particle encounters ) .",
    "even with @xmath4 particles , we are not able to prove numerical convergence of the @xmath2-body results .",
    "the comparison at this level , however , is made difficult by the fact that the vlasov code is significantly diffusive , which might prevent the development of a variety of physical unstable modes .",
    "* while the statistical tools do not provide as rich and intuitive information as visual inspection , they identify some subtle effects .",
    "in particular , when taking into account general trends due to diffusion in the vlasov code , significant for @xmath3 , we notice that the match between gadget and vlasolve worsens with time , then improves .",
    "the degree of the mismatch increases , and it shows up earlier , when reducing the number of particles in the @xmath2-body simulation .",
    "again , this may be ascribed to collective effects due to the shot noise of the particles .",
    "nevertheless , the very good match between the gadget simulations with @xmath105 and @xmath4 particles may suggest that convergence is nearly reached in terms of number of particles and information theory , even if it is not fully proved .",
    "it is worth mentioning again that the collective effect mentioned above is not related to @xmath2-body relaxation , but rather results from random poisson fluctuations .",
    "this can be formulated as follows ( see * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* for similar arguments ) : a given particle at some distance @xmath19 from the center of the system feels a force proportional to the number @xmath188 of particles inside the sphere of radius @xmath19 .",
    "poisson fluctuations imply thus that there is a relative error of order of @xmath189 on this force .",
    "importantly , the inner number of particles @xmath188 changes with time with random fluctuations around the mean behavior : these fluctuations can be considered as a correlated random walk . indeed , because of the finite velocity dispersion",
    ", particles cross both inwards and outwards the frontier of the sphere of radius @xmath19 .",
    "a larger velocity dispersion weakens the amount of correlation , thus makes the errors on the force more random , which should have a fuzzy effect on the phase - space density , similarly as collisional relaxation : this is what we can expect for @xmath66 and as observed on fig .",
    "[ fig:0v5_allj ] . on the contrary",
    ", a smaller velocity dispersion makes the error on the force more _ systematic _ which should induce coherent distortions of the phase - space density : this is what we can expect for @xmath3 and confirmed by visual inspection of fig .  [ fig:0v1_all ] .",
    "this effect has non - trivial consequences on the energy spectrum of the particles , particularly in cold configurations @xcite .",
    "it certainly explains as well the deviations between vlasolve and gadget observed when measuring the statistical estimators defined in this paper . according to @xcite , this _",
    "collective _ effect is dominant over @xmath2-body relaxation , and , as confirmed by our detailed numerical tests in appendix  [ app : instab ] , is not significantly influenced by softening .",
    "note as well that shot noise creates anisotropies in the system , i.e. deviations from spherical symmetry that may be eventually amplified .",
    "@xcite argue that this effect is subdominant compared to the radial component of the noise - induced perturbation when considering the collapse of an homogeneous sphere .",
    "although their calculation is performed only prior to collapse and in the cold case , we believe that the conclusion still remains valid for the kind of initial conditions studied in this paper , as suggested by our numerical experiments that seem to preserve well spherical symmetry .",
    "clearly , the collective effect due to particle shot noise is a real problem for simulations of close to cold spherical systems when it comes to examine fine structures of the phase - space density .",
    "we were not able to prove convergence of the phase - space density in the @xmath3 case even for an @xmath4 particle simulation .",
    "notably , this may have non - trivial consequences on the fine structure of simulated dark matter halos , where numerical convergence in terms of number of particles might not have been reached yet despite the numerous intensive studies .",
    "indeed , convergence toward the continuous limit might be much slower than expected , hence giving the false impression that it is achieved .",
    "we thank christophe alard , analle hall , jrme perez and simon prunet for useful discussions .",
    "this work has been funded in part by anr grant anr-13-monu-0003 and was granted access to the hpc resources of the institute for scientific computing and simulation financed by region ile de france and the project equip@meso",
    "( anr-10-eqpx-29 - 01 ) overseen by the french national research agency ( anr ) as part of the `` investissements davenir '' program .",
    "y.s . gratefully acknowledges the support from grant - in aid for scientific research by jsps ( japan society for promotion of science ) no .",
    "24340035 .    aarseth s.  j. , lin d.  n.  c. , papaloizou j.  c.  b. , 1988 , apj , 324 , 288    alard c. , colombi s. , 2005 , mnras , 359 , 123    barnes e.  i. , lanzel p.  a. , williams l.  l.  r. , 2009 , apj , 704 , 372    bertschinger e. , 1998 , ara&a , 36 , 599    besse n. , sonnendrcker e. , 2003 , jcoph , 191 , 341    besse n. , latu g. , ghizzo a. , sonnendrcker e. , bertrand p. , 2008 ,",
    "jcoph , 227 , 7889    binney j. , 2004 , mnras , 350 , 939    boily c.  m. , athanassoula e. , kroupa p. , 2002 ,",
    "mnras , 332 , 971    campos pinto m. , 2011 , arxiv , arxiv:1112.1859    cheng c.  z. , knorr g. , 1976 , jcoph , 22 , 330    colombi s. , 2001 , newar , 45 , 373    colombi s. , touma j. , 2008 , cnsns , 13 , 46    colombi s. , touma j. , 2014 , mnras , 441 , 2414    crouseilles n. , latu g. , sonnendrcker , e. , 2009 , jcoph , 228 , 1429    crouseilles n. , mehrenberger m. , sonnendrcker e. , 2010 , jcoph , 229 , 1927    dehnen w. , read j.  i. , 2011 , epjp , 126 , 55    dolag k. , borgani s. , schindler s. , diaferio a. , bykov a.  m. , 2008 , ssrv , 134 , 229    filbet f. , sonnendrcker e. , bertrand p. , 2001 ,",
    "jcoph , 172 , 166    fujiwara t. , 1981 , pasj , 33 , 531    fujiwara t. , 1983 , pasj , 35 , 547    gott , j.r .",
    "iii , 1973 , apj , 186 , 481    gl y. , christlieb a.  j. , hitchon w.  n.  g. , 2014 , jcoph , 270 , 711    hahn o. , abel t. , kaehler r. , 2013 , mnras , 434 , 1171    hall a. , 2015 , private communication    hnon m. , 1964 , anap , 27 , 83    henriksen r.  n. , widrow l.  m. , 1997 , phrvl , 78 , 3426    hozumi s. , burkert a. , fujiwara t. , 2000 , mnras , 311 , 377    hozumi s. , fujiwara t. , kan - ya y. , 1996 , pasj , 48 , 503    huss a. , jain b. , steinmetz m. , 1999 , apj , 517 , 64    jing y.p . , suto , y. , 2000 , apjl , 529 , l69    jing y.p . , suto , y. , 2002 , apj , 574 , 538    joyce m. , marcos b. , sylos labini f. , 2009 , mnras , 397 , 775    melott a.  l. , 2007 , arxiv , arxiv:0709.0745    melott a.  l. , shandarin s.  f. , splinter r.  j. , suto y. , 1997 , apj , 479 , l79    mineau p. , feix m.  r. , rouet j.  l. , 1990 , a&a , 228 , 344    moore b. , governato f. , quinn t. , stadel j. , lake g. , 1998 , apj , 499 , l5    nishida m.  t. , yoshizawa m. , watanabe y. , inagaki s. , kato s. , 1981 , pasj , 33 , 567    power c. , navarro j.  f. , jenkins a. , frenk c.  s. , white s.  d.  m. , springel v. , stadel j. , quinn t. , 2003 , mnras , 338 , 14    rossmanith j.  a. , seal d.  c. , 2011 , jcoph , 230 , 6203    roy f. , perez j. , 2004 , mnras , 348 , 62    shandarin s. , habib s. , heitmann k. , 2012 , phrvd , 85 , 083005    shoucri m.  m. , gagne r.  r.  j. , 1978 , jcoph , 27 , 315    sonnendrcker e. , roche j. , bertrand p. , ghizzo a. , 1999 , jcoph , 149 , 201    splinter r.  j. , melott a.  l. , shandarin s.  f. , suto y. , 1998 , apj , 497 , 38    springel v. , 2005 , mnras , 364 , 1105    springel v. , et al . , 2008 , mnras , 391 , 1685    springel v. , yoshida n. , white s.  d.  m. , 2001 , newa , 6 , 79    stadel j. , potter d. , moore b. , diemand j. , madau p. , zemp m. , kuhlen m. , quilis v. , 2009 , mnras , 398 , l21    sylos labini f. , 2012 , mnras , 423 , 1610    umeda t. , 2008 , ep&s , 60 , 773    van albada t.  s. , 1982 , mnras , 201 , 939    watanabe y. , inagaki s. , nishida m.  t. , tanaka y.  d. , kato s. , 1981 , pasj , 33 , 541    yoshikawa k. , yoshida n. , umemura m. , 2013 , apj , 762 , 116",
    "in this appendix , we explain how reflecting boundaries conditions with time delay are implemented in vlasolve .    if the mass inside the sphere of radius @xmath58 is neglected , the trajectories followed by each test particle associated to a grid site that penetrates the sphere are fixed and do not depend on time .",
    "this property , combined with the fact that we use a constant time step , allows us to pre - compute these trajectories once and for all .",
    "the delayed central sphere method is then implemented by associating a linked list to each grid site whose associate test particle radial position @xmath19 half a time step backward in time is such that @xmath61 .",
    "each linked list contains as many elements as the number of time steps needed for the particle to travel a distance of @xmath60 and the @xmath190 element in the list stores the coordinates of the test particle @xmath191 time steps backward in time . before starting the simulation ,",
    "we initialize each element coordinate and the corresponding value of the initial distribution function . for each time step ,",
    "the value of each element is then simply updated by assigning to it the value of its successor while the last element value , whose coordinates fall inside the computing domain , @xmath192 , is interpolated .",
    "a comparison of the results obtained with the reflective central sphere to our improved delayed central sphere is shown on figure [ fig : delayed ] .",
    "the improvements are unquestionable .",
    "we implemented a hybrid shared and distributed memory version of vlasolve via the openmp and mpi libraries , respectively .",
    "shared memory parallelism is relatively straightforward to achieve in the spherically symmetric case , by taking advantage of the fact that the angular momentum @xmath21 is a conserved quantity .",
    "spline interpolations , which represent the most expensive part of the code , can thus be computed independently for each slice of constant @xmath21 .",
    "we therefore easily reach an almost perfect parallelization up to a number of tasks equal to the grid resolution @xmath193 of angular momentum space , which is typically larger than the number of available cores on a shared memory system .    distributed memory parallelization via mpi is not as simple . indeed",
    ", spline interpolations are intrinsically non - local , which makes the parallelization along dimensions other than @xmath21 non trivial .",
    "sticking with the trivial parallelization described above unfortunately limits the maximum total number of processes running in parallel to @xmath193 , which is suboptimal .",
    "we overcome this limitation by performing mpi domain decomposition in @xmath51 space , following the approach of @xcite , who propose to localize the cubic spline interpolation to each domain by using hermite boundary conditions between the domains with an ad hoc reconstruction of the derivatives .",
    "figures  [ fig : testvla ] and [ fig : testvla2 ] show , respectively for @xmath98 and integrated over angular momentum , the phase - space distribution function measured in vlasolve simulations with different resolutions .",
    "these simulations have been performed for a hnon sphere with initial virial ratio @xmath3 . beside the very good global agreement between the various runs ,",
    "these figures bring out three effects , which increase when the resolution of the phase - space grid is reduced :    * diffusion smearing out fine details that build up in phase - space during the course of dynamics , for instance clearly visible when one compares top to bottom middle panels of fig .",
    "[ fig : testvla ] .",
    "one concern with diffusion is that it might prevent the appearance of unstable modes .",
    "however , we did not perform any simulation in this work that would prove this .",
    "* aliasing due to artificial oscillations in the spline interpolation : for the problem studied here , aliasing becomes particularly visible after relaxation in the region above the large @xmath19 tail , but this does not have significant impact on the dynamics .",
    "* aliasing due to undersampling angular momentum space : it is visible at all times when one examines the phase - space distribution function integrated over angular momentum ( top panels of fig .",
    "[ fig : testvla2 ] ) and can have dramatic consequences on the dynamics .",
    "the two top lines of panels of fig .",
    "[ fig : testvla ] and [ fig : testvla2 ] , corresponding to a sparse sampling in @xmath21 space with only 32 slices , indeed show the appearance of an instability , which presents , on the third column of these figures , the same pattern whether @xmath194 or @xmath195 .",
    "this instability is not present in the simulations with higher resolution in @xmath21 , as shown by the two bottom lines of panels .",
    "note that the presence of this instability depends on initial conditions : for @xmath66 , we did not notice it for the time coverage considered , @xmath196 ( upper line of panels of figs .",
    "[ fig:0v5_12 ] and [ fig:0v5_allj ] ) .",
    "[ sec : resoeffects ]",
    "in   [ sec : visu ] we noticed the presence of an instability in the @xmath3 @xmath2-body simulations .",
    "one aim of this appendix is to confirm that this instability is related to the number of particles used in the simulations and not to any other control parameter of the gadget code . in the same time , it is also an opportunity to check that our fiducial choice of the gadget control parameters , given in   [ sec : gadpres ] , is correct .",
    "figure  [ fig : testgad ] illustrates the main results of the tests we performed for simulations with @xmath106 particles .",
    "these tests consisted in changing the softening length of the force , the maximum time step value and the tolerance parameter @xmath197 controlling the errors on the force . improving",
    "the accuracy of the force calculation or dividing the maximum time step @xmath198 by a factor 50 , which corresponds to imposing @xmath199 , does not change the results .",
    "this is confirmed as well by the measurements of the correlators @xmath138 introduced in   [ sec : statana ] , that we do not show here for simplicity .",
    "only the value of the softening parameter of the force @xmath12 has an impact on the dynamics for the tests we did .",
    "reducing @xmath12 by a factor 5 seems to slightly blur the phase - space density , although this effect is difficult to decipher , while increasing @xmath12 by a factor 10 sharpens the fine structures of the phase - space density .",
    "since @xmath12 controls the intensity of close encounters between particles , this is not surprising . note that increasing @xmath12 by a factor 10 is probably an exaggeration , because it _ worsens dramatically _ the match during the mixing phase between the @xmath2-body simulation and the vlasov code when examining the correlators @xmath138 , a sign that @xmath12 is probably getting too close to a physical characteristic scale of the system . by a factor ten gives @xmath200 , to be compared for example to the size of the core of the system after relaxation , @xmath201 .",
    "] we indeed noticed that increasing @xmath12 only by a factor 5 does not have much impact , on the other hand , on @xmath138 .",
    "however , all these effects do not affect the amplitude of the large scale irregularities on the pattern of @xmath97 , which are present whatever value of @xmath12 .",
    "this is also a strong indication that close particle encounters are not at the origin of these irregularities .",
    "we can therefore only conclude that these irregularities and the associated nonlinear instability are the result of non trivial collective effects related to particle shot noise .",
    "this argument is also supported by the fact that in addition , the moment of their appearance is particle number dependent , as discussed in   [ sec : visu ] .",
    "[ lastpage ]"
  ],
  "abstract_text": [
    "<S> we perform a detailed comparison of the phase - space density traced by the particle distribution in gadget simulations to the result obtained with a spherical vlasov solver using the splitting algorithm . </S>",
    "<S> the systems considered are apodized hnon spheres with two values of the virial ratio , @xmath0 and @xmath1 . after checking that spherical symmetry </S>",
    "<S> is well preserved by the @xmath2-body simulations , visual and quantitative comparisons are performed . in particular </S>",
    "<S> we introduce new statistics , correlators and entropic estimators , based on the likelihood of whether @xmath2-body simulations actually trace randomly the vlasov phase - space density . </S>",
    "<S> when taking into account the limits of both the @xmath2-body and the vlasov codes , namely collective effects due to the particle shot noise in the first case and diffusion and possible nonlinear instabilities due to finite resolution of the phase - space grid in the second case , we find a spectacular agreement between both methods , even in regions of phase - space where nontrivial physical instabilities develop . </S>",
    "<S> however , in the colder case , @xmath3 , it was not possible to prove actual numerical convergence of the @xmath2-body results after a number of dynamical times , even with @xmath4 particles .    </S>",
    "<S> -1 cm    [ firstpage ]    gravitation  methods : numerical  galaxies : kinematics and dynamics  dark matter </S>"
  ]
}