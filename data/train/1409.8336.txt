{
  "article_text": [
    "the ability to perform fast and accurate dose calculations is of great importance to modern radiation therapy , especially in proton therapy , where range uncertainties can be critical . in terms of accuracy",
    ", it is widely accepted that monte carlo ( mc ) techniques are the gold standard for dose calculations .",
    "mc simulations of proton treatment plans have previously been performed using well - established packages such as geant4 , fluka and mcnpx @xcite . the improved accuracy of mc simulations compared to pencil beam calculations has been explicitly demonstrated @xcite . because of the enhanced accuracy , mc dose calculations can be used to verify results from pencil beam - based treatment planning systems ( tps ) , hence mitigating the effects of proton range uncertainties @xcite .",
    "unfortunately , computational times associated with mc - based treatment plan simulations using geant4 , fluka and mcnpx can be prohibitive .",
    "for example , a topas @xcite simulation of the dose within 2% statistical error ( @xmath01@xmath2 particle histories ) in a 150 @xmath3 tumor volume typically requires around 1 hour on a 100-node cpu cluster .",
    "this makes routine clinical qa of treatment plans very difficult .",
    "at best , mc evaluations can be reserved for a handful of cases , and even so , only if significant computing resources are available .",
    "recently , several attempts to implement condensed history mc simulations of proton transport on graphics processing units ( gpus ) have been made , with very encouraging results @xcite .",
    "using berger s classification , these attempts can be grouped as class i @xcite and ii @xcite . the typical processing time for @xmath4 particle histories is reported to be around 230 s. the impressive speed gain compared to cpu - based calculations is due to both algorithmic simplification and hardware acceleration . by far the most important approximation in refs.@xcite concerns proton - nucleus collisions .",
    "@xcite and osiecki et al .",
    "@xcite have computed proton depth - dose curves in water on the gpu , without any nuclear interactions .",
    "kohno et al .",
    "@xcite indirectly consider nuclear processes by using measured proton depth - dose curves in water to determine energy losses during particle stepping .",
    "jia et al .",
    "@xcite use a simplified model of non - elastic nuclear interactions ( based on the work of fippel and soukup @xcite ) , which can predict the energy spectrum of secondary protons from p@xmath5o collisions .",
    "the composition of all materials is assumed to be identical to water , and hence , only non - elastic collisions on @xmath5o are considered .",
    "their dose calculations in bone and low - density tissue demonstrate good agreement with geant4 , despite the lack of an in - depth model of nuclear interactions .",
    "however , in certain situations a more accurate model of nuclear processes is critical , e.g. particle propagation in patients with sizeable metallic implants , detailed studies of secondary particle production , neutron dose estimates and dose - averaged linear energy transfer ( let@xmath6 ) calculations .",
    "a non - elastic proton - nucleus interaction can be simulated with the mc method as a two - step process : a fast intranuclear ( inc ) cascade that leaves the nucleus in an excited state , followed by an evaporation stage @xcite .",
    "traditional cpu - based simulations are rather time - consuming : it takes @xmath0200s to compute @xmath7 200 mev p@xmath5o non - elastic interactions proton histories . ] with the bertini inc model in geant4.9.6p2 and the lige inc model @xcite ( incl++ v5.1 ) , respectively . in an effort to accelerate these calculations",
    ", we recently deployed a bertini - style simulation of non - elastic interactions on the gpu @xcite , achieving a speed - up factor of @xmath050 compared to the geant4 bertini model . in this paper , we present a gpu - based class ii condensed history proton transport mc , which uses our previously reported inc and evaporation kernels @xcite to simulate non - elastic collisions with any nucleus , on an event - by - event basis .",
    "elastic collisions of protons with nuclei other than hydrogen and oxygen are also modeled .",
    "very good agreement is obtained with geant4.9.6p2/topas . on a nvidia gtx680 card ,",
    "we report a net calculation time ( including all cpu operations and cpu - gpu data transfers ) of @xmath020 s for a typical plan with @xmath1 histories .",
    "previous authors @xcite report computational times that are of the same order . compared with previous work , our simulation therefore contains a much more comprehensive treatment of nuclear processes , while achieving comparable net computational times .",
    "this paper is organized as follows . in ",
    "[ section : simulationmodel ] , we describe our physics model and all the major components of our simulation . this includes realistic beam spot modeling , energy loss , multiple scattering , energy straggling , inc , nuclear evaporation , elastic nuclear scattering and transport mechanics . in ",
    "[ section : implementation ] , the gpu implementation is described : our parallelization strategy (  [ section : parallelization ] ) , the software structure (  [ section : softwarestructure ] ) and gpu memory management (  [ section : gpumemory ] ) .",
    "we give details of our validation methods and of our treatment plan re - calculation workflow in  [ section : tpscalc ] and [ section : validation ] respectively . in ",
    "[ section : results ] , we report on the validation results , comparing our mc simulation results with geant4.9.6p2/topas : ( 1 ) predictions from our model of non - elastic nuclear interactions (  [ section : nonelasticresults ] ) , ( 2 ) pencil beam dose distributions in homogeneous phantoms (  [ section : homogeneousphantoms ] ) , and ( 3 ) mc re - calculations of complex head and neck treatment plans (  [ section : treatmentplanresults ] ) .",
    "we then discuss a number of current and future applications of our work in ",
    "[ section : discussion ] , before summarizing and concluding in  [ section : conclusions ] .",
    "we focus only on transport through voxelized geometries .",
    "patient geometry is implemented from ct scans , using the formalism of schneider et al .",
    "@xcite to convert the hounsfield unit ( hu ) of each voxel to material density and composition .",
    "the hu to density conversion factors are the same as in ref.@xcite .",
    "following ref.@xcite , in the hu range between -1000 and 3060 we use 26 materials comprised of a combination of up to 12 elements , with everything above 3060 assumed to be metallic implant ( titanium by default ) .      total stopping power ( @xmath8 ) tables for protons in water , air and titanium",
    "are obtained from geant4.9.6p2 .",
    "proton range - energy tables are then generated via numerical integration in the continuous slowing down approximation ( csda ) .",
    "second derivatives are also pre - calculated so that the tables can be cubic - spline interpolated .",
    "the stopping power of a proton of energy @xmath9 in material @xmath10 with @xmath11 is related to @xmath12 , the stopping power in water , by : @xmath13 where @xmath14 is the density of material , @xmath15 is the density of water , and @xmath16 is a scaling factor .",
    "@xmath16 is tabulated as a function of hu using geant4.9.6p2 .",
    "for air ( hu = -1000 ) and titanium ( hu @xmath17 3060 ) , this scaling factor is not applied , and pre - generated tables are used directly instead .",
    "multiple scattering in each condensed history step is simulated using the highland formula @xcite . a multiplicative factor of 1.07",
    "is added to obtain comparable angular spread with geant4.9.6p2 , which employs the urban multiple scattering model @xcite .",
    "radiation lengths for all defined materials are pre - calculated with geant4.9.6p2 .",
    "we also implemented a full molire multiple scattering simulation , which takes into account the single scatter tail at the cost of slowing down the simulation by a factor of @xmath05 .",
    "all results presented in this work were produced using the scaled highland formula .",
    "energy straggling is simulated with a vavilov - gaussian model .",
    "fast sampling from vavilov distributions is achieved using chibani s method @xcite .",
    "the mean energy loss in each step is found by cubic - spline interpolating the range - energy table . for a material @xmath10 with @xmath18 ,",
    "the csda proton range @xmath19 is derived from the range in water , @xmath20 by : @xmath21    in this work the kinetic energies of @xmath22-ray electrons are assumed to be deposited locally . given the typical size of a voxel ( @xmath01 mm ) , this approximation holds very well for soft tissue and bone .      the step size @xmath23 is initially picked as the minimum of three quantities : ( 1 ) the distance to the next elastic or non - elastic nuclear interaction , @xmath24 , which is selected according to the total nuclear cross - section ( 2 ) the distance to the next voxel boundary , @xmath25 , and ( 3 ) the range of the proton , @xmath26 .",
    "we use a ` random hinge ' algorithm @xcite to take into account the small transverse displacement after each multiple scattering step .    if @xmath27 , a nuclear collision occurs , and the proton is propagated to the collision point .",
    "a random number is thrown to determine if the collision is elastic or non - elastic .",
    "the proton history is terminated if one of three conditions are met : ( 1 ) @xmath28 , which means that the proton is stopping in the current voxel , ( 2 ) @xmath29 , where @xmath30 mev , and ( 3 ) the proton is outside the boundaries of the voxelized geometry .",
    "non - elastic proton - nucleus cross - sections for all relevant nuclei in the energy range 0250 mev were tabulated using geant4.9.6p2 .",
    "once a non - elastic collision is deemed to happen , a random number is thrown and the target is picked according to the relative sizes of the non - elastic cross - sections of each nuclear component . after picking a random point of entry into the target",
    ", the proton is propagated through nuclear matter .",
    "this is repeated until an inc involving at least one pauli - allowed nucleon - nucleon collision occurs within the nucleus .",
    "we very briefly summarize the inc and evaporation simulations below ( for further details see ref.@xcite ) .",
    "the nucleus is assumed to be a two - component fermi gas of neutrons and protons .",
    "the nucleon density follows a woods - saxon distribution that is approximated by 15 constant density shells .",
    "the incident proton and all collision products are tracked in the nuclear matter , until they exit the nucleus or become trapped .",
    "pauli blocking is enforced by requiring the kinetic energies of all collision products to exceed their fermi energies .",
    "reflection and refraction at the potential shell boundaries are taken into account . in the therapeutic energy range ( @xmath31 mev ) , only elastic collisions between nucleons need to be considered . total and differential elastic nucleon - nucleon cross - sections are calculated using the parameterization of cugnon et al . @xcite .",
    "the result of the inc simulation is a number of outgoing nucleons and a residual nucleus that subsequently de - excites by particle evaporation .    to model the evaporation phase",
    ", we use the generalized evaporation model ( gem ) @xcite .",
    "the angular distribution of evaporated particles is assumed to be isotropic in the rest frame of the nucleus .",
    "other post - cascade processes such as photon evaporation , pre - equilibrium emission of particles , fission and fermi break - up are currently not considered .",
    "only protons produced in the inc and evaporation stages are stored for subsequent propagation .",
    "neutrons are presently assumed to be dosimetrically irrelevant , and the kinetic energies of all charged particles heavier than protons are locally deposited .",
    "we simulate coherent nuclear elastic collisions with all constituent nuclei in the patient geometry .",
    "collision kinematics are fully relativistic .",
    "total elastic cross - sections @xmath32 are obtained from geant4.9.6p2 .",
    "scattering angles @xmath33 in the center - of - mass frame are sampled according to the following parameterization of the elastic differential cross section by ranft @xcite : @xmath34 where @xmath35 is the mass number of the target and the invariant momentum transfer @xmath36 in ( gev / c)@xmath37 is given by @xmath38 , @xmath39 being the momentum of the scattered proton in gev / c .",
    "a topas simulation of the upcoming mayo proton center spot scanning nozzles has been developed ( fig .",
    "[ figure : nozzlepic ] ) .",
    "details of the different treatment nozzle geometries and the proton beam phase space parameters at nozzle entrance were supplied by the vendor .",
    "although commissioning data are not yet available to validate our model , preliminary spot size calculations are in good agreement with vendor specifications . the capability of geant4 to accurately simulate spot scanning nozzles has previously been demonstrated in ref .",
    "@xcite .",
    "we used the topas simulation to generate phase - space lists of protons near nozzle exit at 40 cm from isocenter plane , covering all synchrotron beam energies and treatment nozzle configurations .",
    "five kinematic variables are stored for each proton : the transverse positions @xmath40 , transverse directional cosines @xmath41 and kinetic energy @xmath9 . for any given beam energy",
    ", we verified that probability distributions of kinematic variables for all relevant off - axis beam - spots were essentially identical to those for central - axis spots .",
    "this significantly reduces the size of input phase - space data , since central - axis particle lists can be used to model off - axis beam spots .",
    "however , if the nozzle includes a range shifter , an energy reduction has to be applied to @xmath9 to account for the additional energy loss of protons in off - axis spots .",
    "this energy correction can be computed knowing the particle direction and the range shifter thickness .",
    "the phase - space files are pre - loaded into our mc at initialization time , and protons are generated at the nozzle exit . in practice , the number of primary proton histories in a given calculation has to be scaled down to account for losses due to nuclear interactions in the nozzle ; otherwise the dose deposited in the phantom or patient would be slightly overestimated .",
    "this scaling factor was calculated for each nozzle configuration and beam energy .",
    "the protons are then are propagated through air to the edge of the volume defined by the ct image in a single step , taking into account multiple scattering , energy straggling and nuclear interactions .",
    "we now describe our implementation of the above model on a gpu using the cuda c framework @xcite .",
    "the reader is assumed to be acquainted with gpu terminology ; if not , he or she is referred to the abundant resources available on the nvidia developer website @xcite .",
    "many different strategies have been used in the past to parallelize photon , neutron and charged particle transport mcs on the gpu .",
    "although no two simulations are identical , one can identify two broad paradigms : the ` one step per thread ' , and ` one particle history per thread ' methods .    in the first method ( e.g. refs.@xcite ) , the simulation of particle histories is split into basic components ( such as track stepping , boundary crossing and discrete physical interactions ) , which are accumulated and processed in parallel by kernels that contain little or no branching instructions . as shown by du et al .",
    "@xcite this strategy can result in a divergence - free simulation because all threads in a warp are made to execute the same set of instructions .",
    "the second method is the most commonly adopted approach . here",
    ", a gpu thread processes a particle history until end conditions are satisfied .",
    "since particle histories differ , thread divergence is inevitable , especially if more than one particle type are handled by a warp , or if a particle and its secondaries are tracked by the same thread .",
    "however , this method potentially results in a much reduced number of global memory transactions .",
    "for example , at the end of each step the particle position , direction and energy needs to be updated .",
    "these variables can be read from global to register memory , updated during track stepping and written back to global memory when end conditions are met .",
    "in contrast , in the ` one step per thread ' method , processing each track step would require at least one global memory read and write per kinematic variable , since one kernel launch occurs per step .",
    "comparing the two methods for a neutron transport mc , du et al .",
    "@xcite find the ` one step per thread ' method to be @xmath010 times slower . in their implementation",
    ", the benefits of a divergence - free simulation is overwhelmed by severe global memory access latency . in this work",
    "we therefore follow the ` one history per thread ' approach .",
    "we limit the effects of thread divergence to some extent by grouping non - elastic events and processing them in parallel .",
    "our code structure is discussed next .",
    "we implement the following five kernels : ( 1 ) a phase space kernel to set the initial kinematic variables of the protons in order to simulate realistic beam spots (  [ section : phasespace ] ) , ( 2 ) a transport kernel to evolve the proton history step by step through the voxelized geometry , taking into account energy loss fluctuations and scattering (  [ section : dedxmultscat ] ) , until it undergoes a non - elastic collision or meets one of the end conditions outlined in  [ section : transportmechanics ] , ( 3 ) an inc simulation kernel , ( 4 ) a nuclear evaporation kernel , and ( 5 ) a dose statistics kernel to evaluate the total and root mean square ( rms ) dose in each voxel .",
    "kernels ( 3 ) and ( 4 ) are described in further detail in ref.@xcite .",
    "we also use curand kernels @xcite for on - the - fly random number generation , and cuda thrust @xcite libraries for various bookkeeping operations .        for a dose calculation involving @xmath42 proton histories",
    ", we process @xmath43 groups of @xmath44 protons to evaluate statistical errors on the dose deposited in each voxel . due to gpu memory constraints , a group is further split into sub - groups of @xmath45 protons , where @xmath45 is an integer multiple of the number of gpu threads in a block .",
    "the sequence of kernel calls is shown in fig .",
    "[ figure : spockflowchart ] . before looping through the primary proton groups , the voxelized geometry , curand states , cross - sections , stopping power and range tables , physics constants , dose array and other simulation inputs",
    "are initialized . at the start of a proton sub - group loop ,",
    "the phase space kernel is launched to sample the kinematic variables of all primary protons in that sub - group .",
    "then the transport kernel is launched to simulate all protons until end conditions are met .",
    "if a nuclear interaction occurs , it is stored for subsequent batch processing .",
    "thrust utility kernels are then called to collect and sort non - elastic interactions .",
    "these are simulated in parallel by the inc kernel , resulting in a list of residual nuclei .",
    "this list is passed to the evaporation kernel to simulate the de - excitation mechanism .",
    "the inc and evaporation kernels are based on the model in  [ section : nuclearmodel ] .",
    "secondary protons produced in the transport , inc and evaporation kernels are collected using thrust functions , and the three kernels are again invoked in the same order .",
    "this is repeated until all secondary protons are simulated .",
    "the program then moves on to the next primary proton group .",
    "after all groups have been processed , the dose statistics kernel calculates the total and rms dose in each voxel from the dose tallies of each primary proton group .    in our mc ,",
    "cpu operations are limited to simulation initialization , kernel call control , and file output .",
    "the thread workload for each gpu kernel is as follows : the phase space kernel initializes the position @xmath46 , directional cosines @xmath47 and kinetic energy @xmath9 of one proton in each gpu thread .",
    "the transport kernel handles one proton history per thread , and the bertini cascade and evaporation kernels simulate one inc and one nuclear de - excitation per thread , respectively . as for the dose statistics kernel",
    ", it processes one voxel per thread .",
    "read - only data such as phase space kinematic variables , interaction cross - sections and stopping power and range tables are stored in as 1-d textures .",
    "constant memory is used for storing physics and mathematical constants .",
    "shared memory is barely used in this work .",
    "ct geometry information and the 3-d dose tallies of each primary proton group are kept in gpu global memory .",
    "all dose tallies need to be updated ` atomically ' to prevent race conditions when multiple threads are updating the dose deposited to the same voxel . for any proton group",
    ", a single dose tally was found to be sufficient on kepler cards .",
    "global memory is also used to store stacks of particles and excited nuclei , using structures of arrays ( soas ) to group together information relevant to each entity ( e.g. a soa of particles contains pointers to position , direction and kinetic energy arrays on device memory ) . using soas guarantees coalesced global memory transactions . to minimize global memory traffic , soas are read and updated once per kernel call .",
    "for example , in a transport kernel call , information contained in the particle soa is read into register memory , modified many times during particle tracking and written back to the soa at the end of the call .    as seen in fig .",
    "[ figure : spockflowchart ] , virtually all host - gpu data transfers occur either during the initialization stage or at simulation end , when the computed dose and dose rms maps are transferred to the host cpu for file output .",
    "particle soas are created and cleared at the beginning and end of a sub - group loop , respectively .",
    "data contained in the soas do not need to be transferred to the host between kernel calls .",
    "in other words , we tried to eliminate cpu - gpu data transfers as much as possible .",
    "the workflow that we adopted for recalculating plans from a commercially available tps is shown in fig .",
    "[ figure : dosecalcflowchart ] .",
    "dicom files ( plan , structure and image ) outputted by the tps are processed using a set of python scripts , to produce inputs for our mc .",
    "this step involves trimming the ct image to reduce computational time : using information contained in the structures file , a smaller rectangular volume containing the patient geometry is defined , so that air - filled voxels in the beam path are removed as much as possible .",
    "beam spot weights , isocenter positions , gantry and couch rotation angles , and details of the nozzle configuration are also read and outputted in text format . a ` bit mask '",
    "file specifying whether or not each voxel in the reduced volume is within a user - specified list of structures is created .",
    "this information allows the user to override the hu values of all voxels inside or outside a given structure , and to restrict dose file output to certain structures only .",
    "this considerably reduces gpu - cpu data transfer and file output times at simulation end .      to validate our nuclear model , we simulated non - elastic proton collisions on a large number of therapeutically relevant nuclei , with incident energies between 70 and 230 mev .",
    "we compared our predictions with geant4.9.6p2 ( using the bertini and binary cascade models ) and published measurements when available .    using our mc",
    ", we simulated infinitesimally narrow pencil beams of protons with energies between 70 and 230 mev , in various homogeneous voxelized phantoms including water , soft tissue , dense bone and pure calcium and titanium .",
    "the voxel size was 1 mm along all directions .",
    "the simulations were also carried out with geant4.9.6p2 , using the qgsp_bic_emy @xcite physics list .",
    "all particles were terminated once they exit the phantom , so as to eliminate any in - scattering contributions from outside the region of interest .",
    "these pencil beam simulations allowed us to verify and refine our implementation of the physics models for proton transport . we also simulated square fields of varying sizes in water at several beam energies , for different treatment nozzle configurations .",
    "these square field simulations were repeated with topas , using the nozzle model described in  [ section : phasespace ] .",
    "to verify our treatment plan calculations , we simulated three complex head and neck cases involving different patients using both topas and our gpu - based mc .",
    "the topas simulation again included the nozzle model described in ",
    "[ section : phasespace ] .",
    "both simulations adopted the native ct voxel size ( @xmath48 mm@xmath49 ) for particle transport and dose scoring . to quantify differences between the two mc we use the 3-d gamma index @xcite , which is also computed on the gpu .",
    "however , the 3-d gamma index might not be sensitive to systematic biases that are smaller than the pass criterion . to investigate these , we examined distributions of the percentage dose difference , defined for a given voxel as : @xmath50 where the dose calculated by topas and our mc in that voxel are @xmath51 and @xmath52 , respectively .",
    "we also define the quantities @xmath53 and @xmath54 .",
    "the latter is defined as : @xmath55 where @xmath56 is the dose calculated by our mc for the same number of protons , but using a different starting random number seed , and @xmath57 is the average percentage statistical uncertainty on the dose in the voxel .",
    "@xmath57 is estimated by dividing the total number of primary protons in 10 groups , as explained in ",
    "[ section : softwarestructure ] .",
    "@xmath53 , which measures the statistical error in the topas simulation , is defined in a similar way .",
    "ideally , 1-d distributions of @xmath58 , @xmath53 and @xmath54 in the targets should be gaussians peaked at zero , with identical widths .",
    "biases and other model discrepancies result in peak shifts and rms differences .",
    "c , ( b ) 113 mev p@xmath59c , ( c ) 200 mev p@xmath5o and ( d ) 200 mev p@xmath60ca collisions , compared with geant4 bertini and binary cascade model predictions and measurements from refs.@xcite.,title=\"fig:\",width=292 ] c , ( b ) 113 mev p@xmath59c , ( c ) 200 mev p@xmath5o and ( d ) 200 mev p@xmath60ca collisions , compared with geant4 bertini and binary cascade model predictions and measurements from refs.@xcite.,title=\"fig:\",width=292 ] c , ( b ) 113 mev p@xmath59c , ( c ) 200 mev p@xmath5o and ( d ) 200 mev p@xmath60ca collisions , compared with geant4 bertini and binary cascade model predictions and measurements from refs.@xcite.,title=\"fig:\",width=292 ] c , ( b ) 113 mev p@xmath59c , ( c ) 200 mev p@xmath5o and ( d ) 200 mev p@xmath60ca collisions , compared with geant4 bertini and binary cascade model predictions and measurements from refs.@xcite.,title=\"fig:\",width=292 ]    fig .",
    "[ figure : inccalcs ] shows predicted differential cross - sections for proton and neutron production in : ( a ) 90 mev p@xmath59c , ( b ) 113 mev p@xmath59c , ( c ) 200 mev p@xmath5o and ( d ) 200 mev p@xmath60ca collisions at various angles .",
    "the values are normalized to total cross - sections from cugnon et al .",
    "@xcite and have been scaled down for display clarity ( except for the topmost curves ) . in general , reasonable agreement is obtained with both geant4.9.6p2 models and published data . the bertini and binary models are routinely included in the physics lists used in geant4-based dose calculations .",
    "further comparisons of our inc and evaporation kernel predictions with geant4 are shown in ref.@xcite .",
    ".[table : incruntimeresults ] time taken in seconds to compute @xmath61 proton@xmath5o and proton@xmath60ca interactions at 200 mev incident proton kinetic energy ( k.e ) .",
    "[ cols=\"^,^,^,^,^\",options=\"header \" , ]",
    "at our clinic , the gpu - based proton transport mc is being used in two applications that can potentially play an important role in mitigating the effects of proton range uncertainties :    1 .",
    "our mc was deployed on a dual k20xm gpu server to routinely qa treatment plans from a commercially - available tps . due to the very fast computational speed , near real - time feedback on the accuracy of most plans",
    "is achievable .",
    "this would not have been possible with a conventional , cpu - based mc .",
    "a friendly user interface for this verification system is being developed to make the software easily accessible to dosimetrists .",
    "another python script , not shown in fig .",
    "[ figure : dosecalcflowchart ] , allows the mc - calculated dose to be imported into the tps for convenient evaluation and display .",
    "2 .   in addition",
    ", we have developed a gpu - based intensity modulated proton therapy ( impt ) optimization code that adopts our mc as the dose computation engine @xcite . for a complex three - field head and neck plan , the full calculation , including the initial dose map for all relevant beam spots ,",
    "is estimated to take half an hour on a cluster with 24 gpus .",
    "therefore , using gpu acceleration , mc - based impt planning can be clinically applicable on a routine basis .",
    "we are currently upgrading this code to a robust mc - based impt optimization system .",
    "we are planning the following two improvements to our physics model : simulation of the production and transport of @xmath22-rays , and propagation of secondary neutrons from non - elastic nuclear interactions of protons in the patient .",
    "the ability to evolve neutron histories will allow us to make very fast and accurate neutron dose calculations .",
    "map ( in units of kev/@xmath62 m ) , in the same coronal plane as in fig .",
    "[ figure : barfigpaper ] .",
    ", width=226 ]    as discussed above , one of the main strengths of this work is the ability to carry out detailed nuclear interaction simulations very rapidly on the gpu .",
    "it was shown in ref.@xcite that secondary protons have a significant impact on the let@xmath63 distribution in clinical proton beams .",
    "in fact , our mc is capable of computing physical dose and let@xmath63 simultaneously ; this does not considerably extend the net computational time .",
    "the let@xmath6 calculations in water are in good agreement with topas .",
    "[ figure : barlet ] shows our prediction of the let@xmath6 distribution in areas with at least 10% of the maximum dose , in the same coronal plane as in fig .",
    "[ figure : barfigpaper ] . as expected , let@xmath6 values are higher in regions where the protons are ranging out . at present , our let@xmath6 values neither include the small contributions of proton recoils from scattering of secondary neutrons , nor heavy ion recoils . the neutron scattering portion will be taken into account after the addition of a neutron transport kernel to our mc . the ability to perform mc - based let@xmath6 calculations rapidly and accurately on",
    "the gpu opens very exciting prospects for biological treatment planning .",
    "to summarize , we have successfully developed a gpu - based proton transport mc that incorporates bertini cascade and evaporation kernels for modeling non - elastic interactions of protons with any nucleus in the therapeutic energy range .",
    "we have verified our mc extensively using geant4 and topas .",
    "the net computation speed is typically @xmath020 s per @xmath4 proton histories , which is comparable to processing times reported by previous authors using simulations with simpler nuclear interaction models .",
    "the very fast calculation speed allowed this mc to be used in our clinic as the central component of a treatment plan verification system , and also as the dose calculation engine for mc - based impt optimization .",
    "furthermore , the detailed nuclear modeling not only gives us greater confidence in our physical dose calculations , but will allow us to perform accurate gpu - based mc calculations of let@xmath6 , as well as fast neutron dose estimates .",
    "this work was partially funded by a grant from varian medical systems , inc .",
    "we are grateful to our colleagues at mayo clinic for carefully reading the manuscript ."
  ],
  "abstract_text": [
    "<S> * purpose : * very fast monte carlo ( mc ) simulations of proton transport have been implemented recently on graphics processing units ( gpus ) . </S>",
    "<S> however , these mcs usually use simplified models for non - elastic proton - nucleus interactions . </S>",
    "<S> our primary goal is to build a gpu - based proton transport mc with detailed modeling of elastic and non - elastic proton - nucleus collisions . </S>",
    "<S> + * methods : * using the cuda framework , we implemented gpu kernels for the following tasks : ( 1 ) simulation of beam spots from our possible scanning nozzle configurations , ( 2 ) proton propagation through ct geometry , taking into account nuclear elastic scattering , multiple scattering , and energy loss straggling , ( 3 ) modeling of the intranuclear cascade stage of non - elastic interactions when they occur , ( 4 ) simulation of nuclear evaporation , and ( 5 ) statistical error estimates on the dose . to validate our mc </S>",
    "<S> , we performed : ( 1 ) secondary particle yield calculations in proton collisions with therapeutically - relevant nuclei , ( 2 ) dose calculations in homogeneous phantoms , ( 3 ) re - calculations of complex head and neck treatment plans from a commercially - available treatment planning system , and compared with geant4.9.6p2/topas . </S>",
    "<S> + * results : * yields , energy and angular distributions of secondaries from non - elastic collisions on various nuclei are in good agreement with the geant4.9.6p2 bertini and binary cascade models . </S>",
    "<S> the 3d - gamma pass rate at 2%-2 mm for treatment plan simulations is typically 98% . </S>",
    "<S> the net computational time on a nvidia gtx680 card , including all cpu - gpu data transfers , is @xmath020 s for @xmath1 proton histories . </S>",
    "<S> + * conclusions : * our gpu - based mc is the first of its kind to include a detailed nuclear model to handle non - elastic interactions of protons with any nucleus . </S>",
    "<S> dosimetric calculations are in very good agreement with geant4.9.6p2/topas . </S>",
    "<S> our mc is being integrated into a framework to perform fast routine clinical qa of pencil - beam based treatment plans , and is being used as the dose calculation engine in a clinically - applicable mc - based impt treatment planning system . </S>",
    "<S> the detailed nuclear modeling will allow us to perform very fast linear energy transfer and neutron dose estimates on the gpu .    </S>",
    "<S> _ keywords _ : proton therapy , cuda , gpu , monte carlo , non - elastic </S>"
  ]
}