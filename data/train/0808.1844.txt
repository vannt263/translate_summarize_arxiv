{
  "article_text": [
    "over the last decade , numerical simulations have developed into a cornerstone of astrophysical research . from interactions of vast clusters of galaxies to the formation of proto - planetary discs , simulations allow us to evolve systems through time and view them at every angle .",
    "they are an irreplaceable test - bed of our physical understanding of the universe .",
    "a number of hydrodynamics codes have been developed that are widely used in this field and still more are being developed .",
    "fundamentally , they all do the same job ; they solve the equations of motion to calculate the evolution of matter through time .",
    "whether the matter represents a nebula for the birth of a star or a network of galaxy clusters , the basic technique remains the same .",
    "however , the algorithms used to solve these equations vary from code to code and this results in differences in the resulting data .",
    "understanding the origin of these variations is vital to the understanding of the results themselves ; is an observed anomaly an interesting piece of new physics or a numerical effect ? as observational data takes us deeper into the universe , it becomes more important to pin down the origin of these numerical artifacts .",
    "additionally , it is difficult to compare results from simulations run with different codes . with observations , papers clearly state the properties of the instrument such as the diameter of the mirror and the wavelengths it is most sensitive to . while a brief description of the code is always included in theoretical papers , there exists no obvious conversion to other numerical techniques and therefore the results are more difficult for the reader to interpret .",
    "the problem of code comparison is not new and it is a topic that has recently created a great deal of interest .",
    "the reason for its current importance is a positive one ; improved numerical techniques and increased computer power have resulted in simulations reaching greater resolutions than could have been imagined even a few years ago .",
    "however , this high refinement comes at a price ; as we start to pick out the detail of these complex fluid flows , the physics we need to consider gets dramatically more complicated .",
    "this brings us to the main question code comparison projects are trying to answer ; can we use the same tools for this new regime of problems ?",
    "a number of papers have come out that tackle this .",
    "one of the most famous is the santa barbara comparison project @xcite which compared many of the progenitors of today s codes by running a model of a galaxy cluster forming .",
    "taking a different tack @xcite compared the performance of a dozen different implementations of a single approach ( in this case smoothed particle hydrodynamics , sph ) on standard astrophysical problems that included the sod shock , examining the range of outcomes that were available from a single technique .",
    "they concluded that one of the weaknesses of sph was the weak theoretical grounding which allows several equally viable formulations to be derived .",
    "more recent work includes @xcite , who focus specifically on the formation of fluid instabilities , comparing the formation of kelvin - helmholtz and rayleigh - taylor instabilities in six of the most utilised codes .",
    "additionally , @xcite has completed a direct comparison between two particular codes ( _ enzo _ and _ gadget2 _ , see below ) looking at the formation of galaxies in a cosmological context .",
    "all these projects give detailed insights into the differences between the codes , but are unable to provide a quantitative measure of how well a code performs in a particular aspect .",
    "this is especially true of the cosmological - based tests of @xcite where the problem is not sufficiently well - posed for convergence onto a single answer .",
    "@xcite sets out a simpler problem and compares it to analytical predictions , but the system is still sufficiently complex not to have an exact solution .",
    "additionally , no previous comparison has attempted to quantitatively compare different codes to one another ; asking whether it is possible to obtain identical results and with what conditions . without this crucial piece of information , it is impossible to fully assess a piece of work performed by an unfamiliar code or to judge which code might be the most suited to a given problem type . this has resulted in somewhat general comments being made about the differences between numerical techniques which has led to many myths about a code s ability becoming accepted dogma .",
    "the set of tests we present in this paper are designed to tackle these difficulties with the intention that they might become part of an established test programme all hydrodynamical codes should attempt .",
    "we present four problems that specifically address different aspects of the numerical code all of which have expected ` correct ' answers to compare to .",
    "the first two tests , the sod shock tube and sedov blast , are both strong shock tests with analytical solutions .",
    "the third and forth tests concern the stability of a galaxy cluster and are primarily tests of the code s gravitational solver .",
    "for all four tests we directly compare the codes against the analytic solution and present an estimate of the main sources of any systematic error .",
    "the remainder of this paper is organised as follows : in section 2 we give a short summary of the main features of each of the four codes we have employed . in section 3",
    "we deal with the sod shock and sedov blast tests , setting out the initial and final states and comparing each code against them .",
    "we repeat this exercise for a static and translating king sphere in section 4 .",
    "finally we discuss our results and summarise our conclusions in section 5 .",
    "the two major techniques for modelling gases in astrophysics are smoothed particle hydrodynamics ( sph ) and adaptive mesh refinement ( amr ) . in the first of these ,",
    "the gas is treated as a series of particles whose motion is dictated by lagrangian dynamics . in amr",
    ", the gas is modelled by a series of hierarchical meshes and the flow of material between cells is calculated to determine its evolution .",
    "there are a variety of codes which utilise both techniques and four of the major ones will be used to run the tests presented in the this paper , two of which use sph ( _ hydra _ and _ gadget2 _ ) and two of which use amr ( _ enzo _ and _ flash _ ) .      _",
    "enzo _ is a massively parallel , eulerian adaptive mesh refinement code , capable of both hydro and n - body calculations @xcite .",
    "it has two hydro - algorithms which can be selected by the user ; the piecewise parabolic method ( ppm ) and the zeus astrophysical code . the ppm solver @xcite uses godunov s method but with a higher - order spatial interpolation , making it third - order accurate .",
    "it is particularly good at shock capturing and outflows .",
    "the zeus method in _ enzo _ is a three - dimensional implementation of the zeus astrophysical code developed by @xcite .",
    "it is a simple , fast algorithm that allows large problems to be run at high resolution . rather than godunov s method",
    ", zeus uses an artificial viscosity term to model shocks , a technique which inevitably causes some dissipation of the shock front .",
    "we compare both these hydro - schemes in these tests .      _",
    "gadget2 _ is a massively parallel , lagrangian , cosmological code that is publicly available from the author s website @xcite .",
    "it is an n - body / sph code that calculates gravitational forces by means of the tree method @xcite and is also able to optionally employ a tree - pm scheme to calculate the long range component of the gravitational interactions . in order to follow the hydrodynamic behaviour of a collisional medium ,",
    "the code uses the entropy - conserving formulation of sph described in @xcite : the main difference of this approach with respect to the standard @xcite formulation of sph resides in the choice of describing the thermodynamic state of a fluid element in terms of its specific entropy rather than its specific thermal energy .",
    "this leads to a tight conservation of both energy and entropy in simulating dissipation - free systems . additionally , _",
    "gadget2 _ employs a slightly modified parametrisation of the artificial viscosity ( by introducing the so called `` signal velocity '' as in @xcite ) .",
    "the user is allowed to set the strength of this artificial viscosity for the specific problem being considered via an input parameter , @xmath0 .",
    "the time stepping scheme adopted by the code is a leap - frog integrator guaranteed to be symplectic if a constant timestep for all particles is employed . in this work",
    "we have exploited the possibility of using fully adaptive individual timesteps for all the particles in the simulation , this being a standard practice .",
    "_ hydra _ is an adaptive particle - particle , particle - mesh code combined with smoothed particle hydrodynamics @xcite .",
    "it has the significant disadvantage that even though massively parallel versions exist @xcite , the publically available version is not a parallel implementation and so this code can not , as released , be used for very large simulations .",
    "akin to _ gadget2 _ , _ hydra _ uses an entropy conserving implementation of sph , but unlike _ gadget2 _ , _ hydra _ does not have fully adaptive individual timesteps .",
    "although the timestep adapts automatically from one step to the next all the particles move in lockstep .      _ flash _ is a publicly available massively parallel eulerian amr code developed by the alliances center for astrophysical thermonuclear flashes @xcite .",
    "originally intended for the study of x - ray bursts and supernovae , it has since been adapted for many astrophysical conditions and now includes modules for relativistic hydrodynamics , thermal conduction , radiative cooling , magnetohydrodynamics , thermonuclear burning , self - gravity and particle dynamics via a particle - mesh approach .",
    "_ flash _ uses the oct - tree refinement scheme of the paramesh package , with each mesh block containing the same number of internal zones .",
    "neighbouring blocks may only differ by one level of refinement with each level of refinement changing the resolution by a factor of two .",
    "the hydrodynamics are based on the prometheus code @xcite .",
    "the input states for the riemann solver are obtained using a directionally split ppm solver @xcite and a variable time step leapfrog integrator with second order strang time splitting is adopted @xcite .",
    "this work uses a modified hybrid fftw based multigrid solver to solve poisson s equation and determine the gravitational potential at each timestep .",
    "this results in a vast reduction in time spent calculating the self - gravity of the simulation relative to a conventional multigrid solver .",
    "_ flash s _ refinement and de - refinement criteria can incorporate the adapted @xcite error estimator .",
    "this calculates the modified second derivative of the desired variable , normalised by the average of its gradient over one cell .",
    "one of the greatest differences between simulations performed now versus those undertaken five years ago is the increasing importance of modelling strong shocks accurately .",
    "while it has long been known that the universe is a violent place , with events such as supernovae , galaxy mergers and agn generating blasts which rip through the intergalactic medium , simulations did not have the resolution to see such phenomena in detail , so these sharp discontinuities were largely ignored .",
    "now , as we struggle to understand the effects of feedback in galaxy formation , multiphase media are essential physics @xcite . in order to attack such problems codes must be able to capture shocks with some proficiency .",
    "these two problems , the sod shock test and the sedov blast test , explicitly test the resolution of shock jumps and allow comparison with exact analytical solutions .       plane , while the right - hand image shows it oriented along the [ 1,1,0 ] plane .",
    "in actuality our second test is oriented in the [ 1,1,1 ] plane i.e. oblique to all the axes . ]",
    "the shock tube problem @xcite has been used extensively to test the ability of hydrodynamics codes to resolve a sharp shock interface @xcite .",
    "the test set - up is simple , consisting of two fluids of different densities and pressures separated by a membrane that is then removed .",
    "the resulting solution has the advantage of showing all three types of fluid discontinuities ; a shock wave moving from the high density fluid to the low density one , a rarefaction ( sound ) wave moving in the opposite direction and a contact discontinuity which marks the current location of the interface between the two fluids . for this test",
    "the initial conditions are traditionally chosen such that the pressure does not jump across the contact discontinuity .",
    "we extend the traditional one - dimensional shock tube problem to consider two three - dimensional set - ups ; the first of these has the fluid membrane at 90@xmath1 to the x - axis of the box ( [ 1,0,0 ] plane ) , causing the shock to propagate parallel to this axis . in the second test",
    ", the membrane is lined up at 45@xmath1 to each of the @xmath2 and @xmath3 axes ( [ 1,1,1 ] plane ) .",
    "this change in orientation of the shock is designed to highlight any directional dependencies inherent in the code , as illustrated in figure  [ fig : shock_setup ] .",
    "all analysis was performed perpendicular to the original shock plane .    for our particular",
    "set - up we chose the initial density and pressure jump either side of the membrane to be from @xmath4 to @xmath5 with the fluid initially at rest .",
    "the polytropic index was @xmath6 .",
    "periodic boundary conditions were used and the results were analysed at @xmath7 .",
    "figures  [ fig : sod_density ] and [ fig : sod_all ] show the results from all four codes running this test . in the results presented in these figures , both _",
    "enzo _ and _ flash _ used an @xmath8 initial ( minimum refinement ) grid with two levels of higher refinement each of which decreased the cell size by a factor of 2 .",
    "the smallest cell size in this case was therefore @xmath9 of the unit box .",
    "_ enzo _ refined anywhere the gradient of the derived quantities exceeded a critical value whereas _ flash _ placed refinements according to the @xcite error estimator described in section  [ sec : flash ] which places subgrids based on the second derivative of the derived quantities . for the sph codes , both _",
    "hydra _ and _ gadget2 _ were run with 1 million particles formed from two glasses containing 1.6 million and 400,000 particles .",
    "the solid black line in all cases is the analytical solution which requires a shock at @xmath10 and a contact discontinuity in the density at @xmath11 at @xmath7 .",
    "what is clear from figures  [ fig : sod_density ] and [ fig : sod_all ] is that all of the codes pass the zeroth level test and successfully reproduce the shock jump conditions , although both the sph codes suffer from visible ringing and broadening around any discontinuities .",
    "_ enzo ( zeus ) _ does not produce the shock jump condition as accurately as _ enzo ( ppm ) _ and _ flash _ , as seen in the plots of energy and entropy in figure   [ fig : sod_all ] , where its post - shock values are around 2% lower . in the oblique case ,",
    "the quadratic viscosity term , @xmath12 , in _ enzo ( zeus ) _ was increased from its default value of 2.0 to 10.0 .",
    "the effect of this value is discussed more fully in relation to the sedov blast test in section  [ sec : code_spec ] . for the planar case ,",
    "@xmath12 was kept at 2.0 .",
    "pleasingly none of the other codes appear to have any visible directional dependence , performing equally well in both the grid aligned and oblique cases we tried .",
    "all the codes could equally well resolve the location and smooth rise of the rarefaction wave but both the sph codes struggle with the contact discontinuity , with a large overshoot not seen by either of the mesh based codes .",
    "this is partly due to the initial conditions as for the sph codes the sudden appearance of a density jump introduces a local source of entropy . in this paper",
    "we are contrasting the results from the different approaches rather than studying the sod shock problem itself in detail . as it is a standard test case higher resolution results can be found in the individual code s method papers ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "closer inspection of the data reveals differences in each code s capacity to handle strong shocks . in the bottom row of figure",
    "[ fig : sod_density ] , we show a close - up of the density over the shock - front . capturing shocks",
    "accurately is an area that sph codes traditionally struggle with more than their eulerian counterparts due to their inherent nature of smoothing between particles .",
    "indeed , we see in this figure both _ gadget2 _ and _ hydra _ have a smeared out the interface compared to _",
    "enzo _ and _ flash s _ steep drop in density .",
    "small differences between the amr codes are also visible here .",
    "_ enzo ( ppm ) _ spreads the shock front over three cells , whereas _ enzo ( zeus s ) _ use of the artificial viscosity term extends this to five . _ flash s",
    "_ ppm scheme gives very similar results to _ enzo ( ppm ) _ , also spreading the shock front over three cells .",
    "figure  [ fig : sod_all ] shows the pressure , internal energy , velocity and computational entropy @xmath13 over the region of interest for the planar [ 1,0,0 ] set - up ( left column ) and the oblique [ 1,1,1 ] set - up ( right column ) .",
    "both _ hydra _ and _ gadget2 _ show signs of post - shock ringing in the velocity plot .",
    "the two lagrangian codes adopt different implementations of artificial viscosity ; with a frequently used choice of the viscosity parameter ( artbulkvisc = 1 ) the ringing features in _ gadget2 _",
    "s profiles appears to be more pronounced than in hydra s ( not shown in the plot ) .",
    "in order for _",
    "gadget2 _ to get closer to hydra s performance , a choice of a significantly higher viscosity parameter has been necessary ( namely @xmath14 ) .",
    "the results produced under such a choice are shown in figure  [ fig : sod_all ] .",
    "the sph codes also exhibit a large spike in both internal energy and entropy at the location of the contact discontinuity .",
    "this is driven by the initial conditions , where two independent particle distributions suddenly appear immediately adjacent to one another .",
    "we saw in the previous section that most of the codes model shock development and sound wave propagation with reasonable success and that they show no directional preference to the orientation of the shock interface .",
    "however , differences were apparent between each of the codes , most obviously between the sph and amr techniques ( unsurprising , since their numerical algorithms fundamentally differ ) . in this section",
    ", we quantitatively compare results from each code and attempt to get as close a match between their results as possible .",
    "for simplicity , we confine the amr codes to using static meshes for this comparison .",
    "figure  [ fig : sod_comparison ] shows a graphical comparison of the density projection between a _",
    "run of 1 million particles and _ enzo ( ppm ) _ for different grid sizes .",
    "it is clear that a grid size of @xmath15 produces significantly poorer results than the _ hydra _ data whereas a grid size of @xmath8 produces significantly better results particularly in the low density region .",
    "although the situation is confused by the lack of points available with _ enzo _ , a grid size of @xmath15 can produce no more than 20 distinct values across the length of the volume being modelled , it is clear that this is too few to recover this model .",
    "however , even with @xmath16 cells in the box the major features are largely recovered . to make further progress we require a more quantitative way of comparing the results from the codes . to achieve this",
    ", we employ a cubic spline to interpolate the data from all runs to the same 178 @xmath17 points at which we have calculated the analytical values .",
    "the residue between each new curve and the analytical solution was then summed and divided by the number of points .",
    "we considered the residue both across the whole region of interest from [ -0.15 , 0.15 ] and just across the shock - front from [ -0.13 , -0.06 ] .",
    ".residue of from the analytical solution of the sod shock density in the planar [ 1,0,0 ] set - up for different static grid sizes and sph resolutions for _ enzo , hydra _ and _ gadget2_. [ cols=\"^,^,^ \" , ]     [ table : times ]    while this paper attempts to cover the major features of astrophysical simulations , it does comprise only four tests .",
    "further examples would extend this paper beyond its scope ( and readability ) , but the differences between codes can not be fully cataloged without further testing .",
    "this paper then , is designed as a starting point for a suite of tests to be developed from which codes can be quantitatively compared for the jobs they are intended for . to assist groups wishing to run these tests on their own code and to compare new updates",
    ", we are making these results and initial conditions available on the web at http://www.astro.ufl.edu/codecomparison .",
    "the authors would like to thank alexei kritsuk , volker springel & richard bower for helpful suggestions and advice and lydia heck for computational support .",
    "ejt acknowledges support from a theoretical astrophysics postdoctoral fellowship from dept . of astronomy / clas , university of florida and",
    "both ejt and glb acknowledge support from nsf grants ast-05 - 07161 , ast-05 - 47823 , and ast-06 - 06959 .",
    "dm acknowledges support from the eu magpop marie curie research and training network . many simulations with _ enzo _",
    "were performed at the national center for supercomputing applications and at the university of florida high - performance computing center who also provided excellent computational support .",
    "the _ flash _",
    "software used in this work was in part developed by the doe - supported asc / alliance center for astrophysical thermonuclear flashes at the university of chicago .",
    "hydra _ and _ gadget2 _ simulations were carried out on the nottingham hpc facility .",
    "flash _ simulations were carried out on the virgo consortium computing facility in durham .",
    "couchman h.  m.  p. , thomas p.  a. , pearce f.  r. , 1995 , apj , 452 , 797 pearce f.  r. , couchman h.  m.  p. , 1997 ,",
    "newa , 2 , 411 agertz o. , et al . , 2007 , mnras , 380 , 963 barnes j. , hut p. , 1986",
    ", natur , 324 , 446 bryan , g.  l. , & norman , m.  l.  1997 , arxiv astrophysics e - prints , arxiv : astro - ph/9710187 feng , l .- l . , shu , c .- w . , &",
    "zhang , m.  2004 , apj , 612 , 1 fryxell b. , et al . , 2000 , apjs , 131 , 273 fryxell b. , mller e. , arnett d. , 1989 , nuas.conf , 100 frenk c.  s. , et al . , 1999 , apj , 525 , 554 king i.  r. , 1966 , aj , 71 , 64 landau , l.  d. , & lifshitz , e.  m.  1959 , course of theoretical physics , oxford : pergamon press , 1959 , lhner , r. , 1987 , comp .",
    "61 , 323 mitchell , n.  l. , mccarthy , i.  j. , bower , r.  g. , theuns , t. , & crain , r.  a. ,  in prep , mnras monaghan j.  j. , 1992 , ara&a , 30 , 543 monaghan j.  j. , 2001 , jkas , 34 , 203 oshea b.  w. , nagamine k. , springel v. , hernquist l. , norman m.  l. , 2005 , apjs , 160 , 1 oshea , b.  w. , bryan , g. , bordner , j. , norman , m.  l. , abel , t. , harkness , r. , & kritsuk , a.   2004 , arxiv astrophysics e - prints , arxiv : astro - ph/0403044 padmanabhan , t.  2002 , theoretical astrophysics , by t.  padmanabhan , pp .  638 .",
    "isbn 0521562422 .",
    "cambridge , uk : cambridge university press , october 2002 . , robertson b. , kravtsov a. , 2007 , arxiv , 710 , arxiv:0710.2102 ryu , d. , ostriker , j.  p. , kang , h. , & cen , r.  1993 , apj , 414 , 1 shapiro , p.  r. , martel , h. , villumsen , j.  v. , & owen , j.  m.  1996 , apjs , 103 , 269 sedov , l.  i.  1959 , similarity and dimensional methods in mechanics , new york : academic press , 1959 , sod , g.  a.  1978 , journal of computational physics , 27 , 1 springel v. , 2005 , mnras , 364 , 1105 springel v. , hernquist l. , 2003 , mnras , 339 , 289 springel v. , hernquist l. , 2002 , mnras , 333 , 649 stone , j.  m. , & norman , m.  l.  1992 , apjs , 80 , 753 strang , g. , 1968 , siam j. numer .",
    ", 5 , 506 tasker , e.  j. , & bryan , g.  l.  2008 , apj , 673 , 810 tasker e.  j. , bryan g.  l. , 2006 , apj , 641 , 878 thacker r.  j. , tittley e.  r. , pearce f.  r. , couchman h.  m.  p. , thomas p.  a. , 2000 , mnras , 319 , 619 wada k. , norman c.  a. , 2007 , apj , 660 , 276 wadsley , j.  w. , veeravalli , g. , & couchman , h.  m.  p.  2008 , mnras , 387 , 427 woodward , p.  r. , & colella , p.  1984",
    ", journal of computational physics , 54 , 174"
  ],
  "abstract_text": [
    "<S> we test four commonly used astrophysical simulation codes ; enzo , flash , gadget and hydra , using a suite of numerical problems with analytic initial and final states . </S>",
    "<S> situations similar to the conditions of these tests , a sod shock , a sedov blast and both a static and translating king sphere occur commonly in astrophysics , where the accurate treatment of shocks , sound waves , supernovae explosions and collapsed haloes is a key condition for obtaining reliable validated simulations . </S>",
    "<S> we demonstrate that comparable results can be obtained for lagrangian and eulerian codes by requiring that approximately one particle exists per grid cell in the region of interest . </S>",
    "<S> we conclude that adaptive eulerian codes , with their ability to place refinements in regions of rapidly changing density , are well suited to problems where physical processes are related to such changes . </S>",
    "<S> lagrangian methods , on the other hand , are well suited to problems where large density contrasts occur and the physics is related to the local density itself rather than the local density gradient .    hydrodynamics  methods : numerical  cosmology : theory </S>"
  ]
}