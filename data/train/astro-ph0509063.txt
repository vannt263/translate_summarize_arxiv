{
  "article_text": [
    "three of jupiter s notable features are : rapid rotation ( spin period of just under ten hours ) ; an atmosphere striped with a large number of alternating zones and belts corresponding to strongly shearing east - west winds ( hundreds of m / s ) ; and many long - lived , coherent vortices , the most prominent being the great red spot ( grs ) .",
    "of course , these three characteristics  rotation , shear , and vortices  are all dynamically linked , so much so that it is often claimed that the presence of the first two implies the likely existence of the third ( see * ? ? ? * ; * ? ? ? * for reviews ) .",
    "protoplanetary disks ( the disks of gas and dust in orbit around newly - forming protostars ) also have rapid rotation and intense shear , which has inspired proposals that such disks should also be populated with long - lived , coherent storms @xcite .",
    "these vortices may play two critical roles in star and planet formation : ( 1 ) in cool , non - magnetized disks , vortices may transport angular momentum radially outward so that mass can continue to accrete onto the growing protostar , and ( 2 ) vortices are very efficient at capturing and concentrating dust particles , which may help in the formation of planetesimals , the basic `` building blocks '' of planets .    motivated by these geophysical and astrophysical problems ,",
    "we have developed a three - dimensional ( 3d ) spectral hydrodynamic code that employs specially tailored algorithms to handle the computational challenges due to rapid rotation , intense shear , and strong stratification . in subsonic flow ,",
    "short - wavelength acoustic waves have periods that are much shorter than the characteristic timescale of the large - scale advective motions .",
    "in numerical simulations , the time - step for an explicit algorithm must be short enough to temporally resolve these fast waves ( i.e. ,  the courant - friedrich - lewy , or cfl , condition ) , which may be inefficient for calculating the evolution of the slower , large - scale flow for long integration times .",
    "one strategy is to filter sound waves from the fluid equations ( `` sound - proofing '' ) so that the time - step will be limited by the longer advective timescale .",
    "the anelastic approximation does this by replacing the full continuity equation with the kinematic constraint that the mass flux be divergence - free .",
    "this approximation still allows for the effects of density stratification ( e.g. ,  buoyancy in the vertical momentum equation , pressure - volume work in the energy / entropy equation ) and has been employed extensively in the study of deep , subsonic convection in planetary atmospheres @xcite and stars @xcite . in @xcite ,",
    "we re - derived the anelastic approximation in the context of protoplanetary disks .",
    "stratified media support the propagation of internal gravity waves .",
    "as these waves travel from high density to low density regions , their amplitudes can grow to large values ( so as to conserve energy flux ) .",
    "if the density contrast is large , velocity and thermodynamic fluctuations can become sufficiently large so as to invalidate the anelastic approximation and/or violate the cfl condition .",
    "we have developed a technique based on `` negative feedback '' to damp these waves when they propagate into low - density gas which has very little inertia .",
    "we compute the evolution of the anelastic equations with a spectral method . the basic philosophy of spectral methods is to approximate any function of interest with a finite sum of basis functions multiplied by spectral coefficients @xcite .",
    "a partial differential equation ( pde ) in space and time is reduced to a coupled set of ordinary differential equations ( ode ) for the time evolution of the spectral coefficients .",
    "the chief advantage of spectral methods over finite - difference methods is accuracy per degrees of freedom ( e.g. ,  number of spectral modes or number of grid points ) . in one dimension ,",
    "the global error ( e.g. ,  @xmath0 norm ) for a spectral method with @xmath1 spectral modes scales as @xmath2 , whereas for a finite - difference method with @xmath1 grid points , the error scales as @xmath3 , where @xmath4 is the ( fixed ) order of the method .",
    "thus , to get the same level of accuracy , spectral methods generally require far fewer degrees of freedom .",
    "this advantage is even more pronounced in 3d problems requiring high resolution .",
    "because of the linear background shear , the fluid equations are not autonomous in the cross - stream coordinate , making it problematic to apply periodic boundary conditions in this direction .",
    "the equations can be made autonomous in the horizontal directions by transforming to a set of lagrangian shearing coordinates @xcite .",
    "features in the flow that are advected by the shear appear quasi - stationary in the shearing coordinates , allowing for larger time steps to be taken in the numerical integration .",
    "because the background state generally depends on the vertical coordinate , we do not impose periodicity in the vertical direction .",
    "we have implemented the code with two different sets of vertical basis functions : ( 1 ) chebyshev polynomials on a truncated , finite domain , and ( 2 ) rational chebyshev functions on an infinite domain .",
    "use of this latter set is equivalent to transforming the infinite domain to a finite one with a cotangent mapping , and using cosine and sine expansions in the mapped coordinate @xcite .",
    "the code is pseudospectral .",
    "that is , nonlinear terms are not computed via convolution , which is computationally slow ; rather , they are computed on a grid of collocation points , and then transformed to wavenumber space with fast fourier transforms ( ffts ) .",
    "different horizontal fourier modes interact only through these nonlinear terms , and are otherwise independent .",
    "this motivated us to divide the domain into blocks along the two horizontal directions , but not along the vertical direction .",
    "that is , on a parallel machine , each processor works with only a subset of the horizontal fourier wavenumbers , but with all of the vertical data corresponding to those horizontal wavenumbers .",
    "the only time in the simulation that different processors communicate with one another is in the computation of the ffts needed for the nonlinear terms .",
    "we get excellent parallel performance with the message passing interface ( mpi ) on the ibm blue horizon and datastar supercomputers at the san diego supercomputer center .    in  2 , we will review the anelastic equations with shear . in  3 , we will describe the spectral method in detail . in  4 , we will present tests of accuracy and performance , and preview potential applications . finally , in  5 , we will outline future work on these applications , as well as propose further improvements to these simulations .",
    "for clarity , we define up - front the following flow variables ( vectors are represented with bold type ) : velocity @xmath5 , vorticity @xmath6 , pressure @xmath4 , density @xmath7 , temperature @xmath8 , entropy @xmath9 , and potential temperature @xmath10 .",
    "for an ideal gas : @xmath11 and @xmath12 , where @xmath13 is the specific heat at constant volume , @xmath14 is the specific heat at constant pressure , @xmath15 is the gas constant , and @xmath16 is the ratio of specific heats .",
    "we work in a cartesian coordinate system @xmath17 with corresponding unit vectors @xmath18 .",
    "the acceleration of gravity points in the negative @xmath19 direction : @xmath20 .",
    "the rotation axis is aligned with the @xmath19 axis : @xmath21 .",
    "each flow variable is represented as the sum of a time - independent background component , denoted with overbars , and a time - varying component , denoted with tildes ( e.g. ,  @xmath22 ) .",
    "the background velocity field is a unidirectional shear flow that is parallel to the @xmath23-axis and varies only with the @xmath24 coordinate ( see fig . [",
    "f : shearing_vortex ] ) : @xmath25 where @xmath26 is the constant shear rate .",
    "the background vorticity corresponding to this shear flow is @xmath27 .",
    "the shear is cyclonic if @xmath26 and @xmath28 have the same sign , and anticyclonic if they have opposite signs .",
    "the background thermodynamic state , which we assume depends only on the vertical coordinate @xmath19 , is in hydrostatic balance : @xmath29 an important measure of the stratification is the brunt - visl frequency , or the frequency of buoyancy - driven oscillations in a convectively stable atmosphere : @xmath30    there are many different variations of the anelastic approximation @xcite .",
    "the key assumption they all share is that the flow is subsonic and the thermodynamic fluctuations are small relative to their background values : @xmath31 where @xmath32 is the mach number and @xmath33 is the local sound speed . in a typical derivation",
    ", all variables are expressed as asymptotic series expansions in powers of the mach number @xmath32 , the expansions are substituted into the governing fluid equations , and terms are grouped by like powers of @xmath32 . in @xcite , we derived a version of the anelastic approximation for a protoplanetary disk with a constant temperature background .",
    "here , we present a more general version proposed by @xcite , but modified to include a background shear :    [ e : anelastic ] @xmath34    where we have defined a dynamic enthalpy @xmath35 , and a density scale height @xmath36 . the error in the anelastic approximation due to the neglected terms scales as @xmath37 .",
    "the careful reader may note that equation is not the `` correct '' linearization of the potential temperature ; the denominator in the pressure term should be @xmath38 .",
    "@xcite shows that the anelastic equations do not conserve energy unless one makes the replacement @xmath39 .    in the case where the background is constant temperature @xmath40",
    ", we can eliminate the potential temperature in favor of the gas temperature via @xcite :    [ e : constant_temperature ] @xmath41    it is useful for diagnostic purposes to identify energy - like conserved quantities for the anelastic system .",
    "we define kinetic , shear , and thermal energies :    [ e : energy_defs ] @xmath42    where we integrate over the computational volume @xmath43 : @xmath44 , @xmath45 , and @xmath46 . for this exercise ,",
    "we assume that all quantities with a tilde are periodic in @xmath23 and @xmath24 .",
    "we also assume that if @xmath47 is finite , then @xmath48 at @xmath49 , or if @xmath50 , then @xmath51 sufficiently fast . to obtain an equation for the evolution of the kinetic energy ,",
    "take the dot product of the momentum flux @xmath52 with the momentum equation and integrate over the domain @xmath43 .",
    "many of the resulting terms can be written as perfect divergences which will integrate to zero with periodicity in @xmath23 and @xmath24 and the vertical boundary conditions .",
    "the terms that survive the integration are source / sink terms for the kinetic energy . for the evolution of the shear energy , multiply the @xmath23-component of the momentum equation by @xmath53 , and integrate over @xmath43 . here , the integration is not so simple because @xmath24 times a tilde quantity is not necessarily periodic in @xmath24 ; this will lead to surface terms that do not cancel . for the evolution of the thermal energy , multiply the potential temperature equation by @xmath54 and integrate over @xmath43 .",
    "the resulting energy evolution equations are :    [ e : energy_evolution ] @xmath55    where the energy source / sink terms are defined :    [ e : source_sinks ] @xmath56    there are two source / sink terms for the kinetic energy : exchange with the background shear , and exchange with the thermal energy . as expected , these same terms appear , with opposite signs , in the evolution equations for the shear and thermal energies .",
    "we can define a `` total '' energy which is the sum of kinetic , shear , and thermal energies .",
    "the evolution equation for the total energy has only one source / sink term , which is the surface term from the shear energy evolution equation .",
    "this term represents the flow of energy into and out of the edges of the domain in the cross - stream direction .",
    "let @xmath57 represent some arbitrary variable , which may be either a scalar or a component of a vector field .",
    "we write : @xmath58 where @xmath59 are integers , and @xmath60 are the set of spectral coefficients .",
    "the fourier - fourier basis in @xmath23 and @xmath24 has wavenumbers : @xmath61 , @xmath62 } , where @xmath63 , @xmath64 , and where @xmath65 and @xmath66 are the dimensions of the periodic box .",
    "the basis functions for the vertical direction , @xmath67 , will be defined in section 3.2 . if @xmath68 is a real function ( and",
    "if the @xmath67 are real functions of @xmath19 ) then we have the reality condition : @xmath69 , where @xmath70 represents complex conjugation .",
    "we only need to keep track of half the spectral coefficients , say , for @xmath71 .",
    "our approach is a pseudospectral method .",
    "products of two or more variables are _ not _ computed via convolution , which is computationally expensive . instead",
    ", we define a grid of collocation points : @xmath72 , where @xmath73 and @xmath74 .",
    "the collocation points are uniformly spaced in @xmath23 and @xmath24 , but not in @xmath19 ( see section 3.2 ) .",
    "a variable can equally be represented by its set of spectral coefficients @xmath75 ( `` wavenumber space '' or `` fff - space '' ) or by the values of the variable at the set of grid points @xmath76 ( `` physical space '' or `` ppp - space '' ) .",
    "we go between these two representations with the use of fast fourier transforms ( ffts ) : @xmath77 to compute a product of two or more variables , we transform to physical space , multiply the variables at each collocation point , and then transform back to wavenumber space .",
    "the product will be contaminated with aliasing errors , but these will be small if the variables are well - resolved ( that is , the spectral coefficients for high wavenumbers are sufficiently small ) . finally , we mention that at times we will work in `` mixed '' space in which the horizontal directions are in fourier - fourier space , but the vertical direction is untransformed : @xmath78 .",
    "we call this `` ffp - space . ''",
    "the anelastic equations with shear are autonomous in time @xmath79 and the streamwise direction @xmath23 , but are non - autonomous in the cross - stream direction @xmath24 and the vertical direction @xmath19",
    ". it would be ideal if we could make the equations autonomous in @xmath24 before imposing periodicity .",
    "fortunately , this can be done by transforming to a set of quasi - lagrangian coordinates that advect with the background shear @xcite :    [ e : shearing_coords ] @xmath80    the jacobian for this coordinate transformation is unity ; the volume of a computational cell is preserved as it is sheared .",
    "partial derivatives in the two coordinate systems are related via the chain rule :    [ e : shearing_derivs ] @xmath81    the anelastic equations in the the shearing coordinates are :    [ e : anelastic2 ] @xmath82\\cdot \\boldsymbol{\\tilde{v } } , \\label{e : divergence2}\\\\ \\frac{\\partial\\boldsymbol{\\tilde{v}}}{\\partial t ' } & = \\sigma\\tilde{v}_y\\boldsymbol{\\hat{x } } + \\boldsymbol{\\tilde{v}}\\times(\\boldsymbol{\\tilde{\\omega}}+2\\omega\\boldsymbol{\\hat{z}})-\\left(\\boldsymbol{\\nabla'}+\\boldsymbol{\\hat{y}}\\sigma t'\\frac{\\partial}{\\partial x'}\\right)\\tilde{h } + \\frac{\\tilde{\\theta}}{\\bar{\\theta}}g\\boldsymbol{\\hat{z}},\\label{e : momentum2}\\\\ \\frac{\\partial\\tilde{\\theta}}{\\partial t ' }   & = -\\boldsymbol{\\tilde{v}}\\cdot\\left(\\boldsymbol{\\nabla ' } + \\boldsymbol{\\hat{y}}\\sigma t'\\frac{\\partial}{\\partial x'}\\right)\\tilde{\\theta}-\\frac{d\\bar{\\theta}}{dz}\\tilde{v}_z,\\label{e : entropy2}\\end{aligned}\\ ] ]    where the vorticity is now : @xmath83 .",
    "the equations are autonomous in both @xmath84 and @xmath85 , at the expense that the equations explicitly depend on time @xmath86 .",
    "variables are represented by fourier - fourier expansions in the shearing coordinates , not in the original coordinates . from the point of view of the original coordinates ,",
    "the computational grid is sheared with the background flow ( see fig . [ f : shearing_coords ] ) .",
    "if left unchecked , the computational grid will become greatly distorted in time : lines of constant @xmath84 will approach being parallel with lines of constant @xmath85 .",
    "periodically , it will be necessary to re - map the shearing coordinate system back onto a rectangular cartesian grid @xcite .",
    "this should not be done at any arbitrary time . in general",
    ", variables will not be periodic with respect to the original coordinates except at those special times when the periodic images line up again vertically .",
    "we define this to be the re - map time : @xmath87    in physical space , the coordinates of a computational cell after re - mapping @xmath88 can be found by inverting and evaluating at the re - map time :    [ e : remap2 ] @xmath89    where the upper sign corresponds to @xmath90 and the lower sign corresponds to @xmath91 . using the well - known fourier shift theorem ,",
    "the re - map process can also be done in fpp - space ( @xmath23 direction is in fourier space , but the @xmath24 and @xmath19 directions in physical space ) : @xmath92 where the top sign corresponds to @xmath90 , and the bottom sign corresponds to @xmath91 .",
    "we re - map the three components of velocity and the potential temperature , but not the dynamic enthalpy . in an anelastic code ,",
    "the enthalpy is not a dynamic variable ; rather , it adjusts instantaneously to maintain the divergence - free condition on the momentum .",
    "the enthalpy should be recomputed from the poisson - like equation after the momentum and potential temperature have been re - mapped ( see section 3.3 ) .",
    "in general , the background state may depend explicitly on the vertical coordinate @xmath19 . rather than imposing artificial periodicity in the vertical direction ,",
    "we employ two different domain mapping methods @xcite .",
    "the first mapping that we use is a cosine mapping : @xmath93 which truncates the vertical domain to be within @xmath94 .",
    "when we couple this mapping with a cosine series expansion , the resulting basis functions are the chebyshev polynomials : @xmath95 that is , use of a cosine basis in the mapped coordinate @xmath96 is completely equivalent to using a chebyshev basis in the original coordinate @xmath19 .",
    "one disadvantage of this approach is that the collocation points ( which are uniformly spaced in the mapped coordinate @xmath96 ) are clustered near the boundaries @xmath49 ( see fig .",
    "[ f : mapping ] ) .",
    "another disadvantage is the need to impose what may be unphysical boundary conditions at the boundaries @xmath49 .",
    "the second mapping we use is a cotangent mapping @xcite : @xmath97 which allows us to treat the entire infinite domain @xmath98 . with this mapping ,",
    "half of the collocation points are within @xmath94 , and they are more concentrated around @xmath99 ( see fig .",
    "[ f : mapping ] ) . the other half of the collocation points are widely spaced beyond @xmath100 .",
    "we couple this mapping with both cosine and sine series :    [ e : rational_chebyshev ] @xmath101    @xcite calls these functions `` rational chebyshev functions '' ( although only the functions for even @xmath102 are rational , whereas the ones for odd @xmath102 are irrational functions ) .",
    "why do we couple the cotangent mapping with _ both _ cosine and sine expansions , whereas with the cosine mapping , we use only cosine expansions ?",
    "the derivative of the @xmath103 chebyshev polynomial is ( with @xmath104 ) : @xmath105 where @xmath106 and @xmath107 for @xmath108 .",
    "that is , the derivative of a chebyshev polynomial is another chebyshev polynomial of one lower degree . on the other hand ,",
    "the derivatives of the rational chebyshev functions are ( with @xmath104 ) :    [ e : ratcheb_deriv ] @xmath109 + 2\\sin(n\\xi)-\\sin[(n\\!+\\!2)\\xi]\\}\\\\ & = n\\left[-s_{n-2}(z)+2s_n(z)-s_{n+2}(z)\\right ] , \\end{split}\\label{e : ratchebc_deriv}\\\\ \\raisetag{14pt } \\begin{split } \\frac{ds_n(z)}{dz } & = -n\\cos(n\\xi)\\sin^2(\\xi)= -n\\{-\\cos[(n\\!-\\!2)\\xi]+2\\cos(n\\xi)-\\cos[(n\\!+\\!2)\\xi]\\}\\\\ & = -n\\left[-c_{n-2}(z)+2c_n(z)-c_{n+2}(z)\\right ] .",
    "\\end{split}\\label{e : ratchebs_deriv}\\end{aligned}\\ ] ]    the derivative of a rational chebyshev function of the cosine kind is a rational chebyshev function of the sine kind , and vice versa . in principle",
    ", one could represent the derivative of @xmath110 with a convergent infinite series of @xmath110 , obviating the need for @xmath111 .",
    "however , we prefer to work with recursion relations with finite numbers of terms , such as .",
    "other recursion relations for the rational chebyshev functions can be found in appendix c.    @xcite has an extensive discussion on the asymptotic behavior of the rational chebyshev functions .",
    "we want to point out that the choice of cosine or sine kind in representing a given function is _ not _ determined by the parity of the function ( i.e. ,  whether it is an even or odd function ) , but on the asymptotic behavior of the function at infinity .",
    "the rational chebyshev functions of the cosine kind approach their asymptotic values in even powers of @xmath112 , whereas those of the sine kind approach their asymptotic values in odd powers of @xmath112 .",
    "the product of two variables represented by the same kind of rational chebyshev functions results in a series of the cosine kind , whereas the product of two variables represented by different kinds of rational chebyshev functions results in a series of the sine kind . multiplying a variable by a function that is odd with respect to @xmath19 causes its series expansion to switch kinds .",
    "every term in a given equation should be represented by the same kind of expansion .",
    "thus , when we use the rational chebyshev functions for the vertical basis functions , @xmath113 , @xmath114 , @xmath115 , @xmath116 , and @xmath35 are represented with rational chebyshev functions of the cosine kind , whereas @xmath117 , @xmath118 , and @xmath119 are represented with rational chebyshev functions of the sine kind .      in this section ,",
    "we describe algorithms for integrating the anelastic equations forward in time .",
    "let the hat symbol ( e.g. ,  @xmath120 ) denote a variable whose horizontal directions are in fourier space ( for clarity , we drop the subscripts @xmath121 previously introduced ) .",
    "one may think of @xmath120 as a either a column vector of the values of the variable at the different vertical positions ( i.e. ,  ffp - space ) , or a column vector of vertical spectral coefficients ( i.e. ,  fff - space ) ; which of these is intended will be clear from the context .",
    "the equations are integrated in time via the method of `` fractional steps . ''",
    "the velocity is integrated in four steps : an advection step , a hyperviscosity step , an explicit pressure step , and an implicit pressure step .",
    "the potential temperature is integrated in two steps : an advection step and a hyperdiffusion step .",
    "we use a superscript @xmath1 to denote a variable at the @xmath1th timestep ( e.g. ,  @xmath122 , @xmath123 ) . a fraction in the superscript",
    "denotes a variable at an intermediate stage of the integration , not after some fraction of a timestep ( e.g. ,  @xmath124 is the velocity after the first of four intermediate steps ) .",
    "we have implemented two versions of the advection step , both based on an explicit second - order adams - bashforth method . in one method , the nonlinear advection terms are treated explicitly and the linear terms ( coriolis and buoyancy ) are treated semi - implicitly . in the other method , the advection , coriolis , and buoyancy terms are all treated explicitly , but with additional terms that damp internal gravity waves in low - density regions . for the pressure step , we use the semi - implicit second - order crank - nicholson method .",
    "we have confirmed that there are no low order splitting errors , so that the algorithms are globally second - order accurate .",
    "the coriolis force couples the horizontal components of the velocity , resulting in inertial oscillations with the coriolis frequency ( modified by linear shear ) : @xmath125 . similarly , buoyancy and pressure - volume work couple the vertical velocity and the potential temperature , resulting in buoyant oscillations ( e.g. ,  internal gravity waves ) with the brunt - visl frequency @xmath126 @xcite .",
    "both inertial and buoyant oscillations can be described by the simple set of coupled ordinary differential equations :    @xmath127    where a dot denotes time differentiation , @xmath128 , @xmath129 , and @xmath130 , @xmath131 are forcing constants .",
    "the exact solution for arbitrary time @xmath79 is :    @xmath132   + f_2\\left(\\frac{\\alpha_1 t^2}{2}\\right)\\left[\\frac{2(1-\\cos(\\omega t))}{(\\omega t)^2}\\right ] , \\end{split}\\\\ \\begin{split } u_2(t ) = & u_2(0)\\cos(\\omega t ) - u_1(0)\\left(\\frac{\\alpha_2}{\\omega}\\right)\\sin(\\omega t)\\\\ & + f_2t\\left[\\frac{\\sin(\\omega t)}{\\omega t}\\right ]   - f_1\\left(\\frac{\\alpha_2 t^2}{2}\\right)\\left[\\frac{2(1-\\cos(\\omega t))}{(\\omega t)^2}\\right ] , \\end{split}\\end{aligned}\\ ] ]    where we have defined @xmath133 .",
    "we use the above solution as a template for a new integration scheme in which the forcing terms ( e.g. ,  @xmath130 , @xmath131 ) are not constants in time , but correspond to nonlinear advection terms , which we treat with an adams - bashforth scheme :    @xmath134 -\\frac{1}{2}\\left[\\widehat{\\left(\\boldsymbol{\\tilde{v}\\times\\tilde{\\omega}}\\right)}^{n-1}\\right],\\\\ \\hat{\\mathfrak{m } } \\equiv & \\frac{3}{2}\\left[-\\widehat{\\left(\\boldsymbol{\\tilde{v}\\cdot\\nabla}\\tilde{\\theta}\\right)}^{n}\\right ] -\\frac{1}{2}\\left[-\\widehat{\\left(\\boldsymbol{\\tilde{v}\\cdot\\nabla}\\tilde{\\theta}\\right)}^{n-1}\\right].\\end{aligned}\\ ] ]    the velocity and potential temperature are updated via :    @xmath135 \\\\ & + \\tfrac{1}{2}\\delta t^2q_2(\\omega_c\\delta t)(2\\omega+\\sigma)\\left [ \\hat{\\mathfrak{n}}_{y } - i(k'_y+\\sigma tk'_x)\\hat{h}^{n}\\right ] , \\end{split}\\\\ \\begin{split } \\hat{v}_{y}^{n+\\frac{1}{4 } } = & \\cos(\\omega_c\\delta t)\\hat{v}_{y}^{n } + \\delta t\\,q_1(\\omega_c\\delta t ) \\left[(-2\\omega)\\hat{v}_x^n+\\hat{\\mathfrak{n}}_{y}\\right ] \\\\ & + \\tfrac{1}{2}\\delta t^2q_2(\\omega_c\\delta t)(-2\\omega)\\left [ \\hat{\\mathfrak{n}}_{x } - ik'_x\\hat{h}^{n}\\right ] , \\end{split}\\\\ \\begin{split } \\hat{v}_{z}^{n+\\frac{1}{4 } } = & \\cos(\\omega_b\\delta t)\\hat{v}_{z}^{n } + \\delta t\\,q_1(\\omega_b\\delta t)\\left[(g/\\bar{\\theta})\\hat{\\theta}^n+\\hat{\\mathfrak{n}}_{z}\\right ] \\\\ & + \\tfrac{1}{2}\\delta t^2\\,q_2(\\omega_b\\delta t)(g/\\bar{\\theta } ) \\left[\\hat{\\mathfrak{m}}\\right ] , \\end{split}\\\\ \\begin{split } \\hat{\\theta}^{n+\\frac{1}{2 } } = & \\cos(\\omega_b\\delta t)\\hat{\\theta}^{n } + \\delta t\\,q_1(\\omega_b\\delta t)\\left[(-d\\bar{\\theta}/dz)\\hat{v}_z^n+\\hat{\\mathfrak{m}}\\right ] \\\\ & + \\tfrac{1}{2}\\delta t^2\\,q_2(\\omega_b\\delta t)(-d\\bar{\\theta}/dz ) \\left[\\hat{\\mathfrak{n}}_z-\\partial\\hat{h}^n/\\partial z\\right ] , \\end{split}\\end{aligned}\\ ] ]    where the functions @xmath136 and @xmath137 are defined :    @xmath138/\\tau^2.\\end{aligned}\\ ] ]    the time differencing error for one step scales as @xmath139 . for @xmath140 , @xmath136 and @xmath137 can be replaced with unity without changing how the error scales with the size of the step .      as an internal gravity wave propagates from a high density region into a low density region ,",
    "its amplitude increases so as to conserve energy flux .",
    "if the density contrast is large , velocity and thermodynamic fluctuations can become sufficiently large so as to invalidate the anelastic approximation and/or violate the cfl condition .",
    "we have developed a strategy to control gravity waves that is akin to `` negative feedback '' in circuit theory .",
    "mathematically , the origin of the buoyant oscillations is the fact that the time derivative of the vertical velocity depends linearly on the potential temperature , and vice versa .",
    "physically , a hot parcel of fluid rises into less dense material , expands and cools ; it then sinks , compresses , and heats - up , and the cycle continues . to damp these oscillations , we add a term proportional to the _ time derivative _ of the potential temperature to the vertical velocity equation , and vice versa .",
    "this introduces a term that is proportional to @xmath141 into the equation for the vertical velocity , and a term that is proportional to @xmath142 into the equation for the potential temperature . in the following integration scheme ,",
    "we add the coriolis and buoyancy terms to the nonlinear advection terms and treat them all with an adams - bashforth scheme :    @xmath143\\\\ -&\\frac{1}{2}\\left[\\widehat{\\left(\\boldsymbol{\\tilde{v}\\times\\tilde{\\omega}}\\right)}^{n-1}-2\\omega\\boldsymbol{\\hat{z}\\times\\hat{v}}^{n-1}+\\sigma\\hat{v}_y^{n-1}\\boldsymbol{\\hat{x}}+\\frac{\\hat{\\theta}^{n-1}}{\\bar{\\theta}}g\\boldsymbol{\\hat{z}}\\right ] , \\end{split}\\\\ \\begin{split } \\hat{\\mathfrak{m } } \\equiv & \\frac{3}{2}\\left[-\\widehat{\\left(\\boldsymbol{\\tilde{v}\\cdot\\nabla}\\tilde{\\theta}\\right)}^{n}-\\left(\\frac{d\\bar{\\theta}}{dz}\\right)\\hat{v}_z^{n}\\right]\\\\ -&\\frac{1}{2}\\left[-\\widehat{\\left(\\boldsymbol{\\tilde{v}\\cdot\\nabla}\\tilde{\\theta}\\right)}^{n-1}-\\left(\\frac{d\\bar{\\theta}}{dz}\\right)\\hat{v}_z^{n-1}\\right ] .",
    "\\end{split}\\end{aligned}\\ ] ]    the velocity and potential temperature are updated via :    @xmath144,\\\\ \\hat{\\theta}^{n+\\frac{1}{2 } } & = \\hat{\\theta}^{n } + \\delta t\\left[\\mathfrak{m}-\\beta(z)\\left(\\frac{\\bar{\\theta}\\omega_b}{g}\\right)\\left(\\mathfrak{n}_z- \\frac{\\partial\\hat{h}^{n}}{\\partial z}\\right ) \\right].\\end{aligned}\\ ] ]    the function @xmath145 determines the range of @xmath19 at which the damping operates ; @xmath146 for most of the domain , but will be nonzero and small in the low density regions .",
    "we note that one could damp buoyant oscillations just by adding a term proportional to @xmath141 ( instead of @xmath147 ) to the vertical velocity equation , and/or a term proportional to @xmath142 ( instead of @xmath148 ) to the potential temperature equation . however , the advantage of adding time derivatives is that as the flow approaches a steady - state , the damping naturally turns off .",
    "we will explore the effects of this gravity - wave damping mechanism in section  4.3 .",
    "unlike finite - difference codes which have a `` grid viscosity '' associated with the spatial differencing , spectral codes have no inherent grid dissipation .",
    "energy will cascade down ( via nonlinear interactions ) to the smallest resolved scales ( highest wavenumbers ) where it will accumulate and eventually cause large truncation and aliasing errors . to control this , artificial viscosity or some other kind of low - pass filtering",
    "is applied to dissipate the energy at the smallest scales @xcite .",
    "this method is related to `` large - eddy '' simulations in which the large scale motions are fully resolved , whereas the small scale flow is treated with a sub - grid scale turbulence model .",
    "for the two horizontal fourier directions , we apply a hyperviscosity of the form : @xmath149 , where @xmath150 is a hyperviscosity coefficient , and @xmath4 is an integer between 1 and 6 .",
    "this is simple to implement because the hyperviscosity operator is an exact eigenoperator of the fourier basis functions : @xmath151 the vertical direction is not resolved with a fourier basis and is not periodic . applying a real diffusion operator to the vertical direction is problematic because the second derivative operator ( or its powers ) is not an eigenoperator of the chebyshev polynomial or rational chebyshev function bases .",
    "furthermore , a real diffusion operator would raise the order of the differential equations and require additional unphysical vertical boundary conditions and/or create spurious boundary layers .",
    "@xcite advocates replacing the second derivative operator with an eigenoperator of the basis functions . for example , for the chebyshev polynomial basis ( where we assume @xmath104 ) :    @xmath152,\\\\ \\sqrt{1-z^2}\\frac{d}{dz}\\left[\\sqrt{1-z^2}\\frac{d}{dz}\\right]t_n(z ) = -n^2t_n(z).\\end{aligned}\\ ] ]    likewise , there is a similar replacement for the eigenoperator of the rational chebyshev function basis .",
    "the chief advantage is that because the eigenoperators are singular at the boundaries , no additional unphysical boundary conditions are needed and no spurious boundary layers are created .    in practice",
    ", we apply hyperviscosity every time step :    @xmath153,\\\\ \\boldsymbol{\\hat{v}}^{n+\\frac{2}{4 } } & = \\boldsymbol{\\hat{v}}^{n+\\frac{1}{4}}\\cdot f_{hyp},\\\\ \\hat{\\theta}^{n+1 } & = \\hat{\\theta}^{n+\\frac{1}{2}}\\cdot f_{hyp},\\end{aligned}\\ ] ]    where @xmath154 and @xmath102 is the order of the chebyshev polynomial or rational chebyshev function .",
    "the hyperviscosity coefficients are initially set to values such that the highest resolved fourier or chebyshev number has an @xmath155-folding time equal to one timestep .",
    "they can be dynamically adjusted every few hundred timesteps so that the energy spectrum does not curl - up at the highest wavenumbers .",
    "subtraction of the enthalpy gradient is done with a semi - implicit crank - nicholson ( globally second - order in time ) algorithm :    [ e : crank_nicholson ] @xmath156    where @xmath157 $ ] .",
    "step , the explicit step , uses the current enthalpy , whereas step , the implicit step , uses the future enthalpy .",
    "we require that the final velocity satisfy the anelastic constraint , which yields a poisson - like equation for the final enthalpy :    [ e : poisson ] @xmath158\\cdot\\boldsymbol{\\hat{v}}^{n+1}&=0,\\label{e : poisson1}\\\\ \\left[\\frac{\\partial^2}{\\partial z^2 } + \\left(\\frac{d\\ln\\bar{\\rho}}{dz}\\right)\\frac{\\partial}{\\partial z } - ( k_{\\bot}^{n+1})^2\\right]\\hat{h}^{n+1 } & = \\frac{2}{\\delta t}\\left[\\boldsymbol{\\hat{\\nabla}}^{n+1}+\\left(\\frac{d\\ln\\bar{\\rho}}{dz}\\right)\\boldsymbol{\\hat{z}}\\right]\\cdot\\boldsymbol{\\hat{v}}^{n+\\frac{3}{4 } } , \\label{e : poisson2}\\end{aligned}\\ ] ]    where @xmath159 .",
    "if the vertical domain is finite ( i.e. ,  chebyshev polynomial basis ) , then explicit boundary conditions will be needed to solve this poisson - like equation .",
    "we require that the vertical velocity vanish at the walls . imposing this on the @xmath19-component of yields :    [ e : boundary_conditions ] @xmath160",
    "if the vertical domain is infinite ( i.e. ,  rational chebyshev function basis ) , then no explicit boundary conditions are needed to invert the poisson - like equation because the vertical basis functions individually satisfy the boundary conditions ( i.e. ,  galerkin method with natural boundary conditions ) : @xmath161 and @xmath162 as @xmath163    the poisson - like equation is singular for the case of @xmath164 .",
    "the anelastic condition for this mode implies that there can be no net vertical momentum across any horizontal plane :    @xmath165    the integration constant for @xmath166 is determined by the condition that the total mass in the domain is conserved .",
    "one can write the poisson - like equation in matrix form : @xmath167 , where @xmath168 is a matrix containing the laplacian - like differential operator , @xmath169 is a column vector of vertical spectral coefficients for the enthalpy , and @xmath170 is a column vector of vertical spectral coefficients for the right - hand side of .",
    "when needed , the last two rows of the matrix @xmath168 are overwritten with the boundary condition data , at the expense that the divergence condition will not be satisfied for the two highest vertical spectral modes .",
    "this is usually an exponentially small error , but if it is undesirable , one can use the tau - method with greens functions to correct the divergence at the two highest spectral modes ( see appendix b ; @xcite ) .",
    "the speed and efficiency in inverting the poisson - like equation depends on the functional form of the stratification term @xmath171 .",
    "if the stratification term is particularly simple ( e.g. ,  zero for no stratification , a constant for constant stratification , or proportional to height @xmath19 as in a protoplanetary disk ) , then one can use chebyshev or rational chebyshev recursion relations ; the matrices will be banded and consequently quick to invert . in particular , for the finite domain with the chebyshev polynomial basis , the matrix equation can be rewritten as : @xmath172 , where @xmath173 and @xmath174 are pentadiagonal matrices ( see appendix a , @xcite ) . if the stratification term is an odd function of @xmath19 , then the even and odd chebyshev modes decouple , reducing the pentadiagonal matrix equation to two tridiagonal matrix equations for the even and odd chebyshev modes .",
    "for the infinite domain with rational chebyshev function basis , the matrix @xmath168 is nonadiagonal ( see appendix c ) .",
    "if the stratification term is an odd function of @xmath19 , then the even and odd rational chebyshev modes decouple , reducing the nonadiagonal matrix equation to two pentadiagonal matrix equations for the even and odd rational chebyshev modes . on the other hand ,",
    "if the stratification term is a more complicated function of height , then the terms multiplied by the stratification term will have to be computed in physical space on a grid of collocation points , and then transformed back to function space .",
    "the matrices in the poisson - like equation will consequently be full and slower to invert .",
    "we have developed our simulation for use on parallel supercomputers such as the blue horizon ( decommissioned in april 2004 ) and datastar supercomputers at the san diego supercomputer center .",
    "the datastar has 176 nodes of 8 processors ( cpu speed of 1.5 ghz and peak performance of 6.0 gflops ) .",
    "each node shares 16 gb of memory .",
    "different horizontal fourier modes interact only through the nonlinear advection terms , whereas the vertical spectral modes ( chebyshev polynomials or rational chebyshev functions ) are fully coupled at every stage of the computation .",
    "this motivated us to divide the computational domain only along the horizontal directions .",
    "each processor works with a small subset of horizontal data , but all of the corresponding vertical data : in physical space , the @xmath175th processor would contain data for : @xmath176 , @xmath177 , @xmath178 ; in wavenumber space , a given processor would contain data for : @xmath179 , @xmath180 , @xmath181 .",
    "the only time different processors communicate with each other is when a horizontal fft needs to be computed .",
    "there are generally two common strategies for this : one could use a fft that works across processors , or one could transpose the data so that a given direction is not split across processors .",
    "for example , if one wanted to compute a fft along the @xmath23 direction , one would swap the data so that each processor had a subset of the @xmath24 and @xmath19 data , but all of the corresponding @xmath23 data .",
    "we have implemented this second strategy with an efficient transpose algorithm developed by alan wray at nasa - ames / stanford center for turbulence research ( wray , personal communication ) .",
    "figure [ f : code_timing ] shows the results of timing tests for a version of the code that used the chebyshev polynomial basis .",
    "the tests were done on the blue horizon and analyzed with the vampir parallel trace tool . for reference",
    ", we note that the datastar runs approximately two times faster than the blue horizon .",
    "we present the average wall - clock or real time to compute one timestep for @xmath182 , @xmath183 , and @xmath184 domains on 16 , 32 , 64 , and 128 processors .",
    "we fit power laws ( @xmath185 ) to the timing data and determined how the times for different steps in the algorithm scale with number of processors ( ideal performance is @xmath186 ) .",
    "as expected , the advection step is the most time - intensive step in the algorithm 80 - 90% of the time is spent in this stage alone due to the large number of ffts required to compute the nonlinear terms . the computation time ( ` adv comp ' ) scales well with the number of processors , whereas the communication time ( ` adv mpi ' ) has a much flatter scaling .      the simplest way to validate the shearing box algorithm is to confirm that the code correctly simulates 2d vortex dynamics .",
    "@xcite analytically determined the steady state solutions for 2d elliptical vortices of uniform vorticity @xmath115 embedded in a uniform shear of strength @xmath26 , and showed that the aspect ratio of a vortex , @xmath187 , where @xmath188 and @xmath189 are the major and minor axes of the ellipse , was determined by the ratio of the vorticity to the shear : @xmath190 which is valid for vortices that rotate in the same sense as the shear . as one would expect , stronger vortices are more round and compact , whereas weaker vortices are more elongated .",
    "@xcite showed that if such a vortex was perturbed , its major axis would oscillate about the @xmath23-axis , and its aspect ratio would oscillate about its mean value ( area remaining constant ) .",
    "these motions would be damped via the occasional shedding of thin filaments of vorticity which would eventually be dissipated by viscosity .    figure [ f:2d_vortex ] shows the kinetic , shear , and total energies as a function of time for the evolution of a 2d elliptical vortex .",
    "the parameters for these runs were : @xmath191 , @xmath192 , @xmath193 , @xmath194 , @xmath195 , @xmath196 , @xmath197 , @xmath198 .",
    "the initial vortex was surrounded with a weak halo of oppositely - oriented vorticity so that there was no net circulation around the vortex ( @xmath199 ) .",
    "the kida oscillations are readily apparent in the energy plots as the larger amplitude , longer period oscillations ( @xmath200 re - map periods ) .",
    "as expected , increasing the hyperviscosity resulted in the damping of these oscillations ; the final state is a steady - state vortex whose major axis is aligned with the @xmath23-axis and whose aspect ratio and area are constant .",
    "superposed on the kida oscillations is another low amplitude , short period oscillation , which is most clearly seen in the plots of total energy .",
    "this period is exactly the re - map period and is due to interactions of the vortex with its periodic images , which are realigned with the primary vortex every re - map period ( see fig .",
    "[ f : shearing_coords ] ) .",
    "the amplitude of these oscillations decreases with domain size .    in figure [",
    "f : time_int_error_2d ] , we plot the percent error in kinetic energy after one re - map period as a function of timestep size for the explicit and semi - implicit treatments of the coriolis ( modified by shear ) terms .",
    "we fit power - laws and confirmed that both schemes are second - order accurate in time . the semi - implicit treatment , however , has an error that is a order of magnitude smaller than the explicit scheme .",
    "( 6,3 ) ( 0,0 ) ( 3,0 )      to test the vertical dimension of the code , we investigate the behavior of linear eigenmodes ( i.e. ,  internal gravity waves ) in a stratified background .",
    "the background shear makes it difficult to compute eigenmodes because the linearized equations depend explicitly on @xmath201 in the original coordinates , or explicitly on @xmath202 in the shearing coordinates .",
    "if we restrict the following analysis to the case of @xmath203 , then the process of finding eigenmodes is straight - forward .",
    "we look for eigenmodes of the form @xmath204 , where @xmath68 represents any variable .",
    "the real part of the eigenvalue is related to the phase speed of the wave , @xmath205 , whereas the imaginary part @xmath206 corresponds to wave growth ( if positive ) or damping ( if negative ) .",
    "the linearized equations are :    @xmath207,\\\\ 0 & = ik_y\\hat{v}_y + d\\hat{v}_z / dz + ( d\\ln\\bar{\\rho}/dz)\\hat{v}_z,\\end{aligned}\\ ] ]    where we have included the damping terms described in section 3.3.2 .",
    "if the damping terms are neglected , then this system of equations can be simplified to the second - order eigenvalue problem for the vertical velocity fluctuation : @xmath208\\hat{v}_z = \\left[\\mathcal{l}-k_y^2\\left(\\frac{\\omega_b}{\\omega_c}\\right)^2\\right]\\hat{v}_z,\\ ] ] where we have defined the second - order linear differential operator : @xmath209.\\ ] ] if the eigenvalue problem is solved on the finite domain with the chebyshev polynomial basis , then boundary conditions must be imposed : @xmath210 . on the infinite domain with the rational chebyshev function basis ,",
    "boundary conditions are naturally satisfied by the basis functions ( i.e. ,  galerkin method ) .    in order to proceed ,",
    "we need to specify the background state . here",
    ", we choose conditions relevant to a protoplanetary disk of gas and dust in orbit around a newly - formed protostar @xcite .",
    "the velocity profile of the gas is very nearly keplerian : @xmath211 , where @xmath212 is the gravitational constant , @xmath213 is the mass of the protostar , and @xmath214 is the cylindrical radius to the protostar .",
    "the horizontal shear rate of this base flow is : @xmath215 keplerian shear is anticyclonic ( as indicated by the negative sign ) , and is comparable in magnitude to the rotation rate itself .",
    "we do not simulate the entire disk ; rather , we we simulate the hydrodynamics only within a small patch @xmath216 that co - rotates with the gas at some fiducial radius @xmath217 with angular velocity @xmath218 .",
    "we map this patch of the disk onto a cartesian grid : @xmath219 , @xmath220 , @xmath221 , @xmath222 , @xmath223 , and @xmath224 . in this rotating patch ,",
    "the velocity profile of the gas is very nearly a linear shear flow with @xmath225 .",
    "the coriolis frequency ( modified by the shear ) is @xmath226 .",
    "the vertical component of the protostellar gravity in this patch of the disk is very nearly @xmath227 .",
    "we assume that the background is constant temperature @xmath40 , which yields a hydrostatic density profile that is gaussian :    @xmath228    the brunt - visl frequency is : @xmath229 the disk can be divided into two regimes : a nearly unstratified midplane ( @xmath230 , @xmath231 ) and a strongly stratified atmosphere above and below the midplane ( @xmath232 , @xmath233 ) .",
    "figure [ f : gravity_wave_plots ] shows the vertical velocity component of the undamped ( @xmath234 ) eigenmodes for @xmath235 .",
    "the eigenvalues are purely real .",
    "there are two kinds of eigenmodes : those confined to the weakly stratified midplane of the disk with frequencies @xmath236 , and those confined to the strongly stratified regions near the boundaries with frequencies @xmath237 .",
    "the latter class of eigenmodes do not exist when the domain is infinite ( rather , there is a continuous spectrum of waves whose velocity amplitudes are formally unbounded as @xmath238 ) .    to investigate the effect of damping on these eigenmodes , we need to specify a profile for @xmath145 , for example : @xmath239 + \\tanh[a(z_c - z)/h_0]\\},\\ ] ] which is nearly zero for most of the domain , but rises sharply at @xmath240 to its maximum value @xmath241 ; the parameter @xmath242 sets how steep the rise is . in the calculations presented here",
    ", we take @xmath243 and @xmath244 .",
    "table [ t : eigenvalues ] and fig.[f : gravity_wave_damping ] show the effect of varying @xmath241 on the two kinds of eigenmodes .",
    "those eigenmodes that are localized around the midplane are only weakly damped , whereas the eigenmodes that are localized in the strongly stratified regions near the boundary are strongly damped .",
    "in fully nonlinear 3d calculations , this damping is necessary for numerical stability .",
    "as internal gravity waves propagate from a high density regions into low density regions , their amplitudes increase so as to conserve energy flux , causing velocity and thermodynamic fluctuations that can become sufficiently large so as to invalidate the anelastic approximation and/or violate the cfl condition .",
    ".effect of damping on linear eigenmodes .",
    "an eigenmode that is localized near the midplane ( e.g. ,  @xmath245 ) is weakly damped , whereas an eigenmode that is localized far from the midplane ( e.g. ,  @xmath246 ) is strongly damped .",
    "damping rate is linearly proportional to @xmath241 . [",
    "cols=\"<,<,<\",options=\"header \" , ]      as a preview of potential applications , we present the simulation of a merger of two 3d vortices in the midplane of a stratified protoplanetary disk . a more complete discussion of simulations of vortices in protoplanetary disks can be found in @xcite .",
    "we use the 2d vortex solution of @xcite and @xcite to initialize an elliptical vortex in the midplane at @xmath99 .",
    "the vorticity is extended off the midplane according to a gaussian profile : @xmath247 we initialize the temperature so that the buoyancy force exactly balances the vertical pressure force : @xmath248 of course , only under very special circumstances would this procedure just so happen to also exactly balance the temperature equation .",
    "in general , @xmath249 initially , leading to an immediate evolution of the temperature .",
    "vertical motions will then be generated by the temperature changes through the buoyancy force , and these vertical velocities will then couple the horizontal motions at different heights .",
    "we allow such a 3d vortex to evolve and relax to a quasi - equilibrium .",
    "we then use that vortex as a template to construct an initial condition with two vortices destined to merge .",
    "[ f : merger ] shows an example of a merger .",
    "the first column shows @xmath250 slices in the midplane @xmath251 of the @xmath19-component of vorticity .",
    "blue corresponds to anticyclonic vorticity , red corresponds to cyclonic vorticity .",
    "the second column shows isovorticity surfaces for the @xmath19 component of vorticity , in blue , and vortex lines ( lines that are everywhere tangent to the vorticity vector ) in red .",
    "the vorticity field is divergence - free ( since it is the curl of another vector field ) .",
    "thus , like magnetic field lines , vortex lines can not begin or end in free space , they must either end on a boundary , extend to infinity , form closed loops , or form unending open curves .",
    "we have developed a three - dimensional , spectral , hydrodynamic code to study vortex dynamics in rapidly rotating , intensely sheared , and strongly stratified systems such as giant planet atmospheres and protoplanetary disks .",
    "the code integrates a number of specially tailored algorithms to handle the numerical challenges associated with shear and stratification .",
    "we used the anelastic approximation to filter sound waves and shocks .",
    "the horizontal coordinates are transformed to a set of shearing coordinates that advect with the background shear flow , and a fourier - fourier basis in these shearing coordinates is used for spectral expansions in the two horizontal directions . for the vertical direction ,",
    "two different sets of basis functions have been implemented : ( 1 ) chebyshev polynomials on a truncated , finite domain , and ( 2 ) rational chebyshev functions on an infinite domain .",
    "use of this latter set is equivalent to transforming the infinite domain to a finite one with a cotangent mapping , and using cosine and sine expansions on the mapped coordinate .",
    "the nonlinear advection terms are time integrated explicitly , whereas the enthalpy gradient and the terms responsible for internal gravity waves are integrated semi - implicitly .",
    "we show that gravity waves can also be damped by adding new terms to the euler equations .",
    "the code is parallelized with the message passing interface ( mpi ) , and we get excellent parallel performance on the ibm blue horizon and datastar supercomputers at the san diego supercomputer center .",
    "the chebyshev polynomial code has the disadvantage that it clustered the collocation points near unphysical walls .",
    "this motivated us to implement the the rational chebyshev functions for the infinite domain .",
    "this removed the walls from the problem , but it did not significantly improve the spacing of the collocation points .",
    "although the collocation points were clustered more towards the center , only half of all the collocation points were in the `` active region ''",
    "@xmath252 , whereas the other half were wasted on resolving the regions toward infinity @xmath100 , where our equations are no longer valid .",
    "also , the rational chebyshev function expansions converged poorly if any fluid dynamics occurred near the mapping parameter @xmath47 , forcing us to choose a larger value of @xmath47 .",
    "we could improve the performance of the rational chebyshev code if we used momentum ariables instead of velocity variables , since the multiplication by the mean density made the momentum decay faster with height .",
    "thanks the national science foundation for support via a graduate student fellowship while at berkeley , and now with an astronomy & astrophysics postdoctoral fellowship ( nsf grant ast0302146 ) .",
    "he also thanks the support of the kavli institute for theoretical physics through nsf grant phy9907949 .",
    "thanks the support of nasa grant nag510664 and nsf grant ast0098465 .",
    "computations were carried out at the san diego supercomputer center using an npaci award .",
    "the authors would also like to thank andrew szeri , xylar asay - davis , and sushil shetty useful comments on the early manuscript .",
    "for the case where the stratification is a linear function of height @xmath19 , the poisson - like equation for the enthalpy can be written in the form :    @xmath253f(z)&=g(z),\\\\ \\frac{df}{dz}\\big|_{z=\\pm 1}&=\\chi_{\\pm},\\end{aligned}\\ ] ]    where we have chosen dimensions so that the boundaries are located at @xmath254 .",
    "there will be one such equation for each pair of horizontal wavenumbers @xmath255 .",
    "we expand @xmath256 and @xmath257 in chebyshev polynomial series : @xmath258 one can then use chebyshev recursion relations to write the above poisson - like equation in matrix form :    @xmath259    where @xmath168 is a @xmath260 matrix for the second - order linear differential operator @xmath261 , and @xmath262 and @xmath170 are column vectors of @xmath263 chebyshev spectral coefficients .",
    "there are two problems with this formulation : the matrix @xmath168 is singular and the system is overspecified : we have @xmath263 undetermined spectral coefficients , but @xmath264 constraints ( @xmath263 equations + 2 boundary conditions ) .",
    "the tau method fixes both problems simultaneously by discarding the equations for the two highest chebyshev modes and replacing them with the boundary conditions , resulting in the differential equation not being satisfied for those same two highest modes .",
    "the matrix @xmath168 is upper triangular ( except for the last two rows which now contain boundary conditions ) and fast to invert , but unfortunately is not diagonally dominant .",
    "the largest elements occur down the last column , and inverting it in its current form will have large round - off errors . @xcite and @xcite",
    "show how to rewrite the poisson - like matrix equation in the form : @xmath265 where @xmath173 and @xmath174 are diagonally dominant , pentadiagonal matrices . @xcite and",
    "@xcite give the recursion relations for the case @xmath266 .",
    "here , we present the recursion relation for the more general case : @xmath267 where we have defined : @xmath268 and @xmath269 the boundary conditions can be rewritten : @xmath270 note that the even and odd chebyshev polynomials are decoupled in the matrix equation and in the boundary conditions , so one could in fact write the pentadiagonal system as two sets of tridiagonal systems for the even and odd modes .",
    "in appendix a , we presented a method to solve the poisson - like equation for the enthalpy in a chebyshev polynomial basis , subject to the constraint that the vertical velocity vanish at the two boundaries at @xmath254 .",
    "the last two rows of the poisson - like matrix equation were overwritten with boundary condition data , resulting in the anelastic divergence condition not being satisfied for the two highest chebyshev modes . here",
    ", we present a method to correct the divergence condition at the two highest modes using greens functions @xcite , at the expense that equation for the evolution of the vertical momentum will not be satisfied at those same two highest modes .    to make the presentation more clear , we will first define a number of operators :    @xmath271    in the fourth fractional step , we subtract the implicit half of the enthalpy gradient as before , but we also add two additional functions , each consisting of exactly one chebyshev mode : @xmath272 where we have defined @xmath273 , and where @xmath274 and @xmath275 are scalars ( as usual , we suppress the subscripts for wavenumber dependence ) . to find the enthalpy at the @xmath263 step , we impose the anelastic constraint @xmath276 , which yields :    @xmath277",
    "we can break this up into three separate poisson - like equations : @xmath278 where @xmath279 and @xmath280 are greens functions , and where :    @xmath281    each of these 3 poisson - like equations can be solved via the tau method as in appendix a. by construction , @xmath282 equals zero for all chebyshev modes except the two highest ; for those modes , the values of the anelastic divergence are functions of @xmath283 and @xmath284 .",
    "we use these two degrees of freedom to impose that the anelastic divergence equal zero at the two highest modes as well , which yields the @xmath285 matrix equation : @xmath286 where we have defined :    @xmath287\\big|_{n = m-1},\\\\ \\alpha_{12 } & \\equiv\\left[\\triangle_a^{n+1}\\gamma_2^{n+1}-d_at_{m}\\right]\\big|_{n = m-1},\\\\ \\alpha_{21 } & \\equiv\\left[\\triangle_a^{n+1}\\gamma_1^{n+1}-d_at_{m-1}\\right]\\big|_{n = m},\\\\ \\alpha_{22 } & \\equiv\\left[\\triangle_a^{n+1}\\gamma_2^{n+1}-d_at_{m}\\right]\\big|_{n = m},\\\\ \\beta_{1 } & \\equiv\\left[\\boldsymbol{\\hat{\\nabla}_a}^{n+1}\\cdot\\boldsymbol{\\hat{v}}^{n+\\frac{3}{4}}-\\triangle_a^{n+1}\\hat{\\pi}_0^{n+1}\\right]\\big|_{n = m-1},\\\\ \\beta_{2 } & \\equiv\\left[\\boldsymbol{\\hat{\\nabla}_a}^{n+1}\\cdot\\boldsymbol{\\hat{v}}^{n+\\frac{3}{4}}-\\triangle_a^{n+1}\\hat{\\pi}_0^{n+1}\\right]\\big|_{n = m},\\end{aligned}\\ ] ]    where the notation @xmath288 represents the @xmath289th chebyshev mode of function @xmath120 . note that if @xmath289 is even , then @xmath290 is an even polynomial",
    ", @xmath291 is an odd polynomial ; if @xmath289 is odd , then @xmath290 is odd and @xmath291 is even . using these symmetries",
    ", one can show that @xmath292 , and @xmath293 , @xmath294 .",
    "this method effectively triples the computational time for the enthalpy step ( three poisson - like solves instead of one per timestep ) .",
    "however , the enthalpy step is still only of order 10% of the total computational time , as the ffts in the nonlinear advection dominate the computation .",
    "we also note that if we were not working in lagrangian coordinates ( which introduced explicit time dependence into the gradient operators ) , then the greens functions @xmath279 and @xmath280 ( two for each set of fourier wavenumbers ) would be independent of time , and would only have to be computed once in a pre - processing step , and stored .",
    "here we present some useful recursion relations for the rational chebyshev functions .",
    "we define : @xmath295    the first derivative operator converts a @xmath110 series into a @xmath111 series , and vice versa .",
    "the recursion relations have the same form for either case , except for the lowest two modes .",
    "let @xmath296 , then : @xmath297/(4l_z),\\quad\\text{for}\\quad n\\ge 2,\\nonumber\\\\ \\hat{g}_0^s & = 0 , \\quad \\hat{g}_1^s = \\left(3\\hat{f}_1^c-3\\hat{f}_3^c\\right)/(4l_z),\\quad \\text{or}\\nonumber\\\\ \\hat{g}_0^c & = \\hat{f}_2^s/(2l_z),\\quad \\hat{g}_1^c = \\left(-\\hat{f}_1^s+3\\hat{f}_3^s\\right)/(4l_z).\\end{aligned}\\ ] ]    the second derivative operator preserves the kind of expansion ; that is , the second derivative of a @xmath110 series is another @xmath110 series , and the second derivative of a @xmath111 series is another @xmath111 series .",
    "the recursion relations for the second derivative operator have the same form for either case , except for the lowest four modes .",
    "let @xmath298 , then : @xmath299/(16l_z^2),\\nonumber\\\\ \\hat{g}_1^c & = \\left[-6\\hat{f}_1^c+21\\hat{f}_3^c-15\\hat{f}_5^c\\right]/(16l_z^2),\\nonumber\\\\ \\hat{g}_2^c & = \\left[-24\\hat{f}_2^c+48\\hat{f}_4^c-24\\hat{f}_6^c\\right]/(16l_z^2),\\nonumber\\\\ \\hat{g}_3^c & = \\left[9\\hat{f}_1^c-54\\hat{f}_3^c+80\\hat{f}_5^c-35\\hat{f}_7^c\\right]/(16l_z^2),\\quad\\text{or}\\nonumber\\\\ \\hat{g}_0^s & = 0,\\nonumber\\\\ \\hat{g}_1^s & = \\left[-6\\hat{f}_1^s+27\\hat{f}_3^s-15\\hat{f}_5^s\\right]/(16l_z^2),\\nonumber\\\\ \\hat{g}_2^s & = \\left[-24\\hat{f}_2^s+48\\hat{f}_4^s-24\\hat{f}_6^s\\right]/(16l_z^2),\\nonumber\\\\ \\hat{g}_3^s & = \\left[7\\hat{f}_1^s-54\\hat{f}_3^s+80\\hat{f}_5^s-35\\hat{f}_7^s\\right]/(16l_z^2).\\end{aligned}\\ ] ]    like the second derivative operator , the @xmath300 operator preserves the kind of expansion .",
    "let @xmath301 , then : @xmath302/4 \\quad\\text{for}\\quad n \\ge 2,\\nonumber\\\\ \\hat{g}_0^c & = \\hat{f}_2^c/2 , \\quad \\hat{g}_1^c = \\left[\\hat{f}_1^c + 3\\hat{f}_3^c\\right]/4,\\quad\\text{or}\\nonumber\\\\ \\hat{g}_0^s & = 0,\\quad \\hat{g}_1^s = \\left[-\\hat{f}_1^s + 3\\hat{f}_3^s\\right]/4,\\end{aligned}\\ ] ]    one last important operation is multiplication by @xmath19 .",
    "a simple recursion relation exists only for multiplication by @xmath19 on a @xmath111 series , which turns it into a @xmath303 series .",
    "let @xmath304 , then : @xmath305    in practice , the recursion relations for @xmath300 and @xmath306 are unnecessary , as matrices for these operations can be built up from the first derivative matrices and the multiplication by @xmath19 matrix .",
    "barranco , j. , marcus , p. , umurhan , m. , 2000 . scalings and asymptotics of coherent vortices in protoplanetary disks . in : center for turbulence research ",
    "proceedings of the 2000 summer program . pp .",
    "boyd , j. , 1998 .",
    "two comments on filtering ( artificial viscosity ) for chebyshev and legendre spectral and spectral element methods : preserving boundary conditions and interpretation of the filter as a diffusion . j. comp .",
    "143 , 283288 .",
    "miesch , m. , elliott , j. , toomre , j. , clune , t. , glatzmaier , g. , gilman , p. , 2000 .",
    "three - dimensional spherical simulations of solar convection . i. differential rotation and pattern evolution achieved with laminar and turbulent states .",
    "j. 532 , 593615 .",
    "moore , d. , saffman , p. , 1971 .",
    "structure of a line vortex in an imposed strain . in : olsen , j.  h. , goldburg , a. , rogers , h. ( eds . ) , aircraft wake turbulence and its detection .",
    "plenum press , new york , pp ."
  ],
  "abstract_text": [
    "<S> we have developed a three - dimensional ( 3d ) spectral hydrodynamic code to study vortex dynamics in rotating , shearing , stratified systems ( e.g. ,  the atmosphere of gas giant planets , protoplanetary disks around newly forming protostars ) . the time - independent background state is stably stratified in the vertical direction and has a unidirectional linear shear flow aligned with one horizontal axis . </S>",
    "<S> superposed on this background state is an unsteady , subsonic flow that is evolved with the euler equations subject to the anelastic approximation to filter acoustic phenomena . a fourier - fourier basis in a set of quasi - lagrangian coordinates that advect with the background shear is used for spectral expansions in the two horizontal directions . </S>",
    "<S> for the vertical direction , two different sets of basis functions have been implemented : ( 1 ) chebyshev polynomials on a truncated , finite domain , and ( 2 ) rational chebyshev functions on an infinite domain . </S>",
    "<S> use of this latter set is equivalent to transforming the infinite domain to a finite one with a cotangent mapping , and using cosine and sine expansions in the mapped coordinate . </S>",
    "<S> the nonlinear advection terms are time integrated explicitly , whereas the coriolis force , buoyancy terms , and pressure / enthalpy gradient are integrated semi - implicitly . </S>",
    "<S> we show that internal gravity waves can be damped by adding new terms to the euler equations . </S>",
    "<S> the code exhibits excellent parallel performance with the message passing interface ( mpi ) . as a demonstration of the code </S>",
    "<S> , we simulate the merger of two 3d vortices in the midplane of a protoplanetary disk .    </S>",
    "<S> hydrodynamics , vortex dynamics , anelastic , rotating flows , stratified flows , shear flows , spectral methods , coordinate mapping , infinite domains 02.70.hm , 47.11.+j , 47.32.cc </S>"
  ]
}