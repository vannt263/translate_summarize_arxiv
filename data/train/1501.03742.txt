{
  "article_text": [
    "the sdss - iii / apogee project obtained high resolution ir spectra of over 150,000 milky way stars during the period 20112014 , as described in @xcite and @xcite .",
    "it is based on a bench - mounted spectrograph operating in cryogenic conditions that can obtain 300 simultaneous spectra covering wavelengths of 1.511.70@xmath1 m for light fed to it from the sloan 2.5-m telescope @xcite via 40-m long optical fibers .",
    "the spectra are recorded onto three separate hawaii-2rg ( h2rg ) arrays , where each array covers a different wavelength span , with small gaps in wavelength coverage between . the instrumental design and performance",
    "are described in detail in @xcite .",
    "given the large amount of data expected for the entire survey , development of an automated reduction pipeline was essential .",
    "however , reduction of apogee spectra is not straightforward for several reasons :    * in the near - ir , telluric absorption is significant and both spatially and temporally variable ; telluric features affect a significant fraction of the apogee observed spectrum . * the sky brightness , dominated by oh lines , is temporally and spatially variable .",
    "* the instrument design delivers slightly undersampled spectra at its short wavelength end . to avoid issues with undersampling for the stellar parameter and abundance determinations ,",
    "data are taken at two different dither positions , where the entire detector assembly is shifted by @xmath00.5 pixel between . *",
    "the teledyne h2rg arrays that are in the apogee instrument have some performance complications ; in particular , some regions show significant persistence , where previous exposure to light affects the subsequent behavior of the detector .",
    "this paper describes the state of the apogee data reduction pipeline as it has been used to produce data contained in the data releases for sdss - iii apogee , dr10 ( june 2013 ; @xcite ) and dr12 ( january 2015 ; @xcite ) . as described below , there are still some areas for potential improvement in the pipeline , but the main goal of this paper is to document the methods used to process the apogee database for its public releases .",
    "data products in and access to the data releases are discussed in @xcite .",
    "additional details on the stellar parameter and abundance analysis are presented in @xcite , and calibration and validation of the parameters and abundances are discussed in @xcite for dr12 and @xcite for dr10 .",
    "the layout of this paper is as follows .",
    "section [ sec : operations ] details the survey operations and data taking .",
    "an overview of the reduction pipeline is given in section [ sec : overview ] .",
    "sections [ sec : ap3d][sec : ap1dvisit ] describe the three steps of apred that reduce observations of an individual plate on a single night : ( 1 ) ap3d reduces the 3d data cubes to 2d images , ( 2 ) ap2d extracts the 300 spectra and determines wavelength zeropoints , and ( 3 ) ap1dvisit performs sky corrections , combines multiple dither exposures , and determines initial radial velocities .",
    "apstar combines spectra of individual stars on the rest - frame and determines accurate radial velocities ( section [ sec : apstar ] ) .",
    "radial velocity determination for both the ap1dvisit and apstar steps are described in detail in section [ sec : rvs ] .",
    "access to the data products is described in section [ sec : access ] , and , finally , a summary is given in section [ sec : summary ] .",
    "figure [ fig_flowchart ] shows a flowchart of the pipeline processing steps .",
    "initial commissioning data were taken starting in april 2011 .",
    "the initial data showed some issues with the internal optics and with relative focus of the three detectors , so the instrument was opened during summer 2011 to improve these issues .",
    "it was subsequently cooled in august 2011 , and official survey - quality data began to be collected after this time .",
    "the instrument remained cold , and in the same optical configuration over the course of the entire survey and is therefore quite uniform .    to collect data ,",
    "the 300 apogee optical fibers are coupled to standard sloan 2.5-m plug plates .",
    "for routine first year science observations , 230 of the fibers are placed on science targets ( almost all stars ) ; 35 additional fibers are placed on blue stars to be used to measure telluric absorption , and 35 fibers are placed on sky regions without objects .",
    "targeting is based almost entirely on the 2mass catalog and is described in detail in @xcite . for most survey fields ,",
    "the fibers are distributed over a 3@xmath4(diameter ) field of view , although for some low declination , high airmass fields , a smaller field is used to minimize differential refraction effects .",
    "data are collected from the sdss telescope using the standard sdss telescope / instrument interface , stui ( sdss telescope user interface )",
    ". the normal mode of operation is to take individual exposures of 500s duration .",
    "exposures are taken at either of two dither positions ( `` a '' or `` b '' ) , where the detectors are nominally moved by @xmath00.5 pixels between exposures ( although early survey data had a somewhat smaller shift of @xmath00.4 due to technical issues but this did not adversely affect the reduction ) . the standard observing sequence collects 2 abba exposure sequences per plate , which leads to slightly over one hour of exposure per plate on a night . for most fields ( but not all ,",
    "see @xcite ) , the target exposure time is three hours , but these are collected over three different visits to the field , spread out in time , to enable identification of radial velocity variation arising from stellar binarity .",
    "individual visits to a field are identified by a plate identification and an mjd 2400000.5 .",
    "the mjd used by sdss - iii is mjd@xmath50.3 days so that the `` day '' increments in the afternoon at apache point observatory . ] .",
    "individual visits to an object are identified by a plate , mjd , and fiber number ; a given star will not generally be observed in the same fiber in subsequent visits , since plates are typically replugged between visits .",
    "the data collection system continually reads the detectors non - destructively as the charge is being accumulated , at slightly more than 10 seconds between reads , so the 500s exposures are composed of a series of 47 readouts . since these `` up - the - ramp ''",
    "readouts are accessible as the exposure is proceeding , it is possible to analyze count rates as the exposure is accumulating .",
    "this is done by `` quicklook '' software that communicates this information to the sdss observers . to date , this has largely been used for informational monitoring , and total exposure times have been fixed to 500s . under poor conditions , a third abba sequence is sometimes obtained . during the final visit ( usually the third ) to a field , only one abba sequence is taken if it is likely to be sufficient to reach the total desired accumulated @xmath6 .",
    "after exposures are finished , a quick reduction is done to provide observers with some roughly reduced data ( i.e. , extracted 1d spectra ) to inspect .",
    "the quick reduction software also takes the files with the individual readouts , bundles them into three data cubes ( one for each detector ) , and compresses them ( see next section ) .",
    "additionally , information about the exposure and quick - reduced spectra are inserted into a database running on the mountain .",
    "this database is used to monitor progress of the observations on each field , and is the basis for the autoscheduler , which determines the plan for plugging and observing of new fields .",
    "a web application allows for a graphical interface to this database .",
    "calibration data are obtained by coupling the fiber bundle from the instrument to a fiber bundle that leads to an integrating sphere with calibration sources .",
    "three calibration sources are available : a continuum source , and thorium - argon - neon ( tharne ) and uraninum - neon ( une ) hollow - cathode lamps .",
    "in addition , several ir leds were installed on a cold shutter mechanism that was installed in summer 2011 .",
    "these are located downstream of the internal slithead , and provide roughly uniform illumination of the detectors that can be used to determine pixel - to - pixel sensitivity variations ; we refer to such frames as internal flats .",
    "some calibration data are taken on a daily basis , mostly for instrument performance monitoring . at the end of the afternoon , a few test frames of a continuum source and some line lamp exposures are taken for quick inspection by the observers to confirm routine instrument performance . at the end of each night , a more complete set of calibration data are obtained ; this set includes several long dark frames , lamp exposures ( tharne and une at both dither positions ) , and several internal flat fields .",
    "more extended sequences of calibration data were taken near the beginning of the survey and were repeated periodically throughout the duration of the survey .",
    "in addition , on each observing night , 4 exposures ( 1 @xmath7 abba ) are taken of a random pointing on the sky so that all fibers are illuminated by sky ( predominantly oh lines ) .",
    "these frames are used to characterize and monitor the image quality and the related spectral line spread function ( lsf ) .",
    "the nightly volume of data collected is significant .",
    "each standard exposure has 47 readouts of three 2048x2048 chips , and the instrument computer also collects an additional 2048x2048 array that provides bias information .",
    "this leads to roughly 1.5 gb per exposure .",
    "for multiple exposures and multiple plates , plus associated calibration data , this leads to of order @xmath0100 gb of data per full night of apogee observing .",
    "all of the raw up - the - ramp apogee data are kept and transferred daily off the mountain to the sas .",
    "to speed up the data transfer off the mountain and reduce overall disk space the raw data are compressed using a custom designed algorithm .",
    "this algorithm takes advantage of the fact that successive reads of the arrays are very similar ; as a result , the sequence of difference images has relatively smaller dynamic range and can be compressed efficiently .",
    "three steps are used to compress the up - the - ramp data cubes :    1 .",
    "the detector reads are converted into difference images resulting in n@xmath8 integer images ( n@xmath8 - 1 difference images and the first read ) .",
    "2 .   the average difference image ( rounded to integers )",
    "is computed and subtracted from the difference images resulting in n@xmath8 + 1 integer images ( n@xmath8 - 1 `` residual '' images , one average difference image , and the first read ) . the n@xmath8 + 1 integer images are written to a multi - exension fits file .",
    "the fits file is compressed using the fpack routines @xcite and the lossless rice compression algorithm .",
    "these custom apogee compressed files ( a separate one for each of the three arrays ) are saved to disk with `` .apz '' extensions and are on average compressed by a factor of @xmath02 .",
    "the theoretical best compression rate of data of our noise - level ( @xmath020 ) and bits per pixel ( 16 ) is @xmath02.6 @xcite , although in practice the best algorithms will obtains compressions of @xmath02.2 . therefore , our custom compression algorithm is about as good as can be expected for our data .",
    "compression and uncompression algorithms are implemented in the apzip and apunzip custom idl procedures .",
    "data reduction is run off - site on the raw , compressed data downloaded from the sas .",
    "there are two main stages for basic data reduction :    1 .",
    "apred reduces observations of an individual plate on an individual night in three steps : 1 .   ap3d reduces the data cubes to 2d images , applying detector calibration products in the process",
    ". a separate error image and a mask of bad pixels are also calculated .",
    "ap2d extracts the spectra from each 2d image to produce 300 well - sampled 1d spectra and corrects them for throughput variations .",
    "ap2d also performs wavelength calibration using exposure - specific wavelength zeropoints determined from the positions of sky lines and wavelength solutions previously derived from emission - line lamp exposures .",
    "error images and masks are also produced .",
    "ap1dvisit measures accurate dither shifts between exposures in a visit , corrects individual exposures for sky emission and absorption , and combines multiple dithered exposures in a visit to produce 300 1d spectra .",
    "the code then determines an initial radial velocity estimate for each stellar object using a best - matching stellar template .",
    "outputs include sky - corrected spectra , as well as pixel - by - pixel errors , mask information , and wavelength array , and the correction spectra used for the sky correction .",
    "in addition , information about the observed dithering and dither combination are output .",
    "apstar is run after multiple individual visits have been obtained .",
    "it resamples the spectra onto a fixed wavelength grid ( constant dispersion in @xmath9 ) , correcting each visit for the visit - specific radial velocity , and coadds the spectra . using the combined spectra ,",
    "the code derives relative radial velocities via cross - correlation of each individual spectrum with the combined spectrum , and puts them on an absolute scale by cross - correlating the combined spectrum against a best - matching template spectrum . as a check",
    ", individual visit rvs are rederived by cross - correlating each visit spectrum against the common template that best matches the combined spectrum .",
    "a flowchart of these processing steps and the resulting data products are shown in figure [ fig_flowchart ] .",
    "a third pipeline stage determines stellar parameters and chemical abundances in the apogee stellar parameters and chemical abundances pipeline ( aspcap ) , as described in @xcite .",
    "the software used for the apogee data reduction pipeline is almost exclusively implemented in the interactive data language ( idl ) .",
    "the code is archived and managed through use of the sdss - iii software repository using the software management package subversion ( svn ) .",
    "while it was not designed for general public usage , the dr12 version of the code is publicly available http://www.sdss3.org / svn / repo / apogee / apogeereduce/.",
    "during an exposure the three apogee arrays are read out non - destructively every @xmath010.6 seconds in sample - up - the - ramp ( sutr ) mode .",
    "in addition to providing the opportunity for inspection of data as it is being accumulated , the sutr can be used advantageously to :    * reduce the read noise by using multiple measurements of the electrons as they are accumulated @xcite ; * detect and correct cosmic rays ; * potentially correct saturated pixels if there are enough ( @xmath103 ) unsaturated reads to measure the flux rate , and the flux rate is assumed constant in time .    as discussed above , the separate apogee raw readouts",
    "are stored in a data cube ( one per array ) and subsequently compressed . in ap3d , these data cubes are `` collapsed '' into 2d images .",
    "basic calibration is also done at this stage , leading to these main steps :    1 .",
    "reference pixel correction , 2 .",
    "linearity correction ( currently not implemented ) , 3 .",
    "dark subtraction , 4 .   cosmic ray detection and repair ; saturated pixel correction ( currently not implemented ) 5 .",
    "collapse to 2d image , 6 .",
    "flat fielding , 7 .",
    "construction of error array and bad pixel mask .",
    "these are all described in more detail below .",
    "each of the three teledyne hawaii 2rg detectors ( each with @xmath11 18@xmath1 m pixels ) are read in parallel through 4 different channels per chip , with each `` quadrant '' being @xmath12 in size .    the voltage bias for the hawaii 2rg arrays can drift slowly over time , but reference pixels have been implement to correct for this effect .",
    "there are two types of reference pixels : ( 1 ) a perimeter of 4 pixels around each array ( `` embedded '' reference pixels ) that are not `` active '' but are read out the same way as the rest of the array ( via 4 output channels per array ) .",
    "( 2 ) a single reference pixel for each array that is read out with its own readout port , and is called the `` reference output '' .",
    "this output channel is read out in parallel and at the same rate as the other four output channels ( leading to five altogether ) producing a separate @xmath12 image . in the raw data cubes this extra @xmath12 `` reference '' image",
    "is attached to the end of the regular read image to produce a @xmath13 array .",
    "the reference image is useful to correct for electronic `` ghosts '' that are created when very high counts from a single output affect the other three .",
    "both types of reference pixels are used in the apogee reduction .",
    "first , the @xmath12 reference arrays are subtracted from each quadrant .",
    "second , vertical ramps are created for each quadrant using means of the bottom / top reference pixels and then subtracted . finally , horizontal ramps are created for the entire array using 50-pixel smoothed values from the left / right reference pixels and subtracted .",
    "this is performed separately for each readout and detector .",
    "most infrared detectors have some degree of nonlinearity , with the sensitivity changing slightly as charge is accumulated @xcite .",
    "linearity corrections are likely to be less important for our spectroscopic analysis because the dynamic range of a given spectrum , especially over the portion of any individual spectral features , is generally relatively small , and we have no requirement for high accuracy in relative flux between different objects . taking the nonlinearity coefficients from @xcite , the error in the relative depth of a 20% ( of the continuum ) absorption line for a spectrum with a continuum of 10,000",
    "adu is @xmath00.4% .",
    "the large majority of our stellar spectra have continua ( in individual exposures ) below this level , and , therefore , the effects of nonlinearity are minor .",
    "we have made some initial tests for nonlinearity using internal flat field data cubes , under the assumption that the led light source is stable ( which it appears to be , judging from the repeatability of light levels in successive exposures ) .",
    "these data suggest that there may be some small level of nonlinearity , but characterizing it is complicated by the behavior of some pixels at low light levels . as a result",
    ", we have chosen not to implement any nonlinearity correction at this time .    additionally , as discussed below",
    ", some regions of two of the detectors suffer from a significant persistence effect , where the amount of charge deposited can be affected by the previous exposure .",
    "this effect is significantly larger than any expected non - linearities in these regions .",
    "consequently , although the pipeline has an implementation for a linearity correction , we have not applied such a correction for the dr10dr12 data .",
    "the dark current is derived from multiple 60 read exposures with the internal cold shutter closed .",
    "figure [ fig : dark ] shows the distribution of the dark current rate ( counts per read ) of all of the pixels .",
    "three panels show the histogram of dark rates for each of the three chips , whereas the lower right shows the cumulative distribution across all pixels for all three chips .",
    "while most pixels have a dark rate below 0.5 counts / read , there is a tail up to high dark rates for some pixels .",
    "in fact , the typical dark current is significantly lower than 0.5 counts per read because , even after averaging 2030 frames to reduce the noise , readout noise dominates over dark current at this level .",
    "the middle array has a section of higher dark current than the other two , and this is reflected in the histogram .",
    "for the pixels with very high dark current , the effect of interpixel capacitance ( ipc , see @xcite ) is clearly visible because the hot pixels produce small crosses on the detector , with charge coupled to the adjacent pixels .    to correct for dark current ,",
    "`` superdark '' frames are constructed by taking the median of 20 long dark frames . to allow for the possibility that dark current may not accumulate linearly with time ,",
    "the superdark is constructed for each up - the - ramp readout , so the superdark calibration frame is a data cube , with the appropriate slice subtracted from the corresponding readout of each science frames .",
    "for the current analysis , we have used a single superdark , constructed from data taken on mjd 56118 .",
    "figure [ fig : dark ] ( top and lower - left panels ) shows the histograms from this date in black , as well as the histograms from darks taken at the end of the sdss - iii / apogee survey , on mjd 56853 ( in red ) .",
    "comparison of these histograms , as well as direct comparison of the dark images , show that the dark current is quite stable , with only a few pixels changing their dark rate significantly .",
    "daily dark frames are taken as part of the normal calibration , and future analysis may use these to implement correction for small changes in dark rates and the number of hot pixels .    all pixels with a dark rate exceeding 10 counts / read are marked as bad pixels .",
    "neighbors of any of these are marked as bad if their dark rates exceed 2.5 counts / read .",
    "one advantage of using sutr sampling is that cosmic rays can be detected and removed .",
    "each pixel is searched for positive jumps that could correspond to cosmic rays .",
    "first , the array of read values is turned into difference counts ( between successive reads ) .",
    "second , a median filtered version of the difference counts is created ( using a median filter of 11 reads ) that can be used to remove any flux rate variations over time ( e.g. , from seeing variations or clouds ) .",
    "then , a `` local '' scatter of the difference counts around the local median value is measured using a robust standard deviation .",
    "any difference count values larger than 10@xmath7 the local scatter above the local median ( and 10@xmath7 above the noise level ) are flagged as cosmic rays .",
    "the cosmic rays are corrected by replacing their difference values with the local median for that pixel .",
    "finally , the counts array is reconstructed by adding the cumulatively summed difference counts to the first read value .",
    "the pixels with detected cosmic rays are flagged in the mask image .",
    "this cosmic ray detection method will miss some very weak cosmic rays but should catch most of the large ones that are more likely to affect the data .",
    "figure [ fig_crfix ] shows an example of the cosmic ray correction process .",
    "figure [ fig_crhist ] shows the distribution of detected cosmic ray rates in the dr12 data for the three arrays .",
    "the median detected cosmic rays in object exposures ( 500s ) are 430/470/470 ( blue / green / red ) .",
    "1359 mm@xmath14 ) .",
    "the median values are 0.92/1.00/0.99 ( blue / green / red ) . the images with shorter exposure times have slightly higher rates likely because of lower poisson noise that allows for the detection of weaker cosmic rays . ]",
    "another advantage of using sutr sampling is that measurable signal is recorded even for pixels that end up being saturated after the full exposure time . if as few as @xmath034 reads are unsaturated , then the flux rate can be measured and used to extrapolate the counts to the end of the exposure .",
    "however , this extrapolation assumes that the count rate is stable , which is not the case in sub - optimal observing conditions .",
    "while it might be possible to characterize the count rate variations using other pixels , the situation is complicated because different pixels may have different variations in count rate , e.g. , the rate in spectral regions including sky emission are likely to vary in a different way from the rate in regions of stellar signal .",
    "the pipeline currently corrects any saturated pixels assuming a constant flux rate , but flags such pixels as having been corrected . because of the possibility that this correction is a poor approximation , subsequent stages of the reduction treat these pixels as bad .         of the fit",
    "photon statistics alone are expected to yield @xmath15 . ]",
    "as is standard with non - destructive readout ir arrays , the array reset at the beginning of each exposure introduces a pedestal value with significant `` noise '' ( i.e. , pixel - to - pixel variations ) , so multiple non - destructive readouts are required to remove the baseline values and this `` reset noise '' . to minimize this non - negligible readout noise , 2d ir images",
    "are typically calculated from the 3d data cubes using either fowler sampling , where some number of readouts at the beginning and end of the exposure are averaged and a difference image created , or using the full up - the - ramp sampling to determine a mean count rate that , when multiplied by the exposure time , gives the total counts per pixel .",
    "the simplest fowler sampling , using just one readout at the beginning and one at the end , corresponds to correlated double sampling ( cds ) .",
    "a detailed analysis of the noise using different readout methods is presented in @xcite .    both fowler sampling and up - the - ramp analysis",
    "are implemented in the pipeline .",
    "up - the - ramp is used for all of the data except for the  dome \" flats ; these use simple cds sampling because the lamp is only turned on for a few seconds to accumulate the desired number of counts ; because the count rate is thus highly non - uniform , up - the - ramp sampling fails in this case .",
    "in addition , the relatively large number of counts in these exposures is not significantly affected by readout noise .",
    "flat fields to correct for pixel to pixel sensitivity variations are constructed using a median of ten internal flat fields and stored in the apflat calibration files .",
    "figure [ fig_flats ] shows the observed sensitivity variations of the three hawaii 2rg detectors which can be quite large .",
    "the middle ( `` green '' ) chip shows a rim of lower qe ( quantum efficiency ) giving the appearance of a `` thumb - print '' .",
    "the 2d images are flat fielded using a `` superflat '' constructed by the average of 20 internal flat field frames , with large scale structure removed ; these are stored in apflat files .",
    "the count levels in the individual flats are such that the combined flat should have s / n@xmath2 500 , or an rms of @xmath160.2% .",
    "the flat field is very stable in time .",
    "this is demonstrated in figure [ fig : flatratio ] , which shows histograms of the ratio of a superflat constructed on mjd 56037 with those taken at the end of the survey on mjd 56852 .",
    "given the s / n of the individual superflats , the ratio of the two flats is expected to have @xmath17 on the basis of photon statistics only .",
    "figure [ fig : flatratio ] shows that the distribution of values in the ratio closely matches a gaussian with width comparable to this , demonstrating that the flats are likely to be extremely stable .",
    "we note some deviations in the b chip ; upon inspection , these arise from the rim noted above , which is likely more related to persistence effects in this detector ( see section [ subsec : persistence ] ) than to temporal qe variations .",
    "any pixels in the superflat that have sensitivity less than 75% of pixels in their vicinity are marked as bad pixels , and saved in the bad pixel masks .",
    "the detectors are read in parallel through 4 different channels per chip . the inverse gain ( @xmath18 / dn ) for each channel in each chip",
    "is derived from pairs of internal flat fields using the measured variance . in 50 different intensity bins with different mean intensities ( @xmath19 ) , the variance in the difference image is measured and the inverse gain calculated from @xmath20 .",
    "we use a gain of 1.9 for all quadrants .",
    "this gain calculation will be updated in the future .",
    "a noise model is constructed by combining in quadrature the poisson noise of the 2d image , the poisson noise of the dark image , and the sampling read noise ( using the equations from @xcite ) .",
    "this noise image is placed in the `` error array '' .",
    "bad pixel mask files for each detector are created using pixels marked as bad during the construction of the superdark and superflat frames .",
    "the bad pixel masks are saved as bitmasks to preserve the reason that any given pixel was marked as bad , and these values are propagated via the bitmasks to the reduced data frames .    the bad pixel mask from the apbpm calibration product",
    "is used to mask out ( set to nan ) bad pixels from each data cube and flagged in the mask image .",
    "these pixels are not used in any of the subsequent analysis .",
    "pixels in the region of the littrow ghost ( @xmath01.604 @xmath1 m , but it varies with fiber ) , are flagged in the mask but are not marked as bad in the image since the effect can be negligible depending on the spectrum .",
    "teledyne h2rg arrays , like many ir detectors , exhibit persistence behavior in which a latent image of a previous exposure appears in subsequent images but at a fraction of the original source flux or stimulus @xcite . in h2rgs ,",
    "the persistence generally decays exponentially with time with the resulting persistence representing a small percentage of the stimulus , although it can sometimes take a long time to be released .",
    "normal persistence is not significant for most apogee exposures . the total persistence accumulated ( in a dark exposure ) 1800s after a `` stimulus '' exposure is only @xmath060 counts even for stimulus well depths of 25,000 counts .",
    "however , some regions of the apogee detectors  the top @xmath01/3 of the `` blue '' array and around the perimeter of the `` green '' detector  have unusually high levels of persistence ( which we sometimes refer to as `` superpersistence '' ) . in these regions",
    "the total accumulated persistence 1800s after an exposure is @xmath01020% of the stimulus counts .",
    "@xmath21 ) between stars in the blue superpersistence region and the star in the preceding plate visit ( in the same fiber ) where a positive difference indicates that the preceding star was brighter .",
    "( b ) the relative blue excess of the stellar spectra , ( blue@xmath22-blue@xmath23)/blue@xmath23 , where blue@xmath23 is the expected ( model ) blue flux and is the product of the observed green flux and an empirical relation ( found from the normal persistence region ) of the blue / green flux ratio as a function of @xmath24-@xmath25 color ( 1.092@xmath260.0737[@xmath24-@xmath25 ] ) .",
    "the relative blue excess signifies the level of persistence relative to the stellar spectrum .",
    "the superpersistence region is shown in red and the normal persistence region in blue .",
    "the line indicates the median of all stars at the same magnitude difference and the error bars the robust standard deviation . ]",
    "apogee spectra can be contaminated in the high persistence regions in two ways : ( 1 ) by stars in the same fiber from preceding plate visits ( most significant when the preceding star is bright ) , and ( 2 ) by calibration exposures , such as the `` dome '' flats taken before each plate visit for throughput calculations . while the persistence from the former have spectral features that will corrupt a stellar spectrum , the latter are generally featureless and act as a veiling component .",
    "fortunately , apogee uses a fiber management scheme in which fibers are designated for `` bright '' , `` medium '' and `` faint '' stars ( although each group still spans a significant magnitude range ) to help reduce cross - contamination between spectra on the detectors ( i.e. , to minimize the `` spatial '' wings of a bright star contaminating the spectrum of an adjacent faint star ; see @xcite for more details ) .",
    "this observing scheme fiber management scheme also helps reduce the relative effect of persistence from preceding stars because the magnitude differences are smaller .",
    "figure [ fig_persistence_skyfibers ] shows the median continuum in the blue detector for sky fibers ( which should show persistence from previous exposures ) versus exposure number for many science visits .",
    "this figure illustrates the level ( and temporal behavior ) of the persistence ( for which the accumulated charge is dominated by the dome flat immediately preceding a science exposure ) , which mostly affects the fainter stars . while featureless ( gray ) persistence ( as expected from the dome flat ) will not significantly impact the measured radial velocities , it will affect the relative depth of the spectral absorption lines and therefore the derived abundances .",
    "the effects of persistence on dr12 abundances are described in @xcite .",
    "figure [ fig_persistence_magdiff]a shows the distribution of magnitude difference ( @xmath28@xmath21=@xmath29-@xmath30 ) between a star and the previous star in the same fiber ( from a different plate ) while the `` relative blue excess '' , a measure of persistence relative to the stellar spectrum , is shown in figure [ fig_persistence_magdiff]b .",
    "even when the preceding star is significantly fainter there is excess flux in the blue ( @xmath010% ) , likely due to persistence from the dome flat .",
    "as @xmath28@xmath21 increases ( i.e. , the preceding star gets relatively brighter ) the flux ratio also increases due to the persistence from the preceding star .",
    "the stellar and dome flat persistence reach parity at @xmath28@xmath21@xmath31@xmath50.10 mag and a relative blue excess of 1 ( where the persistence is as bright as the star itself ) is reached at @xmath28@xmath21@xmath31@xmath56 mag .",
    "the median relative blue excess in the superpersistence region is @xmath017.4% but with a long tail to higher values ( figure [ fig_persistence_magdiff_relbluexhist ] ) and , as might be expected , the faintest apogee stars are the most affected by the persistence ( figure [ fig_persistence_magdiff_relbluexhmag ] ) .",
    "0.174 but has a long tail to higher values . ]",
    "our initial investigation of the apogee superpersistence behavior indicates that the persistence from a single stimulus ( e.g. , a flat exposure ) is well described by a double - exponential in time ( as also seen by @xcite ) with the timescales being fairly constant across pixels and stimulus ( @xmath0120s and @xmath01700s ) .",
    "the exponential amplitudes are a complex function of fluence ( or count rate ) as well as total exposure time , and the behavior changes once saturation is reached .",
    "however , persistence becomes significantly more complex once multiple stimulus exposures are taken in a row .",
    "while this is the information that is required to properly correct apogee data for persistence ( i.e. , the persistence due to the multiple previous stimuli ) , we have not yet fully characterized this behavior .    while there is evidence that persistence can be calibrated out in some circumstances ( e.g ,",
    "the @xmath32 wfc3 team has developed an algorithm that removes @xmath090% of the persistence in wfc3/ir images[multiblock footnote omitted ] ) , the apogee reduction pipeline for dr12 contains no correction for persistence .",
    "this is largely due to the complexity of the problem .",
    "our initial investigation has shown the wfc3 prescription to be inadequate for the apogee detectors .",
    "work is proceeding to fully characterize the apogee persistence behavior and to develop an algorithm to correct for persistence in later data releases .",
    "for dr12 , spectra in the persistence region and with jumps in the spectral continuum from green to blue are flagged ( see @xcite ) and should be treated with caution .",
    "of course , the red and most of the green portions of these spectra are uncontaminated by superpersistence and can be used for science . looking forward",
    ", persistence is expected to be less of a concern in the sdss - iv / apogee-2 survey because the blue detector was replaced in summer 2014 with a detector exhibiting normal persistence behavior ( although the original green detector with higher persistence around the perimeter still remains ) .",
    "all of the above tasks are performed by the idl routine ap3dproc program in the reduction pipeline .",
    "the output files are called ap2d-[abc]-id8.fits ( the abc denoting the red / green / blue detectors , respectively ) and have three data extensions , one each for the flux , errors , and bitwise pixel mask , and each with a size of 2048@xmath72048 .",
    "these files are output to the spectro / v#/red / mjd5/ directory .",
    "once the 2d images are created , the next step is to extract the 300 fiber spectra , correct them for fiber - to - fiber throughput variations , and wavelength calibrate them .",
    "this step is performed by the idl ap2dproc routine .",
    "-magnitude for the superpersistence region .",
    "the connected red dots show medians in 0.5 mag bins of @xmath21 .",
    "the persistence is most significant for the faintest apogee stars . ]",
    "the spectra are recorded roughly along rows on the three detectors .",
    "the standard extraction method uses an empirical measurement of the spatial profile of each trace at each column of each detector .",
    "use of an empirical spatial point spread function ( psf ) is possible because this psf is quite stable over the course of an exposure sequence ( visit ) , because the instrument is stationary and fiber fed . over a longer period , the traces do move by a fraction of a pixel as the weight of the ln@xmath33 tank suspended below the cold plate varies throughout a night due to ln2 depletion and then refill .",
    "however , this longer period drift is tracked using individual `` dome flat '' exposures that are taken at the end of every exposure sequence .",
    "these exposures are taken of the telescope mirror covers illuminated using a continuum source , and are used both for spatial profile construction as well as for mapping the system fiber - to - fiber throughput variations .",
    "the 300 spectra are separated by roughly 6 - 7 pixels on average . in detail , as described by @xcite , the spectra are grouped in 10 blocks of 30 fibers each , with slightly larger gaps between these groups .    to allow accurate measurements of the wings of the psf , data are periodically taken using the so - called `` sparse pack '' calibration channel , in which only 50 of the 300 fibers are populated .",
    "these provide widely separated spectra from which the psf can be determined accurately .",
    "model ) are shown in the lower panel as well as @xmath34 the poisson noise indicating that the model is satisfactory . ]        from the `` dome '' flats , a rough correction for scattered light is made by subtracting the mean value measured at the top and bottom of the chips ( specifically , rows 510 and 20382042 ) .",
    "the resulting image is then smoothed in the wavelength direction with a boxcar filter of width 50 pixels , to increase @xmath6 , given that the psf is not expected to change significantly on this scale ( there is very little tilt of the traces against detector rows ) . at each column , the observed profile is then tabulated for each of the 300 traces . since there is some overlap between adjacent traces , the light at each pixel",
    "is distributed between the two surrounding traces using information from the sparse pack calibration frames .",
    "based on the distances of a given pixel from each of the surrounding traces , the sparse pack calibration is used to determine the relative fraction of the two contributions by looking at values at these distances ( on the appropriate side of the psf ) in the nearest trace in the tabulated sparse pack data .",
    "this method assumes that the profile is sufficiently limited in spatial extent so that only adjacent traces contribute to the light at any given pixel . with this assumption ,",
    "the brightness of any given trace is directly coupled only to the brightness of adjacent traces .",
    "since the solutions of neighboring triplets of fibers are linked together , the solution of all fiber fluxes becomes a linear algebra problem with a tridiagonal matrix , solving for 300 individual fluxes at each column .",
    "this problem is solved by using the tridiagonal matrix or `` thomas '' algorithm @xcite .",
    "errors are propagated through the extraction .",
    "an example of a model psf fit to the apogee data is shown in figure [ fig_psfmodel_example ] .",
    "the ap2d code also includes options for three other extraction methods : boxcar extraction , and simultaneous fitting using both a simple gaussian and a more complex functional ( but still parametric ) form for the psf .",
    "future work might include developing these further .",
    "the most significant future development , however , would probably be to go to a full two - dimensional extraction that accommodates a 2d psf that is not separable in rows and columns ( i.e. ,  spectro - perfectionism ",
    "the `` dome '' flats for each plate are then used to correct the 300 extracted spectra for moderately wavelength - dependent fiber - to - fiber throughput variations .",
    "these are measured on an individual plate basis because of the possibility that the relative throughputs vary depending on the details of each specific coupling of the long fibers from the instrument to the short fibers in the plug plates via the gang connector .",
    "figure [ fig_fluxcorr ] shows an example of a flux calibration file .",
    "the fiber - to - fiber variations are at the @xmath010% level .",
    "accurate fiber - to - fiber throughput correction is desired to enable the possibility of accurate sky subtraction using separate sky fibers .",
    "the correction reduces the rms variation of the flux in sky fiber lines across the plate from @xmath012% to @xmath05% and only @xmath01% around a smoothly varying 2d spatial polynomial fit to the flux variations .",
    "after the fiber - to - fiber throughput calibration , each spectrum is corrected by a wavelength - dependent spectral response function to apply an approximate relative flux calibration .",
    "the relative response curve was created using the spectrum of a blackbody of well - known temperature ( 110 @xmath35c and 150 @xmath35c ) and is used for all apogee spectra ( figure [ fig_responsecorr ] ) .",
    "the correspondence between wavelength and pixel is determined using exposures of tharne and une hollow - cathode lamps .",
    "the wavelength solution varies from fiber - to - fiber because of the optical design and also because of the exact placement of each fiber in the pseudo - slit .",
    "the former causes variations over large scales , while the latter causes a fiber - to - fiber shift .    to derive the wavelength solution",
    ", gaussians are fit to all detectable lines ( 4@xmath36 above the background ) in all calibration spectra .",
    "next , these gaussians are matched up to known lines .",
    "the information for all the lines in the 300 fibers , three arrays , and multiple exposures ( normally one tharne and one urne ) are combined into one list .",
    "a 5th order polynomial ( @xmath37 versus pixel ) and two detector gaps are fit to each fiber separately .",
    "a robust linear fit ( to allow for the possibility of small rotations of the detectors relative to each other ) is made to the derived detector gaps as a function of fiber number to obtain more accurate values .",
    "finally , the 5th order fits are redone holding the chip gaps fixed at the fitted values .",
    "the residuals to these fits are on the order of @xmath00.030.04  ( @xmath00.1 of a pixel ) and dominated by the gaussian line - fitting errors .",
    "systematics in the residuals are at the @xmath00.010.02  level ( figure [ fig_wavelength_resid ] ) .",
    "the temporal variations over year timescales is @xmath00.015 , which demonstrates that the instrument is very stable .    0.010.02  level . ]",
    "a wavelength solution from an apwave calibration file is applied to each extracted spectrum .",
    "this wavelength solution still needs to be corrected for slight differences between the science exposures and the calibration frames due to different dither positions and potential changes in the optics over time ( see  [ subsec : lsfcal ] ) . for `` on - sky",
    "'' observations ( normal science exposures , sky flats , and any star down any fiber [ asdaf ] exposures ) the night sky airglow emission lines are used for this correction .",
    "a zero - point offset in the pixel positions ( not the wavelength ) is determined for each fiber separately .",
    "first , gaussians are fit to all the bright emission lines in each spectrum .",
    "then , a first guess zero - point offset is determined by cross - correlating a model airglow spectrum ( using gaussians with heights of unity and a standard apogee wavelength solution ) with a model spectrum of the measured lines ( also using gaussians with heights of unity ) .",
    "next , the zero - point estimate is used to match the measured lines with known airglow lines .",
    "a new wavelength solution is determined allowing only the pixel zero - point to vary .",
    "finally , a line is fit to all the fiber zero - point shifts versus fiber number and this fit is used for the zero - point offsets in the wavelength solution .",
    "the output files for ap2d are called ap1d-[abc]-id8.fits and have four extensions containing the flux , errors , bitwise pixel mask , and wavelength array ( in  ) , each with a size of 2048@xmath7300 .",
    "a model of the 2d image is also output with names of ap2dmodel-[abc]-id8.fits .",
    "these files are output to the spectro / v#/red / mjd5/ directory .",
    "after extraction , the spectra are sky and telluric corrected and then the separate exposures ( at different dither positions ) are combined into one well - sampled spectrum per fiber .",
    "this is performed in the ap1dvisit stage with the ap1dvisit routine .    as explained in section [ sec : operations ] , each plate `` visit '' generally consists of eight @xmath0500 sec ( 47-read ) exposures taken as two abba dither position sequences ( a and b being roughly 0.5 pixels apart in the spectral dimension ) .",
    "sky subtraction and telluric absorption correction are done on an exposure - by - exposure basis because of the possibility of sky variation from one exposure to another , since the sky is known to vary on short time scales .",
    "this leads to some complications because of the mild undersampling of the spectra on the blue end , preventing simple resampling of sky and telluric fibers to yield a correction for each object fiber .",
    "due to slight undersampling at the bluer wavelengths the apogee exposures are taken at two different spectral dither positions shifted by roughly 0.5 pixels from each other .",
    "the actual positions at which the exposures are taken are not known precisely enough a priori for accurate combination of spectra taken at two different dither positions .",
    "therefore , the dither position of each exposure is measured from the actual data .",
    "this is done relative to the first ( reference ) exposure in two ways : ( 1 ) cross - correlation of spectra , and ( 2 ) shifts of airglow emission lines . for the cross - correlation , the ( non - sky )",
    "spectra are first normalized ( using a 100-pixel median filter ) , then cross - correlated against the first exposure spectrum , and finally a gaussian is fit to the cross - correlation peak to find the best shift .",
    "this is done separately fiber - by - fiber and array - by - array .",
    "finally , a robust mean is calculated of all individual 900 shifts measured . in the emission line method ,",
    "all bright emission lines in all fibers are fit with gaussians , then matched with their corresponding lines in the first exposure , shifts calculated , and a robust mean measured .",
    "the pipeline currently uses only the cross - correlation technique which gives average formal errors of @xmath00.005 pixels .",
    "the measured dither shifts are written to the header for later use in the dither combination process .",
    "7 pixels of the model lsf convolved with the pixel size . ]      to accomplish sky correction ( emission and absorption ) on undersampled data , as well as for spectra in which the lsf varies across the detector , the sky corrections are forward modeled using constraints from the observed sky and telluric fibers .",
    "this requires an accurate measurement of the lsf as a function of wavelength and fiber .",
    "the line spread function ( lsf ) is modeled as a sum of gauss - hermite functions . ]",
    "( which form an orthonormal basis ) and a wide - gaussian for the wings .",
    "the convolution of the model lsf with the pixel size is taken into account .",
    "lsf parameters are determined using airglow lines in the nightly skyflats .",
    "each fiber and array are fit separately .",
    "the lsf parameters are allowed to vary slowly with wavelength by means of a low - order polynomial as a function of pixel .",
    "the model lsf is always normalized to an area of one .",
    "figure [ fig_lsfdiagram ] illustrates the typical variations of the lsf across the three detectors and the fact that the lsf is slightly undersampled in the blue .        as a demonstration of the lsf stability , figure [ fig_lsfstability ] shows the temporal variation of the gaussian fwhm of one thorium - argon - neon line per detector ( and five fibers ) . while there are some small - scale variations , the rms of the fwhm values per fiber are @xmath012% , which indicates that the instrument has been remarkably stable over three years .",
    "the traditional measurement of resolving power ( r=@xmath37/@xmath28@xmath37 ; using a direct - measured fwhm for @xmath28@xmath37 ) gives an average of r=22,500 for apogee spectra , but there are @xmath01020% variations across the detectors ( spectrally and spatially ) as seen in figure [ fig_resolution ] .",
    "however , the apogee lsf is non - gaussian and , therefore , a traditional `` r''-value is not necessarily a good description of apogee s resolution .",
    "the observed spectra are contaminated by night sky emission airglow lines ( mostly oh ) from the earth s atmosphere , and sky continuum which is most often dominated by moonlight ( reflected sunlight ) and greatly enhanced on cloudy nights .",
    "we have found that light pollution from nearby el paso ( texas ) is not a significant component of our sky spectra .",
    "the sky spectrum can vary spatially across our 3@xmath4fov and temporally during our @xmath01 hour `` visit '' of the field .",
    "therefore , each plate has @xmath035 fibers designated for `` blank '' sky that can be used to subtract the sky spectrum from the science fibers .",
    "the sky fiber positions are chosen in @xmath017 spatial zones to give them a fairly uniform distribution across the plate ; see @xcite for details .",
    "the current pipeline is using a temporary , and sub - optimal , sky subtraction method . for each science fiber",
    "the four nearest ( on the sky ) sky fibers are found .",
    "first , the spectra from these four sky fibers are resampled onto the wavelength solution of the science fiber ( using cubic spline interpolation ) .",
    "next , each of the four sky spectra are cross - correlated with a continuum subtracted ( 150 pixel median filter ) science fiber spectrum and shifted accordingly to fix any errors in the wavelength solutions .",
    "an emission line scaling factor is then calculated for each sky spectrum relative to the science spectrum airglow lines using pixels with sky emission greater than 10@xmath7 the noise .",
    "a weighted average sky spectrum is then created from the scaled sky spectra ( with sky continuum added back in ) using 1/(sky distance)@xmath14 for the weighting , and subtracted from the science spectrum .",
    "figure [ fig_skysub ] shows an example of a single exposure sky fiber spectrum after sky subtraction ( the absolute value ; the sky fiber in question was not used to determine the sky spectrum , only the neighboring sky fibers were ) and the pipeline noise model for comparison .",
    "even this sub - optimal sky subtraction works fairly well with the large majority of the residuals below three times the noise level .",
    "possible improved methods include modeling of the airglow lines with 2d spatial polynomial fitting of airglow family fluxes , and principal component analysis ( pca ) .",
    "these methods are currently under investigation and development .",
    "it should be noted that the airglow lines are so bright that little scientific benefit can be gained from the stellar spectrum `` underneath '' them , since even with perfect subtraction the poisson noise from airglow will dominate over ( wash out ) any stellar spectrum .",
    "the far wings of the airglow lines should be salvageable , but the most critical portion of sky subtraction is the removal of the sky continuum , which would otherwise distort line depths in normalized spectra and their subsequent analysis .",
    "poorly subtracted airglow lines can also adversely affect the rv determination .",
    "the nir @xmath21-band hosts a number of atmospheric ( telluric ) absorption lines ( from h@xmath33o , co@xmath33 , and ch@xmath38 ; see figure [ fig_telspec ] ) that contaminate a significant fraction of the apogee spectral range ( @xmath020% ) and need to be corrected . as with the airglow spectrum the telluric absorption spectrum may vary spatially and temporally for our observations .",
    "each plate has @xmath035 fibers designated for `` telluric '' ( hot ) stars that can be used to ascertain the telluric absorption for the science fibers .",
    "a procedure is used to pick telluric fibers in spatial zones similar to that used for sky fibers @xcite .",
    "a three - step process is used to correct for telluric absorption : ( 1 ) telluric absorption model fitting to the hot star spectra , ( 2 ) 2d polynomial spatial fitting of the telluric species scaling parameters across the plate , and ( 3 ) construction of the model telluric absorption spectrum for each science fiber using the model telluric spectra , 2d polynomial fitting parameters , and the known lsf of the science fiber .",
    "the lblrtm[multiblock footnote omitted ] model atmosphere code @xcite was used to create a grid of high - resolution model telluric species spectra for co@xmath33 , h@xmath33o and ch@xmath38 , individually , using the us standard 1976 atmosphere for the altitude of apo . for co@xmath33 and ch@xmath38 , four different scale factors that parameterize the strength of the features were used ( 0.5 , 1.0 , 1.5 , and 2.0 cm ) ; for h@xmath33o , four different precipitable water columns ( 0.75 , 1.5 , 2.25 , and 3.0 ) were used .",
    "spectra were calculated at seven different airmasses , from 1.0 to 2.5 , spaced by 0.25 .    for each plate , we interpolated in airmass within this grid to get four model spectra for each absorption species .",
    "for each telluric star on a plate , we find the scale factor of each model that best matches each spectrum , and determine which of the four scaled models for each species provides the best fit .",
    "we then adopt the model for each species that best fits the majority of the stars , and refit each telluric spectrum with the same model to get a self - consistent set of scale factors across the field .",
    "the fits are performed by adopting the scale factor that yields the minimum rms in all pixels where the telluric lines for that species are dominant ( pixels must be within 5 pixels of a telluric species line with strength greater than 1% in the convolved model telluric spectrum ) . to obtain a reliable telluric scale factor the stellar continuum ( including the wide hydrogen absorption lines )",
    "needs to be removed .",
    "therefore , an iterative process is used .",
    "the stellar continuum is calculated using a median filter ( 100 pixels wide ) of the stellar spectrum corrected with the current best - fit model telluric spectrum ( after the first iteration ) .",
    "stellar continuum and scale factors are calculated until the solution converges .",
    "since the line spread profile ( lsf ) varies from fiber to fiber , the high - resolution model species spectra are convolved with a separate lsf ( from the aplsf calibration file ) for each fiber .    at this point",
    "the species scalings for each hot star are determined , and a 2d spatial polynomial model is fit to the @xmath035 scalings for each species separately . for co@xmath33 and ch@xmath38",
    "we use a linear model ; since these species are thought to be well - mixed in the atmosphere , the linear trend is included to account for variations in airmass across the field . for h@xmath33o ,",
    "which could have significant spatial structure , we use a quadratic surface .",
    "the rms around the fit is normally @xmath012% .",
    "figure [ fig_telsky ] shows an example of a 2d polynomial fit to a species scaling with significant spatial variations ( most exposures show much less variations ) .",
    "finally , the model telluric spectra are calculated for each science spectrum , using the 2d polynomial fit coefficients to obtain the three species scalings for the position of the science object .",
    "then , the high - resolution model telluric species spectra are convolved with the lsf of the science fiber and scaled appropriately with the species scaling for that fiber . the science spectrum is divided by the final convolved telluric spectrum .",
    "an error in the telluric model for each object is computed by taking the rms scatter in the 2d polynomial fit of each species scaling and propagating the errors forward into the model telluric spectrum .",
    "the average error in the telluric correction is roughly @xmath012 % of the stellar continuum .",
    "it is worth noting that this procedure is astrophysically incorrect as the telluric absorption occurs _ before _",
    "the light goes through the spectrograph and gets convolved with the instrumental lsf .",
    "however , this often - used approximation works well enough ( @xmath01% ) for our needs .",
    "figure [ fig_telcorr ] shows an example of an apogee spectrum of a hot star before and after telluric correction .",
    "the residuals after removing the broad stellar absorption features are small at 0.0081 or less than a percent .",
    "some systematics in the residuals , such as around the co@xmath33 band on the red side of the blue chip , are still present .",
    "since the lsf varies only slowly with time it is not necessary to convolve the high - resolution telluric model spectrum for each exposure separately .",
    "therefore , to save time in the entire telluric correction step , the three original high - resolution telluric model spectra are pre - convolved with the lsf of all 300 fibers and saved as the aptelluric calibration product . currently , only a single lsf calibration file is used for all the apogee reductions , because the lsf shows very little temporal variation ( see figure [ fig_lsfstability ] ) .",
    "after sky subtraction and telluric correction the `` corrected '' frame is written to disk .",
    "the apcframe-[abc]-id8.fits files have extension of 1-flux ( electrons ) , 2-error ( electrons ) , 3-bitwise flag mask , 4-wavelength (  ) , 5-sky ( electrons ) , 6-sky error ( electrons ) , 7-telluric absorption , 8-telluric error , 9-wavelength coeficients , 10-lsf coefficients , and 11-plugmap structure ( binary table ) .",
    "the arrays in extensions 18 have sizes of 2048@xmath7300 , the wavelength coefficients 300@xmath714 , and lsf coefficients 300@xmath727 .          as mentioned in  [ subsec : dithershift ] , due to undersampling",
    "the apogee exposures are taken at two different dither positions that must be combined to create well - sampled spectra .",
    "this is performed in two steps : ( 1 ) the exposures ( a total of n@xmath39 ) are paired up and interlaced to create well - sampled spectra , and ( 2 ) the n@xmath39/2 well - sampled spectra are co - added to create one `` visit '' spectrum per object .",
    "the exposures are paired up , one dither position ( a and b ) per pair to create a series of approximately equal-@xmath6 pairs .",
    "each exposure spectrum is separately normalized / scaled using a median filtered ( width of 501 pixels ) version of the spectrum ( each array separately ) to remove any variations in net flux due to differences in seeing or throughput between the two exposures ( only for objects , not sky ) .",
    "using the previously measured dither shifts (  [ subsec : dithershift ] ) , the two scaled spectra are then combined with the sinc - interlace equations from @xcite onto a pixel scale twice as fine as the `` native '' scale ( for the single exposures ) .",
    "all pairs share the same final pixel scale so that the spectra are only resampled once . the flux level of the well - sampled spectrum is then rescaled to the average of the scaling arrays of the two individual exposures . in the second step ,",
    "the n@xmath39/2 well - sampled spectra ( normally 4 per visit ) are co - added .",
    "the flux level of the spectra are again scaled using a median filter .",
    "the scaled spectra are combined using a weighted mean ( with 5 @xmath36 outlier rejection ) where the weights are computed either on a spectrum - to - spectrum or pixel - by - pixel basis .",
    "the pipeline currently uses the pixel - by - pixel weighting . the final combined spectrum is then rescaled using the sum of the scaling arrays of the individual spectra",
    ".      the final combined object spectra are roughly flux calibrated ( on an absolute flux scale ) using the 2mass @xmath21-band magnitudes . for each star",
    "we separately determine an absolute flux correction factor , @xmath40 , to allow for differences in airmass , fiber - centering errors , and seeing variations .",
    "this multiplicative factor is used to convert the observed spectrum in electrons to calibrated physical units ,        o ( exposure 03770010 ) . @xmath41 and @xmath42 are coordinates relative to the center of the plate in right ascension and declination , respectively .",
    "this is a fairly extreme case to show how the 2d fitting handles large spatial variations .",
    "most cases are flatter . ]",
    "@xmath43    where @xmath44 is the observed spectral flux in e@xmath45 at pixel @xmath46 .",
    "the correction factor can be calculated with ,    @xmath47    where @xmath48 is the 2mass zero - point for isophotal monochromatic light ( 1.33@xmath710@xmath49 w/@xmath50 ) for a 0th magnitude star in the @xmath21-band @xcite[multiblock footnote omitted ] . after applying the absolute flux calibration",
    "the spectra are in physical units of ergs / s / cm@xmath14/ .",
    "after the absolute flux calibration step the applate-[abc]-plate4-mjd5.fits and apvisit-plate4-mjd5-fiberid3.fits files are written to disk .",
    "the applate files contain all 300 spectra while the apvisit files ( @xmath0265 of them ) are for single object spectra ( no sky spectra ) .",
    "the fluxes and errors are stored in units of 10@xmath52 ergs / s / cm@xmath14/ .",
    "note , the fiberid is not the same as the idl index in the data arrays .",
    "fiberid=300 is the first spectrum in the data arrays ( bottom ) and fiberid=1 is the last one ( top ) .",
    "the conversion is fiberindex=300@xmath26fiberid .",
    "many of the important object parameters including name , coordinates , 2mass magnitudes , apogee targeting flags , date observed , apvisit filename , radial velocity , best - fitting template parameters , and more are saved in a fits binary table called apvisitsum-plate4-mjd5.fits . in the field",
    "directory spectro / v#/fields / loc4/. these are useful for quickly accessing the output parameters of the pipeline .",
    "most of the stars are observed in several different visits to enable detection of radial velocity variation to identify binaries and to accumulate the necessary @xmath6 .",
    "after multiple visits , a combined spectrum is made to provide the highest @xmath6 individual spectra for each star .",
    "the output combined spectra for all apogee objects are placed on the same rest wavelength pixel scale , with a constant dispersion in @xmath53 , using @xmath54 with 8575 total pixels ( @xmath55 to 8574 ) , giving a rest wavelength range of 15100.8 to 16999.8  .",
    "the dispersion was chosen to provide approximately 3 pixels per resolution element , although the resolution varies over the full wavelength range . to do the combination , each rest frame ( i.e.",
    ", the doppler shift is removed ) visit spectrum is sampled on this final wavelength scale using sinc interpolation .",
    "since the visit spectra are all dither combined , they are well sampled over the entire range ; in fact , they are significantly oversampled at the long wavelength end .",
    "the sinc interpolation takes this into account by using a chip - dependent fwhm , conservatively adopted to be 5 , 4.25 , and 3.5 ( dithered ) pixels in the red , green and blue chips , respectively .",
    "this effectively filters out noise at higher spatial frequencies .    after a rough continuum normalization ( using wide boxcar and median filters ) , the resampled spectra are then combined using a weighted mean , with weights calculated on both a pixel - by - pixel and a spectrum - by - spectrum basis ( where the weight is the inverse square of the normalized error ) . the resulting weighted average spectrum",
    "is then multiplied by the average continuum of the individual visit spectra .",
    "the determination of radial velocities and the spectral combination are done iteratively and is described in more detail in section [ subsubsec : relativervs ] .",
    "figure [ fig_apstar_snr ] shows the s / n values ( per half resolution element ) using the pipeline noise model and the variance from multiple visits ( for 9548 stars with 6 visits ) .",
    "the empirical values are systematically low compared to the noise model estimates in the high s / n regime ( i.e. , bright stars ) , which indicates that we are limited by systematics ( at the @xmath00.5 % level ) for these stars .",
    "however , we can easily achieve the s / n@xmath0100 required for the survey .",
    "a combined lsf is created by taking a weighted average ( using the same weights as above ) of the individual visit lsf arrays on the final apstar wavelength scale .",
    "the model lsf ( a sum of spatially - varying gauss - hermite functions ; see section [ subsec : lsfcal ] ) is fitted to the empirical 2d lsf array and the coefficients of this approximation are also saved .",
    "there is an output apstar-2massid.fits file for each unique object that contains the two combined spectra ( pixel - by - pixel and visit - by - visit weighting ) as well as the individual visit spectra resampled on the apstar wavelength scale .",
    "the final , weighted lsf and the gauss - hermite coefficients are saved in apstarlsf-2massid.fits files .",
    "summary information for all stars in a given field are saved in the apfield-loc4.fits files .     per half resolution element of pixels not affected by telluric absorption or sky lines derived using the pipeline noise model ( black ) and the variance in multiple measurements ( red ) for 9548 stars with 6 visits .",
    "the lines show medians in bins of 1 mag .",
    "the empirical s / n values are consistently low compared to the noise model values for high @xmath6s , which suggests that we are limited by systematic errors at the @xmath00.5% level for these stars . ]",
    "apogee radial velocities ( rv ) are derived at both the visit and the object stages .",
    "the main steps are :    * as each visit is reduced , an rv estimate is determined by cross - correlating the visit spectrum against a grid of synthetic spectra .",
    "this provides an `` estimated rv '' for the visit , which is stored in the apvisit files , but not subsequently used since it was found to be unreliable sometimes . *",
    "`` refined '' radial velocities for each visit are derived when the visit spectra are combined in the object stage .",
    "this is done in three steps : 1 .",
    "relative radial velocities are determined using the combined spectrum as the spectral template .",
    "this is done iteratively because the relative rvs and the combined spectrum depend on each other .",
    "the absolute radial velocity of the combined spectrum is determined by cross - correlating it with a grid of synthetic spectra spanning a large range of stellar parameters .",
    "the relative radial velocities for each visit and the absolute velocity of the combined spectrum are then combined to produce absolute velocities for all visit spectra .",
    "the latter scheme was employed because rvs derived from the combined spectrum ( of the star itself ) should be more precise than rvs derived from a small set of synthetic spectra ( although there can be issues for double - lined spectroscopic binaries ) .",
    "this allows us to create a high - quality combined spectrum without even knowing what type of object we are dealing with .",
    "however , the absolute rv is a critical science product and the final combined spectrum must be on the rest wavelength scale so that it can be properly compared to the large grid of synthetic spectra in the abundance pipeline ( aspcap ) .",
    "therefore , the second step in the `` refined '' rv determination is to derive the absolute radial velocity of the combined spectrum against a small grid of synthetic spectra ( the `` rv mini - grid '' ) .",
    "the various steps in the latter process are described in more detail below .          at the end of the 1d visit stage rvs",
    "are derived for all object spectra on the plate using the well - sampled apvisit files .",
    "this gives a first estimate for the rv ( and therefore called `` estimated '' or est rvs ) , but currently these values are not used later on in the processing .",
    "these were the only rvs available pre - dr10 and were used for science papers such as @xcite .",
    "we decided to keep this portion of the code in the pipeline so we could compare rvs between the various methods .",
    "for completeness we briefly describe how these estimates rvs are derived .",
    "rvs are determined using a set of 96 synthetic template spectra ( first generation `` rv mini - grid '' ) that sparsely cover a large range in stellar parameters :    * 3,500 @xmath16 @xmath56  @xmath16 25,000 k * 2.0 @xmath16 @xmath57  @xmath16 5.0 * @xmath262.0 @xmath16 [ fe / h ] @xmath16 0.3    the ass@xmath58 t @xcite spectral synthesis package and kurucz model atmospheres @xcite were used for cool and warm stars ( @xmath56  @xmath59 10,000 k ) and synspec @xcite tlusty model atmospheres @xcite for hot stars ( @xmath56  @xmath60 15,000 k ) .",
    "three steps are used to derive the rvs : ( 1 ) continuum normalization of observed and template spectra , ( 2 ) cross - correlation of observed spectra against all template spectra , and ( 3 ) @xmath61-minimization using the best - fitting template from step 2 .",
    "* normalization : * continuum normalization of the spectra is critical to obtain accurate rvs and especially important for hot stars with very few , but wide , spectral features ( i.e. , brackett lines ) .",
    "the spectrum for each of the three arrays is normalized separately .",
    "first , bad pixels and pixels with bright airglow lines are masked .",
    "next , the 95@xmath62 percentile is calculated in 40 spectral chunks ( of @xmath0102 pixels each ) , and then fit with a robust cubic polynomial .",
    "the spectrum is normalized with this first estimate of the continuum , and the binning and polynomial fitting are repeated to remove some residual structure .",
    "the final continuum is the product of the two polynomial fits .",
    "the same procedure is used to normalize all of the synthetic template spectra .",
    "* cross - correlation : * before the normalized observed spectrum can be cross - correlated with the template spectra it is resampled ( using cubic spline interpolation ) onto the logarithmic wavelength scale of the template spectra .",
    "the resampled observed spectrum is then cross - correlated with the template spectrum , the best shift is found using the peak of the cross - correlation function , and @xmath61 computed after shifting the template .",
    "this procedure is repeated for all template spectra , and the best - fitting template is chosen based on the lowest @xmath61 value . to refine the radial velocity determination ,",
    "a gaussian plus linear fit is performed on the peak of the cross - correlation function of the best - fitting template .",
    "* @xmath61-minimization method : * after the best - fitting template is found using cross - correlation , a second rv - determination technique is used .",
    "the observed spectrum is split up into 45 pieces ( @xmath0273 pixels each ) and a separate rv derived for each piece using @xmath61-minimization and the chosen template spectrum . in this simple forward - modeling technique , the only floating parameter is the doppler shift . at a given doppler shift",
    "the template spectrum is resampled onto the wavelength scale of the observed spectrum .",
    "one advantage of the `` pieces '' technique is that an ( internal ) rv uncertainty can be calculated directly from the multiple rv measurements of the pieces .",
    "this technique works quite well for spectra of cool or metal - rich stars that have many narrow lines , but less well for hot stars .",
    "the final rv is chosen based on the calculated rv uncertainty of the two techniques .",
    "a final @xmath61 is calculated using the final , adopted doppler shift and best - fitting template . the barycentric correction",
    "( see section [ subsubsec : barycorr ] below ) is applied to convert the rvs to the solar system barycenter . an example apogee spectrum with the best - fitting template",
    "is shown in figure [ fig_exspec ] .      in the object stage radial velocities",
    "are determined for all visits of a star together using a common rv template .",
    "the measurement of rvs and the spectral combination are performed iteratively as described below .",
    "the spectra are `` prepared '' for cross - correlation by :    * pixel masking : pixels marked as `` bad '' in the mask array or have sky lines in the sky array are masked out for the rest of the rv determination . * continuum normalization : each of the three chip spectra are normalized separately .",
    "the chip spectrum is separated into 40 chunks ( covering approximately 14 angstroms each ) and the 95@xmath62 percentile pixel value is calculated for each chunk .",
    "a robust third - order polynomial is then fit to the chunk 95th percentile values .",
    "finally , the spectrum is normalized ( divided ) by the polynomial fit .",
    "this is very similar to the visit stage normalization method mentioned above .",
    "this preparation process is performed on both the observed visit spectra as well as the rv template spectra ( observed combined or synthetic spectrum ) .",
    "all radial velocities are determined by cross - correlating a spectrum against a template spectrum .",
    "the spectra are on the same logarithmic wavelength scale ( see section [ sec : apstar ] ) so that a doppler shift is identical to a constant shift in the x - dimension .",
    "the spectra are `` prepared '' for cross - correlation by continuum normalization .",
    "a gaussian is fit to the peak of the cross - correlation function to more accurately determine the best spectral shift .",
    "finally , the shift and its uncertainty are converted to velocity units .",
    "the relative radial velocities are determined by using the combined spectrum as the rv template .",
    "this is done iteratively , first determining the relative rvs and then creating the combined spectrum using the relative rvs to shift the visit spectra to a common ( mean ) velocity wavelength scale . for the first iteration ,",
    "when no combined spectrum exists yet , the highest @xmath6 visit spectrum is used as the template .",
    "for all subsequent iterations the combined spectrum is used as the template .",
    "each iteration finds small shifts of the shifted and resampled visit spectra compared to the combined spectrum until the values converge .      the combined spectrum after the relative rv step still has the mean rv of the star , which must be removed .",
    "the combined spectrum is cross - correlated against each synthetic spectrum in the rv mini - grid .",
    "for each synthetic spectrum the best rv and @xmath61 ( of the shifted spectrum ) are derived .",
    "the spectrum with the lowest @xmath61 is chosen as the best - fitting spectrum and it s rv is used as the absolute rv of the combined spectrum . once the mean velocity is determined the visit spectra are combined one last time with the mean velocity removed so that the final combined spectrum is on the rest wavelength scale .",
    "the second generation rv mini - grid is composed of 538 synthetic spectra that span a large range of stellar parameters :    * 2,700 @xmath16 @xmath56  @xmath16 30,000 k * 0.0 @xmath16 @xmath57  @xmath16 5.0 * @xmath262.5 @xmath16 [ fe / h ] @xmath16 @xmath50.5    however , the step sizes and ranges for @xmath57  and [ fe / h ] vary with effective temperature . the ass@xmath58 t spectral synthesis package and kurucz model atmospheres were used for cool and warm stars ( 3,500 @xmath59 @xmath56  @xmath59 14,000 k ) , synspec with tlusty model atmospheres for hot stars ( @xmath56  @xmath60 15,000 k ) , and bt - settl model spectra @xcite for very cool stars ( 2,700 @xmath59 @xmath56  @xmath59 3,300 k ) .",
    "this new rv mini - grid covers a larger range of parameter space and with finer sampling than the first generation grid .",
    "in addition , a number of spectra with high carbon and also high @xmath63-elements are included to help serve as templates for carbon - rich and oxygen - rich stars .",
    "the synthetic spectra have a resolution of 23,500 and are on the same logarithmically - spaced wavelength scale as the apogee combined spectra .",
    "we discovered that the bt - settl spectra used for the coolest temperatures have a systematic , temperature - dependent radial velocity offset on the order of 1 ( * ? ? ?",
    "* see figure 7 ) .",
    "the cause is not entirely clear but one possibility is a wavelength shift of the molecular water lines in the bt - settl linelist .",
    "no rv corrections were applied in dr11 + 12 , but future releases will likely have the bt - settl spectra removed from the mini - grid .",
    "after the best fitting template is determined , each individual visit spectrum is cross - correlated against this template to derive what we call `` synthetic '' radial velocities .",
    "we prefer the relative velocities derived ( as discussed above ) from the cross - correlation of each visit with the combined spectrum , because this should be a better match that does not depend on accuracy or completeness of the synthetic library .",
    "however , this technique can perform poorly for faint stars because the highest s / n visit spectrum ( used as the template in the first iteration ) is still quite noisy , and especially when only a small number of the visit spectra are available so that the combined spectrum also has low s / n . in apogee-2 , a significant number of faint halo stars and bulge rr lyrae stars will be observed and , therefore , the rv algorithms will need to be improved to accomodate these faint stars , likely by relying more heavily on synthetic spectra .",
    "the synthetic rvs provide a check of the relative rvs for objects where there is a good library match .",
    "the scatter between the two types of rvs is stored in synthscatter , and when this is larger than 1 , the suspect_rv_combination bit is set in the starflag bitmask .",
    "the cross - correlation functions from which the synthetic rvs are derived are also useful for detecting double - lined spectroscopic binaries ( sb2s ) because the combined spectrum will be a less helpful template in those cases .",
    "no automatic sb2 identification algorithm is currently in use by the pipeline , but the synthetic rv cross - correlation functions are saved in the apstar files and can be used for further inspection .",
    "radial velocities in apogee are reported with respect to the center of mass of the solar system - the barycenter .",
    "the individual exposures are corrected for the relative motion of the earth along the line - of - sight of the star during each observation .",
    "this is called the `` barycentric correction '' and can be calculated very accurately ( to levels ) .",
    "our routines are partially based on those from @xcite . when these corrections are applied to the absolute rvs from above we",
    "attain the rv with respect to the barycenter , or @xmath64for short .    3 and total @xmath6520 ) .",
    "the distributions peak at @xmath0110 for drd11 ( left ) and at @xmath080 for dr12 ( right ) .",
    "the refined and synth methods have very similar distributions with slighter larger scatter values than est in both dr11 and dr12 .",
    "the rv scatter is a good internal measure of the the internal apogee rv precision and long - term stability .",
    "note that these values include real astrophysical variations due to binaries , which likely explains the long tail .",
    ", title=\"fig : \" ] 3 and total @xmath6520 ) .",
    "the distributions peak at @xmath0110 for drd11 ( left ) and at @xmath080 for dr12 ( right ) .",
    "the refined and synth methods have very similar distributions with slighter larger scatter values than est in both dr11 and dr12 .",
    "the rv scatter is a good internal measure of the the internal apogee rv precision and long - term stability .",
    "note that these values include real astrophysical variations due to binaries , which likely explains the long tail .",
    ", title=\"fig : \" ]      to ascertain the accuracy of the apogee velocity zero - point , we compared the apogee rvs to those of @xcite and @xcite , which is on the nidever velocity scale and accurate to @xmath030 .",
    "for dr12 , there are 41 unique stars in common between apogee and nidever / chubak ( 7 with nidever et al .",
    "and 40 with chubak et al . ) .",
    "we find @xmath66 with an rms scatter of 0.192 .",
    "for dr11 , there are only 15 stars in common and @xmath67 with an rms scatter of 0.333 .",
    "therefore , the changes to the rv software from dr11 to dr12 improved both the zero - point ( by @xmath00.25 ) and dispersion .",
    "we find no clear trends with @xmath56  , @xmath57  or [ fe / h ] and do not correct the rvs for any offsets .",
    "the rv uncertainty depends on the @xmath6 , the resolution , and the information contained in the spectral lines themselves : a spectrum with lots of deep and thin lines ( such as in cool and metal - rich stars ) will have a much more accurate rv than a spectrum with few shallow and/or wide lines ( such as for metal - poor or hot stars ) .",
    "the cross - correlation rvs estimate the velocity uncertainty from the uncertainty in the measurement of the cross - correlation peak , which is partially set by the width of the peak .",
    "this currently systematically underestimates the uncertainty in the rv measurements and will be improved in the future .",
    "a better estimate of the internal precision is the rv scatter for stars with multiple measurements . for giants with a total @xmath6@xmath220 and three or more visits the distributions peak at @xmath0110 for dr11 and @xmath070 for dr12 ( figure [ fig_rvscatter ] ) .",
    "the est scatters are slightly smaller than for the refined and synth methods .",
    "this is likely because the est method uses the visit spectra on their native and oversampled wavelength scale while both the refined and synth methods use the resampled / downsampled visit spectra .",
    "future improvements on the rv software will likely use the visit spectra on their native wavelength scale .",
    "the rv scatter is higher for ( 1 ) dwarfs , because their lines are broadened by rotation and higher surface gravities , and , ( 2 ) especially for hotter stars with broader lines .",
    "figure [ fig_vscatter_relations ] shows the dependence of @xmath68 on @xmath56 , @xmath6 , and metallicity .",
    "another estimate of the internal accuracy and long term stability of the apogee rvs are median plate - to - plate rv differences using stars in common .",
    "figure [ fig_rvoffset_plates ] shows the histogram of median rv differences of 4317 plate pairs with more than 50 stars in common and rv difference uncertainties less than 0.05 .",
    "the distribution is centered around zero and has an rms scatter of 0.044 .",
    "this indicates that the apogee instrument and the rvs have been very stable over the three years of survey operations .",
    "the pipeline currently has no flag for binarity because the rv uncertainties are underestimated .",
    "in addition , giants have significant astrophysical rv scatter ( `` jitter '' ) especially at the tip of the rgb ( e.g. , * ? ? ? * ) that makes binary classification more complicated .",
    "work is ongoing to develop a reliable binary classification scheme .",
    "however , in the meantime large rv scatter may point to binarity .",
    "the first catalog of stellar and substellar companions to apogee stars will released in the near future ( troup et al .",
    "2015 , in preparation ) .",
    "all of the data are accessible through the sdss - iii science archive server ( sas ) , which provides web access to the entire set of data products , ranging from the raw data cubes to the reduced spectra ( including intermediate data products ) .",
    "these are organized in a directory structure and files that are described by the sdss - iii datamodel , which can be viewed at .",
    "the sas can be accessed at , with the top level for apogee raw data at , and the top level for apogee reduced data products at .",
    "abbreviated descriptions of the apogee project , instrument , software , and data products can be found on the sdss - iii dr12 web site ( ) and summary file descriptions can be found in the sdss - iii data model .",
    "the main products of the reduction pipeline are the reduced visit spectra , which are stored in apvisit files , and the reduced combined spectra , which are stored in apstar files .",
    "a webapp interface to download these for individual targets and bulk target lists is available at .",
    "otherwise , users can navigate their way through the sas directory structure to find individual files and intermediate data products .",
    "note that most of the image / spectra data products are multi - extension fits files , where the contents of the extensions are described in the datamodel . for idl users ,",
    "the sdss - iii apogeereduce software product contains a routine , apload.pro , that reads all of the extensions with a single command and stores the results in an idl data structure .",
    "parameters extracted from the spectra , along with object information , are stored in summary fits table files .",
    "the allvisit file contains information about individual visits , while the allstar file contains information from the combined spectra .",
    "these tables are also loaded in the the catalog archive server ( cas ) , a database with a web interface at .",
    "[ sec : datamodel ] the official apogee data model  defining the directory structure , filename convention , file formats , and header keywords  is available from .",
    "we have described the automated apogee data reduction pipeline .",
    "the basic steps are :    1 .   collapsing the 3d up - the - ramp data cube to a 2d image and removing cosmic rays .",
    "2 .   extraction of the 300 spectra from the 2d image and rough flux calibration .",
    "3 .   wavelength calibration , sky and telluric correction , combination of dither pairs , and absolute flux calibration .",
    "4 .   combination of visit spectra and radial velocity determination .",
    "* cosmic ray rejection : having up - the - ramp data gives us the ability to detect and remove most of the cosmic rays in our data . *",
    "dither combination : the apogee spectra are slightly undersampled and , therefore , apogee observations are taken as pairs with a half pixel spectral dither between them . these spectra are `` dither - combined '' with a sinc - interlace interpolation to create a single well - sampled spectrum .",
    "* model telluric correction : we fit fairly simple telluric absorption models to hot star spectra across the plate to derive `` scaling '' values for each telluric species .",
    "two - dimensional polynomial fits are then performed of the variations of these scalings across the plate and subsequently used to derive a model telluric absorption spectrum for each observed science spectrum .",
    "* iterative relative rv determination : we use the combined observed spectrum of each star as it s own rv template to derive precise relative rvs .",
    "this is performed in an iterative fashion since the relative rvs and the combined spectrum depend on each other .",
    "d.l.n . was supported by a mclaughlin fellowship at the university of michigan .",
    "sz.m . has been supported by the jnos bolyai research scholarship of the hungarian academy of sciences .",
    "c.a.p . is thankful to the spanish mineco for support through grant aya2014 - 56359-p .",
    "we thank the anonymous referee for useful comments that improved the manuscript .",
    "funding for sdss - iii has been provided by the alfred p. sloan foundation , the participating institutions , the national science foundation , and the u.s .",
    "department of energy office of science .",
    "the sdss - iii web site is http://www.sdss3.org/. sdss - iii is managed by the astrophysical research consortium for the participating institutions of the sdss - iii collaboration including the university of arizona , the brazilian participation group , brookhaven national laboratory , carnegie mellon university , university of florida , the french participation group , the german participation group , harvard university , the instituto de astrofisica de canarias , the michigan state / notre dame / jina participation group , johns hopkins university , lawrence berkeley national laboratory , max planck institute for astrophysics , max planck institute for extraterrestrial physics , new mexico state university , new york university , ohio state university , pennsylvania state university , university of portsmouth , princeton university , the spanish participation group , university of tokyo , university of utah , vanderbilt university , university of virginia , university of washington , and yale university .",
    "ahn , c.  p. , alexandroff , r. , allende prieto , c. , et al .",
    "2014 , , 211 , 17 ahn , c.  p. , alexandroff , r. , allende prieto , c. , et al .",
    "2015 , , submitted allard , f. , homeier , d. , & freytag , b. 2011 , in asp conf .",
    "448 , 16th cambridge workshop on cool stars , stellar systems , and the sun , ed . c. johns - krull , m. k. browning , & a. a. west ( san francisco , ca : asp ) , 91                              hubeny , i. , heap , s. r. , & lanz , t. 1998 , in astronomical society of the pacific conference series , vol . 131 , properties of hot luminous stars , ed . i. howarth , 108 hubeny , i. & lanz , t. 1995 , , 439 , 875 hubeny , i. , & lanz , t.  2011 , astrophysics source code library , 1109.022    koesterke , l. , allende prieto , c. , & lambert , d. l. 2008 , , 680 , 764 koesterke l. , 2009 , in hubeny i. , stone j. m. , macgregor k. , werner k. , eds , aip conf .",
    "ser . vol .",
    "1171 , recent directions in astrophysical quantitative spectroscopy and radiation hydrodynamics .",
    "phys . , new york , p.7 koesterke , l.  2012 , iac talks , astronomy and astrophysics seminars from the instituto de astrofsica de canarias , 375 kubik , b. , barbier , r. , castera , a. , et al .",
    "2014 , , 9154 , 91541q                  pence , w.  d. , seaman , r. , & white , r.  l.  2009 , , 121 , 414 pence , w.  d. , white , r.  l. , & seaman , r.  2010 , , 122 , 1065 rauscher , b.  j. , alexander , d. , brambora , c.  k. , et al .",
    "2007 , , 6690 , smith , r.  m. , zavodny , m. , rahmer , g. , & bonati , m.  2008a , , 7021 , 70210j-1 smith , r.  m. , zavodny , m. , rahmer , g. , & bonati , m.  2008b , , 7021 , 70210k-1 thomas , l.h .",
    "1949 , watson sci .",
    "lab report , columbia university , new york , ny wilson , j.c . , hearty , f. , skrutskie , m.f . ,",
    "et al . , 2012 , proc .",
    "spie , 8446 , 84460h"
  ],
  "abstract_text": [
    "<S> the apache point observatory galactic evolution experiment ( apogee ) , part of the sloan digital sky survey iii , explores the stellar populations of the milky way using the sloan 2.5-m telescope linked to a high resolution ( r@xmath022,500 ) , near - infrared ( 1.51 - 1.70 @xmath1 m ) spectrograph with 300 optical fibers . for over 150,000 predominantly red giant branch stars that apogee targeted across the galactic bulge , disks and halo , the collected high </S>",
    "<S> s / n ( @xmath2100 per half - resolution element ) spectra provide accurate ( @xmath00.1 ) radial velocities , stellar atmospheric parameters , and precise ( @xmath30.1 dex ) chemical abundances for about 15 chemical species . </S>",
    "<S> here we describe the basic apogee data reduction software that reduces multiple 3d raw data cubes into calibrated , well - sampled , combined 1d spectra , as implemented for the sdss - iii / apogee data releases ( dr10 , dr11 and dr12 ) . </S>",
    "<S> the processing of the near - ir spectral data of apogee presents some challenges for reduction , including automated sky subtraction and telluric correction over a 3diameter field and the combination of spectrally dithered spectra . </S>",
    "<S> we also discuss areas for future improvement . </S>"
  ]
}