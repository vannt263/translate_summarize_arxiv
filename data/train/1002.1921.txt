{
  "article_text": [
    "the fundamental problem of graph symmetry perception arises in numerous areas of chemistry and physics . in this",
    "context molecules are modelled by graphs where the vertices represent atoms and the edges represent bonds .",
    "the aim is to find equivalence classes of `` elements '' ( e.g.  vertices , edges , pairs of vertices , subgraphs etc . ) of the graph , or more rigorously , the orbits of the action of the automorphism group @xmath7 of the graph @xmath4 on the set of all `` elements '' of a considered `` mode '' ( for example the orbits of @xmath7 on the set of vertices ) .",
    "it is clear that in order to use such a statement one has to get at some intermediate stage a convenient description of @xmath7 .",
    "however , usually chemists avoid the computation of @xmath7 , preferring to use certain invariants in order to get a classification of `` elements '' of the graph .",
    "let us express the above claim more accurately for the case of vertices .",
    "a vertex invariant in a graph @xmath4 is a property or a parameter of vertices which is preserved by any of its automorphisms , i.e. the property does not depend on the labelling of the graph .",
    "let @xmath9 be a function which is defined on the set of all vertices of @xmath4 .",
    "then @xmath9  is an invariant of vertices if @xmath10 whenever the vertices @xmath11 , @xmath12 belong to the same orbit of @xmath7 .",
    "let us now consider a certain invariant ( a set of invariants ) .",
    "then we may define that two vertices belong to the same equivalency class if and only if they have the same value of the invariant ( invariants ) being taken into account .",
    "whatever the classification approach , the resulting partition can not be finer than the partition into the orbits of the automorphism group ( the automorphism partition ) .    from an algorithmic point of view",
    "the main goal in classification of vertices is to find an algorithm which ensures to produce the automorphism partition of a graph and which is known to be theoretically efficient ( this means that the running time is restricted by a polynomial in the size of the input ) .",
    "however , all known polynomial time methods for the automorphism partitioning problem yield heuristic solutions , i.e.   they result in partitions where the equivalence classes are orbits or unions of orbits .",
    "it is well known ( see e.g.  @xcite ,  @xcite ) that the automorphism partitioning problem ( which is strongly related to the problem of graph symmetry ) is algorithmically equivalent to the graph isomorphism problem ( the problem of graph identification ) in the following sense .",
    "assume that a polynomial algorithm is given solving one of the two problems .",
    "then it is possible to construct from this algorithm a second polynomial algorithm which solves the other problem .",
    "however , both problems seem to be hard from a computational point of view . therefore heuristic approaches are still considered as practically helpful .",
    "the simplest of these approaches are restricted to a classification of vertices ( in chemical terms they determine atom equivalence only ) and are based on different techniques , often applied iteratively , using the valencies of the vertices .",
    "the major weakness of these methods is that they will not give any partition for regular graphs ( graphs where all vertices have the same valencies ) .",
    "for that reason it seems quite natural to extend these techniques to a classification of vertices and edges ( i.e.  atoms and pairs of atoms ) .",
    "now , not only configurations of two vertices ( which define the valencies ) but also configurations consisting of three vertices have to be considered . this is exactly the basic idea of the algorithm of weisfeiler and leman .",
    "it partitions all vertices and ordered pairs of vertices of a graph by examining all ordered triples of vertices .",
    "this approach turns out to be the most powerful method in some class of graph symmetry perception algorithms .",
    "the algebraic object which is constructed in this way and which has been introduced by weisfeiler and leman in @xcite is a cellular algebra .",
    "it is an invariant of the underlying graph . under a different point of view",
    "( without any relation to the automorphism partitioning problem ) this object has also been found and called coherent configuration by higman in @xcite . in greater detail ,",
    "weisfeiler - leman s approach was described ( in english ) in @xcite . however , during approximately twenty years , their ideas were completely unknown and neglected in mathematical chemistry . nowadays , the approach itself and its interrelations with the identification and symmetry perception of graphs are rather familiar to the experts in algebraic combinatorics ( see e.g.  @xcite , @xcite , @xcite , @xcite , @xcite , @xcite ) , however a careful investigation of its abilities still remains a topical problem .",
    "more or less the same as weisfeiler - leman s approach was independently elaborated by g.  tinhofer ( partly in joint work with his student j.  hinteregger ) in @xcite and @xcite , however without explicitly describing the resulting algebraic object . in 1989 ,",
    "ch .  and g.  rcker ( a chemist and a mathematician ) realized the necessity of having a method for the partition of atom pairs , and produced a heuristic computer program for that purpose by simple reasoning without using any group theoretical machinery @xcite , @xcite , @xcite .",
    "the main purpose of our paper is not only to draw attention to the algorithm of weisfeiler and leman but , mainly , to present a good and practical program implementation . to our knowledge ,",
    "no such implementation exists up to now .",
    "only few attempts were made in the past .",
    "a first version of our program has been described by i.v .",
    "chuvaeva , m.  klin and d.v .",
    "pasechnik in @xcite . by means of a very careful revision we now realized all advantages and disadvantages of this implementation .",
    "recently , l.  babel established in @xcite the theoretical complexity of the weisfeiler - leman algorithm and , using these considerations , also created a computer program .",
    "a detailed description is given in @xcite .",
    "our common experiences ( including some important suggestions of ch .",
    "pech ) enabled us to modify the version of the program by chuvaeva et al .  into a very fast program implementation .",
    "a comparison with the program of babel et al .",
    "shows that our program , although inferior with respect to theoretical complexity , is much more efficient from a practical point of view .",
    "this paper is organized as follows . in section 2",
    "we introduce the standard terminology and some basic definitions .",
    "after that a brief survey on previous approaches to graph stabilization is given in section 3 .",
    "section 4 contains the definitions of a cellular algebra and related algebraic objects , states some important properties and interpretations and introduces the cellular algebra which is associated to a given graph . in section 5 an algebraic description of the algorithm of weisfeiler and leman",
    "is presented , followed in section 6 by a more illustrating combinatorial interpretation .",
    "thus , the algorithm is exposed from two different points of view , the first using matrix notation , the second using graph theoretical notation .",
    "sections 7 and 8 give a description of the program implementation and an estimation of its complexity .",
    "furthermore , in a brief excursion we present the main ideas of the complexity considerations and of the implementation of babel s algorithm . finally , in section 9 , extended testing of our program on a large number of examples is documented in order to demonstrate its capability .",
    "we conclude with a discussion in section 10 .",
    "this work is the second contribution in a series of papers @xcite , @xcite concerning different aspects of algebraic combinatorics with emphasis on applications in mathematical chemistry .",
    "the series introduces the basic concepts of algebraic combinatorics and presents some of the main features and tools for perception of symmetry properties of combinatorial objects . those readers who are not familiar with mathematical standard definitions and notations such as matrix , group , basis , equivalence class , etc .",
    "are referred to the first paper @xcite in this series .",
    "however , we tried to make this work as self - contained as possible and hope that it should be understandable for readers with a rather limited knowledge of mathematics .",
    "the present version almost fully coincides with @xcite , see section  [ sect : disc ] for more details .",
    "an _ undirected graph _ is a pair @xmath13 consisting of finite sets @xmath14 and @xmath15 , the _ vertices _ and the _ edges_. each edge connects two different vertices @xmath16 and @xmath17 from @xmath14 and is denoted by @xmath18 .",
    "this means that each element from @xmath15 is an unordered pair of different vertices from @xmath14 .",
    "a _ directed graph _ is a pair @xmath19 with vertex set @xmath14 and _ arc set _ @xmath20 , where each arc , denoted by @xmath21 , links two different vertices @xmath16 and @xmath17 and additionally is assigned a direction , namely from @xmath16 to @xmath17 .",
    "each element of @xmath20 is an ordered pair of different vertices from @xmath14 .",
    "if a vertex @xmath16 belongs to an edge or an arc then @xmath16 is said to be _ incident _ to the edge or arc .",
    "often it is convenient or useful to consider an undirected graph @xmath4 as a directed graph @xmath22 with each edge @xmath18 replaced by two arcs @xmath21 and @xmath23 .",
    "usually , a directed or undirected graph is given either by its diagram or by its adjacency matrix .",
    "a _ diagram _ is a drawing on the plane consisting of small circles which represent the vertices and lines between pairs of vertices which represent the edges .",
    "an arc @xmath21 is indicated by an arrow starting in vertex @xmath16 and ending in vertex @xmath17 .",
    "a more abstract representation is the _ ( 0,1)-adjacency matrix _ @xmath24 . in order to make evident that the matrix @xmath0 represents a graph @xmath4 ,",
    "we will also write @xmath25 . the rows and columns of @xmath0 are indexed by the elements of @xmath14 , which for sake of simplicity are often numbered by @xmath26 with @xmath27 ( or , as for example in the computer package coco , see below , by numbers @xmath28 ) .",
    "thus , @xmath0 is a @xmath29matrix .",
    "the entry @xmath30 is equal to @xmath31 if the edge @xmath18 , respectively the arc @xmath21 , exists and @xmath32 otherwise .",
    "note that the ( 0,1)-adjacency matrix of an undirected graph is symmetric with respect to the main diagonal , whereas in general this is not the case for directed graphs .",
    "sometimes it is necessary to deal with ( undirected or directed ) multigraphs . in a _ multigraph _ each pair of vertices may be connected by more than one edge or arc .",
    "the number of edges resp .",
    "arcs between two vertices is called the _ multiplicity _ of the edge resp .  arc . in the diagram",
    "multiple edges are drawn as parallel lines , multiple arcs as parallel arrows , in the _ adjacency matrix _ the entry @xmath30 denotes the multiplicity of the edge or arc connecting @xmath16 and @xmath17 .",
    "the _ complete directed graph _ is the graph with @xmath1 vertices where all @xmath33 arcs are present .    for certain purposes",
    "it is more convenient to consider graphs with _ loops_. a loop is an arc connecting a vertex with itself . in this sense ,",
    "a complete directed graph with loops has @xmath34 arcs .",
    "in particular , there is one additional arc @xmath35 for each vertex @xmath16 .",
    "the main advantage is that vertices can be identified with the corresponding loops , which considerably simplifies our notation .",
    "the most general notion of a graph is the colored graph .    in",
    "a _ colored _ complete directed graph @xmath22 all vertices and all arcs are assigned colors in such a way that the colors of the vertices are different from the colors of the arcs .",
    "assume that @xmath36 are the colors of the vertices and let @xmath37 denote the vertices which are assigned color @xmath38 .",
    "then @xmath39 is a partition of the vertex set of @xmath22 .",
    "similarly , if @xmath40 are the colors of the arcs and @xmath41 denotes the arcs of color @xmath42 then @xmath43 is a partition of the arc set of @xmath22 .",
    "each colored complete directed graph can be represented by its adjacency matrix @xmath24 which contains in the @xmath16th row and @xmath17th column the color of the arc @xmath21 , that means @xmath44 if and only if @xmath45 . the entry in the @xmath16th row and @xmath16th column is the color of the vertex @xmath16 , thus @xmath46 if and only if @xmath47 .",
    "obviously , any undirected or directed graph can be considered as a colored complete directed graph with three colors .",
    "the vertices are assigned color @xmath32 , the edges ( arcs ) and nonedges ( nonarcs ) are assigned colors @xmath31 and @xmath48 . in the case of a multigraph , different colors of arcs correspond to different multiplicities . in this sense ,",
    "any chemical structure can be seen as a colored complete graph .",
    "the colors @xmath49 can be interpreted as modes of vertices , for example names of atoms in a molecular graph , the colors @xmath30 reflect the multiplicity of bonds or symbolize certain chains of atoms .",
    "figure 1 shows a chemical structure and the adjacency matrix @xmath0 of the corresponding colored complete directed graph ( interesting properties of this compound are discussed in @xcite ) is given below ; here 0 , 1 , 2 , 3 stands for the atoms of c , n , o , h respectively , 4 denotes usual bond , 5 double bond , all other pairs of atoms are denoted by 6 , upper superscripts denote the labels of atoms .    #",
    "1#2#3#4#5 @font    ( 4200,5295)(6901,-6100 ) ( 8216,-4082 ) ( 1,-1)675 ( 8263,-4037 ) ( 1,-1)675 ( 8340,-2828 ) ( 1 , 1)592 ( 8381,-2868 ) ( 1 , 1)592.500 ( 9151,-2236 ) ( 1,-1)675 ( 9826,-4036)(-1,-1)600 ( 8101,-3736 ) ( 0 , 1)600 ( 9976,-3136 ) ( 0,-1)600 ( 9901,-3136 ) ( 0,-1)600 ( 10051,-4036 ) ( 1,-1)375 ( 10787,-4561 ) ( 1 , 0)239 ( 10779,-4486 ) ( 1 , 0)247 ( 10501,-4636 ) ( 0,-1)300 ( 10576,-5011)(6.6667,10.0000 ) . ( 10576,-4636 ) ( 0,-1)300 ( 9049,-4970 ) ( 0,-1)255 ( 9049,-5563 ) ( 0,-1)255 ( 8026,-4036)(-1,-1)324 ( 7426,-4561)(-1 , 0)331 ( 7426,-4486)(-1 , 0)324 ( 7501,-4636 ) ( 0,-1)317 ( 7576,-4636 ) ( 0,-1)317 ( 10159,-2803 ) ( 1 , 1)267 ( 9076,-1945 ) ( 0 , 1)309 ( 8926,-1411)(-1 , 1)375 ( 8977,-1351)(-1 , 1)375 ( 8026,-2911)(-1 , 1)375 ( 9226,-1336 ) ( 1 , 1)300 ( 9274,-1392 ) ( 1 , 1)300 ( 9001,-2161)(0,0)[lb ] ( 9901,-3061)(0,0)[lb ] ( 9901,-3961)(0,0)[lb ] ( 9001,-4861)(0,0)[lb ] ( 8101,-3961)(0,0)[lb ] ( 8101,-3061)(0,0)[lb ] ( 9001,-1561)(0,0)[lb ] ( 9601,-961)(0,0)[lb ] ( 8401,-961)(0,0)[lb ] ( 10501,-2461)(0,0)[lb ] ( 10501,-4561)(0,0)[lb ] ( 11101,-4561)(0,0)[lb ] ( 10501,-5161)(0,0)[lb ] ( 9001,-5461)(0,0)[lb ] ( 9001,-6061)(0,0)[lb ] ( 7501,-4561)(0,0)[lb ] ( 6901,-4561)(0,0)[lb ] ( 7501,-5161)(0,0)[lb ] ( 7501,-2461)(0,0)[lb ]    figure 1    @xmath50    a _ permutation _ @xmath51 acting on a finite set @xmath14 is a bijective mapping from @xmath14 onto itself . for each permutation @xmath51",
    "we denote by @xmath52 the image @xmath17 of an element @xmath53 .",
    "let @xmath54 be the _ symmetric group _ of _ degree _",
    "@xmath1 , i.e.  the group of all permutations acting on the set @xmath14 with @xmath27 .",
    "each subgroup @xmath55 of @xmath54 is called a _ permutation group _ of degree @xmath1 .",
    "the notation @xmath56 indicates that the permutation group @xmath55 acts on the set @xmath14 .",
    "an _ automorphism _ of a colored complete directed graph @xmath19 is a permutation @xmath57 on @xmath14 which preserves the colors of the vertices and arcs , i.e.  which fulfills @xmath58 and @xmath59 for all @xmath60 and all colors @xmath61 .",
    "it is easy to realize that the set of all automorphisms of a graph @xmath22 forms a group .",
    "this group is called the _ automorphism group _ of @xmath22 and is denoted by @xmath62 . clearly , @xmath63 is a permutation group acting on @xmath14 .",
    "let @xmath56 be a permutation group acting on @xmath14 . we define a binary relation @xmath64 on @xmath14 in such a way that @xmath65 holds for two elements @xmath60 if and only if there exists a permutation @xmath66 with @xmath67 .",
    "since @xmath56 is a group , the relation @xmath64 is an equivalence relation on @xmath14 , its equivalence classes are called _ orbits _ ( or _ 1-orbits _ ) of @xmath56 . the set _",
    "1-orb(g,@xmath14 ) _ of the orbits of @xmath56 forms a partition of the set @xmath14 .",
    "the _ automorphism partition _ of the vertex set @xmath14 of a colored complete directed graph @xmath22 is the set _",
    "1-orb(aut(@xmath22),@xmath14 ) _ of the orbits of its automorphism group . obviously , if two vertices @xmath16 and @xmath17 belong to the same 1-orbit , then there is an automorphism @xmath57 which maps @xmath16 onto @xmath17 . the _",
    "automorphism partitioning problem _ is the problem of finding the automorphism partition of a graph .",
    "to give an example , the bijective mapping @xmath57 on @xmath68 defined by @xmath69 is an automorphism of the colored complete directed graph @xmath22 which belongs to the structure in figure 1 .",
    "the automorphism partition of @xmath22 is @xmath70    a graph @xmath22 is called _ vertex - transitive _ if for any two vertices @xmath16 and @xmath17 there exists at least one automorphism such that @xmath67 .",
    "obviously , if a graph is vertex - transitive then its automorphism partition is trivial , meaning that there is exactly one orbit containing all vertices from @xmath14 .    commonly , a permutation @xmath51 on @xmath14 is represented by a so called _ permutation matrix _ @xmath71 .",
    "this @xmath29matrix has entries @xmath32 and @xmath31 with @xmath72 if and only if @xmath52 .",
    "it is easy to see that a permutation matrix has exactly one entry equal to @xmath31 in every row and in every column , all other entries are @xmath32 .",
    "in fact , this property is a necessary and sufficient condition for a matrix to be a permutation matrix . now",
    "the property of a permutation to be an automorphism of a graph can be reformulated in terms of matrices .",
    "namely , a permutation matrix @xmath73 determines an automorphism @xmath57 of @xmath22 if and only if @xmath73 commutes with the adjacency matrix @xmath0 of @xmath22 .",
    "this means that the equality @xmath74 holds .",
    "for example , let @xmath4 be the undirected graph depicted in figure 2 .    0.5 cm    ( 15,6.5 ) ( 2.1,2.5 ) ( 9.9,2.5 ) ( 6,0.5 ) ( 6,4.5 )    ( 6,0.75)(0,1)4 ( 2.3,2.7)(2,1)3.5 ( 2.3,2.3)(2,-1)3.5 ( 9.7,2.7)(-2,1)3.5 ( 9.7,2.3)(-2,-1)3.5    ( 1,2.25)@xmath31 ( 5.8,5.2)@xmath48 ( 10.7,2.25)@xmath75 ( 5.8,-0.85)@xmath76    figure 2    then @xmath77 is the adjacency matrix of the corresponding colored complete directed graph @xmath22 .",
    "the permutation @xmath57 of @xmath78 defined by @xmath79 , @xmath80 , @xmath81 and @xmath82 is an automorphism of @xmath22 with associated permutation matrix @xmath83    given a permutation group @xmath56 , let us now consider the set of permutation matrices @xmath84 .",
    "a graph @xmath22 is called _ invariant _ with respect to the permutation group @xmath56 if and only if its adjacency matrix commutes with all permutation matrices from @xmath85 .",
    "let us further consider the set @xmath86 of all @xmath87-matrices @xmath88 which commute with matrices from @xmath85 , i.e. @xmath89 @xmath86 is called the _ centralizer algebra _ of the permutation group @xmath56 ( the notation @xmath86 stems from the german word `` vertauschungsring '' , the use of which goes back to i. schur and h. wielandt ) .",
    "it is easy to realize that the set of nonnegative integer matrices @xmath88 from @xmath86 coincides with the set of adjacency matrices of multigraphs which are invariant with respect to @xmath56 .",
    "a centralizer algebra @xmath86 is known to have the following main properties :    \\(i ) @xmath86 can be considered as a linear space with basis @xmath90 , + where each @xmath91 is a @xmath92-matrix .",
    "\\(ii ) @xmath93 , where @xmath94 is the matrix with all entries equal to @xmath31 .",
    "\\(iii ) for every matrix @xmath91 there exists a matrix @xmath95 with @xmath96 , + where @xmath97 denotes the transposed matrix of @xmath91 .",
    "to each permutation group @xmath56 we can associate a new induced permutation group @xmath98 , where for @xmath99 and @xmath100 we define + @xmath101 .",
    "2-orb(g,@xmath14 ) _ be the set of orbits of the induced action of @xmath55 on @xmath102 .",
    "this partition of the set of all ordered pairs of elements of @xmath14 is called the partition into _",
    "2-orbits _ of @xmath56 .",
    "each member @xmath103 of this partition defines a graph @xmath104 with the adjacency matrix @xmath105 .",
    "it turns out that the matrices @xmath106 mentioned in ( i ) coincide with the latter adjacency matrices .",
    "more precisely , the basis matrices @xmath90 of the centralizer algebra @xmath86 correspond to the @xmath107orbits of the permutation group @xmath56 in the following manner .",
    "the @xmath108entry of the basis matrix @xmath91 is equal to @xmath31 if and only if @xmath21 belongs to the @xmath109-@xmath110 @xmath107orbit . in this sense ,",
    "the set of all @xmath107orbits can be represented very conveniently by a single matrix of the form @xmath111 .",
    "this means that two pairs @xmath21 and @xmath112 belong to the same @xmath107orbit if and only if the corresponding entries in the matrix @xmath0 are equal .",
    "let us consider as an example the set @xmath113 of permutations acting on the set @xmath114 .",
    "it can be easily proved that @xmath56 is a permutation group ( cf . 4.16 in @xcite ) .",
    "now consider the corresponding set of permutation matrices @xmath115",
    "@xmath116    it turns out ( cf .",
    "5.4 in @xcite ) that the centralizer algebra @xmath86 has the basis @xmath117 @xmath118 thus we obtain @xmath119    to our knowledge , b.yu .",
    "weisfeiler and a.a .",
    "leman were the first to consider the more general problem ( in comparison with the automorphism partition ) of finding the set of @xmath107orbits of @xmath120 for a given graph @xmath22 . in this setting",
    "the automorphism partition of a graph is a byproduct of the determination of the @xmath107orbits : the @xmath121orbit of a vertex @xmath16 is simply the @xmath107orbit of the pair @xmath35 ( for brevity , we will sometimes speak about the orbits of a graph , of a vertex , etc .",
    ", instead of the orbits of the automorphism group of the graph ) .    in the following it will be our goal to determine the @xmath107orbits of a given graph or , equivalently , to find the @xmath107orbit matrix @xmath0 .",
    "first attempts to attack the automorphism partitioning problem date back approximately thirty years .",
    "all these approaches try to find the @xmath121orbits of a given graph . usually , the classical paper @xcite by h.l .",
    "morgan is considered to be the first procedure for graph stabilization . given an undirected graph @xmath13 , the idea is to start with a partition of the vertex set @xmath14 according to the valencies .",
    "the _ valency _ of a vertex @xmath16 is the number of edges which are incident to @xmath16 .",
    "two vertices @xmath16 and @xmath17 are put into the same class of the partition if and only if they have equal valencies . then this partition is refined iteratively using the extended valencies .",
    "the _ extended valency _ of @xmath16 is defined as the sum of the previous extended valencies of all _ neighbours _ of @xmath16 , i.e.  of all vertices which are connected with @xmath16 by an edge . again",
    "two vertices are put into the same class of the partition if and only if they have equal extended valencies .",
    "this iteration procedure terminates as soon as the _ stable partition _ is reached , that is the next partition coincides with the previous one .",
    "years later it has been recognized that morgan s approach is just a special case of _ stabilization of depth 2_. this technique works as follows .",
    "assume that we have a partition @xmath122 of the vertex set @xmath14 of @xmath4 according to the valencies . assume further that this partition is numbered such that @xmath123 contains the vertices of smallest valency , @xmath124 the vertices of second smallest valency , etc .",
    "now for each vertex @xmath53 we compute a list of length @xmath125 which contains the valencies of @xmath16 with respect to each class @xmath37 ( that means the number of edges connecting @xmath16 with vertices from @xmath37 ) , @xmath126 .",
    "each class @xmath37 may now be partitioned into subclasses , each consisting of vertices with equal lists . in this way",
    "we may eventually obtain a refinement of the original partition .",
    "if this is the case , then the subclasses are numbered according to the lexicographical ordering of the corresponding lists .",
    "then we restart the same proceeding with the refined partition .",
    "if in each class the lists of the vertices are identical , then no further refinement is obtained and the procedure stops .    the resulting partition of @xmath14 is commonly called the _ total degree partition _ of the graph @xmath4 ( see e.g.  @xcite ) .",
    "it is the coarsest partition @xmath122 of @xmath14 with the property that every two vertices belonging to the same cell @xmath37 have the same valencies with respect to any other cell @xmath127 , @xmath128 included ( the coarsest equitable partition of @xmath4 in the sense of @xcite ) .",
    "the total degree partition can not be finer than the automorphism partition , since , obviously , a necessary condition for two vertices @xmath16 and @xmath17 to belong to the same @xmath121orbit of @xmath129 is that they belong to the same class of the total degree partition .",
    "in fact , every class of the total degree partition is a union of @xmath121orbits .",
    "figure 3 shows a graph where the total degree partition consists of one class only , namely @xmath14 , but which is not vertex - transitive , i.e.  the automorphism partition consists of more than one @xmath121orbit .",
    "this example makes evident the weakness of the above kind of stabilization .",
    "the method will not give any partition for _ regular _ graphs ( graphs where all vertices have the same valencies ) , not even in the case when @xmath129 is the trivial group consisting of the identity only ( what means that each @xmath121orbit consists of a single vertex ) .",
    "the reader will recognize in figure 3 _ `` cuneane '' _ , cf . 4.26 and 5.8 in @xcite .    # 1#2#3#4#5 @font    ( 3176,2680)(2608,-7884 ) ( 4201,-6061 ) ( 4801,-5461 ) ( 5701,-5761 ) ( 5101,-6361 ) ( 4801,-7561 ) ( 3301,-7561 ) ( 2701,-6361 ) ( 3301,-5761 ) ( 3301,-5761 ) ( 5 , 1)1500 ( 4801,-5461 ) ( 3,-1)900 ( 5701,-5761)(-1,-1)600 ( 5101,-6361)(-3 , 1)900 ( 4201,-6061)(-5,-1)1500 ( 2701,-6361 ) ( 1 , 1)600 ( 3301,-5761 ) ( 0,-1)1800 ( 3301,-7561 ) ( 1 , 0)1500 ( 4801,-7561 ) ( 1 , 4)300 ( 4801,-7561 ) ( 1 , 2)900 ( 2701,-6361 ) ( 1,-2)600 ( 4201,-6061 ) ( 1 , 1)600 ( 3223,-5607)(0,0)[lb ] ( 4748,-5312)(0,0)[lb ] ( 5653,-5592)(0,0)[lb ] ( 5013,-6222)(0,0)[lb ] ( 4103,-5932)(0,0)[lb ] ( 2608,-6232)(0,0)[lb ] ( 3233,-7837)(0,0)[lb ] ( 4778,-7857)(0,0)[lb ]    figure 3",
    "as already mentioned in the introduction , the problem of the recognition of graph symmetry can be made more precise in mathematical language as an automorphism partitioning problem ; the problem of graph identification corresponds to an isomorphism problem .",
    "let us give a precise mathematical statement of the latter problem .",
    "an _ isomorphism _ from a graph @xmath13 to a graph @xmath130 is a bijective mapping @xmath131 from @xmath14 to @xmath132 such that @xmath133 if and only if @xmath134 .",
    "if such a mapping exists then @xmath4 and @xmath135 are called _",
    "isomorphic_. obviously , if @xmath136 then an isomorphism coincides with an automorphism .",
    "the _ isomorphism problem _ is the problem of deciding whether two graphs are isomorphic or not .",
    "similarly as for the automorphism problem there is also a matrix formulation for the isomorphism problem .",
    "namely , two graphs @xmath4 and @xmath135 with adjacency matrices @xmath0 resp .",
    "@xmath137 are isomorphic if and only if there exists a permutation matrix @xmath73 with @xmath138 if this equality is multiplied from the left with the inverse @xmath139 of @xmath73 then , using the fact that @xmath140 holds for each permutation matrix @xmath73 , we obtain @xmath141 this modified equality can be interpreted in the following way .",
    "the matrix @xmath0 is obtainable from the matrix @xmath137 by permuting simultaneously rows and columns .",
    "this corresponds just to a renumbering of the vertices .",
    "g.  tinhofer has found a very interesting algebraic characterization of total degree partitions . he first relaxed the notion of an isomorphism between two graphs @xmath4 and @xmath135 using doubly stochastic matrices .",
    "a matrix @xmath142 is _ doubly stochastic _ if the entries of @xmath142 are nonnegative and the sum of the entries in each row and in each column is equal to @xmath31 .",
    "note that every permutation matrix is doubly stochastic .",
    "now let again @xmath0 and @xmath137 be the adjacency matrices of @xmath4 resp .",
    "then the two graphs are called _ doubly stochastic isomorphic _ if and only if there exists a doubly stochastic matrix @xmath142 fulfilling the equality @xmath143 of course , two isomorphic graphs are also doubly stochastic isomorphic , however , the converse direction is not true in general .",
    "for example , the graphs @xmath4 and @xmath135 of figure 4 are doubly stochastic isomorphic ( choose @xmath144 ) , but they are not isomorphic .    0.5 cm    ( 15,6.5 ) ( -0.5,2.25)@xmath4 ( 3,2.5 ) ( 5,0.5 ) ( 5,4.5 ) ( 7.5,0.5 )",
    "( 7.5,4.5 ) ( 9.5,2.5 )    ( 3.2,2.7)(1,1)1.8 ( 3.2,2.3)(1,-1)1.8 ( 5.25,4.5)(1,0)2.25 ( 5.25,0.5)(1,0)2.25 ( 9.3,2.7)(-1,1)1.8 ( 9.3,2.3)(-1,-1)1.8    ( 1.95,2.25)@xmath31 ( 4.8,5.2)@xmath48 ( 7.3,5.2)@xmath75 ( 10.2 , 2.25)@xmath76 ( 7.3,-0.65)@xmath145 ( 4.8,-0.65)@xmath146    ( 14.5,2.25)@xmath135 ( 18,2.5 ) ( 20,0.5 ) ( 20,4.5 ) ( 22.5,0.5 ) ( 22.5,4.5 ) ( 24.5,2.5 )    ( 18.2,2.7)(1,1)1.8 ( 18.2,2.3)(1,-1)1.8 ( 20,0.75)(0,1)3.5 ( 22.5,0.75)(0,1)3.5 ( 24.3,2.7)(-1,1)1.8 ( 24.3,2.3)(-1,-1)1.8    ( 16.95,2.25)@xmath31 ( 19.8,5.2)@xmath48 ( 22.3,5.2)@xmath75 ( 25.2,2.25)@xmath76 ( 22.3,-0.65)@xmath145 ( 19.8,-0.65)@xmath146    figure 4    tinhofer proved in @xcite that two graphs are doubly stochastic isomorphic if and only if they have identical total degree partitions . to be more precise , the total degree partitions @xmath122 of @xmath13 and @xmath147 of @xmath130 are identical , if @xmath148 , @xmath149 and , for each pair of vertices @xmath47 and @xmath150 , the valency of @xmath16 with respect to @xmath127 is equal to the valency of @xmath151 with respect to @xmath152 , @xmath153 .    the shortcoming of the total degree partition , as pointed out above , motivated the construction of more powerful algorithms for graph stabilization .",
    "a well known approach is to apply the refinement technique , which has already been used for the computation of the total degree partition , by replacing the valencies of the vertices by other invariants of the graph .",
    "for example , for each vertex @xmath16 we may count the number of cycles of a given length which contain @xmath16 , the number and sizes of cliques containing @xmath16 , etc .",
    "however , finding cycles or cliques in a graph is an extremely difficult task which , in general , requires time exponential in the size of the graph .",
    "therefore , we should use a criterion which is easy to check .",
    "a reasonable approach is to consider not only configurations consisting of two vertices , i.e.  the edges and nonedges ( which define the valencies ) , but to examine also configurations consisting of three vertices , i.e.  all triples of vertices .",
    "this procedure is commonly called _ stabilization of depth @xmath75_. the algorithm of weisfeiler and leman , which will be formulated and discussed in great detail in sections 5 and 6 , is based on that principle .",
    "we have seen above that stabilization of depth 2 can be associated with a certain combinatorial object , namely with the total degree partition of the graph under consideration .",
    "this immediately implies the question whether there is a similar object which belongs to stabilization of depth 3 .",
    "it turns out that such an object really exists .",
    "moreover , this object has not only a combinatorial but also a very interesting algebraic description .",
    "the details are exposed in the next section .",
    "a _ matrix algebra _ of _ degree _",
    "@xmath1 is a set of @xmath29matrices which is closed under matrix addition , matrix multiplication and multiplication of a matrix by a scalar , i.e.  if @xmath142 and @xmath154 belong to the matrix algebra and @xmath155 is any real number , then also @xmath156 , @xmath157 and @xmath158 belong to the matrix algebra .    a _ cellular _ ( or _ coherent _ ) _ algebra _ is a matrix algebra which additionally is closed under schur - hadamard ( = componentwise ) multiplication of matrices and under matrix transposition , and which contains the identity matrix @xmath159 and the matrix @xmath94 all entries of which are equal to 1 .",
    "we will denote the schur - hadamard product of two matrices @xmath142 and @xmath154 by @xmath160 .",
    "thus , if @xmath161 and @xmath162 then @xmath163 .",
    "each cellular algebra @xmath164 has a basis @xmath165 ( basis of the vector space @xmath164 ) consisting of @xmath92-matrices which is called _ standard basis _ of @xmath164 , @xmath166 is the _ rank _ of @xmath164 .",
    "it is not hard to see that a standard basis @xmath90 , if suitably numbered , satisfies the following properties :    \\(i ) @xmath93    \\(ii ) @xmath167 for some @xmath168 with @xmath169    \\(iii ) @xmath170    \\(iv ) for each @xmath171 there is a @xmath172 such that @xmath173    \\(v ) for each pair @xmath174 we have    @xmath175 .",
    "a cellular algebra @xmath164 with standard basis @xmath90 can be represented in a very convenient way using the matrix @xmath176 , called the _ adjacency matrix of the cellular algebra _ @xmath164 .",
    "this matrix is unique up to the numbering of the basis matrices .",
    "the nonnegative integers @xmath177 are called the _ structure constants _ of @xmath164 .",
    "these numbers have a very nice geometric interpretation .",
    "we consider the colored complete directed graph @xmath19 which belongs to the adjacency matrix of @xmath164 . for our purposes , it is very convenient to identify each vertex @xmath16 in @xmath22 with the corresponding loop @xmath35 , i.e.  we deal with the complete directed graph with loops .",
    "then the matrices @xmath178 correspond in a natural way to the arc sets @xmath41 of color @xmath42 ( the first @xmath168 matrices of the standard basis virtually represent the vertices of @xmath22 ; the induced partition of the vertex set is called the _ standard partition _ of the graph ) .",
    "an arc @xmath21 has color @xmath42 if and only if the matrix @xmath178 has entry @xmath31 in the @xmath16th row and @xmath17th column .",
    "the entry @xmath21 in the matrix @xmath179 is the number of directed paths of length @xmath48 from vertex @xmath16 to vertex @xmath17 , such that the first step is an arc of color @xmath109 and the second step is an arc of color @xmath38 .",
    "the decomposition ( v ) implies that for any arc @xmath21 of a fixed color @xmath42 the number of paths of length @xmath48 from @xmath16 to @xmath17 , such that the first step is of color @xmath109 and the second step is of color @xmath38 , is the same and equal to @xmath177 ( see figure 5 ) .",
    "in fact , if @xmath90 fulfill ( i)-(iv ) , then this condition is sufficient for these matrices to be the standard basis of a cellular algebra .    0.5 cm    ( 15,7 ) ( 12,0 ) ( 20,0 ) ( 16,4 )    ( 12.25,0)(1,0)7.5 ( 12.2,0.15)(1,1)3.6 ( 16.2,3.85)(1,-1)3.6    ( 10.7,-0.2)@xmath16 ( 21,-0.2)@xmath17 ( 15.7,5)@xmath180 ( 15.8,-1)@xmath42 ( 13.3,2.2)@xmath109 ( 18.7,2.2)@xmath38    figure 5    it is not hard to see ( see @xcite ) that each centralizer algebra is also a cellular algebra ( therefore , the matrix @xmath0 given at the end of section 2 represents a cellular algebra of rank 6 with standard basis @xmath181 ) .",
    "let @xmath164 be a cellular algebra .",
    "if a group with the centralizer algebra @xmath164 exists then the cellular algebra @xmath164 is called _ schurian _ , after i.  schur , who was the first to investigate cellular algebras ( actually he was using a different terminology of group rings , see @xcite for details ) .",
    "the importance of schurian cellular algebras stems from the fact that , as already indicated in section 2 , its basis matrices correspond to the @xmath107orbits .",
    "moreover , the diagonal matrices of the basis correspond to the @xmath121orbits .    given any @xmath29matrix @xmath142 , the _ cellular algebra @xmath182 generated by _",
    "@xmath142 is defined to be the _",
    "smallest _ cellular algebra which contains @xmath142 .",
    "it is important to know that this definition is rigorous .",
    "that means the resulting algebra is well defined and unique ( for a detailed explanation see @xcite ) . as a consequence , we are able to associate with each graph @xmath4 a matrix algebra , namely the cellular algebra @xmath2 which is generated by the adjacency matrix @xmath0 of @xmath4 .",
    "we will also write @xmath6 in order to indicate that the cellular algebra corresponds to the graph @xmath4 .",
    "there are a number of graph classes whose associated cellular algebras are schurian ( for example graphs with a simple spectrum @xcite ) . for those graphs",
    "the automorphism partition can be immediately deduced from the cellular algebra .",
    "namely , in this case the automorphism partition coincides with the standard partition .",
    "unfortunately , this is not the case in general .",
    "the simplest counterexamples can be found among strongly regular graphs .",
    "an undirected graph is called _ strongly regular _ ( see @xcite ) if the standard basis of the associated cellular algebra consists only of @xmath75 matrices .",
    "the first such examples of non - schurian cellular algebras of rank 3 were found by h.   wielandt @xcite , l.c .",
    "chang @xcite , s.s .",
    "shrikhande @xcite and g.m .",
    "adelson - velski et  al .",
    "all these graphs have rather large automorphism groups .",
    "later on , collaborators of weisfeiler found an example with the identity automorphism group ( see @xcite ) .    nevertheless ,",
    "although we can not guarantee that we get the @xmath121orbits and @xmath107orbits for each graph , extended practical experience indicates that the results obtained by the cellular algebras are sufficient , in particular for practically all chemical graphs .",
    "this is confirmed by the computational results which are presented in section 9 .",
    "the representation of a cellular algebra as a colored complete directed graph and the interpretation of the structure constants @xmath177 shows that in a cellular algebra implicitly all configurations of a graph consisting of three vertices are considered . in other words ,",
    "the cellular algebra is the algebraic object which is associated to stabilization of depth @xmath75 .    at the end of this section ,",
    "let us give a precise statement of the problem which now has to be solved .",
    "given a graph @xmath4 , we actually deal with two closely related problems .",
    "compute the basis @xmath90 of the cellular algebra @xmath6 ( or in other words the colored complete graph @xmath22 which is associated to the cellular algebra @xmath6 ) .    construct the colored complete graph @xmath22 with the structure constants @xmath177 .    in the next section we give an algebraic description of the algorithm of weisfeiler - leman which settles problem 1 . in section 6",
    "we present a very illustrative graph theoretical interpretation which solves problem 2 .",
    "b.  weisfeiler and a.  leman were the first to show that the cellular algebra of a graph can be computed in polynomial time .",
    "the proposed method , firstly described in russian in the paper @xcite , has as input any matrix @xmath0 ( the adjacency matrix of a graph @xmath4 ) and as output a basis of the cellular algebra @xmath2 generated by @xmath0 .",
    "the initial description of the algorithm was too sophisticated , clearer ones are given in the english written book @xcite , and also in @xcite and @xcite .",
    "we will first explain the main features of the algorithm by combining all these ideas , illustrate it by an example , and then present a formal description .",
    "the construction of the cellular algebra @xmath2 proceeds iteratively .",
    "we start with the adjacency matrix @xmath24 of an undirected or directed graph @xmath4 ( the diagonal entries are set to be different from the nondiagonal entries ) .",
    "this matrix can be written in the form @xmath183 where @xmath91 are @xmath184matrices with @xmath108entry equal to @xmath31 if and only if @xmath185 . at the end of each iteration",
    "we obtain a new set of @xmath184matrices @xmath186 which fulfills the properties ( i)-(iv ) of a cellular algebra as stated in section 4 , but which may fail property ( v ) . in particular , this means that @xmath186 is the basis of a linear subspace @xmath187 which is closed under schur - hadamard multiplication and transposition and which contains the identity matrix @xmath159 and the all 1 matrix @xmath94 . note that this also holds at the beginning of the procedure in case @xmath0 is symmetric and the values of the diagonal entries are different from all other entries .",
    "initially , the linear subspace @xmath187 with basis matrices @xmath90 will not fulfill property ( v ) of a cellular algebra , i.e.  @xmath187 will not be closed with respect to matrix multiplication .",
    "it is easy to see that @xmath187 contains all products of matrices from @xmath187 if and only if it contains all products @xmath179 of basis matrices .",
    "therefore , we consider in each iteration the linear subspace which is generated by all these products @xmath188 and compute a basis of @xmath184matrices for it .",
    "this process is repeated until it is stable , this means the basis of the actual iteration coincides with the basis of the previous iteration ( up to the numbering of the basis matrices ) . in that case",
    "the subspace @xmath187 is closed under matrix multiplication , property ( v ) is satisfied and , consequently , @xmath187 is a cellular algebra .",
    "a straightforward method to construct the basis @xmath186 of a linear subspace @xmath187 which is generated by some set of matrices @xmath189 ( in our case this is just the set @xmath190 @xmath191 ) and which is closed under schur - hadamard multiplication is described in the paper @xcite .",
    "let @xmath192 .",
    "if @xmath193 then set @xmath194 for @xmath195 and repeat the procedure . assume that @xmath196 and let @xmath197 be a nonzero entry of @xmath88 .",
    "set @xmath198 to be the @xmath184matrix such that @xmath199 if and only if @xmath200 .",
    "let @xmath201 .",
    "if @xmath202 then let @xmath203 be a @xmath184matrix as constructed above . now let @xmath204 and repeat the procedure .",
    "if @xmath193 then let @xmath205 and repeat the procedure .",
    "the last @xmath184matrix @xmath203 will be the first element @xmath206 in the basis of @xmath187 .",
    "let @xmath207 , @xmath195 and repeat the procedure . in this way we obtain a set @xmath186 of @xmath184matrices fulfilling property ( iii ) .",
    "this procedure can be formulated in a more compact and convenient way ( which in fact was the original way used by weisfeiler ",
    "leman ) by introducing indeterminates @xmath208 , @xmath209 , which can be considered to represent the different entries of an adjacency matrix . in this sense",
    ", the matrix @xmath210 represents the adjacency matrix .",
    "since matrix multiplication is a noncommutative operation , it is important in the following to assume that the indeterminants are noncommuting with respect to multiplication , i.e.  @xmath211 .",
    "now compute the product @xmath212 .",
    "each entry of this matrix is a sum of products @xmath213 . in order to obtain the basis of @xmath187 we replace equal entries in @xmath88 by new indeterminates @xmath214 .",
    "now it is not hard to verify that the @xmath184matrices @xmath186 of the resulting matrix @xmath215 are exactly the basis matrices of @xmath187 .",
    "the following very simple example will illustrate this procedure .",
    "consider the graph @xmath4 which is depicted in figure 6 .",
    "# 1#2#3#4#5 @font    ( 2100,1365)(4501,-3094 ) ( 5326,-2461 ) ( 1 , 0)600 ( 5326,-2386 ) ( 1 , 0)600 ( 6226,-2236 ) ( 1 , 1)300 ( 6526,-2911)(-1 , 1)375 ( 5026,-2311)(-1 , 1)375 ( 5026,-2536)(-1,-1)300 ( 5101,-2461)(0,0)[lb ] ( 6601,-1861)(0,0)[lb ] ( 6601,-3061)(0,0)[lb ] ( 4501,-1861)(0,0)[lb ] ( 4501,-3061)(0,0)[lb ] ( 6001,-2461)(0,0)[lb ]    figure 6    here superscripts denote the numbers from @xmath216 associated to atoms which form the molecule of ethylene .",
    "let @xmath0 be the adjacency matrix of the colored graph @xmath4 associated to the molecular graph depicted in figure 6 ( here 0 stands for the carbon atom , 1 for hydrogen atom , 2 for usual bond , 3 for double bond and 4 means that there is no bond between the corresponding atoms ) , @xmath217    then we get that @xmath218    @xmath219 where @xmath220    now we proceed with the matrix @xmath137 ,",
    "@xmath221    we suggest that the reader repeats the process with the matrix @xmath137 instead of @xmath0 and checks that the matrix @xmath222 resulting from the second iteration coincides with @xmath137 .",
    "this means that @xmath137 is in fact the desired result of the stabilization , namely , the adjacency matrix @xmath223 .",
    "the reader can easily find that the order of the automorphism group @xmath224 of our graph @xmath4 is equal to @xmath225 and the matrix @xmath137 represents the set of 2-orbits of @xmath226 .",
    "hence in this case @xmath6 is really a schurian cellular algebra .",
    "here is a formal description of the algorithm ( which will be denoted in the following by the initials of the authors ) .",
    "* algorithm wl *    input : the adjacency matrix @xmath227 of colored graph @xmath4 .",
    "output : a standard basis @xmath90 of the cellular algebra @xmath6 , or more exactly the adjacency matrix @xmath223 .",
    "\\(0 ) let @xmath36 be the set of different entries of @xmath0 .",
    "+ for @xmath228 do + define @xmath229 to be the matrix with + @xmath230 if @xmath44 and @xmath231 otherwise .",
    "+ let @xmath232 .",
    "\\(1 ) let @xmath233 , + where @xmath234 are distinct indeterminates , + which are noncommuting with respect to multiplication .",
    "\\(2 ) compute the matrix product @xmath235 .",
    "+ each entry @xmath236 of @xmath88 is a sum of products @xmath237 .",
    "\\(3 ) determine the set @xmath238 + of different expressions among the entries @xmath236 .",
    "\\(4 ) if @xmath239 then + for @xmath228 do + define @xmath229 to be the matrix with + @xmath230 if @xmath240 and @xmath231 otherwise .",
    "+ @xmath232 .",
    "goto ( 1 ) .",
    "\\(5 ) stop .",
    "as already indicated in the previous section , it follows from the representation of a cellular algebra by a colored complete directed graph that algorithm wl implicitly considers all configurations consisting of three vertices in the graph .",
    "there are other methods ( see e.g.  the references in @xcite ) for perception of graph symmetry which also use configurations of three vertices .",
    "the main advantage of algorithm wl over them is the fact that the cellular algebra contains exhaustive information which is obtainable from subgraphs of at most three vertices .",
    "thus , the resulting partitions of the vertices and pairs of vertices are the finest among the partitions which can be deduced using these configurations .",
    "an interesting method which is rather close to algorithm wl is described in @xcite .",
    "it is based on raising the adjacency matrix to its higher powers , evaluating the entries and partitioning the atoms and pairs of atoms into equivalence classes .",
    "indeed , this procedure considers subgraphs consisting of three vertices .",
    "however , some information can get lost when the resulting partitions are coarser than those obtained by algorithm wl .",
    "in particular , an `` orientation '' of edges can not occur .",
    "note that this is possible even if the algorithm wl is applied to an undirected graph .",
    "consider for example the graph @xmath4 in figure @xmath241 .",
    "0.5 cm    ( 15,3 ) ( 3,0 ) ( 6,0 ) ( 8.5,1.65 ) ( 8.5,-1.65 )    ( 3.25,0)(1,0)2.5 ( 6.2,0.15)(3,2)2.1 ( 6.2,-0.15)(3,-2)2.1    ( 2.7,-1.5)@xmath48 ( 5.7,-1.5)@xmath31 ( 9.2,1.8)@xmath75 ( 9.2,-2.3)@xmath76    @xmath242    figure 7    the edge @xmath243 , for instance , can be considered to be oriented ( in the sense that its endvertices are situated differently according to the whole graph ) . algorithm wl applied to this graph yields not only a coloration , but also an orientation of the edges , i.e.  in the colored complete directed graph , which represents the cellular algebra , the arcs @xmath244 and @xmath245 have different colors ( the colored complete directed graph is given above by its adjacency matrix ) .",
    "the cellular algebra of @xmath4 is of rank @xmath145 .",
    "the standard basis consists of the following matrices :    @xmath246    note that for the same graph the algorithm which was described in @xcite will get as the output the symmetric matrix @xmath247 hence two antisymmetric basic matrices of @xmath6 will be merged .",
    "in the previous sections , we already indicated that each cellular algebra @xmath164 with basis @xmath248 @xmath249 can be represented by a colored complete directed graph @xmath19 , the graph whose adjacency matrix is the matrix @xmath250 ( with indeterminates @xmath208 standing for the colors @xmath109 ) .",
    "this matrix sometimes is called _ generic matrix _ of @xmath164 . for convenience , the vertices in @xmath22 have been identified with the corresponding loops . in this sense , the basis matrix @xmath178 corresponds to the arc set @xmath41 of color @xmath42 , and @xmath251 .",
    "the number of colors in @xmath22 is equal to the rank of @xmath164 .",
    "more generally , to each linear subspace @xmath187 with linear basis @xmath90 satisfying the properties ( i)-(iv ) of a cellular algebra , we can associate a colored complete directed graph @xmath19 , the graph which belongs to the generic matrix @xmath252 of @xmath187 .    with this representation",
    ", the main idea of the algorithm described above can be sketched in a more illustrative manner . in each iteration of the algorithm ,",
    "the coloring of the underlying complete directed graph is modified by means of schur - hadamard multiplication and matrix multiplication .",
    "these two operations may be interpreted as follows .",
    "given generic matrices @xmath161 and @xmath162 of two colored complete directed graphs @xmath253 and @xmath254 with indeterminates representing the colors , the schur - hadamard product @xmath255 corresponds to the generic matrix of a new colored complete directed graph @xmath22 where the color of arc @xmath21 is the ordered mixture of the colors of both arcs in the original graphs . in the case of the matrix product @xmath157 ,",
    "the color of the arc @xmath21 in the new graph @xmath22 depends on the number and colors of paths of length @xmath48 starting in @xmath16 and ending in @xmath17 such that the first step in the path is an arc of @xmath253 and the second step is an arc of @xmath254 .",
    "the @xmath108entry @xmath256 of @xmath157 completely describes the set of these paths .    in the following",
    "we present a slightly different procedure leading to our main goal , namely an efficient computer program for graph stabilization .",
    "the method is based on the computation of the structure constants @xmath177 which have been defined and interpreted in section 4 . to recall the main result ,",
    "a basis @xmath90 of a cellular algebra @xmath164 must fulfill @xmath257 for each pair @xmath174 . in the colored graph @xmath22",
    ", this means that each arc @xmath21 of a given color @xmath42 is the basis arc of exactly @xmath177 triangles with first nonbasis arc of color @xmath109 and second nonbasis arc of color @xmath38 ( a triangle consists of three not necessarily distinct vertices @xmath258 and arcs @xmath21 , @xmath259 and @xmath260 .",
    "the arc @xmath21 is called the _ basis arc _ , the other arcs are the _ nonbasis arcs _ of the triangle ; see figure 5 ) .",
    "the idea of the algorithm can be described informally as follows .",
    "one iteration includes the round along all arcs of the given graph @xmath22 .",
    "for each arc @xmath21 of a fixed color @xmath42 we count the number of triangles with basis arc @xmath21 and nonbasis arcs of color @xmath109 and @xmath38 , respectively , @xmath261 ( equivalently , we count the number of paths of length @xmath48 such that the first arc @xmath259 is of color @xmath109 and the second arc @xmath260 is of color @xmath38 ) .",
    "these numbers should be equal for all arcs .",
    "if this is true , then these numbers are just the structure constants @xmath177 .",
    "if not , then the arc set @xmath41 of color @xmath42 has to be partitioned into subsets @xmath262 , each consisting of arcs with the same numbers .",
    "this step is performed for all colors @xmath263 .",
    "then the graph @xmath22 is recolored , i.e.  we identify color @xmath264 with the old color @xmath42 and introduce the new colors @xmath265 ( in algebraic language , recoloring @xmath22 means to replace the basis matrix @xmath178 by new basis matrices @xmath266 ) .",
    "the next iteration is performed for the recolored graph @xmath22 . if in some iteration no new colors are introduced , then the process is stable and we can stop . in this case , the graph @xmath22 with the final _ stable coloring _ represents the required cellular algebra @xmath164 . here is a more formal description of the algorithm .",
    "* algorithm stabil *    input : the adjacency matrix @xmath267 of a colored graph @xmath4 .",
    "output : a complete directed graph @xmath19 with a stable coloring + and the structure constants @xmath177 .",
    "\\(0 ) let @xmath36 be the set of different entries of @xmath25 and + @xmath19 the colored complete directed graph belonging to @xmath25 . + determine the arc sets @xmath268 of colors @xmath269 .",
    "+ let @xmath232 .",
    "\\(1 ) for @xmath270 do    for all @xmath45 do + compute the numbers @xmath177 of triangles with basis arc @xmath21 and + nonbasis arcs of colors @xmath109 and @xmath38 , respectively , @xmath174 .    collect all arcs having the same parameters @xmath177 , i.e.all arcs + which belong to the same number of triangles of any colors , + and assign them to new sets @xmath262 .",
    "replace @xmath41 by @xmath262 , + i.e.  recolor the arcs of color @xmath42 using the old color @xmath271 + and the new colors @xmath265 .",
    "\\(2 ) let @xmath125 be the number of colors used to recolor @xmath22 .",
    "+ if @xmath272 then + r : = s. goto ( 1 ) .",
    "\\(3 ) stop .",
    "let us illustrate this method by a small example , namely we consider again cuneane , see figure 3 .",
    "here @xmath273 is the adjacency matrix of the corresponding colored graph ; @xmath274 is the result after the first iteration , @xmath275 is the result which we get after the second iteration ( it in fact coincides with the final result ) .",
    "the presented algorithm stabil has been coded in c and was tested on a sun - sparcstation .",
    "the program requires as an input a file containing the number of colors , the vertex number @xmath1 and the adjacency matrix @xmath25 of an arbitrary graph @xmath4 , and provides as an output the number of colors ( i.e.  the rank ) , the number of cells in the standard partition , the adjacency matrix of the cellular algebra @xmath6 , and ( if requested ) the structure constants of @xmath6 .    in the following",
    "we will give some information about the implementation .",
    "the adjacency matrix of the graph @xmath4 is stored in a @xmath29matrix .",
    "after each iteration of the program , this matrix will contain the adjacency matrix of the actual colored complete graph @xmath22 . in the final state it contains the adjacency matrix of @xmath6 .    during any iteration of the program , except the last one , the number of colors increases and some arcs of @xmath22 are recolored . arising of new colors implies a new iteration , while absence of new colors during some iteration gives the sign for finishing the program . in the latter case",
    "a new iteration will not change the coloring of @xmath22 .",
    "any iteration includes the following two imbedded loops : the loop around the colors and the loop around the arcs of a fixed color . to handle the loop around all arcs of a fixed color",
    ", we introduce an additional data structure representing the graph @xmath22 , namely lists which store the arcs @xmath21 of a given color .",
    "each element of a list contains the entries @xmath16 and @xmath17 , i.e.  the number of the row and column of the arc in the adjacency matrix , and a pointer to the information concerning the next arc of the given color .",
    "the following actions with one arc @xmath21 of color @xmath42 form an elementary step of the program , except the last one :    \\(i ) computing the structure constants @xmath177 for @xmath21 . since @xmath174 ,",
    "i.e.  @xmath22 is colored by @xmath166 colors , there are @xmath276 such numbers .",
    "+ ( ii ) saving the nonzero structure constants @xmath177 for @xmath21 as the sequence of triples @xmath277 at the end of a vector memory .",
    "+ ( iii ) assigning the color to the arc @xmath21 .",
    "this is done by examining whether the last sequence in memory is a new sequence ( then a new color is introduced ) , or the same sequence already appears in memory for some other arc of the actual color @xmath42 .",
    "let us consider these actions in some more detail .",
    "_ computation of the structure constants_. as mentioned above , each arc is characterized by a set of @xmath276 numbers , called structure constants .",
    "the geometrical meaning of these numbers has been described , too . in order to calculate the numbers @xmath177 for a given arc @xmath21",
    ", we examine all triangles with basis arc @xmath21 ( see figure 5 ) .",
    "note that there are @xmath1 such triangles .",
    "if for some vertex @xmath180 the arc @xmath259 has color @xmath109 and the arc @xmath260 has color @xmath38 , then we increase @xmath177 by @xmath31 ( initially all @xmath177 are set equal to @xmath32 ) .",
    "thus the number of nonzero @xmath177 does not exceed @xmath1 .    if we compute simultaneously all @xmath276 structure constants for an arc and store them in a straightforward way using an @xmath278matrix",
    ", then we will soon get storage overflow , since the existence of a matrix with @xmath276 elements in the program is impossible already for comparatively small @xmath1",
    ". however , since there are at most @xmath1 nonzero structure constants for each arc , we can use instead of a matrix const with @xmath276 entries a data structure whose size is proportional to @xmath1 .",
    "this data structure consists of lists whose elements contain the information @xmath109 , @xmath177 and a pointer to the next nonzero structure constant in the column @xmath38 of the matrix const .",
    "additionally we need a vector with @xmath166 elements to save the pointers to the columns ( the described technique , called _ hashing _ , is a well known tool to treat efficiently set manipulation problems ; see @xcite ) .    _",
    "saving of the structure constants for arcs of a given color_. in view of the forthcoming manipulations , it is more adequate to save the structure constants as a sequence of triples @xmath279 .",
    "the maximal number of such triples in the sequence of a given arc is @xmath1 . during the pass along the arcs of a given color @xmath42",
    ", we have to save all sequences of structure constants belonging to the arcs of this color .",
    "therefore the length of the vector memory should be about @xmath280 ( note that the number of arcs of color @xmath42 is restricted by @xmath34 ) .    _ the search along memory and recoloring of an arc_. the nonzero structure constants for a given arc @xmath21 of color @xmath42 are saved at the end of the vector memory .",
    "then we should examine whether we have a new sequence or whether an identical sequence has been saved in memory before .",
    "we use the partial ordering of the sequences by their lengths .",
    "so , if we search for an identical sequence , in the case of equal lengths we come to an element by element comparison , in the case of nonequal lengths we pass to the next sequence .",
    "as mentioned before , the main problem in the program is to find memory for the structure constants . for graphs with a comparatively large number of vertices ,",
    "it is impossible to save all these constants for a given color @xmath42 .",
    "therefore we decided to save only the nonzero numbers as triples @xmath279 in the vector memory .",
    "now , some graphs may initially produce a very large number of different sequences @xmath279 and the corresponding massive storage requirements may exceed the available memory capacity of small computers .",
    "therefore we start the program with a simple _ preprocessing procedure _ which aims to increase in advance the number of colors , before starting the main program .    in the first step of this preprocessing",
    "we classify the vertices of the ( colored ) graph @xmath4 in the following way .",
    "two vertices are put into the same cell if and only if they are incident to the same number of edges of each color .",
    "then we can recolor the edges according to the new coloring of the vertices .",
    "if two edges , which initially have the same color , connect two different colored pairs of vertices , then the edges are assigned different colors , too .",
    "some additional practically important details about the current version of the program implementation of algorithm stabil may be found in section 9 .",
    "the question of the theoretical complexity of the wl  stabilization was not considered for a long time .",
    "weisfeiler and leman only stated that the complexity is polynomial in the vertex number @xmath1 of the graph , without giving any explicit time bound . a first attempt for an estimation",
    "was done by s.  friedland . in @xcite",
    "he pointed out that the required time is restricted by @xmath281 .",
    "ponomarenko @xcite improved the time bound to @xmath282 . very recently , l.  babel showed in @xcite that the algorithm can be implemented to run in time @xmath283 .",
    "* before we are going to determine the worst case complexity of our implementation , let us once more stress that we are dealing with two different problems , depending on the point of view .",
    "the first problem is to find the standard basis of the cellular algebra @xmath6 belonging to some graph @xmath4 .",
    "the second problem , which many times appears in framework of algebraic combinatorics , is to compute the structure constants @xmath177 and a stable coloring of the complete directed graph @xmath22 representing the cellular algebra @xmath6 .",
    "our implementation solves the second problem whereas the implementation of the above - mentioned algorithm by babel solves the first problem .",
    "let us now analyze the complexity of algorithm stabil .",
    "we only have to examine step ( 1 ) , the initializing step ( 0 ) and step ( 2 ) obviously can be performed in time @xmath284 .",
    "we have seen in the previous section that an elementary step of ( 1 ) consists of three actions which are performed for each of the @xmath34 arcs of the graph .    in action ( i ) the @xmath1 triangles with basis arc",
    "@xmath21 have to be found .",
    "this can be done in time @xmath285 by inspecting the @xmath16th row and the @xmath17th column of the adjacency matrix @xmath24 of the graph .",
    "note that for each vertex @xmath180 there is one triangle with basis arc @xmath21 , the entries @xmath286 and @xmath287 of @xmath0 are the colors of the nonbasis arcs @xmath259 and @xmath260 .",
    "for each triangle the value of some parameter @xmath177 is actualized . to be more precise , let @xmath44 .",
    "then the value of @xmath177 must be increased by 1 if @xmath288 and @xmath289 . in order to find the actual value of @xmath177 we have to pass through the corresponding list in the data structure ( containing the information @xmath290 ) .",
    "since the length of this list is at most @xmath1 , this requires time @xmath285 for each triangle .",
    "thus , action ( i ) requires total time @xmath284 for one arc .",
    "since there are at most @xmath1 nonzero structure constants for each arc , action ( ii ) , namely saving the sequence of structure constants in the vector memory , can be executed in time @xmath285 .",
    "the most time consuming part is action ( iii ) . in order to compare the sequence of triples @xmath279 for one arc @xmath21 with all such sequences already stored in memory",
    ", we eventually have to pass through the whole vector memory .",
    "since this vector may be of length @xmath291 , this requires time @xmath292 .",
    "( we stress that the current implementation does not use any storage / search technique , see also 8.5 ) .",
    "this shows that the complexity of one elementary step is @xmath292 .",
    "since @xmath34 arcs are treated , one iteration of step ( 1 ) requires time @xmath293 .",
    "now it remains to give a bound on the number of iterations .",
    "if only one color is added during each iteration , then there are @xmath34 iterations .",
    "altogether , this results in a worst case time bound of @xmath294 .    * remarks *    1 .   similar reasonings were done less carefully in @xcite and thus resulted in the evaluation @xmath295 .",
    "2 .   in fact , the number of iterations in the wl - stabilization is less than @xmath34 ( @xcite ) , however such an opportunity to improve the evaluation will not be used in this paper .",
    "3 .   in the worst case ,",
    "if @xmath6 coincides with the full matrix algebra of order @xmath1 , there are @xmath34 basis matrices and therefore @xmath296 structure constants ( most of them are zero ) .",
    "this information may help the reader to realize the difference between the statements of problems 1 and 2 .    the crucial point in the implementation concerning both running time and",
    "space requirement is the vector memory . in order to make the program applicable also for relatively small computers",
    ", it is favourable to restrict the length of memory to @xmath284 . with this modification",
    ", it may be impossible to store all the different sequences of structure constants .",
    "in that case , new sequences are not saved and all the corresponding arcs are assigned the same color .",
    "this color will be split during the next iteration of the program ( note that this procedure may increase the number of iterations which are needed to obtain the stable coloring ) .",
    "as mentioned above , the implementation of the algorithm presented in @xcite has a considerably lower worst case complexity .",
    "we will very briefly indicate the main ideas of that implementation .",
    "compared to algorithm stabil , there are two main modifications , one decreases the number of triangles which are examined in one iteration , the other involves some sophisticated sorting techniques .    in each iteration of algorithm stabil ,",
    "all @xmath297 triangles of the colored graph @xmath22 are examined .",
    "however , it is not really necessary to inspect the whole set of triangles .",
    "one can restrict to a certain subset .",
    "roughly sketched , the procedure is the following .",
    "let a colored complete directed graph @xmath22 be given . in each iteration",
    "some arcs of the graph will keep their colors , others are assigned new colors ( which have not been used in the previous iteration ) .",
    "more concrete , the arc set @xmath41 is split into subsets @xmath262 , where one of the colors @xmath298 is equal to @xmath42 and the others are new colors .",
    "the basic idea is to inspect only those triangles which contain at least one arc of a new color .",
    "denote by @xmath299 the set of these triangles .",
    "further let @xmath300 denote the set of arcs which are basis arcs of triangles from @xmath299 .",
    "now , step ( 1 ) of the algorithm stabil is modified in the following way .",
    "each arc @xmath301 is the basis arc of some ( in general less than @xmath1 ) triangles from @xmath299 . for @xmath301 list the colors of the nonbasis arcs of these triangles .",
    "now , each arc from @xmath300 is associated a multiset of some ordered pairs @xmath302 .",
    "collect arcs with equal multisets and assign them the same color , i.e.  replace each arc set @xmath41 by suitable subsets @xmath262 .",
    "one of these subsets , say @xmath303 ( which may be empty ) , consists of all arcs from @xmath41 which do not belong to @xmath300 .",
    "the procedure stops if no new colors are generated .",
    "it is not yet designated which one of the colors @xmath298 is equal to the old color @xmath42 and which ones are new colors .",
    "the effort for each iteration is kept low if @xmath299 contains only a small number of triangles .",
    "therefore it is favourable to identify @xmath42 with that color @xmath304 where @xmath305 contains the largest number of arcs .",
    "it is not hard to check the correctness of this method ( for details see @xcite ) .",
    "the worst case complexity is determined as follows .",
    "let @xmath306 denote the cardinality of @xmath299 in the @xmath131th iteration .",
    "then obviously @xmath307 .",
    "therefore , multisets of at most @xmath306 arcs @xmath21 have to be computed .",
    "these multisets are stored as lists @xmath308 and are obtained as follows .",
    "order the @xmath306 triangles from @xmath299 lexicographically according to the colors @xmath302 of the nonbasis arcs ( a pair @xmath302 appears before @xmath309 if and only if @xmath310 or @xmath311 and @xmath312 ) . note that the colors are in the range @xmath313 ( since the graph has @xmath34 arcs , not more than @xmath34 colors can occur ) .",
    "it is well known that lexicographical ordering of @xmath306 pairs of integers from @xmath313 can be done in time @xmath314 using the sorting routine _",
    "bucket sort_. now , the lists @xmath308 are obtained by passing through the ordered list of triangles and assigning the actual triangle to its basis arc @xmath21 , i.e.  the colors of the nonbasis arcs are inserted at the end of @xmath308 .",
    "obviously , this requires time @xmath315 .",
    "note that the pairs of colors in the lists @xmath308 appear now in lexicographical order .    to identify the different multisets we have to order the lists @xmath308 , @xmath301 , lexicographically . since the total length of all lists is @xmath306 and the entries",
    "are pairs of numbers from @xmath313 , this again can be done with bucket sort in time @xmath314 . now",
    "the arc sets @xmath41 are split in the obvious way by passing through the ordered list of multisets @xmath308 .",
    "this , as well as finding the subsets @xmath305 of largest cardinality , requires time @xmath315 .",
    "so far we have seen that the complexity for the @xmath131th iteration of this method is @xmath314 .",
    "it remains to compute the total complexity for all iterations ( trivially , the number of iterations is restricted by the maximal number @xmath34 of colors ) .",
    "since @xmath305 has been chosen to be that subset of @xmath41 with largest cardinality , each of the other subsets ( which contain the arcs with new colors ) has at most half the size of @xmath41 .",
    "therefore , each time a certain triangle is inspected , at least one arc set which shares an arc with this triangle is at most half as large than before . as a consequence ,",
    "each of the @xmath297 triangles is examined not more than @xmath316 times .",
    "this shows that @xmath317 .",
    "finally we obtain a worst case time complexity of @xmath318 .",
    "* these ideas have been realized in a computer program by l.  babel , s.  baumann and m.  ldecke .",
    "the program is termed stabcol , due to the fact that the coloring of the complete directed graph is modified in each iteration until the process is stable , i.e.  until a stable coloring is obtained .",
    "it is coded in programming language c and was also tested on the same sun - sparcstation . just as for the program stabil ,",
    "the input is a file containing the number of colors , the vertex number and the adjacency matrix of a graph @xmath4 , the output contains the number of colors , the number of cells and the adjacency matrix of the cellular algebra which is generated by @xmath4 .",
    "contrary to stabil , the program stabcol does not work with vectors of predefined lengths but uses more sophisticated data structures .",
    "the set @xmath299 of triangles and the multisets @xmath308 are stored in lists which are linked by pointers and which are of variable length . in this way",
    ", waste of memory space is avoided .",
    "furthermore , memory space which is no longer needed is set free immediately .",
    "the complexity analysis of stabil shows that most of its time is spent in order to compare a new sequence of numbers with old sequences .",
    "since this is done in the obvious way by passing through the entire vector of sequences , it requires time proportional to the length of the vector .",
    "this somewhat time - consuming procedure is avoided in stabcol by means of very special sorting techniques .",
    "these techniques and the more complicated data structures make the implementation much more ambitious .",
    "however , we do not have enough space to go into details here .",
    "the interested reader may consult the program description @xcite .",
    "* at first glance , a comparison of the theoretical complexities indicates that the implementation of @xcite should be preferred .",
    "however , it turns out that this implementation , although theoretically very fast , is rather slow in practice and applicable only for relatively small graphs , whereas our implementation , although inferior with respect to the worst case bound , is very fast in practice and is able to handle very large graphs ( the practical behaviour of both program implementations is documented in the next section ) .",
    "here we are confronted with a situation which seems to be strange but which rather frequently occurs on the construction of algorithms .",
    "there are two algorithms or two implementations of an algorithm solving the same problem , one of them theoretically fast ( i.e.  with a good worst case complexity ) but practically slow , the other one practically fast in spite of a relatively bad worst case complexity .",
    "there are two main reasons for this paradox .",
    "first , and perhaps most important is that the sign `` o '' in the evaluation means in fact the existence of some constant as a multiplier with the monomial depending on @xmath1 .",
    "the actual value of this constant depends on many factors , in particular on the `` complexity '' of the data structures . in our case",
    "the multiplier for the implementation of stabil is essentially smaller than the one for stabcol .",
    "thus the advantages of the theoretically faster algorithm can not be felt on comparably small graphs .",
    "second , one algorithm has been constructed from a purely theoretical point of view with the aim to obtain a worst case complexity as good as possible .",
    "no practical considerations are taken into account such as simplicity of data structures , easy way of implementing , small space requirements , etc .",
    "in particular , the running time of the algorithm in the mean ( the mean taken over a large representative selection of practically relevant examples ) is not considered .",
    "this average behaviour , however , is much more important for practitioners than the worst case behaviour , which often occurs only for pathological examples .",
    "the second algorithm is constructed from that practical point of view .",
    "it aims to solve the `` real world '' problems very fast , without paying attention to its theoretical complexity .    *",
    "* it is worthwhile to stress that the worst case time bound @xmath319 ( see 8.1 ) is a very rough upper bound .",
    "in fact we see a number of opportunities to diminish this bound essentially .",
    "one of them was mentioned in remark ( ii ) in subsection 8.1 .",
    "also ( as a result of restricting the length of vector memory to @xmath320 ) the complexity of one elementary step in the current version of the program is actually reduced from @xmath321 to @xmath320 . in spite of the fact that the total number of steps may slightly grow , here we have one more standby to reduce the upper bound .    a more careful analysis of the applied technique of hashing together with a more clever organization of storage ( via the use , e.g. , of balanced binary trees )",
    "may essentially decrease the number of comparisons when we operate with the vector memory .",
    "however we do not use these and other possible options in the current preliminary version of our report .",
    "in contrast to @xcite , our report is oriented towards those practical users of stabil , for whom the theoretical question of the evaluation of the efficiency does not play a crucial role .",
    "nevertheless , we intend to return to the consideration of this question in the future .",
    "the presented implementation stabil has been tested on a large number of structures .",
    "all computations were done on a sun - sparcstation 10 with 128 mb ram . on this machine ,",
    "the program is able to handle graphs with up to 2000 vertices . to demonstrate the capability of the program we considered acyclic compounds and compounds containing multiple bonds or heteroatoms as depicted in figure 8 .",
    "these structures also appeared as illustrations in papers by other authors ( see e.g.  @xcite , @xcite ) .",
    "the results are summarized in table i. besides the running time of the program , the number of cells in the standard partition and the number of colors in the stable coloring ( i.e.  the number of equivalence classes of atoms and ordered pairs of atoms ) are stated . in order to make evident the practical efficiency of our program , we also state the running time of the program implementation stabcol .",
    "note that stabcol requires space proportional to @xmath297 , therefore it can handle graphs with not more than 150 vertices .    .",
    "results for the structures in figure 8    [ cols=\"^,^,^,^,^,^ \" , ]     # 1#2#3#4#5 @font    ( 4666,1966)(5018,-4044 ) ( 5101,-3061 ) ( 6001,-3061 ) ( 6901,-3061 ) ( 7801,-3061 ) ( 8701,-3061 ) ( 9601,-2161 ) ( 9601,-3961 ) ( 5101,-3061 ) ( 1 , 0)1800 ( 6901,-3061)(30.00000,0.00000)31(6.6667,10.0000 ) .",
    "( 7801,-3061 ) ( 1 , 0)900 ( 9601,-2161)(-1,-1)900 ( 8701,-3061 ) ( 1,-1)900    figure 11    the program stabil has a rather long history . the first attempt of an implementation was done by e.v .",
    "krukovskaya in pascal , see @xcite .",
    "a draft version of the present program was written in c by i.v .",
    "chuvaeva and d.v .",
    "pasechnik at the n.  d.  zelinski institute of organic chemistry ( moscow ) in 19901992 , see @xcite .",
    "finally this version was improved at the technical university munich in 1995 .",
    "the improved version had static memory and , by this reason , was available only to graphs with up to 200 vertices .",
    "this version was carefully tested and the results of this testing are presented above . in 1996 new improvements",
    "were done according to the suggestions of ch .",
    "pech ( dresden ) : dynamical memory management was created .",
    "now the current version , in principle , can handle graphs with an arbitrary number of vertices .",
    "if for a given graph @xmath4 the number of vertices is sufficiently small ( that is if there will be enough memory for saving all data structures ) then we will get @xmath6 as output .",
    "otherwise , the program will inform the user that the task can not be fulfilled completely .",
    "this last version of the program was used for other purely theoretical purposes .",
    "our experience shows that graphs with up to 500 vertices can be successfully managed , however in some cases we were able to handle even larger graphs .",
    "the codes of both programs stabil and stabcol and a read.me file which describes how to use the programs are released under gplv3 and can be downloaded from the homepage of the fourth author : http://www.ntu.edu.sg/home/dima/software.htm .",
    "the users of the programs are requested to reference this report whenever results obtained with help of stabil or stabcol are published .",
    "the presented algorithm provides a very powerful and efficient tool to determine equivalence of atoms and pairs of atoms in molecules .",
    "the equivalence classes are obtained by examining in a systematic way all configurations of three vertices in the underlying graph .",
    "the partitions of the vertices and edges are the finest which can be deduced using configurations of this size .    as already mentioned before",
    ", the standard partition of a graph not necessarily coincides with its automorphism partition .",
    "indeed , there exist graphs where the former partition is coarser than the latter .",
    "methods which settle this shortcoming to a certain extent are based on the following idea .",
    "classify vertices and edges by examining configurations which consist not only of three but of a larger number of vertices .",
    "this proceeding is generally called _ deep stabilization _ or _ stabilization of depth _ @xmath197 .    roughly speaking , the situation is the following .",
    "let @xmath4 be a graph with @xmath1 vertices ( possibly a directed multigraph ) and @xmath197 a fixed integer , @xmath322 .",
    "all possible @xmath323 subgraphs of @xmath4 which are induced by the ordered @xmath197-tuples of vertices are examined .",
    "we have to find all @xmath324 isomorphism types of these subgraphs .",
    "to each pair @xmath21 of vertices a vector of length @xmath324 is associated , each component of the vector being equal to the number of subgraphs of the corresponding isomorphism type which contain the pair @xmath21 .",
    "any iteration of the stabilization procedure of depth @xmath197 assigns two pairs @xmath21 and @xmath112 the same color if and only if the vectors corresponding to these pairs are equal .",
    "it is clear that the computation of the total degree partition is nothing else than stabilization of depth @xmath48 , weisfeiler - leman stabilization has depth @xmath75 .",
    "for depth at least 4 we obtain stronger algorithms , however at the price of a considerably higher complexity .",
    "one of the first attempts of a program implementation of stabilization of depth @xmath325 for purely chemical goals and on a rather `` naive '' level was done in @xcite .",
    "it is demonstrated in the next paper @xcite of this series that , in contrast to first expectations , stabilization of depth @xmath197 with some @xmath326 is also not sufficient to rigorously settle the automorphism partitioning problem .",
    "it turns out ( see @xcite , @xcite ) that for any fixed value of @xmath197 there exist graphs with the property that the standard partition of depth @xmath197 does not coincide with the automorphism partition .    in future work we intend to develop an implementation of the wl - stabilization which eventually is even faster than the implementation stabil presented in this paper . a very promising approach is to perform in an alternative way stabilization steps of depth 2 and 3 .",
    "given a colored complete directed graph @xmath19 , we start with stabilization of depth 2 , i.e.  we compute the total degree partition of @xmath22 ( let @xmath327 be the graph consisting of the arcs of color @xmath42 ; then the total degree partition of @xmath22 is the coarsest partition of @xmath328 such that any two vertices belonging to the same cell of the partition have the same valencies with respect to any other cell in any graph @xmath327 ) .",
    "the arcs of a given color are recolored according to the colors of their end vertices such that arcs between different colored pairs of vertices are assigned different colors . in the next step",
    "the coloring of the arcs and vertices is refined analogously as in stabil by considering all triangles of the graph .",
    "however , in order to decrease the effort , this is not done iteratively , but only once .",
    "after that we again compute the total degree partition , perform one stabilization step of depth 3 , etc .",
    "the algorithm stops if the coloring of @xmath22 is stable .    as it was mentioned before",
    ", we can only be sure to get the automorphism partition of a graph @xmath4 by means of wl - stabilization if it is known in advance that the algebra @xmath6 is schurian .    in general",
    ", we can only suggest to proceed in the following way : + find the automorphism group @xmath224 of the graph @xmath4 ; + describe the set of 2orbits ( or only 1orbits ) of the action of @xmath55 on the vertex set of @xmath4 .",
    "this problem , in principle , may be solved using e.g. the computer package coco ( i.a .",
    "faradev , m.h .",
    "klin ) , the unix implementation by a.e .",
    "brouwer .",
    "the preliminary versions of coco are described in @xcite and @xcite . with the use of coco",
    "one may handle graphs with a few thousands of vertices .",
    "the current version of coco @xcite is oriented towards purely mathematical goals , namely for the investigation of graphs having a sufficiently large prescribed subgroup of the automorphism group .",
    "in such a case the input graph is described by a set of arcs as a union of suitable 2orbits of a prescribed permutation group . for purely chemical purposes",
    "such a mode of input is certainly inconvenient .",
    "hopefully , in the future a more suitable interface for chemists will be created .",
    "this technical report is considered by the authors as a preliminary version of a future regular publication .",
    "we will be very grateful to everybody who supplies us with remarks , comments , criticism or improvements .",
    "putting the original version of @xcite onto arxiv , we just updated few references , while not trying to reflect the ongoing progress during the last decade .",
    "the reader may benefit from recent papers @xcite , where some new relevant ideas and methods are discussed .",
    "the authors still hope to produce a throughout revision of the present text .",
    "unless more convenient , m.  klin should be regarded as the corresponding author .",
    "we want to express our deep gratitude to the following colleagues :                    99 adelson  velski g.m . : _ private communication . _",
    "_ september 1995 . _ adelson - velski g.m . , weisfeiler b.yu . , leman a.a . , faradev i.a . : _ on an example of a graph having no transitive automorphism group .",
    "_ _ dan sssr , 185 , 1969 , 975 - 976 ( russian ) . _          babel , l. , chuvaeva , i.v . ,",
    "klin , m. , pasechnik , d.v . : _",
    "algebraic combinatorics in mathematical chemistry .",
    "methods and algorithms .",
    "program implementation of the weisfeiler - leman algorithm .",
    "( a preliminary version ) .",
    "_ _ technical report tum  m9701 .",
    "technische universitt mnchen , january 97 , 45 pp .",
    "_                evdokimov , sergei ; ponomarenko , ilia ; tinhofer , gottfried : _ forestal algebras and algebraic forests ( on a new class of weakly compact graphs ) .",
    "formal power series and algebraic combinatorics ( toronto , on , 1998 ) . _ _ discrete math .",
    "225 ( 2000 ) , no . 1 - 3 , 149172 .",
    "_          faradev i.a . ,",
    ", muzichuk m.e . : _ cellular rings and groups of automorphisms of graphs .",
    "_ _ in : i.a.faradev , a.a.ivanov , m.h.klin , a.j.woldar ( eds . ) .",
    "investigations in algebraic theory of combinatorial objects .",
    "kluwer , 1994 , 1 - 152 .",
    "_                    klin m.h .",
    ", krukovskaya e.v . : _ program implementation of the weisfeiler - leman algorithm .",
    "_ in : _ molecular graphs in chemical investigations .",
    "thesis of reports of the multi - university conference , kalinin , 1990 , 33 ( russian ) .",
    "_      klin m.h . ,",
    "lebedev o.v .",
    ", pivina t.s . : _ enumeration of maximum length cycles in graphs corresponding to structural formulas of one homological series of polycyclic compounds of carcass type .",
    "_ in : _ vichislitelnie systemi , 130 , s.b . of the academy of sciences of ussr ,",
    "novosibirsk , 1989 , 3968 ( russian ) .",
    "_    klin m.h . ,",
    "lebedev o.v . ,",
    "pivina t.s .",
    ", zebirov n.s . : _",
    "nonisomorphic cycles of maximum length in a series of chemical graphs and the problem of application of iupac nomenclature rules .",
    "_ match , 27 , 1992 , 133 - 151 .",
    "_    klin m. , rcker ch . , rcker g. , tinhofer g. : _ algebraic combinatorics in mathematical chemistry . methods and algorithms .",
    "i. permutation groups and coherent ( cellular ) algebras . _ _ match , 40 , 1999 , 7 - 138 _                      rcker g. , rcker ch . :",
    "_ computer perception of constitutional ( topological ) symmetry : topsym , a fast algorithm for partitioning atoms and pairwise relations among atoms into equivalence classes .",
    "_ _ j. chem .",
    ", 30 , 1990 , 187 - 191 . _              tinhofer g. , klin m. : _ algebraic combinatorics in mathematical chemistry .",
    "methods and algorithms .",
    "graph invariants and stabilization methods .",
    "_ _ technical report tum  m9902 .",
    "technische universitt mnchen , mrz 99 , 64 pp ."
  ],
  "abstract_text": [
    "<S> the stabilization algorithm of weisfeiler and leman has as an input any square matrix @xmath0 of order @xmath1 and returns the minimal cellular ( coherent ) algebra @xmath2 which includes @xmath0 .    in case when @xmath3 is the adjacency matrix of a graph @xmath4 the algorithm examines all configurations in @xmath4 having three vertices and , according to this information , partitions vertices and ordered pairs of vertices into equivalence classes . </S>",
    "<S> the resulting construction allows to associate to each graph @xmath4 a matrix algebra @xmath5 which is an invariant of the graph @xmath4 . for many classes of graphs , in particular for most of the molecular graphs , the algebra @xmath6 coincides with the centralizer algebra of the automorphism group @xmath7 . </S>",
    "<S> in such a case the partition returned by the stabilization algorithm is equal to the partition into orbits of @xmath7 .    </S>",
    "<S> we give algebraic and combinatorial descriptions of the weisfeiler  </S>",
    "<S> leman algorithm and present an efficient computer implementation of the algorithm written in c. the results obtained by testing the program on a considerable number of examples of graphs , in particular on some chemical molecular graphs , are also included .    </S>",
    "<S> algebraic combinatorics in mathematical chemistry . </S>",
    "<S> + methods and algorithms . </S>",
    "<S> + ii . </S>",
    "<S> program implementation of the weisfeiler - leman algorithm +   +    luitpold babel@xmath8 + _ institut fr mathematik _ + _ technische universitt mnchen _ + _ </S>",
    "<S> d80290 mnchen , germany _ </S>",
    "<S> +   + _ laboratory of mathematical chemistry _ + _ n.d.zelinski institute of organic chemistry _ </S>",
    "<S> + _ moscow , russia _ </S>",
    "<S> +   + _ department of mathematics _ </S>",
    "<S> + _ ben - gurion university of the negev _ </S>",
    "<S> + _ 84105 beer - sheva , israel _ </S>",
    "<S> +   + _ laboratory of discrete mathematics , vniisi _ </S>",
    "<S> + _ moscow , russia _ + </S>"
  ]
}