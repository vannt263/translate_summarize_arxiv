{
  "article_text": [
    "progress in the domain of high - contrast image analysis has spearheaded recent discoveries of faint exoplanets /substellar companions , and resulted in spectacular scattered light images of cirsumstellar disks around nearby stars .",
    "this progress has been mostly driven by a new class of direct imaging data analysis algorithms @xcite that empirically fit and subtract systematic noise in coronagraph data ( also called speckle noise ) .",
    "speckles stems from light diffracted by the optics in the telescope and the instrument .",
    "they are a major nuisance when seeking to detect faint circumstellar point or extended sources , due to their characteristic temporal and spatial scales ( respectively of the order of the exposure time and of the size of the image of a point source ) .",
    "modern coronagraph data analysis methods calibrate this noise by using local estimates of the speckles correlation between the science exposures and a library of noise realizations .",
    "this speckle fitting has been so far carried out in the least - squares sense .",
    "the collection of reference images is sometimes obtained using observations of calibration stars that act as true references ( reference differential imaging ; hereafter rdi ) .",
    "however , in most ground - based cases , the library of noise realizations is assembled using exposures of the source of interest in configurations for which the observer knows a priori that the location of the faint astrophysical source moves in the frame attached to the speckles . in these cases ,",
    "each image can both be treated as a science frame and also included in the reference stack corresponding to other exposures and/or wavelengths in the sequence .",
    "observation strategies enabling this feature include azimuthal motion of the astrophysical signal with respect to the speckles ( angular differential imaging adi ; @xcite , radial motion ( with integral field spectrograph observations , spectroscopic spectral differential imaging ssdi ; @xcite , or they are based on the intrinsic properties of the hypothetical sources surveyed for ( polarization differential imaging , pdi , or presence of sharp spectral feature for spectral differential imaging , sdi @xcite . +",
    "once a library of noise realizations , or point spread functions ( psf ) , has been assembled according to one or more of these strategies , least - squares fitting algorithms can be finely tuned .",
    "this is achieved in a variety of ways including optimizing how the field of view is partitioned before speckle fitting ( e.g adapting the analysis to how locally one thinks the speckles are correlated ) , varying the selection criteria that select the `` best '' noise realizations from the ensemble of references and regularizing the inverse problem .",
    "while implementations and choice of algorithmic parameters vary amongst authors , the consensus emerging in the community is that these methods are extremely efficient at enhancing the detectability of faint astrophysical signals , but do generally create systematic biases in their observed properties ( namely : photometry , spectra , astrometry of point sources and morphology , surface brightness of circumstellar disks ) . now that large surveys based on extreme adaptive optics coronagraph instruments are hitting their full stride @xcite",
    ", these biases are becoming one of the chief problems in high - contrast image analysis .",
    "+ during the past few years several authors have proposed algorithmic modifications in order to mitigate such biases @xcite . forward modeling in the context of exoplanet imaging",
    "was first proposed by @xcite and @xcite .",
    "it aims at jointly estimating the instrument response and the astrophysical signal . to do so",
    ", negative synthetic sources are injected in the raw data across the entire observing sequence .",
    "this new data set , with both positive astrophysical and negative synthetic signals , is then propagated through the reduction algorithm .",
    "jointly minimizing the residuals in such processed images ( by exploring the range of possible astrophysical properties for the synthetic negative sources ) retrieves in principle the unbiased observables of the astrophysical signal .",
    "@xcite suggested that carrying out least - squares speckle subtraction using karhunen - loeve image processing ( klip , or principal component analysis , pca ) provides a simple and computationally efficient framework to carry out astrophysical inference in a way that is equivalent to injecting a negative synthetic source in the raw data .",
    "however , that paper did not fully describe how to implement this forward modeling with klip ( hereafter , klip - fm ) in the most general case .",
    "@xcite revisited this problem and described how to apply klip - fm in the context of rdi , when the library of reference images is built using calibrator stars ( with no astrophysical signal in the library ) .",
    "that paper then discussed how to modify the adi / sdi problem so it mimics the rdi configuration , and thus in principle reduces biases on astrophysical estimates .",
    "that technique was used in @xcite and @xcite . in parallel ,",
    "@xcite and @xcite , for point sources and disks , respectively , discussed how the presence of astrophysical signal in psf libraries obtained using adi can be accounted for as a small perturbation of the least - squares coefficients .",
    "they then showed how these small perturbations could be included in a forward modeling framework to self - calibrate biases on astrophysical observables a posteriori .",
    "+    in the present manuscript we generalize this class of perturbation analysis to all type of observations .",
    "our main objective is to describe the principles underlying klip - fm in the most general case ( e.g without the strong hypothesis previously discussed in the literature ) .",
    "the novelty of our method relies on an analytical expansion for the principal components , when astrophysical signal is present in the reference images .",
    "because of their high technicality , we leave both the proof of this analytical expansion and the algorithmic details regarding its implementation out of main body of the paper .",
    "instead  2 provides a high - level description of our main result and places it into the context of previously published work .",
    "we then demonstrate the advantages of our approach by applying it to two key exoplanet imaging applications : spectral characterization with an integral field spectrograph (  3 ) and point source detection (  4 ) .",
    "we limit the scope of this paper to these two practical examples . in ",
    "5 we conclude by listing other science cases for which our method could be potentially beneficial .",
    "the technical background underlying our results is then discussed in depth in the appendices :    * appendix a provides the most general formalism for an adi + ssdi observing sequence and lays out the formal foundations for our work .",
    "* appendix b summarizes the notations appendix a in a table format . in order to facilitate numerical implementation",
    ", it provides the dimensions of the various matrices discussed in this paper . * appendix c introduces forward modeling in the most general case , and then discusses the specific configuration of rdi .",
    "this was already presented in @xcite , but serves here to set up the stage for appendix f. * appendix d describes forward modeling for astrometry and photometry of point sources using the linear algebra notations introduced in appendix a and c. it also set up the stage for the spectral estimation algorithm described in appendix f. * appendix e contains the proof of our main result .",
    "it heavily relies on the notations introduced in appendix a and summarized in appendix b. * appendix f describes how to take advantage of the result in appendix e to carry out forward modeling for the estimation of point source s spectra using ifs data .",
    "we start with the notations discussed in @xcite , and assume the case of a target image @xmath0 ( where @xmath1 is the spatial dimension ) along with a set of reference images @xmath2 .",
    "the details of how @xmath0 and @xmath2 are chosen among some generic coronagraph sequence are not discussed here .",
    "we refer the reader to appendix a for a thorough presentation of the parameters associated with building a target / reference library in the most general case .",
    "an orthonormal basis @xmath3 is then obtained based on the eigenvectors of the references covariance matrix . the associated eigenvalues @xmath4 are ranked in decreasing order .",
    "they quantify how prevalent each mode @xmath3 is in the reference stack .",
    "when @xmath5 the mode is present in most of the reference images , and conversely when @xmath6 it is absent from most references .",
    "again , linear algebra details are given in appendix a. when astrophysical signal @xmath7 is present in the target ",
    "e.g. , @xmath8 , with @xmath9 standing for the speckle noise realization in the target image to remain consistent with @xcite  the resulting processed image @xmath10 is given by the sum of two terms @xmath11 :    * the residual speckles that have not been fully captured by the pca : @xmath12 where @xmath13 corresponds to the number of principal components over which the target image is projected and @xmath14 stands for the @xmath15 inner product on the portion of the field of view over which the speckle fitting is carried out ( also called the @xmath16 zone ) .",
    "* the astrophysical signal , corrupted by the klip algorithm : @xmath17    this latter term is the source of the biases that we seek to calibrate with forward modeling .",
    "+ when the @xmath3 _ do not depend on the astrophysical signal _ , then the corruption of @xmath7 is _ a linear process_. it can be interpreted as confusion : namely the algorithm fits astrophysical signal with speckle noise .",
    "this occurs for instance in rdi . in this configuration , the @xmath2",
    "were built using images of other stars and thus do not contain the astrophysical signal of interest .",
    "we call this phenomenon _ over - subtraction_. on the other hand , when the references , and thus the @xmath3 , _ do depend on the astrophysical signal _ , the corruption of @xmath7 is _ a nonlinear process_. because the astrophysical signal in the reference images @xmath18 is added to the speckle noise , its impact on the covariance matrix , which scales as the square of the references , is quadratic . as a consequence , the principal components also depend quadratically on the astrophysical signal .",
    "we call this phenomenon _ self - subtraction_. in the context of the locally optimized combination of images algorithm  loci , @xcite  this effect can be interpreted as the subtraction of the astrophysical object with itself as it rotates across the field of view during an adi sequence . in this case , we write @xmath19 to denote the dependence of the principal components on the astrophysical signal .",
    "when a true astrophysical source is present in the data , a detection algorithm is first used to discriminate the @xmath20 and @xmath21 components . if @xmath20 is corrupted by the speckle fitting algorithm , then forward modeling is used in an attempt to estimate the detected faint source s underlying astrophysical properties .",
    "this is often done by injecting a synthetic negative astrophysical source in the data @xmath22 and carrying out a joint minimization over both properties of this negative source and the speckle noise , as discussed in   1 .",
    "this minimization can be formally written as : @xmath23 ^ 2   d \\mathbf{x } \\label{eq : basicforwardmodelling0}\\ ] ] where @xmath24 stands for the minimization over the observable properties of the negative synthetic signal , and @xmath25 for the principal components resulting from injecting this negative source in the observing sequence .",
    "note that even if the discussions in this section rely on the example in eq .",
    "[ eq : basicforwardmodelling0 ] , which uses the formalism of @xcite , they are applicable to any least - squares speckle fitting algorithm .",
    "the last sub - section of appendix e discusses this more general framework .",
    "direct inspection of eq .",
    "[ eq : basicforwardmodelling0 ] shows that forward modeling is a nonlinear optimization , in which the speckle subtraction ( the determination of the principal components in our example ) , is nested within an outer nonlinear loop . as a consequence",
    ", klip has to be carried out every time the cost function in eq .",
    "[ eq : basicforwardmodelling0 ] is evaluated .",
    "one hopes that this two steps process breaks degeneracies , and extensive tests using low - dimensional configurations by a variety of authors have shown this to be true in most cases ( see @xcite or @xcite ) .",
    "however , this approach presents two main limitations .",
    "first it becomes quickly untractable numerically when the number of astrophysical observables is large ( @xmath26 in the case of ifs data ) .",
    "second , and more importantly , there is no guarantee that the optimization in eq .",
    "[ eq : basicforwardmodelling0 ] will converge to its global minimum , for which @xmath27 .",
    "indeed , because @xmath25 is a nonlinear function of the negative synthetic signal , there is no guarantee that eq .",
    "[ eq : basicforwardmodelling0 ] is strictly convex with respect to the astrophysical properties captured in @xmath28 . in other words",
    ", there is no mathematical certainty that the forward modeling cost function contours are always similar to the convex parabolas shown in @xcite . under such pathological cases ( which are more prone to occur in high - dimensional ifs data ) ,",
    "the minimization can easily stall in local minima , thus yielding biased observables .",
    "this is an important and fundamental drawback stemming from _ self - subtraction_. up until now it could only be addressed using sophisticated nonlinear optimizers .",
    "+      in the case of _ over - subtraction _ the principal components do not depend on the astrophysical signal . as a consequence ,",
    "the propagation of @xmath28 through the algorithm is linear . using the example of the klip algorithm ,",
    "this can also be written as @xmath29 = p(\\mathbf{x } ) - \\mathcal{klip } [ \\widehat{a(\\mathbf{x})}]$ ] . in that case , the forward modeling cost function is truly quadratic and convex .",
    "unbiased astrophysical observables can be readily retrieved by direct application of eq .",
    "[ eq : basicforwardmodelling0 ] .",
    "appendix c and d describe how this can be implemented in practice , and how in the particular case of point sources with rdi there exist numerical algorithms more tractable than a brute force minimization of eq .",
    "[ eq : basicforwardmodelling0 ] .",
    "+ figure  [ fig : forwardrdi ] illustrates how in this configuration klip - fm yields unbiased photometry .",
    "this result was obtained using hubble space telescope - nicmos data and the klip algorithm when injecting a synthetic point source of known flux .",
    "the left panel shows the reduced images for four values of @xmath13 ( the number of principal components used for the data analysis ) and illustrates how the detectability of the point source changes with this parameter .",
    "when @xmath13 is too small , the point source is not detected .",
    "it only becomes apparent for larger values @xmath30 albeit with some residual spatially correlated speckle noise in the image ( e.g @xmath31 ) .",
    "this noise obviously contaminates the astrophysical observables .",
    "when @xmath32 the residual noise disappears ( @xmath33 ) but the point source has been significantly over - subtracted .",
    "the right panel of figure  [ fig : forwardrdi ] illustrates over - subtraction increasing with @xmath13 when forward modeling is not used . in this case , only the numerator of eq .",
    "[ eq::reffreeforwardmodellingphoto ] is taken into account .",
    "this corresponds to a matched filter or to cross - correlating of the reduced image of a point source , which captures the corrugations due to the data analysis algorithm , with the uncorrugated instrument psf . without forward modeling and for large @xmath13 ,",
    "the photometric estimate is wrong by a factor of three .",
    "however , when using forward modeling ( e.g. , eq .  [ eq::reffreeforwardmodellingphoto ] ) , we find that the injected photometry is retrieved at the @xmath34 level for @xmath13 that is large enough .",
    "this corresponds to the regime for which the residual speckle noise is sufficiently well behaved .",
    "unfortunately , most modern high - contrast instruments often privilege strategies combining adi+ssdi . in this case , the reference images do contain astrophysical signals and @xmath35 \\neq p(\\mathbf{x } ) - \\mathcal{klip } [ \\widehat{a(\\mathbf{x})}]$ ] ; as a consequence the method outlined in appendix c , which relies on only considering _ over - subtraction _ , is most often not applicable .",
    "in this paper we introduce an analytical expansion that quantifies the propagation of the astrophysical signal through klip , even the presence of _ self - subtraction_. moreover , we show that when the astrophysical signal is small , this expansion only depends on @xmath7 in a linear fashion .",
    "the proof of this result is described in appendix e , along with the linear algebra formalism necessary to implement it in computer calculations .",
    "we do not provide these technical details here , and we only focus on the implications of this expansion .",
    "moreover , instead of discussing the most general framework of appendix e , we here discuss the example of a faint point source detected in ifs data ( as in appendix f ) using the klip algorithm .",
    "the spectrum of this point source is @xmath36 .",
    "if the source is faint enough with respect to the speckles , then the principal components associated with any reference stack picked within a most general adi+ssdi observing sequence , can simply be written as : @xmath37 where @xmath38 is a matrix that only depends on the @xmath39 eigenpair and on the instrument psf : it does not depend on the point source s spectrum .",
    "in other words , in our example of a point source seen through an ifs , our analytical expansion captures the propagation of astrophysical signal through a least - squares speckles fitting algorithm ( klip here ) in a linear fashion : @xmath40 =   \\mathcal{klip } [ i_{\\psi}(\\mathbf{x } ) ] + f^t \\delta\\mathcal{klip } [ i_{\\psi}(\\mathbf{x}),psf(\\mathbf{x})]$ ] .",
    "the actual expression of this expansion is given in appendix e : eqs .",
    "[ eq : perturbepcasimple ] and [ eq : linearklperturbations ] . while this result is here presented in the context of pca - based algorithms , it",
    "can also be applied to algorithms that rely on linear combinations of images ( e.g loci ) .",
    "this in virtue of the direct equivalence between loci and klip discussed by @xcite .",
    "the three main terms in this expansion of @xmath41 have already been discussed in the literature in the context of loci .",
    "we describe them qualitatively here :    * the unperturbed principal components @xmath3 that capture the correlations of the instrument psf",
    ". these are normalized such that @xmath42 and are responsible for _ over - subtraction_. * the perturbation to the principal components that captures the _ direct self - subtraction _ associated with the presence of an astrophysical source at various parallactic angles and wavelengths in the observing sequence .",
    "if @xmath43 is the brightness of the astrophysical source , then this term scales as @xmath44 . in the case of loci",
    ", this term can be modeled by multiplying images of the astrophysical source at various parallactic angles and wavelengths by their corresponding loci coefficients .",
    "this is the term that @xcite correct in the case of disk imaging with adi . * the perturbation to the principal components that captures the _ indirect self - subtraction _ associated with correlations between the astrophysical signal and the speckles .",
    "this term scales as @xmath45 . in the case of loci+adi this term",
    "can be quantified by conducting the perturbation analysis of the loci coefficients introduced by @xcite .",
    "because the unperturbed eigenvalues are ordered by decreasing magnitude we can readily identify three regimes of astrophysical biases :    * when @xmath13 is small , _ over - subtraction _ dominates the biases .",
    "provided that the astrophysical source can be detected , the solution described in  2.3 can be applied . *",
    "when @xmath13 has an intermediate value , _ direct self - subtraction _ dominates the biases .",
    "provided that the astrophysical source can be detected , methods based on linear combinations of images ( e.g loci ) , along with the method described in @xcite are best suited .",
    "* when @xmath13 is large , which might be the only recourse for very faint astrophysical sources , _ indirect self - subtraction _ dominates the biases . in this configuration",
    "one can take advantage of our expansion to predict the influence of a synthetic negative source of spectrum @xmath46 : @xmath47 in other words , here we have applied our analytical expansion to propagate to the synthetic negative source through the data analysis algorithm : @xmath48 =   \\mathcal{klip } [ t(\\mathbf{x } ) ] - \\widehat{f}^t \\delta\\mathcal{klip } [ t(\\mathbf{x}),psf(\\mathbf{x})]$ ] . substituting this expression for @xmath49 into eq .",
    "[ eq : basicforwardmodelling0 ] yields a quadratic forward modeling cost function .",
    "this ensures that the forward modeling optimization will converge toward the global minimum ( e.g no pathological biases ) .",
    "moreover , because each evaluation of eq .",
    "[ eq : basicforwardmodelling0 ] is calculated only via a simple matrix multiplication ( see appendix f for details ) , forward modeling becomes numerically tractable even with highly dimensional astrophysical observables ( such as ifs data ) .",
    "this latter case is of course the most interesting one , for which previously published methods fail .",
    "we will highlight this configuration when presenting practical applications of eq .",
    "[ eq : perturbepcasimple0 ] in   3 and   4 .",
    "does not hold for bright point sources*. the two leftmost panels show the raw and klip processed images in the spectral channel centered around @xmath50 m of the gpi j - band filter .",
    "the middle panel shows a model of the klip processed image , predicted by eq .",
    "[ eq : linearklperturbations ] based on the principal components calculated in the absence of the synthetic source in the reference library and the model of the point source moving azimuthally / radially across the psf library .",
    "the two rightmost panels then show the horizontal and vertical cross section of both the actual and model - based klip images at the location of the injected synthetic source .",
    "while the images look like good matches , the cross sections do no perfectly overlap : the linear approximation does not hold in the case of point sources brighter ( top panel ) or as bright ( bottom panel ) as the local speckles and with relatively aggressive klip parameters.,title=\"fig:\",scaledwidth=50.0% ]   does not hold for bright point sources*. the two leftmost panels show the raw and klip processed images in the spectral channel centered around @xmath50 m of the gpi j - band filter .",
    "the middle panel shows a model of the klip processed image , predicted by eq .",
    "[ eq : linearklperturbations ] based on the principal components calculated in the absence of the synthetic source in the reference library and the model of the point source moving azimuthally / radially across the psf library .",
    "the two rightmost panels then show the horizontal and vertical cross section of both the actual and model - based klip images at the location of the injected synthetic source .",
    "while the images look like good matches , the cross sections do no perfectly overlap : the linear approximation does not hold in the case of point sources brighter ( top panel ) or as bright ( bottom panel ) as the local speckles and with relatively aggressive klip parameters.,title=\"fig:\",scaledwidth=50.0% ]     holds for bright point sources . *",
    "two leftmost panels show the raw and klip processed images in the spectral channel centered around @xmath50 m of the gpi j band filter .",
    "the middle panel shows a model of the klip processed image , predicted by eq .",
    "[ eq : linearklperturbations ] based on the principal components calculated in the absence of the synthetic source in the reference library and the model of the point source moving azimuthally / radially across the psf library .",
    "the two rightmost panels then show the horizontal and vertical cross section of both the actual and model based klip images , at the location of the injected synthetic source . on these cross - sections , both the data and mode overlap .",
    "when compared to figure  [ fig : perturbationdoesnotwork ] this example illustrates that simply changing the klip parameters to less aggressive settings yields better agreement between the actual reduced klip image and the linear model , both in the brighter than and as bright as speckles configurations.,title=\"fig:\",scaledwidth=50.0% ]   holds for bright point sources .",
    "* two leftmost panels show the raw and klip processed images in the spectral channel centered around @xmath50 m of the gpi j band filter .",
    "the middle panel shows a model of the klip processed image , predicted by eq .",
    "[ eq : linearklperturbations ] based on the principal components calculated in the absence of the synthetic source in the reference library and the model of the point source moving azimuthally / radially across the psf library .",
    "the two rightmost panels then show the horizontal and vertical cross section of both the actual and model based klip images , at the location of the injected synthetic source . on these cross - sections , both the data and mode overlap .",
    "when compared to figure  [ fig : perturbationdoesnotwork ] this example illustrates that simply changing the klip parameters to less aggressive settings yields better agreement between the actual reduced klip image and the linear model , both in the brighter than and as bright as speckles configurations.,title=\"fig:\",scaledwidth=50.0% ]    before delving into practical examples , we first study the validity of our linear approximation . the mathematical rationale associated with this aspect",
    "is described appendix e. we in particular direct the reader toward eq .  [",
    "eq : mainapprox ] which can be used priori to decide whether or not eq .",
    "[ eq : perturbepcasimple0 ] is valid .",
    "we illustrate the various regimes of this approximation using public gemini planet imager j - band data on beta pictoris , obtained in december 2013 as part of gpi commissioning activities .",
    "details about the observations and scientific implications are presented in . in this paper",
    "we do not discuss the exoplanet in this system and instead we inject synthetic planets at other locations in the gpi field of view .",
    "we chose this data for our numerical examples because gpi raw j - band data is dominated by speckles ( when compared to the results reported in @xcite ) and because beta pictoris is the brightest star with gpi public commissioning data in this filter .",
    "figures [ fig : perturbationdoesnotwork ] to [ fig : perturbationdoesworkfintnodetec ] illustrate how the linear model described by eq .",
    "[ eq : perturbepcasimple0 ] fares when compared with propagating numerically ( without any approximation ) a synthetic source through the klip algorithm .",
    "we carried out this test using target images from a single gpi exposure , without limiting the ensemble of potential references ( e.g. the target image is chosen for a given @xmath51 but the references are picked among all @xmath52 ) .",
    "there is no loss of generality associated with using a single exposure to illustrate the validity of eq .",
    "[ eq : perturbepcasimple0 ] , because it can easily be generalized by derotation and summation and over all exposures of an adi sequence .",
    "we start with figure  [ fig : perturbationdoesworkfintnodetec ] , which addresses the case of a point source that is too faint to be detected in raw ifs data .",
    "the top panel compares numerical klip data with the linear model for non - aggressive parameters .",
    "a detailed description of algorithm parameters is given in appendix a. for the sake of our discussions here ( and for the remainder of the paper ) the main consideration to remember is that `` aggressive '' corresponds to parameters that are tuned to reduce speckles very efficiently , and thus reveal the faintest underlying point sources . in the case of the top row of figure  [ fig : perturbationdoesworkfintnodetec ] , while the model fares very well , the injected point source ( at the same location as in the bottom panel ) is barely seen by eye and can not be distinguished from local speckles .",
    "on the other hand , when using the same geometry but more aggressive settings , the faint point source is detected .",
    "the cross sections in the bottom panel of figure  [ fig : perturbationdoesworkfintnodetec ] illustrate how the psf morphology of the injected source is very much altered by klip .",
    "this results in biases on the astrophysical estimates when the inference is carried out on these reduced images and in the absence of forward modeling .",
    "however , the results from numerical klip and the linear model are in very good agreement , even with an aggressively selected psf library , the cross sections corresponding to the reduced data and the linear model are completely indistinguishable .",
    "this demonstrates that the analytical expansion in eq .",
    "[ eq : perturbepcasimple0 ] does indeed capture with high fidelity the degradation of the astrophysical signal due to the speckle noise fitting algorithm . as a consequence one can in principle predict this degradation prior to any measurements and use our analytical model for unbiased astrophysical inference .",
    "+ on the other hand , figure  [ fig : perturbationdoesnotwork ] illustrates two cases for which the linear approximation in eq .",
    "[ eq : perturbepcasimple0 ] does not hold . indeed , as predicted in eq .",
    "[ eq : mainapprox ] the linear approximation is not valid for point sources brighter ( top panel of figure  [ fig : perturbationdoesnotwork ] ) or as bright as ( bottom panel ) as the local speckles when using relatively aggressive klip parameters .",
    "fortunately , figure  [ fig : perturbationdoeswork ] shows that simply changing the klip parameters to less aggressive settings yields better agreement between the actual reduced klip image and the linear model in both configurations ( point source brighter and as bright as speckles ) . in this case , the cross sections corresponding to the reduced data and the linear model are much closer one to another on figure  [ fig : perturbationdoeswork ] than on figure  [ fig : perturbationdoesnotwork ] ( albeit not matching perfectly ) .",
    "these cases are somewhat of limited interest because they operate in configurations for which the point source can be detected in raw ifs data ( either in a single slice or in an ifs cubes where it would stand immobile when compared to the speckles ) . for those brightnesses ,",
    "aggressive klip might not be needed .",
    "this illustrates the limitations of the perturbation method presented in  2.4 .",
    "it also emphasizes how the applicability of our analytical result can be extended to `` bright '' objects provided that the least - squares psf subtraction parameters are chosen to be non - aggressive .",
    "up until this point , our discussion , and in particular the analytical perturbation of principal components discussed in  .  2 ( and appendix e ) , was general and",
    "could be applied to extended objets .",
    "we now consider a more specific example , in which we show that eq .",
    "[ eq : perturbepcasimple0 ] can be used to estimate the spectrum of faint point sources in ifs data . because of the high dimensionality ( @xmath53 ) of the astrophysical observables potentially affected by self - subtraction , this problem is often considered as one of the most challenging in coronagraph data analysis . the injection of negative synthetics point sources and/or the direct minimization of eq .",
    "[ eq : basicforwardmodelling0 ] can be made tractable in the cases of rdi or adi .",
    "however , the presence of astrophysical signal at _ other wavelengths _ in the reference library ( e.g when using ssdi ) renders the spectral estimation problem very degenerate .",
    "these degeneracies , along with the large number of unknown astrophysical quantities , are an important obstacle to the spectral characterization of the fainter substellar companions discovered using modern high - contrast instruments ( see @xcite for examples ) . +   the linear expansion in eq .",
    "[ eq : perturbepcasimple0 ] can alleviate this problem entirely .",
    "indeed , the negative synthetic source can be propagated through the algorithm a priori , and thus inference can occur without having to compute multiple times the costly matrix inversion associated with klip . moreover , under the assumption that eq .",
    "[ eq : perturbepcasimple0 ] holds ( see discussion in   2.5 and in appendix e ) , it does capture in a linear fashion the actual degradation of the astrophysical signal due to over- and self - subtraction .",
    "when neglecting the higher order terms in @xmath46 in @xmath54 ( e.g for @xmath55 is small ) , the forward modeling cost function in eq .",
    "[ eq : basicforwardmodelling0 ] becomes quadratic .",
    "this ensures that there are no pathological cases for which klip - fm converges to a local minimum . in appendix",
    "f we describe in greater detail how to carry out astrophysical inference by injecting eq .",
    "[ eq : perturbepcasimple0 ] into eq .",
    "[ eq : basicforwardmodelling0 ] .",
    "there , we show that the spectral extraction consists of ( 1 ) running the klip algorithm , ( 2 ) building a wavelength and pixel dependent model of the point source propagated through the klip algorithm , ( 3 ) based on this model , building a @xmath56 matrix whose diagonal terms capture over - subtraction while off - diagonal terms capture self - subtraction , ( 4 ) invert this matrix to retrieve the spectrum of the detected point source .",
    "we insist here that while this method is mathematically equivalent to injecting a negative synthetic source into the data , we do not carry out the multidimensional minimization in eq .",
    "[ eq : basicforwardmodelling0 ]  as is. instead we rely on the formalism of appendix e and f to built a linear model of the corruption of the astrophysical signal and then invert this model .",
    "our algorithm thus does not feature a series of iterations to find the global minimum of eq .",
    "[ eq : basicforwardmodelling0 ] .",
    "of course this method is not perfectly suited to quantify the stochastic uncertainties associated with the extracted spectrum .",
    "however this `` frequentist '' approach has the benefit of being computationally cheap : in this first paper , we limit our examples to this simple inversion algorithm . as discussed in  3.3 , forward modeling",
    "can also be carried out in the bayesian sense : in this case , eq .",
    "[ eq : basicforwardmodelling0 ] ( along with adequate weighting to capture the properties of the residual noise ) becomes a likelihood function in which the contribution of the negative synthetic source is accounted for according to eq .",
    "[ eq : perturbepcasimple0 ] .              in order to test the klip - fm ifs spectral estimation algorithm described in appendix f",
    ", we inject point sources of known spectra in the gpi j - band beta pictoris public data set , and illustrate how this method can alleviate ssdi algorithmic biases . to do so , we study the three regimes illustrated in figures [ fig : perturbationdoesnotwork ] to [ fig : perturbationdoesworkfintnodetec ] , using two types of underlying spectra for the synthetic sources : a flat spectrum ( in units of contrast : same point source to star flux ratio as a function of wavelength ) and a sharp triangular spectrum .",
    "these two cases can be considered , respectively , as the most and least challenging in terms of high - contrast ifs spectral estimation .",
    "indeed , the former is particularly difficult because the presence of the point source at other wavelengths in the reference images yields a `` local derivative '' of the spectrum after klip or loci , see @xcite . as a consequence ,",
    "retrieving a flat spectrum might be difficult using the simple inversion described above .",
    "on the other hand , a sharp triangular spectrum , with a significant fraction of the bandpass for which the point source s flux is small , might be intuitively more amenable to this type of analysis . in this section",
    "we again illustrate the performances of klip - fm in various configurations by using only one data cube for the target image .",
    "+        figure  [ fig : brightandmiddlenonagressive ] illustrates how the estimated spectrum varies as a function of the number of principal components ( @xmath13 ) when the injected source has a sharp spectral feature whose maximum flux is brighter ( left column ) and as bright ( right column ) as the speckles .",
    "the top row shows the estimated spectrum when using aperture photometry and the bottom row when using klip - fm .",
    "the solid thick line represents the injected spectrum and each thin dashed line is an estimated spectrum that corresponds to @xmath57 ( where @xmath58 is the number of images in the psf library ) .",
    "it was generated using non - aggressive parameters close to the ones in figure  [ fig : perturbationdoeswork ] . because indirect self - subtraction , which scales as @xmath59 , worsens when increasing the number of klip modes , one expects that the estimated spectrum after klip in the absence of forward modeling to vary as @xmath13 increases .",
    "this is exactly the behavior that the top two panels of figure  [ fig : brightandmiddlenonagressive ] ( and subsequent figures ) exhibit . on the other hand , self - subtraction",
    "is accounted for with forward modeling and thus the estimated spectrum should in principle not depend on @xmath13 ( provided that the residual speckle noise is small enough and that the linear approximation is valid ) .",
    "again , this is exactly what happens on the bottom panels of figure  [ fig : brightandmiddlenonagressive ] : klip - fm reduces the sensitivity of the estimated spectrum to @xmath13 and brings the estimated spectrum closer to the injected one .",
    "however , in cases for which the point source is at least as bright as the speckles , forward modeling is not absolutely necessary because aperture photometry after klip with non - aggressive reductions still yields an estimate of the spectrum within @xmath60 of the injected signal ( top panels ) .",
    "this is because over - subtraction does not depend on @xmath4 , and direct self subtraction only scales as @xmath61 . in this context klip - fm",
    "is a tool to reduce uncertainties .",
    "this is of course only true when using algorithm parameters chosen so that eq .",
    "[ eq : perturbepcasimple0 ] holds . indeed , when the point source is relatively bright and the speckle fitting is aggressive , eq .",
    "[ eq : perturbepcasimple0 ] does not hold and biases still remain after klip - fm when comparing the estimated and injected spectra .",
    "this is illustrated on figure  [ fig : brightandmiddleagressive ] : in spite of a somewhat reduced sensitivity to @xmath13 a significant offset remains between injected and extracted spectra .",
    "+ such considerations do not apply to point sources fainter than the speckles , for which eq .",
    "[ eq : perturbepcasimple0 ] is always valid .",
    "we discuss results obtained in this configuration using both flat ( left columns ) and peaky ( right columns ) spectra along with non - aggressive ( figure  [ fig : faintnonagressive ] ) and aggressive ( figure  [ fig : faintagressive ] ) klip settings . in the case of non - aggressive subtractions ,",
    "the post - klip aperture photometry spectra are significantly biased by residual speckle noise . because klip - fm still operates under the assumption that the residual speckle noise is well behaved ( e.g @xmath62 ) , which is clearly not applicable to this case , forward modeling does still yield biases in both the flat and peaky spectra configurations ( figure  [ fig : faintnonagressive ] ) .",
    "this ought to be expected for such algorithm settings that do not seek to reach the absolute best speckle least - squares fitting , yielding the type of correlated residuals illustrated in the top panel of figure  [ fig : perturbationdoesworkfintnodetec ] . on the contrary",
    ", figure  [ fig : faintagressive ] , which was obtained using aggressive settings this time , shows that the bright portion of a peaky spectrum becomes very close to the injected spectrum when using klip - fm . as a matter of fact ,",
    "the spectral fidelity in this case is almost as good as figure  [ fig : brightandmiddlenonagressive ] , even though the injected point source is @xmath63 times fainter . as predicted",
    ", results using a flat spectrum exhibit somewhat lesser fidelity : in particular both the aggressive and non - aggressive settings seem to yield similar biases . however , these biases are much smaller in the case of klip - fm than without using forward modeling . even in this worse - case scenario of a point source with a flat spectrum , only detectable at the @xmath64 level",
    "( see images in the bottom panel of figure  [ fig : perturbationdoesworkfintnodetec ] ) , residual biases are at the @xmath65 level , which is well below the statistical uncertainties that ought to be expected for the low - significance detections we simulated here .",
    "figures  [ fig : brightandmiddlenonagressive ] to [ fig : faintagressive ] clearly demonstrate how klip - fm reduces the systematic biases associated with spectral extraction of faint point sources in ifs coronagraph data",
    ". however deviations from the injected spectrum are noticeable in the case of fainter point sources .",
    "this is in spite of the fact that the final estimated spectrum is a much weaker function of @xmath13 , which we use here as a proxy to establish the ability of klip - fm to correct for over- and self - subtrcation .",
    "we investigated this feature by carrying out the same analysis as in figures  [ fig : brightandmiddlenonagressive ] to [ fig : faintagressive ] except that in a first step we set the flux of the injected point source to zero to quantify the residual speckles floor . for illustration , the estimated spectrum obtained under this null hypothesis",
    "is given in the top panel of figure  [ fig : extrabias ] .",
    "subtracting this `` residual speckle noise flux '' to the klip - fm spectral estimate yields the bottom panel of figure  [ fig : extrabias ] .",
    "we indeed obtain a bias - free estimated spectrum in the bright channels of the spectrum .",
    "we confirm by eye inspection that the bluer end of the spectrum corresponds to non - detections , which explains the remaining offset .",
    "we find a similar outcome when repeating this test for all the configurations shown on figures  [ fig : brightandmiddlenonagressive ] to [ fig : faintagressive ] .",
    "the test on figure  [ fig : extrabias ] illustrates that with klip - fm , spectral estimation is not limited by over- and self - subtraction . by and large",
    "the post post - klip - fm biases stem from the residual speckles in the reduced images .    of course in practice",
    "this null test can not be carried out and the estimated spectrum , along with its associated uncertainties , will be affected by poorly subtracted speckles .",
    "when using a full adi sequence this will be alleviated by co - adding cubes over time , in virtue of the central limit theorem , as described in @xcite . in that respect ,",
    "our non - adi single cube test is somewhat of a pessimistic configuration .",
    "if the observing strategy does not include adi , the brightness of the residual speckles can also be minimized by adjusting klip parameters ( within the range for which the linear approximation remains valid , as discussed in  2.5 ) .",
    "regardless of these adjustments , the estimation of confidence intervals associated with the now unbiased klip - fm extracted spectrum is of critical importance for astrophysical inference . most often , these confidence intervals are calculated by injecting and extracting synthetic point sources at various positions in the coronagraph field of view .",
    "errors bars associated with this process include contribution of both the possible algorithmic biases and of the residual post - processed speckles .",
    "using klip - fm makes the former term negligible .",
    "correlations between spectral channels ( associated with the latter term ) can also be estimated based on residual noise statistics at other locations than the one of the detected point source .",
    "all of these approaches yield realistic confidence intervals under the assumption that the noise properties are spatially uniform across the field of view ( or at least over all azimuths at a given angular separation ) .",
    "when using a ground - based adaptive optics system , this assumption is not always true due to signatures of the wind direction in the coronagraph psf .",
    "our forward modeling approach alleviates this assumption since it enables the estimation of confidence intervals based the contribution of the residual speckles _ at the location of the point source_. this can be achieved by estimating spatial and spectral co - variances at positions where astrophysical signal is absent and introducing them into eq .",
    "[ eq : basicforwardmodelling0 ] so it becomes a true likelihood function in the baysian sense ( see @xcite for details on how the spectral correlation can be included ) .",
    "this represents significant progress when compared with the present state , in particular for data sets that feature significant residuals associated with atmospheric wind .",
    "however a full end to end demonstration of this approach is beyond the scope of this paper and we leave out this analysis to an upcoming publication ( wang et al .",
    ", in preparation ) .",
    "except that the flux of the synthetic point source was set to zero .",
    "_ bottom , _ when subtracting this `` residual speckle noise flux '' to the klip - fm spectral estimate we find indeed that we can obtaine a bias - free extracted spectrum in all the spectral channels for which there is a statistical significant detection , scaledwidth=50.0% ]",
    "we now tackle the actual detection problem , which is the decision process that chooses whether or not to trigger a detection alarm and take action accordingly ( in the case of a first epoch this action consists of carrying out confirmation observations ) .",
    "this problem has been extensively discussed by . here",
    "we revisit these results in the context of klip - fm .",
    "a detection algorithm can be seen as an observer that estimates the probability that flux in a given set of pixels originates from an astrophysical signal rather than scattered starlight ( speckles ) or other sources of noise . because the characteristic scales of speckle noise mimic the presence of a planet for most classes of observers , a preliminary routine aimed at calibrating this noise is necessary . in this paper",
    "we discuss algorithms based on least - squares psf fitting for this denoising step .",
    "after this has been carried out , statistical inference regarding the presence of a certain class of point sources , or lack thereof , then occurs using the chosen observer .",
    "if a given combination of pixels ( as defined by the observer ) is above a given threshold ( often chosen to minimize the false positive rate ) , then an alarm is triggered and follow - up observations are carried out . on the other hand ,",
    "if no alarm is triggered , the range of astrophysical objects that are absent from the data ( e.g completeness ) is then quantified in order to inform the statistical distribution of such object across the ensemble of stars observed ( see work by for recent exoplanet surveys ) . in this section",
    "we describe how , for a given set of chosen algorithm parameters , klip - fm can keep the false positive rate similar to the one obtained without forward modeling while significantly increasing completeness .",
    "injection of true positives , at separation of @xmath66 and random azimuthal positions .",
    "_ left : _ the observer measures the maximum of the counts in an aperture the size of the fwhm of a psf in the `` blue '' channels , at the base of the spectral feature , in both the klip+apphot and the klip - fm cases .",
    "_ right : _ the observer measures the maximum of the counts in an aperture the size of the fwhm of a psf in the `` red '' channels , at the peak of the spectrum , in both the klip+apphot and the klip - fm cases . in both cases",
    "we find that using forward modeling in conjunction with klip fares better that simply using aperture photometry after klip .",
    "klip - fm shifts to the right the `` point source present '' histogram while only slightly changing the tail of the histogram associated with no signal .",
    "this reduces the area of the `` confusion zone '' , where the two histograms overlap.,scaledwidth=45.0% ]      our goal is to quantify the efficiency of klip - fm when applied to the detection problem . to do",
    "so we compare two types of observers :    * de - noising with klip and then aperture photometry ( denoted klip+apphot ) . * de - noising with klip and then inversion of eq .",
    "[ eq : simplemat ] ( klip - fm ) .",
    "we depart from the common practice in the high - contrast imaging community that consists of comparing the local signal - to - noise ratio ( s / n ) of images obtained using various algorithms .",
    "instead we follow the prescription described in @xcite and recently revisited by @xcite .",
    "using such metrics is now becoming common practice in high - contrast imaging . note that this approach was also pointed out by @xcite , who demonstrated that the rigorous way to assess the efficiency of various joint denoising and detection methods is to study them under the paradigm of minimizing the false positive fraction ( fpf ) while maximizing the true positive fraction ( tpf ) .",
    "for the sake of brevity we do not recall the formal definition of these quantities , and refer the reader to the excellent presentations in @xcite . in practice",
    "the fpf and tpf can be estimated using numerical simulations as follows :    * we choose a hypothesis for the underlying population of astrophysical signal we want to test : this includes the brightness of the point sources , their separation from the star , and their underlying spectrum .",
    "* we generate a series of @xmath67 data sets : @xmath68 of them have a signal as prescribed in the previous step , the other @xmath68 do not have signal ( e.g their brightness has been set to zero ) .",
    "this latter data set serves as a null hypothesis test in the assessment of the data analysis algorithm .",
    "* we propagate these data sets through each denoising+observer algorithm whose performance we want to assess .",
    "* based on these simulations , we build the empirical probability density function ( pdf ) of the scalar metrics given by each observer under both the signal present and absent hypotheses .",
    "this yields the histograms shown in figures  [ fig : probablitiesfaint ] and  [ fig : probablitiesbright ] . *",
    "the fpf captures the probability that , for a given threshold , the observer will classify an event as an astrophysical detection while it is actually stemming from noise realizations .",
    "it is thus calculated as the area under the curve of the `` no point source '' histogram , from the threshold to @xmath69 . *",
    "the tpf measures completeness ( i.e.,the probability that astrophysical signal will be classified as such and not as noise ) .",
    "it is thus calculated as the area under the curve of the `` point source '' histogram , from the threshold to @xmath69 .",
    "* we then move the threshold from the left to the right of each histogram and compute the fpf and tpf at each threshold value .",
    "this yields the receiver operating characteristic ( roc ) , which is parametric curve describing @xmath70 .",
    "this roc can then be used to compare denoising+observers methods .",
    "injections of true positives , at separation of @xmath66 and random azimuthal positions .",
    "_ left : _ the observer measures the maximum of the counts in an aperture the size of the fwhm of a psf in the `` blue '' channels at the base of the spectral feature in both the klip+apphot and the klip - fm cases .",
    "_ right : _ the observer measures the maximum of the counts in an aperture the size of the fwhm of a psf in the `` red '' channels at the peak of the spectrum in both the klip+apphot and the klip - fm cases . in both cases",
    "we find that using forward modeling in conjunction with klip fares better than simply using aperture photometry .",
    "klip - fm shifts to the right the histogram of counts associated with point source signal injected in the data while only slightly changing the tail of the histogram associated with no signal .",
    "this reduces the area of the `` confusion zone , '' where the two histograms overlap.,scaledwidth=45.0% ]    as described extensively in the imaging science literature ( @xcite and references therein ) , having the roc follow a straight line between the @xmath71 and @xmath72 implies that tpf and fpf are always equal for all values of threshold : the observer is no better than a coin toss . on the other hand , having the roc follow a perfect elbow from @xmath71 to @xmath73 to @xmath72 implies that there exists an optimal value for the threshold for which the  no point source \" and  point source \" histograms do not overlap at all , thus enabling the recovery of all possible astrophysical signal without any false positive . in this case",
    "the observer is ideal . in this framework",
    "the area integrated under the roc curve ( auc ) is the figure of merit that quantifies the performances of a given denoising+observer combination .",
    "we ran a series of numerical tests to compare the performance of klip+aperture photometry and klip - fm under this metric .",
    "figures [ fig : probablitiesfaint ] and [ fig : probablitiesbright ] show the histograms of observed counts in the wavelengths around the base and the maximum of a sharp triangular spectrum for synthetic companions fainter and as bright as the speckles .",
    "similar extractions were also conducted without injecting companions and the null hypothesis histograms as also reported in figures [ fig : probablitiesfaint ] and [ fig : probablitiesbright ] .",
    "these figures were generated using @xmath74 injections of true positives at separation of @xmath66 and at random azimuthal positions .",
    "based on these , we then calculate the roc corresponding to each configuration , as shown in figure  [ fig : rocs ] . in all cases , we find that using forward modeling in conjunction with klip fares better than simply using aperture photometry after this algorithm . a closer look at figures [ fig : probablitiesfaint ] and [ fig : probablitiesbright ] illustrates how klip - fm does shift to the right the histogram of counts when an astrophysical signal is present , while only slightly changing the tail of the histogram associated with and absent signal .",
    "this reduces the area of the  confusion zone, where the two histograms overlap , and increases the area under the roc .",
    "this is particularly striking in the left panel of figure  [ fig : probablitiesfaint ] for which both histograms without forward modeling almost completely overlap and result in a straight roc between @xmath71 and @xmath72 ( e.g. coin toss ) .",
    "klip - fm , under similar conditions , does yield an roc that can operate at @xmath75 completeness only with @xmath76 fpf . note that these tests were carried out for aggressive least square subtraction settings and that the difference between aperture photometry and klip - fm is less striking when using less aggressive klip configurations . +",
    "it is important to remember that here we do not discuss a new algorithm to remove speckles more efficiently ( such as the one presented in @xcite ) ; as a matter of fact the actual images underlying the two methods compared in this section are _",
    "the only difference between these methods resides in analyzing these images using a forward model for over- and self - subtraction . inverting this model then yields a retrieved signal for true astrophysical sources that is now less impacted by flux losses .",
    "this reduces the `` confusion zone '' illustrated in figures [ fig : probablitiesfaint ] and [ fig : probablitiesbright ] . here",
    "comparisons were limited to klip with and without forward modeling in the case of an aperture photometry observer ( e.g the fitting zone @xmath77 in klip - fm was chosen to be equal to the aperture in klip+apphot ) .",
    "future investigations are needed to assess the gain when using forward modeling with more sophisticated observers , such as the ones presented in @xcite .",
    "our work was limited to speckle fitting in the least - squares sense , applying perturbation methods to the more sophisticated costs functions such as presented @xcite would also be of great interest .",
    "separation : fainter than the speckles ( top ) and as bright as the speckles ( bottom ) .",
    "* the area integrated under the roc curve ( auc ) is the figure of merit that quantifies the performances of a given denoising+observer combination . in all cases",
    "we find that using using forward modeling in conjunction with klip increases this figure of merit .",
    "for instance , in the case of the `` blue '' channels of companions that are fainter than the speckles ( top ) then @xmath78 for all possible values of thresholds without forward modeling . on the other hand , klip - fm results in the existence of an `` optimal threshold '' ( at the elbow of the roc ) for which @xmath79 .",
    "the thickness of the lines indicated the uncertainties of the roc due to the coarse resolution of our numerical experiment ( @xmath74 ) .",
    "however this does not change our conclusion that , by and large , klip - fm does increase the tpf for a given fpf when compared to klip without forward modeling .",
    ", scaledwidth=50.0% ]      finally we illustrate how this procedure can also be used in a more systematic manner for `` planet search . ''",
    "instead of building a model for hypothetical point sources scattered across the field of view , we present here a point - wise implementation of klip - fm that inverts eq .",
    "[ eq : simplemat ] _ at each point the the astrophysical scene , one at a time_. figure  [ fig : finalcomparisonklipfmimage ] was generated using this method over a portion of the gpi field of view , with a synthetic companion that is five times fainter than the local speckles , aggressive psf subtraction parameters , and we only used one gpi data - cube .",
    "the leftmost column of each panel figure  [ fig : finalcomparisonklipfmimage ] shows the images from the klip algorithm , and the next column shows the flux across wavelengths obtained with point - wise klip - fm .",
    "the two right columns show the horizontal and vertical cross section of both images at the location of the injected point source .",
    "this figure highlights the four advantages of point - wise klip - fm :    * in the low flux channels , denoted as @xmath80 , and @xmath81 m , the klip image features hints of faint flux at the location of the injected point source , but the single wavelength detection is much more convincing in the left column with point - wise klip - fm .",
    "this is in part due to the convolution by the instrument psf , which would occur regardless of forward modeling .",
    "however this is also due to the fact that inverting eq .",
    "[ eq : simplemat ] does shift to the right the signal present histogram ( as shown in figure .",
    "[ fig : probablitiesfaint ] ) , thus helping to discriminate faint astrophysical signals from residual speckle noise .",
    "* in all channels the centroid of the signal after klip is very much affected by the over / self - subtraction .",
    "on the other hand , with point - wise klip - fm , the maximum of the retrieved signal is at the location of the injected source in the channels for which the residual speckle noise is uncorrelated .",
    "this is highly beneficial when using detection metrics that rely on the stability of the point source location as a function of wavelength .",
    "it also has significant advantages for astrometry .",
    "* in all channels the point - wise klip - fm counts correspond to the unbiased spectrum of the point source ( see   4 ) .",
    "* for all locations corresponding to non - detections , over / self - subtraction have also been corrected ; such images can be readily used to derive detection limits .    in spite of all these advantages , point - wise klip - fm ,",
    "as implemented to generate figure  [ fig : finalcomparisonklipfmimage ] , presents one major drawback : it is painstakingly slow and memory hungry ( generating figure  [ fig : finalcomparisonklipfmimage ] , for only one gpi data cube and a small fraction of the field of view , required a day of computations on a standard macbook pro laptop ) . carrying out the forward model construction and inversion `` as is '' , over the entire field of view of a coronagraph imager and over an entire observing sequence is thus prohibitively expensive computationally .",
    "however , simplifications exist : in particular the exceedingly large intermediate matrices of appendix e and f need not to be evaluated in all cases .",
    "one can show that temporary variables of lower dimensionality can be used instead .",
    "the linear algebra details associated with these simplifications is beyond the scope of this paper and will be presented in a latter communication ( ruffio et al .",
    ", in preparation ) .",
    "here we simply use our computationally inefficient implementation point - wise klip - fm to illustrate on figure  [ fig : finalcomparisonklipfmimage ] that this algorithm has the potential to become a very powerful tool for exoplanet detection via direct imaging .",
    "in this paper we introduced a linear expansion that captures the impact of over / self - subtraction in high - contrast imaging data .",
    "this is done in the most the general case for which the reference images of the astrophysical scene move azimuthally and/or radially across the field of view ( adi and/or ssdi ) .",
    "this method is based on perturbing the covariance matrix underlying any least - squares speckles problem and propagating this perturbation through the data analysis algorithm .",
    "most of the work in this paper has been presented in the pca framework , but it can be easily generalized to methods relying on linear combinations of images ( instead of eigenmodes ) .",
    "based on this linear expansion , we then demonstrated how this new algorithm could be used in practice .",
    "we first considered the case of the spectral extraction of faint point sources in ifs data ( under the adi+ssdi observation strategy ) and illustrated , using public gemini planet imager commissioning data , that our novel perturbation - based forward modeling can indeed alleviate algorithmic biases .",
    "we then applied klip - fm to the detection of point sources and showed how it decreases the rate of false negatives while keeping the rate of false positives unchanged , when compared to classical klip .",
    "+ beyond these two examples , our analytical result is broadly applicable to a wide range of high - contrast science :    * _ planet detection : _ should the point - wise klip - fm described in  4.3 be improved upon so it can be implemented in an efficient manner , it will facilitate the detection of the faintest end of the point sources buried in the residual speckles of ongoing surveys .",
    "note however that this gain will only occur if astronomers relax their standards to trigger follow - up observations .",
    "indeed , for very faint planets if the threshold is solely based on a fpf @xmath82 then the tpf will be close to @xmath83 regardless of whether or not forward modeling is used .",
    "this is illustrated in figure  [ fig : rocs ] , for the faintest example considered in this paper .",
    "however , if a fpf of @xmath76 is tolerated , then forward modeling will bring the completeness , or tpf , up @xmath75 . without forward modeling , increasing the allowable fpf to @xmath76 only brings completeness up to @xmath76 , which is still no better than a coin toss .",
    "this demonstrates loosening detection threshold might be benefitial , now that we are equipped with a tool that can greatly increase completeness at only a modest cost in observing efficiency ( in our example , one in five follow - up observations is triggered based on a bright speckle instead of a true astrophysical point source ) .",
    "given the paucity of currently directly imaged exoplanets , we argue that the experimental design of ongoing surveys should consider such an option . *",
    "_ planet detection : _ in this manuscript we only considered observers that integrate flux over an aperture ( with and without forward modeling ) .",
    "more sophisticated observers such as the ones presented in @xcite could be used . moreover",
    ", the linear model developed here could also be used in a bayesian framework .",
    "it was recently shown that a simple model of dual - image adi subtraction in such a framework was an effective method for the detection of faint sources .",
    "because of the analytical derivation presented herein , similar work can now be conducted using more sophisticated pca - based denoising algorithms . * _ detection limits in ifs data : _ in the case of non - detections , completeness is estimated for each hypothesis regarding the potential astrophysical signal that was not observed . in the case of broadband imaging with rdi or adi ,",
    "this ensemble of astrophysical hypothesis is of low dimensionality because the observables are simply separation and integrated brightness . in the case of ifs observations ,",
    "this dimensionality significantly increases .",
    "moreover , when using sdi or ssdi , the roc , and thus the completeness , varies as a function of the hypothesized underlying spectrum .",
    "this significantly complicates the population statistics for this type of observation , and is one of the outstanding problems for the statistical analysis of ongoing large high - contrast surveys with ifs @xcite . in appendix",
    "f we briefly describe how klip - fm could be used to address this issue , but leave out numerical examples for future work . *",
    "_ astrometry : _ point - wise forward modeling can be carried out at the subpixel level around a first guess for the location of a detected point source . this in principle should yield high precision astrometry , even when using adi and/or ssdi .",
    "we will demonstrate the performances of this method in a future paper ( wang et al .",
    "2016 , in preparation ) .",
    "* _ retrieval of physical properties of planets _ : as discussed in  3 , because of its simplicity eq .",
    "[ eq : forwardmodellingspectra ] is amenable to be used within a bayesian framework to evaluate correlated uncertainties associated with the spectrum of a faint point source .",
    "one could also directly fit the physical model `` in the data '' by using eq .",
    "[ eq : forwardmodellingspectra ] as the cost function in retrieval codes , such as the one recently presented in @xcite . * _ disk imagery and characterization : _ the biggest practical difference between high - contrast disk imagery and point source detection resides in the choice of optimal least - squares reduction parameters . in this paper",
    "we presented a forward modeling that is parameter independent , and as a consequence all our discussions are in principle applicable to disk imaging and characterization .",
    "note however that in practice forward modeling with disks is complicated by the fact that eq  [ eq : convol ] can not be simplified to by using a simple psf as the astrophysical model : every hypothetical disk morphology instead has to be explored .",
    "the amount of work required to robustly devise these algorithmic improvements and thoroughly test them goes beyond the scope of what can be achieved by a single individual .",
    "it is our hope that the community will conduct the potentially important investigations in data analysis development outlined here in a collaborative manner and include promising advances in publicly available tools , such as @xcite .",
    "we thank the two anonymous referees for their feedback and extremely important suggestions which made this paper significantly more readable .",
    "this manuscript also benefited from critical inputs from the entire gemini planet imager team .",
    "in particular dimtry savransky who carefully went over the linear algebra presented in the appendices ; abhiji rajan , kim ward - duong and marshall perrin who provided insightful suggestions on the writing and presentation ; christian marois and kate morzinski who provided important suggestions regarding the context of the paper .",
    "the vast majority of the results in   4 stemmed from initial discussions during the exoplanet imaging workshop whose findings are presented in @xcite .",
    "finally this paper would have never been written without jason wang and jean baptiste ruffio who were able to confirm the findings presented herein using a separate implementation of klip - fm and made their code available to the community @xcite .",
    "* reminder of the structure of the appendices : *    * appendix a provides the most general formalism for an adi + ssdi observing sequence and lays out the formal foundations for our work . *",
    "appendix b summarizes the notations appendix a in a table format . in order to facilitate numerical implementation",
    ", it provides the dimensions of the various matrices discussed in this paper .",
    "* appendix c introduces the formalism underlying forward modeling in the most general case , and then discusses the specific configuration of rdi .",
    "this was already presented in @xcite , but serves to set up the stage for appendix f. * appendix d describes how to carry out forward modeling for the astrometry and photometry of point sources for rdi within the framework of the linear algebra notations introduced in appendix a and c. * appendix e contains the proof of our novel analytical expansion .",
    "it heavily relies on the notations introduced in appendix a. it contains the key innovation of the present manuscript . *",
    "appendix f describes how to take advantage of the result in appendix e to carry out forward modeling in order to estimate the spectrum of point sources in ifs data .",
    "in this appendix we provide a detailed description of our mathematical notations regarding the most general case of a high - contrast observing sequence and a generic implementation of the klip algorithm ( e.g we do put table [ tabnotations ] into words ) .",
    "note that all the material in this appendix has already been discussed in the literature , but is revisited here in order to provide a rigorous framework for the latter introduction of the klip - fm algorithm .",
    "an illustration of the algorithm parameters discussed here is given in fig .",
    "[ fig : cartoonparameters ]      we consider the general case of an observing sequence with an integral field spectrograph ( ifs ) and in the presence of field rotation ( adi ) .",
    "an image , @xmath84 at the wavelength @xmath85 and at time @xmath86 ( parallactic angle @xmath87 ) , within the observing sequence , can be written as : @xmath88 ) \\label{eq : genrealframe}\\ ] ] where :    * @xmath89 is the focal plane intensity associated with speckles ( integrated over the narrow bandpass around @xmath85 at time @xmath86 ) that results from a random realization @xmath90 of the telescope + instrument wavefront .",
    "* @xmath1 are the 2d coordinates across the field of view .",
    "* @xmath43 is equal to zero if there is no astrophysical signal . if an object is present , it is equal to the integrated photometry of the astrophysical source over the entire bandpass of the ifs . *",
    "@xmath91 $ ] is the normalized spectrum of the object .",
    "namely , if the actual spectrum of the object at the resolution of the ifs is @xmath92 $ ] then @xmath93 and @xmath94 .",
    "* @xmath95 is the image at @xmath85 of the astrophysical source , at the spatial resolution of the instrument , rotated north up .",
    "* @xmath96 corresponds to the 2d rotation matrix with respect to the stellar location associated with the azimuthal motion of the astrophysical source across the adi observing sequence .",
    "@xmath97 corresponds to the parallactic angle ( direction of north in the images ) which varies across an adi sequence . *   throughout the paper @xmath1 corresponds to the 2d coordinates across the field of view . in the linear algebra formalism discussed in the appendices , and for practical implementations , these two dimensions can be collapsed onto one .",
    "for instance if @xmath1 describes all the possible pixel coordinates across the field of view ( of size @xmath98 ) , then x is a @xmath99 array .",
    "pca - based reduction algorithms use a well - chosen library of images to build an empirical model of the speckle noise realization associated with each target image within the observing sequence .",
    "each empirical model is then subtracted from its corresponding target image in order to increase the s / n of potential astrophysical sources . without a loss of generality ,",
    "we choose here the target image at wavelength @xmath100 at at the exposure starting at @xmath51 ( parallactic angle @xmath101 ) .",
    "@xmath102).\\ ] ] the corresponding reference library is then assembled by choosing among all other possible images with @xmath103 .",
    "this captures the most general configuration discussed in this paper .",
    "of course there exists observing scenarios for which it greatly simplifies :    * when using rdi ( a psf library built using images of other sources ) and under the assumption that the library has been built to be `` signal free '' ( see for instance @xcite ) , then the astrophysical signal is only present in the target image @xmath104 . in this case",
    "@xmath105 for all images in the reference in the psf library and thus @xmath106 .",
    "these are the shorthanded notations described in @xcite ( here the state of the telescope+instrument @xmath107 does not depend on time and wavelength , it is simply indexed over the ensemble of reference stars ) . * when using angular differential imaging ( adi ) with non - ifs data ( or when using ifs data that excludes images at other wavelengths from the psf library ) , we can drop the wavelength dependence for both the spatial scaling of the speckle noise and the brightness of the potential astronomical objects .",
    "then eq .",
    "[ eq : genrealframe ] reduces to : @xmath108).\\ ] ] where @xmath109 is now a scalar instead of a vector .",
    "the first step in least - squares speckles fitting is to build for each @xmath110 its corresponding ensemble of reference psfs @xmath111 by choosing among all other possible images with @xmath103 . in the most general case ( e.g",
    "when using ssdi and adi ) all ifs slices are first spatially rescaled to @xmath100 , so that the characteristic scale of the speckle noise in the references matches the noise in the target image .",
    "thus , the reference images are : @xmath112 ) \\label{eq : imageplanet}\\ ] ] in the case of adi only , this rescaling is not necessary and the wavelength dependence can be dropped .",
    "the flux normalized astrophysical scene seen by the instrument can be written as the convolution of the sky @xmath113 by the instrument psf : @xmath114 where the wavelength and field dependence of the coronagraphic psf are captured in the subscripts of @xmath115 . using these notations and neglecting psf field dependence , the motion of the astrophysical signal at given field point @xmath116 associated with wavelength scaling and field rotation ",
    "@xmath117)$] is captured by @xmath118)$ ] , with : @xmath119 & = & \\mathbf{x_\\mathcal{s } } +   \\delta^{(\\lambda_{0},t,\\lambda ) } \\mathbf{x_\\mathcal{s}}\\\\   \\delta^{(\\lambda_{0},t,\\lambda ) } \\mathbf{x_\\mathcal{s } } & = & ||\\mathbf{x_\\mathcal{s}}||   \\frac{\\lambda}{\\lambda_{0 } } ( \\cos(\\theta_t ) \\mathbf{n } + \\sin(\\theta_t )   \\mathbf{e})\\end{aligned}\\ ] ] where @xmath120 are the unit vectors pointing north and east .",
    "@xmath121 is a 2d vector that relates the position in the field of view of a hypothetical point source in the science image of interest at @xmath122 to its position in each one of the spatially the rescaled reference images ( at @xmath123 ) .",
    "this motion of the astrophysical scene with respect to the speckle noise across the instrument field of view is key to building psf libraries for which the signal in the reference psfs is not located at @xmath116 ( thus enabling local empirical fitting of the speckles only , with `` minimal contamination from the signal '' ) .      .",
    ", scaledwidth=70.0% ]    [ ref : selcrit ] more formally , we build such a collection of reference images by ensuring that @xmath124 is large enough so that there is no ( or little ) astrophysical signal at @xmath116 in the psf library .",
    "we write these references as @xmath125 .",
    "this library is constructed over subsections of the image , or subtraction zones @xmath16 , centered on @xmath116 . here",
    "we parameterize these zone in polar coordinates : radial extent @xmath126 ( or @xmath127 annuli across the field of view ) or azimuthal extent @xmath128 ( or @xmath129 sectors per annulus ) .",
    "note that in this paper we do not follow the method described in @xcite , which splits the geometry of the problem between optimization ( @xmath130 ) and subtraction zones ( @xmath16 ) and we solely focus on the case for which @xmath131 .",
    "however , in principle , the klip - fm formalism is also applicable when @xmath16 is a subregion of @xmath130 .",
    "we write @xmath132 and @xmath133 as the radial and tangential unit vectors in the direction of @xmath134 . whether or not an image is included in this library",
    "is then decided using a combination of the following criteria :    * @xmath135 such that @xmath136 to account for the minimal motion of a source due to field rotation .",
    "@xmath137 is the full width at half maximum of the instruments s psf at wavelength @xmath138 .",
    "* @xmath135 such that @xmath139 to account for the minimal outward motion of a source due to speckle chromaticity . *",
    "@xmath135 such that @xmath140 to account for the minimal inward motion of a source due to speckle chromaticity .",
    "very often @xmath141 .",
    "however , as explained in @xcite , it can be very beneficial to use different values when seeking to detect faint companions with sharp spectral features . in this case",
    ", @xmath142 can be chosen based on the hypothetical underlying sharp spectral feature of the hypothetical astrophysical signal . * @xmath135 such that the reference belongs to the @xmath58 images with the largest correlation with the target .",
    "note that we adopt the following notation for correlations for the remainder of the paper : @xmath143 .",
    "note that in the case of point sources , when @xmath144 , with @xmath145 and zero otherwise , then the first three selection criteria above directly relate to the flux contamination across wavelengths and rotation angle .",
    "for all the examples in this manuscript , we simplify the reference selection by using @xmath146 .",
    "we also introduce the following shorthand notations :    * @xmath147 is the overall ensemble of psfs in the observing sequence . when folding the two - dimensional spatial variable @xmath1 into a line vector it can be seen as a matrix with @xmath148 lines and @xmath149 columns ( @xmath150 is the number of exposures in the observing sequence and @xmath149 the number of pixels in the @xmath16 zones ) .",
    "note that @xmath1 corresponds to 2d coordinates that are folded into one dimension for practical reasons .",
    "that is , if the @xmath16 zone was the entire field of view ( of dimension @xmath98 pixels ) , then one row entry of @xmath147 would be of dimension @xmath151 .",
    "the same applies to @xmath152 .",
    "* @xmath153 is the ensemble of reference psfs chosen to analyze a target image at @xmath154 . when folding @xmath1 into a line vector , it becomes a matrix with @xmath155 lines and @xmath149 columns ( @xmath155 is the number of frames selected in the psf library ) . for clarity",
    ", we drop the dependence on algorithms parameters and write this matrix as @xmath156 .",
    "* @xmath157 is an @xmath155 by @xmath148 selection matrix whose entries are defined by @xmath158 = 1 $ ] if @xmath159 ( \\mathbf{x})$ ] is the @xmath160 th entry in the reference library and @xmath161 otherwise . or , more succinctly : @xmath162 where again , we write @xmath163 dropping the dependence on @xmath164 and @xmath165 .      once the reference library corresponding to a given target image has been assembled , the pca is carried out as follows :    1 .",
    "zero mean @xmath0 and @xmath18 over @xmath16 .",
    "2 .   calculate the karhunen - love transform of @xmath156 : @xmath166   r_m(\\mathbf{x } )    \\label{eq : kldefinition}\\ ] ] where the vectors @xmath167 ...",
    "v_{k}[n_{\\mathcal{r } } ] \\right]$ ] are the eigenvectors of the @xmath155-dimensional covariance matrix of the reference library @xmath168 , and correspond to its eigenvalues @xmath169 .",
    "3 .   choose a cutoff , @xmath13 , for the number of modes the target image will be projected on .",
    "4 .   project the target image on the principal components and subtract this projected speckle noise model from the target   =   p(\\mathbf{x } )    = t(\\mathbf{x } )   - \\sum_{k = 1}^{k_{klip } } < t(\\mathbf{x}),z_k(\\mathbf{x})>_{\\mathcal{s } }   z_k(\\mathbf{x } )    \\label{eq : projectionsdefinition}\\ ] ]    this algorithm was outlined in @xcite and @xcite .",
    "@xcite suggested that such a formalism could serve as a foundation to calibrate potential systematic errors on the astrophysical observables due to the reduction algorithms , however they did not delve into the details of such a procedure .",
    "the present manuscript addresses this outstanding point .",
    "here we summarize the various notations introduced in the discussions in the appendices ( along with the dimensions of each variable ) .",
    "it is our hope that this summary will help the reader through the more technical arguments of this manuscript , along with helping interested parties to implement the klip - fm algorithm .",
    "+ & & & +    *    continued from previous page * + & & & +     +     + @xmath1 & & @xmath170 & coordinates in focal plane + @xmath171 & & @xmath170 & center of pca subtraction zone + @xmath172 & & @xmath170 & radial and azimuthal motion of an hypothetical source located at @xmath116 over an adi+ssdi observing sequence + @xmath97 & & @xmath170 & adi field rotation corresponding to the exposure at time @xmath86 + @xmath173 & & @xmath174 & radial extent of the local @xmath16 zone of the field of view over which the speckles least - squares fitting occurs + @xmath175 & & @xmath174 & azimuthal extent of the @xmath16 zone + @xmath176 & & @xmath174 & azimuthal displacement of an astrophysical source at the @xmath177 th exposure + @xmath178 & & @xmath174 & adi exclusion criterion + @xmath179 & & @xmath174 & sdi exclusion criterion ( inwards ) + @xmath180 & & @xmath174 & sdi exclusion criterion ( outwards ) + @xmath181 & & @xmath174 & number of most correlated + & & & references kept in psf library + @xmath182 & & @xmath174 & number of references in psf library , in this paper we use @xmath183 + @xmath184 & & @xmath174 & number of pixels in the @xmath16 zone +   + @xmath185 & & @xmath170 & location of an astrophysical point source + @xmath186 & & @xmath170 & location of synthetic negative point source underlying forward modeling + @xmath187 & & @xmath170 & estimated location of an astrophysical point source + @xmath43 & & @xmath174 & photometry of astrophysical source + @xmath188 & & @xmath174 & photometry f synthetic negative point source underlying forward modeling + @xmath189 & & @xmath174 & estimated photometry of astrophysical source + @xmath36 & @xmath190 $ ] & @xmath191 & spectrum of astrophysical point source + @xmath109 & @xmath192 & @xmath191 & normalized spectrum of astrophysical source + @xmath46 & & @xmath191 & spectrum of synthetic negative source underlying forward modeling + @xmath193 & & @xmath191 & normalized spectrum of synthetic negative source underlying forward modeling + @xmath194 & & @xmath191 & estimated spectrum of astrophysical source + @xmath195 & & @xmath191 & estimated normalized spectrum of astrophysical source + @xmath196 & @xmath197 $ ] & @xmath198 & vector of normalized flux of the astrophysical source corresponding to the signal contained in each one of @xmath155 reference images + @xmath199 & @xmath200 $ ] & @xmath201 & matrix in whose diagonal elements have been populated by each one of the @xmath155 entries of @xmath196 +   + @xmath202 & & @xmath203 & scattered starlight ( speckles ) at wavelength @xmath85 in the zone @xmath16 corresponding to the state of the instrument at time @xmath86 + @xmath204 & @xmath205 $ ] & @xmath206 & matrix of the concatenated speckles realizations kept in the reference psf library + @xmath207 & & @xmath206 & short - handed notation for @xmath204 + @xmath208)$ ] & & @xmath203 & astrophysical image at wavelength @xmath85 that has been rotated by @xmath97 due to adi field rotation + @xmath0 & @xmath209)$ ] & @xmath210 & target image at @xmath154 + @xmath111 & @xmath211)$ ] & @xmath210 & k th image in the reference psf library for the target image + @xmath156 & @xmath212 $ ] & @xmath213 & matrix of the concatenated references in the psf library + @xmath214 & & @xmath203 & processed image at wavelength @xmath85 and time @xmath86 + @xmath215 & @xmath216 & @xmath213 & short - handed notation for @xmath217 + @xmath218 & @xmath219)\\\\ ... \\\\ a_{\\lambda_k}(\\mathit{r}_{\\theta_{t_k}}[\\mathbf{x } \\frac{\\lambda_k}{\\lambda_0 } ] ) \\\\ ... \\\\",
    "a_{\\lambda_{n_{\\mathcal{r}}}}(\\mathit{r}_{\\theta_{t_{n_{\\mathcal{r}}}}}[\\mathbf{x } \\frac{\\lambda_{n_{\\mathcal{r}}}}{\\lambda_0}])\\end{array}\\right ] $ ] & @xmath206 & matrix of the concatenated @xmath155 astrophysical images in the reference library , at wavelength @xmath220 that have been rotated by @xmath97 due to adi field rotation and rescaled to wavelength @xmath138 + @xmath221 & & @xmath206 & short - handed notation for @xmath222 + @xmath223 & & @xmath203 & kl modes of speckles in the @xmath16 zone + @xmath224 & @xmath225 $ ] & @xmath206 & matrix of the concatenated kl modes associated with speckles + @xmath226 & & @xmath203 & perturbation of speckles kl modes due to astrophysical signal in the reference library + @xmath227 & @xmath228 $ ] & @xmath229 & perturbation of the speckles kl modes decomposed as a function of wavelength .",
    "+ @xmath230 & @xmath231 & @xmath203 & kl modes of the instrument psf perturbed by astrophysical signal = kl modes of the actual data + @xmath232 & @xmath233 $ ] & @xmath206 & matrix of the concatenated kl modes calculated based on the data ( contains perturbation from astrophysical source ) + @xmath234 & & @xmath203 & perturbation of the @xmath235 s due to a negative synthetic source + @xmath236 & @xmath237 $ ] & @xmath229 & perturbation of the speckles kl modes decomposed as a function of wavelength .",
    "+ @xmath238 & see text , too ugly & @xmath229 & model of the astrophysical source propagated through the data analysis algorithm at @xmath239 , decomposed as a function of wavelength +   + @xmath240 & @xmath241 & @xmath242 & covariance of the speckles + @xmath4 & & @xmath243 & @xmath135 th eigenvalue of @xmath240 + @xmath244 & @xmath245\\\\ ... \\\\ v_k[m ] \\\\ ... \\\\",
    "v_k[n_{\\mathcal{r}}]\\end{array}\\right ]   $ ] & @xmath246 & @xmath135 th eigenvector of @xmath240 + @xmath247 & @xmath248   & ... & 0 & ... & 0 \\\\ ... & ... &   0 & ... & ...",
    "\\\\0 & 0 &   v_k[m ] & 0 & 0 \\\\ ... & ... & 0 & ... & ... \\\\0 & ... & 0 & 0 &    v_k[n_{\\mathcal{r } } ] \\end{array}\\right ] $ ] & @xmath249 & elements of the @xmath135 th eigenvector of @xmath240 arranged on the diagonal of a square matrix + @xmath250 & @xmath251 $ ] & @xmath249 & eigenvector of @xmath240 concatenated to build a square matrix + @xmath252 & @xmath253 & @xmath242 & covariace matrix of the reference library + @xmath254 & @xmath255 & @xmath249 & cross term between speckles and astrophysical signal + @xmath256 & & @xmath243 & @xmath135 th eigenvalue of @xmath252 as defined by the perturbation analysis of this paper + @xmath257 & @xmath258\\\\ ... \\\\ u_k[m ] \\\\ ... \\\\",
    "u_k[n_{\\mathcal{r}}]\\end{array}\\right ]   $ ] & @xmath246 & @xmath135 th eigenvector of @xmath252 as defined by the perturbation analysis of this paper +   + @xmath259 & @xmath260 $ ] & @xmath249 & identity matrix of size @xmath182 + @xmath261 & @xmath262 $ ] & @xmath263 & rectangular matrix that relates each slice of each exposure to the its wavelength + @xmath264 & @xmath158 = 1 $ ] if @xmath265 & @xmath266 & selection matrix that relates each slice of each exposure to its position in the reference library ( note it depends on algorithm parameters ( @xmath267 ) + @xmath268 & @xmath269 & @xmath270 & selection matrix that relates each slice in the reference library to its wavelength +",
    "in this appendix we provide a detailed description of our mathematical notations and forward modeling implementation in the case of rdi , in configurations for which there is no astrophysical signal in the psf library .",
    "most of the material in this appendix has already been discussed in @xcite , albeit in somewhat less detail .",
    "we revisit it here in order to provide a rigorous context for the latter introduction of the klip - fm algorithm in the general case of adi and/or ssdi .",
    "forward modeling in the context of exoplanet imaging was first proposed by @xcite and aims at jointly estimating the instrument response and the astrophysical signal .",
    "to do so , negative synthetic sources are injected in the raw data across the entire observing sequence .",
    "this new data set , with both positive astrophysical and negative synthetic signals , is then propagated through the reduction algorithm .",
    "jointly minimizing the residuals in such processed images ( by exploring the range of possible astrophysical properties for the synthetic negative sources ) retrieves in principle the properties of the astrophysical signal .",
    "we call @xmath271 the ensemble of estimated astrophysical observables @xmath272 .",
    "these are the quantities corresponding to the synthetic negative astrophysical signal injected in the data , while @xmath273 are the quantities corresponding to the actual signal .",
    "this notation covers the most general case ( i.e. , resolved source , not centered on the star , and whose morphology changes with wavelength ) .",
    "of course in practice one never faces such a challenge and the dimensionality of astrophysical estimates is much smaller . we can then write the forward modeling problem at a given wavelength @xmath138 and time @xmath51 as the following minimization : @xmath274 ) \\right ] ||_{\\mathcal{f}}^2    % \\min_{\\widehat { \\mathcal{a } } } \\int_{\\mathcal{f}}\\mathcal{p}_{\\mathcal{r}(\\widehat { \\mathcal{a } } ) } \\left [ t(\\mathbf{x } )   - \\widehat{\\epsilon } \\widehat{a_{\\lambda_{p_0 } } } \\widehat{a_{\\lambda_{p_0}}}(\\mathbf{x } - \\widehat{\\mathbf{x_a } } - \\mathbf { \\delta x_{q_0 } } ) ) \\right]^2   d \\mathbf{x } \\label{eq : basicforwardmodelling}\\ ] ] where @xmath275 describes a most general and generic least - squares speckle fitting algorithm ( using reference images that depend both on the astrophysical observables , @xmath276 , and their synthetic negative counterparts , @xmath271 ) .",
    "@xmath77 is a `` fit '' region of the field of view that does not necessarily correspond to the @xmath16 zone . in the context of this paper ,",
    "we assume that @xmath277 corresponds to @xmath278 described in  [ ref : pcabasic ] , with reference images chosen according to the rules described in  [ ref : selcrit ] .",
    "note that in practice , images from a sequence of exposures ( and/or wavelengths ) are co - added before the signal is estimated , and as a consequence eq .",
    "[ eq : basicforwardmodelling ] is only representative of realistic cases up to one or two summations .",
    "however for the sake of clarity we will present our work without these summations and only discuss them when outlining practical implementations for spectral extraction in appendix f.      we review here applications of eq .",
    "[ eq : basicforwardmodelling ] to the case of rdi . in this configuration",
    "the signal can be _ over - subtracted _ , that is , the image of a point source can be fitted using some combination of instrument noise realizations ( e.g it can be over - subtracted by a speckle at the same exact location in the reference library ) . in this case",
    "the reference library does not depend on the astrophysical ( @xmath276 ) or on the synthetic negative ( @xmath271 ) signals .",
    "the least - squares speckles fitting algorithm can then be written as an operator on any arbitrary image @xmath279 : @xmath280 = i(x )    - \\sum_{k = 1}^{k_{klip } } < i(x ) , z_k(\\mathbf{x})>_{\\mathcal{s } }   z_k(\\mathbf{x})$ ] . here",
    "the simplification @xmath281 is key because it alleviates all issues associated with self - subtraction : only over - subtraction remains . assuming that the morphology of the psf is known ( e.g @xmath282 ) , and that is not field dependent , then there are only three unknowns : the photometry over the bandwidth of interest @xmath43 and the location of the point source ( astrometry ) in the scene @xmath283 .",
    "we call @xmath284 , the values of @xmath285 that actually minimize eq .",
    "[ eq : basicforwardmodelling ] . under these assumptions",
    "the forward modeling problem , eq .",
    "[ eq : basicforwardmodelling ] reduces to the following minimization : @xmath286- \\left ( \\widehat{\\epsilon } a(\\mathbf{x } - \\widehat{\\mathbf{x_a } } )   - \\sum_{k = 1}^{k_{klip } } < \\widehat{\\epsilon } a(\\mathbf{x } - \\widehat{\\mathbf{x_a } } )   , z_k(\\mathbf{x})>_{\\mathcal{s } }   z_k(\\mathbf{x } ) \\right)||_{\\mathcal{f}}^2   \\label{eq : reffreeforwardmodelling}\\ ] ] where eq .",
    "[ eq : reffreeforwardmodelling ] means that because the psf library ( and thus the karuhnen - loeve modes ) does not contain any astrophysical signal , estimating the astrophysical observables of a detected point source can occur in processed image space .",
    "this implies that one does not need to reprocess the data for every evaluation of the forward modeling cost function ( e.g every value of @xmath284 that is hypothesized while iterating to find the global minimum of eq .",
    "[ eq : reffreeforwardmodelling ] ) .",
    "in particular , the cpu intensive matrix inversion associated with the determination of the principal components is only carried out once . moreover eq .  [ eq : reffreeforwardmodelling ] also provides insights regarding the signal estimation algorithm .",
    "indeed , the quantity that is being minimized can be decomposed into three terms :    * a noise term that represents the remaining speckle noise that has not been captured by the pca : @xmath287 algorithms such as loci or klip are aimed at changing the pdf of this noise from spatially - correlated+ rician in the raw data @xcite , to spatially - uncorrelated+gaussian @xcite ( with the smallest standard deviation ) . * a term capturing the difference between the astrophysical signal @xmath288 and the negative synthetic source , @xmath289 , both are propagated through the principal component analysis : @xmath290    plugging these expressions into eq .",
    "[ eq : reffreeforwardmodelling ] yields : @xmath291 where @xmath292 corresponds to the negative synthetic source propagated through klip .",
    "we have thus established that forward modeling with rdi simply consists of inverting the `` transfer function '' of the algorithm : namely solving for @xmath285 in the least - squares sense . when the algorithm parameters have been well chosen , the noise term @xmath21 is indeed zero mean , gaussian , and does not feature spatial correlations ( see@xcite for in - depth discussions regarding these hypothesis ) . on the other hand ,",
    "when these parameters are ill chosen , then some systematics may remain and residual speckle noise may bias the estimation of @xmath285 .",
    "however it is important to note that such biases stem from the speckle noise not being properly subtracted ; they are not due to over - subtraction",
    ". they can be reduced by choosing a fitting zone , @xmath77 over which it has been empirically determined that psf subtraction residuals are zero mean and do not feature spatial correlations .",
    "alternatively , one can explore other algorithm parameters such as geometries of the @xmath16 zone .",
    "the example in figure  [ fig : forwardrdi ] shows that this well - behaved regime can be achieved by simply increasing @xmath13 .",
    "here we do not discuss algorithmic parametric searches aimed at minimizing the residual speckle noise , and work under the assumption that this latter source of uncertainty is well behaved .",
    "appendix d shows how one can solve eq .",
    "[ eq : forwardverysimple ] analytically , without any numerical optimization , under the assumption that @xmath293 .",
    "this yields : @xmath294 eq .",
    "[ eq::reffreeforwardmodellingastro ] implies that pca - based algorithms ( on the rdi case ) do not bias the astrometry of a point source ( under the well - behaved residual speckles assumption ) .",
    "[ eq::reffreeforwardmodellingphoto ] can then be used for photometric estimation or to estimate algorithmic throughput when calculating detection limits .",
    "note that in practice , this algorithm can be implemented very efficiently at the subpixel precision level using fourier transforms .",
    "indeed , the correlation between the two images @xmath295 and @xmath296 over @xmath16 can be written as : @xmath297 fft[m_{\\mathcal{s } } i_2(\\mathbf{x } ) ] \\right \\ } ( \\widehat{\\mathbf{x_a } } )   \\label{eq : fouriershit}\\ ] ] where @xmath298 denotes a mask over the image that is zero everywhere but in @xmath16 , fft is a fast fourier transform and mft is the matrix fourier transform , discussed in @xcite , calculated over a subpixel grid of @xmath283 centered around an initial guess of the position of the detected point source . as a consequence",
    ", the entire 2d grid of correlations necessary to solve for the location of the point source can be calculated without resorting to cpu expensive loops .",
    "this appendix details the linear algebra associated with the derivation of eq .",
    "[ eq::reffreeforwardmodellingphoto ] and eq .",
    "[ eq::reffreeforwardmodellingastro ] .",
    "it also sets up the stage for the mechanics underlying the spectral estimation algorithm discussed in appendix f.      we consider the general case of minimizing the following forward modeling cost function : @xmath299 where @xmath300 is a @xmath191 column vector , @xmath301 is a @xmath229 matrix , and @xmath302 is a @xmath203 line vector .",
    "this is the most general case for point sources whose both position , spectrum and astrometry are being estimated .",
    "then , the pair @xmath303 is a solution to this least - squares minimization problem if and only if : @xmath304 and @xmath305 using the shorthanded notation @xmath306 , we can write eq .  [ eq : minphot ] as : @xmath307 taking the first derivative with respect to @xmath300 yields : @xmath308 which can be substituted into eq .",
    "[ eq : minastro ] and yield after simplification : @xmath309 thus when seeking to minimize a quadratic cost function of a functional form similar to eq .",
    "[ eq : forwardls ] the spatial offset @xmath310 can thus be first calculated by maximizing the cross - correlation in eq .",
    "[ eq : finalastro ] , assuming a first guess for the spectrum . based on this value of @xmath310",
    "one can update @xmath311 using eq .",
    "[ eq : finalphot ] and iterate until astrometry and photometry have converged .      in the case of eq .",
    "[ eq : reffreeforwardmodelling ] we can write : @xmath312 we also work under the assumption that @xmath313 ( i.e. , the zone over which the signal is estimated is the same as the one over which the principal components are calculated ) . in this case : @xmath314 eqs .",
    "[ eq::reffreeforwardmodellingastro ] and [ eq::reffreeforwardmodellingphoto ] can be directly derived from estimating the astrometry using eq .",
    "[ eq : finalastro ] and then plugging this estimate into eq .",
    "[ eq : finalphot ] .",
    "this appendix describes the derivation of the main theoretical result of this paper .",
    "the expression of a target image and its associated references are : @xmath315 ) \\\\ & & r_{\\lambda , t}(\\mathbf{x})=s_{\\psi_{\\lambda , t}}(\\frac{\\mathbf{x}}{\\lambda_0 } ) + \\epsilon a a_{\\lambda}(\\mathit{r}_{\\theta_t}[\\mathbf{x } \\frac{\\lambda}{\\lambda_0}])\\end{aligned}\\ ] ] where the references have been chosen among all images in the observing sequence according to the parameters @xmath165 .",
    "we drop this dependence for simplicity and use the following shorthand notations :    * @xmath316 is the @xmath155 by @xmath149 matrix whose @xmath135 th line entry is @xmath317 .",
    "note that each line entry of @xmath316 is zero mean over @xmath16 .",
    "* @xmath318 is the @xmath155 by @xmath149 matrix whose @xmath135 th line entry is @xmath319 .",
    "note that each line entry of @xmath318 is zero mean over @xmath16 . * @xmath199 the @xmath155 diagonal matrix whose @xmath135 th diagonal entry is @xmath320 ( the normalized astrophysical flux at the wavelength corresponding to the @xmath135 th reference ) .",
    "* @xmath218 is the @xmath155 by @xmath149 matrix whose @xmath135 th line entry is @xmath321)$ ] .",
    "note that each line entry of @xmath218 is zero mean over @xmath16 . in the case of a point source and neglecting the field dependence of the psf , this can be further simplified as : @xmath322 ) = psf_{\\lambda_k } (   \\mathbf{x }   - \\mathbf{x_\\mathcal{s } } - \\mathbf { \\delta^{(\\lambda_{0},t,\\lambda ) } x_\\mathcal{s}})\\ ] ]    in this framework the reference library can be written in a matrix form : @xmath323 when using pca - based algorithms the next step is to calculate the karhune loeve transform of this ensemble of references ( e.g. eq .  [ eq : kldefinition ] ) . our goal is to evaluate how the signal in the references e.g @xmath324 propagates through this principal component decomposition .",
    "to do so , we write the covariance matrix in the presence of an astrophysical signal as the sum of the speckles covariance and the cross - term between the astrophysical signal and the speckle noise : @xmath325 note that here we dropped the @xmath326 factor in front of the covariance matrix .",
    "thus the presence of an astrophysical signal in the psf library becomes a quadratic ( scaling as @xmath327 ) perturbation of the reference s covariance matrix : this non - linearity , associated with the eigenmodes truncation , is the source of the _ self - subtraction biases _ for astrophysical estimates ( over - subtraction occurs regardless even when @xmath105 in the references ) .",
    "however , when : @xmath328 is true for each entry in these matrice , then the dependence on the astrophysical signal becomes linear and it can be modeled a posteriori in a tractable fashion .",
    "this argument is the crux of the analysis presented in this paper .",
    "this inequality is true when : @xmath329 } { \\mathbf{\\lambda } [ \\mathbf{a } \\mathbf{a_{\\delta}}(\\mathbf{x } )   \\mathbf{a_{\\delta}}(\\mathbf{x } ) ^{t } \\mathbf{a}^t ] } \\right ) \\label{eq : mainapprox}\\ ] ] where @xmath330 $ ] denotes the operator that calculates the eigenvalue of a matrix @xmath331 . as a consequence , the linear approximation holds either when the astrophysical signal @xmath43 is small with respect to the local speckles _ or _ when the algorithm parameters are chosen so that the correlations of astrophysical images across the psf library @xmath332 have much smaller eigenvalues than the cross - term between the astrophysical signal and the speckle noise @xmath254 .",
    "this latter case occurs when the algorithm parameters are chosen not to be aggressive ( @xmath333 larger than the fwhm of a point source psf for instance ) .",
    "note however that while this condition is necessary ( e.g when it is true the linear approximation holds ) , it is not sufficient : there exist cases where this inequality is not strictly true but where the linear model holds . in practice",
    "it is preferable to use a metric based on numerical evaluation of the eigen - modes or eigenvalues such as the one presented on fig .",
    "[ fig : figureeigenvalues ] .",
    "the case of small @xmath43 is of most interest in the framework of high - contrast imaging .",
    "indeed when a source is brighter than the speckles , pca - based algorithm might not be necessary ( or can be tuned so that @xmath333 is large enough ) , and thus the sophistications presented in this manuscript can be circumvented .",
    "+      we remind the reader that @xmath167 ... v_{k}[n_{\\mathcal{r } } ] \\right]$ ] are the eigenvectors of @xmath240 and @xmath4 its eigenvalues ( see discussion associated with eq .",
    "[ eq : kldefinition ] ) . under the linear approximation described by eq .",
    "[ eq : approxlincov ] we now propagate the astrophysical signal in the psf library through the calculation of eigenvalues / vectors of the covariance matrix .",
    "this identity is a standard linear algebra result , however because it is the cornerstone of klip - fm , we recall here the main steps of its derivation .",
    "we seek to express the perturbed eigenpair @xmath334 of @xmath335 as : @xmath336 this implies that : @xmath337 where we have used @xmath338 .",
    "we neglect the terms of order @xmath327 , left multiply eq .",
    "[ eq : basicpert ] by @xmath339 , and use the fact that @xmath340 ( e.g. the eigenbasis @xmath341 is orthonromal ) .",
    "we find : @xmath342 similarly , left multiplying eq .",
    "[ eq : basicpert ] by @xmath343 , @xmath344 yields : @xmath345 finally , forcing the normalization of @xmath346 yields @xmath347 .",
    "we finally find that the eigenpair of @xmath252 can be written as a small perturbation of eigenvalues / vectors of the signal - free reference covariance matrix : @xmath348 note that in this framework the perturbation to both @xmath349 and @xmath350 is a linear function of the astrophysical signal .",
    "the validity of eq .",
    "[ eq : perturbationeigen ] depends both on the validity of the inequality in eq .",
    "[ eq : mainapprox ] and on the magnitude of the terms in @xmath327 .",
    "relative differences between the true eigenvalues of @xmath252 and the ones calculated using eq .",
    "[ eq : perturbationeigen ] .",
    "the linear approximation holds very well for small values of @xmath43 . making the algorithm parameters less aggressive , by increasing @xmath351 or reducing @xmath58 ,",
    "results in a wider range of @xmath43 for which the approximation is well behaved . for point source",
    "@xmath352 fainter than the speckles , the linear approximation in eq .",
    "[ eq : perturbationeigen ] is always below the @xmath353 level across all ranges of parameters tested .",
    "similar levels of fidelity can be achieved with a point source as bright as the speckles , provided that @xmath351 is large enough ( less aggressive algorithm).,scaledwidth=100.0% ]    figure  [ fig : figureeigenvalues ] shows how this approximation fares when changing the brightness @xmath43 of a synthetic point source injected in ifs coronagraph data and varying algorithm parameters . to do",
    "so we used the same public gemini planet imager j - band data on the source beta pictoris used in the body of the manuscript .",
    "our proxy to quantify the fidelity of the approximation is the largest of all possible @xmath58 relative differences between the true eigenvalues of @xmath252 and the ones calculated using eq .",
    "[ eq : perturbationeigen ] .",
    "we find that indeed the linear approximation holds very well for small values of @xmath43 and that making the algorithm parameters less aggressive by increasing @xmath351 or reducing @xmath58 results in a wider range of @xmath43 for which the approximation is well behaved .",
    "it is also important to note that this metric is somewhat conservative . indeed , in most cases we found that for @xmath13 smaller than @xmath76 of the dimensionality of the reference library , the approximation holds very well even with bright point sources .",
    "indeed when using @xmath354 ) we find that in most cases , even with a point source brighter than the local speckles , our eigenvalues - based metric remains below @xmath353 .",
    "next , we propagate the linear expansion in eq .",
    "[ eq : perturbationeigen ] into the principal components .",
    "this is achieved by plugging eq .",
    "[ eq : perturbationeigen ] into eq .",
    "[ eq : kldefinition ] : @xmath355   r_m(\\mathbf{x } ) \\\\   y_k(\\mathbf{x } ) & = & \\frac{1}{\\sqrt{\\lambda_k +   \\epsilon \\ ; v_k^t \\mathbf{c_{a_{\\delta } s } } v_k } } \\times \\nonumber\\\\   & &   \\sum_{m=1}^{n_{\\mathcal{r } } } \\left ( v_k[m ] +   \\epsilon \\sum_{j = 1 , j \\neq k}^{n_{\\mathcal{r } } } \\frac{v_j^t \\mathbf{c_{a_{\\delta } i } } v_k } { \\lambda_k   - \\lambda_j } v_j[m ] \\right )   \\times \\left ( s_{m}(\\mathbf{x } ) + \\epsilon a_{\\lambda_m } a_{\\delta m } ( \\mathbf{x } ) \\right ) .",
    "\\label{eq : perturbepcaall}\\end{aligned}\\ ] ]    this expression can be simplified by replacing the definition of the unperturbed principal components e.g . , eq .  [ eq : kldefinition] into eq .",
    "[ eq : perturbepcaall ] , in order to express the @xmath356 as a function of the @xmath3 .",
    "this finally yields : @xmath357    where again we have neglected the terms of @xmath358 .",
    "[ eq : perturbepcasimple ] captures how the presence of an astrophysical signal in the reference library translates into a small perturbation of the principal components . when neglecting the @xmath358 terms , this perturbation is linear with respect the signal s photometry @xmath43 and/or its spectrum @xmath36 .",
    "here we identify the three terms discussed in  2.4 :    * _ over - subtraction _",
    ", scaling at @xmath359 + @xmath360 * _ direct self - subtraction _ , scaling as @xmath361 + @xmath362 * _ indirect self - subtraction _ , scaling as @xmath363 @xmath364      one of the main features of eq .",
    "[ eq : perturbepcasimple ] is that the presence of the astrophysical signal in the reference library is captured in a linear fashion .",
    "this has important consequences when using ifs data , because the high dimensionality of the astrophysical unknowns makes it very difficult to carry out the forward modeling minimization in eq .",
    "[ eq : basicforwardmodelling ] _ `` as is '' _ for ssdi observations . here",
    "we rewrite the expression of the @xmath365 in a way that highlights this linear dependence on @xmath366 $ ] . to do so",
    ", we use the following linear algebra identity , which is true for any eigenvector @xmath367 of the signal - less covariance matrix : @xmath368 this stems from :    * defining @xmath261 as the @xmath369 rectangular matrix that relates each slice of each exposure to its wavelength @xmath370 $ ] .",
    "we then write @xmath371 . * recognizing that @xmath372 is an @xmath155 dimensional vector whose @xmath135 th entry is @xmath320 ( the normalized astrophysical flux at the wavelength corresponding to the @xmath135 th reference ) . * recognizing that for any @xmath155 dimensional vector @xmath373 : @xmath374 , where @xmath375 and @xmath376 denote the matrices whose diagonal elements are populated with the @xmath155 entries of the vectors @xmath367 and @xmath373 . applying this identity to @xmath377 yields eq .",
    "[ eq : stupididentity ] .",
    "we then use eq .",
    "[ eq : stupididentity ] to simplify eq .",
    "[ eq : perturbepcasimple ] .",
    "some linear algebra manipulations finally yield the main theoretical result of this manuscript : @xmath378 \\nonumber\\end{aligned}\\ ] ] while eq .",
    "[ eq : linearklperturbations ] can seem daunting at first , we emphasize that for a given unperturbed basis set @xmath379 and a given model of the image of the astrophysical source , then @xmath380 only needs to be pre - computed once and stored .",
    "then the propagation of hypothetical sources of any arbitrary spectra @xmath36 through the least - squares speckle subtraction algorithm can be evaluated using a * simple matrix multiplication*. this has considerable advantages for statistical inference in the case of non - detections and for the estimation of astrophysical observables when faint substellar companions are detected .",
    "while this manuscript used the formalism laid out in @xcite , we can also use the equivalency between eq .",
    "18 and eq .  29 in @xcite under the assumption of full rank correlation matrices , to apply our formalism to the case of loci . in the absence of astrophysical signal in the psf library",
    ", the processed image using loci can be written as : @xmath381^t = t(\\mathbf{x})^t - \\mathbf{s}(\\mathbf{x})^t \\mathbf{c_{loci}}\\ ] ] where the loci coefficients are given by eq .",
    "18 and eq .  29 in @xcite .",
    "note that here we have transposed all quantities in @xcite in order to follow the array conventions in @xcite .",
    "@xmath382 we use the the following notations for the perturbed problem :    * @xmath383 are , respectively , the matrices whose column entries are @xmath384 , * @xmath385 are as defined in the body of the manuscript , * @xmath386 are , respectively , the diagonal matrices whose diagonal entries are @xmath387 . when using an eigenvalue truncation for loci , and keeping the first @xmath13 modes , then the last @xmath13 diagonal terms of both matrices",
    "are set to zero .    in the presence of an astrophysical signal",
    "then the reduced image becomes : @xmath381^t = t(\\mathbf{x})^t - \\mathbf{s}(\\mathbf{x})^t \\mathbf{c_{loci } }   - \\epsilon \\mathbf{a_{\\delta}}(\\mathbf{x})^t \\mathbf{c_{loci } } -   \\epsilon \\mathbf{s}(\\mathbf{x})^t \\mathbf{\\delta c_{loci}}\\ ] ] and we can use the formalism of the present manuscript to write @xmath388 @xmath389 where @xmath390 and @xmath391 can be calculated using eq .",
    "[ eq : perturbationeigen ] .",
    "the formalism developed herein is also applicable to loci implementation of least - squares speckle fitting algorithms .",
    "here we describe the mathematical formalism that takes advantage of eq .",
    "[ eq : linearklperturbations ] to generalize the rdi forward modeling concepts discussed in appendix d to the case of ifs spectroscopy of faint point sources with adi+ssdi .",
    "we assume that the location of the point source is known and seek to estimate its spectrum .",
    "we leave the astrometric estimation to further investigation .    [ [ forward - modeling - cost - function - in - the - presence - of - astrophysical - signal - in - the - reference - library ] ] forward modeling cost function in the presence of astrophysical signal in the reference library ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^    we start with eq .  [",
    "eq : basicforwardmodelling ] .",
    "because of the presence of an astrophysical signal in the psf library , the data analysis operator @xmath275 can not be simplified as straightforwardly as in the case of rdi . moreover , in the most general case the dependence on @xmath276 and @xmath271 is nonlinear .",
    "fortunately in the case of small perturbations ( both for the actual signal and for its synthetic negative counterpart ) the linear approximation in eq .",
    "[ eq : linearklperturbations ] holds and the data analysis operator can be simplified as follows : @xmath392 & = & i(x )    - \\sum_{k = 1}^{k_{klip } } < i(x ) , z_k(\\mathbf{x } ) + f^t \\mathbf{\\delta z_k}^{\\lambda }   ( \\mathbf{x } )   > _ { \\mathcal{s } }   ( z_k(\\mathbf{x})+f^t \\mathbf{\\delta z_k}^{\\lambda }   ( \\mathbf{x } ) ) \\\\",
    "\\mathcal{lsq}_{\\mathcal{r}(\\mathcal{a } ) } [ i(x ) ] & = & i(x )    - \\sum_{k = 1}^{k_{klip } } < i(x ) , y_k(\\mathbf{x } )   > _ { \\mathcal{s } }   y_k ( \\mathbf{x } ) \\\\ \\mathcal{lsq}_{\\mathcal{r}(\\mathcal{a},\\widehat { \\mathcal{a } } ) } [ i(x ) ] & = & i(x )    - \\sum_{k = 1}^{k_{klip } } < i(x ) , y_k(\\mathbf{x } ) - \\widehat{f}^t \\widehat{\\mathbf{\\delta y_k}^{\\lambda }   ( \\mathbf{x } ) }   > _ { \\mathcal{s } }   ( y_k(\\mathbf{x})-\\widehat{f}^t \\widehat{\\mathbf{\\delta y_k}^{\\lambda }   ( \\mathbf{x } ) ) } \\label{eq : klipwithnegative}\\end{aligned}\\ ] ]    of course in reality @xmath36 and @xmath227 are unknown .",
    "we can however apply the exact same treatment derived for the actual astrophysical signal in eq .",
    "[ eq : linearklperturbations ] to the negative synthetic source .",
    "plugging eq .",
    "[ eq : klipwithnegative ] into eq .",
    "[ eq : basicforwardmodelling ] yields the single wavelength forward modeling cost function at @xmath138 : @xmath393 , [ y_{k}^{\\lambda_0}(\\mathbf{x } ) - \\widehat{f } \\widehat{\\mathbf{\\delta y_k^{\\lambda_0 } } ( \\mathbf{x } ) } ] >    [ y_{k}^{\\lambda_0}(\\mathbf{x } ) - \\widehat{f } \\widehat{\\mathbf{\\delta y_k^{\\lambda_0 } } ( \\mathbf{x } ) } ] \\right )   ||_{\\mathcal{f}}^2 .",
    "% \\label{eq : reffreeforwardmodellingsdi}\\ ] ] adding this cost function for all wavelengths finally yields the spectral extraction cost function over the full range of wavelengths covered by the ifs : @xmath394 note that in the most rigorous case , each wavelength should to be weighted by its noise and possible correlation between wavelengths ought to be included .",
    "this is critical when deriving confidence intervals .",
    "however , the applications presented in this paper are only focused on biases associated with the most likely estimated spectrum .",
    "we leave further sophistications related to the calculations of confidence intervals to a future communication ( wang et al .",
    "2016 , in preparation ) . in  3 .",
    "we show that even using this simple approach yields unbiased estimated spectra ( albeit without confidence intervals ) . here",
    "we emphasize that the principal components considered are the sum of two terms :    * the principal components of the data itself , @xmath395 , which contain ( or do not contain ) perturbations due to the presence of a hypothetical point source .",
    "unfortunately the contribution of these perturbations can not be evaluated a priori . * a term corresponding to the the perturbation of @xmath395 due to the injection of the synthetic injected negative point source @xmath396 .",
    "this synthetic source is used for forward modeling purposes . even if this term corresponds to the injection of a non - physical source for the purpose of astrophysical inference , its impact",
    "can still be quantified using the result in eq .",
    "[ eq : linearklperturbations ] .",
    "we now simplify eq .",
    "[ eq : reffreeforwardmodellingsdi ] in order to reduce the problem to the functional form described in appendix d ( eq .",
    "[ eq : forwardls ] , which is more amenable to astrophysical inference ) .",
    "we use a fitting region @xmath77 whose size is independent of the size of the search area @xmath16 . assuming that the point source has been detected but its position is only known at the @xmath397 pixels level , this fitting region can be an aperture the size of the fwhm of the psf centered around this rough position .",
    "this is what we use in practice in the examples in this paper .",
    "we introduce the following notations : @xmath398 & = &   \\delta ( p , q ) ( a{\\lambda_p }   - \\sum_{k = 1}^{klip }   < a_{\\lambda_p } , y_{k}^{\\lambda_p } >   y_{k}^{\\lambda_p } ) - ... \\\\ % & & \\sum_{k = 1}^{klip } ( < t_{\\lambda_p},y_{k}^{\\lambda_p } >   \\widehat{\\mathbf{\\delta y_k^{\\lambda_p}}}[q ] +   < t_{\\lambda_p } ,   \\widehat{\\mathbf{\\delta y_k^{\\lambda_p}}}[q ] > y_{k}^{\\lambda_p})\\end{aligned}\\ ] ] this latter term contains all the contributions of the synthetic negative point source that are linear in @xmath399 ( e.g. neglecting the terms in @xmath400 in the forward modeling cost function ) .",
    "this expression for @xmath401 captures both over - subtraction and self - subtraction . here",
    "again , @xmath401 can be written as a simple matrix multiplication : @xmath402 with @xmath403 being a @xmath229 matrix whose @xmath177 th line entry is defined by : @xmath404(\\mathbf{x } ) = \\delta_{p , q } \\left ( a_{\\lambda_p } ( \\mathbf{x } )   - \\sum_{k = 1}^{k_{klip } }   < a_{\\lambda_p}(\\mathbf{x } ) , y_{k}^{\\lambda_p}(\\mathbf{x } ) >   y_{k}^{\\lambda_p}(\\mathbf{x } ) \\right ) \\nonumber   \\\\ & & ... - \\sum_{k = 1}^{k_{klip } } \\left ( < t_{\\lambda_p}(\\mathbf{x}),y_{k}^{\\lambda_p}(\\mathbf{x } ) >   \\widehat{\\mathbf{\\delta y_k^{\\lambda_p}}}[q](\\mathbf{x } ) +   < t_{\\lambda_p}(\\mathbf{x } ) ,   \\widehat{\\mathbf{\\delta y_k^{\\lambda_p}}}[q](\\mathbf{x } ) > y_{k}^{\\lambda_p}(\\mathbf{x } ) \\right ) \\label{eq : deflambdamatrix}\\end{aligned}\\ ] ] where @xmath405(\\mathbf{x})$ ] is the @xmath177 th line entry in @xmath406 .",
    "this yields the following simplified form for the forward modeling cost function : @xmath407        * once a faint point source has been identified , carry out a klip reduction using geometric parameters that keep the point source at the center of the subtraction @xmath16 zone .",
    "if combining adi and ssdi , derotate each exposure and sum over time to obtain : @xmath408)\\ ] ] * assuming that the location of the point source and the off - axis psf of the instrument are known , build a model of the motion of the point source across wavelengths and exposures @xmath409)$ ] .",
    "* for each @xmath410 associated with the reduction of each exposure at each wavelength , use this model in conjunction with eq .",
    "[ eq : linearklperturbations ] and eq .",
    "[ eq : deflambdamatrix ] to calculate @xmath406 and @xmath411 .",
    "when using adi , derotation and summation over time are necessary : @xmath412)\\ ] ]    these three steps only consist of basic linear algebra operations ( associated with some image rotations over of a small subregion @xmath77 of the image , usually ranging from a psf fwhm to the entire @xmath16 zone ) .",
    "once they have been carried out , the spectrum of the point source can be retrieved using any quadratic optimization algorithm to minimize eq .",
    "[ eq : forwardmodellingspectra ] .",
    "here we only consider the most simple route and recognize that eq .",
    "[ eq : forwardmodellingspectra ] is similar to eq .",
    "[ eq : minphot ] ( up to a summation ) and thus the estimated spectrum can be obtained by solving the following inverse problem : @xmath413      here we show that the algorithm discussed above can also be used to obtain detection limits that vary as a function of the hypothetical nature of the point sources that have not been detected in ifs data .",
    "quantifying completeness as a function of underlying spectral type is most often carried by injecting a series of point sources featuring the various hypothetical spectra that the experiment is expecting to be sensitive to ( see the example of @xcite for an illustration using the with and without methane hypothesis ) . because this involves analyzing multiple data sets with synthetic sources , very often only a small finite number of hypothesis are tested due to practical ( cpu time ) limitations .",
    "using eq .",
    "[ eq : linearklperturbations ] completely circumvents this problem because it enables the injection of a `` generic '' synthetic planet in the data : the reduced cubes / images can then be obtained from this `` generic data set '' via a simple matrix multiplication .",
    "then any observer can be used to generate the rocs and calculate completeness . in practice",
    ", this method follows the steps described below for a standard adi+ssdi sequence :    * for each cube and each wavelength , calculate the reduced image @xmath414 .",
    "this image can be calculated by splitting the field of view in multiple subtraction regions , @xmath16 . * for each cube and each wavelength , add an astrophysical scene @xmath208)$ ] to the processed image .",
    "this scene can be composed of a series of point sources separated in radius and azimuth so that there is only one synthetic source for each @xmath16 zone .",
    "* for each point source in the astrophysical scene ( and thus each corresponding @xmath16 zone ) , each cube , and each wavelength , calculate the associated perturbed principal components @xmath415 * pick a value of @xmath13 and calculate @xmath238 associated with each synthetic point source .",
    "* for each underlying hypothetical spectrum , create a synthetic observed image integrated over the entire observing sequence , at each wavelength based on these quantities : @xmath416 ) +   a_{\\lambda } ( \\mathbf{x } ) \\right ) + f \\sum_t \\mathbf{f}_{\\lambda , t } ( \\mathit{r}_{-\\theta_{t}}[\\mathbf{x } ] )   \\label{eq : klipfmnodetec}\\ ] ] ( note that here we have dropped the summation over the number of synthetic sources included in the dataset ) . *",
    "once the various terms in eq .",
    "[ eq : klipfmnodetec ] , @xmath417 have been evaluated , then generating a reduced image for a given hypothetical spectrum @xmath46 can be done via simple matrix multiplication .",
    "the observer of choice can the be applied to a wide variety of spectra and completeness calculated for each hypothesis .",
    "this method tests a wide variety of non - detection hypothesis without having to resort to a cpu - costly matrix inversion ( associated with the principal components calculation ) for each astrophysical scenario .",
    "it does involves a computational overhead of @xmath53 extra image rotations when compared to the analysis of an entire data set simply using klip .",
    "however , this overheard can be mitigated by only carrying out these rotations locally in regions surrounding the injected planets . moreover ,",
    "most implementations of pca - based methods calculate reduced images for a range of @xmath13 all the way to @xmath58 .",
    "because the linear model in eq .",
    "[ eq : klipfmnodetec ] is valid for all @xmath13 in the case of synthetics planets at the detection limit , it is sufficient to apply only the procedure described above for one value of @xmath13 .",
    "+        , j .-",
    "l . , feldt , m. , dohlen , k. , mouillet , d. , puget , p. , wildi , f. , abe , l. , antichi , j. , baruffolo , a. , baudoz , p. , boccaletti , a. , carbillet , m. , charton , j. , claudi , r. , downing , m. , fabron , c. , feautrier , p. , fedrigo , e. , fusco , t. , gach , j .- l . , gratton , r. , henning , t. , hubin , n. , joos , f. , kasper , m. , langlois , m. , lenzen , r. , moutou , c. , pavlov , a. , petit , c. , pragt , j. , rabou , p. , rigal , f. , roelfsema , r. , rousset , g. , saisse , m. , schmid , h .-",
    "m . , stadler , e. , thalmann , c. , turatto , m. , udry , s. , vakili , f. , & waters , r. 2008 , in presented at the society of photo - optical instrumentation engineers ( spie ) conference , vol .",
    "7014 , society of photo - optical instrumentation engineers ( spie ) conference series , 701418 ",
    "70141812    , b.  a. , close , l. , lenzen , r. , brandner , w. , mccarthy , d.  w. , nielsen , e. , & hartung , m. 2004 , in advancements in adaptive optics . edited by domenico b. calia , brent l. ellerbroek , and roberto ragazzoni .",
    "proceedings of the spie , volume 5490 , pp .",
    "389 - 397 ( 2004 ) . ,",
    "d.  bonaccini calia , b.  l. ellerbroek , & r.  ragazzoni , 389397    , m. , marleau , g .- d . , galicher , r. , beust , h. , lagrange , a .- m .",
    ", baudino , j .- l . , chauvin , g. , borgniet , s. , meunier , n. , rameau , j. , boccaletti , a. , cumming , a. , helling , c. , homeier , d. , allard , f. , & delorme , p. 2014",
    ", , 567 , l9    , t.  d. , mcelwain , m.  w. , turner , e.  l. , abe , l. , brandner , w. , carson , j. , egner , s. , feldt , m. , golota , t. , goto , m. , grady , c.  a. , guyon , o. , hashimoto , j. , hayano , y. , hayashi , m. , hayashi , s. , henning , t. , hodapp , k.  w. , ishii , m. , iye , m. , janson , m. , kandori , r. , knapp , g.  r. , kudo , t. , kusakabe , n. , kuzuhara , m. , kwon , j. , matsuo , t. , miyama , s. , morino , j .-",
    ", moro - martn , a. , nishimura , t. , pyo , t .- s . , serabyn , e. , suto , h. , suzuki , r. , takami , m. , takato , n. , terada , h. , thalmann , c. , tomono , d. , watanabe , m. , wisniewski , j.  p. , yamada , t. , takami , h. , usuda , t. , & tamura , m. 2013 , , 764 , 183    , t.  d. , mcelwain , m.  w. , turner , e.  l. , mede , k. , spiegel , d.  s. , kuzuhara , m. , schlieder , j.  e. , wisniewski , j.  p. , abe , l. , biller , b. , brandner , w. , carson , j. , currie , t. , egner , s. , feldt , m. , golota , t. , goto , m. , grady , c.  a. , guyon , o. , hashimoto , j. , hayano , y. , hayashi , m. , hayashi , s. , henning , t. , hodapp , k.  w. , inutsuka , s. , ishii , m. , iye , m. , janson , m. , kandori , r. , knapp , g.  r. , kudo , t. , kusakabe , n. , kwon , j. , matsuo , t. , miyama , s. , morino , j .- i . , moro - martn , a. , nishimura , t. , pyo , t .- s .",
    ", serabyn , e. , suto , h. , suzuki , r. , takami , m. , takato , n. , terada , h. , thalmann , c. , tomono , d. , watanabe , m. , yamada , t. , takami , h. , usuda , t. , & tamura , m. 2014 , , 794 , 159      caucci , l. , barrett , h.  h. , devaney , n. , & rodrguez , j.  j. 2007 , in adaptive optics : analysis and methods / computational optical sensing and imaging / information photonics / signal recovery and synthesis topical meetings on cd - rom ( optical society of america ) , atua5      , j. , barman , t. , fitzgerald , m.  p. , graham , j.  r. , larkin , j.  e. , macintosh , b. , bauman , b. , burrows , a.  s. , cardwell , a. , de rosa , r.  j. , dillon , d. , doyon , r. , dunn , j. , erikson , d. , gavel , d. , goodsell , s.  j. , hartung , m. , hibon , p. , ingraham , p. , kalas , p. , konopacky , q. , maire , j. , marchis , f. , marley , m.  s. , marois , c. , millar - blanchaer , m. , morzinski , k. , norton , a. , oppenheimer , r. , palmer , d. , patience , j. , perrin , m. , poyneer , l. , pueyo , l. , rantakyr , f.  t. , sadakuni , n. , saddlemyer , l. , savransky , d. , serio , a. , sivaramakrishnan , a. , song , i. , soummer , r. , thomas , s. , wallace , j.  k. , wiktorowicz , s. , & wolff , s. 2015 , , 798 , l3    ,  . ,",
    "pueyo , l. , hagan , j.  b. , gofas - salas , e. , rajan , a. , chen , c. , perrin , m.  d. , debes , j. , golimowski , d. , hines , d.  c. , ndiaye , m. , schneider , g. , mawet , d. , marois , c. , & soummer , r. 2014 , in society of photo - optical instrumentation engineers ( spie ) conference series , vol .",
    "9143 , society of photo - optical instrumentation engineers ( spie ) conference series , 57      , j.  r. , rice , e.  l. , veicht , a. , aguilar , j. , pueyo , l. , giorla , p. , nilsson , r. , luszcz - cook , s.  h. , oppenheimer , r. , hinkley , s. , brenner , d. , vasisht , g. , cady , e. , beichman , c.  a. , hillenbrand , l.  a. , lockhart , t. , matthews , c.  t. , roberts , jr .",
    ", l.  c. , sivaramakrishnan , a. , soummer , r. , & zhai , c. 2015 , , 798 , l43                , s. , oppenheimer , b.  r. , brenner , d. , parry , i.  r. , sivaramakrishnan , a. , soummer , r. , & king , d. 2008 , in society of photo - optical instrumentation engineers ( spie ) conference series , vol .",
    "7015 , society of photo - optical instrumentation engineers ( spie ) conference series , pp .",
    "70151970151910    , s. , oppenheimer , b.  r. , zimmerman , n. , brenner , d. , parry , i.  r. , crepp , j.  r. , vasisht , g. , ligon , e. , king , d. , soummer , r. , sivaramakrishnan , a. , beichman , c. , shao , m. , roberts , l.  c. , bouchez , a. , dekany , r. , pueyo , l. , roberts , j.  e. , lockhart , t. , zhai , c. , shelton , c. , & burruss , r. 2011 , , 123 , 74    , s. , pueyo , l. , faherty , j.  k. , oppenheimer , b.  r. , mamajek , e.  e. , kraus , a.  l. , rice , e.  l. , ireland , m.  j. , david , t. , hillenbrand , l.  a. , vasisht , g. , cady , e. , brenner , d. , veicht , a. , nilsson , r. , zimmerman , n. , parry , i.  r. , beichman , c. , dekany , r. , roberts , j.  e. , roberts , jr . , l.  c. , baranec , c. , crepp , j.  r. , burruss , r. , wallace , j.  k. , king , d. , zhai , c. , lockhart , t. , shao , m. , soummer , r. , sivaramakrishnan , a. , & wilson , l.  a. 2013 , , 779 , 153    , p. , marley , m.  s. , saumon , d. , marois , c. , macintosh , b. , barman , t. , bauman , b. , burrows , a. , chilcote , j.  k. , de rosa , r.  j. , dillon , d. , doyon , r. , dunn , j. , erikson , d. , fitzgerald , m.  p. , gavel , d. , goodsell , s.  j. , graham , j.  r. , hartung , m. , hibon , p. , kalas , p.  g. , konopacky , q. , larkin , j.  a. , maire , j. , marchis , f. , mcbride , j. , millar - blanchaer , m. , morzinski , k.  m. , norton , a. , oppenheimer , r. , palmer , d.  w. , patience , j. , perrin , m.  d. , poyneer , l.  a. , pueyo , l. , rantakyr , f. , sadakuni , n. , saddlemyer , l. , savransky , d. , soummer , r. , sivaramakrishnan , a. , song , i. , thomas , s. , wallace , j.  k. , wiktorowicz , s.  j. , & wolff , s.  g. 2014 , , 794 , l15                , p.  r. and poyneer , l. and barrett , h. and frazin , r. and caucci , l. and devaney , n. and furenlid , l. and gadysz , s. and guyon , o. and krist , j. and maire , j. and marois , c. and mawet , d. and mouillet , d. and mugnier , l. and pearson , i. and perrin , m. and pueyo , l. and savransky , d. 2012 , spie , 8447 , 844722      , b. , graham , j.  r. , ingraham , p. , konopacky , q. , marois , c. , perrin , m. , poyneer , l. , bauman , b. , barman , t. , burrows , a.  s. , cardwell , a. , chilcote , j. , de rosa , r.  j. , dillon , d. , doyon , r. , dunn , j. , erikson , d. , fitzgerald , m.  p. , gavel , d. , goodsell , s. , hartung , m. , hibon , p. , kalas , p. , larkin , j. , maire , j. , marchis , f. , marley , m.  s. , mcbride , j. , millar - blanchaer , m. , morzinski , k. , norton , a. , oppenheimer , b.  r. , palmer , d. , patience , j. , pueyo , l. , rantakyro , f. , sadakuni , n. , saddlemyer , l. , savransky , d. , serio , a. , soummer , r. , sivaramakrishnan , a. , song , i. , thomas , s. , wallace , j.  k. , wiktorowicz , s. , & wolff , s. 2014 , proceedings of the national academy of science , 111 , 12661    , c. , correia , c. , galicher , r. , ingraham , p. , macintosh , b. , currie , t. , & de rosa , r. 2014 , in society of photo - optical instrumentation engineers ( spie ) conference series , vol .",
    "9148 , society of photo - optical instrumentation engineers ( spie ) conference series , 0              , c. , macintosh , b. , & vran , j. 2010 , in society of photo - optical instrumentation engineers ( spie ) conference series , vol .",
    "7736 , society of photo - optical instrumentation engineers ( spie ) conference series              , k.  m. and males , j.  r. and skemer , a.  j. and close , l.  m. and hinz , p.",
    "m. and rodigas , t.  j. and puglisi , a. and esposito , s. and riccardi , a. and pinna , e. and xompero , m. and briguglio , r. and bailey , v.  p. and follette , k.  b. and kopon , d. and weinberger , a.  j. and wu , y .- l . , 2015 , , 815 , 108      , e.  l. , liu , m.  c. , wahhaj , z. , biller , b.  a. , hayward , t.  l. , close , l.  m. , males , j.  r. , skemer , a.  j. , chun , m. , ftaclas , c. , alencar , s.  h.  p. , artymowicz , p. , boss , a. , clarke , f. , de gouveia dal pino , e. , gregorio - hetem , j. , hartung , m. , ida , s. , kuchner , m. , lin , d.  n.  c. , reid , i.  n. , shkolnik , e.  l. , tecza , m. , thatte , n. , & toomey , d.  w. 2013 , , 776 , 4    , b.  r. , baranec , c. , beichman , c. , brenner , d. , burruss , r. , cady , e. , crepp , j.  r. , dekany , r. , fergus , r. , hale , d. , hillenbrand , l. , hinkley , s. , hogg , d.  w. , king , d. , ligon , e.  r. , lockhart , t. , nilsson , r. , parry , i.  r. , pueyo , l. , rice , e. , roberts , j.  e. , roberts , jr .",
    ", l.  c. , shao , m. , sivaramakrishnan , a. , soummer , r. , truong , t. , vasisht , g. , veicht , a. , vescelus , f. , wallace , j.  k. , zhai , c. , & zimmerman , n. 2013 , , 768 , 24    , l. , crepp , j.  r. , vasisht , g. , brenner , d. , oppenheimer , b.  r. , zimmerman , n. , hinkley , s. , parry , i. , beichman , c. , hillenbrand , l. , roberts , l.  c. , dekany , r. , shao , m. , burruss , r. , bouchez , a. , roberts , j. , & soummer , r. 2012 , , 199 , 6    , l. , soummer , r. , hoffmann , j. , oppenheimer , r. , graham , j.  r. , zimmerman , n. , zhai , c. , wallace , j.  k. , vescelus , f. , veicht , a. , vasisht , g. , truong , t. , sivaramakrishnan , a. , shao , m. , roberts , jr . , l.  c. , roberts , j.  e. , rice , e. , parry , i.  r. , nilsson , r. , luszcz - cook , s. , lockhart , t. , ligon , e.  r. , king , d. , hinkley , s. , hillenbrand , l. , hale , d. , dekany , r. , crepp , j.  r. , cady , e. , burruss , r. , brenner , d. , beichman , c. , & baranec , c. 2014 , arxiv e - prints    , t.  j. , debes , j.  h. , hinz , p.  m. , mamajek , e.  e. , pecaut , m.  j. , currie , t. , bailey , v. , defrere , d. , de rosa , r.  j. , hill , j.  m. , leisenring , j. , schneider , g. , skemer , a.  j. , skrutskie , m. , vaitheeswaran , v. , & ward - duong , k. 2014 , , 783 , 21      , r. & aime , c. 2004 , in advancements in adaptive optics . edited by domenico b. calia , brent l. ellerbroek , and roberto ragazzoni .",
    "proceedings of the spie , volume 5490 , pp .",
    "495 - 503 ( 2004 ) . ,",
    "d.  bonaccini calia , b.  l. ellerbroek , & r.  ragazzoni , 495503        , r. , perrin , m.  d. , pueyo , l. , choquet ,  . ,",
    "chen , c. , golimowski , d.  a. , brendan hagan , j. , mittal , t. , moerchen , m. , ndiaye , m. , rajan , a. , wolff , s. , debes , j. , hines , d.  c. , & schneider , g. 2014 , , 786 , l23"
  ],
  "abstract_text": [
    "<S> a new class of high - contrast image analysis algorithms that empirically fit and subtract systematic noise has lead to recent discoveries of faint exoplanet /substellar companions and scattered light images of circumstellar disks . </S>",
    "<S> these methods are extremely efficient at enhancing the detectability of faint astrophysical signal , but they do generally create systematic biases in their observed properties . </S>",
    "<S> this paper provides a general solution for this outstanding problem . </S>",
    "<S> we present the analytical derivation of a linear expansion that captures the impact of astrophysical over - subtraction and/or self - subtraction these image analysis techniques . </S>",
    "<S> we examine the general case for which the reference images of the astrophysical scene move azimuthally and/or radially across the field of view as a result of the observation strategy . </S>",
    "<S> our new method is based on perturbing the covariance matrix underlying any least - squares speckles problem , and propagating this perturbation through the data analysis algorithm . </S>",
    "<S> most of the work in this paper is presented in the principal component analysis framework , but it can be easily generalized to methods relying on linear combination of images ( instead of eigenmodes ) . based on this linear expansion , obtained in the most general case , we then demonstrate practical applications of this new algorithm . </S>",
    "<S> we first consider the case of the spectral extraction of faint point sources in ifs data and illustrate , using public gemini planet imager commissioning data , that our novel perturbation - based karhunen - love image processing forward modeling ( klip - fm ) can indeed alleviate algorithmic biases . </S>",
    "<S> we then apply klip - fm to the problem associated with the detection of point sources . </S>",
    "<S> we show how it decreases the rate of false negatives ( e.g missed planets ) while keeping the rate of false positives unchanged when compared to classical least - squares fitting methods . </S>",
    "<S> this can potentially have important consequences on the design of follow - up strategies of ongoing direct imaging surveys . </S>"
  ]
}