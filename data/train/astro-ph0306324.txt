{
  "article_text": [
    "with massive new data sets shrinking the statistical error bars on cosmological quantities , it is becoming increasingly important to avoid inaccuracies in their modeling and analysis .",
    "for example , one of the less interesting aspects of modern studies of large scale structure is having to deal with complex angular masks .",
    "this humble but essential task is rendered more time - consuming by the fact that angular masks may require updating as a survey progresses .",
    "the purpose of this paper is to describe a scheme intended to remove much of the drudgery and scope for inadvertent error or unnecessary approximation involved in defining and using angular masks .",
    "the scheme is implemented in a publically available software package mangle , which can be obtained , along with complete documentation , from http://casa.colorado.edu/~ajsh / mangle/. the present paper is not a software manual : for that , visit the aforesaid website .",
    "rather , the purpose of this paper is to set forward the philosophy and to detail the algorithms upon which the software is built .",
    "angular masks of galaxy survey have grown progressively more complicated through the years .",
    "the first complete redshift surveys of galaxies , the first center for astrophysics redshift survey ( cfa1 ; @xcite ) , and the first southern sky redshift survey ( ssrs1 ; @xcite ) , had rather simple angular boundaries , defined by simple cuts in declination and in galactic latitude .",
    "the level of complexity increased with the _ iras _ redshift surveys .",
    "the first of these , the _ iras _ 2  jy redshift survey @xcite , in addition to a cut in galactic latitude , excluded 1465 lunes of high cirrus or contamination by local group galaxies , each lune being an approximately @xmath2 square with boundaries of constant ecliptic latitude and longitude .",
    "the angular masks of subsequent _ iras _ surveys followed a similar theme , leading up to the pscz survey @xcite , whose high - latitude mask ( the one most commonly used in large scale structure studies ) consisted of the whole sky less 11,477 @xmath2 ecliptic lunes .",
    "the automatic plate measuring ( apm ) survey ( @xcite , b , 1996 ) and associated surveys such as the apm - stromlo survey @xcite , consisted of a union of a couple of hundred photographic plates , cut to @xmath3 , each drilled with a smrgsbord of holes to avoid bright stars , satellite trails , plate defects , and the like .",
    "the edges of the excluded holes were straight lines on photographic plates , but unlike the _ iras _ surveys , the holes were not necessarily rectangles , their boundaries were not necessarily lines of constant latitude and longitude , and different holes could overlap .",
    "= 6.5 in    the anglo - australian telescope 2 degree field survey ( 2df ; @xcite ; @xcite ) is a redshift survey of galaxies from the apm survey , and thus inherits the holey angular mask of the apm survey .",
    "superimposed on the apm backdrop , the 2df angular mask consists of several hundred overlapping @xmath4 diameter circular fields .",
    "the various overlaps of the circular fields have , at least in early releases of the data , various degrees of completeness .    the sloan digital sky survey ( sdss ; @xcite ) has an angular mask comparable in complexity to that of the 2df survey .",
    "it consists of several stripes from the parent photometric survey , peppered with holes masked out for a variety of reasons .",
    "superimposed on the stripes are circular fields from the redshift survey .",
    "recently , the sdss team used the mangle  scheme described in the present paper as part of the business of computing the 3d galaxy power spectrum @xcite . with both the 2df and sdss data going public , it has seemed sensible to publish the scheme so that others can use it too .",
    "the scheme described in the present paper began life in the delightful atmosphere of an aspen center for physics workshop in 1985 .",
    "the mathematics of harmonization (  [ harmonize ] ) and other aspects of the computation of angular integrals are written up in an appendix to @xcite .",
    "the methods described therein were first applied by @xcite , and have been used regularly by him since that time .",
    "the idea of adapting the methods to deal with angular masks in a rather general way , and in particular the concept of balkanization , is new to the present paper .",
    "the mangle  software has been applied to the 2df 100k survey by @xcite , and to the sdss by @xcite .",
    "the figures in this paper were prepared from files generated by the mangle  software .",
    "figure  [ twoqzfig ] shows a zoom of a small piece of the northern angular mask of the 2df qso redshift survey ( 2qz ) 10k release @xcite .",
    "the angular mask of this survey is defined by files ( downloadable from http://www.2dfquasar.org/spec_cat/masks.html ) giving the boundaries of : ( 1 ) @xmath3 ukst plates , ( 2 ) holes in ukst plates , and ( 3 ) @xmath4 fields .",
    "these boundaries are illustrated in the top left panel of figure  [ twoqzfig ] .",
    "the 2qz team provide the completeness of the angular mask in the @xmath5 pixelized form illustrated in the top right panel of figure  [ twoqzfig ] .",
    "the 2qz mask is typical of the way that angular masks are defined in modern galaxy surveys .",
    "[ cols= \" < , < \" , ]     motivated by common practice , an angular mask is defined in the present paper to be an arbitrary union of arbitrarily weighted angular regions bounded by arbitrary numbers of edges .",
    "the restrictions on the mask are    1 .   that each edge must be part of some circle on the sphere ( but not necessarily a great circle ) , and 2 .   that the weight within each subregion of the mask must be constant",
    "this definition of an angular mask by no means covers all theoretical possibilities , but it does reflect the actual practices of makers of galaxy surveys .",
    "the broad utility of spherical polygons to delineate angular regions is widely appreciated ; for instance , they play an integral part in the sdss database .",
    "the definition implies that an angular mask is a union of arbitrarily weighted non - overlapping polygons .",
    "a polygon is defined to be the intersection of an arbitrary number of caps , where a cap is defined to be a spherical disk , a region on the unit sphere above some line of constant latitude with respect to some arbitrary polar axis . for reference ,",
    "table  [ deftable ] collects definitions of mask , polygon , cap , and certain other terms used in this paper .",
    "the bottom left panel of figure  [ twoqzfig ] shows the 2qz mask ` balkanized ' ( see  [ balkanize ] below ) into non - overlapping polygons .",
    "the bottom right panel of figure  [ twoqzfig ] shows the mask reconstructed from spherical harmonics up to @xmath6 ( see  [ harmonize ] below ) .",
    "the information specifying a mask ( its angular boundaries and completeness ) is collected in files which we refer to as ` polygon files ' .",
    "typically a command in the mangle  suite of software will :    1 .   read in one or more polygon files , possibly in different formats ; 2 .",
    "do something to or with the polygons ; 3 .",
    "write an output file , possibly a polygon file , or files .",
    "the strategy adopted in the mangle  software is to permit the most flexible possible input format for polygon files , the idea being to be able to read the files provided by the makers of a galaxy survey as far as possible in their original form , or perhaps mildly edited .",
    "mangle  reads and writes several different formats of polygon files :    * circle ; * vertices ; * edges ; * rectangle ; * polygon .    for convenience , there are five additional formats that provide useful information about polygons , but that can only be written , not read , because the information they provide is too limited , or ambiguous , to specify polygons completely .",
    "the five output only formats are : area ; graphics ; i d ; midpoint ; weight .",
    "an abbreviated description of each format appears below ; see http://casa.colorado.edu/~ajsh/mangle/ for full details .",
    "the * circle * format is able to describe polygons in all generality .",
    "a circle is defined by the azimuth @xmath7 and elevation @xmath8 of its north polar axis , and by the angular radius , the polar angle @xmath9 , of the circle .",
    "each circle defines a cap .",
    "a polygon is an intersection of caps , and a line of the form @xmath10 containing @xmath11 angles defines a polygon with @xmath12 caps .",
    "the * vertices * format specifies polygons by a sequence of vertices , assumed to be joined by great circles .",
    "the general form of a line specifying a polygon in vertices format is @xmath13 which defines a polygon with @xmath12 caps . in vertices format ,",
    "a line with @xmath14 angles defines a polygon with n caps .",
    "the * edges * format is a souped - up version of the vertices format .",
    "whereas the vertices format joins each pair of vertices with a great circle , the edges format uses an additional point ( or additional points ) between each pair of vertices to define the shape of the circle joining the vertices .",
    "although the edges format retains more information about a polygon than the vertices format , in general it does not retain all information about a polygon .",
    "a rectangle is a special kind of 4-cap polygon bounded by lines of constant azimuth and elevation .",
    "the * rectangle * format is offered not only because some masks are defined this way ( for example , the _ iras _ masks ) , but also because the symmetry of rectangles permits accelerated computation of their spherical harmonics (  [ harmonize ] ) .",
    "a line in rectangle format looks like @xmath15 with precisely 4 angles .",
    "the * polygon * format is the default output format for polygon files . besides the circle format , it is the only other format that is able to describe polygons in all generality without loss of information .",
    "it stores each cap , not as three angles as in the circle format , but rather as a unit vector along the north pole of the cap , together with a quantity @xmath16 , which is equal both to the area of the cap divided by @xmath17 , and to half the square of the 3-dimensional distance between the north pole and the cap boundary .",
    "it seems doubtful that one would want to create an original mask file in polygon format , since it is a bit peculiar , but it is the format used internally by the mangle  software , and it specifies polygons in the manner expected for many years past by the fortran backend .",
    "the advantage of the format is that some computational operations are simpler and faster if the cap axis is stored as a unit vector rather than as an azimuth and elevation .    of the purely output formats ,",
    "one of the most useful is the * graphics * format , which is useful for making plots of polygons .",
    "the mangle  software does not incorporate any plotting software : it is assumed that you have your own favourite plotting package .",
    "the graphics format is similar to edges format , but is generally more economical .",
    "whereas in edges format there is a specified number of points per edge , in graphics format there is a specified number of points per @xmath17 of azimuthal angle along each edge .",
    "thus in graphics format curvier edges get more points than straighter edges .",
    "the graphics format is implemented only as output , not as input , because of ambiguity in the interpretation of the format .",
    "another useful output format is the * midpoint * format , which returns a list containing the angular position of a point inside each polygon of a mask .",
    "this can be helpful in assigning weights to the polygons of a mask , if you have your own software that returns a weight given an angular position .",
    "[ midpoint ] for more about how midpoints of polygons are computed .",
    "the * area * , * i d * , and * weight * output formats give lists of , respectively , the areas , identity numbers , and weights ( completenesses ) of the polygons of a mask .",
    "one of the basic tasks that the mangle  software does is resolve a mask into a set of non - overlapping polygons .",
    "this takes place in a sequence of four steps , elaborated in the subsections following .    1 .",
    "snap ; 2 .",
    "balkanize ; 3 .   weight ; 4 .",
    "unify .    resolving a mask into non - overlapping polygons",
    "greatly simplifies the logic of dealing with a mask , since it allows subsequent processing ( generation of random catalogues , computation of spherical harmonics , plotting , etc . ) to proceed without recourse to the intricate hierarchy of overlapping geometric entities and the associated complicated series of inclusion and exclusion rules that tend to characterize a survey mask .",
    "each individual polygon is by definition an intersection of caps .",
    "geometrically , this implies that a polygon is convex : the interior angles at the vertices of a polygon are all less than @xmath18 .",
    "the requirement that a polygon be an intersection of caps greatly simplifies the logic , since it means that a point lies inside a polygon if and only if it lies inside each of the caps of the polygon .",
    "the first thing that must be done on all the original polygon files of a mask is to ` snap ' them .",
    "this process identifies almost coincident cap boundaries and snaps them together .",
    "the problem is that the positions of the intersections of two almost but not exactly coincident circles ( cap boundaries ) on the unit sphere may be subject to significant numerical uncertainty . to avoid numerical problems ,",
    "such circles must be made exactly coincident .",
    "you might think that that near - but - not - exactly - coincident circles would hardly ever happen , but in practice they occur often , because a mask designer tries to make two polygons abut , but imprecision or numerical roundoff defeats an exact abutment .",
    "the snap process adjusts the edges of each polygon , but it leaves the number and order of polygons the same as in the input file(s ) .",
    "edges that appear later in the input file(s ) are snapped to earlier edges .",
    "the snap process offers four tunable tolerances :    * axis tolerance .",
    "are the axes of two caps within this angular tolerance of each other , either parallel or anti - parallel ?",
    "if so , change the axis of the second cap to equal that of the first cap . * latitude tolerance . if the axes of two caps coincide , are their latitude boundaries within this tolerance of each other ?",
    "if so , change the latitude of the second cap to equal that of the first cap .",
    "the two caps may lie either on the same or on opposite sides of the latitude boundary . * edge tolerance , and edge to length tolerance .",
    "are the two endpoints and midpoint of an edge closer to a cap boundary than the lesser of ( a ) the edge tolerance , and ( b ) the edge to length tolerance times the length of the edge ?",
    "in addition , does at least one of the two endpoints or midpoint of the edge lie inside all other caps of the polygon that owns the cap boundary ?",
    "if so , change the edge to align with the cap boundary .",
    "the purpose of the first two of these tolerances , the axis tolerance and the latitude tolerance , is obvious .",
    "the remaining two tolerances , the edge tolerance and the edge to length tolerance , are necessary because it is possible for two edges , if they are short enough , to almost coincide even though the axes and latitudes of their corresponding caps differ significantly .    by default , the three angular tolerances ( axis , latitude , and edge ) are all two arcseconds , which is probably sufficient for typical large scale structure masks . the tolerances can be tightened considerably before numerical problems begin to occur , so it is fine to tighten the tolerance for a mask whose edges are more precisely defined . the default edge to length tolerance @xmath19 , should be fine in virtually all cases .",
    "the snap process accomplishes its work in two stages :    * snap axes and latitudes of pairs of caps together , passing repeatedly through all pairs of caps until no more caps are snapped . *",
    "snap edges of polygons to other edges , again passing repeatedly through all pairs of caps until no more caps are snapped .    as a finishing touch ,",
    "snap prunes each of the snapped polygons in order to eliminate superfluous caps , those whose removal leaves the area of the polygon unchanged .      the process of resolving a mask into disjoint polygons we dub ` balkanization ' , since it fragments an input set of possibly overlapping polygons into many non - overlapping connected polygons .",
    "the process involves two successive stages :    1 .",
    "fragment the polygons into non - overlapping polygons , some of which may be disconnected .",
    "identify disconnected polygons and subdivide them into connected parts .",
    "= 1.8 in    the algorithm for the first stage of balkanization is simple and pretty :    * is the intersection of two polygons neither empty nor equal to the first polygon ?",
    "if so , find a circle , a cap boundary , of the second polygon that divides the first polygon , and split the first polygon into two along that circle .",
    "* iterate .",
    "notice that only one of the two parts of the split polygon overlaps the second polygon , and that only the overlapping part needs iterating . for any pair of polygons ,",
    "iteration ceases when the overlapping part lies entirely inside the second polygon .",
    "the final overlapping part is equal to the intersection of the original first polygon with the second polygon .",
    "all other fragments of the first polygon lie outside the second polygon .",
    "figure  [ balkanizefig ] illustrates an example of the first stage of balkanization for two overlapping polygons a and b. first , a is split against b , which takes two iterations of the above cycle .",
    "then , b is split against a. again , this takes two iterations of the above cycle .",
    "the final system consists of 5 non - overlapping polygons .",
    "note that splitting the system shown in panel ( a ) of figure  [ balkanizefig ] into its three connected parts ( the part of a that does not intersect b , the part of b that does not intersect a , and the intersection ab of a and b ) would not constitute a successful balkanization , since two of these regions are not convex and hence not polygons .",
    "one might ask , why not stop at panel ( c ) in figure  [ balkanizefig ] ?",
    "do not the three polygons there already form a satisfactory set of non - overlapping polygons ?",
    "the answer is that the intersection polygon ab may well have a weight different from those of the non - overlapping parts of the parent a and b polygons ( this is typically true for example in the 2df and sdss surveys ) . to deal with this eventuality",
    ", balkanization must continue to completion , as illustrated in panel ( e ) .",
    "the question of whether two polygons overlap is determined by computing the area of the intersection of the polygons .",
    "the area is proportional to the monopole harmonic , computed as described in  [ harmonize ] .",
    "the intersection of two polygons is itself a polygon , consisting of the intersection of the two sets of caps defining the polygons .",
    "stage 1 of the balkanization procedure yields polygons that can contain two or more connected parts , as illustrated in figure  [ discpolfig ] .",
    "stage 2 attempts to subdivide such disconnected polygons into connected parts by computing the connected boundaries of the polygon , and lassoing ( see  [ lasso ] ) each connected boundary with an extra circle .",
    "figure  [ eyefig ] illustrates a polygon that has two distinct connected boundaries by virtue of being not simply - connected rather than not connected .",
    "a region is said to be * simply - connected * if , according to the usual mathematical definition , it is connected and any closed curve within it can be continuously shrunk to a single point . loosely speaking ,",
    "this means that a simply - connected polygon has no holes .",
    "because it is connected , the polygon of figure  [ eyefig ] need not be split .",
    "the strategy to deal with non - simply - connected polygons is based on the following theorem , proven in the appendix : * a connected part of a polygon is simply - connected if and only if all the boundaries of the connected part belong to a single group*. a group is defined here as follows : two circles are friends , belonging to the same group , if they intersect ( anywhere , not necessarily inside the polygon ) , and friends of friends are friends . according to this definition of group , the circles on a single connected boundary necessarily all belong to the same group . however , the circles on two distinct connected boundaries may or may not belong to the same group .",
    "this theorem implies that it is necessary to lasso only those boundaries of a polygon that belong to the same group . in figure  [ discpolfig ] , for example , the two boundaries of the polygon belong to the same group of three intersecting circles , so these two boundaries must be lassoed , partitioning the polygon into two parts . in figure  [ eyefig ] , on the other hand , the two boundaries belong to two separate groups , and need not be lassoed .    figure  [ discpolsfig ] illustrates a more complicated polygon , similar to the polygon of figure  [ discpolfig ] but pierced with two circular holes .",
    "the polygon contains four boundaries belonging to three groups .",
    "the two original boundaries inherited from figure  [ discpolfig ] belong to the same intersecting group of circles , but the additional two holes form two separate groups . here",
    "only the two boundaries belonging to the same group need lassoing .",
    "= 2.5 in    figure  [ fractalfig ] illustrates a yet more complicated multiply - connected polygon .",
    "the mangle  software balkanizes this polygon correctly into seven polygons , a stringent test of the algorithms .",
    "a corollary of the theorem proven in the appendix is that the polygon formed by the intersection of the caps bounded by the circles of a single group must be a union of simply - connected parts . for example",
    ", the two parts of the polygon in figure  [ discpolfig ] must be simply - connected  which evidently they are  because the circles of the polygon all belong to the same group .",
    "in the course of the proof in the appendix , it is shown that if the boundary of a polygon falls into two ( or more ) groups , then the circles of a second group must lie entirely inside exactly one of the simply - connected parts of the polygon bounded by the first group .",
    "for example , each of the two circles bounding the two holes in the polygon of figure  [ discpolsfig ] must lie entirely inside exactly one of the two simply - connected parts of the original polygon from figure  [ discpolfig ] , which again is evidently true .",
    "it follows from the statement of the previous paragraph that in lassoing the connected boundaries of a group , it is necessary to consider only the boundaries belong to the same group : any boundary belonging to another group can be ignored , because it must lie entirely inside one of the simply - connected parts bounded by the first group .",
    "thus each lassoing circle is required to enclose fully its connected boundary , while excluding fully all other connected boundaries belonging to the same group ; there is no constraint on the lasso from boundaries belonging to other groups .",
    "if a group of circles of a polygon defines a single boundary , then that boundary needs no lassoing , but stage 2 balkanization nevertheless attempts to lasso the boundary if the number of caps of the group exceeds the number of vertices .",
    "for example , in its original configuration the polygon shown in figure  [ eggboxfig ] has a large number of caps .",
    "none of the caps can be discarded , since each excludes a small piece of the sky .",
    "here it is advantageous to lasso the polygon with an extra circle , allowing most of the original caps to be discarded as superfluous .",
    "a lasso that lassos the lone boundary of a group is discarded if the lasso completely encloses all the circles of the group to which the boundary belongs . for",
    "then either the lasso completely encloses the polygon , in which case it is superfluous , or else the lasso lies completely inside the simply - connected region bounded by the lone boundary , in which case the lasso , if kept , would divide the simply - connected region in two , which would be incorrect . if on the other hand the lasso of a lone boundary of a group intersects at least one of the circles of the group , then the lasso must completely enclose the simply - connected region bounded by the lone boundary , as in figure  [ eggboxfig ] ; the lasso can not lie inside the simply - connected region because it is being assumed that the lasso intersects a circle of the group , whereas no such circle can exist within the simply - connected region .",
    "stage 2 balkanization may need more than one pass to succeed .",
    "figure  [ chainfig ] shows an example of a polygon , bounded by one large cap punctuated by fifteen small caps , that contains four parts bounded by four boundaries all belonging to the same single group .",
    "the top and bottom boundaries can be lassoed successfully with single circles , but the middle two boundaries can not : any circle that encloses either of the middle boundaries necessarily intersects another boundary somewhere . here",
    "stage 2 balkanization succeeds by submitting the polygon to two passes . in the first pass ,",
    "the polygon is split into three polygons , consisting of the top and bottom connected parts , plus a third polygon containing the two middle parts . in the second",
    "pass , the third polygon is split into two , completing the partitioning of the original polygon into its four parts .    in certain convoluted cases , such as the polygon shown in figure  [ vfig ]",
    ", it can be impossible to lasso any of the connected boundaries of the polygon with a circle that wholly encloses a connected boundary while wholly excluding all other connected boundaries in the same group .",
    "stage 2 balkanization gives up attempting to lasso a boundary after a certain maximum number of attempts , but it keeps a record of the best - attempt lasso , the one that encloses as much as possible of a boundary while wholly excluding all other boundaries in the same group .",
    "stage 2 balkanization proceeds to split the polygon into two parts with the best - attempt lasso , and then submits the two parts to a further pass .",
    "the polygon of figure  [ vfig ] , for example , contains two parts bounded by two connected boundaries neither of which can be lassoed with a circle that completely encloses the boundary while completely excluding the other boundary .",
    "finding no satisfactory lasso , stage 2 balkanization splits the polygon into two polygons with a best - attempt lasso , shown as a dashed line in figure  [ vfig ] .",
    "the two polygons are then submitted to further passes of stage 2 balkanization , which in this case succeeds with one pass .",
    "the upshot is that the original polygon is balkanized into four polygons .",
    "= 2.5 in    it is conceivable that the algorithm of the above paragraph could continue for ever , continually splitting a polygon into two and continually failing to lasso successfully all the boundaries of the split polygons .",
    "however , polygons that defy lassoing have to be filamentary in character ( long , thin , and windy ) , such as that shown in figure  [ wfig ] , and splitting such a polygon in two generally makes it less filamentary , like putting spaghetti in a blender . in the case of the polygon of figure  [ wfig ] ,",
    "stage 2 balkanization forcibly splits the polygon 8 times , eventually balkanizing the 13-part polygon into 34 disjoint parts .",
    "suffice to say that we know of no polygon that fails the algorithm , and it is possible that no such polygon exists . if the reader finds one , please tell us about it .    in practice , the mangle  software bails out if a polygon has to be split forcibly in two more than a certain maximum number ( 100 ) of times . even in this last gasp case , the set of polygons output by balkanization still constitutes a valid set of non - overlapping polygons that completely tile the mask .",
    "the only problem is that the ` failed ' polygons , those which could not be partitioned completely , may contain two or more disjoint parts with different weights .",
    "to finish , balkanization prunes each of the balkanized polygons in order to eliminate superfluous caps , those whose removal leaves the area of the polygon unchanged .",
    "for example , pruning discards the many superfluous caps of the polygon of figure  [ eggboxfig ] .",
    "the caps are tested in order , with any new lassoing cap being tested last , so that the many superfluous caps are discarded , and the lassoing cap is kept .",
    "the algorithm to lasso a connected boundary of a polygon is to pick a point , initially taken to be the barycentre of the centres of the edges of the connected boundary ( or , if the connected boundary consists of a single circle , the centre of that circle ) , and find the circle centred on that point which most tightly encloses the boundary .",
    "the lassoing circle is enlarged slightly if possible , as a precaution against numerical problems that might potentially occur if the lasso just touched an edge or vertex of the boundary .",
    "a lasso that lassos , i.e. that encloses completely , one connected boundary of a polygon , is required to exclude completely all other connected boundaries belonging to the same group .",
    "a lasso attempt can sometimes fail if a polygon has two or more connected boundaries .",
    "a lasso attempt fails if the angular distance from the centre of the lasso to the farthest point @xmath20 on the to - be - lassoed connected boundary is greater than the angular distance from the centre of the lasso to the nearest point @xmath21 on all other connected boundaries belonging to the same group .",
    "if a lasso attempt fails , then the centre point of the lasso is shifted over the unit sphere along the vector direction from @xmath21 to @xmath20 , by an amount that puts the centre point just slightly closer to @xmath20 than @xmath21 .",
    "the lasso is then reattempted .",
    "the process of shifting the centre point and retrying a lasso is repeated until either the lasso succeeds , or until a certain maximum number of attempts has been made .",
    "multiple intersections occur where 3 or more circles ( cap boundaries ) intersect at a single point .",
    "multiple intersections pose a potential source of numerical problems , because the topology around multiple intersections may vary depending on numerics , as illustrated in figure  [ multfig ] .",
    "circles kiss if they just touch . again , kissing circles pose a potential source of numerical problems , because whether two circles kiss may vary depending on numerics , as illustrated in figure  [ kissfig ] .",
    "mangle  is equipped to deal with both multiply - intersecting and kissing circles , and should cope in almost all cases , although it is possible to fool manglewith a sufficiently complicated polygon , for example a polygon whose vertices have a fractal distribution of separations .",
    "the strategy is as follows .",
    "circles are considered to be multiply intersecting , crossing at a single vertex , if the intersections are closer than a certain tolerance angle .",
    "similarly , circles are considered to kiss , touching at a single vertex , if their kissing distance is closer than the tolerance angle .",
    "the algorithm is friends - of - friends : two vertices closer than the tolerance are friends , and a friend of a friend is a friend . the position of each vertex @xmath22 of a polygon , where edge @xmath23 intersects ( or kisses ) edge @xmath24 , is computed two different ways , first as the intersection of edge @xmath23 with edge @xmath24 , then as the intersection of edge @xmath24 with edge @xmath23 . for each of the two ways of computing it ,",
    "the intersection is tested against all other circles , to determine whether the intersection is or is not a vertex of the polygon , that is , whether the intersection lies on the edge of the polygon , or outside the polygon . for consistency",
    ", the test should give the same result in both computations : the intersection should be a vertex in both cases , or it should not be a vertex in both cases . if an inconsistency is detected , then the tolerance angle is doubled ( or set to a tiny number , if the tolerance is zero ) , and the computation is repeated for the inconsistent polygon , until consistency is achieved . by default ,",
    "the initial tolerance angle for multiple intersections and kissings is @xmath25 arcseconds .    in figure",
    "[ multfig ] , the intersection of the two diagonals is a vertex of the polygon in the left panel , but is not a vertex in the right panel , because it lies outside the polygon . in the case of an exact multiple intersection , as in the middle panel of figure  [ multfig ] , the intersection @xmath22 is considered to be a vertex of the polygon only if @xmath23 and @xmath24 are both edges of the polygon .",
    "thus the intersection of the two diagonals in the middle panel of figure  [ multfig ] is a vertex , because both diagonals are edges , but the intersection of the horizontal with either diagonal is not a vertex , because the horizontal is not an edge of the polygon . if @xmath23 is an edge , and it intersects multiply with a bunch of other circles , then the adjacent edge @xmath24 is formed by the circle which ` bends most tightly ' around the polygon , that is , the circle whose interior angle at the vertex is the smallest , or , if two circles subtend the same interior angle ( within the tolerance angle ) , then the circle whose polar angle @xmath9 is the smallest .    in figure  [ kissfig ] , the two circles @xmath23 and @xmath24 intersect at no vertices in the left panel , and at two vertices in the right panel . in the case of an exact kiss , as in the middle panel of figure  [ kissfig ] , the kissing point @xmath22 is considered to be a vertex only if @xmath23 and @xmath24 are both edges of the polygon .",
    "thus the kissing point @xmath22 is _ not _ a vertex of the the upper and lower polygons , the two disks , but it is a vertex of the middle polygon , the pointy one .",
    "two polygons that just touch or kiss at a single isolated point ( or at a set of isolated points ) are considered to be disconnected from each other .",
    "thus for example the top and bottom polygons in the middle panel of figure  [ kissfig ] are considered to be disconnected from each other ; and similarly the left and right polygons in the middle panel of figure  [ kissfig ] are considered to be disconnected from each other . in practice , consistency of the topology of the distribution of vertices around a polygon is checked by means of a 64-bit check number . if the intersection @xmath22 of edge @xmath23 with edge @xmath24 ( two edges can intersect at two separate points , so @xmath22 is an ordered pair , going from edge @xmath23 to edge @xmath24 right - handedly around the boundary of the polygon ) is determined to be a vertex of the polygon , then a 64-bit pseudo - random integer is added to the check number , and if the same intersection @xmath22 of edge @xmath24 with edge @xmath23 is determined to be a vertex of the polygon , then the same 64-bit pseudo - random integer is subtracted from the check number . for consistency , the check number should be zero for the entire polygon .",
    "it is conceivable , with probability 1 in @xmath26 , or less than 1 in 10 billion billion , that the check number could evaluate to zero accidentally , but this seems small enough not to worry about , especially since inconsistency should be a rare occurrence in the first place .",
    "figure  [ flowerfig ] illustrates a mask designed to be as ` difficult ' as possible : it contains many multiply intersecting and nearly multiply - intersecting circles , and many kissing and nearly kissing circles , including several simultaneously multiply - intersecting and multiply - kissing circles .",
    "the mangle  software copes with this , a non - trivial accomplishment .",
    "the sum of the areas of the 332 polygons of the balkanized mask of figure  [ flowerfig ] differ from the area , @xmath27 , of the overall bounding rectangle by @xmath28 , which is definitely satisfactory .",
    "given the algorithms , one could expect the numerical uncertainty in the area of a single polygon to be no better than machine precision times @xmath29 , which on the machine used for this computation was about @xmath30 .",
    "when balkanizing , does the order of the polygons in the input polygon files matter ?",
    "the answer is yes , if the input polygons overlap , and if the overlapping polygons carry different weights .",
    "as described in the following subsection  [ weight ] , if two polygons overlap , then the weight of the polygon that appears later in the input file(s ) overrides the weight of the earlier polygon .",
    "if all polygons have the same weight ( say 1 ) , then the order of the input polygon files does not really matter .",
    "however , it may lead to a slightly smaller eventual polygon file ( after unifying , see  [ unify ] ) if large , coarse polygons are put first , and small , finely detailed polygons are put last .",
    "each connected polygon of a mask may have a different weight . in galaxy surveys ,",
    "the ` weight ' attached to a polygon is the completeness of the survey in that polygon .",
    "these weights must be supplied by the user .",
    "if no weights are supplied , then the weight defaults to 1 .",
    "if the input polygons of a mask overlap , then the policy adopted by the mangle  software is to allow the weights of later polygons in polygon files to override the weights of earlier polygons .",
    "thus for example , to drill empty holes in a region , one would put the polygons of the parent region first ( with weight 1 , perhaps ) , and follow them with polygons specifying the holes ( with weight 0 ) .",
    "there are three ways to apply weights to polygons .",
    "the first way is simply to edit the polygon file or files specifying the mask . attached to each polygon in a polygon file",
    "is a line that includes a number for the weight ; one simply edits that number .",
    "the second way is to specify weights in a file .",
    "the mangle  software contains a facility to read in these weights , and to apply them successively to the polygons of a polygon file .",
    "suppose that you have your own software that returns a weight given an angular position in a mask .",
    "the mangle  software includes a utility (  [ midpoint ] ) to create a file giving the angular position of a point inside each polygon of a mask .",
    "this file of angular positions becomes input to your own software , which should create a file of weights , which in turn can be fed back to mangle .",
    "the third way to apply weights to polygons is to write a subroutine ( in either fortran or c ) that returns a weight given an angular position , and compile it into mangle .",
    "the mangle  software includes some template examples of how to do this . in our experience ,",
    "method two is the method of choice , except in cases that are simple enough that method one suffices .",
    "the set of non - overlapping polygons that emerges from balkanizing and weighting may be more complicated than necessary .",
    "the mangle  software includes a facility for simplifying the polygons of a mask , which we call unification .",
    "unification is not strictly necessary , but it tidies things up , and it can save subsequent operations , such as harmonization ( see  [ harmonize ] ) , a lot of computer time .",
    "= 1.8 in    unification eliminates polygons with zero weight , and does its best to merge polygons with the same weight .",
    "the algorithm is to pass repeatedly through a set of polygons , merging a pair of polygons wherever the pair can be merged into a single polygon by eliminating a single abutting edge .",
    "figure  [ unifyfig ] illustrates an example of the unification procedure .",
    "unification does not necessarily accomplish the most efficient unification , nor , as illustrated in figure  [ nounifyfig ] , is unification necessarily exhaustive .",
    "the mangle  software contains several utilities that do various things with a mask .",
    "one of the most important of these is a utility to take the spherical harmonic transform of a mask , a process we call harmonization . in particular , the area of a mask is proportional to the zeroth harmonic .",
    "computation of the area of a polygon is basic to several of the mangle  algorithms .",
    "for example , whether two polygons intersect is determined by whether the area of their intersection is non - zero .",
    "the method for computing the spherical harmonics of a mask consisting of a union of polygons is described in the appendix of @xcite .",
    "the algorithm is recursive and stable , able to compute harmonics to machine precision to arbitrarily high order , limited only by computer power and patience .",
    "the recursion , as implemented in the mangle  software , recovers correctly from underflow , which can occur at large harmonic number @xmath31 .",
    "while the recursive algorithm by itself is fast , there is a numerical penalty to be paid for allowing the polygons of a mask to have arbitrary shape : the computation time for harmonics up to @xmath31 increases as @xmath32 , a pretty steep penalty when @xmath31 is large .",
    "the computation time is proportional to the number of edges of the polygons of the mask , and on a 750mhz pentium iii it takes 3 cpu minutes per edge to compute harmonics up to @xmath6 .",
    "thus the method is slow compared to fast algorithms specially designed for regular pixelizations , such as healpix @xcite .",
    "the most time - consuming part of the computation is rotating the harmonics of an edge from its natural frame of reference into the final frame of reference : it is this rotation that takes @xmath32 time . the rotation is unnecessary if the edge is a line of constant latitude in the final reference frame , and the computation goes faster , as @xmath33 , in this case .",
    "another acceleration is possible if two edges are related by a rotation about the polar axis of the final frame .",
    "although computing the harmonics @xmath34 of a single edge @xmath35 still takes @xmath32 time , the harmonics @xmath36 of a second edge @xmath37 rotated right - handedly by azimuthal angle @xmath38 from edge @xmath35 are @xmath39 , which is fast to compute .    in practice , the mangle  software currently implements the latter acceleration only in the special case where ( some of ) the polygons of a mask are rectangles , polygons bounded by lines of constant azimuth and elevation .",
    "the acceleration applies only if at least two rectangles of the mask have the same minimum and maximum elevation .",
    "two such rectangles need not be adjacent in the polygon file : mangle  reorders the computation of polygons so as to take advantage of acceleration where possible .      for completeness , we give here an overview of the method detailed by @xcite .",
    "the spherical harmonic coefficients @xmath40 of a mask @xmath41 , a function of angular direction @xmath42 , are defined by @xmath43 @xmath44 where @xmath45 are the usual orthonormal spherical harmonics , and @xmath46 denotes an interval of solid angle about @xmath47 .",
    "the key mathematical trick is to convert the integral  ( [ olm ] ) for @xmath40 from an integral over the solid angle of the mask to an integral over its edges .",
    "this is done by introducing the square @xmath48 of the angular momentum operator @xmath49 into the integrand @xmath50 which is valid except for the monopole harmonic @xmath51 , dealt with below .",
    "the hermitian character of the angular momentum operator @xmath52 allows equation  ( [ olml ] ) to be rewritten @xmath53 by assumption , the mask is a sum over polygons @xmath54 , and @xmath41 is a constant @xmath55 within each polygon .",
    "it follows that @xmath56 in equation  ( [ olmp ] ) is a sum over polygons , with the contribution from each polygon being a vector whose magnitude is @xmath55 times @xmath57 times a dirac delta - function , and whose direction is along the boundary of the polygon , winding right - handedly about the polygon .",
    "thus the integral  ( [ olmp ] ) reduces to a sum of integrals over the boundaries @xmath58 of the polygons @xmath59 the boundary @xmath58 of a polygon is a set of edges , so the integral in equation  ( [ olmo ] ) becomes a sum of integrals over each edge of each polygon .",
    "thus a harmonic @xmath40 is a sum of contributions @xmath60 from each edge @xmath35 of each polygon @xmath54 @xmath61 hence the analytic problem reduces to that of determining the harmonics @xmath34 of the edge @xmath35 of a polygon .",
    "the problem is well suited to computation , and could easily be parallelized if required ( currently , mangle  is not parallelized ) .",
    "stable recursive formulae for computing the harmonics @xmath34 of a polygon edge are given by @xcite .",
    "first , the harmonics of an edge are computed in a special frame of reference where the axis of the edge cap is along the polar direction ( the @xmath62 direction ) of the spherical harmonics .",
    "the harmonics of the edge are then rotated into the actual frame of reference .",
    "the most time consuming part of the computation is the second part , the rotation , with the computational time going as @xmath32 .",
    "the above derivation of the harmonics @xmath40 of the mask fails for the monopole harmonic @xmath51 , for which equation  ( [ olml ] ) is invalid .",
    "the monopole harmonic @xmath63 is @xmath64 where @xmath65 is the weighted area of the mask , a weighted sum of the areas @xmath66 of the polygons @xmath54 @xmath67 the general formula for the area @xmath66 of a polygon @xmath54 is @xmath68 where @xmath69 , an integer , is the euler characteristic (= faces minus edges plus vertices of any triangulation ) of the polygon , @xmath70 and @xmath71 are the lengths and polar angles of the edges @xmath35 of the polygon , and @xmath72 are the exterior angles ( @xmath73 @xmath18 minus interior angle ) at the vertices @xmath74 of the polygon .",
    "the euler characteristic @xmath69 of a polygon , a topological quantity , is calculable topologically  it equals two plus the number of connected boundaries minus twice the number of groups to which the boundaries belong  but in practice it is quicker to compute the euler characteristic as follows .",
    "first , in the trivial case that the polygon is the whole sky , its area is @xmath75 .",
    "second , in the special case that the polygon is a single cap with edge @xmath35 , its area is @xmath76 .",
    "otherwise , the polygon is an intersection of two or more caps .",
    "if the area of any one of the caps is less than or equal to @xmath17 , then the area of the polygon must be less than @xmath17 , so the euler characteristic @xmath69 must take that integral value which makes the area lie in the interval @xmath77 .",
    "this leaves the case where every one of the caps of the polygon has area greater than @xmath17 .",
    "the policy in this case is to introduce an extra cap which splits the polygon into two parts , each of whose areas is less than @xmath17 ; the area of the polygon is then the sum of the areas of the two parts . in practice ,",
    "polygons which are intersections of caps all of whose areas exceed @xmath17 are fairly uncommon , so the slow down involved in splitting these particular polygons is not great .",
    "moreover the splitting is necessary only for the monopole harmonic : the higher order harmonics can be computed from the original polygon without splitting it .",
    "the mangle  software contains a ` map ' utility to reconstruct the mask at arbitrary points @xmath42 from spherical harmonics up to a given maximum @xmath78 @xmath79 for example , the bottom right panel of figure  [ twoqzfig ] was generated using this utility .",
    "another important feature provided in the suite of mangle  software is a utility to compute precisely the angular cross - correlation @xmath0 at given angular separation @xmath9 between given ` data ' points and ` random ' points in the mask .",
    "the angular integral is done analytically and evaluated to machine precision , rather than by monte carlo integration with random points .    if the ` data ' points are chosen randomly within the mask , as in  [ random ]",
    ", then the cross - correlation becomes equivalent to the angular autocorrelation @xmath1 , for random - random , at given angular separation between pairs of points in the mask .",
    "the advantage of computing the @xmath0 angular integral analytically over the traditional monte carlo method is that it eliminates unnecessary shot noise . as discussed for example by @xcite",
    ", this unnecessary shot noise can adversely affect the performance of estimators of the correlation function at small scales .    in the case of the pscz high latitude mask , which balkanizes into 744 polygons , it takes 5 cpu minutes per 1000 ` data ' points to compute @xmath0 at 1000 angular separations with a 1.2ghz pentium iii .",
    "the contribution of a data point at position @xmath42 to the angular correlation @xmath0 at angular separation @xmath9 is a weighted sum over the polygons of the mask of the azimuthal angle @xmath80 subtended within the polygon by a circle of radius @xmath9 centred at @xmath42 .",
    "the correlation @xmath0 at angular separation @xmath9 is an average over the contributions from each data point .",
    "the computation of @xmath0 is done at a specified angular separation or set of separations @xmath9 , not , as is common with monte carlo integration , over a bin of angular separations . for a finite number of data points , and a mask consisting , as in the present paper , of a union of weighted polygons , the correlation @xmath0 is a continuous function of angular separation @xmath9 , except that , if a data point @xmath42 happens to coincide with the axis of an edge of a polygon , then the function will be discontinous at a separation @xmath9 equal to the polar angle of the said edge .",
    "furthermore , the correlation @xmath0 is a differentiable function of separation @xmath9 except at a finite , possibly large , number of discontinuities where @xmath9 equals the separation between a data point @xmath42 and either a vertex of a polygon or a point on the edge of a polygon where the separation from @xmath42 is extremal .    although @xmath0 , as a function of separation @xmath9 , is thus typically discontinuous in the derivative , and occasionally discontinuous in itself , in practical galaxy surveys @xmath0 tends to be relatively smooth , especially when the number of data points is large .",
    "thus in the practical case it is usually fine to sample @xmath0 at a suitably large number of angular separations , and to interpolate ( linearly ) on such a table .",
    "the dr utility loops in turn through each data point @xmath42 , so that two points take twice as much cpu time as one point . for each data point , the dr utility attempts to accelerate the computation with respect to the angular separations @xmath9 by first computing the minimum and maximum angles between the point @xmath42 and each polygon in the mask .",
    "the information about the minimum and maximum angles is used to decide whether the circle about @xmath42 lies entirely outside or entirely inside a polygon , in which case the ( unweighted ) angle @xmath80 subtended within the polygon is zero or @xmath17 . in practical cases",
    "the angle subtended is often zero for the great majority of polygons of a mask , especially when the mask is composed of many polygons .",
    "since calculation of the subtended angle can be skipped if the angle is zero , computation can be greatly speeded up .",
    "further acceleration comes from ordering the polygons in increasing order of the minimum angle from the given point @xmath42 to each polygon .",
    "this allows the computation to loop to the next value of @xmath9 as soon as it hits a polygon for which the subtended angle is zero , rather than checking through large numbers of polygons that all have zero subtended angle .",
    "the angular auto - correlation @xmath1 between pairs of points in a mask can be computed in various ways . the traditional method ,",
    "as suggested by the random - random designation , is to count pairs of random points .",
    "however , the traditional method is certainly not the most precise method , and it may not be the most efficient , especially at small scales , if large numbers of random points are needed to reduce the shot noise to a subdominant level .",
    "an alternative method , mentioned above , is to compute @xmath1 using the @xmath0 algorithm with the ` data ' points chosen randomly within the mask .",
    "although this method is subject to some shot noise , the shot noise is liable to be substantially less than that of the traditional method at small scales .    at the largest angular separations",
    "@xmath9 , a choice method is to compute @xmath1 from its spherical harmonic expansion , truncated at some suitably large harmonic @xmath78 : @xmath81 where @xmath82 is a legendre polynomial , which is accurate at angular scales @xmath83 .",
    "the exact expression for the autocorrelation @xmath1 at angular separation @xmath9 is @xmath84 for a mask of polygons as considered in this paper , this double integral over solid angles can be transformed into a double integral over the edges of the polygons @xcite @xmath85 where @xmath65 is the weighted area , equation  ( [ a ] ) , of the mask , and @xmath86 is the green s function of the scalar product @xmath87 of angular momentum operators : @xmath88      }      &      ( x_{12 } \\geq x )      \\\\      0      &      ( x_{12 } \\leq x )      \\ .",
    "\\end{array }    \\right.\\ ] ] unfortunately the integral  ( [ rrexact ] ) can not be solved analytically , and we have not attempted to implement its numerical solution in the mangle  software .",
    "@xcite gives a series expansion of the expression  ( [ rrexact ] ) valid at small scales , but the series expansion is liable to break down already at tiny scales in the typically complex masks of modern surveys ( the coefficients of the series expansion change discontinuously wherever the angular separation equals the distance between distinct vertices , or more generally any extremal distance between pairs of edges ) , making the series expansion of limited applicability .",
    "the mangle  software contains a utility for generating random points inside a mask .",
    "as indicated above , this can be useful for example in computing the angular auto - correlation @xmath1 of pairs of points in the mask .",
    "the algorithm , which is quite fast , is as follows :    1 .   select randomly a polygon in the mask , with probability proportional to the product of the polygon s weight and area .",
    "lasso that polygon with a circle that is intended to be a tight fit , but is not necessarily minimal .",
    "generate a point randomly within the circle , test whether the point lies inside the polygon , and keep the point if it does .",
    "iterate .",
    "a lasso is computed for a polygon as needed , but is then recorded , so that a lasso is computed only once for any polygon .",
    "if the desired number of random points exceeds the number of polygons in the mask , then the computation starts by lassoing every polygon in the mask .",
    "the mangle  software contains several other utilities , described below .",
    "one simple but oft - used utility is one that copies a polygon file or files into another polygon file in a different format ",
    "see  [ format ] for an abbreviated description of the possible formats .",
    "for example , most of the figures in this paper were produced from points generated by copying polygon files into graphics format .",
    "the utility for copying polygon files has some switches to copy polygons with weights only in some interval , or with areas only in some interval .",
    "this makes it easy for example to discard polygons with small weights or small areas .      the mangle  software contains routines that return the vertices of the polygons of a mask , and to return the positions of points along the edges of a mask .",
    "for example , when a polygon file is copied into graphics format , the copy utility invokes these routines .",
    "a single polygon can have more than one connected boundary , as illustrated in figures  [ discpolfig][fractalfig ] and [ chainfig][wfig ] . here",
    "the routines return the vertices and edge points on distinct boundaries as distinct sets .",
    "the routines to determine the distinct connected boundaries of a polygon are used in stage 2 of the balkanization process ,  [ balkanize ] .",
    "the mangle  software contains a routine to find a point inside each polygon of a mask .",
    "the aim is to find a point that is squarely inside the polygon , well away from its edges .",
    "for example , the weights attached to the balkanized set of polygons shown in the lower left panel of figure  [ twoqzfig ] were obtained by picking a point inside each polygon , and evaluating the weight at that point from the @xmath5 pixelized map provided by the 2qz team .",
    "the pixelization means that the map is reliable only away from the edges of a polygon , so it is important to pick the point squarely inside the polygon .",
    "the algorithm finds one point for each distinct connected boundary of a polygon .",
    "if the polygon contains non - simply - connected parts , as in figures  [ eyefig][fractalfig ] , that means that the algorithm will return more points than there are distinct connected parts of the polygon ; however , having more points than necessary is not a problem .",
    "the algorithm to find a point inside a polygon is mildly paranoid . for each connected boundary of a polygon , the algorithm first determines the barycentre of the midpoints of the edges of the connected boundary .",
    "this barycentre can not be guaranteed to lie inside the polygon , so it is not enough to stop here . instead",
    ", great circles are drawn from the barycentre to each of the midpoints of the edges of the connected boundary . on each of these great circles ,",
    "the midpoint of the segment of the great circle lying within the polygon , with one end of the segment being the midpoint of an edge of the connected boundary , is determined .",
    "each of these segment midpoints inside the polygon is tested to see how far away it is from the nearest vertex or edge of the polygon , including edges and vertices other than on the connected boundary .",
    "the desired point inside the polygon is chosen to be that segment midpoint which is furthest away from any vertex or edge .",
    "the mangle  software contains a utility to find inside which polygon or polygons of a polygon file a given point lies .",
    "a point may lie inside zero polygons , or one polygon , or more than one polygon .",
    "the utility takes no short cuts : it tests all points against all polygons .",
    "this can take time if there are large numbers of points and large numbers of polygons .",
    "if the polygon file has been produced by balkanization , then a point would normally lie inside at most one polygon .",
    "however , a point at the edge of two abutting polygons is considered to lie inside both polygons .",
    "the observing strategies of modern galaxy surveys typically produce angular masks with complex boundaries and variable completeness .",
    "the purpose of this paper has been to set forward a scheme that is able to deal accurately and efficiently with such angular masks , and thereby to reduce both the labour and the chance for inadvertent error .",
    "the fundamental idea is to resolve a mask into a union of non - overlapping polygons each of whose edges is part of a circle ( not necessarily a great circle ) on the sphere .",
    "the scheme has been implemented in a suite of software , mangle , downloadable from http://casa.colorado.edu/~ajsh / mangle/.    the mangle  software includes several utilities for accomplishing common tasks associated with angular masks of galaxy surveys .",
    "this includes generating random catalogues reflecting the angular selection function ( a tool employed in almost all galaxy survey analysis ) , measuring the @xmath0 and @xmath1 angular integrals ( needed for estimating the correlation function ) , and expanding the mask in spherical harmonics ( a key step in various techniques for measuring the power spectrum and redshift space distortions ) .",
    "the scheme was originally motivated by the nature of real angular masks of real galaxy surveys , and the underlying angular routines have been battle - tested over many years .",
    "the full apparatus of the mangle  software has been used on the 2df survey by @xcite , and on the sdss survey by @xcite .",
    "ajsh was supported by nasa atp award nag5 - 10763 and by nsf grant ast-0205981 .",
    "mt was supported by nsf grants ast-0071213 & ast-0134999 , nasa grants nag5 - 9194 & nag5 - 11099 , and fellowships from the david and lucile packard foundation and the cottrell foundation .",
    "we thank yongzhong xu for his contributions to an early version of the balkanization software , and michael blanton for suggestions .",
    "colless m. et al .",
    "( the 2dfgrs team ; 29 authors ) , 2001 , mnras , 328 , 1039 ( astro - ph/0106498 ) croom s. m. , smith r. j. , boyle b. j. , shanks t. , loaring n. s. , miller l. , lewis i. j. , 2000 , mnras , 322 , l29 ( 2qz , available at http://www.2dfquasar.org/spec_cat/ ) da costa l. n. , pellegrini p. s. , davis m. , meiksin a. , sargent w. l. w. , tonry j. l. , 1991 , apjs , 75 , 935 gorski k. m. , wandelt b. d. , hansen f. k. , hivon e. , banday a. j. , 1999 , astro - ph/9905275 hamilton a. j. s. , 1993a , apj , 406 , l47 hamilton a. j. s. , 1993b , apj , 417 , 19 huchra , j. , davis , m. , latham , d. and tonry , j. ( 1983 ) apjs , 52 , 89 kerscher m. , szapudi i. , szalay a. , 2000 , apj , 535 , l13 ( astro - ph/9912088 ) lewis i. j. et al .",
    "( 2df team ; 23 authors ) , 2002 , mnras , 333 , 279 ( astro - ph/0202175 ) loveday j. , peterson b. a. , maddox s. j. , efstathiou g. , 1996 , apjs , 107 , 201 maddox s. j. , efstathiou g. , sutherland w. j. , 1990b , mnras , 246 , 433 maddox s. j. , efstathiou g. , sutherland w. j. , 1996 , mnras , 283 , 1227 maddox s. j. , sutherland w. , efstathiou g. , loveday j. , 1990a , mnras , 243 , 692 saunders w. , sutherland w. j. , maddox s. j. , keeble o. , oliver s. j. , rowan - robinson m. , mcmahon r. g. , efstathiou g. p. , tadros h. , white s. d. m. , frenk c. s. , carraminana a. , hawkins m. r. s. , 2000 , mnras , 317 , 55 ( pscz , available at http://www-astro.physics.ox.ac.uk/~wjs/pscz.html ) strauss m. a. , huchra j. p. , davis m. , yahil a. , fisher k. b. , tonry , j. , 1992 , apjs , 83 , 29 tegmark m. , hamilton a. j. s. , xu y. , 2002 , mnras , 335 , 887 ( astro - ph/0111575 ) tegmark m. et al .",
    "( sdss collaboration ) , 2003 , apj , to be submitted york d. g. , et al .",
    "( sdss collaboration , 144 authors ) , 2000 , aj , 120 , 1579",
    "this appendix proves the following theorem , invoked in  [ balkanize2 ] ( see table  [ deftable ] for a definition of the term * group * ) :      first , suppose that a polygon contains a region which is connected but not simply - connected .",
    "it is required to prove that the boundaries of this region belong to at least two distinct groups . by definition of simply - connectedness",
    ", a continuous line can be drawn entirely inside the non - simply - connected region such that one connected boundary of the region lies entirely on one side of the line , and another connected boundary of the region lies entirely on the other side of the line . in the polygon of figure  [ eyefig ] , for example",
    ", such a line would circulate around the central boundary while remaining inside the outer boundary .",
    "the continuous line can not intersect any of the circles forming the caps of the polygon , because if the line did intersect a circle , then the line would be inside the polygon on one side of the intersection , and outside the polygon on the other side of the intersection , contradicting the assumption that the line lies entirely inside the polygon . hence the continuous line must partition the circles of the polygon into two non - intersecting groups .",
    "the two connected boundaries on either side of the continuous line must therefore belong to two distinct groups , as was to be demonstrated .",
    "conversely , suppose that a polygon has boundaries that belong to at least two distinct groups .",
    "it is required to prove that the two groups delineate a connected but non - simply - connected region of the polygon .",
    "consider the polygon , call it a , formed by the intersection of all the caps of one group .",
    "the polygon a so formed must consist of one or more simply - connected parts ; for if any connected part of a were not simply - connected , then according the previous paragraph the boundaries of that part would belong to different groups , contradicting the assumption that the caps of a all belong to a single group .",
    "now consider similarly the polygon , call it b , formed by the intersection of all the caps of a second group .",
    "the boundaries of polygon b must lie entirely inside one and only one of the simply - connected parts of a. for certainly b must lie inside at least one part of polygon a , since a must enclose the parent polygon , and the boundary of b lies inside ( at the border of ) the parent polygon .",
    "but the boundary of polygon b can not lie in more than one part of a , because if it did then , because the circles of b are all in the same group and therefore connected to each other , there would be a path lying along the circles of b traversing continuously from one part of a to another , and therefore necessarily intersecting one of the boundaries of polygon a , contradicting the assumption that the circles of a and b belong to distinct groups that nowhere intersect . similarly , the boundaries of polygon a must lie entirely inside one and only one of the simply - connected parts of b. this argument has identified two special boundaries : a boundary of a that entirely encloses b ; and a boundary of b that entirely encloses a. the region enclosed by these two special boundaries delineates a region of the polygon that is connected but not simply - connected . for consider a continuous line which is displaced slightly off the special boundary of a , towards the special boundary of b. by construction , the continuous line lies entirely inside both polygons a and b. the continuous line can not intersect any of the circles of a or b , because if it did then the line would lie inside a ( or b ) on one side of the intersection , and outside a ( or b ) on the other side , contradicting the fact that the line lies entirely inside a and b. the continuous line could possibly intersect circles belonging to a third group of circles of the parent polygon . however , if the continuous line is displaced off the special boundary of a by a sufficiently small amount that it does not encounter any third group , then the continuous line will lie entirely inside the parent polygon .",
    "this continous line forms a line inside the polygon that can not be shrunk continuously to a point , so the polygon must contain a region that is connected but not simply - connected , as was to be demonstrated ."
  ],
  "abstract_text": [
    "<S> this paper presents a scheme to deal accurately and efficiently with complex angular masks , such as occur typically in galaxy surveys . </S>",
    "<S> an angular mask is taken to be an arbitrary union of arbitrarily weighted angular regions bounded by arbitrary numbers of edges . </S>",
    "<S> the restrictions on the mask are ( i ) that each edge must be part of some circle on the sphere ( but not necessarily a great circle ) , and ( ii ) that the weight within each subregion of the mask must be constant . </S>",
    "<S> the scheme works by resolving a mask into disjoint polygons , convex angular regions bounded by arbitrary numbers of edges . </S>",
    "<S> the polygons may be regarded as the ` pixels ' of a mask , with the feature that the pixels are allowed to take a rather general shape , rather than following some predefined regular pattern . among other things , </S>",
    "<S> the scheme includes facilities to compute the spherical harmonics of the angular mask , and data - random @xmath0 and random - random @xmath1 angular integrals . </S>",
    "<S> a software package mangle  which implements this scheme , along with complete software documentation , is available at http://casa.colorado.edu/~ajsh / mangle/.    large - scale structure of universe  methods : data analysis </S>"
  ]
}