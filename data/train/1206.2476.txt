{
  "article_text": [
    "the impact of magnetic fields on various objects in astrophysics is now well established .",
    "they play a major role on a wide range of scales , from the study of the early universe , the stellar and intergalactic medium to the formation and interiors of stars or the accretion flows around stellar objects .",
    "they are difficult to study both from an observational and a theoretical ( and numerical ) point of view .",
    "several implementations of ideal mhd have been performed since the last decade ( @xcite , @xcite , @xcite among others ) , and numerical issues concerning the divergence free condition have now been resolved .",
    "however , ideal magnetohydrodynamics ( mhd ) is in many circumstances a poor approximation and non - ideal mhd effects need to be thoroughly considered .",
    "ambipolar diffusion is expected to play a major role in star formation ( @xcite ) , at the scale of molecular clouds by enabling the collapse of otherwise magnetically supported clouds ( @xcite ) and at the scale of the first larson s core with the formation of a centrifugally supported disk and the well - known _ fragmentation crisis _ ( @xcite ) .",
    "ambipolar diffusion is also important in protoplanetary disks as they are in general only partially ionised .",
    "the microscopic and entropic heating resulting from the drift and collision between neutral and charged species is another very important and relatively unknown aspect which is crucial as soon as cooling or heating of the gas ( thus radiative transfert ) is taken into account ( in contrast it is not relevant when using a barotropic equation of state ) .",
    "magnetic resistivity effects range from prohibiting long - term mhd turbulence in molecular clouds ( @xcite ) to preventing the _",
    "magnetic braking catastrophe _ on small scales ( @xcite ) .",
    "its importance is also crucial in order to study disk formation around protostellar objects ( @xcite ) and the physics of binary formation and brown dwarfs .",
    "thus , it appears necessary to introduce the ambipolar and ohmic diffusion in a 3d mhd code . before exploring the astrophysical impact of such a study ,",
    "however , the accuracy of the treatment of the complete mhd set of equations must be unambiguously assessed .",
    "this is the very aim of the present paper , in which we describe a prescription to incorporate ambipolar and ohmic diffusion in the multi - dimensional mhd amr code ramses ( @xcite ) , extending the ideal mhd version presented in @xcite and @xcite .",
    "several numerical treatments have been derived from ideal mhd models , following different aims and thus using different methods .",
    "[ rev3]the first attempt to implement ambipolar diffusion in a code was made by @xcite using an iterative approximation in an implicit first - order code .",
    "@xcite used a semi - explicit method in a two - dimensional code to investigate instabilities in c - schocks .",
    "@xcite presented a widely used explicit method ( @xcite , @xcite , @xcite ) to implement single - fluid ambipolar diffusion in the strong coupling limit , and then developed a two - fluid model in order to capture shock instabilities . @xcite and",
    "more recently @xcite presented a semi - implicit scheme for solving two - fluid ambipolar diffusion , arguing that the single fluid approximation does not carry the full set of mhd waves that can propagate in a poorly ionized system .",
    "multi - fluid approaches including ambipolar diffusion and ohmic diffusion have been suggested by @xcite , or @xcite and then investigated by e.g. @xcite .",
    "recently , @xcite used the single - fluid approach including more realistic resistivities based on a multi - fluid approach for ambipolar diffusion , ohmic diffusion and hall effect in two - dimensional ( axi - symmetric ) calculations .",
    "another approach has been used by @xcite was to describe both ambipolar diffusion and ohmic diffusion in one single laplace operator @xmath0 , with @xmath1 taking into account every diffusive process at stake .",
    "these numerous studies have also given rise to several numerical tests , a number of which we will either perform directly or slightly modify to assess the accuracy of our treatment .",
    "our current study focusses on the one - fluid approximation ( @xcite ) , as in previous calculations by @xcite and @xcite .",
    "[ revv1]we used a direct explicit method to implement non - ideal mhd terms in both the induction and energy equations ( @xcite ) in an amr framework .",
    "we did not choose to account for non - ideal effects by adding ambipolar diffusion and ohmic dissipation in a single laplace operator as @xcite .",
    "instead we kept the full expressions and proceeded separately for each non - ideal effect .",
    "the paper is organized as follows . in ",
    "[ amb ] , we first derive the equations for ambipolar diffusion in the single fluid approximation .",
    "we then describe the various tests we have performed , first without the hydrodynamics and then in a complete mhd situation , exploring in particular the propagation of alfvn waves .",
    "comparisons with existing analytical or benchmark solutions are presented in details , demonstrating the validity and the accuracy of our scheme .",
    "  [ mag ] addresses the case of ohmic diffusion , following the same procedure as for ambipolar diffusion , while   [ concl ] is devoted to the conclusion .",
    "when the ions pressure and momentum are negligible compared to those of neutral species ( as is the case for example in molecular clouds ) , the lorentz force exerted on the ions is in equilibrium with the drag force exerted by the neutrals , which corresponds to a situation of strong coupling between the neutral fluid and the field lines .",
    "in such a situation , the plasma can be adequately described by a single fluid ( @xcite and @xcite ) of mass density @xmath2 , and neutrals and ions mass densities @xmath3 and @xmath4 respectively .",
    "interestingly , in the case of the one - fluid approximation the results can be directly compared with the ones obtained with ideal mhd giving clear insights about mhd wave propagation properties in the non - ideal case ( @xcite).the present study is devoted to the technical resolution of the resistive mhd equations and we will also ignore gravity ( and thus the poisson equation ) .",
    "the mhd equations are given by the usual continuity , momentum , energy and induction equations , completed by the magnetic field divergence - free condition ( in rational units , @xmath5 ) :    @xmath6    @xmath7 denotes the total energy @xmath8 where @xmath9 is the specific internal energy .",
    "@xmath10 is the total pressure @xmath11 where @xmath12 is the adiabatic index .",
    "@xmath13 denotes the lorentz force @xmath14 with @xmath15    the ambipolar electromagnetic force ( emf ) is given by @xmath16 where @xmath17 and @xmath18 denote respectively the ions and neutrals velocities , and @xmath19 is the drift coefficient between ions and neutrals due to ambipolar diffusion .",
    "the last equality in equation  ( [ fad ] ) illustrates the balance between magnetic and drag forces in the ion fluid , while equation  ( [ eqenergda ] ) is accounting for ambipolar heating of neutrals by ions ( @xcite ) . in order to write both equation  ( [ eqenergda ] ) and equation  ( [ fad ] ) we need to assume that the velocity drift between ions and neutrals and the one between electrons and neutrals are not too different ( by a factor @xmath20 ) .",
    "therefore , as long as the hall effect is negligible , these equations remain valid ( see @xcite for a more detailed study ) .    equation  ( [ eqenergda ] ) ( the conservation of energy : @xmath21 ) is equivalent to @xmath22 where we can see that the neutrals - ions friction term heats up the gas and increases the entropy .      in this section ,",
    "we describe the numerical implementation of the previous equations , focusing on the ambipolar diffusion terms in the energy and induction equations .",
    "the ambipolar term in the induction equation can be considered as an additional electromotive force ( emf ) . to update the magnetic field the values of the emf have to be defined as time and space averages along cell edges ( @xcite ) .",
    "for instance , the emf in the @xmath23 direction is defined at @xmath24 ( and the same for the other directions with circular permutations ) [ revv3]where i , j and k are the cell indices in the @xmath25 directions respectively .",
    "we focus now on the emf in the @xmath23 direction , defined at @xmath24 and explain in details how it is computed .",
    "@xmath26 writes @xmath27   \\times \\mathbf{b } = \\mathbf{v_d } \\times \\mathbf{b}\\end{aligned}\\ ] ] with the drift velocity @xmath28 .",
    "we therefore have to evaluate @xmath29 and @xmath30 at @xmath24 , and then calculate @xmath31    the ramses code is based on the constrained transport scheme for the magnetic field evolution ( @xcite ) , for which the components of the magnetic field are defined at the center of cell faces : if @xmath32 are the coordinates of a cell center , @xmath33 is defined at position @xmath34 , @xmath35 at @xmath36 and @xmath37 at @xmath38 ( see figure  [ schemas12 ] ) .",
    "each magnetic field component is computed using the finite - surface approximation , which reads for the x component : @xmath39 while other components are defined by circular permutations .",
    "we also need to define the drift velocity @xmath40 at @xmath24 using the lorentz force @xmath41 , the density @xmath2 and the ions density @xmath42 .",
    "the two latter quantities are cell - centered quantities ( in contrast to the magnetic field ) : @xmath43 and @xmath44    we then define the edge - centered density ( and the ions edge - centered density ) as an arithmetic average of surrounding cells ( see figure  [ schemas12 ] , right panel ) : @xmath45.\\end{aligned}\\ ] ]     by averaging over neighbouring cells.,title=\"fig:\",scaledwidth=33.0% ]   by averaging over neighbouring cells.,title=\"fig:\",scaledwidth=31.5% ]    this definition is adapted for the components of the magnetic field to compute them at @xmath24 ( see figure  [ schemas32 ] ) : @xmath46   \\label{eqnbx } \\\\",
    "b_{y;i-\\frac{1}{2},j-\\frac{1}{2},k } & = \\frac{1}{2 } \\big [ b_{y;i , j-\\frac{1}{2},k } + b_{y;i-1,j-\\frac{1}{2},k } \\big ]   \\label{eqnby } .\\end{aligned}\\ ] ]     and @xmath35 at @xmath24.,title=\"fig:\",scaledwidth=33.0% ]   and @xmath35 at @xmath24.,title=\"fig:\",scaledwidth=33.0% ]    given the lorentz force at @xmath24 ( see sections  [ calculexplicitlorentz ] and [ divduflux ] ) , it is possible to compute the first component ( z direction , with unit vector @xmath47 ) of the ambipolar emf : @xmath48 , while the two other components are obtained through circular permutations .",
    "these ambipolar emfs are then added to the ideal mhd emfs calculated with a 2d riemann solver , as described in @xcite and @xcite .",
    "we now focus on the computation of the lorentz force @xmath41 at @xmath24 . the first way to calculate",
    "this term is to explicitly compute the magnetic field components and the current @xmath49 at @xmath24 , as : @xmath50    @xmath51 is naturally defined at @xmath24 and @xmath52 and @xmath53 are naturally defined respectively at @xmath54 and @xmath55 . in order to have all three components of @xmath56 at the location of the emf ( @xmath24 ) we need to use the magnetic field components at specific positions , as follows : @xmath57    as above",
    ", we have to express each of these terms through arithmetic averages of the naturally defined components of the magnetic field : @xmath58    @xmath59 and @xmath60 are naturally defined at @xmath61 and @xmath62 respectively , and thus the two terms in equation  ( [ direct ] ) need not to be computed again .",
    "the terms in equation  ( [ mag1 ] ) and equation  ( [ mag2 ] ) are obtained thanks to averages on four components ( see figure  [ schemas45 ] ) : @xmath63 \\nonumber \\\\        & = \\frac{1}{2}\\big [ b_{z;i , j , k } + b_{z;i-1,j , k } \\big ] \\\\",
    "b_{z;i , j-\\frac{1}{2},k } & = \\frac{1}{2}\\big [ b_{z;i , j , k } + b_{z;i , j-1,k } \\big ] \\\\",
    "b_{x , i-\\frac{1}{2},j-\\frac{1}{2},k-\\frac{1}{2 } } & = \\frac{1}{4 } [ b_{x;i-\\frac{1}{2},j , k } + b_{x;i-\\frac{1}{2},j-1,k } + b_{x;i-\\frac{1}{2},j , k-1 } + b_{x;i-\\frac{1}{2},j-1,k-1 } ] \\\\",
    "b_{y , i-\\frac{1}{2},j-\\frac{1}{2},k-\\frac{1}{2 } } & = \\frac{1}{4 } [ b_{y;i , j-\\frac{1}{2},k } + b_{y;i-1,j-\\frac{1}{2},k }   + b_{y;i , j-\\frac{1}{2},k-1 } + b_{y;i-1,j-\\frac{1}{2},k-1 } ] .\\end{aligned}\\ ] ]     as an average over surrounding cells .",
    "right : @xmath64.,title=\"fig:\",scaledwidth=33.0% ]   as an average over surrounding cells .",
    "right : @xmath64.,title=\"fig:\",scaledwidth=33.0% ]    the lorentz force for the other components of the emf ( @xmath65 and @xmath66 directions ) are obtained through circular permutations .",
    "another way to compute the lorentz force is to express it as the divergence of a well chosen flux : @xmath67 and @xmath68 with @xmath69 $ ] and @xmath70 .",
    "let us focus on the @xmath65 component of the lorentz force for the emf in the @xmath23 direction .",
    "it reads : @xmath71    in order to compute the lorentz force at @xmath24 , we compute each term at specific positions : @xmath72 \\label{eqn005}\\\\   \\partial_y ( b_x b_y )                   = & \\frac{1}{\\delta y } \\big [   b_{x , i-\\frac{1}{2},j , k } b_{y , i-\\frac{1}{2},j , k }   - b_{x , i-\\frac{1}{2},j-1,k } b_{y , i-\\frac{1}{2},j-1,k }   \\big ] \\\\",
    "\\partial_z ( b_x b_z )                   = & \\frac{1}{\\delta z } \\big [   b_{x , i-\\frac{1}{2},j-\\frac{1}{2},k+\\frac{1}{2 } } b_{z , i-\\frac{1}{2},j-\\frac{1}{2},k+\\frac{1}{2 } }   -   b_{x , i-\\frac{1}{2},j-\\frac{1}{2},k-\\frac{1}{2 } } b_{z , i-\\frac{1}{2},j-\\frac{1}{2},k-\\frac{1}{2 } }   \\big ] .",
    "\\end{aligned}\\ ] ]    we then only need to compute each component of the magnetic field at @xmath24 in order to get the emf in the @xmath23 direction .    as explained in the previous paragraph , an average over well chosen ( where the magnetic field is naturally defined ) surrounding cells is used ( see figures  [ schemas32 ] and  [ schema6 ] ) :    @xmath73 \\\\",
    "b_{z;i , j-\\frac{1}{2},k } & = \\frac{1}{2}\\big [ b_{z;i , j , k } + b_{z;i , j-1,k } \\big ] \\\\",
    "b_{y;i-\\frac{1}{2},j , k } & = \\frac{1}{2}\\big [ b_{y;i , j , k } + b_{y;i-1,j , k } \\big ] \\label{eqn00001}\\\\    b_{x , i-\\frac{1}{2},j-\\frac{1}{2},k-\\frac{1}{2 } } & = \\frac{1}{4 } [ b_{x;i-\\frac{1}{2},j , k } + b_{x;i-\\frac{1}{2},j-1,k } \\nonumber \\\\                          & + b_{x;i-\\frac{1}{2},j , k-1 } + b_{x;i-\\frac{1}{2},j-1,k-1 } ] \\\\    b_{z , i-\\frac{1}{2},j-\\frac{1}{2},k-\\frac{1}{2 } } & = \\frac{1}{4 } [ b_{z;i , j , k-\\frac{1}{2 } } + b_{z;i , j-1,k-\\frac{1}{2 } } \\nonumber \\\\                          & + b_{z;i-1,j , k-\\frac{1}{2 } } + b_{z;i-1,j-1,k-\\frac{1}{2 } } ] \\label{eqn00002 } , \\end{aligned}\\ ] ]    and @xmath74 \\\\    b_{y;i-\\frac{1}{2},j-\\frac{1}{2},k } & = \\frac{1}{2}[b_{y;i , j-\\frac{1}{2},k } + b_{y;i-1,j-\\frac{1}{2},k } ] \\\\    b_{z;i-\\frac{1}{2},j-\\frac{1}{2},k } & = \\frac{1}{4 } \\big [   \\frac{1}{2 } ( b_{z;i , j , k-\\frac{1}{2}}+b_{z;i , j-1,k-\\frac{1}{2 } } ) \\nonumber \\\\                        &    +                  \\frac{1}{2 } ( b_{z;i-1,j , k-\\frac{1}{2}}+b_{z;i-1,j-1,k-\\frac{1}{2 } } ) \\nonumber \\\\                        &    +                  \\frac{1}{2 } ( b_{z;i , j , k+\\frac{1}{2}}+b_{z;i , j-1,k+\\frac{1}{2 } } ) \\nonumber \\\\                        &    +                  \\frac{1}{2 } ( b_{z;i-1,j , k+\\frac{1}{2}}+b_{z;i-1,j-1,k+\\frac{1}{2 } } ) \\big ] \\label{eqn006 } \\nonumber \\\\                        & = \\frac{1}{4}[b_{z;i , j , k}+b_{z;i , j-1,k } \\nonumber \\\\                        & + b_{z;i-1,j , k}+b_{z;i-1,j-1,k } ] .\\end{aligned}\\ ] ]     as an average over eight naturally defined magnetic components.,scaledwidth=50.0% ]    again and as highlighted previously , in order to get the two other components of the emf one only needs to perform circular permutations .",
    "these two methods ( described in sections  [ calculexplicitlorentz ] and [ divduflux ] ) to compute the lorentz force are implemented in ramses and show similar performances .",
    "[ revv5]this method might work better under certain conditions , for a particular setup of the magnetic field lines .",
    "nonetheless , when counting the number of floating point operations , the computer performs using this method 4911 more additions and 8047 more multiplications for a given cell than with the previously described method .",
    "the ambipolar energy flux ( see equation  [ fluxambi ] ) has to be evaluated on each face of the cell , that is to say at locations @xmath75 , @xmath76 and @xmath77 .",
    "again , as in   [ ambterm ] , the needed components are obtained thanks to averages over neighbouring cells ( averages which are not detailed here ) .",
    "@xmath78      the ambipolar diffusion timescale can be estimated through the drift velocity of ions .",
    "recalling equation  ( [ fad ] ) we get : @xmath79 where @xmath80 is a characteristic length for ambipolar diffusion , which can be estimated as [ rev2 ] @xmath81 .",
    "we then have the timescale : @xmath82    written as a diffusion , @xmath83 with the ambipolar diffusion coefficient @xmath84 , where @xmath85 is the alfvn speed and @xmath86 is the characteristic collision time between ions and neutrals .",
    "[ rev6]a von neumann analysis for the diffusion part of the equation can be performed for the scheme used : @xmath87 it can be differenced ( in one dimension ) : @xmath88 using @xmath89 , @xmath90 equation  ( [ eqnvonneumann ] ) shows that the scheme is stable according to von neumann stability analysis provided the coefficient is lower than 0.5 : @xmath91for the three dimensional case , this time - step constraint is more stringent than for the one dimensional case presented above .",
    "therefore , the time step used to update the solution is computed by taking the minimum of the usual mhd courant condition ( @xcite ) and the ambipolar timestep defined by @xmath92 where the minimum is taken over all the cells of the computational grid . the coefficient @xmath93 is taken to achieve better convergence",
    "this choice is based on the various tests performed , and might not be suited to all other problems .",
    "[ rev4]as can be noted in equation ( [ timestepad ] ) , the time - step scales as @xmath94 . even though this is very demanding in terms of numerical resources as the grid becomes more and more refined ,",
    "there are means to speed - up the calculations , as explained in the following paragraph .",
    "the ambipolar time step is proportional to @xmath42 ( see equation  ( [ timestepad ] ) ) , which is assumed to be proportional to @xmath95 : @xmath96 ( see @xcite ) .",
    "both the factor ( @xmath97 ) and the power law ( @xmath98 ) are very dependent on the microphysics and the geometry of the grains .",
    "this assumption is thus made for the sake of simplicity , but might not always be valid . in some cases ,",
    "for example in star formation simulations , the time - step can become unphysically small in very diffuse regions where the ionisation approximated as above ( equation  ( [ timestepad ] ) ) is very small .",
    "following @xcite , we use a threshold in order to limit the time - step when needed . on the other hand , in very dense parts where the grid is fairly refined ( where @xmath99 is small )",
    ", the dependence of @xmath42 and @xmath19 with the density prevent the time - step from becoming too becoming too small .",
    "this situation has to be studied for each different physical problem and ca nt be assumed once and for all .",
    "we will address this issue in the case of star - formation in a forthcoming paper .",
    "[ rev9 ]      the amr algorithm used in ramses is described in @xcite , and its extension to mhd is first described in @xcite and then in @xcite .",
    "we briefly recall the main features here .",
    "it is a tree - based amr code whose data structure is a fully threaded tree `` ( @xcite ) .",
    "the grid is divided into ' ' octs \" which are groups of 8 cells with the same parent cell .",
    "the first level of refinement ( @xmath100 ) corresponds to the unit cube , which defines the computational domain .",
    "the grid is recursively refined from the @xmath101 to the minimum level of refinement @xmath102 , in order to build the base cartesian grid .",
    "adaptive refinement then proceeds from this coarse grid up to the user - defined maximum level of refinement @xmath103 .",
    "when @xmath104 the computational grid is a traditional cartesian grid .",
    "issues arise when refined cells are created , in the case where @xmath105 . concerning the non - ideal mhd , the emf and energy fluxes",
    "are simply added to the existing ideal mhd emf and fluxes . as a consequence ,",
    "there are no more complications in refining and derefining cells than in the ideal mhd case .",
    "the `` prolongation operator '' is the creation of a new `` oct '' of 8 cells when a cell is newly refined .",
    "cell - centered variables and magnetic field components are needed for each refined cell .",
    "this is usually done using a conservative interpolation of the variables , yet in the case of magnetic fields , the divergence - free constraint has to be fulfilled by each of the new cells which makes things more complicated in details .",
    "a critical step has been solved by @xcite and @xcite in the constrained transport framework .",
    "the idea developed in those articles is to use slope limiters to interpolate the magnetic field components in each parent face conserving the flux , and then to perform a three dimensional ( which is divergence - free inside the cell volume ) reconstruction in order to compute the new magnetic field components for each children faces .",
    "the same slope limiters as the ones used in the godunov scheme for the hydrodynamics are used in this step .",
    "the `` restriction operator '' is , in the multigrid terminology , the operation of derefining a split cell .",
    "the divergence - free constraint still needs to be satisfied , so that the magnetic field components in the coarse faces are simply the arithmetic averages of the four fine faces values .",
    "this is the parallel in mhd of the `` flux correction step '' for the euler system .",
    "this is specific to the induction equation : for a coarse face adjacent to a refined face , the coarse emf in the conservative update of the solution needs to be replaced by the arithmetic average of the two fine emf vectors .",
    "this is mandatory to guarantee that the magnetic field remains divergence - free even at coarse / fine boundaries .        in this section ,",
    "we first test the accuracy of the calculation of the ambipolar term alone . for sake of simplicity , we assume that the magnetic field has the form @xmath106 , with @xmath107 and @xmath108 , that all the velocities remain equal to zero and that density and thermal pressure are constant .",
    "the induction equation takes the form of a diffusion equation : @xmath109 which can also be written in compact form : @xmath110    this is a non - linear diffusion equation , since the diffusion coefficient , @xmath111 , depends non - linearly on the magnetic field . here",
    ", @xmath112 denotes the y - component of the alfvn velocity .",
    "the solution of this problem with a dirac pulse as initial condition ( known as the barenblatt - pattle solutions ) has been derived by @xcite ( see appendix  [ annexebaren ] for more details about the analytical solution ) .    the initial states in one and two dimensions are respectively : @xmath113 [ revv4]with @xmath114 being the cell size at the lowest level of refinement used ( in this case : 3 ) .",
    "this ensures that the initial perturbation is the same for the case of an amr grid and a fully refined grid .",
    "we performed the test both with a uniform grid and using the amr with the same maximum level .",
    "[ rev5]the level of refinement refers to the number of cells used : @xmath115 cells are used for the level of refinement @xmath116 in a @xmath117-dimensional calculation . as seen in the figures , the agreement between the numerical and the analytical curves is excellent , a few tenths of a percent on average .",
    "the results obtained on an amr grid ( with levels varying from 3 to 7 , corresponding to a mesh size @xmath118 and @xmath119 ) are almost as good as the ones obtained on a regular grid corresponding to the highest level of refinement ( level 7 , with a cell size @xmath120 and 128 cells ) : the maximum relative error is less than one percent except where the magnetic field equals zero .",
    "the difference between amr and uniform grid is less than @xmath121 for values of magnetic field of about @xmath122 .",
    "the results for @xmath123 are shown on figure  [ figbaren1 ] , where we have taken @xmath124 , @xmath125 and @xmath126 and on figure  [ figbaren2 ] for @xmath106 .",
    "the grid is refined if the gradient of magnetic field is greater than 0.1 ( this insures for this test that the error on the amr grid and on the regular grid are about the same ) .",
    "we also checked that the same accuracy is obtained for any orientation of the magnetic field ( using @xmath127 or @xmath128 instead of @xmath129 ) .",
    "figure  [ figordbaren ] represents the evolution of the error calculated as @xmath130 as function of the mesh size ( @xmath116 being the number of cells for each level ) .",
    "[ rev_comput]in terms of computational time for this particular test using the refinement strategy described above , the time is about the same for a regular grid at level 7 as for a grid going from levels 5 to 7 , but there is a gain of about @xmath131 in the number of cells .",
    "one level further ( regular grid at level 8 or amr grid going from levels 5 to 8) the computation is @xmath132 faster in the amr case and needs @xmath133 less cells . for a regular grid at level 9 or an amr grid going from levels 5 to 9",
    "the calculation is @xmath134 faster with @xmath135 less cells needed .",
    ", with n the number of cells .",
    "the dashed line corresponds to @xmath136.,scaledwidth=54.0% ]      [ cshock ]    following @xcite and @xcite , we have tested our new scheme for the case of both isothermal and non - isothermal oblique c - shock including ambipolar heating as given by equation  ( [ eqenergda ] ) .",
    "we start from a steep function as initial state for the different variables , whose values are the ones taken at infinity ahead of and behind the shock .",
    "our calculation takes place in the frame of the shock .",
    "the post- and pre - shock values are displayed in table  [ tabchocoblda ] .",
    "the angle between the shock normal and the magnetic field is set to 45@xmath137 .",
    "[ cols=\"^,^,^,^,^,^,^\",options=\"header \" , ]     such an agreement between the numerical and the analytical solutions , within about 0.2% ( except a few points where it can reach 1% ) can be considered as very satisfactory and asseses the validity of our treatment when hydrodynamics and ohmic diffusion are coupled .",
    "the grid is refined if the gradient of magnetic field , pressure , density or velocity is greater than 0.1 ( this insures for this test that the error on the amr grid and on the regular grid are about the same ) .",
    "proceeding as for the ambipolar diffusion study we have examined the behaviour of propagating alfvn waves as well as of standing waves in an non - isothermal ionized plasma in the case of ohmic diffusion .",
    "lesaffre and balbus ( 2007 ) derived analytical solutions for the general case of mhd flows with shear , non - zero resistivity @xmath138 , viscosity and cooling . in the absence of shear and rotation",
    ", these authors showed that torsional afvn waves are a solution for such flows .",
    "following closely the notations of lesaffre and balbus ( 2007 ) , the unperturbed state in both studies for a wave propagating in the @xmath65 direction is defined as : @xmath139    for the propagating wave study , the perturbed state is chosen such as @xmath140 and @xmath141 ( we necessarily have @xmath142 ) .",
    "furthermore , we have @xmath143 ( constant density ) , but the pressure varies with time , so that @xmath144 ( see lesaffre & balbus 2007 ) . in the absence of shear , viscosity and rotation , the relation between the perturbed magnetic field , @xmath145 , and the perturbed velocity , @xmath146 , reads @xmath147 with @xmath148 the wave angular frequency and @xmath149 the wave number .    the time evolution of the gaz pressure @xmath150 is governed by the equation : @xmath151 with @xmath12 the adiabatic coefficient of the gaz and @xmath152 the current .    since @xmath146 only depends on @xmath23 and has components only in the @xmath65 and @xmath66 direction , @xmath153 .",
    "we finally get    @xmath154    the solutions of the dispersion relation read : @xmath155 with @xmath156 .",
    "a value @xmath157 yields a moderate damping , with @xmath158 and @xmath159 , whereas a value @xmath160 produces a stronger damping , with @xmath161 and @xmath162 .",
    "[ [ estimating - numerical - diffusion ] ] estimating numerical diffusion + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    proceeding exactly as in   [ modifequation ]",
    "we can derive the leading order error term in the ideal mhd scheme for alfvn standing , and propagating waves .",
    "[ [ propagating - waves - alfvenpropadm ] ] propagating waves [ alfvenpropadm ] + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    we start the simulation from an initial perturbed state with @xmath163 and @xmath164 .",
    "the time evolution of the pressure is : @xmath165    for the propagating wave test , we have arbitrarily chosen @xmath166 and let the system evolve from the initial state .",
    "figure  [ figalfvpropadm ] portrays a snapshot of the evolution of @xmath167 , @xmath168 , @xmath169 , @xmath170 , @xmath2 and @xmath150 along the @xmath23-direction after five wave periods ( _ i.e _ , @xmath171 ) , for @xmath172 .",
    "once again , the agreement between the numerical and the analytical solution is very satisfactory , at most of the order of a few percents .      +     +        [ [ standing - waves - alfvenstatiodm ] ] standing waves [ alfvenstatiodm ] + + + + + + + + + + + + + + + + + + + + + + + + + + + + + + +    as for the ambipolar diffusion , we start the simulation from an initial perturbed state obtained by adding two propagating waves with opposite values of @xmath173 and the same value of @xmath174 , and let the system evolve .",
    "the evolution of the pressure is ( in real notation ) : @xmath175 . \\end{aligned}\\ ] ] figure  [ figalfvstatiodm ] shows a snapshot of the evolution of @xmath167 , @xmath168 , @xmath169 , @xmath170 , @xmath2 and @xmath150 along @xmath23 after three wave periods ( @xmath176 ) , for @xmath177 .",
    "as seen , once again , the agreement between the numerical and the analytical solution is very good , of the order of or better than a few percents .",
    "+     +        ) of @xmath178 , the root - mean - square of the magnetic field in the @xmath65 direction , for alfvn standing waves . in this case ,",
    "@xmath179.,scaledwidth=57.0% ]      we tested the evolution of the precision of the implementation of ohmic diffusion by examining the evolution of the error with the level of refinement , _",
    "i.e _ with the mesh size @xmath99 for alfvn standing waves and the barenblatt test .",
    "the error @xmath9 is defined here as the maximum difference between the analytical values and the numerical solution , corrected by the damping factor for alfvn waves , and the error at the center of the box for the barenblatt test .",
    "the error as function of cell size follows a power - law , at least in the range studied here ( up to 10 periods of the wave ) . for the standing waves we find : @xmath180 for the alfvn propagating waves @xmath181 for the barenblatt test @xmath181    a log - log plot of the error as a function of cell size @xmath99 for different times",
    "is given on figure  [ errorstandingohmic ] for alfn standing waves , and on figure  [ errorohmicbaren ] for the barenblatt test .",
    "the behavior of the error for the propagating waves differs if the mesh size is coarse or fairly refined ( @xmath182 or @xmath183 respectively ) . for the barenblatt test",
    ", the error scales as @xmath184 .",
    "[ rev7]in the case of ohmic diffusion , equation  ( [ eqn09 ] ) reduces exactly to the heat equation , whereas in the case of ambipolar diffusion , equation  ( [ eqn10 ] ) reduces to a non - linear diffusion equation .",
    "the error in the two cases scales as @xmath184 .",
    "as seen in section  [ alfvenpropadm ] , the dissipation of alfvn waves is slightly larger than expected according to the analytical values .",
    "the spurious dissipation due to the numerical scheme can be estimated as : @xmath185 where @xmath186 is the value measured in the numerical simulation , with @xmath187 , and @xmath188 is the drift contribution due to numerical dissipation .",
    "another way to proceed is to set @xmath189 , to examine how the alfvn waves dissipate , and then to estimate @xmath188 as @xmath190 .",
    "both methods give about the same value for @xmath188 . for a level of amr refinement of 4 ,",
    "we get @xmath191 ; for 5 , @xmath192 and for 6 , @xmath193 , to be compared with @xmath194 or 0.02 for the present simulations . as expected , the better the resolution , the smaller the numerical diffusion .",
    "in this paper we have described a numerical method to implement the treatment of the two important terms of non - ideal mhd , namely ambipolar diffusion and ohmic dissipation , into the multi - dimensional amr code ramses . for ambipolar diffusion",
    ", we have used a single fluid approach , which is valid when the lorentz force and the neutral - ion drag force are comparable , corresponding to a domain of strong coupling between the fluid and the field lines .",
    "the situations where such an approximation can be made are numerous , of which cloud collapse or certain protoplanetary disks are two typical examples .",
    "the accuracy of our numerical resolution of the mhd equations was examined by performing a diversity of tests , for which either analytical or benchmark solutions exist . for both ambipolar and ohmic diffusion",
    ", we first explored the purely magnetic case , without any coupling to the hydrodynamics . for ambipolar diffusion ,",
    "this was done by comparing the evolution of a dirac pulse to the solution provided by barenblatt while for ohmic diffusion , the solution is confronted to the well known heat diffusion equation . in a second step , we studied the full mhd case ( coupling the fluid to the magnetic field ) by considering first an oblique shock , and then the behavior of propagating and standing alfvn waves .",
    "for all these tests the solutions obtained with our method show excellent agreement with the analytical predictions , typically within a few tenths of a percent on average , showcasing the validity and the robustness of our method .",
    "we have also carefully analyzed the main source of numerical error using the modified equation framework . in order to estimate the spatial resolution that is required to model non - ideal mhd effects reliably .",
    "this opens the avenue to a vast domain of astrophysical applications , in particular cloud collapse , pre - stellar core formation and protostellar disks where ambipolar and ohmic diffusion processes are believed to play a dominant role .",
    "such astrophysical applications of the non - ideal mhd equations with ramses will be explored in forthcoming papers .",
    "the research leading to these results has received funding from the european research council under the european community s seventh framework programme ( fp7/2007 - 2013 grant agreement no .",
    "following @xcite , the solution of equation  ( [ bybaren ] ) in general form ( @xmath195 ) , where @xmath196 depends on the problem , is : @xmath197^{{\\beta}^{-1 } } & \\quad & \\textrm{if } \\quad r \\leq \\eta_0 t^{\\delta}\\\\ & 0 & \\quad & \\textrm{if } \\quad r > \\eta_0 t^{\\delta }   \\end{split } \\right.\\ ] ] with @xmath198 the dimensionality of the problem , the various constants are defined as follow : @xmath199",
    "following @xcite , in the isothermal case with a constant ion density , we reduce the set of mhd equations to : @xmath200 \\end{aligned}\\ ] ] with @xmath201 and @xmath202 derived from the initial state , @xmath203 the alfvn mach number , and @xmath204 the mach number ; @xmath205 is the angle between the magnetic field and the velocity field ; and @xmath206 and @xmath207 are the dimensionless density and magnetic field .",
    "following @xcite and @xcite , and reminding that the set of equations is not exactly the same as ours , we solve the set of equations : @xmath208 where the dimensionless quantities are @xmath209 , @xmath210 , the velocities @xmath211 , @xmath212 .",
    "@xmath213 and @xmath214 are the initial dimensionless pressure and magnetic fields , @xmath205 is the angle between the pre - shock velocity and the magnetic field , and @xmath215 the alfvn mach number ."
  ],
  "abstract_text": [
    "<S> we have implemented non - ideal magneto - hydrodynamics ( mhd ) effects in the adaptive mesh refinement ( amr ) code ramses , namely ambipolar diffusion and ohmic dissipation , as additional source terms in the ideal mhd equations . </S>",
    "<S> we describe in details how we have discretized these terms using the adaptive cartesian mesh , and how the time step is diminished with respect to the ideal case , in order to perform a stable time integration . </S>",
    "<S> we have performed a large suite of test runs , featuring the barenblatt diffusion test , the ohmic diffusion test , the c - shock test and the alfven wave test . for the latter , </S>",
    "<S> we have performed a careful truncation error analysis to estimate the magnitude of the numerical diffusion induced by our godunov scheme , allowing us to estimate the spatial resolution that is required to address non - ideal mhd effects reliably . </S>",
    "<S> we show that our scheme is second - order accurate , and is therefore ideally suited to study non - ideal mhd effects in the context of star formation and molecular cloud dynamics . </S>"
  ]
}