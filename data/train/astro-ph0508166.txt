{
  "article_text": [
    "during most of its lifetime , a galaxy undergoes long periods of secular evolution .",
    "the subtle dynamical effects driving this evolution are best studied using analytic techniques that can accurately follow the accumulation of weak perturbations for long periods of time .",
    "the mere existence of a present - day disk galaxy selects against strong or frequent mergers since its formation owing to the fragility of galactic disks .",
    "the evolution of such galaxies must be dominated by long - term secular changes , which are harder to model using n - body simulations . however , since galaxy evolution is punctuated by epochs of violent nonlinear evolution , e.g. initial formation , and major and minor mergers , modern researchers must rely upon n - body simulations , which can easily follow strong perturbations for short periods of time and adapt to evolving equilibria . similarly , modelling realistic astronomical scenarios that include collisionless dark matter and star particles , gas , star formation and mass loss from winds require simulations . in the coming decade , simulations of galaxies that accurately evolve the dynamics over many gigayears will be possible , including a more physical treatment of the ism , star formation , and mass loss . as researchers reliance on n - body simulation continues to grow and",
    "simulations continue to be used as the gold standard for theoretical verification , it is important to verify that n - body simulations truly capture the dynamical mechanisms that drive quiescent galaxy evolution .",
    "the secular evolution of quiescent galaxies is driven by structural asymmetries , often triggered by environmental perturbations such as satellites and group interactions or by local instabilities such as in swing amplification @xcite .",
    "the response of a galaxy to an asymmetry results in torques that globally redistribute energy and angular momentum among the dark matter , stellar , and gas components and thereby change the galaxy s equilibrium mass distribution .",
    "a barred galaxy is the simplest , most well - defined example of strong inter - component evolution and , therefore , a good litmus test for our understanding of long - term galaxy evolution mediated by resonant interactions ; more than half of all galaxies are strongly barred in the near ir @xcite .",
    "we will emphasise the bar ",
    "halo interaction as an example throughout this paper but one should remember that the same dynamical arguments apply to any evolving disturbance including interactions between the inner and outer disk , the spheroid , and the dark matter halo . a merging satellite , for example ,",
    "will be the subject of a forthcoming paper .",
    "halo interaction has been studied recently by a large number of groups with a variety of differing conclusions @xcite .",
    "the goal of this paper is to provide a detailed understanding of the dynamical mechanisms underlying this simplest of intercomponent interactions and as a guide to the requirements necessary to reproduce these dynamics accurately in n - body simulations .",
    "the bar - halo interaction is most often described in terms of dynamical friction although , as we will see later in this paper many aspects of this interaction are qualitatively different .",
    "* hereafter tw ) and @xcite explained the bar slow down observed in n - body simulations @xcite by using dynamical friction as a paradigm and by deriving a formalism appropriate for the quasi - periodic orbits typical of galaxies . in short , the bar interacts with the dark matter halo near resonances .",
    "this induces a wake that lags the bar and , therefore , torques the bar and slows its pattern speed .",
    "the use of the chandrasekhar formula produces the correct scaling for the halo  bar torque with rapid evolution , but does not properly represent the underlying mechanism . to see this , consider a sphere of orbits with a rotating bar pinned to its centre .",
    "if one stood on the rotating bar and looked at the surrounding orbits in general they would execute rosettes . because orbits spend more time near apocenter than pericenter",
    ", orbits will torqued by the bar if their apocenters lead the bar .",
    "however , eventually the apocenters of the same orbit will trail the bar as the rosette fills in .",
    "if one waits long enough , the apocenter will appear at every phase relative to the bar and the net torque on the orbit will vanish .",
    "if one applies this argument to every orbit , the bar can never apply a torque !",
    "what went wrong ?",
    "we made two related but inconsistent assumptions : ( 1 ) we can ignore the closed periodic orbits because they are measure zero in phase space ; and ( 2 ) we can wait sufficiently long for the orbits to look like filled in rosettes .",
    "consider an orbit that is not quite closed .",
    "this nearly closed orbit will have apsides that precess so slowly that it will never look like a filled in rosette over an astrophysically realistic time period because a galaxy is only a finite number of bar periods old . as one makes the time interval shorter , more orbits will not look like filled in rosettes .",
    "these orbits _ will _ receive a net torque over this finite period , which causes the bar to slow .",
    "however , as the bar slows , these nearly closed orbits no longer find themselves nearly closed and a new set of orbits take their place .",
    "this describes the essence of resonant angular momentum transfer .",
    "the resonance itself refers to the closed orbit condition : frequencies of the orbit being commensurate with the frequency of the bar pattern . in other words ,",
    "the angular momentum exchange is caused by the breaking of adiabatic invariants near a resonance . even though the periodic orbits have zero measure , they influence the dynamics over a finite measure of phase space .",
    "the importance of resonances in galactic disk dynamics was explored by ( * ? ? ?",
    "* hereafter lbk ) .",
    "the dynamics of this process is qualitatively different than the sum over scatterings that leads to the chandrasekhar formula .",
    "this paper will describe these dynamics in more detail , derive explicit conditions based on hamiltonian perturbation theory that must be satisfied before these resonant dynamics can be obtained in n - body simulations , and demonstrate them with n - body examples .    in an earlier paper , ( * ? ? ?",
    "* hereafter wk ) , we described the interaction between a bar and a dark matter halo based on a combination of perturbation theory and n - body simulations .",
    "we noted that in cuspy haloes the following low - order resonance extends all the way to the centre : @xmath1 where @xmath2 ( @xmath3 ) is the frequency of the radial ( azimuthal ) oscillation and @xmath4 is the pattern frequency of the bar .",
    "this resonance for arbitrary eccentricity orbits is analogous to the classical inner lindblad resonance ( ilr ) for nearly circular orbits .",
    "we will call this resonance the ilr throughout this paper although we really mean its _ hot _ analogue .",
    "the reason that the ilr extends all the way to the centre owes to the relationship between frequencies for radial orbits , @xmath5 . therefore , in a cusp where @xmath6 and @xmath7 , there is always some orbit in an isotropic system such that equation ( [ eq : ilr ] ) holds .",
    "since the specific angular momentum in a central dark matter cusp is very small , if the bar can torque orbits at this resonance , it could make large changes to the inner density profile .",
    "a linear perturbation theory calculation that includes self - gravity suggested that these changes might be significant and the predicted changes were observed in an n - body simulation ( wk ) .",
    "our results differed with the conclusions of published simulations ( e.g. * ? ? ?",
    "* ) only in that this central evolution had not been previously examined .",
    "previous simulations focused on the slowing of the bar , which is widely seen in simulations @xcite but whose rate remains controversial .",
    "wk offered some explanation for these differing results .",
    "the elements of our interpretation fell into two categories : ( 1 ) numerical limitations : astronomically unrealistic ( poisson ) noise disrupting the quasi - periodic dynamics and ( 2 ) the sensitivity of the evolution to the particular halo , disk and bar profiles .",
    "this paper will explore the first of these issues and the underlying dynamics in detail beginning with an elaboration of the physical picture presented above in  [ sec : bardyn ] .",
    "we will explore the second category in ( * ? ? ?",
    "* hereafter paper ii ) . @xcite and ( * ? ? ?",
    "* hereafter s3 ) have suggested that the these differences are caused by the fixed pattern speed assumption in wk , which makes the width of the resonance in frequency space narrow , whereas real resonances in slowing bars are broad .",
    "however , the breadth in frequency space from the finite lifetime of the bar is similar to the breadth from the slowing of the bar .",
    "we will describe why the breadth of the resonance in frequency space is a weak effect in  [ sec : bardyn ] and show that the requirements to accurately simulate this resonance are very stringent and likely explain most of the differences .",
    "most of the comparisons between simulations and analytic theory have examined the overall rate of angular momentum transferred between a bar and a halo using an appropriately developed formula from lbk or tw .",
    "in contrast , we compare the analytic predictions from perturbation theory and the results of n - body simulations by examining the details of the dynamical mechanisms on small scales in phase space . we were surprised to find that the time scale of secular evolution in galaxies , e.g. bar slow down , can be so fast that the lbk formalism gives quantitatively inaccurate results @xcite .",
    "we describe a second surprise in this paper : orbits may linger near the resonance , which causes the change in conserved quantities to scale as the square root of the perturbation strength ( described in wk as the _ slow limit _ ) rather than as the square of the perturbation strength ( the _ fast limit _ ) . such a possibility was discussed in tw but we find that in practice it is important for the ilr .",
    "the proper identification of the dynamical mechanisms and their regimes is a necessary first step in being able to compare with simulations .",
    "all this makes the astronomically relevant regimes for a slowing bar of at least modest strength not easy to describe with analytic perturbation theory .",
    "one needs to include the direct time dependence as described in @xcite and an interaction that may linger near the resonance for an arbitrary time . using hamiltonian perturbation theory , we can reduce the exact solution to a series of one - dimensional hamiltonian problems .",
    "we can then solve these problems using a sequence of symplectic mappings or direct integrations .",
    "this brute - force perturbation technique allows us to obtain solutions for an arbitrary amplitude and time dependence while maintaining the well - understood aspects of secular perturbation theory .",
    "we describe this approach in  [ sec : bardyn ] .    in  [ sec :",
    "simres ] , we discuss the requirements for an n - body simulation to accurately follow these resonant dynamical processes and identify three criteria that must be satisfied .",
    "the first criterion requires that the phase space around the resonance be adequately populated .",
    "the finite number of particles used to trace the gravitational field causes fluctuations on all scales .",
    "these fluctuations can change the dynamics of an orbit near resonance .",
    "we divide these into small- and large - scale fluctuations and derive two additional particle number criteria .",
    "the final criterion also provides estimates for astronomical noise sources such as dark - matter substructure .",
    "we illustrate the consequences of time - dependence and multiple dynamical regimes in  [ sec : simres ] using the generalisation of the familiar lbk formula for finite - time interactions presented in @xcite .",
    "we end with a discussion in  [ sec : disc ] and summarise in  [ sec : summ ] .",
    "there are two complementary ways to describe the dynamics of bar  halo interactions : 1 ) consider the global macroscopic response of the halo to the bar and compute the subsequent evolution ; and 2 ) consider the sum of each orbit s individual response to the perturbation and compute the evolution as the net change in each orbit s conserved quantities .",
    "each point of view provides a different insight but both points of view are formally equivalent and will lead to identical outcomes .",
    "the former is natural for comparison with n - body simulations and the latter with methods and results from nonlinear dynamics .",
    "both require careful attention to the resonances but have different virtues depending on the application .    in the first point of view",
    ", the bar excites a wake in the halo .",
    "an example of such a wake in a self - consistent bar simulation is shown in figure [ fig : barwake ] . the excited dark matter",
    "halo wake lags the bar , which causes a torque on the bar and removes angular momentum .",
    "naively one might expect the wake to be symmetric about the bar .",
    "an explanation for the lag requires us to consider the second point of view : the response of individual orbits .",
    "the basic physical picture was outlined in  [ sec : intro ] : an arbitrary orbit has apsides that precess either forward or backward in the rotating bar frame , depending on the orbit s energy and angular momentum .",
    "a forward - precessing case is shown in the first panel of figure [ fig : resorb ] . over short periods of time ,",
    "the orbit may torque the bar and later the bar may torque the orbit . however , if we look at this orbit averaged over some time interval @xmath8 , long compared to both its orbital and precession periods , the bar will see an axisymmetric ring of mass density .",
    "such an orbit , therefore , does not change its angular momentum and presents _ no net torque _ on the bar .",
    "however , there will always be some orbits that are very nearly closed in the bar frame ; these are the _ commensurate _ or _ resonant orbits_. near commensurabilities , the precession appears to stop or slow down so much that it might as well be stopped .",
    "more precisely , for some fixed time interval @xmath8 , the precession rate is sufficiently slow that density of the orbit averaged over the available time is not axisymmetric .",
    "this situation is shown in panels ( b ) and ( c ) of figure [ fig : resorb ] for orbits successively closer to resonance .",
    "resonant orbits feel a coherent forcing at the same phase over many periods . for these orbits ,",
    "adiabatic invariance is broken and the actions _ can _ change . therefore ,",
    "the orbit can exchange angular momentum with the bar , which causes both the bar and orbit to evolve .",
    "figure [ fig : resorb ] shows an orbit with prograde procession , but there also exists a corresponding orbit with retrograde procession at a slightly different ( in this case larger ) energy . to lowest order , these orbits cancel and there is no evolution .",
    "although the net torque from the appropriately chosen pair may cancel , the phase - space density will usually vary with energy and hence the average over phase space will not generally cancel : there will either be more prograde or retrograde orbits . more precisely , the net torque caused by a particular resonance will depend on the gradient of the phase - space distribution function at that resonance ( lbk , tw ) . at any one time",
    ", halo orbits are gaining and losing angular momentum owing to all the resonances but the actual net torque occurs as these first order effects cancel . if there were no phase - space density gradient near the resonance , in many cases there would be no evolution .",
    "in addition , this net torque imposes a direction to the evolution and the broken symmetry causes the response to either lag or lead the bar position angle . for a given bar perturbation , the response of the halo and , therefore , the net torque on the bar will depend on the phase - space structure of the dark halo .    from the point of view of an individual orbit",
    ", the bar induces a periodic distortion in its trajectory , analogous to the modulation of a pendulum by a sinusoidal force . averaged over an ensemble of orbits with different phases , the sinusoidal response cancels .",
    "however , orbits that pass through resonance receive a permanent change that is proportional to the amplitude of the perturbation",
    ". the ongoing secular evolution changes both the properties of the bar and the halo .",
    "therefore , the position of the resonance , defined by the closed non - precessing orbit , slowly drifts through phase space ( see  [ sec : calib ] ) .",
    "hence , the time spent by any orbit near a resonance is finite because the entire system evolves as a consequence of the torque applied to these commensurate orbits ( tw ) .",
    "if the secular evolution is rapid , the change in energy and angular momentum ( or actions ) caused by a particular resonance is usually small for any orbit @xcite .",
    "the net change for these orbits do not cancel since there are always some measure of orbits close enough to being closed such that the first - order response does not cover all phases .",
    "the net angular momentum change then results from the coherent interaction between the forced excitation of the orbit and the slowly changing forcing potential , making the magnitude of the response second - order in the bar perturbation amplitude . in summary ,",
    "the net torque is proportional both to the phase space gradient of the unperturbed phase space distribution and to the amplitude of the changes in the angular momenta of individual orbits , which is proportional to the square of the perturbation amplitude .",
    "if the secular evolution is slower , orbits may linger near the resonance . in this case",
    ", the interaction is nonlinear and no longer depends on cancellation or the gradient of the phase - space density .",
    "the change in angular momentum for these interactions depends on the square root of the perturbation amplitude ( tw ) .",
    "we will see that this regime is important for the ilr .",
    "altogether the overall evolution of the galaxy is driven by the net torque from all the resonances and affects a significant fraction of all orbits .",
    "note that the evolution of the galaxy halo is not caused by a dynamical instability but is _ secular _ since it is driven by the exchange of angular momentum with the disk bar .",
    "a common misconception is that resonances are extremely `` thin '' and , therefore , will only affect a set of orbits of measure zero .",
    "based on the physical explanation above , this statement is incorrect for several reasons .",
    "first , one must be careful to distinguish between the width of the resonance in phase space and the width of the resonance in frequency space .",
    "the width in phase space depends on the integers defining the commensurability in eq .",
    "[ eq : ilr ] .",
    "the mathematical definition will be presented in  [ sec : hamilton ] . ] , the amplitude of the perturbation and the frequency of the perturbation , @xmath4 .",
    "the _ resonance width _ scales as the square root of the bar amplitude and inversely with the second partial with respect to the resonant action ( see eq .",
    "[ eq : reswid ] and associated discussion ) .",
    "the sign and magnitude of the torque depends on the phase of the apoapse as it passes through the resonance and the net torque results from the sum over all possible phases .",
    "if there were insufficient orbital density in a resonance width then one would not get the ensemble result but the contributions from a few orbits at arbitrary phase , which would give a larger , fluctuating contribution .",
    "this leads to an important particle number criterion (  [ sec : calib ] ) .",
    "secondly , for a real stellar system , the frequency spectrum of the perturbation is not made of sharp lines but is broadened both by the finite age of the galaxy and by the time - dependence of the driving bar perturbation .",
    "this is related to our consideration of finite time intervals @xmath8 in the previous discussion .",
    "as long as the integral under each `` line '' in the spectrum is approximately the same , the time - asymptotic result from secular perturbation theory remains valid .",
    "in other words , nearly the same results obtain as long as the resonances are not overlapping , which is true unless the bar slows is so quickly that distinct resonances disappear , which we will demonstrate does not occur in practise .",
    "this approximation also breaks down if the overall evolution of the bar pattern speed or the density profiles is so slow that the changes in the individual orbits near the resonance receive nonlinear perturbations . this situation can occur for some resonances even when the bar pattern speed changes rapidly as the bar loses angular momentum @xcite . in these cases ,",
    "the perturbation equations may be solved directly , as we will describe below .",
    "even if the bar pattern speed did not change or were held fixed artificially , new orbits would still be affected as the phase - space structure of the system itself evolved .",
    "the orbits at or near the resonance will change their actions and will , therefore , occupy a different part of phase - space .",
    "this in turn causes the halo potential to change and reach a new equilibrium , moving fresh material into the resonance .    finally , even in the extremely artificial situation",
    "where both the background potential and the bar pattern speed were held fixed , a significant number of orbits would still be affected as long as the system only existed for a finite time .",
    "orbits near a resonance precess away from the resonance but they only do so very slowly : the closer they are to the resonance , the slower their precession . given an infinite time such orbits would precess through all angles and give an axisymmetric time averaged orbit that would feel no net torque from the bar .",
    "in such an eternal system , the orbits affected would be a set a measure zero .",
    "however , any astrophysical system only exists for a finite time so the bar changes the actions of many orbits .",
    "we explicitly compute the extent in phase space of resonances for finite time perturbations in  [ sec : simres ] .",
    "these same arguments imply that there is no evolution without resonances for a _ collisionless _ system in a near - equilibrium state . in the case of a rotating bar , for some fixed @xmath9 , the density of a time - averaged orbit sufficiently far from a resonance",
    "is axisymmetric ( see fig . [",
    "fig : resorb ] , first panel ) and , therefore , applies no torque . in the absence of all resonances , the conserved actions , energy and angular momentum , are preserved for all time in an axisymmetric collisionless stellar system . in this sense ,",
    "post - formation near - equilibrium galaxy evolution is governed by the resonant transfer of angular momentum .",
    "resonances are not the exception but are required for galaxy evolution !",
    "for example , global `` modes '' , i.e. a density wave that self - similarly evolves and whose ensemble describes all possible excitations such as spiral arms , bars , and halo modes , must dominate angular momentum transfer in the absence of strong non - equilibrium perturbations such as mergers . in the absence of these `` modes '' ,",
    "secular evolution can only occur by local _",
    "collisional _ scattering , as in an accretion disk , but this process has a characteristic time scale much longer than a hubble time in galaxies with the observed amount of substructure .",
    "in this and the next several subsections , we convert this physical picture to rigorous criteria for computing resonance phenomena in particle simulations . in later sections and in paper ii",
    ", we will explore these dynamics in n - body simulations directly .",
    "one can estimate the overall torque applied by a bar analytically by summing the change in the action caused by the perturbation after some period @xmath9 for each orbit in an ensemble using the collisionless boltzmann equation ( cbe ) .",
    "although more difficult , this approach does the averaging analytically .",
    "however , one must be careful to treat the formal divergences that occur at resonances .",
    "these divergences are caused by the infinitely large amplitude achieved by an infinitesimal number of particles , but are not a cause for physical concern .",
    "alternatively , one may solve the perturbation theory equations directly ( see  [ sec : solve ] ) .",
    "one must also take care to include all the important resonances in this sum including those associated with both discrete and continuous modes .",
    "this is a straightforward if somewhat complicated calculation if both self gravity and modes are excluded , which we do here .",
    "however , self - gravity can enhance the response at large _ global _ scales @xcite and is also responsible for",
    "the existence of weakly damped discrete modes @xcite , such as the @xmath10 sloshing mode .",
    "these modes persist for astronomically relevant time scales and some are sufficiently long - lived that they must be included to follow the dynamics correctly .",
    "real astrophysical systems are not eternal and damped modes are observationally evident in asymmetries ( e.g. * ? ? ?",
    "* ) . with additional work ,",
    "self gravity and point modes can be accommodated by analytic perturbation theory , although analytic estimates of complex realistic scenarios are difficult .",
    "( in  [ sec : numsol ] , we present a direct solution to the perturbation theory problem that circumvents all of these difficulties at the expense of cpu time . )",
    "we begin by presenting the solution of the cbe both to make contact with previous work ( e.g. lbk & tw ) and illustrate the difficulties .",
    "this development also includes all of the background needed for direct solution .",
    "the torque on the halo may be computed analytically by expanding the rotating bar potential in a fourier series , where each angle corresponds to a quasi - periodic degree of freedom for an orbit . in a spherical system ,",
    "one degree of freedom corresponds to radial motion , one to azimuthal motion in the orbital plane , and one to the orientation of the orbital plane .",
    "this last angle has zero frequency .",
    "the coefficients of the expansion will then depend only on actions @xmath11 : @xmath12 where @xmath4 is the bar pattern speed , @xmath13 is azimuthal wave number defined by the spherical harmonic @xmath14 , @xmath15 are the actions with their corresponding angles @xmath16 , and @xmath17 is an integer vector describing each term in the fourier series",
    ". we will use subscripts 0 and 1 to denote terms that are zero- and first - order in the perturbation amplitude .",
    "the perturbed hamiltonian includes both the imposed gravitational potential of the bar and the gravitational potential resulting from the response of the halo .",
    "these actions follow naturally from hamilton - jacobi theory ; @xmath18 , can be immediately identified with the radial action @xmath19 , @xmath20 with the angular momentum in the orbital plane @xmath21 and @xmath22 with the projection of the angular momentum along the @xmath23 axis @xmath24 ( e.g. * ? ? ?",
    "* ) . from hamilton s equations ,",
    "we can obtain the frequency of the angles : @xmath25 .",
    "the subscripted @xmath26 denotes a coefficient in the action - angle series .",
    "the natural decomposition of phase space into resonant variables follows from an action - angle transform of the collisionless boltzmann equation ( cbe ) in phase space and a laplace transform in time ( e.g. * ? ? ?",
    "to solve for the response , we begin with the linearised cbe : @xmath27 the quantities @xmath28 and @xmath29 are the unperturbed phase space distribution function and the unperturbed hamiltonian and @xmath30 and @xmath31 are the first - order terms .",
    "the fourier - laplace transform of the cbe is @xmath32 where @xmath33 is the laplace transform variable , the tilde indicates a laplace transformed quantity , the subscript @xmath17 indicates an action - angle transformed variable and @xmath34 .",
    "remember that the total perturbing potential @xmath31 is the response combined with the external perturbation .",
    "the solution is the inverse laplace transform of the series : @xmath35 where @xmath36 are the three angle variables and @xmath37 are the three action variables .",
    "each term in the solution described by equation ( [ eq : dfser ] ) is oscillatory , proportional to @xmath38 . for a fixed perturbing frequency @xmath4 ,",
    "the inverse laplace transform couples each term to the perturbing frequency and yields oscillations of the form @xmath39 $ ] .",
    "for example , assuming an @xmath40 quadrupole perturbation as we do for a bar , the integers @xmath41 take the following values : @xmath42 , @xmath43 and @xmath44 .",
    "orbits with @xmath45 define the closed _ resonant _ orbits in the frame of reference rotating with the bar . for the parts of phase space very near a resonance described by a particular @xmath46 , the argument of the exponential will change very slowly for one term and rapidly vary for most of the other terms .",
    "the separation of these characteristic motions is easily performed by making a canonical transformation to two new degrees of freedom where one of the new coordinates corresponds to the angle of the commensurability @xmath47 and @xmath48 is the position angle of the perturbation .",
    "this can be done with the canonical transformation generating function ( e.g. goldstein type 2 , op .",
    "cit . ) : @xmath49 i_s$ ] .",
    "the new actions and angles are therefore : @xmath50 with @xmath51 and with @xmath52 and @xmath22 as before .",
    "the angle @xmath53 is often called the `` slow '' angle because its conjugate frequency vanishes at the resonance . there is some arbitrariness in the choice of the `` fast '' angle , @xmath54 .",
    "for example , the choice @xmath55 yields the conjugate actions @xmath56 and @xmath57 . this choice might be useful when @xmath58 . in both cases ,",
    "the angle @xmath53 varies very slowly and @xmath54 varies rapidly relative to @xmath53 near the resonance defined by the vector of integers @xmath59 .",
    "we can take advantage of this situation by averaging over some time interval @xmath8 long enough so that all the terms but the resonant one vanish owing to the rapid oscillation in @xmath54 but that is small enough so that the argument of the exponent is nearly unchanged . in this way",
    ", we reduce the problem to a collection of one - dimensional pendulum equations in @xmath53 , one for each resonance ( e.g. the _ averaging theorem _ , * ? ? ?",
    "the averaged hamiltonian in these new coordinates takes the form @xmath60 where @xmath61 is the slow action at resonance and @xmath29 is the averaged unperturbed hamiltonian with constant @xmath4 , up to some arbitrary constant .",
    "equation ( [ eq : hamprt ] ) is a pendulum equation with arm length @xmath62 and acceleration @xmath26 .",
    "the relative signs for the terms in equation ( [ eq : hamprt ] ) can be arranged by changing the phase of @xmath53 as necessary ; real positive values are assumed in the square roots of the expressions that follow .",
    "the area defined by the infinite - period trajectory is naturally identified as the _ width _ of the particular resonance ; this width is proportional to the square root of the fourier coefficient @xmath63 from equation ( [ eq : v1exp ] ) ( see also eq .",
    "[ eq : reswid ] ) .",
    "a single resonance potential can cover a significant volume in physical space .",
    "individual resonances can overlap in phase space and will lead to chaos and diffusion in the usual way @xcite .",
    "however , in galaxy dynamics on large scales , a few low - order resonances often dominate the response in both physical and phase space .",
    "hamilton s equations in these new variables with the hamiltonian from equation ( [ eq : hamprt ] ) explicitly represents the dynamics near resonance .",
    "these equations may include an arbitrary time dependence in the perturbation consistent with the averaging .",
    "however , these equations only describe a single orbit .",
    "a full description of the secular evolution of a galaxy requires the sum of responses over the entire phase space and motivates beginning with equation ( [ eq : lcbe ] ) .",
    "however , remember that there are astronomical regimes where an orbit may linger close to the resonance making weak nonlinearities important and in these cases we must resort to direct solution over an ensemble of orbits , as we describe below .",
    "the inverse fourier - laplace transform of equation ( [ eq : lcbe ] ) is straightforward albeit cumbersome and does not require the equivalent one - dimensional problem explicitly . having solved for the self - consistent phase - space distribution function for the response , we may then go back to the first order solution of the collisionless boltzmann equation for the distribution function and integrate over velocities to get the shape of the gravitational potential corresponding to a particular resonance , derive the overall torque , or compute any other phase - space moment of interest . for a given orbit with actions @xmath11 , the position @xmath64 determines the angle @xmath36 .",
    "the integral of @xmath65 over velocity then requires an implicit solution of the equations defining the angles from positions and momenta .",
    "this full , final solution is self - consistent in the limit that the force from the perturbation and the response are small compared to the background restoring force .",
    "the result is a second - order perturbation theory calculation . here ,",
    "for simplicity , we will eliminate the self consistency by assuming that @xmath31 includes only the external perturbation rather than both the external perturbation and the halo response , which is of the same order of magnitude .",
    "as an example of this whole procedure , we sketch the calculation of the response of a homogeneous core to a bar or satellite rotating with frequency @xmath4 outside the core .",
    "we focus on the ilr , @xmath66 , although the basic features of the example apply to any @xmath59 . to solve equation ( [ eq : lcbe ] ) ,",
    "we need an expression for @xmath26 .",
    "we begin by relating the angle variables to physical quantities . based on coordinate transformations and geometry , the angle @xmath67 describes the radial oscillation of the trajectory",
    ", @xmath68 describes the azimuthal oscillation of the trajectory , and @xmath52 determines the orientation of the orbital plane , which is invariant for a spherical potential .",
    "on can express @xmath52 in terms of the colatitude @xmath69 of the trajectory and the elevation of the orbital plane @xmath70 ( tw ) .",
    "in addition , we find that @xmath71 and @xmath72 with @xmath73 .",
    "the first contributing multipole to the ilr is the quadrupole @xmath74 .",
    "furthermore , we can write the perturbing potential as an inner quadrupole @xmath75 , where @xmath76 is a constant , because we are considering the perturber to be outside the phase - space region of interest and , since by symmetry @xmath77 , it is sufficient to consider @xmath78 only . with all of these identifications , it is then straightforward to compute the necessary fourier coefficient : @xmath79 the only explicit time dependence is a pure sinusoidal oscillation so the laplace transform yields : @xmath80 the integrals defining @xmath81 can be performed analytically because the motion in a homogeneous core is purely harmonic with constant frequencies throughout the core , but its exact functional form is not important here .",
    "we now substitute equation ( [ eq : htrans ] ) into equation ( [ eq : lcbe ] ) @xmath82 and perform the inverse laplace transform as follows : @xmath83\\over ( \\ldo - m\\omega_p)/2 } .\\end{aligned}\\ ] ] this equation has several interesting features .",
    "first , the term @xmath84\\over ( \\ldo - m\\omega_p)/2 } \\ ] ] oscillates rapidly and in the limit @xmath85 , @xmath4 approaches @xmath86 .",
    "this implies that after a long time , one will only see a contribution for a commensurability @xmath87 .",
    "if the satellite or bar was within or nearly within the homogeneous core , @xmath88 and no ilr can possibly exist for small values of @xmath89 .",
    "a small decrease in @xmath4 can remove most of the low - order resonances , and outside of the core , one has @xmath90 and , therefore , no low - order resonances exist .",
    "second , in a truly homogeneous core , @xmath91 is constant so that @xmath92 and therefore @xmath93 independent of the resonance @xmath59 .",
    "these features imply that a bar deep inside of a halo core will have a dramatically reduced torque .",
    "we may derive an expression for the change in angular momentum similarly .",
    "we begin by deriving the change in angular momentum for a single orbit .",
    "the liouville theorem gives us the rate of change in angular momentum for each orbit as : @xmath94\\ ] ] where @xmath95 $ ] are poisson brackets ( e.g. * ? ? ?",
    "because @xmath96 is a conserved quantity in the absence of any perturbation , this equation becomes @xmath97 where @xmath98 , @xmath11 are action - angle variables and @xmath31 is the first - order , perturbed hamiltonian .",
    "now expanding @xmath31 as an action - angle expansion @xmath99 we can describe the evolution of a particular orbit s z angular momentum component : @xmath100 we may now integrate over some time interval @xmath8 , defined to be long compared to an orbital time for our orbit with action @xmath11 but short compared to the overall evolutionary time scale .",
    "the angles now are explicit functions of time : @xmath101 , where @xmath102 and @xmath103 is the angle vector at @xmath104 .",
    "the solution for @xmath105 is particularly simple for the sinusoidal time dependence in a simple rotating pattern ( e.g. eq . [ eq : fourier ] )",
    ". integrating equation ( [ eq : dldt ] ) , one finds @xmath106\\right|^t_0    \\nonumber \\\\    & = &    -\\sum_\\bl il_3 h_{1\\,\\bl}(\\bi,0 )   e^{i(\\ldw_0 ) }       \\left\\{e^{i(\\ores)t/2 } { \\sin(\\ores)t/2\\over(\\ores)/2 } \\right\\ } , \\label{eq : deltalz0}\\end{aligned}\\ ] ] where we denote @xmath107 .",
    "equation ( [ eq : deltalz0 ] ) describes the change in angular momentum @xmath96 for a single orbit . to determine the change in angular momentum for a particular portion of phase space , needed to perform a statistical comparison to a n - body simulation",
    ", we must average equation ( [ eq : deltalz0 ] ) over an orbit ensemble . to do this",
    ", we multiply equation ( [ eq : deltalz0 ] ) by the phase - space distribution function @xmath108 , where @xmath109 , and average over the initial phase , @xmath110 .",
    "there are several subtleties in evaluating the average of equation ( [ eq : deltalz0 ] ) .",
    "first , note that the bracketed term on the right - hand side is steeply peaked about @xmath111 in the limit @xmath112 ; this , of course , owes to the resonance defined by @xmath111 .",
    "second , an average over angles is non - vanishing only for the term @xmath30 ( @xmath113 ) when @xmath114 .",
    "this implies that the net torque is second order in @xmath115 and this procedure yields a generalised form of the lbk formula @xcite .",
    "however , by performing the average over @xmath98 , we are implicitly assuming a time interval such that all phases are uniformly represented and this ignores an important feature of the resonance under some circumstances .",
    "recall that near the resonance , we can replace the multidimensional problem with a one - dimensional one in the resonant angle @xmath53 .",
    "although @xmath67 and @xmath68 remain distributed in phase , the distribution of @xmath53 is correlated by the dynamics of the resonance . to evaluate this average including the correlation",
    ", we can replace the integral over phase with an integral over time , @xmath116 and evaluate the integral using pendulum dynamics .",
    "far from the resonance , @xmath117 will be linear with time . as the orbit approaches the resonance defined by the infinite - period trajectory",
    ", the phases will linger near the top pivot point of the pendulum , i.e. an upside down pendulum , and the run of @xmath117 will look like stairs with horizontals at @xmath118 and @xmath119 ( @xmath120 and @xmath121 ) if the coefficient of the pendulum potential is negative ( positive ) . near the infinite - period trajectory , @xmath122 , @xmath123 with @xmath124 . because the phase will accumulate near the top pivot point in the one - dimensional potential",
    ", @xmath125 will take on the value @xmath126 or @xmath127 , again depending on the sign of the resonance potential . putting this together",
    "the phase integral takes the value @xmath128 near the resonance .",
    "this bunching and break down of the phase averaging is a consequence of broken adiabatic invariance at the resonance . in the limit of long time intervals , the contributing orbits will be closer and closer to the infinite - period trajectory and , therefore , more and more closely bunched in phase about the top pivot point .",
    "our detailed investigation shows that resonances in astronomically realistic systems can be bunched and require a more subtle treatment than that described here .",
    "in particular , one must consider the simultaneous variation of @xmath129 with @xmath53 and this correlates @xmath115 with @xmath53 . in this case ,",
    "@xmath130 scales as @xmath131 rather than @xmath132 .",
    "tw call the division between these regimes the _ slow _ and _ fast _ limits and we describe them in the next section . rather than",
    "perform very complicated slow - limit phase averages and time ordering , we will solve the equations of motion by direct numerical integration for an ensemble of orbits .",
    "the rate of secular evolution determines whether or not an orbit _ lingers _ near the resonance for many periods or quickly moves through the resonance .",
    "the rate of pattern speed evolution characterises the secular change .",
    "the natural width in frequency space is the change in the commensurate frequency across the resonant width .",
    "the ratio of the rate of pattern speed evolution to the square of the natural width in frequency is a dimensionless ratio that tw call the _ speed _ ( @xmath33 ) . in their perturbation calculation ,",
    "values of @xmath133 give rise to changes in the action that scale as the square root of the perturbation strength and @xmath134 give changes that scale as the square of the perturbation strength .",
    "tw call these the _ slow _ and _ fast _ limits . for a perturbed system",
    "whose only time - dependence is its pattern speed , tw defined the quantity _ speed _ , @xmath135 where @xmath134 is _ fast _ and @xmath133 is _",
    "slow_.    for our purposes , these two regimes complicate the perturbation theory but do not result in a dramatic qualitative change in the evolution of a particular orbit .",
    "however , the standard perturbation theory ( e.g. lbk ) assumes the fast limit .",
    "a set of exploratory simulations that explicitly tracked @xmath33 for individual orbits show that the dominant resonances have contributions from the slow limit unless the bar slows down within a rotation period .",
    "the ilr is _ dominated _ by slow - limit encounters . in practise",
    ", we find that @xmath33 is @xmath136 for most low - order resonances .",
    "solving the linearised cbe for arbitrary time dependence in the perturbation and for arbitrary values of the speed @xmath33 is difficult if not intractable .",
    "the added complication of time dependence and contributions from both the slow and fast limits motivates us to abandon explicitly solving the cbe by analytic phase averaging in favour of direct integration of the perturbed hamiltonian .",
    "averages of phase - space ensembles are then performed by monte - carlo integration .",
    "although more cpu intensive , this direct approach to perturbation theory simplifies the complexity of tracking multiple time scales , requires no differentiation between the fast and slow limits , and better facilitates a comparison to n - body simulations . in principle",
    ", one can include the self gravity of the response using this method although we do not do so here .",
    "we can look at the topology and effect of diffusion on the resonant islands by converting the perturbed hamiltonian near a resonance to a twist mapping applying the now standard procedure ( e.g. * ? ? ?",
    "begin with the one - dimensional averaged equations , @xmath137 where @xmath29 and @xmath138 are the zeroth - order and perturbed parts of the hamiltonian , respectively . by choosing the phase , with no loss in generality , we may keep only the real part to get @xmath139 the surface of section implied by the averaging principle are the successive returns to the @xmath140 plane separated by time intervals @xmath141 , where @xmath142 is the fast frequency .",
    "> from hamilton s equations , the change in action between two successive periods @xmath143 denoted by subscripts @xmath144 and @xmath145 is @xmath146    \\nonumber \\\\",
    "\\label{eq : twisteqm}\\end{aligned}\\ ] ] where the second equality assumes a simple oscillatory time dependence for the perturbation . to derive a symplectic mapping",
    ", we choose a canonical generating function of the form @xmath147 the canonical transformation is then : @xmath148 where @xmath149 . comparing equations (",
    "[ eq : twisteqm ] ) and ( [ eq : twistsym ] ) we can deduce that @xmath150 +    h(i_{s , n+1 } ) .",
    "\\label{eq : genfct2}\\ ] ] the integration constant @xmath151 yields a phase shift that can be absorbed into @xmath152 .    the mapping defined by equations ( [ eq : twistsym ] ) and ( [ eq : genfct2 ] ) is well - defined and straightforwardly applied but , for computational speed , the phase - space quantities must be tabled and evaluated using interpolation methods .",
    "truncation error can then lead to an imperfect symplectic mapping , but this situation can be improved as follows",
    ". on rearranging terms , equation ( [ eq : twistsym ] ) has the form @xmath153 which implies that @xmath154 must hold .",
    "the function @xmath155 has only a sinusoidal dependence on @xmath156 and this implies that the integral in the previous equation can be performed exactly : @xmath157 deriving the mapping in this way , rather than explicitly from equations ( [ eq : genfct ] ) and ( [ eq : genfct2 ] ) , guarantees the symplectic condition .",
    "investigation of the orbit topology for the astronomically - motivated bar perturbation used here shows that most resonances have the standard pendulum topology with one important exception : the relative amplitude of the ilr is sufficiently large that orbit families bifurcate as has been described extensively elsewhere ( e.g. * ? ? ? * for a review ) .",
    "this does not present an in - principle problem but , for simplicity , we restrict ourselves to moderate to weak strength bars for comparison between perturbation theory and simulations to remove the complications caused by orbit bifurcation .",
    "the action - angle or cartesian phase - space coordinates can be obtained at any iteration @xmath144 ( eq . [ eq : twist ] ) in the twist mapping by another canonical transformation .",
    "we apply two - body interactions in the diffusive limit by tabulating the standard orbit averaged diffusion coefficients @xcite . at each step , we transform from slow and fast actions and angles to cartesian coordinates , apply the change in parallel and perpendicular velocities obtained from a monte carlo realization , and then transform back to slow and fast variables .",
    "as previously described , the first step in canonical perturbation theory is to expand the phase - space quantities in a fourier series of actions and angles : @xmath158}\\ ] ] where we have assumed that the time dependence is periodic with phase angle @xmath159 as previously defined and @xmath160 if @xmath161 is a perturbation and we consider hamilton s equations , we may transform to new action and angle variables where one angle takes the form @xmath162 as long as @xmath163 is sufficiently large , the reaction of a orbit to the perturbation will be oscillatory",
    ". however , in the limit that @xmath164 the period of the oscillations will be very long and in the limit @xmath165 the perturbation may cause a permanent shift in the actions , i.e. a _",
    "resonance_. near a resonance , the three - degree - of - freedom equations of motion can be transformed to a one - degree - of - freedom problem as described in ",
    "[ sec : canonical ] .",
    "the one - dimensional equations of motion take the following form : @xmath166 where @xmath167 is the transform of the perturbation that follows from the application of equation ( [ eq : angletrans ] )    the validity of the averaging theorem is the only practical limitation in this approximation .",
    "it may break down for large amplitude perturbations if resonances overlap ( e.g. * ? ? ? * ) or if the system loses or changes equilibrium .",
    "the approximation has two important advantages .",
    "first , it separates the resonant variable from the others and , thereby , allows the dynamics of the resonance to be isolated from the remaining system , allowing us to check the one - dimensional problem against the full integration of the equations of motion ( examples below ) .",
    "second , because we have averaged over the rapid oscillations , the one - dimensional problem can be solved numerically with a larger time step .    however , unlike the n - body problem , forces in the one - dimensional mapping depend on the velocity , i.e. @xmath168 , and , therefore , we can not use an explicit symplectic integrator such as leap frog .",
    "rather , we use the semi - implicit symplectic rk2 method : @xmath169 we apply this to equation ( [ eq : onedeqm ] ) and iterate until it converges using the algorithm : @xmath170 where @xmath171 until @xmath172 and @xmath173 . in practice , this iteration converges for @xmath174 when @xmath175      we want to compare orbit integrations using the time averaged one - dimensional equations with those integrated directly using the three - dimensional equations of motion in the bar quadrupole gravitational potential . for the one - dimensional case",
    ", we can perform a canonical transformation to commensurate and non - commensurate action - angle variables and average over the non - commensurate angles , just as in the perturbation theory . for a spherical system , this leaves a reduced , two - degree of freedom problem : one corresponds to the commensurate degree of freedom and one corresponds to the node or _ angle of ascension _ of the orbital plane .",
    "the conjugate action to this angle is the @xmath23 component of the angular momentum .",
    "the four first - order ordinary differential equations , hamilton s equations , can then be integrated as an initial value problem independent of slow or fast limit considerations .",
    "for the three - dimensional case , we simply integrate the orbit using the combined halo and quadrupole bar potential using the quadrupole component of the bar perturbation as described in  [ sec : barpert ] .",
    "we assume an nfw dark matter halo and the bar length is the nfw halo scale length @xmath176 .",
    "we impose a time - dependent pattern speed from an n - body simulation with a slowing bar that has a mass that is 1% of the enclosed dark - matter halo mass within the bar radius , which has a 2% force perturbation at maximum .",
    "we choose such a weak perturbation to make sure that the perturbation remains only weakly nonlinear in the slow limit , where the strength scales as @xmath131 .",
    "we use a standard leap frog algorithm for the direct solution of hamilton s equations in cartesian coordinates and use the implicit symplectic algorithm to evolve the averaged equations ( described in ",
    "[ sec : numavg ] ) .",
    "because in the averaged equations the fast oscillatory motion has been removed near the resonance , the time step can be 100 times larger than for the ordinary cartesian evolution . at each time step , the cartesian phase space is transformed to the new variables for comparison in the figures .",
    "figures [ fig : comporb10 ] and [ fig : comporbilr ] compares resonant and non - resonant orbits for the @xmath177 and the @xmath178 ( ilr ) resonances integrated using the time averaged one - dimensional perturbation theory and by directly integrating the full three - dimensional equations of motion .",
    "the @xmath177 resonant orbit returns to apocenter twice during each bar period . to simplify the discussion",
    ", we will call this the _ direct radial resonance _ ( drr ) . an equilibrium phase - space distribution in a spherical halo",
    "may be described by two conserved quantities . for convenience we will use the energy @xmath179 and",
    "the angular momentum scaled to the maximum for a given energy @xmath180 $ ] .    for drr ( fig .",
    "[ fig : comporb10 ] ) , the _ fast _ variable is @xmath68 and , therefore , @xmath20 is conserved through the resonance as seen for the one - dimensional averaged orbit .",
    "the full three - dimensional problem exhibits an oscillation in @xmath20 but there is no net change .",
    "outside of resonance , slower modulations by the resonance are seen in both the three - dimensional and one - dimensional solutions for @xmath18 .",
    "the rapid oscillation from the fast degree of freedom is superimposed on this slower motion in the three - dimensional solution .",
    "finally , the net change @xmath181 is zero for the non - resonant orbit and non - zero for the resonant orbit .",
    "the overall behaviour for the ilr ( fig .",
    "[ fig : comporbilr ] ) resonance is similar although both @xmath18 and @xmath20 now both change owing to resonance passage .",
    "note that both the ilr and ddr transitions are not fully in the slow or fast regime .",
    "remember that convenient analytic approximations only exist for @xmath133 ( slow ) or @xmath134 ( fast ) and encounters with @xmath182 , like these , can not be solved accurately by analytic perturbation theory but require a numerical solution of the one - dimensional equations of motion .      in this section ,",
    "we compare the net changes in the halo phase space caused by the rotating bar using both perturbation theory and the full equations of motion .",
    "the latter is performed using an n - body code with a fixed halo potential .",
    "we begin with a monte - carlo generated phase space for the equilibrium distribution in cartesian space : @xmath183 and for each particle we perform the same orbit calculations described in  [ sec : ode ] .",
    "the bar mass and length and dark matter halo are as described in the previous section .",
    "however , now the evolution of the bar pattern speed is determined by conservation of the total angular momentum in the three - dimensional calculation . the pattern speed for",
    "this weak bar slows by 3% during the evolution .",
    "the bar amplitude is slowly turned on and then turned off to avoid transients .",
    "transients will not affect the total torque significantly but may produce difficult to interpret phase - space features .",
    "the evolution of the bar pattern speed with time is used as an input to the one - dimensional experiment .    in figure",
    "[ fig : comp1d3d ] , we show the ensemble change in the @xmath23 component of the angular momentum @xmath113 during the bar evolution .",
    "these figures are made by first computing @xmath113 for each orbit as a function of its initial values of @xmath179 and @xmath184 .",
    "we then use kernel density estimation with cross validation @xcite to estimate the smoothing kernel .",
    "we increase and decrease this estimate to ensure that the resulting density field is not over smoothed . using this procedure , figure [ fig : comp1d3d ]",
    "compares the change in the @xmath23 component of the angular momentum after evolving the phase space with the one - dimensional and three - dimensional equations of motion . in the one dimensional case ,",
    "each resonance must be computed separately and we use the following five resonances ( listed in order of their appearance in figure [ fig : comp1d3d ] ) : @xmath185 ( ilr ) , @xmath186 , @xmath187 ( drr ) , @xmath188 ( corotation ) and @xmath189 ( outer lindblad ) .",
    "figure [ fig : comp1d3d]a is the sum of the five separate one - dimensional phase space calculations .    the low - order resonances with energies larger than -5 agree within 20% for the two cases",
    ". however , the ilr ( @xmath190 ) appears at a somewhat different location and magnitude in the two panels of figure [ fig : comp1d3d ] .",
    "because the rate of pattern speed change is so slow for such a weak bar , the orbits linger near the ilr and become nonlinear .",
    "a similar experiment with the same parameters but a with a 10 times more massive bar has the opposite problem : the pattern speed decreases by 50% so the orbits are less likely to linger but the overall amplitude is sufficiently high that the interaction itself is nonlinear . as in figure [ fig : comp1d3d ] , the resonances at @xmath191 agree but the one - dimensional integration predicts more torque at ilr than the three - dimensional integration .",
    "we also tried using the 1% bar but artificially forcing the bar pattern speed to decrease at the rate of the 10% bar , which resulted in good agreement between the two calculations at ilr .",
    "because hamiltonian perturbation theory is impractical for complicated astronomical problems and inappropriate for large perturbations such as major mergers , in the end one must `` throw caution to the wind '' and resort to exploring the dynamics using n - body simulations . using the development from  [ sec : hamilton ] , we can derive the requirements necessary to correctly simulate resonance dynamics .",
    "there are three requirements on the particle number .",
    "first , we require a sufficient number of particles near the resonance to produce the first - order cancellation demanded by the second - order perturbation mechanism ( criterion 1 ) .",
    "if you like , an n - body simulation does the phase averaging by monte - carlo integration and this criterion ensures convergence of this integral .",
    "second , there must be enough particles so that the time for an orbit to artificially diffuse across the resonance is long compared to the characteristic time scale of a closed orbit in the resonance potential .",
    "we separately consider two regimes .",
    "artificial non - astronomical diffusion is caused by small scale graininess in the potential owing to the gravitational force from individual particles ( criterion 2 ) .",
    "similarly , artificial diffusion can be caused by potential fluctuations from poisson noise at large spatial scales ( criterion 3 ) .",
    "in addition , criterion 3 can describe true astronomical noise .",
    "numerical integration errors can also give rise to a similar diffusion , and hence the integration must be performed accurately .",
    "there is a final criterion that does not depend explicitly on particle number : the potential solver must be able to resolve scales smaller than the resonance potential ( criterion 0 ) and , of course , the realized phase - space distribution must cover this region .",
    "clearly , this criterion must be satisfied by construction given the resonance potential from equation ( [ eq : v1exp ] ) for the set of desired resonances described by @xmath59 and @xmath4 .",
    "we investigate each of these issues using the perturbation theory developed in ",
    "[ sec : solve ] to estimate the particle number criteria in  [ sec : criteria ] , derive scaling formula in  [ sec : calib ] and then calibrate these against n - body simulations in  [ sec : results ] .",
    "the change in the actions @xmath18 and @xmath20 as a function of bar phase @xmath192 for an ensemble of orbits starting with fixed actions ( e.g. energy , angular momentum , and plane inclination ) is shown in figure [ fig : vphase ] for drr and ilr . @xmath179 and",
    "@xmath184 show a non - sinusoid variation with initial bar phase @xmath192 for orbits that pass through resonance .",
    "orbits gain or lose angular momentum and energy depending on the bar phase at resonance .",
    "if one averages over all the phases there is a net change , as expected .",
    "there is also a small purely sinusoidal modulation in these quantities for the non - resonant orbits owing to the rotating bar perturbation , which is only barely perceptible in these figures .",
    "this example further illustrates the brief statement in  [ sec : simdesc ] that a simulation must have sufficient particles to cover all the phases shown in figure [ fig : vphase ] or one will not get the correct ensemble average .",
    "the two resonances are excited by the same bar perturbation but the relative amplitude is much larger for ilr than for drr giving ilr a peakier profile .",
    "the peaky profile requires fewer particles to converge to the mean than the only slightly asymmetric drr . however",
    ", the required particle number may still need to be high to cover ilr adequately owing to the small total mass at low energies . clearly , the coverage criterion depends on the perturbation amplitude of each resonance separately .",
    "in addition , the orbits in figure [ fig : vphase ] have identical initial inclinations near the peak of the contribution for a given energy @xmath179 and total angular momentum @xmath21 .",
    "the full ensemble in an n - body simulation will sample all inclinations and further dilute the net signal from the resonance .",
    "one can see the full phase space ensemble result about the initial orbit in figure [ fig : distlz ] where we plot @xmath113 as a function of initial phase space coordinate ( @xmath179,@xmath184 ) as in figure [ fig : comp1d3d ] .",
    "the particle number was increased for both resonances until the amplitude and location of the resonance features in the @xmath179@xmath184 plane remained unchanged .",
    "if we decrease the number of particles below this value , the sampling is insufficient in the vicinity of the resonance to recover the full amplitude of the resonance .",
    "more than @xmath193 ( @xmath194 ) equal mass particles within the virial radius are needed for the drr ( ilr ) resonance .",
    "note that we have chosen a very large bar length to reduce the required number of particles .",
    "we will see in  [ sec : results ] that ilr for a typical strength scale - length sized bar requires @xmath195 particles !",
    "we investigate the effects of two - body perturbations on an orbit near resonance by combining the twist mapping , the solutions to the one - dimensional , and the three - dimensional equations of motion with a monte - carlo simulation of the fokker - planck equation .",
    "the diffusion coefficients are derived from the isotropic phase - space distribution for a spherical equilibrium using the standard prescription ( e.g. * ? ? ?",
    "* ; * ? ? ?",
    "* ) : @xmath196 where @xmath197 is the time step , @xmath198 and @xmath199 are unit - variance zero - mean normally distributed random variates and @xmath200 is a random variate uniformly distributed in the unit interval .",
    "we adopt a constant value of @xmath201 with @xmath202 . this conservative value is smaller than that of state - of - the - art @xmath203cdm simulations and corresponds to a gravitational softening length of about 0.3% of the virial radius .",
    "the reader may scale the values of the particle mass @xmath13 for any value of @xmath201 by keeping the product @xmath204 fixed .",
    "the algorithm for applying equation ( [ eq : diffmc ] ) is as follows : ( 1 ) at the end of every twist - mapping iteration or every time step for the symplectic integration of the one - dimensional average equations , we transform the action - angle variables to cartesian coordinates ; ( 2 ) equation ( [ eq : diffmc ] ) is applied to the velocities ; and ( 3 ) the cartesian coordinates are transformed back to actions and angles .",
    "figure [ fig : twist]a shows the surface of section of the same orbit near ilr described in the previous figures in the one - dimension slow variables @xmath129@xmath53 plane with no small scale diffusion .",
    "the bar pattern speed is constant .",
    "we label the orbits by @xmath205 where @xmath61 is the value of the action at resonance for a zero amplitude bar .",
    "since the amplitude here is not zero , the homoclinic trajectory is offset slightly from @xmath206 . in figure",
    "[ fig : twist]a one can also see how the twist mapping demarcates the expected pendulum topology .",
    "figure [ fig : twist]b begins with the orbit @xmath207 but adds two - body diffusion corresponding to particle masses of @xmath208 , @xmath209 , and @xmath210 in units where the total halo mass is unity . for @xmath211",
    ", diffusion becomes very important and the orbit diffuses to larger @xmath129 and even crosses the homoclinic trajectory . for @xmath212 ,",
    "the diffusion is so large that the orbit diffuses into the libration zone .",
    "similarly , we may solve the one - dimensional equations of motion including the two - body diffusion for the same test orbits shown in figures [ fig : comporb10 ] and [ fig : comporbilr ] ; these are shown in figures [ fig : tbodyorb10 ] and [ fig : tbodyorbilr ] , respectively , for particle masses of @xmath213 , @xmath208 , and @xmath209 .",
    "the two - body fluctuations are only included in the one - dimensional solution , the three - dimensional solution is left unchanged for comparison . only at @xmath211 does the two - body perturbed solution begin to follow the unperturbed solution .",
    "this is consistent with our twist mapping results . in short ,",
    "_ values of @xmath13 equal to or smaller than those of typical n - body simulations destroy resonances .",
    "_    figure [ fig : tbodyorbtot ] shows the results of an integration using the three - dimensional equations of motion for an ensemble @xmath214 particles in the quadrupole bar perturbation both without and with two - body diffusion equivalent to @xmath193 particles .",
    "this isolates the effects of diffusion from those of coverage . with two - body diffusion",
    ", the inner ilr is significantly reduced .",
    "however , the outer low - order resonances , @xmath177 in particular , still appear at their predicted strength and location",
    ". how can we understand this in the context of the large changes in orbital structure near resonances we saw in the twist mapping and one - dimensional solutions ?",
    "even though the random walk in actions seen in figures [ fig : twist ] , [ fig : tbodyorb10 ] and [ fig : tbodyorbilr ] may be larger than the width of the resonance , the pattern speed of the rotating potential will continue to evolve and sweep past the ` walking ' orbit at some nearby action whenever @xmath215 . at this point",
    ", the adiabatic invariant corresponding to the slow motion will break and the orbit will feel a coherent ` kick ' . however , orbit can not linger near the homoclinic trajectory owing to the random walk and will , therefore , always be in the _",
    "fast limit_. in other words , the two - body noise diffusion of n - body particle - particle simulations , which is much larger than that in true dark matter haloes , is sufficient to cause _ slow limit _",
    "transitions to become _ fast limit _ transitions .",
    "note that the speed parameter is fast ( @xmath216 ) for the @xmath177 resonance ( ddr ) ( fig .",
    "[ fig : comporb10 ] ) but slow ( @xmath217 ) for the ilr ( fig .",
    "[ fig : comporbilr ] ) . the clear difference in magnitude between the ilr in the slow limit ( fig .",
    "[ fig : tbodyorbtot]a ) and when it is forced into the fast limit by noise ( fig .",
    "[ fig : tbodyorbtot]b ) is a consequence of the smaller changes in angular momentum for a fast - limit encounter .",
    "the corotation resonance ( @xmath218 ) appears at @xmath219 , immediately to the right of the @xmath177 resonance and at lower amplitude .",
    "this resonance has @xmath182 and its amplitude is also diminished by the diffusive effects of two - body encounters .",
    "only the amplitude of the drr is preserved .      the calculations in the previous section emphasise the fluctuations in the gravitational field dominated by two - body encounters on relatively small scales .",
    "formally , large scale contributions were also included .",
    "the contribution to the fluctuations on large scales in the homogeneous approximation leads to a divergence at the upper end of the coulombic logarithm @xmath201 .",
    "physically , this divergence is removed by the inhomogeneity of a gravitationally bound galaxy and a realistic estimate must be computed differently . in this section ,",
    "we explicitly address the role of fluctuations owing to noise at large scales , both in simulations and astronomically owing to dark - matter substructure .    to appreciate the physical situation , consider the forcing of an inner - halo orbit by a disturbance ( such as orbiting dark - matter subhaloes ) in the outer galaxy .",
    "there are two requirements for a distant disturbance to cause an effect on the inner orbit : 1 ) the force must vary over the region sampled by the orbit , otherwise there can be no work done relative to the background potential ; and 2 ) the time scale of the disturbance must be smaller than one of the orbit s natural periods , otherwise the motion will be adiabatically invariant .",
    "these sorts of considerations are very similar to those important for the bar  halo interaction discussed in  [ sec : bardyn ] and can be approached similarly .",
    "@xcite derives a formalism for treating the evolution of orbits including statistical fluctuations caused by perturbers of various sorts .",
    "assuming that the perturbations are a first - order markovian process , i.e. they do not retain any memory of their prior state , the evolution equation naturally takes the fokker - planck form @xcite . in particular , @xcite works out analytic expressions for the diffusion coefficients and we will use them here .",
    "the calculation explicitly includes the spatial and temporal correlations of any physical perturbation . the expression for the coefficients",
    "have two parts : 1 ) a second - order _ reinforcement _ by the perturbation on the induced distortion on the orbit , typical of any second - order perturbation theory as described in  [ sec : hamilton ] ; and 2 ) a correlation coefficient that describes the spatial and temporal correlation of the perturbation .",
    "if we denote the change in component @xmath220 of the action at time @xmath221 after evolving by a period @xmath222 as @xmath223 , then action - space diffusion coefficients from @xcite are : @xmath224 the spatial component of the response is expanded in a orthogonal series , the @xmath225 rotate the spherical harmonics , and the terms @xmath226 describe the coefficients of the action - angle expansion for the @xmath227 basis function .",
    "the operator @xmath228 describes the self - gravitating response owing to an applied frequency @xmath229 in the space spanned by the basis .",
    "the sums on @xmath230 and @xmath231 are the sums in the space of this operator . in this study",
    ", we will ignore self gravity and hence the @xmath232 become identity matrices . the limit @xmath233 must be taken in the sense that @xmath222 is small compared to the evolutionary time scale owing to the fluctuations but remains large compared to the dynamical time .",
    "the time dependence in the diffusion coefficients reminds us that the underlying equilibrium distribution @xmath234 changes on an evolutionary time scale but , for the purposes of the computation , is held fixed on a dynamical time scale .",
    "the lowest - order temporal variation has been explicitly removed by the limit @xmath233 .",
    "the integrals may be simplified by noting that @xmath235 .",
    "we can then do the integral in @xmath70 using the orthogonality of the rotation matrices as previously described . for a given equilibrium distribution function @xmath234 ,",
    "the term in curly brackets in equations ( [ eq : mom1expa ] ) and ( [ eq : mom2expa ] ) is the spatial and temporal correlation of the perturbation and need be computed only once since it is independent of the local value of the actions .",
    "we now use equations ( [ eq : mom1expa ] ) and ( [ eq : mom2expa ] ) to compute the fluctuations by random realisation .",
    "the procedure parallels that in  [ sec : diffu ] : one generates new values of @xmath11 from @xmath236 , @xmath237 and gaussian random variates .",
    "here we do not have the luxury of uncorrelated parallel and perpendicular motion as in the infinite homogeneous case but we must diagonalise @xmath237 ( e.g. by a jacobi rotation ) to generate uncorrelated random variates in @xmath11 .",
    "figure [ fig : fluctorb ] shows the evolution of an orbit near drr and ilr perturbed by large - scale fluctuations ( cf . figs .",
    "[ fig : comporb10 ] and [ fig : comporbilr ] ) .",
    "the particle number requirements are 1000 and 100 times smaller than that for two - body diffusion , respectively , for the two resonances . from the n - body simulation point of view , the two - body relaxation from the previous section sets a minimum particle number in a particle - particle code ( e.g. direct , tree , mesh , etc . ) and the large - scale fluctuations considered here",
    "sets a minimum particle number in an expansion code . by limiting the spatial scales",
    ", the expansion - based solver dramatically reduces the relaxation and potentially the particle requirements .",
    "we can use these results to estimate the importance of astronomical noise sources on bar  halo resonances . in principle , the fluctuations from any physical process can be computed as described in @xcite .",
    "the most common and perhaps relevant noise comes from orbiting substructure . ignoring orbital decay , the calculation is identical to that discussed in the previous section .",
    "@xmath203cdm simulations provide both a spatial density distribution and mass function for dark - matter substructure .",
    "@xcite show that these distributions can be modelled using a press - schechter approach @xcite extended to include tidal stripping and orbital decay .",
    "oguri & lee find that the satellite masses have the cumulative distribution @xmath238 for @xmath239 from @xmath240 to @xmath241 .",
    "the spatial distribution of substructure is shallower than the overall dark matter distribution with shallower profiles for larger values of @xmath13 .",
    "we will assume , for simplicity , that the maximum substructure mass , @xmath242 , is 0.3 and the smallest substructure mass , @xmath243 is @xmath240 .",
    "this implies that the mean mass ( in virial mass units ) is @xmath244 let the fraction of the dark matter in substructure with @xmath245 be @xmath246 .",
    "then , the diffusion coefficients from equations ( [ eq : mom1expa ] ) and ( [ eq : mom2expa ] ) for particle mass @xmath13 may be scaled to @xmath247 . assuming that the fraction of the mass in substructure @xmath248 @xcite and using equation ( [ eq : meff ] ) we have @xmath249 . to implement the effect of tidal stripping , we assume that the density distribution of substructure within the dark halo takes the same nfw form as the dark matter but with no substructure inside of @xmath250 ( units @xmath251 ) .",
    "this requires restricting the phase - space integral inside the curly brackets in both equations to orbits with @xmath252 .",
    "figure [ fig : fluctorbilr ] shows the now familiar ilr orbit perturbed by large scale fluctuations from orbiting substructure restricted to orbits with @xmath252 .",
    "now , @xmath253 must be larger than about @xmath254 to destroy the resonance , which is an order of magnitude larger than the actual substructure noise .",
    "all of the particle number criteria described in ",
    "[ sec : criteria ] have natural scalings in terms of physical quantities : properties of the equilibrium gravitational potential and the perturbation such as bar strength , bar shape , bar pattern speed , etc .",
    "we derive simple scaling relations in this section and calibrate them using the results of  [ sec : simdesc ] and additional simulations .      to calibrate the scaling estimates for the particle number requirements defined in ",
    "[ sec : criteria ] , we evolve phase - space ensembles as described in  [ sec : comp1d3d ] .",
    "we can use both the one - dimensional and three - dimensional equations of motion to study each of the three criteria from  [ sec : criteria ] .",
    "the coverage criterion demands that one samples phase space sufficiently densely in the vicinity of a resonance to ensure the correct ensemble average .",
    "the _ resonance potential _ is defined by the one - dimensional pendulum problem from equation ( [ eq : hamprt ] ) and is simply the fourier action coefficient corresponding to the commensurability @xmath59 .",
    "we define the half - width of the resonance potential as the maximum extent of the infinite - period trajectory in the one - dimensional phase space : @xmath255 this is called the _ resonance width _ in the celestial mechanics literature .",
    "hence , we can use perturbation theory to estimate a characteristic _ width _ or _ volume _ in phase space associated with each resonance . because it depends on both the fourier action - angle expansion coefficient and the change in slow frequency with slow action",
    ", this width depends on both the order of the resonance and the amplitude of the perturbation .    as the galaxy halo slowly evolves , the resonance defined by the commensurability @xmath87 sweeps through phase space as described in ",
    "[ sec : bardyn ] . a secular torque occurs only if there are enough particles so that the first - order sinusoidal oscillations cancel to leave the second - order changes .",
    "we , therefore , require sufficient particles , @xmath256 , in a fraction @xmath257 of the resonance width to obtain a mean cancellation of the first - order forced response .",
    "we use the resonance width to estimate the number of particles needed to resolve this phase space volume .",
    "the commensurability @xmath258 defines a track in the @xmath179 and @xmath21 ( or @xmath19 and @xmath259 ) phase - space plane .",
    "the resonance width in equation ( [ eq : reswid ] ) takes values along this locus . for a spherical isotropic stellar system ,",
    "most resonance tracks defining the commensurability have only a small variation with @xmath260 for fixed @xmath179 .",
    "we optimistically assume that an ensemble average over angles for orbits over a large range in @xmath184 for the same resonance cancels the first - order oscillation .",
    "clearly more careful approximations that explicitly compute the full phase - space volume for coherent contributions are possible . in addition , we assume that the phase - space distribution is isotropic .",
    "the phase - space fraction within an energy width @xmath261 for an isotropic phase - space distribution function @xmath262 is : @xmath263 = p(e)f(e ) de = n(e ) de\\ ] ] where @xmath264 with normalisation @xmath265 we then use the width in @xmath179 , corresponding to @xmath266 defined in equation ( [ eq : reswid ] ) , to estimate the fraction of phase space @xmath267 that we require to be populated with at least @xmath256 particles as follows : @xmath268 where @xmath269 is the value of the slow action at the resonance .",
    "this expression for @xmath267 is independent of the choice for @xmath54 , as it must be , but depends of course on the resonance @xmath59 .",
    "we can now use @xmath267 to estimate the number of particles needed to resolve a resonance .",
    "explicitly , our requirement @xmath270 implies that the minimum critical particle number for resonance @xmath59 is @xmath271 .",
    "for example , if we demand that @xmath272 particles should span one tenth of the resonance width for @xmath273 to obtain good first - order cancellation , we require the simulation to contain the following minimum number of particles : @xmath274 this factor of 100 is only a crude guess but tests in  [ sec : results ] suggest that this is approximately the correct value .      as we have seen from ",
    "[ sec : diffu ] , fluctuations on very small spatial scales ( two - body relaxation ) causes diffusion in the conserved quantities of an orbit . recall that in linear perturbation theory , torque is transferred to orbits whose apses are very slowly precessing in the bar frame",
    "this implies that the orbits must remain quasi - periodic for at least several periods in the bar frame .",
    "the period of the slowly precessing orbit is best characterised by the period of the closed resonant orbit . for our spherical system , this period is @xmath275 we therefore require that the diffusion length in the conserved quantities over some number of @xmath276 be smaller than the resonance width .",
    "let the diffusion coefficient , the mean - squared rate of spread of an ensemble of particles in the slow action @xmath129 , be denoted as @xmath277 .",
    "using equation ( [ eq : reswid ] ) , we can then express this criterion as @xmath278 where @xmath279 is the desired number of resonance periods over which the orbit must remain stable .",
    "we estimate that plausible values of @xmath280 range from 0.1 to 0.3 and use @xmath281 in the estimates given below .",
    "we test this choice in  [ sec : results ] . for a fixed phase - space distribution with unit mass , the diffusion coefficient scales as the mass per particle or inversely with the number of particles @xmath282 .",
    "now , if we derive @xmath283 for a unit - mass particle then the number of particles required to satisfy the criterion in equation ( [ eq : diffureq ] ) is @xmath284    direct - summation n - body simulations ( including tree - algorithm based simulations ) follow individual particle motions with a resolution approximately equal to the interparticle softening scale .",
    "we express the relaxation present in these codes at small scales using two - body relaxation as in ",
    "[ sec : criteria ] .",
    "the standard expressions are given in terms of energy @xmath179 and angular momentum @xmath21 .",
    "the diffusion coefficient @xmath285 transforms to new variables @xmath286 as @xmath287 ( e.g. * ? ? ?",
    "depending on the value of @xmath288 , we are free to choose either @xmath289 or @xmath290",
    ". we may then derive @xmath277 from the homogeneous diffusion coefficients @xmath291 and equation ( [ eq : dtrans ] ) .",
    "in the same way , the large - scale expansion - based diffusion coefficients in equations ( [ eq : diffureq ] ) and ( [ eq : nreq ] ) together with equation ( [ eq : dtrans ] ) yields @xmath277 and particle number criteria for noise on large scales .",
    "we use the same expansion from our poisson solver for the expansion in these diffusion coefficients although any biorthogonal expansion would suffice .",
    "this approach also facilitates a direct comparison with the simulations .",
    "comparison between the one- and three - dimensional solutions for individual orbits allows us to investigate the time step criteria necessary to obtain a correct transition through resonance .",
    "this is more stringent than the requirement that the energy or actions be conserved for an equilibrium orbit . for an orbit with energy e , we find that a time step with approximately 1/100 of the period of the circular orbit with the same energy is necessary .      .scaling of particle number requirements . [ cols=\"<,<,<\",options=\"header \" , ]     [ tab : scaling ]    we can use the formula derived in  [ sec : calib ] to determine the particle number requirements , i.e. the number of equal mass particles within the virial radius .",
    "we start with a halo - scale - length bar , i.e. bar radius @xmath292 , whose mass is 1% of the dark matter mass within that radius and a pattern speed at one - half of its corotation value .",
    "we plot the results for each of the three criteria for three of the most important resonances , ilr ( -1,2 ) , corotation ( 0,2 ) , and drr ( 1,0 ) in figure [ fig : dnbigbar ] .",
    "table [ tab : scaling ] describes how each of these criteria scale with the mass of the perturbing bar , @xmath293 .",
    "we choose such a weak bar to facilitate comparison with perturbation theory but the reader may scale these estimates to any bar mass using these relations . since both the energy and angular momentum change along the track of each resonance , as seen in previous figures ( e.g. fig .",
    "[ fig : distlz ] ) , we plot the requirement for each criteria as a function of the radius of a circular orbit with the same energy , @xmath294 . for this interaction ,",
    "the most important resonances are the ilr and drr .",
    "we show the corotation resonance ( 0,2 ) for comparison .",
    "note the radial location of the resonances : the corotation resonance and drr are around the end of the bar , 0.067 , while the ilr begins at approximately one quarter of the bar radius , 0.014 , and extends inward to very small radii , at least as small as 0.02 times the bar radius .",
    "it is important for the poisson solver to resolve down to this scale , approximately @xmath295 times the virial radius in this case .",
    "hence , in this figure we assume a gravitational softening length of this size when calculating the small - scale noise requirement .    for all resonances ,",
    "the small - scale noise criteria is the most severe but it is comparable to the coverage criterion for ilr .",
    "remember that , as they are usually used , the small scale noise criterion only applies to particle - particle codes , e.g. direct , tree , and grid based , and not to expansion scf codes . as described in ",
    "[ sec : diffusion ] , small - scale noise will strongly affect which orbits enter resonance and the regime of the resonance .",
    "however , coverage will dominate the small - scale noise for a stronger , i.e. more massive , bar at ilr according to the scalings in table [ tab : scaling ] .",
    "the estimates for coverage are consistent with the convergence of @xmath113 in phase space with particle number for coverage alone computed using one - dimensional averaging as shown in figure [ fig : distlz ] .",
    "similarly , comparison of figure [ fig : dnbigbar ] and figures [ fig : tbodyorb10 ] and [ fig : tbodyorbilr ] show consistency : the scaling relations require more than @xmath296 particles for drr and considerably more for ilr .",
    "figure [ fig : dnsmlbar ] shows the same predictions for an approximately scale - length sized moderate strength bar , i.e. bar radius@xmath297 .",
    "the bar mass is 10% of the enclosed dark matter mass , making the maximum relative amplitude of the asymmetric to axisymmetric force 30% .",
    "this bar requires a force resolution of @xmath298 times the virial radius to fully resolve the ilr , which we use in our calculation of the small - scale noise .",
    "the coverage criterion demands a very large particle number to correctly couple to the bar  halo ilr : approaching @xmath299 particles .",
    "the trends for the _ outer _ resonances are similar to those for the large bar but the coverage criterion is relatively more important . approximately @xmath300 particles are needed for these resonances .",
    "because the ilr for a scale - length bar occupies very low energies in the cusp , we can check the criteria in figure [ fig : dnsmlbar]a for by realizing only a small subset of the full phase space . by varying the energy range",
    ", we may use between @xmath193 and @xmath296 actual particles to achieve a suite of realizations logarithmically spaced between @xmath193 and @xmath299 equivalent particle numbers .",
    "the ilr resonance only reaches its full amplitude for @xmath301 particles consistent with the prediction in figure [ fig : dnsmlbar ] .    as described in ",
    "[ sec : diffusion ] , the diffusion will cause a drift in the orbits that pass through resonance and cause all resonant interactions to be in the fast limit , even if they would be in the slow limit without noise .",
    "therefore , one may relax the small - scale noise criteria if one knows _ a priori _ that all resonances are fast and possibly still obtain the correct overall torque .",
    "this coincidence explains the convergence of the total torque in simulations that do not meet the small - scale noise criterion . for the bar ",
    "halo interaction emphasised here , slow limit interactions primarily affect the ilr resonance .",
    "the net torque scales as @xmath302 in the slow limit and @xmath303 in the fast limit .",
    "therefore , the noise - induced fast limit may diminish this interaction by an order of magnitude for bars of typical strength .",
    "the bar  halo interaction and dynamical friction are governed by the same dynamics @xcite .",
    "the traditional chandrasekhar dynamical friction is the sum of single scattering events and , therefore , works without resonance .",
    "however , in the case of a bound orbit responding to a periodic perturbation such as a bar ( or orbiting satellite ) , the individual scatterings become repetitive interactions near a commensurability as described in  [ sec : bardyn ] . for quasi - periodic systems ,",
    "the angular momentum transfer occurs at resonances ( and can be understood as the superposition of many second - order secular hamiltonian perturbation theory problems , one for each resonance ) .",
    "hence , dynamical friction works in quasi - periodic systems through resonances .",
    "the second - order quasi - periodic analogue to dynamical friction obtains for fast - limit encounters .",
    "slow - limit encounters have a different scaling . in general",
    ", one can not replace the details of resonant dynamics with that of scattering ( chandrasekhar formula ) .",
    "for example , the lack of a few low - order resonances owing to differences in pattern speed or the halo profile can cause large changes in the torque .",
    "we will see examples of this in paper ii .    in  [ sec :",
    "diffu ] , we argued that scattering owing to small scale fluctuations in the potential can be large enough , even for particle numbers typical of state - of - the - art n - body simulations , that the location and dynamics of the resonance change .",
    "if potential fluctuations rapidly scatter orbits through the resonances , the orbits have no memory that they have been affected by the same perturbation during previous periods .",
    "however , one can observe dynamical friction in a poor simulation even if the quasiperiodic nature of the orbits are lost but it is in the wrong , scattering regime . in this case",
    "it is possible that the total torque can be larger for small @xmath282 .",
    "if this torque changes the actions of the orbits that drive the structural evolution , then the evolution will be even faster .",
    "although the first - order perturbation may dominate the instantaneous changes to phase space , the second - order changes describe the net changes that will persist after many dynamical times . most often , these results are computed assuming that the perturbation began infinitely long in the past , the _ time - asymptotic limit_. lbk derived a formula describing the exchange of angular momentum between a spiral pattern and the rest of the disk in this limit , which can be straightforwardly applied to a bar interacting with a halo @xcite",
    ". however , not only is the number of characteristic dynamical times in a galactic age modest but the growth of a bar is most likely only a small fraction of the galactic age . in the previous section",
    ", we argued that the finite time effects yield different angular momentum distributions in the halo than for a time - asymptotic system .",
    "@xcite shows that the lbk formula does not give an accurate description of the bar slow down for the same reasons and presents the following generalisation for an arbitrary time - dependent perturbation : @xmath304 this expression reduces to the lbk formula for a perturbation with a constant pattern speed in the @xmath305 limit ( for additional details , see * ? ? ?",
    "the simulations described here assume a fixed bar profile with a changing pattern speed .",
    "because angular momentum is conserved , the net change in halo angular momentum is equal and opposite to the bar angular momentum",
    ". therefore @xmath306 .",
    "figure [ fig : pattern ] compares the evolution of the pattern speed @xmath307 in an n - body simulation , the time - dependent torque from equation ( [ eq : lbk1 ] ) , and the time - asymptotic lbk limit .",
    "the details of the simulation will be described in paper ii . for now , note that the time - dependent perturbation theory gives fair agreement while the lbk limit predicts a much more rapid slow down than observed in the simulation .",
    "this is caused by a variety of resonances that do not contribute in the time - asymptotic limit but contribute appreciable torque ( of both signs ) over a finite - time at a sufficient magnitude so that the overall evolution is affected .",
    "clearly , time - dependent theory is necessary to describe this interaction and we use it for all subsequent predictions .",
    "we compare a n - body self - consistent simulation of a bar that forms in a live disk(see * ? ? ? * for details ) to the one - dimensional perturbation theory calculations from  [ sec : numavg ] .",
    "for these simulations , both the expansion centre and the quadrupole centre are at the origin .",
    "we eliminate the @xmath308 term from the expansion and apply only the quadrupole part of the bar perturbation .",
    "this eliminates issues of centring and combined halo - disk equilibria .",
    "we will treat these in paper ii .",
    "the evolution of the pattern speed is computed by enforcing total conservation of angular momentum .",
    "the bar has a mass that is 10% of the dark matter enclosed within the bar radius and corotates at 3/2 of the bar radius .",
    "the bar is slowly turned on and off with the function @xmath309 defined in  [ sec : barpert ] . in figure",
    "[ fig : ocontrib ] , we compare the evolution of the pattern speed in the n - body simulation to the prediction from the one - dimensional averaged perturbation theory .",
    "we also plot the contributions from the five most important resonances separately , calculated using the one - dimensional perturbation theory .",
    "naively , the rate of secular evolution should be proportional to the perturbation amplitude .",
    "however , because of the slow and fast limits this simple scaling is broken . nonetheless",
    ", we can remove some of the dependence on the turn on and turn off by plotting the pattern speed evolution in figure [ fig : ocontrib ] using the scaled time @xmath310     plot for the n - body simulation in figure .",
    "compare this with fig . .",
    "]    as one can also see from figure [ fig : ocontrib]a , the rate of pattern speed evolution predicted by the one - dimensional approach exceeds that in the n - body simulation owing to a stronger ilr contribution . as described in ",
    "[ sec : comp1d3d ] , the ilr is strongly nonlinear and the amplitude predicted by the one - dimensional solution is roughly a factor of two larger than for the three - dimensional solution . figure [ fig : ocontrib]b shows the same run but with the prediction for ilr decreased , in an ad - hoc way , by a factor of two , which gives a good correspondence between the theory and the simulation .",
    "even with this decrease , we see that the torque is still dominated by the ilr and drr . to check this interpretation",
    ", we decreased the bar amplitude by a factor of 10 to @xmath311 . in this case , the ilr is not strongly nonlinear and we have a good correspondence between the prediction and the simulation without any ad hoc adjustment .",
    "figure [ fig : nbodyprof ] shows the distribution of angular momentum change in phase - space as a result of the bar interaction .",
    "it looks very similar to the perturbation theory prediction in figure [ fig : distlz ] with the expected differences in the ilr .      for testing ones",
    "own n - body code s ability to properly evolve the bar - halo problem , we recommend reproducing some of the angular momentum exchange experiments performed here .",
    "for the bar  halo interaction , most researchers only check the evolution of the pattern speed with time . a more sensitive test , and one that is crucial to understanding the component  component interaction during the overall secular evolution , is to verify that each resonance is numerically converged .",
    "comparing the distribution of the change in angular momentum in phase space is an effective tool to accomplish this goal ( e.g. figs .",
    "[ fig : distlz ] and [ fig : comp1d3d ] ) .",
    "these figures may be constructed as follows . for a spherical",
    "halo , the phase - space distribution function will be a function of energy and total angular momentum , @xmath179 and @xmath21 . to make this plane rectangular , use the normalised angular momentum variable @xmath260 so that @xmath312 $ ] . for a spherical equilibrium",
    ", @xmath313 is the angular momentum of the circular orbit with energy @xmath179 .",
    "this can be determined by finding the radius of the circular orbit @xmath314 by solving @xmath315 implicitly for @xmath316 , where @xmath317 and then @xmath318 .",
    "one then computes the change in angular momentum in some time interval on this plane .",
    "if resonant angular momentum transfer dominates the evolution , the change in angular momentum will follow the curves in @xmath179 and @xmath184 defined by the commensurabilities . if scattering or more general non - resonant interaction dominates , the change in angular momentum will populate a broad area in this plane .",
    "this is only a rough guide ; the ilr , for example , is broad @xmath179 and @xmath184 owing to its special degeneracy ( see fig .",
    "[ fig : comp1d3d ] ) .",
    "a @xmath113 plot can be made from an n - body simulation using the following procedure :    1 .",
    "save the state of the n - body phase space separated by a time interval that is small but of order of or larger than the orbital time scale .",
    "for the three - dimensional calculation ( n - body simulation with fixed background potential ) , the evolution of the pattern speed may be compared with figure [ fig : barpert ] in  [ sec : barpert ] .",
    "2 .   for each orbit",
    ", compute the change in the @xmath23-component of the angular momentum , @xmath113 . for figures in this paper , we compute @xmath113 for the entire simulation from before the bar is turned on until after it is turned off using @xmath309 ( eq . [ eq : turnonoff ] ) .",
    "3 .   use a density estimator to produce the distribution of @xmath319 over the phase space in the plane defined by @xmath179 and @xmath184 .",
    "simple histograms will suffice but some tuning of bin sizes will be necessary to resolve the features .    using this graphical tool , one may straightforwardly reproduce some of the examples presented here . here are some recommended tests :    1 .",
    "compute the @xmath113 plots for the large bar used in  ",
    "[ sec : criteria][sec : calib ] .",
    "the details of the bar perturbation are given in ",
    "[ sec : barpert ] .",
    "the @xmath113 diagrams should be compared to figures [ fig : distlz ] and [ fig : comp1d3d ] .",
    "one should attempt to identify each of the resonances .",
    "the bar used for these examples is much larger than bars in nature",
    ". this experiment should be repeated for a scale - length sized bar of moderate strength as described in ",
    "[ sec : results ] . ideally , check that their position and amplitude is converged by drastically increasing the particle number .    since it is not possible to make particle number criteria that are appropriate for all problems , it is necessary to determine the criteria for each class of problem individually using the procedure that we outlined above .",
    "one should check these other scenarios against perturbation theory whenever possible .",
    "this is not always possible so an idealised experiment , i.e. one which imposes an approximate form of the perturbation and its time dependence , should suffice to verify the particle number criteria .",
    "sometimes it is necessary to use a weaker form of the perturbation and in this case the derived particle number criteria can be scaled to the real problem . for these other perturbations , one can repeat the one- and three - dimensional computations outlined in  [ sec : bardyn ] and compare them with n - body simulations .",
    "the perturbation theory allows one to separate the effects of the individual resonances and compute their locations and importance ( e.g. fig .",
    "[ fig : ocontrib ] ) .",
    "numerical perturbation theory , i.e. the integration of the reduced one - dimensional equations of motion , bypasses most of the complications associated with solving the cbe while retaining all of the dynamics of the resonance interaction typical in canonical perturbation theory .",
    "furthermore , this approach automatically includes any desired time dependence .",
    "all of the necessary details including a symplectic integration scheme are provided in  [ sec : numavg ] .",
    "one may also compare individual orbits as in figures [ fig : comporb10 ] and [ fig : comporbilr ] both to check of one s perturbation theory calculation and to verify the choice of time step ( see  [ sec : timestep ] ) . finally , a three - dimensional ensemble integration permits sampling a specific energy range in phase space with more particles than is possible with a full n - body simulation , as a test of convergence .",
    "secular evolution in galaxies is caused by intercomponent interactions possibly triggered by environmental disturbances .",
    "these interactions manifest themselves as large - scale asymmetric features such as spiral arms , bars , ovals , and lopsidedness .",
    "the dynamical mechanisms mediating the secular evolution in the collisionless components are resonantly driven .",
    "the linear and nonlinear dynamics of a single particle in resonance and the features of orbit families in model potentials have been well understood using perturbation theory or numerical solutions of the equations of motion . however , an n - body simulation adds two additional complications .",
    "first , a simulation provides the ensemble result but the effect of a resonance on a particular orbit depends sensitively on initial conditions .",
    "the resulting angular momentum exchange in phase space at resonance has contributions of both signs depending on the orbits initial conditions .",
    "the ongoing secular evolution imposes a directionality that breaks the symmetry in the initial conditions .",
    "however , the simulation must have a sufficient number of particles in the vicinity of the resonance to obtain the correct net torque .",
    "second , representation of the dark matter and stellar components by an unnaturally small number of particles leads to fluctuations in the gravitational potential . for modern simulations ,",
    "the magnitude of these fluctuations yield a very long relaxation time but we have shown that the noise is sufficient to cause orbits to random walk through resonances . of course , if some orbits walk out of the resonance , others walk in .",
    "however for some resonances , ilr in particular , orbits would like to _ linger _ near the resonance for many rotation periods .",
    "the noise prevents this and in doing so changes both the amplitude of the net torque and the location of the orbits in phase space receiving the torque . in this paper",
    ", we explored the details of the resonance mechanism and its manifestation in an n - body simulation from a rigorous kinetic theory point of view .",
    "we presented particle number criteria for each type of discreteness error and checked them with numerical experiments for the bar  halo interaction .",
    "both the coverage and noise criteria require a very large number of particles for important resonances . in the case of coverage , the net torque from such a resonance may not be discernible until the critical particle number is reached . in the case of noise , assuming that the coverage criterion is met , diffusion may force the resonant interaction into a different regime until the noise is reduced to the correct threshold by using a sufficient number of particles . in both cases",
    ", checking for convergence by ( e.g. ) doubling the number of particles may not be a good indicator .",
    "for example , figure [ fig : tbodyorbtot ] shows that the ilr for a very large , albeit weak , bar is reduced by a factor of 3 and the angular momentum is transferred to orbits with higher energy ( and therefore with large radii ) for noise equivalent to @xmath193 particles .",
    "scaling to a moderate strength disk - scale - length - sized bar would demand between @xmath320 and @xmath299 particles to attain the correct dynamical regime .",
    "although larger @xmath282 at fixed spatial resolution will reduce the fluctuations , many n - body practitioners choose to use their particle number to optimise the resolution since the cost of a simulation is driven by @xmath282 .",
    "unfortunately , this results in maximising the noise . for simulations of secular evolution ,",
    "it is worth decreasing the spatial resolution and , thereby , use some of one s particle resources to reduce noise .",
    "alternatively , an expansion code allows us to directly control the spatial resolution and efficiently eliminate the high - spatial frequencies that dominate the noise .",
    "we have shown that this poisson solver reduces the required number of particles to satisfy the noise criterion by several of orders of magnitude , in practise leaving only the coverage criteria .",
    "for this reason , we recommend this poisson solver for treating problems of secular evolution and use it in paper ii to study the self - consistent evolution of the bar - perturbed halo .",
    "of course , this method also has its price : one sacrifices adaptiveness and introduces some bias .",
    "however , in balance we have found it well suited to studying secular evolution .    the work presented here was the product of a sustained cycle of perturbation theory predictions followed by numerical experiments , and we needed many more cycles than anticipated !",
    "our experience suggests that it may not be possible to provide a universal set of particle criteria for an arbitrary dynamical interaction for several reasons .",
    "the strength of the perturbation may change the morphology of the stable periodic orbits , the rate of secular evolution may change the resonance topology , and regimes such as fast and slow limit interactions in resonances may deceive n - body convergence tests .",
    "rather , each secular mechanism must be studied in detail to develop a meaningful set of particle number criteria for that particular problem .",
    "simulations alone are unlikely to be sufficient for a full understanding of the dynamics or even ascertaining convergence .",
    "the important astronomical processes of disk heating and secular bulge formation are worthwhile topics for this sort of future investigation .",
    "many thanks to kelly holley - bockelmann for suggestions , discussions and a careful reading of this manuscript and to julianne dalcanton for pleading for a numerical testing ground .",
    "we would also like to acknowledge many electronic discussions with jerry sellwood .",
    "parts of this work was completed at the institute for advanced study in princeton and mdw thanks his host john bahcall for his hospitality .",
    "this work was supported in part by nsf ast-9802568 , ast-9988146 , ast-0205969 , and nasa atp , nag5 - 12038 & nags-13308 .",
    "arnold v.  i. , 1978 , mathematical methods of classical mechanics .",
    "springer - verlag , new york    athanassoula e. , 2003 , mnras , 341 , 1179    binney j. , tremaine s. , 1987 , galactic dynamics .",
    "princeton university press , princeton , new jersey    chirikov b.  v. , 1979 , physics reports , 52 , 265    contopoulos g. , grosbol p. , 1989 ,",
    "a&arv , 1 , 261    debattista v.  p. , 2002",
    ", in asp conf .",
    "ser . 275 : disks of galaxies : kinematics , dynamics and peturbations bar dynamical friction and disk galaxy dark matter content .",
    "pp 153156    debattista v.  p. , sellwood j.  a. , 1998 , , 493 , l5 +    debattista v.  p. , sellwood j.  a. , 2000 , , 543 , 704    eskridge p.  b. , frogel j.  a. , pogge r.  w. , quillen a.  c. , davies r.  l. , depoy d.  l. , houdashelt m.  l. , kuchinski l.  e. , ramrez s.  v. , sellgren k. , terndrup d.  m. , tiede g.  p. , 2000 , aj , 119 , 536    fuchs b. , 2001 , a&a , 368 , 107    gao l. , white s.  d.  m. , jenkins a. , stoehr f. , springel v. , 2004 , , 355 , 819    goldstein h. , 1950 , classical mechanics .",
    "addison - wesley , reading , massachusetts    hernquist l. , weinberg m.  d. , 1992 , apj , 400 , 80    holley - bockelmann k. , weinberg m.  d. , katz n. , 2005 , mnras    jog c.  j. , 1992 , apj , 390 , 378    jogee s. , barazza f.  d. , rix h. , shlosman i. , barden m. , wolf c. , davies j. , heyer i. , et  al . , 2004 , apjl , 615 , l105    lichtenberg a.  j. , lieberman m.  a. , 1983 , regular and stochastic motion .",
    "springer    lynden - bell d. , kalnajs a.  j. , 1972 , mnras , 157 , 1    navarro j.  f. , frenk c.  s. , white s.  d.  m. , 1997 , , 490 , 493    oguri m. , lee j. , 2004 , , 355 , 120    pawula r.  f. , 1967 , phys .",
    ", 162 , 186    press w.  h. , schechter p. , 1974",
    ", , 187 , 425    risken h. , 1989 , the fokker - planck equation .",
    "springer - verlag    sellwood j.  a. , 1981 , a&a , 99 , 362    sellwood j.  a. , 2003 , apj , 587 , 638    silverman b.  w. , 1986 , density estimation for statistics and data analysis . chapman and hall ,",
    "london    spitzer l. , 1987 , dynamical evolution of globular clusters .",
    "princeton university press , princeton , new jersey    toomre a. , 1981 , in fall s.  m. , lynden - bell d. , eds , , normal galaxies .",
    "cambridge university press , cambridge , p.  111",
    "touma j. , tremaine s. , 1997 , , 292 , 905    tremaine s. , weinberg m.  d. , 1984 , apj , 282 , l5    valenzuela o. , klypin a. , 2003 , , 345 , 406    vesperini e. , weinberg m.  d. , 2000 , , 534 , 598    weinberg m.  d. , 1985 , mnras , 213 , 451    weinberg m.  d. , 1986 , , 300 , 93    weinberg m.  d. , 1994 , , 108 , 1414    weinberg m.  d. , 1998a , , 299 , 499    weinberg m.  d. , 1998b , , 297 , 101    weinberg m.  d. , 2001 , , 328 , 311    weinberg m.  d. , 2004 , in asp conf .",
    "317 : milky way surveys : the structure and evolution of our galaxy finding the milky way in 2mass .",
    "p.  129",
    "weinberg m.  d. , katz n. , 2002 , , 580 , 627    weinberg m.  d. , katz n. , 2005 , mnras , to be submitted ( paper ii )",
    "rather than apply a force from a full bar , we may capture the essence of the nonaxisymmetric interaction by considering the quadrupole component only .",
    "laplace s equation demands that the quadrupole part of the gravitational potential increases as @xmath321 for radii well within the bar and decreases as @xmath322 far from the bar and , therefore , comes to a peak somewhere in between .",
    "we find that the following functional form @xmath323 fits the quadrupole radial component for bars quite well .",
    "to be explicit , our halo is an nfw model with concentration @xmath324 .",
    "we scale all radii and masses by the virial radius and virial mass , respectively .",
    "we fit equation ( [ eq : quad ] ) to a homogeneous ellipsoid with @xmath325 and @xmath326 . the major axis for our main test case is chosen to be @xmath327 .",
    "our standard tests assume a bar mass of 1% of the dark - matter mass enclosed with the bar semi - major axis .",
    "this leads to the following values : @xmath328 , @xmath329 .    to compare with perturbation theory",
    ", we attempt to minimise transients by slowly turning on and off the perturbation using the following function : @xmath330    \\left[1+\\erf\\left({t_f - t\\over\\delta t}\\right)\\right ]    \\label{eq : turnonoff}\\ ] ] where @xmath331 and @xmath332 are the turn and turn off times , respectively , and @xmath333 is the width of the turn and turn off .",
    "the final perturbing potential is therefore : @xmath334    the moment of inertia for the homogeneous ellipsoid about the minor axis is @xmath335 and the angular momentum of the bar is then @xmath336 . let the @xmath23 component of angular momentum of the phase space be @xmath337 . then in the three - dimensional direct integration of a phase - space ensemble , the pattern speed is derived by enforcing the conservation of momentum @xmath338 to give : @xmath339 .",
    "figure [ fig : barpert ] shows the evolution of the pattern speed for the two bar examples from  [ sec : criteria ] ."
  ],
  "abstract_text": [
    "<S> a galaxy remains near equilibrium for most of its history . only through resonances </S>",
    "<S> can non - axisymmetric features such as spiral arms and bars exert torques over large scales and change the overall structure of the galaxy . in this paper </S>",
    "<S> , we describe the resonant interaction mechanism in detail and derive explicit criteria for the particle number required to simulate these dynamical processes accurately using n - body simulations , and illustrate them with numerical experiments . to do this </S>",
    "<S> , we perform a direct numerical solution of perturbation theory , in short , by solving for each orbit in an ensemble and make detailed comparisons with n - body simulations . </S>",
    "<S> the criteria include : sufficient particle coverage in phase space near the resonance and enough particles to minimise gravitational potential fluctuations that will change the dynamics of the resonant encounter . </S>",
    "<S> these criteria are general in concept and can be applied to any dynamical interaction . </S>",
    "<S> we use the bar  </S>",
    "<S> halo interaction as our primary example owing to its technical simplicity and astronomical ubiquity .    </S>",
    "<S> some of our more surprising findings are as follows . </S>",
    "<S> first , the inner - lindblad - like resonance ( ilr ) , responsible for coupling the bar to the central halo cusp , requires more than @xmath0 equal mass particles within the virial radius for a milky - way - like bar in an nfw profile @xcite . </S>",
    "<S> second , orbits that linger near the resonance receive more angular momentum than orbits that move through the resonance quickly . </S>",
    "<S> small - scale fluctuations present in state - of - the - art particle - particle simulations can knock orbits out of resonance , preventing them from lingering and , thereby , decrease the torque . </S>",
    "<S> this particularly affects the ilr . </S>",
    "<S> however , noise from orbiting substructure remains at least an order of magnitude too small to be of consequence . </S>",
    "<S> the required particle numbers are sufficiently high for scenarios of interest that apparent convergence in particle number is misleading : the convergence is in the noise - dominated regime . </S>",
    "<S> state - of - the - art simulations are not adequate to follow all aspects of secular evolution driven by the bar - halo interaction . </S>",
    "<S> it is not possible to derive particle number requirements that apply to all situations , e.g. more subtle interactions may be even more difficult to simulate . </S>",
    "<S> therefore , we present a procedure to test the requirements for individual n - body codes to the actual problem of interest .    </S>",
    "<S> [ firstpage ]    dark matter  cosmology : observations , theory  galaxies : formation , galaxy : structure </S>"
  ]
}