{
  "article_text": [
    "the prevalence of computer driven trading has radically changed the market structure in several asset classes , most notably in equities and futures . this has attracted the interest of researchers driven by both practical and academic motivations .",
    "early studies have followed an econometric approach in exploring the relationship between order flow and prices within electronic trading venues @xcite , whereas later studies focused on understanding and reducing the price impact caused by large orders @xcite .",
    "more recently , several researchers have focused on the application of point processes @xcite , queueing theory @xcite and agent s utility functions @xcite to modeling electronic markets .",
    "participants in electronic trading fall into several categories , with different characteristics and objectives .",
    "although any formal classification is blurred by the fact that the same market participants often interact in several capacities at the same time , algorithmic traders can be roughly divided into the following categories : market makers , who provide the most liquidity in the markets and try to capture the bid - ask spread with minimum duration risk ; systematic traders and arbitrageurs , who typically try to profit from price dislocations and statistical relationships among the prices of different securities ; and agency brokers , who execute large trades on behalf of their customers .",
    "irrespective of their objectives , all market participants in a public electronic venue contribute to price formation by adding and removing liquidity in a limit order book where quotes are published and orders are matched .    here , we will analyze the dynamics of prices and trades from an agency broker s point of view , faced with the task of buying or selling a given number of shares within a set time horizon and at the best possible price .",
    "the broker typically seeks to obtain liquidity from a variety of market venues , including public exchanges , dark pools and internal liquidity sources . in a public exchange , a broker has the choice to either remove liquidity from the far side ( that is , the ask side for a buy order or the bid side for a sell order ) or add liquidity to the near side of the order book .",
    "either strategy has its advantages and trade - offs . when removing liquidity , one pays the full spread but is free to choose the timing of the trade .",
    "when posting passively , one avoids paying the spread but gives up the timing option . in order to explore this trade - off",
    ", we study the relationship between price dynamics and intensity of trade arrival . in the next sections",
    "we will first compute empirically average price moves and waiting times conditional on the state of the order book .",
    "we then attempt to capture the main features by introducing a stochastic model for diffusion in three dimensions .",
    "we compute the probabilities of price movement and trade occurrence from the model , and calibrate them to recent historical market data .    ]    .price moves and waiting times until trade arrival .",
    "we denote quote updates by tuples @xmath0 , with the quantities indicating respectively the time of the quote update , the new best bid , the new best ask , the number of shares at the best bid and those at the ask .",
    "the change in just one of the prices or quantities is sufficient to trigger the publication of a quote update , i.e. a new row in the table . in the same table",
    "we denote a trade execution by the tuple @xmath1 with quantities indicating the time , the price , the quantity and the side of the trade .",
    "this sequence is used for computing price moves and waiting times until the arrival of the next trade , as described in the text[tab : taq - proc ] [ cols=\"^,^,^,^,^ \" , ]",
    "a common intuition among market practitioners is that the order sizes displayed at the top of the book reflect the general intention of the market .",
    "when the number of shares available at the bid exceeds those at the ask , participants expect the next price movement to be upwards , and inversely , for the ask .",
    "this is why , for example , a broker working an order on behalf of a client might be concerned about posting too much of it at the near side , thus showing his intentions to the rest of the market . in order to quantify and model this intuition ,",
    "we calculate a few quantities related to the microstructure of the order book conditional on its bid - ask imbalance defined as @xmath2 where @xmath3 and @xmath4 are the bid and ask quantities posted at the top of the book .",
    "positive ( negative ) imbalance indicates an order book that is heavier on the bid ( ask ) side . in figure",
    "[ fig : cond_imbalance_emp-1 ] , we show the effect of the book imbalance on the average mid price change and on the waiting time until the next price change .",
    "we calculate these quantities by considering the stopping time defined by the next change in either the best bid or the best ask .",
    "the average price changes are therefore related to the conditional up - tick and down - tick probabilities , which have been previously considered in the literature @xcite . here",
    ", we use the same probabilities to compute the average size of the price jump .",
    "as expected , a high book imbalance is indicative of the general trading intention in the market and , on average , a good predictor of mid price movements .",
    "the price change until the next tick is well approximated by a linear function of the imbalance and is typically well below the bid - ask spread , even for highly imbalanced order books .",
    "in other words , although book imbalance might be used as a predictor for the next price movement , it does not by itself offer an opportunity for a straightforward statistical arbitrage .",
    "the average waiting time until the next mid price change is also affected by the imbalance of the order book , with highly imbalanced books indicating a price move coming in a relatively short time .",
    "this relationship is to be expected in a market where the typical broker posts part of his orders at the near side and both price variations and queue levels are mostly driven by the pressure of the order flow . in the context of microstructure studies , this is usually interpreted as the order flow having an impact on the limit book , but it can also be seen more generally as the natural supply and demand influence on the price of an asset .",
    "another stopping time with economic significance is the one defined by the first arrival of a trade of a specified side .",
    "this stopping time is important to a broker who is posting part of his order at the near side of the limit order book and has to wait for market orders originating from the opposite side to be matched with his resting order .",
    "trades originating from the same side ( i.e. trades from buy market orders while the broker is posting at the bid ) may affect the share price and change the prevailing dynamics in the market , but they will not contribute to the broker s fill rate .",
    "therefore , for an order posted at the bid ( ask ) side , the relevant stopping time is the time of first arrival of a sell ( buy ) trade .    in table",
    "[ tab : taq - proc ] we show a typical segment of the trades and quotes times series .",
    "it consists of quote tuples @xmath0 , indicating the time of the quote update , the new best bid and ask prices and sizes , and trade tuples @xmath1 indicating the time , price , quantity and side of the trade .",
    "note that although the side of the trade is not usually published by equities exchanges , it can be inferred by its price compared to the prevailing quotes .",
    "we calculate average price variations and waiting times until the next buy or sell trade as follows : a ) for each quote @xmath0 we compute the prevailing book imbalance @xmath5 , as in eq .",
    "( [ eq : imbaldef ] ) ; b ) given a quote , we identify the next buy and sell trade on the tape ; c ) we determine the prevailing mid price at the time of the trade ; d ) we compute the difference between the prevailing mid price and the mid price of the original quote , and assign it to the corresponding bucket based on the original quote imbalance and the side of the trade .",
    "a similar procedure is used for computing the waiting time until the next buy or sell trade .    in figure",
    "[ fig : cond_imbalance_emp-2 ] we show average price moves and waiting times until the arrival of the next buy or sell trade , conditional on the book imbalance . as expected , the general trends of these quantities as a function of the book imbalance are similar to those obtained by using the next mid price move as a stopping time .",
    "however average price movement from the observation time to the arrival of the next sell trade display a clear shift upwards compared to those derived until the arrival of the next buy trade .",
    "this can be interpreted as the result of the information advantage of aggressive traders over traders posting at the near side .",
    "it can also be interpreted more mechanically , as the impact of the intervening buy trades between the observation time and the next sell trade ( conversely , the impact of intervening sell trades if the stopping time is the next buy trade ) . as a result of this information ,",
    "a trader who is posting his quote on the bid side of the limit order book will see on average an upwards price move by the time a sell trade matches his quote .",
    "conversely , a trader posting on the ask side of a book displaying the same book imbalance will experience a price movement with a downward bias . finally , in figure [ fig : cond_prob_empir-1 ] we compute the empirical probability of the next market event as a function of the current book imbalance .",
    "the events of interest are a favourable or unfavourable price move or the occurrence of a matching trade from the point of view of a broker pegging part of his order on the near side , i.e. the broker keeps updating his quote to stay at the prevailing best bid or ask price .    in the next sections",
    ", we will explain the empirical observations summarized in figures [ fig : cond_imbalance_emp-1 ] and [ fig : cond_prob_empir-1 ] by introducing a three - dimensional stochastic model for the joint evolution of the bid / ask queues and the near side trade arrival process . before developing the full model we will first review a simpler , two - dimensional model for the bid and ask queues only , in order to introduce some of the analytical techniques that are used in the full three - dimensional model .",
    "our starting point is the two - dimensional diffusion model for the top of the book @xcite.we model the number of shares @xmath3 and @xmath4 posted at the top of the order book for the bid and ask with the following stochastic processes :    @xmath6    where @xmath7 are brownian motions . because the number of shares available at the top of the book is always a positive quantity , when either of the two processes cross the positive axis we reset its value by drawing from two positive distributions @xmath8 and @xmath9 .",
    "one can think of these distributions as modeling the next price levels in the book ; once the first level is depleted , they serve as a new starting point for the top queue . following this interpretation",
    ", we will also assume that every time one of the two queues is depleted the price also moves in the direction of the depleted queue .",
    "if the ask queue is depleted the price moves up ; if the bid is depleted the price moves down .",
    "in other words , we assume that as one side of the book is depleted under the pressure of incoming aggressive trades and cancellations of existing limit orders , the other side follows it to keep the bid - ask spread fixed .",
    "given the queue model of equation ( [ eq : b ] ) , it is natural to ask whether an up - tick or a down - tick is the most likely future price move .",
    "we can calculate such probabilities by identifying the @xmath10 and the @xmath11 axes of the plane with the bid and the ask quote sizes respectively and writing the general equation for the evolution of the hitting probability :    @xmath12    where @xmath13 is the correlation between the diffusion processes governing the depletion and replenishment of the bid and ask queues .",
    "this correlation is typically negative in a normal market .",
    "the choice of boundary conditions selects the event with corresponding probability @xmath14 .",
    "for example , for an up - tick price movement , the boundary conditions are @xmath15 moreover , since the probability @xmath14 is for event occurrence up to the first stopping time , the pde in eq .",
    "( [ eq : pde2dxy ] ) is time independent .",
    "in fact , the solution is the @xmath16 limit of the fixed @xmath17 horizon problem .",
    "as shown in @xcite among others , it is possible to solve the above pde by introducing two changes of variables .",
    "the first transformation removes the correlation between the queue processes :    @xmath18    yielding the equation    @xmath19    the second transformation casts the modified problem in polar coordinates :    @xmath20    where @xmath21 .",
    "then the equation for the hitting probability becomes    @xmath22    and the boundary conditions for an up - tick price movement become @xmath23 the solution in polar coordinates is straightforward , @xmath24 , which in the original set of coordinates has the form    @xmath25    this is the probability of upward movement of a markovian order book in the diffusive limit .",
    "in order to capture the joint dynamics of the bid and ask queues and trade arrival , we introduce another stochastic process to model the arrival of trades on the near side of the book ( the bid side for a broker executing a buy order , or the ask side for a sell order ) :    @xmath26    the process @xmath27 does not correspond to a market observable .",
    "however , in analogy to our model for the bid and ask queues , we assume that a new trade hits the near side whenever @xmath27 crosses the origin . within this extended three dimensional model ,",
    "the queue processes @xmath3 and @xmath4 are now driven exclusively by the addition and cancellation of limit orders in the book until the arrival of a trade , while the timing of near side trade arrivals is governed by the @xmath27 process .",
    "more importantly , we can model the relationship between book imbalance , order flow and price variations by introducing correlations between the stochastic processes @xmath28 , @xmath29 , and @xmath30 .",
    "the introduction of an unobserved diffusion process @xmath30 for modeling trade arrival leads to a non - markovian model . as in the two - dimensional case",
    ", we assume that once a queue gets depleted or a trade arrives , the process @xmath31 restarts at a value @xmath32 which characterizes the trade arrival time distribution . this model parameter is to be determined by calibration .    during the dynamic optimization of an execution schedule",
    ", one needs to consider the relative likelihood of favourable and adverse price moves and of trade arrival at the near side of the book . in terms of the model described above",
    ", these events correspond to the three dimensional stochastic process @xmath33 crossing the positive orthant . in the following ,",
    "we calculate the probability of these market events conditional on the state of the queue and the value of the trade process @xmath27 . as in the previous section",
    "we identify the @xmath10 and @xmath11 coordinates with the processes governing the bid and ask queue sizes , and the @xmath34 coordinate with the level of the process @xmath27 .",
    "the equation for the hitting probability becomes : @xmath35 where @xmath13 is the correlation between the processes governing the bid and ask queues , and @xmath36 and @xmath37 are the correlation of those processes with that governing the arrival of the trades at the near side .",
    "the different events are identified by the boundary conditions of @xmath14 , which are set to one on the plane corresponding to the market event considered , and zero on all other boundaries .",
    "for example , the probability of a near side trade before any price move corresponds to the boundary conditions @xmath38    as in the two dimensional case , it is possible to remove the correlations between @xmath28 , @xmath29 , and @xmath27 via the coordinate change    @xmath39}{\\sqrt{1-\\rho^2_{xy } } \\sqrt{1 - \\rho_{xy}^2 - \\rho_{xz}^2 - \\rho_{yz}^2 + 2\\rho_{xy}\\rho_{xz}\\rho_{yz } } } , \\end{aligned } \\right.\\ ] ]    yielding the equation    @xmath40    then we cast the problem into a convenient set of curvilinear coordinates via the transformation    @xmath41    yielding the modified problem    @xmath42    and the boundary condition for a near side trade becomes @xmath43 the new integration domain after the introduction of spherical coordinates is shown in figure [ fig : integration - domain ] . the problem ( [ eq : phitheta ] ) can be further simplified by introducing one extra transformation , @xmath44 which changes the integration domain into the semi - infinite strip , @xmath45 @xmath46 , and the diffusion equation ( [ eq : phitheta ] ) into the form    @xmath47    in this domain the near side trade boundary conditions become @xmath48    the solution to problem ( [ eq : phizeta ] ) that satisfies the first two boundary conditions ( [ eq : phizeta_trade_bc ] ) can be expressed as a generalized fourier series @xcite :    @xmath49    with @xmath50 .",
    "the expansion coefficients @xmath51 can be determined by enforcing the third boundary condition in ( [ eq : phizeta_trade_bc ] ) . to compute the coefficients , we introduce the integrals    @xmath52    @xmath53",
    "then the third boundary condition in ( [ eq : phitheta_trade_bc ] ) becomes the matrix equation @xmath54 and the coefficients @xmath51 can be computed by matrix inversion as @xmath55 .    ]    ) in the @xmath56 space , for @xmath57 and boundary conditions as in ( [ eq : phitheta_trade_bc ] ) .[fig : sol_profile ] ]    when the boundary @xmath58 is approximately linear , the integrals @xmath59 and @xmath60 can be computed analytically .",
    "figure [ fig : sol_profile ] shows the solution profile for the case where the near side trade arrival process is uncorrelated from the bid and ask queue sizes , i.e. @xmath61 . in summary we have a semi - analytic method of computing the probability @xmath62 or equivalently @xmath63 for given initial values @xmath64 and corresponding correlations .",
    "we proceed by calibrating the model jointly to the average mid - price moves shown in figure [ fig : cond_imbalance_emp-2 ] and to the empirical probabilities of price moves and trade arrivals summarized in figure [ fig : cond_prob_empir-1 ] .",
    "it was shown in the previous section that the model probabilities are determined by the book imbalance ( relative size of the bid and ask queues ) , the initial position of the trade arrival process @xmath32 and the three elements of the correlation matrix @xmath65 .",
    "the book imbalance is a market observable , and the remaining four parameters are to be estimated by the calibration process .",
    "model probabilities are computed semi - analytically as in the previous section .",
    "expectations of price changes up to the stopping time defined by the arrival of a trade can not be easily computed with analytic methods and monte carlo simulations were used instead .",
    "we calibrate the model against empirical probabilities of price movements for equity vod.l for all trading days in the first quarter of 2012 .",
    "the results are shown in figures [ fig : cond_imbalance_emp-2-cal ] and [ fig : passive - fill - probabilities ] .",
    "calibrations against data from other liquid stocks displayed qualitatively similar results .",
    "we note that the model reproduces the gap between the average mid - price moves until the arrival of a buy or sell trade .",
    "the gap is controlled by the correlation matrix @xmath66 and in particular by the two correlations between the trade arrival process and the bid and ask queue processes .",
    "this shift in average price moves conditioned on the side of the trade can be interpreted as the expected slippage of a passive fill .",
    "when executing an order , a broker will typically post a fraction of the total quantity at the near side in an attempt to save part of the spread . however , when measuring the differences in the average price achieved by aggressive and passive fills , we observe that passive fills rarely achieve their expected savings of one full spread . while part of this effect is generally attributed to adverse selection ( that is , the ability of other market participants to take advantage of the timing given up by the broker when posting at the near side ) , the slippage of orders posted at the near side is also due to the interaction between queue depletion and trade flow , as our model predicts . in the calibration described here ,",
    "this effect alone is responsible for the loss of about 60% of the theoretical spread captured by a passive fill .",
    "figure [ fig : cond_imbalance_emp-2-cal ] also compares the empirical and model derived average arrival times of a buy or sell trade as a function of book imbalance .",
    "the model captures the gross features of the empirical shapes for moderate book imbalance values , but is not as accurate in reproducing the steep decrease of the arrival times at extreme book imbalance values .",
    "finally , we note that the model is able to reproduce the empirical shapes of the event probabilities .",
    "as shown in figure [ fig : passive - fill - probabilities ] , the probability of an unfavorable price movement increases as the book gets heavier towards the near side , reaching almost 90% in cases of high imbalance . knowing this , a broker can decide to keep the order posted on the near side for moderate imbalance values and cross the spread in a highly imbalanced book . deriving such optimal spread crossing policies is left for future work .    ,",
    "@xmath67 and @xmath68 @xmath69 [ fig : cond_imbalance_emp-2-cal ] ]    ]",
    "we analyzed the microstructure of trade arrival and its relationship to the state of a limit order book .",
    "we observed empirically that the arrival time of trades at the near side and the dynamics of the mid - price until the arrival of a trade of a given side depend strongly on the order book imbalance .",
    "we introduced a stochastic model with correlation between the processes for the order queues at the top of the book and a process representing the arrival of the trades at the near side of the book .",
    "we were able to compute probabilities of price movement and trade arrival in a semi - analytical form .",
    "this allowed us to perform an efficient calibration of the model to empirical probabilities .",
    "since the model captures the dependence of the trade arrival probabilities on the order imbalance , it can be used to construct optimal order execution strategies .",
    "we would like to thank ioana savescu for many insightful discussions and comments .",
    "bouchaud , j.  d. farmer , and f.  lillo .",
    "how markets slowly digest changes in supply and demand . in t.",
    "hens and k  schenk - hoppe , editors , _ handbook of financial markets : dynamics and evolution_. elsevier : academic press , 2008 ."
  ],
  "abstract_text": [
    "<S> we examine the dynamics of the bid and ask queues of a limit order book and their relationship with the intensity of trade arrivals . in particular , we study the probability of price movements and trade arrivals as a function of the quote imbalance at the top of the limit order book . we propose a stochastic model in an attempt to capture the joint dynamics of the top of the book queues and the trading process , and describe a semi - analytic approach to calculate the relative probability of market events . </S>",
    "<S> we calibrate the model using historical market data and discuss the quality of fit and practical applications of the results . </S>"
  ]
}