{
  "article_text": [
    "alignment problems for large detectors , especially track detectors , in particle physics often require the determination of a large number of alignment parameters , typically of the order of @xmath0 to @xmath1 .",
    "alignment parameters for example define the accurate space coordinates and orientation of detector components . in addition",
    "drift chambers require the determination of the drift velocity @xmath2 and of local variations of the drift velocity , and of the lorentz angle .",
    "figure [ fig : corra ] shows an example of residuals in a silicon vertex track detector before and after an alignment .    in the alignment",
    "usually special alignment measurements are combined with data of particle reaction , typically tracks from physics interactions and from cosmics . in this paper",
    "the alignment parameters are called _ global _ parameters ; they contribute to all the data .",
    "usually these parameters are _ corrections _ to default values and are thus relatively small , and the value zero is the initial approximation .",
    "parameter sets valid for a single track are called _ local _ parameters , examples are track slopes and curvatures .",
    "an approximate alignment method is to perform least squares fits on the data _ ignoring _ initially the alignment parameters .",
    "the _ deviations _ between the fitted and measured data , the _ residuals _ , are then used to determine the alignment parameters afterwards .",
    "single fits depend only on the small number of local parameters like slope or curvature of the track , and are easy to perform .",
    "this approximate method however is not a statistically correct method , because the ( local ) fits depend on a wrong model ( namely : ignoring the global parameters ) , and the result are biased .",
    "in addition the results may be unstable due to detector inefficiencies .",
    "the adjustment of parameters based on the observed ( biased ) residuals will then result in biased alignment parameters .",
    "if these alignment parameters are applied as corrections in repeated fits , the remaining residuals will be reduced , as desired .",
    "however , the fitted parameters will still be biased , even more , if this approximate procedure is applied iteratively .",
    "the simple residual method is also unable to determine correlated parameters , for example a geometrical shift of a detector position and a shift in drift velocity in a drift chamber .",
    "a better method is an overall fit , with all the ( global ) alignment parameters and local parameters , perhaps from thousands or millions of events , determined simultaneously .",
    "the most important general method for the determination of parameters from measured data is the linear least squares model .",
    "it is usually stable , fast and accurate , requires no initial values of parameters and is able to take into account all the correlations between different parameters , even if there are many parameters .",
    "there is of course a practical limit in the number of parameters in simultaneous fits , because of space and time limitations . in an alignment",
    "fit the size of the vectors and matrices in the least squares solution will be large , of the order of @xmath3 or @xmath4 . with standard methods such",
    "a solution is impossible .    in this paper",
    "a special method of solution for this kind of problems is derived . due to the special structure of the matrices with one set of global parameters and many sets of local parameters",
    "the problem can in fact be reduced to a solvable size , without making any approximations .",
    "the rather general method is realized in a program called * millepede * @xcite .",
    "* linear models . * in a linear model the measured quantity @xmath5 has an expectation value which is a _ linear _ combination of the parameters @xmath6 with fixed factors ( e.g. from geometry ) which are combined to a vectore @xmath7 .",
    "the difference between the measured value and the expectation value is the residuum @xmath8 : @xmath9 the measured data are assumed to be _ independent _ ; the result of a measurement @xmath5 does not depend on any other measurement .",
    "thus the covariance matrix of the measured data is a diagonal matrix , which simplifies the treatment .",
    "the accuracy of the measurement @xmath5 is given by the variance @xmath10 or the standard deviation @xmath11 .",
    "it is assumed , that the precision is at least approximately known .",
    "the solution of the method of least squares is determined by the minimum of the weighted sum of the square of the residuals @xmath12 where the sum ( index @xmath13 ) is over all measurements .",
    "this sum is a quadratic function of the parameters @xmath6 , and the solution is obtained from a set of linear equations ( so - called normal equations of least squares ) , which can be written in matrix form @xmath14 with a symmetric @xmath15-by-@xmath15 matrix @xmath16 and a right - hand - side @xmath15-vector @xmath17 ; the elements of @xmath16 and @xmath17 are sums with _",
    "independent _ contributions from each measurement ( because the measured data are independent ) .",
    "there is no limitation on the number of measured data ; it is not necessary to keep all input data in memory , because the complete information from a single measurement is contained in the contributions to @xmath16 and @xmath17 , which have a fixed size .",
    "the solution vector is @xmath18 with the inverse of the matrix @xmath16 , which , by error propagation , is equal to the covariance matrix of the parameters @xmath6 .",
    "what are the limits for the number @xmath15 of parameters , if the matrix equation is solved by standard methods ?",
    "the symmetry property of the matrix @xmath16 may be used to store only the @xmath19 elements on and above the diagonal , and also to reduce the computer time to almost half the time for a non - symmetric matrix .",
    "matrix inversion is an explicit process and requires a cpu time proportional to @xmath20 for a @xmath15-by-@xmath15 matrix . for a @xmath1-by-@xmath1 symmetric matrix in double precision ( about 4 mbyte )",
    "the cpu time is a few minutes on a standard pc . the time ( @xmath21 ) and space ( @xmath22 ) requirements imply at present a practical limit of the size of the matrix ( and number of parameters ) between @xmath23 1  000 and @xmath23 10  000 .",
    "the accuracy of the computation of the inverse matrix is a critical point , and often computation in double precision is required , especially for large matrices .",
    "the accuracy is generally low for a large condition number of the matrix ( the condition number is defined as the ratio of the largest to the smallest eigenvalue of the matrix ) . from the interpretation of the inverse matrix as covariance matrix it is clear , that the condition number will be large if the correlation between parameters is high .",
    "the matrix is singular ( one or more eigenvalues are zero ) in case of a complete correlation between parameters . in this case and also in cases of missing data ( e.g. dead channels in an alignment fit )",
    "a standard matrix inversion program will fail .",
    "a singular value decomposition ( svd ) would allow to recognize the cases of zero or small eigenvalues , which would _",
    "destroy _ the full solution .",
    "the standard method in case of zero or very small eigenvalues is to set their inverse to zero ; this means essentially to remove parameters or linear combinations of parameters from the solution ( i.e. the resulting parameter values are zero ) ; if the parameters are in fact _",
    "corrections _ this is clearly acceptable . in the program",
    "* millepede * @xcite a similar , but simpler and faster strategy is used to avoid the effects of a bad condition number .",
    "this strategy also works in cases , where due to missing input data one or more parameters are undefined ; the parameters will become zero in this case .",
    "the strategy allows in addition to remove certain parameters from the least squares fit without the necessity to reorganize the numbering .",
    "* solution by partitioning .",
    "* the special structure of the matrix @xmath16 to be inverted may allow to move the limit of solvable problems further ( see also @xcite ) .",
    "below the matrix @xmath16 is partitioned into submatrices , and the vectors @xmath6 and @xmath17 are partitioned into two subvectors ; then the matrix equation becomes @xmath24 where the submatrix @xmath25 is a @xmath26-by-@xmath26 square matrix and the submatrix @xmath27 is a @xmath28-by-@xmath28 square matrix , with @xmath29 .",
    "if the sub - vector @xmath30 would not exist , the solution for the sub - vector @xmath31 would be defined by the matrix equation @xmath32 where the star indicates the special character of this solution .",
    "only the @xmath28-by-@xmath28 sub - matrix @xmath27 has to be inverted .",
    "the solution @xmath33 of course differs from the final solution @xmath31 and is called the _",
    "local _ solution .",
    "now , having inverted the sub - matrix @xmath27 , the submatrix of the complete inverse matrix @xmath16 correponding to the upper left part @xmath25 , called @xmath34 , is obtained by the formula @xmath35 which requires in addition to some matrix products the calculation of the inverse of a @xmath26-by-@xmath26 sub - matrix . with this matrix @xmath34",
    "the solution of the whole matrix equation can written in the form @xmath36 which can be used to obtain the complete result ( @xmath30 and @xmath31 ) .",
    "note that to solve the matrix equation two smaller matrices , a symmetric @xmath26-by-@xmath26 and a symmetric @xmath28-by-@xmath28 matrix , have to be inverted .",
    "the sub - vector @xmath30 is obtained by the product @xmath37 which is simplified by using the special local solution @xmath38 .",
    "if the interest is the determination of this sub - vector @xmath30 only , while the sub - vector @xmath31 is not needed , then only the equation has to be solved .",
    "some computer time can be saved by this method , especially if the matrix @xmath39 is easily calculated or already known before . in special cases",
    "the method can be applied repeatedly , and therefore problems with a huge number of parameters become solvable .",
    "the method is not an approximation , but is exact and it takes into account all the correlations .",
    "this type of application is discussed in more detail in the next chapter .",
    "it seems that this possibility of removing unnecessary parameters , but still getting the correct solution for the remaining parameters in least squares problems was already known and has been used in the nineteenth century ; one example is @xcite .",
    "* constraints .",
    "* if there are explicit relations between the parameters of a least squares fit , then they should be explicitly taken into account in the solution .",
    "the case of a single linear constraint between parameters of the form @xmath40 is assumed here .",
    "the lagrange multiplier method is the standard method to include constraints in a least squares solution ; one additional vector @xmath41 is introduced , with one element per constraint .",
    "the equation is modified by the additional parameters to the form @xmath42 where the matrix on the left hand side is still symmetric .",
    "_ linear _ least squares problems with _ linear _ constraints can be solved direcly , without iterations and without the need for initial values of the parameters .",
    "* local parameters .",
    "* local parameters are denoted by @xmath43 .",
    "a set of measurements @xmath44 is considered . a single value @xmath44 from the set is ideally given by a linear expression @xmath45 , depending on the parameters @xmath46 and on ( known ) constant factors @xmath47 .",
    "more complete , the dependence can be written as @xmath48 with an additional index @xmath13 indicating the @xmath13-th measured value .",
    "as an example the measurement of a straight particle track is considered , where each @xmath5 is a coordinate measurement at plane @xmath13 .",
    "the local parameters are intercept ( @xmath49 ) and slope ( @xmath50 ) of the particle track . if the distance of the plane is denoted by @xmath51 , the linear track model can be written as @xmath52 from a least squares fit of the model to the set of measured @xmath44-values the local parameters intercept and slope can be determined .",
    "the formalism of least squares allows to take into account the different precision of the different measurements , by assigning a weight to each measurement of @xmath53 .",
    "the least squares solution , minimizing the weighted sum of squared residuals , is defined by the so - called normal equations , which can be written in terms of matrices @xmath54 the elements of the matrix @xmath55 and the vector @xmath56 are formed by sums @xmath57 these formulas are valid in the case of _ uncorrelated _ @xmath44-measurements ( uncorrelated measurements are assumed thoughout this paper ) .",
    "the inverse matrix @xmath58 is the covariance matrix of the parameter vector @xmath59 .",
    "* global parameters . *",
    "now global parameters are considered , which contribute to _ all _ the measurements .",
    "they are assumed to be _ alignment parameters _ here , although the formalism is general and can also be applied to other problems .",
    "aligment parameters are defined to represent _ corrections _ to ideal ( design ) values ; this parametrization adds further terms to the equations @xmath60 usually only few terms containing global parameters are nonzero for a single @xmath44 measurement . in the following it",
    "is assumed that , as written in equation , the dependence on the global parameters is _ linear_. a non - linear relationship for the global parameters would require iterations , starting with reasonable initial values for the parameters , and assuming a linearized expression in each iteration .",
    "* the simultaneous fit of global and local parameters . * in the following it is assumed that there is a set of @xmath61 partial measurements .",
    "each partial measurement , with index @xmath62 , depends on local parameters @xmath63 , and all of them depend on the global parameters . in a simultaneous fit of all global parameters plus local parameters from @xmath61 subsets of the data there",
    "are in total @xmath64 parameters , and the standard solution requires the solution of @xmath64 equations with a computation proportional to @xmath65 . below it is shown , that the problem can be reduced to @xmath15 equations with a computation proportional @xmath20 .",
    "generalizing the formalism of equations to the complete measurement , starting from equations of the type of , one obtains a system of normal equations with large dimensions , as is shown in equation .",
    "the matrix on the left side of equation has , from each partial measurement , three types of contributions .",
    "the first part is a contribution of a symmetric matrix @xmath66 , of dimension @xmath15 ( number of global parameters ) .",
    "all the matrices @xmath66 are added up in the upper left corner of the big matrix of the normal equations .",
    "the second contribution is the symmetric matrix @xmath67 ( compare equation ) , which gives a contribution to the diagonal of the big matrix and is depending only on the @xmath62-th partial measurement . the third contribution is a rectangular matrix @xmath68 , with a row number of @xmath15 ( global ) and a column number of @xmath69 ( local ) .",
    "there are two contributions to the vector of the normal equations , @xmath70 for the global and @xmath71 for the local parameters .",
    "the complete matrix equation is given by @xmath72 in this matrix equation the matrices @xmath66 , @xmath67 , @xmath68 and the vectors @xmath70 and @xmath71 contain contributions from the @xmath62-th partial measurement .",
    "ignoring the global parameters one could solve the normal equations @xmath73 for each partial measurement separately by @xmath74 the complete system of normal equations has a special structure , with many vanishing sub - matrices .",
    "the only connection between the local parameters of different partial measurements is given by the sub - matrices @xmath68 und @xmath66 ,    the aim of the fit is solely to determine the global parameters ; final best parameters of the local parameters are not needed .",
    "the matrix of equation is written in a partitioned form .",
    "the general solution can also be written in partitioned form .",
    "many of the sub - matrices of the huge matrix in equation are zero and this has the effect , that the formulas for the sub - matrices of the inverse matrix are very simple . by this procedure",
    "the normal equations @xmath75 are obtained , which only contain the global parameters , with a modified matrix @xmath76 and a vector @xmath77 , @xmath78 this set of normal equations contains explicitly only the global parameters ; implicitly it contains , through the correction matrices , the complete information from the local parameters , influencing the fit of the global parameters .",
    "the parentheses in equation represents the solution for the local parameters , ignoring the global parameters .",
    "the solution @xmath79 represents the solution vector @xmath6 with covariance matrix @xmath80 .",
    "the solution is direct , no iterations are required .",
    "iterations may be necessary for other reasons , namely    * the equations depend _ non - linearly _ on the global parameters ; the equations have to be linearized ; * the data contain outliers which have to be removed in a sequence of cuts , becoming narrower during the iteration ; * the accuracy of the data is not known before , and has to be determined from the data ( after the alignment ) .    * application .",
    "* a very important point in problems discussed above is the definition of the set of global parameters .",
    "it is essential to define them in a way which is sensitive to the data used to determine them .",
    "computing the inverse of a huge ( symmetric ) matrix can be a delicate numerical problem .",
    "the matrix will be singular or close to a singular matrix , if one or more of the global parameters are not really determined ( and constrained ) by the data , and this could destroy the whole determination .",
    "this will happen in case of a strong correlation between different global parameters .",
    "it is wise to start with a few global parameters and to observe the correlations between them , before adding more global parameters .",
    "for example if too many global parameters are used in a detector alignment , the whole detector may _ shift _ and _ rotate _ freely in the fit . in those cases one could either fix certain global parameters or",
    "one has to introduce constraints ( e.g. average displacement and rotation equal to zero )",
    ".    experience with the method shows that it is essential to make a simultaneous alignment of all track detector components , which are also used for the measurement of tracks , while independent internal alignment of the single track detector components may not lead to a good overall result .",
    "it is also important to use , if possible , different data sets simultaneously . for example in a track detector alignment high - momentum cosmic muons may be useful , which traverse the whole detector and thus relate ( and constrain ) different parts of the detector . but this should be done simultaneously with tracks from physics events , because these events finally require a good alignment .",
    "the method described here has been realized in the program * millepede * @xcite , written in fortran77 .",
    "it provides a set of subroutines for the mathematical methods and allows to adapt the method to a particular problem .",
    "the program allows to adjust the dimension of vectors and matrices via ` parameter`-statements and to introduce linear constraints . throughout the program use",
    "is made of the sparse character of the vectors and matrices in order to reduce the execution time .",
    "the program includes a method for outlier rejection , which in practice may be essential in alignment problems especially if some detector components have a bad initial alignment .",
    "this feature requires to iterate , realized with an intermediate data file , which is written during the first iteration and read during the other iterations .    sometimes the model underlying",
    "the alignment is _ nonlinear _ and also constraints may be nonlinear . the standard method to treat these problems is linearization : the nonlinear equation is replaced by a linear equation for the correction of a parameter ( taylor expansion ) ; this requires a good approximate value of the parameter .",
    "the example described is the alignment in the @xmath81-plane perpendicular to the beam line of a 56-plane drift chamber and a 2-plane silicon vertex detector in the h1 detector at hera @xcite .",
    "both are cylindrical detectors ; the drift chamber has a length ( @xmath44 ) of about 2 m , and extending from 20.3 cm to 84.4 cm in radius @xmath82 .",
    "the silicon vertex detector @xcite has two planes around the beampipe made of 0.15 mm aluminium and 0.9 mm carbon fiber .",
    "the drift chamber and the silicon vertex detector have a @xmath81 resolution of about 150 @xmath83 m and 15 @xmath83 m , respectively .",
    "these detectors are interspersed by additional chambers for the @xmath44-measurement .",
    ".alignment parameters determined in the * millepede * fit .",
    "[ aliparm ] the * millepede * accuracy is given by one standard deviation @xmath84 .",
    "the different parameters are discussed in the text . [",
    "cols=\">,>,<,>,<\",options=\"header \" , ]     the alignment procedure allows to reach the intrinsic resolution not only locally but also for complete tracks . for the drift chambers cjc1 and cjc2 the local hit resolution can be determined from local hit triplets as a function of drift distance",
    "; the minimum is about 120 @xmath83 m for 1 cm drift distance .",
    "the minimum value from track residuals is about 125 @xmath83 m . for",
    "the cst the intrinsic point resolution of 15 @xmath83 m from hits overlaps is also reached globally .",
    "figure [ fig : mille2 ] shows the improvement for track parameters , determined from data in the comparison of parameters between the two parts of cosmic tracks .",
    "a significant improvement is visible for larger track momenta . in table",
    "[ tab : sigmas ] the standard deviations in the parameters @xmath85 and @xmath86 , determined from the difference between the two parts of cosmic tracks , are given for three different track classes .",
    "we would like to thank the organizers of the conference on advanced statistical techniques in particle physics for their hospitality and the stimulating atmosphere in durham .    9 v. blobel and e. lohrmann , statistische und numerische methoden der datenanalyse , teubner , stuttgart und leipzig ( 1998 ) a program description for * millepede * and the code is available via ` http://www.desy.de/~blobel/ ` .",
    "schreiber , o. ( 1877 ) : rechnungsvorschriften fr die trigonometrische abteilung der landesaufnahme , ausgleichung und berechnung der triangulation zweiter ordnung .",
    "handwritten notes . mentioned in w. jordan ( 1910 ) : handbuch der vermessungskunde , sechste erw .",
    "auflage , band i ,  iii : 429 - 433 .",
    "j.b.metzler , stuttgart .",
    "h1 collaboration , the h1-detector at hera , nucl .",
    "* a386 * , 310  396 ( 1997 ) d. pitzl et al . , the h1 silicon vertex detector , nucl .",
    "instrum . meth .",
    ", * a454 * , 334  349 ( 2000 )"
  ],
  "abstract_text": [
    "<S> track detectors in high energy physics experiments require an accurate determination of a large number of alignment parameters . a general method has been developed , which allows the determination of up to several thousand alignment parameters in a simultaneous linear least squares fit of an arbitrary number of tracks . </S>",
    "<S> the sensitivity of the method is demonstrated in an example of the simultaneous alignment of a 56-plane drift chamber and a 2-plane silicon tracker . </S>",
    "<S> about 1400 alignment parameters are determined in a fit of about fifty thousand tracks . </S>"
  ]
}