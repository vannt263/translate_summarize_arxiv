{
  "article_text": [
    "dissipationless cosmological @xmath0-body simulations aim to reproduce the clustering of dark matter in the universe , assumed to be in the form of a microscopic particle with extremely weak non - gravitational interactions ( for reviews see e.g. @xcite ) . in the absence of an analytical treatment of the strongly non - linear regime",
    ", these simulations have become increasingly central in extrapolating the predictions of the current `` standard model '' of cosmology to the corresponding scales .",
    "many kinds of observations now probe directly or indirectly the distribution of dark matter at these scales , and will do so with greater precision in the coming years .",
    "the resultant need for precision in the theoretical results makes more necessary than ever a better understanding of these simulations .",
    "this paper concerns one potentially important source of error which is currently still poorly understood : rather than evolving numerically the theoretical vlasov - poisson equations describing the self - gravitating dark matter , simulations employ the @xmath0-body method in which the matter is sampled by `` macro - particles '' . the errors introduced , i.e. , the difference between the results of the finite @xmath0 simulation and those in the theoretical model ( which corresponds to an appropriate @xmath1 limit ) , are not understood .",
    "this is the discreteness problem in cosmological @xmath0-body simulation .",
    "it is a problem which has received , given its potential importance , a very modest amount of attention ( see references below ) .",
    "further the existing literature on the issue is marked by a considerable diversity in its conclusions , both qualitatively _ and _ quantitatively . given the ever more pressing need for robust control on the very considerable precision required of simulations",
    " a goal of one percent precision is now typically considered ( see e.g. @xcite )  it is an issue which deserves attention .    in this paper",
    "we first give a brief review of the problem of discreteness in cosmological @xmath0-body simulation .",
    "we both describe briefly previous work by other authors on the issue , as well as some recent work by ourselves and our collaborators , in which we have developed new analytical approaches to describe discreteness effects both in the initial conditions of simulations and in their early time evolution . as a starting point",
    "we attempt here to give a precise explicit formulation of the problem of discreteness .",
    "this distinguishes notably the problem from strictly numerical issues ( e.g. about the agreement of codes using different summation techniques ) .",
    "we emphasize in particular the necessity to establish , before any discussion about the quantification of errors , precisely how numerical simulations should be extrapolated to approach the desired theoretical limit .",
    "our conclusion is simply that an appropriate such extrapolation is one which takes the interparticle spacing @xmath2 to zero , _ at fixed values of the other relevant discreteness parameters_. further such extrapolation should be done keeping fixed the initial conditions , which  given that simulations are performed in a finite periodic system  means using the same realization ( and modes ) of the initial theoretical power spectrum .",
    "after this introductory discussion we turn to a numerical and analytical study of the issue .",
    "the goal of this study is to answer the more practical question of _ how small _ the interparticle distance @xmath2 must be to attain convergence of physically relevant quantities to a desired precision .",
    "in particular we focus on the issue , which is at the centre of some controversy in the literature , of the accuracy of results , at scales around and below the initial interparticle distance , of simulations which use a force smoothing scale smaller than this latter scale . to attempt to resolve the question we use here a simple numerical method to isolate errors which manifestly must arise from discreteness , and which therefore give a lower bound on the discreteness errors .",
    "we focus here on the two point correlation properties of clustering , but the method we use can be extended to any other quantity ( e.g. mass function , merger rates ) .",
    "the essential difference between our study and the few previous such attempts of this kind ( see references below ) is that we use , as mentioned above , also an analytical formalism which describes fully the measured discreteness effects at sufficiently early times .",
    "this allows us to `` calibrate '' the errors , in the sense that it allows us to establish without doubt that the measured quantities arise from physical discreteness effects , and not from the other possible sources of dispersion in our results ( poor numerical convergence , or finite size effects ) .",
    "we then study the further evolution of these errors into the non - linear regime , allowing us to place with confidence a lower bound on the true discreteness error in this regime .    more specifically our tests , and principal conclusions , are as follows .",
    "we consider @xmath0-body simulations in an eds universe of identical theoretical initial conditions , given by a random gaussian realization of a power spectrum @xmath3 . in our central test",
    "the simulations differ only in the choice of `` pre - initial '' configuration , i.e. , the point distribution chosen to represent the uniform universe prior to the application of the perturbations corresponding to the given theoretical initial conditions .",
    "the canonical choices in the literature are `` grid '' ( a simple cubic lattice ) , or `` glass '' @xcite . here",
    "we consider a wider class of such configurations , employing also two different bravais lattice configurations ( body - centred cubic and face - centred cubic ) .",
    "the reason for our choice of these configurations is that they allow us to apply in a very powerful way our analytical treatment .",
    "this formalism gives a very accurate description for the early time evolution of simulations starting , in principle , from any perturbed bravais lattice .",
    "the differences in the evolved power spectra , starting from the same realization of the theoretical model discretised on these different distributions , measured in our simulations are in extremely good agreement with these analytical predictions for _ all wavenumbers _ at early times , and progressively deteriorates , as anticipated , as we go into the strongly non - linear regime . in this latter regime",
    "we observe that these differences show similar dependences on the discreteness parameters as in the regime where we can fit them analytically .",
    "notably at a given physical scale , they decrease as @xmath2 decreases , and increase monotonically as a function of time at fixed @xmath2 .",
    "these tests give us a robust non - trivial lower bound on the size of systematic discreteness errors .",
    "for the power spectrum , which is the quantity we focus on , these lower bounds are of order a few percent for wavenumbers comparable to and larger than the nyquist frequency for a starting red - shift equal to @xmath4 , and then decrease monotonically at smaller wavenumbers . while the precise bounds for any given cosmological model ( and choice of other relevant simulation parameters ) will differ , they will be of this order ( or larger , as the bounds monotonically increase with the starting redshift ) .",
    "our results allow us then to draw conclusions about the question of how far @xmath2 must be extrapolated to attain errors smaller than of this order .",
    "specifically we conclude that the common practice of using results considerably below the scale @xmath2 ( or @xmath5 in reciprocal space ) _ may _ be justified , but only with a discreteness error bar which is , for the power spectrum , and for normalisations typical of cosmological simulations , of order of these lower bounds , i.e. , several percent .",
    "precision greater than this for a given wavenumber @xmath6 , e.g. , down to below the one percent level for the power spectrum now often cited as necessary , can be achieved only by using particle densities such that @xmath7 .",
    "indeed results of simulations do not converge to the continuum limit until this parameter range is reached , and thus one can not have real confidence in results without performing such an extrapolation .",
    "while this conclusion has been argued for in several studies by some authors ( see references and discussion below ) , it is a much more stringent requirement than that assumed in much of the literature , and formulates a considerable challenge to simulation .",
    "the problem of discreteness in cosmological simulation arises from the fact that the numerical simulations are not a direct discretisation of the equations of motion of the theoretical model .",
    "the latter is ( usually ) assumed to be described , on the physical scales of relevance , by vlasov - poisson ( vp ) equations ( or `` collisionless boltzmann equations '' ) which give the evolution of the ( smooth ) phase space mass density .",
    "@xmath0-body simulations , on the other hand , are numerical integrations of the equations of motion of @xmath0 self - gravitating particles , i.e. , [ nbody - eom ] _ i + 2 _ i = -_ji w_(|_i-_j| ) where dots denote derivatives with respect to time , @xmath8 is the mass of the particles , @xmath9 is the ( comoving ) position of the @xmath10-th particle , and @xmath11 is a function which regularizes the divergence in the gravitational force at @xmath12 below a characteristic scale @xmath13 .",
    "these unphysical `` macro - particles '' are artefacts of the @xmath0-body simulation technique , with a mass many orders of magnitude ( typically @xmath14 ) larger than those of the theoretical dark matter particles .    as the vp equations may , in principle , be obtained as an appropriate @xmath1 limit of the particle system , the problem of discreteness is in practice that of determining the discrepancy between the solution of the @xmath0-body equations for some finite @xmath0 and their solution for a much much larger @xmath0 , representative of the vp limit .",
    "it is therefore evidently essential to specify precisely how to extrapolate cosmological @xmath0-body simulations to this limit .",
    "this is the point we first discuss .      in the case of the @xmath0-body method employed to solve the cosmological problem ,",
    "the unphysical parameters characterising the numerical solution can be clearly divided into two .",
    "firstly there are those required , _ in addition to the parameters of the input theoretical model _ , to characterise the equations ( [ nbody - eom ] ) and their initial conditions .",
    "secondly there are the parameters introduced to then solve these well posed equations numerically ( e.g. time step , parameters controlling the precision of the calculation of the force ) .",
    "it is only the former , which we will refer to as the _ discreteness parameters _ and denote by @xmath15 , which are the subject of study here .",
    "the latter set of parameters , which we will refer to as the _ numerical parameters _ of a simulation , control the accuracy with which the set of equations ( [ nbody - eom ] ) , with well defined initial conditions , are solved .",
    "they therefore have no relevance to the problem of discreteness which we are focussing on : we wish to understand the relation between the results of a `` perfect '' @xmath0-body simulation , i.e. , an arbitrarily precise numerical solution of the equations ( [ nbody - eom ] ) from well specified initial conditions , and the evolution of the theoretical model from its corresponding initial conditions .",
    "the set of discreteness parameters @xmath15 we consider is the following :    * \\1 .",
    "the mass of the macro - particles ( referred to as _ mass resolution _ in the literature ) , or equivalently ( since the mean mass density is specified ) their mean ( comoving ) number density @xmath16 .",
    "we will parametrize this by @xmath17 , which we refer to as the _ mean interparticle spacing_. * \\2 .",
    "the _ smoothing parameter _ @xmath13 characterising the regularisation of the force ( known as the _ force resolution _ in the literature ) .",
    "the _ pre - initial configuration _ , i.e. , choice of grid , glass , or other distribution .",
    "we will denote this discrete variable @xmath18 .",
    "the _ initial red - shift _ , @xmath19 .",
    "some remarks on this list are appropriate :    * discreteness effects depend on the number of particles @xmath0 used in a simulation only through the _ density _ of these particles .",
    "change in results when @xmath0 varies , at fixed @xmath2 , is _ not _ a discreteness effect : to pass from the vp equations to the @xmath0-body equations ( [ nbody - eom ] ) , and their initial conditions , we do not need to introduce the side @xmath20 of the cubic box ( which , with periodic replicas , is canonically used to approximate the infinite universe ) as both sets of equations are well defined in infinite space .",
    "the box size @xmath20 thus belongs to the second set of parameters , as it is introduced to solve the eqs .",
    "( [ nbody - eom ] ) in a ( finite ) numerical simulation .",
    "the dependences on it , i.e. on the variation of @xmath0 at fixed particle density , are _ finite - size effects_. we do not study these effects here , and will always work at fixed @xmath20 in our numerical study below .",
    "for studies of them see e.g. @xcite . *",
    "the smoothing parameter @xmath13 , on the other hand , can not , in modern cosmological simulation , be considered as belonging to the numerical parameters : it is not , in this context , a parameter introduced to facilitate the numerical solution ) may be solved numerically without any such smoothing ( and often are in other contexts e.g. galactic dynamics ) . ] .",
    "rather , as we will discuss further below , it is used with the aim of reducing effects of two - body collisionality , i.e. , to try to make the @xmath0-body solution approach better the theoretical collisionless behaviour corresponding to the vp equations . *",
    "that the initial red - shift @xmath19 is a discreteness parameter in the sense we have defined above has been shown explicitly in @xcite ( and summarised also briefly in sect .",
    "[ plt - summary ] below ) . put simply , the treatment of the evolution of eqs .",
    "( [ nbody - eom ] ) in this work shows , analytically , that the initial conditions for the @xmath0-body system derived for a given input power spectrum ( ps ) at a redshift @xmath21 ( using the canonical method based on the zeldovich approximation ) , do not evolve exactly under eqs .",
    "( [ nbody - eom ] ) to those set up from the same ps at a different red - shift @xmath22 .",
    "this is true _ in the limit of arbitrarily small initial relative displacements to the lattice _ where non - linear ( fluid ) corrections to the zeldovich approximation can be neglected .",
    "this list of discreteness parameters is a minimal one , appropriate for , say , a standard @xmath23 type code . even in this case",
    "it could be elaborated to be more precise .",
    "for example , the regularisation involves the choice of a function which is not always the same , and @xmath13 can vary in time .",
    "different choices of the sampled modes may also be made in setting up initial conditions .",
    "the list is adequate also for a simple @xmath24 code , but evidently it would need to be expanded to describe adaptive codes in which the particle number changes in time and space according to some criteria .",
    "we will not consider such complexities here , apart from a few further comments on this point in our conclusions : it is sufficiently ambitious to hope , at least as a first step , to control fully the effects of discreteness for these simpler cases .",
    "let us now denote by @xmath25 the measured value of any physically relevant quantity in an @xmath0-body simulation , at red - shift @xmath26 , with values of the discreteness parameters @xmath27 , e.g. , a two point correlation function or a ps ( where the variable @xmath28 is given the appropriate interpretation , and could equally well represent a set of vector separations for a higher order statistic ) .",
    "the discreteness problem can be schematically represented then as that of determining an estimate of the difference ( r , z ; \\",
    "{ d _ } ) ( r , z ; \\",
    "{ d _ } ) - q_vp ( r , z ) where @xmath25 is the result of a `` perfect '' @xmath0-body simulation , and @xmath29 is the result of the same quantity in the vp equations evolved from the same initial conditions",
    ".    by construction @xmath29 is , in general , unknown .",
    "indeed it is because we can not determine it analytically that we turn to @xmath0-body simulation . to estimate @xmath30",
    "the best one can do is thus to study , numerically , the convergence of @xmath25 towards some fixed value as the @xmath31 are appropriately extrapolated .",
    "if the goal is to approach as closely as possible the evolution of the vp equations , one should evidently extrapolate the relevant parameters in a way which indeed gives convergence to this limit of the @xmath0-body system .",
    "while it is evident that the interparticle distance @xmath2 should be decreased , how the other parameters should be varied ( or not ) is not . indeed , as we will discuss further in our conclusions , most of the few convergence studies of cosmological simulations in the literature do not adopt an extrapolation which converges directly to the vp limit .",
    "there is in fact no rigorous treatment in the literature on cosmological @xmath0-body simulations , or more broadly in the cosmology literature , establishing the existence of the vp limit : derivations of the vp equations ( see e.g. @xcite ) are limited to showing that these equations may be obtained by a truncation to the leading term of a bbgky hierarchy of equations , but do not rigorously establish the conditions under which the required truncation may be made .",
    "formal proofs establishing the validity of the vlasov mean field approximation for long - range interacting systems can , however , be found in the mathematical physics literature ( for a discussion see e.g. @xcite ) .",
    "notably @xcite have proved that in a _",
    "finite _ system of particles interacting through @xmath32 pair forces , _ regularized _ so that the potential is bounded below at @xmath33 , the vlasov limit corresponds to @xmath1 . in taking this limit the volume , mass and time of evolution",
    "are kept fixed for gravity , where @xmath8 is the particle mass ) scales in proportion to @xmath34 . ] .",
    "we will assume , without rigorous proof , the evident extension of this result to the infinite volume case of cosmological simulations : we take the vp limit as @xmath35 ( i.e. particle number in any finite volume goes to infinity ) at fixed mass density , _ followed by _",
    "@xmath36 has not in fact been proven .",
    "we neglect this mathematical subtlety here , which one would expect to be relevant , at most , to the asymptotically long time behaviour of the system ( which does not interest us in this context ) ] .",
    "the convergence at fixed temporal duration corresponds to keeping also the initial red - shift @xmath19 fixed , and as the limit should clearly not depend on @xmath18 ( the choice of pre - initial configuration ) , we also keep this fixed .    in summary ,",
    "applied to an @xmath0-body simulation , this tells us that _ an _ appropriate extrapolation is given by _ decreasing @xmath2 ( i.e. increasing the particle density ) while keeping the other discreteness parameters @xmath15 fixed_. the limit is taken at _ fixed _",
    "@xmath37 , which means that the spatial resolution ( for unsmoothed gravity ) is limited to above this scale .",
    "in other words this extrapolation converges to a smoothed version of the vp equations , which then ( we assume ) would converge to vp as @xmath36 .",
    "this extrapolation is not necessarily unique  convergence may in principle be obtained while allowing @xmath19 and/or @xmath13 to vary in various manners as a function of @xmath2  but it is certainly simple .",
    "the use of any alternative ( _ if _ , we emphasize , the goal is to obtain direct convergence to the vp limit ) should , however , be carefully considered to establish ( at least as rigorously as here ) that it gives convergence to the vp limit .",
    "it is important to note the specific order of the limits in @xmath2 and @xmath13 . beyond the necessity to introduce a regularisation in rigorous proofs of the vp limit mentioned above",
    ", the reason for this can be understood easily on physical grounds : the scale @xmath38 provides a characteristic scale which is clearly necessary to give physical significance to the limit @xmath35 . indeed taking @xmath39 and initial conditions specified by a pure power law input ps , @xmath2 is the sole characteristic scale of the discrete system ( in the limit @xmath40 ) , and defines itself the unit of length .",
    "varying @xmath2 gives , up to a trivial rescaling , a system with exactly the same dynamics , which is manifestly not that of the vp limit ( as it includes explicitly non - mean field effects such as two body collisionality ) .",
    "when , on the other hand , the same system is treated , but now with @xmath41 , the limit @xmath35 has a non - trivial meaning if it is taken at constant @xmath42 .",
    "indeed non mean - field effects such as two body scattering , and other ones we will describe below , are explicitly no longer present in the dynamics in this limit .",
    "finally we make one important remark about initial conditions . evidently to establish convergence to the evolution of a given continuum model",
    ", one should keep the initial conditions in this limit fixed . while we have stated explicitly that , in extrapolating , the initial redshift @xmath19 should be held fixed , this does not prescribe unambiguously the initial conditions at any finite @xmath2 : given that simulations are performed in a finite volume , the number of modes in any interval of wavenumber is finite , and thus different realizations of the same initial conditions introduce intrinsic statistical fluctuations in the initial conditions compared to the average theoretical behaviour . for convergence studies of discreteness effects",
    "specifically it is simplest to keep also the realization fixed , although of course such effects can in principle be averaged out by a sufficiently large number of realizations , one needs to specify whether power should be added ( if present in the theoretical model ) in the larger range of wavenumbers which can be sampled in the initial conditions as @xmath2 decreases . while this is not the source of ambiguity in our extrapolation ( as power",
    "should evidently not be added in the range that @xmath43 ) , for studies in the range @xmath44 , such as that we will report below , it is relevant .",
    "we will use the prescription that the realization of the input displacement field is kept fixed , as this allows us most clearly to identify effects of discreteness . ] .      while the above discussion simply tells us how to extrapolate towards the vp limit , the practical form of the discreteness problem is more detailed : _",
    "how small do we need @xmath2 to be , given certain fixed values of other parameters in the set @xmath45 , to attain a desired precision @xmath46 on the theoretical quantity @xmath47 ? _",
    "current practice in interpreting the results of cosmological simulations appears to repose on an approximate answer to this question , which we now attempt to summarize ( see e.g. @xcite ) .",
    "it is supposed that there are essentially two ways in which discreteness can play a significant role in making an @xmath0-body simulation deviate from the desired vp evolution :    * d1 . through the _ limits placed on the accurate representation of the initial conditions_. indeed , to avoid aliasing effects , only modes of the input theoretical ps up to the nyquist frequency @xmath48 should be sampled . unless @xmath49 this means that there is `` missing power '' . in simulations of cdm type models ,",
    "notably , this is always the case .",
    "further , for _ any _ initial ps , there is always additional power in the initial conditions , predominantly at @xmath50 , generated purely by the discretisation . in a glass",
    "there is also a contribution , @xmath51 at small @xmath6 , for @xmath52 . ] .",
    "* d2 . through",
    "_ two body collisions in the course of the dynamical evolution _ which cause deviations from the desired mean field behaviour of the vp limit .",
    "the first point is believed not to place , in practice , an important limitation on the accuracy of simulations once they are evolved .",
    "the reason is that gravitational clustering , from cdm cosmological initial conditions , is understood to develop essentially by the transfer of power from large to small scales , non - linear structures being formed by the evolution of fluctuations at initially larger scales .",
    "the spatial resolution thus improves rapidly as time goes on , essentially following the forming non - linear structures which depend only on the presence of the initial fluctuations which seeded them .",
    "small residual effects are envisaged , arising from the `` spurious '' power generated by the sampling on a specific pre - initial configuration ( grid or glass ) , but they are usually assumed to be negligible and of no practical importance .",
    "an exception is in the case of hot ( or warm ) dark matter spectra . in this case one",
    "may have @xmath49 so that all the initial power is well represented , but the small scale power generated by discreteness can evolve to form structures which may not be `` wiped out '' sufficiently rapidly by the structures forming at larger scales .",
    "recently interest in this case has been regenerated in the context of simulation of `` warm dark matter '' models , and it has been shown explicitly in numerical studies @xcite , using different @xmath18 ( grid or glass ) that such effects may be important , leading to gross discreteness effects in such simulations .",
    "the effects of two body collisionality ( d2 ) are understood to be taken care of by the smoothing @xmath13 .",
    "indeed it is explicitly for this reason that such a smoothing is introduced , its value being chosen ideally large enough to suppress the related effects , but small enough so that too much spatial resolution is not lost .",
    "since , according to simple estimates @xcite , one expects such effects to be largest in regions of highest density , @xmath53 is chosen just large enough to suppress them , over the relevant cosmological time scales , in such regions .    in summary",
    ", these physical arguments may be formulated as qualitative answers to the question posed above , as follows . for typical quantities measured in simulations ( e.g. two point correlation function , ps , halo masses and profiles ) , the errors @xmath46 due to discreteness , for any @xmath28 a little larger than @xmath13 are negligible , i.e. , so small as to be of no practical interest ( compared to attainable numerical errors , notably ) , if :    * a1 .",
    "@xmath2 is sufficiently small so that , at red - shift @xmath26 , the fluctuations at scale @xmath28 may be formed by the collapse of fluctuations initially at scales @xmath54 . *",
    "@xmath2 is sufficiently small so that the collisional relaxation time scale in the densest resolved regions ( i.e. the highest density in a region of radius @xmath55 ) is large compared to the age of the universe .",
    "both of the answers can be converted , by making use of known phenomenological models describing the results of simulations ( notably halo models , or the model of @xcite ) , into approximate criterion for the necessary @xmath2 ( i.e. particle density ) expressed in terms of the parameters of the theoretical model , and the scales @xmath28 and @xmath13 , and of the red - shift @xmath26 . in @xcite",
    "one can find , for example , approximate criteria derived using halo models , while @xcite , @xcite and @xcite present extensive numerical studies - body equation . thus particle density and the smoothing @xmath13 are considered on the same footing as choice of time step , and parameters for force precision etc .. the sets of simulations studied do not in fact define a convergence study to the vp limit , as we have discussed above : power is added as the particle density is increased , and the initial red - shift also changes .",
    "we will return to this point in our conclusions . ] .",
    "a series of other articles focus specifically on the effects of two body relaxation in placing limits on the accuracy of density profiles in halos , using mostly numerical approaches ( @xcite , @xcite , @xcite ) .",
    "a recent paper by @xcite concludes , on the basis of some simple numerical tests on different theoretical initial conditions , that discreteness effects may be neglected once the non - linearity scale has evolved to be larger than the mean interparticle separation .",
    "while these answers may be correct , they are certainly not in any way rigorous .",
    "the essential problem is that they _",
    "assume that the physical effects of discreteness are known _ , or , at least , that those which play any significant role in simulations are known . while the latter may a posteriori prove to be true , the former certainly is not .",
    "indeed understanding of the role of discreteness in the highly non - linear evolution of these systems is extremely limited .",
    "one of the surprising aspects , at least at first sight , of the standard criteria just discussed is that they allow the resolution scale of a simulation ( at @xmath56 ) to be very much smaller than the scale @xmath2 . indeed in practice the spatial resolution is usually taken to be fixed by @xmath13 , with @xmath57 .. ] if one considers that this smoothing is introduced to make the `` macro - particles '' behave like fluid elements , moving under the effect of the mean field , it would appear to be necessary to have , at least , @xmath58 .",
    "this point has been forcefully argued by melott et al . in a series of papers during the nineties @xcite , and",
    "restated in a recent comment @xcite . in @xcite , @xcite and @xcite",
    "specific non - vlasov effects are explicitly shown to be present in numerical experiments , and of much greater importance once the regime @xmath59 is attained .",
    "one of the few controlled studies of the issue of discreteness in the literature in a spirit resembling that advocated above is given in @xcite .",
    "the paper focuses on the difference between results of simulation using @xmath24 codes and @xmath23 codes at different resolutions .",
    "its conclusion is that results of the latter codes in the regime @xmath59 , _ do not _ agree well , most notably for phase sensitive statistics , with those obtained from higher resolution @xmath24 codes ( for which @xmath60 ) .",
    "these results , which place a question mark over the reliability of results below the scale @xmath2 , have been largely ignored and addressed only very incompletely in subsequent works ( see , notably , @xcite ) which support , broadly , the `` common wisdom '' which we have outlined above .",
    "the common wisdom has also been questioned by several other groups of authors ( @xcite ) , all placing in question ( like melott et al . )",
    "the use of a smoothing @xmath59 on the basis of numerical results .",
    "in particular we note that the role played by interactions of particles with their nearest neighbours  which give physical effects clearly not representative of the mean field vlasov - poisson limit  in the evolution of clustering at early times in simulations has been highlighted in cosmological simulations in @xcite , and in a simplified class of gravitational n - body simulations in @xcite . in a very recent study",
    "@xcite conclude , on the basis of a study using wavelet techniques to analyse a set of @xmath61cdm simulations , also that results below the scale @xmath2 are unreliable .",
    "we note also the discussion of discreteness effects in @xcite , which illustrates with a study of a one - dimensional sheet model that discreteness may induce effects prior to virialisation ( and distinct from two body effects ) by artificially bounding above the growth of the phase space density .      in recent work by ourselves and",
    "our collaborators @xcite , we have used a perturbative treatment of cosmological @xmath0-body simulations to treat discreteness effects analytically . while the method is limited by its range of application ( to sufficiently early times ) it has the advantage of providing an exact quantification of these effects in that range , as well as an understanding of the physical mechanism at play . in this section",
    "we will briefly review this formalism , which we will employ in the next section in the analysis of our numerical results .",
    "the treatment can be understood as a generalization to discrete distributions of the standard linearization of the equations of a self - gravitating fluid , in the lagrangian formalism ( see e.g. @xcite ) . at linear order",
    "we thus refer to it as `` particle linear theory '' ( plt ) .",
    "the full details can be found in these publications , and we will limit ourselves to a short summary of the essential idea , and the salient results . we note that while @xcite presents the details of the use of plt to quantify discreteness effects in the usual case of a simple cubic ( sc ) lattice as @xmath18 , @xcite develops fully its generalisation to the cases that @xmath18 is a body centred cubic ( bcc ) or face centred cubic ( fcc ) lattice .",
    "we will exploit fully this latter generalisation in the next section .",
    "the principle of this approach is very simple : it consists simply in taylor expanding the force on each particle due to any other in their relative ( vector ) displacement from the lattice configuration . since the force is zero in the unperturbed lattice the force @xmath62 on a particle originally at lattice site @xmath63 can be written , at linear order in the displacements @xmath64 , as ( ) = -_*r* d ( * r*- * r* ) * u*(*r*,t ) , [ linearised - force ] where the sum is over all the lattice sites , and the matrix @xmath65 is _ ( * r * ) & = & gm ( -3 ) + d _ ( * 0*)&= & -_*r * d _ ( * r * ) where @xmath66 is the kronecker delta , and the subscripts are the cartesian indices . with this approximation to the force , the equations of motion for the particles eq .",
    "( [ nbody - eom ] ) may then be written as ( * r*,t ) + 2 h * u*(*r*,t ) = - _ * r* d ( * r*- * r* ) * u*(*r*,t ) .",
    "[ linearised - eom ] defining the discrete fourier transform on the lattice and its inverse by [ def - discreteft ] @xmath67 where the sum in eq .",
    "is over the first brillouin zone ( fbz ) of the lattice , i.e. , the set of @xmath0 non - equivalent reciprocal lattice vectors closest to the origin @xmath68 , where @xmath69 is a vector of integers of which each component @xmath70 ( @xmath71 ) takes all integer values in the range @xmath72 .",
    "see @xcite for the explicit expressions for the fbz vectors of a fcc and bcc lattice .",
    "( [ linearised - eom ] ) can be written in reciprocal space as ( * k*,t ) + 2 h ( t ) * * ( * k*,t ) = - ( * k * ) * u*(*k*,t ) where @xmath73 , the fourier transform ( ft ) of @xmath74 , is a symmetric @xmath75 matrix for each @xmath76 .",
    "the solution of the dynamical problem now reduces simply to the diagonalisation of the @xmath77 , which is straighforward ( and inexpensive ) numerically .. for each @xmath76 this gives three orthonormal eigenvectors @xmath78 and their eigenvalues @xmath79 ( @xmath80 ) .",
    "the evolved displacements from _ any _ initial perturbed lattice configuration , specified at a time @xmath81 , may then be written as [ eigen_evol ] ( , t)=_e^i where the matrix elements of the `` evolution operator '' @xmath82 and @xmath83 are [ evol_operators ] @xmath84 the functions @xmath85 and @xmath86 are linearly independent solutions of the mode equations + 2 h = - f [ mode - equation ] chosen such that @xmath87 , @xmath88 , @xmath89 and @xmath90 .",
    "the expression eq .",
    "( [ eigen_evol ] ) for the evolution is , up to the validity of the linearized approximation to the force , _",
    "exact for the discrete system_. to use it to determine discreteness effects we must , as we have discussed at length in the previous subsections , first identify unambiguously the correct continuum limit , and how it is obtained by extrapolation of the discreteness parameters .",
    "we have shown in @xcite that this may be done straighforwardly directly from eq .",
    "( [ eigen_evol ] ) : taking the limit @xmath35 , this expression for the evolution converges exactly to that obtained @xcite by linearizing the equations for a self - gravitating fluid in the lagrangian formalism , which reduces asymptotically to the zeldovich approximation .",
    "the latter represents the appropriate analogous treatment of the vlasov - poisson limit .",
    "note again that the limit @xmath35 in eq .",
    "( [ eigen_evol ] ) is taken at fixed @xmath81 ( i.e. fixed initial red - shift @xmath19 ) and for a fixed input spectrum of displacements @xmath91 ( and velocities @xmath92 ) .. alternatively , and in line with the general prescription given above , the limit may be recovered with a finite smoothing @xmath13 which is kept fixed as @xmath35 . to do",
    "so one exploits the fact that the plt formalism can be applied to any two body interaction potential , and specifically a softened gravitational potential ( see @xcite for details ) . ]    the differences between the evolution given by eq .",
    "( [ eigen_evol ] ) and this continuum evolution may then be computed exactly for any given initial conditions , yielding the discreteness effects , in the regime of validity of the plt approximation .",
    "in @xcite we have studied the domain of validity of plt numerically for a range of different initial conditions , and conclude that , for some simple statistical quantities , it describes the evolution up to the time when many particles approach their nearest neighbours , which corresponds approximately to shell crossing in the corresponding fluid limit  the plt approximation actually hold for much longer times , apparently following well the evolution of any mode until it goes non - linear . ] . in @xcite",
    "we have presented a quantitative analysis of the discreteness effects in this corresponding regime , for some basic quantities in typical cosmological simulations .",
    "some of the essential results are the following :    * the modification at shell crossing ( up to which the plt treatment described fully the discreteness effects ) of the evolution of any given mode of the displacement field grows monotonically with time . indeed taking the limit @xmath93 at fixed particle density ( i.e fixed @xmath2 ) the evolution of the n - body system _ diverges from the continuum vp limit_. * the modification due to discreteness at shell crossing , for a fixed @xmath19 , depends approximately on the ratio @xmath94 , increasing as @xmath94 does .",
    "this is physically very reasonable : the longer the wavelength of a mode compared to the interparticle scale , the less affected is the evolution by discreteness . for the typical values of @xmath19 in cosmological simulations ,",
    "the effect is typically to reduce the power in modes , by up to about @xmath95 at the nyquist frequency , and by about @xmath96 at half this value .    given this treatment of discreteness effects  exhaustive and analytical , but with a limited domain of validity in time  what can we conclude about the questions raised in the previous subsections ? concerning the formal extrapolation to the vp limit , we have already noted that plt indeed converges to the theoretical vp behaviour when the parameters are extrapolated as prescribed above . with respect to the question of",
    "how far we must extrapolate in @xmath2 in order to converge with some required precision to the vp evolution , the treatment also gives a clear answer , _ at shell crossing_. the answer depends of course on the quantity considered , and then also on @xmath19 and on the cosmological model ( which determined the red - shift of shell crossing given @xmath2 ) . in @xcite we have shown , for example , that , for @xmath19 a factor of five larger than the redshift of shell crossing , errors of five percent in the ps are achieved only for @xmath97 .",
    "thus if we want , at shell crossing , an accuracy of less than this on the power , we can use only results in this range .",
    "this second conclusion is strikingly different from what one might expect given the `` common wisdom '' : the evolution of the simulation makes the range of scale over which the continuum model is accurately represented ( to some given precision ) _ decrease _ , rather than increase .",
    "it in fact suggests that the view that @xmath2 should be a lower limit for spatial resolution may even be too optimistic .",
    "these findings , however , only apply at shell crossing , and the `` common wisdom '' above may still apply later on . indeed , as we described , the justification for this common wisdom is that when the transfer of power , characteristic of gravitational clustering in these systems , sets in , differences at smaller scales are wiped out .",
    "these results at shell - crossing show , however , that between @xmath19 and shell crossing errors develop in the long - wavelength modes ( below @xmath98 ) which were not present in the initial conditions . as a result modes at later time which depend on this power will necessarily inherit this error .",
    "an important point which we emphasize is that the fundamental reason why the discreteness errors determined using plt do not behave as expected by the common wisdom is that _ they arise from physical effects of discreteness which are not usually envisaged_. indeed the physical effects described by plt compared with the vp limit are different from the two effects envisaged usually which we listed above .",
    "firstly , they are _ dynamical _ effects which modify the evolution of any given mode in a way which is independent of the initial conditions .",
    "secondly , they are clearly not two body collisional effects .",
    "the effect they describe can be characterised physically as a _ dynamical sparse sampling effect _ :",
    "plt compared with its vp limit tells us how the evolution of a fluctuation depends on the spatial density of the sampling particles .",
    "an important question is then evidently to understand how this physical effect  which there is no reason to believe should go away when we pass to the non - linear regime quantitatively affects results in the latter regime .",
    "we will return to this point in our conclusions .",
    "we return now to the practical question of how small @xmath2 needs to be for a measured quantity to have converged to a desired precision . since the force smoothing @xmath13 places a lower bound on the spatial resolution ,",
    "a simplified , more specific , form of the question is : _ how small does @xmath2 have to be in order that , at any given red - shift , the effects of discreteness are negligible down to scales of order _",
    "the answer provided by the `` common wisdom '' above is that @xmath2 is sufficiently small , in typical simulations , if @xmath99 is less than about one hundred ( see e.g. @xcite ) . according to the `` dissenting views '' @xmath2 must be at least as small as @xmath13 .    one way to determine , in principle , which view is correct is evidently to compare results from simulations with large @xmath100 in the range @xmath101 with those obtained in much higher resolution simulations , with @xmath102 .",
    "this is indeed the strategy advocated in @xcite , which reports a study of this type down to a resolution @xmath103 .",
    "it concludes , as noted above , that there are significant differences in results , i.e. , no evidence for convergence , in the range @xmath104 .",
    "other authors @xcite argue however that these differences are ascribable to `` erroneous evolution in high resolution runs '' .",
    "the difficulty in reaching a convincing conclusion is that the questions of discreteness effects are intertwined with numerical and finite size effects . while such differences should be resolvable by further numerical tests",
    ", this would require considerable investment of resources which , apparently because of the wide acceptance of the `` common wisdom '' , has not been made .",
    "instead of undertaking such a numerical study  which , given the modest numerical resources at our disposition , would not in any case likely to be any more conclusive than that reported by @xcite  we focus in the rest of this paper on another kind of test .",
    "we will see that this will allow us to reach conclusions , with modest sized ( but very well numerically converged ) simulations , about the central issue : the validity / precision of results in the range of scales around or below @xmath2 , in simulations with @xmath105 .",
    "the aim is to provide a method which gives a non - trivial lower bound on discreteness error in such simulations .",
    "to do so we simply compare the results of simulations from identical theoretical initial conditions , changing only the choice of the discreteness parameter @xmath18 , i.e. , the pre - initial configuration .",
    "we can then study how this error depends on time and scale .",
    "although the measured effects are quite small  at most of order of five percent in the ps for the times and scales relevant to cosmological simulations  we can establish clearly , using the analytical plt formalism combined with numerical tests of their dependence on @xmath2 and @xmath13 , that they are indeed discreteness effects .",
    "we can then address in a controlled way the question of how far @xmath2 needs to be extrapolated so that one can be confident that the true systematic errors due to discreteness have converged to significantly less than this lower bound ( e.g. to less than one per cent ) .    rather than considering a specific cosmological model , we consider a simple power law ps with exponent n=-2 , evolved in an eds universe .",
    "this choice is both suitable for our study as it is simple  introducing no characteristic scale in the input model  and yet close to the currently favoured cdm - like cosmological model , which has an initial ps with effective exponent ranging between @xmath106 and @xmath107 over the relevant range of scales .",
    "in particular we note that this ps is , like these cosmological models , long - wavelength dominated so that the very efficient transfer of power from long to short wavelengths which , as we have discussed above , is believed to play a role in wiping out discreteness effects , should be well represented .",
    "we will comment further in our conclusions on the generalization to other initial conditions , and specifically to those of currently favoured cosmological models .",
    "all our simulations have been performed using the publically available parallel tree - mesh code gadget2 @xcite .",
    "we use this single ( widely used and highly tested ) code for our study for the reasons we discussed above : the discreteness effects we are trying to understand and control for are distinct from differences arising between different codes , and indeed distinct from any dependence of results on the numerical parameters of a given code .",
    "the `` calibration '' of our results with our analytic tools here provide in fact a robust check that the gadget2 code s integration of the @xmath0-body equations of motion is sufficiently precise that this is indeed the case .",
    "comparison with other codes would be , in the relevant regime , a check on the accuracy of these codes , rather than a check on our results . in the regime where our analytic results do not apply",
    ", we can have , of course , less confidence in the identification of our measured effects as physical discreteness effects , and a comparison with other codes could be instructive .",
    "we will address this issue below , where we give details of the detailed checks of numerical convergence of our results which we have performed using gadget2 .",
    "we use the standard method , based on the zeldovich approximation , to set up initial conditions by applying appropriate displacements to four different @xmath18 : a simple cubic ( sc ) lattice , a body centred cubic ( bcc ) lattice , a face centred cubic ( fcc ) lattice , and a glass configuration , shown in fig .  [ unitcells ] .    ,",
    "title=\"fig:\",scaledwidth=15.0% ] , title=\"fig:\",scaledwidth=15.0% ] , title=\"fig:\",scaledwidth=15.0% ]    our reference set of simulations , which we denote s1 , have the number of particles shown in table [ table1 ] .",
    "the numbers for the bcc and fcc configurations have been chosen to be as close as possible to those of the sc and glass configurations , there are two particles per elementary cell of a bcc lattice , four per cell in a fcc lattice .",
    "thus in a cubic box we have @xmath108 in a bcc , @xmath109 in an fcc , lattice , @xmath110 is an integer . ] .",
    "the glass is generated , starting from poisson distributed points with zero velocity , using an option in the gadget2 package which evolves the particles under coulomb forces ( without expansion ) and with a damping implemented by setting the velocities to zero at each time step . in what follows our results",
    "will always be given in _ units of length in which the box size is equal to unity_. in these units the value of @xmath2 in the four different @xmath18 varies by less than one percent .",
    ".number of particles in the four preic of the reference set of simulations s1 [ table1 ] [ cols=\"<,>\",options=\"header \" , ]",
    "the reduced two - point correlation function @xmath111 is defined ( see e.g. @xcite ) as [ xi - full ] ( ) = ( + ) ( ) , where @xmath112 means ensemble average over all the possible realizations of the system . for particle distributions",
    "@xmath111 has a singularity at @xmath113 , and it is therefore convenient to divide it as ( ) = _ d()+ ( ) . where @xmath16 is the mean number density .",
    "the quantity we give results for in the paper , and denote by @xmath114 , is a direct real space angle - averaged estimator of @xmath115 : ( r)+1=_i=1^n_c n_i(r ) , where @xmath116 is the number of particles in the spherical shell of radii @xmath117 , volume @xmath118 , centred on the @xmath119 particle of a subset of @xmath120 particles randomly chosen from the @xmath0 particles of the system .      because we consider distributions with periodic boundary conditions",
    "we can write the density contrast as a fourier series : ( ) = _ ( i ) ( ) with @xmath121 .",
    "the coefficients @xmath122 are given by ( ) = _ v ( ) ( -i)d^3x . the ps is defined as p()= |()|^2 , which we estimate with p(k ) = _",
    "k||k+k |()|^2 where @xmath123 is the number of vectors @xmath124 considered in the sum . to speed up the computation",
    "we perform a sampling at larger @xmath6 on the vectors @xmath124 .",
    "we have checked that our results are robust to this choice ."
  ],
  "abstract_text": [
    "<S> the effects of discreteness arising from the use of the @xmath0-body method on the accuracy of simulations of cosmological structure formation are not currently well understood . in the first part of this paper </S>",
    "<S> we discuss the essential question of how the relevant parameters introduced by this discretisation should be extrapolated in convergence studies if the goal is to recover the vlasov - poisson limit . in the second part of the paper we study numerically , and with analytical methods we have developed recently , the central issue of how finite particle density affects the precision of results above the force smoothing scale . in particular we focus on the precision of results for the power spectrum at wavenumbers around and above the nyquist wavenumber , in simulations in which the force resolution is taken smaller than the initial interparticle spacing . using simulations of identical theoretical initial conditions sampled on four different `` pre - initial '' configurations ( three different bravais lattices , and a glass ) </S>",
    "<S> we obtain a _ lower bound _ on the real discreteness error . with the guidance of our analytical results , which match extremely well this measured dispersion into the weakly non - linear regime , and of further controlled tests for dependences on the relevant discreteness parameters , we establish with confidence that the measured dispersion is not contaminated either by finite box size effects or by subtle numerical effects . </S>",
    "<S> our results show notably that , at wavenumbers _ below _ the nyquist wavenumber , the dispersion increases monotonically in time throughout the simulation , while the same is true above the nyquist wavenumber once non - linearity sets in . for normalizations typical of cosmological simulations , we find lower bounds on errors at the nyquist wavenumber of order of a percent , and larger above this scale . </S>",
    "<S> our main conclusion is that the only way this error may be reduced below these levels at these physical scales , and indeed convergence to the physical limit firmly established , is by extrapolation , at fixed values of the other relevant parameters , to the regime in which the mean comoving interparticle distance becomes less than the force smoothing scale .    </S>",
    "<S> cosmology ; n - body simulation ; discreteness effects </S>"
  ]
}