{
  "article_text": [
    "the study of _ link reciprocity _ in binary directed networks @xcite , or the tendency of vertex pairs to form mutual connections , has received an increasing attention in recent years @xcite . among other things , reciprocity has been shown to be crucial in order to classify @xcite and model @xcite directed networks , understand the effects of network structure on dynamical processes ( e.g. diffusion or percolation processes @xcite ) , explain patterns of growth in out - of - equilibrium networks ( as in the case of the wikipedia @xcite or the world trade web @xcite ) , and study the onset of higher - order structures such as correlations @xcite and triadic motifs @xcite . in networks that aggregate temporal information such as e - mail or phone - call networks",
    ", reciprocity also provides a measure of the simplest _ feed - back _ process occurring in the network , i.e. the tendency of a vertex to _ respond _ to another vertex stimulus .",
    "finally , reciprocity quantifies the information loss determined by projecting a directed network into an undirected one : if the reciprocity of the original network is maximum , the full directed information can be retrieved from the undirected projection ; on the other hand , no reciprocity implies a maximum uncertainty about the directionality of the original links that have been converted into undirected ones @xcite . in particular intermediate cases ,",
    "significant directed information can be retrieved from an undirected projection using the knowledge of reciprocity @xcite . in general , reciprocity is the main quantity characterizing the possible dyadic patterns , i.e. the possible types of connections between two vertices .",
    "while the reciprocity of binary networks has been studied extensively , that of weighted networks has received much less attention @xcite , because of a more complicated phenomenology at the dyadic level . while in a binary graph",
    "it is straightforward to say that a link from vertex @xmath0 to vertex @xmath1 is reciprocated if the link from @xmath1 to @xmath0 is also there , in a weighted network there are clear complications . given a link of weight @xmath2 from vertex @xmath0 to vertex @xmath1 , how can we assess , in terms of the mutual link of weight @xmath3 , whether the interaction is reciprocated ? while @xmath4 ( no link from @xmath1 to @xmath0 ) clearly signals the absence of reciprocation , what about a value @xmath5 but such that @xmath6 ?",
    "this complication has generally led to two approaches to the study of directionality in weighted networks : one assuming ( either explicitly or implicitly ) that perfect reciprocity corresponds to symmetric weights ( @xmath7 ) @xcite , and one looking for deviations from such symmetry by studying net flows ( or imbalances ) , defined as @xmath8 @xcite . in the latter approach , significant information about the original weights , including their reciprocity , is lost : the original network produces the same results as any other network where @xmath9 and @xmath10 .",
    "since @xmath11 is arbitrary , this approach can not distinguish networks that have very different symmetry properties .",
    "in particular , maximally asymmetric ( i.e. @xmath12 , implying @xmath13 whenever @xmath14 ) and maximally symmetric networks ( i.e. @xmath15 , implying @xmath16 ) , which are treated as opposite in the first approach , are indistinguishable in the second one .",
    "consider , for example , two nodes @xmath17 and @xmath18 linked by the asymmetric weights @xmath19 and @xmath20 : the imbalance @xmath21 is the same as if they were an almost symmetric dyad with @xmath22 and @xmath23 .",
    "in addition to the above limitations , it has become increasingly clear that the heterogeneity of vertices , which in weighted networks is primarily reflected into a generally very broad distribution of the _ strength _",
    "( total weight of the links entering or exiting a vertex @xcite ) , must be taken into account in order to build an adequate null model of a network @xcite .",
    "indeed , the different intrinsic tendencies of individual vertices to establish and/or strengthen connections have a strong impact on many other structural properties , and the reciprocity is no exception .",
    "it is therefore important to account for such irreducible heterogeneity by treating local properties such as the strength ( or the degree in the binary case ) as constraints defining a null model for the network @xcite .",
    "while null models of weighted networks are generally computationally demanding @xcite , recently a fast and analytical method providing exact expressions characterizing both binary and weighted networks with constraints has been proposed @xcite .",
    "this allows us , for the first time , to have mathematical expressions characterizing the behaviour of topological properties under the null model considered . in this paper",
    "we extend those results , in order to propose new mathematical definitions of reciprocity in the weighted case and to evaluate their behaviour exactly under various null models that introduce different constraints .",
    "this also allows us to assess whether an observed asymmetry between reciprocal links is consistent with fluctuations around a balanced but noisy average , or whether it a statistically robust signature of imbalance .",
    "finally , we introduce models that successfully reproduce the observed patterns by introducing either a correct global reciprocity level or more stringent constraints on the local reciprocity structure .",
    "we first introduce measures of reciprocity which meet three criteria simultaneously : 1 ) if applied to a binary network , they must reduce to their well - known unweighted counterparts ; 2 ) they must allow a consistent analysis across all structural levels , from dyad - specific through vertex - specific to network - wide ; 3 ) they must have a mathematically controlled behaviour under null models with different constraints , thus disentangling reciprocity from other sources of ( a)symmetry . then , we discuss the differences with respect to other inadequate measures of ` symmetry ' , show our empirical results , and introduce theoretical models aimed at reproducing the reciprocity structure of real weighted networks .",
    "we consider a directed weighted network specified by the weight matrix @xmath24 , where the entry @xmath25 indicates the weight of the directed link from vertex @xmath0 to vertex @xmath1 , including the case @xmath26 indicating the absence of such link . for simplicity , we assume no self - loops ( i.e. @xmath27 @xmath28 ) , as the latter carry no information about reciprocity ( in any case , allowing for self - loops is straightforward in our approach ) . as fig .",
    "1 shows , we can always decompose each pair @xmath29 of reciprocal links into a bidirectional ( fully reciprocated ) interaction , plus a unidirectional ( non reciprocated ) interaction .",
    "and @xmath30 ) into a fully reciprocated component ( @xmath31 ) and a fully non - reciprocated component ( @xmath32 , which implies @xmath33 ) . ]",
    "formally , we can define the _ reciprocated _ weight between @xmath0 and @xmath1 ( the symmetric part ) as @xmath34=w^\\leftrightarrow_{ji } \\label{eq : wlr}\\ ] ] and the _ non - reciprocated weight _ from @xmath0 to @xmath1 ( the asymmetric part ) as @xmath35 note that if @xmath36 then @xmath37 , which makes the unidirectionality manifest .",
    "we can also define @xmath38 as the _ non - reciprocated weight _ from @xmath1 to @xmath0 , and restate the unidirectionality property in terms of the fact that @xmath39 and @xmath40 can not be both nonzero .",
    "thus any dyad @xmath29 can be equivalently decomposed as @xmath41",
    ". if the network is binary , all the above variables are either @xmath42 or @xmath43 and our decomposition coincides with a well studied dyadic decomposition @xcite .      from the above fundamental dyadic quantities it is possible to define reciprocity measures at the more aggregate level of vertices .",
    "we recall that the out- and in - strength of a vertex @xmath0 are defined as the sum of the weights of the out - going and in - coming links respectively : @xmath44 in analogy with the so - called degree sequence in binary networks , we denote the vector of values @xmath45 as the _ out - strength sequence _ , and the vector of values @xmath46 as the _ in - strength sequence_. using eqs.([eq : wlr]-[eq : wl ] ) , we can split the above quantities into their reciprocated and non - reciprocated contributions , as has been proposed for vertex degrees in binary networks @xcite .",
    "we first define the _ reciprocated strength _ @xmath47 which measures the overlap between the in - strength and the out - strength of vertex @xmath0 , i.e. the portion of strength of that vertex which is fully reciprocated by its neighbours .",
    "then we define the _ non - reciprocated out - strength _ as @xmath48 and the _ non - reciprocated in - strength _ as @xmath49 the last two quantities represent the non - reciprocated components of @xmath50 and @xmath51 respectively , i.e. the out - going and in - coming fluxes which exceed the inverse fluxes contributed by the neighbours of vertex @xmath0 .      finally , we introduce weighted measures of reciprocity at the global , network - wide level . recall that the total weight of the network is @xmath52 similarly , we denote the _ total reciprocated weight _ as @xmath53 extending a common definition widely used for binary graphs @xcite , we can then define the _ weighted reciprocity _ of a weighted network as @xmath54 if all fluxes are perfectly reciprocated ( i.e. @xmath55 ) then @xmath56 , whereas in absence of reciprocation ( i.e. @xmath57 ) then @xmath58 . in the appendix we discuss the difference between our definitions and other attempts to characterize the reciprocity of weighted networks @xcite .    just like its binary counterpart , eq.([eq : r ] )",
    "is informative only after a comparison with a null model ( nm ) is made , i.e. with a value @xmath59 expected for a network having some property in common ( e.g. the number of vertices @xmath60 and/or the total weight @xmath24 ) with the observed one . as a consequence ,",
    "networks with different empirical values of such quantities can not be consistently ranked in terms of the measured value of @xmath61 .",
    "an analogous problem is encountered in the binary case @xcite , and has been solved by introducing a transformed quantity that we generalize to the present setting as @xmath62 the sign of @xmath63 is directly informative of an increased , with respect to the null model , tendency to reciprocate ( @xmath64 ) or to avoid reciprocation ( @xmath65 ) .",
    "if @xmath63 is consistent with zero ( within a statistical error that we quantify in the appendix ) , then the observed level of reciprocity is compatible with what merely expected by chance under the null model .",
    "the literature on null models of networks is very vast @xcite . in this paper",
    "we adopt a recent analytical method @xcite and extend it in order to study the reciprocity of weighted networks .",
    "the three null models we consider are described in the methods and appendix .",
    "we stress that the alternative approaches are all based on the assumption that the maximum level of reciprocity corresponds to a symmetric network where @xmath66 , so that deviations from this symmetric situation are interpreted as signatures of incomplete reciprocity .",
    "this is actually incorrect : independently of other properties of the observed network , the symmetry of weights ( i.e. @xmath66 ) is completely uninformative about the reciprocity structure , for two reasons .",
    "first , in networks with broadly distributed strengths ( as in most real - world cases ) the attainable level of symmetry strongly depends on the in- and out - strengths of the end - point vertices : unless @xmath67 for all vertices , it becomes more and more difficult , as the heterogeneity of strengths across vertices increases , to match all the constraints required to ensure that @xmath66 for all pairs . therefore , even networks that maximize the level of reciprocity , given the values of the strengths of all vertices , are in general not symmetric .",
    "on the other hand , in networks with balance of flows at the vertex level ( @xmath67 for all vertices ) an average symmetry of weights ( @xmath68 ) is automatically achieved by pure chance , even without introducing a tendency to reciprocate ( see appendix ) . in many real networks ( including examples we study below ) , the balance of flows at the vertex level",
    "is actually realized , either exactly or approximately , as the result of conservation laws ( e.g. mass or current balance ) . in those cases ,",
    "the symmetry of weights should not be interpreted as a preference for reciprocated interactions .    in the appendix",
    "we also show that measures based on the correlation between @xmath25 and @xmath3 are flawed .",
    "similarly , studies of asymmetry focusing on the differences @xmath8 are severely limited by the fact that the observed imbalances might actually be fluctuations around a zero average ( @xmath69 ) , irrespective of the level of reciprocity .",
    "thus , reciprocity and symmetry are two completely different structural aspects @xcite .    [",
    "cols=\"<,^,^,^,^\",options=\"header \" , ]      we now carry out an empirical analysis of several real weighted networks using our definitions introduced above .",
    "we start with the global quantities @xmath61 and @xmath63 defined in eqs.([eq : r ] ) and ( [ eq : rho ] ) . in table 1",
    "we report the analysis of 70 biological , social and economic networks @xcite .",
    "all networks display a nontrivial weighted reciprocity structure ( i.e. @xmath70 ) , which differs from that predicted by the 3 null models considered ( wcm , bcm and wrg : see methods and appendix ) .",
    "this means that the imposed constraints can not account for the observed reciprocity .",
    "remarkably , we also find that networks of the same type systematically display similar values of @xmath71 : for a given choice of the null model , the resulting reciprocity ranking provides a consistent ( non - overlapping ) classification of networks .",
    "however , different null models provide different estimates of reciprocity and rank the same networks differently . some networks ( social networks",
    "@xcite and the world trade web @xcite ) always show a positive reciprocity , while others ( foodwebs @xcite ) always show a negative reciprocity , irrespective of the null model",
    ". however , other networks ( interbank networks @xcite ) are classified as weakly but positively reciprocal under the wcm , but as strongly negatively reciprocal under the bcm and the wrg . in one case ( neural network @xcite ) , the estimated level of reciprocity can be slightly positive , negative , or even consistent with zero depending on the null model . as a consequence ,",
    "the 5 interbank networks are more reciprocal than the neural network under the wcm , while the ranking is inverted under the bcm and the wrg . since the wcm is the most conservative model , preserving most information from empirical data , we choose to rank the networks in the table using @xmath72 .",
    "importantly , we find that all weighted rankings are quite different from the binary analysis - based ranking @xcite . while the various snapshots of the world trade web are systematically found to be strongly and sometimes almost perfectly reciprocal in the binary case ( @xmath73 under the binary random graph model @xcite ) , here we find them to be less reciprocal than social networks if the additional weighted information is taken into account .",
    "also , while the neural network of _ c. elegans _ has a strong binary reciprocity ( @xmath74 @xcite ) , here we find it to have a very weak ( under the wcm ) , consistent with zero ( under the wrg ) , or even negative ( under the bcm ) weighted reciprocity .",
    "these important differences show that the reciprocity of weighted networks is nontrivial and irreducible to a binary description .",
    "versus out - strength @xmath50 in four weighted networks in increasing order of reciprocity @xmath71 : a ) the everglades marshes foodweb , b ) the neural network of _ c. elegans _ , c ) the world trade web in the year 2000 , and d ) the social network of a fraternity at west virginia college ( note that the increase in reciprocity is not necessarily associated with an increase in symmetry ) . ]",
    "the two differences between the wcm and the wrg ( see methods and appendix ) are node imbalance ( @xmath75 and @xmath76 are equal in the wrg and different in the wcm ) and node heterogeneity ( the expected strenghts of all vertices are equal in the wrg , and broadly distributed in the wcm ) .",
    "we can use the bcm as an intermediate model in order to disentangle the role of these two differences in producing the observed deviations between @xmath72 and @xmath77 .",
    "the bcm preserves node heterogeneity but assumes node balance by regarding the observed difference between the in- and out - strength of each vertex as a statistical fluctuation around a balanced average ( see appendix ) . as we show in fig .",
    "2 , some real networks ( such as foodwebs and the world trade web ) indeed appear to display very small fluctuations around this type of node balance . in foodwebs , where edges represent stationary flows of energy among species ,",
    "the almost perfect balance is due to an approximate biomass or energy conservation at each vertex . in the world trade web , where edges represent the amount of trade among world countries , the approximate balance of vertex flows is due to the fact that countries tend to minimize the difference between their total import and their total exports , i.e. they try to ` balance their payments ' @xcite .    as we show in the appendix , the balance of vertex flows implies that , even without introducing a tendency to reciprocate , the expected mutual weights are equal : @xmath68 .",
    "this implies a larger expected reciprocated weight @xmath78 in the bcm than in the wcm , so that @xmath79 , as confirmed by table 1 .",
    "however , we find that @xmath80 and @xmath77 are always very similar , while they can be very different from @xmath72 .",
    "this means that node imbalances , even when very weak , can have a major effect on the expected level of reciprocity .",
    "surprisingly , we find that this effect is much stronger than that of the strikingly more pronounced node heterogeneity .",
    "correctly filtering out the effects of flux balances or other symmetries can lead to counter - intuitive results : the most reciprocal of the four networks ( the social network , see table 1 ) is one of the least symmetric ones ( see fig .",
    "2d ) , whereas the least reciprocal of the four networks ( the foodweb , see table 1 ) is the most symmetric one ( see fig .",
    "2a ) .",
    "since @xmath71 consistently ranks the reciprocity of networks with different properties , it can also track the evolution of reciprocity in a network that changes over time .",
    "for this reason , in our dataset we have included 53 yearly snapshots of the world trade web , from year 1948 to 2000 @xcite . in fig .",
    "3 we show the evolution of @xmath61 , @xmath81 and @xmath71 under the three null models .",
    "the plots confirm that , unlike @xmath71 , @xmath61 is not an adequate indicator of the evolution of reciprocity , since the baseline expected value @xmath81 ( under every null model ) also changes in time as a sort of moving target ( fig .",
    "( blue ) and its expected values @xmath59 under the weighted configuration model ( red ) , the balanced configuration model ( green ) , and the weighted random graph ( orange ) ; b ) evolution of @xmath63 under the same 3 null models as above . ]",
    "note that @xmath82 fluctuates much more than @xmath83 and @xmath84 , and its fluctuations resemble those of the observed value @xmath61 ( see fig .",
    "this is due to the fact that , while all snapshots of the network are characterized by ` static ' fluctuations of the empirical strengths of vertices around the balanced flux condition @xmath85 ( like those in shown in fig .",
    "2c for the year 2000 ) , these fluctuations have different entities in different years .",
    "changes in the size of ` static ' fluctuations produce the ` temporal ' fluctuations observed in the evolution of @xmath82 , and partly also in the observed value @xmath61 , confirming the important role of node ( im)balances . after controlling for the time - varying entity of node imbalances ( using the wcm ) , we indeed find that the fluctuations of @xmath72 are less pronounced than those of @xmath80 and @xmath77 ( see fig .",
    "3b ) . however , the fluctuations of @xmath61 and @xmath82 do not cancel out completely , and their resulting net effect ( the trend of @xmath72 ) is still significant , indicating the strongest level of reciprocity across the three null models .    while a binary analysis of the wtw @xcite detected an almost monotonic increase of the reciprocity , with a marked acceleration in the 90 s",
    ", we find that the weighted reciprocity has instead undergone a rapid decrease over the same decade : this counter - intuitive result confirms that the information conveyed by a weighted analysis of reciprocity is nontrivial and irreducible to the binary picture .",
    "we now focus on the reciprocity structure at the local level of vertices , i.e. on the reciprocated and non - reciprocated strength @xmath86 , @xmath87 and @xmath88 defined in eqs.([eq : slr]-[eq : sl ] ) . as clear from eq.([eq : wrec ] ) , this allows us to analyse how different vertices contribute to the overall value of @xmath89 and hence to @xmath61 . in order to assess whether the vertex - specific reciprocity structure is significant , rather than merely a consequence of the local topological properties of vertices , we compare the observed value of @xmath86 , @xmath87 and @xmath88 with their expected values under the wcm and the bcm .",
    "unlike the wrg , these models preserve the total strength @xmath90 of each vertex , thus filtering out the effects of the observed heterogenity of vertices . in fig .",
    "4 we show the observed and expected values of the ( non-)reciprocated strength versus the total strength @xmath91 for the four networks already shown in fig . 2 in order of increasing reciprocity .    ) and reciprocated ( @xmath86 ) or non - reciprocated ( @xmath92 ) strength in four weighted networks in increasing order of reciprocity @xmath71 : a ) the everglades marshes foodweb , b ) the neural network of _ c. elegans _ , c ) the world trade web in the year 2000 , and d ) the social network of a fraternity at west virginia college ( black : real data , green : weighted configuration model , red : balanced configuration model ) . ]    for the anti - reciprocal networks with @xmath93 ( the foodweb and , under some null model , the neural network ) , the dominant and less fluctuating contribution to @xmath91 comes from the non - reciprocated strength , and therefore we choose to plot @xmath92 versus @xmath91 ( fig .",
    "conversely , for the positively reciprocal networks with @xmath94 ( the world trade web and the social network ) the dominant contribution comes from the reciprocated strength , so we consider @xmath86 versus @xmath91 ( fig.4c - d ) .",
    "we found very rich and diverse patterns . in all networks",
    ", the selected quantity displays an approximately monotonic increase with @xmath91 .",
    "qualitatively , this increasing trend is also reproduced by the two null models .",
    "however , we systematically find large differences between the latter and real data . in the foodweb ( fig .",
    "4a ) , the observed values of the _ non - reciprocated strength _ @xmath92 are always larger than the expected values ( note that the separation between the two trends is exponentially larger than it appears in a log - log plot ) .",
    "this shows that each vertex contributes , roughly proportionally to its total strength , to the overall anti - reciprocity of this network ( @xmath95 and hence @xmath65 , see table 1 ) .",
    "by contrast , in the neural network ( fig .",
    "4b ) some vertices ( mostly , but not uniquely those with large @xmath91 ) have a larger non - reciprocated strength than expected under the null models , while for other vertices ( mostly those with small @xmath91 ) the opposite is true .",
    "this shows that the weak ( and nearly consistent with zero , see table 1 ) overall reciprocity of this network is the result of several opposite contributions of different vertices , that cancel each other almost completely . the world trade web ( fig .",
    "4c ) also shows a combination of deviations in both directions , even if in this case for the vast majority of vertices the observed _ reciprocated _ strength is larger than the expected one .",
    "this results in the overall positive reciprocity of the network , but again in a such a way that the global information is not reflected equally into the local one . finally , the social network ( fig .",
    "4d ) displays a behaviour analogous , but opposite , to that of the foodweb : the observed _ reciprocated _ strength of each vertex systematically exceeds its expected value and gives a proportional contribution to the overall positive reciprocity .    note that , while the striking similarity between the predictions of the wcm and the bcm in the foodweb and in the world trade web is not surprising , because of the very close node - balance relationship @xmath96 in these two networks ( see fig . 2a and 2c ) , in the neural network and in the social network the similarity between the predictions of the two null models",
    "is nontrivial , since node balance is strongly violated in these cases ( see fig .",
    "2b and 2d ) .",
    "having shown that the reciprocity of real weighted networks is very pronounced , we conclude our study by introducing a class of models aimed at correctly reproducing the observed patterns . to this end , rather than proposing untestable models of network formation , we expand the null models we have considered above by enforcing additional or alternative constraints on the reciprocity structure .",
    "this approach leads us to define the weighted counterparts of the binary exponential random graphs ( or @xmath97 models ) with reciprocity @xcite and their generalizations @xcite .",
    "we first define three models that exactly reproduce , besides the observed heterogeneity of the strength of vertices , the observed global level of reciprocity ( i.e. such that @xmath98 and @xmath99 , implying @xmath100 ) .",
    "our aim is to check whether this is enough in order to reproduce the more detailed , local reciprocity structure .    in the first model ( ` weighted reciprocity model ' ,",
    "see appendix ) , the constraints are @xmath51 and @xmath50 for each vertex ( as in the wcm ) , and additionally @xmath89 .",
    "this model is the analogue of the binary reciprocity model by holland and leinhardt @xcite and replicates the overall reciprocity @xmath61 exactly .",
    "however , as we discuss in the appendix , it is best suited to reproduce networks that are anti - reciprocal or , more precisely , less reciprocal than the wcm ( @xmath101 ) .",
    "therefore , in our analysis we can only apply it to the foodwebs . in fig .",
    "5a we show our results on the everglades web . for the sake of comparison with fig .",
    "4a , we plot @xmath92 as a function of @xmath91 .",
    "we find that , quite surprisingly , the model does not significantly improve the accordance between real and expected trends produced by the wcm and bcm ( see fig.4a ) .",
    "the only difference with respect to the latter is that now a few vertices with very large @xmath91 lie below the expected trend , while all the other vertices continue to lie above it ( fig .",
    "5a ) producing an overall @xmath100 : so , even if all vertices appeared to contribute evenly and proportionally to the global anti - reciprocity ( see fig .",
    "4a ) , adding the latter as an overall constraint is not enough in order to capture the local reciprocity structure .    ) and reciprocated ( @xmath86 ) or non - reciprocated ( @xmath92 ) strength in four weighted networks in increasing order of reciprocity @xmath71 : a ) the everglades marshes foodweb , b ) the neural network of _ c. elegans _ , c ) the world trade web in the year 2000 , and d ) the social network of a fraternity at west virginia college ( black : real data , blue : the weighted reciprocity model , orange : the non - reciprocated strength model , green : the reciprocated strength model ; all such models reproduce the global level of reciprocity but not necessarily the local reciprocity structure ) . ]    in our second model ( ` non - reciprocated strength model ' , see appendix ) , the constraints are @xmath87 , @xmath88 ( for each vertex ) , and @xmath89 .",
    "this slightly relaxed model ( potentially ) generates all levels of reciprocity @xmath61 .",
    "however , it does not automatically reproduce the in- and out - strength sequences , therefore it is only appropriate for networks where @xmath87 and @xmath88 are the dominant contributions to @xmath51 and @xmath50 respectively , so that specifying the former largely specifies the latter as well .",
    "so , even if now there are no mathematical restrictions , this model is again only appropriate for networks with negative reciprocity ( @xmath101 ) . in fig .",
    "5a we show the predictions of this model on the foodweb : note that , as compared to the previous model , now the quantity @xmath92 is exactly reproduced by construction , while @xmath91 is not reproduced , with most vertices lying above the expected trend and a few dominating ones lying below it .",
    "so the result is even worse than before . in fig .",
    "5b we also show the performance of this model on the neural network ( which actually displays @xmath102 , even if it still has negative reciprocity under other null models , see table 1 ) : even if the agreement is now much better , most data continue to lie either above or below the expected curve , confirming that the reciprocated strengths can not be simply reconciled with the total strengths .",
    "note however that for networks with smaller @xmath71 this model becomes more accurate , and in the limit @xmath103 it exactly reproduces all the strength sequences of any network .",
    "our third model ( ` reciprocated strength model ' , see appendix ) is a ` dual ' one appropriate in the opposite regime of strong positive reciprocity ( i.e. @xmath104 , especially in the limit @xmath105 ) .",
    "the constraints are now @xmath86 ( for each vertex ) and the total weight @xmath24 ( note that , as a consequence , also the non - reciprocated total weight @xmath106 is kept fixed ) .",
    "this model is most appropriate for networks where @xmath86 is the dominant contribution to @xmath91 . in fig .",
    "5c we show the predictions of this model on the world trade web .",
    "now @xmath86 is obviously always reproduced , while @xmath91 instead is not reproduced for all vertices . in fig .",
    "5d we show the results for the social network , and in this case we find that the model reproduces real data remarkably well .",
    "this confirms that the model is particularly appropriate for strongly reciprocal networks .",
    "we therefore find that , as in the dual case discussed above , if the overall reciprocity is moderate then the constraints are in general not enough in order to characterize the local reciprocity structure . however , in networks with strong overall reciprocity , this model accurately ( and exactly in the limit @xmath107 ) reproduces all the local reciprocity structure .",
    "the above three models produce the correct level of global reciprocity ( i.e. @xmath108 or @xmath100 ) but not necessarily the correct local reciprocity structure . in networks with strong ( either positive or negative ) reciprocity , the local reciprocity structure",
    "can be simply inferred from the global one , plus some information about the heterogeneity of vertices ( some strength sequence ) .",
    "conversely , in networks with moderate reciprocity the local patterns are irreducible to any overall information , and thus constitute intrinsic heterogeneous features . in this case , it is unavoidable to use a model that fully reproduces the three quantities @xmath87 , @xmath88 and @xmath86 separately for each vertex , by treating them as constraints . in the appendix we describe this model , that we denote as the weighted reciprocated configuration model ( wrcm ) in detail . using this model , all the plots in fig .",
    "5 are automatically reproduced exactly , by construction .",
    "therefore we believe that this model represents an important starting point for future analyses of higher - order topological properties in weighted networks .",
    "in particular , we foresee two main applications .",
    "the first application is to the analysis of weighted ` motifs ' , i.e. the abundances of all topologically distinct subgraphs of three or four vertices @xcite . in the binary case",
    ", it has been realized that such subgraphs are important building blocks of large networks , and that their abundance is not trivially explained in terms of the dyadic structure .",
    "this result can only be obtained by comparing the observed abundances with their expectation values under a null model that separately preserves the number of reciprocated and non - reciprocated ( in - coming and out - going ) links of each vertex . in the weighted case ,",
    "no similar analysis has been carried out so far , because of the lack of an analogous method , like the wrcm defined here , to control for the reciprocated and non - reciprocated connectivity properties separately .",
    "the second application is to the problem of community detection @xcite in weighted directed networks , i.e. the identification of densely connected modules of vertices .",
    "most approaches attempt to find the partition of the network that maximizes the so - called ` modularity ' , i.e. the total difference between the observed weights of intra - community links and their expected values under the wcm . in networks where the observed reciprocity is not reproduced by the wcm ( as all networks in the present study )",
    ", the difference between observed and expected weights is not necessarily due to the presence of community structure , as it also receives a ( potentially strong ) contribution by the reciprocity .",
    "this means that , in order to filter out the effects of reciprocity from community structure , in the modularity function one should replace the expected values under the wcm with the expected values under the wrcm .    the ever - increasing gap between the growth of data about weighted networks and our poor understanding of their dyadic properties led us to propose a rigorous approach to the reciprocity of weighted networks .",
    "we showed that real networks systematically display a rich and diverse reciprocity structure , with several interesting patterns at the global and local level .",
    "we believe that our results form an important starting point to answer many open questions about the effect of reciprocity on higher - order structural properties and on dynamical processes taking place on real weighted networks .",
    "equation ( [ eq : rho ] ) in the results section introduces the quantity @xmath63 , as the normalized difference between the observed value of the weighted reciprocity @xmath61 and its expected value under a chosen null model @xmath59 .",
    "the introduction of @xmath63 has two important consequences .",
    "firstly , networks with different parameters can be ranked from the most to the least reciprocal using the measured value of @xmath63 . secondly , and consequently",
    ", the reciprocity of a network that evolves in time can be tracked dynamically using @xmath63 even if other topological properties of the network change ( as is typically the case ) . clearly , the above considerations apply not only to the global quantity @xmath61 , but also to the edge- and vertex - specific definitions we have introduced in eqs.([eq : wlr]-[eq : wl ] ) and ( [ eq : slr]-[eq : sl ] ) . for this reason , in the appendix we introduce and study three important null models in great detail .",
    "we briefly describe these models below .      to start with",
    ", we consider a network model with the same total weight @xmath24 as the real network but with no tendency towards or against reciprocation , i.e. a directed version of the weighted random graph ( wrg ) model @xcite .",
    "this allows us to quantify for the first time the baseline level of reciprocity @xmath83 expected by chance in a directed network with given total weight .",
    "however , this null model is severely limited by the fact that it is completely homogeneous in two respects ( see the appendix ) : it generates networks where each vertex @xmath0 has the same expected in- and out - strength ( @xmath109 ) , and moreover this value is common to all vertices ( @xmath110 ) .      a popular and more appropriate null model that preserves the observed intrinsic heterogeneity of vertices is one where all vertices have the same in - strength and out - strength as in the real network , i.e. the directed weighted configuration model ( wcm ) @xcite . in such model ,",
    "since @xmath111 and @xmath112 , the two sources of homogeneity characterizing the wrg are both absent : each vertex has different values of the in - strength and out - strength , and these values are also heterogeneously distributed across vertices . in other words , this model preserves the in- and out - strength sequences separately .",
    "another important null model that we introduce here for the first time is one that allows us to conclude whether the observed asymmetry of fluxes is consistent with a fluctuation around a balanced network ( i.e. one where the net flow at each vertex is zero ) .",
    "this model , that we denote as the balanced configuration model ( bcm ) , is somewhat intermediate between the above two models , as it assumes ( like the wrg ) that the expected in- and out - strength of each vertex are the same , i.e. that the two observed values @xmath113 and @xmath114 are fluctuations around a common expected value @xmath115 , but at the same time preserves ( as the wcm ) the strong heterogeneity of vertices ( i.e. in general @xmath116 if @xmath117 ) .",
    "this model preserves the total strength @xmath118 of each vertex , but not the in- and out - strength separately .",
    "+ note that all the above null models preserve the total weight of the original network , i.e. @xmath119 .",
    "however , they do not automatically preserve the reciprocity ( neither locally nor globally ) .",
    "our aim is to understand whether the observed reciprocity can be simply reproduced by one of the null models ( and is therefore trivial ) , or whether it deviates systematically from the null expectations . in the next section",
    "we show that the latter is true , and that the reciprocity structure is a robust and novel pattern characterizing weighted networks .      as we show in the appendix , it is possible to characterize all the above null models analytically , and thus to calculate the required expected values exactly . even if the final expressions are rather simple , their derivation is in some cases quite involved and requires further developments of mathematical results that have appeared relatively recently in the literature @xcite .",
    "moreover , the crucial step that fixes the values of the parameters of all models requires the application of a maximum - likelihood method that has been proposed by two of us only recently @xcite .",
    "it is for the above reasons , we believe , that the reciprocity of weighted networks has not been studied as intensively as its binary counterpart so far . by putting all the pieces together , we are finally able to approach the problem in a consistent and rigorous way .",
    "importantly , the framework wherein our null models are introduced ( maximum - entropy ensembles of weighted networks with given properties ) extends to the weighted case , and at the same time formally unifies , recent randomization approaches proposed by physicists and well - established models of social networks introduced by statisticians , i.e. the so - called exponential random graphs or @xmath97 models ( see the appendix ) .",
    "while a variety of specifications for the latter exist in the binary graph case @xcite , very few results for weighted graphs are available @xcite .",
    "our contribution opens the way for the introduction of more general families of exponential random graphs for weighted networks . indeed , besides the null models discussed above",
    ", we will also introduce the first models that correctly reproduce the observed reciprocity structure , either at the global ( but not necessarily local ) level , or at the local ( and consequently also global ) level .",
    "it is worth mentioning that our approach makes use of exact analytical expressions , and allows to find the correct values of the parameters both in the null models and in the models with reciprocity .",
    "by contrast , the common methods available in social network analysis to estimate binary exponential random graphs rely on approximate techniques such as markov chain monte carlo or pseudo - likelihood approaches @xcite .",
    "another advantage is that the method we employ allows us to obtain the expected value of any topological property mathematically , and in a time as short as that required in order to measure the same property on the original network @xcite . unlike other randomization approaches @xcite",
    ", we do not need to computationally generate several randomized variants of the original network and take ( approximate , and generally biased @xcite ) sample averages over them .",
    "comparing real data with the above null models , and the null models among themselves , allows us to separate different sources of heterogeneity observed in networks .",
    "this is a key step towards understanding the origin of the reciprocity structure of real weighted networks .",
    "d. g. acknowledges support from the dutch econophysics foundation ( stichting econophysics , leiden , the netherlands ) with funds from beneficiaries of duyfken trading knowledge bv , amsterdam , the netherlands .",
    "f. r. acknowledges support from the fessud project on `` financialisation , economy , society and sustainable development '' , seventh framework programme , eu .",
    "before considering the reciprocity of weighted networks , we briefly recall the basic definitions in the binary case , that were originally introduced to describe the mutual relations taking place between vertex pairs @xcite .      for binary ,",
    "directed networks the reciprocity is defined as the fraction of links having a `` partner '' pointing in the opposite direction :    @xmath120    where @xmath121 and @xmath122 .",
    "the above quantity , @xmath123 , is not independent on the link density ( or connectance ) @xmath124 : on the contrary , it can be shown that @xmath125 is the expected value of @xmath123 under the directed random graph model ( drg in what follows ) @xcite . in the drg",
    ", a directed link is placed with probability @xmath126 between any two vertices , i.e. @xmath127 ( with @xmath128 ) .",
    "this implies    @xmath129    showing that the expected value of @xmath123 coincides with the fundamental parameter of this null model , and hence depends on @xmath130 and @xmath60 . in order to assess whether there is positive or negative reciprocity",
    ", one should compare the measured @xmath123 with its expected value @xmath131 .",
    "this means that @xmath123 can not be used to consistently rank networks with different values of @xmath130 and @xmath60 , because they have different reference values .",
    "also , and consequently , @xmath123 can not be used to track the evolution of a network that changes in time , because @xmath130 and/or @xmath60 will also change @xcite .",
    "this is why a different definition of reciprocity was proposed @xcite , trying to control for the time - varying properties by means of the pearson correlation coefficient between the transpose elements of the adjacency matrix @xcite :    @xmath132    a symmetrical adjacency matrix ( as those for binary , undirected networks ) represents a network with the highest values of @xmath123 and @xmath71 ( both equal to 1 ) , whereas a fully asymmetrical one , with @xmath133 values mirroring @xmath134 values on opposite sides of the main diagonal ( like a triangular matrix ) , displays the lowest value , being @xmath135 and @xmath136 ) @xcite .",
    "this meaningful definition of reciprocity automatically discounts density effects , i.e. the expectation value of @xmath123 ( under the drg ) . as a result ,",
    "consistent rankings and temporal analyses become possible in terms of @xmath71 .",
    "in what follows we provide additional information about the possible generalization of the reciprocity to the weighted case .      by looking at eq.([rho ] ) , it is not clear whether a generalization to the weighted case should start from the first term on the left ( i.e. as a correlation coefficient ) or from the last term on the right ( i.e. as the normalized excess from a random expectation ) .",
    "this ambiguity comes from the fact that , for weighted networks , those two terms are no longer equivalent ( as we now show ) .",
    "we therefore start by attempting the first route , and then consider the second one .    if we follow the binary recipe from left to right , we define the weighted reciprocity as the pearson correlation coefficient ( where , as usual , @xmath137 ) .",
    "after some algebra , this implies    @xmath138    where , in order to produce a result formally equivalent to eq.([rho ] ) , we have defined the weighted analogues of @xmath61 and @xmath125 as follows :    @xmath139    note that the equivalence @xmath140 , valid for the binary case , no longer holds : @xmath141 .",
    "the previous expressions generalize the binary ones and reduce to them when substituting the @xmath142 s in place of the @xmath25 s .",
    "moreover , interestingly enough , the coefficient @xmath143 can be expressed as a function of the weights distribution mean , @xmath144 , and standard deviation , @xmath145 , or , in an equivalent way , as a function of the so - called coefficient of variation , @xmath146 , as    @xmath147    we could be tempted to interpret @xmath143 as the weighted counterpart of the binary connectance and , @xmath61 as the weighted counterpart of eq.([r ] ) .",
    "however , we can show a simple case for which the above `` product - over - squares '' definition above fails in measuring our intuitive notion of reciprocity .",
    "let us consider a simple network like that in fig . 1 .",
    "if we calculate @xmath61 by choosing @xmath148 , we obtain    @xmath149    where the sum in the denominator includes all the weights different from the central ones .",
    "now , let us imagine a second situation where @xmath150 ; the calculations , now , would give    @xmath151    and we would intuitively require that @xmath152 , for every choice of the involved weights , because of the greater disparity between the two central flows .",
    "however , it can be shown that under certain circumstances exactly the opposite result is obtained , by simply changing the non - central weights .",
    "in fact , by choosing the latter to satisfy the condition    @xmath153    the very counter - intuitive result @xmath154 is obtained .",
    "this shows that eq.([rhow ] ) is not a good choice for a weighted extension of eq.([rho ] ) .    before considering the alternative route",
    ", we observe that we could also imagine to define a slightly different correlation coefficient , only between the two triangular blocks of the weighted adjacency matrix : the upper - diagonal one and the lower - diagonal one .",
    "this would be defined as    @xmath155    where @xmath156 is the upper - diagonal mean and @xmath157 is the lower - diagonal mean .",
    "again , this definition has an undesirable performance .",
    "this is evident if we imagine a matrix whose transposed entries are defined as @xmath25 and @xmath158 ( with @xmath159 ) . in this case , we would have    @xmath160    independently of the value of @xmath161 !",
    "so we could arbitrarily rise or lower the value of @xmath161 , thus making the matrix more and more asymmetric , without measuring this effect at all .",
    "note that this circumstance is impossible in the binary case , as all weights are forced to be either zero or one , and therefore the only allowed value for @xmath161 is one .",
    "the two examples above show that correlation - based definitions of reciprocity , while having a satisfactory behaviour in the binary case , become problematic in the weighted one .",
    "unfortunately , the few attempts that have been proposed so far in order to characterize the reciprocity of weighted networks @xcite are all based on measures of correlation or symmetry between mutual weights . later",
    ", we show that symmetry - based measures are also flawed . together with our results above",
    ", this means that all the available measures fail in providing a consistent and interpretable characterizaton of the reciprocity of weighted networks .",
    "we now consider the second route , i.e. a definition that starts from generalizing the last term in eq.([rho ] ) .",
    "this means that we are now free to first generalize @xmath61 in a satisfactory way , rather than as a forced effect of the correlation - based definition , and then calculate its expected value under some appropriate null model . to this end , we note that the binary nature of the variables defining @xmath123 allows us to rewrite it in a very suggestive way :    @xmath162}{\\sum_{i\\neq j}a_{ij}}.\\ ] ]    the previous relation is consistent with the intuitive meaning of reciprocity , as a measure of the quantity of mutually - exchanged flux between vertices .",
    "so we can extend this definition to the weighted case , to obtain    @xmath163}{\\sum_{i\\neq j}w_{ij}}. \\label{rmin}\\ ] ]    where we have defined the _",
    "total reciprocated weight _ as @xmath164 $ ] .",
    "this definition does not suffer from the same limitations of the previous one . on the contrary ,",
    "the more the difference between mutual links , the less the reciprocity , because the numerator would not change , while the denominator would become larger .",
    "note that @xmath165 : in fact , since we are considering pairs of nodes at a time , we can rewrite it as    @xmath166+\\min[w_{ij},\\:w_{ji}]\\right)}{\\sum_{i < j}\\left(\\min[w_{ij},\\:w_{ji}]+\\max[w_{ij},\\:w_{ji}]\\right)}. \\label{rmin2}\\ ] ]    another advantage of this second definition is the possibility of mutuating from it the concept of _ reciprocated strength _ in the same way as the concept of reciprocated degree was defined :    @xmath167 \\label{srec}\\ ] ]    so that a very impressive definition of reciprocity can be given , as    @xmath168    a further feature of this quantity is its scale - invariance : if all the weights are multiplied by a scale factor , @xmath169 , @xmath61 does not change , as shown below :    @xmath170}{\\sum_{i\\neq j}\\lambda w_{ij}}=\\frac{\\lambda\\sum_{i\\neq j}\\min[w_{ij},\\:w_{ji}]}{\\lambda\\sum_{i\\neq j}w_{ij}}=r.\\ ] ]    moreover , in the case we had a matrix with transposed entries defined as @xmath25 and @xmath171 ( with @xmath159 ) as in the example considered before , we would find    @xmath172    thus obtaining a continuous function with a global maximum in @xmath173 as it should be ( see fig .",
    "2 ) .     as a function of @xmath161 . ]",
    "it follows that the appropriate weighted generalization of eq.([rho ] ) is    @xmath174    where @xmath61 is defined by eq.([rmin ] ) and its expected value has to be computed according to a chosen null model ( @xmath175 ) .",
    "indeed , this choice also gives us the possibility to choose different null models , and compare their effects on @xmath71 . from @xmath165",
    ", it follows that @xmath176 .",
    "in this section we describe in detail the three null models we considered in order to carry out our analysis .",
    "we adopt the formalism of exponential random graphs or @xmath97 models , which allows to obtain maximally random ensembles of networks with specified constraints .",
    "exponential random graphs were first introduced in social network analysis @xcite and then recently rephrased within a maximum - entropy approach typical of statistical physics @xcite .",
    "we adopt the latter notation , as it is more practical when , rather than approaching the problem using approximate techniques such as markov chain monte carlo or pseudo - likelihood @xcite , one can solve the model analytically and obtain exact results as we do below .",
    "exponential random graphs are very useful when one needs to understand , as in our case , the expected effects of a given set of topological properties , @xmath177 ( such as the total weight , or the strength sequence ) on the structure of networks .",
    "recently , a method based on the maximum - likelihood principle was proposed @xcite in order to fit exponential random graphs to a real - world graph @xmath178 exactly @xcite .",
    "this method provides null models which specify the effects of one or more constraints on the structure of the _ particular _ network @xmath178 , and hence allows to empirically detect patterns in the latter , identified as deviations from the model s predictions @xcite . in the method ,",
    "maximum - entropy exponential random graphs are generated by specifying an ensemble @xmath179 of allowed graphs , and by looking for the probability @xmath180 of generating a single graph @xmath181 in the ensemble in such a way that the shannon entropy    @xmath182    is maximum , under the constraints that the probability is properly normalized , @xmath183 , and that the expected value    @xmath184    of the set @xmath177 of enforced topological properties equals the particular value @xmath185 observed on the real network @xmath178 :    @xmath186    in the above expressions , @xmath187 is a vector of langrange multipliers allowing to tune the value of @xmath188 , and @xmath189 is the specific value of @xmath187 that makes @xmath188 coincide with @xmath190 , as dictated by the maximum - likelihood principle @xcite .",
    "the solution to the above constrained maximization problem is    @xmath191    where    @xmath192",
    "is sometimes called the _ graph hamiltonian _ and",
    "@xmath193    is the _ partition function _ , ensuring that the probability is properly normalized .",
    "the above formal results translate into specific quantitative expectations when a particular choice of the constraints , @xmath177 , is made .",
    "once the numerical values of the lagrange multipliers are found , they can be used to find the ensemble average , @xmath194 , of any topological property @xmath195 of interest :    @xmath196    the exact computation of the expected values can be very diffcult .",
    "for this reason it is often necessary to rest on the linear approximation method even if , in what follows , the only approximation will be that of treating the expected value of a ratio , as the ratio of the expected values : @xmath197 .    the next subsections will be devoted to the description of the null modes used in the main text .",
    "we start with the simplest case , which is the most direct generalization of the binary , undirected random graph ( erds - rnyi ) model . for an ensenble of binary , undirected networks ,",
    "it was shown @xcite that , if the only constraint @xmath198 is the total number @xmath130 of links ( i.e. @xmath199 ) , then the probability @xmath200 coincides with that of the _ erds - rnyi random graph model_. in the latter , each pair of vertices is connected with the same probability @xmath126 , all pairs of vertices being sampled independently of each other . in the framework of exponential random graphs , the probability @xmath126 is simply a function of @xmath201 .",
    "the random graph model has already been generalized to the undirected , weighted case @xcite , by considering an ensemble of networks with non - negative , integer - valued edge weights ( @xmath202 ) and imposing , as the only constraint , the total weight , @xmath203 .",
    "the result is the _ undirected weighted random graph _",
    "model @xcite , where each pair of vertices is still independent as in its binary counterpart , and connected by an edge of weight @xmath204 with probability @xmath205 , where @xmath206 .",
    "here we introduce the directed version of the weighted random graph .",
    "the hamiltonian of the wrg is    @xmath207    thus , the partition function becomes    @xmath208    ( provided that @xmath209 ) , that is a product over the @xmath210 independent random variables , identified with the orderd pairs of the network s @xmath60 nodes .",
    "so , every ( non - negative , integer - valued ) weighted network in the grandcanonical ensemble has the following probability    @xmath211    by defining @xmath206 .",
    "note that this parameter has a precise probabilistic meaning , making even more evident the above prescription , @xmath212 .",
    "in fact , @xmath213 . according to the maximum - likelihood principle @xcite , @xmath126 has to be calculated in terms of the observed quantities , by maximizing the function    @xmath214\\ ] ]    with respect to @xmath201 .",
    "the solution to this optimization problem can be found by isolating @xmath201 in the above equation    @xmath215    and , then , by inverting eq .",
    "[ eq : likwrg ] ( note that the condition expressed by eq .",
    "[ eq : con ] is satisfied because @xmath216 ) :    @xmath217    to calculate @xmath71 we need the expected value of @xmath61 .",
    "looking at its definition , we need the expected value of the minimum between @xmath25 and @xmath3 :    @xmath218\\rangle}{\\langle w\\rangle}.\\ ] ]    by considering that @xmath25 and @xmath3 are independent random variables , the cumulative distribution for the minimum is relatively easy to calculate :    @xmath219\\geq w)=p(w_{ij}\\geq w)p(w_{ji}\\geq w)=p^{w}p^{w};\\ ] ]    from this , it follows that its expected value is    @xmath220\\rangle_{wrg}=\\sum^{+\\infty}_{w=1}{p(\\min[w_{ij},\\:w_{ji } ] \\geq w)}={\\frac{p^2}{1-p^2}}. \\label{eq : expmindwrg}\\ ] ]    now , the expected value ( that is , the ensemble average ) of @xmath61 , computed in correspondence of the maximum - likelihood parameters , can be found by using the result of eq .",
    "[ eq : p * ] :    @xmath221      this second null model is the weighted version of the directed configuration model , fully specified by the in - degree and out - degree sequences @xcite .",
    "the weighted counterparts of these constraints are the in - strength and out - strength sequences @xcite :    @xmath222    the partition function of the wcm is    @xmath223^{-1}\\nonumber\\end{aligned}\\ ] ]    ( where @xmath224 and provided that @xmath225 ) .",
    "again , it is a product over @xmath210 independent random variables .",
    "the reason becomes clearer when considering the wcm : when the contraints are _ local _ , that is expressable as linear combinations of the adjacency matrix elements , the partition function factorizes and the probability of a given configuration factorizes as well , as a product of the independent random variables probability coefficients @xcite . in this case",
    "every ( non - negative , integer - valued ) weighted network in the grandcanonical ensemble has a probability of the following form    @xmath226^{-1}}\\equiv\\prod_{i\\neq j}p_{ij}^{w_{ij}}(1-p_{ij})\\equiv\\nonumber\\\\ & \\equiv&\\prod_{i\\neq j}(x_{i}y_{j})^{w_{ij}}(1-x_{i}y_{j})\\equiv\\prod_{i\\neq j}q_{ij}(w_{ij})\\end{aligned}\\ ] ]    by defining @xmath227 .",
    "now , two parameters per vertex have to be calculated in terms of the observed quantities : the maximum - likelihood principle @xcite prescribes to maximize    @xmath228\\ ] ]    with respect to @xmath229 and @xmath230 .",
    "the solution to the optimization problem can be found by solving the system    @xmath231    ( again , the condition expressed by eq .",
    "[ eq : con ] is satisfied because @xmath232 ) .",
    "the expected value of the minimum between @xmath25 and @xmath3 can be easily found by generalizing eq .",
    "[ eq : expmindwrg ]    @xmath220\\rangle_{wcm}=\\frac{p_{ij}p_{ji}}{1-p_{ij}p_{ji}}\\ ] ]    and the expected value of @xmath61 , computed in correspondence of the maximum - likelihood parameters , can be found by using the results of eq .",
    "[ eq : wcm ] :    @xmath233      in addition to the wcm , we further developed a version of it that is intended to model networks where the observed differences between @xmath114 and @xmath234 are interpreted as statistical fluctuations around a balanced condition , i.e. @xmath235 .",
    "we can start from the wcm equations , to specify them in this particular case .",
    "the condition @xmath236 implies that @xmath237 and this reduce the number of equations to solve , from @xmath238 to @xmath60 :    @xmath239    this , in turn , implies that @xmath240 and that @xmath68 .",
    "so , under the bcm , the expected value of the minimum and of @xmath61 become , respectively ,    @xmath220\\rangle_{bcm}=\\frac{p_{ij}^2}{1-p_{ij}^2}\\ ] ]    and    @xmath241    which is nothing more that a simplified version of eq .",
    "[ r_wcm ] .    the fundamental insight given by",
    "the bcm is that , in networks with node balance , i.e. where @xmath235 , the expected weights are symmetric :    @xmath242    this means that , in networks where the observed differences between @xmath114 and @xmath234 are consistent with statistical fluctuations around a balanced condition , one automatically expects symmetric weights , even without introducing any tendency towards reciprocation .",
    "this shows that measures of reciprocity based on the symmetry of mutual weights necessarily receive spurious contributions from other sources of flow balance .",
    "this observation concludes our statement that previously attempted correlation- and symmetry - based measures @xcite can not properly separate reciprocity from other factors .",
    "the three previous null models are defined in terms of constraints as the total weight , the in- and out - strength sequences and the total - strength sequence .",
    "so , not being included in the list of the constraints , the reciprocity @xmath61 and the index @xmath71 were a sort of target quantities , to test the power of the considered null models in reproducing them .",
    "now , we can make a step forward and include some information about the reciprocity structure of the network .",
    "we start by generalizing the wcm , by adding to its hamiltonian a sort of `` global reciprocity '' defined over the whole network , thus fixing the total number of reciprocal links .",
    "this means to consider , as a further constraint , the quantity    @xmath243=\\sum_{i}s_{i}^{\\leftrightarrow}\\ ] ]    to obtain the following hamiltonian    @xmath244    ( where @xmath245 ) . the resolution of this null model is considerably simplified by considering an equivalent way of rewriting it ,    @xmath246\\ ] ]    having posed , to uniform the formalism , @xmath247\\equiv w_{ij}^{\\leftrightarrow}$ ] and having defined    @xmath248    now , the most challenging calculation is about the partition function .",
    "this can be done by rewriting the hamiltonian solely in terms of the variables @xmath249 , @xmath250 and @xmath251 ,    @xmath252\\end{aligned}\\ ] ]    and considering the admissible states for them :    @xmath253    where @xmath254 and @xmath255 .",
    "so the partition function becomes    @xmath256    ( having posed @xmath257 , @xmath258 and @xmath259 ) and , consequently , the probability coefficient for the generic configuration @xmath260 is    @xmath261    now , the maximum - likelihood principle prescribes to maximize    @xmath262\\end{aligned}\\ ] ]    with respect to @xmath229 , @xmath230 and @xmath263 .",
    "the solution to the previous optimization problem can be found by solving the system    @xmath264    where    @xmath265    @xmath266    @xmath267    now , the expected value of the minimum between @xmath25 and @xmath3 is @xmath268\\rangle_{wrm}^*=\\langle w_{ij}^{\\leftrightarrow}\\rangle_{\\vec{\\theta}^*}$ ] .",
    "even if it is possible to write down the analytical expression of the expected value of @xmath61 , by using it , this can be avoided , by considering that    @xmath269    this , in turn , implies that    @xmath270    so , by definition , the index @xmath71 is trivially reproduced by the wrm .    note also that the only difference between the predicted quantities @xmath271 and @xmath272 lies in the presence of the extra - parameter @xmath263 in the second expression . recalling that @xmath273 ,",
    "if the hidden variables @xmath229 and @xmath230 are kept fixed , changing @xmath263 means lowering the expected reciprocal weight with respect to the wcm prediction .",
    "this makes the wrm best suited to reproduce networks that are anti - reciprocal ( i.e. , less reciprocal than the wcm prediction ) .",
    "a second null model including the information about the global reciprocity structure of the network can be defined , starting by the wrm hamiltonian .",
    "this time , the imposed constraints are the in- and out - strength sequences , diminished by the reciprocal strength sequence ( see eq .",
    "[ s_only ] ) , and the total number of reciprocal links :    @xmath274.\\nonumber\\end{aligned}\\ ] ]    following the calculations of the wrm , the partition function is    @xmath275    ( having posed @xmath257 , @xmath258 and @xmath259 ) .",
    "the probability coefficient for a generic configuration , @xmath260 , is    @xmath276    and the maximum - likelihood principle prescribes to maximize    @xmath277\\end{aligned}\\ ] ]    with respect to @xmath229 , @xmath230 and @xmath263 .",
    "the solution to the previous optimization problem can be found by solving the system    @xmath278    where    @xmath279",
    "@xmath280    @xmath281    as for the wrm    @xmath282    this , in turn , implies that    @xmath283      until now , we have defined three null models with no constraints about the reciprocity ( the wrg , the wcm and the bcm ) and two null models with the total number of reciprocal links ( thus implementing a global notion of reciprocity ) , as a constraint .    now , we can define more refined null models , by considering , as constraints , the local notion of reciprocity , as defined by eq .",
    "we start by considering the following hamiltonian :    @xmath284    ( where @xmath285 ) .",
    "the resolution of the null model described by this hamiltonian is , again , considerably simplified by considering the equivalent expression    @xmath286;\\ ] ]    by summing over the states defined in eq .",
    "[ states ] we find the partition function    @xmath287    ( having posed @xmath288 , @xmath289 ) the probability coefficient for the generic configuration @xmath260 is    @xmath290    and the likelihood function is , of course , the logarithm of the previous probability coefficient .",
    "the solution to this optimization problem prescribes to solve the following system    @xmath291    where    @xmath292    @xmath293    this model allows to solve for the @xmath294 value analitically .",
    "in fact , by summing eq . [ wdwrm ] over the ordered pairs of nodes , we find    @xmath295    and by solving this second - order equation w.r.t .",
    "@xmath294 , and taking the positive solution , we have the maximum - likelihood estimation of this parameter .",
    "also this model exactly reproduces the observed reciprocity , because @xmath296 and @xmath297 .",
    "this means that @xmath298 and the local quantities as the reciprocal strength sequence are now trivially reproduced .",
    "the last step is the definion of a very general null model , to finally include those local quantities not fixed by the nsm and the rsm .",
    "this implies a slight generalization of the formulas in the previous two paragraphs .",
    "the graph hamiltonian becomes    @xmath299    where , now , @xmath300 and    @xmath301    with obvious meaning of the symbols ( defined above ) .",
    "the partition function now becomes    @xmath302    and the likelihood is    @xmath303.\\end{aligned}\\ ] ]    the solution to this optimization problem , with respect to @xmath229 , @xmath230 and @xmath304 , can be found by solving the following system :    @xmath305    where    @xmath306    @xmath307    @xmath308    by the definition of the wrcm model , we not only recover the result that the global reciprocity is equal to the observed one ( implying @xmath309 and @xmath310 , also valid for the wrm ) : now , all the vertex - level , strength sequences are exactly reproduced , impyling that the reciprocity is reproduced at a _ local _ level .",
    "the wrcm is now powerful enough to allow for the analysis of the weighted motifs ( to understand which all the dyadic information has to be fixed ) and for the community detection , especially for those networks where the reciprocity plays an important role in shaping its structure .",
    "the first six models explained in the previous sections can be recovered from the last and most general one ( the wrcm ) by means of simple substitutions in the graph hamiltonian ( as shown by the following table ) .",
    "@xmath311 & @xmath312 + @xmath313 & @xmath314 + @xmath315 & @xmath316 +   + @xmath317 & @xmath318 + @xmath319 & @xmath320 +   + @xmath321 & @xmath322 +",
    "the jackknife method @xcite is an expedient to mimic resampling and it is usually used to estimate the variance of a given function of the population mean , @xmath323 ( being @xmath294 the random variable of interest ) . doing this in the least biased way , would imply to have a whole collection of samples .",
    "however , we observe only a single realization .",
    "how can compensate for the lack of such observations ?",
    "we can build a set of artificial samples by considering the following sets :    @xmath324    that is a list of vectors for each of which a single observation has been removed .",
    "then , we calculate the so called _ jackknife averages _    @xmath325    the estimates of the first two moments    @xmath326    from which the estimate of the jackkinfe - standard deviation follows    @xmath327    and , finally @xcite ,    @xmath328    how can we implement all this for our weighted networks ?",
    "the quantity we are interested in is @xmath71 .",
    "it is a function of the expected value of @xmath61 , taken over the whole grandcanonical ensemble : @xmath81 . by applying the jackknife method",
    ", we can build @xmath130 artificial samples by removing one _ weight _ at a time . by rewriting the above formulas , the final estimates become    @xmath329    @xmath330    where @xmath175 can be @xmath331 , @xmath332 , @xmath333 , @xmath334 , @xmath335 , @xmath336 , @xmath337 and where the sum over the index @xmath0 means that we are summing over the realizations with the @xmath0-th weight removed .",
    "in what follows a brief description of the analysed networks is given .    * interbank network .",
    "* this is the network of the italian interbank monetary exchanges @xcite , in the year 1999 .",
    "we analysed the monthy transactions for may ( @xmath338 , @xmath339 ) , june ( @xmath338 , @xmath340 ) , august ( @xmath338 , @xmath341 ) , october ( @xmath338 , @xmath342 ) and december ( @xmath338 , @xmath343 ) . *",
    "food webs .",
    "* we analysed eight different food webs @xcite , from different ecosystems ( lagoons , marshes , lakes , bays , estuaries , grasses , rivers ) , with a prevalence of aquatic habitats : _ chesapeake bay _",
    "( @xmath344 , @xmath345 ) and _ mondego bay _",
    "( @xmath346 , @xmath347 ) , _ everglades marshes _ ( @xmath348 , @xmath349 ) , _ maspalomas lagoon _ ( @xmath350 , @xmath351 ) , _ michigan lake _ ( @xmath352 , @xmath353 ) , _ st .",
    "marks seagrass _",
    "( @xmath354 , @xmath355 ) , _ crystal river creek _ ( @xmath350 , @xmath356 and @xmath350 , @xmath357 ) . * neural networks .",
    "* we analysed the neural network @xcite of _ c. elegans _",
    "( @xmath358 , @xmath359 ) .",
    "* social networks .",
    "* we analysed three different social networks @xcite : _ bk - office _ , _ bk - tech _ and _ bk - fraternity_. bk - tech and bk - fraternity are completely connected ( that is , @xmath360 ) .",
    "bernard and killworth ( and , later , also with the help of sailer ) , collected five sets of data on human interactions in bounded groups .",
    "_ bk - office _",
    "( @xmath361 , @xmath362 ) is the network of the human interactions ( conversations ) frequency between the employees of a small business - office , as recorded at time intervals of fifteen minutes ( during two four - days periods ) , by an external observer , along a fixed route through the office itself .",
    "_ bk - tech _",
    "( @xmath344 , @xmath363 ) is the network of the human interactions ( conversations ) frequency between collaborators in a technical research group at a west virginia university , as recorded at time intervals of half - hour ( during one five - days working week ) , by an external observer . _",
    "bk - fraternity _",
    "( @xmath364 , @xmath365 ) is the network of the human interactions ( conversations ) frequency between the students living in a fraternity at a west virginia college , as recorded by an external observer at time intervals of fifteen minutes ( during a five - days week , twenty - one hours per day ) who walked through the public areas of the building . *",
    "the world trade network . *",
    "we analyse the series of yearly bilateral data on exports and imports among world countries from the database in ref.@xcite , from 1948 to 2000 ( @xmath366 $ ] and @xmath367 $ ] ) .",
    "killworth p. d. , bernard h. r. & sailer l. informant accuracy in social network data iv : a comparison of clique - level structure in behavioral and cognitive network data .",
    "_ social networks _ * 2 * , 191 - 218 ( 1979 ) .",
    "killworth p. d. , bernard h. r. & sailer l. informant accuracy in social - network data v. an experimental attempt to predict actual communication from recall data .",
    "_ social science research _ * 11 * , 30 - 66 ( 1982 ) ."
  ],
  "abstract_text": [
    "<S> in directed networks , reciprocal links have dramatic effects on dynamical processes , network growth , and higher - order structures such as motifs and communities . while the reciprocity of binary networks has been extensively studied , that of weighted networks is still poorly understood , implying an ever - increasing gap between the availability of weighted network data and our understanding of their dyadic properties . </S>",
    "<S> here we introduce a general approach to the reciprocity of weighted networks , and define quantities and null models that consistently capture empirical reciprocity patterns at different structural levels . </S>",
    "<S> we show that , counter - intuitively , previous reciprocity measures based on the similarity of mutual weights are uninformative . by contrast , our measures allow to consistently classify different weighted networks according to their reciprocity , track the evolution of a network s reciprocity over time , identify patterns at the level of dyads and vertices , and distinguish the effects of flux ( im)balances or other ( a)symmetries from a true tendency towards ( anti-)reciprocation . </S>"
  ]
}