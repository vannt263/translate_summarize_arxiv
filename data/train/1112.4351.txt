{
  "article_text": [
    "the numerical pricing of options with early exercise features , such as american options , is a challenging problem , especially when the dimension of the underlying asset increases .",
    "there is a large body of literature which discusses this problem from different points of view , beginning with techniques aimed at solving the dynamic programming problem using trees or the associated hamilton - jacobi - bellman equation . over the past decade",
    ", there has been a lot of activity in developing monte carlo techniques for such optimal stopping problems .",
    "the most popular have been basis function regression methods initially proposed in @xcite and @xcite . if these methods are used to provide an approximate optimal exercise strategy , they naturally provide lower bounds for prices .",
    "thus they were soon followed by dual methods @xcite designed to find upper bounds .",
    "an account of these methods can be found in @xcite .    following on from the development of dual methods for american options ,",
    "there has been a strand of research extending these ideas to multiple optimal stopping problems , which correspond to options with multiple exercise features @xcite .",
    "the dual method proceeds via the idea of pathwise optimization , which originated in @xcite .",
    "this pathwise optimization method was developed in a general setting in @xcite where it was applied to more general stochastic control problems .    in this paper ,",
    "our aim is to consider a subclass of such stochastic control problems for which we can develop a relatively simple dual approach and which leads to numerical algorithms for the efficient computation of the value function .",
    "we were originally motivated by option pricing problems in the electricity market . in that setting contracts such as swing options",
    "give the holder certain rights to exercise variable amounts through the lifetime of the contract .",
    "the dual approach , initiated in @xcite , used a simplistic swing contract in which a single exercise was allowed on each day , with the total number of exercise rights over the lifetime of the contract constrained . in @xcite , this was extended to multiple discrete exercises on a given day .",
    "other recent developments have seen a move to continuous time @xcite and a ` pure martingale ' dual formulation of the problem @xcite .",
    "our first aim in this paper is to provide a more general formulation of the dual problem in discrete time which allows exercise of continuous amounts and contains the ` pure martingale ' approach .",
    "our second aim is to provide a useful numerical approach to this type of problem .",
    "having moved beyond the multiple optimal stopping problem to a more general stochastic control formulation , the space of controls is now potentially of dimension greater than one , and consequently more difficult to handle . instead of a purely binary decision ( or at most a finite set of decisions ) at each time point , we have the possibility of choosing from a euclidean space ( in the electricity context , this is exercising a real amount corresponding to a volume of power ) .",
    "our dual formulation of the problem leads naturally to an upper bound on the value function .",
    "we develop a technique based on being given an a priori estimate for the value function , say typically an estimate obtained via basis function regression , and converting this to an improved estimate via the dual .    in order to produce the a priori estimate ,",
    "the method uses least squares regression and monte carlo techniques , an extension of the approach due to longstaff - schwarz @xcite and tsitsiklis and van roy @xcite ; we use test functions that depend on both the underlying factor and the control value .",
    "we note that this idea has been considered by boogert and jong @xcite ; however , boogert and jong did not develop the extended regression based method in detail , but worked with regression depending only on the underlying factor for several discrete values of the control .",
    "belomestny et al .",
    "@xcite have also developed a family of least squares regression and monte - carlo based numerical algorithms .",
    "the algorithm in @xcite can be applied to more general discrete time control problems than the ones we consider in this paper . however , as in @xcite , belomestny et al .",
    "regress the conditional expectation arising in the dynamic programming principle using test functions depending on the underlying factor only .",
    "when applied to the same control problem , with the right choice of test functions and grid in the space of underlying factor and control , we found that our extended regression based method performs better than the method in @xcite or the method in @xcite , especially when the control is high dimensional .",
    "the a priori estimate is used as an input to the dual formulation based upper bound .",
    "the implementation of the dual estimate requires the numerical solution of several independent deterministic optimal control problems .",
    "we note that these control problems can be solved simultaneously , and , hence , it is well suited for a parallel implementation .    as an application",
    ", we will focus on one example in this paper , namely natural gas storage valuation .",
    "the owner of a natural gas storage facility is faced with an optimal control problem in order to maximize the return from running the facility .",
    "the demand for natural gas is seasonal with high demand and prices in the winter , and low demand in the summer .",
    "the operator of a facility will want to buy and store gas when it is cheaper over the summer , and then sell gas into the market when the price is higher in the winter .",
    "the operation of the facility is thus a control problem where , on a given day , the operator has the decision to inject or produce a volume of gas , given the current price of gas .",
    "thus , we have the set up of a stochastic control problem of the type we consider here .",
    "we chose the particular gas storage problem as a numerical example in order to compare the results of our probabilistic approach to the results of the partial differential equation based methods ( cf.@xcite ) .",
    "in general , we expect the probabilistic approach to perform better than the pde methods when the dimension of the underlying factor and/or the dimension of the control is high .",
    "our numerical example demonstrates that the dual formulation based upper bound is sharper than the one we get from the a priori estimate at comparable computational expense .",
    "this empirical observation justifies the potential benefit of computing the dual formulation based estimate in practice .",
    "the outline of the paper is as follows .",
    "we will begin with the setup for the problem in section  2 and follow this with the dual formulation in section  3 .",
    "we obtain our main representation in theorem  [ _ thm_dual_formulation ] , and then derive a version which can be used for the monte carlo based numerical technique in lemma  [ lem_upperlowerdifference ] .",
    "we follow this with a discussion of the numerical technique itself in section  4 .",
    "finally , we apply the approach to the gas storage problem in the last section .",
    "we consider an economy in discrete time defined up to a finite time horizon @xmath0 .",
    "we assume a financial market described by the filtered probability space @xmath1 , where @xmath2 .",
    "we take @xmath3 to be an @xmath4-valued discrete time markov chain representing the price of the underlying assets and any other variables that affect the dynamics of the underlyings .",
    "we assume that the filtration @xmath5 is generated by @xmath6 .",
    "moreover , we assume that @xmath7 is a risk neutral pricing measure , and write @xmath8 for any random variable @xmath6 on our probability space . throughout the paper",
    ", we will assume that interest rates are 0 .",
    "we phrase our problem in the language of options , even though it is a standard stochastic control problem of maximizing a reward obtained from a randomly evolving system .",
    "the payoff of the option ( or the reward for the position ) @xmath9 at time @xmath10 is a function of the underlying @xmath3 and the exercise amount @xmath11 , which is chosen by the holder of the option subject to certain constraints .",
    "the problems that we consider are decoupled in that the decision at time @xmath12 regarding @xmath13 has no impact on the evolution of the underlying state of the economy @xmath14 for @xmath15 .",
    "the set of _ admissible exercise decisions _ available at a given time is defined by a ( set - valued ) function @xmath16 on @xmath17 that takes values in the set of subsets of @xmath18 .",
    "the control process @xmath19 is defined by @xmath20 , @xmath21 , for the exercise amount @xmath13 .",
    "we will write @xmath22 , or , if needed , @xmath23 , for the given set of admissible exercise decisions depending on @xmath12 , the state of the underlyings @xmath24 , and the value of the control process @xmath25 . the initial value @xmath26 and the constraints @xmath27 for @xmath10 are determined by the option contract .",
    "[ _ def_kadmissiblepolicy ] a policy , or exercise strategy , @xmath28 is a @xmath16-_admissible exercise policy _ on @xmath29 started at @xmath30 if it satisfies all of the following properties .",
    "a.   @xmath31 is @xmath32-measurable for @xmath33 , b.   and @xmath34 for all @xmath35 and for all @xmath36 in a set of probability one ,    where @xmath37 is defined recursively by @xmath38 and @xmath39 for @xmath40 .",
    "the set of such policies is denoted by @xmath41 .",
    "thus , a @xmath16-admissible exercise policy @xmath42 on the time - set @xmath29 is defined by the @xmath43-adapted process @xmath44 describing the exercise decisions at times @xmath45 , and the value of such an exercise policy @xmath42 at time @xmath12 is given by @xmath46 .",
    "\\label{_eq_policyvalue}\\ ] ] in the particular examples considered in this paper , the set @xmath47 will be a line segment in @xmath48 or a quadrant of @xmath49 .",
    "we are now in a position to define the value function @xmath50 at time @xmath12 of the option satisfying the constraints @xmath16 .",
    "[ _ def_valuefunction ] we define the value function to be @xmath51 , \\ ( y , x)\\in{\\mathbb r}^l\\times{\\mathbb r}^d.\\ ] ]    for simplicity , we make the following assumption .    [ ass - dpp ] there exists a set @xmath52 of initial control values and a bound @xmath53 such that @xmath54 < c \\;\\;\\forall s \\in { { \\cal t } } , h \\in k_s(y , x_s),\\ ] ] for all @xmath55 reachable at time @xmath56 from @xmath57 by a @xmath16-admissible policy .",
    "this is enough to ensure the existence of the value function and the dynamic programming principle .",
    "weaker assumptions which guarantee existence would be possible , but are not the focus of this paper .    in order to indicate the type of problems that fit into this framework",
    ", we give three examples . in the final section ,",
    "we will focus on the first .",
    "+ natural gas storage valuation and optimal operation can be formulated as an option contract as described above . in particular , let @xmath58 denote the spot price of natural gas at time @xmath12 , and let @xmath59 denote the amount of gas stored in the facility at time @xmath12 . in that case , with @xmath13 denoting the change of level between @xmath12 and @xmath60 , the payoff is defined by @xmath61 more accurate models",
    "may also take into account the loss of gas occurring at injection .    at time @xmath12",
    ", the set @xmath62 is determined by the maximum and minimum capacity of the gas storage facility , and by the injection / production rate depending on the stored amount @xmath24 .",
    "a continuous time description of this problem was given in @xcite and in @xcite .",
    "in section [ _ sec_gas_storage ] , we present a time - discretized version .",
    "+ in the electricity market , a swing option enables the holder to protect themselves against the risk of price spikes if they are exposed to the spot price of electricity @xmath6 .",
    "the simplest versions give their holder the right , for a specified period of time , to purchase each day ( on- or off- peak time ) electricity at a fixed price @xmath16 ( strike price ) . in this case",
    ", the payoff is that of a call @xmath63 . when exercising a swing option at a time @xmath12 , the amount purchased may vary ( or swing ) between a minimum volume , @xmath64 , and a maximum volume , @xmath65 , while the total quantity purchased for the period must remain within minimum @xmath66 and maximum @xmath67 volume levels",
    "thus , we have @xmath68 with @xmath69 and @xmath70 .",
    "the set @xmath47 is the line segment determined by these constraints .",
    "+ a similar approach can be pursued to model the optimal liquidation of a portfolio of dependent assets .",
    "let @xmath71 denote the value of two bonds by the same issuer with different issue dates .",
    "we assume that , whenever @xmath72 is traded , there is a temporary price impact on both , @xmath72 and @xmath73 , referred to as a _ multi - asset price impact_. for example , if @xmath74 denotes the quantities sold of the bonds @xmath72 and @xmath73 , respectively , the payoff is @xmath75 for some @xmath76 and some matrix @xmath77 .",
    "the reader is referred to @xcite for further details .",
    "the one - dimensional case is considered in @xcite .    in this setting ,",
    "the set @xmath47 is determined by the total volume of each bond that we hold and wish to liquidate , and is hence a subset of @xmath78 .",
    "many models ( see for example @xcite ) consider modelling the permanent price impact of trades on top of incorporating the temporary impact . in the presence of permanent impact ,",
    "the optimal liquidation problem is typically formulated as a coupled stochastic control problem .",
    "the approach based on coupled control problems falls beyond the scope of this paper . for certain models of permanent price impact ( e.g. non - resilient impact ) ,",
    "the a priori estimate presented in section  [ _ seq_num_lower_bound ] can be easily adapted .",
    "deriving a dual formulation , however , is less straightforward .",
    "definition [ _ def_valuefunction ] represents the value of the option as the supremum over the set of admissible exercise policies . we now develop a dual for this problem that represents the option value as an infimum over a space of martingale - valued functions .",
    "let @xmath79 denote the space of functions defined on @xmath18 and taking values in the space @xmath80 of martingales which are adapted to the filtration @xmath5 and null at time @xmath81 . for @xmath82 , @xmath83 , @xmath84",
    ", @xmath85 denotes the time-@xmath12 value of @xmath86 .",
    "[ _ thm_dual_formulation ] let @xmath16 be a function defined on @xmath17 and taking values in the set of subsets of @xmath18 .",
    "then , for all @xmath87 , the value @xmath88 of the option at time @xmath81 almost surely satisfies the following .",
    "@xmath89 . \\label{_eq_dual_thm}\\ ] ] moreover , @xmath90 , \\label{_eq_dual_thm}\\ ] ] where @xmath91 such that @xmath92.\\ ] ]    we follow a similar approach to that of rogers @xcite .",
    "we have @xmath93 \\\\ & = \\sup_{\\pi\\in { { \\cal p}}_{k , y,0}}{{\\mathbb e}}\\left[\\sum_{s=0}^{t-1}\\big ( h_s(h_s , x_s)-m^{y_{s+1}}_{s+1 } + m^{y_{s+1}}_s\\big ) + h_t(h_t , x_t)\\bigg |x_0=x\\right ] \\\\ & \\leq   { { \\mathbb e}}\\left [ \\left\\{\\sup_{\\pi\\in { { \\cal p}}_{k , y,0}}\\sum_{s=0}^{t-1}\\big ( h_{s}(h_s , x_s)-m^{y_{s+1}}_{s+1 } + m^{y_{s+1}}_s\\big ) + h_t(h_t , x_t)\\right\\}\\bigg |x_0=x\\right].\\end{aligned}\\ ] ] as this holds for all martingales @xmath94 , we then have @xmath95.\\ ] ]    to see that the inequality holds the other way around , we consider a particular family of martingales .",
    "the one that we take is @xmath96 from the doob decomposition of the value function .",
    "thus , its increments are given by @xmath97.\\ ] ] using this martingale , we have @xmath98 \\\\ & \\qquad \\qquad \\leq   { { \\mathbb e}}\\left[\\sup_{\\pi\\in { { \\cal p}}_{k , y,0}}\\left\\{\\sum_{s=0}^{t-1 } ( h_s(h_s , x_s ) -",
    "\\delta m^{k , y_{s+1}}_s )   + h_t(h_t , x_t)\\right\\}\\bigg|x_0=x\\right ] \\\\ &",
    "\\qquad\\qquad = { { \\mathbb e}}\\bigg[\\sup_{\\pi\\in { { \\cal p}}_{k , y,0}}\\bigg\\{\\sum_{s=0}^{t-1}\\big ( h_s(h_s , x_s ) - v_{s+1}^{k,*}(y_{s+1},x_{s+1})+{{\\mathbb e}}_s\\left[v_{s+1}^{k,*}(y_{s+1},x_{s+1})\\right]\\big ) \\\\ & \\qquad\\qquad\\qquad\\qquad\\qquad+ h_t(h_t , x_t)\\bigg\\}\\bigg|x_0=x\\bigg].\\end{aligned}\\ ] ]    by the definition of the value function @xmath99 , for any @xmath100 , @xmath10 , and @xmath101 , we have @xmath102,\\ ] ] and , therefore , @xmath103.\\ ] ] hence , @xmath98 \\\\ & \\qquad\\qquad \\leq   { { \\mathbb e}}\\left[\\sup_{\\pi\\in { { \\cal p}}_{k , y,0 } } \\left\\{\\sum_{s=0}^{t-1}\\big ( v_s^{k,*}(y_s , x_s ) -   v_{s+1}^{k,*}(y_{s+1},x_{s+1})\\big ) + h_t(h_t , x_t)\\right\\}\\bigg|x_0=x\\right ] \\\\ & \\qquad \\qquad = v_0^{k,*}(y , x ) + { { \\mathbb e}}\\left[\\sup_{\\pi\\in { { \\cal p}}_{k , y,0 } } \\big\\{h_t(h_t , x_t)-v_t^{k,*}(h_t , x_t)\\big\\}\\right ] .",
    "\\end{aligned}\\ ] ] now , using the fact that at @xmath0 we must have @xmath104 , we have @xmath105 \\leq   v_0^{k,*}(y , x)\\ ] ] as required .    consider the specification of the multiple stopping problem in @xcite .",
    "the payoff function is @xmath106 for @xmath10 , the control satisfies @xmath107 and takes non - negative integer values , and the constraint sets are defined by @xmath108 in this special case , the payoff value is either @xmath81 or @xmath24 .",
    "hence , simplifies to the following .",
    "@xmath109.\\ ] ] the dual formulation in this form coincides with the result obtained in @xcite .    in general , we need to solve the deterministic control problem along the path in order to use this approach . if we have a good approximation to the value function , then we can use the martingale arising from its doob decomposition , as this will be an approximation to the optimal martingale .",
    "we note that , if we are given a set of approximations to the value function , we can bound the error made in the upper bound arising from the dual formulation in terms of what are essentially the errors in the dynamic programming equations .",
    "more specifically , let @xmath110 , @xmath111 be a set of approximations to the value function and denote by @xmath112 the associated upper bound on the value function .",
    "[ lem_upperlowerdifference ] the difference between the a priori estimate for the value function and the associated estimate arising from the dual formulation can be expressed as @xmath113-v_s(y_s , x_s)\\bigg\\vert x_t = x\\right].\\end{aligned}\\ ] ]    we choose the martingale in the upper bound to be the one generated by @xmath110 , and , thus , @xmath114.\\ ] ] substituting this into the dual formulation given in theorem  [ _ thm_dual_formulation ] , we have @xmath115   \\\\ & = { { \\mathbb e}}\\bigg[\\sup_{\\pi\\in{{\\cal p}}_{k , y , t } } \\sum_{s = t}^{t-1}\\left\\{h_s(h_s , x_s)-v_{s+1}(y_{s+1},x_{s+1 } ) + { { \\mathbb e}}_s\\left [ v_{s+1}(y_{s+1},x_{s+1})\\right]\\right\\ } \\\\ & \\qquad\\qquad\\qquad+ h_t(h_t , x_t)\\bigg\\vert x_t = x\\bigg ]   \\\\ & = { { \\mathbb e}}\\bigg[\\sup_{\\pi\\in{{\\cal p}}_{k , y , t } } \\sum_{s = t}^{t-1}\\big\\{h_s(h_s , x_s)-v_{s+1}(y_{s+1},x_{s+1 } ) + v_s(y_s , x_s)\\\\ & \\qquad\\qquad\\qquad\\qquad + { { \\mathbb e}}_s\\left [ v_{s+1}(y_{s+1},x_{s+1})\\right]-v_s(y_s , x_s)\\big\\ } + h_t(h_t , x_t)\\bigg\\vert x_t = x\\bigg ]   \\\\ & = { { \\mathbb e}}\\bigg[\\sup_{\\pi\\in{{\\cal p}}_{k , y , t } } \\sum_{s = t}^{t-1}\\left\\{h_s(h_s , x_s ) + { { \\mathbb e}}_s\\left [ v_{s+1}(y_{s+1},x_{s+1})\\right]-v_s(y_s , x_s)\\right\\ } \\\\   &",
    "\\qquad\\qquad\\qquad + v_t(y_t , x_t)-v_t(y_t , x_t)+ h_t(h_t , x_t)\\bigg\\vert x_t = x\\bigg ]   \\\\ & = v_t(y , x ) + { { \\mathbb e}}\\left[\\sup_{\\pi\\in{{\\cal p}}_{k , y , t } } \\sum_{s = t}^{t-1 }   \\left\\ { h_s(h_s , x_s)+{{\\mathbb e}}_s \\left[v_{s+1}(y_{s+1},x_{s+1})\\right]-v_s(y_s , x_s)\\right\\}\\bigg\\vert x_t = x\\right ] \\end{aligned}\\ ] ] as @xmath116 , giving the required result .",
    "we now present a numerical implementation of the dual upper bound derived in lemma [ lem_upperlowerdifference ] .",
    "the lemma gives a representation of the difference between an upper bound @xmath117 and another ( a priori ) approximation @xmath110 of @xmath118 . in section [ _ seq_num_upper_bound ] , we present a numerical method that approximates @xmath117 given that approximations of the functions @xmath110 and @xmath119 \\label{_eq_conditional_expectation_of_candidate_solution}\\ ] ] are available .    in section [ _ seq_num_lower_bound ] , we introduce an approach to generate an a priori estimate @xmath110 and an approximation of the conditional expectation .      in this section",
    ", we assume that a set of a priori approximations @xmath110 is available , i.e. , for @xmath120 , the function @xmath110 represents an approximation of @xmath118 .",
    "furthermore , we assume that , for @xmath120 , the function @xmath121 and ( an estimate of ) @xmath119\\ ] ] can be computed for any time-@xmath12 reachable pair @xmath122 . under such assumptions ,",
    "we introduce a numerical method that implements the upper estimate @xmath117 derived in lemma [ lem_upperlowerdifference ] .",
    "lemma [ lem_upperlowerdifference ] requires the estimation of a path - wise optimum .",
    "hence , given a trajectory @xmath123 , we aim to approximate the function @xmath124-v_s(y_s , x_s)\\big\\}\\ ] ] recursively for @xmath125 .",
    "the optimization algorithm is based on the following path - wise dynamic programming principle .",
    "@xmath126-v_s(y_s , x_s)\\big\\}\\right\\}\\nonumber\\\\ & = \\sup_{h\\in k_t(y , x_t)}\\big\\ { h_t(h , x_t)+{{\\mathbb e}}\\left[v_{t+1}(y - h , x_{t+1})|x_t = x_t\\right]\\nonumber\\\\ & \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ -v_t(y , x_t)+f_{t+1}(y - h , x_{\\cdot})\\big\\},\\label{eq_pwdynamicprogrammingprinciple}\\end{aligned}\\ ] ] and @xmath127 .",
    "\\label{eq_dualrepresentationwithdynamicprogramming}\\ ] ] based on and , we are now in a position to formulate the following algorithm .",
    "[ main_alg ] generate @xmath128 independent trajectories @xmath129 , @xmath130 of the process @xmath6 started at a fixed @xmath131 .",
    "for @xmath130    1 .",
    "set @xmath132 , and define @xmath133 .",
    "[ _ step2 ] set @xmath134 .",
    "[ _ step3 ] define a finite gird @xmath135 ( see remark [ _ rem_dual_version ] ) , and for each @xmath136 solve the optimization problem @xmath137\\\\ & \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ -v_t(y , x^i_t)+\\widehat{f}_{t+1}(y - h , x^i_{\\cdot})\\big\\}\\end{aligned}\\ ] ] 4 .",
    "[ _ step4 ] given the set @xmath138 , define ( interpolate ) @xmath139 on the whole domain @xmath140 ( see remark [ _ rem_dual_version ] ) .",
    "if @xmath141 , continue with [ _ step2 ] , otherwise finish .",
    "once @xmath142 is defined for all @xmath130 , we approximate @xmath143 by the monte - carlo average @xmath144    clearly , the main challenge in the implementation of algorithm [ main_alg ] is the solution of the optimization problem in step 3 .",
    "[ _ rem_dual_version ]    the particular implementations of the above algorithm differ in    a.   the specification of the domain @xmath140 , b.   the definition of @xmath145 , c.   the approximation of the solution to the optimization problem in point [ _ step3 ] of the algorithm , d.   and the method applied in point [ _ step4 ] of the algorithm .",
    "two possible versions of algorithm [ main_alg ] are presented in sections [ _ sec_fy1 ] and [ _ sec_fy2 ] .",
    "one possible approach is to discretized the problem in the control .",
    "we define @xmath146 as an ( equidistant ) grid contained in the set of initial control values of interest . then , recursively for @xmath120 , we define @xmath147 to be an ( equidistant ) grid contained in the set @xmath148 furthermore , @xmath140 is defined to be the same as @xmath145 ; this specification implies that the optimization problem in step [ _ step3 ] of algorithm [ main_alg ] is an optimization over a finite set ; moreover , @xmath149 for @xmath111 .",
    "[ rem_ygrid ] the choice of @xmath145 depends on the constraints of the problem . for instance , in the case of the gas storage problem , there is a well defined lower and upper limit of @xmath30 ; @xmath145 can be an equidistant grid in this region .      here , we define @xmath145 similarly to the previous version . however , we assume @xmath150 to be a parametric surface of the following form .",
    "@xmath151 for some vector of parameters @xmath152 depending on the trajectory @xmath129 and for some set of test functions @xmath153 with domains in @xmath18 , implying @xmath154 the accuracy of the algorithm is sensitive to the choice of test functions ; more specifically , different settings may have different optimal sets of test functions , and the ( numerical ) solution of the optimization problem in step [ _ step3 ] of algorithm [ main_alg ] should be adapted to the particular choice of test functions .",
    "point [ _ step4 ] of algorithm [ main_alg ] is implemented via a least squares regression , i.e. , we define @xmath155 to minimize the expression @xmath156",
    "^ 2.\\ ] ]     as we increase the number @xmath157 of independent test functions and the number @xmath128 of simulated trajectories , we anticipate that @xmath150 converges to @xmath158 for @xmath111 .",
    "however , @xmath150 is likely to estimate @xmath158 from below , and , therefore , our method is likely to result in a low - biased estimate of the dual formulation based upper bound .",
    "as stated at the beginning of section [ _ seq_num_upper_bound ] , the solution of requires computable functions @xmath110 and @xmath159\\ ] ] approximating @xmath118 and @xmath160 $ ] , respectively , for @xmath120 .",
    "we suggest the following method , which is based on the dynamic programming formulation .",
    "( dynamic programming formulation ) @xmath161\\right\\ } & \\text { if } 0\\le t\\le t-1 .",
    "\\end{array } \\right . \\label{eq_maindynamicprogrammingfromulation}\\end{aligned}\\ ] ]    for the computation of the conditional expectation in the above formulation , we introduce a slightly extended version of the standard least squares regression based monte carlo method @xcite .",
    "our construction yields an a priori estimate @xmath162 that approximates @xmath163 for a bounded set",
    "@xmath164 of initial @xmath131 values , where @xmath164 is contained in the support of the law of @xmath131 .",
    "[ main_alg_2 ] define a set @xmath165 of distinct initial values of @xmath6 in @xmath164 ( see section [ _ sec_practical_implementation_xyregression ] ) and generate independent trajectories @xmath129 , @xmath130 , of the process @xmath6 , with @xmath166 for each @xmath167 .",
    "define @xmath168 for @xmath169 , where @xmath170 .",
    "furthermore , for @xmath171 , define a finite set @xmath172 such that , for all @xmath173 , we have @xmath174 ( see remark [ _ rem_versions_of_xyregression ] ) .",
    "then , proceed as follows .    1 .",
    "set @xmath132 and define @xmath175 2 .   [ _ apriori_step2 ] set @xmath134 .",
    "[ _ apriori_step3 ] given the set @xmath176 define a function @xmath177 approximating @xmath178 on @xmath179 ( see remark [ _ rem_versions_of_xyregression ] ) .",
    "[ _ apriori_step4 ] for each @xmath173 , solve the optimization problem @xmath180 5 .   [ _ apriori_step5 ] @xmath181 is only defined on @xmath182 .",
    "given the set @xmath183 define the function @xmath184 on its domain ( see remark [ _ rem_versions_of_xyregression ] ) .",
    "6 .   if @xmath141 , then continue with step @xmath185 ; else , @xmath186 results in an a priori approximation .",
    "the above outline of algorithm [ main_alg_2 ] leaves some choice as to how certain things are done in detail ; in particular , this includes the following points .",
    "[ _ rem_versions_of_xyregression ]    the particular implementations of algorithm [ main_alg_2 ] differ in    a.   the construction of the set @xmath182 , b.   the construction of the function @xmath187 in step [ _ apriori_step4 ] , c.   and the construction of the function @xmath184 in step [ _ apriori_step5 ] .    in section",
    "[ _ sec_practical_implementation_xyregression ] , we implement a particular version of algorithm [ main_alg_2 ] for the a priori estimate .      since the three items described in remark [ _ rem_versions_of_xyregression ] are closely connected , we discuss them together .    in a similar way to the classic least squares regression based approach ( cf.@xcite ) , we approximate the function @xmath188 by an orthogonal projection onto a function space spanned by a set of test functions @xmath189 , where , for @xmath190 , @xmath191 is defined on @xmath192 , and @xmath193 .",
    "\\label{_eq_xyregression}\\ ] ] in contrast to @xcite , where the orthogonal projection at time @xmath12 is determined by the distribution of @xmath24 , we have to deal with the control variable as well .",
    "we define the projection to minimize @xmath194-\\sum_{q=1}^q\\gamma_{t , q}\\psi_q(y , z)\\right)^2\\right ] , \\label{_eq_xyreg_error}\\ ] ] where @xmath195 and @xmath196 are independent random variables . in most applications ,",
    "the set reachable by @xmath197 is bounded , and , therefore , in order to try to obtain uniform accuracy across the reachable set , we will take @xmath196 to be uniformly distributed on this bounded set .",
    "the distribution of @xmath195 can be defined to coincide with the distribution of @xmath24 . however , in many applications , such as the numerical example in section [ _ sec_numerical_results ] , only the distribution of @xmath24 conditioned on particular values of @xmath131 is specified ; here , we assume that the law of @xmath131 is uniform on a certain set @xmath164 .",
    "formula suggests that , by increasing the number of appropriately chosen test functions @xmath198 , @xmath187 approximates the conditional expectation @xmath199\\ ] ] in the mean square sense with respect to the joint measure of @xmath196 and @xmath195 ; for our particular choice of test functions , see section [ _ sec_results_aprioriestimate ] .    in order to determine the regression coefficients @xmath200 for @xmath190",
    ", we observe that , when is minimized , we have @xmath201-\\sum_{q=1}^q\\gamma_{t , q}\\psi_q(y , z)\\right)^2\\right ]   \\\\ & \\ \\ \\ \\ = 2{{\\mathbb e}}_{y , z}\\big[{{\\mathbb e}}[v_{t+1}(y , x_{t+1})|x_t = z]\\psi_r(y , z)\\big ]            -2{{\\mathbb e}}_{y , z}\\left[\\sum_{q=1}^q\\gamma_{t , q}\\psi_q(y , z)\\psi_r(y , z)\\right]\\\\ & \\ \\ \\",
    "\\ = 2{{\\mathbb e}}_{y , z}\\big[v_{t+1}(y , x_{t+1})\\psi_r(y , z)\\big ]            -2\\sum_{q=1}^q\\gamma_{t , q}{{\\mathbb e}}_{y , z}\\left[\\psi_q(y , z)\\psi_r(y , z)\\right]=0.\\end{aligned}\\ ] ] hence , @xmath202 satisfies the linear equation @xmath203 where @xmath204\\ ] ] and @xmath205\\ ] ] for @xmath206 .",
    "when estimating the regression coefficients , we replace @xmath207 and @xmath208 in with their monte - carlo estimates @xmath209    the choice of @xmath165 and @xmath182 , @xmath111 , determines how accurately @xmath210 and @xmath211 approximate @xmath207 and @xmath208 , respectively .",
    "when implementing the method , we consider    a.   @xmath165 to be randomly sampled from the law of @xmath131 , or @xmath165 to be a low discrepancy sequence in @xmath164 , b.   @xmath212 to be randomly sampled from the conditional distribution @xmath213 , c.   and @xmath30 to be independent of @xmath212 and randomly sampled from the uniform distribution on the support of @xmath25 , or to be a low discrepancy sequence lattices , see section [ _ sec_numerical_results ] . ] in the support of @xmath25 ; we generated a small number ( @xmath214 to @xmath215 ) of @xmath30 items for each @xmath216 .",
    "[ _ rem_xygrid ]    initially , we looked at defining @xmath217 , for some set @xmath145 .",
    "however , the numerical results showed that to achieve a given accuracy , a large enough @xmath145 is required , resulting in a set @xmath218 significantly larger than the size of @xmath182 constructed in the version described prior to this remark ( calibrated to yield the same accuracy ) .",
    "figure [ fig : xygirds ] demonstrates the difference between @xmath218 and the set @xmath182 described before this remark .",
    "we observe that @xmath182 yields a better coverage with fewer grid points .",
    "what remains is to be specified are the particulars of step [ _ apriori_step5 ] of algorithm [ main_alg_2 ] , i.e. , to define @xmath184 given @xmath219 to do this , one can use interpolation , or one can fit a parametric surface to the graph of @xmath220 ; we consider the parametric representation @xmath221 choosing @xmath222 , @xmath190 , to minimize the mean square error @xmath223 i.e. , we define @xmath184 by another least squares regression .    for the numerical computation of the dual formulation based approach , to ensure that we have an upper bound ,",
    "it is essential that the estimate of @xmath224 \\label{_eq_martingaleincrement}\\ ] ] is a martingale increment , that is it has zero expectation .",
    "as introduced in this section , the function @xmath225 is a biased estimate of .",
    "when is used for computing the dual upper bound - in particular , when @xmath187 is a poor estimate of @xmath188 - the error due to this bias might be larger than the statistical error .    in such cases",
    ", one can replace @xmath187 with the following estimate @xmath226 where @xmath227 , @xmath228 for some @xmath229 is an i.i.d .",
    "sample from the conditional distribution of @xmath230 .",
    "multivariate regression similar to has been mentioned in @xcite .",
    "however , @xcite does not pursue the same route as presented above , but rather restricts attention to a least squares regression that uses test functions depending only on the underlying factor @xmath6 , and , for each value of @xmath30 in a finite set @xmath231 , a separate simpler regression is computed .",
    "the extension of @xmath181 to the whole domain of @xmath184 is not considered ( step [ _ apriori_step5 ] in algorithm [ main_alg_2 ] ) .",
    "@xcite restricts the optimization problem in step [ _ apriori_step5 ] to @xmath232 .",
    "computing regressions which are based on test functions depending only on @xmath6 is less expensive than a regression with high number of @xmath233-dependent test functions ( see section [ _ sec_results_aprioriestimate ] for the implementation of the a priori method ) .",
    "however , for accurate estimates , a fine grid @xmath232 is required , and , hence , a high number of simple regressions needs to be computed .",
    "with carefully chosen @xmath234-grid ( see remark [ _ rem_xygrid ] ) and a suitable set of @xmath233-dependent test functions , our version attains the same accuracy at significantly lower cost .",
    "the a priori estimates @xmath110 and @xmath235 $ ] , described above , typically result in a high biased estimate of the value function .",
    "however , the outcome of the a priori method can be applied to generate a low biased estimate . by definition , for any @xmath236 and for any policy @xmath237",
    ", @xmath238 is a low biased estimate of @xmath239 .",
    "the a priori estimate generates a policy as follows . for @xmath240 , a reachable pair @xmath241 , and @xmath242 ,",
    "there exists at least one value @xmath243 that satisfies @xmath244\\nonumber\\\\ \\ & \\sup_{h\\in k_t(y , x)}\\left\\{h_t(h , x)+\\mathbb{e}[v_{t+1}(y - h , x_{t+1})|x_t = x]\\right\\}-\\epsilon . \\label{_eq_lowbiasedpolicy}\\end{aligned}\\ ] ] given a starting value @xmath236 , and assuming that the supremum exists almost surely for reachable pairs , determines a exercise policy @xmath245 .",
    "as @xmath246 approaches @xmath81 , @xmath247 converges to @xmath163 .",
    "this convergence result motivates the following low - biased algorithm .",
    "[ main_alg_3 ] fix @xmath236 and @xmath242 .",
    "generate @xmath128 independent trajectories @xmath129 , @xmath130 , of the process @xmath6 started at a fixed @xmath131 .",
    "for @xmath130 ,    1 .",
    "set @xmath248 , and @xmath249 , 2 .",
    "[ _ forwardstep ] for @xmath250 and @xmath251 , find a @xmath252 that satisfies , 3 .",
    "set @xmath253 .",
    "4 .   and , if @xmath132 , then stop ; else , set @xmath254 , and continue with step [ _ forwardstep ] .",
    "once this routine has been executed for all @xmath130 , the monte - carlo average @xmath255 approximates ( up to statistical error due to sampling variance ) a low biased estimate at time @xmath81 for initial control value @xmath26 and initial factor value @xmath216 .",
    "in this section , we discuss the gas storage example following @xcite , and we compare the numerical performance of the implementation of both , the a priori method and the method based on the dual formulation .",
    "the natural gas storage problem addresses the optimal utilization of certain types of storage facilities .",
    "we assume relatively high deliverability and high injection rates .",
    "in particular , given the price @xmath24 of gas and the amount @xmath25 of _ working gas _ in the inventory at time @xmath12 , we aim to optimize the production ( injection ) amount for the given day , for each day over a year .",
    "* @xmath256 , the rate of production if @xmath257 , or the rate of injection if @xmath258 .",
    "the rate is measured in million cubic feet per day ( mmcf@xmath259day ) . *",
    "@xmath260 , base gas requirement ( built into the facility and can not be removed ) .",
    "* @xmath261 , the maximum storage capacity of the facility on top of the base gas level . *",
    "@xmath262 , the maximum production rate at storage level @xmath30 . *",
    "@xmath263 , the maximum injection rate at storage level @xmath30 .",
    "* @xmath264 , the rate of gas that is lost given production at rate @xmath257 or injection at rate @xmath258 .",
    "* @xmath265 , the discount rate .    as in @xcite",
    ", we consider a facility with working gas capacity of @xmath266mmcf and with base gas requirement @xmath267mmcf .",
    "the maximum production rate ( attainable at maximum capacity ) is known to be @xmath268mmcf@xmath259day , whereas the maximum injection rate ( attainable at minimum capacity ) is @xmath269mmcf@xmath259day .",
    "the facility is available for one year , and a decision on gas production / injection is made daily , i.e. , @xmath270 .",
    "the daily constraints on gas production and injection are derived from the ideal gas law and bernuolli s law ( the reader is referred to section 3 in @xcite for details ) . in particular , @xmath274 where @xmath275 .",
    "moreover , @xmath276 where @xmath277 and @xmath278 combining and with , we get the constraint set for the amount of gas that can be produced / injected during a day : @xmath279 . \\label{_eq_constraints}\\ ] ]        in practice , gas prices are quoted in ",
    "dollars per million british thermal units \" ( $ @xmath259mmbtus ) .",
    "we note that @xmath283 mmbtus are roughly equivalent to @xmath214 mmcf .",
    "the calculations in @xcite are based on the gas price model @xmath284 where @xmath285 is a poisson process with intensity rate @xmath286 and independent of the brownian motion @xmath287 .",
    "moreover , @xmath288 is normally distributed with mean @xmath289 and variance @xmath290 independent of @xmath287 and @xmath291 . in our implementation",
    ", we rescaled the parameters of @xcite to daily time - scale : @xmath292 , @xmath293 , @xmath294 , @xmath295 , @xmath296 , and @xmath297 .    since the payoff function is piece - wise linear in @xmath298 and the constraints sets",
    "are bounded ( uniformly in @xmath12 ) for any @xmath16-admissible policy @xmath42 , the following bounds are satisfied for all @xmath10 , @xmath299 , @xmath300 $ ] .",
    "@xmath301\\\\ \\le v^{\\pi}_t(y , x ) \\le   c_{\\max}(y_{\\max})\\delta t\\sum_{s = t}^t\\mathbb{e}[x_s|x_t = x ] < \\infty.\\end{gathered}\\ ] ] these inequalities imply that the value function is well defined , and the dynamic programming principle holds for this particular formulation of the gas storage problem .",
    "first , we ran the method using an equidistant initial grid @xmath302 in the price region @xmath303 $ ] of interest ( @xcite presents results in this price interval ) .",
    "however , we found that the absolute value of the second derivative of @xmath304 with respect to gas price was large in the price interval @xmath305 $ ] , and close to zero otherwise ; therefore , we decided to refine the grid in the middle region .",
    "in particular , we chose an initial grid @xmath302 that had @xmath306 equidistant points in the interval @xmath307 $ ] , @xmath308 equidistant points in @xmath305 $ ] , and @xmath306 equidistant points on @xmath309 $ ] .       on each rectangle , we used the following polynomials : @xmath214 , @xmath216 , @xmath30 , @xmath311 , @xmath312 , @xmath313 , @xmath314 , @xmath315 , and @xmath316 .",
    "in addition to these polynomials , on the patches in the second row , we also used @xmath317 , @xmath318 , and @xmath319 .",
    "although defining functions locally on small rectangles leads to a relatively high number of test functions , the matrix [ _ eq_bpsi ] is sparse , and the evaluation is tractable .    in step [ _ apriori_step4 ] of algorithm [ main_alg_2 ] , we simply compared the outcome of three scenarios : @xmath320 , @xmath321 , and @xmath322 ; i.e. , we assumed _ bang - bang controls_. we also tested replacing the supremum with the maximum over finer grids in @xmath323 ; however , these tests did not result in significantly different option values .",
    "the numerical results corresponding to @xmath248 , @xmath324 , and bang - bang controls are shown in figures [ fig : apriori1 ] and [ fig : apriori2 ] .",
    "comparing these figures to the plots on page 235 in @xcite , we find that our a priori method slightly overestimates the option value .",
    "given that , in order to estimate the values at time @xmath81 , the a priori method uses information from later times , it is likely to be a _ high biased _ method ( see comments on the least squares regression based methods in @xcite ) .",
    "we implemented the version of the method based on the dual formulation as specified in section [ _ sec_fy2 ] for three different initial gas prices ( @xmath325$@xmath259mmbtus , @xmath326$@xmath259mmbtus and @xmath327$@xmath259mmbtus ) . in each case , we generated @xmath328 gas price trajectories . for @xmath329 , we used a fixed equidistant grid in @xmath330 $ ] with @xmath331 points .",
    "for the parametric curve fitting component , we partitioned the control interval @xmath330 $ ] into three shorter intervals ( @xmath332 $ ] , @xmath333 $ ] , and @xmath334 $ ] ) , and on each small interval we used the following polynomials as test functions : @xmath214 , @xmath30 , @xmath312 , and @xmath335 .    in order to compute the optimization in step [ _ step3 ] of algorithm [ main_alg ] , we approximated the supremum with the maximum on a finite grid in @xmath323 .",
    "this grid can be chosen to be finer than @xmath329 . with other optimization techniques ,",
    "even more accurate estimates can be computed .    in order to estimate the accuracy of the method , we ran the algorithm using finer @xmath329 grids but the same set of gas price trajectories , more test functions defined locally on finer partitions , and more accurate optimization . since the refined specifications resulted in absolute differences that were around @xmath336 of the standard deviation of the results , we consider the refined estimates numerically equivalent to our reference results .",
    "the results are given in table [ tab : dualvsfwd ] and plotted in figures [ fig : compat3 ] , [ fig : compat6 ] , and [ fig : compat9 ] .",
    "for each case ( @xmath338 ) , table [ tab : dualvsfwd ] describes the range of differences of the high - biased and low - biased estimates over the range of control @xmath339 $ ] .",
    "we also provide the range of estimated standard deviations to indicate the order of magnitude of the statistical error .",
    "we note that a conservative upper and lower bound can be computed by adding three times its standard deviation to the upper estimate and subtracting three times its standard deviation from the low - biased estimate .",
    "figures [ fig : compat3 ] , [ fig : compat6 ] , and [ fig : compat9 ] suggest that , in some cases , the dual formulation method based estimate results in a sharper upper bound compared to the estimates of the a priori method .",
    "the upper and lower estimates are consistent with the numerical results of @xcite .",
    "boogert a. and jong c. , _ gas storage valuation using a monte carlo method _ , j. derivatives , * 15 * ( 2008 ) , 8198 .",
    "chen , z. and forsyth , p.a .",
    ", _ a semi - lagrangian approach for natural gas storage valuation and optimal operation _ , siam j. sci .",
    ", * 30 * ( 2007 ) , 339368 ."
  ],
  "abstract_text": [
    "<S> we consider a class of discrete time stochastic control problems motivated by some financial applications . </S>",
    "<S> we use a pathwise stochastic control approach to provide a dual formulation of the problem . </S>",
    "<S> this enables us to develop a numerical technique for obtaining an estimate of the value function which improves on purely regression based methods . </S>",
    "<S> we demonstrate the competitiveness of the method on the example of a gas storage valuation problem .    </S>",
    "<S> l. g.  gyurk , , </S>"
  ]
}