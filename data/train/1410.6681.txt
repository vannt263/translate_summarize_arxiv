{
  "article_text": [
    "the gps timing and control ( gtc ) system is one of the major subsystems in the high altitude water cherenkov ( hawc ) gamma ray observatory @xcite .",
    "hawc is a very high energy ( vhe ) gamma ray observatory being built on the flank of the volcano sierra negra in mexico at latitude @xmath1 north , longitude @xmath2 west , and altitude 4100 m. it is important for hawc to maintain a low dead time , as an all - sky survey instrument . in order to maintain a low dead time ,",
    "the hawc main data acquisition system ( daq ) was designed as a distributed daq , providing continuous read out .",
    "the first level of the daq consists of 11 caen vx1190a time to digital converters ( tdcs ) and 11 ge xvb602 intel corei7 single board computers ( sbcs ) to read out tdcs , where each tdc - sbc pair reads a fragment of an event with 128 channels .",
    "these event fragments are combined in the online reconstruction farm .",
    "the distributed design of the daq system makes synchronous operation of the system critical .",
    "the gtc system , which is a custom fpga based system , is designed to perform this task . + as its name suggests , the gtc system has two sub systems : the gps timing system and the control system .",
    "the primary task of the gps timing system is to provide a timestamp for each recorded event , which is the absolute time of the trigger .",
    "the primary task of the control system is to provide the clock and the control signals to the tdcs , and provide trigger and detector status information to the scaler system .",
    "the gtc system is implemented using three different types of custom cards : clock type hclock card , control type hclock card and cb_fan card , as well as a commercial gps receiver navsync cw46s.pb.pdf ] +",
    "the completed hawc detector will consist of 300 steel water tanks of 7.3 m in diameter and 4.5 m in height instrumented with 4 pmts in each tank .",
    "each of these tanks contain a light - tight bladder filled with purified water and 4 pmts pointed upwards are placed near the bottom of the bladder .",
    "construction of hawc is scheduled in stages ; continuous operation of the first phase with 30 tanks ( hawc 30 ) with a fully functional gtc system started in november 2012 , and the final phase with 300 tanks will be completed in 2014 . + the hawc detector is designed to observe cosmic gamma rays by detecting the component of extensive air showers ( eas ) which reaches ground level .",
    "eas are generated from the interactions between the earth s atmosphere and cosmic gamma rays .",
    "when the relativistic charged particles in an eas move through the water tanks , they create cherenkov light that can be detected by the pmts .",
    "the main daq measures the arrival time and time over threshold ( tot ) of the pmt pulses , with an accuracy of 100 ps , using caen vx1190a time to digital converters ( tdcs ) .",
    "this information is used to determine the species of the primary particle initiating the eas ( gamma ray or proton ) , its energy , and the celestial coordinates of the primary particle .",
    "caen vx1190a tdcs are designed to record tot measurements within a given time window , around a trigger signal .",
    "each of these tdcs is equipped with 128 data channels and an output buffer to store data until read out .",
    "the control of the tdcs is done using three signals of the tdc control bus : trg , clr , and crst .",
    "the trg is the trigger signal input to the tdc . in hawc ,",
    "the trigger signal is a periodic signal that is provided by the gtc system . in a typical data",
    "run the periodic trigger frequency is 40 khz ( period = 25 @xmath0s ) and the tdcs record the data in a 25.2 @xmath0s window around each trigger .",
    "the data saved in a given time window is called an  event \" in this paper .",
    "the analysis software searches these events for individual eas arrivals .",
    "the overlapping of the `` event '' time windows and the ability of the tdcs to read out while acquiring new data provides read out with no intrinsic daq dead time .",
    "clr is the clear command , which clears the data in the output buffer , resets the event counter , bunch counter , and performs a tdc global reset .",
    "crst is the reset command , which resets the extended trigger time tag and bunch counter .",
    "+ when hawc is completed , it will need 1200 data channels , which is 9 full tdcs and 48 data channels from a 10@xmath3 tdc .",
    "besides the 10 tdcs used to record pmt signals , an @xmath4 tdc will be used to record 32 signals coming from the gps timing system and calibration signals .",
    "these signals are similar to the tot signals but they are encoded with the current gps time , which is the timestamp of that event .",
    "figure  [ overalltiming ] shows a simplified timing diagram of the pmt signals and the timestamp signals . in this timing diagram , channels 1 through 128 of tdc 1 through ( n-1 ) record pmt signals and channels 1 through 32 of the n@xmath3 tdc record timestamps .",
    "+     tdc record timestamps .",
    "two timestamps per each trigger window are guaranteed , when the clock system is configured to send a timestamp in every 10 @xmath0s . ]",
    "while tdc buffers are filling with data , a ge xvb602 intel core i7 based vme single board computer ( sbc ) reads each tdc and delivers the data to the online reconstruction farm .",
    "however , sbcs can not perform the read out process at exactly the same rate for every tdc .",
    "therefore , the online reconstruction farm receives different fragments of a single event at different times .",
    "the hawc online reconstruction software identifies the event fragments belonging to a given trigger using the event identification number ( event i d ) , which is a 12 bit number in the event header .",
    "the event i d becomes zero after a tdc power cycle and then increases by one for each trigger .",
    "the gtc system also can reset the event i d to zero by sending a clr signal through the tdc control bus . + after identifying the event fragments of a single event , the online reconstruction process combines the fragments into a single event and decodes the timestamp .",
    "this event build is possible only if all the tdcs are working synchronously and maintain a unique event i d for a given trigger .",
    "the main objective of the control system is to keep the tdcs in synch .",
    "the synchronization between tdcs is achieved by distributing a global clock signal to all the tdcs , and clearing and resetting all the tdcs simultaneously at the beginning of each run .",
    "the gps timing system provides two services to hawc : 1 ) produce a periodic timestamp and 2 ) derive a low jitter 40 mhz signal to use as the global clock signal for hawc .",
    "as shown in figure  [ clockcardschem ] , the gps timing system is made from two components : a custom board called the clock type hclock card and a navsync cw46s gps receiver .",
    "figure  [ hclockcard ] shows a photograph of a fully assembled hclock card .",
    "it is a 2 slots wide 6u vme-64x module that is equipped with a phase lock loop ( pll ) , ten 17-pair ( 34 pins ) lvds general purpose input output ( gpio ) ports , a 16 pin connector to the gps receiver , a a24d16 vme interface and a virtex ii fpga .",
    "+ each of these gpio ports has 16 lvds gpio signals to / from the fpga and the @xmath5 pair carries a 40 mhz clock signal , which is also an lvds signal .",
    "the direction of the gpio ports is switchable by changing the io driver chips .",
    "clock type hclock cards are made with two input ports and eight output ports .",
    "+ the fpga is mounted in a mezzanine card ( labeled as mez-456 in the picture ) . since the performance and the resources of the virtex ii family fpgas are adequate for the requirements of hawc , a virtex ii xc2v1000 - 4fg456 fpgas in our shop s spare stock was used .",
    "however , if a future upgrade needs to change the fpga , it can easily be done by simply designing a new mezzanine card . + the gps receiver is used to obtain the gps time and a 10 mhz sine wave signal .",
    "the internal pll of the clock type hclock card uses this 10 mhz sine wave signal to derive a low jitter 40 mhz digital clock signal and makes several exact copies that are delivered to the control type hclock card , to the fpga and to the @xmath5 signal pair of all the gpio connectors .",
    "this 40 mhz signal is used as the global clock signal of hawc .",
    "other than this sine wave , the gps receiver transmits a one pulse per second ( 1pps ) pulse stream and a set of data strings via the rs232 protocol .",
    "the rising edges of these 1pps pulses mark the top of each second .",
    "the firmware running inside the fpga uses this 1pps signal and the data strings to replicate the current gps time .",
    "+              a simplified functional block diagram of the clock firmware is shown in figure  [ clockfirmwareblockdiagram ] .",
    "this is a sequential logic design with several state machines implemented using vhdl .",
    "+ the gps receiver installed at the hawc site is configured to send three data strings followed by a 1pps pulse .",
    "these three strings ( polyt , gpgsa , and polyp ) are standard nmea 0183 strings , which carry the current gps time , gps receiver operating mode , number of visible satellites , and dilution of precision ( dop ) values .",
    "the first module of the firmware reads these serial strings and extracts the current gps time and the health information such as the gps fix status and dilution of precision .",
    "then the gps time and health information goes to the internal clock module , which is a continuously running 8 digit binary coded decimal ( bcd ) clock using the 40 mhz clock signal as the reference frequency . in this 8 digit clock",
    "the least significant digit is microseconds and the most significant digit is tens of seconds .",
    "this clock module also receives the 1pps signal , which is used to identify the top of each second . at the top of each second",
    ", the internal clock module compares its clock time with the gps clock time , and overwrites the internal clock if the times do not match and the gps receiver is in good health .",
    "this allows the timing system to have an internal clock that runs synchronously with the gps clock .",
    "the final stage of the firmware is to make a tdc readable timestamp in every @xmath6s interval , where @xmath6s can be configured to @xmath7s or @xmath8s .",
    "other than these major modules , the clock firmware has a vme module that handles an a24d16 vme interface and several fifos that are filled with gps health monitoring information .          the first 28 bits of the gtc timestamp are a 7 digit bcd value that carries the time in the format : 10s of s , 1s of s , 100s of milliseconds , 10s of milliseconds , 1s of milliseconds , 100s of microseconds and 10s of microseconds ( ss : mmm : uu ) .",
    "the remaining 4 bits are used to encode various errors that are encountered in the process of acquiring and encoding the timestamp .",
    "these error codes are defined in table 1 .",
    "the encoding of this timestamp to a tdc readable format is done using a simple algorithm .",
    "each bit is denoted by a pulse ; if a pulse is 1 @xmath0s wide it denotes a logic zero bit , if a pulse is 2 @xmath0s wide it denotes a logic one bit . as an example , the timing diagram shown in figure  [ exampletimestamp ] is the encoding for the time 12.34567 seconds with no errors .",
    "an encoding scheme of this type with pulses must be used because the tdcs are only sensitive to edges but not to logic levels .",
    "that is one can not just send the 28 raw binary bits with logic levels to the tdcs because most of the time , most of the lines will not make a logic transition during a trigger window ( @xmath9 ) .",
    "s wide pulse is used to indicate logic 0 , and a 2@xmath0s wide pulse is used to indicate logic 1 . ]",
    ".the errors corresponds to each timestamp is encoded into the 4 most significant bits of the timestamp .",
    "the meaning of each error code is shown . [ cols=\"^,<\",options=\"header \" , ]      every hawc event has a timestamp associated with it .",
    "this timestamp is constructed by combining three components : tdc timestamp , ntp timestamp , and trigger derived timestamp .",
    "tdc timestamp is the encoded timestamp that comes from the gtc system .",
    "these timestamps are sent to a tdc when the microseconds digit of the absolute clock time is 0 , for example when the absolute time is * * .****00 sec , * * .****10 sec , * * .****20 sec , etc .",
    "the tdc that records this encoded timestamp is also read out in the same way as the other tdcs , and the time stamp becomes a part of the main data stream .",
    "the tdc timestamp ( ss : mmm : uu ) rolls over every minute .",
    "hence , the low - resolution timestamp ( ` yyyy : mm : dd : hh : mm : ss ` ) needs to be combined with the raw hawc tdc data within one minute of the trigger time .",
    "this is done by the single board computers that read tdcs , which record the system time each time tdc readout is completed for a block of events .",
    "the computer system clock of the single board computers is synchronized via ntp time service to a local ntp time server . with the local ntp time server ,",
    "the absolute accuracy of the system clocks is in the millisecond range .",
    "the tdc timestamp , and the ntp timestamp of each event get combined together in the online reconstruction farm .",
    "when they are added , the tens of seconds and the seconds digits are coming from both the tdc timestamp , and the ntp timestamp .",
    "these two digits must be equal if both timestamps , tdc timestamp , and ntp timestamp , are accurate .",
    "therefore , we use this property as a sanity check to measure the accuracy of the timestamps .    as discussed before , the latency between an event trigger and the daq computer adding its time stamp to that event s data plus the uncertainty of the computer s system clock should together be less than one minute when the daq system is running normally . in the current configuration ,",
    "the sbcs initiate readout approximately every 6 milliseconds .",
    "the finest resolution timestamp is derived from the raw hawc tdc data itself .",
    "the raw hawc tdc data have a field called ` extended trigger time tag ' which contains the trigger arrival time ( @xmath10 ) relative to the last bunch counter reset ( crst ) with a precision of 800 ns . for each of the 28 tdc channels which corresponds to the tdc timestamp",
    ", there is a rising edge time measurement , again relative to the last tdc reset , lets call it @xmath11 where @xmath12 .",
    "now each of the 28 channels will provide a delta time measurement ( @xmath13 ) from the most recent rising edge of its input signal until the arrival of the trigger signal .",
    "+ @xmath14 + thus the finest resolution time is given by , + @xmath15 + the @xmath16 measured in this method has an accuracy of 0.1 ns(100 ps ) .",
    "in the final step , we construct the gps timestamp of the trigger by combining these three components :    gps time = ntp time + tdc time + @xmath16 .",
    "we thus have an accurate timestamp for the arrival time of the trigger signal .",
    "the absolute accuracy of this time stamp is 1 @xmath0s , which is the absolute accuracy of the tdc time , note that following a similar procedure we can measure all of the pmt signal edges with respect to the arrival of the trigger signal .",
    "the control system provides several services to hawc : 1 ) keep all tdcs working synchronously , 2 ) issue a synchronous trigger signal to the tdcs , 3 ) issue a scaler daq trigger signal called load next event ( lne ) and send the status of the detector to the scaler system .",
    "other than these major services , the control system also has a general purpose level shifter to shift signals from lvds to ecl and vice versa .",
    "the control system is made from two custom vme boards : a control type hclock card and a cb_fan card .",
    "the control type hclock card is a version of the hclock card with 6 input ports and 4 output ports .",
    "the control type hclock card also gets the 40 mhz global clock from the clock card .",
    "the cb_fan card is a 2 slots wide 6u vme-64x module , that is designed to provide appropriate level conversions and fan - outs for the control type hclock card - tdc interface .",
    "the cb_fan card does not perform any logic .",
    "a photograph of a fully assembled cb_fan card is shown in figure  [ cbfancard ] . +",
    "a schematic diagram of the connections between the clock type hclock card , control type hclock card , cb_fan card and the scaler system is shown in figure  [ controlcardschem ] . the input signal coming from the clock card is the 40 mhz global clock signal .",
    "the control type hclock card makes several copies of this 40 mhz clock signal and distributes it to the @xmath5 signal pair of all the gpio connectors and to the fpga .",
    "the interface between the control type hclock card and the scaler system consists of three outputs and one input : 10 mhz reference , pause pulses , busy pulses , lne ( the trigger signal for the scaler system ) and lne enable input .",
    "the 10 mhz reference is a continuous 10 mhz square wave signal output .",
    "the pause pulses produces a 10 mhz signal in - phase with the 10 mhz reference when the control system is in the pause state .",
    "the scaler system counts both of these signals .",
    "the ratio of the number of pause pulses to the number of 10 mhz reference pulses gives the fractional dead time of the detector enforced by the experiment control system .",
    "the functionality of the busy pulse output is similar to the pause pulses except busy pulses produce a 10 mhz signal when at least one tdc is filled to the almost full level .",
    "the load next event ( lne ) signal , a 100 hz clock , acts as a readout - start trigger for the scaler system .",
    "+ the control type hclock card interface to a cb_fan card consists of four output signals , 40 mhz , clr , crst and trig , and 16 input signals , 16 almost full .",
    "the four output signals are the tdc control - bus signals .",
    "the control card makes four identical copies of all output signals and can accept up to 64 inputs .",
    "therefore , one control type hclock card can be connected with four cb_fan cards .",
    "but the tdcs can not directly connect to the control type hclock card , because these i / os are lvds signals but the tdc control bus is compatible with only ecl signals .",
    "the cb_fan card is designed to provide level shifting between the hclock card lvds signals and tdc ecl signals .",
    "apart from the level shifting , the cb_fan card makes 6 identical copies of the 40 mhz , clr , crst and trig signals .",
    "the active edges of the trg , clr and crst signals are placed midway between the active clock edges .",
    "control firmware , control type hclock card hardware and cb_fan card hardware is designed obtain these signals synchronized to better than 12.5 ns .",
    "therefore , one cb_fan card can be used to control up to 6 tdcs .",
    "since one control type hclock card can interface with 4 cb_fan cards , the gtc system is capable of controlling up to 24 tdcs .",
    "+              a simplified functional block diagram of the control firmware is shown in figure  [ fig : controlfirmware ] .",
    "similar to the clock firmware , this firmware is also a sequential logic design implemented in vhdl .",
    "however , unlike the clock firmware individual modules of the control firmware are not connected in series .",
    "coordination of these modules is done through the vme module .",
    "+ the first module shown in figure  [ fig : controlfirmware ] is the trigger module , which coordinates the trigger signals that go to the tdcs .",
    "the trigger module can work in three modes : pause , periodic trigger , and external trigger . in the pause mode ,",
    "the trigger module does not issue any triggers . in the periodic trigger mode ,",
    "the trigger module issues a periodic trigger signal with a known frequency set by the vme module . in the external trigger mode ,",
    "the trigger module issues a trigger signal upon a request coming from the external trigger .",
    "this trigger mode is not currently used in hawc ; the potential usage of this functionality is discussed in section  [ sec : pottentialusage ] . in a typical data taking run of hawc",
    ", the trigger module runs in the periodic trigger mode with a trigger frequency of 40 khz . at the end of each run",
    "the hawc experiment control system sends a request via the gtc control software to the vme module to switch the trigger module to the pause mode .",
    "the 40 khz periodic trigger frequency was chosen because it is the optimum trigger frequency for the hawc daq system . however , this periodic trigger frequency can be changed by a request to the vme module from the hawc run control system .",
    "the clr and crst modules issue the clear and reset signals to the tdcs upon a request coming from the vme module .",
    "these requests originate in the run control system at the beginning of each run .",
    "+ the next three modules in figure  [ fig : controlfirmware ] provide the signals to the scaler system .",
    "the 10 mhz reference module is a 10 mhz square wave signal generator that generates a reference pulse stream to the scaler system .",
    "the functionality of the pause pulse module is equivalent to a multiplexer with two inputs and one output : logic lo input , 10 mhz square wave input and pause pulse output .",
    "when the trigger module is in the pause state , the pause pulse output switches to the 10 mhz square wave .",
    "when the trigger module is not in the pause state , the output switches to the logic lo level .",
    "the busy pulse module has a similar functionality , except that the selection between logic lo and 10 mhz square is done using the or of the almost full signals .",
    "if any of the almost full inputs are logic hi , the busy pulse output gets connected with the 10 mhz square wave , otherwise the output stays in the logic lo level .",
    "therefore , one can calculate the fraction of the time that hawc stays in the busy state using the ratio between busy pulses per run and 10 mhz square wave pulses .",
    "apart from the main features of the gtc system described above it is also able to support several other functionalities : external triggers , sbc readout signal and lvds control busses . at the present , hawc runs using a periodic trigger signal",
    "however , the gtc system is designed to support both the periodic trigger mode and the external trigger mode .",
    "+ the sbc read out signal is another currently unused feature of the gtc system . similar to the other signals this signal also comes from the control card and goes to the cb_fan card .",
    "the cb_fan card converts this signal to a single ended 3.3v logic level 110 ohm back terminated signal and makes 8 copies of them .",
    "the intention of this signal is to issue a read out request to the sbcs .",
    "one of the potential uses of this signal is to issue an sbc read out request when at least one tdc becomes almost full .",
    "+ besides the ecl signal tdc control buses , each cb_fan card also fans - out three copies of lvds control buses .",
    "this control bus signaling could drive the read out of additional devices such as pmt digitizers or external programed trigger modules .",
    "in order to check reliability of the gtc system , we made a test setup with two independent gtc systems and a tdc with an accuracy of 200 ps to record timestamps coming from both tdcs .",
    "if both gtc systems are reliable we expect them to produce identical timestamps for a given trigger .",
    "we collected data during 24 hours and did nt print any event with unequal timestamps .",
    "+ the health of the gtc system was continuously monitored from early 2013 , and we found that the 1pps signal had a jitter , less than 50 ns , with respect to the 10 mhz output . each time the 1pps moved more than 25 ns it caused an overwrite of the clock firmware s internal clock from the gps clock .",
    "therefore , this jitter produced error flags in the timestamps .",
    "the average rate of this error flag is 11 per hour .",
    "this jitter introduced an upper limit of 25 ns accuracy to the gtc generated timestamp .",
    "however , the 25 ns accuracy is well below the required accuracy of 1@xmath0s for hawc .",
    "navsynch builds a new gps module with an internal phase lock to lock the 1pps and 10 mhz outputs .",
    "however , the present gps module is sufficient for hawc s requirements .",
    "the hawc gamma ray observatory equipped with a fully functional gtc system started its first phase , with 30 tanks , in november of 2012 .",
    "the pmt signals were digitized using a caen vx1190a tdc .",
    "apart from the pmt signals the clock system generates a 32 bit timestamp encoded in a 32 channel pulse pattern , which is similar to the tot signals of the pmt output signals after the febs .",
    "these 32 signals were digitized using another caen vx1190a tdc .",
    "both tdcs were read out by their own sbcs via a vme back plane and the data is transferred to the online reconstruction farm via an ethernet connection . in the online reconstruction farm the timestamp and",
    "the pmt data that correspond to the same event ids are combined to form a single event . after combining these two parts ,",
    "the online reconstruction software decodes the timestamp . + in order to make tdcs work synchronously ,",
    "the control system delivers two identical copies of a 40 mhz clock signal and the trigger signal to tdcs . since the online reconstruction process uses the event i d to combine the pmt data with the timestamp , it is a must to maintain a unique event i d to event fragments that correspond to a given trigger .",
    "therefore , at the beginning of each run the gtc system issues a clear ( clr ) signal to reset the event i d counters .",
    "the gtc system also issues a reset ( crst ) signal at the beginning of each run to reset all the other counters in tdcs .",
    "+ the health monitoring of the gtc system was continuously done from early 2013 and it reveals that the accuracy of the timestamps produced by the gtc system has an upper limit of 25 ns . however , the 25 ns accuracy is well below the required accuracy of 1@xmath0s for hawc .",
    "+ when hawc is completed in 2015 , it will have 300 tanks instrumented with 4 pmts per each tank .",
    "this will increase the number of tdcs required to record pmt signals up to 10 , and another tdc will be used to record timestamps . therefore , the completed hawc will be instrumented with 11 tdcs .",
    "the gtc system with two cb_fan cards will be able to match this requirement .",
    "we would like to give our special thanks to everyone in the hawc collaboration who helped us to design and build the gtc system .",
    "funding for the gtc system construction was provided by the nsf hawc construction grant , phy 1002546 , via a subcontract with the university of maryland , and nsf hawc grants phy 0901973 and phy 1002432 ."
  ],
  "abstract_text": [
    "<S> the design and performance of the gps timing and control ( gtc ) system of the high altitude water cerenkov ( hawc ) gamma ray observatory is described . </S>",
    "<S> the gtc system provides a gps synchronized absolute timestamp , with an accuracy better than 1@xmath0s , for each recorded event in hawc . in order to avoid any slack between the recorded data and the timestamp , </S>",
    "<S> timestamps are injected to the main data acquisition ( daq ) system after the front - end electronic boards ( febs ) . </S>",
    "<S> when hawc is completed , the hawc main daq will use 10 time to digital converters ( tdcs ) . in order to keep all the tdcs in sync , </S>",
    "<S> the gtc system provides a synchronized clock signal , coordinated trigger signal , and control signals to all tdcs .    </S>",
    "<S> gps timestamp , gamma - ray astrophysics , water cherenkov detector , time to digital converter , tev astronomy </S>"
  ]
}