{
  "article_text": [
    "cosmic structure is formed by the gravitational amplification of initially small density fluctuations present in the early universe . a fluctuation containing the mass of the milky way galaxy will collapse by a factor of @xmath2 in size before it comes into dynamical equilibrium . in order to adequately resolve its internal structure ,",
    "another two orders of magnitude of spatial resolution _ per dimension _ are needed , at a minimum , for a total spatial dynamic range @xmath3 .",
    "resolving the formation of individual stars in an entire galaxy would require vastly more resolution : @xmath4a seemingly unreachable goal .",
    "n - body tree codes are widely used in numerical cosmology to achieve high spatial dynamic ranges in general 3-d evolutions , and some parallel implementations have won past gordon bell awards @xcite .",
    "the largest cosmological n - body simulation used just over @xmath5 particles and achieved a @xmath6 @xcite .",
    "the highest dynamic range n - body simulation achieved @xmath7 with substantially fewer particles @xcite .",
    "these calculations simulate only the collisionless cold dark matter ( cdm ) which dominates the gravitational dynamics of structure formation .",
    "we are interested in simulating the formation of cosmic structures including the all  important baryonic gas which forms the visible galaxies .",
    "our original design goal was to achieve @xmath8 , a mark which we have far surpassed . in this paper we describe the enzo cosmological adaptive mesh refinement ( amr ) code we have developed for parallel computers and its application to a simulation of the formation of the first stars in the universe .",
    "the time - dependent calculation is carried out in full 3-d on a structured adaptive grid hierarchy which follows the collapsing protogalaxy and subsequent protostellar cloud to near stellar density starting from primordial fluctuations a few million years after the big bang .",
    "more than 8000 subgrids at 34 levels of refinement are generated automatically to achieve a final spatial and temporal dynamic range of @xmath0 ( for comparison , @xmath0 is roughly the ratio of the diameter of the earth to the size of a human cell ) .",
    "it is the highest dynamic range 3-d simulation ever carried out in astrophysics .",
    "the calculation incorporates all known relevant dynamical , chemical , and thermodynamic processes and is carried out in a proper expanding cosmological background spacetime .",
    "enzo combines an euler solver for the primordial gas @xcite , an n - body solver for the collisionless dark matter @xcite , a poisson solver for the gravitational field @xcite , and a 12-species stiff reaction flow solver for the primordial gas chemistry @xcite .",
    "the latter is needed to determine the nonequilibrium abundance of molecular hydrogen which dominates the radiative cooling of the gas .",
    "this system of equations is solved on every level of the grid hierarchy with full two - way coupling , making it one of the most complex amr simulations ever carried out .",
    "adaptive mesh refinement allows us to resolve locally all the important length and timescales everywhere within the gravitationally collapsing cloud at all times , giving us confidence that our results are accurate .",
    "the calculation is effectively an _ ab initio _ simulation of star formation which connects initial conditions to the final state in full generality .    in this paper , we concentrate on the technical and performance aspects of the amr code , but also discuss some of the exciting astrophysical results we have obtained . as we will see , achieving extreme resolution is more a matter of high performance data structures and extended precision arithmetic than raw gigaflops , although the latter is certainly needed .",
    "the physics of present - day star formation is complicated and fraught with uncertainties .",
    "this is due to the relative complexity of the interstellar medium : it is composed primarily of hydrogen and helium but also contains heavier elements which are important for radiative cooling and heating . in addition , there are dynamically important magnetic fields , radiative backgrounds and uncertain initial conditions .",
    "in contrast , the formation of the first star takes place in a much simpler environment : the gas composition is essentially just hydrogen and helium ( since heavier elements are formed inside stars ) , there is no important radiative source , the magnetic fields are most likely insignificant and  most importantly  the initial conditions are precisely specified by cosmological models .",
    "this makes primordial star formation a clean initial value problem in which we can include , from first principles , all of the relevant physical processes .",
    "moreover , the problem is extremely important  it provides the starting point for the formation for all other structure in the universe , from galaxies to superclusters .",
    "the combination of all of these elements is rare in physics , and efforts to solve the problem date back over three decades .",
    "however , progress has been difficult because of the extreme multi - scale nature of the problem , as discussed in the introduction . in the following , we review the physical ingredients which are required to solve this problem , emphasizing the numerical implications .      in modern cosmological models ,",
    "cold dark matter ( cdm ) dominates the dynamics of structure formation because its mass density exceeds that of the ordinary baryonic material by a factor of ten or more .",
    "although the composition of cdm is unknown , its cosmologically relevant properties ",
    "its mean density and the functional form of its power spectrum of density fluctuations @xmath9are known or are calculable once a friedmann `` world '' model is specified .",
    "we simulate a `` standard '' cdm model which means that the cosmological parameters and the amplitude of the power spectrum are those that have been shown to reproduce the statistical properties of galaxies and clusters of galaxies in the present universe @xcite .",
    "the cdm power spectrum has the interesting property that _ rms _ density fluctuations are logarithmically divergent on small mass scales , implying that structures form hierarchically from the bottom - up : small gravitational condensations form first which then merge to form larger , more massive , objects later on .",
    "this merging behavior is captured numerically by combining an n - body technique , to follow the motion of the collisionless dark matter particles , with a poisson solver , to compute the self - gravity of the dark matter ( and the gas ) .",
    "but when does collapse to high density occur ?",
    "how does it proceed ? and what kind of astrophysical object is produced ?      in order to answer these questions , we need an accurate description of the thermal state of the gas",
    ". the fluid equations plus the ideal gas law ( and poisson s equation ) describe the evolution of the gas density , velocity and energy , but require knowledge of the radiative heating and cooling rates .",
    "this , in turn , depends on the chemical composition .",
    "the primordial gas contains about 76% hydrogen and 24% of helium ( trace amounts of deuterium and lithium play no important role here ) .",
    "for such a gas , and for temperatures below @xmath10 k , the primary cooling agent is molecular hydrogen , which has rotational and vibrational excited states than can be collisionally excited .",
    "because the cosmological background density of baryons is small , chemical reactions in the smooth background gas occur on long timescales . as a consequence chemical equilibrium is rarely an appropriate assumption .",
    "the number of possible chemical reactions involving h@xmath11 is large , even in the simple case of metal free primordial gas .",
    "we have tediously selected the dominant reactions and collected the most accurate reaction rates available @xcite .",
    "we solve the time dependent chemical reaction network involving twelve species ( including deuterium and helium ) . a fast numerical method to solve this set of stiff ordinary differential equations",
    "has been developed by some of us @xcite .",
    "once the chemical state is known , we must determine the radiative cooling rate . for densities encountered in the collapsing cloud ,",
    "it is accurate to assume the gas is optically thin and only consider excitations from atomic and molecular ground states .",
    "we include all known radiative loss terms due to atoms , ions , and molecules that are appropriate for our primordial gas . also the energy exchange between the cosmic microwave background and free electrons ( compton heating and cooling ) is included .",
    "to solve the star formation problem using a traditional static , uniform mesh is simply not feasible . even assuming a continuation of moore s law in its present form",
    ", it would not be until about 2200 that a problem of this dynamic range could even fit into memory of the largest systems .",
    "the solution method that we adopt is structured adaptive mesh refinement ( samr : @xcite ) , because it : ( 1 ) is spatially- and time - adaptive , ( 2 ) uses accurate and well - tested grid - based methods for solving the hydrodynamics equations , and ( 3 ) can be well optimized and parallelized . in this section",
    ", we describe our implementation ; more details are available elsewhere @xcite .",
    "the central idea behind samr is deceptively simple .",
    "while solving the desired set of equations on a uniform grid , monitor the quality of the solution ; when necessary , add an additional , finer mesh over the region that requires enhanced resolution .",
    "this finer ( child ) mesh obtains its boundary conditions from the coarser ( parent ) grid or from other neighbouring ( sibling ) grids with the same mesh spacing .",
    "the finer grid is also used to improve the solution on its parent .",
    "as the evolution continues , it may be necessary to move , resize or remove the finer mesh .",
    "even finer meshes may be required , producing a tree structure that may continue to any depth .",
    "we show an example of this for the two - dimensional case in figure  [ fig : amr_overview ] .",
    "each level up the hierarchy decreases the mesh spacing relative to its parent by a factor @xmath12 ( the refinement factor ) .",
    "therefore , if we define the resolution ( or sdr ) as the ratio of the length of the entire region to the cell spacing , the resolution at a level @xmath13 is given by @xmath14 , where @xmath15 is the number of cells in the root grid .",
    "there are a number of things to note about this algorithm .",
    "first , in order to be efficient , the covering fraction of the refined meshes must be relatively small . for our problem the covering fraction of the most refined grids",
    "is extremely small , approximately @xmath16 ( nevertheless , this is by far the most interesting region ! ) .",
    "second , the refinement factor is constrained to be an integer so that meshes can be aligned , making communication between grids easier and more accurate .",
    "in addition , the subgrids must be rectangular and completely contained within their parents .",
    "third , the finer mesh is in addition to , not instead of , the coarse mesh it covers . at first",
    "this seems wasteful ; however , the overhead is quite small and there are significant advantages .",
    "the individual grids remain uniform , so we can use off - the - shelf solvers .",
    "also , since the timestep constraint depends on the mesh spacing , the uniform ( coarse ) mesh has a uniform ( large ) timestep , thus naturally permitting multiple timesteps at different levels .      to advance our system of coupled equations in time as represented on this hierarchy",
    "requires some care .",
    "the overall control algorithm is quite similar to that used for a single grid .",
    "the heart of the algorithm is the recursive evolvelevel routine which is passed the level it is to work on and the new time :    .... evolvelevel(level , parenttime ) begin    setboundaryvalues(all grids )    while ( time < parenttime )    begin      dt = computetimestep(all grids )      solvehydroequations(allgrids , dt )      time + = dt      setboundaryvalues(all grids )      evolvelevel(level+1 , time )      fluxcorrection      projection      rebuildhierarchy(level+1 )    end end ....    the interior loop is used to advance the grids on this level from time ( the time at their current state ) to parenttime ( the time to which the parent grids have been advanced ) .",
    "inside this loop there is a recursive call so that all finer levels are advanced as well .",
    "the resulting order of timesteps is like the multigrid w cycle , as shown in figure  [ fig : timesteps ] .",
    "we treat each grid as its own self - contained unit , so that each routine in the pseudo - code above is applied to all the grids on a given level . as with any hyperbolic equation ,",
    "we first need to set the boundary conditions on the grids . for the root grid",
    ", we use a predefined boundary condition ( periodic in this case ) , while for finer grids , a two step procedure is used :    1 .",
    "all boundary values are first interpolated from the grid s parent .",
    "grids which border other grids on the same level ( i.e. siblings ) use the solution from the sibling grid .",
    "this ensures that all boundary values are set using the highest resolution solution available .",
    "once the boundary values have been set , it s straightforward to solve the equations of hydrodynamics on a grid . because it is a cartesian rectangular grid , we can use highly - optimized solvers .",
    "we have implemented two : the piecewise parabolic method ( ppm ) @xcite modified for use in cosmological hydrodynamics @xcite , as well as a robust finite difference technique @xcite .",
    "this allows us a double check on any result .",
    "a disadvantage to such a hierarchy is that we must ensure consistency in regions which are represented by both coarse and fine meshes .",
    "this involves two steps : the first is to correct the coarse fluxes ( of conserved quantities ) at subgrid boundaries to reflect the improved flux estimates from the subgrid .",
    "this is required to ensure mass , momentum and energy conservation as material flows into and out of a refined region .",
    "the second step , termed _ projection _ , updates the solution on the coarse mesh points which are covered by finer meshes .",
    "taken together , these two steps represent one side of the two - way communication between parent and child grids ( the other side being boundary interpolation from parent to grid ) .",
    "the final part of the evolvelevel routine adapts the grid hierarchy to the new solution .",
    "the rebuildhierarchy procedure modifies ( `` rebuilds '' ) the grids on the specified level and higher .",
    "this involves three steps :    1 .",
    "a refinement test is applied to the parent grids of the current level , resulting in a boolean field indicating if this mesh point needs to be refined .",
    "rectangular regions are chosen which cover all of the refined regions , while attempting to minimize the number of unnecessarily refined points .",
    "this is done with an edge - detection algorithm from machine vision studies @xcite .",
    "finally , the new grids are created and their values are copied from the old grids on the same level where possible , or are otherwise interpolated from the parent grids .",
    "the old grids are then deleted , freeing their memory .",
    "this process is repeated on the next refined level , until the entire hierarchy has been rebuilt .",
    "this is both easier and more effective than moving and resizing the grids , and still only takes about 10% of the overall cpu time .      in this application",
    ", there are three criteria used to determine when refinement is required . since gravitational collapse causes mass to flow into a small number of cells , the first two",
    "are designed to preserve a given mass resolution in the solution .",
    "we define a threshold @xmath17 such that whenever a cell accumulates at least this much mass , it is refined .",
    "this is done separately for the gas and the dark matter component .",
    "the third refinement criterion ensures that all possible collapsing fragments are resolved .",
    "more specifically , we require that the cell width be less than some fraction of the local jeans length ( @xmath18 ) , the smallest perturbation which is unstable to gravitational collapse .",
    "we have varied @xmath19 , the number of cells across the local jeans length , from 4 to 64 without seeing a significant difference in the results .      to simulate a system such as a collapsing star",
    ", we must also solve the elliptic poisson equation on the hierarchy . on the root grid , this is done with an fft which naturally provides the periodic boundary conditions required . on subgrids",
    ", we interpolate the gravitational potential field and then solve the poisson equation using a traditional multi - grid relaxation technique . in order to produce a solution that is consistent across the boundaries of sibling grids , we use an iterative method : first solving each grid separately , exchanging boundary conditions , and then solving again .",
    "in contrast to the familiar baryonic fluid , the dark matter is pressureless and collisionless , only interacting via gravity .",
    "therefore , it is not appropriate to use the fluid equations ; rather , we solve for the individual trajectories of a representative sample of particles .",
    "this we do using particle - mesh techniques specially tailored to adaptive mesh hierarchies .",
    "this adds another layer of complexity to the software , the details of which are discussed elsewhere @xcite .",
    "finally , as discussed earlier , the cooling of the primordial star is controlled by the formation of molecular hydrogen .",
    "therefore , we need to follow the chemical evolution of various ionized states of hydrogen , helium , deuterium , and molecular hydrogen , twelve in all .",
    "this coupled set of ordinary differential equations can be solved independently for each grid point . because the equations are stiff , we use a backward finite - difference technique for stability , sub - cycling within a fluid timestep for additional accuracy @xcite .",
    "the code is implemented in c++ , with compute - intensive kernels in fortran 77 .",
    "an object oriented approach provides a number of benefits .",
    "the first is encapsulation : a grid represents the basic building block of amr .",
    "we have defined a series of atomic and binary operations that perform functions such as solving a certain set of equations on a grid or interpolating from one grid to another .",
    "this greatly simplifies the control algorithms .",
    "the second is extensibility : adding new equations is generally a matter of adding a few methods to a grid class and a few lines to the control algorithm .",
    "efficiently parallelizing samr is difficult , particularly for distributed memory systems .",
    "grids have a relatively short life , so information must be updated frequently .",
    "moreover , load balancing becomes a serious headache since small regions of the original grid eventually dominate the computational requirements .",
    "as a first attempt , we tried compiler - based parallelization ( a predecessor to openmp ) . using pragmas , we identified large - grained loops that performed operations over entire grids .",
    "this was successful for a relatively small number of processors ( 8 - 16 ) , but could not be extended to distributed memory systems , such as clusters of pcs . to adapt to these machines",
    ", we developed an mpi version that exploited the following optimization techniques :    * _ distributed objects_. we leveraged the object - oriented design by distributing the objects over the processors , rather than attempting to distribute an individual grid .",
    "this makes sense because the grids are generally small ( @xmath20 ) and numerous ( sometimes in excess of 50,000 grids ) .",
    "this had the added benefit of ease of coding : we simply added a small number of communication primitives to the class methods . *",
    "_ sterile objects_. although distributing the objects results in good load balancing , it can greatly increase the amount of communication since each processor has to probe other processors to find potential neighbours .",
    "we solved this problem by creating a type of object which contained information about the location and size of a grid , but did not contain the actual solution .",
    "these sterile objects are small and so each processor can hold the entire hierarchy . only those grids which are local to that processor are non - sterile .",
    "this means that almost all messages are direct data sends ; very few probes are required . * _ pipeline communications_. one result of distribution is that all binary operations ( e.g. obtaining boundary values ) are potentially non - local .",
    "however , a given stage of the calculation generally involves many sends . we optimize this by dividing each stage into two steps .",
    "first , all of the data ( such as boundary values ) are processed and sent . since all processors have the location of all other grids locally ( thanks to the sterile objects ) , we can order these sends such that the data that are required first are sent first . then , in the receive stage , the data needed immediately have had a chance to propagate across the network while the rest of the sends were initiated .",
    "this was implemented through the use of mpi s asynchronous communication mode , and resulted in a large decrease in wait times .      performing a simulation with such extreme dynamic range",
    "presents unique difficulties .",
    "one of these is simply the requirement of being able to accurately describe the positions of grids and particles within the problem domain . at a minimum",
    ", we must be able to distinguish between the two locations @xmath21 and @xmath22 , where @xmath23 is the minimum grid spacing .",
    "this implies a precision of at least @xmath24 ( in fact we require roughly 100 times larger than this because of various mathematical operations which are applied to this ratio ) .",
    "therefore , we need 128 bit precision . unfortunately , this is not always available and when available , we often suffer a large performance penalty .",
    "for example , the gnu fortran compilers does not support 128 bit precision .",
    "the sgi compiler on the origin2000 does provide 128 bit arithmetic , but is some 30 times slower than 64 bit .",
    "the rs/6000 compiler on the sp2 allows 128 bit precision , but only as an extra compiler option , so libraries ( such as mpi ) must be re - compiled .",
    "one option for dealing with this issue is to develop routines which use native 64 bit arithmetic to perform 128 bit operations , circumventing patchy native support .",
    "recent work @xcite in this direction appears to be quite successful and we are examining the possibility of adopting this method .",
    "whichever approach is taken , it is clear that the use of 128 bit arithmetic should be kept to a minimum because of its impact on operation count , memory consumption and interprocessor message size . throughout the code , we have identified only those operations which require high precision . these correspond to operations involving absolute position and time , as opposed to relative location ( o(@xmath25 ) ) .",
    "most grid atomic operations can be entirely written in terms of relative position and time , and hence low precision .",
    "this reduced the total high - precision operation count to @xmath26 of the total , resulting in considerable speed ( and memory ) improvements .",
    "in the calculation discussed in this paper , we have set up a three dimensional volume that is 256 comoving kiloparsec ( kpc ) on a side ( 1 parsec is 3.26 light years , roughly the distance to the sun s nearest neighbour ) .",
    "we set up the initial conditions a few million years after the big bang , using an inflation - inspired cosmological model .",
    "we first run a low - resolution ( @xmath27 ) simulation to determine where the first star will form and then restart the calculation including three additional levels of static meshes , covering the region from which the star will form ( equivalent to @xmath28 initial conditions over the entire box ) .",
    "this allows us to increase mass resolution in this region by a large factor ( 512 ) and capture as many small - wavelength modes in the initial conditions as possible .",
    "we have experimented with using only two additional levels and find it has little effect on the overall evolution of the object .",
    "we have also carried out a number of experiments varying the refinement criteria and find the results described here are quite robust .",
    "a series of earlier amr simulations at increasing resolutions have revealed the following results . a simulation with @xmath29 @xcite showed that at redshifts of @xmath30 ( approximately 150 million years after the big bang ) primordial gas becomes gravitationally bound to dark matter condensations with characteristic mass of few @xmath31 m@xmath32 ( solar masses ) .",
    "non - equilibrium chemical reactions form @xmath33 from primordial hydrogen in the cores of these clumps in sufficient concentrations to cool the gas down to a few hundred k via molecular line radiation . a simulation with @xmath34 @xcite showed the onset of gravitational instability in this cool gas and the formation of a collapsing protostellar core .",
    "the mass of the collapsing cloud was a few hundred solar masses .",
    "most recently , a simulation with @xmath35 @xcite resolved the supersonic accretion flow onto a central , fully molecular protostellar core , confirming the resulting star would be much more massive than the sun .",
    "the simulation reported here attempts to follow the protostar s collapse to stellar density , which we estimate will require @xmath36 . as of current writing , we have achieved @xmath37 we find a rapidly accreting protostar that will form a single massive star with a mass of order one hundred times that of our own sun .",
    "such a large star will explode as a supernovae , generating the very first heavy elements in the universe . in figure",
    "[ fig : density_zoom ] , we show a zoom into the forming star . at this stage",
    ", the protostar is still collapsing and not yet spherical since gravity still overwhelms internal pressure .",
    "we highly encourage readers to view the animated version of this zoom at www.tomabel.com/gb/movies.html .",
    "although the cloud and protostar are not spherical , it is instructive to plot in figure  [ fig : five ] radial profiles of mass - weighted spherical averages of various quantities for seven illustrative times of the evolution . at the first output time shown ( marked z=19 ) , about 700 @xmath38 have cooled below 200 kelvin at the center of the protogalactic halo of mass @xmath39 . from the radial velocity profiles it is evident that cooling gas behind the accretion shock ( at @xmath40 pc ) falls onto this cooled central material .",
    "this cold central region within @xmath41 pc is the high redshift analog of a present day molecular cloud despite its minute molecular mass fraction of @xmath42 ( see panel c of figure  [ fig : five ] ) .",
    "as the evolution continues ( the second output time shown in figure  [ fig : five ] ) the total mass of the proto - galactic object has grown to @xmath43 at @xmath44 .",
    "the primordial `` molecular cloud '' contains now @xmath45 . at the same time a central core of @xmath46 starts to become warmer ( @xmath47 k ) within the `` molecular cloud '' and shows small radial velocities . for this central core",
    "the radial velocities and temperatures are seen to increase monotonically as time goes on .",
    "the molecular mass fraction also starts to increase slightly .",
    "when the central densities exceed @xmath5 @xmath48 three  body h@xmath11 formation shows its effect in binding atomic hydrogen to molecules . at central densities",
    "@xmath49 @xmath48 atomic and molecular hydrogen exist in similar abundance .",
    "this enhanced molecular fraction which decreases the cooling time is the reason for the observed central temperature drop ( see panel d of figure  [ fig : five ] ) .",
    "interestingly , the inner @xmath50 shows similar thermal evolution and start to collapse more rapidly than its surrounding .",
    "in fact as can be seen in panel e of figure  [ fig : five ] it eventually starts to contract faster than the local sound speed . before this dynamical collapse all",
    "the cooling gas has been settling to the center with sound crossing times shorter than or equal to the dynamical times , and long cooling times .",
    "i.e. the contraction proceeds quasi  hydrostatically until 3 body h@xmath11 formation turns the gas fully molecular . during this slow contraction phase",
    "sound waves damp sub ",
    "jeans density perturbations in the baryons yielding a rather smooth gas distribution prior to the onset of 3 body h@xmath11 formation .",
    "the time - scales become as short as weeks for the densest material followed in the simulations .",
    "we have not observed any signs of fragmentation by examining the three  dimensional density field of the final output time .",
    "although the protostar has not yet reached stellar density , we conclude that a single massive star will ultimately form .",
    "our primary interest is not raw performance , but rather the complexity and difficulty of the problem and the algorithm .",
    "therefore , we first examine some characteristics of the resulting grid hierarchy .    in the top two panels of figure  [ fig : grids ] ,",
    "we show how the grid hierarchy grows as time progresses .",
    "note the slow increase in the number of grids as the proto - star condenses and the final , very sudden jump in the depth of the grid tree at the end when the core of the cloud collapses to high density .",
    "this demonstrates how the data structures themselves adapt to fit the physical solution .",
    "note also the extremely large number of memory allocations and frees , since the entire grid hierarchy is rebuilt thousands of times .",
    "this kind of method represents a new class of scientific computing that place great strain on the operating system infrastructure .",
    "total memory usage is also substantial , often reaching up to 20 gb . with outputs in the 2 - 4 gb range ,",
    "we require at least 50 - 100 gb disk storage and much more mass storage space .    in the bottom two panels of this figure ,",
    "we have chosen two representative times and plotted the distribution of grids per level . at early times ,",
    "most of the grids are at moderate levels , representing the fact that relatively low resolution is sufficient to model the proto - stellar cloud . however , at late times , as the proto - star forms , a large investment is required at the very highest levels of resolution .",
    "finally , we turn to the raw performance of the code . because of the adaptive nature of the algorithm it is difficult to determine an over - all flop rate for the entire computation .",
    "one solution to this problem would be to instrument each module to return its operation count ( which depends on such factors as the grid size , particle number , and other parameters , as well as the solution itself in the case of some modules ) .",
    "then we could simply add up the count returned by all the modules .",
    "however , the code is nearly 100,000 lines , so this remains a future project .    in the meantime , we have estimated the flop rate in the following way .",
    "we have used the hardware floating - point counter on the sgi origin2000 to determine the total floating point operation count for a portion of the simulation ( drawn from near the middle of the run , which should be representative ) . in doing so",
    ", we have been careful to use only 64 bit precision , rather than 128 bit ( this somewhat affects the accuracy of the result but because it is only used for timing this is not a concern ) .",
    "then , when we run the calculation on our production machine , the blue horizon sp2 system at the san diego supercomputer center , we use full 128 bit precision and measure the wall clock time for this same portion of the simulation .",
    "this ensures that the operation count employs a widely - used standard ( the hardware counter on the r10000 processor ) , while the timing reflects the use of 128 bit precision .",
    "this provides a conservative estimate of the flop rate since we treat 128 bit operations as a single operation , even though the hardware itself may not do so .",
    "given this operation count coupled with the measured wall clock time running on 64 processors of the blue horizon sp2 , produced a total speed of approximately 13 gflop / s .",
    "since most of the run was done on 64 processors and the section timed is representative of the entire calculation , this represents our estimate of the sustained performance .    as an exercise",
    ", we can also ask how long this calculation would have taken with a traditional static grid code and compute an effective or virtual flop rate . to do this , we assume a grid with @xmath0 cells on each side , and assume the entire calculation would have taken ( quite conservatively ) @xmath51 timesteps .",
    "this works out to approximately @xmath52 floating point operations .",
    "since the entire calculation took of order @xmath53 seconds , this converts to a virtual flop rate of @xmath54 flop / s .",
    "we stress that this result has been achieved by optimizing all stages of the calculation .",
    "since we solve a number of different kinds of equations with various techniques , it is instructive to examine the relative time taken by each part . in the table below , we examine the fractional part of the compute time taken by each of the following science components : ( a ) the hydrodynamics solver , ( b ) the gravity solver , ( c ) the chemistry solver , ( d ) the particle solver for the dark matter , as well as a few major parts of the amr structure . we stress that these are fractions of the compute time which , for our 64 processor run , represents approximately 60% of the total wall clock time ,",
    "the other 40% being consumed by communication and imperfect load balancing .",
    "more detailed analysis of this code ( on other problems ) has been performed elsewhere @xcite .",
    "[ cols=\"<,^\",options=\"header \" , ]",
    "beyond simply running the simulation , we have also faced major challenges in data analysis and visualization of these large dynamic range simulations .",
    "our analysis routines have had to be implemented in parallel to hold the gigabytes of data in memory on available systems .",
    "these routines facilitate finding collapsed objects and other regions of interest .",
    "they range from computing direct hydrodynamical quantities , such as temperatures and densities , to derived quantities like cooling times , two  body relaxation times ,",
    "x  ray luminosities and inertial tensors .",
    "to study flattened objects such as galactic or proto stellar disks versatile routines to find such objects and derive projections , surface densities and other useful diagnostic quantities were created or modified so that they understood the structure of the hierarchy .",
    "visualization has proven equally involved . to allow interactive exploration of the full data sets on available systems we developed jacques , a gui - based visualization tool which allows simultaneous interactive analysis of tens of thousands of grids of the amr hierarchy on modest memory machines .",
    "jacques is implemented in the interactive data language ( idl ) , and was used to produce the images in fig .  [",
    "fig : density_zoom ] .",
    "the hundred solar radii protostar in our computational volume is tiny compared to a needle in a haystack and navigation techniques had to be devised to simplify the identification of regions of interest and to visualize slices and projections of them ( jacques has a `` zoom in by @xmath51 button '' ! ) .",
    "other features include velocity fields , isosurfaces , and a preliminary volume renderer .",
    "we have presented results on the highest - resolution 3-d computational fluid dynamics simulation yet performed , achieving a spatial dynamic range of @xmath0 in the region of interest .",
    "the simulation breaks new ground in the complexity of the method and the realism of the result . on the computational front",
    ", we solve a series of coupled partial and ordinary differential equations with a range of techniques , in parallel , on a hierarchy of 34 levels containing nearly 10,000 grids . from an astrophysical point of view",
    ", we have performed a long sought feat : the _ ab initio _ simulation of one of the first stars in the universe .",
    "put together , we argue that this represents a watershed in scientific computing .",
    "we acknowledge support from nsf grant ast-9803137 .",
    "support for glb was provided by nasa through hubble fellowship grant hf-01104.01 - 98a from the space telescope science institute , operated by the association of universities for research in astronomy , inc .",
    ", under nasa contract nas6 - 26555 .",
    "we gratefully acknowledge the support of the san diego supercomputing center .",
    "bryan and m.l .",
    "norman , `` a hybrid amr application for cosmology and astrophysics , '' in i m a volume 117 on _ structured adaptive mesh refinement ( samr ) grid methods _ , eds .",
    "baden , n.p .",
    "chrisochoides , d. gannon , and m.l .",
    "norman , ( springer : new york ) , pp .",
    "165 - 170 ( 2000 ) ."
  ],
  "abstract_text": [
    "<S> as an entry for the 2001 gordon bell award in the `` special '' category , we describe our 3-d , hybrid , adaptive mesh refinement ( amr ) code _ enzo _ designed for high - resolution , multiphysics , cosmological structure formation simulations . our parallel implementation places no limit on the depth or complexity of the adaptive grid hierarchy , allowing us to achieve unprecedented spatial and temporal dynamic range . </S>",
    "<S> we report on a simulation of primordial star formation which develops over 8000 subgrids at 34 levels of refinement to achieve a local refinement of a factor of @xmath0 in space and time . </S>",
    "<S> this allows us to resolve the properties of the first stars which form in the universe assuming standard physics and a standard cosmological model . achieving _ </S>",
    "<S> extreme resolution _ requires the use of 128-bit extended precision arithmetic ( epa ) to accurately specify the subgrid positions . </S>",
    "<S> we describe our epa amr implementation on the ibm sp2 blue horizon system at the san diego supercomputer center .    </S>",
    "<S> # 1@xmath1 # 1_#1 _    # 1_#1 _ # 1_#1 _ =    # 1 1.25 in .125 in .25 in    keywords : parallel algorithms , adaptive mesh refinement , numerical cosmology </S>"
  ]
}