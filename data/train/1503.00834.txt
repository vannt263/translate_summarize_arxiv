{
  "article_text": [
    "turbulent convection is ubiquitous in stars and planets . in intermediate - mass stars like the sun",
    ", convection acts with radiation to transport the energy generated by fusion in the core to the surface where it is radiated into space . in short , convection enables the sun to shine",
    ". it also redistributes angular momentum , establishing differential rotation ( equator spinning about 30% faster than the polar regions ) and meridional circulations ( with poleward flow near the surface ) . furthermore , turbulent solar convection and the mean flows it establishes act to amplify and organize magnetic fields , giving rise to patterns of magnetic activity such as the 11-year sunspot cycle .",
    "other stars similarly exhibit magnetic activity that is highly correlated with the presence of surface convection and differential rotation @xcite .",
    "stars are hydromagnetic dynamos , generating vibrant , sometimes cyclic , magnetic activity from the kinetic energy of plasma motions .",
    "perhaps the biggest challenge in modeling solar and stellar convection is the vast range of spatial and temporal scales involved .",
    "solar observations reveal a network of convection cells on the surface of the sun known as granulation @xcite .",
    "each cell has a characteristic size of about 1000 km and a lifetime of 10 - 15 min .",
    "however , in order to account for the differential rotation and cyclic magnetic activity of the sun , larger - scale convective motions must also be present , occupying the bulk of the convection zone that extends from the surface down to 0.7 @xmath0 where @xmath0 is the solar radius @xcite .",
    "these so - called `` giant cells '' have characteristic length and time scales of order 100,000 and several weeks respectively .",
    "below the convective zone lies the convectively stable radiative zone where energy is transported by radiative diffusion .",
    "the interface between the convective and radiative zones is a thin internal boundary layer that poses its own modeling challenges .",
    "here convection overshoots into the stable interior , exciting internal gravity waves and establishing a layer of strong radial shear in the differential rotation that is known as the _ solar tachocline _ @xcite .",
    "another formidable modeling challenge is the geometry .",
    "high - mass stars ( @xmath1 , where @xmath2 is the solar mass ) are inverted suns , with convectively stable ( radiative ) envelopes surrounding convectively unstable cores .",
    "these are also expected to possess vigorous dynamo action but much of it is likely hidden from us , occurring deep below the surface where it can not be observed with present techniques .",
    "stellar lifetimes are anticorrelated with mass , so all high - mass stars are significantly younger than the sun .",
    "furthermore , stars spin down as they age due to torques exerted by magnetized stellar winds @xcite . thus , most high - mass stars spin much faster that the sun , as much as one to two orders of magnitude",
    ". the fastest rotators are significantly oblate .",
    "for example , the star regulus in the constellation of leo has an equatorial diameter that is more than 30% larger than its polar diameter @xcite .",
    "other types of stars and planets pose their own set of challenges .",
    "low - mass main sequence stars ( @xmath3 ) are convective throughout , from their core to their surface , so they require modeling strategies that can gracefully handle the coordinate singularity at the origin ( @xmath4 ) as well as the the small - scale convection established by the steep density stratification and strong radiative cooling in the surface layers .",
    "red giants have deep convective envelopes and dense , rapidly - rotating cores .",
    "jovian planets have both deep convective dynamos and shallow , electrically neutral atmospheric dynamics that drive strong zonal winds .",
    "all of these systems have the common property that they are highly turbulent .",
    "in other words , the reynolds number @xmath5 is very large , where @xmath6 and @xmath7 are velocity and length scales and @xmath8 is the kinematic viscosity of the plasma .",
    "for example , in the solar convection zone @xmath9 @xcite . furthermore , though all of these systems are strongly stratified in density ( compressible ) , most possess convective motions that are much slower than the sound speed @xmath10 .",
    "thus , the mach number @xmath11 .",
    "exceptions include surface convection in solar - like stars and low - mass stars and deep convection in the relatively cool red giants , where @xmath12 can approach unity .",
    "meeting this considerable list of challenges requires a flexible , accurate , robust , and efficient computational algorithm .",
    "it is within this context that we here introduce the compressible high - order unstructured spectral difference ( chorus ) code .",
    "chorus is the first numerical model of global solar , stellar , and planetary convection that uses an unstructured grid .",
    "this valuable feature allows chorus to avoid the spherical coordinate singularities at the origin ( @xmath4 ) and at the poles ( colatitude @xmath13 , @xmath14 ) that plague codes based on structured grids in spherical coordinates .",
    "such coordinate singularities compromise computational efficiency as well as accuracy , due to the grid convergence that can place a disproportionate number of points near the singularities and that can severely limit the time step through the courant - freidrichs - lewy ( cfl ) condition .",
    "thus , chorus can handle a wide range of global geometries , from the convective envelopes of solar - like stars and red giants to the convective cores of high - mass stars .",
    "the flexibility of the unstructured grid promotes maximal computational efficiency for capturing multi - scale nature of solar and stellar convection .",
    "as noted above , boundary layers play an essential role in the internal dynamics of stars and planets . in solar - like stars with convective envelopes ,",
    "much of the convective driving occurs in the surface layers , producing granulation that transitions to giant cells through a hierarchical merging of downflow plumes @xcite .",
    "meanwhile , the tachocline and overshoot region at the base of the convection zone play a crucial role in the solar dynamo .",
    "the unstructured grid of chorus will enable us to locally enhance the resolution in these regions in order to capture the essential dynamics .",
    "similarly , optimal placing of grid points will allow chorus to efficiently model other phenomena such as core - envelope coupling in red giants ( see above ) .",
    "furthermore , the unstructured grid is deformable .",
    "so , it can handle the oblateness of rapidly - rotating stars as well as other steady and time - dependent distortions arising from radial pulsation modes or tidal forcing by stellar or planetary companions .",
    "the spectral difference method ( sdm ) employed for chorus achieves high accuracy for a wide range of spatial scales , which is necessary to capture the highly turbulent nature of stellar and planetary convection .",
    "furthermore , its low intrinsic numerical dissipation enables it to be run in an inviscid mode ( no explicit viscosity ) , thus maximizing the effective @xmath15 for a given spatial resolution .",
    "one feature of chorus that is not optimal for modeling stars is the fully compressible nature of the governing equations .",
    "the dynamics of stellar and planetary interiors typically operates at low mach number such that acoustic time scales are orders of magnitude smaller than the time scales for convection or other large - scale instabilities .",
    "therefore , a fully compressible solver such as chorus is limited by the cfl constraint imposed by acoustic waves .",
    "many codes circumvent this problem by adopting anelastic or pseudo - compressible approximations that filter out sound waves .",
    "we choose instead to define idealized problems by scaling up the luminosity to achieve higher mach numbers while leaving other important dynamical measures such as the rossby number unchanged .",
    "this allows us to take advantage of the hyperbolic nature of the compressible equations , which is well suited for the sdm method and which promotes excellent scalability on massively parallel computing platforms .",
    "furthermore , the compressible nature of the equations will enable chorus to address problems that are inaccessible or at best challenging with anelastic and pseudo - compressible codes .",
    "these include high - mach number convection in red giants , the coupling of photospheric and deep convection , and the excitation of the radial and non - radial acoustic oscillations ( p - modes ) that form the basis of helio- and asteroseismology .",
    "currently chorus employs an explicit time - stepping method , which is not optimal for low mach number flow , especially on non - uniform grids .",
    "however , the sdm is well suited for split - timestepping and implicit time - stepping methods which we intend to implement in the future .",
    "the purpose of this paper is to introduce the chorus code , to describe its numerical algorithm , and to verify it by comparing it to the well - established anelastic spherical harmonic ( ash ) code .",
    "we begin with a discussion of the mathematical formulation and numerical algorithms of chorus in sections 2 and 3 respectively . in section 4",
    "we generalize the anelastic benchmark simulations of @xcite to provide initial conditions for compressible models like chorus .",
    "we then address boundary conditions in section 5 and the conservation of angular momentum in section 6 , which can be a challenge for global convection codes . in section 7",
    "we verify the chorus code by comparing its output to analogous ash simulations for two illustrative benchmark cases , representative of jovian planets and solar - like stars .",
    "we summarize our results and future plans in section 8 .",
    "we consider a spherical shell of ideal gas , bounded by an inner spherical surface at @xmath16 and an outer surface at @xmath17 where @xmath18 is the radius .",
    "we assume that the bulk of the mass is concentrated between both surfaces , and the gravity satisfies @xmath19 where @xmath20 is the gravitational constant , @xmath21 is the interior mass and @xmath22 is the radial unit vector . consider a reference frame that is uniformly rotating about the @xmath23 axis with angular speed @xmath24 where @xmath25 is the unit vector in @xmath23 direction . in this rotating frame",
    ", the effect of coriolis force is added to the momentum conservation equations .",
    "the centrifugal forces are negligible as they have much less contribution in comparison with the gravity .",
    "however , the chorus code can handle oblate spheroids in rapidly - rotating objects and we will consider centrifugal force effect in the future .",
    "the resulting system of hydrodynamic equations is    @xmath26    @xmath27    @xmath28    where @xmath29 , @xmath30 , @xmath31 , @xmath32 and @xmath33 are time , pressure , temperature , density and velocity vector respectively .",
    "@xmath34 is the total energy per unit volume and is defined as @xmath35 where @xmath36 is the ratio of the specific heats .",
    "@xmath37 is the viscous stress tensor for a newtonian fluid .",
    "the term @xmath38 in eq.([eqn : energy ] ) represents the viscous heating .",
    "the diffusive flux @xmath39 is generally treated in the form of @xmath40 where @xmath41 is the entropy diffusion coefficient , @xmath42 is the specific entropy , @xmath43 is the thermal diffusivity ( thermal conductivity and radiative conductivity ) , and @xmath44 is the specific heat at constant pressure . the entropy diffusion is a popular way of parameterizing the energy flux due to unresolved , subgrid - scale convective motions which tend to mix entropy @xcite . at the bottom of the convection zone , @xmath39 is generally prescribed with a constant value which acts as the energy source of convection . the last term in eq.([eqn : energy ] ) is the work done by buoyancy .",
    "+ the governing equations for fully compressible model can be written in a conservative form as @xmath45 where @xmath46 is the vector of conserved variables , @xmath47 is the combination of the coriolis force term and the gravitational force term , and @xmath48 , @xmath49 , @xmath50 are the total fluxes including both inviscid and viscous flux vectors in local cartesian coordinates ( transforming to an arbitrary geometry will be discussed in next section ) . we write these as @xmath51 , @xmath52 , and @xmath53 , where + @xmath54",
    "@xmath55    @xmath56    @xmath57    in eq.([eqn : ql])-([eqn : fgh_vis_2 ] ) , @xmath58 , @xmath59 , and @xmath60 are the velocity components in the @xmath61 , @xmath62 , and @xmath23 directions respectively . the viscous stress tensor components in eq.([eqn : fgh_vis_1 ] ) and ( [ eqn : fgh_vis_2 ] ) can be written in the following form @xmath63 where @xmath64 is the dynamic viscosity and @xmath8 is the kinematic viscosity .",
    "the equations of motion ( 4)-(9 ) are solved using a spectral difference method ( sdm ) .",
    "the sdm is similar to the multi - domain staggered method originally proposed by kopriva and his colleagues @xcite .",
    "liu et al @xcite first formulated the sdm for wave equations by extending the multi - domain staggered method to triangular elements .",
    "the sdm was then employed by wang et al for inviscid compressible euler equations on simplex elements @xcite and viscous compressible flow on unstructured grids @xcite .",
    "the sdm is simpler than the traditional discontinuous galerkin ( dg ) method @xcite since dg deals with the weak form of the equations and involves volume and surface integrals .",
    "the weak form is developed by integrating the product of a test function with the compressible navier - stokes equations .",
    "for the discontinuous galerkin method , the integration is performed over the spatial coordinates of each finite element of the computational domain .",
    "the sdm is similar to the quadrature - free nodal discontinuous galerkin method @xcite .",
    "the sdm of chorus is designed for unstructured meshes of all hexahedral elements @xcite .",
    "this spectral difference approach employs high - order polynomials within each hexahedral element locally .",
    "in particular , we employ the roots of legendre polynomials plus two end points for locating flux points @xcite .",
    "the stability for linear advection of this type of sdm has been proven by jameson @xcite .",
    "overall , high - order sdm is simple to formulate and chorus is very suitable for massively parallel processing .",
    "the computational domain is divided into a collection of non - overlapping hexahedral elements as illustrated in fig.[fig : mesh ] .",
    "these elements share similarities with the control volumes in the finite volume method . to achieve an efficient implementation , all hexahedral elements in the physical domain @xmath65",
    "are transformed to a standard cube @xmath66 .",
    "this mapping is achieved through a jacobian matrix    @xmath67.\\ ] ]    the governing equations in conservative form in the physical domain as described by eq.([eqn : govn_conserve ] ) are then transformed into the computational domain .",
    "the transformed equations are written as @xmath68 where @xmath69 and @xmath70 using the determinant @xmath71 of @xmath72 .",
    "the transformed flux components can be written as a combination of the physical flux components as    @xmath73    in the two - dimensional standard element as illustrated in fig.[fig : thirdorder ] , two sets of points are defined , namely the solution and flux points for the sdm .",
    "a total of 9 solution points and 24 flux points are employed for the third - order sdm in 2d .",
    "a more detailed description of the sdm for quadrilateral elements can be found in @xcite .",
    "the unknown conserved variables are stored at the solution points , while flux components @xmath48 , @xmath49 , and @xmath50 are stored at the flux points in corresponding directions .    .    in order to construct a degree ( n-1 ) polynomial in each coordinate direction ,",
    "n solution points are required ( thus n is defined as the order the scheme ) .",
    "the solution points in 1d are chosen to be chebyshev - gauss - quadrature points defined by @xmath74 , \\quad   s=1,2,\\cdots , n.\\ ] ]    the flux points are selected to be the legendre - gauss - quadrature points plus the two end points , 0 and 1 .",
    "choosing @xmath75 and @xmath76 , we can determine the higher - degree legendre polynomials as @xmath77    the locations of these legendre - gauss quadrature points for the n - th order sdm are the roots of equation @xmath78 plus two end points .    using the solutions at n solution points , a degree ( n-1 )",
    "polynomial can be built using the following lagrange basis defined as @xmath79    similarly , using the ( n+1 ) fluxes at the flux points , a degree n polynomial can be built for the flux using a similar lagrange basis defined as @xmath80    the reconstructed solution for the conserved variables in the standard element is just the tensor products of the three one - dimensional polynomials , i.e. , @xmath81    similarly , the reconstructed flux polynomials take the following forms : @xmath82    the flux polynomials are element - wise continuous , but discontinuous across element interfaces . for computing the inviscid fluxes , an approximate riemann solver @xcite",
    "is employed to compute a common flux at interfaces and to ensure conservation and stability . here the rusanov flux treatment for the @xmath83 direction is formulated as @xmath84 , where @xmath85 is the interface normal direction , @xmath86 is the fluid velocity normal to the interface and @xmath87 is the speed of sound .",
    "if the normal direction of the cell interface is mapped to either the @xmath88 or @xmath89 direction , the riemann fluxes can be formulated similarly .    for calculating the viscous fluxes ,",
    "a simple averaging procedure is used for evaluating fluxes at interfaces @xcite .",
    "this procedure is similar to the br1 scheme @xcite . for future implementation of implicit time stepping methods",
    ", we can extend the chorus code to use br2 scheme @xcite .",
    "the number of degrees of freedom ( dofs ) for chorus simulations in this paper is computed as @xmath90 where @xmath91 is the total number of elements in the spherical shell and @xmath92 is the order of the scheme , which is equal to the number of solution points in each direction within one standard element .    the chorus code is written in fortran 90 and efficient parallel performance is achieved by using the message passing interface ( mpi ) for interprocessor communication .",
    "the parmetis package @xcite is used to partition the unstructured mesh by means of a graph partitioning method .",
    "the parallel scalability of the chorus code is shown in fig.[fig : scalability ] using the yellowstone high - performance computing cluster at the national center for atmospheric research ( ncar ) , which is built on ibm s idataplex architecture with intel sandy bridge processors .",
    "these numerical experiments demonstrate strong scaling , with @xmath93 denoting the execution time of the sequential chorus code and @xmath94 denoting the execution time of the parallel chorus code with @xmath95 processors .",
    "two sets of simulations using the 4th order sdm are shown .",
    "the total numbers of elements in physical domain for test1 and test2 are 294,912 and 1,105,920 respectively , which correspond to 18,874,368 and 70,778,880 dofs in the 4th - order sdm simulations .    .",
    "though the equations that chorus solves are general , we are intersted in simulating global - scale convection in stellar and planetary interiors for reasons discussed in section 1 .",
    "thermal convection is a classical fluid instability in the sense that it can develop from a static equilibrium state that satisfies certain instability criteria @xcite .",
    "the first is the schwarzschild criterion which requires a negative ( superadiabatic ) radial entropy gradient @xmath96 .",
    "the second is that the buoyancy force must be sufficiently strong to overcome viscous and thermal diffusion .",
    "this is typically quantified in terms of the rayleigh number , which must exceed a critical value in order for convection to ensue .",
    "though linear theory is generally concerned with static , equilibrium initial conditions , numerical simulations can tolerate initial conditions that are not in equilibrium .",
    "however , it is still desirable to initiate nonlinear simulations with states that are close to equilibrium in order to mitigate violent initial transients and minimize nonlinear ( dynamic ) equilibration times .    in the sections that follow",
    "we describe how we set up the initial conditions for spherical shells of convection .",
    "chorus can also handle convective cores and fully convective geometries but we defer these applications to future papers .",
    "note that these initial conditions are static relative to the uniform rotation of the coordinate system ( @xmath97 ) .",
    "the differential rotation , meridional circulation , and convective motions are in no way imposed ; they are zero initially .",
    "after specifying the static initial conditions , chorus automatically introduces random thermal perturbations through the non - axisymmetric distribution of unstructured grid points to excite the convection which in turn establishes the mean flows . note also that the stratification in a stellar or planetary convection zone is nearly hydrostatic .",
    "convection will modify this but only slightly .",
    "so , the initial conditions not only excite the convection but they also establish the basic background stratification including crucial simulation properties such as the density contrast across the convection zone .      to establish the static initial conditions we first consider a steady state in the absence of motions ( @xmath98 , @xmath97 ) .",
    "then the governing equations ( [ eqn : mass_convervation ] ) - ( [ eqn : energy ] ) reduce to the equation of hydrostatic balance , @xmath99 and the equation of thermal energy balance , @xmath100 where the subscript @xmath101 denotes the initial state .",
    "these are supplemented with the ideal gas law @xmath102 where @xmath103 is the specific gas constant , and the equation for specific entropy , @xmath104      though we solve the equations in dimensional form , it is useful to define several nondimensional numbers that characterize the parameter regime of the solution : @xmath105 here @xmath106 is the rayleigh number , @xmath107 is the fluid prandtl number , @xmath108 is the ekman number , @xmath109 is the density ratio across the layer , with @xmath110 and @xmath111 as the the densities at the inner and outer boundaries , @xmath112 , @xmath113 is the aspect ratio , and @xmath114 is the entropy difference across the layer , averaged over latitude and longitude .",
    "the hydrostatic balance equation ( [ eqn : hydrostatic ] ) , along with the constitutive equations ( [ eqn : gas_relation ] ) and ( [ eqn : entropy ] ) , can be satisfied by introducing a polytropic stratification as described by jones et al .",
    "@xcite : @xmath115 where @xmath116 and @xmath117 the subscripts @xmath118 , @xmath119 , and @xmath120 refer to the bottom , top , and middle of the layer respectively .",
    "once the dimensionless numbers together with other physical input values are determined , the profiles of @xmath121 , @xmath122 , @xmath123 , and @xmath124 can be evaluated .",
    "it follows from ( [ eqn : entropy ] ) that setting @xmath125 yields an adiabatic stratification ( @xmath126 ) .",
    "we do so here so that the @xmath127 subscript denotes a polytropic , adiabatic stratification .",
    "this provides an excellent first approximation to a stellar or planetary convection zone which is very nearly adiabatic due to the high efficiency of the convection . though they can not be strictly adiabatic because they must satisfy the schwarzschild criterion ( @xmath128 ) ,",
    "they are _ nearly adiabatic _ in the sense that @xcite @xmath129 the bar denotes an average over latitude and longitude . equation ( [ eqn : epsilon ] ) is the basis of the so - called _",
    "anelastic approximation _ in which the equations of motion are derived as perturbations about a static , often ( but not necessarily ) adiabatic , reference state @xcite .",
    "although we do not employ the anelastic approximation here , an adiabatic , polytropic reference provides a useful starting point for setting up the initial conditions .",
    "however , the process can not end here because this polytropic solution does not in general satisfy eq.([eqn : thermal_equilibrium ] ) and , since it does not satisfy the schwarzschild criterion , it will not excite convection .      in anelastic systems , the superadiabatic component of the entropy gradient ( @xmath128 ) is assumed to be small so it can be specified indepedently of the adiabatic reference state @xcite .",
    "this amounts to setting @xmath130 , @xmath131 , and @xmath132 , and then solving equation ( [ eqn : thermal_equilibrium ] ) for @xmath133 : @xmath134 where @xmath7 is the luminosity .",
    "this procedure breaks down in fully compressible systems because equation ( [ eqn : entropy ] ) will only be satisfied to lowest order in @xmath135 .",
    "this is a high price to pay merely to satisfy equation ( [ eqn : thermal_equilibrium ] ) which should have little bearing on the final dynamical equilibrium achieved after the onset of convection .",
    "it is more essential to satisfy the constitutive equations ( [ eqn : gas_relation ] ) and ( [ eqn : entropy ] ) precisely , together with the hydrostatic balance equation ( [ eqn : hydrostatic ] ) to avoid a rapid initial restratification .",
    "we achieve this by introducing an extra step in the initialization procedure .",
    "as in anelastic systems , we compute the polytropic , adiabatic stratification as described in section [ sec : polytrope ] and we calculate @xmath136 as defined in eq.([eqn : target_entropy ] ) . however , unlike anelastic systems , we treat @xmath136 as a target entropy gradient and then solve equations ( [ eqn : hydrostatic ] ) , ( [ eqn : gas_relation ] ) , and ( [ eqn : entropy ] ) precisely using a separate finite difference code . in particular , we solve the following two equations for @xmath137 and @xmath138 using @xmath139 and @xmath140 as an initial guess @xmath141    the temperature @xmath142 is then given by ( [ eqn : gas_relation ] ) .",
    "this process produces a superadiabatic , hydrostatic , spherically - symmetric initial state that satisfies equations ( [ eqn : hydrostatic ] ) , ( [ eqn : gas_relation ] ) , and ( [ eqn : entropy ] ) .",
    "the entropy gradient will be equal to @xmath136 but the thermal energy balance equation ( [ eqn : thermal_equilibrium ] ) will only be satisfied to lowest order in @xmath135 .    an alternative approach would be to solve all four equations ( [ eqn : hydrostatic])-([eqn : entropy ] ) simultaneously for the four unknowns @xmath138 , @xmath137 , @xmath142 , and @xmath143 .",
    "our _ almost flux balance _ approach is much easier to implement and provides an effective way to initiate convection .",
    "the inner and outer boundaries are assumed to be impenetrable and free of viscous stresses @xmath144 where @xmath145 are the velocity components in spherical coordinates @xmath146 .    in addition , a constant heat flux @xmath147 ) is imposed at the bottom boundary and the temperature is fixed at the top boundary .",
    "the present chorus code employs 20 nodes including 8 corner points and 12 mid - edge points for each hexahedral element in the physical domain . a precise treatment of the curved top and bottom boundaries of the spherical shells is then assured by the iso - parametric mapping procedure mentioned in section 3 . for calculating inviscid fluxes on element interfaces ,",
    "an approximate riemann solver @xcite is generally used .",
    "however , exact inviscid fluxes are employed on top and bottom boundaries by using the fact that @xmath148 is precisely zero on spherical shell boundaries .",
    "a careful transformation between cartesian and spherical coordinate systems is conducted for computing viscous fluxes on two boundaries in order to ensure the stress - free conditions .",
    "the equations of motion ( 1)-(3 ) express the conservation of mass , energy , and linear momentum .",
    "the conservation of angular momentum follows from these equations and the impenetrable , stress - free boundary conditions discussed in section [ sec : bcs ] .",
    "these are hyperbolic equations and we express them in conservative form when implementing the numerical algorithm , as disscussed in section [ sec : algorithm ] .",
    "this , together with the spectral accuracy within the elements and the approximate riemann solver employed at cell edges , ensures that the mass , energy , and linear momentum are well conserved as the simulation proceeds .",
    "however , we do not explicitly solve a conservation equation for angular momentum .",
    "numerical errors including both truncation and round - off errors can result in a small change in angular momentum over each time step .",
    "though these changes may be small , even a highly accurate algorithm can accummulate errors over thousands or millions of time steps that can compromise the validity of a simulation .",
    "this can be an issue in particular for unstructured grid codes like ours that solve the conservation equations in cartesian geometries that are mapped to conform to the spherical boundaries .",
    "however , conservation of angular momentum can be violated even in highly accurate pseudo - spectral simulations , as reported by jones et al .  @xcite .",
    "for this reason , we introduce an angular momentum correction scheme similar to one of the schemes described by jones et al @xcite .",
    "two correction steps are taken in the chorus code to maintain constant angular momentum over long simulation intervals including :    1 .",
    "calculate three cartesian components of angular momentum explicitly , namely @xmath149 .",
    "2 .   add a commensurate rigid body with rotating rate @xmath150 to remove the angular momentum discrepancy .    in step 1 ,",
    "three cartesian components are evaluated over the full spherical shell @xmath151 as @xmath152 note that all three components are initially zero relative to the rotating coordinate system .",
    "the introduced rigid body rotating rate @xmath150 in step 2 is determined by @xmath153 where @xmath154 are the moment of inertia of the the spherical shell in the @xmath61 , @xmath62 and @xmath23 directions respectively , and @xmath155 , @xmath156 , and @xmath157 .",
    "once @xmath150 is obtained , the cartesian velocity components @xmath58 , @xmath59 , and @xmath60 will be updated at each solution point using @xmath158 where function @xmath159    we note that this correction procedure applies equally well in the case of an oblate , rapidly - rotating star .",
    "the total moment of inertia in each direction is numerically calculated by summing up the moment of inertia in each element of the unstructured grid so it works regardless of the shape of the star .    this correction procedure is computationally expensive if performed at every time step .",
    "thus , in all chorus simulations , we only do correction every 5000 time steps .",
    "fig.[fig : omega ] shows the time evolution of @xmath160 , @xmath161 and @xmath162 from a representative chorus simulation .",
    "this demonstrates the high accuracy of the numerical algorithm since the relative angular momentum error never exceeds @xmath163 even at this 5000-step correction interval .",
    "furthermore , it demonstrates that the cumulative long - term errors in the angular momentum components are well controlled .",
    "we verify the chorus code by comparing its results to the well - established anelastic spherical harmonic ( ash ) code @xcite .",
    "however , we acknowledge that this comparison is not ideal since the two codes solve different equations . as mentioned in section [ sec : polytrope ] , the equations of motion in the anelastic approximation are obtained by linearizing the fully compressible equations ( 1)-(3 ) about a hydrostatic , spherically - symmetric reference state .",
    "so we would only expect chorus and ash to agree in the limit @xmath164 , where @xmath135 is the normalized radial entropy gradient defined in eq .",
    "( [ eqn : epsilon ] ) .",
    "a thorough comparison between the two systems would involve a linear and nonlinear analysis demonstrating convergence as @xmath164 .",
    "this lies outside the scope of the present paper . here",
    "we focus on defining two benchmark simulations , patterned after the gaseous atmosphere of jupiter and the convective envelope of the sun , and compare the results from chorus and ash . despite subtle differences in the model equations and substantial differences in the numerical method",
    ", we demonstrate good agreement between the two codes .",
    "this serves to verify chorus and to pave the way for future applications .",
    "ash is a multi - purpose code designed to simulate the hydrodynamics ( hd ) and magnetohydrodynamics ( mhd ) of solar and stellar interiors in global spherical geometries .",
    "it was first developed over 15 years ago and has remained at the leading edge of the field ever since , continually improving in its physical sophistication and parallel efficiency on high - performance computing platforms .",
    "ash results have appeared in over 100 publications with applications ranging from convection and dynamo action in solar - like stars and fully - convective low - mass stars , to core convection and dynamo action in massive stars , to mhd instabilities and stably - stratified turbulence , to the generation of and transport by internal gravity waves , to tachocline confinement , to flux emergence , to the hd and mhd of red giants @xcite .",
    "ash is based on the anelastic approximation ( sec .",
    "[ sec : polytrope ] ) and uses a poloidal - toroidal decomposition of the mass flux to ensure that the anelastic form of the mass continuity equation is satisfied identically ( @xmath165 ) .",
    "it is a pseudo - spectral code that uses triangularly - truncated spherical harmonic basis functions in the horizontal dimensions .",
    "although earlier versions of ash employed chebyshev basis functions in the radial dimension , the version presented here uses a centered , fourth - order finite difference scheme that was introduced to improve parallel efficiency . the radial grid is uniformly spaced for the simulations presented here and the boundary conditions are as specified in section [ sec : bcs ] .",
    "time stepping is accomplished using an explicit adams - bashforth scheme for the nonlinear terms and a semi - implicit crank - nicolson scheme for linear terms , both second order .",
    "ash is one of four global anelastic codes that were validated using a series of three carefully defined benchmark simulations presented by jones et al.@xcite .",
    "all three benchmarks had shell geometries and dimensional parameters that were chosen to represent deep convection in jupiter s extended atmosphere but they differed in their degree of magnetism ( one was non - magnetic ) and turbulent intensity ( spanning laminar and turbulent dynamo solutions ) . in order to concisely represent the effective parameter space ,",
    "the benchmark simulations were specified through a series of non - dimensional parameters as defined in eq.([eqn : numbers ] ) , namely @xmath166 , @xmath167 , @xmath168 , and @xmath113 .",
    "these benchmarks made use of a hydrostatic , adiabatic , polytropic reference state as described in sec .",
    "[ sec : polytrope ] , specified through the additional nondimensional parameters @xmath169 and @xmath95 ( the polytropic index ) .",
    "all four codes used similar numerical methods ( pseudospectral , spherical harmonic ) and agreed to within a few percent for a variety of different metrics of physical quantities .",
    "the benchmarks we define here are inspired by the anelastic convection - driven dynamo bechmarks of jones et al .",
    "however , some modifications to the anelastic benchmarks are necessary in order to ensure that they are consistent with the fully compressible equations solved by chorus .",
    "we already discussed one example of this when defining the initial conditions in sec .  [",
    "sec : almost ] .",
    "another significant modification of the anelastic benchmarks that we introduce here concerns the mach number .",
    "an implicit requirement of the anelastic approximation is that the mach number of the flow is much less than unity @xmath170 , where @xmath10 is the sound speed .",
    "this is well justified in stellar convection zones where @xmath12 is typically less than @xmath171 . in a fully compressible code",
    "this places a severe constraint on the allowable time step permitted by the courant - freidrichs - lewy ( cfl ) condition @xmath172 where @xmath173 is some measure of the minimum grid spacing .",
    "anelastic codes are not subject to this constraint . if the mach number is low , the cfl constraint imposed by the sound speed is much more stringent than that imposed by the flow field @xmath174 . in the future",
    "we will mitigate this constraint through the use of implicit and local time stepping . here",
    "we address it by defining benchmark problems for which the mach number is low ( justifying the anelastic approximation in ash ) but not too low ( mitigating the cfl constraints of chorus ) .",
    "the cfl constraint arising from the sound speed can be a major issue for global , rotating convection simulations where the equilibration time scale is much longer than the dynamical time scale .",
    "if one neglects structural stellar evolution , the longest time scale in the system is the thermal relaxation timescale @xmath175 , which can exceed @xmath176 years in stars ; by comparison the dynamical time scale is of order one month .",
    "however , a more relevant time scale for equilibration of the convection is the thermal diffusion time scale @xmath177 , which is @xmath178 days for the jupiter benchmark and @xmath179 days for the solar benchmark ( @xmath180 days and @xmath181 days respectively ) .      before proceeding to the simulation results ,",
    "we first define several important metrics that provide a means to compare chorus and ash . these include the mean kinetic energy relative to the rotating reference frame and its mean - flow components , namely the the differential rotation ( drke ) and the meridional circulation ( mcke ) :    @xmath182    @xmath183    @xmath184    where @xmath151 denotes the volume of the computational domain and angular brackets denote averages over longitude .",
    "the growth rate of the kinetic energy is defined as @xmath185    from eq.([eqn : energy ] ) , four components of the energy flux are involved in transporting energy in the radial direction , namely the enthalpy flux @xmath186 , kinetic energy flux @xmath187 , radiative flux @xmath188 and entropy flux @xmath189 . in a statistically steady state , these four fluxes together must account for the full luminosity imposed at the bottom boundary : @xmath190 where @xmath191 and @xmath192 @xmath193 , @xmath194 , and @xmath195 denote the mean density , temperature and entropy , averaged over horizontal surfaces .    on each horizontal surface ,",
    "the mean mach number is defined as @xmath196 where @xmath197 and the mean sound speed is @xmath198      the deep , extended outer atmosphere of jupiter is thought to be convectively unstable @xcite .",
    "this has motivated substantial work on the internal dynamics of giant planets and inspired the parameter regimes chosen for the anelastic benchmarks of jones et al .",
    "our first benchmark for comparing chorus and ash is similar to the hydrodynamic benchmark of jones et al .",
    "@xcite apart from the thermal boundary conditions . whereas we impose a fixed heat flux on the lower boundary and a fixed temperature on the upper ( sec .",
    "[ sec : bcs ] ) , jones et al .",
    "fix the specific entropy @xmath42 on both boundaries . note that this means that the rayleigh number @xmath166 , defined in terms of @xmath114 in eq .",
    "( [ eqn : numbers ] ) , does change somewhat in our simulations as the convection modifies the entropy stratification .",
    "this is in contrast to jones et al .  where it was held fixed .",
    "the parameters for this case are specified in table [ tab : parameter_jupiter ] .",
    "the value of @xmath166 listed is the initial value , before convection ensues .",
    "the number of dofs used for the chorus simulation is about a factor of five larger than that used for the ash simulation , as indicated in table [ tab : computational_effort ] .",
    "both simulations use the same boundary conditions and initial conditions , apart from the random perturbations needed to excite convection which are generated independently by each code .",
    "l dimensionless parameters + @xmath199 , @xmath200 , @xmath201 , @xmath202 , @xmath203 , @xmath204 +   + defining physical input values + @xmath205 = 7 @xmath206 @xmath207 @xmath208 , @xmath209 = 1.76 @xmath206 @xmath210 @xmath211 , @xmath21 = 1.9 @xmath206 @xmath212 @xmath213 , @xmath110 = 1.1 @xmath213 @xmath214 + @xmath103 = 3.503 @xmath206 @xmath215 @xmath216 @xmath217 @xmath218 , @xmath20 = 6.67 @xmath206 @xmath219 @xmath217 @xmath220 @xmath221 , @xmath222 +   + derived physical input values + @xmath223 = 2.45 @xmath206 @xmath207 @xmath208 , @xmath224 = 4.55 @xmath206 @xmath207 @xmath208 , @xmath8 = 3.64364 @xmath206 @xmath225 @xmath226 @xmath211 , + @xmath41 = 3.64364 @xmath206 @xmath225 @xmath226 @xmath211 , @xmath36 = 1.5 +   + other thermodynamic quantities + @xmath7 = 7.014464 @xmath206 @xmath227 @xmath216 @xmath211 , @xmath44 = 1.0509 @xmath206 @xmath228 @xmath216 @xmath217 @xmath218 +    .",
    "the evolution of the kinetic energy densities for both chorus and ash simulations are illustrated in fig.[fig : ke_density_jupiter ] .",
    "as mentioned above , both simulations start with the same background stratification but with different random perturbations .",
    "the small amplitude of the initial perturbations ensures that each simulation begins in the linear regime . for each simulation",
    "there is an initial adjustment period before the flow locks on to the fastest - growing eigenmode which then grows exponentially .",
    "the initial establishment period is different for each simulation , lasting roughly 8 days for the chorus simulation and 2 days for the ash simulation .",
    "however , this is to be expected from the different mix of random perturbations .",
    "a meaningful comparison can only be made between the two codes after they reach the exponential growth phase , which is followed by nonlinear saturation and a subsequent equilibrium .",
    "in other words , the two features of fig .  [",
    "fig : ke_density_jupiter ] that should be compared are the slope of the line in the linear growth phase and the value of the kinetic energy density after each simulation has saturated and equilibrated .    this first point of comparison , namely the growth rate ,",
    "is highlighted in fig.[fig : growth_jupiter ] .",
    "the peak values achieved by each simulation in the linear regime reflect the growth rate of the preferred linear eigenmode and agree to within about 2% ; @xmath229 for chorus and @xmath230 for ash .",
    "we define the nonlinear saturation time @xmath231 as the time at which the growth rate first crosses zero after the exponential growth phase .",
    "again , the saturation time is different between the two simualtions because of the random nature of the initial conditions .",
    "thus , in order to compare the two cases in the nonlinear regime we define a sampling time @xmath232 to be 10 days after the saturation time , @xmath231 .",
    "this is @xmath233 days for the chorus simulation and @xmath234 days for the ash simulation .",
    "averaged between ( @xmath235 ) days and @xmath232 days , @xmath236 @xmath216 @xmath214 for the chorus simulation and @xmath237 @xmath216 @xmath214 for the ash simulation .",
    "the difference is about @xmath238 .",
    "another point of comparison is the relative magnitude of the mean flows , as quantified by the drke and mcke defined in sec .",
    "[ sec : metrics ] . at the sampling time @xmath232 ,",
    "drke / ke @xmath239 and mcke / ke @xmath240 for the chorus simulation while drke / ke @xmath241 and mcke / ke @xmath242 for the ash simulation .",
    "this corresponds to a difference of about 16% and 5% for the dr and mc respectively .",
    "small differences between the two codes of order several percent are to be expected due to differences between the compressible and anelastic equations . furthermore , the relatively large difference in the drke / ke likely comes about because the simulations are not fully equilibrated .",
    "we address these issue further in the following section ( sec .",
    "[ sec : mach ] ) .      as mentioned in secs .",
    "[ sec : polytrope ] and [ sec : ash ] , the comparisons between ash and chorus are only meaningful if the stratification is nearly adiabatic ( @xmath243 ) and the mach number is small . these conditions are required for the validity of the anelastic approximation . fig .",
    "[ fig : ma_jupiter ] demonstrates that these conditions are met , but that departures are significant .",
    "in particular , we expect that the anelastic and compressible equations are only equivalent to lowest order in @xmath135 , which reaches a value as high as 0.07 in the upper convection zone ( fig.[fig : epsilon_jupiter ] ) .    in fig.[fig :",
    "ma_jupiter ] , the mean mach number is minimum at the bottom and increases with radius and reaches the maximum ( about 0.012 ) at the top in both the chorus and ash simulations . as defined in eq.([eqn : epsilon ] ) , @xmath135 is proportional to the mean entropy gradient @xmath244 .",
    "identical initial entropy gradients for the chorus and ash simulations implies that they have the same initial degrees of adiabaticity .",
    "when convection is present , the associated energy flux leads to a redistribution of entropy , tending to smooth out the entropy gradient .",
    "this is the reason that @xmath135 in fig.[fig : epsilon_jupiter ] becomes smaller than the initial near @xmath245 .",
    "the location @xmath245 corresponds to where the efficiency of the convection peaks .",
    "this is demonstrated in fig.[fig : flux_jupiter ] which shows the components of the energy flux defined in sec .",
    "[ sec : metrics ] .",
    "the _ almost flux balance _ initialization described in sec .",
    "[ sec : almost ] establishes an entropy stratification that carries most of the energy flux through entropy diffusion @xmath246 , with a slight over - luminosity of about 7% in the upper convection zone .",
    "once convection is established , it carries roughly 15% of this flux , flattening the entropy gradient and reducing @xmath189 .",
    "the kinetic energy flux @xmath187 for this case is negligible .",
    "the maximum values of @xmath186 at @xmath245 for the chorus and ash simulations are 0.1536 and 0.1484 respectively , showing the difference of @xmath247 .    .",
    "in a nonlinear equilibrium state , the sum of the normalized fluxes in fig .  [",
    "fig : flux_jupiter ] should be unity .",
    "this is clearly not the case ; as mentioned above both simulations are over - luminous by about 7% due to the initial entropy stratification .",
    "this will eventually subside but the process is slow , occurring gradually over a time scale that is longer than the thermal diffusion time scale of @xmath248 days but shorter than the thermal relaxation time scale of @xmath249 days ( see sec .",
    "[ sec : ash ] ) .",
    "this is demonstrated in fig.[fig : flux_1800 ] which shows the flux balance in the ash simulation after 1800 days .",
    "given the greater computational cost of chorus ( sec .",
    "[ sec : performance ] ) , and the satisfactory agreement at the sampling time ( within the expected order @xmath135 ) , we choose not to run the chorus simulation to full equilibration .    .",
    "the structure of the convection at the sampling time is illustrated in fig .",
    "[ fig : vr_jupiter ] .",
    "though this is well into the nonlinear regime , both simulations are dominated by a series of columnar convective rolls approximately aligned with the rotation axis but sheared slightly in the prograde direction at low latitudes by the differential rotation .",
    "these are the well - known ` banana cells ' characteristics of convection in rotating spherical shells and most apparent for laminar parameter regimes @xcite .",
    "though this is well into the nonlinear regime , they reflect the preferred linear eigenmodes and are well described by a single sectoral spherical harmonic mode with @xmath250 , where @xmath251 and @xmath252 are the spherical harmonic degree and order . the degree and order @xmath251 and @xmath252",
    "can also be interpreted as the total wavenumber and the longitudinal wavenumber respectively .",
    "close scrutiny of fig .",
    "[ fig : vr_jupiter ] reveals that the two simulations exhibit a slightly different mode structure , with chorus selecting an @xmath253 mode and ash selecting an @xmath254 mode .",
    "this is demonstrated more quantitatively in fig.[fig : spectrum_jupiter ] which shows the spherical harmonic spectra of the velocity field on the horizontal surface @xmath255 as a function of spherical harmonic degree @xmath251 ( summed over @xmath252 ) at the sampling time @xmath232 . in the chorus simulation , the spectra of radial velocity @xmath256 , meridional velocity @xmath257 , and zonal velocity @xmath258 peak at @xmath259 and its higher harmonics , @xmath260 , @xmath261 and @xmath262 . in comparison , the velocity spectra in the ash simulation peak at @xmath263 , @xmath264 , @xmath265 and @xmath266 .",
    "this level of agreement is consistent with the expected accuracy of the anelastic and compressible systems . as discussed by jones et al .",
    "@xcite , the linear growth rates of the @xmath267 and @xmath268 modes in this hydrodynamic benchmark are the same to order @xmath135 and even a single anelastic code may choose one or the other depending on the random initial perturbations .",
    "the laminar nature of this benchmark highlights these small differences ; in more turbulent parameter regimes where the rayleigh number far exceeds the critical value , a broad spectrum of modes is excited and the results are less sensitive to the details of the initial conditions and the linear eigenmodes .",
    "this is demonstrated by the solar benchmark described in sec .",
    "[ sec : solarbm ] , which is in a more turbulent parameter regime and which exhibits closer agreement between the velocity spectra .    .",
    "the mean ( averaged ) flows for the jupiter benchmark are shown in fig .",
    "[ fig : mcdr_jupiter ] .",
    "all averages span 2 days ( about 4.8 rotation periods ) , starting at the sampling time @xmath232 .",
    "the meridional circulation is expressed in terms of a stream function , @xmath269 , defined as @xmath270 and the differential rotation is expressed in terms of the angular velocity @xmath271 we define thermal variations @xmath272 and @xmath273 by averaging over longitude and time and then subtracting the spherically - symmetric component ( @xmath274 ) in order to highlight variations relative to the mean stratification .    the chorus and ash results in fig .",
    "[ fig : mcdr_jupiter ] correspond closely with a few notable exceptions . near the equator in the upper convection zone , @xmath275 in fig.[fig : mcdr_jupiter](_d _ ) is somewhat smaller than that in fig.[fig : mcdr_jupiter](_h _ ) .",
    "this is also reflected by the lower drke / ke noted in sec .",
    "[ sec : growth ] .",
    "as mentioned there , this discrepancy may in part be because the simulations are not strictly in equilibrium at the sampling time ( fig .",
    "[ fig : flux_jupiter ] ) .",
    "we would expect the correspondence to improve if we were to run chorus for several thousand days , giving the mean flows ample time to equilibrate along with the stratification .",
    "the wiggles in the @xmath276 plot for chorus ( fig .",
    "[ fig : mcdr_jupiter](_b _ ) ) can be attributed to two factors .",
    "first , unlike ash , the relevant state variable in chorus is the total energy @xmath34 .",
    "the specific entropy must be obtained from @xmath34 by subtracting out contributions from the kinetic energy and the mean stratification to obtain the pressure variations , from which @xmath272 is computed ( using also the density variation ) .",
    "this residual nature of @xmath276 along with the post - processing step of interpolating the chorus results onto a structured , spherical grid both contribute numerical errors . in ash , by contrast , @xmath42 is a state variable .",
    "the correspondence of figs .",
    "[ fig : mcdr_jupiter](_b _ ) and ( _ f _ ) despite these numerical errors is a testament to the accuracy of chorus .    .",
    "having gained confidence in simulating the jupiter benchmark , we now look into defining a benchmark that has more in common with the sun .",
    "this serves two purposes .",
    "first , it helps verify the chorus code by probing a different region in parameter space , this one more turbulent .",
    "second , it makes explicit contact with solar and stellar convection which is the primary application we had in mind when developing chorus .    the most significant differences between the solar and the jupiter benchmarks include the rayleigh number @xmath166 , the density stratification @xmath169 , and the radiative heat flux @xmath277 .",
    "the value of @xmath166 is about four times larger in the solar benchmark .",
    "this , combined with the larger value of @xmath168 implies that the flow is more turbulent and less rotationally constrained ( larger rossby number ) . in the middle of the convection zone , the rossby number @xmath278 for the sun benchmark and it is larger than the jupiter benchmark @xmath279 . as in the sun , the radiative flux @xmath277 ( which was set to zero in the jupiter benchmark ) carries energy through the bottom boundary , extending into the lower convection zone ( see fig .",
    "[ fig : flux_sun ] ) .",
    "this allows us to set the radial entropy gradient @xmath280 to zero at the lower boundary , which is what marks the base of the convection zone in the sun .",
    "another significant difference is the aspect ratio @xmath113 , for which we use a solar - like value of @xmath281 .    as mentioned in secs .",
    "[ sec : intro ] and [ sec : ash ] , a challenge in simulating solar convection with a compressible code like chorus is the low value of the mach number .",
    "we address this challenge by scaling up the luminosity @xmath7 by a factor of 1000 relative to the actual luminosity of the sun . according to the mixing - length theory of convection ,",
    "the rms velocity should scale as @xmath282 .",
    "thus , to preserve a solar - like value of the rossby number ( important for achieving reasonable mean flows ) , this suggests that we would need to scale up the rotation rate @xmath283 by a factor of approximately 10 relative to the actual sun .",
    "we then chose values of of @xmath41 and @xmath8 to give practical values for @xmath106 and @xmath108 .",
    "table [ tab : parameter_sun ] gives the parameters for the solar benchmark .    the radiative flux @xmath188 is parameterized by expressing the radiative diffusion as @xmath284 , where @xmath285 , @xmath286 , @xmath287 , and @xmath288 .",
    "the parameter @xmath289 is chosen so that @xmath290 on the bottom boundary .",
    "as for the jupiter benchmark , we define a sampling time @xmath232 that is 10 days after the nonlinear saturation time .",
    "the sampling times are @xmath291 days and @xmath292 days for chorus and ash respectively .",
    "the number of dofs used for the chorus simulation is about a factor of 6.8 larger than that used for the ash simulation , as indicated in table [ tab : computational_effort ] .",
    "l dimensionless parameters + @xmath108 = 2.447 @xmath206 @xmath171 , @xmath293 = 3 , @xmath113 = 0.736762 , @xmath106 = 1,428,567 , @xmath294 = 1 , @xmath95 = 1.5 +   + defining physical input values + @xmath205 = 6.61 @xmath206 @xmath295 @xmath208 , @xmath209 = 8.1 @xmath206 @xmath296 @xmath211 , @xmath21 = 1.98891 @xmath206 @xmath297 @xmath213 , @xmath110 = 0.21 @xmath213 @xmath214 + @xmath103 = 1.4 @xmath206 @xmath228 @xmath216 @xmath217 @xmath218 , @xmath20 = 6.67 @xmath206 @xmath219 @xmath217 @xmath220 @xmath221 +   + derived physical input values + @xmath223 = 4.87 @xmath206 @xmath295 @xmath208 , @xmath224 = 1.74 @xmath206 @xmath295 @xmath208 ,",
    "@xmath8=6.0 @xmath206 @xmath298 @xmath226  @xmath211 , + @xmath41 = 6.0 @xmath206 @xmath298 @xmath226 @xmath211 , @xmath36 = 5/3 +   + other thermodynamic quantities + @xmath7 = 3.846 @xmath206 @xmath299 @xmath216 @xmath211 , @xmath44 = 3.5 @xmath206 @xmath228 @xmath216 @xmath217 @xmath218 +      the volume - averaged kinetic energy densities for both the chorus and ash simulations are plotted in fig.[fig : sun](a ) . as in the jupiter benchmark , the random initial conditions lead to differences in the initial transients but once the preferred linear eigenmode begins to grow the two simulations exhibit similar growth rates and nonlinear saturation levels .",
    "averaged between ( @xmath300 ) and @xmath232 days , @xmath301 @xmath216 @xmath214 for the chorus simulation and @xmath302 @xmath216 @xmath214 for the ash simulation .",
    "the difference is about @xmath303 . in the linear regime",
    ", they grow very fast and the ranges of a well - defined linear unstable regime are narrow as shown in fig.[fig : sun](b ) for both chorus and ash simulations .",
    "thus , only their maximum growth rates in that regime are compared .",
    "a difference of only @xmath238 is present between @xmath304 of the chorus simulation and @xmath305 of the ash simulation . at the sampling time @xmath232 , drke / ke@xmath306 and mcke / ke@xmath307 for the chorus simulation while drke / ke@xmath308 and mcke / ke@xmath309 for the ash simulation ( a discrepancy of about 9% and 19% respectively ) . as in the jupiter benchmark , this relatively large difference in mean flows is likely attributed to the immature state of the simulations , which has not yet achieved flux balance by the sampling time ( sec .",
    "[ sec : machsun ] ) .    .",
    "as in the jupiter benchmark , a low mach number is also achieved in this solar benchmark , with the maximum mach number around 0.017 and 0.015 for the chorus simulation and the ash simulation , respectively , as shown in fig.[fig : ma_sun ] .",
    "the value of @xmath135 also peaks in the upper convection zone ( fig .",
    "[ fig : epsilon_sun ] ) . reflecting the flatter entropy gradient at the sampling time @xmath232 ,",
    "@xmath135 becomes smaller where the convective efficiency is largest , near @xmath310 .",
    "the chorus and ash simulations also have similar flux balances as shown in fig.[fig : flux_sun ] .",
    "both are over - luminous ( @xmath311 ) due mainly to the large diffusive and entropy fluxes @xmath312 and @xmath313 , which have not yet equilibrated .",
    "this imbalance subsides by @xmath314 days as verified by an extended ash simulation .",
    "however , as with the jupiter benchmark , we have not run chorus to full equilibration because of the computational expense . increasing the luminosity",
    "further will mitigate this relaxation time and we plan to exploit this for future production runs .    the radiative flux @xmath188 carries energy through the bottom boundary and dominates the heat transport in the lower convection zone while the entropy flux @xmath189 carries energy through the top boundary and the upper convection zone .",
    "the enthalpy flux @xmath186 gradually increases towards the top until peaks near @xmath315 , and then drops down to zero rapidly as it approaches the impenetrable top boundary . at @xmath310 , @xmath316 and @xmath317 from the chorus simulation while @xmath318 and @xmath319 from the ash simulation .    .",
    "the structure of the convection in the solar benchmark is illustrated in fig.[fig : vr_sun ] .",
    "one would not expect the instantaneous flow field in a highly nonlinear simulation to correspond exactly between two independent realizations but the qualitative agreement is promising .",
    "this qualitative agreement is confirmed quantitatively by comparing the velocity spectra in fig.[fig : spectrum_sun ] .",
    "the radial velocity spectrum peaks at @xmath320 ( fig.[fig : spectrum_sun](_a _ ) ) and the meridional velocity spectrum exhibits substantial power in two wavenumber bands , namely @xmath320 and @xmath321 ( fig.[fig : spectrum_sun](_b _ ) ) . for the zonal velocity spectra ( fig.[fig : spectrum_sun](_c _ ) ) , three modes @xmath322 , and @xmath323 are prominent in the low @xmath251 ( @xmath324 ) range . after peaking at @xmath320 , the high-@xmath251 power decreases exponentially in amplitude .",
    "some of the small discrepancies between the two curves in each plot can likely be attributed to random temporal variations that would cancel out with some temporal averaging .      the meridional circulation from the chorus simulation ( see fig.[fig : mcdr_sun](a ) ) and the ash simulation ( see fig.[fig : mcdr_sun](e ) ) exhibit similar flow patterns with most circulations concentrating between the low latitudes and middle latitudes , outside the so - called _ tangent cylinder _ , namely the cylindrical surface aligned with the rotation axis and tangent to the base of the convection zone .",
    "the specific entropy perturbation @xmath272 are shown in fig.[fig : mcdr_sun](b ) for the chorus simulation and in fig.[fig : mcdr_sun](f ) for the ash simulation . in both simulations , the contours of @xmath272",
    "are symmetric about the equator . by comparing the contours of @xmath273 in fig.[fig : mcdr_sun](c ) for the chorus simulation and fig.[fig : mcdr_sun](g ) for the ash simulation , a good agreement is achieved . for both simulations",
    ", they also have similar differential rotation profiles as shown in fig.[fig : mcdr_sun](d ) and fig.[fig : mcdr_sun](h ) .",
    "some of the small discrepancies can likely be attributed to the flux imbalances shown in fig.[fig : flux_sun ] , causing mean flows to vary slowly as the simulations equilibrate from different random initial conditions and nonlinear saturation states .",
    "residual random temporal fluctuations may also be present despite the ( short ) time average , particularly for the meridional circulation which is a relatively weak flow with large fluctuations @xcite .    .",
    "as demonstrated in sec .",
    "[ sec : algorithm ] , the chorus code achieves excellent scalability out to 12k cores .",
    "this is strong scaling for intermediate - resolution simulations .",
    "we expect higher - resolution simulations to scale even better to tens of thousands of cores . in this section",
    "we consider chorus s performance relative to the anelastic code ash .",
    "the computational efforts are summarized in table [ tab : computational_effort ] . the resolution in ash",
    "is expressed as @xmath325 where @xmath326 , @xmath327 , and @xmath328 are the number of grid points in the radial , latitudinal , and longitudinal directions respectively . however , due to pseudo - spectral de - aliasing and the symmtery of the spherical harmonics , the effective number of dofs for ash is @xmath329 , where @xmath330 is the maximum spherical harmonic mode . for both benchmarks , @xmath331 and @xmath332 .",
    "the total number of core hours needed to run 10 days is much larger for chorus than it is for ash ; by more than three orders of magnitude for the jupiter benchmark and by a factor of 75 for the solar benchmark .",
    "much of this is due to the smaller time step required by the compressible scheme and the higher number of degrees of freedom used in running the chorus benchmarks .",
    "furthermore , the ash simulations were run on only 71 cores whereas the chorus runs typically employed several thousand.thus , imperfect scaling is a factor , as is a difference in the computational platform .",
    "the ash simulations were run with the intel xeon e5 - 2680v2 ( ivy bridge ) cores on nasa s plieades machine ( 2.8 ghz clock speed , 3.2gb / core memory ) whereas the chorus simulations were run with the intel xeon e5 - 2670 ( sandy bridge ) cores on ncar s yellowstone machine ( 2.6 ghz clock speed , 2 gb / core memory ) .",
    "furthermore , chorus uses a fourth - order accurate five - stage explicit runge - kutta method @xcite whereas ash uses a simpler second - order mixed adams - bashforth / crank - nicolson time stepping .",
    "this also contributes to the larger number of core hours per time step used by chorus ( table [ tab : computational_effort ] ) .",
    "though ash out - performs chorus for these simple benchmark problems , it must be remembered that such problems are ideal for pseudo - spectral codes ; relatively low resolution , laminar runs dominated by a limited number of spherical harmonic modes .",
    "the real potential of chorus will be realized for high - resolution , turbulent , multi - scale convection where its superior scalability and variable mesh refinement will prove invaluable .",
    "it can also be used for studying physical phenomena such as core convection and oblate stars that are challenging or even inaccessible to codes that use structured , spherical grids .",
    "furthermore , there is much potential for improvement in the efficiency of chorus ; we intend to implement an implicit time marching scheme and a p - multigrid method @xcite as well as local time stepping in the future , and to optimize the numerical algorithm for higher performance on heterogeneous ( cpu / gpu ) architectures that are very suitable for data structures of the sdm .",
    "llllc & & + code & chorus & ash & chorus & ash + resolution & 294,912 elements & @xmath333 & 307,200 elements & @xmath334 + dofs & 18,874,368 & 3,750,030 & 19,660,800 & 2,907,000 + time step ( s ) & 1.5 & 533 & 4 & 20 +   + core hours per time step & @xmath335 & @xmath336 & @xmath337 & @xmath338 +   + number of iteration + required to run 10 days & 576,000 & 1,621 & 216,000 & 43,200 +   + number of core hours + needed to run 10 days & 43,380 & 11.4 & 17,352 & 230 +",
    "we have developed a novel high - order spectral difference code , chorus , to simulate stellar and planetary convection in global spherical geometries . to our knowledge",
    ", the chorus code is the first stellar convection code that employs an unstructured grid , giving it unique potential to simulate challenging physical phenomena such as core convection in high and low - mass stars , oblate distortions of rapidly - rotating stars , and multi - scale , hierarchical convection in solar - like stars .",
    "the chorus code is fully compressible , which gives it advantages and disadvantages over codes that employ the anelastic approximation . on the one hand",
    ", the hyperbolic nature of the compressible equations promotes more efficient parallel scalability over the ( elliptical ) anelastic equations .",
    "indeed , we demonstrated that the chorus code does achieve excellent strong scalability for intermediate - size problems extending to 12,000 cores .",
    "we expect even better scalability for higher - resolution problems .",
    "furthermore , the fully compressible equations are required to accurately capture the small - scale surface convection in solar - like and less massive stars where mach numbers approach unity and where the anelastic approximation breaks down . on the other hand , the cfl constraint imposed by acoustic waves places strict limits on the allowable time step for simulating deep convection in most stars and planets , where the mach number is much less than unity .",
    "we intend to address this constraint in the future by implementing implicit and local time stepping schemes .",
    "to verify the chorus code , we defined two benchmark simulations designed to bridge the gap between fully compressible and anelastic systems .",
    "this allowed us to compare chorus results to the well - established ash code which employs the anelastic approximation .",
    "the two benchmark cases were formulated to simulate convection in the jupiter and sun .",
    "metrics of physical quantities sensitive to the convective driving and structure such as the linear growth rate and the total ke agree to lowest order in @xmath135 , the stratification parameter upon which the validity of the anelastic approximation is based .",
    "mean flows exhibit larger variations ( 5 - 20% ) that may be attributed to flux imbalances at the sampling time .",
    "better agreement between the two codes could likely be achieved by running the simulations longer but full equilibration would require at least an order of magnitude more computing time .",
    "we did not believe this computational expense was warranted given the good agreement at the sampling time .",
    "the level of agreement is remarkable considering that the chorus and ash codes not only solve different equations ( compressible versus anelastic ) but also they employ dramatically different numerical algorithms .",
    "thus , we consider the chorus code verified .",
    "future applications of chorus will focus on the applications discussed in  1 , namely the interaction of convection , differential rotation , and oblateness in rapidly - rotating stars , core convection in high and low - mass stars , hierarchical convection in solar - like stars , and the excitation of radial and non - radial acoustic pulsations within the context of asteroseismology .",
    "we have already implemented a deformable grid algorithm which we are now using to model oblate stars .",
    "the next step also include further development of chorus as a large - eddy simulation ( les ) code , with modeling of subgrid - scale ( sgs ) motions based either on explicit turbulence models or on the implicit numerical dissipation intrinsic to the sdm method .",
    "junfeng wang is funded by an newkirk graduate fellowship by the national center for atmospherical center ( ncar ) .",
    "chunlei liang would like to acknowledge the faculty start up grant from the george washington university .",
    "ncar is sponsored by the national science foundation .",
    "s.  h. saar , the activity cycles and surface differential rotation of single dwarfs , in : m.  dikpati , t.  arentoft , i.  g. hernandez , c.  lindsey , f.  hill ( eds . ) , solar - stellar dynamos as revealed by helio- and asteroseismology : gong 2008/soho 21 , asp conference series , vol .  416 , asp , san francisco , ca , 2010 , pp . 375384 .",
    "d.  r. soderblom , b.  f. jones , d.  fischer , rotational studies of late - type stars .",
    "m34 ( ngc 1039 ) and the evolution of angular momentum and activity in young solar - type stars , astrophys .",
    "j. 563 ( 2001 ) 334340 .",
    "h.  a. mcalister , t.  a. ten brummelaar , d.  r. gies , w.  huang , w.  g. bagnuolo jr . , m.  a. shure , j.  sturmann , l.  sturmann , n.  h. turner , s.  f. taylor , d.  h. berger , e.  k. baines , e.  grundstrom , c.  ogden , first results from the chara array .",
    "i. an interferometric and spectroscopic study of the fast rotator @xmath339 leonis ( regulus ) , astrophys .",
    "j. 628 ( 2005 ) 439452 .",
    "m.  s. miesch , j.  r. elliott , j.  toomre , t.  c. clune , g.  a. glatzmaier , p.  a. gilman , three - dimensional spherical simulations of solar convection : differential rotation and pattern evolution achieved with lamiar and turbulent states , astrophys .",
    "j. 532 ( 2000 ) 593615 .",
    "z.  j. wang , y.  sun , c.  liang , y.  liu , extension of the sd method to viscous flow on unstructured grids , in : h.  deconinck , e.  dick ( eds . ) , computational fluid dynamics 2006 , springer berlin heidelberg , 2006 , pp .",
    "119124 .",
    "f.  bassi , s.  rebay , a high - order accurate discontinuous finite element method for the numerical solution of the compressible navier ",
    "stokes equations , journal of computational physics 131 ( 1997 ) 267279 .                    m.  s. miesch , p.  a. gilman , m.  dikpati , nonlinear evolution of global magneto - shear instabilities in a three - dimensional thin - shell model of the solar tachocline , astrophys .",
    "j.  suppl .",
    "( 2007 ) 337361 ."
  ],
  "abstract_text": [
    "<S> we present a novel and powerful compressible high - order unstructured spectral - difference ( chorus ) code for simulating thermal convection and related fluid dynamics in the interiors of stars and planets . </S>",
    "<S> the computational geometries are treated as rotating spherical shells filled with stratified gas . </S>",
    "<S> the hydrodynamic equations are discretized by a robust and efficient high - order spectral difference method ( sdm ) on unstructured meshes . </S>",
    "<S> the computational stencil of the spectral difference method is compact and advantageous for parallel processing . </S>",
    "<S> chorus demonstrates excellent parallel performance for all test cases reported in this paper , scaling up to 12,000 cores on the yellowstone high - performance computing cluster at ncar . </S>",
    "<S> the code is verified by defining two benchmark cases for global convection in jupiter and the sun . </S>",
    "<S> chorus results are compared with results from the ash code and good agreement is found . </S>",
    "<S> the chorus code creates new opportunities for simulating such varied phenomena as multi - scale solar convection , core convection , and convection in rapidly - rotating , oblate stars .    </S>",
    "<S> spectral difference method , high - order , unstructured grid , astrophysical fluid dynamics </S>"
  ]
}