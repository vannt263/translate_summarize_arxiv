{
  "article_text": [
    "galaxy mergers are a natural and crucial ingredient of the @xmath0cdm hierarchical galaxy formation paradigm .",
    "although the fraction of galaxies undergoing a merger at any given time is relatively small , nearly all galaxies will experience a merger at some point in their histories ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "particularly significant are ` major ' mergers , which can be transformative . in these cases",
    ", mergers violently alter the orbits of the stars in the galaxies and can transform rotationally supported discs into dispersion - supported spheroids ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "furthermore , tidal torques exerted by the galaxies upon one another drive gas inwards ( e.g. , * ? ? ? * ; * ? ? ?",
    "* ) , thereby resulting in powerful starbursts ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) , triggering active galactic nuclei ( agn ) ( e.g. , * ? ? ?",
    "* ) , altering metallicity gradients @xcite , and leaving behind signatures of the starbursts and agn activity in the form of compact stellar cores ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) and supermassive black holes ( bhs ; e.g. , * ? ? ?",
    "also , mergers may drive the size evolution of quiescent galaxies ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "it has thus been proposed that various seemingly different observational classes of objects in the universe  including blue star - forming disc galaxies , irregular galaxies of a variety of morphologies , heavily dust - obscured ( ultra-)luminous infrared galaxies ( ( u)lirgs ) , both obscured and unobscured agn , ` post - starburst ' ( aka ` k+a ' ) galaxies , and ` red and dead ' elliptical galaxies  may be related in a merger - driven evolutionary sequence ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "galaxy mergers have been studied using numerical simulations for more than forty years ( @xcite ) , and for more than seventy years if one considers the pioneering laboratory method of @xcite .",
    "although the early simulations included only gravity , they provided much insight into the effects of mergers on galaxy morphologies , the formation of tidal tails and shells , and the kinematics of merger remnants .",
    "more sophisticated simulations ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) included also gas dynamical processes , which can be important for many galaxies because a significant fraction of the baryonic mass is in gas , and , unlike the stars , the gas is dissipational .",
    "hydrodynamic simulations of galaxy mergers have helped us to understand the driving mechanism of starbursts ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) , supermassive bh fueling and feedback ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) , feedback from supernovae ( e.g. , * ? ? ?",
    "* ) , the kinematics of merger remnants ( e.g. , @xcite ; @xcite ) , the survivability of discs during mergers ( e.g. , * ? ?",
    "? * ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) , the sizes of merger remnants ( e.g. , @xcite ; @xcite ; @xcite ) , and the formation of local ( e.g. , * ? ? ?",
    "* ) and high - redshift ulirgs ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) , among many other topics .",
    "whereas cosmological simulations are routinely performed using both grid - based eulerian and particle - based pseudo - lagrangian methods , idealised isolated ( i.e. , non - cosmological ) galaxy merger simulations have almost always been performed using pseudo - lagrangian smoothed particle hydrodynamics ( sph ; @xcite ; see @xcite , @xcite , and @xcite for recent reviews ) .",
    "sph is well - suited to simulating galaxy mergers because it naturally treats the large bulk velocities present before the discs coalesce and it concentrates resolution elements in regions where the mass is located ( the galaxy centre(s ) ; see section 9.4 of @xcite for further discussion ) .",
    "furthermore , the other primary method used for galaxy formation studies , adaptive mesh refinement ( amr ) , does not treat self - gravity as accurately as particle - based approaches @xcite . for these reasons , relatively few galaxy merger simulations have been performed using amr ( to our knowledge , the only published examples of such simulations are @xcite ) .",
    "recent studies that used simple , idealised test problems and cosmological simulations have highlighted potentially significant problems that are inherent in the standard formulation of the sph technique .",
    "@xcite demonstrated that the standard implementation of sph artificially suppresses the kelvin ",
    "helmholtz ( kh ) and raleigh  taylor ( rt ) instabilities because the method introduces spurious pressure forces near steep density gradients that allow a gap to be created between particles , thereby reducing their interactions .",
    "furthermore , sph can artificially damp subsonic turbulence @xcite and restricts gas stripping from substructures falling on to haloes @xcite .",
    "however , fixed grid - based methods also have drawbacks ; for example , these codes are not galilean invariant and can produce over - mixing @xcite .",
    "partially motivated by the limitations inherent in the traditional sph technique , @xcite developed a novel moving - mesh hydrodynamics code known as arepo .",
    "although similar approaches have been proposed earlier , such techniques have not yet seen wide - spread use in astrophysical applications .",
    "arepo  is quasi - lagrangian because the unstructured mesh is advected with the flow .",
    "whereas the motion of the grid reduces mass exchange between cells compared with a static mesh ( e.g. , * ? ? ?",
    "* ) , arepo  is not strictly lagrangian because the mass in a given cell can change with time .",
    "nevertheless , arepo  offers a number of advantages over other methods that make it attractive for astrophysical applications .",
    "for example , it is galilean invariant and naturally concentrates resolution elements in dense regions , similar to particle - based techniques . because arepo  uses a finite - volume method to solve the euler equations ,",
    "it is better than traditional sph at capturing shocks and contact discontinuities and does not artificially suppress fluid instabilities ( see also * ? ? ?",
    "* ; * ? ? ?",
    "its ability to better capture weak shocks than sph is potentially significant for cosmological problems because these features are ubiquitous in the cosmic web ( e.g. , * ? ? ?",
    "because of its hybrid nature , arepo  performs better than ( or at least as well as ) both traditional sph and grid - based approaches for idealised test problems . thus , it is useful to compare the results of arepo  simulations to those of simulations performed using other techniques to investigate what effects , if any , the shortcomings of the traditional methods have on the results of cosmological and idealised galaxy merger simulations .    some comparisons between cosmological simulations performed with arepoand gadget-3   in which all other ingredients , including the gravity solver and sub - resolution models , are identical  have already been made . in some situations , the baryonic properties of the simulations performed with the two codes differ strikingly . for example",
    ", @xcite demonstrated that gas cooling is more efficient in the arepo  simulations , which results in more star formation at late times .",
    "they attribute the difference to spurious heating in the outer regions of virialized haloes in the gadget-3  simulations and the inability of conventional sph to correctly develop a turbulent cascade to smaller scales .",
    "the arepo  simulations produce galaxies with extended , relatively smooth gas discs , whereas in the gadget-3  simulations , the discs are more compact and clumpy @xcite .",
    "@xcite demonstrated that the relative fraction of gas supplied to galaxies in halos of moderate to large size through ` cold - mode accretion ' ( aka ` cold flows ' ) is dramatically less in the arepo  simulations because with traditional sph , much of the cold gas that reaches the central galaxies does so because it is locked in ` blobs ' of purely numerical origin and because the rate at which gas cools from galaxies hot haloes is higher in arepobecause it allows for a proper cascade of turbulent energy to small scales .",
    "because of the nature of the aforementioned comparisons , the differences can only originate from differences in the hydrodynamical solver .",
    "it is sometimes argued ( e.g. , * ? ? ?",
    "* ) that the differences caused by inaccuracies in the numerical technique employed are subdominant to the effects caused by varying the prescriptions for star formation and stellar and agn feedback and hence may be ignored .",
    "however , the results of @xcite caution against this because they find differences in the accretion rate of hot gas on to galaxies between arepo  and gadget-3  that in some cases approach two orders of magnitude , which is far greater than the discrepancies between simulations and observations that feedback effects are invoked to resolve ( see @xcite and @xcite for comparisons of arepocosmological hydrodynamical simulations with observations ) .    with the exception of a single modest - resolution merger simulation presented in @xcite , the moving - mesh approach has not yet been used to simulate galaxy mergers . here , we present the first detailed study of idealised galaxy merger simulations performed using moving - mesh hydrodynamics .",
    "we present a small suite of simulations of equal - mass mergers simulated with both gadget-3  and arepo . to isolate differences caused by the different hydrodynamical solvers",
    ", we have kept all other components of the simulations ",
    "namely , the gravity solver and the sub - resolution models for star formation , the interstellar medium ( ism ) , bh accretion , and agn feedback  as similar as possible .",
    "other , more - comprehensive comparisons , such as the _ aquila _ @xcite and agora @xcite projects , allow multiple ingredients of the simulations to vary simultaneously , thereby yielding a general characterization of the systematic uncertainties due to different numerical methods and sub - resolution models .",
    "our goal is much more specific : we aim to isolate effects of the hydrodynamical solver from those caused by differences in the gravity solver or sub - resolution models , which is not readily possible in these other comparisons .    in our work",
    ", we have chosen to use a ` standard ' implementation of sph , as incorporated in the gadget-3  code .",
    "we have not explored recent variants of sph that are designed to improve its reliability in some circumstances ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) for several reasons .",
    "the most important is that we wish to assess the reliability of previous simulations of gas dynamics in galaxy mergers that were performed using traditional formulations of sph .",
    "we also note that many of the sph modifications that have recently been proposed have not yet been tested under a wide range of conditions .",
    "it is presently thus still unclear which of the numerous modification should eventually be adopted in a new ` best sph ' variant .",
    "also , a number of problems with sph are still unresolved even in the most recent proposed revisions of the method .",
    "we discuss these issues further below .",
    "the remainder of this paper is organised as follows . in section  [",
    "s : methods ] , we describe the two different hydrodynamical methods used and the sub - resolution models for star formation , bh accretion , and supernova and agn feedback . in section  [ s : results_no_bhs ] ( [ s : results_bhs ] ) , we compare gadget-3  and arepo  simulations that do not ( do ) include bh accretion and agn feedback .",
    "section [ s : tests ] presents tests of different methods for treating bh accretion and agn feedback that we used to inform our choice of a fiducial treatment . in section  [ s : discussion ] , we review some of the major issues with sph , discuss why sph works reasonably well for some applications but not others , and outline which previous work is likely to be robust to the hydrodynamical solver used and which may need to be reconsidered .",
    "section  [ s : conclusions ] presents our conclusions .",
    "as noted above , we use two different codes , gadget-3  and arepo , because we wish to investigate differences in the outcome that are driven by variations in the method used to solve the hydrodynamics .",
    "gadget-3  uses sph @xcite , a pseudo - lagrangian method . in sph ,",
    "the gas is discretised into particles , which are typically of fixed mass .",
    "the density field and other continuous quantities are calculated by taking the mean of the values of some number of nearest particles ( we use 32 ) weighted by the smoothing kernel . to derive the equations of motion",
    ", the lagrangian can be discretised and then the variational principle used @xcite .",
    "the formulation of sph used in gadget-3  is explicitly conservative even if the smoothing lengths vary @xcite .",
    "the advantages of modern sph include explicit conservation of mass , energy , entropy , and linear and angular momentum ; galilean invariance ; resolution that naturally becomes finer in regions of high gas density ; and accurate treatment of self - gravity .",
    "arepo  adopts a novel version of the other primary technique used in astrophysical hydrodynamics , the finite - volume ( i.e. , eulerian ) grid - based approach . in traditional amr codes , cubic cells at fixed spatial locations are employed , and the cells are refined and de - refined according to some criteria ( e.g. , the mass of cells can be kept approximately constant ) . in arepo ,",
    "the grid cells are not fixed in space ; rather , mesh - generating points are advected with the flow and a voronoi tesselation is used to generate an unstructured grid from the points .",
    "the euler equations are solved using a finite - volume approach .",
    "specifically , arepo  uses a second - order unsplit godunov scheme with an exact riemann solver .",
    "advantages of this moving - mesh approach compared with sph include the following : it is better at resolving shocks and contact discontinuities ; it does not suppress fluid instabilities ; and the density field across a resolution element ( a cell ) can be reconstructed to first order ( unlike in sph , for which the density can only be constructed to zeroth order ) .",
    "both codes use the same tree - based gravity solver , which is a modified version of that used in gadget-2@xcite .",
    "collisionless particles are used to represent dark matter and stars ; these particles are assigned fixed gravitational softening lengths . in gadget-3 ,",
    "the gas particles also have fixed gravitational softening .",
    "this treatment guarantees that , by using suitably small softening , one can have sufficient force resolution at all times .",
    "in contrast , the gravity solvers traditionally used in amr codes have force resolution that depends on the cell size and thus varies in time and space . even in collisionless simulations ,",
    "this treatment can lead to the suppression of small - scale structure ( i.e. , dwarf galaxies ) if cells around forming haloes are not refined sufficiently early @xcite . because arepo  treats the collisionless component using a tree - based method , it does not suffer from this problem .",
    "the quasi - lagrangian nature of the moving mesh cells also enables a superior treatment of gas self - gravity .",
    "arepo  treats each cell as if the mass were concentrated at the cell centre and calculates the softened gravitational force using a softening that is of order the cell radius . for all components ,",
    "gravitational interactions are softened using a cubic spline that has compact support ( e.g. , * ? ? ?",
    "full details of the treatment of self - gravity used in arepo  can be found in section 5 of @xcite .      in both gadget-3  and arepo , star formation and supernova feedback",
    "are implemented via the effective equation of state ( eos ) method of @xcite . only gas particles with density greater than a low - density cutoff ( @xmath1 @xmath2 )",
    "are assumed to have an eos governed by the sub - resolution model . in the @xcite model ,",
    "the ism is considered to consist of two phases in pressure equilibrium : cold dense clouds and a hot diffuse medium in which the cold clouds are embedded .",
    "the instantaneous sfr for each particle is calculated using a volume density - dependent kennicutt  schmidt @xcite prescription , @xmath3 , with @xmath4 .",
    "star particles are spawned from gas particles or cells probabilistically according to their sfrs .",
    "feedback from supernovae is included as an effective pressurization of the ism such that the equation of state of the gas is stiffer than an isothermal eos .",
    "see @xcite and @xcite for further details .",
    "we stress that the sub - resolution models for star formation and feedback in gadget-3  and arepo  are as similar as possible , which enables us to investigate differences caused solely by variations in the calculation of the hydrodynamics .      as for the star formation and stellar feedback sub - resolution models , we have attempted to keep the sub - resolution models for bh accretion and agn feedback in the two codes as similar as possible .",
    "however , for reasons we discuss in section [ s : tests ] , the default sub - resolution models for bh accretion and feedback used in gadget-3   and arepo   differ slightly . because we shall explore different numerical implementations of the bh accretion and feedback model ,",
    "we describe the model in some detail here , but see @xcite for a more thorough presentation .",
    "each disc galaxy is initialised with a @xmath5 central sink particle that undergoes modified eddington - limited bondi ",
    "lyttleton accretion @xcite .",
    "the accretion rate is the bondi ",
    "lyttleton accretion rate multiplied by a dimensionless factor @xmath6 : @xmath7 where @xmath8 is the gravitational constant , @xmath9 is the bh mass , @xmath10 is the local gas density , @xmath11 is the local sound speed , and @xmath12 is the velocity of the bh relative to the gas . because we typically do not resolve the bondi radius , the parameter @xmath6 , which we set equal to 100 , is used to account for the fact that we underestimate the density at the bondi radius . in practice , the choice of @xmath6 matters only at early times because most of the mass growth occurs during times of eddington - limited accretion , and the mass of the final bh is insensitive to the value of @xmath6 .",
    "the eddington - limited accretion rate is @xmath13 where @xmath14 is the proton mass , @xmath15 is the thomson cross - section , and @xmath16 is the radiative efficiency , which is defined by @xmath17 where @xmath18 is the luminosity of the bh .",
    "we assume @xmath19 @xcite .    the bh particles accrete mass at a rate @xmath20 in which the @xmath21 factor accounts for the rest - mass of the energy radiated away by the agn ( this factor was not included in the original @xcite treatment ) . in gadget-3 ,",
    "gas particles are swallowed stochastically . in arepo ,",
    "the more natural treatment is to continuously drain gas from the cell in which the bh is located .",
    "we have compared this treatment with one analogous to that in gadget-3 , in which cells are swallowed stochastically ; we found that for the mass and time resolutions of our simulations , the differences in the results are negligible ( but lower - resolution simulations can exhibit differences ) .",
    "to calculate the accretion rate given by equation  ( [ eq : bondi ] ) , we must determine @xmath10 and @xmath22 near the bh . in gadget-3 , the sph estimates for these quantities are used . in arepo , we can adopt analogous estimates , but we can instead also employ the quantities for the cell in which the bh is located . in principle , the latter should better represent the properties of the gas around the bh",
    ". however , the individual cell values can also be more noisy , so it is not clear a priori which is preferred .",
    "we compare the results obtained using the different treatments in section [ s : accretion_test ] .",
    "based on those tests , we chose to use the cell density and sph - like estimate of the sound speed in our default treatment .",
    "one potential issue when calculating the accretion rate using either the sph density estimate or the cell density is that as the bh consumes or expels the nearby gas , the region used for the density estimate can grow in size .",
    "consequently , the bh can continue to accrete gas from larger and larger scales , whereas in reality , bh accretion should terminate once the gas near the bh is consumed or expelled . in sph , this problem is unavoidable unless one reduces the number of neighbours used to estimate the density ( which is problematic because the noise in the density estimate will be increased significantly ) or a scheme that is more complicated than the simple bondi ",
    "lyttleton approach is employed ; one consequence is that lower - resolution simulations can sometimes exhibit more bh growth ( e.g. , * ? ? ?",
    "* ) . in arepo",
    ", this problem may be avoided by preventing cells near the bh from becoming too large .",
    "we do this by forcing the cells within some radius of the bh to be refined if they have a radius greater than some maximum value .",
    "we explore the effects of this refinement in section [ s : refinement_test ] . based on our tests",
    ", we decided to force cells within 500 pc of a bh to have a maximum size of 50 pc .",
    "bh accreting from a gas with sound speed @xmath23 km @xmath24 .",
    "thus , an even stricter refinement criterion could be justified , but because of the resolution of the simulations , there is no structure on smaller scales . ]    finally , because the initial bh particles are similar in mass to the stellar and dark matter particles , two - body interactions can cause the bh to stray from the centre of the potential well .",
    "however , in reality , dynamical friction would cause the bhs to rapidly sink to the potential minimum .",
    "thus , we pin the bh to the halo potential minimum . for this reason",
    ", we also neglect the @xmath12 term in the denominator of equation ( [ eq : bondi ] ) .",
    "we also include a simple model for thermal feedback from the agn @xcite .",
    "the bh particles deposit some fraction @xmath25 of their luminosity ( as thermal energy ) to the surrounding gas .",
    "we use @xmath26 because in previous gadget-2  simulations , this value yielded an @xmath27 relation normalization consistent with that observed @xcite .",
    "we scale the number of gas particles over which we distribute the feedback energy with resolution such that the total mass of the particles is constant .",
    "as we demonstrate in section [ s : fb_test ] , this scaling minimizes the resolution dependence of the sub - resolution model .",
    "it is desirable to have sub - resolution models that do not depend significantly on numerical resolution , at least as long as the physics that the sub - resolution treatment is meant to represent remains inaccessible .",
    "otherwise , the problem is not well - posed numerically and the interpretation of the sub - resolution model becomes unclear .",
    "the initial disc galaxies are created following the procedure described in @xcite .",
    "the galaxies consist of dark matter haloes described by a @xcite profile with virial velocity @xmath28 and concentration @xmath29 , an exponential stellar disc with scalelength @xmath30 and scaleheight @xmath31 , an exponential gaseous disc with scalelength @xmath32 and scaleheight determined by requiring the disc to be rotationally supported , and a bulge described by a @xcite profile with scalelength @xmath33 .",
    "note that , unlike in @xcite , the gaseous and stellar discs do not have the same scalelength ; rather , the gaseous discs can be significantly more extended than the stellar discs .    unlike sph , grid - based methods can not treat empty space .",
    "thus , for the arepo  simulations , we must add a background grid of low - density cells to the initial conditions used for the gadget-3  simulations such that the entire simulation volume has positive gas density .",
    "see section 9.4 of @xcite for details of how the background mesh is added .",
    "our intention is not to present a comprehensive suite of merger simulations that addresses the full parameter space but rather to directly compare the results obtained using arepo  and gadget-3  for a set of simulations based on galaxy models that are representative of a variety of actual galaxies . for definiteness",
    ", we use galaxy models that are similar to those of @xcite and the same merger parameters as @xcite .",
    "two of the isolated disc galaxies are intended to be milky way ( ) and small magellanic cloud ( ) analogues .",
    "the other two represent a dwarf starburst ( ) and a redshift @xmath34 disc galaxy ( ) .",
    "thus , the initial discs capture much of the diversity of real disc galaxies , but the sampling is by no means complete .",
    "the properties of the disc galaxies are given in table [ tab : galaxy_models ] .",
    "we simulate each disc galaxy with two different resolutions , which are specified in table [ tab : resolutions ] .",
    "we evolve each disc in isolation for 3 gyr . for the mergers ,",
    "two identical disc galaxies are placed on parabolic orbits with initial separation and pericentric passage distance as specified in table [ tab : orb_params ] . as in @xcite ,",
    "two orbits , the and orbits of @xcite , are used . for the orbit ,",
    "the directions of the spin axes of the discs given in spherical coordinates are @xmath35 . for , @xmath36 .",
    "note that neither orbit is coplanar ; thus , our general conclusions should be relatively insensitive to orbit ( mergers with perfectly coplanar orbits , which are of course highly unlikely in nature , can exhibit pathological behavior that is not characteristic of the behaviour for other orbits ) .",
    "because our focus is to compare the results of otherwise - identical gadget-3and areposimulations , two orbits is sufficient ; a comprehensive suite of simulations would ideally include a much wider variety of orbits ( see , e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "we run each merger simulation for @xmath37 gyr , depending on the simulation , which is sufficient time for the galaxies to coalesce .",
    "we typically simulate each merger at two different resolutions ( see table [ tab : resolutions ] for details ) .",
    "furthermore , to strengthen our conclusions regarding whether any resolution dependence is systematic , we performed the simulation with bh accretion and agn feedback included at a third , higher resolution . except where otherwise noted ,",
    "we always plot the results of the highest - resolution run .",
    "we first present a comparison of gadget-3  and arepo  simulations for which we disabled the bh accretion and agn feedback treatments in the codes .",
    "gyr , the absolute values of the sfrs for , , , and are @xmath38 , @xmath39 , @xmath40 , and @xmath41 , respectively .",
    "the sfhs are almost identical regardless of the resolution or code used.,title=\"fig : \" ] +   gyr , the absolute values of the sfrs for , , , and are @xmath38 , @xmath39 , @xmath40 , and @xmath41 , respectively .",
    "the sfhs are almost identical regardless of the resolution or code used.,title=\"fig : \" ]      +        a comparison of the star formation histories ( sfhs ) and cumulative stellar mass formed versus time for the isolated disc simulations is shown in fig .",
    "[ fig : iso_nb_sfhs ] .",
    "the solid ( dashed ) lines indicate the higher ( lower ) resolution runs , and blueish ( reddish ) colours indicate arepo  ( gadget-3 ) simulations .    the isolated discs ( fig . [ fig : iso_nb_sfhs ] )",
    "evolve in the expected manner : after some initial settling into equilibrium , as the gas is consumed ( in these idealised simulations , no additional gas is supplied during the simulations ) , the sfr decreases and the stellar mass formed increases . for the simulations ,",
    "there are some minor resolution- and code - dependent differences in the sfhs at @xmath42 gyr .",
    "the different runs are almost identical .",
    "the simulations exhibit minor resolution - dependent differences in the sfhs throughout the simulation .",
    "for the model , there are minor differences in the sfrs of the gadget-3  and arepo  simulations at @xmath43 gyr . in all cases ,",
    "the curves of cumulative stellar mass formed versus time are almost indistinguishable .",
    "these results demonstrate that for the isolated disc simulations , the two codes agree very well and the simulations are converged with respect to particle number ( at least in terms of their sfhs ) .",
    "[ fig : merger_nb_sfhs ] shows the sfhs for the merger simulations without bh accretion and agn feedback . as expected from much previous work , the mergers exhibit the following generic evolution .",
    "the sfr initially oscillates for a short time as the discs settle into equilibrium .",
    "then , there is a slight elevation when the discs are at first pericentric passage , but the bulges prevent the discs from becoming very unstable .",
    "as the discs approach final coalescence , in many cases , strong tidal torques drive gas into the nucleus and fuel a starburst .",
    "however , the strength and shape of the starburst depend on the progenitor properties and orbit . after the strong starbursts ( , , , and )",
    ", the sfr decreases to the pre - merger level or significantly below it .",
    "note that the decrease is driven solely by gas consumption and shock - heating of the gas because these simulations do not include agn feedback . in the other merger simulations , in which a strong starburst is not induced",
    ", the sfr can remain elevated for the duration of the simulation ( see especially and ) .    as can be inferred from fig .",
    "[ fig : merger_nb_sfhs ] , the agreement for the merger simulations is also excellent , although there are more noticeable differences than for the isolated disc cases .",
    "the most prominent difference is that for , , , and , the time at which the starburst occurs depends on resolution .",
    "this is likely caused by resolution - dependent variations in the hydrodynamical drag experienced by the galaxies as they collide , which can slightly alter the merging time - scales .",
    "however , for a given resolution , the sfhs during the starburst are similar for the two codes .",
    "the most significant , albeit still relatively minor , differences between the arepo  and gadget-3  simulations occur after the starbursts , e.g. , at @xmath44 , 2.9 , and 2.6 gyr for , , and , respectively .",
    "the sfhs do not vary systematically depending on the code used , e.g. , for the post - starburst phase of , the arepo  sfrs tend to be lower , whereas for , the opposite is true . as for the isolated discs , the differences in the cumulative stellar mass formed versus time are negligible .",
    "+            the agreement of the sfhs of the gadget-3  and arepo  simulations for both the isolated disc and merger simulations indicates that the differences in the numerical schemes do not dramatically affect the global evolution of the simulated systems .",
    "however , it is possible that the detailed properties of the simulated mergers differ despite the good agreement for the integrated quantities , and this is indeed the case .",
    "[ fig : nb_gas_comparison ] presents gas surface density plots for four different simulation snapshots .",
    "( the interested reader is invited to visit the aforementioned url to view animations that compare the time - evolution of the gas surface density for the highest - resolution runs of all simulations presented in this work . )",
    "the top row shows the arepo  result , and the bottom row shows the gadget-3  result for the same snapshot and resolution .",
    "the first column shows the isolated disc at @xmath45 gyr .",
    "the arepo  and gadget-3  results are qualitatively similar , but the gas distribution appears slightly smoother in the arepo  simulation and the orientation of the bar differs .",
    "the second column shows the merger at @xmath46 gyr , which is near final coalescence .",
    "again , the morphologies are very similar , but the spatial extent of the tidal tails differs slightly .",
    "the third column shows the merger near the peak of the starburst ( @xmath47 gyr ) . here , the gas distribution is again smoother in the arepo  run , and the gas morphology of the nuclear region differs quite dramatically .",
    "finally , the fourth column shows the merger at @xmath48 gyr ( @xmath49 gyr after the peak of the starburst ) . here , the differences are the most dramatic : the nuclear disc that has re - formed is oriented edge - on in the arepo  simulation but face - on in the gadget-3  simulation",
    "this is likely driven by the stochastic nature of the torques acting on the gas that accumulates in the centre of the remnant ( e.g. , * ? ? ?",
    "furthermore , the gadget-3  simulation features a clumpy , extended hot halo that is not present in the arepo  simulation .    in general ,",
    "the arepo  morphologies tend to be smoother than those yielded by gadget-3 , and the clumps that are often observed in the gadget-3  simulations ( and are spurious ; e.g. , @xcite ) are not present in the arepo  simulations .",
    "the differences between the two codes are most pronounced during the starburst and post - starburst phases .",
    "we discuss the physical reasons for these differences in detail in section [ s : reasons_for_agreement ] .",
    "we shall now compare the gas phase structure in the gadget-3  and arepo  simulations .",
    "animations showing the evolution of the gas phase structure for all simulations are available at the aforementioned url . for brevity",
    ", we will only discuss the general trends and present an illustrative example .    throughout the simulations ,",
    "the evolution of the gas phase structure is very similar in the arepo  and gadget-3  simulations when bh accretion and agn feedback are not included . given the results presented above , this result is not surprising : if the phase structure differed significantly , then the sfhs would not agree so well . as for the gas morphology",
    ", the differences are more pronounced in the starburst and post - starburst periods of the simulations .",
    "specifically , the arepo  simulations tend to exhibit less low - density , hot halo gas . in both the arepo  and gadget-3  simulations , a hot halo forms when gas is shock - heated during final coalescence of the discs . in the arepo  simulations",
    ", however , the hot halo gas cools more effectively for the reasons discussed in section [ s : reasons_for_agreement ] .",
    "[ fig : nb_pd_comparison ] demonstrates this difference .",
    "this figure shows example phase diagrams for the post - starburst phase ( @xmath48 gyr , @xmath50 myr after the starburst ) of the merger simulation performed using arepo  ( left ) and gadget-3  ( right ) .",
    "note that these correspond to the same simulation and output time as the gas surface density plots shown in the fourth column of fig .",
    "[ fig : nb_gas_comparison ] . in the arepo  simulation , there is less hot halo gas .",
    "the enhanced cooling of hot halo gas in the arepo  simulation explains why the sfr is somewhat higher in the arepo  simulation at this time ( see fig .",
    "[ fig : merger_nb_sfhs ] ) , which is also the case in some of the other merger simulations ( e.g. , ) .",
    "we now compare simulations that include bh accretion and agn feedback .",
    "here , we use the default accretion and feedback schemes discussed above , but we explore the implications of different choices in section [ s : tests ] .        +     +     +          +     +     +     +      +     +     +     +    fig .",
    "[ fig : iso_sfhs ] shows the sfhs and cumulative stellar mass formed versus time for the isolated disc simulations .",
    "blue ( red ) indicates arepo  ( gadget-3 ) simulations with bh accretion and agn feedback ; the corresponding simulations without bh accretion and agn feedback are indicated in cyan ( magenta ) for comparison .",
    "solid ( dashed ) lines indicate higher ( lower ) resolution simulations .    in general , for the isolated disc simulations , the agreement among the sfhs for the two codes and different resolutions is still relatively good , but the differences are clearly more significant than when bh accretion and agn feedback are disabled . for the case",
    "( first row of fig .",
    "[ fig : iso_sfhs ] ) , the arepo  simulations tend to have slightly higher sfrs , but the differences between the simulations sfrs are less than @xmath51 dex at all times .",
    "the cumulative stellar mass formed is indistinguishable .",
    "the sfhs for the simulations ( second row ) agree similarly well , and the cumulative stellar mass formed is nearly the same .",
    "for the simulations ( third row ) , the sfrs differ by as much as @xmath52 dex , but the resolution - dependent variations are as significant as those between the codes and the differences for simulations that vary only in whether they include bh accretion and agn feedback . in this case , the total stellar mass formed over the course of the simulations ( 3 gyr ) is @xmath51 dex less in the gadget-3  simulations with agn feedback , but all other simulations agree very well . finally , the sfrs of the isolated disc simulations ( fourth row ) can vary by as much as @xmath53 dex , and the primary cause of the difference is whether bh accretion and agn feedback are included ( in such simulations , the sfrs are systematically lower , as expected ) .",
    "however , the stellar mass formed is the same to within @xmath54 dex .    figs .",
    "[ fig : e_sfhs ] and [ fig : f_sfhs ] show the sfhs and cumulative stellar mass formed versus time for the -orbit  and -orbit  merger simulations , respectively . for brevity , we will not discuss each panel individually but rather highlight general trends . for a given progenitor combination and orbit , the shapes of the sfhs are qualitatively similar for both codes and all resolutions ( except in the cases for which agn feedback significantly impacts the post - starburst sfr ) .",
    "however , there are significant quantitative code- and resolution - dependent differences . for many of the simulations ( i.e. , , , , , and ) , the sfhs are almost identical up to final coalescence .",
    "if a strong starburst is triggered , the precise time and amplitude of the starburst can vary depending on the code and resolution . in some  but not all  cases ( and , in particular ) , inclusion of agn feedback causes the post - starburst sfr to decrease more rapidly compared with the corresponding simulations without agn feedback . although the sfhs differ significantly at some times , the cumulative stellar mass formed versus time is often very similar for the different codes and resolutions , as we saw above for the simulations without agn feedback and the isolated disc simulations with agn feedback . in most cases , the cumulative stellar mass formed differs by less than @xmath51 dex at all times .",
    "the merger simulations exhibit the most significant differences in the cumulative stellar mass formed : when agn feedback is included , the cumulative stellar mass formed in the arepo  simulations is @xmath55 dex greater than in the gadget-3  simulations .",
    "+          +     +     +        another quantity of interest is the bh mass versus time because differences in the bh masses would alter the strength of the agn feedback and thereby influence whether or not the merger remnants lie on the @xmath27 relation @xcite .",
    "it is natural to expect that the bh mass evolution is more code- and resolution - dependent than the sfh because the bh growth depends sensitively on the gas conditions in the nuclear region(s ) and could thus be affected by small - scale variations that would not significantly alter the integrated sfh .",
    "[ fig : iso_bh_mass ] shows the bh mass versus time for the isolated disc simulations . in the and simulations ,",
    "the bhs grow by only a modest amount ( @xmath56 and @xmath57 dex , respectively ) over the 3.0 gyr of the simulations . in the and simulations ,",
    "the bhs rapidly increase in mass by 2 - 3 orders of magnitude .",
    "this strong bh growth in the absence of a merger is driven by bar instabilities , which is clear from examination of the gas morphologies .",
    "the bh growth terminates once the gas near the bh is consumed or expelled .    for a given code ,",
    "the final bh masses in the isolated disc simulations differ with resolution by @xmath58 dex . however , the code - dependent variations can be more significant . in particular , note that the final bh masses in the arepo  simulations are a factor of @xmath59 greater than those in the gadget-3  simulations .    the bh mass evolution for the merger simulations is shown in fig . [",
    "fig : merger_bh_mass ] . in these plots ,",
    "the total mass of all bhs  recall that each progenitor disc is seeded with a bh  is plotted . for a given progenitor ,",
    "the bhs grow significantly more in the merger simulations than in the isolated disc simulations .",
    "the merger exhibits the weakest growth ( @xmath60 dex ) , and the merger simulations exhibit the strongest bh growth ( almost four orders of magnitude ) . as for the sfhs ,",
    "the code- and resolution - dependent differences amongst the bh masses in the merger simulations are more significant than for the isolated disc simulations . in many  but not all  examples , the bh masses are greater in the arepo  simulations than in the gadget-3  runs . the resolution - dependent variations ( which are at most @xmath40 dex and usually significantly less ) are typically less than the code - dependent differences ( for a given resolution , these can be as great as an order of magnitude ) , and the resolution dependence is not systematic .",
    "consequently , for a given code , the final bh masses should be considered uncertain by as much as a factor of a few .",
    "this reflects the high degree of non - linearity in the feedback - regulated bh growth .",
    "any small variation in the local gas conditions at the bh s position can influence its exponential growth rate and hence become strongly amplified with time .",
    "note also that the bh accretion histories can differ significantly depending on the resolution and code ; thus , during the merger , the bh masses at a given time can differ more significantly than the final bh masses ( i.e. , the bh masses after the bh growth has terminated , which can occur at different times for different resolutions and codes ) .",
    "interestingly , for the merger , which was simulated at three resolutions , the bh mass evolution in the two higher - resolution ( resolutions r3 and r4 ) simulations performed with a given code is almost identical , but the @xmath49 dex difference in the final bh masses yielded by the two different codes persists .",
    "thus , it is possible that the bh masses yielded by a given code would converge if all simulations were performed at even higher resolution , but we have not performed such simulations because of the computational expense and because the code - dependent differences , which are the focus of this work , remain even for the highest - resolution simulations .",
    "+            fig .",
    "[ fig : gas_comparison ] shows example gas surface density plots for the arepo  ( top row ) and gadget-3  ( bottom row ) simulations with bh accretion and agn feedback . as for the simulations without bh accretion and agn feedback , the morphologies are qualitatively similar , but",
    "the details differ . furthermore , as for the sfhs ,",
    "the code - dependent differences in the gas morphologies are more significant when bh accretion and agn feedback are included .",
    "the first column shows the isolated disc at @xmath61 gyr . at this time , a bar is evident in the arepo  simulation and much of the gas in the central region has been consumed because of the bar instability . in the gadget-3  simulation ,",
    "a bar is not evident ; rather , a large , irregularly shaped cavity , which contains some small clumps of dense gas , has formed .",
    "part of the reason for the significant differences between the arepo  and gadget-3  results is that in the arepo  simulations , the bh can only consume gas that is within 50 pc , whereas in gadget-3 , the region from which gas is accreted grows as the gas near the bh is depleted because a fixed number of neighbours is used to calculate the sph density estimate .",
    "note , however , that generically , holes tends to form around the bhs for the following physical reason : in the quiescent state that is eventually reached in isolation or at the end of a merger ( when the bh growth has effectively shut off ) , a small bubble of hot , low - density gas around the bh is created by the pressure that is sustained in our feedback model by the residual accretion .",
    "the second column shows the merger simulation at @xmath62 gyr ( after first pericentric passage ) .",
    "the results of both codes exhibit extended , smooth tidal features , and the morphologies are almost indistinguishable .",
    "this column exemplifies the good agreement that is characteristic of the pre - starburst phase of the merger simulations .    the third column of fig .",
    "[ fig : gas_comparison ] shows the merger near the peak of the starburst ( @xmath63 gyr ) .",
    "some of the filamentary structure is similar in the arepo  and gadget-3  simulations , but the detailed morphologies differ significantly . as noted above , the gadget-3  result exhibits many spurious clumps of gas that are not present in the arepo  simulation .    finally , the fourth column shows the merger at @xmath48 gyr , @xmath50 myr after the starburst .",
    "note that for comparison , this is the same simulation and time as shown in the fourth column of fig .",
    "[ fig : nb_gas_comparison ] , except that bh accretion and agn feedback are included here . for a given code ,",
    "the gas morphologies are similar to those of the simulations for which bh accretion and agn feedback were not included ( fig . [ fig : nb_gas_comparison ] ) .",
    "one notable difference is that in the gadget-3  simulation , the gas disc is less pronounced and the hot halo is more prominent .",
    "once again , the gadget-3  simulation features an extended halo of hot gas and spurious clumps , both of which are not present in the arepo  simulation .",
    "note that in this example , the code - dependent differences in the gas morphologies are more significant than those caused by the inclusion of agn feedback .",
    "this result is a counterexample to the conclusion of @xcite regarding the effects of various star formation and stellar feedback models compared with differences between codes and implies that it is highly desirable to use the most accurate hydrodynamical solver possible .           as for the simulations without bh accretion and agn feedback ,",
    "the gas phase structure in the gadget-3  and arepo  simulations is similar in the pre - starburst phase but can differ significantly during and after the starburst .",
    "again , we only present one example to illustrate the characteristic differences here , but the interested reader can visit the aforementioned url to examine the evolution of the gas phase structure for all simulations .",
    "[ fig : pd_comparison ] shows gas phase diagrams for the simulations with bh accretion and agn feedback at the same time as in fig .",
    "[ fig : nb_pd_comparison ] ( @xmath48 gyr , @xmath64 myr after the peak of the starburst and agn activity ) . for a given code ,",
    "the inclusion of agn feedback causes there to be more gas in the hot halo and correspondingly less gas on the eos ( the thin line in the lower - right corner ) . as for the simulations that did not include agn feedback , the gadget-3  simulation features more hot halo gas than the arepo  simulation , in which the hot halo gas cools more efficiently .      here , we present various tests that demonstrate the effects of the different treatments of bh accretion and agn feedback discussed above .",
    "we use the analogue as one test case . whereas for this simulation , the differences in the results are small in an absolute sense , they are systematic and can have more significant effects in other simulations .",
    "we chose to use the analogue as a test case because the sfh and bh growth are comparatively simple ; thus , differences can be more easily understood .",
    "furthermore , the bh grows very little ( @xmath65 , the seed mass , throughout the simulation ) and should have a negligible effect on the sfh of the galaxy .",
    "thus , the ` no bh ' case can be used as the baseline with which to compare the other runs ; ideally , the sfhs should be the same for the bh and ` no bh ' cases .",
    "we also investigate the effects of different bh accretion and agn feedback for the merger simulation . in this significantly more complicated case ,",
    "the interpretation of the comparisons among the different treatments of bh accretion and agn feedback is less straightforward , but many of the effects observed for the case are also observed here .",
    "the tests presented here justify our fiducial choices for the bh accretion and feedback implementations and demonstrate some important numerical effects that are not always appreciated in the literature .",
    "+     , but for the merger .",
    "the results are almost independent of the @xmath66 value for the higher resolution because the resolution around the bh is sufficiently high without the forced refinement .",
    "the final bh masses for the two resolutions agree better when @xmath67 pc , but this agreement does not indicate better convergence .",
    "see the text for details.,title=\"fig : \" ] + , but for the merger .",
    "the results are almost independent of the @xmath66 value for the higher resolution because the resolution around the bh is sufficiently high without the forced refinement .",
    "the final bh masses for the two resolutions agree better when @xmath67 pc , but this agreement does not indicate better convergence .",
    "see the text for details.,title=\"fig : \" ]    in sph , as the gas density in the immediate vicinity of a bh decreases because of gas consumption and expulsion , the radius over which the density is calculated increases because the number of neighbours used for the density estimate and the particle masses are fixed .",
    "thus , in some situations , the bh accretion rate can be overestimated and gas fuels the bh from unphysically large scales ; this is especially problematic in cosmological simulations , for which the resolution is often not better than a kiloparsec . in arepo , the standard cell refinement scheme attempts to keep cell masses comparable ; thus , a similar effect , in which cells near the bh grow large , can occur .",
    "however , unlike in sph , we can overcome this potential problem by preventing cells near the bh from becoming too large and using the gas density of the cell that contains the bh to calculate the accretion rate .",
    "consequently , if the gas density in the vicinity of the bh decreases , the accretion rate decreases concomitantly .",
    "[ fig : refinement_test ] demonstrates the effects of limiting the maximum cell size near the bh particle for the isolated disc case .",
    "we force cells located within 500 pc of the bh to be refined if their size is greater than some value @xmath66 .",
    "we show the results for @xmath68 and 200 pc in fig .",
    "[ fig : refinement_test ] .",
    "the top panel indicates that the choice of @xmath66 has no effect on the sfh , and the slight difference between the different resolutions at late times is independent of @xmath66 .",
    "however , the growth of the bh differs systematically . for both resolutions",
    ", the bh grows more when @xmath67 pc because of the effect described above , and the consequences are more severe for the lower - resolution simulation .",
    "when @xmath68 pc , the final bh mass is slightly less and the two different resolutions agree perfectly .",
    "[ fig : refinement_test_merger ] shows the results of changing @xmath66 for the merger simulation . in this case , the sfh is better converged when a maximum cell when @xmath68 pc . for the higher - resolution simulations ,",
    "the bh growth history is unaffected by the choice of @xmath66 .",
    "thus , for this resolution ( @xmath69 pc ) , the refinement near the bh is sufficiently high even without forcing refinement .",
    "interestingly , the final bh mass of the lower - resolution simulation with @xmath67 pc agrees better with that of the higher - resolution simulations than when @xmath68 pc . in this case , allowing larger cells near the bh by setting @xmath67 pc serves to mitigate some of the resolution dependence : in the lower - resolution simulation with @xmath68 pc , during the starburst at final coalescence , the central gas density is greater than in the higher - resolution runs .",
    "consequently , the bh grows more rapidly during that time . using @xmath67 pc results in a decreased central gas density and thus less - massive bh .",
    "however , this result should not be taken as an indication that the bh mass is better - converged when @xmath67 pc : if the bh mass were truly converged , the @xmath68 pc simulation should agree at least as well because in this simulation , the number of resolution elements is greater than or equal to that of the lower - resolution simulation .",
    "+     +      +     +    to calculate the bh accretion rate using equation  ( [ eq : bondi ] ) , we require the gas density and sound speed near the bh . in arepo",
    ", both quantities can be estimated in a manner analogous to that in sph , i.e. , by averaging over some number of nearest neighbour cells ( typically , 32 ) .",
    "however , it is also possible to use the gas density and sound speed for the cell in which the bh is located . in principle",
    ", the cell values should be more representative of the conditions near the bh and thus ensure a more physical calculation of the accretion rate , but they may be too noisy to be useful .",
    "we will explore the effects of these choices now .",
    "[ fig : accretion_test ] demonstrates the variations that arise from using different methods to calculate the bh accretion rate in arepofor the isolated disc case .",
    "the gadget-3  results are shown for comparison . in all cases ,",
    "the mass over which the feedback energy is distributed is kept constant , i.e. , the number of cells or particles over which the energy is distributed is increased as the cell mass is decreased .",
    "furthermore , cells within 500 pc of the bh are forced to have size less than @xmath68 pc .",
    "the differences in the sfh ( upper - left panel ) for the various treatments are small and comparable with the resolution - dependent differences .",
    "the bh growth history , in contrast , can be affected significantly ; the upper - right panel indicates that the final bh mass can differ by as much as 0.4 dex , and the effect in merger simulations can be even larger .",
    "the bh grows most in arepo  when the sph density and sound speed are used ( the blue curve ) .",
    "the reason is that , as shown in the lower - left panel , in arepo , the sph density estimate is systematically greater than the cell density ( and similar to the gadget-3  density ) .",
    "the gadget-3  simulations ( red curve ) exhibit the next highest bh growth ; the reason that they feature less growth compared with the analogous arepo  simulations is that the sph sound speed estimate ( lower - right panel ) is systematically higher in gadget-3than arepo .",
    "when the cell density is used , the bh grows less because the cell density is systematically lower than the sph density .",
    "the growth is most suppressed when the cell sound speed is used ( cyan curve ) because the cell sound speed is systematically higher than the sph sound speed .",
    "furthermore , the cell sound speed is very noisy , with variations of @xmath70 km@xmath24 from the mean value , and the cell density is significantly more noisy when the cell sound speed is used to calculate the bh accretion rate ( compare the cyan and green curves in the lower - left panel of fig .",
    "[ fig : accretion_test ] ) .    fig .",
    "[ fig : accretion_test_merger ] compares the different bh accretion rate treatments for the merger simulation . as for the isolated disc case ,",
    "the bh grows most when the sph estimates for the gas density and sound speed are used to calculate the accretion rate .",
    "using the cell density rather than the sph estimate results in a very similar final bh mass .",
    "furthermore , using both the cell density and sound speed results in the smallest final bh mass of the three lower - resolution simulations because the cell sound speed can be more than a factor of three greater than the sph estimate .",
    "although the differences in the bh masses caused by varying the sub - resolution model accretion rate calculation are significant ( @xmath52 dex ) , they are less than the differences between the two resolutions for a fixed code and those between the two codes for a fixed number of particles / cells .    based on these results , we chose to use the cell density for our production runs because this is more representative of the density near the bh than is the sph density , yet the two have comparable amounts of noise .",
    "however , we chose to use the sph estimate for the sound speed because the cell value is too noisy .",
    "+     +      +     +    the manner in which the agn feedback energy is distributed can also affect the bh growth .",
    "as explained in section [ s : bh_fb_method ] , our preferred method is to keep the mass over which the feedback energy is distributed ( the ` feedback mass ' ) constant .",
    "thus , for higher - resolution runs , in which the particle / cell mass is lower , the number of particles / cells over which the feedback energy is distributed should be increased .",
    "however , this is not the only possible approach ; an alternative approach is to keep the number of particles / cells over which the feedback energy is distributed fixed .",
    "but , as we will show now , this causes a stronger resolution dependence , which is undesirable for a sub - resolution model .",
    "[ fig : fb_test ] demonstrates the differences between these two choices for the isolated disc case . as in the previous test , there are minor variations in the sfhs at late times , but the magnitude of the difference is similar to that caused by varying the resolution .",
    "however , varying the method for distributing the feedback energy causes significant and systematic changes in the bh growth history . first , note that the dashed and solid blue lines , which correspond to the lower - resolution arepo  simulation and the higher - resolution simulation in which the feedback mass is kept constant , agree perfectly .",
    "the corresponding curves for the density and sound speed are ( necessarily ) in good agreement . in contrast",
    ", the arepo  run in which the number of cells over which the feedback is distributed is kept constant ( the cyan line ) has systematically less bh growth .",
    "the reason for this discrepancy is that the latter simulation has systematically lower gas density ( bottom left ) and higher sound speed ( bottom right ) because the agn feedback heats a smaller mass of gas compared with the lower - resolution run .",
    "consequently , the steady state that is reached is at a higher temperature and lower density .",
    "the analogous effect can be observed for gadget-3 , but in this case , there is still some resolution dependence even when the feedback mass is kept constant .",
    "[ fig : fb_test_merger ] shows a comparison of the different methods for distributing the feedback energy for the merger . for this model ,",
    "the sfh differs most significantly in the areporun in which an equal cell number is used ; in this case , star formation is quenched more effectively by the agn after the starburst than in any of the other simulations , and the sfh in this regime differs most significantly from that of the lower - resolution run .",
    "for the gadget-3simulations , the final bh mass of the lower - resolution run agrees slightly better with that of the higher - resolution run in which the mass over which the feedback energy is distributed is kept constant , as was observed for the case .",
    "however , for the areposimulations , the final bh mass in the higher - resolution run in which the number of cells over which the feedback energy is distributed is kept constant agrees better with the final bh mass of the lower - resolution simulation .",
    "the reason for this behaviour is that in the equal - mass run , the initial stage of rapid bh growth ( @xmath71 gyr ) is terminated slightly earlier and at a slightly lower bh mass than in the equal - cell - number run , primarily because the rapid decline in the gas density occurs earlier in the equal - mass run .",
    "consequently , during the final - coalescence phase , in which the bh undergoes eddington - limited accretion , the less - massive bh grows less .",
    "this unexpected behaviour demonstrates the difficulty of predicting the effects of the sub - resolution model in the significantly more complex context of galaxy mergers and highlights the aforementioned conclusion that the final bh masses should only be considered robust to within a factor of a few .",
    "furthermore , the difference in the final bh masses of the two higher - resolution simulations is less significant than the difference between either of these masses and that of the lower - resolution run .    the purpose of the sub - resolution model is to encapsulate in a simple manner physics that is not included in the simulations .",
    "the implicit assumption in our model is that the feedback energy deposited by agn is thermalised over some physical scale , and this physical scale does not and should not depend on the resolution of our simulations .",
    "thus , in our production runs , we kept the feedback mass constant .",
    "in earlier work @xcite , we have compared results from gadget-3and arepoand , in some cases , identified significant differences that we attributed to numerical issues with the conventional formulation of sph . in the present paper and in studies of the ly-@xmath6 forest ( e.g. , * ? ? ? * ; * ? ? ? * ) , it has been found that sph can produce results in certain regimes that agree well with grid - based codes .",
    "to understand this situation , we first briefly review the primary limitations of the sph approach that have become clear in recent work .",
    "this then allows us to discuss why sph can be expected to work reasonably well in some applications but not in others . finally , we comment on what this implies for the numerical robustness of different types of previous work .",
    "the traditional formulation of sph used in this work has been  and still is ",
    "being used for many astrophysical simulations .",
    "it is thus important to understand which of these results may be influenced by numerical artefacts of the type discussed below . whereas we acknowledge that there have been impressive efforts to address at least some of these issues ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) , we feel that there remain many lingering misconceptions about sph that muddle the interpretation of the reliability of simulations performed even with updated versions of this algorithm .",
    "the transition from the continuum equations of fluid dynamics to the discrete form used by sph involves a two - step procedure ( e.g. , * ? ? ?",
    "first , the exact fluid quantities are replaced by smoothed versions via a convolution with the smoothing kernel .",
    "second , the integral forms of these convolutions are replaced by discrete sums over the sph particles such that they can be evaluated numerically .",
    "the error made in the discretization step depends not on the number of sph particles , @xmath72 , but instead on the number of neighbours in the discrete sums , @xmath73 .",
    "if , as is typically done , @xmath73 is held fixed as @xmath72 is increased , there will be a _",
    "constant _ source of error in the local estimates even as the resolution of the simulation is nominally increased @xcite .",
    "consequently , local fluid estimates are often noisy and are not guaranteed to approach their continuum values as @xmath72 is increased .",
    "this source of noise , although small , may have a significant impact on flows in which the energy content is dominated by internal energy rather than kinetic or gravitational energy .",
    "the noise is particularly strong in gradients of interpolated quantities , most notably in the pressure force @xcite .",
    "furthermore , if @xmath72 is increased without simultaneously increasing @xmath73 , the solution may asymptote to a fixed result that is different from the true solution because of this constant source of error @xcite .",
    "tests by @xcite demonstrated that conventional implementations of sph do not accurately describe jumps in physical quantities across contact discontinuities because the pressure effectively becomes multi - valued at the interface , thereby resulting in artificial repulsive forces that act as a macroscopic surface tension .",
    "if two fluid phases in pressure equilibrium shear relative to one another , the spurious surface tension inhibits the proper growth of kelvin - helmholtz instabilities and the two phases will not mix together correctly . instead , the colder",
    ", more dense phase can fragment into clumps that retain their identity because of the presence of the spurious surface tension ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "various new formulations of sph have shown promise in alleviating this problem ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) ; thus , we will not dwell on it here .",
    "however , we mention it for completeness and because nearly all previous studies of galaxy mergers using sph have employed traditional formulations of sph that are susceptible to this surface tension issue .",
    "in most implementations of sph , the mass continuity equation is not integrated in detail ; instead , estimates of the fluid density at any given simulation time are made using kernel interpolation ( e.g. , * ? ? ?",
    "* ) applied to the current particle positions .",
    "partly for this reason , sph is often referred to as a ` lagrangian ' method . however , sph is only ` pseudo - lagrangian ' because the particle mass is fixed in time and particle shapes are not allowed to become distorted arbitrarily by the flow ( see @xcite for a detailed discussion ) .",
    "consequently , sph can not properly describe fluid mixing on small scales , whereas in arepo , mixing is not suppressed because the implied mass exchange between cells is computed correctly according to the continuity equation .      in",
    "essentially all widely used sph codes , shocks are captured using some form of artificial viscosity . ideally , this viscosity should operate only in and near shocks because it can have unintended consequences for the properties of the flow in other regions if it is not accurately controlled ; for example , it can cause spurious cooling in cosmological applications ( e.g. , * ? ? ?",
    "moreover , the action of the viscosity within shocks is to locally broaden them over several smoothing lengths , thereby degrading the effective spatial resolution in shocked regions .    many grid - based codes , including arepo , instead treat shocks by solving the riemann problem across all cell - cell interfaces .",
    "this treatment has several advantages because it implies that such codes minimize the additional source of unphysical diffusion that would arise from artificial viscosity and because shocks can be spatially resolved more precisely than in sph .      from the discussion in section [ s : limitations_of_sph ]",
    ", we can now provide arguments as to why sph yields results that are reliable in some situations and why it fails in others .",
    "for definiteness , we consider four applications : ( 1 ) idealized tests of driven supersonic and subsonic turbulence , ( 2 ) the intergalactic medium ( igm ) , ( 3 ) gas accretion on to galaxies , and ( 4 ) starbursts and agn activity in galaxy mergers , as described in this paper .",
    "@xcite compared gadget-3and arepofor idealized simulations of isothermal turbulence in periodic boxes subject to large - scale forcing .",
    "their tests demonstrate that the traditional formulation of sph , as incorporated in gadget-3 , does not yield a proper cascade of energy to small scales when the turbulence is subsonic , as illustrated in their fig .",
    "however , otherwise identical simulations performed with arepoand the navier - stokes version of arepo@xcite produced a well - developed turbulence spectrum , not only in the inertial range but also through the dissipational range .",
    "in contrast , sph was found to perform significantly more reliably for supersonic turbulence @xcite , yielding results that are in reasonable agreement with arepoindependent of the motion of the mesh .",
    "these apparently contradictory conclusions can be readily explained by the limitations discussed above in section [ s : local_noise ] and section [ s : shock_capturing ] . in the supersonic limit , the energy density of the fluid is dominated by kinetic energy . although noise is still present in the local fluid quantities ( see section [ s : local_noise ] )",
    ", its influence is subdominant in this regime .",
    "similarly , spurious entropy generation from the artificial viscosity ( see section [ s : shock_capturing ] ) is also a minor source of error .",
    "in contrast , for subsonic turbulence , the internal energy is comparable in magnitude to the kinetic energy ; thus , the force errors from gradient noise and excessive spurious dissipation corrupt the solution on small scales such that the correct cascade of turbulent energy is not reproduced .",
    "early simulation results for the ly-@xmath6 forest obtained using both sph @xcite and grid codes @xcite agreed well .",
    "more refined comparisons ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) have demonstrated that when applied to the same initial conditions , sph and grid codes yield statistical measures for the ly-@xmath6 forest , such as flux probability distribution functions and power spectra , that agree at the @xmath74 level .",
    "the reasons for this agreement can be understood based on the discussion in section [ s : limitations_of_sph ] .",
    "the energy density of the igm gas responsible for the ly-@xmath6 forest is dominated by kinetic and gravitational energy ; thus , errors in the local fluid quantities due to noise are subdominant .",
    "furthermore , the physical state of the gas is simple , in the sense that different phases of gas are not in close proximity .",
    "thus , errors such as those discussed in sections [ s : inaccurate_instabilities ] and [ s : inaccurate_continuity ] will not greatly affect the igm , and hence the sph results are fairly reliable .",
    "whether this conclusion also extends to metal lines , for which issues of mixing of galactic outflows with pristine igm gas become important , has not been investigated thus far .      within galaxy haloes ,",
    "however , the physical state of the gas can differ significantly between , e.g. , gadget-3and arepo@xcite .",
    "why should sph predict the physical state of the gas responsible for the ly-@xmath6 forest so reliably yet fail so spectacularly within the haloes of galaxies ?",
    "this can be understood by realizing that the internal energy in approximately hydrostatic gas is no longer negligible compared with the kinetic and gravitational energy .",
    "noise in the local sph estimates can then significantly affect the physical state of the halo gas by , for example , producing spurious viscous heating effects that reduce cooling flows ( e.g. , * ? ? ?",
    "moreover , the gas within haloes can exhibit complex phase structure , with cold , dense gas in close proximity to and shearing relative to shock - heated diffuse gas .",
    "when simulated with traditional sph , the different gas phases will not mix correctly , as demonstrated by @xcite , because fluid instabilities ( section [ s : inaccurate_instabilities ] ) and mixing due to fluid motions ( section [ s : inaccurate_continuity ] ) are not treated properly . instead , the cold gas can fragment into clumps that remain intact ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) , thereby delivering an artificial supply of cold , low - angular - momentum gas to the central galaxy , which in turn can inhibit the formation of a rotationally supported disc .      in this paper , we have demonstrated that the results of idealised ( i.e. , non - cosmological ) numerical experiments involving isolated disc galaxies and galaxy mergers are relatively similar between sph and the moving - mesh approach , in contrast with cosmological simulations of forming galaxies .",
    "this finding especially holds for simulations in which agn feedback is not included or , more generally , during early stages of mergers when the gas structure is relatively simple .",
    "later , once the gas becomes virialized and feedback from bh growth drives large - scale outflows , some detailed differences do however appear .",
    "the discussion in section [ s : limitations_of_sph ] can again be used as a guide to understand this behaviour .    in the simulations presented here ,",
    "we construct models of disc galaxies that evolve in isolation or merge . in these models ,",
    "the gas is initially rotationally supported in the galaxy potential ; thus , its internal energy is small compared with its kinetic and gravitational energy and the flows are effectively supersonic . in this regime ,",
    "similar to the gas that produces the ly-@xmath6 forest , we expect that noise in the sph estimates ( see section [ s : local_noise ] ) should not be a significant source of error .",
    "moreover , in the approach adopted here , as formulated originally in @xcite , there is no effort made to resolve the multiphase structure of the star - forming gas . instead",
    ", the ism is described using a sub - resolution model .",
    "because of this , as for the gas in the igm , the gas locally has a simple structure and different phases of gas do not exist in close proximity .",
    "as long as the gas can be characterised well in this manner , we do not expect errors associated with an inaccurate treatment of fluid instabilities ( section [ s : inaccurate_instabilities ] ) or mixing ( section [ s : inaccurate_continuity ] ) to affect our model galaxies .",
    "these conditions can start to be violated in a galaxy merger as gas is shock heated and virialized and as different gas phases start to shear relative to one another because of , e.g. , the action of agn feedback .",
    "we note that these conditions would also be violated in simulations that have enough resolution to truly resolve the multi - phase structure of the ism . in this case",
    ", extremely strong local density constrasts would be prevalent .",
    "furthermore , in contrast with cosmological simulations , in which gas cooling is a crucial determinant of how and when gas is supplied to galaxies , the gas flows in galaxy merger simulations are driven primarily by gravitational torques . in both the gadget-3  and arepo  simulations presented here , we use the same accurate tree - based gravity solver .",
    "consequently , the gravitational forces are treated equally accurately in both codes .",
    "this is another reason that the results agree relatively well .",
    "for the same reason , the dark matter halo mass functions of arepo  and gadget-3  cosmological simulations agree very well despite the significant differences in the distributions of baryons @xcite .",
    "as stressed above , the agreement is less good during the starburst and post - starburst phases of the merger simulations . during the starburst ,",
    "gas is shock - heated and a hot halo forms .",
    "if agn feedback is included , the amount of gas in the hot halo is increased .",
    "once this hot halo forms , cooling becomes important for the post - starburst sfr and gas morphology and thus the relevant differences between sph and grid - based approaches become manifest . as in cosmological simulations @xcite and idealised simulations of ` inside - out ' disc formation @xcite , gas cools more effectively from the hot haloes formed in the mergers in arepo  than in gadget-3 .",
    "furthermore , some gas that is ejected during the starburst and agn activity falls back on to the remnant during the post - starburst phase . in the arepo  simulations , infalling clumps and filaments are effectively disrupted , whereas in the gadget-3  simulations they survive ( see section [ s : inaccurate_instabilities ] ) ; the differences in this regard are the same that explain why ` cold flows ' are less prominent in cosmological simulations performed with arepo  @xcite , as discussed above .",
    "it is worthwhile considering the implications of the differences we have demonstrated , regarding both the robustness ( or lack thereof ) of previous work and comparisons of simulations with observations .",
    "we restrict ourselves to comments on the rich literature of simulations of isolated galaxies and galaxy mergers , which forms the central topic of this paper .    for the reasons discussed above",
    ", we in general expect many of these past works to be at most weakly affected by the inaccuracies of traditional sph provided they use cold gas from the start and do not have sufficient resolution to resolve a truly multi - phase ism . however , the differences that we found are much more significant once hot haloes are present in the simulations .",
    "hence , we expect that the results of simulations that initially include hot haloes in the progenitor galaxies ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) could differ significantly if a moving - mesh technique rather than traditional sph were used .",
    "furthermore , conclusions regarding hot haloes produced by gas shocking in mergers ( e.g. , * ? ? ?",
    "* ) , the x - ray emission from hot haloes ( e.g. , * ? ? ?",
    "* ) , and the properties of starburst- and agn - driven winds ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) may depend on the numerical method employed .",
    "also , because the re - formation of discs in mergers depends on gas cooling from the hot halo of the remnant , studies of disc re - formation ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "* ) might also be affected by the spurious suppression of cooling that is inherent in sph .",
    "indeed , we have already noted that the discs that re - form in the mergers presented here are very different in the gadget-3  and arepo  simulations ( see the fourth columns of figs .",
    "[ fig : nb_gas_comparison ] and [ fig : gas_comparison ] ) .",
    "the differences between traditional sph and moving - mesh simulations may also have important implications for studying agn feedback with merger simulations .",
    "in particular , the differences in the bh masses yielded by arepo  and gadget-3can affect the strength of the feedback , the agn luminosity and duty cycle ( e.g. , * ? ? ? * ; * ? ? ? * ; * ? ? ? * ) , and the @xmath75 relation of the merger remnants ( e.g. , * ? ? ? * ) .",
    "however , we caution that for the thermal agn feedback model presented here , the final bh masses depend primarily on the feedback coupling efficiency @xmath25 @xcite . because this number is very uncertain , it may be possible and reasonable to simply use a slightly reduced value of @xmath25 in arepo  to make the final bh masses more consistent with those yielded by gadget-3 .",
    "furthermore , the scatter in the bh masses for different resolutions suggests that the values of the final bh masses are only robust to within a factor of a few ( see also * ? ? ?",
    "recently , @xcite have presented idealised isolated disc and galaxy merger simulations performed with gadget-3that include models for star formation and stellar feedback that are significantly more sophisticated than the eos approach used here .",
    "this work attempts to directly resolve the ism multi - phase structure .",
    "hence , one possible concern is the use of traditional sph .",
    "however , @xcite also demonstrate that the results of their simulations agree rather well with the results of gadget-3simulations that employ the much simpler eos approach .",
    "also , @xcite compared simulations performed using the traditional density - entropy formulation of sph used in gadget-3with simulations performed using an alternative pressure - entropy formulation of sph @xcite that is designed to overcome the inaccurate treatment of fluid instabilities ; they found that the spurious cold clumps present in the outflows in the standard gadget-3simulations were not formed when the new pressure - entropy flavour of sph was used .",
    "thus , many of the conclusions of @xcite are likely robust to the hydrodynamical solver employed because the rotational support is still dominant over pressure forces , although some details , such as the post - starburst gas morphologies , are clearly affected .",
    "we have compared a suite of idealised isolated disc and galaxy merger simulations performed using the sph code gadget-3  and the moving - mesh hydrodynamics code arepo , both with and without bh accretion and agn feedback . to isolate the effects of the hydrodynamical solver used",
    ", we have kept all other aspects of the simulations ( i.e. , the gravity solver , the treatment of cooling , and the sub - resolution models for star formation , supernova feedback , bh accretion , and agn feedback ) as similar as possible .",
    "our principal conclusions are the following :    1 .   unlike for cosmological hydrodynamical simulations ,",
    "the results of idealised ( non - cosmological ) isolated disc and merger simulations performed with arepo  and gadget-3  are similar because ( 1 ) in these simulations , the gas is already initialised by hand in a rotationally supported disc , and thus the flow is supersonic in character and noise in the sph estimates is not a significant source of error ; ( 2 ) the gas phase structure is relatively simple ; and ( 3 ) gravitational torques ( rather than cooling ) are the primary determinant of the gas inflows .",
    "2 .   when bh accretion and agn feedback are not included , the results are quite insensitive to the code used .",
    "the sfhs and cumulative stellar mass formed versus time are remarkably similar .",
    "3 .   when bh accretion and agn feedback are included , the results of the two codes are qualitatively similar , but the quantitative differences are more significant . in particular , the bh masses can differ by as much as an order of magnitude .",
    "the arepo  simulations typically yield larger bh masses .",
    "4 .   the gas morphologies and phase structures are also similar but differ in detail .",
    "primarily , arepoyields smoother , less clumpy morphologies and less prominent hot gaseous haloes in the post - starburst phase . 5 .   as for cosmological simulations ,",
    "the differences between the sph and moving - mesh results are primarily caused by more efficient cooling of hot halo gas and stripping of gas clumps and filaments in arepo .",
    "much of the previously published results of idealised isolated disc and galaxy merger simulations are likely robust to the inaccuracies that are inherent in traditional sph . however , for some studies , such as simulations in which the progenitors are initialised with hot haloes and studies of disc re - formation in mergers , the arepo  results may differ qualitatively from those yielded by traditional sph .",
    "consequently , it would be interesting to revisit such studies using arepo .",
    "it is certainly reassuring that the bulk of our results for merger simulations exhibit good quantitative agreement between sph and the very different moving - mesh technique . interpreting this as a vindication of using sph for merger simulations",
    "would nevertheless be incorrect .",
    "as we have discussed , unsolved conceptual problems with the accuracy of sph and its convergence rate remain even in the most recent incarnations of the proposed improved versions of sph .",
    "we therefore think that more accurate numerical techniques , such as our moving - mesh approach , should clearly be preferred over traditional sph to perform such simulations , especially in future calculations for which a higher numerical precision and the resolution of multi - phase media is desired .",
    "we thank shy genel , phil hopkins , federico marinacci , rdiger pakmor , ewald puchwein , and debora sijacki for useful discussion ; jorge moreno and franois schweizer for detailed comments on the manuscript ; and the anonymous referee for a critical report that helped to improve the paper .",
    "cch is grateful to the klaus tschira foundation for financial support , acknowledges the hospitality of the aspen center for physics , which is supported by the national science foundation grant no .",
    "phy-1066293 , and heartily thanks andreas bauer for many python tips , which were very helpful for ( almost completely ) curing a long - standing idl dependency .",
    "vs acknowledges support from the european research council under erc - stg grant exagal-308037 . this research has made use of nasa s astrophysics data system bibliographic services ."
  ],
  "abstract_text": [
    "<S> galaxy mergers have been investigated for decades using smoothed particle hydrodynamics ( sph ) , but recent work highlighting inaccuracies inherent in the traditional sph technique calls into question the reliability of previous studies . </S>",
    "<S> we explore this issue by comparing a suite of gadget-3  sph simulations of idealised ( i.e. , non - cosmological ) isolated discs and galaxy mergers with otherwise identical calculations performed using the moving - mesh code arepo . </S>",
    "<S> when black hole ( bh ) accretion and active galactic nucleus ( agn ) feedback are not included , the star formation histories ( sfhs ) obtained from the two codes agree well . when bhs are included , the code- and resolution - dependent variations in the sfhs are more significant , but the agreement is still good , and the stellar mass formed over the course of a simulation is robust to variations in the numerical method . during a merger , </S>",
    "<S> the gas morphology and phase structure are initially similar prior to the starburst phase . </S>",
    "<S> however , once a hot gaseous halo has formed from shock heating and agn feedback ( when included ) , the agreement is less good . in particular , during the post - starburst phase , the sph simulations feature more prominent hot gaseous haloes and spurious clumps , whereas with arepo , gas clumps and filaments are less apparent and the hot halo gas can cool more efficiently . </S>",
    "<S> we discuss the origin of these differences and explain why the sph technique yields trustworthy results for some applications ( such as the idealised isolated disc and galaxy merger simulations presented here ) but not others ( e.g. , gas flows onto galaxies in cosmological hydrodynamical simulations ) .    </S>",
    "<S> [ firstpage ]    hydrodynamics  methods : numerical  galaxies : interactions  galaxies : starburst  galaxies : active  galaxies : formation . </S>"
  ]
}