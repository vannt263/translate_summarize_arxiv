{
  "article_text": [
    "directed graphs are natural combinatorial objects which are used to model systems in many areas including biology ( for example  @xcite ) , the social sciences ( for example  @xcite ) and computer science ( for example  @xcite ) . in this paper",
    "we consider the problem of sampling directed graphs with a given degree sequence",
    ".    for graph - theoretic terminology not introduced here , see  @xcite . a directed graph ( digraph )",
    "@xmath1 consists of a vertex set @xmath2 and an arc set @xmath3 note that digraphs as defined here are simple , which means that they contain no loops and no multiple arcs .    the arc @xmath4 is drawn as an arrow from @xmath5 to @xmath6 .",
    "we refer to @xmath5 as the _ tail _ and @xmath6 as the _ head _ of the arc . for a vertex @xmath5 ,",
    "the _ out - degree _ @xmath7 of @xmath5 is the number of arcs with tail @xmath5 .",
    "similarly , the _ in - degree _ @xmath8 of @xmath5 is the number of arcs with head @xmath5 . for a positive integer @xmath0 ,",
    "if @xmath9 for all vertices @xmath10 then we say that the digraph @xmath11 is _ @xmath0-regular _ ( or _ @xmath0-in , @xmath0-out _ ) .",
    "let @xmath12 be a sequence of positive integers , and let @xmath13 be the set of all simple @xmath0-regular digraphs on the vertex set @xmath14=\\ { 1,\\ldots , n\\}$ ] .",
    "the _ configuration model _ of bollob ' as  @xcite ( adapted for directed graphs ) gives an expected polynomial - time uniform sampling algorithm for @xmath13 when @xmath15 .",
    "there is a one - to - one correspondence between @xmath13 and the set of all @xmath0-regular bipartite graphs on @xmath16 with no edges in common with the perfect matching @xmath17 .",
    "the probability that a @xmath0-regular bipartite graph on the given vertex bipartition has no edges in common with this perfect matching is asymptotic to @xmath18 whenever @xmath19 , by  ( * ? ? ? * theorem 4.6 ) .",
    "this probability is polynomially small when @xmath20 .",
    "mckay and wormald s algorithm  @xcite for sampling @xmath0-regular graphs runs in expected polynomial time for @xmath21 , and hence gives rise to an expected polynomial - time algorithm for uniformly sampling elements of @xmath13 when @xmath20 .",
    "the set of all 1-regular digraphs is in one - to - one correspondence with the set of all derangements of @xmath14 $ ] , and here the configuration model corresponds to repeatedly sampling uniform permutations of @xmath22 until one is obtained without fixed points .",
    "the proportion of permutations which are derangements tends to @xmath23 , so this algorithm has linear expected running time .",
    "other algorithms for uniformly sampling derangements in linear expected time but an improved constant have been proposed , for example  @xcite .",
    "we know of no expected polynomial - time uniform sampling algorithm for regular digraphs other than those mentioned above .",
    "hence we turn our attention to the problem of obtaining approximately uniform samples from @xmath13 using a markov chain .",
    "( some markov chain definitions are given in section  [ s : intro - mc ] ; for others , see  @xcite . )    there is a very natural markov chain for digraphs which has arisen in many contexts , which we will call the _",
    "switch chain_. a transition of the switch chain is performed by randomly choosing two distinct arcs and exchanging their heads , if the two arcs are non - incident and if the resulting digraph does not contain any multiple arcs .",
    "see figure  [ f : chain ] for a precise description of the transition procedure of the chain .",
    "a transition of the switch chain is called _ switching along an alternating rectangle _ by rao , jana and bandyopadhyay  @xcite ; we will simply call it a _",
    "switch_. similar transformations were used by ryser  @xcite to study 0 - 1 matrices .",
    "besag and clifford  @xcite defined a related chain for sampling 0 - 1 matrices with given row and column sums , while diaconis and sturmfels  @xcite used a similar chain to sample contingency tables .",
    "rao , jana and bandyopadhyay  @xcite showed that the switch chain is not irreducible for general degree sequences .",
    "( however , they mention that degree sequences for which the switch chain is not irreducible are `` rather rare '' . ) for completeness , we prove in lemma  [ connected ] that the switch chain is irreducible for regular digraphs .",
    "this also follows from the existence of the multicommodity flow defined in sections  [ s : flow ] ,  [ s:2circuit ] .",
    "the switch chain is aperiodic for @xmath24 , as we prove in lemma  [ aperiodic ] .    in their empirical study of methods for generating directed graphs with given degree sequences , milo et al .",
    "@xcite wrote that the switch chain `` works well but , as with many markov chain methods , suffers because in general we have no measure of how long we need to wait for it to mix properly '' .",
    "our main result , theorem  [ main ] , partially answers this point by providing the first rigorous polynomial bound on the mixing time of the switch chain , in the special case of regular digraphs .",
    "let @xmath13 be the set of all @xmath0-regular digraphs on the vertex set @xmath25 , where @xmath26 is any integer - valued function which satisfies @xmath27 for all @xmath28 .",
    "let @xmath29 be the mixing time of the markov chain @xmath30 with state space @xmath13 and transition procedure given by figure  [ f : chain ] , for @xmath24 .",
    "then @xmath31 [ main ]    our proof of this result has two parts . to avoid using a lazy chain ( which stays where it is at each step , with probability at least @xmath32 ) we prove and apply a new result which can be used to bound the smallest eigenvalue of an ergodic reversible markov chain",
    "this new bound is based on diaconis and stroock  ( * ? ? ?",
    "* proposition 2 ) and inspired by sinclair  ( * ? ? ?",
    "* theorem 5 ) . to bound the second - largest eigenvalue of the chain",
    "we adapt the multicommodity flow analysis given in  @xcite for the undirected case .",
    "while some parts of the proof are very similar to  @xcite , significant extra technical difficulties arise in the directed setting .",
    "we expect that the bound on the mixing time given in theorem  [ main ] is far from tight , but proving a substantially tighter bound seems beyond the reach of known proof techniques .",
    "the _ flip chain _ is a markov chain which performs a restricted set of switches , designed to ensure that the underlying digraph never becomes disconnected .",
    "the flip chain for undirected graphs was described in  @xcite , and proposed as a self - randomizing mechanism for peer - to - peer networks .",
    "the mixing time of the flip chain for regular undirected graphs was analysed in  @xcite , building on the multicommodity flow analysis of the switch chain  @xcite .",
    "we expect that theorem  [ main ] can be used to show that the flip chain for digraphs is rapidly mixing for regular degree sequences .",
    "this result would be of interest since many protocols for communications networks ( such as peer - to - peer networks ) use directed communications ( see for example  @xcite ) .",
    "the structure of the rest of paper is as follows .",
    "the necessary markov chain definitions are given in the next subsection , together with the new result ( lemma  [ smallest - eigval ] ) for bounding the smallest eigenvalue of an ergodic , reversible markov chain . in section  [ s : markov ]",
    "we define the switch chain @xmath30 and prove that it is ergodic on @xmath13 for @xmath24 .",
    "a bound on the smallest eigenvalue of the chain is given in lemma  [ our - smallest - eigval ] , and a bound on the second - largest eigenvalue is stated in proposition  [ our - second - largest - eigval ] . to conclude section  [ s : markov ] ,",
    "we show how theorem  [ main ] follows from proposition  [ our - second - largest - eigval ] , and give an overview of the main steps of the multicommodity flow argument which is used to prove proposition  [ our - second - largest - eigval ] .",
    "this argument is presented in sections  [ s : flow]  [ s : analysis ] .",
    "finally , a worked example is given in section  [ a : example ] which illustrates several features of the multicommodity flow construction .",
    "before we begin our analysis , we mention some recent related work . in many practical situations ,",
    "almost uniformly random samples are required in order to estimate the average value of some observable of a system .",
    "kim et al .",
    "@xcite describe an alternative approach to this problem in the case of sampling directed graphs with given in - degrees and out - degrees .",
    "let @xmath33 , @xmath34 be two vectors of nonnegative integers with a common sum . denote by @xmath35 the set of all digraphs on the vertex set @xmath14 $ ] with in - degree sequence @xmath33 and out - degree sequence @xmath34 ( and assume that this set is nonempty ) .",
    "kim et al .",
    "describe an algorithm which runs in time @xmath36 and produces a random element of @xmath35 , drawn from a specific non - uniform distribution .",
    "the samples output by the algorithm are statistically independent , and the algorithm can calculate the weight of each digraph that it produces .",
    "they then explain how combining their algorithm with biased sampling allows the average value of any function on @xmath35 to be approximated .",
    "however , they do not analyse the running time of the biased sampling procedure , which could be very inefficient when the output distribution is far from uniform .",
    "( indeed , in  ( * ? ? ?",
    "* section 4.1 ) they assume that the number of samples in the biased sampling is some positive integer multiple of @xmath37 , which is usually exponentially large . )    we complete this section with a final remark .",
    "milo et al .",
    "@xcite wrote of the switch chain for directed graphs that `` theoretical bounds on the mixing time exist only for specific near - regular degree sequences '' , citing kannan , tetali and vempala  @xcite .",
    "however , this is not correct , as we now explain .",
    "two markov chains are considered in  @xcite .",
    "the first is an analogue of the switch chain for undirected graphs .",
    "a bound on the mixing time is given in  @xcite for near - regular bipartite undirected graphs , but no conclusion can be drawn from this for directed graphs .",
    "the second chain analysed in  @xcite is a markov chain for tournaments with a given score sequence .",
    "( a _ tournament _ is a digraph obtained by giving an orientation to each edge in an ( undirected ) complete graph .",
    "its _ score sequence _ is the sequence of out - degrees . )",
    "each transition of the markov chain reverses the arcs of a directed 3-cycle , so it is quite different from the switch chain .",
    "furthermore , tournaments are very special kinds of digraphs .",
    "we know of no rigorous polynomial bound on the mixing time of the switch chain for digraphs , other than theorem  [ main ]",
    ".    _ acknowledgements .",
    "_   i am grateful to brendan mckay for his suggestion that it seemed unnecessary to make the switch chain lazy , which led to the approach taken here .",
    "i am also grateful to the anonymous referee for their helpful comments , which improved both the content and the structure of this paper .",
    "let @xmath30 be an ergodic , time - reversible markov chain on the finite state space @xmath38 with transition matrix @xmath39 and stationary distribution @xmath40 .",
    "the _ total variation distance _ between two probability distributions @xmath41 on @xmath38 is given by @xmath42 the _ mixing time _",
    "@xmath43 is defined by @xmath44 where @xmath45 is the distribution of the state @xmath46 of the markov chain after @xmath47 steps from the initial state @xmath48 .",
    "let @xmath49 be the minimum stationary probability .",
    "the transition matrix @xmath39 has real eigenvalues @xmath50 where @xmath51 , and the markov chain is aperiodic if and only if @xmath52 .",
    "let @xmath53 be the second - largest eigenvalue in absolute value .",
    "the following result follows from sinclair  ( * ? ? ?",
    "* proposition 1 ) , which is based on a result of diaconis and stroock  ( * ? ? ?",
    "* proposition 3 ) .    _",
    "( ( * ? ? ?",
    "* proposition 1 ) ) _ the mixing time of the markov chain @xmath30 satisfies @xmath54 [ mix - eigvals ]    it has become common practice when applying this bound to first make the markov chain lazy ( that is , replace the transition matrix @xmath39 by @xmath55 ) .",
    "this ensures that all eigenvalues of the chain are nonnegative , so that @xmath56 and only @xmath57 needs to be bounded .",
    "however , we prefer not to use introduce unnecessary laziness and seek an alternative approach .",
    "diaconis and stroock proved a result  ( * ? ? ?",
    "* proposition 2 ) which provides an upper bound on @xmath58 , where @xmath59 is the smallest eigenvalue of a markov chain as in ( [ eigenvalues ] ) . in lemma  [ smallest - eigval ]",
    "below , we give a new method for bounding on @xmath59 .",
    "the new bound is obtained by modifying  ( * ? ? ?",
    "* proposition 2 ) in the same way that sinclair modified  ( * ? ? ?",
    "* proposition 1 ) to produce  ( * ? ? ?",
    "* theorem 5 ) .",
    "the modification results in a bound which is more local in character and seems easier to apply than  ( * ? ? ?",
    "* proposition 2 ) .",
    "( see also the discussion in  ( * ? ? ?",
    "* section 2 ) . )    to state the new bound we need some notation .",
    "write @xmath60 for the underlying graph of the markov chain @xmath30 , where @xmath61 and each edge @xmath62 corresponds to a transition of @xmath30 .",
    "that is , @xmath63 is an edge of @xmath60 if and only if @xmath64 .",
    "define @xmath65 for the edge @xmath66 .",
    "( if @xmath67 then the edge @xmath68 is called a _ self - loop _ at @xmath69 . )    for each @xmath70 , fix a particular cycle from @xmath69 to @xmath69 in @xmath60 with an odd number of edges , and denote it by @xmath71 .",
    "( such a cycle exists for each @xmath69 , since the markov chain is aperiodic . ) note that @xmath71 may be a 1-cycle , which is a walk along a self - loop edge at @xmath69 .",
    "write @xmath72 to denote the length of the cycle @xmath71 , which is a positive odd number .",
    "let @xmath73 be the set of these odd cycles , and define the parameter @xmath74    suppose that @xmath30 is a reversible , ergodic markov chain with state space @xmath38 .",
    "let @xmath51 and let the eigenvalues of @xmath30 be given by _",
    "( [ eigenvalues])_. then @xmath75 [ smallest - eigval ]    the proof is very similar to the proof of  ( * ? ? ? * proposition 2 ) , but using a different application of the cauchy - schwarz inequality , as in the proof of  ( * ? ? ? * theorem 5 ) .",
    "assign an arbitrary orientation to each cycle @xmath71 and let @xmath76 under this orientation . also define @xmath77 to be the distance from @xmath69 to @xmath78 along the oriented cycle @xmath71 . then for any function @xmath79 we have @xmath80 for all @xmath70 .",
    "given @xmath81 , let @xmath82 then for any nonzero function @xmath79 we have @xmath83 using the cauchy - schwarz inequality .",
    "exchanging the order of summation ( and now orienting each edge @xmath84 arbitrarily ) gives @xmath85 divide through by @xmath86 to obtain @xmath87 now set @xmath88 equal to any eigenfunction @xmath89 corresponding to @xmath59 .",
    "after rearranging this completes the proof , since @xmath90    this leads to an analogue of  ( * ? ? ?",
    "* corollary 6 ) .",
    "we also prove a bound for a special case which often arises .",
    "[ congestion - corollary ] under the same conditions as lemma  _ [ smallest - eigval ] _",
    "we have @xmath91 where @xmath92 in particular , if @xmath93 then @xmath94 ( where @xmath39 denotes the transition matrix of the markov chain ) .    the first statement follows immediately from theorem  [ smallest - eigval ] .",
    "now suppose that @xmath95 . then each @xmath96 is a self - loop .",
    "if @xmath97 is a self - loop at @xmath98 then @xmath99 is contained in exactly one element of @xmath100 , namely @xmath101 . in this case @xmath102",
    "if @xmath84 is not a self - loop then @xmath99 is not contained in any element of @xmath100 , and in this case @xmath103 therefore @xmath104 and the second statement follows from the first .",
    "we will use the _ multicommodity flow _ method of sinclair  @xcite to bound the second eigenvalue @xmath105 .",
    "a _ flow _ in @xmath60 is a function @xmath106 which satisfies @xmath107 where @xmath108 is the set of all simple directed paths from @xmath69 to @xmath98 in @xmath60 and @xmath109 .",
    "extend @xmath110 to a function on oriented edges by setting @xmath111 so that @xmath112 is the total flow routed through @xmath99 .",
    "let @xmath113 be the length of the longest path with @xmath114 , and let @xmath115 be the _ load _ of the edge @xmath99 .",
    "the _ maximum load _ of the flow is @xmath116 sinclair  ( * ? ? ?",
    "* corollary @xmath117 ) proves the following .    _",
    "( ( * ? ? ?",
    "* corollary @xmath117 ) ) _ for any reversible ergodic markov chain @xmath30 and any flow @xmath110 , the second eigenvalue @xmath105 satisfies @xmath118 [ second - eigval ]",
    "let @xmath119 be any function such that @xmath27 for all @xmath28 , and denote by @xmath120 the set of all @xmath121-regular simple digraphs with vertex set @xmath14=\\ { 1,2,\\ldots , n\\}$ ] .",
    "we usually hide the dependence of @xmath0 on @xmath22 and just write @xmath0 rather than @xmath121 ; similarly we write @xmath13 for @xmath120 .",
    "we will study the markov chain @xmath30 described in figure  [ f : chain ] , which we call the _",
    "switch chain_. from a given state , an unordered pair of two distinct arcs are chosen uniformly at random .",
    "then the two chosen arcs exchange heads , unless the chosen arcs are incident or exchanging their heads would create a repeated arc .",
    "note that two arcs are non - incident if and only if the set of endvertices of the two arcs contains exactly four vertices .",
    "we will write @xmath122 $ ] as shorthand notation for the switch that replaces the arcs @xmath123 , @xmath124 with the arcs @xmath125 , @xmath126 , as in figure  [ f : chain ] .",
    "the transition matrix @xmath39 of the markov chain satisfies @xmath127 if @xmath128 and @xmath129 differ by just a switch , with all other non - diagonal entries equal to zero . therefore @xmath39 is symmetric , so the stationary distribution of the markov chain is uniform over @xmath13 .",
    "it is not difficult to see that the switch chain is aperiodic , but for completeness we give a brief proof .",
    "the switch chain on @xmath13 is aperiodic for @xmath28 and @xmath130 .",
    "[ aperiodic ]    fix @xmath131 and choose an arc @xmath132 .",
    "since @xmath24 , there exists an arc @xmath133 .",
    "these two arcs are distinct but incident , and if they are the arcs chosen in the transition procedure then the switch will be rejected and the chain will remain at @xmath11 . hence @xmath134 .",
    "so there is a self - loop at every state of @xmath13 , which proves that the chain is aperiodic .",
    "rao , jana and bandyopadhyay  @xcite showed that the switch chain is not always irreducible on the set of all digraphs with a given degree sequence .",
    "characterisations of degree sequences for which the chain is irreducible were given in  @xcite .",
    "we will now prove that when @xmath28 and @xmath24 the set @xmath13 is connected under switches ; that is , that the switch chain is irreducible on @xmath13 .",
    "( this was already known when @xmath135 , see diaconis , graham and holmes  ( * ? ? ?",
    "* remark 2 ) . )",
    "we will use results from lamar  @xcite . for a set @xmath136 of vertices in a digraph @xmath11 , define the sets @xmath137 for @xmath138 , as follows : @xmath139 ( in  @xcite these sets are called @xmath140 , @xmath141 , @xmath142 , @xmath143 , respectively . )    [ connected ] the space @xmath13 is connected under switches when @xmath28 and @xmath130 .    for",
    "a contradiction , assume that @xmath13 is not connected under switches . then by lamar  (",
    "* theorems 3.3 and 3.4 ) , for any digraph @xmath144 there is a set of vertices @xmath145 such that the induced digraph @xmath146 $ ] is a directed 3-cycle and , writing @xmath147 for all @xmath148 ,    * all vertices in @xmath149 other than @xmath150 belong to @xmath151 , * no arcs from @xmath152 to @xmath153 are present , * all ( non - loop ) arcs from @xmath154 to @xmath155 are present .",
    "let @xmath156 for @xmath138 .",
    "considering the in - degree and out - degree of @xmath157 gives , using ( i ) , @xmath158 ( and in particular , @xmath159 ) .",
    "however , by ( ii ) , the in - degree of any element of @xmath160 is at most @xmath161 , the out - degree of any element of @xmath162 is at most @xmath163 and the out - degree of any element of @xmath164 is at most @xmath165 .",
    "this contradicts the assumption that @xmath144 unless @xmath166 but then @xmath167 , and this set is nonempty as @xmath28 . by ( iii ) , the in - degree of any element of @xmath168 is @xmath169 . since the in - degree of @xmath157 is @xmath170 , we obtain a contradiction .",
    "suppose that @xmath144 contains a directed 3-cycle on the vertices @xmath171 .",
    "consider the sets @xmath172 where @xmath148 .",
    "if @xmath173 does not belong to @xmath174 then we say that @xmath69 is a _",
    "useful neighbour _ for the given 3-cycle .",
    "( note that @xmath69 must be an in - neighbour or an out - neighbour of at least one vertex on the 3-cycle , since @xmath175 . )",
    "similarly , @xmath176 is called a _",
    "useful arc _ for the given 3-cycle if @xmath177 and one of the following conditions holds :    * @xmath178 , with @xmath179 and @xmath180 ; * @xmath181 , with @xmath182 and @xmath183 .    the following result will be used later .",
    "suppose that @xmath144 contains a set of three vertices @xmath184 such that the induced digraph @xmath146 $ ] is a directed 3-cycle",
    ". then there exists a useful neighbour or a useful arc for this 3-cycle .",
    "[ useful ]    suppose that there is no useful neighbour for the 3-cycle . then condition ( i ) from the proof of lemma  [ connected ] holds .",
    "for a contradiction , assume that there is no useful arc @xmath176 .",
    "then all ( non - loop ) arcs from @xmath185 to @xmath153 are absent in @xmath11 , and all ( non - loop ) arcs from @xmath186 to @xmath155 are present in @xmath11 .",
    "that is , conditions ( ii ) and ( iii ) from the proof of lemma  [ connected ] also hold .",
    "arguing as in the proof of lemma  [ connected ] leads to a contradiction .",
    "now we prove a bound on the smallest eigenvalue of the switch chain .",
    "suppose that @xmath28 and @xmath130 , and let @xmath187 .",
    "the smallest eigenvalue @xmath59 of the switch chain satisfies @xmath188 [ our - smallest - eigval ]    by lemma  [ aperiodic ] , there is a self - loop @xmath71 in @xmath189 at every @xmath190 .",
    "let @xmath191 be the set of these 1-cycles .",
    "since @xmath93 , the result follows from the second statement of corollary  [ congestion - corollary ] since @xmath192    we also need a bound on the second - largest eigenvalue of the switch chain .",
    "suppose that @xmath28 and @xmath130 , and let @xmath105 be the second - largest eigenvalue of the switch chain on @xmath13 .",
    "then @xmath193 [ our - second - largest - eigval ]    the proof of proposition  [ our - second - largest - eigval ] is lengthy and quite technical .",
    "we give an outline of the proof below , and full details in sections  [ s : flow][s : analysis ] . but first , we show how theorem  [ main ] can be proved from proposition  [ our - second - largest - eigval ] .",
    "if the smallest eigenvalue @xmath59 is nonnegative then @xmath56 , and by proposition  [ our - second - largest - eigval ] we have @xmath194 suppose now that @xmath59 is negative .",
    "then @xmath195 and it follows from lemma  [ our - smallest - eigval ] and proposition  [ our - second - largest - eigval ] that ( [ our - next - largest ] ) also holds in this case .    finally , we note that @xmath196 ( this is well - known but for completeness we sketch a proof .",
    "take a bipartite graph on @xmath197 vertices and assign @xmath0 `` half - edges '' to each vertex on the side .",
    "arbitrarily match each half - edge on the left to a half - edge on the right .",
    "there are at most @xmath198 ways to perform this matching . finally , orient each edge from left to right and identify the @xmath199th vertex on each side , giving a digraph on @xmath22 vertices which may have loops or multiple arcs . as each element of @xmath13",
    "can be formed from at least one matching in this way , we obtain an upper bound . )",
    "hence , since @xmath40 is uniform , @xmath200 substituting ( [ our - next - largest ] ) and ( [ log - omega ] ) into lemma  [ mix - eigvals ] gives the stated bound on the mixing time , completing the proof .    hence it remains to establish proposition  [ our - second - largest - eigval ] .",
    "we use a multicommodity flow argument to prove this result . before",
    "embarking on the proof , we outline the major steps in the argument .",
    "( we note that our proof follows the same general outline as most canonical path or multicommodity flow arguments , where encodings are often used .",
    "in particular , our proof builds upon the argument from  @xcite . )    * given distinct digraphs @xmath201 , we define a finite set @xmath202 of objects , called pairings . for each @xmath203",
    "we will define a canonical path @xmath204 from @xmath11 to @xmath205 , indexed by @xmath88 .",
    "then the flow @xmath110 is defined on @xmath206 by @xmath207 and is set to zero for all other paths .",
    "note that @xmath110 satisfies ( [ flow - condition ] ) . * to define @xmath204 we work with the symmetric difference @xmath208 of @xmath11 and @xmath205 ( with arcs of @xmath209 coloured blue and arcs of @xmath210 coloured red ) . in sections",
    "[ s : circuits ] and  [ s : circuit ] we show how to decompose @xmath211 into a sequence of arc - disjoint subdigraphs called 1-circuits and 2-circuits , in a canonical way .",
    "the canonical path @xmath204 is formed by processing each of these 1-circuits and 2-circuits in the given order . * we can process 1-circuits , and certain 2-circuits , in a way which is very similar to the method used in  @xcite for undirected graphs .",
    "the 2-circuits which can be handled in this way are called _",
    "normal_. section  [ s:1circuit ] explains how to process a 1-circuit and section  [ s : normal ] describes how to process a normal 2-circuit . *",
    "the main difficulties in the proof arise from the need to handle 2-circuits which are not normal .",
    "we further categorise these as _",
    "eccentric 2-circuits _ or _",
    "triangles_. sections  [ s : eccentric ] and  [ s : triangle ] describe how to process these 2-circuits .    by this stage",
    ", the multicommodity flow is completely defined .",
    "next we must analyse the flow in order to bound the maximum load of the flow , and hence the second - largest eigenvalue ( using lemma  [ second - eigval ] ) .",
    "* let @xmath212 be a transition along one of the canonical paths @xmath204 , and suppose that this transition is performed while processing the 1-circuit or 2-circuit @xmath213 .",
    "a set of _ interesting arcs _ for @xmath214 with respect to @xmath215 is defined .",
    "these are arcs which have been disturbed during the processing of @xmath213 and not yet returned to their original state , and they will play a key role in our analysis .",
    "lemma  [ zoo ] describes the structure of the digraph formed by the interesting arcs ( see also figure  [ f : zoo ] ) .",
    "* next we identify @xmath11 , @xmath205 and @xmath214 with their adjacency matrices and define a matrix @xmath216 by @xmath217 .",
    "then @xmath216 is an @xmath218 matrix with entries in @xmath219 .",
    "we say that @xmath216 is an _ encoding _ for @xmath214 with respect to @xmath220 .",
    "lemma  [ notquiteunique ] shows that given @xmath212 , @xmath216 and @xmath88 there are at most four possibilities for @xmath220 such that @xmath212 is a transition on @xmath204 and @xmath216 is an encoding for @xmath214 with respect to @xmath220 .",
    "further information about the structure of @xmath216 is given in lemma  [ structure ] .",
    "* now the notion of encoding is broadened to encompass any @xmath218 matrix with entries in @xmath219 such that all row sums and column sums equal @xmath0 .",
    "given @xmath221 , we say that the encoding @xmath216 is @xmath214__-valid _ _ if every entry of @xmath222 belongs to @xmath223 and @xmath224 satisfy the conclusions of lemma  [ structure ] .",
    "( here @xmath211 is the digraph defined by all entries of @xmath222 which equal 1 . )",
    "lemma  [ zvalid ] proves a useful fact about @xmath214-valid encodings .",
    "* next we explain how to apply switches to encodings , and prove in lemma  [ fix ] ( using lemma  [ zvalid ] ) that any @xmath214-valid encoding can be transformed into an element of @xmath13 using at most three switches . counting the number of ways these switches can be performed in reverse leads to an upper bound of the form @xmath225 on the number of @xmath214-valid encodings , as proved in lemma  [ poly ] . *",
    "combining all this allows us to prove an upper bound on the total flow routed through an arbitrary transition of the markov chain .",
    "this bound , of the form @xmath226 , is proved in lemma  [ load ] . with this in hand it is easy to establish a polynomial bound on the maximum load @xmath227 of the flow , and hence to prove proposition  [ our - second - largest - eigval ] .",
    "we now define the multicommodity flow which will be used to bound the second largest eigenvalue , and hence the mixing time , of the switch chain for regular directed graphs .    for @xmath228 ,",
    "let @xmath208 be the symmetric difference of @xmath11 and @xmath205 , together with an arc - colouring which colours all arcs of @xmath229 blue and all arcs of @xmath230 red .",
    "this arc colouring means that we can think of @xmath211 as the symmetric difference of the _ ordered pair _",
    "@xmath220 .    for @xmath10 let @xmath231 be the blue in - degree of @xmath5 , which equals the red in - degree of @xmath5 , and",
    "let @xmath232 be the blue out - degree of @xmath5 , which equals the red out - degree of @xmath5 .",
    "choose a _ pairing _ of the red and blue arcs around each vertex as follows : each blue arc with head @xmath5 is paired with a red arc with head @xmath5 , and each blue arc with tail @xmath5 is paired with a red arc with tail @xmath5 , defining two bijections ( one from the set of blue arcs with head @xmath5 to the set of red arcs with head @xmath5 , and one from the set of blue arcs with tail @xmath5 to the set of red arcs with tail @xmath5 ) .",
    "denote the set of all such pairings by @xmath202 .",
    "then @xmath233 is the total number of pairings .",
    "write @xmath60 for the underlying graph of the markov chain @xmath30 , where @xmath234 and each edge @xmath62 corresponds to a transition of @xmath30 . for each pairing in @xmath202",
    "we construct a canonical path from @xmath11 to @xmath205 in @xmath60 .",
    "each of these paths will carry @xmath235 of the total flow from @xmath11 to @xmath205 .",
    "we now introduce some terminology .",
    "forward circuit _ in @xmath211 is a string @xmath236 over the alphabet @xmath237 such that the arcs @xmath238 are all distinct , all belong to @xmath239 and alternate in colour : that is , the arcs in @xmath240 all have one colour and the arcs in @xmath241 all have the other colour .    the _ converse _ of @xmath211 is the digraph obtained from @xmath211 by reversing the direction of every arc ( but keeping the colours the same ) . a _",
    "reverse circuit _ in @xmath211 is a string @xmath236 over the alphabet @xmath237 which forms a forward circuit in the converse of @xmath211 .",
    "that is , the arcs @xmath242 are all distinct , all belong to @xmath239 and alternate in colour , so that the arcs in @xmath243 all have one colour and the arcs in @xmath244 all have the other colour . by _",
    "we mean either a forward circuit or a reverse circuit .",
    "for a forward or reverse circuit @xmath245 , denote by @xmath246 the set of arcs in ( [ arclist ] ) or ( [ reversearclist ] ) , respectively .",
    "it is important to note that the arcs of a circuit alternate both in colour and orientation at each step . while a circuit may contain both the arcs",
    "@xmath176 and @xmath247 , any three consecutive vertices on the circuit are distinct .",
    "we now define two operations on digraphs .",
    "let @xmath248 denote the operation which takes a digraph to its converse ( that is , it reverses every arc in the digraph ) , and let @xmath249 be the operation which takes a digraph to its complement . writing @xmath14^{(2)}$ ] for the set of all ordered pairs of distinct elements of @xmath14 $ ] , the complement @xmath250 of a digraph @xmath11 has arc set @xmath14^{(2 ) } - a(g)$ ] .",
    "note that the operations @xmath248 and @xmath249 commute and are both involutions .",
    "we can also apply @xmath248 and @xmath249 to the ( arc - coloured ) symmetric difference @xmath251 . here",
    "@xmath252 is the result of reversing every arc in @xmath211 , without changing the colour of any arc .",
    "similarly , @xmath253 is the result of exchanging the colour of every arc in @xmath211 ( so that blue becomes red and vice - versa ) , without changing the orientation of any arc . to see this , note that the set of blue arcs in @xmath251 equals @xmath254 but this equals the set of red arcs in @xmath255 ( and similarly , the set of red arcs in @xmath256 equals the set of blue arcs in @xmath255 ) .",
    "finally , we generalise these definitions so that they also apply to ( arc - coloured ) sub - digraphs @xmath136 of @xmath211 . that is",
    ", @xmath257 is the result of reversing every arc in @xmath136 , without changing the colour of any arc , while @xmath258 is the result of exchanging the colour of every arc in @xmath136 without changing the orientation of any arc .",
    "fix a pairing @xmath203 .",
    "we decompose @xmath211 into a sequence of circuits depending on @xmath88 , as follows .",
    "let @xmath259 be the lexicographically least arc in @xmath211 .",
    "choose the arc @xmath260 which is paired with @xmath259 at @xmath261 .",
    "( note that if @xmath259 is blue then @xmath260 is red , and vice - versa .",
    "furthermore , @xmath262 since @xmath211 is a symmetric difference . ) next choose the arc @xmath263 which is paired with @xmath260 at @xmath264 .",
    "( this arc will have the same colour as @xmath259 . )",
    "continue in this fashion . specifically , for @xmath265 , if @xmath266 then let @xmath267 be the arc which is paired with @xmath268 at @xmath269 and let @xmath270 be the arc which is paired with @xmath271 at @xmath272 .",
    "the vertices @xmath273 are not necessarily distinct , but the arcs are distinct .",
    "the process terminates when @xmath274 is paired with @xmath259 at @xmath275 , giving a forward circuit @xmath276 .",
    "if @xmath277 then @xmath278 and we are done . otherwise , take the lexicographically least arc not in @xmath279 and generate a new circuit @xmath280 by the above procedure .",
    "continue generating circuits until @xmath281 then @xmath282 and the circuits @xmath283 are arc - disjoint .",
    "note that , once the pairing has been chosen , @xmath284 is formed without regard to the colouring of @xmath211 .",
    "this property will be needed later .",
    "using @xmath284 , we form a path @xmath285 from @xmath11 to @xmath205 in the underlying graph of the markov chain ( that is , to get from @xmath286 to @xmath287 we perform a switch ) .",
    "the path is defined by processing each circuit @xmath288 in turn . processing a circuit changes its arcs from agreeing with @xmath11 to agreeing with @xmath205 , with no other arcs being permanently altered ( though some may be temporarily changed while processing the circuit @xmath288 ) .",
    "the canonical path is defined inductively .",
    "if @xmath289 is the canonical path obtained by processing the first circuit @xmath279 , and @xmath290 is the canonical path from @xmath291 to @xmath205 obtained by processing the circuits @xmath292 , in order , then the canonical path from @xmath11 to @xmath205 corresponding to @xmath88 is given by the concatenation of these two paths .",
    "thus it suffices to describe the canonical path corresponding to a particular circuit @xmath293 .",
    "first we may need to decompose the circuit @xmath245 further .",
    "a _ 1-circuit _",
    "@xmath294 is a string on the letters @xmath295 such that @xmath296 and @xmath275 appears only once in @xmath213 .",
    "usually a 1-circuit will be a contiguous substring of @xmath245 ( allowing reversal of direction and/or cyclic wrapping around @xmath245 ) , but it may also contain one arc which is not an arc of @xmath245 .",
    "we now show how to decompose a circuit into a sequence of 1-circuits ( and possibly some single switches ) which will then be processed in order ( as described in section  [ s:1circuit ] ) to form the canonical path corresponding to @xmath245 .",
    "given a circuit @xmath236 , let @xmath297 and let @xmath298 ( which is the currently unprocessed segment of @xmath245 ) .",
    "suppose that the current digraph on the canonical path from @xmath11 to @xmath205 is @xmath299 . if @xmath300 for @xmath301 then @xmath302 is a 1-circuit which we process ( using the procedure described in section  [ s:1circuit ] ) , extending the canonical path as @xmath303 this completes the processing of @xmath245 .",
    "otherwise , @xmath5 appears @xmath304 times on @xmath302 , where @xmath305 .",
    "relabel the vertices on @xmath302 as @xmath306 by construction , @xmath302 is a forward circuit , so @xmath307 .",
    "firstly , suppose that @xmath308 is a 1-circuit .",
    "that is , arcs @xmath309 and @xmath310 are present on @xmath213 , with opposite colours .",
    "process the 1-circuit @xmath213 , extending the canonical path as in ( [ process ] ) , leaving the forward circuit @xmath311 as the unprocessed section of @xmath245",
    ". then process @xmath312 inductively .    next",
    ", suppose that we are not in the above situation ( so that the arcs @xmath309 and @xmath313 are present on @xmath213 , with the same colour ) , but that @xmath314 is a 1-circuit .",
    "that is , the arcs @xmath315 and @xmath316 are present on @xmath213 , with opposite colours .",
    "process the 1-circuit @xmath213 , extending the canonical path as in ( [ process ] ) , and leaving the forward circuit @xmath317 to be processed inductively .    finally , suppose that neither of the two situations above apply .",
    "then the arcs @xmath309 and @xmath313 have one colour while @xmath318 and @xmath319 have the other colour .",
    "we will process @xmath320 ( which we call a _ 2-circuit _ ) , extending the canonical path as in ( [ process ] ) and leaving @xmath321 to be processed inductively .",
    "here @xmath312 is a reverse circuit and we process it using the same procedure as described above , but with all arcs reversed .",
    "all 1-circuits and 2-circuits created by the above procedure are called _",
    "raw_. the order in which we detect and process raw 1-circuits and raw 2-circuits implies that both the processed and unprocessed sections of @xmath245 are contiguous whenever the processing of a raw 1-circuit or raw 2-circuit is complete .",
    "( that is , these sections form contiguous substrings of @xmath245 , where a substring is allowed to wrap around in a cyclic fashion . )",
    "suppose that @xmath213 is a raw 1-circuit or raw 2-circuit with substring @xmath322 .",
    "fix @xmath323 such that the corresponding arcs are @xmath324 and @xmath325 .",
    "these arcs are called _ successive arcs _ along @xmath213 .",
    "every raw 1-circuit or raw 2-circuit @xmath213 has the following property : successive arcs along @xmath213 are paired under @xmath88 at their common endvertex @xmath326 , except possibly when @xmath327 and the arcs are the first and last arcs of @xmath213 .",
    "we call this the _ well - paired _ property , which will be used in lemma  [ simplify ] below .",
    "raw 1-circuits are processed using the method described in section  [ s:1circuit ] .",
    "in most cases , raw 2-circuits must be further decomposed ( into a sequence of 1-circuits and/or switches ) before they can be processed , as described in section  [ 2circuit ] .",
    "it is here that extra difficulties arise here when working with directed graphs .",
    "recall the notation for switches introduced after figure  [ f : chain ] .",
    "let @xmath328 be a circuit in @xmath211 which is also a 4-cycle .",
    "set @xmath329 we now define notation for the switch which processes this 4-cycle , starting from the current digraph @xmath299 and producing the next digraph @xmath330 on the canonical path .",
    "let @xmath331 if @xmath332 and @xmath333 otherwise . then define @xmath334 =      \\begin{cases } [ \\alpha\\beta\\gamma\\delta ] & \\text { if $ i=0 $ , $ h=0$,}\\\\                    [ \\alpha\\delta\\gamma\\beta ] & \\text { if $ i=0 $ , $ h=1$,}\\\\                    [ \\beta\\alpha\\delta\\gamma ] & \\text { if $ i=1 $ , $ h=0$,}\\\\                    [ \\beta\\gamma\\delta\\alpha ] & \\text { if $ i=1 $ , $ h=1$. }   \\end{cases}\\ ] ] if @xmath331 then the switch @xmath335 $ ] deletes the arcs @xmath336 , @xmath337 and replaces them with @xmath338 , @xmath339 , while the opposite occurs if @xmath333 .    finally , we define the _ status _ of an arc @xmath176 in a digraph @xmath214 to equal 0 if @xmath340 and to equal 1 if @xmath341 .",
    "we say that two arcs have _ matching status _ if their status is equal in @xmath214 , and say that they have _ opposite status _ otherwise .",
    "let @xmath213 be a 1-circuit .",
    "( if @xmath213 is not raw then @xmath213 has resulted from the decomposition of a raw 2-circuit : see sections  [ s : normal ] and  [ s : eccentric ] . )",
    "the method for processing a 1-circuit is very similar to that used in  @xcite , and some of the discussion and figures given there may be helpful .",
    "( see also the worked example in section  [ a : example ] . )",
    "label the 1-circuit as @xmath342 where @xmath343 , such that @xmath344 is the minimum vertex on @xmath213 and @xmath345 .",
    "set @xmath346 also set @xmath347 then @xmath348 and @xmath349 for @xmath350 ( identifying @xmath351 with @xmath344 ) . note that any three consecutive vertices on @xmath213 are distinct .",
    "define the set @xmath352 ( this definition ensures that exactly one value @xmath47 is stored for each distinct vertex @xmath353 with @xmath354 , ensuring that vertices which are repeated along @xmath213 are treated correctly . ) note that @xmath355 always .",
    "the arcs @xmath356 are called _ odd chords_. the number of phases in the processing of @xmath213 will be @xmath357 .",
    "for the first phase , choose the minimum @xmath358 .",
    "there will be @xmath47 steps in the first phase , which proceeds as follows :    for @xmath359 do + xxx = form @xmath360 from @xmath361 by performing the switch @xmath362 $ ] ; +    if @xmath363 then there is only one phase and the processing of @xmath213 is complete .",
    "otherwise , @xmath364 but all odd chords @xmath365 with @xmath366 have been reinstated to match their status in @xmath299 ( that is , they belong to @xmath367 if and only if they belong to @xmath299 ) .    for subsequent phases ,",
    "if @xmath47 was the starting point of the previous phase then choose @xmath368 minimum such that @xmath369 .",
    "the odd chord @xmath356 has been switched in the previous phase but will be restored to its original state by the end of this phase .",
    "there will be @xmath370 steps in this phase , performing the sequence of switches @xmath371,\\,\\ ,       \\zeta^i\\chi^h[x_0 x_{2q-3 } x_{2q-2 } x_{2q-1}],\\,\\ , \\ldots    , \\,\\ , \\zeta^i\\chi^h[x_0 x_{2t+1 } x_{2t+2 } x_{2t+3}].\\ ] ] note that every switch involves @xmath344 , the start - vertex of @xmath213 .    at any point during the processing of the 1-circuit , at most three odd chords",
    "have been switched ( that is , temporarily disturbed ) .",
    "this is illustrated in the worked example in section  [ a : example ] .",
    "we now show how to process a raw 2-circuit @xmath213 , given the method for processing a 1-circuit described in section  [ s:1circuit ] .",
    "suppose that we have reached the digraph @xmath299 on the canonical path from @xmath11 to @xmath205 in @xmath60 .",
    "note that @xmath299 agrees with @xmath11 on the 2-circuit @xmath213 before the processing of @xmath213 begins .",
    "we relabel the vertices on @xmath213 as @xmath372 where @xmath373 is the lexicographically least arc in @xmath374 .",
    "treat the indices @xmath123 on the vertex labels as elements of @xmath375 , with addition performed modulo 2 . in the undirected case",
    "@xcite , the vertices @xmath376 are all distinct . however , this is no longer the case in the directed setting , which complicates the definition of the canonical paths .",
    "also note that there may be as few as two vertices between two successive occurrences of @xmath5 on the 2-circuit @xmath213 .",
    "this is explained in more detail below figure  [ 2circuit ] , once we have introduced some useful notation .",
    "recall that @xmath249 is the complementation operation for digraphs .",
    "set @xmath377 then @xmath378 figure  [ 2circuit - lite ] depicts @xmath379 , where the curved lines ( from @xmath380 to @xmath381 and from @xmath382 to @xmath383 ) represent any odd number of alternating arcs .",
    "solid arcs represent arcs which are present in @xmath384 and dashed arcs represent arcs which are absent in @xmath384 .",
    "that is , if @xmath331 then solid arcs belong to @xmath299 and dashed arcs belong to @xmath205 , while if @xmath333 then solid arcs belong to @xmath205 and dashed arcs belong to @xmath299 .    ]    for @xmath385 , let @xmath386 be the unique vertex such that @xmath387 or @xmath388 is a contiguous substring of @xmath213 ( allowing cyclic wrapping in the case of @xmath389 ) . if @xmath390 for some @xmath199 then @xmath391 and there is only one arc between @xmath392 and @xmath393 .",
    "this means that the corresponding curved line in figure  [ 2circuit - lite ] can be replaced by a single arc .",
    "there are four possibilities for @xmath379 in which @xmath394 for @xmath395 .",
    "these are shown in figure  [ bowtie - family ] .",
    "the leftmost 2-circuit involves 5 distinct vertices and the middle two 2-circuits each involve 4 distinct vertices , with one coincidence of the form @xmath396 , where @xmath397 .",
    "the rightmost 2-circuit involves 3 distinct vertices : we will call it a _ triangle_.",
    "[ c]@xmath383 [ c]@xmath382 [ c]@xmath398[c]@xmath399     with at most 5 distinct vertices .",
    "the rightmost 2-circuit is a triangle . ]    in the undirected analysis  @xcite , a critical observation was that vertex @xmath400 must be distinct from @xmath382 ( without loss of generality ) .",
    "this fact underpinned the definition of the canonical paths in  @xcite . for directed graphs",
    "this property does not necessarily hold , as can be seen from the last two 2-circuits in figure  [ bowtie - family ] .",
    "we will say that @xmath213 is _ normal _ if @xmath401 for some @xmath385 . in section",
    "[ s : normal ] we describe how to process a normal 2-circuit .",
    "the procedure is analogous to that used in  @xcite , which is the motivation for the definition of normal 2-circuits .",
    "note that the triangle ( shown at the rightmost of figure  [ bowtie - family ] ) is not normal but the remaining 2-circuits in figure  [ bowtie - family ] are normal .    for @xmath385 ,",
    "let @xmath402 be the unique vertex such that @xmath403 or @xmath404 is a contiguous substring of @xmath213 ( allowing cyclic wrapping in the case of @xmath405 ) .",
    "we will need the following lemma .",
    "suppose that @xmath213 is a raw 2-circuit which is not normal and such that @xmath406 for some @xmath385 .",
    "then @xmath213 is a triangle .",
    "[ simplify ]    without loss of generality ( by reversing arcs and/or taking the complement if necessary ) we may suppose that @xmath407 .",
    "( this means we can not assume that @xmath373 is the lexicographically least arc in @xmath213 , but we do not need to use that property in this proof . ) colour arcs around the 2-circuit orange , purple in an alternating fashion , starting with the orange arc @xmath373 . by assumption , @xmath213 has initial substring @xmath408 . by the well - paired property of 2-circuits , we know that the orange arc @xmath373 is paired with the purple arc @xmath409 at @xmath380 under @xmath88 , and the purple arc @xmath409 is paired with the orange arc @xmath410 at @xmath400 under @xmath88 .",
    "now @xmath5 is incident with exactly four arcs of @xmath213 , one of each colour and orientation ( see figure  [ 2circuit - lite ] . ) hence the presence of the orange arc @xmath410 on @xmath213 shows that @xmath411 .",
    "but then we obtain @xmath412 as @xmath213 is not normal .    now @xmath413 and",
    "the purple arc @xmath409 is paired with the orange arc @xmath414 .",
    "this implies that @xmath415 , and since @xmath213 is not normal it follows that @xmath416 this gives all pairing information around the 2-circuit except for pairings at @xmath5 .",
    "( for example , since @xmath417 and @xmath418 , we know that the purple arc @xmath414 is present on @xmath213 and is paired with the orange arc @xmath419 at @xmath400",
    ". this arc is paired at @xmath380 with the purple arc @xmath420 , since @xmath398 and @xmath421 . ) but as @xmath5 is only incident with four arcs of @xmath213 there can be no other vertices involved in @xmath213 .",
    "so by the well - paired property , at least one of the pairs of arcs @xmath422 and @xmath423 must be paired at @xmath5 .",
    "it follows that @xmath213 is a triangle on @xmath424 .",
    "call @xmath213 _ eccentric _ if it is not normal and not a triangle .",
    "if @xmath213 is eccentric then @xmath425 for all @xmath385 , by lemma  [ simplify ] .",
    "hence @xmath379 is as shown in figure  [ eccentric ] .",
    "( remember that arcs must alternate in both colour and orientation , giving a unique way to navigate around this figure , or see figure  [ eccentric - detail ] below for an unravelled version . ) again the curved lines represent an odd number of alternating arcs ( from @xmath380 to @xmath381 and from @xmath382 to @xmath383 ) .",
    "recall also that the vertices @xmath426 are not necessarily distinct .",
    "[ r]@xmath427[r]@xmath428     when @xmath213 is eccentric ]    we describe how to process an eccentric 2-circuit in section  [ s : eccentric ] and in section  [ s : triangle ] we explain how to process a triangle .",
    "this will complete the description of the canonical path from @xmath11 to @xmath205 corresponding to the pairing @xmath88 .",
    "let @xmath213 be a normal 2-circuit , with vertices labelled as in ( [ slabels ] ) , where @xmath373 is the lexicographically least arc in @xmath374 .",
    "recall the notation @xmath402 defined before lemma  [ simplify ] .",
    "a normal 2-circuit was depicted in figure  [ 2circuit - lite ] but now we need a more detailed picture ( figure  [ 2circuit ] ) .",
    "recall however that there can be as few as three arcs in the left or right half of this figure : for example , if there were only three arcs on the right then @xmath429 and @xmath430 for @xmath431 .",
    "again the curved lines in figure  [ 2circuit ] represent an odd number of alternating arcs .    , in more detail ]",
    "let @xmath123 be the lexicographically least index such that @xmath432 .",
    "( here we use the ordering @xmath433 on @xmath434 . )",
    "define the arc @xmath435 .",
    "shortcut arc _ of @xmath213 is @xmath436 ( that is , it equals @xmath437 itself if @xmath438 and equals the reversal of @xmath437 if @xmath439 ) .",
    "suppose that @xmath299 is the current digraph on the canonical path from @xmath11 to @xmath205 before we start decomposing @xmath213 .",
    "there are three cases , called ( na ) , ( nb ) , ( nc ) , where the ` n ' stands for ` normal ' .    1 .",
    "the shortcut arc @xmath436 belongs to @xmath374 .",
    "2 .   the shortcut arc @xmath436 does not belong to @xmath374 , and @xmath436 is not an arc of @xmath440 .",
    "the shortcut arc @xmath436 does not belong to @xmath374 , and @xmath436 is an arc of @xmath440 .",
    "we consider these cases in order .",
    "( a more detailed description of the analogous process in the undirected case , with figures , can be found in  @xcite and may also be helpful . )    1 .   in case ( na ) ,",
    "the 2-circuit @xmath213 can be split into two 1-circuits , @xmath441 and @xmath442 .",
    "there are four subcases to consider , depending on which `` half '' of the 2-circuit contains the shortcut arc and whether the shortcut arc belongs to @xmath299 . in all subcases , the arcs of @xmath441 and",
    "@xmath442 form a partition of the arcs of @xmath213 .",
    "+ once the two 1-circuits @xmath441 and @xmath442 have been identified , they are processed in that order , extending the canonical path from @xmath11 to @xmath205 as @xmath443 after processing @xmath441 , and @xmath444 after processing @xmath442 .",
    "suppose that @xmath213 can be rewritten ( allowing cyclic wrapping if necessary ) as @xmath445 and @xmath446 .",
    "split @xmath213 into two 1-circuits @xmath447 2 .",
    "suppose that @xmath213 can be rewritten ( allowing cyclic wrapping if necessary ) as @xmath448 and @xmath449 .",
    "split @xmath213 into two 1-circuits @xmath450 3 .",
    "suppose that @xmath213 can be rewritten ( allowing cyclic wrapping if necessary ) as @xmath451 and @xmath446 .",
    "split @xmath213 into two 1-circuits @xmath452 4 .",
    "suppose that @xmath213 can be rewritten ( allowing cyclic wrapping if necessary ) as @xmath453 and @xmath449 .",
    "split @xmath213 into two 1-circuits @xmath454 2 .   now suppose that @xmath213 is a normal 2-circuit , the shortcut arc @xmath436 is not an arc of @xmath213 and @xmath436 is not an arc of @xmath455 .",
    "then we can use the shortcut arc to give an alternating 4-cycle @xmath456 .",
    "first process this alternating 4-cycle using the switch @xmath457 $ ] , extending the canonical path by one step to give @xmath458 ( call this step the _ shortcut switch_. ) now @xmath436 is an arc of @xmath459 and we can form a 1-circuit @xmath441 from @xmath213 , specifically @xmath460 process this 1-circuit ( as described in section  [ s:1circuit ] ) to extend the canonical path further , giving @xmath461 note that @xmath436 is not an arc of @xmath462 after the 1-circuit @xmath441 has been processed , so it has been restored to the same state as in @xmath455 , before the processing of the 2-circuit @xmath213 began .",
    "finally assume that @xmath213 is a normal 2-circuit , the shortcut arc @xmath436 is not an arc of @xmath213 and @xmath436 is an arc of @xmath440 .",
    "then the shortcut arc completes the 1-circuit @xmath441 defined in ( [ normals1 ] ) , which is processed ( as described in section  [ s:1circuit ] ) .",
    "this extends the canonical path to give @xmath463 last we process the alternating 4-cycle @xmath464 , using the shortcut switch @xmath457 $ ] , extending the canonical path by one step to give @xmath465 note that @xmath436 is not an arc of @xmath462 but it is an arc of @xmath466 , so it has been restored to the same state as in @xmath455 .",
    "now we may assume that @xmath213 is an eccentric 2-circuit .",
    "then @xmath467 for all @xmath385 , by definition , and @xmath425 for all @xmath385 , by lemma  [ simplify ] .",
    "call @xmath468 the _ eccentric arc_. note that @xmath469 which is the set of in - neighbours of @xmath5 on @xmath213 .",
    "hence the eccentric arc is never an arc of @xmath213 , so that the analogue of case ( na ) never arises .",
    "the remaining possibilities are below , called case ( ea ) and ( eb ) ( these are similar to cases ( nb ) and ( nc ) for normal 2-circuits , respectively ) .    1 .",
    "suppose that @xmath470 .",
    "then @xmath471 forms an alternating 4-cycle which we process using the switch @xmath472 $ ] , extending the canonical path by one step to give @xmath473 we call this step the _",
    "eccentric switch_. after performing the eccentric switch we have the 2-circuit @xmath474 indeed , since @xmath475 it follows that @xmath476 is a normal 2-circuit , which we can process using the method described in section  [ s : normal ] .",
    "this extends the canonical path as @xmath477 note that @xmath478 , so the eccentric arc has been restored to the same state as in @xmath384 , before the processing of @xmath213 began . 2 .",
    "suppose that @xmath479 .",
    "then @xmath476 defined in ( [ seccentric ] ) is a normal 2-circuit which we first process using the method described in section  [ s : normal ] .",
    "this extends the canonical path as @xmath480 then @xmath471 forms an alternating 4-cycle which we process using the eccentric switch @xmath472 $ ] , extending the canonical path by one step to give @xmath481 now @xmath482 , so the eccentric arc has been restored to the same state as in @xmath384 .",
    "this procedure for still works even for eccentric 2-circuits with only five vertices .",
    "these arise when @xmath483 for all @xmath385 ( matching figure  [ eccentric ] with both curved lines replaced by one arc each . )",
    "the following information will be needed when analysing the flow .",
    "[ eccentric - plus - shortcut ] let @xmath213 be an eccentric @xmath484-circuit with the labelling of ( [ slabels ] ) and let @xmath476 be the normal @xmath484-circuit used to process @xmath213 .",
    "suppose that @xmath476 falls into case ( nb ) or ( nc ) .",
    "then the following all hold :    1 .",
    "neither of the arcs @xmath485 , @xmath486 are involved in the eccentric switch .",
    "2 .   using the labelling from figure  [ eccentric ] , the shortcut arc used to process @xmath476 is @xmath487 and the shortcut switch is @xmath488 $ ] .",
    "the eccentric arc is involved in the shortcut switch and does not lie on the 1-circuit used to process @xmath476 .",
    "recall that the eccentric arc is @xmath489 .",
    "the first statement is immediate as the eccentric switch processes the alternating 4-cycle @xmath471 .    for the remainder of the proof",
    ", we use labels @xmath490 to denote the labelling of @xmath476 obtained as in ( [ slabels ] ) .",
    "see figure  [ eccentric - detail ] .",
    "as @xmath213 is eccentric we have @xmath491 for all @xmath385 . by choice of the eccentric switch",
    "we have @xmath492 and @xmath493 for @xmath494 , while @xmath495 .",
    "[ c]@xmath5     ( above ) and the normal 2-circuit @xmath496 used to process it ( below ) ]    now @xmath475 since @xmath497 is a contiguous substring of @xmath213 .",
    "hence @xmath498 is the lexicographically least @xmath123 such that @xmath499 .",
    "it follows that the shortcut arc is @xmath500 .",
    "notice that the eccentric arc is incident with the shortcut arc at @xmath501 ( with the same orientation ) .",
    "furthermore , the shortcut switch involves a switch to the alternating 4-cycle @xmath502 which includes the eccentric arc .",
    "specifically , the switch is @xmath488 $ ] , proving ( ii ) .",
    "since the eccentric arc @xmath489 is one of the arcs involved in the shortcut switch , it does not lie on the 1-circuit used to process @xmath476 . this establishes ( iii ) , completing the proof .",
    "now suppose that @xmath213 is a triangle , with vertices labelled @xmath503 where @xmath157 is the least vertex on @xmath213 and @xmath504 is an arc in the current digraph @xmath299 .",
    "define the sets @xmath505 for @xmath138 .",
    "there are two cases , depending on whether a useful neighbour of @xmath213 exists .    1 .",
    "first suppose that there exists a useful neighbour of @xmath213 .",
    "let @xmath69 be the minimum useful neighbour of @xmath213 , and set @xmath506 according to the first condition in this list which is satisfied by @xmath69 : @xmath507 then the sequence of three switches given by lamar  ( * ? ? ?",
    "* left half of figure 2 ) can be used to process @xmath213 . for completeness",
    "we describe these switches here .",
    "relabel the vertices of the triangle with @xmath508 , @xmath326 , @xmath509 so that * @xmath510 , * @xmath511 , @xmath512 , * @xmath513 .",
    "+ ( once @xmath514 are chosen using the above procedure , the labelling of the triangle is uniquely determined . )",
    "then the sequence of switches @xmath515,\\qquad \\zeta^i \\chi^h [ bxca],\\qquad",
    "\\zeta^i \\chi^h [ abcx]\\ ] ] processes the triangle and restores all arcs between @xmath69 and the triangle to their original state",
    ". see figure  [ useful - nb ] for the case @xmath516 : the diagram for the other cases can be obtained by reversing all arcs if @xmath439 , and/or by exchanging solid lines and dashed lines if @xmath333 .",
    "call arcs @xmath517 , @xmath518 , @xmath519 the _ auxilliary arcs_. +    + use this sequence of switches to process the triangle , extending the canonical path as @xmath520 2 .",
    "suppose that there is no useful neighbour of @xmath213 in @xmath299 .",
    "then using lemma  [ useful ] , there must exist a useful arc for @xmath213 .",
    "let @xmath176 be the lexicographically least such arc . recall that @xmath176 satisfies one of the properties ( u1 ) , ( u2 ) given just before lemma  [ useful ] .",
    "define @xmath521 then @xmath522 with @xmath523 and @xmath524 .",
    "relabel the vertices of the triangle as @xmath508 , @xmath326 , @xmath509 , where @xmath525 and @xmath526 .",
    "( once @xmath527 is defined , this labelling is completely determined . )",
    "the sequence of switches given by lamar  ( * ? ? ?",
    "* right side of figure 2 ) will be used to process @xmath213 . for completeness",
    "we give this sequence of switches in our notation : @xmath528 , \\quad   \\chi^h [ a y b c ] , \\quad     \\chi^h [ b y c a],\\quad \\chi^h [ x b c y].\\ ] ] these switches are also displayed in figure  [ useful - arc ] in the case that @xmath331 : the diagram for @xmath333 can be obtained by exchanging solid lines and dashed lines .",
    "the arcs @xmath176 , @xmath529 , @xmath530 , @xmath531 , @xmath532 are called _",
    "auxilliary arcs_. use this sequence of switches to process the triangle , extending the canonical path as @xmath533 +",
    "we now analyse the multicommodity flow so that we can apply lemma  [ second - eigval ] to give a bound on the second - largest eigenvalue of the switch chain . in this section",
    "we assume that @xmath534 for all @xmath22 .",
    "this implies the general result for any @xmath535 , by complementation where necessary .",
    "fix a pairing @xmath203 and let @xmath204 be the canonical path from @xmath11 to @xmath205 with respect to @xmath88 .",
    "let @xmath212 be any transition on @xmath204 , and let @xmath213 be the raw 1-circuit or raw 2-circuit which is currently being processed .",
    "( that is , the transition @xmath212 is performed while processing @xmath213 . )",
    "let @xmath299 be the digraph on the canonical path from @xmath11 to @xmath205 just before the processing of @xmath213 began .",
    "any arc which does not belong to @xmath213 but which has distinct status in @xmath214 and @xmath299 is called an _ interesting arc _ for @xmath214 with respect to @xmath215 .",
    "( that is , the arc does not belong to @xmath213 but is present in @xmath214 but absent in @xmath299 , or vice - versa . ) the only arcs that can be interesting are :    * odd chords which are switched while processing a 1-circuit , * the shortcut arc and/or eccentric arc , switched while processing a normal or eccentric 2-circuit , * auxilliary arcs which are switched while processing a triangle .",
    "we will label an interesting arc by @xmath536 ( respectively , 2 ) if it is absent ( respectively , present ) in @xmath299 but present ( respectively , absent ) in @xmath214 .",
    "( the reason for this choice of labels will be made clear shortly . )",
    "interesting arcs play a key role in our analysis .",
    "the following lemma describes the possible subdigraphs of @xmath214 that can be formed by interesting arcs in @xmath214 .",
    "it proves that the labelled digraph consisting of the interesting arcs is a subdigraph of one of the eight labelled digraphs shown in figure  [ f : zoo ] , up to symmetries . here",
    "@xmath537 and @xmath538 independently , giving four symmetries obtained by exchanging these pairs .",
    "furthermore , @xmath248 may also be applied to reverse the orientation of all arcs .",
    "hence each digraph shown in figure  [ f : zoo ] represents up to eight possible digraphs .",
    "note , the label for a given arc is shown next to the head of that arc .",
    "let @xmath214 be a digraph which lies on the canonical path from @xmath11 to @xmath205 with respect to the pairing @xmath203 .",
    "there are at most five interesting arcs in @xmath214 with respect to @xmath215 .",
    "the digraph consisting of the interesting arcs in @xmath214 is a subdigraph of one of the digraphs in figure  [ f : zoo ] .",
    "if there are five interesting arcs then the following statements all hold :    1 .",
    "there exists a vertex @xmath6 which is the head ( respectively , tail ) of three interesting arcs , and these three interesting arcs do not all have the same label .",
    "there is a fourth interesting arc which has @xmath6 as tail ( respectively , head ) .",
    "let @xmath539 be the head ( respectively , tail ) of the fourth interesting arc .",
    "the fifth interesting arc is not incident with @xmath6 but has @xmath539 as its head ( respectively , tail ) .",
    "[ zoo ]    while processing a triangle , at most three interesting arcs are used , namely the two or three auxilliary arcs .",
    "it follows from figures  [ useful - nb ] ,  [ useful - arc ] that the auxilliary arcs always form subdigraphs of a configuration from figure  [ zoo ] .    when processing a normal 2-circuit , the situation is very similar to that in  @xcite , with at most four interesting arcs . up to three interesting arcs arise from the processing of a 1-circuit .",
    "they are all odd chords , and hence are all incident with the start - vertex of the 1-circuit with consistent orientation .",
    "however , they do not all have the same label .",
    "the fourth interesting arc corresponds to the shortcut arc , which may be labelled @xmath536 or 2 and may be incident with none , one or two of the other interesting arcs ( but not incident with the start vertex of the 1-circuit ) .",
    "the fifth possible interesting arc is the eccentric arc , in the case that we are processing an eccentric 2-circuit @xmath213 .",
    "let @xmath476 be the normal 2-circuit containing the eccentric arc which is used to process @xmath213 .",
    "if @xmath476 falls into case ( na ) then the eccentric arc may be a interesting arc for part ( either the start or end ) of the processing of @xmath441 , the 1-circuit which contains it .",
    "but the configuration of interesting arcs in this case looks just the same as those which may arise from the processing of a normal 1-circuit , since the eccentric arc is involved in either the first switch of the last phase or the last switch of the first phase , and hence plays the same role as an interesting arc left over from a previous phase .",
    "however , if @xmath476 falls into case ( nb ) or ( nc ) then by lemma  [ eccentric - plus - shortcut ] ( iii ) , the eccentric arc does not lie on the 1-circuit @xmath441 which arises from @xmath476 .",
    "but the eccentric arc be an interesting arc throughout the processing of @xmath441 . hence @xmath441 may have up to five interesting arcs , including the shortcut arc and the eccentric arc . in this case",
    "the eccentric arc is incident with the start - vertex @xmath5 of @xmath441 ( which equals the start - vertex of @xmath213 ) and it has the _ opposite _ orientation to the other interesting arcs incident with @xmath5 , if any . let @xmath539 be the endvertex of the eccentric arc which is not @xmath5 . if the shortcut arc is present then it must be incident with the eccentric arc at @xmath539 , with consistent orientation .",
    "this completes the proof .",
    "now identify a digraph with its @xmath218 adjacency matrix ( which has zero diagonal ) , and define the @xmath218 matrix @xmath216 by @xmath540 .",
    "entries of @xmath216 belong to @xmath541 .",
    "we may also think of @xmath216 as the complete digraph on @xmath14 $ ] with each arc labelled by the corresponding entry of @xmath216 .",
    "an arc in @xmath216 is called _ bad _ if its label is @xmath536 or 2 .",
    "note that @xmath216 is independent of @xmath88 .",
    "call @xmath216 an _ encoding _ for @xmath214 with respect to ( @xmath542 . note that an arc receives label @xmath536 if it is absent in both @xmath11 and @xmath205 but is present in @xmath214 , while an arc receives label 2 if it is present in both @xmath11 and @xmath205 but is absent in @xmath214 .",
    "thus arcs in the symmetric difference @xmath256 are never bad arcs .",
    "furthermore , every bad arc is an interesting arc , and an interesting arc is bad if and only if it does not belong to the symmetric difference @xmath256 .",
    "this observation will be used many times in our analysis . in particular , it means that the digraph of bad arcs in an encoding @xmath216 for @xmath214 is a subdigraph of one of the digraphs in figure  [ f : zoo ] .",
    "this also explains our choice of labels for interesting arcs , since a bad arc with label 2 ( respectively , @xmath536 ) is also an interesting arc with label 2 ( respectively , @xmath536 ) .    in the undirected setting  (",
    "* lemma 1 ) it is always possible to uniquely recover @xmath220 if @xmath212 , @xmath216 and @xmath88 are known .",
    "we prove a slightly weaker result in the directed setting .",
    "given @xmath212 , @xmath216 , @xmath88 , there are at most four possibilities for @xmath220 such that @xmath212 is a transition along the canonical path from @xmath11 to @xmath205 corresponding to @xmath88 and @xmath216 is an encoding for @xmath214 with respect to @xmath220 .",
    "[ notquiteunique ]    the matrix @xmath543 equals @xmath544 . from this matrix",
    "we can identify all arcs which are present in both @xmath11 and @xmath205 ( entries with value 2 in @xmath543 ) and all arcs which are absent in both @xmath11 and @xmath205 ( entries with value 0 in @xmath543 ) .",
    "we can also identify the symmetric difference @xmath251 , corresponding to entries with value 1 in @xmath543 .",
    "it remains to assign colours blue and red to the arcs of @xmath211 so that blue arcs come from @xmath11 and red arcs come from @xmath205 .",
    "from the uncoloured version of @xmath211 together with @xmath88 we can construct the circuit decomposition @xmath284 .",
    "let @xmath545 be the sequence of raw 1-circuits and raw 2-circuits obtained by decomposing the circuits in @xmath284 in order , as described in section  [ s : circuit ] .",
    "the elements of @xmath545 are pairwise arc - disjoint and their union is @xmath211 .",
    "suppose that the transition @xmath212 deletes the arcs @xmath546 , @xmath547 and replaces them with @xmath548 , @xmath549 .",
    "call @xmath550 the _ switch arcs_. we classify transitions along the canonical paths into three types as follows :    1 .   * type 1 : * the transition is any step in the processing of a 1-circuit used to process @xmath551 .",
    "at least one of the switch arcs belong to @xmath213 .",
    "( this includes the case of a raw 1-circuit , in which case the 1-circuit equals @xmath213 . )",
    "type 2 : * the transition is a shortcut switch or an eccentric switch used while processing the normal or eccentric 2-circuit @xmath552 .",
    "at least two of the switch arcs belong to @xmath213 .",
    "* type 3 : * the transition is a step in the processing of a triangle @xmath551 .",
    "at least one of the four switch arcs belong to @xmath213 .    in all cases",
    ", at least one of the switch arcs belongs to the element @xmath551 currently being processed . therefore , there are at most four possiblities for @xmath213 , namely , at most one possibility for each switch arc .",
    "( this follows as elements of @xmath545 are pairwise arc - disjoint . )",
    "now fix one of the ( at most four ) possibilities for @xmath213 .",
    "we will show that given this choice ( or guess ) for @xmath213 , we can uniquely determine @xmath220 by colouring the edges of @xmath211 .",
    "note that if @xmath213 is a 2-circuit , its labelling ( as in figure  [ 2circuit ] ) can be determined uniquely .",
    "hence we can determine whether @xmath213 is normal , eccentric or a triangle .",
    "furthermore , in the first two cases we can identify exactly which arcs will be used as odd chords , shortcut arcs or eccentric arcs during the processing of @xmath213 .",
    "we now claim that if @xmath213 is a triangle then we can uniquely determine the useful neighbour @xmath69 or the useful arc @xmath176 which is used to process @xmath213 , and hence identify all auxilliary arcs used while processing @xmath213 . to see this , note that when processing a triangle , each switch involves either two or three vertices of the triangle .",
    "if all three vertices of the triangle are involved in the switch then the other vertex is either a useful neighbour , or an endvertex of a useful arc .",
    "fix one orientation around the triangle and call it `` clockwise '' , with the opposite orientation called `` anticlockwise '' . consider the number of clockwise and anticlockwise arcs on the triangle in @xmath214 and @xmath553 : if they are equal in @xmath214 or in @xmath553 then we are using a useful arc and otherwise we are using a useful neighbour .",
    "( see figures  [ useful - nb ] ,  [ useful - arc ] . ) in the latter situation it is easy to identify the useful neighbour @xmath69 : it is the only vertex involved in the switch which does not belong to @xmath213 .",
    "this determines the auxilliary arcs ( their orientation matches the orientation of the switch arcs at @xmath69 ) .",
    "now suppose that we are using an useful arc @xmath176",
    ". then we are in case ( t2 ) , which means that no useful neighbour of @xmath213 existed at the start of processing @xmath213 .",
    "then @xmath98 is the only vertex incident with the switch arcs which does not belong to @xmath213 , and @xmath69 and @xmath98 are the unique vertices in @xmath214 which are useful neighbours of @xmath213 .",
    "that is , @xmath69 and @xmath98 are the only vertices not in @xmath213 which do not belong to the set @xmath554 .",
    "if only two vertices of the triangle are involved in the switch then the unique switch arc which is not incident with either of these vertices is the useful arc , and the switch is the first or last in processing @xmath213 .",
    "this shows that all auxilliary arcs for @xmath213 can be identified , as claimed .",
    "suppose that @xmath213 comes from the decomposition of the circuit @xmath555 .",
    "the digraph induced by all interesting arcs contains no circuits , as can be seen from figure  [ f : zoo ] .",
    "hence for any @xmath556 we can find at least one arc on @xmath557 which is not an interesting arc for @xmath213 : call this a _",
    "helpful arc _ for @xmath557 .",
    "colour the helpful arc for @xmath557 blue if it does not belong to @xmath214 and @xmath558 , or if it does belong to @xmath214 and @xmath559 ; otherwise colour it red .",
    "then the colouring of the rest of @xmath557 is forced , since colours alternate around the circuit . in the same way we can assign colours to the arcs of every raw 1-circuit and raw 2-circuit obtained in the decomposition of @xmath560 , other than the element @xmath551 ( which we have assumed is ) being switched in the current transition @xmath212 .",
    "it remains to explain how to assign colours to the arcs of @xmath213 .",
    "if @xmath213 is a triangle then @xmath212 is a type 3 transition . by observing the number of clockwise and anticlockwise arcs in @xmath214 and @xmath553",
    ", we can determine the orientation of the triangle in @xmath11 and in @xmath205 and hence assign colours to the arcs in @xmath213 .",
    "hence for the remainder of the proof we can assume that @xmath213 is either a 1-circuit or a normal or eccentric 2-circuit",
    ". therefore the vertices @xmath561 all belong to @xmath213 and without loss of generality @xmath562 is the start - vertex of @xmath213 ( since the start - vertex is involved in every switch ) .",
    "the argument for 1-circuits and normal 2-circuits is very similar to that given in  @xcite .",
    "first suppose that @xmath212 is a type 1 transition , performed while processing the 1-circuit @xmath476 .",
    "now @xmath476 may be a raw 1-circuit ( in which case @xmath563 ) , or @xmath476 may have arisen while processing a raw ( normal or eccentric ) 2-circuit @xmath213 .",
    "hence @xmath476 may contain a shortcut arc ( but note , no 1-circuit contains an eccentric arc , by lemma  [ eccentric - plus - shortcut ] ) .",
    "the arcs of @xmath476 can be partitioned into sections , separated from each other by two consecutive arcs that are either both in @xmath214 or both absent from @xmath214 .",
    "each section contains at least two arcs , so at least one arc which is not the shortcut arc",
    ". then at least one arc of @xmath476 is actually switched in the current transition , which allows us to label the section containing that arc as switched , and alternately label the remaining sections around @xmath476 as switched or unswitched .",
    "then colour an arc of @xmath476 blue if it belongs to @xmath214 and is unswitched or it is absent from @xmath214 and is switched , and colour an arc of @xmath476 red if it belongs to @xmath214 and is switched or it is absent from @xmath214 and is unswitched .",
    "finally , if @xmath476 is not raw but arose from a 2-circuit @xmath213 , there is a unique way to colour the remaining arcs of @xmath213 , keeping the colours alternating .    for the remainder of the proof",
    "we assume that @xmath212 is type 2 transition for @xmath213 ; that is , a shortcut switch or an eccentric switch .",
    "let @xmath299 denote the digraph on the canonical path from @xmath11 to @xmath205 just before we start decomposing @xmath213 .",
    "we consider three subcases .",
    "firstly , suppose that @xmath212 is an eccentric switch .",
    "then we know that the arcs @xmath485 and @xmath564 have the same status in @xmath299 .",
    "the former is not involved in the eccentric switch , by lemma  [ eccentric - plus - shortcut ] ( i ) , while the latter is involved in the eccentric switch .",
    "hence if these two arcs have matching status in @xmath214 then we are in case ( ea ) and the current transition is the first in processing @xmath213 .",
    "colour the arcs of @xmath213 according to @xmath214 : arcs of @xmath565 should be coloured blue and the remaining arcs of @xmath213 should be coloured red . if these arcs have opposite status in @xmath214 then we are in case ( eb ) and the current transition is the last in processing @xmath213 .",
    "colour the arcs of @xmath213 according to @xmath553 : arcs of @xmath566 should be coloured red and the remaining arcs of @xmath213 should be coloured blue .",
    "we proceed similarly if @xmath212 is a type 2 transition for @xmath213 which is a shortcut switch . for now , assume that @xmath213 is a normal 2-circuit , so the shortcut switch does not involve the eccentric arc ( if any ) .",
    "if the shortcut arc is @xmath567 then the arcs @xmath568 and @xmath569 have matching status in @xmath299 .",
    "the former arc is not involved in the shortcut switch but the latter arc is .",
    "hence if these two arcs still have matching status in @xmath214 then we are in case ( nb ) and the current transition is the first in processing @xmath213 .",
    "colour the arcs of @xmath213 according to @xmath214 , as described in the previous paragraph . if these two arcs have opposite status in @xmath214 ( one absent and one present )",
    "then we have already processed the 1-circuit using the shortcut arc , so we are in case ( nc ) and the current transition is the last in processing @xmath213 .",
    "colour the arcs of @xmath213 according to @xmath553 , as described in the previous paragraph .",
    "the third subcase is that @xmath212 is a shortcut switch which also involves an eccentric arc .",
    "then @xmath213 is an eccentric 2-circuit which has been decomposed into an eccentric switch and a normal 2-circuit @xmath476 , where @xmath476 contains the eccentric arc .",
    "the current transition is the shortcut switch which has arisen while processing @xmath476 .",
    "now the arcs @xmath570 and @xmath486 have matching status in @xmath299 . from lemma  [ eccentric - plus - shortcut ] ( i ) we know that neither of these arcs are involved in the eccentric switch .",
    "the former arc is not involved in the shortcut switch but the latter arc is , by lemma  [ eccentric - plus - shortcut ] ( ii ) .",
    "hence , these two arcs also have matching status at the start of processing @xmath476 , and we can colour the arcs of @xmath213 according to @xmath214 if these arcs have matching status in @xmath214 , and colour the arcs of @xmath213 according to @xmath553 otherwise .",
    "this completes the proof .",
    "let @xmath571 denote the label of arc @xmath546 in the encoding @xmath216 .",
    "the arc - reversal operator @xmath248 acts on an encoding @xmath216 by mapping @xmath216 to its transpose @xmath572 .",
    "if @xmath573 and @xmath574 for some @xmath575 then @xmath576 is called a _ handy tuple _ with _ centre _ @xmath577 . if @xmath576 is handy and at most one of @xmath578 , @xmath579 is the head , when @xmath438 ( respectively , the tail , when @xmath439 ) of two bad arcs with distinct labels then @xmath576 is said to be _ very handy_. we now collect together some structural information about bad arcs in encodings .    [ structure ] given @xmath580 with symmetric difference @xmath208 ,",
    "suppose that @xmath214 is a digraph on the canonical path from @xmath11 to @xmath205 with respect to some pairing @xmath88 .",
    "let @xmath216 be the corresponding encoding , defined by @xmath540 .",
    "then the following statements all hold .    1 .   viewed as the arcs of a labelled digraph , the set of bad arcs in @xmath216 forms a subdigraph of one of the digraphs given in figure  [ f : zoo ] .",
    "if @xmath216 contains a handy tuple then @xmath216 contains a very handy tuple .",
    "if there are five bad arcs in @xmath216 then there exists a very handy tuple @xmath581 , and a handy tuple @xmath582 in @xmath216 such that @xmath583 and @xmath584 4 .",
    "if there are four bad arcs in @xmath216 then there is at least one handy tuple in @xmath216 .",
    "if @xmath135 then no arc in @xmath211 is incident with a bad arc with label @xmath484 . if @xmath216 has a bad arc with label @xmath484 which is not the only bad arc in @xmath216 then @xmath216 has a handy tuple and @xmath216 has at most three bad arcs , exactly one of which has label @xmath484 .",
    "furthermore , if @xmath216 has three bad arcs , exactly one of which has label @xmath484 then each endvertex of the bad arc with label @xmath484 is the centre of a handy tuple in @xmath216 . 6 .",
    "if @xmath585 then every vertex which has nonzero degree in @xmath211 is the head of at most one bad arc with label @xmath484 and is the tail of at most one bad arc with label @xmath484 .    every bad arc is interesting , so ( i ) follows immediately from lemma  [ zoo ] .",
    "statements ( ii)(iv ) follow from ( i ) , by inspection of figure  [ f : zoo ] . now",
    "the head ( respectively , tail ) of a bad arc is also the head ( respectively , tail ) of an arc in @xmath209 and an arc in @xmath210 , unless the bad arc is the useful arc used to process a triangle in case ( t2 ) .",
    "this follows from the definition of odd chords , shortcut arc , eccentric arc and auxilliary arcs in sections  [ s:1circuit ] ,  [ s : normal]  [ s : triangle ] .",
    "hence ( vi ) and the first statement of ( v ) holds , since a bad arc with label 2 is present in both @xmath11 and @xmath205 .",
    "furthermore , inspection of figure  [ useful - arc ] shows that the remaining statements of ( v ) hold , completing the proof .    the notion of an encoding is now generalised to mean any @xmath218 matrix @xmath216 with entries in @xmath586 such that every row and column sum equals @xmath0 .",
    "given @xmath221 , an encoding @xmath216 is called _",
    "@xmath214-valid _ if every entry of @xmath222 belongs to @xmath223 and @xmath587 satisfy statements ( i)(vi ) of lemma  [ structure ] , where @xmath211 is the digraph defined by the entries of @xmath222 which equal 1 .",
    "we also define the set @xmath588 of all bad arcs in @xmath216 by @xmath589 ^ 2 \\mid l(i , j)\\in \\ { -1,2\\}\\}.\\ ] ]",
    "let @xmath590 and let @xmath216 be a @xmath214-valid encoding .",
    "suppose that @xmath591 is another encoding such that @xmath592 .",
    "then @xmath591 is also @xmath214-valid .",
    "[ zvalid ]    if @xmath593 then @xmath594 and hence @xmath595 , as @xmath216 is @xmath214-valid .",
    "similarly , if @xmath596 then @xmath597 and hence @xmath598 .",
    "this shows that every entry of @xmath599 belongs to @xmath223 .",
    "checking properties ( i)(vi ) of lemma  [ structure ] we see that they all hold for @xmath600 , completing the proof .",
    "switches can be applied to encodings , as follows . by definition ,",
    "the sum of all labels on arcs with head @xmath5 add up to @xmath0 , and the sum of all labels on arcs with tail @xmath5 add up to @xmath0 , for all vertices @xmath5 .",
    "if @xmath601 are vertices with @xmath602 , @xmath603 , @xmath604 and @xmath605 then we may perform the switch @xmath606 $ ] by decreasing @xmath607 and @xmath608 by one and increasing @xmath609 and @xmath610 by one , giving a new encoding @xmath591 .",
    "let @xmath590 .",
    "given a @xmath214-valid encoding , one can obtain a digraph ( with no bad arcs ) using at most three switches .",
    "[ fix ]    let @xmath216 be a @xmath214-valid encoding and let @xmath211 be the digraph given by the entries of @xmath222 which equal 1 .",
    "first suppose that @xmath216 contains a handy tuple .",
    "then @xmath216 contains a very handy tuple , by lemma  [ structure ] ( ii ) .",
    "if @xmath216 contains a very handy tuple @xmath581 and a handy tuple @xmath611 such that @xmath583 and ( [ independent ] ) holds , then we choose @xmath576 to be the very handy tuple @xmath581 .",
    "otherwise , let @xmath576 be any very handy tuple in @xmath216 .    if @xmath438 ( respectively , @xmath439 ) then the sum of the labels on the bad arcs with @xmath578 as head ( respectively , tail ) is strictly greater than the sum of the labels on the bad arcs with @xmath579 as head ( respectively , tail ) . by construction",
    ", each row of @xmath216 adds up to @xmath0 and each column of @xmath216 adds up to @xmath0 .",
    "hence @xmath579 is the head ( respectively , tail ) of strictly more good arcs ( with label 1 ) than @xmath578 .",
    "it follows that there exists a vertex @xmath612 such that @xmath613 and @xmath614 .",
    "now we can perform the switch @xmath615 $ ] to give an encoding @xmath591 with @xmath616 and @xmath617 .",
    "note that @xmath591 is a @xmath214-valid encoding by lemma  [ zvalid ] , and that @xmath618 .",
    "we call this operation a @xmath619-_switch_.    next suppose that no vertex is the head ( respectively , tail ) of two bad arcs with distinct labels , but that an arc exists in @xmath216 with label 2 . by lemma  [ structure ] ( iii ) , ( iv ) , there are at most three bad arcs in @xmath216 .",
    "choose vertices @xmath620 such that for some @xmath621 we have @xmath573 and if @xmath438 ( respectively , @xmath439 ) then @xmath577 is the tail ( respectively , head ) of exactly one bad arc .",
    "( that such an @xmath577 exists follows from lemma  [ structure ] ( i ) . ) let @xmath136 be the set of vertices @xmath622 with @xmath623 . since @xmath577 is the tail ( respectively , head ) of exactly @xmath624 arcs",
    "labelled 1 and one arc labelled 2 , it follows that @xmath625 .",
    "we claim that there exists a vertex @xmath626 which is not the head ( respectively , tail ) of a bad arc with label 2 .",
    "if @xmath627 then there are at most 3 vertices which are at the head ( respectively , tail ) of a bad arc labelled 2 , and one of these is @xmath578 . since @xmath628 and @xmath629 , we can choose a vertex @xmath626 which is not the head of a bad arc with label 2 , as claimed . if @xmath585 then by lemma  [ structure ] ( vi ) , each vertex in @xmath211 is head ( respectively , tail ) of at most one bad arc labelled 2 .",
    "hence there are at most 2 bad arcs labelled 2 in @xmath216 , by lemma  [ structure ] ( i ) .",
    "therefore at most one vertex other than @xmath578 is the head ( respectively , tail ) of a bad arc labelled 2 in @xmath216 .",
    "the claim then follows since @xmath628 and @xmath630 . if @xmath135 then by lemma  [ structure ] ( v ) there is exactly one bad arc in @xmath216 , namely @xmath631 .",
    "hence we can let @xmath579 be any element of @xmath136 since @xmath628 , and the claim follows as @xmath632 in this case .",
    "now @xmath578 is the head ( respectively , tail ) of at most @xmath624 good arcs and @xmath579 is the head ( respectively , tail ) of at least @xmath0 good arcs .",
    "hence we can choose a vertex @xmath612 such that @xmath633 and @xmath634 .",
    "perform the switch @xmath635 $ ] to produce an encoding @xmath591 with @xmath636 and @xmath637",
    ". then @xmath591 is @xmath214-valid by lemma  [ zvalid ] , and @xmath638 .",
    "call this operation a 2-_switch_.    finally , suppose that the only remaining bad arcs are labelled @xmath536 .",
    "let @xmath577 and @xmath579 be vertices such that @xmath574 for some @xmath575 , choosing @xmath577 to be a vertex at the tail , when @xmath438 ( respectively head , when @xmath439 ) of two bad arcs with label @xmath536 , if such a vertex exists .",
    "note that when @xmath216 contains three bad arcs with label @xmath536 then such a choice of @xmath577 exists , by lemma  [ structure ] ( i ) .",
    "we claim that there exists a vertex @xmath578 such that @xmath639 but @xmath578 is not the head , when @xmath438 ( respectively tail , when @xmath439 ) of any bad arc . to see this , note that there are at least @xmath640 choices for @xmath578 , and there is at most one vertex which is at the head ( respectively , tail ) of a bad arc which is not incident with @xmath577 , by choice of @xmath577 .",
    "hence we can avoid this vertex when choosing @xmath578 , proving the claim .",
    "then @xmath578 is the head ( respectively , tail ) of exactly @xmath0 good arcs , while @xmath579 is the head ( respectively , tail ) of at least @xmath641 good arcs .",
    "hence there is at least one way to choose a vertex @xmath612 such that @xmath633 and @xmath634 .",
    "perform the switch @xmath615 $ ] to produce an encoding @xmath591 , with @xmath642 , @xmath643 .",
    "again lemma  [ zvalid ] shows that @xmath591 is @xmath214-valid , and @xmath638 .",
    "call this operation a @xmath644-_switch_.    if the original encoding @xmath216 has five bad arcs then by lemma  [ structure ] ( iii ) , we can find a very handy tuple @xmath581 in @xmath216 and perform the @xmath619-switch @xmath645 $ ] , where @xmath646 is a vertex found using the procedure above .",
    "it follows from ( [ independent ] ) and figure  [ structure ] ( i ) that @xmath611 is a very handy tuple in the resulting @xmath214-valid encoding @xmath591 .",
    "hence we may perform the @xmath619-switch @xmath647 $ ] to transform @xmath591 into the @xmath214-valid encoding @xmath648 with at most one bad arc . at most one further switch",
    "is required to transform @xmath648 into an encoding with no bad arcs .",
    "thus at most 3 switches are needed to process @xmath216 when @xmath216 has five bad arcs .    similarly ,",
    "if @xmath216 has four bad arcs then by lemma  [ structure ] ( iv ) , we can transform @xmath216 into a @xmath214-valid encoding @xmath591 with at most two bad arcs , using a @xmath619-switch . at most two further switches",
    "are needed to produce an encoding with no bad arcs . thus at most 3 switches",
    "are needed to process @xmath216 when @xmath216 has four bad arcs . clearly , if @xmath216 has at most 3 bad arcs then at most 3 switches are required .",
    "this completes the proof .    for @xmath590 let @xmath649 be the set of all @xmath214-valid encodings .",
    "we obtain the following upper bound on @xmath650 using a relatively simple proof .",
    "it is possible that an improved bound can be found using a more careful analysis , probably saving a factor of @xmath22 .    for any @xmath590 we have @xmath651 [ poly ]    fix @xmath590 and let @xmath652 be a @xmath214-valid encoding . by lemma  [ fix ]",
    "there exists a sequence @xmath653 where @xmath654 is a digraph with no bad arcs , @xmath655 and each of @xmath656 is @xmath214-valid .",
    "we can turn this into a function @xmath657 by performing these switches in a canonical way : as in lemma  [ fix ] perform all @xmath619-switches first , then all 2-switches , then all @xmath644-switches , following the extra conditions described in lemma  [ fix ] and breaking ties using lexicographic ordering on the 5-tuple @xmath658 .",
    "it suffices to prove that @xmath659 for all @xmath660 .",
    "now fix @xmath660 .",
    "reverse @xmath128-switch _ to be the reverse of a @xmath128-switch , for @xmath661 . for an upper bound we count all encodings which can be obtained from @xmath662 using at most three reverse switches , regardless of whether @xmath662 is the canonical image of that encoding under @xmath663 .",
    "we will perform the reverse switchings in order : first the reverse @xmath644-switches , if any , then any reverse 2-switches and finally any reverse @xmath619-switches .",
    "note that a reverse switching alters four entries of the current encoding , none of which are bad entries .",
    "so a bad arc created by a reverse switch will never be changed by a later reverse switch .",
    "fix an encoding @xmath664 ( which may not have any bad arcs ) .",
    "let @xmath665 be the number of distinct 5-tuples @xmath658 which define a reverse @xmath128-switch that may be performed in @xmath666 , for @xmath667 .",
    "the result of each of the reverse switches counted by @xmath665 is a @xmath214-valid encoding .",
    "our next task is to calculate upper bounds on @xmath665 which hold for all encodings @xmath664 .",
    "we only perform @xmath644-switches on encodings @xmath664 which have no bad arc with label 2 . for such encodings",
    "we claim that @xmath668 with notation as in lemma  [ fix ] , the factor of 2 counts the two choices of orientation @xmath323 .",
    "we prove the bound assuming that @xmath438 , and the proof for @xmath439 follows by symmetry .",
    "there are @xmath22 choices for vertex @xmath577 , and @xmath0 choices for @xmath579 since @xmath669 as @xmath666 is @xmath214-valid",
    ". then choose @xmath670 so that @xmath671 and @xmath578 is not the head of any bad arc .",
    "there are at most @xmath170 choices for @xmath578 since @xmath672 .",
    "then there are @xmath0 choices for @xmath612 such that @xmath673 , since @xmath578 is the head of exactly @xmath0 good arcs .",
    "this gives the claimed bound on @xmath674 when @xmath666 has no bad arcs labelled 2 .",
    "now suppose that @xmath664 may contain bad arcs with distinct labels , but no vertex is the head ( respectively , tail ) of two bad arcs with distinct labels in @xmath666 .",
    "we also ensure that the reverse 2-switchings that we perform never create any such pair of bad arcs , in order to maintain the canonical order in which forward switches are performed .",
    "we claim that @xmath675 the factor of 2 counts the two choices of orientation @xmath575 .",
    "we prove the bound assuming that @xmath438 , and the proof for @xmath439 follows by symmetry .",
    "there are at most @xmath22 choices for @xmath577 which is not the tail of a bad arc labelled @xmath536 .",
    "then distinct out - neighbours @xmath578 , @xmath579 of @xmath577 in @xmath666 can be chosen in at most @xmath676 ways such that @xmath578 is not the head of a bad arc labelled @xmath536 and @xmath579 is not the head of a bad arc labelled 2 .",
    "( note , @xmath577 is the tail of at most @xmath0 good arcs , since @xmath577 is not the tail of any bad arc labelled @xmath536 . ) then there are at most @xmath677 choices for a neighbour @xmath612 of @xmath578 in @xmath666 , since @xmath578 is the head of at most @xmath0 good arcs .",
    "this gives the claimed bound on @xmath678 .",
    "finally , we claim that for all @xmath664 we have @xmath679 again , the factor of 2 counts the two choices of orientation @xmath680 and we assume @xmath438 below , without loss of generality .",
    "there are @xmath22 ways to choose a vertex @xmath577 which may be the tail of at most one bad arc in @xmath666 .",
    "there are @xmath0 choices for @xmath579 , as @xmath666 is @xmath214-valid so @xmath681 .",
    "then there are at most @xmath641 choices for @xmath578 such that @xmath578 is an out - neighbour of @xmath577 and is not the head of any arc labelled @xmath536 .",
    "( there are at most @xmath0 choices for @xmath578 if there is no bad arc incident with @xmath577 in @xmath666 . ) finally , there are at most @xmath0 choices for @xmath682 such that @xmath673 , since @xmath578 is the head of at most @xmath0 good arcs .",
    "( the @xmath0 here arises since @xmath578 may itself be the head of at most one bad arc in @xmath666 , and the bad arc may be labelled @xmath536 . )",
    "this gives the claimed bound on @xmath683 .",
    "each sequence of reverse switches which may arise is given a type , defined by the corresponding sequence of labels in @xmath684 .",
    "it follows from the proof of lemma  [ fix ] that the only types of reverse switchings which occur are given by the following 9 sequences and all distinct subsequences of these ( including the empty sequence ) : @xmath685 , & [ \\ 2,\\ ( -1,2),\\ ( -1,2)\\ ] ,   & [ \\   -1,\\ -1,\\ ( -1,2)\\ ] , \\\\ { }   [ \\",
    "-1,\\ 2,\\ ( -1,2)\\ ] ,   & [ \\",
    "2,\\ 2,\\ ( -1,2)\\ ] , & [ \\",
    "-1,\\ -1,\\ -1\\ ] , \\\\ { }   [ \\ -1,\\ -1,\\ 2\\ ] , & [ \\",
    "-1,\\ 2,\\ 2\\ ] , & [ \\ 2,\\ 2,\\ 2\\ ] .",
    "\\end{array}\\ ] ] this gives 19 possible types in all .",
    "we calculate the contribution of a type by simply multiplying the upper bounds obtained in ( [ n1])([n12 ] ) corresponding to each reverse switch in the sequence .",
    "( it is at this step that a more careful analysis may lead to an improved bound , but we are satisfied by the bound given by this simple calculation . ) for example , the contribution from the type @xmath686 $ ] is @xmath687    finally we simply sum the contribution from each of the 19 types and find that the resulting expression is bounded above by @xmath688 , using the inequalities @xmath689 .",
    "this shows that @xmath690 completing the proof .    for each pair @xmath220 of distinct digraphs in @xmath13 ,",
    "let @xmath691 be the set of @xmath692 canonical paths which we have defined from @xmath11 to @xmath205 , one for each pairing @xmath203 .",
    "let @xmath693 .",
    "define @xmath694 for each path @xmath695 .",
    "then @xmath696 where @xmath40 is the stationary distribution of the markov chain , which is uniform on @xmath13 .",
    "thus @xmath106 is a flow .",
    "we want to apply lemma  [ second - eigval ] .",
    "first we bound @xmath112 for all transitions @xmath99 of the markov chain .    for any transition @xmath697 of the markov chain , @xmath698 [ load ]    fix a transition @xmath697 of the markov chain .",
    "let @xmath220 be a pair of distinct digraphs in @xmath13 and suppose that @xmath99 lies on @xmath204 , the canonical path from @xmath11 to @xmath205 corresponding to the pairing @xmath203 . from @xmath214 and @xmath220",
    "we can construct @xmath216 and the digraph @xmath699 .",
    "we colour arcs of @xmath211 green if they belong to @xmath214 and yellow if the corresponding entry in @xmath216 is 1 .",
    "( recall that the symmetric difference @xmath211 consists of those arcs with entry 1 in @xmath217 . )    from the pairing @xmath88 we obtain the circuit decomposition @xmath284 of @xmath211 , with colours alternating green , yellow almost everywhere .",
    "a vertex @xmath69 is _ bad _ with respect to @xmath88 if two arcs of the same colour are paired at @xmath69 under @xmath88 .",
    "if a vertex is not bad it is called _",
    "good_. every bad vertex lies on the circuit currently being processed .",
    "specifically , bad vertices may only be found incident to interesting arcs .",
    "lemma  [ zoo ] shows that there are at most five interesting arcs and at most six potentially bad vertices .    a yellow - yellow or green - green pair at a bad vertex @xmath69",
    "is called a _ bad pair _ with respect to @xmath88 .",
    "careful consideration of the possibilities reveals that there can be at most 16 bad pairs with respect to @xmath88 . in the worst case ,",
    "there are five interesting arcs which all belong to @xmath211 .",
    "an interesting arc @xmath99 which belongs to @xmath211 creates two bad pairs in the circuit containing @xmath99 , one at each endvertex of @xmath99 ( both of the same colour ) .",
    "a bad pair is also created in the current circuit @xmath245 incident with each endvertex of each interesting arc , giving at most six further bad pairs .",
    "( the worked example in section  [ a : example ] gives an example of a digraph , @xmath700 , containing the maximum number of bad pairs : see figure  [ example5 ] . )",
    "note also that a bad vertex may be the head ( respectively , tail ) of at most two bad pairs of each colour .",
    "this follows from lemma  [ zoo ] since no vertex is head ( respectively , tail ) of more than two interesting arcs with the same label .",
    "hence a bad vertex may be the head ( respectively , tail ) of at most four bad pairs in total .",
    "this is true even if there are some coincidences between the bad vertices , which may occur when the interesting arcs have one of the configurations other than the first one in figure  [ f : zoo ] . to see this",
    ", note that for all the configurations in figure  [ f : zoo ] , the only vertex which is the head ( or tail ) of more than two interesting arcs is @xmath5 , the start - vertex of the current circuit , and @xmath5 is always distinct from all other bad vertices .    given the uncoloured digraph @xmath211 , we can form a pairing @xmath88 by pairing up all in - arcs around @xmath5 and pairing up all out - arcs around @xmath5 , for each vertex @xmath5 .",
    "let the set of all these pairings be @xmath701 .",
    "say that a pairing @xmath702 is _ consistent with _",
    "@xmath216 if there are at most 16 bad pairs in the yellow - green colouring of @xmath211 with respect to @xmath216 , and at each vertex @xmath539 and for each choice of orientation there are at most two bad pairs of each colour with that orientation at @xmath539 .",
    "let @xmath703 be the set of all pairings @xmath88 of @xmath211 which are consistent with @xmath216 .",
    "given any @xmath220 with @xmath704 , any pairing @xmath203 is consistent with the yellow - green colouring of @xmath211 , as proved above .",
    "therefore each triple @xmath215 with @xmath203 and @xmath705 gives rise to at least one pair @xmath706 with @xmath652 and @xmath707 .",
    "conversely , we can start with @xmath652 and find an upper bound for @xmath708 .",
    "once @xmath88 and @xmath212 are given , there are at most four possibilities for @xmath220 with @xmath705 , by lemma  [ notquiteunique ] .",
    "recall from ( [ number - pairings ] ) that @xmath709 where @xmath710 is the in - degree of @xmath5 in @xmath211 and @xmath711 is the out - degree of @xmath5 in @xmath211 .",
    "similarly , each good",
    "vertex @xmath5 contributes a factor @xmath712 to @xmath708 , but a bad vertex may contribute more .",
    "the contributions from in - arcs and out - arcs are independent , so we consider only in - arcs below .",
    "recall that no vertex can be the head of more than two bad pairs of a given colour .",
    "first suppose that a vertex @xmath5 is the head of @xmath713 green arcs and @xmath714 yellow arcs",
    ". then @xmath5 must be bad , with two bad green pairs and no bad yellow pairs .",
    "the number of ways to pair up the in - arcs around @xmath5 is @xmath715 next suppose that @xmath5 is the head of @xmath716 green arcs and @xmath717 yellow arcs",
    ". then @xmath5 must be a bad vertex",
    ". now @xmath5 may be the head of two bad green pairs and one bad yellow pair , or @xmath5 may be the head of one bad green pair and no bad yellow pairs .",
    "the number of ways to pair up the in - arcs around @xmath5 with two bad green pairs and one bad yellow pair is @xmath718 while the number of pairings of in - arcs around @xmath5 with one bad green pair and no bad yellow pairs is @xmath719 finally , suppose that @xmath5 is the head of @xmath231 arcs of each colour",
    ". then @xmath5 may be good , or it may be the head of one bad pair of each colour , or the head of two bad pairs of each colour .",
    "the number of pairings of in - arcs around @xmath5 with two bad pairs of in - arcs of each colour is @xmath720 while the number of pairings of in - arcs around @xmath5 with one bad pair of each colour is @xmath721 by symmetry , the same bounds hold for out - arcs and also hold after exchanging green and yellow .",
    "since there are at most 16 bad pairs , it follows that @xmath722 now write @xmath723 to denote the indicator variable which is 1 if @xmath705 and is 0 otherwise , for @xmath724 and @xmath203 .",
    "then @xmath725 the first inequality follows by lemma  [ notquiteunique ] , the third inequality follows from ( [ psi - prime ] ) , and applying lemma  [ poly ] gives the last inequality .",
    "this completes the proof .",
    "we can now complete our argument by proving proposition  [ our - second - largest - eigval ] .",
    "for any transition @xmath697 of the switch chain we have @xmath726 therefore , by lemma  [ load ] , @xmath727 next , observe that @xmath728 , since each step along a canonical path replaces at least one arc of @xmath11 by an arc of @xmath205 .",
    "the result follows from lemma  [ second - eigval ] .",
    "let @xmath724 be any pair of digraphs with the symmetric difference @xmath211 given in figure  [ example1 ] , where vertices of degree 0 in @xmath211 are not shown .",
    "to avoid congestion in the figure , some vertices are depicted as black rectangles .",
    "solid arcs belong to @xmath11 and dashed arcs belong to @xmath205 , so they play the role of blue and red arcs",
    ".      let @xmath88 which be the pairing which produces the forward circuits @xmath729 in the given order .",
    "set @xmath730 and start processing @xmath211 .",
    "the first circuit to process is the eccentric 2-circuit @xmath731 we have @xmath516 , and the eccentric arc @xmath489 does not belong to @xmath374 .",
    "hence @xmath213 falls into case ( ea ) and we must first perform the eccentric switch @xmath732 $ ] .",
    "this produces the next digraph @xmath733 in the canonical path @xmath204 .",
    "the eccentric arc @xmath489 has been used in the eccentric switch , so it is now an interesting arc .",
    "initially it belonged to @xmath210 , and now it belongs to @xmath734 , so it does not belong to the current symmetric difference @xmath735 .",
    "however , we include all interesting arcs in our figures , denoted by thicker arcs ( either solid or broken , as appropriate ) . hence figure  [ example2 ] shows the symmetric difference of @xmath733 and @xmath205 , together with the eccentric arc .",
    "next , we must process the normal 2-circuit @xmath737 which the eccentric switch has produced ( see figure  [ eccentric - detail ] ) . from lemma  [ eccentric - plus - shortcut ]",
    "we know that the shortcut arc is @xmath487 , and again @xmath516 .",
    "now @xmath738 so @xmath476 falls into case ( nc ) , and we will perform the shortcut switch last . our next task is to process the 1-circuit @xmath739 the set @xmath740 of end - vertices of odd chords which are absent in @xmath733 is @xmath741 .",
    "now @xmath742 is a contiguous substring of @xmath213 , so these vertices are all distinct , and hence @xmath740 has three elements .",
    "thus there will be three phases in the processing of @xmath441 .",
    "the first phase is over after just one switch , namely @xmath743 $ ] .",
    "this produces the next digraph @xmath744 on the canonical path : see figure  [ example3 ] .",
    "the odd chord @xmath745 has become an interesting arc , so it is included in figure  [ example3 ] together with the eccentric arc .",
    "both belong to @xmath746 , and hence they are depicted by a thick unbroken arc .",
    "the arcs @xmath373 , @xmath747 , @xmath748 have now been switched to agree with @xmath205 , so they play no further role .",
    "hence we have omitted these arcs from figure  [ example3 ] .",
    "we now start phase 2 with the switch @xmath749 $ ] , producing the next digraph @xmath750 on the canonical path .",
    "see figure  [ example4 ] .",
    "note that there are four interesting arcs in @xmath750 , namely three odd chords and the eccentric arc .",
    "the vertex @xmath751 is omitted from figure  [ example4 ] since it has degree zero in the symmetric difference of @xmath750 and @xmath205 .",
    "( we will make no further comments on the inclusion of interesting arcs or the omission of isolated vertices for the remaining figures . )",
    "the next step in phase 2 is the switch @xmath752 $ ] , which involves the shortcut arc .",
    "this produces the digraph @xmath700 on the canonical path .",
    "see figure  [ example5 ] .",
    "note that @xmath700 has five interesting arcs , namely @xmath753 this is the maximum possible , by lemma  [ zoo ] .",
    "later we will show that @xmath700 also has the maximum number of bad pairs .",
    "then we perform phase 3 , which consists of one step : the switch @xmath756 $ ] .",
    "this produces the digraph @xmath757 which has no interesting odd chords , but still has two interesting arcs , namely the eccentric arc and shortcut arc .",
    "see figure  [ example7 ] .",
    "this completes the processing of the 1-circuit @xmath441 . to complete the processing of the normal 2-circuit @xmath476",
    "we must perform the shortcut switch @xmath488 $ ] .",
    "this produces the digraph @xmath758 as in figure  [ example8 ] , with no interesting arcs .",
    "it remains to process the remaining circuits in the given order .",
    "each remaining circuit is an alternating 4-cycle , which is processed by a single switch , removing it from the symmetric difference .",
    "this gives 6 more switches , specifically @xmath759 , \\,\\ , [ v x_{1,0 } q_1 q_2],\\,\\ ,     [ z_{1,0 } x_{1,0 } r_1 r_2],\\,\\ ,      [ z_{1,0 } s_1 s_2 v],\\,\\ ,    [ v w_2 t_1 t_2],\\,\\ , [ v u_2 u_1 z_{0,0}].\\ ] ] the switches are performed in this order , producing digraphs @xmath760 where @xmath761 .",
    "this completes the construction of the canonical path @xmath204 from @xmath11 to @xmath205 corresponding to @xmath88 .",
    "now let us return to the digraph @xmath700 .",
    "we now show that there are 16 bad pairs in @xmath700 with respect to @xmath88 .",
    "we redraw @xmath211 in figure  [ example9 ] , where now solid lines show arcs in @xmath762 and dashed lines show arcs in @xmath763 . hence solid and dashed arcs play the role of green and yellow arcs , in the terminology of lemma  [ load ] .",
    "interesting arcs are still shown with thicker lines .      by tracing around this figure using the circuits given in ( [ circuits ] ) determined by the pairing @xmath88 , we find that there are 16 bad pairs in @xmath700 with respect to @xmath88 .",
    "this is the maximum possible number of bad pairs , as proved in lemma  [ load ] .",
    "table  [ badpairs ] shows the bad vertices and the bad pairs of arcs incident with each one .        1 .   in this relatively small example , not many coincidences between the bad vertices are possible .",
    "for instance , we know that @xmath764 since @xmath765 is a contiguous substring of @xmath213 , while @xmath766 since @xmath767 is a blue arc in @xmath211 and @xmath768 is a red arc in @xmath211 . in our example",
    ", the only coincidences that may occur are that @xmath501 may equal @xmath769 or it may equal @xmath405 .",
    "if either holds then the vertex @xmath769 is incident with four bad pairs in @xmath700 , one of each colour and orientation .",
    "2 .   this example was constructed to produce a digraph with the maximum number of bad pairs ( namely @xmath700 , with 16 bad pairs ) .",
    "this was achieved by letting the interesting arcs all belong to @xmath211 , so that they did not become bad arcs when they became interesting , but instead they created extra bad pairs with respect to @xmath88 .",
    "if instead @xmath211 just consisted of the arcs of the eccentric 2-circuit @xmath213 , then any interesting arc would also be a bad arc .",
    "( for example , if the eccentric arc had not been an arc of @xmath211 but was absent in both @xmath11 and @xmath205 then in @xmath733 it would become a bad arc with label @xmath536 . )",
    "then the analogue of @xmath700 would be an example of a digraph with the maximum number of bad arcs .",
    "a.  berger and m.  m \" uller - hannemann , uniform sampling of digraphs with a fixed degree sequence , in _ graph theoretic concepts in computer science _ , lecture notes in computer science vol .",
    "6410 , springer , berlin , 2010 , pp .",
    "220231 .",
    "p.  diaconis , r.  graham and s.p .",
    "holmes , statistical problems involving permutations with restricted positions , in _ state of the art in probability and statistics _",
    ", lecture notes - monograph series vol .",
    "36 , institute of mathematical statistics , beachwood , oh , 2001 , pp .",
    "195222 .",
    "t.  feder , a.  guetz , m.  mihail and a.  saberi , a local switch markov chain on given degree graphs with application in connectivity of peer - to - peer networks , in _ proceedings of the 47th annual ieee symposium on foundations of computer science _",
    ", ieee press , new york , 2006 , pp .",
    "c.  hall and a.  carzaniga , uniform sampling for directed p2p networks , in _ proceedings of euro - par 2009 parallel processing _ , lecture notes in computer science vol .",
    "5705 , springer , berlin , 2009 , pp .",
    "511522 .",
    "p.  mahlmann and c.  schindelhauer , peer - to - peer networks based on random transformations of connected regular undirected graphs , in _ proceedings of the 17th annual acm symposium on parallelism for algorithms and architectures _ , acm press , new york , 2005 , pp .  155164 .",
    "p.  mahlmann and c.  schindelhauer , distributed random digraph transformations for peer - to - peer networks , in _ proceedings of the 18th annual acm symposium on parallel algorithms and architectures _ , acm press , new york , 2006 , pp .",
    "308317 .    c.  mart ' inez , a.  panholzer and h.  prodinger , generating random derangements , in proceedings of the fifth workshop on analytic algorithmics and combinatorics ( analco ) , siam , philadelphia , pa , 2008 , pp",
    ".  234240 .",
    "r.  milo , n.  kashtan , s.  itzkovitz , m.e.j .",
    "newman and u.  alon , _ on the uniform generation of random graphs with prescribed degree sequences _ , preprint , 2004 .",
    "+ arxiv : cond - mat/0312028v2 [ cond-mat.stat-mech ]      a.r .",
    "rao , r.  jana and s.  bandyopadhyay , a markov chain monte carlo method for generating random ( 0,1)-matrices with given marginals , _ sankhy@xmath770 : the indian journal of statistics _ * 58 * ( 1996 ) , 225242 ."
  ],
  "abstract_text": [
    "<S> the switch chain is a well - known markov chain for sampling directed graphs with a given degree sequence . </S>",
    "<S> while not ergodic in general , we show that it is ergodic for regular degree sequences . </S>",
    "<S> we then prove that the switch chain is rapidly mixing for regular directed graphs of degree @xmath0 , where @xmath0 is any positive integer - valued function of the number of vertices . </S>",
    "<S> we bound the mixing time by bounding the eigenvalues of the chain . </S>",
    "<S> a new result is presented and applied to bound the smallest ( most negative ) eigenvalue . </S>",
    "<S> this result is a modification of a lemma by diaconis and stroock  @xcite , and by using it we avoid working with a lazy chain . </S>",
    "<S> a multicommodity flow argument is used to bound the second - largest eigenvalue of the chain . </S>",
    "<S> this argument is based on the analysis of a related markov chain for undirected regular graphs by cooper , dyer and greenhill  @xcite , but with significant extension required . </S>"
  ]
}