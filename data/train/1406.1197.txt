{
  "article_text": [
    "network theory is systematically used to address problems of scientific and societal relevance @xcite , from the prediction of the spreading of infectious diseases worldwide @xcite to the identification of early - warning signals of upcoming financial crises @xcite .",
    "more in general , several dynamical and stochastic processes are strongly affected by the topology of the underlying network @xcite .",
    "this results in the need to identify the topological properties that are statistically significant in a real network , i.e. to discriminate which higher - order properties can be directly traced back to the local features of nodes , and which are instead due to additional factors .    to achieve this goal ,",
    "one requires ( a family of ) randomized benchmarks , i.e. ensembles of graphs where the local heterogeneity is the same as in the real network , and the topology is random in any other respect : this defines a _ null model _ of the original network .",
    "nontrivial patterns can then be detected in the form of empirical deviations from the theoretical expectations of the null model @xcite .",
    "important examples of such patterns is the presence of _ motifs _ ( recurring subgraphs of small size , like building blocks of a network @xcite ) and _ communities _ ( groups of nodes that are more densely connected internally than with each other @xcite ) . to detect these and many other patterns",
    ", one needs to correctly specify the null model and then calculate e.g. the average and standard deviation ( or alternatively a confidence interval ) of any topological property of interest over the corresponding randomized ensemble of graphs .",
    "unfortunately , given the strong heterogeneity of nodes ( e.g. the power - law distribution of vertex degrees ) , the solution to the above problem is not simple .",
    "this is most easily explained in the case of binary graphs , even if similar arguments apply to weighted networks as well . for simple graphs ,",
    "the most important null model is the ( undirected binary ) configuration model ( ubcm ) , defined as an ensemble of networks where the degree of each node is specified , and the rest of the topology is maximally random @xcite .",
    "since the degrees of all nodes ( the so - called _ degree sequence _ ) act as constraints , `` maximally random '' does not mean `` completely random '' : in order to realize the degree sequence , interdependencies among vertices necessarily arise .",
    "these interdependencies affect other topological properties as well .",
    "so , even if the degree sequence is the only quantity that is enforced ` on purpose ' , other structural properties are unavoidably constrained as well .",
    "these higher - order effects are called `` structural correlations '' . in order to disentangle spurious structural correlations from genuine correlations of interest",
    ", it is very important to properly implement the ubcm in such a way that it takes the observed degree sequence as input and generates expectations based on a uniform and efficient sampling of the ensemble .",
    "similar and more challenging considerations apply to other null models , defined e.g. for directed or weighted graphs and specified by more general constraints .",
    "several approaches to the problem have been proposed and can be roughly divided in two large classes : _ microcanonical _ and _ canonical _ methods .",
    "microcanonical approaches @xcite aim at artificially generating many randomized variants of the observed network in such a way that the constrained properties are identical to the empirical ones , thus creating a collection of graphs sampling the desired ensemble . in these algorithms",
    "the enforced constraints are ` hard ' , i.e they are met exactly by each graph in the resulting ensemble . as we discuss in this paper , this strong requirement implies that most microcanonical approaches proposed so far suffer from various problems , including bias , lack of ergodicity , mathematical intractability , high computational demands , and poor generalizability .    on the other hand , in",
    "_ approaches @xcite the constraints are ` soft ' , i.e. they can be violated by individual graphs in the ensemble , even if the ensemble average of each constraint still matches the enforced value exactly .",
    "canonical approaches are generally introduced to directly obtain , as a function of the observed constraints ( e.g. the degree sequence ) , exact mathematical expressions for the expected topological properties , thus avoiding the explicit generation of randomized networks @xcite . however , this is only possible if the mathematical expressions for the topological properties of interest are simple enough to make the analytical calculation of the expected values feasible .",
    "unfortunately , the most popular approaches rely on highly approximated expressions leading to ill - defined or unknown probabilities that can not be used to sample the ensemble .",
    "these approximations are in any case available only for the simplest ensembles ( e.g. the ubcm ) , leaving the problem unsolved for more general constraints .",
    "this implies that the computational use of canonical null models has not been implemented systematically so far .    in this paper , by combining an exact maximum - likelihood approach with an efficient computational sampling scheme ,",
    "we define a rigorously unbiased method to sample ensembles of various types of networks ( i.e. directed , undirected , weighted , binary ) with many possible constraints ( degree sequence , strength sequence , reciprocity structure , mixed binary and weighted properties , etc . ) .",
    "we make use of a series of recent analytical results that generate the exact probabilities in all these cases of interest @xcite and consider various examples illustrating the usefulness of our method when applied to real - world networks .",
    "we also analyse the canonical fluctuations of the constraints in each model .",
    "previous theoretical analyses of fluctuations in some network ensembles have been carried out , for instance , in ref.@xcite for graphs with given degree sequence and in ref .",
    "@xcite for graphs with given community structure .",
    "also , a comparison between some microcanonical and canonical network ensembles has been carried out in ref .",
    "@xcite . in this paper",
    ", we provide a complete analytical characterization of the fluctuations of each constraint for all the ensembles under study . for the majority of these ensembles ,",
    "the exact analytical expressions characterizing the fluctuations are derived here for the first time . moreover , in our maximum - likelihood approach the knowledge of the hidden variables allows us to calculate , for the first time , the exact value of the fluctuations explicitly for each node in the empirical networks considered .",
    "our results suggest that , unlike in most physical systems , the microcanonical and canonical versions of the graph ensembles considered here are surprisingly _ not _ equivalent ( see ref .",
    "@xcite for a recent mathematical proof of ensemble nonequivalence in the ubcm ) .    in any case , our canonical method can in principle be converted into an unbiased microcanonical one , if we discard all the sampled networks that violate the sharp constraints . at the end of the paper",
    ", we discuss the advantages and disadvantages of this procedure explicitly , and clarify that canonical ensembles are more appropriate in presence of missing entries or errors in the data .    finally , we include an appendix with a description of a algorithm that we have explicitly coded in various ways @xcite .",
    "the algorithm allows the users to sample all the graph ensembles described in this paper , given an empirically observed network ( or even only the values of the constraints ) .",
    "in this section , we briefly discuss the main available approaches to the problem of sampling network ensembles with given constraints , and highlight the limitations that call for an improved solution .",
    "we consider both microcanonical and canonical methods . in both cases , since the ubcm is the most popular and most studied ensemble , we will discuss the problem by focusing mainly on the implementations of this model .",
    "the same kind of considerations extend to other constraints and other types of networks as well .",
    "there have been several attempts to develop microcanonical algorithms that efficiently implement the ubcm .",
    "one of the earliest algorithm starts with an empty network having the same number of vertices of the original one , where each vertex is assigned a number of ` half edges ' ( or ` edge stubs ' ) equal to its degree in the real network .",
    "then , pairs of stubs are randomly matched , thus creating the final edges of a random network with the desired degree sequence @xcite .",
    "unfortunately , for most empirical networks , the heterogeneity of the degrees is such that this algorithm produces several multiple edges between vertices with large degree , and several self - loops @xcite .",
    "if the formation of these undesired edges is forbidden explicitly , the algorithm gets stuck in configurations where edge stubs have no more eligible partners , thus failing to complete any randomized network .    to overcome this limitation , a different algorithm ( which is still widely used )",
    "was introduced @xcite .",
    "this `` local rewiring algorithm '' ( lra ) starts from the original network , rather than from scratch , and randomizes the topology through the iteration of an elementary move that preserves the degrees of all nodes .",
    "while this algorithm always produces random networks , it is very time consuming since many iterations of the fundamental move are needed in order to produce just one randomized variant , and this entire operation has to be repeated several times ( the mixing time being still unknown @xcite ) in order to produce many variants .    besides these practical problems ,",
    "the main conceptual limitation of the lra is the fact that it is _ biased _ , i.e. it does not sample the desired ensemble uniformly .",
    "this has been rigorously shown relatively recently @xcite .",
    "for undirected networks , uniformity has been shown to hold , at least approximately , only when the degree sequence is such that @xcite @xmath0 where @xmath1 is the largest degree in the network , @xmath2 is the average degree , @xmath3 is the second moment , and @xmath4 is the number of vertices . clearly , the above condition sets an upper bound for the heterogeneity of the degrees of vertices , and is violated if the heterogeneity is strong .",
    "this is a first indication that the available methods break down for ` strongly heterogeneous ' networks . as we discuss later , most real - world networks are known to fall precisely within this class . for",
    "directed networks , where links are oriented and the constraints to be met are the numbers of incoming and outgoing links ( in - degree and out - degree ) separately , a condition similar to eq.([eq_1 ] ) is required to avoid the generation of bias @xcite . again , this condition is strongly violated by most real - world networks . moreover , the directed version of the lra is also non - ergodic , i.e. it is in general not able to explore the entire ensemble of networks @xcite .",
    "it has been shown that ergodicity can be restored by introducing an additional triangular move inverting the direction of closed loops of three vertices @xcite . however , in order to restore uniformity ( for both directed and undirected graphs ) one needs to introduce an appropriate acceptance probability for the rewiring move @xcite .",
    "unfortunately , the acceptance probability depends on some nontrivial property of the current network configuration . since this property must be recalculated at each step , the resulting algorithm is significantly time consuming . quantifying the bias generated by the lra when eq.([eq_1 ] ) ( or its directed counterpart ) is violated is difficult , mainly because an exact mathematical characterization of microcanonical graph ensembles valid in such regime is still lacking .",
    "yet , the proof of the existence of bias provided in refs .",
    "@xcite is an obvious warning against the use of the lra on strongly heterogeneous networks .",
    "the reader is referred to those papers for a discussion .",
    "other recent alternatives @xcite rely on theorems , such as the erds - gallai @xcite one , that set necessary and sufficient conditions for a degree sequence to be _ graphic _ , i.e. realized by at least one graph .",
    "these ` graphic ' methods exploit such ( or related ) conditions to define biased sampling algorithms in conjunction with the estimation of the corresponding sampling probabilities , thus allowing one to statistically reweight the outcome and sample the ensemble effectively uniformly @xcite .",
    "del genio et al .",
    "@xcite show that , for networks with power - law degree distribution of the form @xmath5 , the computational complexity of sampling _ just one _ graph using their algorithm is @xmath6 if @xmath7",
    ". however , when @xmath8 the computational complexity increases to @xmath9 if @xmath10 and to @xmath11 if @xmath12 .",
    "the upper bound @xmath13 is a particular case of the so - called `` structural cut - off '' that we will discuss in more detail later . for the moment",
    ", it is enough for us to note that eq .",
    "is another indication that , for strongly heterogeneous networks , the problem of sampling becomes more complicated .",
    "unfortunately , most real networks violate eq .",
    "strongly .",
    "so , while ` graphic ' algorithms do provide a solution for every network , their complexity increases for networks of increasing ( and more realistic ) heterogeneity .",
    "a more fundamental limitation is that these methods can only handle the problem of binary graphs with given degree sequence .",
    "the generalization to other types of networks and other constraints is not straightforward , as it would require the proof of more general ` graphicality ' theorems , and _ ad hoc _ modifications of the algorithm .",
    "canonical approaches aim at obtaining , as a function of the observed constraints ( e.g. the degree sequence ) , mathematical expressions for the expected topological properties , avoiding the explicit generation of randomized networks . for canonical methods",
    "the requirement of uniformity is replaced by the requirement that the proability distribution over the enlarged ensemble has maximum entropy @xcite .    for binary graphs ,",
    "since any topological property @xmath14 is a function @xmath15 of the adjacency matrix @xmath16 of the network ( with entries @xmath17 if the vertices @xmath18 and @xmath19 are connected , and @xmath20 otherwise ) , the ultimate goal is that of finding a mathematical expression for the probability @xmath21 of occurrence of each graph .",
    "this allows to compute the expected value of @xmath14 as @xmath22 .",
    "importantly , for canonical ensembles with local constraints @xmath21 factorizes to a product over pairs of nodes , where each term in the product involves the probability @xmath23 that the vertices @xmath18 and @xmath19 are connected in the ensemble . determining the mathematical form of @xmath23 is the main goal of canonical approaches .",
    "note that , by contrast , in the microcanonical ensemble all links are dependent on each other ( the degree sequence must be reproduced exactly in each realization ) , which implies that the probability of the entire graph does not factorize to node - pair probabilities .    for binary undirected networks , the most popular specification for @xmath23 is the factorized one @xcite : @xmath24 ( where @xmath25 is the degree of node @xmath18 and @xmath26 is the total degree over all nodes ) . for weighted undirected networks , where each link can have a non - negative weight @xmath27 and each vertex @xmath18",
    "is characterized by a given strength @xmath28 ( the total weight of the links of node @xmath18 ) , the corresponding assumption is that the expected weight of the link connecting the vertices @xmath18 and @xmath19 is @xmath29 ( where @xmath30 is the total strength of all vertices ) .",
    "equations and are routinely used , and have become standard textbook expressions @xcite .",
    "the most frequent use of these expressions is perhaps encountered in the empirical analysis of _ communities _ , i.e. relatively denser modules of vertices in large networks @xcite .",
    "most community detection algorithms compare different partitions of vertices into communities ( each partition being parametrized by a matrix @xmath31 such that @xmath32 if the vertices @xmath18 and @xmath19 belong to the same community , and @xmath33 otherwise ) and search for the optimal partition .",
    "the latter is the one that maximizes the modularity function which , for binary networks , is defined as @xmath34c_{ij } \\label{eq_4}\\ ] ] where eq",
    ". appears explicitly as a null model for @xmath35 . for weighted networks , a similar expression involving eq . applies .",
    "other important examples where eq .",
    "is used are the characterization of the connected components of networks @xcite , the average distance among vertices @xcite , and more in general the theoretical study of percolation @xcite ( characterizing the system s robustness under the failure of nodes and/or links ) and other dynamical processes @xcite on networks .    due to the important role that these equations play in many applications , it is remarkable that the literature puts very little emphasis on the fact that eqs . and are valid only under strict conditions that , for most real networks , are strongly violated .",
    "it is evident that eq .",
    "represents a probability only if the largest degree @xmath1 in the network does not exceed the so - called `` structural cut - off '' @xmath36 @xcite , i.e. if @xmath37 obviously , the above condition sets an upper bound for the allowed heterogeneity of the degrees , since both @xmath1 and @xmath26 are determined by the same degree distribution . unfortunately ,",
    "as we discuss below , it has been shown that @xmath1 strongly exceeds @xmath38 in most real - world networks , making eq .",
    "ill - defined .",
    "it should be noted that in principle the knowledge of @xmath23 allows one to sample networks from the canonical ensemble very easily , by running over all pairs of nodes and connecting them with the appropriate probability .",
    "however , the fact that @xmath39 when @xmath40 makes such probability useless for sampling purposes .",
    "this is why , despite their conceptual simplicity , general algorithms to sample canonical ensembles of networks have not been implemented so far , and the emphasis has remained on microcanonical approaches .",
    "equations , and , along with our discussion above , show that most methods run into problems when the heterogeneity of the network is too pronounced : strongly heterogeneous networks elude most microcanonical and canonical approaches proposed so far .",
    "unfortunately , networks in this extreme regime are known to be ubiquitous , and represent the rule rather than the exception . a simple way to prove",
    "this is by directly checking whether the largest degree exceeds the structural cut - off @xmath41 . as maslov et al .",
    "first noticed @xcite , in real networks @xmath41 is strongly and systematically exceeded : for instance , for the internet @xmath42 and @xmath43 , which means that the structural cut - off is exceeded ten - fold .",
    "consequently , if eq . were applied to the two vertices with largest degree , the resulting connection ` probability ' would be @xmath44 , i.e. more than 40 times larger than any reasonable estimate for a probability .",
    "we also note that , when inserted into eq .",
    ", this value of @xmath23 would produce , in the summation , a single term 40 times larger than any other ` regular ' ( i.e. of order unity ) term , thus significantly biasing the community detection problem . to the best of our knowledge",
    ", a study of the entity of this bias has never been performed .",
    "the internet is not a special case , and similar results are found in the majority of real networks , making the problem entirely general . to see this",
    ", it is enough to exploit the fact that most real networks have a power - law degree distribution of the form @xmath5 with exponent in the range @xmath45 . for these networks ,",
    "the average degree @xmath46 is finite but the second moment @xmath3 diverges .",
    "therefore the structural cut - off scales as @xmath47 @xcite , which means that eqs . and",
    "by contrast , extreme value theory shows that the largest degree scales as @xmath48 @xcite .",
    "this implies that the ratio @xmath49 diverges for large networks , i.e. the largest degree is infinitely larger than the allowed cut - off value .",
    "unfortunately , many results and approaches that have been obtained by assuming @xmath50 are naively extended to real networks where , in most of the cases , @xmath51 .",
    "therefore , although this might appear as an exaggerated claim , most analyses of real - world networks ( including community detection ) that have been carried out so far have relied on incorrect expressions , and have been systematically affected by an uncontrolled bias .    in theoretical and computational models of networks , the problem is normally circumvented by enforcing the condition @xmath50 explicitly , e.g. by considering a truncated power - law distribution .",
    "this procedure is usually justified with the expectation that the inequality @xmath50 should hold for sparse networks where the average degree does not grow with @xmath4 , as in most real networks @xcite .",
    "this interpretation of the role of sparsity is however misleading , since in real scale - free networks with @xmath52 the average degree is finite irrespective of the presence of the cut - off .",
    "this makes those networks sparse even without assuming a truncation in the degree distribution . as a matter of fact , as clear from the example above",
    ", real networks systematically violate the cut - off value , and are therefore ` strongly heterogeneous ' , even if sparse . by the way",
    ", the fact that a high density is not the origin of the breakdown of the available approaches should be clear by considering that dense but homogeneous networks ( including the densest of all , i.e. the complete graph ) are such that @xmath50 and are therefore correctly described by eq .",
    ", just like sparse homogeneous networks .",
    "this confirms that the problem is in fact due to _ strong heterogeneity _ and not to high density .",
    "the above arguments can be extended to other ensembles of networks with different constraints .",
    "the general conclusion is that , since real - world networks are generally strongly heterogeneous , the available approaches either break down or become computationally demanding .",
    "moreover , it is difficult to generalize the available knowledge to modified constraints and different types of graphs .",
    "in what follows , building on a series of recent results characterizing several canonical ensembles of networks @xcite , we introduce a unified approach to sample these ensembles in a fast , unbiased and efficient way . in our approach , the functional form of the probability of each graph in the ensemble",
    "is derived by maximizing shannon s entropy @xcite ( thus ensuring that the sampling is unbiased ) , and the numerical coefficients of this probability are derived by maximizing the probability ( i.e. the likelihood ) itself @xcite . since this double maximization is the core of our approach , we call our method the `` maximize and sample '' ( `` max & sam '' for short ) method .",
    "we also provide a code implementing all our sampling algorithms ( see appendix ) .",
    "we will consider canonical ensembles of binary graphs with given degree sequence ( both undirected @xcite and directed @xcite ) , of weighted networks with given strength sequence ( both undirected @xcite and directed @xcite ) , of directed networks with given reciprocity structure ( both binary @xcite and weighted @xcite ) , and of weighted networks with given combined strength sequence and degree sequence @xcite . in all these cases , that have been treated only separately so far , we implement an explicit sampling protocol based on the exact result that the probability of the entire network always factorizes as a product of dyadic probabilities over pairs of nodes .",
    "this ensures that the computational complexity of our sampling method is always @xmath6 in all cases considered here , irrespective of the level of heterogeneity of the real - world network being randomized .",
    "therefore our method does not suffer from the limitations of the other methods discussed in sec .",
    "[ sec : previous ] : it is efficient and unbiased even for strongly heterogeneous networks .    it should be noted that , while most microcanonical algorithms require as input the entire adjacency matrix of the observed graph ( see sec . [",
    "sec : micro ] ) , our canonical approach requires only the empirical values of the constraints ( e.g. the degree sequence ) . at a theoretical level",
    ", this desirable property restores the expectation that such constraints should be the sufficient statistics of the problem . at a practical level",
    ", it enormously simplifies the data requirements of the sampling process .",
    "for instance , if the sampling is needed in order to reconstruct an unknown network from partial node - specific information ( e.g. to generate a collection of likely graphs consistent with an observed degree and/or strength sequence ) , then most microcanonical algorithms can not be applied , while canonical ones can reconstruct the network to a high degree of accuracy @xcite .",
    "let us start by considering binary , undirected networks ( buns ) .",
    "a generic bun is uniquely specified by its binary adjacency matrix @xmath16 . the particular matrix corresponding to the observed graph that we want to randomize will be denoted by @xmath53 . as we mentioned , the simplest non - trivial constraint is the degree sequence , @xmath54 ( where @xmath55 is the degree of node @xmath18 ) , defining the ubcm .    in our approach ,",
    "the canonical ensemble of buns is the set of networks with the same number of nodes , @xmath4 , of the observed graph and a number of ( undirected ) links varying from zero to the maximum value @xmath56 .",
    "appropriate probability distributions on this ensemble can be fully determined by maximizing , in sequence , shannon s entropy ( under the chosen constraints ) and the likelihood function , as already pointed out in @xcite .",
    "the result of the entropy maximization @xcite is that the graph probability factorizes as @xmath57 where @xmath58 .",
    "the vector @xmath59 of @xmath4 unknown parameters ( or ` hidden variables ' ) is to be determined either by maximizing the log - likelihood function @xmath60 or , equivalently , by solving the following system of @xmath4 equations ( corresponding to the requirement that the gradient of the log - likelihood vanishes ) @xcite : @xmath61 where @xmath62 is the observed degree of vertex @xmath18 and @xmath63 indicates its ensemble average . in both cases , the parameters @xmath59 vary in the region defined by @xmath64 for all @xmath18 @xcite .    from eq .",
    "it is evident that only the observed values of the chosen constraints ( the _ sufficient statistics _ of the problem ) are needed in order to obtain the numerical values of the unknowns ( the empirical degree sequence fixes the value of @xmath59 , which in turn fix the value of all the probabilities @xmath65 ) . in any case , for the sake of clarity , in the code we allow the user to choose the preferred input - form ( a matrix , a list of edges , a vector of constraints ) .",
    "this applies to all the models described in this paper and implemented in the code .",
    "note that the above form of @xmath23 represents the exact expression that should be used in place of eq .. this reveals the highly non - linear and non - local character of the interdependencies among vertices in the ubcm : in random networks with given degree sequence , the correct connection probability @xmath23 is a function of the degrees of _ all vertices _ of the network , and not just of the end - point degrees as in eq .. only when the degrees are ` weakly heterogeneous ' ( mathematically , this happens when @xmath66 for all pairs of vertices , which implies @xmath67 ) , these structural interdependencies become approximately local . note that , in the literature , this is improperly called the `` sparse graph '' limit @xcite , while , as we discussed in sec.[sec : problems ] , what defines this limit is a low level of heterogeneity , and not sparsity .        unlike eq .",
    ", the @xmath23 considered here always represents a proper probability ranging between 0 and 1 , irrespective of the heterogeneity of the network .",
    "this implies that eq . provides us with a recipe to sample the canonical ensemble of buns under the ubcm .",
    "after the unknown parameters have been found , they can be put back into eq . to obtain the probability to correctly sample any graph @xmath16 from the ensemble .",
    "the key simplification allowing this in practice is the fact that the graph probability is factorized , so that a single graph can be sampled stochastically by sequentially running over each pair of nodes @xmath68 and implementing a bernoulli trial ( whose elementary events are @xmath69 , with probability @xmath70 , and @xmath71 , with probability @xmath23 ) . this process can be repeated to generate as many configurations as desired .",
    "note that sampling each network has complexity @xmath6 , and that the time required to preliminarily solve the system of coupled equations to find the unknown parameters @xmath59 is independent on how many random networks are sampled and on the heterogeneity of the network .",
    "thus this algorithm is always more efficient than the corresponding microcanonical ones described in sec.[sec : micro ] .    in fig .",
    "[ bun_a2 ] we show an application of this procedure to the network of liquidity reserves exchanges between italian banks in 1999 @xcite . for an increasing number of sampled graphs ,",
    "we show the convergence of the sample average @xmath72 of each entry of the adjacency matrix to its exact canonical expectation @xmath73 , analytically determined after solving the likelihood equations .",
    "this preliminary check is useful to establish that , in this case , generating 1000 networks ( bottom right ) is enough to reach a high level of accuracy . if needed , the accuracy can be quantified rigorously ( e.g. in terms of the maximum width around the identity line ) and arbitrarily improved by increasing the number of sampled matrices .",
    "note that this important check is impossible in microcanonical approaches , where the exact value of the target probability is unknown .",
    "we then select the sample of 1000 networks and confirm ( see the top panel of fig .",
    "[ bun_top2 ] ) that the imposed constraints ( the observed degrees of all nodes ) are very well reproduced by the sample average , and that the confidence intervals are narrowly spread around the identity line .",
    "this is an important test of the accuracy of our sampling procedure .",
    "again , the accuracy can be improved by increasing the number of sampled matrices if needed .",
    "after this preliminary check , the sample can be used to compare the expected and observed values of higher - order properties of the network .",
    "note that in this case we do not require ( or expect ) that these ( unconstrained ) higher - order properties are correctly reproduced by the null model .",
    "the entity of the deviations of the real network from the null model depends on the particular example considered , and the characterization of these deviations is precisely the reason why a method to sample random networks from the appropriate ensemble is needed in the first place . in the bottom panels of fig .",
    "[ bun_top2 ] we compare the observed value of two quantities of interest with their arithmetic mean over the sample .",
    "the two quantities are the average nearest neighbors degree ( annd ) , @xmath74 , and the clustering coefficient , @xmath75 of each vertex .",
    "note that , since our sampling method is unbiased , the arithmetic mean over the sample automatically weighs the configurations according to their correct probability . in this particular case , we find that the null model reproduces the observed network very well , which means that the degree sequence effectively explains ( or rather generates ) the two empirical higher - order patterns that we have considered . this is consistent with other studies @xcite , but not true in general for other networks or other constraints , as we show later on . from the bottom panels of fig .",
    "[ bun_top2 ] we also note that the confidence intervals highlight a non - obvious feature : the fact that the few points further away from the identity line turn out to be actually within ( or at the border of ) the chosen confidence intervals , while several points closer to the identity are instead found to be much more distant from the confidence intervals , and thus in an unexpectedly stronger disagreement with the null model .",
    "these counter - intuitive insights can not be derived from the analysis of the expected values alone , e.g. using expressions like eq . or similar .",
    "we now calculate the fluctuations of the constraints explicitly .",
    "we start by calculating the ensemble variance of each degree @xmath25 , defined as @xmath76\\equiv\\langle k_i^2\\rangle-\\langle k_i\\rangle^2 $ ] . in the microcanonical ensemble ,",
    "one obviously has @xmath76=0 $ ] . in the canonical ensemble",
    ", the independence of pairs of nodes implies that the variance of the sum @xmath77 coincides with the sum of the variances of its terms , i.e. @xmath78&=&\\sum_{j\\ne i}\\sigma^2[a_{ij}]=\\sum_{j\\ne i}(\\langle a^2_{ij}\\rangle-\\langle a_{ij}\\rangle^2)\\nonumber\\\\ & = & \\sum_{j\\ne i}p_{ij}(1-p_{ij})=k_i-\\sum_{j\\ne i}p_{ij}^2.\\label{eq : varubcm}\\end{aligned}\\ ] ] then , the canonical relative fluctuations can be measured in terms of the so - called _ coefficient of variation _ , which we conveniently express in the form @xmath79\\equiv\\frac{\\sigma[k_i]}{k_i}=\\sqrt{\\frac{1}{k_i}-\\frac{\\sum_{j\\ne",
    "i}p_{ij}^2}{(\\sum_{j\\ne i}p_{ij})^2 } } , \\label{eq : fluubcm}\\ ] ] where we have restricted ourselves to the case @xmath80 also implies @xmath81=0 $ ] and leads to an indeterminate form for @xmath82 $ ] .",
    "however this case is uninteresting since each isolated node @xmath18 remains isolated across the entire ensemble ( @xmath83 @xmath84 ) and can be safely removed without loss of generality . ] . a plot of @xmath82 $ ] as a function of @xmath25 for the interbank network considered above is shown in fig .",
    "[ fig : fluubcm ] .",
    "we find that the relative fluctuations vanish for vertices with large degree , while they are very large for vertices with moderate and small degree .",
    "in particular , @xmath82\\approx 1 $ ] when @xmath85 .    in general , we note that the term @xmath86 in eq.([eq : fluubcm ] ) is a _ participation ratio _ , measuring the inverse of the effective number of equally important terms in the sum @xmath87 : in particular , it equals @xmath88 if and only if there is only one nonzero term ( complete concentration ) , while it equals @xmath89 if and only if there are @xmath90 identical terms ( complete homogeneity ) , i.e. @xmath91 for all @xmath92 .",
    "since these are the two extreme bounds for a participation ratio , and since in the case of complete concentration we also have @xmath85 , we conclude that the bounds for @xmath82 $ ] are @xmath93\\le\\sqrt{\\frac{1}{k_i}-\\frac{1}{n-1}}. \\label{eq : boundubcm}\\ ] ] the resulting allowed region for @xmath82 $ ] is the one comprised between the abscissa and the dashed line in fig.[fig : fluubcm ] .",
    "we find that the realized trend is close to the upper bound .",
    "this suggests that the maximum - entropy nature of our algorithm produces almost maximally homogeneous terms in the sum @xmath87 , i.e. no particular subset of vertices is preferred as canditate partners for @xmath18 , the only preference being obviously given ( as a consequence of the explicit form of @xmath23 in terms of @xmath94 and @xmath95 ) to vertices with larger degree .",
    "since the degree distribution of most real - world networks is such that the average degree remains finite even when the size of the network becomes very large , the above results suggest that , unlike most physical systems , the microcanonical and canonical ensembles defined by the ubcm are _ not _ equivalent in the ` thermodynamic ' limit @xmath96 .",
    "while eq.([eq : boundubcm ] ) shows that values closer to the lower bound @xmath82=0 $ ] can be in principle achieved , the maximization of the entropy appears to push the ensemble towards the opposite upper bound where the equivalence of the microcanonical and canonical ensembles is maximally violated .",
    "on the other hand , one might in principle construct synthetic networks with sufficiently large degrees , such that the canonical fluctuations are arbitrarily small and the two ensembles arbitrarily close .",
    "$ ] as a function of the degree @xmath25 for each node of the binary network of liquidity reserves exchanges between italian banks in 1999 @xcite ( @xmath4 = 215 ) .",
    "the blue points are the exact values in eq.([eq : fluubcm ] ) , while the dashed curve is the upper bound in eq.([eq : boundubcm ] ) .",
    "the lower bound is the abscissa @xmath82=0$].,scaledwidth=48.0% ]      for binary directed networks ( bdns ) , the adjacency matrix @xmath16 is ( in general ) not symmetric , and each node @xmath18 is characterized by two degrees : the out - degree @xmath97 and the in - degree @xmath98 .",
    "the _ directed binary configuration model _",
    "( dbcm ) , which is the directed version of the ubcm , is defined as the ensemble of bdns with given out - degree sequence @xmath99 and in - degree sequence @xmath100 . at a canonical level",
    ", the dbcm is defined on the ensemble of all bdns with @xmath4 vertices and a number of links ranging from 0 to @xmath101 .",
    "equation still applies , but now with `` @xmath102 '' replaced by `` @xmath92 '' and @xmath103 , where the @xmath104 parameters @xmath59 and @xmath105 are determined by either maximizing the log - likelihood function @xcite @xmath106\\nonumber\\\\ & -&\\sum_i\\sum_{j \\neq i } \\ln ( 1+x_iy_j)\\nonumber\\end{aligned}\\ ] ] ( where @xmath53 is the real network ) or , equivalently , by solving the system of @xmath104 equations @xcite @xmath107 the parameters @xmath59 and @xmath105 vary in the region defined by @xmath64 and @xmath108 for all @xmath18 respectively @xcite .",
    "the ensemble can be efficiently sampled by considering each pair of vertices _ twice _ , and using ( say ) @xmath23 and @xmath109 to draw directed links in the two directions ( these two events being statistically independent ) . since this is a straightforward extension of the ubcm , we do not consider any specific example to illustrate the dbcm .",
    "however , the related algorithm has been implemented in the code ( see appendix ) .",
    "we conclude the discussion of this ensemble with the calculation of the canonical fluctuations .",
    "in analogy with eqs.([eq : varubcm ] ) and ( [ eq : fluubcm ] ) , the variances of @xmath110 and @xmath111 are given by @xmath112&= & \\sum_{j \\ne i } p_{ij}(1-p_{ij})=k^{out}_i-\\sum_{j \\ne i } p^2_{ij},\\label{eq : vardbcm1}\\\\ \\sigma^2[k^{in}_{i}]&= & \\sum_{j \\ne i } p_{ji}(1-p_{ji})=k^{in}_i-\\sum_{j \\ne i } p^2_{ji}.\\label{eq : vardbcm2}\\end{aligned}\\ ] ] for @xmath113 and @xmath114 , the relative fluctuations are @xmath115&\\equiv&\\frac{\\sigma[k^{out}_i]}{k^{out}_i}=\\sqrt{\\frac{1}{k^{out}_i}-\\frac{\\sum_{j\\ne i}p_{ij}^2}{(\\sum_{j\\ne i}p_{ij})^2}},\\label{eq : fludbcm1}\\\\ \\delta[k^{in}_i]&\\equiv&\\frac{\\sigma[k^{in}_i]}{k^{in}_i}=\\sqrt{\\frac{1}{k^{in}_i}-\\frac{\\sum_{j\\ne i}p_{ji}^2}{(\\sum_{j\\ne i}p_{ji})^2}}.\\label{eq : fludbcm2}\\end{aligned}\\ ] ] the above quantities still involve participation ratios defined by the connection probabilities . for the bounds of",
    "@xmath116 $ ] and @xmath117 $ ] , considerations similar to those leading to eq.([eq : boundubcm ] ) apply here .",
    "a more constrained null model , the _ reciprocal binary configuration model _ ( rbcm ) , can be defined for bdns by enforcing , in addition to the two directed degree sequences considered above , the whole local reciprocity structure of the network @xcite .",
    "this is equivalence to the specification of the three degree sequences defined as the vector of the numbers of non - reciprocated outgoing links , @xmath118 , the vector of the numbers of non - reciprocated incoming links , @xmath119 , and the vector of the numbers of reciprocated links , @xmath120 @xcite .",
    "these numbers are defined as @xmath121 , @xmath122 , and @xmath123 respectively @xcite .",
    "the rbcm is of crucial importance when analysing higher - order patterns that exist beyond the dyadic level in directed networks .",
    "the most important example is that of _ triadic motifs _",
    "@xcite , i.e. patterns of connectivity ( involving triples of nodes ) that are statistically over- or under - represented with respect to a null model where the observed degree sequences and reciprocity structure are preserved ( i.e. the rbcm ) .",
    "note that in this case no approximate canonical expression similar to eq .",
    "exists , therefore the null model is usually implemented microcanonically using a generalization of the lra that we have discussed in sec .",
    "[ sec : micro ] .",
    "conceptually , this procedure suffers from the same problem of bias as the simpler procedures used to implement the ubcm and the dbcm through the lra @xcite . to our knowledge , in this case",
    "no correction analogous to that proposed in ref .",
    "@xcite has been developed in order to restore uniformity .    in our `` max & sam '' approach , we exploit known analytical results @xcite showing that the probability of each graph @xmath16 in the rbcm is @xmath124 where @xmath125 , @xmath126 , @xmath127 and @xmath128 denote the probabilities of a single ( non - reciprocated ) link from @xmath18 to @xmath19 , a single ( non - reciprocated ) link from @xmath19 to @xmath18 , a double ( reciprocated ) link between @xmath18 and @xmath19 , and no link at all respectively .",
    "the above four possible events are mutually exclusive .",
    "the greatest difference with respect to the dbcm lies in the fact that the two links that can be drawn between the same two nodes are no longer independent .",
    "the @xmath129 unknown parameters , @xmath59 , @xmath105 and @xmath130 , must be determined by either maximizing the log - likelihood @xcite @xmath131   -\\sum_i\\sum_{j < i } \\ln ( 1\\!+\\!x_iy_j\\!+\\!x_jy_i\\!+\\!z_iz_j)\\nonumber\\end{aligned}\\ ] ] or , equivalently , solving the @xmath129 coupled equations @xcite : @xmath132 the parameters @xmath59 , @xmath105 and @xmath130 vary in the region defined by @xmath64 , @xmath108 and @xmath133 for all @xmath18 respectively @xcite .    after the unknown parameters have been found , the four probabilities allow us to sample the ensemble correctly and very easily . in particular , we can consider each pair of vertices @xmath68 _ only once _ and either draw a single link directed from @xmath18 to @xmath19 with probability @xmath134 , draw a single link directed from @xmath19 to @xmath18 with probability @xmath135 , draw two mutual links with probability @xmath136 , or draw no link at all with probability @xmath137 .",
    "note that , despite the increased number of constraints , the computational complexity is still @xmath6 . as for the dbcm , we do not show a specific illustration of the rbcm , but the procedure described above has been fully coded in order to sample the relevant ensemble in a fast and unbiased way ( see appendix ) .",
    "coming to the canonical fluctuations , in this ensemble eqs.([eq : vardbcm1 ] ) and ( [ eq : vardbcm2 ] ) generalize to @xmath138&= & \\sum_{j \\neq i } p^{\\to}_{ij}(1-p^{\\to}_{ij})=k^{\\to}_i-\\sum_{j \\neq i } ( p^{\\to}_{ij})^2,\\label{eq : varrbcm1}\\\\ \\sigma^2[k^{\\gets}_{i}]&= & \\sum_{j \\neq i } p^{\\gets}_{ij}(1-p^{\\gets}_{ij})=k^{\\gets}_i-\\sum_{j \\neq i}(p^{\\gets}_{ij})^2.\\label{eq : varrbcm2}\\\\ \\sigma^2[k^{\\leftrightarrow}_{i}]&= & \\sum_{j \\neq i } p^{\\leftrightarrow}_{ij}(1-p^{\\leftrightarrow}_{ij})=k^{\\leftrightarrow}_i-\\sum_{j \\neq i } ( p^{\\leftrightarrow}_{ij})^2.\\label{eq : varrbcm3}\\end{aligned}\\ ] ] for @xmath139 , @xmath140 and @xmath141 , the relative fluctuations are @xmath142&\\equiv&\\frac{\\sigma[k^{\\to}_i]}{k^{\\to}_i}=\\sqrt{\\frac{1}{k^{\\to}_i}-\\frac{\\sum_{j\\ne i}(p_{ij}^\\to)^2}{(\\sum_{j\\ne i}p_{ij}^\\to)^2}},\\label{eq : flurbcm1}\\\\ \\delta[k^{\\gets}_i]&\\equiv&\\frac{\\sigma[k^{\\gets}_i]}{k^{\\gets}_i}=\\sqrt{\\frac{1}{k^{\\gets}_i}-\\frac{\\sum_{j\\ne i}(p_{ji}^\\gets)^2}{(\\sum_{j\\ne i}p^\\gets_{ji})^2}},\\label{eq : flurbcm2}\\\\ \\delta[k^{\\leftrightarrow}_i]&\\equiv&\\frac{\\sigma[k^{\\leftrightarrow}_i]}{k^{\\leftrightarrow}_i}=\\sqrt{\\frac{1}{k^{\\leftrightarrow}_i}-\\frac{\\sum_{j\\ne i}(p_{ji}^\\leftrightarrow)^2}{(\\sum_{j\\ne i}p^\\leftrightarrow_{ji})^2}}.\\label{eq : flurbcm3}\\end{aligned}\\ ] ]    thus , in all the ensembles considered so far ( which are defined in terms of _ purely binary _ constraints ) , the squared relative fluctuation of each constraint always takes the form of the inverse of the value of the constraint itself , _ minus _ the participation ratio of the corresponding probabilities .",
    "let us now consider weighted undirected networks ( wuns ) .",
    "differently from the binary case , link weights can now range from zero to infinity by ( without loss of generality ) integer steps .",
    "the number of configurations in the canonical ensemble is therefore infinite .",
    "still , enforcing node - specific constraints implies that a proper probability measure can be defined over the ensemble , such that the average value of any network property of interest is finite @xcite . a single graph in the ensemble is now specified by its ( symmetric ) weight matrix @xmath143 , where the entry @xmath27 represents the integer weight of the link connecting nodes @xmath18 and @xmath19 ( @xmath144 means that no link is there ) .",
    "we denote the particular real - world weighted network as @xmath145 .",
    "each vertex is characterized by its _",
    "strength _ @xmath146 representing the weighted analogue of the degree .",
    "the weighted , undirected counterpart of the ubcm is the _ undirected weighted configuration model _ ( uwcm ) .",
    "the constraint defining it is the observed strength sequence , @xmath147 . like its binary analogue , the ubcm",
    "is widely used in order to detect communities and other higher - order patterns in undirected weighted networks .",
    "however , most approaches @xcite incorrectly assume that this model is characterized by eq .",
    ", which is instead only a highly simplified expression @xcite .    in the canonical ensemble ,",
    "the probability of each weighted network @xmath143 is @xcite @xmath148 where now @xmath149 , showing that the weights are drawn from geometric distributions @xcite . as usual ,",
    "the numerical values of the unknown parameters @xmath59 are found by either maximizing the log - likelihood function @xmath150 or solving the system of @xmath4 equations : @xmath151 in both approaches , now the parameters @xmath59 vary in the region defined by the constraint @xmath152 for all @xmath68 @xcite .    in this model , after finding the unknown parameters we can sample the canonical ensemble by drawing , for each pair of vertices @xmath18 and @xmath19 , a link of weight @xmath153 with geometrically distributed probability @xmath154 .",
    "note that this correctly includes the case @xmath144 , occurring with probability @xmath70 , corresponding to the absence of a link .",
    "alternatively , using a procedure similar to that discussed in @xcite , one can start with the disconnected vertices @xmath18 and @xmath19 , draw a first link ( of unit weight ) with bernoulli - distributed probability @xmath23 , and ( only if this event is successful ) place a second unit of weight on the same link , again with probability @xmath23 , and so on until a failure is first encountered . in this way",
    ", only repetitions of elementary bernoulli trials are involved , a feature that can sometimes be convenient for coding purposes ( e.g. if only uniformly random number generators need to be used ) . after all pairs of vertices have been considered and a single weighted network has been sampled , the process can be repeated until the desired number of networks is sampled .            in fig .",
    "[ wun_w2 ] we show an application of this method to the same interbank network considered previously in figs .",
    "[ bun_a2 ] and [ bun_top2 ] , but now using its weighted representation @xcite . in this case",
    "we plot , for increasing numbers of sampled networks , the convergence of the sample average @xmath155 of each edge weight to its exact canonical expectation @xmath156 . as for the example considered for the ubcm , generating 1000 matrices ( bottom right )",
    "turns out to be enough to obtain a high level of accuracy for this network .",
    "this important check is impossible in microcanonical approaches , where there is no knowledge of the exact value of the expected weights .    here",
    "as well , the average of the quantities of interest over the sample can be compared with the observed values . as a preliminary check , the top plot of fig .",
    "[ wun_top2 ] confirms that , for the sample of 1000 matrices , the sample average of the strength of each node coincides with its observed value , and the confidence intervals are very narrow around the identity line . thus the enforced constraints are correctly reproduced .",
    "we can then properly use the uwcm as a null model to detect higher - order patterns in the network .    in the bottom panels of fig .",
    "[ wun_top2 ] we show the average nearest neighbor strength ( anns ) , @xmath157 , and the weighted clustering coefficient , @xmath158 . in this case , in line with previous analyses of different networks @xcite , we find that the uwcm is _ not _ as effective as its binary counterpart in reproducing the observed higher - order properties , as clear from the presence of many outliers in the plots . since our previous checks ensure that the implementation of the null model is correct , we can safely conclude that the divergence between the null model and the real network is not due to an insufficient or incorrect sampling of the ensemble .",
    "rather , it is a genuine signature of the fact that , in this network , the strength sequence alone is not enough in order to replicate higher - order quantities .",
    "so the strength sequence turns out to be less informative ( about the whole weighted network ) than the degree sequence is ( about the binary projection of the same network ) .",
    "we now come to the analysis of the canonical fluctuations .",
    "the ensemble variance of each strength @xmath28 is defined as @xmath159\\equiv\\langle s_i^2\\rangle-\\langle s_i\\rangle^2 $ ] , and the independence of pairs of nodes implies @xmath160&=&\\sum_{j\\ne i}\\sigma^2[w_{ij}]=\\sum_{j\\ne i}(\\langle w^2_{ij}\\rangle-\\langle w_{ij}\\rangle^2)\\nonumber\\\\ & = & \\sum_{j \\ne i } \\frac{p_{ij}}{(1-p_{ij})^2}=\\sum_{j\\ne i}\\langle w_{ij}\\rangle(1+\\langle w_{ij}\\rangle)\\nonumber\\\\ & = & s_i+\\sum_{j\\ne i}\\langle w_{ij}\\rangle^2 .",
    "\\label{eq : varuwcm}\\end{aligned}\\ ] ] therefore the relative fluctuations take the form @xmath161\\equiv\\frac{\\sigma[s_i]}{s_i}=\\sqrt{\\frac{1}{s_i}+\\frac{\\sum_{j\\ne i}\\langle w_{ij}\\rangle^2}{(\\sum_{j\\ne i}\\langle w_{ij}\\rangle)^2 } } \\label{eq : fluuwcm}\\ ] ] for @xmath162 . a plot of @xmath163 $ ] as a function of @xmath28 for the interbank network is shown in fig .",
    "[ fig : fluuwcm ] . unlike in the ubcm , here the relative fluctuations are found to be smaller for intermediate values of the strength .    when comparing eq.([eq : fluuwcm ] ) with eq.([eq : fluubcm ] ) , it is interesting to notice that the term @xmath164 , while still being a participation ratio .",
    "it equals @xmath88 if and only if there is only one nonzero term ( complete concentration , which still implies @xmath165 but _ not _",
    "@xmath166 ) , while it equals @xmath89 if and only if there are @xmath90 identical terms ( complete homogeneity ) , i.e. @xmath167 for all @xmath92 . ]",
    ", is now predeced by a",
    "_ positive _ sign .",
    "this implies that the bounds for @xmath163 $ ] are quite different from those for @xmath82 $ ] shown in eq.([eq : boundubcm ] ) : @xmath168\\le\\sqrt{\\frac{1}{s_i}+1}. \\label{eq : bounduwcm}\\ ] ] the allowed region for @xmath163 $ ] is the one above the dashed line in fig.[fig : fluuwcm ] , and extends beyond 1 .",
    "we now find that the realized trend is very close to the _ lower _ bound for small and intermediate values of the strength ( again suggesting that in this regime our maximum - entropy method produces almost maximally homogeneous terms in the sum @xmath169 ) , while it exceeds the lower bound significantly for large values of the strength . in any case , since eq.([eq : bounduwcm ] ) implies that @xmath163 $ ] can not vanish for any value of @xmath28 , we find evidence of the fact that for this model the microcanonical and canonical ensembles are _ always _ not equivalent .",
    "$ ] as a function of the strength @xmath28 for each node of the binary network of liquidity reserves exchanges between italian banks in 1999 @xcite ( @xmath4 = 215 ) .",
    "the blue points are the exact values in eq.([eq : fluuwcm ] ) , while the dashed curve is the lower bound in eq.([eq : bounduwcm ] ) .",
    "the upper bound exceeds 1 and extends beyond the region shown.,scaledwidth=48.0% ]      we now consider weighted directed networks ( wdns ) , defined by a weight matrix @xmath143 which is in general not symmetric .",
    "each node is now characterized by two strengths , the out - strength @xmath170 and the in - strength @xmath171 .",
    "the _ directed weighted configuration model _ ( dwcm ) , the directed version of the uwcm , enforces the out- and in - strength sequences , @xmath172 and @xmath173 , of a real - world network @xmath145 @xcite .",
    "the model is widely used to detect modules and communities in real wdns @xcite .    in its canonical version ,",
    "the dwcm is still characterized by eq .",
    "where `` @xmath102 '' is replaced by `` @xmath174 '' and now @xmath175 . the @xmath104 unknown parameters @xmath59 and @xmath105 can be fixed by either maximizing the log - likelihood function @xcite @xmath176\\nonumber \\\\ & + & \\sum_i\\sum_{j \\neq i } \\ln ( 1-x_iy_j)\\nonumber\\end{aligned}\\ ] ] or solving the the @xmath104 equations @xcite @xmath177 where in both cases the parameters @xmath59 and @xmath105 vary in the region defined by @xmath178 for all @xmath68 @xcite .    once the unknown variables are found , we can implement an efficient and unbiased sampling scheme in the same way as for the uwcm , but now running over each pair of vertices _ twice _",
    "( i.e. in both directions )",
    ". one can establish the weight of a link from vertex @xmath18 to vertex @xmath19 using the geometric distribution @xmath154 , and the weight of the reverse link from @xmath19 to @xmath18 using the geometric distribution @xmath179 , these two events being independent .",
    "alternatively , as for the undirected case , one can construct these random events as a combination of fundamental bernoulli trials with success probability @xmath23 and @xmath109 . since this directed generalization of the undirected case",
    "is straightforward , we do not consider any explicit application .",
    "however , we have explicitly included the dwcm model in the code ( see appendix ) .",
    "we now come to the canonical fluctuations . in analogy with eq.([eq :",
    "varuwcm ] ) , it is easy to show that the variances of @xmath180 and @xmath181 are given by @xmath182&= &   \\sum_{j\\ne i}\\langle w_{ij}\\rangle(1+\\langle w_{ij}\\rangle)=s^{out}_i+\\sum_{j \\ne i } \\langle w_{ij}\\rangle^2,\\label{eq : vardwcm1}\\\\ \\sigma^2[s^{in}_{i}]&= & \\sum_{j\\ne i}\\langle w_{ji}\\rangle(1+\\langle w_{ji}\\rangle)=s^{in}_i+\\sum_{j \\ne i } \\langle w_{ji}\\rangle^2.\\label{eq : vardwcm2}\\end{aligned}\\ ] ] for @xmath183 and @xmath184 , the relative fluctuations are @xmath185&\\equiv&\\frac{\\sigma[s^{out}_i]}{s^{out}_i}=\\sqrt{\\frac{1}{s^{out}_i}+\\frac{\\sum_{j\\ne i}\\langle w_{ij}\\rangle^2}{(\\sum_{j\\ne",
    "i}\\langle w_{ij}\\rangle)^2}},\\label{eq : fludwcm1}\\\\ \\delta[s^{in}_i]&\\equiv&\\frac{\\sigma[s^{in}_i]}{s^{in}_i}=\\sqrt{\\frac{1}{s^{in}_i}+\\frac{\\sum_{j\\ne i}\\langle w_{ji}\\rangle^2}{(\\sum_{j\\ne i}\\langle w_{ji}\\rangle)^2}}.\\label{eq : fludwcm2}\\end{aligned}\\ ] ] for the bounds of the above quantities , expressions similar to eq.([eq : bounduwcm ] ) apply , suggesting that the microcanonical and canonical versions of this ensemble are also not equivalent .      in analogy with the binary case",
    ", we now consider the _ reciprocal weighted configuration model _ ( rwcm ) , which is a recently proposed null model that for the first time allows one to constrain the reciprocity structure in weighted directed networks @xcite .",
    "the rwcm enforces three strengths for each node : the non - reciprocated incoming strength , @xmath186 , the non - reciprocated outgoing strength , @xmath187 , and the reciprocated strength , @xmath188 @xcite .",
    "such quantities are defined by means of three pair - specific variables : @xmath189 $ ] ( reciprocated weight ) , @xmath190 and @xmath191 ( non - reciprocated weights ) .    despite its complexity",
    ", the rwcm is analytically solvable @xcite and the graph probability factorizes as : @xmath192 \\label{eq : rwcm}\\ ] ] where @xmath193 is the node - pair partition function .",
    "the @xmath129 unknown parameters @xmath59 , @xmath105 and @xmath130 must be determined either by maximizing the log - likelihood function @xmath194 \\!-\\ ! \\sum_i\\sum_{j < i}\\ln z_{ij}(x_i , x_j , y_i , y_j , z_i , z_j)\\nonumber\\end{aligned}\\ ] ] or by solving the @xmath129 equations : @xmath195 here , the parameters @xmath59 , @xmath105 and @xmath130 vary in the region defined by @xmath178 and @xmath196 for all @xmath68 @xcite .",
    "equation shows that pairs of nodes are independent , and that the probability that the nodes @xmath18 and @xmath19 are connected via a combination of weighted edges of the form @xmath197 is @xmath198 $ ] ( where , as usual , all the parameters are intended to be the ones maximizing the likelihood ) . also , note that @xmath199 and @xmath200 can not be both nonzero , but they are independent of @xmath201 ( the joint distribution of these three quantities shown above is not simply a multivariate geometric distribution ) .",
    "the above observations allow us to define an unbiased sampling scheme , even if more complicated than the ones described so far . for each pair of nodes",
    "@xmath68 , we define a procedure in three steps . first , we draw the reciprocal weight @xmath201 from the geometric distribution @xmath202 ( or equivalently , from the composition of bernoulli distributions as discussed for the uwcm ) .",
    "second , we focus on the _ mere existence _ of non - reciprocated weights ( irrespective of their magnitude ) .",
    "we randomly select one of these three ( mutually excluding ) events : we establish the absence of any non - reciprocated weight between @xmath18 and @xmath19 ( @xmath203 , @xmath204 ) with probability @xmath205 , we establish the existence of a non - reciprocated weight from @xmath18 to @xmath19 ( @xmath206 , @xmath204 ) with probability @xmath207 , we establish the existence of a non - reciprocated weight from @xmath19 to @xmath18 ( @xmath203 , @xmath208 ) with probability @xmath209 .",
    "third , if a non - reciprocated connection has been established ( i.e. if its weight @xmath153 is positive ) we then focus on the value to be assigned to it ( i.e. on the extra weight @xmath210 ) .",
    "if @xmath206 , we draw the weight @xmath200 from a geometric distribution @xmath211 ( shifted to strictly positive integer values of @xmath200 via the rescaled exponent ) , while if @xmath208 we draw the weight @xmath199 from the distribution @xmath212 .",
    "the recipe described above is still of complexity @xmath6 and allows us to sample the canonical ensemble of the rwcm in an unbiased and efficient way .",
    "it should be noted that the microcanonical analogue of this algorithm has not been proposed so far . as for the dwcm",
    ", we show no explicit application , even if the entire algorithm is available in our code ( see appendix ) .    in this model ,",
    "the canonical fluctuations are somewhat more compicated than in the previous models .",
    "the variances of the constraints are @xmath213 & = & \\sum_{j \\ne i } \\frac{x_iy_j(1-x_jy_i)(1-x_i^2x_jy_iy_j^2)}{(1-x_iy_j)^2(1-x_ix_jy_iy_j)^2},\\\\ \\sigma^2[s_i^\\leftarrow ] & = & \\sum_{j \\ne i } \\frac{x_jy_i(1-x_iy_j)(1-x_ix_j^2y_i^2y_j)}{(1-x_jy_i)^2(1-x_ix_jy_iy_j)^2}\\\\ \\sigma^2[s_i^\\leftrightarrow ] & = & \\sum_{j \\ne i } \\frac{z_{i}z_{j}}{(1-z_{i}z_{j})^2}.\\end{aligned}\\ ] ] while for the variance of the reciprocated weight we can still write @xmath214=\\langle w^\\leftrightarrow_{ij}\\rangle(1+\\langle w^\\leftrightarrow_{ij}\\rangle)$ ] in analogy with the uwcm and dwcm , similar relations do not hold for the non - reciprocated weights .",
    "however , since @xmath215 for all @xmath68 , it is easy to show that @xmath216>\\langle w^\\rightarrow_{ij}\\rangle(1+\\langle w^\\rightarrow_{ij}\\rangle)$ ] and @xmath217>\\langle w^\\leftarrow_{ij}\\rangle(1+\\langle w^\\leftarrow_{ij}\\rangle)$ ] . this still allows us to obtain a lower bound for all quantities as in the other weighted models , by using @xmath218 & > & \\sum_{j \\neq i } \\langle w^{\\rightarrow}_{ij}\\rangle(1+\\langle w^{\\rightarrow}_{ij}\\rangle)=s^{\\rightarrow}_i+\\sum_{j \\neq i } \\langle w^{\\rightarrow}_{ij}\\rangle^2,\\label{eq : varrwcm1}\\\\ \\sigma^2[s^{\\gets}_{i } ] & > & \\sum_{j \\neq i } \\langle w^{\\leftarrow}_{ij}\\rangle(1+\\langle w^{\\leftarrow}_{ij}\\rangle)=s^{\\leftarrow}_i+\\sum_{j \\neq i } \\langle w^{\\leftarrow}_{ij}\\rangle^2,\\label{eq : varrwcm2}\\\\ \\sigma^2[s^{\\leftrightarrow}_{i}]&= & \\sum_{j \\neq i } \\langle w^{\\leftrightarrow}_{ij}\\rangle(1+\\langle w^{\\leftrightarrow}_{ij}\\rangle)=s^{\\leftrightarrow}_i+\\sum_{j \\neq i } \\langle w^{\\leftrightarrow}_{ij}\\rangle^2 .",
    "\\label{eq : varrwcm3}\\end{aligned}\\ ] ] then , for @xmath219 , @xmath220 and @xmath221 , we get @xmath222&\\equiv&\\frac{\\sigma[s^{\\rightarrow}_i]}{s^{\\rightarrow}_i}>\\sqrt{\\frac{1}{s^{\\rightarrow}_i}+\\frac{\\sum_{j\\ne i}\\langle w^{\\rightarrow}_{ij}\\rangle^2}{(\\sum_{j\\ne i}\\langle w^{\\rightarrow}_{ij}\\rangle)^2}},\\label{eq : flurwcm1}\\\\",
    "\\delta[s^{\\leftarrow}_i]&\\equiv&\\frac{\\sigma[s^{\\leftarrow}_i]}{s^{\\leftarrow}_i}>\\sqrt{\\frac{1}{s^{\\leftarrow}_i}+\\frac{\\sum_{j\\ne i}\\langle w^{\\leftarrow}_{ij}\\rangle^2}{(\\sum_{j\\ne i}\\langle w^{\\leftarrow}_{ij}\\rangle)^2}},\\label{eq : flurwcm2}\\\\ \\delta[s^{\\leftrightarrow}_i]&\\equiv&\\frac{\\sigma[s^{\\leftrightarrow}_i]}{s^{\\leftrightarrow}_i}=\\sqrt{\\frac{1}{s^{\\leftrightarrow}_i}+\\frac{\\sum_{j\\ne i}\\langle w^{\\leftrightarrow}_{ij}\\rangle^2}{(\\sum_{j\\ne i}\\langle w^{\\leftrightarrow}_{ij}\\rangle)^2}}.\\label{eq : flurwcm3}\\end{aligned}\\ ] ] therefore , for all three quantities , a lower bound of the form @xmath163\\ge \\sqrt{\\frac{1}{s_i}+\\frac{1}{n-1}}$ ] still applies , as in eq.([eq : bounduwcm ] ) .",
    "this suggests that , for this model as well , the microcanonical and canonical ensembles are not equivalent .",
    "we finally consider a ` mixed ' null model of weighted networks with both binary ( degree sequence @xmath54 ) and weighted ( strength sequence @xmath147 ) constraints .",
    "we only consider undirected networks for simplicity , but the extension to the directed case is straightforward .",
    "the ensemble of weighted undirected networks with given strengths and degrees has been recently introduced as the _ ( undirected ) enhanced configuration model _ ( uecm ) @xcite .",
    "this model , which is based on analytical results derived in @xcite , is of great importance for the problem of _ network reconstruction _ from partial node - specific information @xcite . as we have also illustrated in fig.[wun_top2 ] , the knowledge of the strength sequence alone is in general not enough in order to reproduce the higher - order properties of a real - world weighted network @xcite . usually , this is due to the fact that the expected topology is much denser than the observed one ( often the expected network is almost fully connected ) .",
    "by contrast , it turns out that the simultaneous specification of strengths and degrees , by constraining the local connectivity to be consistent with the observed one , allows a dramatically improved reconstruction of the higher - order structure of the original weighted network @xcite .",
    "this very promising result calls for an efficient implementation of the uecm .",
    "we now describe an appropriate sampling procedure .",
    "the probability distribution characterizing the uecm is halfway between a bernoulli ( fermi - like ) and a geometric ( bose - like ) distribution @xcite , and reads @xmath223 .",
    "\\label{eq_mix}\\ ] ] as usual , the @xmath104 unknown parameters must be determined either by maximizing the log - likelihood function @xmath224\\nonumber\\\\ & + & \\sum_{i}\\sum_{j",
    "< i } \\ln \\frac{1-y_iy_j}{(1-y_iy_j + x_ix_jy_iy_j)}\\end{aligned}\\ ] ] or by solving the @xmath104 equations @xcite : @xmath225 where @xmath226 . here",
    ", the parameters @xmath59 and @xmath105 vary in the region @xmath227 for all @xmath18 and @xmath228 for all @xmath68 respectively @xcite .    in order to define an unbiased sampling scheme",
    ", we note that eq .",
    "highlights the two key ingredients of the uecm , respectively controlling for the probability that a link of any weight exists and , if so , that a specific positive weight is there .",
    "the probability to generate a link of weight @xmath153 between the nodes @xmath18 and @xmath19 is @xmath229 the above expression identifies two key steps : the model is equivalent to one where the ` first link ' ( of unit weight ) is extracted from a bernoulli distribution with probability @xmath23 and where the ` extra weight ' ( @xmath230 ) is extracted from a geometric distribution ( shifted to the strictly positive integers ) with parameter @xmath231 .",
    "as all the other examples discussed so far , this algorithm can be easily implemented .    in fig .",
    "[ mix_aw2 ] we provide an application of this method to the world trade web @xcite .",
    "we show the convergence of the sample averages ( @xmath72 and @xmath155 ) of the entries of both binary and weighted adjacency matrices to their exact canonical expectations ( @xmath73 and @xmath156 respectively ) . as in the previous cases ,",
    "generating 1000 matrices is enough to guarantee a tight convergence of the sample averages to their exact values ( in any case , this accuracy can be quantified and improved by sampling more matrices ) .    for this sample of 1000 matrices , in the top plots ( two in this case ) of fig .",
    "[ mix_top2 ] we confirm that both the binary and weighted constraints are well reproduced by the sample averages .",
    "when we use this null model to check for higher - order patterns in this network , we find that two important topological quantities of interest ( annd and anns , bottom panels of fig .",
    "[ mix_top2 ] ) are well replicated by the model .",
    "these results are consistent with what is obtained analytically by using the same canonical null model on the same network @xcite . moreover , in this case we can calculate confidence intervals besides expected values ( for instance , in fig .",
    "[ mix_top2 ] we can clearly identify outliers that are otherwise undetected ) , and do this for any desired topological property , not only those whose expected value is analytically computable .",
    "our method therefore represents an improved algorithm for the unbiased reconstruction of weighted networks from strengths and degrees @xcite .",
    "the canonical fluctuations in this ensemble can be also calculated analytically . for the variance of the degrees",
    ", we can still exploit the expression @xmath232=p_{ij}(1-p_{ij})$ ] . for the variance of the strengths",
    ", we can use the definition @xmath233=\\langle w_{ij}^2\\rangle-\\langle w_{ij}\\rangle^2 $ ] , which however leads to a more complicated expression in this case . using the relation @xmath234 , the end result can be expressed as follows : @xmath78 & = & \\sum_{j \\ne i } p_{ij}(1-p_{ij}),\\\\ \\sigma^2[s_i ] & = & \\sum_{j\\ne i}\\frac{p_{ij}(1+y_{i}y_{j}-p_{ij})}{(1-y_{i}y_{j})^2}\\nonumber\\\\ & = & \\sum_{j \\ne i } \\langle w_{ij}\\rangle\\left(\\frac{1+y_iy_j}{1-y_iy_j}-\\langle{w_{ij}}\\rangle\\right).\\end{aligned}\\ ] ] since @xmath235 , we can obtain the following relations for the relative fluctuations : @xmath236&\\equiv&\\frac{\\sigma[k_i]}{k_i}=\\sqrt{\\frac{1}{k_i}-\\frac{\\sum_{j\\ne i}p_{ij}^2}{(\\sum_{j\\ne i}p_{ij})^2}},\\label{eq : fluuecm1}\\\\ \\delta[s_i]&\\equiv&\\frac{\\sigma[s_i]}{s_i}\\ge\\sqrt{\\frac{1}{s_i}-\\frac{\\sum_{j\\ne i}\\langle{w_{ij}}\\rangle^2}{(\\sum_{j\\ne i}\\langle{w_{ij}}\\rangle)^2}}.\\label{eq : fluuecm2}\\end{aligned}\\ ] ] so @xmath82 $ ] retains the same expression valid for the ubcm and all the other ensembles of binary graphs considered previously , which in turn leads to the same bounds as in eq.([eq : boundubcm ] ) .",
    "this is confirmed in fig.[fig : fluuecm ] . by contrast , @xmath163 $ ] has a more complicated form , which differs from that valid for the uwcm and does not lead to simple expressions for the upper and lower bounds .",
    "also note the presence of a _ minus _ sign in eq.([eq : fluuecm2 ] ) .",
    "what can be concluded relatively easily is that , in the ideal limit @xmath237 ( corresponding to very small values of @xmath28 ) , we have @xmath238 which implies @xmath239 and @xmath163\\to \\delta[k_i]$ ] .",
    "this means that , in this extreme ( and typically unrealized ) limit , @xmath163 $ ] behaves as @xmath82 $ ] , so it has the same upper bound @xmath240 .",
    "however , since @xmath241 is typically larger than zero , this bound is systematically exceeded , especially for large values of @xmath28 .",
    "this is also confirmed in fig.[fig : fluuecm ] . as in the other models ,",
    "the non - vanishing of the fluctuations suggests that the microcanonical and canonical ensembles are not equivalent .",
    "in this section we come back to the difference between canonical and microcanonical approaches to the sampling of network ensembles and discuss how , at least in principle , our method can be turned into an unbiased microcanonical one .",
    "we provided evidence that , for all the models considered in this paper , the canonical and microcanonical ensembles are _ not _ equivalent ( see also @xcite for a recent mathematical proof of nonequivalence for the ubcm ) .",
    "this result implies that choosing between microcanonical and canonical approaches to the sampling of network ensembles is not only a matter of ( computational ) convenience , but also a theoretical issue that should be addressed more formally .    to this end",
    ", we recall that microcanonical ensembles describe isolated systems that do not interact with an external ` heat bath ' or ` reservoir ' . in ordinary statistical physics",
    ", this means that there is no exchange of energy with the external world . in our setting",
    ", this means that microcanonical approaches do not contemplate the possibility that the network interacts with some external ` source of error ' , i.e. that the value of the enforced constraints might be affected by errors or missing entries in the data .",
    "when present , such errors ( e.g. a missing link , implying a wrong value of the degree of two nodes ) are propagated to the entire collection of randomized networks , with the result that the ` correct ' network is not included in the microcanonical collection of graphs on which inference is being made .    by contrast , besides being unbiased and mathematically tractable , our canonical approach is also the most appropriate choice if one wants to account for possible errors in the data , since canonical ensembles appropriately describe systems in contact with an external reservoir ( source of errors ) affecting the value of the constraints .",
    "while in presence of even small errors microcanonical methods assign zero probability to the ` uncorrupted ' configuration and to all the configurations with the same value of the constraints , our method assigns these configurations a probability which is only slightly smaller than the ( maximum ) probability assigned to the set of configurations consistent with the observed ( ` corrupted ' ) one .",
    "these considerations suggest that , given its simplicity , elegance , and ability to deal with potential errors in the data , the use of the canonical ensemble should be preferred to that of the microcanonical one .    nonetheless , it is important to note that , at least in principle , our canonical method can also be used to provide unbiased microcanonical expectations , if theoretical considerations suggest that the microcanonical ensemble is more appropriate in some specific cases .",
    "in fact , if the sampled configurations that do not satisfy the chosen constraints exactly are discarded , what remains is precisely an unbiased ( uniform ) sample of the microcanonical ensemble of networks defined by the same constraints ( now enforced sharply ) .",
    "the sample is uniform because all the microcanonical configurations have the same probability of occurrence in the canonical ensemble ( since all probabilities , as we have shown , depend only on the value of the realized constraints ) . the same kind of analysis presented in this paper can then be repeated to obtain the microcanonical expectations . in the rest of this section , we discuss some advantages and limitations of this approach .    as a guiding principle",
    ", one should bear in mind that , to be feasible , a microcanonical sampling based on our method requires that the number @xmath242 of canonical realizations to be sampled ( among which only a number @xmath243 of microcanonical ones will be selected ) is not too large , especially because for each canonical realization one must ( in the worst - case scenario ) do @xmath244 checks to ensure that each constraint matches the observed value exactly ( the actual number is smaller , since all the checks after the first unsuccessful one can be aborted ) .",
    "we first discuss the relation between @xmath242 and @xmath245 .",
    "let @xmath246 denote a generic graph ( either binary or weighted ) in the canonical ensemble , and @xmath247 the observed network that needs to be randomized .",
    "let @xmath248 formally denote a generic vector of chosen constraints , and let @xmath249 indicate the observed values of such constraints .",
    "similarly , let @xmath250 denote the generic vector of lagrange multipliers ( hidden variables ) associated with @xmath248 , and let @xmath251 indicate the vector of their likelihood - maximizing values enforcing the constraints @xmath252 . on average , out of @xmath242 canonical realizations",
    ", we will be left with a number @xmath253 of microcanonical realizations , where @xmath254 is the probability to pick a graph in the canonical ensemble that matches the constraints @xmath252 exactly .",
    "this probability reads @xmath255 where @xmath256 is the probability of graph @xmath246 in the canonical ensemble , and @xmath257 is the number of microcanonical networks matching the constraints @xmath252 exactly ( i.e. the number of graphs with given @xmath252 ) . inserting eq . into eq . and inverting , we find that the value of @xmath242 required to distill @xmath245 microcanonical graphs is @xmath258    note that @xmath259 is nothing but the maximized likelihood of the observed network , which is automatically measured in our method .",
    "this is typically an extremely small number : for the networks in our analysis , it ranges between @xmath260 ( world trade web ) and @xmath261 ( binary interbank network ) . on the other hand ,",
    "the number @xmath257 is very large ( compensating the small value of the likelihood ) but unknown in the general case : enumerating all graphs with given ( sharp ) properties is an open problem in combinatorics , and asymptotic estimates are available only under certain assumptions .",
    "this means that it is difficult to get a general estimate of the minimum number @xmath242 of canonical realizations required to distill a desired number @xmath245 of microcanonical graphs .",
    "another criterion can be obtained by estimating the number @xmath242 of canonical realizations such that the microcanonical subset samples a desired _ fraction _ @xmath262 ( rather than a desired _ number _",
    "@xmath245 ) of all the @xmath257 microcanonical graphs . in this case",
    ", the knowledge of @xmath257 becomes unnecessary : from the definition of @xmath262 we get @xmath263 the above formula shows that , if we want to sample a number @xmath245 of microcanonical realizations that span a fraction @xmath262 of the microcanonical ensemble , we need to sample a number @xmath264 of canonical realizations and discard all the non - microcanonical ones .",
    "this number can be extremely large , since @xmath259 is very small , as we have already noticed . on the other hand , @xmath262 can be chosen to be very small as well . to see this ,",
    "let us for instance compare @xmath262 with the corresponding fraction @xmath265 of _ canonical _ configurations sampled by @xmath242 realizations , where @xmath266 is the number of graphs in the canonical ensemble .",
    "for all networks we considered in this paper , we showed that @xmath267 realizations were enough to generate a good sample .",
    "this however corresponds to an extremely small value of @xmath268 .",
    "for instance , for the binary interbank network we have @xmath269 .",
    "we might therefore be tempted to choose the same small value also for @xmath262 , and find the required number @xmath242 from eq . . however , the result is a value @xmath270 ( in the mentioned example , @xmath271 ) , which clearly indicates that setting @xmath272 ( where @xmath268 is an acceptable canonical fraction ) is inappropriate .",
    "in general , @xmath262 should be much larger than @xmath268 .",
    "importantly , we can show that , given a value @xmath273 that generates a good canonical sample , the subset of the @xmath245 microcanonical relations contained in the @xmath242 canonical ones spans a fraction @xmath262 of the microcanonical ensemble that is indeed much larger than @xmath268 . to see this , note that @xmath259 , being obtained with the introduction of the constraints @xmath252 , is necessarily much larger than the completely uniform probability @xmath274 over the canonical ensemble ( corresponding to the absence of constraints ) .",
    "this inequality implies that , if we compare @xmath268 with @xmath262 ( both obtained with the same value of @xmath242 ) , we find that @xmath275 the above expression shows that , even if only @xmath245 out of the ( many more ) @xmath242 canonical realizations belong to the microcanonical ensemble , the resulting microcanonical sampled fraction @xmath262 is still much larger than the corresponding canonical fraction @xmath268 .",
    "this non - obvious result implies that , in order to sample a microcanonical fraction that is much larger than the canonical fraction obtained with a given value of @xmath242 , one does not need to increase the number of canonical realizations beyond @xmath242 .",
    "the above considerations suggest that , under appropriate conditions , using our `` max & sam '' method to sample the microcanonical ensemble might be competitive with the available microcanonical algorithms .",
    "it should be noted that the value of @xmath242 affects neither the preliminary search for the hidden variables @xmath251 , nor the calculation of the microcanonical averages over the @xmath245 final networks .",
    "however , it does affect the number of checks one has to make on the constraints to select the microcanonical networks .",
    "the worst - case total number of checks is @xmath276 , and performing such operation in a non - optimized way might slow down the algorithm considerably . a good strategy would be that of exploiting our analysis of the canonical fluctuations to identify the vertices for which it is more unlikely that the local constraint is matched exactly , and check these vertices first .",
    "this would allow one to identify , for each of the @xmath242 canonical realizations , the constraint - violating nodes at the earliest possible stage , and thus to abort the following checks for that particular network .",
    "implementing such an optimized microcanonical algorithm is however beyond the scope of this paper .",
    "the definition and correct implementation of null models is a crucial issue in network analysis . when applied to real - world networks ( that are generally strongly heterogeneous )",
    ", the existing algorithms to enforce simple constraints on binary graphs become biased or time - consuming , and in any case difficult to extend to networks of different type ( e.g. weighted or directed ) and to more general constraints .",
    "we have proposed a fast and unbiased `` max & sam '' method to sample several canonical ensembles of networks with various constraints .",
    "while canonical ensembles are believed to represent a mathematically tractable counterpart of microcanonical ones , they have not been used so far as a tool to sample networks with soft constraints , mainly because of the use of approximated expressions that result in ill - defined sampling probabilities . here",
    ", we have shown that it is indeed possible to use exact expressions to correctly sample a number of canonical ensembles , from the standard case of binary graphs with given degree sequence to the more challenging models of directed and weighted graphs with given reciprocity structure or joint strength - degree sequence .",
    "moreover , we have provided evidence that microcanonical and canonical ensembles of graphs with local constraints are not equivalent , and suggested that canonical ones can account for possible errors or missing entries in the data , while microcanonical ones do not .",
    "our algorithms are unbiased and efficient , as their computational complexity is @xmath6 even for strongly heterogeneous networks .",
    "canonical sampling algorithms may therefore represent an unbiased , fast , and more flexible alternative to their microcanonical counterparts .",
    "we have also illustrated the possibility to obtain an unbiased microcanonical method by discarding the realizations that do not match the constraints exactly . in our opinion",
    ", these findings might suggest new possibilities of exploitation of canonical ensembles as a solution to the problem of biased sampling in many other fields besides network science .",
    "an algorithm has been coded in various ways @xcite in order to implement our sampling procedure for all the seven null models described in sec . [",
    "sec : maxsam ] . in",
    "what follows , we describe the matlab implementation @xcite .",
    "a more detailed explanation accompanies the code in the form of a `` read_me '' file @xcite .",
    "here we briefly mention the main features .    the code can be implemented by typing a command having the typical form of a matlab function , taking a number of different parameters as input .",
    "the output of the algorithm is the numerical value of the _ hidden variables _ , i.e. the vectors @xmath59 , @xmath105 and @xmath130 ( where applicable ) maximizing the likelihood of the desired null model ( see sec .",
    "[ sec : maxsam ] ) , plus a specifiable number of sampled matrices .",
    "the hidden variables alone allow the user to numerically compute the expected values of the adjacency matrix entries ( @xmath277 and @xmath156 ) , as well as the expected value of the constraints ( as a check of its consistency with the observed value ) , according to the specific definition of each model . moreover ,",
    "the user can obtain as output any number of matrices ( networks ) sampled from the desired ensemble .",
    "these matrices are sampled in an unbiased way from the canonical ensemble corresponding to the chosen null model , using the relevant random variables as described in sec .",
    "[ sec : maxsam ] .        * * ubcm * for the undirected binary configuration model , preserving the degree sequence ( @xmath54 ) of an undirected binary network @xmath53 ( see sec . [",
    "sec : ubcm ] ) ; * * dbcm * for the directed binary configuration model , preserving the in- and out - degree sequences ( @xmath100 and @xmath278 ) of a directed binary network @xmath53 ( see sec . [",
    "sec : dbcm ] ) ; * * rbcm * for the reciprocal binary configuration model , preserving the reciprocated , incoming non - reciprocated and outgoing non - reciprocated degree sequences ( @xmath120 , @xmath119 and @xmath279 ) of a directed binary network @xmath53 ( see sec . [",
    "sec : rbcm ] ) ; * * uwcm * for the undirected weighted configuration model , preserving the strength sequence ( @xmath147 ) of an undirected weighted network @xmath145 ( see sec . [",
    "sec : uwcm ] ) ; * * dwcm * for the directed weighted configuration model , preserving the in- and out - strength sequences ( @xmath280 and @xmath172 ) of a directed weighted network @xmath145 ( see sec . [",
    "sec : dwcm ] ) ; * * rwcm * for the reciprocal weighted configuration model , preserving the the reciprocated , incoming non - reciprocated and outgoing non - reciprocated strength sequences ( @xmath281 , @xmath282 and @xmath283 ) of a directed weighted network @xmath145 ( see sec .",
    "[ sec : rwcm ] ) ; * * uecm * for the undirected enhnaced configuration model , preserving both the degree and strength sequences ( @xmath54 and @xmath147 ) of an undirected weighted network @xmath145 ( see sec .",
    "[ sec : uecm ] ) .",
    "* ` matrix ` for a ( binary or weighted ) matrix representation of the data , i.e. if the entire adjacency matrix is available ; * ` list ` for an edge - list representation of the data ,",
    "i.e. a @xmath284 matrix ( @xmath285 being the number of links ) with the first column listing the starting node , the second column listing the ending node and the third column listing the weight ( if available ) of the corresponding link ; * ` par ` when only the constraints sequences ( degrees , strengths , etc . ) are available .    in any case , the two options that are not selected are left empty , i.e. their value should be `` * * [ ] * * '' .",
    "we stress that the likelihood maximization procedure ( or the solution of the corresponding system of equations making the gradient of the likelihood vanish ) , which is the core of the algorithm , only needs the observed values of the chosen constraints to be implemented .",
    "however , since different representations of the system are available , we have chosen to exploit them all and to let the user choose the most appropriate to the specific case .",
    "for instance , in network reconstruction problems @xcite one generally has empirical access only to the local properties ( degree and/or strength ) of each node , and the full adjacency matrix is unknown .",
    "the fifth parameter ( ` eps ` ) controls for the maximum allowed relative error between the observed and the expected value of the constraints .",
    "according to this parameter , the code solves the entropy - maximization problem by either just maximizing the likelihood function or also improving this first outcome solution by further solving the associated system . even if this choice might strongly depend on the observed data , the value @xmath286 works satisfactorily in most cases .",
    "the sixth parameter ( ` sam ` ) is a boolean variable allowing the user to extract the desired number of matrices from the chosen ensemble ( using the probabilities @xmath23 ) .",
    "the value `` 0 '' corresponds to no sampling : with this choice , the code gives only the hidden variables as output .",
    "if the user enters `` 1 '' as input value , the algorithm will ask him / her to enter the number of desired matrices ( after the hidden variables have been found ) . in this case",
    ", the code outputs both the hidden variables and the sampled matrices , the latter in a ` .mat ` file called ` sampling.mat ` .    the seventh parameter ( ` x0new ` ) is optional and has been introduced to further refine the solution of the uecm @xcite in the very specific case of networks having , at the same time , big outliers in the strength distribution and a narrow degree distribution . in this case , the optional argument ` x0new ` can be inputed with the previously obtained output : in so doing , the code will solve the system again , by using the previous solution as initial point .",
    "this procedure can be iterated until the desired precision is reached .",
    "note that , since ` x0new ` is an _",
    "parameter , it is not required to enter `` * * [ ] * * '' when the user does not need it ( differently e.g. from the data format case ) .",
    "dg acknowledges support from the dutch econophysics foundation ( stichting econophysics , leiden , the netherlands ) with funds from beneficiaries of duyfken trading knowledge bv , amsterdam , the netherlands .",
    "this work was also supported by the eu project multiplex ( contract 317532 ) and the netherlands organization for scientific research ( nwo / ocw ) ."
  ],
  "abstract_text": [
    "<S> sampling random graphs with given properties is a key step in the analysis of networks , as random ensembles represent basic null models required to identify patterns such as communities and motifs . </S>",
    "<S> an important requirement is that the sampling process is unbiased and efficient . </S>",
    "<S> the main approaches are microcanonical , i.e. they sample graphs that match the enforced constraints exactly . unfortunately , when applied to strongly heterogeneous networks ( like most real - world examples ) , the majority of these approaches become biased and/or time - consuming </S>",
    "<S> . moreover , the algorithms defined in the simplest cases , such as binary graphs with given degrees , are not easily generalizable to more complicated ensembles . here </S>",
    "<S> we propose a solution to the problem via the introduction of a `` maximize and sample '' ( `` max & sam '' for short ) method to correctly sample ensembles of networks where the constraints are ` soft ' , i.e. realized as ensemble averages . </S>",
    "<S> our method is based on exact maximum - entropy distributions and is therefore unbiased by construction , even for strongly heterogeneous networks . </S>",
    "<S> it is also more computationally efficient than most microcanonical alternatives . </S>",
    "<S> finally , it works for both binary and weighted networks with a variety of constraints , including combined degree - strength sequences and full reciprocity structure , for which no alternative method exists . </S>",
    "<S> our canonical approach can in principle be turned into an unbiased microcanonical one , via a restriction to the relevant subset . </S>",
    "<S> importantly , the analysis of the fluctuations of the constraints suggests that the microcanonical and canonical versions of all the ensembles considered here are not equivalent . </S>",
    "<S> we show various real - world applications and provide a code implementing all our algorithms . </S>"
  ]
}