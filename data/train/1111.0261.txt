{
  "article_text": [
    "molecular dynamics simulations are widely used in materials science , chemistry and molecular biology .",
    "unfortunately , the most accurate molecular dynamics methods that are based on self - consistent field ( scf ) theory @xcite are often limited by some fundamental shortcomings such as a very high computational cost or unbalanced phase space trajectories with unphysical hysteresis effects , numerical instabilities and a systematic long - term energy drift @xcite .",
    "recently an extended lagrangian framework for first principles molecular dynamics simulations was proposed that overcomes most of the previous problems @xcite .",
    "the new framework was originally designed for ground state born - oppenheimer molecular dynamics simulations based on hartree - fock @xcite or density functional theory @xcite at _ zero _ electronic temperatures . in this paper",
    "we supplement previous work by proposing extended free energy lagrangians for first principles molecular dynamics simulations also at _ finite _ electronic temperatures @xcite .",
    "our extended lagrangian free energy dynamics is formulated and demonstrated both for plane - wave pseudopotential and local orbital density matrix based calculations . for the density matrix formulation",
    "our approach is given by a generalization of the original extended lagrangian framework @xcite using a density matrix representation of the electronic degrees of freedom with fractional occupation of the states .",
    "the plane - wave formulation is based on the wave function extended lagrangian molecular dynamics method that recently was proposed by steneteg et al .",
    "@xcite .",
    "first we formulate the extended lagrangian approach to first principles molecular dynamics at finite electronic temperatures for local orbital density matrix representations and thereafter for plane wave pseudopotential calculations . a numerically efficient expression for a generalized pulay force that does not require idempotent density matrices",
    "is demonstrated and a recursive fermi operator expansion algorithm for the density matrix is discussed .",
    "thereafter a verlet integration scheme for the equations of motion is presented .",
    "finally , we illustrate the extended lagrangian free energy dynamics by some examples before giving a brief summary .",
    "the first principles molecular dynamics scheme presented in this paper is a finite electronic temperature generalization of the extended lagrangian framework of time - reversible born - oppenheimer molecular dynamics @xcite . in many ways",
    "the generalization is straightforward , except for an additional entropy term , problems arising in the construction of the density matrix , the calculation of the pulay force for fractional occupations and the phase alignment problem in the integration of the wave functions @xcite .",
    "our two different formulations of extended lagrangian free energy molecular dynamics are based on either an underlying local orbital representation or a plane wave pseudo potential description .",
    "alternative free energy formulations suitable for extended lagrangian self - consistent tight - binding molecular dynamics simulations @xcite will be presented elsewhere .",
    "the time evolution of the system described by @xmath4 is determined by the euler - lagrange equations , @xmath21 which give the equations of motion for the nuclear and electronic degrees of freedom , @xmath22}{\\partial r_k } +      t\\frac{\\partial { \\cal s}[d]}{\\partial r_k } - \\frac{\\mu\\omega^2}{2 }     \\frac{\\partial \\mathrm{tr}[(d - p)^2]}{\\partial r_k } , \\nonumber \\\\ \\\\ \\label{el_b }",
    "\\mu { \\ddot p } & = & \\mu { \\omega^2 } ( d - p).\\end{aligned}\\ ] ] in the limit @xmath23 , we get the decoupled equations @xmath24}{\\partial r_k } + t_e\\frac{\\partial { \\cal s}[d]}{\\partial r_k } , \\\\ \\label{el_2 } { \\ddot p } & = & { \\omega^2 } ( d - p),\\end{aligned}\\ ] ] where the self - consistent density matrix @xmath5 is given from the fermi operator expansion @xmath25^{-1},\\ ] ] under the canonical condition of charge neutrality , @xmath26 = \\mathrm{tr}[{\\widetilde d}s ] = n_{\\rm occ.},\\ ] ] i.e. the chemical potential @xmath27 is set such that the trace of @xmath5 is the number of occupied states . the inverse temperature @xmath28 .",
    "the orthogonalized effective single - particle hamiltonian @xmath29 , i.e. the fockian or kohn - sham hamiltonian , is given by a congruence transformation of the fockian in a non - orthogonal ( atomic orbital ) representation , @xmath30 , where @xmath31 since we use the limit @xmath23 , we recover the regular free energy lagrangain ( without extention ) and the total free energy is a constant of motion that is unaffected by the extended variables @xmath2 and @xmath3 .",
    "this is in contrast to extended lagrangian car - parrinello type molecular dynamics @xcite .",
    "the major advantage of the auxiliary set of variables @xmath2 and @xmath3 occurs in the scf optimization and in the geometric integration of the equations of motion discussed in section iii below .      in plane wave ( pw )",
    "pseudopotential methods it is convenient to propagate both the electronic wave functions , @xmath32 , and the density , @xmath33 . in this case",
    "we define the wave function ( and density ) extended free energy lagrangian @xcite as @xmath34 \\\\\\   ~\\\\     + \\frac{1}{2 } \\mu \\sum_{m}\\int |{\\dot \\phi}_{m}({\\bf r})|^2 d{\\bf r }                - \\frac{1}{2 } \\mu \\omega^2 \\sum_{m}\\int |\\psi^{sc}_{m}({\\bf r } ) -",
    "\\phi_{m}({\\bf r})|^2 d{\\bf r }   \\\\   ~\\\\     + \\frac{1}{2 } \\mu \\int |{\\dot \\rho({\\bf r})}|^2 d{\\bf r }                - \\frac{1}{2 } \\mu \\omega^2 \\int |n^{sc}({\\bf r } ) -",
    "\\rho({\\bf r})|^2 d{\\bf r }      + t_e{\\cal s}[{\\bf f } ] .",
    "\\end{array}\\ ] ] the auxiliary electronic degrees of freedom @xmath35 and @xmath36 are extended through harmonic oscillators centered around the self - consistent ( sc ) ground state wave functions @xmath37 and densities @xmath38 .",
    "as above , @xmath11 is a fictitious electron mass parameter and @xmath12 is a frequency parameter determining the curvature of the harmonic potentials . as for the density matrix extension , the potential @xmath39",
    "$ ] is defined at the self - consistent field ( scf ) electron ground state @xmath38 , at which the free energy functional @xmath40 = u[{\\bf r};n^{\\rm sc}]-t_e{\\cal s}[{\\bf f}],\\ ] ] has its minimum for a given nuclear configuration , @xmath15 , @xcite under the constraints of correct electron occupation , @xmath41 .",
    "the mean field entropy term in @xmath42 is given analogous to eq .",
    "( [ sed ] ) as a function of the occupation numbers , @xmath43 , where @xmath44 = -2 k_b \\sum_i\\left(f_i\\ln(f_i ) + ( 1-f_i)\\ln(1-f_i)\\right),\\ ] ] and @xmath45^{-1}.\\ ] ] here @xmath46 are the eigenvalues of the effective single particle ( kohn - sham ) hamiltonian , i.e. @xmath47 the entropy term @xmath48 $ ] provides a variationally correct energetics and dynamics @xcite where the electron density is given by @xmath49      as for the density matrix extended free energy lagrangian , the dynamics for the wave function extended free energy lagrangian is determined by the euler - lagrange equations , which give the equations of motion for the nuclear and electronic degrees of freedom , @xmath50}{\\partial r_k } + \\\\ & & ~~ { } - \\frac{\\mu\\omega^2}{2 } \\frac{\\partial}{\\partial r_k } \\left(\\sum_{n}\\int |\\psi^{sc}_{n } - \\phi_{n}|^2 d{\\bf r } \\right ) \\nonumber \\\\ & & ~~ { } - \\frac{\\mu\\omega^2}{2 } \\frac{\\partial}{\\partial r_k } \\left(\\int    { \\cal s}[{\\bf f}]}{\\partial r_k } , \\nonumber \\\\ \\label{el_b_pw } & & \\mu { \\ddot \\phi } = \\mu { \\omega^2 } ( \\psi^{\\rm sc } - \\phi ) , \\\\ \\label{el_c_pw } & & \\mu { \\ddot \\rho}({\\bf r } ) = \\mu { \\omega^2 } ( n^{\\rm sc}({\\bf r } ) - \\rho({\\bf r})).\\end{aligned}\\ ] ] in the limit @xmath23 , we get the decoupled equations @xmath51}{\\partial r_k } + t_e\\frac{\\partial { \\cal s}[{\\bf f}]}{\\partial r_k } , \\\\",
    "\\label{el_2_pw } { \\ddot \\psi } & = & { \\omega^2 } ( \\psi^{\\rm sc } - \\phi ) , \\\\",
    "\\label{el_3_pw } { \\ddot \\rho}({\\bf r } ) & = & { \\omega^2 } ( n^{\\rm sc}({\\bf r } ) - \\rho({\\bf r})).\\end{aligned}\\ ] ] also in this case , the total free energy is a constant of motion in the limit @xmath23 . the advantages with the extended equations of motion occur in the scf optimization and geometric integration discussed in section iii .      the nuclear force @xmath52 in eqs .",
    "( [ el_1 ] ) and ( [ el_1_pw ] ) can be partitioned into three separate terms , @xmath53 the first term , @xmath54 , is the hellmann - feynman force term @xcite for a fractional occupation of the states @xcite ( including nuclear - nuclear repulsion ) .",
    "the second term , @xmath55 , corresponds to the pulay force term @xcite , and the third term , @xmath56 is an additional entropy force term .    in a plane wave formulation",
    "the pulay force term usually vanishes , but only at @xmath57 . at finite electronic temperatures",
    "the pulay term is finite even for a constant plane wave basis set representation . in this case",
    "however , the pulay term is exactly cancelled by the entropy force term @xmath58 if the entropy is given by eq .",
    "( [ s_pw ] ) .",
    "this is not true for a local orbital basis set representation . in this case",
    "only a part of the pulay force term @xmath55 is canceled by the entropy contribution @xmath58 @xcite .",
    "nevertheless , this cancellation provides a significant simplification of the pulay term .",
    "the remaining force term can be viewed as a generalized ( @xmath59 ) pulay force @xcite , @xmath60,\\ ] ] which is valid for finite temperature ensembles with non - integer occupation @xcite . for a constant orthonormal plane wave basis set representation",
    "the overlap matrix is equal to the identity matrix , i.e. @xmath61 , and the generalized pulay term disappears .",
    "a similar convenient expression for the pulay force term was recently given by schlegel et al .",
    "@xcite , but without considering any entropy contribution from fractional occupation .",
    "a generalized pulay force was also discussed in connection to the efficient ehrenfest - like molecular dynamics scheme by jakowski and morokuma @xcite . in the present formulation",
    "the electronic entropy is necessary to make our free energy and forces variationally correct in a molecular dynamics simulation with factional occupation of the states at finite electronic temperatures @xcite .",
    "the density matrix or the density that minimizes the free energy functional in eq .",
    "( [ omega ] ) or in eq .",
    "( [ omega_pw ] ) with the particular form of the entropy term in eq .",
    "( [ sed ] ) or in eq .",
    "( [ s_pw ] ) are given by the fermi operator expansion in eq .",
    "( [ fo ] ) or by fermi weighted integration in eq .",
    "( [ density ] ) . if other expressions of the entropy are used , the pulay force expression in eq .",
    "( [ gpforce ] ) may still be valid @xcite , but the density matrix @xmath5 and wave functions will have a fractional occupation distribution of the eigenvalues that is different from the fermi - dirac function .",
    "thanks to the extended lagrangian formulations of free energy molecular dynamics , eqs .",
    "( [ xfe ] ) and ( [ xfe_pw ] ) , it is possible to simultaneously integrate both the nuclear and the electronic degrees of freedom in eqs .",
    "( [ el_1 ] ) and ( [ el_2 ] ) for the density matrix formulation , or eqs .",
    "( [ el_1_pw ] ) and ( [ el_2_pw ] ) for the plane wave extension , with almost any kind of geometric integration scheme developed for celestial or classical molecular dynamics , e.g. the time - reversible verlet algorithm or higher - order symplectic integration methods @xcite .",
    "morevover , the auxiliary degrees of freedom @xmath2 in eq .",
    "( [ xfe ] ) or @xmath35 and @xmath36 in eq .",
    "( [ xfe_pw ] ) will stay close to the free energy ground state @xmath5 or @xmath62 and @xmath38 , since @xmath2 , @xmath35 , and @xmath36 evolve in harmonic potentials centered around @xmath5 , @xmath62 , and @xmath38 .",
    "it is therefore possible to use the extended dynamical variables as an efficient initial guess of @xmath5 , @xmath62 , or @xmath38 , in the iterative scf optimization procedure that minimizes the free energy , i.e. @xmath63,\\\\ ~~ \\nonumber \\\\ \\{\\psi^{\\rm sc } ( t),n^{\\rm sc } ( t)\\ } = { \\rm scf}\\left[{\\bf r};\\phi(t),\\rho(t)\\right ] . \\ ] ] this choice of initial guesses also avoids the fundamental problem of a broken time - reversal symmetry in the propagation of the underlying electronic degrees of freedom @xcite , since the extended dynamical variables can be integrated by a time - reversible algorithm , for example , the verlet scheme @xcite .",
    "this is in contrast to regular born - oppenheimer - like molecular dynamics , where the initial guess of the scf optimization is based on some extrapolation of the self - consistent solutions from previous time steps @xcite , for example @xmath64 ,   \\\\ ~~",
    "\\nonumber \\\\ \\{\\psi^{\\rm sc } ( t),n^{\\rm sc } ( t)\\ } = { \\rm scf}\\left[{\\bf r};\\phi(t-\\delta t),\\rho(t-\\delta t)\\right],\\end{aligned}\\ ] ] which breaks time - reversal symmetry because of the incomplete and non - linear scf optimization .",
    "a broken time - reversal symmetry leads to a hysteresis effect and a systematic drift in the total energy and the phase space @xcite . only by the costly procedure of increasing the scf convergence to a very high degree of accuracy",
    "is it possible to reduce the drift , though it never really disappears .",
    "as will be shown below , our extended lagrangian approach allows for highly efficient and stable free energy molecular dynamics simulations without any significant energy drift .",
    "often only one single scf iteration is sufficient to provide accurate trajectories .    in principle , time - reversibility is not a necessary criterion for long - term energy conservation .",
    "a more fundamental aspect is the conservation of geometric properties of the exact flow of the underlying dynamics as in symplectic integration schemes @xcite .",
    "here we only consider the verlet integration algorithm , which in its velocity formulation is both time - reversible and symplectic .",
    "first we present the integration of the density matrix and thereafter the electron wave function and density integration .",
    "the time - reversible verlet integration @xcite of the density matrix @xmath65 in eq .",
    "( [ el_2 ] ) , @xmath66 that includes a weak external dissipative force that removes the accumulation of numerical noise @xcite , has the following form : @xmath67 in the first @xmath68 initial steps we set @xmath69 , where @xmath70 , and we use a high degree of scf convergence , typically 10 - 15 scf cycles per time step .",
    "the last term on the right hand side of eq .",
    "( [ vrl_damp ] ) is the dissipative force term , which is tuned by some small coupling constant @xmath71 .",
    "this term corresponds to a weak coupling to an external system that removes numerical error fluctuations , but without any significant modification of the microcanonical trajectories and the free energy @xcite .",
    "a few optimized examples of the dimensionless parameter , @xmath72 , the @xmath73 coefficients and @xmath71 are given in table  [ tab_coef ] ( see ref .",
    "@xcite for details ) .",
    "the integration coefficients in table  [ tab_coef ] are optimized under the condition of stability under incomplete , approximate scf convergence",
    ". a larger value of @xmath71 in table  [ tab_coef ] gives more dissipation but also a larger perturbation of the molecular trajectories .",
    "for @xmath74 the scheme is exactly time - reversible and perfectly lossless without any dissipation of numerical errors . in an exactly time - reversible and lossless scheme",
    "small numerical errors may accumulate to large fluctuations during long simulations , which can lead to a loss of numerical stability .",
    "it is particularly important to include dissipation when the numerical noise is large , for example , in reduced complexity calculations utilizing an approximate sparse matrix algebra .",
    ".coefficients for the verlet integration scheme with the external dissipative force term in eq .",
    "( [ vrl_damp ] ) .",
    "the values are derived in ref .",
    "@xcite , which contains a more complete set of coefficients .",
    "[ cols=\"<,<,^,^,^,^,^,^,^,^,^\",options=\"header \" , ]      the verlet integration of the wave functions and the density in eqs .",
    "( [ el_2_pw ] ) and ( [ el_3_pw ] ) , including a weak external dissipative force term that removes a systematic accumulation of numerical noise ( as described above ) has the following form : @xmath75 sine the electronic ground state wave functions , @xmath76 , are unique except with respect to their phase , a straightforward verlet integration of the wave functions may lead to large and uncontrolled errors . to avoid this problem",
    "we have included a subspace alignment through a unitary rotation transform @xmath77 in eq.([verlet_pw ] ) @xcite , where @xmath78 where @xmath79 denotes the frobenius norm .",
    "the rotation @xmath77 that minimizes this distance between @xmath80 and @xmath81 is given by @xmath82 where @xmath83 @xcite .",
    "using this subspace alignment we can use the same coefficients as in the density matrix integration that are given in tab .",
    "[ tab_coef ] .",
    "the density matrix can be calculated from a diagonalization of the effective single - particle hamiltonian , @xmath29 , where @xmath84 here @xmath85 is an orthogonal matrix consisting of the hamiltonian eigenvectors and @xmath86 is a diagonal matrix with the corresponding hamiltonian eigenvalues @xmath87 . by replacing these eigenvalues @xmath87 with the occupation numbers @xmath88 in eq .",
    "( [ occ_nr ] ) , the density matrix is given by @xmath89 because of the cubic scaling of the computational cost as a function of system size , the diagonalization approach is ill - suited for reduced complexity calculations of large extended systems .",
    "in this case we instead propose using recursive fermi operator expansion methods , both at finite and zero electronic temperatures . in plane wave pseudopotential methods usually some form of iterative eigensolvers are used to calculate a subset of the lowest lying eigenfunctions @xcite .",
    "plane wave matrix representations are not sparse and linear scaling of the cost as a function of the number of atoms can in general not be achieved . because of the large number of plane wave basis functions , an explicit construction of the density matrix is difficult and it is only for local atom centered basis set representations for which it is useful to calculate the density matrix",
    ". here we will discuss efficient recursive expansion methods for the construction of the density matrix at finite and zero electronic temperatures .",
    "the recursive fermi operator expansion methods allows for very efficient reduced complexity calculations of large systems if sparse matrix algebra can be used .      the density matrix at finite electronic temperatures used in the calculation of the nuclear and electronic forces , eqs .",
    "( [ el_1 ] ) and ( [ el_2 ] ) , can be constructed by a recursive fermi operator expansion @xcite , @xmath91^{-1 } \\approx { \\cal p}_m({\\cal p}_{m-1}(\\ldots { \\cal p}_0^{(m)}(h)\\ldots ) ) .\\ ] ] there are certainly numerous fairly well established alternative techniques that can incorporate the effects of the electronic distribution at finite temperatures , such as matsubara , green s function , integral representation , chebyshev fermi operator expansion , or continued fraction methods @xcite . however , in contrast to schemes that are based on _ serial _ expansions , the _ recursive _ expansion in eq .",
    "( [ rec ] ) leads to a very high - order approximation in only a few number of iteration steps . here",
    "we will use a recursive fermi operator expansion based on the pad polynomial @xmath92\\ ] ] in eq .",
    "( [ rec ] ) for @xmath93 @xcite .",
    "the problem of finding the chemical potential @xmath27 in eq .",
    "( [ rec ] ) such that the correct occupation is achieved , @xmath94 can be solved by a newton - raphson optimization using the analytic derivative of the density matrix with respect to @xmath27 , @xmath95    the recursive fermi operator expansion of the temperature - dependent density matrix , which automatically finds the chemical potential by a newton - raphson optimization , is given by algorithm  [ fermi_op_exp ] .",
    "the algorithm is a slight modification of the original scheme given in ref .",
    "@xcite and was previously presented in ref .",
    "a full derivation is given for the first time in appendix  [ appendix : recursive_operator_expansion ] .",
    "the main difference to the original algorithm is that the expansion order @xmath96 is independent of the temperature and that the expansion is performed for @xmath5 directly , instead of the virtual projector @xmath97 .",
    "note also that the choice of @xmath96 determines both the initialization of @xmath98 as well as the expansion order as is shown in the appendix .",
    "the initial guess for @xmath27 in the newton - raphson optimization has to be particularly good at low temperatures , i.e. when @xmath99 is large .",
    "if @xmath96 is small the analytic derivative @xmath100 is more approximate , which also may require a better initial guess .",
    "@xmath101 @xmath102 @xmath103 @xmath104 @xmath105 solve @xmath106x_n = x_{n-1}^2 $ ] @xmath107 occupation error @xmath108 @xmath109/\\mathrm{tr}[\\beta d ( i - d)]$ ] @xmath110    in the recursive fermi operator expansion , algorithm  [ fermi_op_exp ] , a system of linear equations is solved in each iteration .",
    "the numerical problem is well conditioned and the solution from the previous cycle @xmath111 is typically close to the solution @xmath112 .",
    "a linear conjugate - gradient solver is therefore very efficient @xcite .",
    "the fermi operator expansion algorithm can be formulated based only on matrix - matrix operations and does not require a diagonalization of the fockian .",
    "it is therefore possible to reach a reduced complexity scaling of the computational cost as a function of system size if sparse matrix algebra can be utilized .",
    "the recursive fermi operator expansion , algorithm  [ fermi_op_exp ] , provides an efficient calculation of the density matrix at finite electronic temperatures , @xmath90 .",
    "the algorithm can be applied also at zero temperatures , @xmath57 . however , in this case there are more efficient recursive fermi operator expansion schemes , for example , the second order occupation correcting spectral projection technique @xcite , shown in algorithm  [ fermi_op_exp_t0 ] . here",
    "@xmath113 and is chosen to minimize the occupation error , @xmath114 - n_{\\rm occ}|$ ] .",
    "the idempotency error , @xmath115| = |\\mathrm{tr}[x_n(i - x_n)]|,\\ ] ] which determines the degree of convergence , can be estimated from the size of the occupation correction , since @xmath116| = |\\mathrm{tr}[x_{n+1 } ] - \\mathrm{tr}[x_n]|$ ] , and towards convergence ( e.g. @xmath117 ) the continuous decrease of the idempotency error can be estimated from every second value . in the initialization , @xmath118 and @xmath119",
    "are upper and lower estimates of the spectral bounds of @xmath29 . to improve matrix sparsity",
    ", numerical thresholding can be applied after each matrix multiplication within controllable total error bounds @xcite .",
    "the recursive 2nd - order occupation correcting expansion algorithm is fast , robust , and very memory efficient compared to other linear scaling methods @xcite . if more detailed information about the homo - lumo gap and the spectral bounds are available , an efficient boosting technique based on shifting and rescaling of the second order projection polynomials in eq .",
    "( [ sp2 ] ) can be applied to accelerate the idempotency convergence @xcite .",
    "@xmath101 @xmath120 @xmath121 @xmath122",
    "the extended lagrangian free energy molecular dynamics schemes were implemented in freeon , as suite of freely available programs for _ ab initio _ electronic structure calculations developed by challacombe and co - workers @xcite , and in vasp , the vienna ab initio simulation package @xcite .    for the calculation of the electronic entropy contribution to the free energy we rely on a diagonalization of the fockian or the kohn - sham hamiltonian , which would not be possible within a reduced complexity scheme . a sufficiently accurate expansion of @xmath123 in eq .",
    "( [ sed ] ) , which is suitable within a reduced complexity calculation may be possible , but it is currently an unsolved problem . for the construction of the density matrix we use either the recursive fermi operator expansion , algorithm  [ fermi_op_exp ] , or , as a comparison , an `` exact '' calculation based on the conventional ( non - recursive ) exponential form of the fermi - dirac distribution in eq .",
    "( [ rec ] ) , which requires a full diagonalization of the hamiltonian .",
    "the plane wave pseudo potential calculations were carried out within the local density approximation ( lda ) for the exchange correlation energy .",
    "ultrasoft pseudo potentials were used @xcite , and for the scf optimization an iterative rmm - diis scheme @xcite was applied .",
    "the plane wave cutoff was 246 ev and a mesh of 64 _",
    "k_-points was used .",
    "the electronic temperature was set to @xmath124 k around which also the nuclear temperature fluctuated .        in a free energy simulation based on regular first principles molecular dynamics the self - consistent electronic state is propagated through an extrapolation from previous time steps , which is used as an initial guess to the scf optimization procedure as was shown in eq .",
    "( [ extrp ] ) .",
    "this approach leads to the breaking of time - reversal symmetry with an unphysical systematic drift in the energy and phase space .",
    "figure [ e_drift ] illustrates this problem , which is avoided with the density matrix extended lagrangian free energy molecular dynamics .",
    "( color online ) the fluctuations in the total free energy , @xmath125 , of a water molecule using regular free energy molecular dynamics for a conventional density matrix based born - oppenheimer method with a linear extrapolation of the electronic state , eq .",
    "( [ extrp ] ) , in comparison to the density matrix extended lagrangian free energy molecular dynamics . ]",
    "figure [ fig_water_t10000k ] shows the free energy conservation vs. the fluctuations of the sum of the nuclear kinetic and potential energy , @xmath126 .",
    "only one or two scf cycles per time step are used , which shows that the simulation is stable , conserving the free energy under incomplete approximate scf convergence . while the amplitude of the fluctuations in @xmath127 is dependent on the electronic temperature @xmath0 ,",
    "the amplitude of the total free energy oscillations , @xmath125 , is not .",
    "this is an agreement with the total free energy being a constant of motion as in the density matrix extended free energy lagrangian , eq .",
    "( [ xfe ] ) , in the limit @xmath23 .",
    "( color online ) the fluctuations in the nuclear kinetic and potential energy , @xmath126 , in comparison to the total free energy , @xmath125 , for a density matrix extended lagrangian free energy molecular dynamics simulation of a single water molecule using hartree - fock ( rhf ) or hybrid density functional theory ( pbe0 @xcite ) .",
    "the average nuclear temperature was approximately room temperature , i.e. @xmath128 k. ]    figure  [ fig_bucky_water_t2500k ] shows the corresponding behavior of the free energy fluctuations of the sum of the nuclear kinetic and potential energy , @xmath126 for a single water molecule embedded in a c@xmath129 bucky ball .",
    "the electronic temperature was set to @xmath130 k , while the nuclear temperature of the bucky ball was initially zero , and the water molecule was given an initial velocity and hence had a non - zero initial temperature .",
    "the time evolution of the total temperature , @xmath131 , the temperature of only the bucky ball , @xmath132 , and the temperature of only the water molecule , @xmath133 , are shown in figure  [ fig_bucky_water_t2500k_temperature ] .",
    "clearly visible in the figure is the process of kinetic energy transfer from the water molecule to the bucky ball ; as the water molecule repeatedly collides with the wall of the bucky ball , kinetic energy is transferred between the two sub - systems and the bucky ball heats up , while the water molecule cools down .",
    "( color online ) the fluctuations in the nuclear kinetic and potential energy , @xmath127 , in comparison to the total free energy , @xmath134 , for a density matrix extended lagrangian free energy molecular dynamics simulation of a single water molecule embedded within a @xmath135 bucky ball using hartree - fock theory .",
    "the average nuclear temperature was approximately @xmath136 k. ]     ( color online ) the fluctuations in the total nuclear temperature , @xmath137 , in comparison with the temperature of only the bucky ball , @xmath132 and the temperature of the water molecule , @xmath133 .",
    "we start our simulation with the bucky ball at @xmath138 k and a water molecule at the center inside the bucky ball with a non - zero initial velocity .",
    "while the total temperature remains fairly constant , the energy transfer from the water molecule to the bucky ball is clearly visible in the rising @xmath132 and the falling @xmath133 . ]    if we use the original expression of the pulay term @xcite , @xmath139,\\ ] ] which is valid only for an idempotent density matrix in the limit of @xmath57 , i.e. when @xmath140 , we find that it affects the energetics even at fairly modest electronic temperatures .",
    "figure [ fe_gpulay ] gives a comparison of the free energy calculated either with the original zero - temperature expression in eq .",
    "( [ pforce ] ) or its finite temperature generalization in eq .",
    "( [ gpforce ] ) .",
    "only the generalized pulay force has the correct variational properties derived from the extended free energy lagrangian , which gives a significant improvement in the conservation of the free energy .",
    "( color online ) the fluctuations in the total free energy , @xmath125 , for a small li cluster at @xmath141 k simulated using freeon within the density matrix extension .",
    "the pulay force has been calculated either with the original zero - temperature expression , eq .",
    "( [ pforce ] ) , or its finite temperature generalization , eq .",
    "( [ gpforce ] ) . ]",
    "( color online ) the change in total free energy as a function of time for a periodic 8 atom silicon cell for conventional born - oppenheimer md as implemented in vasp and extended lagrangian free energy md . both simulations using a time step of 0.25 fs , and a energy convergence criteria of 0.5 mev .",
    "the conventional born - oppenheimer md show a clear unphysical systematic drift in comparison to the extended lagrangian free energy md . ]",
    "figure  [ fig_wf_total_energy ] demonstrates how the total free energy for the conventional born - oppenheimer molecular dynamics and the plane wave extended lagrangian free energy molecular dynamics behave over time in the plane wave formulation .",
    "a system of 8 silicon atoms are simulated for a total of 5 ps using a time step of 0.25 fs .",
    "the figure effectively depicts how the regular born - oppenheimer molecular dynamics exhibit an unphysical systematic drift in the total free energy .",
    "this issue is solved by the use of the extended lagrangian free energy formulation , which with equivalent settings otherwise shows no systematic drift . in fig .",
    "[ fig_wf_etotal_efree ] we show the same behavior for the plane wave formulation as in fig .",
    "[ fig_water_t10000k ] for the density formulation , where we demonstrate that the total free energy is a constant of motion .",
    "figure [ fig_wf_fluctuations ] shows the error as measured by the amplitude of the total energy vs. the free energy fluctuations for various lengths of the integration time step @xmath142 . only the free energy has the correct scaling with respect to the time step .",
    "( color online ) the fluctuations for the total nuclear and potential energy , @xmath143 , in comparison to the total free energy , @xmath144 , of a periodic 8 atom silicon system .",
    "the simulation was carried out using extend lagrangian free energy md in vasp . using a time step of 0.25 fs and energy convergence criteria of @xmath145 ev with ultrasoft pseudopotentials . both the nuclear and electronic had an average temperature of about 500 k. ]     ( color online ) the error amplitudes as a function of time step for the total nuclear and potential energy , @xmath143 , and the total free energy , @xmath144 , of a 8 atom periodic silicon cell ]      the temperature - dependent density matrices for the simulations in fig .",
    "[ fig_water_t10000k ] were constructed using the  exact \" analytic fermi - dirac distribution of the states .",
    "if we instead use the recursive fermi operator expansion of algorithm  [ fermi_op_exp ] we find no significant deviation compared to the fermi - dirac result when we use more than 5 steps in the recursion .",
    "figure [ fig_water_recursion_m ] shows the free energy calculated with the exact result vs. the recursive expansion .",
    "the example corresponds to the simulation of the lower panel in fig .",
    "[ fig_water_t10000k ] . using 5 recursion steps gives only a small constant shift in the free energy .",
    "the accuracy for a specific expansion order @xmath96 will depend on the temperature @xmath0 . in fig .",
    "[ m_t_exp ] we show the error in the entropy as a function of @xmath96 for three different temperatures for a small li cluster . in this case",
    "we find that the relative accuracy is reduced for lower temperatures , though the rate of convergence as a function of the number of expansion steps @xmath96 is the same .",
    "( color online ) the fluctuations in the total free energy , @xmath125 , for a water molecule , h@xmath146o ( pbe0/3 - 21 g ) , using either the exact fermi - dirac distribution or the recursive fermi operator expansion , algorithm  [ fermi_op_exp ] , with 5 ( @xmath147 ) or 6 ( @xmath148 ) recursion steps .",
    "the simulation is based on a hybrid density functional ( pbe0 @xcite ) for @xmath149 k and @xmath150 k using 2 scf cycles per time step , @xmath151 fs , within the density matrix extension . ]",
    "( color online ) the relative error in the entropy as a function of the number of expansion steps @xmath96 in the recursive fermi operator expansion , algorithm  [ fermi_op_exp ] , for three different electronic temperatures @xmath0 . ]",
    "free energy generalizations of regular born - oppenheimer molecular dynamics for simulations at finite electronic temperatures are currently widely used @xcite . in this paper first principles free energy molecular dynamics schemes were developed based on extended lagrangian born - oppenheimer molecular dynamics @xcite .",
    "the formulation was given both for density matrix and plane wave representations .",
    "the density matrix formulation has numerically convenient expressions for the electronic forces as well as a recursive fermi operator expansion that are well suited for reduced complexity calculations .",
    "our extended lagrangian free energy molecular dynamics enables efficient and accurate molecular dynamics simulations based on hartree - fock and density functional theory ( or any of their many extensions ) both for localized orbital and plane wave pseudopotential calculations with a temperature - dependent electronic degrees of freedom and nuclear trajectories that evolve on the self - consistent free energy potential surface .",
    "the los alamos national laboratory is operated by los alamos national security , llc for the nnsa of the usdoe under contract no .",
    "de - ac52 - 06na25396 .",
    "we gratefully acknowledge the support of the us department of energy through the lanl ldrd / er program and the swedish foundation for strategic research ( ssf ) via strategic materials research center on materials science for nanoscale surface engineering ( ms2e ) , and the gran gustafsson foundation for research in natural sciences and medicine for this work .",
    "discussions with marc cawkwell , erik holmstrm , igor abrikosov and anders odell as well as support from travis peery at the t - division ten - bar java group are gratefully acknowledged .",
    "there are at least 19 different ( dubious ) ways to calculate matrix exponentials @xcite .",
    "consider @xmath152 which after a first order taylor expansion gives @xmath153 this means that the fermi - dirac distribution function , @xmath154 , can be approximated as @xmath155^{-1 } = \\lim_{n \\rightarrow \\infty } \\frac{(2n - x)^n}{(2n+x)^n + ( 2n - x)^n},\\ ] ] such that @xmath156 for large values of @xmath157 .",
    "the function @xmath158 has the important recursive property , @xmath159 which enables a rapid high - order expansions .",
    "the following recursive approximation can therefore be used : @xmath160 & = & { \\phi}(2n - 4nx_i ) \\nonumber \\\\ \\approx { f}_{n}(x_i ) & = & { f}_2({f}_2 ( \\ldots { f}_2(x_i ) \\ldots ) ) , \\end{aligned}\\ ] ] where @xmath161 and with the recursion repeated @xmath96 times , i.  e.  for @xmath162 .    the density matrix at finite electronic temperatures , @xmath163^{-1 } = { \\phi}\\left[\\beta(h-\\mu i)\\right],\\ ] ] can thus be calculated using the recursive grand canonical fermi operator expansion , @xmath164 which is generated by algorithm  [ fermi_op_exp ] .",
    "even if a correct geometric and long - term energy conserving integration scheme , such as the verlet algorithm , is used both for the nuclear and the electronic degrees of freedom , a systematic energy drift may still appear in a simulation .",
    "the most probable cause is the approximate formulation of the underlying dynamics .",
    "any self - consistent first principles calculation involves many different numerical approximations , of which some can be physically motivated , others not . in the ideal case",
    "we would perform all calculations numerically exact , but for an _ approximate _ underlying dynamics that is sufficiently close to our effective single particle theory .",
    "the dominating major approximations due to incomplete scf convergence and the finite time steps are treated within the extended lagrangian framework and the geometric integration presented here .",
    "other approximations , such as truncated multipole expansions , finite arithmetics , thresholding of small matrix elements , and finite grid errors , have not been considered .",
    "first principles electronic structure codes have in general never been able to generate exact energy conserving molecular dynamics . to obtain a well working scheme that is stable and energy conserving under approximate scf convergence",
    "may thus involve extensive prior testing , tuning and debugging , even if the dissipative electronic force discussed above is applied . in this way ,",
    "an energy conserving extended lagrangian free energy ( or born - oppenheimer ) molecular dynamics simulation is an excellent test and signature of a well working code .      in regular born - oppenheimer molecular dynamics simulations , various forms of thermostats",
    "are applied to generate , for example , stable constant temperature ( nvt ) or constant pressure ( nvp ) ensembles . in this case the problem with a systematic energy drift may not be seen directly , but the underlying dynamics is , of course , still wrong , even if a hypothetical `` exact '' thermostat could be used . by using an ever increasing number of scf cycles the underlying energy drift can be kept low , but this is computationally expensive .",
    "thermostats typically act through a rescaling of the forces or the velocities of the nuclear degrees of freedom .",
    "unfortunately , this approach may lead to an unphysical energy transfer between high - frequency and low - frequency modes @xcite .",
    "the problem is particularly significant when there is a large difference between the atomic masses @xcite .",
    "depending on the accuracy of the electronic structure code used in the molecular dynamics simulation , we give the following practical guide for a constant free energy simulation : 1 ) use the extended lagrangian formulation @xcite and a geometric integration scheme @xcite for the integration of both the nuclear and the electronic degrees of freedom .",
    "2 ) if the calculation is noisy , use electronic dissipation @xcite , e.g. as in eq .",
    "( [ vrl_damp ] ) .",
    "3 ) if the simulation still shows excessive fluctuations in the energy or a systematic drift we suggest a careful review and tuning of the numerical approximations in the underlying electronic description .",
    "4 ) if the energetics still is unstable , and then only as a last resort , one could use a stabilizing velocity or force rescaling . in that case",
    "we suggest the following velocity rescaling , which is constructed to minimize the perturbation of the molecular trajectories : @xmath165 @xmath166 here @xmath167 is the velocity of particle @xmath168 , which is rescaled by the constant @xmath169 at time step @xmath157 .",
    "@xmath170 is the desired target ( free ) energy , @xmath171 is the total ( free ) energy and @xmath172 is the nuclear kinetic energy at time step @xmath157 .",
    "the constant @xmath173 is a chosen relaxation time and @xmath174 is a weight factor for the integrated error term .",
    "the rescaling above is loosely based on the berendsen thermostat @xcite including an integrated error term ( if we chose @xmath175 ) as is often used in conventional control theory .",
    "the velocity rescaling factor @xmath169 is typically small and if the verlet integration scheme is used , @xmath169 scales with the length of the integration step @xmath142 as @xmath176 or @xmath177 , depending on how the relaxation time @xmath173 is chosen . for higher - order integration schemes , @xmath178 for larger integers of @xmath179",
    "this means that even if the velocity rescaling is unphysical , the error can at least be kept very small , with only minor perturbations of the molecular trajectories .",
    "the velocity rescaling above was not necessary for any of the simulations performed for this article ."
  ],
  "abstract_text": [
    "<S> extended free energy lagrangians are proposed for first principles molecular dynamics simulations at finite electronic temperatures for plane - wave pseudopotential and local orbital density matrix based calculations . thanks to the extended lagrangian description the electronic degrees of freedom can be integrated by stable geometric schemes that conserve the free energy . for the local orbital representations both the nuclear and electronic forces have simple and numerically efficient expressions that are well suited for reduced complexity calculations . a rapidly converging recursive fermi operator expansion method that does not require the calculation of eigenvalues and eigenfunctions for the construction of the fractionally occupied density matrix </S>",
    "<S> is discussed . an efficient expression for the pulay force that is valid also for density matrices with fractional occupation occurring at finite electronic temperatures </S>",
    "<S> is also demonstrated . </S>"
  ]
}