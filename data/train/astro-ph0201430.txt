{
  "article_text": [
    "digital images of galaxies which are small by today s standards , may still contain over one million pixels .",
    "it is natural to try to distill the information contained in this large number of pixels into a set of quantities that can be used easily and efficiently to derive information on the physical properties of the observed object .",
    "the most common approach currently consists in fitting ellipses of increasing semimajor axis to the galaxy images ( e.g. , carter 1978 ; kent 1984 ; lauer 1985 ; jedrzejewski 1987 ; franx , illingworth & heckman 1989 ; peletier et al .",
    "intensity profiles , ellipses shape and deviation from ellipses , parametrized by a few fourier terms , are obtained with these methods .",
    "a nice feature of this parametrization is that it gives a physically meaningful description of the galaxy photometry in terms of the ellipticity , diskyness and boxyness at each radius .",
    "one limitation of the ellipse fitting methods however is that strong deviations of the isophotes from ellipses can not be easily modeled with a small number of fourier terms .",
    "this makes these methods not well suited to the photometric modeling of multicomponent objects such as lenticulars and spirals , which have a bulge , a main disk and often an embedded nuclear disk or a bar .",
    "more importantly , if the deviations from ellipses are non negligible it becomes non trivial to use the fitted isophotes for the construction of realistic galaxy dynamical models due to the complexity of deprojection and the evaluation of the gravitational potential .",
    "in this paper we focus on a completely different approach to the photometric modeling , the multi - gaussian expansion ( mge ) method , that overcomes both of these limitations .",
    "the original idea of the application of the mge method to the problem of the deconvolution and deprojection of galaxy images comes from bendinelli ( 1991 ) .",
    "this idea was generalized to the non - spherical case and made applicable to real galaxies by monnet , bacon & emsellem ( 1992 ) and further developed by emsellem , monnet & bacon ( 1994a ) and emsellem , dejonge & bacon ( 1999 ) .",
    "the mge method consists of a series expansion of galaxy images using two - dimensional ( 2d ) gaussian functions .",
    "the gaussians have the beneficial properties that both the convolution ( e.g. , to take seeing or psf effects into account ) and the deprojection ( to derive the intrinsic stellar luminosity density from the observed galaxy photometry ) can be performed analytically in a simple and efficient manner . as shown by emsellem et al .",
    "( 1994a ) , many other dynamical and photometric quantities can be evaluated easily and accurately when the density is expressed in mge form .",
    "for example , the mge potential can be computed with a single integration , as opposed to the two that are required when the intrinsic density is stratified on similar triaxial ellipsoids , and three in the general case . in the case of @xmath1 axisymmetric mge dynamical models the velocity moments predicted from the jeans equations , already projected onto the sky , can be expressed with only a double integration .",
    "the even part of the distribution function can also be easily retrieved from an mge density distribution via the hunter & qian ( 1993 ) formalism .",
    "the mge parametrization is one of the few simple parametrizations that are general enough to reproduce the surface brightness of realistic multicomponent objects ( e.g. , spirals with multiple disks ) .",
    "it has already been used for the modeling of a number of galaxies ( emsellem et al .  1994b , 1996 , 1999 ; emsellem 1995 ; van den bosch et al .",
    "1998 ; van den bosch & emsellem 1998 ; cretton & van den bosch 1999 ) .    what is however still missing from the mge machinery is an accurate , easy to use , generally available , robust and automatic algorithm for the determination of an mge expansion from galaxy images . in this paper",
    "we present such an algorithm .",
    "the method we describe here brings the mge fitting phase of a dynamical modeling process to the same level of the losvd extraction phase ( e.g. , van der marel & franx 1993 ) in terms of robustness and ease of use .",
    "this paper is organized as follows . in section  2",
    "we define our notation and give some useful formulae for the application of mge models to the dynamical modeling of galaxies . in section  3",
    "we discuss our new mge fitting method . in section",
    "4 we give information on the availability of the software implementing the methods discussed in this paper .",
    "some conclusions are given in section  5 .",
    "in this section we rederive , in a slightly different notation , results from monnet et al .  ( 1992 ) and emsellem et al .",
    "( 1994a ) that are usually needed for the construction of dynamical models , starting from the mge photometric models we describe in this paper . the case of gaussians with the same centre and circular psf",
    "is considered here , while the general case is discussed in detail in emsellem et al .",
    "( 1994a ) .",
    "let @xmath2 be a system of coordinates centred on the galaxy nucleus , with the @xmath3 axis pointing towards the observer .",
    "the mge projected surface brightness can be written as @xmath4 } , \\label{eq : surf_twist}\\ ] ] with @xmath5 where @xmath6 are the polar coordinates on the plane of the sky @xmath7 . here",
    "@xmath8 is the number of the adopted gaussian components , having total luminosity @xmath9 , observed axial ratio @xmath10 , dispersion @xmath11 along the major axis , and position angle ( pa ) @xmath12 , measured counterclockwise from the @xmath13 axis to the major axis of the gaussian .",
    "given that the convolution , deprojection and potential calculations , can be carried out separately for each single gaussian component of equation  ( [ eq : surf_twist ] ) , in what follows the index of the gaussian is not written explicitly and only one gaussian is considered .",
    "the results for the complete mge model are obtained by summing the contributions over the @xmath8 gaussians components .",
    "the mge surface brightness has to be convolved with the instrumental psf before comparison with the observed surface brightness .",
    "assume the normalized psf can be written as the sum of @xmath14 circular gaussians @xmath15 with @xmath16 .",
    "the total luminosity @xmath17 of one gaussian , having surface brightness @xmath18 , does not change after convolution @xmath19 with the psf .",
    "the convolved gaussian can then be written explicitly as @xmath20 } , \\label{eq : psf1}\\ ] ] where @xmath21      the deprojection of a galaxy surface brightness distribution is generally non unique ( e.g. , rybicki 1986 ; franx 1988 ) .",
    "the mge deprojection discussed here represents a possible solution to the problem .",
    "it generally produces smooth and natural - looking intrinsic densities , consistent with the observed photometry .",
    "the nonuniquness of the triaxial deprojection on a set of real galaxies and its effects on the dynamical modeling will be the subject of a coming paper ( cappellari & de zeeuw , in preparation ) .",
    "if a good mge fit to the photometry can only be obtained by allowing the pa @xmath12 of the gaussians to be different from each other , then the object can _ not _ be axisymmetric .",
    "the following deprojection method can be used to produce an intrinsic density model consistent with the observations .",
    "consider one single gaussian component taken from equation  ( [ eq : surf_twist ] ) .",
    "since the isophotes of this component are similar ellipses it can be deprojected by assuming the intrinsic density is stratified on triaxial ellipsoids ( contopoulos 1956 ; stark 1977 ; binney 1985 ) . the intrinsic luminosity density of this component can be written again as a gaussian with the same total luminosity @xmath17 @xmath22 .",
    "\\label{eq : density}\\ ] ] here @xmath23 is a system of coordinates as in binney ( 1985 ) , centred on the gaussian centre and aligned with its principal axes .",
    "the axes are assumed to be such that the longest axis of the gaussian lies along the @xmath24-axis and the shortest axis along the @xmath25-axis , so that @xmath26 .",
    "the two usual polar coordinates @xmath27 define the orientation of the line - of - sight with respect to the principal axes of the object .",
    "another angle @xmath28 is required to specify the rotation of the object around the line - of - sight , and uniquely define the orientation in space of the @xmath23 coordinate system .",
    "this angle @xmath28 is defined by the requirement that the @xmath25 axis project onto the @xmath13 axis , or equivalently that the @xmath29 axis lies in the @xmath30 plane .",
    "once the viewing angles @xmath31 have been _ assumed _ , given the observed axial ratio @xmath32 for the gaussian , the intrinsic axial ratios @xmath33 and @xmath34 can be found using relations valid for general ellipsoidal bodies ( e.g. , de zeeuw & franx 1989 ) @xmath35 } { 2\\sin^2 \\theta       \\left [ \\delta ' \\cos \\psi          ( \\cos \\psi\\ !   + \\ !            \\cot \\phi \\sec \\theta \\sin \\psi   ) \\ ! -\\ ! 1   \\right ] } , \\\\ p^2\\ ! -\\",
    "q^2\\ ! = \\ !",
    "\\frac { \\delta '       \\left [ 2\\cos 2\\psi\\ !   + \\ !",
    "\\sin 2\\psi ( \\cos \\theta \\cot \\phi\\ ! -\\ ! \\sec \\theta \\tan \\phi )   \\right ] } { 2\\sin^2 \\theta       \\left [ \\delta ' \\cos \\psi          ( \\cos \\psi\\ !   + \\ !            \\cot",
    "\\phi \\sec \\theta \\sin \\psi   ) \\ ! -\\ ! 1 \\right ] } , \\end{aligned}\\ ] ] where @xmath36 .",
    "it should be noted that in general a solution may not be found for all assumed viewing angles ( e.g. , bertola et al .",
    "if a triaxial deprojection is sought for the galaxy , then the viewing angles have to be the same for all the gaussians and the permissible viewing angles for the object , assumed to be triaxial , will lie in the intersection of the permissible viewing angles of each gaussian ( cf .",
    "williams 1981 ) .",
    "if an acceptable mge model can be obtained by fixing the pa @xmath12 of all the gaussians to the same value @xmath28 , then the object can be deprojected by assuming it is axisymmetric ( triaxial solutions however can _ not _ be excluded [ cf .",
    "franx 1988 ] ) . in this case",
    "the formulae of the previous section simplify considerably .    in the oblate axisymmetric case ( @xmath37 )",
    ", once an inclination @xmath38 ( for @xmath39 the deprojection is degenerate ) has been assumed for the galaxy ( @xmath40 corresponding to edge - on ) , one has : @xmath41 while in the prolate axisymmetric case ( @xmath42 ) @xmath43    the oblate mge deprojection above is only defined if @xmath44 for all gaussians .",
    "this means that the flattest gaussian in an mge fit dictates the minimum possible inclination for which the mge model can be used in a dynamical model .",
    "however since the gaussian components do nt necessarily have physical significance one do nt want to base any conclusion of a dynamical model on this minimum inclination .",
    "one simple way to avoid this problem consists in trying to increase the minimum axial ratio @xmath32 allowed in the mge fit until the @xmath0 increases significantly or the galaxy contour can not be accurately reproduced any more with any number of gaussians .",
    "this @xmath45 will provide a good estimate of the minimum inclination for which the given galaxy , assumed to be axisymmetric , can be deprojected .    independently from an actual mge fit , the limit to the above @xmath45 is set by the axial ratio @xmath32 of the ellipse having the same curvature of the galaxy isophotes along the major axis , at the point of maximum curvature .",
    "in fact there has to be at least one gaussian flat enough to reproduce the maximum curvature along the major axis .",
    "the potential generated by a triaxial gaussian mass distribution of the form given in equation  ( [ eq : density ] ) , can be evaluated using the classical chandrasekhar ( 1969 ) formulae for densities stratified on similar concentric ellipsoids ( see binney & tremaine 1987 , p.  61 ) . in the mge case",
    "the potential can be written as a one - dimensional ( 1d ) integral @xmath46          } {          \\sqrt{(1-\\delta t^2)(1-\\epsilon t^2 ) }          }          } { \\rm d}t , \\label{eq : pot_tri}\\end{aligned}\\ ] ] where @xmath47 , @xmath48 , g is the gravitational constant and @xmath49 is the mass - to - light - ratio . for oblate axisymmetric models ( @xmath37 )",
    "this reduces to @xmath50          } {          \\sqrt{1-\\epsilon t^2 }          }          } { \\rm d}t .",
    "\\label{eq : pot_axis}\\ ] ] in the spherical case ( @xmath51 ) to @xmath52 already for @xmath53 the error function @xmath54=1 $ ] to 16 digits accuracy and the spherical mge potential can be replaced with high precision by the potential of a point mass enclosing the total mass @xmath55 of the gaussian component .    since the @xmath56 of the gaussians in an mge fit span various orders of magnitude in size , asymptotic expressions can also be conveniently used to estimate the triaxial or axisymmetric potential of equations  ( [ eq : pot_tri ] ) and ( [ eq : pot_axis ] ) at very small and very large radii as done in cappellari et al .",
    "we start by considering the mge fit to galaxies without isophote twists .",
    "the determination of an axisymmetric mge parametrization from the photometry , namely the fit of a sum of gaussians with the same centre and pa , to a galaxy image seems to be a very simple problem that can be efficiently solved with general nonlinear minimization algorithms .",
    "we assume for simplicity that the pa @xmath28 of all gaussians is known .",
    "we do nt fit @xmath28 since it is very easily measured before fitting .",
    "we found it fast and accurate to determine it from the weighted second moments of the surface brightness above a given level , as done by automatic galaxy extraction packages ( e.g. , bertin & arnouts 1996 ) .",
    "it may also be measured with standard photometric programs , or may be dictated by other requirements in the dynamical model ( in general a more accurate @xmath28 is required in the centre where the kinematical data are available ) .",
    "we will also always assume that the mge models are analytically convolved with a circular mge psf before comparing with the data using equations  ( [ eq : psf1 ] ) and ( [ eq : psf2 ] ) .",
    "the straightforward mge fit approach consists of fitting the nonlinear function of equation  ( [ eq : surf_twist ] ) to the pixels of the image by minimizing the @xmath0 ( pixel integration can be taken into account in the very innermost few pixels ) @xmath57 ^ 2 , \\label{eq : chi2}\\ ] ] where @xmath58 are the pixel counts , @xmath59 is a corresponding weight factor , depending on the photometric and systematic errors , and the sum is done over all ( good ) image pixels .",
    "positivity constraints are generally enforced on the @xmath9 , although in principle only the total surface density needs to be positive everywhere .",
    "although the convergence can be improved by starting the fit with only a few gaussians and then adding new components as long as the residuals decrease appreciably ( emsellem et al .",
    "1994a ) , we have discovered that this brute force approach does not work well in practice for two main reasons :    1 .",
    "the nonlinear function @xmath0 above has a large number of local stationary points . in fact",
    "suppose that we have found a minimum of the @xmath0 with @xmath8 gaussians .",
    "a new configuration with @xmath60 gaussians , where the new gaussian is equal to one of those previously found , is a saddle point for the @xmath0 .",
    "consequently even state - of - the - art nonlinear fitting algorithms have a high chance of stopping or slowing down considerably in a narrow valley in the @xmath61-dimensional space ( with @xmath62 ) close to one of these many stationary points , unless the initial guess is very near the true minimum ; 2 .",
    "the `` correct '' weighting of the pixel measurements tends to produce a model that underestimates the nuclear density due to the fact that the total @xmath0 of equation  ( [ eq : chi2 ] ) is dominated by the contribution of many pixels at large radii .",
    "this is _ not _ what is needed for an accurate dynamical model of the nucleus .",
    "the net result is that in the above approach the fit proceeds by trial and error , with a lot of manual intervention .",
    "an automatic fit generally takes many hours on a 1  ghz pc and usually converges to a solution that can still be improved manually .      to solve the convergence problems of an mge fit we start by analysing the peculiarities of a fit to a 1d profile , as can be obtained by measuring the photometry of a galaxy with constant ellipticity . since galaxy profiles are generally well described by multiple power - law regimes ( e.g. , lauer et al .",
    "1995 ) , in this section we start by trying to satisfy the natural requirement that the fit has to `` look good '' on a log - log plot . to obtain this result",
    "we do the following :    1 .   we sample the profile logarithmically in radius .",
    "this is usually done in galaxy photometry to improve the s / n at large radii while still maintaining all the information at the smaller radial scales ; 2 .",
    "we require the fit to optimise the _ relative _ error , namely we minimize @xmath63 ^ 2 ,          \\label{eq : chi2new}\\ ] ] where @xmath14 is the number of photometric data points @xmath64 in the profile , @xmath65 is the corresponding isophote major axis and @xmath66 is the 1d version of equation  ( [ eq : surf_twist ] ) .",
    "the reason why gaussians are so successful in reproducing power - law profiles lies in the fact that every gaussian provides a very localized contribution to the profile , only for radii close to its @xmath11 .",
    "in fact 1 ) at small radii ( @xmath67 ) gaussians become very rapidly constant , while power - laws continue to rise , 2 ) at large radii ( @xmath68 ) gaussians go to zero much more rapidly than a power - law .",
    "it appears clear that the mge best - fitting solution for a logarithmically sampled power - law profile consists of a series of gaussians that are also logarithmically spaced , both in @xmath11 and in height , within the ranges imposed by the data ( see fig .  [",
    "fig : mge_fit_1d_powerlaw ] ) .    .",
    "_ top panel : _ the profile and the @xmath69 best - fitting gaussian components are shown . _",
    "bottom panel : _ radial variation of the relative error in the profile fit .",
    "note that the maximum error is reached precisely @xmath70 times , with alternating signs .",
    "the vertical lines indicate the @xmath11 of the gaussians shown in the upper panel.[fig : mge_fit_1d_powerlaw],title=\"fig : \" ]    we now show that this solution is the true _ global _ minimum .",
    "in fact our least - squares mge solution , with positive gaussians , for a given decreasing function of radius , in a given interval , is characterized by the condition that the maximum relative error is reached precisely @xmath70 times , with alternating signs ( bottom panel of fig .",
    "[ fig : mge_fit_1d_powerlaw ] ) .",
    "a similar condition also exists for the unique _ _ minimax _ _ solution of other approximating functions e.g. , chebyshev polynomials and rational functions ( see e.g. , press et al .",
    "the fact that the minimax condition is satisfied for our mge fits shows that our algorithm is able to converge to the minimax mge approximation of a power - law .",
    "the same minimax condition can be verified in the case of mge fits to more realistic profiles composed of multiple power - law regimes ( fig .",
    "[ fig : mge_fit_1d_m32 ] ) , and essentially for any function that appears smooth in a log - log plot . here",
    "the gaussians will not be precisely logarithmically spaced in the @xmath11 , but will be more closely spaced where the profile is steeper ( fig .",
    "[ fig : mge_fit_1d ] ) .",
    "also in these cases however the least - squares solution essentially provides the minimax mge approximation of the given function .     for the triple power - law profile of the intrinsic density of m32 , as determined by van der marel et al .",
    "( 1998 ) . with",
    "@xmath69 gaussians the maximum error is 0.7 per cent ( excluding border effects ) in the range 001300 , over ten orders of magnitude in the density.[fig : mge_fit_1d_m32],title=\"fig : \" ]     for the double power - law profile with flat core @xmath71 .",
    "the maximum error is 0.3 per cent ( excluding border effects ) over ten orders of magnitude .",
    "[ fig : mge_fit_1d],title=\"fig : \" ]    we emphasize the fact that the logarithmic sampling of the profiles is a necessary condition for the least - squares solution to coincide , within the numerical approximations , with the minimax solution for the power - law .",
    "a linear sampling would have produced an mge fit with smaller errors at large radii and larger errors towards the centre .    with real photometric data",
    "the above condition for the minimax solution can not be always verified , due to the noise and to the fact that the observed profile is known at a finite number of points .",
    "the convergence to a global solution however can still be recognized , by simple visual inspection of the result , from the fact that every gaussian has to give a significant contribution to a specific part of the profile : a gaussian that remains always lower than any other gaussian is generally an indication that the solution is not the global minimum ( unless the profile becomes very flat ) .    to determine the fits of fig .",
    "[ fig : mge_fit_1d_powerlaw][fig : mge_fit_1d ] we made use of the important fact that equation  ( [ eq : surf_twist ] ) is _ linear _ in the gaussian total luminosity @xmath9 . since a global solution for the linear variables @xmath9 can be found easily for any given combination of the nonlinear ones @xmath11 , it is crucial to separate the treatment of these two sets of variables . in practice",
    "our 1d mge fitting algorithm consists of the following steps :    1 .",
    "we start with the @xmath11 logarithmically spaced in radius between the maximum radius of the measured photometric data @xmath72 and a minimum radius @xmath73 .",
    "we know this is a good guess for general multiple power - law profiles ; 2 .",
    "we solve the nonlinear least - squares minimization problem for the @xmath74 , imposing the constraints that @xmath75 .",
    "the actual computation is done using the robust levenberg - marquardt implementation due to mor , garbow & hillstrom ( 1980)craigm / idl ] .",
    "the adopted implementation accepts bound constraints on the variables and is able to deal with degenerate jacobians .",
    "the latter is a necessary feature since some of the variables @xmath9 may be zero in the final solution ; 3 .   for every choice of the @xmath11 variables , during the above iterative optimisation process , we find the best - fitting value for the @xmath9 , with the constraints @xmath76 .",
    "this is a non - negative least - squares ( nnls ) problem that can be efficiently solved using the lawson & hanson ( 1974 ) algorithm .    in case",
    "a solution with negative gaussians is needed ( e.g. , to reproduce a profile that is _ not _ monotonically decreasing with radius ) the solution of the linear system with nnls , in step ( iii ) above , must be replaced by a solution using the singular value decomposition ( svd ) to provide a zero order ( i.e.  minimum norm ) regularization on the solution ( e.g. , press et al .",
    "other linear regularization constraints could also be enforced on the solution .",
    "a direct non - regularized solution of the linear system is extremely ill - conditioned and will produce a result containing elements @xmath9 of very large absolute value and different sign .",
    "an mge model obtained in this way presents the risk of cancellation of significant digits when deriving any physical quantity .",
    "[ fig : mge_error ] shows that the maximum relative error in an mge fit to multiple power - law profiles decreases almost exponentially with increasing number of gaussians , approximately as fast as @xmath77 .",
    "this is not surprising , given that every gaussian diverges exponentially from the power - law starting from the point of closest approach .",
    "although the actual numbers will depend on the profiles and on the adopted radial ranges , these examples provide an estimate of the number of gaussians that are required to reach a given accuracy in the fit , and explain why 1015 gaussians generally produce a very good mge fit to realistic galaxy profiles .",
    "( solid line ) and in the fit of fig .",
    "[ fig : mge_fit_1d ] ( dashed line ) as a function of the number of gaussians adopted in the expansion .",
    "[ fig : mge_error],title=\"fig : \" ]    we finally mention that an asymptotic power - law nuclear cusp can also be imposed on the mge profile as described in emsellem et al .",
    "although this choice breaks the elegance of the mge parametrization somewhat , this detail does not change in any way the essence of our fitting algorithm .",
    "we now extend the 1d algorithm described above to the fit of actual 2d images .",
    "we perform this extension by starting from the obvious requirement that the 2d algorithm provides _ exactly _ the same results of the 1d case ( to be precise the same @xmath9 and @xmath11 ) when it is used to fit a 2d image that presents the same major axis profile of the 1d case and has perfectly elliptical isophotes with constant axial ratio @xmath32 and pa .",
    "this goal is achieved by fitting `` in parallel '' the mge model of equation  ( [ eq : surf_twist ] ) , in polar coordinates , to a certain number @xmath78 of photometric profiles , measured along sectors uniformly spaced in angle from the major axis to the minor axis ( sectors in the four quadrants are averaged together before fitting ) .",
    "all profiles include the central pixel and proper integration of the gaussians on that pixel was performed for an accurate data - model comparison .",
    "the sampling of the photometry along the sectors is now logarithmically spaced in the _ elliptical _ radius @xmath79 , where @xmath32 is a representative axial ratio of the galaxy isophotes ( see fig .",
    "[ fig : sectors ] ) .",
    "this latter detail ensures that the requirement stated in the previous paragraph is precisely satisfied also for flattened objects .",
    "this way of sampling galaxy photometry is a time proven practice common to most photometry packages ( e.g. , jedrzejewski 1987 ) . in the fit the same relative error",
    "is assigned to all measurements as in the 1d case , following equation  ( [ eq : chi2new ] ) .",
    "sectors have been used , spaced in angle by @xmath80 and covering the whole galaxy from the major to the minor axis . in this figure",
    "only one every three sectors is shown .",
    "these are the sectors from which the profiles shown in fig .",
    "[ fig : n4342_profiles ] have been extracted .",
    "note that the radial sampling along the sectors follows a characteristic isophote of the galaxy .",
    "the @xmath81 pc1 image of the galaxy is visible in the background.[fig : sectors],title=\"fig : \" ]    the actual photometric measurements are obtained by selecting sets of pixels on the image , based on their angular position and logarithmic radius ranges . once the pixels have been selected , the luminosity weighted average coordinates of each photometric point are evaluated from the pixels themselves and _ not _ from the original sectors .",
    "this ensures that the coordinates of sectors at the border , or containing masked pixels , are properly computed and , even more importantly , it permits an accurate modeling of the galaxy surface brightness distribution close to the centre , where the discrete nature of pixels can not be neglected .",
    "in particular _ no _ surface brightness interpolation is performed in the centre , but the observed pixel values are used in the fit . to guarantee a proper sampling of the image , both in the nucleus and at large radii , 24 sectors have been adopted for every decade in radius _ in pixels units _ ( this corresponds to the usual factor 1.1 separation between successive radial intervals ) .    with these choices ,",
    "when fitting a galaxy with slowly varying ellipticity with radius ( as is often the case for single component objects like ellipticals ) , if the input guess @xmath32 for the axial ratio is close to the galaxy average value , the procedure essentially reduces to @xmath78 1d similar fits and converges very quickly by varying almost only the @xmath11 as done in section  [ sec:1d ] .",
    "if the axial ratio is not constant or the isophotes are not ellipses ( as in the case of spirals ) , both the @xmath11 and @xmath82 will have to be optimised together . in practice",
    "we still apply steps ( i)-(iii ) of section  [ sec:1d ] , with the only difference that we also fit the nonlinear parameters @xmath82 in step ( ii ) . to make the fit more robust",
    ", bound constraints are given on the variables : @xmath75 and @xmath83 .",
    "experience on a number of complex objects has shown that the above procedure will still converge very quickly and automatically to an excellent mge fit to the photometry , since the initial guess for the solution is already good enough to permit the levenberg - marquardt optimisation algorithm to converge to the global minimum .    as an example we present in figures  [ fig : m32_profiles ] the profiles/6\\simeq0.38 $ ] pixels has been assigned in the plots to the radius of the central pixel , corresponding to the unweighted average radius measured from the centre of the pixel .",
    "] of an mge fit to the elliptical galaxy m32 ( cf .",
    "bendinelli et al .",
    "the model was fit simultaneously to a wfpc2/f814w image and an @xmath84-band ground - based one ( peletier 1993 ) .",
    "the @xmath85 gaussians mge fit for this galaxy was obtained with @xmath86 sectors , spaced by @xmath80 , covering the whole galaxy , from the major to the minor axis .",
    "as expected the gaussians succession is very regular and predictable , as in the 1d mge fit previously shown in fig .",
    "[ fig : mge_fit_1d_m32 ] .",
    "the comparison between the contours of the model and the data is presented in fig .",
    "[ fig : m32_contours ] .",
    "similarly to what was done by emsellem et al .",
    "( 1994a ) , to determine the number of gaussian components in the fit we start e.g. , from @xmath87 gaussians and keep adding gaussians and restarting the fit , until the best - fitting @xmath0 stops decreasing appreciably ( e.g. , less than 1 per cent ) .",
    "-band photometry of m32 ( open squares ) and the corresponding @xmath85 gaussians mge best - fitting model ( solid line ) .",
    "the individual convolved gaussians components are also shown . from top",
    "to bottom the profiles are measured along @xmath80 wide sectors , linearly spaced in angle between the major ( @xmath88 ) and the minor axis ( @xmath89 ) . only 7 representative sectors of the of the @xmath86 sectors actually used in the fit are shown here . _ right panels : _ radial variation of the relative error along the profiles .",
    "the rms error is 2.2 per cent .",
    "most of this scatter is due to the resolution of m32 into stars .",
    "[ fig : m32_profiles],title=\"fig : \" ]     of the ( 1280 s ) wfpc2/f814w ( @xmath84-band ) image of m32 .",
    "the noisy appearance of this high signal - to - noise hst image is due to the resolution of the galaxy into stars . _",
    "bottom panel : _ same as in upper panel for the @xmath90 ground - based ( 1 s ) int @xmath84-band image . superimposed on the two plots are the contours of the intrinsic mge surface brightness , convolved with the proper psf . in this plot , as in the following ones the contours are logarithmically spaced , but otherwise arbitrary .",
    "[ fig : m32_contours],title=\"fig : \" ]   of the ( 1280 s ) wfpc2/f814w ( @xmath84-band ) image of m32 .",
    "the noisy appearance of this high signal - to - noise hst image is due to the resolution of the galaxy into stars . _",
    "bottom panel : _ same as in upper panel for the @xmath90 ground - based ( 1 s ) int @xmath84-band image . superimposed on the two plots are the contours of the intrinsic mge surface brightness , convolved with the proper psf . in this plot , as in the following ones the contours are logarithmically spaced , but otherwise arbitrary .",
    "[ fig : m32_contours],title=\"fig : \" ]    instead of convolving the mge model with the different psfs during the fit we simply exclude the radial range that is affected by psf effects , of the lower resolution image , and only convolve the model with the hst psf .",
    "this is done to avoid spoiling the fit to the high resolution hst image by any psf mismatch in the ground - based data .",
    "sky subtraction and relative flux calibration of the frames is standard for the mge method as for any other photometric modeling ( e.g. , franx et al .",
    "1989 ) and will not be discussed here in detail .",
    "the sky subtraction for the ground - based image was determined by requiring the outer profile to fall of as a power - law ; the sky level and relative calibration of the hst image was adjusted to ensure agreement in the overlap region .",
    "an mge fit to the more `` difficult '' s0 galaxy ngc  4342 , which has a small nuclear stellar disk , in addition to a main outer disk ( van den bosch et al .",
    "1998 ) is shown in fig .",
    "[ fig : n4342_profiles ] .",
    "also in this case the mge fit with @xmath91 gaussians to the wfpc2/f814w image of this galaxy was obtained with @xmath86 sectors , spaced by @xmath80 , covering the whole galaxy , from the major to the minor axis . a comparison between the contours of our mge model and of the observed image is shown in fig .  [ fig : n4342_contours ] .     for the @xmath91 gaussians mge fit to the wfpc2/f814w photometry of ngc  4342 .",
    "the rms error is 1.8 per cent .",
    "part of the data - model discrepancy at large radii along the major axis is due to a non perfect flatfielding of the pc1 ccd close to the border .",
    "[ fig : n4342_profiles],title=\"fig : \" ]    -band ) image of ngc  4342 at two different scales : @xmath92 ( _ top panel _ ) and @xmath81 ( _ bottom panel _ ) .",
    "superimposed on the two plots are the contours of the intrinsic mge surface brightness ( fig .",
    "[ fig : n4342_profiles ] ) , convolved with the wfpc2 psf .",
    "this figure can be compared with fig .  1 in cretton & van den bosch ( 1999 ) .",
    "[ fig : n4342_contours],title=\"fig : \" ] -band ) image of ngc  4342 at two different scales : @xmath92 ( _ top panel _ ) and @xmath81 ( _ bottom panel _ ) .",
    "superimposed on the two plots are the contours of the intrinsic mge surface brightness ( fig .",
    "[ fig : n4342_profiles ] ) , convolved with the wfpc2 psf .",
    "this figure can be compared with fig .  1 in cretton & van den bosch ( 1999 ) .",
    "[ fig : n4342_contours],title=\"fig : \" ]    in fig .",
    "[ fig : ngc4698_mge ] is presented an example of an mge fit to the sa galaxy ngc  4698 , which has non - convex isophotes ( bertola et al .",
    "1999 ; cappellari 2000 ) and for this reason necessarily can not be reproduced by a sum of _ positive _ gaussians . in this case",
    "the positivity constraint for the @xmath9 has been eliminated and the linear part of the gaussian fit has been performed using svd as described in section  [ sec:1d ] .",
    "ngc  4698 has a disk with prominent dust lanes .",
    "the techniques that can be used to determine an mge model of a dusty galaxy are almost the same one can use to correct standard photometric measurements for dust effects ( e.g. , carollo et al .  1997 ) . while performing an mge fit one can mask ( exclude from the fit ) the galaxy regions that are affected by clumpy dust absorptions .",
    "this method clearly works better if some symmetries can be assumed for the underlying galaxy .",
    "this was done to obtain the mge model of fig .  [",
    "fig : ngc4698_mge ] , with constant pa .",
    "mge models like this can also be used to estimate and correct for dust absorption effects ( emsellem 1995 ) . when images in more than one band are available , a colour excess map [ e.g. , @xmath93 can be used to perform a first - order correction for dust absorption as done by cappellari et al .",
    "( 2002 ) to determine an mge model of ic  1459 .    -band ground - based image of the sa galaxy ngc  4698 , taken with the vatican advanced technology telescope ( vatt ) .",
    "overlaid are the contours of the best - fitting mge model for this galaxy , obtained without imposing the usual positivity constraints on the gaussians . only in this way",
    "also the non - convex central isophotes can be reproduced .",
    "the prominent dust lanes in the bottom part of the image and the bright stars have been masked during the mge fit .",
    "[ fig : ngc4698_mge],title=\"fig : \" ]    the mge fitting method discussed in this paper was already successfully applied to another sample of ten galaxies in cappellari ( 2000 ) .",
    "the method was also tested on twenty elliptical and lenticular galaxies with hst / wfpc2 photometry , taken from the sauron representative sample ( de zeeuw et al .",
    "these models will be presented elsewhere .",
    "we have generally found that the rms error of our mge models is dominated by the noise or by intrinsic asymmetries in the photometry , and is of the order of @xmath94 per cent or less . in most cases",
    "a good fit is obtained in about one minute on the same 1 ghz machine that took many hours to obtain a poorer fit with the brute force approach .",
    "we notice that the adopted mge fit approach also has the advantage that it is very simple to fit together multiple photometric profiles obtained from different images .",
    "it is also easy to combine high resolution images with published photometric profiles at large radii .",
    "in fact during the fit the program only needs to know the measured values of the surface brightness and the corresponding polar coordinates , and does not have to deal with multiple images directly .      an alternative approach to the 2d mge fit of an image , using gaussians with the same pa and the same centre , consists of transforming the whole problem into a nnls problem , that can be solved with the _ ad - hoc _ lawson & hanson ( 1974 ) algorithm .",
    "this can be done by generating a large grid of all possible gaussians that may end up in the final solution .",
    "we sample @xmath11 logarithmically with @xmath75 ; for every choice of @xmath11 we sample @xmath82 linearly with @xmath83 .",
    "the non - negative superposition of the gaussians that best fit the data is then found with nnls .",
    "this approach is memory intensive since a copy of the data has to be kept in memory for every gaussian in the grid : a @xmath95 grid requires @xmath96 copies of the photometric data , yet it is already feasible if only the sectors are used .",
    "the advantage of this method is that it is _ guaranteed _ to find the lowest @xmath0 solution ( although it may not be unique ) within the accuracy imposed by the adopted grid of gaussians .",
    "a big disadvantage is that in practice many more gaussians are used by the nnls algorithm to produce a fit with the same @xmath0 as found with our nonlinear algorithm of section  [ sec:2d ] .",
    "this is in general an important point , since one often needs to use the mge parametrization to perform subsequent calculations whose speed depends on the number of gaussians : the computation of the potential scales linearly with the number @xmath8 of gaussians , while for example the solution of the jeans equations scales as @xmath97 ( emsellem et al .",
    "1994a ) .    as an example we have used a @xmath95 grid of @xmath98 values ( @xmath96 gaussians ) to produce an mge model for ngc  4342 using the same input photometry of section  [ sec:2d ] .",
    "the nnls algorithm gave a best solution with 38 positive gaussians and an error only slightly smaller than that of the 13 gaussians nonlinear solution of fig .",
    "[ fig : n4342_profiles ] ( rms error of 1.7 per cent , to be compared with 1.8 per cent for the nonlinear solution ) .",
    "since the nnls solution is ill - conditioned it may be possible to extract a subsample from the 38 gaussians that gives essentially the same @xmath99 of the best solution .",
    "in particular one would like to find the _",
    "smallest _ set of gaussians that still verifies @xmath100 , where @xmath101 represents a chosen fractional tolerance .",
    "unfortunately this is a combinatorial minimization problem whose exact solution would require ( today ) a very large amount of time even with 38 gaussians .",
    "we have thus adopted the following approximate method :    1 .",
    "solve the nnls problem obtained by fitting the whole @xmath98 grid of gaussians @xmath102 to the photometric data and define @xmath103 ; 2 .   construct a set @xmath104 containing the positive gaussians @xmath102 from the previous solution , with @xmath105 ; 3 .   for",
    "@xmath105 solve a new nnls problem , excluding @xmath102 from @xmath104 , and record the @xmath106 obtained in the solution .",
    "define @xmath107 ; 4 .   if @xmath108 , where @xmath101 is the maximum accepted fractional error in @xmath0 , then eliminate @xmath102 from @xmath104 , update the number @xmath109 , and go back to step ( iii ) , otherwise return @xmath104 .    running the above fully linear algorithm , we have been able to find ( in a time 400@xmath110 longer ) a set of 14 gaussians that produced a @xmath0 , in the ngc  4342 fit , not larger than that of the 13 gaussians nonlinear solution .",
    "in general we have found that this linear algorithm is not competitive , both in speed and number of gaussians for a given @xmath0 , with the one described in section  [ sec:2d ] .",
    "its extreme robustness however is very attractive and it can be very useful to test that a given solution can not be significantly improved , or in cases where the final number of gaussians is not an issue .    the solution obtained by the fully linear mge fitting method can be further improved by the nonlinear fitting method and the steps ( ii)-(iv ) outlined above can be iterated once more .",
    "we have implemented all this and found that it works very well , although the extra complication of combining the two methods is not required most of the times .      in sections  [ sec:2d][sec:2d_lin ]",
    "we have shown how to fit mge models to galaxies having isophotes with four - fold symmetry ( constant pa with radius ) . here",
    "we briefly discuss how to produce an mge fit to galaxies whose isophotes twist with radius .",
    "the extension of the nonlinear fitting method of section  [ sec:2d ] to galaxies with isophote pa that varies with radius comes very natural from the previous discussion .",
    "it has been shown that , in a single component object like an elliptical , every gaussian contributes to the surface brightness essentially only at an elliptical radius @xmath111 close to its @xmath56 .",
    "consider for simplicity the case of constant axial ratio @xmath32 .",
    "as before the @xmath11 will have to be logarithmically spaced and all the @xmath82 can be set equal to a representative galaxy axial ratio .",
    "a very good starting guess for pa @xmath12 of the gaussian @xmath102 will then be given by the pa of the isophote with semimajor axis @xmath112 .",
    "the pa at the various radii can be measured before fitting with standard photometry packages . as before for the constant - pa fitting problem , the starting guess with constant axial ratio provides a good approximation to the actual model fit with varying isophote ellipticity and the nonlinear optimisation method converges to the global minimum .",
    "[ fig : n5831_profiles ] presents the profiles of the @xmath85 gaussians mge best - fitting model for a wfpc2/f702w image of the elliptical ( e3 ) galaxy ngc  5831 , that presents a @xmath113 isophote twist in the range @xmath114 ( peletier et al .",
    "1990 ; binney & merrifield 1998 , figure 4.37 ) .",
    "the profiles have been measured along 36 sectors @xmath80 wide , covering the whole galaxy image from @xmath115 to @xmath89 .",
    "since we are fitting a centre - symmetric model , the counts measured within sectors symmetric with respect to the centre have been averaged before fitting .",
    "a very good mge model can be obtained for this galaxy . as expected , although the pa is different for the various fitted components , the gaussians succession is still regular and predictable as in the case of constant pa of fig .",
    "[ fig : m32_profiles ] . a comparison between the contours of the data and of the convolved mge model is shown in fig .  [ fig : n5831_contours ] .     for the @xmath85 gaussians mge fit to the wfpc2/f702w photometry of ngc  5831 .",
    "only 6 equally spaced representative profiles are shown , of the @xmath116 sectors actually used in the fit .",
    "@xmath88 corresponds to the pa of the central isophotes .",
    "the rms error is 1.2 per cent.,title=\"fig : \" ]    @xmath110160@xmath117 ( 1000 s ) wfpc2/f702w image of elliptical galaxy ngc  5831 .",
    "note the @xmath113 isophote twist of this galaxy .",
    "overlaid are the contours of the mge best - fitting model whose profiles are shown in fig .",
    "[ fig : n5831_profiles].,title=\"fig : \" ]    fig .",
    "[ fig : n2950 ] shows an mge fit to the central region of the s0 barred galaxy ngc  2950 .",
    "this object presents a sharp @xmath118 isophote twist inside the central @xmath119 , due to the presence of a double bar component ( friedli et al .",
    "1996 ; rest et al .",
    "an @xmath120 gaussians mge model is able to reproduce very well the central surface brightness of this object , including the strongly twisted and non elliptical isophotes , with the exception of the slightly `` spiral - like '' isophote shape that peaks at an elliptical radius of @xmath121 and is clearly visible from the contour plot .",
    "@xmath11034@xmath117 of the ( 730 s ) wfpc2/f814w ( @xmath84-band ) image of the barred s0 galaxy ngc  2950 .",
    "the best - fitting mge model is overlaid .",
    "note the sharply twisted and non elliptical isophotes due to a double bar within this galaxy .",
    "@xmath120 gaussians have been used in the mge model and the resulting rms error is 2.1 per cent.,title=\"fig : \" ]    the fully - linear mge fitting method of section  [ sec:2d_lin ] can also be easily extended to deal with isophote twisting . it is simply necessary to add gaussians with a range of pa @xmath28 , linearly spaced from @xmath115 to @xmath89 , in the representative library of gaussian , for every @xmath98 combination .",
    "the nnls fit to the photometry will be performed with a three - dimensional grid @xmath122 of gaussians .",
    "the only problem of this approach is that the memory requirements will increase considerably , but a 30@xmath11030@xmath11030 grid of gaussians can already be solved with current averages pcs .",
    "the complete idl source code implementing the linear and nonlinear mge fitting algorithms , described in this paper , both with and without isophote twist , together with manual and usage examples , can be found at http://www.strw.leidenuniv.nl/@xmath123mcappell/idl .",
    "the mge method is one of the few simple parametrizations that are general enough to reproduce the surface brightness of realistic multicomponent galaxies . in addition",
    "many dynamical and photometric quantities can be evaluated easily and accurately when the density is expressed in mge form .    in this paper",
    "we have described a simple yet powerful algorithm that reduces the process of generating an mge fit to multiple galaxy images to a simple , fast and automatic task .",
    "we have provided examples of its practical use and have tested it by accurately reproducing the photometry of a relatively large sample of galaxies , both with and without isophote twists .",
    "we have also compared some of our fits with previously obtained photometric models .",
    "we have also described an alternative algorithm that , although currently less practical , due to the larger computing power requirements , is guaranteed to converge to the minimum @xmath0 solution within the accuracy imposed by an adopted grid of parameters in the solution space .",
    "these algorithms have been implemented in an idl program that can produce an mge model starting from the observed images of a galaxy , requiring the user to only input the coordinates of the galaxy centre , the pa and a characteristic flattening .",
    "multiple resolution images ( e.g. , ground - based and hst ) can easily be fitted together , in one single step . the complete idl source code implementing the algorithms described in this paper is made publicly available .",
    "it is a pleasure to thank eric emsellem for stimulating discussions that provided the motivation to undertake this project .",
    "i wish to thank tim de zeeuw and ellen verolme for careful reading of the manuscript and very useful comments and suggestions .",
    "i thank the anonymous referee for constructive comments .",
    "i am grateful to jos funes and alessandro pizzella for obtaining the ccd image shown in fig .",
    "[ fig : ngc4698_mge ] and to claudia scarlata for providing the reduced version of it .",
    "that image was obtained with the vatt : the alice p.  lennon telescope and the thomas j.  bannan astrophysics facility ."
  ],
  "abstract_text": [
    "<S> we describe a simple , efficient , robust and fully automatic algorithm for the determination of a multi - gaussian expansion ( mge ) fit to galaxy images , to be used as a parametrization for the galaxy stellar surface brightness . in most cases </S>",
    "<S> the least - squares solution found by this method essentially corresponds to the _ minimax _ , constant relative error , mge approximation of the galaxy surface brightness , with the chosen number of gaussians . </S>",
    "<S> the algorithm is well suited to be used with multiple resolution images ( e.g. , _ </S>",
    "<S> hubble space telescope _ [ hst ] and </S>",
    "<S> ground - based ) . </S>",
    "<S> it works orders of magnitude faster and is more accurate than currently available methods . an alternative , more computing intensive , fully linear algorithm , that is _ guaranteed _ to converge to the smallest @xmath0 solution , is also discussed . </S>",
    "<S> examples of mge fits are presented for objects with hst or ground - based photometry , including galaxies with significant isophote twist .    </S>",
    "<S> [ firstpage ]    galaxies : kinematics and dynamics  galaxies : structure  techniques : image processing </S>",
    "<S>  stellar dynamics </S>"
  ]
}