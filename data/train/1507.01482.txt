{
  "article_text": [
    "in this paper by a graph we always mean _ an undirected _ graph , i.e.  a graph @xmath1 consists of a set of vertices @xmath2 together with _",
    "a symmetric _ set of edges @xmath3 .    as usual",
    "we say that a subset @xmath4 is _ homogeneous _ if either @xmath5 for all @xmath6 or @xmath7 for all @xmath6 , i.e.  the induced graph on @xmath8 is either complete or empty ( we ignore the diagonal ) .    a classical theorem of erds - szekeres  @xcite states that every graph on @xmath9 vertices contains a homogeneous subset of size at least @xmath10 ( all @xmath11 s are of base two ) , and this bound is tight up to a constant multiple .",
    "since the families of graphs with a forbidden induced subgraph have much stronger structural properties than arbitrary graphs , they have much bigger homogeneous subsets .    for any finite graph @xmath12",
    "there is a constant @xmath13 such that every @xmath12-free finite graph on @xmath9 vertices contains a homogeneous subset of size at least @xmath14 .",
    "however the following conjecture is widely open ( see e.g. @xcite ) .    * erds - hajnal conjecture . * for every finite graph @xmath12 there is a constant @xmath15 such that every @xmath12-free graph on @xmath9 vertices has a homogeneous subset of size at least @xmath16 .    in the bi - partite case one",
    "has better bounds .",
    "let @xmath1 be a graph .",
    "we say that a pair of subsets @xmath17 is _ homogeneous _ if either @xmath18 or @xmath19 .    for any finite graph @xmath12",
    "there is a constant @xmath15 such that every @xmath12-free graph on @xmath9 vertices has a homogeneous pair @xmath20 with @xmath21 .",
    "the following definition is taken from @xcite .",
    "let @xmath22 be a class of finite graphs    1 .",
    "@xmath22 has the _ erds - hajnal property _ if there is @xmath23 such that every @xmath24 has a homogeneous subset @xmath8 of size @xmath25 2 .",
    "@xmath22 has the _ strong erds - hajnal property _ if there is @xmath23 such that every @xmath26 has a homogeneous pair @xmath20 with @xmath27 .",
    "[ rem : strong eh implies eh ] is is shown in @xcite that if a family of finite graphs @xmath22 has the strong erds - hajnal property and is closed under taking induced subgraphs then it has the erds - hajnal property .    in this paper",
    "we consider families of graphs whose edge relations are given by a fixed definable relation in a first - order structure .",
    "let @xmath28 be a first - order structure and @xmath29 be a definable relation .",
    "consider the family @xmath30 of all finite graphs @xmath31 where @xmath32 is a finite subset and @xmath33 .",
    "we say that @xmath34 satisfies the _ ( strong ) erds - hajnal property _ if the family @xmath30 does .",
    "we extend this notion to the bi - partite case .",
    "let @xmath28 be a first - order structure and @xmath35 a definable relation .    1 .",
    "a pair of subsets @xmath36 is called _ @xmath34-homogeneous _ if either @xmath37 or @xmath38 .",
    "we say that the relation @xmath34 satisfies the _ strong erds - hajnal property _ if there is a constant @xmath39 such that for any finite subsets @xmath40 , @xmath41 there are @xmath42 , @xmath43 with @xmath44 , @xmath45 , and the pair @xmath46 is @xmath34-homogeneous .",
    "our motivation for this work comes from the following remarkable theorem by alon et al .",
    "[ thm : semialg - ramsey ] if @xmath47 is a semialgebraic relation then @xmath34 has the strong erds - hajnal property .    a.   although it is not stated explicitly in @xcite , but can be easily derived from the proof , homogeneous pairs in the above theorem can be chosen to be relatively uniformly definable .",
    "b.   the above theorem was generalized by basu ( see @xcite ) to ( topologically closed ) relations definable in arbitrary o - minimal expansions of real closed fields .",
    "besides the erds - hajnal property for semialgebraic graphs , the above theorem has many other applications including unit distance problems @xcite , improved bounds in higher dimensional semialgebraic ramsey theorem @xcite , ( * ? ? ?",
    "* theorem 1.2 ) , algorithmic property testing @xcite , and can also be used to obtain a strong szemerdi - type regularity lemma for semialgebraic graphs @xcite ( see also section  [ sec : distal regularity ] ) .",
    "the aim of this article is to demonstrate that the above result by alon et al .",
    ", along with its key implications , holds at a much larger level of generality , namely for families of graphs whose edge relation is definable in a structure satisfying a certain model theoretic property called _ distality _ ( see section [ sec : distality ] ) and with respect to the class of the so - called _ generically stable _ measures ( as opposed to just the counting ones , see section  [ sec : gen stab meas ] ) . in particular , this applies to graphs definable in arbitrary o - minimal structures and in @xmath0-adics with analytic expansions , with respect to the lebesgue ( respectively , haar ) measure on a compact interval ( respectively , compact ball ) .",
    "the following is one of the key results of our paper ( see theorem  [ thm : delta - main ] ) .",
    "[ thm : intro - main ] let @xmath28 be a distal structure , and @xmath48 a definable relation . then there is a constant @xmath39 such that for any generically stable measures @xmath49 on @xmath50 and @xmath51 respectively there are definable sets @xmath52 , @xmath53 with @xmath54 , @xmath55 , and the pair @xmath56 is @xmath34-homogeneous .",
    "it is not hard to see that our theorem  [ thm : intro - main ] implies theorem  [ thm : semialg - ramsey ] , by taking @xmath28 to be the ordered field of real numbers , and considering measures concentrated on finite sets .",
    "thus distal structures provide a natural framework for a model theoretic approach to ramsey - type results in geometric combinatorics .",
    "it is demonstrated by malliaris - shelah in @xcite ( see also @xcite for an alternative proof ) that if @xmath28 is a stable structure and @xmath29 is a definable relation then the family of finite graphs @xmath30 has the erds - hajnal property .",
    "however in general this family does not have the _",
    "strong _ erds - hajnal property ( see section  [ sec : failure in acfp ] ) .",
    "our proof of theorem [ thm : intro - main ] ( and the density version in corollary [ cor : density extra parameters ] ) gives explicit bounds on @xmath57 and the number of the parameters in the definitions of @xmath58 and @xmath59 in terms of the vc - density of the edge relation @xmath34 .",
    "in particular , for @xmath60-minimal structures and for @xmath0-adics , we obtain a bound in terms of the number of variables involved in @xmath34 , due to the corresponding bounds for vc - density from @xcite .",
    "we were informed by pierre simon that after reading our paper he had found another proof of this result which is faster , but does not give bounds .    a brief summary of the paper . in section  [ sec : prelims ]",
    "we introduce the context and the notation : first - order structures and definable sets , distality , keisler measures and generic stability . in section  [ sec : basicramsey ] we prove a definable generalization of theorem [ thm : semialg - ramsey ] for bi - partite graphs . in section  [ sec : density distal ramsey ] we improve it to a density version , using which we obtain an analogue for hypergraphs and a version allowing additional parameters in the definition of the edge relation .",
    "this gives in particular a lot of new families of graphs satisfying the strong erds - hajnal property ( see example  [ ex : non - distal structures satisfying * ] ) . in section  [ sec : distal regularity ]",
    "we obtain a strong regularity lemma for hypergraphs definable in distal structures , generalizing the result for semialgebraic hypergraphs from @xcite .",
    "in section  [ sec : equiv to distality ] we consider the converse to our results from the previous sections .",
    "first , in section  [ sec : failure in acfp ] we demonstrate a very explicit failure of the definable counterpart of theorem  [ thm : semialg - ramsey ] in the theory of algebraically closed fields of positive characteristic , even without requiring definability of the homogeneous subsets .",
    "it follows in particular that every field interpretable in a distal structure is of characteristic @xmath61 . in section  [ sec : equivalence to distality ] we prove that distality of a structure is in fact equivalent to the definable counterpart of theorem  [ thm : semialg - ramsey ] .",
    "some further questions concerning incidence phenomena and higher - dimensional ramsey theory in our setting will be addressed in a future paper .",
    "we thank pierre simon for pointing out a mistake in an earlier version of our results .",
    "we thank dave marker , kobi peterzil , caroline terry , roland walker and the anonymous referee for their numerous comments that have helped to improve the presentation .    the work presented in this paper began during the program on model theory , arithmetic geometry and number theory at msri , berkeley , spring 2014 .",
    "we thank msri for its hospitality .",
    "the first author was partially supported by valcomo ( anr-13-bs01 - 0006 ) , by the fondation sciences mathematiques de paris ( fsmp ) and by a public grant overseen by the french national research agency ( anr ) as part of the investissements davenir program ( reference : anr-10-labx-0098 ) .",
    "the second author was partially supported by nsf .",
    "we assume familiarity only with the very basic notions of model theory such as first - order structures and formulas that can be found in any introductory model theory book ( e.g. @xcite ) . by a structure",
    "we always mean a first - order structure .",
    "our notations are standard",
    ". we will denote first - order structures by script letters @xmath62 , etc .",
    ", and use letter @xmath63 etc . to denote their underlying sets . very often we will not distinguish singletons and tuples : e.g.   we may use @xmath64 to denote a tuple of variables @xmath65 , use @xmath66 to denote an element of @xmath50 , and then we use @xmath67 to denote the length of the tuple @xmath68 .    if @xmath28 is a structure and @xmath69 is a formula in the language of @xmath28 , then for @xmath70 , as usual , by @xmath71 we will denote the subset of @xmath72 defined by @xmath73 , namely @xmath74 .    a subset @xmath75 is called _ definable _ if there is a formula @xmath69 and @xmath70 such that @xmath76 ; if we want to specify the set of parameters , then for @xmath77 a definable subset @xmath75 is called @xmath58-definable ( or definable over @xmath58 ) if we can choose @xmath66 as above in @xmath78 .",
    "also if we want to specify @xmath79 we say that such a set @xmath80 is @xmath79-definable .",
    "vapnik  chervonenkis dimension , or vc - dimension , is an important notion in combinatorics and statistical learning theory .",
    "let @xmath80 be a set , finite or infinite , and let @xmath81 be a family of subsets of @xmath80 .",
    "given @xmath82 , we say that it is _ shattered _ by @xmath81 if for every @xmath83 there is some @xmath84 such that @xmath85 .",
    "a family @xmath81 is said be a _ vc - class _ if there is some @xmath86 such that no subset of @xmath80 of size @xmath9 is shattered by @xmath81 . in this case",
    "_ the vc - dimension of @xmath81 _ , that we will denote by @xmath87 , is the smallest integer @xmath9 such that no subset of @xmath80 of size @xmath88 is shattered by @xmath89 . for a set @xmath90 ,",
    "let @xmath91 and let @xmath92 .",
    "[ fac : sauershelah ] if @xmath93 then for @xmath94 we have @xmath95 .    if @xmath96 is a subset and @xmath97 , we let @xmath98 ( we do nt assume that the points @xmath99 are distinct ) .",
    "[ vc - theorem ] for any @xmath100 and @xmath101 there is @xmath102 satisfying the following . for any _ finite _ probability space @xmath103 and a family @xmath81 of subsets of @xmath80 of vc - dimension @xmath104 , there are some @xmath105 such that for any @xmath84 we have @xmath106 .",
    "an important class of nip theories was introduced by shelah in his work on the classification program @xcite .",
    "it has attracted a lot of attention recently , both from the point of view of pure model theory and due to some applications in algebra and geometry .",
    "we refer to @xcite for an introduction to the area .",
    "as was observed early on in @xcite , the original definition of nip is equivalent to the following one ( see @xcite for a more detailed account ) .",
    "let @xmath107 be a complete theory and @xmath69 a formula in @xmath107 , where @xmath108 are tuples of variables , possibly of different length .",
    "we say that _ the formula @xmath69 is nip _ if there is a model @xmath28 of @xmath107 such that the family of sets @xmath109 is a vc - class .",
    "in this case we define the vc - dimension of @xmath69 to be the vc - dimension of this class .",
    "( it is easy to see that by elementarily equivalence the above does not depend on the model @xmath28 of @xmath107 . )    _ a theory @xmath107 is nip _ if all formulas in @xmath107 are nip .    slightly abusing terminology",
    "we say that a structure @xmath28 is nip if its complete theory @xmath110 is nip .",
    "restated differently , a structure @xmath28 is _ an nip structure _ if for every formula @xmath69 the family of @xmath79-definable sets @xmath111 is a vc - class .",
    "given a set of formulas @xmath112 and a set @xmath113 , we say that @xmath114 is a _",
    "@xmath115-type over @xmath59 _ if @xmath116 and there is some @xmath117 and some @xmath118 satisfying simultaneously all formulas from @xmath114 . by a _ complete _ @xmath115-type over @xmath59 we mean a maximal @xmath115-type over @xmath59 .",
    "we will denote by @xmath119 the collection of all complete @xmath115-types over @xmath59 . in view of the remarks above ,",
    "the following is an immediate corollary of the sauer - shelah lemma .",
    "[ fac : polytypesnip ] a structure @xmath28 is nip if and only if for any finite set of formulas @xmath112 there is some @xmath120 such that @xmath121 for any finite @xmath113 .",
    "the class of distal theories is defined and studied in @xcite , with the aim to isolate the class of purely unstable nip theories ( as opposed to the class of stable theories which are always nip , see also @xcite ) .",
    "the original definition is in terms of some properties of indiscernible sequences , but the following explicit combinatorial characterization of distality given in @xcite can be used as an alternative definition .",
    "[ stronghonestdef ] let @xmath107 be a complete nip theory and @xmath28 a model of @xmath107 .",
    "the following are equivalent .    1",
    ".   @xmath107 is distal ( in the sense of the original definition , see fact  [ fac : distality indiscernibles ] ) .",
    "2 .   for every formula @xmath69 there is a formula @xmath122 with @xmath123 such that : for any finite @xmath113 with @xmath124 and any @xmath125 , there are @xmath126 such that @xmath127 and @xmath128 ( i.e.   for any @xmath129 either @xmath130 or @xmath131 ) .",
    "[ srem : distal - one ] it is not hard to see that if @xmath28 satisfies fact  [ stronghonestdef](2 ) for all formulas @xmath69 with @xmath132 then it satisfies it for all formulas , i.e. @xmath28 is distal .",
    "besides , any @xmath28 satisfying [ stronghonestdef](2 ) is automatically nip ( easy to see using the equivalence from fact  [ fac : polytypesnip ] ) , so the assumption that @xmath28 is nip in fact  [ stronghonestdef ] is used to deduce ( 2 ) from ( 1 ) .    [ rem : udtfs ] an immediate corollary of fact  [ stronghonestdef](2 ) is that in a distal structure , for any formula @xmath69 there is a formula @xmath133 such that for any finite @xmath113 with @xmath124 and @xmath125 , there are some @xmath134 such that @xmath135 .",
    "namely , one can take @xmath136 .",
    "in fact , this corollary characterizes nip ( see @xcite for the details ) .",
    "we list some examples of distal structures ( providing more details than we normally would , for the sake of a non model - theorist reader ) .      a structure @xmath137 is o - minimal if every definable subset of @xmath138 is a finite union of singletons and intervals ( with endpoints in @xmath139 ) . from this assumption one",
    "obtains cell decomposition for definable subsets of @xmath140 , for all @xmath9 .",
    "moreover , a cell decomposition of a definable set is uniformly definable in terms of its definition ( see @xcite for a detailed treatment of o - minimality , or ( * ? ? ?",
    "* section 3 ) and references there for a quick introduction ) .",
    "examples of o - minimal structures include @xmath141 , @xmath142 , @xmath143^k}\\right)$ ] for @xmath144 ranging over all functions real - analytic on some neighborhood of @xmath145^k$ ] , or the combination of both @xmath146 .",
    "it is straightforward to verify that if @xmath28 is o - minimal then it satisfies fact  [ stronghonestdef](2 ) for all formulas @xmath69 with @xmath132 .",
    "[ sample - real ] the field of reals @xmath147 .    by tarski",
    "s quantifier elimination , for each @xmath9 the definable subsets of @xmath148 are exactly the semialgebraic sets , namely finite boolean combinations of sets defined by polynomial equations @xmath149 and inequalities @xmath150 for @xmath151 $ ] .",
    "it is o - minimal , and so distal .",
    "more generally , it is proved in @xcite that every ordered dp - minimal structure is distal ( see fact  [ fac : dp - min distal totally indisc ] ) .",
    "examples of ordered dp - minimal structures include weakly o - minimal structures and quasi - o - minimal structures .",
    "an ordered structure @xmath28 is weakly o - minimal ( quasi - o - minimal ) if in every elementary extension , every definable subset is a finite union of convex subsets ( respectively , a finite boolean combination of singletons , intervals and @xmath152-definable sets @xcite ) .",
    "[ sample : integers ] @xmath153 as an ordered group .    by presburger",
    "s quantifier elimination , for each @xmath9 the definable subsets of @xmath154 are finite boolean combinations of sets of the following types : @xmath155 @xmath156 @xmath157 for @xmath158 and @xmath159 . this structure is quasi - o - minimal ( see ( * ? ? ?",
    "* example 2 ) ) .",
    "[ ex : rcvf]the _ valued field @xmath160 of puiseux power series over @xmath147 , in the language @xmath161 .",
    "_    using quantifier elimination from @xcite , for each @xmath9 the definable subsets of @xmath162 ( in the language of valued fields ) are finite boolean combinations of sets of the following types : @xmath163 @xmath164 @xmath165 for @xmath166 $ ] and @xmath159 .",
    "this structure is a model of the complete theory rcvf of real closed fields equipped with a proper convex valuation ring , and by @xcite it is weakly o - minimal .",
    "[ sample : qp ] by a result of macintyre @xcite the field of @xmath0-adics @xmath167 eliminates quantifiers in the language @xmath168 , where for @xmath169 we have @xmath170 .",
    "it follows that for each @xmath9 the definable subsets of @xmath171 are finite boolean combinations of sets of the following three types : @xmath172 @xmath173 @xmath174 for @xmath175 $ ] and @xmath159 .    similarly to the o - minimal case ,",
    "there is a notion of minimality for expansions of @xmath167 .",
    "namely , a structure @xmath28 in a language @xmath176 is @xmath0-minimal if in every model of @xmath177 , every definable subset in one variable is quantifier - free definable just using the language @xmath178 @xcite .",
    "@xmath179-minimal structures with an additional assumption of definability of skolem functions satisfy an analogue of the @xmath0-adic cell decomposition of denef .",
    "a motivating example of a @xmath0-minimal theory with definable skolem functions is the theory @xmath180 of the field of @xmath0-adic numbers @xmath167 expanded by all sub - analytic subsets of @xmath181 @xcite .    by ( * ?",
    "* corollary 7.8 ) , every @xmath0-minimal structure with definable skolem functions is dp - minimal .",
    "since @xmath182 is distal @xcite ( can be also verified using fact  [ fac : dp - min distal totally indisc ] ) , it follows by remark  [ rem : dp - min dist exp ] that any @xmath0-minimal theory with skolem functions is distal .",
    "let @xmath28 be a structure .",
    "recall that a _ keisler measure _ on @xmath50 is a finitely additive probability measure on the boolean algebra of all definable subsets of @xmath50 , i.e.   it is a function @xmath183 that assigns to every definable @xmath75 a number @xmath184 $ ] with @xmath185 , @xmath186 and @xmath187 for all definable subsets @xmath188 . given a formula @xmath189 with parameters from @xmath138 and a keisler measure @xmath183 on @xmath72",
    ", we will write @xmath190 to denote @xmath191 .    in this paper we will deal mostly with the so - called generically stable and smooth keisler measures .    _",
    "generically stable measures on @xmath50 _ are defined as keisler measures on @xmath50 admitting a ( unique ) global @xmath138-invariant extension which is both finitely satisfiable in @xmath138 and definable over @xmath138 ( see remark [ rem : definable measure def ] ) . in the nip case , according to the following fact from ( * ? ? ?",
    "* theorem 3.2 ) ( see also ( * ? ? ?",
    "* section 7.5 ) ) , they can also be defined in terms of the structure @xmath192 alone without mentioning global measures .",
    "[ genstable ] let @xmath192 be an nip structure and @xmath183 a keisler measure on @xmath193 .",
    "then the following are equivalent .    1 .",
    "the measure @xmath183 is generically stable .",
    "2 .   for every formula @xmath69 with @xmath194 and @xmath195",
    "there are some @xmath196 such that @xmath197 for any @xmath198 .",
    "the vc - theorem implies that in nip theories , for _ any _ keisler measure , a uniformly definable family of sets admits an @xmath199-approximation by types ( see ( * ? ? ?",
    "* section 4 ) ) .",
    "fact  [ genstable](2 ) implies that with respect to a generically stable measure , there are @xmath199-approximations by _ elements _ of a model rather than just by types over it .",
    "we remark that the bound on the size of @xmath199-approximations depends just on the vc - dimension of the formula ( so uniform over all generically stable measures ) .",
    "[ uniformepsilonnetgenstable ] let @xmath28 be an nip structure .",
    "then for any @xmath200 and any @xmath101 there is some @xmath201 such that : for any formula @xmath69 of vc - dimension at most @xmath202 and any generically stable measure @xmath183 on @xmath72 , there are some @xmath203 such that for any @xmath198 , @xmath204 .",
    "let @xmath205 be given for @xmath202 and @xmath199 by fact  [ vc - theorem ] .",
    "let @xmath69 be a formula of vc - dimension at most @xmath202 and @xmath183 an arbitrary generically stable measure on @xmath72 .",
    "by fact  [ genstable](2 ) there are some @xmath206 such that for any @xmath207 we have @xmath208 , where @xmath209 .",
    "now applying fact  [ vc - theorem ] to @xmath210 , we find some @xmath203 such that for all @xmath211 , @xmath212 .",
    "then @xmath213 for all @xmath198 , as wanted .",
    "[ vcforsetsofformulas ] encoding several formulas into one we can replace a single formula @xmath69 in proposition  [ uniformepsilonnetgenstable ] by a finite set of formulas @xmath112 .",
    "recall that a keisler measure @xmath183 on @xmath50 is called _ smooth _ if there is a unique global keisler measure extending it .",
    "the following equivalence can be used to avoid a reference to global measures in the definition of smoothness .",
    "[ non - uniform epsilon - net for smooth ] a keisler measure @xmath183 on @xmath50 is smooth if and only if the following holds .",
    "+ for any formula @xmath69 with @xmath214 and @xmath101 there are some formulas @xmath215 and @xmath216 with parameters from @xmath138 , for @xmath217 , such that :    1 .",
    "the sets @xmath218 partition @xmath219 , 2 .",
    "@xmath220 and @xmath198 , if @xmath221 , then @xmath222 3 .   for each @xmath220 , @xmath223",
    "every smooth measure is generically stable , and there are generically stable measures which are not smooth ( though every keisler measure in an nip theory can be extended to a smooth one , but over a larger set of parameters ) .",
    "however , we have the following characterization from @xcite .",
    "[ fac : distal iff gen stable is smooth ] let @xmath107 be nip .",
    "then the following are equivalent :    1 .",
    "@xmath107 is distal .",
    "2 .   for any model @xmath28 of @xmath107 , any generically stable measure on @xmath50",
    "is smooth .",
    "[ rem : localizing generic stability ] let @xmath183 be a keisler measure on @xmath50 and @xmath52 a definable subset with @xmath224",
    ". then we can localize @xmath183 to @xmath58 by defining @xmath225 .",
    "clearly @xmath226 is a keisler measure on @xmath50 and @xmath226 is generically stable ( smooth ) provided @xmath183 is .",
    "let @xmath28 be a structure , @xmath227 a keisler measure on @xmath51 and @xmath228 a keisler measure on @xmath50 .",
    "a keisler measure @xmath183 on @xmath229 is called _ a product measure of @xmath227 and @xmath228 _ if for any definable subsets @xmath230 , @xmath231 we have @xmath232 .",
    "we can extend this notion to finitely many keisler measure @xmath233 on @xmath234 in an obvious way .",
    "a product keisler measure always exists but in general is not unique .",
    "however , for smooth measures we have the following proposition that follows from ( * ? ? ?",
    "* corollary 2.5 ) .",
    "[ prop : unique smooth amalgam ] let @xmath28 be a structure , @xmath227 a smooth keisler measure on @xmath51 and @xmath228 a smooth keisler measure on @xmath50 . then there is a unique product measure of @xmath227 and @xmath228 and this measure is also smooth .    in the case of smooth measures @xmath227 and @xmath228",
    "we will denote their unique product measure as @xmath235 .",
    "let @xmath236 be pairwise disjoint tuples of variables , and @xmath183 a keisler measure on @xmath237 .",
    "then for each @xmath238 , @xmath183 induces a keisler measure @xmath233 on @xmath239 by @xmath240 and we will denote this @xmath233 by @xmath241 .",
    "it is easy to see that if @xmath183 is generically stable ( smooth ) then every @xmath242 is also generically stable ( smooth ) .",
    "+ also in this case we will call a keisler measure @xmath183 on @xmath237 _ a product measure _ if @xmath183 is a product of @xmath243 .    finally , we give some examples of smooth keisler measures .",
    "[ examplesofsmoothmeasures ]    1 .",
    "any keisler measure concentrated on a finite set ( as fact  [ genstable](2 ) is clearly satisfied ) .",
    "2 .   let @xmath244 be the lebesgue measure on the unite cube @xmath145^n$ ] in @xmath148 .",
    "let @xmath192 be an o - minimal structure expanding the field of real numbers .",
    "if @xmath245 is definable in @xmath192 , then , by o - minimal cell decomposition , @xmath246^n$ ] is lebesgue measurable , hence @xmath244 induces a keisler measure on @xmath50 .",
    "this measure is smooth by ( * ? ? ?",
    "* section 6 ) .",
    "3 .   similarly to ( 2 ) , for every prime @xmath0 a ( normalized ) haar measure on a compact ball in @xmath167 induces a smooth keisler measure on @xmath171 ( see ( * ? ? ?",
    "* section 6 ) ) .",
    "4 .   any definable ,",
    "definably compact group @xmath247 in an o - minimal structure or over the @xmath0-adics admits a unique @xmath247-invariant generically stable measure @xcite , which is then smooth by distality and fact  [ fac : distal iff gen stable is smooth ] .",
    "in this section we prove the key result of this paper .",
    "[ thm : delta - main ] let @xmath28 be a model of a distal theory , and @xmath48 a definable relation .",
    "then there is a constant @xmath39 and a pair of formulas @xmath248 , @xmath249 such that for any generically stable measures @xmath49 on @xmath50 and @xmath51 respectively , there are @xmath250 from @xmath28 with @xmath251 , @xmath252 , and the pair @xmath253 , @xmath254 is @xmath34-homogeneous .    as in @xcite",
    "the above theorem will follow from an asymmetric version ( see theorem [ basicpartitiongraphs ] below ) .",
    "let @xmath28 be a distal structure and we fix a formula @xmath69 .",
    "let @xmath255 be as given for @xmath69 by fact  [ stronghonestdef ] .",
    "for @xmath256 we will denote by @xmath257 the subset of @xmath72 defined by @xmath258 and call it _ a chamber_. if in addition @xmath259 then we say that @xmath257 is a @xmath59-definable chamber .    for a chamber @xmath260 and @xmath207",
    "we say that @xmath261 _ crosses @xmath262 _ if both @xmath263 and @xmath264 are nonempty .    for a chamber @xmath262 and a set @xmath59",
    "we will denote by @xmath265 the set of all @xmath266 such that @xmath261 crosses @xmath262 .",
    "note that @xmath267 is a definable set ( by a formula depending just on the formula @xmath268 defining @xmath262 ) .    for @xmath269",
    ", a chamber @xmath262 is called _ @xmath59-complete _ if @xmath262 is @xmath59-definable and @xmath270 .",
    "it follows from the choice of @xmath268 that for every finite @xmath269 and @xmath271 there is a @xmath59-complete chamber @xmath262 with @xmath272 .",
    "in particular , for any finite @xmath59 the union of all @xmath59-complete chambers covers @xmath72 .",
    "[ def:1r - cutting ] adopting a definition from @xcite , we define @xmath273-cutting as follows .",
    "let @xmath210 be a keisler measure on @xmath274 .",
    "for a positive @xmath275 we say that a family of chambers @xmath89 is a @xmath273-cutting with respect to @xmath210 if @xmath72 is covered by @xmath276 and for every @xmath277 we have @xmath278 .",
    "the following claim is an analogue of a cutting lemma from @xcite ( see also exercise 10.3.4(b ) there ) .",
    "[ crosscuttingexists]there is a constant @xmath279 such that the following holds . for any positive @xmath280 and for any generically stable measure @xmath210 on @xmath219",
    "there is a finite set @xmath281 such that the family of all @xmath282-complete chambers is a @xmath273-cutting with respect to @xmath210 , and the size of @xmath282 is bounded by @xmath283 .",
    "consider the family of sets @xmath284 it is a definable family , hence has a bounded vc - dimension by nip . applying proposition  [ uniformepsilonnetgenstable ] with @xmath285",
    "we obtain a subset @xmath281 of size at most @xmath286 , where @xmath279 is a constant that depends only on the vc - dimension of @xmath287 , such that for every @xmath138-definable chamber @xmath262 if @xmath288 then @xmath289 .",
    "since @xmath290 for any @xmath282-complete cell @xmath262 , we are done .",
    "the following theorem is an analogue of a result in ( * ? ? ?",
    "* section 6 ) .",
    "[ basicpartitiongraphs ] let @xmath28 be a distal structure and let @xmath291 be a definable relation .",
    "then for any @xmath292 there are some @xmath293 and formulas @xmath294 depending just on @xmath34 and @xmath295 such that :    for any keisler measure @xmath183 on @xmath72 and any generically stable measure @xmath210 on @xmath219 , there are some @xmath296 with @xmath297 , @xmath298 and the pair of sets @xmath299 is @xmath34-homogeneous .",
    "let @xmath69 be a formula defining @xmath34 .",
    "let @xmath280 be a positive real number that we will determine later .",
    "by claim  [ crosscuttingexists ] , let @xmath300 be a set of size at most @xmath283 such that for every @xmath282-complete chamber @xmath262 , @xmath301 .",
    "it is not hard to see that there is a constant @xmath302 and a number @xmath303 such the number of @xmath282-definable chambers is at most @xmath304 .",
    "thus the number of @xmath282-complete chambers is at most @xmath305 , where @xmath306 is a constant .",
    "as the set of @xmath282-complete chambers covers @xmath72 , there is an @xmath282-complete chamber @xmath307 with @xmath308 .    for the set @xmath309",
    ", we have @xmath310 and for every @xmath311 , @xmath312 does not cross @xmath307 .",
    "in particular all @xmath313 have the same @xmath79-type over @xmath314 .",
    "note that @xmath314 is a disjoint union of @xmath315 and @xmath316 , and both @xmath317 and @xmath318 are @xmath34-homogeneous .",
    "thus either @xmath319 or @xmath320 .",
    "let @xmath321 be the formula such that an instance of it defines @xmath307 , and let @xmath322 be the formula such that an instance of it defines either @xmath323 or @xmath324 , depending on which one has large measure . by assumption",
    "there are only finitely many choices for both depending on the original data .",
    "so given @xmath292 we can find @xmath280 with @xmath325 , and take any positive @xmath326 .",
    "then , encoding finitely many choices for @xmath327 into one formula we can conclude the theorem",
    ".    we can take any @xmath328 and let @xmath329 be as in theorem  [ basicpartitiongraphs ] .",
    "now take @xmath330 .",
    "we will see in corollary  [ cor : density extra parameters ] that one can allow an extra parameter in @xmath34 without affecting the uniform choice of @xmath327 .",
    "first we prove that theorem  [ thm : delta - main ] can be strengthened to a density version .",
    "it seems that this implication is folklore , as it is mentioned in ( * ? ? ?",
    "* corollary 7.1 and the remark afterwards ) without definability of the homogeneous subsets and stated in @xcite .",
    "however , the proofs in both places are very sketchy , so we give a complete proof verifying definability of homogeneous subsets , and in addition working with keisler measures .",
    "our argument is an elaboration on the proof of theorem 3.3 in @xcite .",
    "[ prop : densityforgraphs ] let @xmath28 be a distal structure and @xmath291 a definable relation .",
    "given @xmath331 there is @xmath195 such that for any keisler measure @xmath183 on @xmath72 , any generically stable measure @xmath210 on @xmath219 , and a product measure @xmath332 of @xmath183 and @xmath210 , if @xmath333 then there are uniformly definable ( in terms of @xmath329 and @xmath34 only ) @xmath334 and @xmath335 with @xmath336 , @xmath337 , and @xmath338 .",
    "we fix a distal structure @xmath28 and a definable relation @xmath291 . by theorem  [ thm : delta - main ]",
    "we know that there is a constant @xmath23 and formulas @xmath294 such that for any measure @xmath183 on @xmath72 and any generically stable measure @xmath210 on @xmath219 there are some @xmath339 and @xmath269 definable by an instance of @xmath340 and @xmath322 respectively , with @xmath341 and @xmath342 , such that either @xmath343 or @xmath344",
    ".    now we fix keisler measures @xmath345 as in the proposition and let @xmath332 be a product keisler measure of @xmath346 on @xmath347 .    for definable sets @xmath348 we denote by @xmath349 the density of @xmath34 in @xmath350 , namely @xmath351 and setting @xmath352 if @xmath353 .",
    "the following claim is a basic step .",
    "[ claim : basic - step ] let @xmath354 , @xmath269 be definable sets with @xmath355 .",
    "then there are subsets @xmath356 , @xmath357 defined uniformly ( in terms of @xmath58 , @xmath59 and @xmath34 ) such that @xmath358 , @xmath359 and @xmath360 .    using remark  [ rem : localizing generic stability ] we apply theorem  [ thm : delta - main ] to @xmath361  the localizations of @xmath183 on @xmath58 and @xmath210 on @xmath59 , respectively .",
    "this gives us @xmath362 , @xmath363 defined by instances of @xmath340 and @xmath322 respectively , such that for the sets @xmath364 , @xmath365 we have @xmath358 , @xmath359 and either @xmath360 or @xmath366 .",
    "if @xmath366 then @xmath367 contradicting the assumption @xmath355 .",
    "it is not hard to see that proposition  [ prop : densityforgraphs ] follows from claim [ claim : basic - step ] and the following claim by iterating sufficiently ( but boundedly ) many times and taking the conjunction of the corresponding defining formulas .",
    "[ claim : ind ] for any @xmath368 there is some @xmath369 such that for any definable @xmath58 and @xmath59 with @xmath370 there are uniformly definable ( in terms of @xmath34 , @xmath329 , @xmath58 , @xmath59 ) subsets @xmath83 @xmath371 with @xmath372 , @xmath373 and @xmath374 .",
    "we pick @xmath375 to be determined later .",
    "we choose @xmath42 , @xmath43 homogeneous with respect to @xmath34 and with @xmath376 and @xmath377 ( applying theorem  [ basicpartitiongraphs ] and remark  [ rem : localizing generic stability ] to @xmath361  the localizations of @xmath183 on @xmath58 and @xmath210 on @xmath59 , respectively ) .",
    "if @xmath378 then we take @xmath379 , @xmath380 , @xmath381 and we are done .",
    "so assume @xmath382    let @xmath383 and @xmath384 .",
    "let @xmath385 , so @xmath386 .    from it follows that @xmath387 .",
    "in particular at least one of @xmath388 or @xmath389 is at most @xmath390 .",
    "+ * we assume @xmath391 .",
    "*    let @xmath392 and @xmath393 .",
    "* case 1 : @xmath394 . * + for definable @xmath395 and @xmath371 we write @xmath396 for @xmath397 .",
    "since there are no @xmath34-edges between @xmath398 and @xmath399 we have @xmath400 we also have @xmath401    a very simple combinatorial statement is that if @xmath402 and @xmath403 then there is @xmath404 with @xmath405 .    so in this case we can choose @xmath406 and @xmath407 such that @xmath408 and @xmath409 , @xmath410 , where @xmath411    * case 2 : @xmath412 . *",
    "+ in this case we will take @xmath413 and @xmath414 . as above , let @xmath415 .",
    "let @xmath416 .",
    "the maximal possible measure of the set of @xmath34-edges between @xmath398 and @xmath59 is @xmath417    thus for the measure of the set of @xmath34-edges between @xmath418 and @xmath59 we obtain @xmath419    since @xmath420 we obtain    @xmath421    as @xmath422 decreases to @xmath423 , the right side of the above inequality goes increasingly to @xmath424 . since @xmath425 we have that @xmath426 .",
    "so we can choose @xmath427 so that for @xmath416 the right side is at least @xmath428 .",
    "combining the two cases together we take @xmath411    uniform definability of @xmath429 in all the cases follows from the uniform definability of @xmath46 and construction , so as always we can encode finitely many formulas into a single one .",
    "now we can use this proposition inductively to prove the analogue of proposition  [ prop : densityforgraphs ] for hypergraphs , essentially following the proof of ( * ? ? ? * theorem 8.2 ) .",
    "[ prop : densityramseyhypergraphs][hypergraphdensityversion ] let @xmath28 be a distal structure and @xmath430 a definable relation .",
    "given @xmath331 there is @xmath195 such that : given a generically stable product measure @xmath332 on @xmath431 with @xmath432 there are definable sets @xmath433 with @xmath434 for all @xmath435 such that @xmath436 . moreover ,",
    "each @xmath437 is defined by an instance of a formula that depends only on @xmath34 and @xmath329 .",
    "let @xmath438 be given , and assume inductively that we have proved the proposition for all @xmath439 .",
    "let @xmath440 and @xmath441 be given .",
    "let @xmath332 be a generically stable product measure on @xmath442 . applying proposition  [ prop : densityforgraphs ] with @xmath443 to the _ binary _ relation @xmath444 we find some @xmath445 , @xmath398 with @xmath446 and @xmath447 with @xmath448 such that @xmath34 holds on all elements of @xmath449 ( the corresponding projections of @xmath332 are clearly generically stable ) .",
    "moreover , @xmath450 for some uniformly definable ( depending only on @xmath34 and @xmath329 ) relation @xmath451 .",
    "we apply the inductive assumption to @xmath451 with @xmath452 , @xmath453 and @xmath454 , which gives us some @xmath455 and uniformly definable sets @xmath456 with @xmath457 and such that @xmath458 , which implies @xmath459 .",
    "take @xmath460 .",
    "all the data is chosen uniformly depending only on @xmath461 .",
    "the density version implies a generalization of theorem  [ basicpartitiongraphs ] for hypergraphs .",
    "[ densityforgraphs ] let @xmath28 be a distal structure and @xmath430 a definable relation .",
    "then there is @xmath462 such that for any generically stable measures @xmath233 on @xmath239 , there are @xmath437 with @xmath463 for all @xmath435 , uniformly definable in terms of @xmath34 , and such that either @xmath436 or @xmath464 .",
    "since a product of generically stable measures is generically stable , the measure @xmath465 is generically stable , and either @xmath466 or @xmath467 .",
    "applying proposition  [ hypergraphdensityversion ] with @xmath468 to @xmath34 and to @xmath469 we obtain some @xmath470 respectively .",
    "but then @xmath471 satisfies the conclusion .    besides",
    ", the formulas defining homogeneous subsets can be chosen depending just on the formula defining the edge relation , and not on the parameters used ( in the semialgebraic setting this corresponds to saying that the complexity of the homogeneous subsets is bounded in terms of the complexity of the edge relation , and does not depend on the choice of the coefficients of the polynomials involved ) .",
    "[ cor : density extra parameters ] let @xmath28 be a distal structure and @xmath472 a formula .",
    "given @xmath331 there is @xmath195 such that : for a definable relation @xmath473 with some @xmath474 and a generically stable product measure @xmath332 on @xmath431 with @xmath432 there are definable sets @xmath433 with @xmath434 for all @xmath435 and @xmath436 .",
    "moreover , each @xmath437 is defined by an instance of a formula that depends only on @xmath79 and @xmath329 .",
    "follows immediately by proposition  [ prop : densityramseyhypergraphs ] applied to the relation @xmath475 and to the generically stable product measure @xmath476 , where @xmath477 is a ( generically stable ) @xmath478-valued measure on @xmath219 concentrated on @xmath479 .",
    "let @xmath244 be the lebesgue measure on @xmath480 restricted to the unit cube , i.e. @xmath481 where @xmath482 is the standard lebesgue measure and @xmath483 is the unit cube in @xmath480 .",
    "let @xmath484 be an o - minimal expansion of @xmath485 and @xmath486 be a formula .",
    "then for any @xmath487 there is some @xmath101 such that for any @xmath488 with @xmath489 there are definable @xmath490 , @xmath491 with @xmath492 and @xmath493 .",
    "this follows from corollary  [ cor : density extra parameters ] and fact  [ examplesofsmoothmeasures ] .",
    "also we get a generalization of the original semialgebraic counting version over finite sets from theorem  [ thm : semialg - ramsey ] with additional control on the parameters over which the homogeneous subsets are defined .",
    "[ basicramseyforcountingmeasures ] let @xmath28 be a distal structure and let a formula @xmath494 be given .",
    "then there is some @xmath495 and formulas @xmath248 and @xmath249 depending just on @xmath79 and satisfying the following . for any definable relation @xmath496 for some @xmath497 and finite @xmath498",
    "there are some @xmath499 with @xmath500 and    1 .",
    "the pair @xmath429 is @xmath34-homogeneous , 2 .",
    "there are some @xmath501 and @xmath502 such that @xmath503 and @xmath504 .",
    "let @xmath505 be as given by corollary  [ cor : density extra parameters ] .",
    "then the existence of @xmath429 follows by defining @xmath506 ( @xmath507 to be the normalized number of points in @xmath508 ( resp . , @xmath509 ) .",
    "such keisler measures are always generically stable by fact  [ examplesofsmoothmeasures ] .    for part ( 2 ) , by remark  [ rem : udtfs ] we can find some formulas @xmath510 and @xmath511 such that for any finite sets @xmath56 and @xmath512 there are some @xmath513 such that @xmath514 and @xmath515 .",
    "we will show in section  [ sec : equiv to distality ] that the most basic version of corollary [ basicramseyforcountingmeasures ] characterizes distality .",
    "this is not the case however if we do not require definability of the homogeneous subsets .    1 .",
    "if every definable relation in @xmath28 satisfies the strong erds - hajnal property and @xmath516 is interpretable in @xmath28 , then every definable relation in @xmath516 satisfies the strong erds - hajnal property .",
    "2 .   let @xmath28 and @xmath516 be two structures in the same language and assume that @xmath516 embeds into @xmath28 . if all quantifier - free definable relations in @xmath28 satisfy the strong erds - hajnal property , then all quantifier - free definable relations in @xmath516 satisfy the strong erds - hajnal property as well .    by the remark and corollary  [ basicramseyforcountingmeasures ] we have the following .",
    "if @xmath28 is distal and @xmath516 is interpretable in @xmath28 ( embeds into @xmath28 ) , then all definable ( resp .",
    ", quantifier - free definable ) relations in @xmath516 satisfy the strong erds - hajnal property .",
    "[ ex : non - distal structures satisfying * ] the following relations satisfy the strong erds - hajnal property .    1 .   definable relations in an arbitrary algebraically closed field of characteristic @xmath61 ( since @xmath517 is interpretable in the distal theory of real closed fields @xmath518 ) .",
    "2 .   definable ( in the language @xmath519 ) relations in an arbitrary non - trivially valued algebraically closed field of residue characteristic @xmath61 ( since",
    "its theory @xmath520 is interpretable in the theory of real closed valued fields @xmath521 ( see e.g. ( * ? ? ?",
    "* corollary 6.3 ) ) , which is distal in view of example  [ ex : rcvf ] ) .",
    "3 .   quantifier - free definable relations in an arbitrary field of characteristic @xmath61 ( as it can be embedded into some model of @xmath517 ) .",
    "4 .   quantifier - free definable ( in @xmath519 ) relations in an arbitrary valued field of equicharacteristic @xmath61 ( as it can always be embedded into a model of @xmath520 ) .    thus ( see remark  [ rem : strong eh implies eh ] ) we obtain many new families of graphs satisfying the erds - hajnal conjecture .    1 .   every relation satisfying the strong erds - hajnal property is nip .",
    "if all definable relations on @xmath28 satisfy the erds - hajnal property then @xmath28 is nip .",
    "\\(1 ) if the relation @xmath291 is not nip , then for any finite bi - partite graph @xmath247 there are some @xmath498 such that @xmath247 is isomorphic to @xmath522 . by the optimality of the bound @xmath523 on the size of homogeneous subsets in arbitrary bi - partite graphs it follows that @xmath34 does not have the strong erds - hajnal property .",
    "\\(2 ) if the relation @xmath291 is not nip , let @xmath524 be defined by @xmath525 .",
    "this is a symmetric relation such that for any finite graph @xmath247 there is some set @xmath526 such that @xmath247 is isomorphic to @xmath527 ( see e.g. ( * ? ? ?",
    "* lemma 2.2 ) ) .",
    "again optimality of the logarithmic bound for arbitrary graphs implies that @xmath451 does not have the erds - hajnal property .",
    "szemerdi s regularity lemma is a fundamental result in graph combinatorics with many versions and applications in extremal combinatorics , number theory and computer science ( see @xcite for a survey ) . in it",
    "s simplest form for bi - partite graphs , it can be presented as following .    if @xmath528 , then there exists @xmath529 such that : for any finite bi - partite graph @xmath530 , there exist partitions @xmath531 and @xmath532 into non - empty sets , and a set @xmath533 with the following properties .    1",
    ".   bounded size of the partition : @xmath534 .",
    "few exceptions : @xmath535 3 .",
    "@xmath199-regularity : for all @xmath536 , and all @xmath537 , one has @xmath538 where @xmath539 .    in general the bound on the size of the partition @xmath279 is known to grow as an exponential tower of height @xmath540 , and the result is less informative in the case of sparse graphs .",
    "recently several improved regularity lemmas were obtained in the context of definable sets in certain structures or in restricted families of structures .",
    "1 .   @xcite algebraic graphs of bounded complexity in large finite fields ( equivalently , definable graphs in pseudofinite fields ) : pieces of the partition are algebraic of bounded complexity , no exceptional pairs , stronger regularity . some generalizations and simplifications were obtained in @xcite and by hrushovski ( unpublished ) .",
    "@xcite graphs of bounded vc - dimension : density arbitrarily close to @xmath61 or @xmath541 , the size of the partition is bounded by a polynomial in @xmath542 . 1 .   @xcite graphs without arbitrarily large half - graphs , corresponding to the case of stable graphs ( no exceptional pairs ) .",
    "@xcite semialgebraic graphs of bounded complexity .",
    "we remark that the classes of structures in ( 1 ) , 2(a ) and 2(b ) are orthogonal to each other . in the next section",
    "we give a generalization of the case 2(b ) to graphs definable in arbitrary distal structures . as remarked before , the stable and the distal cases present two extremal cases of general nip structures .",
    "we work in a model @xmath28 of a distal theory @xmath107 .",
    "we have sorts @xmath543 ( i.e.   definable subsets of some powers of @xmath28 ) and a definable relation @xmath544 .",
    "a.   let @xmath545 .",
    "b.   we call a subset @xmath546 _ a rectangular subset _ if it is of the form @xmath547 . c.   for @xmath77 and a finite set of formulas @xmath548",
    ", a rectangular subset @xmath547 is called @xmath549-definable over @xmath58 if each @xmath550 is a finite boolean combination of sets from @xmath551 .",
    "( in fact we will need only conjunctions of @xmath552 and their negations , i.e.   partial @xmath549-types . )",
    "d.   given keisler measures @xmath233 on each sort @xmath553 , for a rectangular definable @xmath554 we set @xmath555 e.   by _ a rectangular definable partition of @xmath556 _ we mean a finite partition @xmath557 of @xmath556 consisting of rectangular definable sets . f.   for rectangular definable partitions @xmath558 of @xmath556 we write @xmath559 if @xmath557 refines @xmath560 , namely for each @xmath561 there is @xmath562 with @xmath563 .",
    "g.   given keisler measures @xmath233 on each sort @xmath553 , for a rectangular definable partition @xmath557 of @xmath556 , we define _ the defect _ of @xmath557 to be @xmath564 obviously , if @xmath565 then @xmath566 .",
    "[ prop : partitioned regularity ] there is some constant @xmath567 such that : for any @xmath101 and any generically stable measures @xmath233 on @xmath553 , for @xmath568 , there is a rectangular uniformly definable ( in terms of @xmath34 and @xmath199 ) partition @xmath557 of @xmath556 with @xmath569 and @xmath570 .",
    "we give a proof of the proposition in several claims , essentially following the proof of ( * ? ? ?",
    "* theorem 1.3 ) but working with keisler measures .    using proposition  [ prop : densityramseyhypergraphs ] we know that the following holds .",
    "[ thm : main ] there is a constant @xmath571 , and formulas @xmath572 such that for any generically stable measures @xmath233 on @xmath553 there are @xmath573 , such that the sets @xmath574 defined by @xmath575 are @xmath34-homogeneous and @xmath576 .",
    "since we are going to keep track of the parameters used in @xmath552 it is more convenient to assume that in the above claim @xmath577 and @xmath578 .",
    "it can be always achieved by a concatenation of variables .",
    "we fix @xmath57 from the previous claim and let @xmath579 , where @xmath552 are from the above claim .",
    "[ claim:1 ] let @xmath80 be a definable rectangular subset of @xmath556 with @xmath580 .",
    "then there is some @xmath581 and a rectangular set @xmath582 which is @xmath549-definable over @xmath583 , such that @xmath584 is @xmath34-homogeneous and @xmath585 .",
    "apply claim  [ thm : main ] to measures @xmath233 relativized to the sets @xmath550 .",
    "[ claim:2 ] let @xmath557 be a rectangular partition of @xmath556 which is @xmath549-definable over a finite set @xmath58 .",
    "then there is a rectangular partition @xmath560 which is @xmath549-definable over a finite set @xmath418 with    1 .",
    "@xmath586 , 2 .",
    "@xmath587 , 3 .",
    "@xmath588 .",
    "let @xmath589 be non - homogeneous .",
    "we can partition it into @xmath590 rectangular subsets , all of them @xmath549-definable using one extra parameter @xmath591 , such that one of these subsets is @xmath34-homogeneous and is of measure at least @xmath592 .",
    "namely , if @xmath593 , by claim [ claim:1 ] there are some @xmath594 such that @xmath595 is an @xmath34-homogeneous subset of @xmath80 with @xmath596 , and we take a partition of @xmath80 into @xmath590 pieces given by the sets @xmath597 and @xmath598 for all @xmath568 .    replacing each non - homogeneous @xmath589 with such a sub - partition we obtain @xmath560 satisfying the requirements .",
    "thus , by induction on @xmath9 we can construct a rectangular partition @xmath599 of @xmath556 which is @xmath549-definable over a finite set @xmath600 and such that    1 .",
    "@xmath601 , 2 .",
    "@xmath602 , 3 .",
    "@xmath603 .",
    "in particular , given @xmath195 , using @xmath604 and @xmath605 above , after @xmath606 steps we have @xmath607 with @xmath608 , where @xmath609 is a positive constants depending only on @xmath34 .",
    "this finishes the proof of proposition  [ prop : partitioned regularity ] .    from the above @xmath202-partite version",
    "we obtain a regularity lemma for hypergraphs .",
    "[ thm : distal regularity lemma ] let @xmath610 be a definable set and @xmath611 with @xmath612 for all @xmath613 be a definable relation . then there is some constant @xmath614 such that the following holds .    for any @xmath101 and for any generically stable measure @xmath183 on @xmath179 , there is a partition @xmath615 with @xmath616 such that @xmath617 s are uniformly definable ( in terms of @xmath34 and @xmath199 ) and @xmath618 where the sum is over all tuples @xmath619 such that @xmath620 is not @xmath34-homogeneous .",
    "let @xmath621 be as given by the proof of proposition  [ prop : partitioned regularity ] for @xmath622 and @xmath623 , for all @xmath613 .",
    "using fact  [ fac : polytypesnip ] , we obtain constants @xmath624 and @xmath625 depending only on @xmath34 and such that the number of @xmath549-types over any finite set @xmath58 is bounded by @xmath626 .",
    "finally , we partition @xmath179 into realizations of complete @xmath549-types over @xmath627 , say @xmath628 .",
    "it follows that there will be at most @xmath629 parts .",
    "it is easy to see that this partition of @xmath179 satisfies the homogeneity condition because the rectangular partition @xmath630 refines @xmath631 and @xmath607 .      normally in the conclusion of a regularity",
    "lemma one is able to choose parts of ( approximately ) equal measure .",
    "we give a sufficient condition for this in the definable setting .",
    "to simplify some expressions , given real numbers @xmath632 and @xmath195 , we write @xmath633 to denote that @xmath634 .    [ def : uniformly cutting finite sets ] we say that a structure @xmath28 _ uniformly cuts finite sets _ if for every formula @xmath69 and every @xmath101 there is a formula @xmath635 such that for any sufficiently large finite set @xmath339 , any @xmath198 and any @xmath636 there is some @xmath497 such that @xmath637 .",
    "note that this is a property of @xmath110 .    1 .",
    "assume that there is a definable linear order @xmath638 on @xmath28 .",
    "then clearly @xmath28 uniformly cuts finite sets and @xmath639 in definition  [ def : uniformly cutting finite sets ] can be chosen independently of @xmath79 and @xmath199 ( using lexicographic ordering for subsets of @xmath50 for @xmath640 ) .",
    "2 .   let @xmath641 , then @xmath28 uniformly cuts finite sets . for subsets of @xmath138",
    "this follows from the fact that every ball in @xmath167 is a disjoint union of exactly @xmath0 balls , using which an argument similar to the proof that for an atomless measure , every set of positive measure contains subsets of arbitrary smaller measure , can be carried out up to @xmath199 , in a number of steps bounded in terms of @xmath199 ( one can check using quantifier elimination in the @xmath0-adics that in this case @xmath639 can not be chosen independently of @xmath199 ) . to extend this to subsets of @xmath50 for @xmath640 ,",
    "note that if @xmath202 is an infinite field and @xmath642 is a finite set then there is a uniformly definable linear map @xmath643 that is one - to - one on @xmath58 .",
    "[ prop : cutting gen stable measures ] let @xmath28 be a distal structure and assume that it uniformly cuts finite sets .",
    "then for every formula @xmath69 and @xmath644 there is some @xmath635 such that : for any generically stable measure @xmath183 on @xmath28 with @xmath645 for any singleton @xmath646 , if @xmath647 then we can find some @xmath648 with @xmath649 .",
    "fix @xmath101 arbitrary , and let @xmath635 be an arbitrary formula .",
    "as @xmath28 is distal , it follows by fact  [ fac : distal iff gen stable is smooth ] that @xmath183 is smooth over @xmath138 .",
    "let @xmath650 , @xmath491 list all of the formulas over @xmath138 given by fact  [ non - uniform epsilon - net for smooth ] for each of @xmath69 and @xmath651 , with respect to @xmath183 and @xmath199 .",
    "let @xmath652 be the finite boolean algebra of subsets of @xmath72 generated by @xmath653 .",
    "clearly the number of atoms in @xmath652 is at most @xmath654 . by assumption",
    "every definable set of positive @xmath183-measure is infinite .",
    "then for all sufficiently large @xmath655 we can choose a set @xmath656 such that for every atom @xmath58 of @xmath652 , @xmath657 .",
    "it then follows that for every @xmath658 we have @xmath659 .",
    "but by the choice of @xmath660 this implies that for any set @xmath314 from @xmath661 we have @xmath662 .",
    "now let @xmath663 be given ( if @xmath664 then there is nothing to do ) .",
    "let @xmath665 , and let @xmath635 be as given by definition  [ def : uniformly cutting finite sets ] for @xmath69 and @xmath199 . take @xmath666 sufficiently large ( to be specified later ) , then for @xmath262 with @xmath667 chosen as above with respect to @xmath199 and @xmath639 we have in particular @xmath668 .",
    "let @xmath669 .",
    "we may assume that there is some @xmath670 such that @xmath671 ( as @xmath487 , by choosing @xmath666 sufficiently large we may assume that @xmath672 is arbitrarily large ) .",
    "then , using that both @xmath673 we obtain @xmath674 , so @xmath675 .    by the choice of @xmath635",
    ", there is some @xmath648 such that @xmath676 , which implies @xmath677 , and so @xmath678 . by the assumption on @xmath262",
    "this implies that @xmath679 , i.e. @xmath680 .    [ rem : definable measure def ] recall that a global measure @xmath183 is _ definable _ over a small model @xmath138 if it is @xmath681-invariant and for every formula @xmath682 and every closed subset @xmath80 of @xmath145 $ ] , the set @xmath683 is closed .",
    "it is _ finitely satisfiable _ if for every @xmath684 with @xmath685 there is some @xmath125 such that @xmath686 holds .",
    "as mentioned before , in an nip structure , a keisler measure @xmath183 over @xmath687 is generically stable if and only if it admits a global @xmath138-invariant extension which is both definable over @xmath138 and finitely satisfiable in @xmath138 ( see ( * ? ? ?",
    "* theorem 3.2 ) ) .",
    "assume that @xmath107 uniformly cuts finite sets in such a way that @xmath639 in definition  [ def : uniformly cutting finite sets ] can be chosen independently of @xmath199 ( e.g. if @xmath688 has a definable linear order ) . then under the assumptions of proposition",
    "[ prop : cutting gen stable measures ] we can choose @xmath689 such that @xmath690 , where @xmath227 is the unique global keisler measure extending @xmath183 .    as @xmath227",
    "is generically stable over @xmath28 , it is in particular definable over @xmath28 .",
    "that is , for every @xmath644 the set @xmath691 is type - definable over @xmath28 ( and consistent ) .",
    "it then follows by compactness that we can find some @xmath692 with @xmath693 .",
    "let @xmath28 be a distal structure and assume that it uniformly cuts finite sets . then in theorem  [ thm : distal regularity lemma ] for any @xmath183 satisfying in addition @xmath645 for all @xmath694 and any @xmath644 we can find a partition @xmath695 with @xmath696 for all @xmath697 ( and the parts @xmath617 are uniformly definable in terms of @xmath698 ) .",
    "we are following the standard repartition argument ( see e.g.   ( * ? ? ? * proof of theorem 1.3 ) ) .",
    "let @xmath699 be a @xmath202-uniform hypergraph , and let @xmath615 be a partition of its vertices given by theorem  [ thm : distal regularity lemma ] for @xmath700 , with @xmath701 .",
    "fix @xmath644 and @xmath183 satisfying the assumptions , and we will find a new partition @xmath702 satisfying the conclusion of the corollary for @xmath199 and @xmath57 .",
    "let @xmath703 , without loss of generality @xmath704 , and fix an arbitrary @xmath705 . using proposition  [ prop : cutting gen stable measures ]",
    "we can partition each @xmath617 into @xmath706 with @xmath707 for all @xmath708 and the remainder @xmath709 .",
    "let now @xmath710 , and again using proposition  [ prop : cutting gen stable measures ] we can partition @xmath282 into @xmath711 with @xmath712 and the remainder @xmath713 . as @xmath714 was sufficiently small compared to @xmath57 and @xmath715 , calculating the error we get @xmath716 .",
    "we claim that @xmath717 is the required partition , re - enumerate it as @xmath702 .",
    "we still have that @xmath306 is a polynomial in @xmath540 .",
    "note that @xmath718 , so there are at most @xmath279 parts of the new partition contained in @xmath282 .",
    "hence the sum @xmath719 over all tuples @xmath619 for which not all of @xmath720 are subsets of parts of the original partition is at most @xmath721 .",
    "together with the assumption on the original partition it then follows that @xmath722 , where the sum is over all tuples @xmath619 such that @xmath723 is not @xmath34-homogeneous , is bounded by @xmath724 .",
    "it follows from the construction that the new partition is uniformly definable in terms of the old one and @xmath57 , and thus uniformly definable in terms of @xmath725 and @xmath57 .    answering a question from an earlier version of our article",
    ", pierre simon had recently demonstrated that all distal structures uniformly cut finite sets .",
    "fields of positive characteristic give a standard example of the failure of the strong szemerdi - trotter bound on the number of incidences between points and lines . in a personal communication terrence tao",
    "had suggested that it may also be used for the failure of the strong erds - hajnal property in this setting , which turned out to be the case indeed .",
    "let @xmath727 be a field .",
    "for a set of points @xmath728 and a set of lines @xmath729 in @xmath730 we denote by @xmath731 the incidence relation , i.e. @xmath732 . as remarked in example  [ ex : non - distal structures satisfying * ] , every field @xmath727 of characteristic @xmath61 satisfies the strong erds - hajnal property with respect to quantifier - free formulas .",
    "in particular we have :    [ prop : pointslines ] let @xmath727 be a field of characteristic @xmath61 .",
    "then there is a constant @xmath644 such that for any finite ( sufficiently large ) set of points @xmath728 and any finite ( sufficiently large ) set of lines @xmath729 in @xmath730 there are some @xmath733 and @xmath734 with @xmath735 and @xmath736 .",
    "let @xmath738 be a finite field of characteristic @xmath0 , of size @xmath739 .",
    "let @xmath179 be the set of _ all _ points in @xmath738 , and let @xmath729 be the set of _ all _ lines in @xmath740 of the form @xmath741 .",
    "then there are @xmath742 with @xmath735 and such that @xmath743 .",
    "we show that this is impossible .",
    "we have @xmath744 .",
    "since @xmath738 has size @xmath739 , every line contains exactly @xmath739 points , therefore @xmath745 .",
    "notice also that every point belongs to exactly @xmath739 lines in @xmath729 .                  by (",
    "* corollary 4.5 ) every infinite nip field of characteristic @xmath764 contains @xmath765 .",
    "but then @xmath28 can not satisfy the strong erds - hajnal property by the proposition above , contradicting distality .",
    "in this section we assume some familiarity with nip theories ( see e.g. @xcite ) and recall some facts about distal theories .",
    "we fix a theory @xmath107 and a big sufficiently saturated model @xmath766 of @xmath107 . recall that a sequence @xmath767 of elements of @xmath50 indexed by a linear order @xmath768 is _ indiscernible _ over a set of parameters @xmath769 if for any @xmath770 and @xmath771 from @xmath768 we have @xmath772 . given a linear order @xmath768 , by a _",
    "dedekind cut _ in @xmath768 we mean a cut @xmath773 ( i.e. , @xmath774 and @xmath775 for all @xmath776 ) such that @xmath777 has no maximal element and @xmath778 has no minimal element .",
    "we denote by @xmath779 the reverse of the order on @xmath768 .      1 .",
    "@xmath107 is distal ( in the sense of fact  [ stronghonestdef ] ) .",
    "every indiscernible sequence @xmath780 in any model of @xmath138 of @xmath107 is distal .",
    "that is , for any two distinct dedekind cuts of @xmath768 , if some two elements fill them separately , then they also fill them simultaneously : if @xmath781 and we have some @xmath66 and @xmath782 from @xmath783 such that both @xmath784 and @xmath785 are indiscernible , then @xmath786 is indiscernible .    given an indiscernible sequence @xmath787)$ ] , one defines the _ average measure _ @xmath183 of @xmath768 as the global keisler measure given by @xmath788 : a_i \\models \\phi(x ) \\})$ ] for all definable sets @xmath189 , where @xmath789 is the lebesgue measure on @xmath145 $ ] .",
    "it follows from nip that this keisler measure is well - defined , i.e.   that the corresponding set of indices is measurable for every @xmath189 with parameters from @xmath766 .",
    "we say that @xmath790 is a _",
    "polarized _ cut of @xmath768 if @xmath773 is a cut of @xmath768 and @xmath791 specifies whether it is approached from the left or from the right .",
    "it follows from nip that for a polarized dedekind cut @xmath790 and a set of parameters @xmath792 we have a complete _ limit type _ of @xmath793 over @xmath58 denoted by @xmath794 and defined by @xmath795 the set @xmath796 is unbounded from above in case @xmath797 , or from below in case @xmath798 .      1 .",
    "the measure @xmath183 is generically stable ( ( * ? ? ?",
    "* proposition 3.7 ) ) .",
    "the support of @xmath183 is exactly the set of limit types of cuts of @xmath768 .",
    "that is , if for some formula @xmath189 we have @xmath799 then @xmath800 for some polarized dedekind cut @xmath793 of @xmath768 ( * ? ? ?",
    "* lemma 2.20 ) .",
    "3 .   @xmath768 is distal if and only if @xmath183 is smooth ( * ? ? ?",
    "* proposition 2.21 ) .",
    "indeed , if @xmath803 expands @xmath107 and @xmath767 is an infinite @xmath804-indiscernible sequence , then it is in particular @xmath729-indiscernible , so not totally-@xmath729-indiscernible by distality of @xmath107 , so of course not totally-@xmath804-indiscernible .",
    "[ strongbasechange ] let @xmath107 be nip .",
    "let @xmath768 be an indiscernible sequence and @xmath805 a set of parameters .",
    "let @xmath806 be a sequence of pairwise - distinct polarized dedekind cuts in @xmath768 .",
    "for each @xmath220 , let @xmath807 fill the cut @xmath808 ( i.e. , if @xmath809 then @xmath810 is indiscernible ) .",
    "then there exist @xmath811 in @xmath812 such that :        [ fac : nip finite alternation ] let @xmath69 be an nip formula .",
    "then there are some @xmath816 such that for any indiscernible sequence @xmath817 from @xmath72 with @xmath818 and any @xmath198 , the set @xmath819 is a disjoint union of at most @xmath202 intervals .        1 .",
    "@xmath107 is distal .",
    "2 .   for any definable relation @xmath291 and",
    "any global generically stable measures @xmath820 there are some definable @xmath821 which are @xmath34-homogeneous and satisfy @xmath822 .",
    "3 .   for any definable relation @xmath291",
    "there is some @xmath23 and some formulas @xmath823 such that for all finite @xmath824 there are some @xmath825 such that @xmath826 and the pair of sets @xmath827 is @xmath34-homogeneous .",
    "\\(1 ) implies ( 2 ) and ( 3 ) follow from corollaries  [ densityforgraphs ] and [ basicramseyforcountingmeasures ] .",
    "+ ( 2 ) implies ( 1 ) .",
    "assume that @xmath828 is a non - distal indiscernible sequence , with @xmath829 $ ] .",
    "this means that @xmath768 can be written as @xmath781 ( where @xmath830 and @xmath831 are without last elements ) in such a way that there are some @xmath832 such that @xmath833 and @xmath834 are indiscernible , but @xmath835 is not .    then there is a formula @xmath836 with some finite @xmath837 , say @xmath838 for @xmath839 , such that @xmath840 holds for any @xmath841 , but @xmath842 .",
    "let @xmath843 $ ] be some interval of @xmath844 between @xmath845 and @xmath846 , and @xmath847 $ ] some interval between @xmath846 and @xmath848 .",
    "let @xmath849 ) , k=(a_i : i \\in [ k_1,k_2])$ ] .",
    "let @xmath183 be the average measure of @xmath850 , and @xmath210 the average measure of @xmath279 ( we may assume that both sequences are indexed by @xmath145 $ ] by taking an order preserving bijection ) .",
    "then both @xmath183 and @xmath210 are generically stable by fact  [ averagemeasures](1 ) .",
    "now assume that @xmath851 and @xmath852 are definable subsets of @xmath853 with @xmath854 and @xmath855 , where @xmath856 are formulas with parameters in some small model @xmath857 .",
    "by fact  [ averagemeasures](2 ) it follows that there is some polarized dedekind cut @xmath793 of @xmath850 such that @xmath858 , and some polarized dedekind cut @xmath859 of @xmath279 such that @xmath860 .",
    "it follows by compactness , indiscernibility of @xmath768 and taking an automorphism of @xmath766 that there is some @xmath861 filling @xmath793 and @xmath422 filling @xmath859 ( separately , as cuts in @xmath768 ) such that @xmath862 holds .",
    "by fact  [ strongbasechange ] we can find some @xmath863 such that still @xmath864 holds , but moreover @xmath865 . in particular , @xmath866 . on the other hand , by the choice of @xmath79 and",
    "the definition of @xmath346 there are some @xmath867 in @xmath768 such that @xmath868 .",
    "this shows that the relation @xmath869 is not homogeneous on @xmath870 . as @xmath871 were arbitrary definable sets of positive measure",
    ", we conclude .",
    "+ ( 3 ) implies ( 1 ) .",
    "assume that @xmath107 is not distal , and we will show that ( 3 ) can not hold .",
    "working in @xmath766 we have some @xmath872 for @xmath873 and @xmath874 such that @xmath781 , @xmath875 and @xmath785 are indiscernible , but @xmath876 is not .",
    "this implies in particular that there is a formula @xmath877 such that @xmath878 for some finite @xmath879 with @xmath880 , but @xmath881 for any @xmath882 such that @xmath883 .",
    "let now @xmath884 with @xmath885 .",
    "assume that there are @xmath886 and @xmath644 as required by ( 3 ) for @xmath34 .",
    "as @xmath107 is nip , it follows by fact  [ fac : nip finite alternation ] that there are some @xmath887 such that for any indiscernible sequence @xmath888 with @xmath818 and any @xmath889 , the set @xmath890 is a disjoint union of at most @xmath202 intervals . without loss of generality",
    "it then follows from ( 3 ) that there is some @xmath891 such that for any finite indiscernible sequences @xmath892 and @xmath893 with @xmath818 we can find _ intervals _ @xmath894 and @xmath895 such that @xmath896 is @xmath897-homogeneous .",
    "we are going to show that this property fails .",
    "by indiscernibility of @xmath768 , automorphism and compactness for any dedekind cuts @xmath905 of @xmath906 and @xmath907 of @xmath908 we can find some @xmath909 and @xmath910 which fill those cuts ( separately , viewed as cuts in @xmath768 ) and such that @xmath911 holds .    for each @xmath912 ,",
    "let @xmath913 be an infinite increasing sequence of cuts of @xmath914 , and let @xmath915 be a decreasing sequence of cuts of @xmath916 .",
    "by the previous remark , let @xmath917 and @xmath918 be such that @xmath917 fills the cut @xmath919 , @xmath918 fills the cut @xmath920 and @xmath921 holds .          1 .",
    "for any @xmath928 we have that @xmath929 holds .",
    "the sequence @xmath906 with all the @xmath930 added in the corresponding cuts is an indiscernible sequence , 3 .",
    "the sequence @xmath908 with all the @xmath931 added in the corresponding cuts is an indiscernible sequence , 4 .",
    "@xmath932 holds for any @xmath933 .    here",
    "( a ) follows from the first bullet and the choice of @xmath934 ; using the second bullet above it is easy to show that ( b ) holds , and that the sequence has the same em - type as @xmath768 ( similarly for ( c ) ) ; ( d ) was already observed above .    in view of ( a)(d ) above",
    ", for any @xmath935 we can choose indiscernible sequences @xmath936 and @xmath937 such that for any @xmath938 we have @xmath939 and @xmath940 for any @xmath941 .",
    "it then follows that for all sufficiently large @xmath666 , for any choice of an interval @xmath942 with @xmath943 and @xmath944 with @xmath945 , the sets @xmath946 can not be @xmath897-homogeneous  a contradiction to the choice of @xmath947 .",
    "the above proof shows that an nip theory is distal if and only if the property ( 3 ) in theorem [ thm : characterizing distality ] holds for all finite indiscernible sequences @xmath56 . as the following proposition shows , in an arbitrary nip theory the property ( 3 ) almost holds for @xmath56 indiscernible sequences , except for the uniform definability of one of the homogeneous subsets .",
    "let @xmath949 be nip .",
    "then there is @xmath528 depending only on @xmath79 such that for any @xmath950 and @xmath951 indiscernible sequences ( in fact @xmath115-indiscernible for some finite @xmath115 depending just on @xmath79 is enough ) there are @xmath952 such that : @xmath953 and either @xmath954 holds for all @xmath955 or @xmath956 holds for all @xmath955 .",
    "by fact  [ fac : nip finite alternation ] there is @xmath202 such that @xmath949 ca nt alternate on an indiscernible sequence more than @xmath202 times .",
    "we divide @xmath59 into @xmath957 intervals of almost equal length .",
    "namely , for @xmath958 let @xmath959 then for every @xmath960 there is some interval @xmath961 not containing any alternation points .",
    "it follows that for some @xmath962 , there are @xmath963-many points in @xmath58 which do not alternate inside @xmath964 , and then at least half of them satisfy @xmath79 or @xmath965 .",
    "so we can take @xmath966 .",
    "matthias aschenbrenner , alf dolich , deirdre haskell , dugald macpherson , and sergei starchenko , _ vapnik - chervonenkis density in some theories without the independence property , i _ , trans .",
    "soc . , to appear ( arxiv:1109.5438 ) ( 2011 ) .",
    "david conlon , jacob fox , jnos pach , benny sudakov , and andrew suk , _ ramsey - type results for semi - algebraic relations _ , transactions of the american mathematical society * 366 * ( 2014 ) , no .",
    "9 , 50435065 .",
    "jacob fox , mikhail gromov , vincent lafforgue , assaf naor , and jnos pach , _ overlap properties of geometric expanders _",
    ", journal fr die reine und angewandte mathematik ( crelles journal ) * 2012 * ( 2012 ) , no .  671 , 4983 ."
  ],
  "abstract_text": [
    "<S> it is known that families of graphs with a semialgebraic edge relation of bounded complexity satisfy much stronger regularity properties than arbitrary graphs , and that they can be decomposed into very homogeneous semialgebraic pieces up to a small error ( e.g. , see @xcite ) . </S>",
    "<S> we show that similar results can be obtained for families of graphs with the edge relation uniformly definable in a structure satisfying a certain model theoretic property called distality , with respect to a large class of generically stable measures . </S>",
    "<S> moreover , distality characterizes these strong regularity properties . </S>",
    "<S> this applies in particular to graphs definable in arbitrary o - minimal structures and in @xmath0-adics . </S>"
  ]
}