{
  "article_text": [
    "this is the fourth in a series of seven papers describing the pan - starrs1 surveys , the data reduction techiques and the resulting data products .",
    "this paper ( paper iv ) describes the details of the source detection and photometry , including point - spread - function and extended source fitting models , and the techniques for `` forced '' photometry measurements .",
    "* paper i ) provides an overview of the pan - starrs system , the design and execution of the surveys , the resulting image and catalog data products , a discussion of the overall data quality and basic characteristics , and a brief summary of important results .",
    "* paper ii ) describes how the various data processing stages are organised and implemented in the imaging processing pipeline ( ipp ) , including details of the the processing database which is a critical element in the ipp infrastructure .",
    "* paper iii ) describes the details of the pixel processing algorithms , including detrending , warping , and adding ( to create stacked images ) and subtracting ( to create difference images ) and resulting image products and their properties .",
    "* paper v ) describes the final calibration process , and the resulting photometric and astrometric quality .",
    "* paper vi ) describes the details of the resulting catalog data and its organization in the pan - starrs database .",
    "* paper vii ) describes the medium deep survey in detail , including the unique issues and data products specific to that survey .",
    "the medium deep survey is not part of data release 1 .",
    "( dr1 )    the pan - starrs1 filters and photometric system have already been described in detail in @xcite .",
    "the photometric and astrometric precision goals for the pan - starrs1 surveys were quite stringent : photmetric accuracy of 10 millimagnitudes , relative astrometric accuracy of 10 milliarcseconds and absolute astrometric accuracy of 100 milliarcseconds with respect to the icrs reference stars .",
    "an additional constraint on the pan - starrs analysis system comes from the high data rate .",
    "ps1 produces typically @xmath1 exposures per night , corresponding to @xmath2 billion pixels of imaging data .",
    "the images range from high galactic latitudes to the galactic bulge , so large numbers of measurable stars can be expected in much of the data . the combination of the high precision goals of the astrometric and photometric measurements and the high data rate ( and a finite computing budget ) mean that the process of detecting , classifying , and measuring the astronomical objects in the image data stream in a timely fashion are a significant challenge",
    ".    in order to achieve these ambitious goals , the object detection , classification , and measurement process must be both precise and efficient .",
    "not only is it necessary to make a careful measurement of the flux of individual objects , it is also critical to characterize the image point - spread - function , and its variations across the field and from image to image . since comparisons between images must be reliable , the measurements must be stable for both photometry and astrometry .",
    "a variety of astronomical software packages perform the basic object detection , measurement , and classification tasks needed by the pan - starrs ipp .",
    "each of these programs have their own advantages and disadvantages .",
    "below we discuss some of the most widely used of these other packages , highlighting the features of the programs which are particularly desirable , and noting aspects of the programs which are problematic for the ipp .",
    "* dophot : analytical fitted model with aperture corrections .",
    "pro : well - tested , stable code .",
    "con : limited range of models , algorithm converges slowly to a psf model , limited tests of psf validity , inflexible code base , fortran @xcite .",
    "* daophot : pixel - map psf model with analytical component .",
    "pro : well - tested , high - quality photometry .",
    "con : difficult to use in an automated fashion , does it handle 2d variations well ?",
    "@xcite . * sextractor : pure aperture measurement with rudimentary object subtraction .",
    "pro : fast , widely used , easy to automate .",
    "con : poor object separation in crowded regions , psf - modeling was only in beta , not widely used at the time @xcite .",
    "* galfit : detailed galaxy modeling .",
    "not a multi - object psf analysis tool .",
    "con : does not provide a psf model , not easily automated",
    ". very detailed results in very slow processing .",
    "only a galaxy analysis program @xcite .",
    "* sdss phot : con : tightly integrated into the sdss software environment @xcite .    when the ipp development was starting , the existing photometry packages either did not meet the level of accuracy required or were required too much human intervention to be considered for the needs of ps1 . in the case of the sdss photo tool ,",
    "the software was judged to be too tightly integrated to the architecture of sdss to be easily re - integrated into the pan - starrs pipelin .",
    "a new photometry analysis package was developed using lessons learned from the existing photometry systems . in the process",
    ", the object analysis software was written using the data analysis c - code library written for the ipp , .",
    "components of the photometry code were integrated into the ipp s mid - level astronomy data analysis toolkit called .",
    "the result software , psphot , can be used either as a stand - alone c program , or as a set of library functions which may be integrated into other programs    the main version of psphot is a stand - alone program which is run on a single image or a group of related images representing the data read from a camera in a single exposure .",
    "the images are expected to have already been detrended so that pixel values are linearly related to the flux .",
    "the gain may be specific by the configuration system , or a variance image may be supplied .",
    "a mask may also be supplied to mark good , bad , and suspect pixels .",
    "several variants of psphot have also been used in the ps1 pv3 analysis .",
    "the version called psphotstack accepts a set of images , each representing the same patch of sky in a different filter , nominally the full @xmath3 filter set for the analysis of the ps1 pv3 stack images , though where insufficient data were available in a given filter , a subset of these filters was processed as a group . as discussed in detail below",
    ", the psphotstack analysis includes the capability of measuring forced psf photometry in some filter images based on the position of sources detected in the other filters .",
    "it also include an option to convolve the set of images to a single , common psf size across the filters for the purpose of fixed aperture photometry .",
    "a second version of psphot used in the pv3 analysis is called psphotfullforce . in this version , a set of image all representing the same pixels",
    "are processed together , with the positions of sources to be analysed loaded from a supplied file . in this version the analysis , sources are not discovered  only the supplied sources are considered .",
    "psf models are determined for each exposure and the forced psf photometry is measured for all sources .",
    "a subset of sources may also be used to measure forced galaxy shape parameters . as described below , a grid of galaxy models are fitted based on the supplied guess model .",
    "psphot has a number of important requirements that it must meet , and a number of design goals which we believe will help to make usable in a wide range of circumstances",
    ". the critical requirements of the pan - starrs ipp which drive the requirements for psphot :    * * 10 millimagnitude photometric accuracy*. for psphot , this implies that the measured photometry of stellar objects must be substantially better than this 10 mmag since the photometry error per image is combined with an error in the flat - field calibration and an error in measuring the atmospheric effects .",
    "we have set a goal for psphot of 3mmag photometric consistency for bright stars between pairs of images obtained in photometric conditions at the same pointing , ie to remove sensitivity to flat - field errors .",
    "this goal splits the difference between the three main contributors and still allows some leeway .",
    "this requirement must be met for well - sampled images and images with only modest undersampling . * * 10 milliarcsecond astrometric accuracy*. relative astrometric calibration depends on the consistency of the individual measurements .",
    "the measurements from psphot must be sufficiently representative of the true object position to enable astrometric calibration at the 10mas level .",
    "the error in the individual measurements will be folded together with the errors introduced by the optical system , the effects of seeing , and by the available reference catalogs .",
    "we have set a goal for psphot of 5mas consistency between the true source postion and the measured position given reasonable psf variations under simulations .",
    "this level must be reached for images with 250 mas pixels , implying psphot must introduce measurement errors less than 1/50th of a pixel .",
    "the choice of 32 bit floating point data values for the source centroids places a numerical limit of 1e-7 on the accuracy of a pixel relative to the size of a chip ( since a single data value is used for x or y ) . for the @xmath4 gpc chips ,",
    "this yields a limit of about 0.25 milliarcsecond .",
    "the design goals for psphot are chosen to make the program flexible , general , and able to meet the unknown usages cases future projects may require :    * * flexible psf model * different image sources require different ways of representing the psf .",
    "ideally , both analytical and pixel - based versions should be possible .",
    "* * psf spatial variation * most images result in some spatial psf variations at a certain level .",
    "the psf representation should naturally incorporate 2-d variations . *",
    "* flexible non - psf models * psphot must be able to represent psf - like objects as well as non - psf sources ( e.g. , galaxies )",
    ". it must be easy to add new object models as interesting representations of sources are invented . * * clean code base * psphot should incorporate a high - degree of abstraction and encapsulation so that changes to the code structure can be performed without pulling the code apart and starting from scratch .",
    "* * psf validity tests * psphot should include the ability to choose different types of psf models for diffent situations , or to provide the user with methods for assessing the different psf models . * * careful systematic corrections * psphot must carefully measure and correct for the photometric and astrometric trends introduced by using analytical psf models . *",
    "* user configurable * psphot should allow users to change the options easily and to allow different approaches to the analysis .",
    "1 .   * image preparation * load data , characterize the image background , load or construct variance and mask images . 2 .   * initial object detection * smooth ,",
    "find peaks , measure basic properties .",
    "* psf determination * select psf candidates , perform model fits , build psf model from fits , select best psf model class .",
    "* bright object analysis * fit objects with psfs , determine psf validity , subtract psf - like objects , fit non - psf model(s ) , select best model class , subtract model .",
    "n sources * detect low - level sources , measure properties ( aperture or psf ) 6 .",
    "* extended source analysis * detailed measurements relevant to galaxies and/or other extended ( non - psf ) sources . 7 .   *",
    "aperture corrections * measure the curve - of - growth , spatial aperture variations , and background - error corrections . 8 .",
    "* output * write out objects in selected format , write out difference image , variance image , etc , as selected .",
    "psphot is highly configurable .",
    "users may choose via the configuration system which of the above analyses are performed .",
    "this is useful for testing , but also allows for specialized use cases .",
    "for example , the psf model may already be available from external information , in which case the psf modeling stage can be skipped .",
    "the first step is to prepare the image for detection of the astronomical objects .",
    "we need three separate images : the measured flux ( signal image ) , the corresponding variance image , and a mask defining which pixels are valid and which should be ignored .",
    "the signal and variance images are represented internally as 32-bit floating point values .",
    "the variance and mask images may either be provided by the user , or they may be automatically generated from the input image , based on configuration - defined values for the image gain , read - noise , saturation , and so forth . for the function - call form of the program ,",
    "the flux image is provided in the api , and references to the mask and variance are provided in the configuration information . as in the stand - alone c - program , the variance and mask may be constructed automatically by psphot .",
    "the mask is represented as 16-bit integer image in which a value of 0 represents a valid pixel .",
    "each of the 16 bits define different reasons a pixel should be ignored .",
    "this allows us to optionally respect or ignore the mask depending on the circumstance .",
    "for example , in some cases , we ignore saturated pixels completely while in other circumstances , it may be useful to know the flux value of the saturated pixel .",
    "in addition , the mask pixels are used to define the pixels available during a model fit , and which should be ignored for that specific fit . the initial mask ,",
    "if not supplied by the user , is constructed by default from the image by applying three rules : 1 ) pixels which are above a specified saturation level are marked as saturated ( configuration keyword : ) .",
    "2 ) pixels which are below a user - defined value are considered unresponsive and masked as dead .",
    "3 ) pixels which lie outside of a user - defined coordinate window are considered non - data pixels ( eg , overscan ) and are marked as invalid .",
    "the valid window is defined by the configuration variables , , , .",
    "psphot ( and other ipp ) functions understand two types of masked pixels : `` bad '' and `` suspect '' .",
    "bad pixels are those which should not be used in any operations , while suspect pixels are those for which the reported signal may be contaminated or biased , but may be useable in some contexts . for example , a pixel with poor charge transfer efficiency is likely to be too untrustworthy to use in any circumstance , while a pixel in which persistence ghosts have been subtracted might be useful for detection or even analysis of brighter sources .",
    "table  [ tab : mask_values ] lists the 16 bit values used for ps1 mask images , along with their description ( see * ? ? ?",
    "* for additional information ) .",
    "the variance image , if not supplied is constructed by default from the flux image using the configuration supplied values of and to calculate the appropriate poisson statistics for each pixel . in this case , the image is assumed to represent the readout from a single detector , with well - defined gain and read noise characteristics .",
    "this assumption is not always valid .",
    "for example , if the input flux image is the result of an image stack with a variable number of input measurements per pixel ( due to masking and dithering ) , the variance can not be calculated from the signal image alone .",
    "it is necessary in such a case to supply a variance image which accurately represents the variance as a function of position in the image .",
    "some image processing steps introduce cross - correlation between pixel fluxes .",
    "an obvious case is smoothing , but geometric transformations which redistibute fractional flux between neighboring pixels also introduces cross - correlations . in the noise model ,",
    "it is necessary to track the impact of the cross correlations on the per - pixel variance . in the general case",
    ", this would require a complete covariance image , consisting of the set of cross - correlated pixels for each image pixel .",
    "since a typical smoothing or warping operation may introduce correlation between 25 - 100 neighboring pixels , the size of such a covariance image is prohibitive .    before sources are detected in the image , a model of the background",
    "is subtracted .",
    "the image is divided into a grid of background points with a spacing of 400 pixels .",
    "superpixels of size @xmath5 pixels are used to measure the local background for each background grid point , thus over - sampling the background spatial variations by a factor of 2 . in the interest of speed ,",
    "10,000 randomly selected _ unmasked _ pixels in these regions are sampled to determine the background .",
    "bilinear interpolation is used to generate a full - resolution image from the grid of background points , and this image is then subtracted from the science image .",
    "the background image and the background standard deviation image are kept in memory from which the values of and are calculated for each object in the output catalog .",
    "see also the discussion in @xcite .",
    "the objects are initially detected by finding the location of local peaks in the image .",
    "the flux and variance images are smoothed with a small circularly symmetric kernel using a two - pass 1d gaussian .",
    "the smoothed flux and variance images are combined to generate a significance image in signal - to - noise units , including correction for the covariance , if known . at this stage ,",
    "the goal is only to detect the brighter sources , above a user defined s / n limit ( configuration keyword : ) .",
    "a maximum of are found at this stage .",
    "the detection efficiency for the brighter sources is not strongly dependent on the form of this smoothing function .",
    "the local peaks in the smoothed image are found by first detecting local peaks in each row .",
    "for each peak , the neighboring pixels are then examined and the peak is accepted or rejected depending on a set of simple rules .",
    "first , any peak which is greater than all 8 neighboring pixels is kept .",
    "any peak which is lower than any of the 8 neighboring pixels is rejected .",
    "any peak which has the same value as any of the other 8 pixels is kept if the pixel @xmath6 and @xmath7 coordinates are greater than or equal to the other equal value pixels .",
    "this simple rule set means that a flat - topped region will maintain peaks at the maximum @xmath6 and @xmath7 corners of the region .",
    "we use the 9 pixels which include the source peak to fit for the position and position errors .",
    "we model the peak of the sources as a 2d quadratic polynomial , and use a very simple bi - quadratic fit to these pixels .",
    "we use the following function to describe the peak          by approximating the error per pixel as the error on just the peak , and pulling that term out of the above equation , and recognizing that the values x , y in the 3x3 grid centered on the peak pixel have values of only 0 or 1 , we can greatly simplify the chi - square equation to a square matrix equation with the following values : @xmath10          the peaks detected in the image may correspond to real sources , but they may also correspond to noise fluctuations , especially in the wings of bright stars .",
    "psphot attempts to identify peaks which may be formally significant , but are not locally significant .",
    "it first generates a set of `` footprints '' , contiguous collections of pixels in the smoothed significance image above the detection threshold .",
    "these regions are grown by a small amount to avoid errors on rough edges  an image of the footprints is convolved with a disk of radius 3 pixels .",
    "peaks are assigned to the footprints in which they are contained ( note by definition all peaks must be located in a footprint ) .    for any peak which is not the brightest peak in that footprint it is possible to reach the brightest peak by following the highest valued pixels between the two peaks .",
    "the lowest pixel along this path is the _",
    "key col _ for this peak ( as used in topographic descriptions of a mountain ) . if the key col for a given peak is less than ( 4.0 ) sigmas below the peak of interest , the peak is considered to be _ locally insignificant _ and removed from the list of possible detections ( see figure  [ fig : peaks ] ) . in the vicinity of a saturated star ,",
    "the rule is somewhat more agressive as the flat - topped or structured saturated top of a bright star may appear as multiple peaks with highly significant cols between them .",
    "however , this is an artifact of the proximity to saturation . in this regime",
    ", we require the col to also be a fixed fraction ( 5% ) of the saturation below the peak to avoid being marked as locally insignificant .",
    "example of the biases encountered when measuring the second moments .",
    "a simulated image was generated using the ps1 psf profile .",
    "each panel corresponds to a different value of @xmath15 , as marked .",
    "the solid red line is the true fwhm of the psf used to generate the stars .",
    "the blue solid line is the fwhm of the window function ( @xmath16 ) .",
    "the gray dots are the fwhm derived from the measured second moments for stars in the image .",
    "the dotted blue line is the target ( 65% of the window function ) . in this example",
    ", we would choose @xmath15 between 0.5 and 0.8 arcseconds so the dotted blue line would match the bright end of the gray dots . ]    once a collection of peaks has been identified , a number of basic properties of the objects related to the first and second moments are measured .",
    "below , the second moments are used to select candidate stellar sources to be used in modeling the psf .    in order to measure the moments , it is necessary to define an appropriate aperture in which the moments are measured .",
    "we also apply a `` window function '' , down - weighting the pixels by a gaussian of size @xmath17 which is chosen to be large compared to the psf size , @xmath18 .",
    "this window function reduces the noise of the measurement of the first and second moments by suppressing the noisy pixels at high radial distance as well as by reducing the contaminating effects of neighboring stars .",
    "the choice of the window function @xmath17 and the aperture is an iterative process : for a given value of @xmath17 , the psf stars will have a measured value of @xmath18 which is modified by the effect of the window function .",
    "in addition , depending on the size of the window function compared to the true psf size , the measured value of the psf size , @xmath18 , will be biased high or low depending on the signal - to - noise of the object .",
    "these effects are illustrated in figure  [ fig : moments.window ] using simulated data .",
    "an image was generated with a psf model matching the radial profile of the ps1 psf model with a fwhm of 1.4 arcseconds .",
    "as the window function @xmath17 is increased , the measured fwhm for the bright simulated stars rises to meet the truth value . for small values of @xmath17 , fainter stars are biased to low measured values of the fwhm . for large values of @xmath17 , the faint stars are biased to higher values and the scatter increases .    in a real image",
    ", we do not know the true value of the psf size .",
    "if we simply choose a very large window function and rely on bright stars , our estimate of the psf size will be quite noisy . compounding this problem",
    "are the two additional facts that ( 1 ) we do not know which are the real stars ( as opposed to bright galaxies or possible image artifacts ) and ( 2 ) the brighter stars are themselves subject to additional biases due to saturation and other non - linear effects ( c.f . , `` the brighter - fatter '' effect , ref ) . to make a robust choice for the window function @xmath19 , we choose a value such that the measured value of @xmath18 is 65% of @xmath15 .",
    "the resulting second moment values are biased somewhat low ( 75% of the truth value for the ps1 psf profile ) , but are relatively unbiased as a function of brightness .",
    "to choose the value of @xmath17 , we try values of ( 1 , 2 , 3 , 4.5 , 6 , 9 , 12 , 18 ) pixels @xmath20 ( 0.26 , 0.51 , 0.77 , 1.15 , 1.54 , 2.3 , 3.1 , 4.6 ) arcseconds . for each of these values ,",
    "we then select candidate psf stars based on the distribution of the measured @xmath21 values . for each test value of @xmath15",
    ", we determine the ratio @xmath22 , i.e. , the ratio of the window size to the observed psf size .",
    "we interpolate to find a value of @xmath17 for which @xmath23 is expected to be 0.65 .",
    "we call this value the .",
    "we use an aperture with a radius of = 4@xmath24 to select the pixels for the measurement .        where @xmath26 is the flux in a pixel ; @xmath27 is the local sky value for that pixel ; @xmath28 is the value of the window function for the pixel ; @xmath29 is the window - weighted sum of the source flux , used to re - normalize the moments ; @xmath30 is the radius of a pixel , @xmath31 ; the sum is performed over all pixels in the aperture . for the centroid calculation ( @xmath32 ) , the peak coordinate ( see  [ sec : peaks ] ) is used to define the aperture and the window function ; for higher order moments , the centroid is used to center the window function .",
    "if the measured centroid coordinates ( @xmath33 ) differs from the peak coordinates be a large amount ( ) , then the peak is identified as being of poor quality and is rejected . in both of these cases , it is likely that the ` peak ' was identified in a region of flat flux distribution or many saturated or edge pixels .",
    "in addition to the moments above , a preliminary kron radius and flux are also calculated at this stage . in this analysis , the 1st and half - radial moments",
    "are calculated : @xmath34 note that the window function is not applied in the calculation of these moments .",
    "the kron radius @xcite is defined the be 2.5@xmath24 the first radial moment .",
    "the kron flux is the sum of ( sky - subtracted ) pixel fluxes within the kron radius .",
    "we also calculate the flux in two related annular apertures : the kron inner flux is the sum of pixel values for the annulus @xmath35 , while the kron outer flux is the sum of pixel values for @xmath36 .",
    "the first radial moment is limited at the low and high ends by @xmath37 where @xmath38 is the first radial moment of the psf stars , or 0.75@xmath24 if that can not be determined .",
    "@xmath39 is set to , the size of the moments aperture .",
    "psphot uses an analytical model to represent the shape and flux of an object .",
    "an important concept within the psphot code is the distinction between a model which describes an object on an image and a model with describes the point - spread - function ( psf ) across an image .",
    "any object in an image may be represented by some analytical model , for example , a 2-d elliptical gaussian : @xmath40 the object model will have a variety of model parameters , in this case the centroid coordinates ( @xmath41 ) , the elliptical shape parameters ( @xmath42 ) , the model normalization ( @xmath43 ) and the local value of the background ( @xmath44 ) . a specific object will have a particular set of values for these different parameters .",
    "the point - spread - function ( psf ) of an image describes the shape of all unresolved objects in the image . in a typical image ,",
    "the shape of point sources is not well described by a single function . instead , the shape will vary as a function of position in the image .",
    "the psf model therefore must describe the parameter variation as a function of the position of the object on the image .",
    "note that the object model consists of a certain number of parameters which are defined by the psf model , and another set of parameters which are independent from object to object .",
    "for the case of the elliptical gaussian model , the psf parameters would be the shape terms ( @xmath45 ) while the independent parameters would be the centroid , normalization and local sky values ( @xmath46 ) .",
    "thus these parameters are each a function of the object centroid coordinates : @xmath47 psphot represents the variation in the psf parameters as a function of position in the image in two possible ways , specified by the configuration .",
    "the first option is to use a 2-d polynomial which is fitted to the measured parameter values across the image .",
    "the second option is to use a grid of values which are measured for objects within a subregion of the image . in the latter case ,",
    "the value at a specific coordinate in the image is determined by interpolation between the nearest grid points .",
    "the order of the polynomial or the sampling size of the grid is dynamically determined depending on the number of available of psf stars . in the case of the pv3 analysis , the grid of values was used , with a maximum of @xmath48 samples per gpc1 chip image . for the earlier pv2 analysis ,",
    "the maximum grid sampling was @xmath49 per gpc1 chip image . for the pv1 analysis ,",
    "the polynomial representation was used , with up to 3rd order terms .",
    "the higher order representation was used for pv3 in order to follow some of the observed psf variations in the images    psphot uses a single structure to represent the object model and another structure to represent the psf model .",
    "the object model structure consists of the collection of measured object model parameters , carried as a vector ( ) along with an equal - length vector with the parameter errors .",
    "the structure also includes an integer giving the identifier of the model used in the particular case , as well as model fit statistics such as the chi - square of the fit and the magnitude representation of the ratio between the model flux and an aperture flux ( see below for more details on this value ) .",
    "the psphot representation of the psf consists of an array of polynomials , each representing the variation in the object model psf parameters ( of ) .",
    "the psf model structure also includes the same integer used to identify which model corresponds to particular instance of the psf . at the moment , the number of psf parameters is a fixed number ( 4 ) fewer than the number of parameters of the corresponding object model .",
    "for example , the elliptical gaussian model uses 7 parameters to represent the object and 3 for the psf model .",
    "psphot is written so that the object detection , measurement , and classification code does not depend on the specific form of the available object model functions .",
    "access to the characteristics of the models is provided through a simple function abstraction method . throughout psphot",
    ", there are many places where it is necessary for the code to refer to an aspect of the object or psf model .",
    "often , these quantities are needed deep within other parts of the code .",
    "for example , when attempting to fit the pixel flux values for an object , it is necessary to generate a guess for the model parameters . or , in order to limit the domain of the fit",
    ", it is necessary to determine an isophotal radius for a model .    in order to avoid having the code",
    "depend on the specific form of a model , the function calls needed in these types of circumstances are abstracted , and a method is provided to return the necessary function to the higher - level software . for example , each model type has its own function to define an initial guess for the model , or a function to determine the radius for a given flux level .",
    "these are then registered as part of the model function code .",
    "another function is then used to return the appropriate function for a specific model type .",
    "for example , the will return the function for a given model type .",
    "this mechanism makes it very easy to add new model functions into the psphot code base . to add a new model function",
    ", the programmer simply defines a new model name ( a string ) , the set of all necessary model lookup functions , and places the reference to the model code at the appropriate location in the psmodelinit.c routine .    when a new model is provided to psphot , it is not necessary to specify the intended use of the object model function ( ie , psf - like object , galaxy , comet , etc ) .",
    "any model can be used for the psf model , or to describe the flux distributions of the non - psf objects .",
    "the code currently uses a fixed translation between the object model parameters and the psf model parameters .",
    "it also defines a specific order for the 4 independent parameters .",
    "the first stage of determining the psf model for an image is to identify a collection of objects in the image which are _ likely _ to be psf - like .",
    "psphot uses the object moments to make the initial guess at a collection of psf - like objects . at this point ,",
    "the program has measured the second order moments for all objects identified by their peaks , as well as an approximate signal - to - noise ratio .",
    "all objects with a s / n ratio greater than a user - defined parameter ( = 20.0 ) are selected by psphot , though objects which have more than a certain number of saturated pixels are excluded at this stage .",
    "psphot then examines the 2-d plane of @xmath50 in search of a concentrated clump of objects ( see figure  [ fig : moment.class ] ) . to do this",
    ", it constructs an artificial image with pixels representing the value of @xmath50 , using a user - defined scale for the size of a pixel in this artificial image ( note that the units of the @xmath50 plane are the size of the second - moment in pixels in the original image ) .",
    "a typical value for the bin size is approximately 0.1 image pixels .",
    "the binned @xmath50 plane is then examined to find a peak which has a significance greater than xxx .",
    "unless the image is extremely sparse , such a peak will be well - defined and should represent the objects which are all very similar in shape .",
    "other objects in the image will tend to land in very different locations , failing to produce a single peak . to avoid detecting a peak from the unresolved cosmic rays , objects which have second - moments very close to 0",
    "are ignored .",
    "the only danger is if the psf is very small and too many of these objects are rejected as cosmic rays .",
    "once a peak has been detected in this plane , the centroid and second moments of this peak are measured . all objects which land within xxx @xmath51 of this centroid",
    "are selected as likely psf - like objects in the image .",
    "illustration of psf star selection using the fwhm derived from the second moments in @xmath52 and @xmath53 directions .",
    "the dominant clump is located in this diagram .",
    "galaxies tend to have a range of sizes and thus spread out above the stars .",
    "cosmic rays also have a range of sizes , with one dimension smaller than the psf .",
    "the red circle represents the psf star candidates .",
    "]      all candidate psf objects are then fitted with the selected object model , allowing all of the parameters ( psf and independent ) to vary in the fit .",
    "psphot uses the levenberg - marquardt minimization technique for the non - linear fitting .",
    "non - linear fitting can be very computationally intensive , particularly for if the starting parameters are far from the minimization values .",
    "psphot uses the first and second moments to make a good guess for the centroid and shape parameters for the psf models .",
    "any objects which fail to converge in the fit are flagged as invalid .    for the resulting collection of object model parameters ,",
    "the psf - dependent parameters of the models are all fitted as a function of position to a 2-d polynomial .",
    "the order of this polynomial is a user - defined parameter .",
    "the fitting process for these polynomials is iterative , and rejects the @xmath54 outliers in each of three passes .",
    "this fitting technique results in a robust measurement of the variation of the psf model parameters as a function of position without being excessively biased by individual objects which fail drastically .",
    "objects whose model parameters are rejected by this iterative fitting technique are also marked as invalid and ignored in the later psf model fitting stages .",
    "all of the psf - candidate objects are then re - fitted using the psf model to specify the dependent model parameter values for each object .",
    "for example , in the case of the elliptical gaussian model , the shape parameters ( @xmath55 ) for each object are set by the coordinates of the object centroid and fixed ( not allowed to vary ) in the fitting procedure .",
    "the resulting fitted models are then used to determine a metric which tests the quality of the psf model for this particular image .",
    "the metric used by psphot to assess the psf model is the scatter in the differences between the aperture and fit magnitudes for the psf objects .",
    "the difference between the aperture and fit magnitudes ( _ apresid _ ) is a critical parameter for any psf modeling software which uses an analytical model to represent the flux distribution of the objects in an image .",
    "an approximate correction is measured here , with a more detailed correction measured after all object analysis is performed . the psf model with the best consistency of the aperture correction",
    "is judged to be the best model .        before the detailed analysis of the objects",
    "is performed , it is convenient to subtract off all of the sources , at least as well as possible at this stage .",
    "we make the assumption that all sources are psf - like .",
    "if the centroid of the source has been determined , we use this value for its position ; otherwise , we use the interpolated position of the peak .",
    "a single linear fit is used to simultaneously measure all source fluxes .",
    "since the local sky has been subtracted , this measurement assumes the local sky is zero .",
    "we can write a single @xmath56 equation for this ) ^2\\ ] ] where @xmath57 is image flux for each pixel , @xmath58 $ ] is the psf model realized at the position of source @xmath59 , and @xmath60 is the normalization for the source .    minimizing this equation with respect to each of the @xmath60 values results in a matrix equation : @xmath61 where @xmath62 is the vector of @xmath60 values , the elements of @xmath63 consist of the dot products of the unit - flux psf for source @xmath59 and source @xmath64 , and",
    "@xmath65 is the dot product of the unit - flux psf for source @xmath64 with the pixels corresponding to source @xmath64 .",
    "the dot products are calculated only using pixels within the source apertures . since most sources have no overlap with most other sources , this matrix equation results in a very sparse , mostly diagonal square matrix .",
    "the dimension is the number of sources , likely to be 1000s or 10,000s .",
    "direct inversion of the matrix would be computationally very slow .",
    "however , an interative solution quickly yields a result with sufficient accuracy . in the iterative solution , a guess at the solution @xmath66",
    "is made assuming @xmath63 is purely diagonal ; the guess is multiplied by @xmath63 , and the result compared with the observed vector @xmath65 .",
    "the difference is used to modify the initial guess .",
    "this proces is repeated several times to achieve a good convergence .        once a psf model has been selected for an image , psphot attempts to fit all of the detected objects , above a user - defined signal - to - noise ratio with the psf model . for these fits ,",
    "the dependent parameters are fixed by the psf model and only the 4 independent object model parameters are allowed to vary in the fit .",
    "psphot again uses levenberg - marquardt minimization for the non - linear fitting .",
    "the objects are fitted in their s / n order , starting with the brightest and working down to the user - specified limit .",
    "once a solution has been achieved for an object , psphot attempts to judge the quality of the psf model as a representation of the object shape . to do this , it calculates the next step of the minimization _ allowing the shape parameters to vary_. this step , essentially the gauss - newton minimization distance from the current local minimum , should be very small if the object is well represented by the psf , but large if the psf is not a good representation of the object flux .",
    "the model quality is judged by the change in the two shape parameters which represent the 2d size of the object . for the case of the elliptical gaussian ,",
    "these two parameters are @xmath67 and @xmath68 . for a generic model",
    ", the shape parameters may be defined differently , but there should always be two parameters which scale the object size in two dimensions .",
    "currently , psphot requires the two relevant shape parameters to be the first two dependent parameters in the list of model parameters ( ie , parameters 4 & 5 ) .",
    "the expected distribution of the variation of the two shape parameters will be a function of the signal - to - noise of the object in question and the value of the shape parameter itself .",
    "the expected standard deviation on the shape parameter is , eg , @xmath69 .",
    "if the object is well - represented by the psf , then the shape parameter values should be close to their minimization value .",
    "we can thus ask , for each object , given the measured amplitude of the gauss - newton step , how many standard deviations from the expected value ( of 0.0 ) is this particular value ?",
    "objects for which the variation in the shape parameters is a large positive number of standard deviations are likely to be better represented by a larger flux distribution than the psf ( eg , a galaxy or comet , etc ) . objects for which the variation in the shape parameters is a large negative number of standard deviations are likely to be better represented by a smaller flux distribution than the psf ( ie , a cosmic ray or other defect ) .",
    "a user - defined number of standard deviations is used to select these two cases , and to flag the object as a likely galaxy ( really meaning extended ) or as a likely defect .    at this stage of the analysis ,",
    "psphot uses two additional indicators to identify good and poor psf fits .",
    "the first of these is the signal - to - noise ratio .",
    "it is possible for the peak finding algorithm to identify peaks in locations which are not actually a normal peak .",
    "some of these cases are in the edges of saturated , bleeding columns from bright stars , in the nearly flat halos of very bright stars , and so on . in these cases , a local peak exists , with a lower nearby sky region",
    ". however , the fitted psf model can not converge on the peak because it is very poorly defined ( perhaps only existing in the smoothed image ) .",
    "the fit can either fail to converge or it can converge on a fit with very low or negative peak flux / flux normalization .",
    "psphot will flag any non - convergent psf fit and any object with psf s / n ratio lower than a user - defined cutoff .",
    "it is also useful to identify very poor fits by setting a maximum chi - square cutoff for objects .",
    "as the objects are fitted to the psf model , those which survive the exclusion stage are subtracted from the image .",
    "the subtraction process modifies the image pixels ( removing the fitted flux , though not the locally fitted background ) but does not modify the mask or the variance images . the signal - to - noise ratio in the image after subtraction represents the significance of the remaining flux .",
    "if the subtractions are sufficiently accurate models of the psf flux distribution , the remaining flux should be below 1 @xmath51 significance . in practice",
    "the cores of bright stars are poorly represented and may have larger residual significance .",
    "sources which are blended with other sources are fitted together as a set of psfs .",
    "a single multi - object fit is performed on all blended peaks .",
    "the resulting fits are evaluated independently and any which are determined to be psfs are subtracted from the image .",
    "sources which are judged to be non - psf - like are confronted with two possible alternative choices .",
    "first , the object is fitted with a double - source model . in this pass ,",
    "the assumption is made that there are two neighboring sources , but the peaks are blended together , or otherwise not distinguished . the initial guess for the two peaks is made by splitting the flux of the single source in half and locating the two starting peaks at + /-",
    "2 pixels from the original peak along the direction of the semi - major axis of the sources , as measured from the second moments . in order for the two - source model to be accepted",
    ", both sources must be judged as a valid psf source .",
    "otherwise , the double - psf model is rejected and the source is fitted with the available non - psf model or models .",
    "after the psf model has been fitted to all sources , and the kron flux has been measured for all sources , psphot uses these two measurements , along with some additional pixel - level analysis , to determine the size class of the object .",
    "if the object is large compared to a psf , it is considered to be _ extended _ and will be fitted with a galaxy model ( or possibly another type of extended source model in special cases ) .",
    "if the object is small compared to a psf , it is considered to be a _ cosmic ray _ and masked .",
    "extended sources are identified as those for which the kron magnitude is significantly brighter than the psf magnitude when compared to a psf star . the value @xmath70 , the difference between the psf and kron magnitudes , is calculated for each object .",
    "the median of @xmath71 is calculated for the psf stars .",
    "this median is subtracted from @xmath71 for each star .",
    "the result is divided by the quadrature error of the psf and kron magnitudes and called .",
    "if is larger than ( 3.0 ) , the object is considered to be extended .",
    "cosmic rays are identified by a combination of the kron magnitude and the second - moment width of the object in the minor axis direction .",
    "the second - moment in the minor axis direction is calculated from @xmath72 as follows : @xmath73 if @xmath74 pixels@xmath75 and the instrumental kron magnitude is @xmath76 , then the object is identified as a cosmic ray and the associated pixels are masked .      once every object ( above the s / n cutoff ) has been confronted with the psf model , the objects which are thought to be galaxies ( extended ) can now be fit with appropriate models for the galaxies ( or other likely extended shapes ) . again",
    ", the fitting stage starts with the brightest sources ( as judged by the rough s / n measured from the moments aperture ) and working to a user defined s / n limit .",
    "psphot will use the user - selected galaxy model to attempt the galaxy model fits . in the configuration system ,",
    "the keyword is set to the model of interest .",
    "all suspected extended objects are fitted with the model , allowing all of the parameters to float .",
    "the initial parameter guesses are critical here to achieving convergence on the model fits in a reasonable time .",
    "the moments and the pixel flux distribution are used to make the initial parameter guess .",
    "many of the object parameters can be accurately guessed from the first and second moments .",
    "the power - law slope can be guessed by measuring the isophotal level at two elliptical radii and comparing the ratio to that expected .    for each of the galaxy models ( in fact for all object models ) , a function is defined which examines the fit results and determines if the fit can be consider as a success or a failure .",
    "the exact criteria for this decision will depend on the details of the model , and so this level of abstraction is needed .",
    "for example , in some case , the range of valid values for each of the parameters must be considered in the fit assessment . in other cases",
    ", we may choose to use only the parameter errors and the fit chi - square value .",
    "all galaxy model fits which are successful are then subtracted from the image as is done for the successful psf model fits .",
    "of course , the background flux is retained , with the result that only the object is subtracted from the image . again , the variance image is ( currently ) not modified .",
    "after a first pass through the image , in which the brighter sources above a high threshold level have been detected , measured , and subtracted , psphot optionally begins a second pass at the image . in this stage ,",
    "the new peaks are detected on the image with the bright objects subtracted . in this pass",
    ", the peak detection process uses the variance image to test the validity of the individual peaks .",
    "all peaks with a significance greater than a user - defined minimum threshold are accepted as objects of potential interest .",
    "the objects which are measured in this faint - object stage are clearly low significance detections .",
    "the pv3 threshold for the bright object analysis is a signal - to - noise of 20 .",
    "the lower limit cutoff for the faint object analysis in pv3 is a signal - to - noise of 5.0 .",
    "objects detected in the faint object stage are fitted with the psf model using the linear , ensemble fitting process .",
    "the important concept here is that an analytical model will always fail to describe the flux of the objects at some level . in the end ,",
    "all astronomical photometry is in some sense a relative measurement between two images . whether the goal is calibration of a science image taken at one location to a standard star image at another location , or the goal is simply the repetitive photometry of the same star at the same location in the image , it is always necessary to compare the photometry between two images .",
    "if this measurement is to be consistent , then the measurement must represent the flux of the stars in the same way regardless of the conditions under which the images were taken , at least within some range of normal image conditions .",
    "so , for example , two images with different image quality , or with different tracking and focus errors , will have different psf models . since an analytical model will always fail to represent the flux of the star at some level",
    ", the measured flux of the same object in the two images will be different ( even assuming all other atmospheric and instrumental effects have been corrected ) .",
    "the amplitude of the error will by determined by how inconsistently the models represent the actual object flux .",
    "for example , if the first image psf model flux is consistently 10% too low and the second is 5% too high , then the comparison between the two images will be in error by 15% .",
    "aperture photometry avoids these problems , by trading for other difficulties . in aperture",
    "photometry , if a large enough aperture is chosen , the amount of flux which is lost will be a small fraction of the total object flux .",
    "even more importantly , as the image conditions change , the amount lost will change by an even smaller fraction , at least for a large aperture .",
    "this can be seen by the fact that the dominant variations in the image quality are in the focus , tracking and seeing .",
    "all of these errors initially affect the cores of the stellar images , rather than the wide wings .",
    "the wide wings are largely dominated by scattering in the optics and scattering in the atmosphere .",
    "the amplitude and distribution of these two scattering functions do not change significantly or quickly for a single telescope and site .",
    "the difficulty for aperture photometry is the need to make an accurate measurement of the local background for each object .",
    "as the aperture grows , errors in the measurement of the sky flux start to become dominant .",
    "if the aperture is too small , then variation in the image quality are dominant .",
    "the brighter is the object , the smaller is the error introduced by the large size of the aperture .",
    "however , the number of very bright stars is limited in any image , and of course the brighter stars are more likely to suffer from non - linearity or saturation .",
    "psphot measures the aperture correction ( _ apresid _ ) for every psf candidate object and applies this correction to the psf model photometry .",
    "psphot allows a collection of psf model functions to be tried on all psf candidate objects . for each model test , the above corrected apresid scatter is measured . the psf model function with the smallest value for the apresid scatter",
    "is then used by psphot as the best psf model for this image .",
    "the number of models to be tested is specified by the configuration keyword .",
    "the configuration variables , , through specify the names of the models which should be tested .        where @xmath82 ( @xmath83 ) .",
    "the pseudo - gaussian is a taylor expansion of the gaussian and is used by dophot @xcite .",
    "the latter profiles are similar to the moffat profile form @xcite , with small differences . for the ps1 gpc1 analysis",
    ", we used the model , which we found by experimentation to match well to the observed profiles generated by ps1 .",
    "figure  [ fig : radial.profiles ] shows example radial profiles for moderately bright stars in fairly good ( 0.9 arcsec ) and poor ( 2.2 arcsec ) seeing . using a fixed power - law exponent results in somewhat faster profile fitting",
    "compared to the variable power - law exponent model .",
    "radial profiles of stellar images from ps1 .",
    "these two profiles illustrate the radial trend of the ps1 psfs for a star with fwhm 0.9 arcsec ( red ) and 2.2 arcsec ( blue ) .",
    "the black line shows the psf model with radial trend of the form @xmath84 . ]",
    "galaxies with regular profiles , such as elliptical galaxies and regular spiral galaxies , may be described as primarily a radial surface brightness profile , with additional structure acting as a perturbation on that profile . for many galaxies , the azimuthal shape at a given isophotal level",
    "may be described as an elliptical contour . to first order",
    ", a galaxy may be well decribed with a single elliptical contour and radial profile .    in order to facilitate the petrosian photometry analysis below",
    ", psphot generates a radial profile for each suspected galaxy .",
    "this analysis starts by generating a radial profile in 24 azimuthal segments .",
    "near the center of the galaxy , the profile is defined for radial coordinates in steps of 1 pixel , with the closest pixel values interpolated to that radial position .",
    "further from the center , profile is defined using the median of the pixels landing in an annular segment of size @xmath85 , rounded up to the nearest integer pixel value .",
    "the median of all pixels within a rectangular approximation to the radial wedge is used .",
    "the resulting 24 radial profiles are subject to contamination from neighboring sources or to nan values from masked pixels . to clean the profiles , pairs of radial profiles from opposite sides of the source",
    "are compared .",
    "any masked values are replaced by the corresponding value in the other profile .",
    "the minimum of both profiles is the kept for both profiles .",
    "the result of this analysis is a set of profiles of the form @xmath86 . in this case",
    ", @xmath26 is effectively the surface brightness for each radius in instrumental counts per pixel .",
    "the surface brightness profiles are then used to define the radial contour at a specific isophotal level .",
    "this contour will be used to rescale the radial profiles into a single set of profiles normalized by the elliptical contour .",
    "this contour is defined by determining the median radius for profile bins with surface brightness in the range @xmath87 to @xmath88 .",
    "the result of this analysis is a value for the radius as a function of the angle for a well - defined surface brightness regime .",
    "we then determine the elliptical shape parameters for this elliptical contour : @xmath89 .",
    "this ellipse is then used to redefine a single radial profile normalized by the elliptical contour : @xmath90    the surface brightness values are sampled at a number of radial annuli , with the radii defined in the configuration ( & ) . for each source ,",
    "the resulting surface brightness profile is saved in the output cmf - file as an n - element value in the fits table ( ) .",
    "the flux at each radial position and the fill - factor ( fraction of pixels used to the total possible ) as also saved as equal - length vectors in the fits table ( and ) .",
    "the values of the radial bins are saved in the cmf header ( , ) .",
    "@xcite defined an adaptive aperture based on a ratio of surface brightnesses .",
    "the motivation is to define an aperture which can be determined for galaxies without significant biases as a function of distance . since surface brightness in a resolved object is conserved , using a ratio of surface brightness to define a spatial scale results in a spatial scale which is constant regardless of galaxy distance .    to measure the petrosian radius and flux , we start by defining a series of radial apertures with power - law spacing : @xmath91 .",
    "we calculate the surface brightness for the annulus from @xmath92 by calculating the median of the values in the range @xmath93 to @xmath94 and dividing the the effective area of the annulus corresponding to @xmath95 .    for any annulus @xmath59 spanning the radii @xmath96 to @xmath97 ,",
    "the petrosian ratio for that annulus is defined as the ratio of the surface brightness in the annulus to the average surface brigthness within @xmath98 .",
    "the petrosian radius is defined to be @xmath99 for the annulus for which the petrosian ratio = 0.2 , i.e. , the point on the galaxy radial profile at which the surface brightness is 20% of the average surface brightness at that point .",
    "we determine the petrosian radius for the galaxy by quadratic interpolation between the last two of the fixed annuli with petrosian ratio @xmath100 and the first annulus with petrosian ratio @xmath101 .",
    "in general , the petrosian ratio for a galaxy with a regular morphology ( spiral or elliptical ) is falling monotonically , so this interpolation is unambiguous .",
    "however , irregular galaxy morphologies , noise , and/or significant masking can cause the petrosian ratio to have rises as well as drops .",
    "we track the petrosian ratio until the value is no longer significant ( @xmath102 ) .",
    "if the petrosian ratio drops below 0.2 for more than one radius , we choose the largest such radius .",
    "once the petrosian radius has been determined , we can now measure the petrosian flux : this is defined to be the total flux within an aperture corresponding to 2 @xmath24 the petrosian radius . using the petrosian flux , we can calculate two other interesting radii : @xmath103 and @xmath104 , the radii inside which 50% and 90% of the total petrosian flux is contained .",
    "we attempt to measure the radial profile of sources in order to find the radius at which the flux of the object is matches the sky . in this analysis ,",
    "a series of up to 25 radial bins with power - law spacing are defined and the flux of the object in each annulus is measured .",
    "the `` sky radius '' is defined to be the radius at which the ( robust median ) flux in the annulus is within 1 @xmath51 of the local sky level .",
    "if this limit is not reached before the slope of the flux from one annulus to the next is less than a user - defined limit , then the annulus at which the slope reaches this limit is used to define the sky radius .",
    "these values are saved in the output smf / cmf files , but not sent to the psps .",
    "the sky radius value is used below in the calculation of the kron magnitude .      preliminary kron radius and flux values @xcite",
    "are calculated soon after sources are detected ( section  [ sec : moments ] )",
    ". however , these preliminary values are not accurate due to the window - functions applied .",
    "after sources have been characterized and the psf model is well - determined , the kron parameters are re - calculated more carefully . in this version of the calculation ,",
    "the image is first smoothed by gaussian kernel with @xmath105 pixels , corresponding to a fwhm of 1.0  in the ps1 stack images .",
    "next , the kron radius is determined in an iterative process : the first radial moment is measured using the pixels in an aperture 6@xmath24 the first radial moment from the previous iteration .",
    "on the first iteration , the sky radius is used in place of the first radial moment . by default ,",
    "2 iterations are performed .",
    "the kron radius is defined the be 2.5@xmath24 the first radial moment .",
    "the kron flux is the sum of pixel fluxes within the kron radius .",
    "we also calculate the flux in two related annular apertures : the kron inner flux is the sum of pixel values for the annulus @xmath35 , while the kron outer flux is the sum of pixel values for @xmath106 .    two details in the calculation above should be noted .",
    "first , for faint sources , noise in the measurement of the 1st radial moment may result in an excessively small aperture for the successive calculations . the window used for the calculations",
    "is constrained to be at least the size of the aperture based on the psf stars ( section  [ sec : moments ] ) . at the other extreme",
    ", noise may make the radius grow excessively , resulting in an unrealistically low effective surface brightness .",
    "the aperture is constrained to be less than a maximum value defined such that the minimum surface brightness is 1/2@xmath107 the effective surface brightness of a source detected at the @xmath108 limit .",
    "second , the measurement of the 1st radial moment includes a filter to reduce contamination from outlier pixels .",
    "pairs of pixels on opposites sides of the central pixel are considered together .",
    "the geometric mean of the two fluxes is used to replace the flux values .",
    "if the object has 180  symmetry , this operation has no impact .",
    "however , if one of the two pixels is unusually high , the value will be surpressed by the matched pixel on the other side .",
    "this trick has the effect of reducing the impact of pixels which include flux from near neighbors .      in the galaxy model fittting stage ,",
    "sources which meet certain criteria are fitted with analytical models for galaxies .",
    "three traditional analytical galaxy models are implemented in and used in the pv3 analysis :      where @xmath112 is a normalized radial term : @xmath113 .",
    "the terms ( @xmath114 , @xmath115 , @xmath116 ) describe the elliptical contour and the profile scale in all three models and the coordinates @xmath117 & @xmath118 are determined relative to the centroids ( @xmath119 ) . including the normalization ( @xmath120 ) and a local sky value , the exponential and devaucouleur profiles have 7 free parameters and the sersic profile has the additional free parameter of the sersic index @xmath121 .    in this stage ,",
    "the galaxy model is convolved with an approximation to our best guess for the psf model at the location of the galaxy . for the pv3 analysis ,",
    "all sources detected in the bright source analysis step ( @xmath122 ) were fitted with all three galaxy models , unless ( a ) the morphological test identified the source as a likely cosmic ray ( section  [ sec : source.size ] ) or ( b ) the peak of the psf profile was above the saturation limit for the chip ( see the discussion in * ? ? ?",
    "* regarding the masking of saturated pixels ) .",
    "sources in the denser portions of the galactic plane and bulge were not included in the analysis .",
    "this restriction limited the total time spent on the galaxy modeling analysis at the expense of galaxy photometry in the plane ( though kron photometry is available for those objects ) .",
    "the galactic plane region was defined by @xmath123 where @xmath124 . for the pv3 analysis , @xmath12520 , @xmath12615 , @xmath12750 .",
    "before the non - linear fitting may be performed , it is necessary to determine initial values for the parameters to be fitted . for each of the three model types , the position determined from the psf fitting analysis",
    "is used as the initial centroid @xmath128 . a guess for the terms (",
    "@xmath114 , @xmath115 , @xmath116 ) is generated based on the second moments .",
    "the guess does not attempt to use the psf model to adjust the ( @xmath114 , @xmath115 , @xmath116 ) values ; it was found that such a guess tended to be too small and resulted in more iterations rather than fewer .",
    "the 1st radial moment ( see [ sec : moments ] ) is used to estimate the effective radius of the model based on the results of graham & driver ( 2005 , table 1 ) .",
    "they quantive the relationships between the first radial moment used to calculated a kron magnitude and the effective radius for different sersic index values , @xmath121 .",
    "since the exponential and devaucouleur models are equivalent to sersic models with @xmath121 = 1 and 4 , respectively , this work can be used to generate the initial effective radius values for all 3 model types .",
    "once the effective radius is chosen , the second moments are used to define the aspect ratio and position angle of the elliptical contour .",
    "the kron flux is used to generate a guess for the normalization , applying an appropriate scale factor based on the ( @xmath114 , @xmath115 , @xmath116 ) values , generated by integrating normalized sersic models and determining the relationship between the central intensity and the integrated flux as a function of the sersic index .    the psf - convolved galaxy model fitting analysys uses the levenberg - marquardt minimization method to determine the best fit .",
    "in this process , the @xmath56 value to be minimized is : @xmath129 ^ 2\\ ] ] where @xmath130 represents the pixel values in the image ( within some aperture ) and @xmath131 represents the unconvolved galaxy model , a function of a number of parameters @xmath132 , which is then convolved with the psf model .      to determine the minimization",
    ", we need the gradient and laplacian of @xmath56 with respect to the model parameters , @xmath134 : @xmath135 where we have approximated the laplacian with the hessian matrix , @xmath136 by dropping the second - derivatives ( which are assumed to be a small perturbation ) .",
    "since @xmath137 and since the order of the derivative and convolution may be exchanged , we can write these in terms of the convolved image of the model and the convolved images of the derivatives of the model @xmath138 with respect to the model parameters , @xmath134 : @xmath139 the gradient vector and hessian matrix are used in the levenberg - marquardt minimization analysis using the standard techinique of determining a step from the current set of model parameters to a new set by solving the matrix equation : @xmath140 where @xmath141 is zero for @xmath142 and for @xmath143 set to be large when the last iteration produced a large change in the parameters compared to the local - linear expectation and small when the last change was small .",
    "the iteration ends when the change in the parameters is small and/or the change in the @xmath56 value is small .    in the analysis , convolved galaxy fit , the galaxy model image and the model derivative images",
    "must be convolved with the psf at each iteration step . to save computation time",
    ", this convolution is performed using a circularly symmetric approximation of the psf model , with the psf model scale size set to the average of the major and minor axis direction scale size of the full psf model , with the same radial profile term as the psf model .",
    "the convolution is performed directly using the circular symmetry to reduce the number of multiplications performed : all points in the 2d circularly symmetric psf model which have the same radial pixel coordinate can be evaluated in the convolution by summing up the corresponding pixels in the ( galaxy model ) image to be convolved before multiplying by the psf model profile at that radial coordinate .",
    "this approximation reduces the number of multiplications by a factor of near 8 for larger radii . for the small size of the psf model used to convolve the galaxy model images ,",
    "it was found that this direct convolution was faster than using an fft - based convolution .    for the exponential and devaucouleur fits ,",
    "all parameters are fitted in the non - linear minimization stage . for the sersic model",
    ", we do not fit the index within the levenberg - marquardt analysis .",
    "instead , we start with a coarse grid search over a range of possible index values , ( @xmath144 ) and a range of possible values for @xmath145 based on the value of @xmath146 , the first radial moment . for a given value of the sersic index ,",
    "the @xmath145 is related to the 1st radial moment by the scale factor specificy by graham & driver .",
    "we use the observed value of the 1st radial moment and try @xmath145 values of a factor of ( 0.8 , 0.9 , 1.0 , 1.12 , 1.25 ) times the value predicted by the graham and driver equation . for each of these steps ,",
    "the aspect ratio and position angle are held constant and the normalization is determined to minimize the @xmath56 .",
    "we next perform 3 levenberg - marquardt minimization fits allowing the shape parameters ( @xmath114 , @xmath115 , @xmath116 ) and the normalization to be fitted , holding the centroid ( @xmath33 ) , sersic index @xmath121 , and sky constant . in these fits , the index @xmath121 is set to the minimum value previously calculated as well as values halfway to the next , and previous , values in the grid above . e.g. , if the minimum fitted index value is 3.0 , then the lmm fits are performed using @xmath121 = 2.5 , 3.0 , 3.5 .",
    "the resulting @xmath56 values are then used to perform quadratid interpolation to find the index @xmath121 which produces the locally minium @xmath56 value .",
    "finally , this best - fit index value is held constant while levenberg - marquardt minimization is used to find the best fit values of all other parameters .      for some science goals ,",
    "a well - measured color of a galaxy is more important than an accurate total magnitude . in the case of ps1 ,",
    "the image quality variations for stacks of different filters presents a serious challenge for the determination of precise colors .",
    "psphot determines a set of psf - matched radial aperture flux measurements in order to minimize the impact of the stack image quality variations .    in psphotstack , the stack analysis version of psphot",
    ", the 5 filter images are processed together .",
    "after the psf models have been fitted and a best set of galaxy models have been determined , three sets of radial apertures are measured . in the first set , the fluxes in the radial apertures are measured using the raw stack images .",
    "the centers of the apertures for each object across the 5 filters are fixed so that the pixels represent the equivalent portions of the same galaxy for all 5 filters . in this analysis , the best model for each object",
    "is subtracted from the image pixels for all objects excluding the object in consideration .",
    "the best model is determined based on the minimum @xmath56 value for the model fits .",
    "in addition to the raw radial apertures , the stack images are each convolved with a circular gaussian with @xmath51 chosen to yield an image with a typical fwhm of 6 .",
    "the full set of radial apertures are again measured on these convolved images .",
    "again , the best object models are subtracted from the image for objects not being measured .",
    "this subtraction includes the convolution to smooth the model to the effective fwhm of the convolved image .",
    "the entire procedure is then repeated with a target fwhm of 8 .",
    "the pan - starrs1 surveys ( ps1 ) have been made possible through contributions of the institute for astronomy , the university of hawaii , the pan - starrs project office , the max - planck society and its participating institutes , the max planck institute for astronomy , heidelberg and the max planck institute for extraterrestrial physics , garching , the johns hopkins university , durham university , the university of edinburgh , queen s university belfast , the harvard - smithsonian center for astrophysics , the las cumbres observatory global telescope network incorporated , the national central university of taiwan , the space telescope science institute , the national aeronautics and space administration under grant no .",
    "nnx08ar22 g issued through the planetary science division of the nasa science mission directorate , the national science foundation under grant no .",
    "ast-1238877 , the university of maryland , and eotvos lorand university ( elte ) and the los alamos national laboratory ."
  ],
  "abstract_text": [
    "<S> over 3 billion astronomical objects have been detected in the more than 22 million orthogonal transfer ccd images obtained as part of the pan - starrs1 @xmath0 survey . over 85 billion instances of those objects </S>",
    "<S> have been automatically detected and characterized by the pan - starrs image processing pipeline photometry software , . </S>",
    "<S> this fast , automatic , and reliable software was developed for the pan - starrs project , but is easily adaptable to images from other telescopes . </S>",
    "<S> we describe the analysis of the astronomical objects by in general as well as for the specific case of the 3rd processing version used for the first public release of the pan - starrs @xmath0 survey data . </S>"
  ]
}