{
  "article_text": [
    "modern portfolio theory @xcite formulates the asset allocation problem as an optimization model , with the objective of maximising the expected portfolio return subject to keeping the estimated risk below a pedefined level ( the `` risk budget '' ) . in theory",
    ", this approach should result in a carefully diversified asset allocation across various investable assets . in practice , however , optimal asset allocations computed from portfolio models are often seen as counterintuitive and ill - diversified , as they may contain large positions in just a few assets , and a large number of very small positions @xcite . to overcome this problem",
    ", fund managers often impose additional constraints in the form of strategic allocation targets .",
    "we have found however , that the imposition of allocation targets is artficial and unnecessary if both the parameter estimation and the numerics that go into a portfolio model are carried out very carefully .",
    "this paper is aimed primarily at practitioners . inspired by an essay by wilmott @xcite ,",
    "we give a list of seven sins in porfolio optimization that should be avoided at all cost .",
    "the best known investment model is the one - period mean - variance ( mv ) model of markowitz @xcite . for the purposes of this paper we restrict ourselves to this model , as it is both very simple and widely known among the readership and yet of fundamental interest in finance .",
    "a very similar discussion could be held about more complex multiperiod models that involve more general risk terms . for the sake of completeness and to define the notation , we start with a brief recap of the mv model .    an investor wishes to actively manage a portfolio in @xmath0 risky assets .",
    "the investor holds fixed positions @xmath1 in asset @xmath2 over an investment period @xmath3 $ ] ( one hour , day , week , month , ... ) , at the end of which he / she is prepared to adjust the positions again .",
    "the expected return of asset @xmath2 is @xmath4 $ ] .",
    "@xmath5 is the random variable describing the return per unit position in asset @xmath2 over the investment period @xmath3 $ ] .",
    "hence the expected portfolio return is @xmath6 = x^{\\operatorname{t}}e[r].\\ ] ] the variance of the portfolio return is @xmath7 the elements @xmath8 of the @xmath9 variance - covariance matrix @xmath10 are @xmath11\\bigr)\\bigl(r_j-\\operatorname{e}[r_j]\\bigr ) \\right].\\ ] ] the problem the investor faces is to decide on the positions @xmath1 .",
    "the mean - variance approach to this problem proposes to choose the positions by solving the following optimization problem , @xmath12\\label{mean variance}\\\\ \\text{s.t . } & x^{\\operatorname{t}}\\operatorname{cov}(r , r)x\\leq\\operatorname{\\sigma^2_{max}},\\nonumber\\end{aligned}\\ ] ] where @xmath13 refers to the @xmath14 where the objective function is maximised .    to make model useable in practice",
    ", the expectations and covariances need to be replaced by estimates @xmath15,\\\\ \\sigma_{ij}&\\approx\\operatorname{cov}\\bigl(r_i , r_j\\bigr).\\end{aligned}\\ ] ] this is usually done via proprietary methods that use historical prices and other data available at time @xmath16 .",
    "the practical problem being solved is then @xmath17 where @xmath18 denotes the transpose of a vector , @xmath19 is the vector of @xmath20 and @xmath21 is the matrix of @xmath22 .     for @xmath23 .",
    "the red line marks the boundary of the ellipsoid @xmath24 .",
    "the eigenvectors of @xmath21 define the principal directions of the ellipsoid and the inverse of the square roots of the eigenvalues are the corresponding equatorial radii .",
    ", scaledwidth=75.0% ]    the set @xmath25 of decision vectors that satisfy the constraints of an optimization problem is called the _",
    "feasible domain_. for the model problem this is the interior of an ellipsoid induced by the inequality constraint @xmath26 .    if @xmath25 is a convex set ( that is , for any pair of points @xmath27 the line segment @xmath28\\}$ ] between @xmath29 and @xmath30 lies in @xmath25 ) , and if @xmath31 is a convex function ( that is , for any @xmath27 and @xmath32 $ ] , @xmath33 ) , then the problem is called a _",
    "convex optimization problem _ be a convex set . ] .",
    "if @xmath21 is symmetric positive definite and @xmath34 , the analytic solution of this problem is given as @xmath35 note that @xmath36 , e.g.  the optimum lies at the boundary of the aforementioned ellipsoid .",
    "we introduce the sharpe ratio @xcite for @xmath37 in this context as @xmath38 where @xmath39 is a risk - free interest rate over the considered investment period .",
    "we will henceforth assume short investment periods on the order of days and set @xmath40 , but all the calculations easily extend to the case where @xmath41 .",
    "note that the sharpe ratio @xmath42 of the optimal portfolio does not depend on @xmath43 .",
    "we identified the model formulation , the estimation of parameters and the algorithmic solution as potential mine fields of portfolio optimization .",
    "another mine field concerns parameter uncertainty . in order to keep the technical difficulty of this paper to a minimum , we chose not to deal with this issue here , but we refer our readers to the extensive recent literature on robust optimization @xcite . among the countless ways to produce unsatisfactory results through portfolio modelling , we chose to discuss just seven of the most common mistakes that we have seen committed .",
    "this is a true classic that deserves the top spot here . a single negative eigenvalue ( even if close to zero ) can spoil it all . in practice",
    "the covariance matrix @xmath21 is estimated using historic data .",
    "it is tempting to estimate the elements of the matrix using independent processes for each entry , e.g. moving averages with distinct update rates .",
    "this is a recipe for disaster .",
    "we illustrate the consequences :    let @xmath21 be a symmetric real matrix .",
    "then there exists a real orthonormal matrix @xmath44 such that @xmath45 is a diagonal matrix .",
    "the diagonal entries of @xmath46 are the eigenvalues of @xmath21 .",
    "the columns of @xmath44 are the eigenvectors .",
    "let us assume that there exists an eigenvector @xmath47 associated with a negative eigenvalue @xmath48 .",
    "then @xmath49 .",
    "hence we can find a portfolio with a negative variance , that is , @xmath47 corresponds to a portfolio of negative risk .",
    "taking weights @xmath50 , where @xmath51 when @xmath52 and @xmath53 otherwise , and where @xmath54 , we obtain a portfolio with expected return @xmath55 that satisfies the risk budget , since @xmath56 this might entice one to take arbitrarily large positions in the erroneous belief that the risk budget will not be exceeded .",
    "some argue that the introduction of extra constraints such as the self - financing condition @xmath57 and non - shortselling conditions @xmath58 avoid the problem of large positions .",
    "however , the positions will still be completely nonsensical , and the extra constraints may not be applicable to all asset classes . although there exist some approaches to correct estimated and polluted covariances , see higham@xcite , we found that a careful analysis of the estimation process itself adds far more value to the trading strategy .",
    "the second sin is of more subtle nature and yet more dramatic . for almost rank deficient matrices the ellipsoid in fig .",
    "[ fig : volcon1 ] becomes very cigar - shaped .",
    "the eigenvectors associated with small eigenvalues will change strongly under even very small perturbations of the matrix . in a typical backtest",
    "the entries of such a matrix are updated and hence the ellipsoid will rotate",
    ".    even if @xmath21 has only positive eigenvalues they might be still too small .",
    "the inverse of @xmath21 is @xmath59 where @xmath44 and @xmath46 are the aforementioned matrices of eigenvectors and eigenvalues .",
    "this decomposition can be represented as sum of outer products , that is @xmath60 we assume @xmath61 .",
    "inserting into yields @xmath62 the position @xmath63 is a linear combination of @xmath0 _ principal portfolios _ @xmath64 .",
    "this term only gives the explicit solution for the standard model .",
    "the effect of ill - conditioning is equally important in problems with more constraints .",
    "this reveals the fundamental problem of the markowitz model : the weights scale as @xmath65 , that is , the optimizer will try to align the position with principal portfolios linked with small eigenvalues .",
    "michaud@xcite calls this effect the maximization of the estimation error as the eigenvectors associated with small eigenvalues are most sensitive to noise . in practice",
    ", it has often been observed that this results in rather extreme positions .",
    "there are numerous approaches to overcoming this behavior .",
    "a popular approach is to ignore eigenvalues smaller than a threshold in the sum for @xmath63 .",
    "often the threshold is induced by the wigner semicircle distribution .",
    "another powerful approach is to use shrinkage estimators @xcite , the most simple of which is the convex combination @xmath66 where @xmath67 is the identity matrix .",
    "so the eigenvalues of @xmath68 are @xmath69 .",
    "although matrix shrinkage towards @xmath67 does not change the eigenvectors , and hence eigenvectors are still equally sensitive to noise , the eigenvalues change ( and are in particular larger than @xmath70 ) .",
    "this weakens the impact of the last few eigenvectors , especially as @xmath19 tends to be close to orthogonal to them . a third approach that shows excellent practial results",
    "was developed by zuev @xcite , who used semi - definite programming to maximize the smallest eigenvalue among the covariance matrices @xmath21 that lie in a certain subset of the set of symmetric positive definite matrices .",
    "we have observed that some find it simply too tempting to bypass all the maths by using a more trivial intermediate stage in the optimization process . rather than solving the toy problem",
    ", some practitioners first identify the unit - vector @xmath30 that results in the maximal expected return .",
    "this vector is @xmath71 . in a second stage",
    "they then identify the scaling factor @xmath72 that achieves to achieve @xmath73 . using this approach",
    "the optimal vector is @xmath74 although this looks close to the analytic solution , dramatic differences exist : in the numerator of @xmath75 all information contained in @xmath21 is ignored . as a result ,",
    "this approach does not exploit diversification , one of the uncontested benefits of investing in a portfolio rather than a single asset .",
    "worse even , there is some danger lurking in the denominator .",
    "as soon as @xmath19 is aligned with an eigenvector corresponding to a small eigenvalue the denominator can be extremely small and blow up the position size and hence the portfolio .",
    "a modern solver may iterate through the feasible domain by taking dozens of intermediate steps that converge towards the unique global maximum of .",
    "however , the choice of those steps should be left to the solver .",
    "most portfolio optimization models are convex programming problems , a class of well - studied optimization problems with rich mathematical structure @xcite .",
    "non - convex optimization problems may have multiple local extrema and convergence to a global extrema ( it may be not unique ) can not be guaranteed as the solver may get attracted to any of the local extrema @xcite . when multiple optimization problems are solved sequentially , the solution may get attracted to a different local extremum each time , even when the model parameters change only slightly , and this can result in high trading costs .",
    "it is therefore often preferrable to use a convex portfolio model that avoids these costs or at least do extensive backtesting to estimate the impact of these costs on performance .",
    "a related problem is the failure to recognize convexity when it is present implicitly in a model , as this prevents one from using convex optimization software that would be able to solve the problem much efficiently and robustly than most nonconvex solvers . as an example , consider a portfolio manager who aims to maximize the sharpe ratio @xcite @xmath76 we note that the sharpe ratio is not defined for @xmath37 and the limit of @xmath77 for @xmath78 does not exist .",
    "further , the sharpe ratio function has no unique maximizer , since @xmath79 for all @xmath80 and @xmath37 .",
    "using model in conjunction with a nonconvex solver may lead to the evaluation of @xmath77 for points close to the origin , which causes numerical inaccuracy . to avoid this problem",
    ", we wish to avoid the origin and a reasonably large region around it . exploiting the fact that @xmath79 , we may rescale @xmath29 to satisfy @xmath81 . hence",
    ", the problem becomes @xmath82 the numerator of @xmath77 now being constrained to a fixed number , it plays no role in the maximization of @xmath77 and can be neglected , that is , the optimal decision vector @xmath63 can be found by solving the simpler problem @xmath83 this problem is still not convex , as the feasible domain is the boundary of the risk ellipsoid , but it provably has the same solution as the convex problem @xmath84 for generically we have @xmath85 , and if @xmath86 , then @xmath87 is an improved feasible solution for @xmath88 .",
    "this contradicts the optimality of @xmath63 and shows that the optimal @xmath63 must satisfy the constraint of the nonconvex problem automatically . in this fashion , solving the convex problem yields a maximizer @xmath63 of the nonconvex problem whilst avoiding the associated numerical problems .",
    "most portfolio managers solve a variant of with additional constraints for which the optimal solution is no longer given in closed form .",
    "a solution has to be computed algorithmically in this case , and the choice of a good solver is crucial .",
    "the most robust and powerful solvers require the problem to be reformulated in a specific standard form , which usually requires a lift - and - project approach that will be further described below .",
    "for example , matlab s ` quadprog ` is unable to solve problem directly without lifting the risk constraint into to the utility function .    bypassing such steps by writing proprietary optimization software",
    "is not recommended , as the numerical challenges faced in such attempts are easily underestimated .",
    "a particularly popular route in this context is to use _ simulated annealing _ , because it is intuitive to understand and trivial to code .",
    "however , whilst simulated annealing has its place in highly nonconvex and unstructured global optimization problems , it is not designed to exploit any of the strong mathematical structures that underly portfolio problems , in particular convexity , and as a result it converges far less robustly and exceedingly more slowly than modern convex optimization solvers .    to demonstrate the fallacy of simulated annealing we tried to implement a simple scheme . however , even the most basic convex and constrained problems are hard to approximate with such algorithms and require careful tuning . it remains a black art . in a multi - period setting in which the portfolio positions are frequently updated , it is of utmost importance to choose a robust solver that yields reproducible results free of random fluctuations that cause unnecessary transactions costs when rebalancing the portfolio .",
    "the issue of transaction costs is so important that is wise to reduce the fluctuations that occur as a function of the changing model parameters even further , by ways of regularization terms . the use of a fast , robust , reliable , deterministic algorithm is also hugely important in any back - testing framework for quantitative trading in which one wishes to study the statistical behavior of the trading strategy and avoid all avoidable sources of artificial randomness .",
    "most portfolio problems have reformulations as second order cone programming problems ( socps ) , or , occasionally semidefinite programming problems ( sdps ) .",
    "such problems can be solved in polynomial time via iterative schemes known as _ interior - point methods_. practical implementations of such schemes are currently the leading codes for solving portfolio problems in terms of robustness , speed and reliability .",
    "leading codes include the following :    * sdpt3 @xcite , see http://www.math.nus.edu.sg/@xmath89mattohkc/sdpt3.html , is freely available , only available for matlab .",
    "* sedumi @xcite , see http://sedumi.ie.lehigh.edu/ , is very similar to sdpt3 . * mosek @xcite , see http://www.mosek.com is the leading commercial conic programming solver and has interfaces for the most common programming languages .",
    "lifting is a powerful technique to make hard problems look simple by introducing additional dimensions . using a classic example we demonstrate what it is all about :",
    "often problems of type are solved in a large loop over thousands of investment periods . for each period some of the estimates may change and the portfolio is rebalanced .",
    "it is certainly a good idea to take into account some costs when changing the position .",
    "most quants use quadratic costs as the resulting cost term is differentiable .",
    "however , such terms tend to overestimate costs for large trades .",
    "let us assume that the system currently holds the position @xmath90 and a new investment periods starts . the formulation above is not taking into account the position @xmath90 at all .",
    "this may result in large costs and spurious oscillations in the position.to address these problems we penalize deviations from @xmath90 , that is @xmath91 the positive parameters @xmath92 reflect the estimate costs per unit position .",
    "introducing auxiliary variables @xmath93 the problem can be reformulated as @xmath94 \\label{lttf2}\\\\ \\text{s.t . } & x^{\\operatorname{t}}c x\\leq\\operatorname{\\sigma^2_{max } } , \\nonumber \\\\ & x_i - x^0_i \\leq t_i,\\nonumber \\\\ & x^0_i - x_i \\leq t_i.\\nonumber\\end{aligned}\\ ] ]    problem is called a _ lifting _ of problem . through the introduction of extra variables ,",
    "liftings involve an inflation of the problem dimension .",
    "this seeming disadvantage is offset when the following occurs :    * the lifted problem belongs to a problem class with lower complexity than the original problem .",
    "for example , in the above case , a nonsmooth problem turned into a smooth one ( the nondifferentiable absolute value terms in the constraint have disappeared ) .",
    "in other cases , nonconvex problems can be convexified through liftings . *",
    "the lifted problem belongs to a problem class for which efficient standard software already exists , avoiding the need to implement a custom designed algorithm . in the example above , a quadratic programm resulted , one of the most efficiently solved class of optimization problems .",
    "as long as @xmath97 problem has a non - empty feasible domain as it contains the trivial portfolio @xmath98 . in equity portfolios",
    "the position @xmath29 is often interpreted as a fraction of the investors s capital .",
    "being _ fully invested _ is then reflected by the constraint @xmath99 .",
    "the enhanced problem @xmath12\\label{equity}\\\\ \\text{s.t . } & x^{\\operatorname{t}}\\operatorname{cov}(r , r)x\\leq\\operatorname{\\sigma^2_{max}},\\nonumber\\\\ & e^{\\operatorname{t } } x = 1 \\nonumber\\end{aligned}\\ ] ] has no solution if @xmath43 is smaller than the minimum variance @xmath100 of all fully invested portfolios , e.g. @xmath101                                                      c.  stein .",
    "inadmissibility of the usual estimator for the mean of a multivariate distribution . in j. neyman ( ed . ) , _ proc .",
    "berkeley symp .",
    "statist .",
    "_ , vol .  1 , pp .",
    "california press , 1956 .",
    "todd , k.c .",
    "toh and r.h .",
    "ttnc . on the implementation and usage of sdpt3",
    " a matlab software package for semidenite - quadratic - linear programming , version 4.0 .",
    "_ http://www.math.nus.edu.sg/",
    "mattohkc / sdpt3.html_.      p.  wilmott .",
    "the commonest mistakes in quantitative finance : a dozen basic lessons in commonsense for quants and risk managers and the traders who rely on them . _ frequently asked questions in quantitative finance , 2nd edition _ , wiley , 2009 , pp ."
  ],
  "abstract_text": [
    "<S> although modern portfolio theory has been in existence for over 60 years , fund managers often struggle to get its models to produce reliable portfolio allocations without strongly constraining the decision vector by tight bands of strategic allocation targets . </S>",
    "<S> the two main root causes to this problem are inadequate parameter estimation and numerical artifacts . </S>",
    "<S> when both obstacles are overcome , portfolio models yield excellent allocations . in this paper , which is primarily aimed at practitioners </S>",
    "<S> , we discuss the most common mistakes in setting up portfolio models and in solving them algorithmically .    </S>",
    "<S> primary 91g10 . </S>",
    "<S> secondary 90c25 , 90c90 .    </S>",
    "<S> portfolio theory , mean - variance optimization , conic optimization . </S>"
  ]
}