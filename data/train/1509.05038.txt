{
  "article_text": [
    "the interstellar medium ( ism ) consists predominantly of hydrogen ( @xmath0 ) , followed by helium ( @xmath1 ) and heavier elements ( @xmath2 ) .",
    "its interaction with the ultraviolet ( uv ) radiation emitted by massive stars is of great interest .",
    "extreme uv photons carrying more energy than the ionization potential of hydrogen ( @xmath3 ) ionize the gas .",
    "any excess over the ionization potential is then transformed into kinetic energy of the liberated electrons ( photoelectrons ) .",
    "regions containing a significantly high fraction of photoelectrons are known as ` h  ii regions ' @xcite and have temperatures of the order of @xmath4 which is higher than that of the surrounding gas ( @xmath5 ) resulting in their expansion @xcite .",
    "the edge of the ionized medium is known as an ` ionization front ' and separates the h  ii region from the rest of the ism .",
    "the ionization front can be considered as a sharp discontinuity in which the degree of ionization and the gas temperature drops abruptly , over a few uv photon mean free paths .",
    "the material ahead of this front is dominated by far - uv radiation ( fuv ) carrying energy @xmath6 .",
    "photons in this energy regime can photodissociate co and h@xmath7 molecules creating so called ` photodissociation regions ' ( pdrs ; known also as  photon - dominated regions  ,",
    "see * ? ? ?",
    "* for a review ) .",
    "further ahead the radiation field is attenuated to the extent that it does not affect quiescent molecular zones .",
    "studies of the different phases of the ism are of great interest as they can lead to an in - depth understanding of the mechanisms responsible for its structure and dynamical evolution .",
    "this in turn may answer important questions concerning the contribution of stellar feedback in driving turbulence at small ( subpc ) scales ( see e.g. * ? ? ?",
    "* for a more general discussion on ism turbulence ) well as the modes that trigger the formation of new stars beyond the expanding ionized regions .",
    "studying pdrs is key to understanding the role played by the fuv photons in governing the physical and chemical structure and determining the thermal balance of the neutral ism in galaxies .",
    "several groups worldwide have made significant efforts in simulating the ( hydro-)dynamical evolution of the ism using different computational techniques such as smoothed particle hydrodynamics ( sph ) and adaptive mesh refinement ( amr ) .",
    "these have led to the modelling of star formation processes , as well as feedback from massive stars and magnetic fields @xcite . on the other hand ,",
    "observations have produced a wealth of data from the atomic and molecular lines emitted at different wavelengths by the different phases of the ism .",
    "however , this does not directly reveal the exact three - dimensional density and velocity structure of the observed objects .",
    "there is thus the need for a tool which acts as a `` common interface '' between the simulated hydrodynamical ism structure and the observed line emission . towards this goal",
    ", efforts have been made to model the complex chemical processes occurring in the different phases of the ism of particular relevance to pdrs .",
    "coupling radiation transport techniques with hydrodynamics and the gas chemistry , however , is complicated and poorly developed as yet , although significant efforts have been made in this direction by @xcite and @xcite .",
    "numerical codes dedicated to modelling the chemistry in photoionized regions and pdrs have been presented in the past .",
    "codes for photoionized regions include cloudy @xcite while a three - dimensional treatment has been achieved in the mocassin code @xcite and in the torus code @xcite which are based on monte carlo ( mc ) methods first described by @xcite . on the other hand ,",
    "several codes treating pdrs have been presented in the past decade or so .",
    "these include ucl_pdr @xcite , cloudy @xcite , costar @xcite , htbkw @xcite , kosma-@xmath8 @xcite , leiden @xcite , meijerink @xcite , meudon @xcite and sternberg @xcite .",
    "@xcite provide an interesting review of many of those pdr codes as well as benchmarking tests pinpointing the differences .",
    "the codes are able to treat complicated chemical networks and thus obtain the abundances of many chemical species , the line emissivities of different coolants , as well as temperature profiles within a given pdr .",
    "while most attention has been paid to an accurate chemical pdr modelling , the majority of pdr codes treat one - dimensional structures .",
    "recently @xcite have implemented the three - dimensional code 3d - pdr which is able to treat pdrs of any given arbitrary density distribution .",
    "in addition @xcite also improved the kosma-@xmath8 pdr code to handle 3d pixels ( voxels ) which mimic the fractal structure of the ism .",
    "these new implementations meet the need for pdr codes to treat complicated geometrical structures , since the chemistry can depend on it .    in this paper , we present the first self - consistent fully three - dimensional unified code for treating photoionized and photodissociated regions simultaneously with arbitrary geometrical and density distributions .",
    "this new code is able to calculate i ) the structure of circumstellar and interstellar radiation fields using an mc method that treats the diffuse component and ii ) a detailed pdr chemistry using a healpix ray - tracing scheme to estimate the cooling and heating rates as well as line emissivities , the abundances of chemical species and temperature profiles , following the methods of the 3d - pdr code .",
    "it therefore models the wide range of observable chemical processes which take place in the transition zones from ionized to molecular regions .",
    "our paper is organized as follows . in sections",
    "[ sec:3dpdr ] and [ sec : torus ] we give an overview of the 3d - pdr and torus codes respectively . in section [ sec : coupling ] we show the method we followed for coupling the two codes . in section [ sec : benchmark ] we benchmark our new code while in section [ sec : applications ] we show the capabilities of the code in simulating three - dimensional structures .",
    "we conclude in section [ sec : conclusions ] with the description of the effects introduced in simulating photoionized and photodissociation regions in full three dimensions .",
    "the 3d - pdr code ( * ? ? ? * hereafter  b12  ) is a three - dimensional time - dependent astrochemistry code which has been designed to treat pdrs of arbitrary density distribution .",
    "it is a further development of the one - dimensional ucl_pdr code and it uses the chemical model features of @xcite .",
    "it solves the chemistry and the thermal balance self - consistently in each computational element of a given cloud .",
    "3d - pdr has been fully benchmarked against other pdr codes according to the tests of @xcite and has been used in various applications e.g. @xcite .",
    "we list below a brief overview emphasizing on the ray - tracing and uv treatment as well as the model chemistry used in 3d - pdr . for full details about the code see b12 .",
    "3d - pdr uses a ray - tracing scheme based on the healpix @xcite package . along each ray , the elements closest to the line - of - sight are projected creating a set of points called ` evaluation points ' .",
    "the properties of the evaluation points are identical to those of the projected elements . with this technique",
    "we are able to calculate : i ) the column densities of species for a random element along a particular direction , ii ) the attenuation of the far - ultraviolet radiation in the pdr , and iii ) the propagation of the far - infrared / submm line emission out of the pdr .    the treatment of the uv radiation in the 3d - pdr code is initially estimated by invoking the _ on - the - spot _",
    "approximation i.e. by neglecting the diffuse component of the radiation field .",
    "the attenuation of the uv field , @xmath9 , at a randomly given point , @xmath10 , is evaluated using the equation @xmath11 where @xmath12 is the magnitude of the unattenuated field strength along the healpix direction @xmath13 , @xmath14 is the number of healpix rays at level of refinement @xmath15 , @xmath16 is a dimensionless factor converting the visual extinction to uv attenuation @xcite , and @xmath17 is the visual extinction along @xmath13 defined as @xmath18 in the above equation @xmath19 and the integration corresponds to the column of the h - nucleus number density @xmath20 along the ray of length @xmath21 .",
    "we note that torus-3dpdr performs radiative transfer with frequency dependent opacity , however for the purposes of this initial comparison in the present work and consistency with the majority of the pdr codes we have restricted @xmath22 to the above value ( c.f .",
    ".    equation [ eqn:3dpdruv ] has been extensively used in several codes treating pdrs .",
    "as described in @xcite , most of the models adopt a plane - parallel geometry illuminated from one or from both sides .",
    "however , the majority of them do not account for the geometrical dilution i.e. that a spherically emitted radiation field decreases in intensity with the square of the distance .",
    "accounting for the latter , the attenuation along a healpix direction @xmath23 is expressed as follows : @xmath24 where @xmath25 is the position of the ionization front from the exciting source , and @xmath26 is the distance of a particular point @xmath10 from the ionization front and inside the pdr ( see appendix [ app : dilution ] for the corresponding derivation ) . as we explain below , this is an important factor especially when a pdr model is being used to reproduce the observed data of an object . in torus-3dpdr",
    "this attenuation naturally comes from the monte carlo ( mc ) radiative transfer treatment and this is what is being used throughout this paper unless otherwise stated .",
    "the code uses the most recent umist 2012 chemical network database @xcite .",
    "this network consists of 215 species and more than 3000 reactions .",
    "however , in this paper we will consider only a subset of this network consisting of 33 species ( including @xmath27 ) and 330 reactions .",
    "we make use of the sundials package in order to construct the appropriate set of ordinary differential equations ( odes ) for describing the formation and destruction of each species as well as the associated jacobian matrices to compute the abundance of each chemical species .    for the particular cases of h@xmath7 and co photodissociation rates ,",
    "we adopt the treatments of @xcite and @xcite and we use the additional tabulated shielding functions provided in those papers",
    ". we also account for the shielding of c  i using the treatment of @xcite in order to estimate the photoionization rate of carbon .",
    "the rate of molecular hydrogen formation on dust grains is calculated using the treatment of @xcite while the thermally averaged sticking coefficient of hydrogen atoms on dust grains is taken from @xcite .",
    "the dust temperature at each point in the density distribution is calculated using the treatment of @xcite to account for the grain heating due to the incident fuv photons .",
    "future updates will include more detailed heating functions such as @xcite and @xcite for the grain charge photo - electric heating and grain temperature respectively .",
    "torus is a grid - based three - dimensional radiation transport and eulerian hydrodynamics code that uses an octree adaptive ( non - uniform ) grid .",
    "it was initially designed to perform three - dimensional calculations , including the treatment of polarization and mie or rayleigh scattering . in this form",
    "it was used to analyze synthetic spectral line observations of stellar winds that are rotationally distorted by rapid stellar rotation or which contain clumps @xcite . with the addition of a dust treatment it was also used to model observations of the wolf - rayet ( wr ) star binary wr137 in an effort to provide an explanation for observed polarization variability @xcite .",
    "it has since continued developing and been applied to models of accretion on to t tauri stars @xcite , discs around herbig aebe stars @xcite , raman - scattered line formation in symbiotic binaries @xcite , dust emission and molecular line formation in star forming regions @xcite and synthetic galactic hi observations @xcite .",
    "most recently it has been used in radiation hydrodynamic applications , both by coupling it to an sph code @xcite and in a self - contained manner by performing the hydrodynamics calculation on the torus grid @xcite .",
    "we give below a brief overview emphasizing on the key features of the mc photoionization routines .",
    "torus performs photoionization calculations using an iterative mc photon energy packet propagating routine , similar to that of @xcite and @xcite which in turn are based on the methods presented by @xcite .",
    "these photon energy packets are collections of photons for which the total energy @xmath28 remains constant , but the number of photons contained varies for different frequencies @xmath29 . in the model , they are initiated at stars with frequencies selected randomly based on the emission spectrum of the star .",
    "the constant energy value @xmath28 for each photon packet is simply the total energy emitted by star s ( luminosity @xmath21 ) during the duration @xmath30 of the iteration divided by the total number of photon packets @xmath31 : @xmath32 photons that are emitted from a given ionizing source are propagated in random but isotropic directions .",
    "as soon as a photon packet is emitted , it will propagate for a path length @xmath33 determined by a randomly selected optical depth .",
    "the length @xmath33 is determined by the position in which the next event will occur ; either involving an interaction with the material after traversing a random optical depth given by @xmath34 ( as detailed in * ? ? ?",
    "* ) , or involving the crossing of a cell boundary .",
    "if the photon packet fails to escape a cell after traveling an optical depth @xmath8 then its propagation ceases and an absorption event occurs : this is the situation when @xmath35 , @xmath36 where @xmath37 is the opacity term and @xmath38 the size of the cell ( see also * ? ? ?",
    "* ) . at this point , there are two possibilities based on the assumed effect of the diffuse field radiation :    1 .",
    "accounting for the diffuse field .",
    "the diffuse field refers to photons emitted by the recombination of electrons with ions .",
    "the effect of this radiation field is both to further ionize the gas ( should the recombination photon be energetic enough ) and to cool the gas ( through extraction of energy by optically thin photons ) .",
    "the diffuse radiation field can be important for irradiating regions shadowed by denser clumps along their line - of - sight with the ionizing source . here , the total recombination coefficient ( so - called ` case - a ' ) is given by @xmath39 where @xmath40 is the recombination coefficient of hydrogen at temperature @xmath41 in the quantum level @xmath42 .",
    "@xcite studied how @xmath43 changes by varying the temperature for the basic elements ( h , he , li , and na ) . in torus-3dpdr , once an absorption event occurs it it is followed by the immediate emission of a new photon packet from the same location and with the same energy , but containing a different number of photons to account for different photon frequency .",
    "we also note that the diffuse component of radiation field can be created by the scattering of ionizing photons onto dust grains .",
    "such treatment has been performed e.g. @xcite and we aim to include the dust contribution in a subsequent paper .",
    "2 .   using the _ on - the - spot _ ( ots ; * ? ? ?",
    "* ) approximation ( case - b ) in which the diffuse field photons are assumed to contribute negligibly to the global ionization structure following absorption .",
    "the recombination coefficient is then given by equation @xmath44 this is justified in regions of simple geometry , for example where density gradients are small . in mc photoionization with the ots approximation ,",
    "once a photon packet is absorbed it is ignored and is assumed to either have been re - emitted with a frequency lower than that required for photoionization , or to provide a negligible further contribution to the ionization structure by causing further photoionization on only small scales .",
    "the energy density @xmath45 of a radiation field is given by @xmath46 where @xmath47 is the speed of light and @xmath48 is the specific intensity and frequency @xmath29 .",
    "a photon energy packet traversing a path @xmath33 in a particular cell contributes an energy @xmath49 to the time - averaged energy density of that cell .",
    "thus by summing over all paths @xmath33 the energy density of a given cell ( volume @xmath50 ) can be determined .",
    "thus eqn .",
    "[ energydensity ] can be evaluated using the expression : @xmath51 this is then used to obtain ionization fractions by solving the ionization balance equation @xcite @xmath52 where @xmath53 , @xmath54 , @xmath55 , @xmath56 and @xmath57 are the number density of the @xmath58 ionization state of species @xmath59 , recombination coefficient , absorption cross section , electron number density and the threshold frequency for ionization of species @xmath60 respectively . using the mc estimators described in eqn .",
    "[ energydensitymc ] , eqn .",
    "[ ionbalance ] can then be approximated as @xmath61    this approach has the advantage that photon energy packets contribute to the estimate of the radiation field without having to undergo absorption events , thus even very optically thin regions are properly sampled .",
    "photoionization calculations are performed iteratively , doubling the number of photon packets per iteration until the temperature and ionization fractions converge .",
    "charge exchange recombination from o  ii , o  iii and n  iv and ionization of n  i and o  i is included following the prescription from @xcite      we include a range of atomic constituents : hydrogen , helium , carbon , nitrogen , oxygen , neon and sulfur , for which we solve the ionization balance using eqn .",
    "[ ionbalancemc ] .",
    "note that the ionization balance is solved for every species in the calculation .",
    "the ionization states that we treat for metals are c  ( i  iv ) , n  ( i  iv ) , o  ( i  iii ) , ne  ( ii  iii ) , s  ( ii  iv ) . the hydrogen , helium and c  iv recombination rates used by torus are calculated based on @xcite .",
    "other radiative recombination and dielectronic recombination rates are calculated using fits to the results of @xcite , @xcite or @xcite .",
    "the photoionization cross sections of all atomic species in this paper are calculated using the phfit2 routine from @xcite .",
    "torus performs photoionization calculations that incorporate a range of atomic species and in which the thermal balance in each cell is calculated by iterating on the temperature until the heating and cooling rates match .",
    "similarly to the photoionization calculation ( eqn .",
    "[ ionbalancemc ] ) , the heating rate in a given cell is calculated based on the summation of trajectories of photon packets through the cell .",
    "this is used to estimate the heating contributions from the photoionization of hydrogen and helium @xcite and the heating due to dust photoelectric ejection @xcite . adding up these three terms give the total heating rate .    on the other hand ,",
    "the cooling rate is initially calculated for the maximum and minimum allowed temperatures in the calculation ( @xmath62 and @xmath63 respectively by default in torus ) .",
    "this is then refined by bisection until the cooling rate matches the heating rate .",
    "the cooling processes considered are free ",
    "free radiation , hydrogen and helium recombination , dust cooling and collisional excitation of hydrogen and metals .",
    "the strategy we use to couple the two codes is to dismantle 3d - pdr and re - assemble it using the torus framework .",
    "although the iteration procedure for determining the thermal balance , as well as the associated routines for estimating the heating and cooling functions , are identical to those of the 3d - pdr code , we have modified the ray tracing scheme in order to overcome issues related to the large memory requirements .",
    "the most important feature however , is the ability to use the mc radiation transport to compute an accurate structure of the uv field in any given arbitrarily complex distribution either for a single or multiple radiation sources .",
    "torus-3dpdr calculates steady states and its primary use is to post - process snapshots of hydrodynamical simulations .",
    "below we discuss how the code calculates the uv field from the mc photoionization . in appendix",
    "[ app : tech ] we discuss the technical details followed to couple torus and 3d - pdr .      in pdr modelling the uv field is usually prescribed at the ionization front and is then assumed to be attenuated according to some simple function ( i.e. an exponential ) . in the coupled code",
    "we calculate the uv field using the propagation of photon packets in a photoionization calculation .",
    "the uv field in a given cell ( in draines ) is the sum of the path lengths , @xmath33 , of photon packets with frequencies in the uv ( @xmath64 ) and is given by @xmath65 where @xmath66 is the mean radiation propagation vector , @xmath67 is the habing constant @xcite , and @xmath68 is the conversion factor between the habing field to the draine field @xcite . in practice we store the uv field as two vectors , one for positive and one for negative directions .",
    "this is important for multi  dimensional calculations , in particular if there are multiple sources ( and the radiation field is not simply divergent about a point ) .",
    "in this section we benchmark torus-3dpdr against 3d - pdr and mocassin for simple one dimensional tests .",
    "the pdr abundances correspond to those of milky way solar undepleted abundances .",
    "the chemical network used here is the most recent umist 2012 network @xcite in contrast to the @xcite version used in b12 .",
    "the cosmic - ray ionization rate is taken to be @xmath69",
    ". we also account for the rate of h@xmath7 formation on grains using the treatment of @xcite and we determine the dust temperature following the treatment of @xcite in addition to the 3d - pdr version presented in b12 .",
    "to check whether the uv estimator we use is accurate , we calculate the uv field as a function of distance from a test source .",
    "the source that we consider is the same as that used in the hii40 lexington benchmark .",
    "we compare with our numerical estimate by integrating over the uv band ( @xmath70  ) of the stellar spectrum and attenuate this value accounting for both the distance from the source and the gas opacity , i.e. @xmath71 where @xmath9 is the attenuated @xmath72 uv field , @xmath26 is the distance from the source , and @xmath37 is the opacity term ( see appendix [ app : dilution ] ) .",
    "we have compared the uv distribution ( by invoking the on - the - spot approximation ) calculated by the torus-3dpdr with the above eqn .",
    "[ eqn : uvtest ] and we show the results in fig . [",
    "fig : uvtest ] .",
    "it can be seen that the agreement is excellent , verifying that our uv estimate is accurate .     with the opacity term @xmath73 ( green solid line ) and without this term ( red dashed line ) .",
    "torus-3dpdr reproduces precisely eqn .",
    "[ eqn : uvtest ] verifying that the uv estimate is accurate.,scaledwidth=50.0% ]      in order to assess the accuracy of the pdr calculations after the coupling of the two codes , we perform a one - dimensional test to compare the coupled torus-3dpdr code against 3d - pdr .",
    "the setup of the test we adopt is very similar to the v2 model discussed in the ( * ? ? ?",
    "* hereafter  r07  ) paper .",
    "however , due to the recent updates of the 3d - pdr code described above , we do not aim at benchmarking torus-3dpdr against the various other one - dimensional pdr codes described in r07 .",
    "the adopted model consists of a one - dimensional uniform density distribution with h - nucleus number density of @xmath74 .",
    "the size of the distribution is chosen so that the maximum visual extinction is @xmath75 .",
    "we assume that it is irradiated by a plane - parallel radiation field of strength @xmath76 multiples of the draine radiation field @xcite , and that the attenuation of the uv field is according to eqn .",
    "[ eqn:3dpdruv ] .    as described in b12 ,",
    "in order to emulate a semi - infinite slab we have considered cells aligned along two opposite healpix rays at the @xmath77 level of refinement while assuming very high optical depths in all other directions . here , the 3d - pdr run uses @xmath78 elements logarithmically distributed per @xmath17 dex with @xmath79 in all cases , implying a total number of @xmath80 elements .",
    "the torus-3dpdr runs use a non - uniform mesh , clustered near the ionization front .",
    "the uv field is assumed to be plane - parallel impinging from one side while the attenuation of the field is calculated using eqn .",
    "[ eqn:3dpdruv ] .",
    "figure [ fig : roll1 ] shows results for the benchmark model described above .",
    "we compare gas and dust temperature profiles , abundances of h  i , h@xmath7 , c  ii , c  i and co versus @xmath17 , and local emissivities as well as emergent intensities ( surface brightnesses ) for some of the dominant cooling lines .",
    "the agreement between the two codes is excellent .",
    "we also note that we have performed all other tests described in the r07 work ( i.e. v1 , v3 , and v4 ) and we have found excellent agreement as well .              the hii40 lexington benchmark @xcite is a canonical test of photoionization codes .",
    "it involves modelling the ionization and temperature structure of a uniform density medium around a massive star .",
    "it is usually performed in 1d owing to the spherically symmetric nature of the problem .",
    "@xcite demonstrated the veracity of the photoionization scheme in torus using this test , obtaining agreement with the ionization and temperature structure computed by the well known cloudy code @xcite .",
    "table [ tab : lex ] compares torus with the median values of all participating codes in the hii40 lexington benchmark @xcite .",
    "overall we find good agreement between the lines emmisivities .",
    ".comparison between torus with the median value for all participating codes in the lexington 2000 benchmark workshop for the standard h  ii region ( hii40 ) test .",
    "the values of the ` median ' column are those listed in table 4 of @xcite .",
    "the third column corresponds to the absolute error @xmath81 , where @xmath82 is the median value and the @xmath83 is the torus result for the intensity of each line . [",
    "cols=\"<,^,^,^\",options=\"header \" , ]      in this section we perform a one - dimensional test application in which the integrated scheme is being tested to simulate the interaction of a uniform - density cloud with ionizing radiation .",
    "the density , @xmath20 , is taken to be @xmath84 and the star is assumed to have a blackbody temperature of @xmath85 and radius @xmath86 emitting photons from the left - hand edge of the grid . the grid is taken to be uniform and spherical consisting of 256 cells .",
    "these values correspond to the hii40 simulation of the lexington benchmarking @xcite .",
    "we convert the mean intensity into draine units using the relation : @xmath87 where @xmath88 is the intensity of the radiation integrated over wavelength ( here in  ) .",
    "assuming monochromatic radiation at @xmath89 , the integral of the above equation can be considered as a @xmath90-function and eqn .",
    "[ eqn : uvtodra ] can therefore take the form : @xmath91 the above equation calculates the intensity of the uv radiation field ( in @xmath92 units ) resulting from a star emitting @xmath93 photons per unit time placed at distance @xmath26 .",
    "we perform two runs in which we explore the effect of the attenuation of radiation in the pdr scheme estimated i ) directly from the mc approach as calculated in torus and described in  [ ssec : uvmcrt ] and",
    "ii ) using the exponential relation given by eqn .",
    "[ eqn:3dpdruv ] .",
    "torus-3dpdr selects as pdr cells any cell that has a temperature below 3000k corresponding to an ionization fraction of @xmath94 .",
    "the upper panel of fig .",
    "[ fig : fullrun ] shows the temperature profiles while the lower panel shows the fractional abundances of h  ii , h  i , and h@xmath7 .",
    "the ionizing radiation is impinging from the left hand side in the above diagrams ( the position of the star defines the centre of the cartesian co - ordinate system ) .",
    "in addition , in the upper panel we overplot the results obtained from mocassin @xcite for the calculations concerning the photoionized region , while we also overplot those obtained from 3d - pdr for the photodissociation region .",
    "we find that the integrated code torus-3dpdr is in very good agreement with mocassin .",
    "for the particular case of the mc - attenuation , we have performed an additional 3d - pdr calculation in which we have included the additional extinction due to the distance of the point source from each pdr cell as described by eqn .",
    "[ eqn : geomdil ] . as is shown in the upper panel of fig .",
    "[ fig : fullrun ] , the pdr temperature profile obtained from the mc torus-3dpdr technique is reproducible only when the distance from the source is taken into account .",
    "note , however , that h@xmath7 and h  i are not strongly sensitive to that .    , whereas the red dashed line is as described by eqn .",
    "[ eqn : geomdil ] .",
    "black crosses ( + ) show a comparison with the mocassin code .",
    "lower panel : fractional abundances of hydrogen for different phases .",
    "the black solid line is ionized h  ii , the green solid line is atomic h  i , and the blue - gray solid line is molecular h@xmath7 .",
    "the green dot - dashed line is atomic hydrogen obtained without pdr calculations ( i.e. as in the lexington test ) .",
    "all these correspond to the torus-3dpdr code .",
    "the green and blue dashed lines correspond to 3d - pdr runs using eqn .",
    "[ eqn:3dpdruv ] to account for the attenuation of the radiation field.,title=\"fig:\",scaledwidth=50.0% ] , whereas the red dashed line is as described by eqn .",
    "[ eqn : geomdil ] .",
    "black crosses ( + ) show a comparison with the mocassin code .",
    "lower panel : fractional abundances of hydrogen for different phases .",
    "the black solid line is ionized h  ii , the green solid line is atomic h  i , and the blue - gray solid line is molecular h@xmath7 .",
    "the green dot - dashed line is atomic hydrogen obtained without pdr calculations ( i.e. as in the lexington test ) .",
    "all these correspond to the torus-3dpdr code .",
    "the green and blue dashed lines correspond to 3d - pdr runs using eqn .",
    "[ eqn:3dpdruv ] to account for the attenuation of the radiation field.,title=\"fig:\",scaledwidth=50.0% ]",
    "in this section we present the capabilities of the code in simulating three - dimensional density structures interacting with one- or two- sources , either by invoking the on - the - spot approximation or including the diffusive component of the ionizing radiation , thus exploring the importance of these components in regulating the chemistry of pdrs . to do this we consider an oblate spheroidal cloud with a uniform density distribution .",
    "the choice of such an object was based on the assumption it is not spherically symmetric hence not reproducible by an equivalent one - dimensional approach , while at the same time it offers simplified results .",
    "we consider a cubic computational domain with size @xmath95 consisting of @xmath96 cells of equal volume .",
    "figure [ fig : simsetup ] shows the simulation setup .",
    "the center of the spheroid defines the center of a cartesian co - ordinate system .",
    "the semi - major axis is taken to be @xmath97 , the semi - minor axis is taken to be @xmath98 and the density is assumed to be @xmath99 .",
    "this means that the visual extinction , @xmath17 , can reach values up to @xmath100 along the @xmath101axis .",
    "we can consider this structure as a cloud of mass @xmath102 .",
    "the spheroid is embedded in an ambient medium of uniform density @xmath103 . in all simulations we use the mc photoionization routine",
    "described in  [ ssec : mcphot ] and",
    "we use an @xmath77 healpix level of refinement as explained in  [ ssec : hlevel ] .    .",
    "the @xmath104 and @xmath101 axis dimensions are in @xmath105 .",
    "the shaded spheroid has dimensions of @xmath97 and @xmath98 and it has a uniform density with @xmath106 .",
    "the center of the cloud defines the center of a cartesian co - ordinate system .",
    "the spheroid is embedded in an ambient medium with density @xmath103 .",
    "the middle black point corresponds to the position of the ionizing source for the simulations , s1 (  [ ssec : s1 ] ) and s2 (  [ ssec : s2 ] ) .",
    "the gray points , s3@xmath107 and s3@xmath7 , correspond to the two positions of the stars in the s3 simulation (  [ ssec : s3 ] ) .",
    "all stars are placed at a distance @xmath108 from the center of the oblate spheroidal cloud.,width=302 ]    we perform three simulations . in the first simulation ( s1 ) , we place a single exciting source at a distance of @xmath109 from the center of the spheroid emitting @xmath110 photons per second and invoking the on - the - spot approximation . in the second simulation ( s2 )",
    ", we use the same setup but we switch on the contribution of the diffuse component of the radiation field . thus by comparing simulations s1 and s2 we examine the effect of the diffuse radiation field on the abundance distribution . in the third simulation ( s3 )",
    "we replace the single exciting source with two sources emitting half the number of photons per second , compared to the s1 and s2 cases . in particular",
    ", we place the two stars at positions @xmath111 which ensures that the distance @xmath108 from the center of the spheroid is kept the same as in s1 and s2 .",
    "each of the two stars emit @xmath112 photons per second and the diffuse component of radiation is taken into account .",
    "therefore , in the s3 simulation we test the capabilities of the code in treating pdrs interacting with multiple sources and we examine the consequent effects introduced in the abundances distribution as well as on the distribution of the local emissivities of the most important cooling lines .",
    "the stellar spectra in the models presented here are blackbodies , which are probabilistically randomly sampled by the mc photon packets",
    ". there are therefore occasionally high frequency ionizing photon packets , that can propagate far into the neutral gas since the photoionization cross section is proportional to the inverse cube of the photon frequency , i.e. @xmath113 where the @xmath114 is the ionization threshold ( e.g. @xmath115 for hydrogen ) .",
    "these high frequency packets are responsible for regions of localized heating exterior to the main ionization front . in the case of our three - dimensional models , the calculations with a single star consider a source that has @xmath116 radius and @xmath117 effective temperature ( whereas in the multiple sources simulation each source has @xmath118 with half that effective temperature ) , and so have a higher probability of emitting high frequency photon packets .",
    "this is why the temperature distribution within the ellipse and particularly in the ionization front is subject to spurious heating which has a significant ( but very local ) effect in determining the abundances distribution .",
    "these areas can be seen in almost all panels of fig .",
    "[ fig : diff1star ] and fig .",
    "[ fig : difflines ] and are located close to the @xmath119 axis ( i.e. @xmath120 and @xmath121 ) and with @xmath122 .",
    "this can be alleviated by using more photon packets ( so the energy per packet is reduced ) however at the cost of computational expense .",
    "we will thus exclude this effect from all discussion below .",
    "we also note that in the particular case of simulation s3 and because the ionizing photons have lower frequency than in the s1 and s2 cases , this effect is not present .           as a first test",
    "we explore the effect of using different levels of healpix refinement corresponding to different angular resolutions per direction in each cell of the computational domain .",
    "we perform two additional simulations to s1 , one with @xmath77 ( corresponding to 12 healpix rays ) and one with @xmath123 ( corresponding to 192 healpix rays ) .",
    "figure [ fig : healpixtest ] shows the changes observed for the gas temperature and h@xmath7 abundance distribution .",
    "overall we find excellent agreement in the gas temperature distribution and minor changes in the h@xmath7 abundance distribution , showing that even at low angular resolution ( i.e. at @xmath77 ) our results remain consistent with those at higher angular resolution ( i.e. @xmath123 ) . given also that the computational expense increases approximately 4 times by increasing the healpix level ( since there are 4 times more rays emanated from each cell ; see appendix [ app : cputime ] for further discussion ) in this paper we will use @xmath77 for all simulations .",
    "we note that in more complicated simulations with non - uniform density distribution , a higher level of angular resolution must be used .",
    "figure [ fig:1star ] shows the outcomes of the s1 simulation .",
    "we show cross - section plots ( at @xmath124 plane ) of the gas temperature ( fig .",
    "[ fig:1star]a ) , the abundance distributions of h@xmath7 , h  i , c  ii and c  i ( fig . [ fig:1star]b - e respectively ) and the local emissivity of [ c  i ] @xmath125 ( fig .",
    "[ fig:1star]f ) .",
    "the ionizing source interacts with the rarefied medium resulting in an h  ii region .",
    "the dense oblate spheroidal cloud on the other hand shields the propagation of the uv photons behind it .",
    "the resultant temperature in the h  ii region is @xmath126 while in the shadowed region it is @xmath127 , and in the innermost part of the spheroid @xmath128 .",
    "this extra heating , that shifts the temperature from @xmath63 to @xmath129 in the ambient medium behind the spheroid , is due to the interaction of that rarefied gas with cosmic rays , and which do not attenuate inside this computational domain .",
    "note that the gas temperature and ionization fraction transition from the ionized medium to the pdr is very abrupt .",
    "the shielding of the uv radiation allows the formation of atoms and molecules in the interior of the cloud . in the modelled cloud , this shielding extinguishes the uv radiation to such an extent that is able to photodissociate h@xmath7 to form h  i while it can not photoionize atomic hydrogen .",
    "this creates a layer rich in atomic hydrogen as shown in fig .",
    "[ fig:1star]c .",
    "here , the north surface shows an increase in the abundance of atomic hydrogen . immediately behind the ionization front ( i.e. towards the interior of the cloud ) , the free hydrogen atoms transition to molecular hydrogen as shown in fig .",
    "[ fig:1star]b .",
    "figures [ fig:1star]d and e show the distribution of c  ii and c  i respectively . by comparing these two panels it",
    "can be seen how the c  ii to c  i transition occurs in the spheroid .",
    "figure [ fig:1star]f plots the local emissivity of [ c  i ] @xmath125 . this line is predominantly emitted from a thin region located at low optical depths i.e. close to the ionization front , and its peak is at @xmath130 .",
    "we emphasize that the h  i - to - h@xmath7 transition is known to occur in a very thin zone of the pdr and consequently in order to properly resolve it we need to increase the resolution of the grid . in the work presented here ,",
    "none of the 3d simulations use high spatial resolution in order to study this transition in detail . as shown in @xcite , such a low spatial resolution ( i.e. not being able to resolve the h  i to h@xmath7 transition ) does not change the overall chemistry of the pdr .",
    "however , by using the amr techniques as described in appendix [ app : tech ] , torus-3dpdr is able to perform such detailed studies at the cost of computational expense .",
    "to explore the effect of diffuse radiation on the abundance distribution of different species , we repeat the s1 simulation in which we are additionally considering a full treatment of the uv field .",
    "the diffuse component of the radiation field penetrates further into the cloud , thus increasing its temperature and changing its chemistry and line emission .",
    "we focus here on the changes observed in the oblate spheroidal cloud itself between the s1 and s2 simulations , hence we will not include in our discussion the ambient medium . to show the effects of the interaction of the diffuse field we plot in the left column of fig .",
    "[ fig : diff1star ] cross sections of the spheroid , coloured according to the percentage of the relative change , @xmath131 , between the two simulations , given by the relation @xmath132 where @xmath133 and @xmath134 are the values of the @xmath135 and @xmath136 simulation that we compare .",
    "the relative change in the gas temperature is shown in fig .",
    "[ fig : diff1star]a . here",
    ", although the temperature remains the same close to the ionization front ( with a relative change of @xmath137 ) , it gets hotter in the inner part of the cloud ( with a relative change of @xmath138 ) .",
    "in particular , at high optical depths we find that the spheroid in the s1 simulation has an average temperature of @xmath139 , whereas in the s2 simulation it has @xmath140 . as a consequence ,",
    "the abundance of atomic hydrogen is higher in the s2 simulation reducing at the same time the abundance of h@xmath7 .",
    "the h  i - to - h@xmath7 transition has now been shifted further inside the cloud ( but still at low optical depths ; see fig .  [",
    "fig : diff1star]c ) .",
    "similarly , c  i is primarily emitted by a region closer to the centre of the ellipsoid .",
    "since the peak of c  i occurs in general in a quite thin zone of the pdr , such a shift may cause significant changes in its abundance distribution through the ellipsoid as observed in fig .",
    "[ fig : diff1star]e",
    ". however , in the innermost region , both s1 and s2 simulations are in excellent agreement .",
    "hence inclusion of the diffuse component of the radiation field primarily affects the abundance distribution at low optical depths , while it is able to heat up the gas at intermediate optical depths .",
    "figure [ fig : highj ] shows cross section plots of the ellipsoid where the local emissivity of co @xmath141 and co @xmath142 transition lines are mapped ( left and middle panels for the s1 and s2 simulations respectively ) . the difference in gas temperature at the inner part of the cloud due to the diffuse component of radiation leads to discrepancies in the emissivities of both @xmath143 transition lines with the high-@xmath143 to be up to @xmath144 orders of magnitude brighter in the s2 simulation .",
    "this shows that high-@xmath143 co lines may be used as gas temperature diagnostics in regions of intermediate optical depths where the diffuse radiation can penetrate the cloud deeper .",
    "it also shows that a realistic treatment of the uv field is necessary when comparing observational with numerical data such as i.e. of the orion bar ( i.e. * ? ? ?",
    "* ; * ? ? ?",
    "* ; * ? ? ?",
    "the effect of multiple sources interacting with pdrs is particularly interesting and very poorly studied due to the lack of numerical codes that are able to treat such systems . here",
    ", we discuss the capabilities of torus-3dpdr in modelling such pdrs by revisiting the s2 simulation described above , in which we replace the ionizing source of @xmath145 with two identical sources of @xmath146 .",
    "both sources in this simulation have the same distance @xmath108 from the center of the oblate spheroidal cloud as in the s1 and s2 simulations .",
    "the diffuse component of the radiation field is taken into consideration , hence this setup ensures that any changes observed between s2 and s3 will be a result of the structure of the radiation field emitted by two sources instead of a single source .",
    "the right panel of fig .",
    "[ fig : diff1star ] shows the relative change between s2 and s3 simulations for the gas temperature , the atomic hydrogen abundance , and the atomic carbon abundance .",
    "we find that the gas temperature shows fluctuations of the order of @xmath147 for the entire cloud , corresponding to @xmath148 ( see fig .",
    "[ fig : diff1star]b ) .",
    "the spatial distribution of the uv field has an impact in the abundances distribution between s2 and s3 particularly at low optical depths .",
    "this can be seen in fig .",
    "[ fig : diff1star]d and [ fig : diff1star]f , where we compare h  i and c  i. similarly to what has been discussed in  [ ssec : s2 ] , the uv distribution is now less strong as in s2 resulting to a shift of the h  i - to - h@xmath7 transition to lower optical depths , thus also increasing h@xmath7 .",
    "such a behaviour is also observed in c  i.    the middle and right columns of fig .",
    "[ fig : highj ] compares co @xmath141 and co @xmath142 for the s2 and s3 simulations . in both cases the differences observed",
    "are not significant in comparison with s1 and s2 , however at the inner part of the cloud the @xmath142 line emissivity is higher by a factor of @xmath149 reflecting the gas temperature difference of @xmath148 between s2 and s3 .",
    "we argue that in more complicated structures involving multiple sources the effects introduced by the realistic uv treatment can be of significant importance .",
    "furthermore , we plot in fig .",
    "[ fig : difflines ] the relative changes in the line emissivities for the s2 and s3 simulations of c  ii @xmath150 , c  i @xmath125 , o  i @xmath151 and co @xmath141 . in general , c",
    "ii @xmath150 remains in principle unaffected when the uv radiation field structure is taken into account , however c  i @xmath125 and in particular co @xmath141 show strong dependency under a multiple source treatment .",
    "these point to the conclusion that emission lines do become dependent on the spatial structure of the radiation field even when the total intensity received is the same as the intensity emitted by a single source at the same distance .",
    "this is in agreement with the results presented in b12 as well as with the findings of @xcite .",
    "thus three - dimensional codes such as torus-3dpdr are often needed in order to compare as closely as possible numerical simulations with observations .",
    "in this paper we present torus-3dpdr , a three - dimensional astrochemistry code which is able to treat simultaneously photoionization and photodissociation regions with arbitrary geometrical and density distributions interacting with single or multiple sources .",
    "the code uses a monte carlo - based scheme to calculate the propagation of the ionizing radiation including its diffusive component and a healpix - based ray - tracing scheme to calculate the column densities in each cell and along any direction on the celestial sphere .",
    "we have performed one - dimensional and three - dimensional simulations demonstrating the capabilities of the code .",
    "we performed a one - dimensional pdr calculation to explore the consistency of torus-3dpdr against 3d - pdr @xcite and we found excellent agreement between the two codes in reproducing the temperature profile as well as the abundances of species and the local emissivities of the major cooling lines .",
    "the simulation setup was identical to a standard pdr benchmarking test discussed in @xcite , although our codes include the updated umist network as well as an updated h@xmath7 formation heating mechanism and thus we can not compare torus-3dpdr directly against the numerous codes presented in @xcite .",
    "we then advanced our benchmarking calculation by performing a one - dimensional calculation including both the mc photoionization treatment as well as the pdr treatment in a uniform density cloud .",
    "the photoionization calculations reproducing the h  ii region followed the lexington hii40 benchmarking case and showed excellent agreement with the mocassin code @xcite .",
    "once the value of the ionization fraction of hydrogen fell below @xmath152 , corresponding to a gas temperature of @xmath153 , the pdr calculations were switched on .",
    "the thermal balance obtained in the pdr using torus-3dpdr was in agreement with 3d - pdr only when we included the extinction due to the distance of each pdr cell for the ionizing radiation emitted by the ionizing point source .",
    "we thus argue that this factor is important in order to obtain more accurate abundance distributions in the pdr and particularly a more accurate gas temperature profile .",
    "we have demonstrated the three - dimensional capabilities of torus-3dpdr by treating an application in which we considered an oblate spheroidal cloud irradiated externally by either a single source or two sources .",
    "although this simulation setup is simplified in three - dimensional space , it is not reproducible by one - dimensional codes .",
    "we have performed control runs in which we have invoked the on - the - spot approximation and additionally the effects introduced by the diffuse component of radiation field .",
    "our results for this application can be summarized as follows :    1 .",
    "the effects introduced by the diffuse component of the radiation field in the single ionizing source case ( simulations s1 and s2 ) , have been found to affect both the outer parts ( low optical depths ) and the inner parts ( high optical depth ) of the cloud .",
    "we found that the gas temperature has been increased as a result of the diffuse radiation by an average of @xmath129 and by @xmath154 individually at high optical depths .",
    "this in turn resulted in a higher abundance of h  i while also increasing locally the abundance of c  ii compared to what we found when invoking the on - the - spot approximation ( s1 ) .",
    "2 .   the effects introduced by the interaction of two sources instead of a single source ( simulations s2 and s3 ) can heat up the gas at the inner part of the cloud by @xmath148 which results to a @xmath149 times higher line emissivity of the co @xmath142 transition .",
    "we argue that the impact of multiple source treatment is potentially higher at even higher co @xmath143 transitions .",
    "in addition , the abundance distributions of the species examined are strongly correlated with the geometric distribution of the radiation field .",
    "3 .   the local emissivities of the fine - structure lines which are predominantly emitted at low optical depths , depend on the spatial shape of the radiation field ( simulations s2 and s3 ) .",
    "the local emissivities of co transitions are strongly affected , showing that we require realistic and detailed uv structures when comparing models with observational data .",
    "in addition , we have performed a test in which we increased the angular resolution ( healpix level of refinement ) in the s1 simulation and examined the gas temperature structure and h@xmath7 abundance distribution .",
    "we found that even at the lowest possible resolution ( @xmath77 which also compromises a low computational cost ) torus-3dpdr provides acceptable results for the simulations presented in this paper . for more complicated density distributions however , a higher level of healpix refinement is needed though at the cost of computational expense .",
    "while most existing pdr codes consider one - dimensional density profiles and very simplified radiation fields , torus-3dpdr brings us a step closer to simulating realistic three - dimensional h  ii / pdr complexes interacting with multiple sources . future versions of torus-3dpdr will include treatments of dust radiation transfer and x - ray chemistry in the photoionization and photodissociation regions .",
    "the authors thank the anonymous referee for the useful comments which have significantly improved the validity of the torus-3dpdr code .",
    "the work of tgb was funded by stfc grant st / j001511/1 .",
    "the work of tjhaw was funded by stfc grant st / k000985/1 .",
    "tgb and tjhaw acknowledge the nordita programme on photo - evaporation in astrophysical systems ( 2013 june ) where part of the work for this paper was carried out .",
    "this research has made use of nasa s astrophysics data system .",
    "part of this work used the dirac data analytics system at the university of cambridge , operated by the university of cambridge high performance computing serve on behalf of the stfc dirac hpc facility ( www.dirac.ac.uk ) .",
    "this equipment was funded by bis national e - infrastructure capital grant ( st / k001590/1 ) , stfc capital grants st / h008861/1 and st / h00887x/1 , and stfc dirac operations grant st / k00333x/1 .",
    "dirac is part of the national e - infrastructure .",
    "abel n.  p. , ferland g.  j. , shaw g. , van hoof p.  a.  m. , 2005 , apjs , 161 , 65    acreman d.  m. , harries t.  j. , rundle d.  a. , 2010 , mnras , 403 , 1143    acreman d.  m. , douglas k.  a. , dobbs c.  l. , brunt c.  m. , 2010 , mnras , 406 , 1460    andree - labsch s. , ossenkopf v. , rllig m. , 2014 , arxiv , arxiv:1405.5553    arthur s.  j. , henney w.  j. , mellema g. , de colle f. , vzquez - semadeni e. , 2011 , mnras , 414 , 1747    bell t.  a. , viti s. , williams d.  a. , crawford i.  a. , price r.  j. , 2005 , mnras , 357 , 961    bell t.  a. , roueff e. , viti s. , williams d.  a. , 2006 , mnras , 371 , 1865    bensch f. , leuenhagen u. , stutzki j. , schieder r. , 2003 , apj , 591 , 1013    bisbas t.  g. , wnsch r. , whitworth a.  p. , hubber d.  a. , 2009 , a&a , 497 , 649    bisbas t.  g. , wnsch r. , whitworth a.  p. , hubber d.  a. , walch s. , 2011 , apj , 736 , 142    bisbas t.  g. , bell t.  a. , viti s. , yates j. , barlow m.  j. , 2012 , mnras , 427 , 2100    bisbas t.  g. , bell t.  a. , viti s. , barlow m.  j. , yates j. , vasta m. , 2014 , mnras , 443 , 111    bisbas t.  g. , papadopoulos p.  p. , viti s. , 2015 , apj , 803 , 37    black j.  h. , van dishoeck e.  f. , 1987 , apj , 322 , 412    boger g.  i. , sternberg a. , 2006 , apj , 645 , 314    cazaux s. , tielens a.  g.  g.  m. , 2004 , apj , 604 , 222    . 2002 , apj , 575 , l29    compigne m. , et al . , 2011 , a&a , 525 , a103    dale j.  e. , bonnell i.  a. , clarke c.  j. , bate m.  r. , 2005 , mnras , 358 , 291    dale j.  e. , ercolano b. , clarke c.  j. , 2007 , mnras , 382 , 1759    dale j.  e. , ngoumou j. , ercolano b. , bonnell i.  a. , 2013 , mnras , 436 , 3430    dobbs c.  l. , glover s.  c.  o. , clark p.  c. , klessen r.  s. , 2008 , mnras , 389 , 1097    draine b.  t. , 1978 , apjs , 36 , 595    ercolano b. , barlow m.  j. , storey p.  j. , liu x .- w . , 2003 , mnras , 340 , 1136    ercolano b. , barlow m.  j. , storey p.  j. , 2005 , mnras , 362 , 1038    ferland g.  j. , korista k.  t. , verner d.  a. , ferguson j.  w. , kingdon j.  b. , verner e.  m. , 1998 , pasp , 110 , 761    ferland g. , 1995 , in r. williams & m. livio ed .",
    ", the analysis of emission lines : a meeting in honor of the 70th birthdays of d.  e. osterbrock and m.  j. seaton .",
    "cambridge univ . press , cambridge , p.  83",
    "gaches b.  a.  l. , offner s.  s.  r. , rosolowsky e.  w. , bisbas t.  g. , 2015 , apj , 799 , 235    glover s.  c.  o. , mac low m .-",
    ", 2007a , apjs , 169 , 239    glover s.  c.  o. , mac low m .-",
    ", 2007b , apj , 659 , 1317    glover s.  c.  o. , federrath c. , mac low m .-",
    ", klessen r.  s. , 2010 , mnras , 404 , 2    grski k.  m. , hivon e. , banday a.  j. , wandelt b.  d. , hansen f.  k. , reinecke m. , bartelmann m. , 2005 , apj , 622 , 759    gritschneder m. , naab t. , burkert a. , walch s. , heitsch f. , wetzstein m. , 2009a , mnras , 393 , 21    gritschneder m. , naab t. , walch s. , burkert a. , heitsch f. , 2009b , apj , 694 , l26    harries t.  j. , 2015 , mnras , 448 , 3156    harries t.  j. , 2000 , mnras , 315 , 722    harries t.  j. , babler b.  l. , fox g.  k. , 2000 , a&a , 361 , 273    harries t.  j. , howarth i.  d. , 1997 , a&as , 121 , 15    habing h.  j. , 1968 , bull .",
    "netherlands , 19 , 421    haworth t.  j. , harries t.  j. , 2012 , mnras , 420 , 562    hollenbach d. , mckee c.  f. , 1979 , apjs , 41 , 555    hollenbach d.  j. , takahashi t. , tielens a.  g.  g.  m. , 1991 , apj , 377 , 19    hollenbach d.  j. , tielens a.  g.  g.  m. , 1999 , rvmp , 71 , 173    hubber d.  a. , batty c.  p. , mcleod a. , whitworth a.  p. , 2011",
    ", a&a , 529 , a27    hubber d.  a. , walch s. , whitworth a.  p. , 2013",
    ", mnras , 430 , 3261    jansen d.  j. , van dishoeck e.  f. , black j.  h. , spaans m. , sosin c. , 1995 , a&a , 302 , 223    kamp i. , bertoldi f. , 2000 , a&a , 353 , 276    kamp i. , van zadelhoff g .- j .",
    ", 2001 , a&a , 373 , 641    kaufman m.  j. , wolfire m.  g. , hollenbach d.  j. , luhman m.  l. , 1999 , apj , 527 , 795    kahn f.  d. , 1954 , bull .",
    "netherlands , 12 , 187    kingdon j.  b. , ferland g.  j. , 1996 , apjs , 106 , 205    klessen r.  s. , glover s.  c.  o. , 2014 , arxiv , arxiv:1412.5182    kurosawa r. , harries t.  j. , bate m.  r. , symington n.  h. , 2004 , mnras , 351 , 1134    le bourlot j. , pineau des forets g. , roueff e. , flower d.  r. , 1993 , a&a , 267 , 233    le petit f. , roueff e. , le bourlot j. , 2002 , a&a , 390 , 369    le petit f. , roueff e. , herbst e. , 2004 , a&a , 417 , 993    lee h .- h . , herbst e. , pineau des forets g. , roueff e. , le bourlot j. , 1996 , a&a , 311 , 690    levrier f. , le petit f. , hennebelle p. , lesaffre p. , gerin m. , falgarone e. , 2012 , a&a , 544 , aa22    lucy l.  b. , 1999 , a&a , 344 , 282    mcelroy d. , walsh c. , markwick a.  j. , cordiner m.  a. , smith k. , millar t.  j. , 2013 , a&a , 550 , a36    meijerink r. , spaans m. , 2005 , a&a , 436 , 397    mellema g. , arthur s.  j. , henney w.  j. , iliev i.  t. , shapiro p.  r. , 2006 , apj , 647 , 397    nussbaumer h. , storey p.  j. , 1983 , a&a , 126 , 75    offner s.  s.  r. , bisbas t.  g. , viti s. , bell t.  a. , 2013 , apj , 770 , 49    offner s.  s.  r. , bisbas t.  g. , bell t.  a. , viti s. , 2014 , mnras , 440 , l81    osterbrock d.  e. , 1989 , astrophysics of gaseous nebulae and active galactic nuclei .",
    "university science books , mill valley , ca    papadopoulos p.  p. , thi w .- f .",
    ", viti s. , 2002 , apj , 579 , 270    pequignot d. , petitjean p. , boisson c. , 1991 , a&a , 251 , 680    pquignot d. , et al .",
    ", 2001 , aspc , 247 , 533    pinte c. , harries t.  j. , min m. , watson a.  m. , dullemond c.  p. , woitke p. , mnard f. , durn - rojas m.  c. , 2009 , a&a , 498 , 967    rllig m. , ossenkopf v. , jeyakumar s. , stutzki j. , sternberg a. , 2006 , a&a , 451 , 917    rllig m. , et al . , 2007 , a&a , 467 , 187    rundle d. , harries t.  j. , acreman d.  m. , bate m.  r. , 2010 , mnras , 407 , 986    shaw g. , ferland g.  j. , abel n.  p. , stancil p.  c. , van hoof p.  a.  m. , 2005 , apj , 624 , 794    shull j.  m. , van steenberg m. , 1982 , apjs , 48 , 95    spitzer l. , 1978 , physical processes in the interstellar medium .",
    "wiley , ney york    sternberg a. , dalgarno a. , 1989 , apj , 338 , 197    sternberg a. , dalgarno a. , 1995 , apjs , 99 , 565    stoerzer h. , stutzki j. , sternberg a. , 1996 , a&a , 310 , 592    strmgren b. , 1939 , apj , 89 , 526    symington n.  h. , harries t.  j. , kurosawa r. , 2005 , mnras , 356 , 1489    tannirkulam a. , et al . , 2008 ,",
    "apj , 689 , 513    tielens a.  g.  g.  m. , hollenbach d. , 1985 , apj , 291 , 722    tielens a.  g.  g.  m. , meixner m.  m. , van der werf p.  p. , bregman j. , tauber j.  a. , stutzki j. , rank d. , 1993 , sci , 262 , 86    van der werf p.  p. , stutzki j. , sternberg a. , krabbe a. , 1996 , a&a , 313 , 633    van dishoeck e.  f. , black j.  h. , 1988 , apj , 334 , 771    verner d.  a. , ferland g.  j. , 1996 , apjs , 103 , 467    verner d.  a. , ferland g.  j. , korista k.  t. , yakovlev d.  g. , 1996 , apj , 465 , 487    vink j.  s. , harries t.  j. , drew j.  e. , 2005 , a&a , 430 , 213    walch s.  k. , whitworth a.  p. , bisbas t. , wnsch r. , hubber d. , 2012 , mnras , 427 , 625    walch s. , whitworth a.  p. , bisbas t.  g. , wnsch r. , hubber d.  a. , 2013 , mnras , 435 , 917    weingartner j.  c. , draine b.  t. , 2001 , apjs , 134 , 263    wolfire m.  g. , mckee c.  f. , hollenbach d. , tielens a.  g.  g.  m. , 2003 , apj , 587 , 278    wood k. , mathis j.  s. , ercolano b. , 2004 , mnras , 348 , 1337    woodall j. , agndez m. , markwick - kemper a.  j. , millar t.  j. , 2007 , a&a , 466 , 1197",
    "torus-3dpdr uses the octree adaptive mesh refinement ( amr ) grid native to torus , including domain decomposition .",
    "domain decomposition splits the grid into subsets , each of which are handled by processors with independent private memory .",
    "this provides the advantage of alleviating intensive memory requirement of of 3d - pdr .",
    "however , during ray tracing , rays must traverse cells on the grid that belong to different domains to that from which the ray originate , in which the thread doing the ray tracing has no knowledge of the conditions . to overcome this issue",
    ", message passing interface ( mpi ) communication is required between the thread doing the ray tracing and the thread through which the ray is passing . to facilitate this , we iterate over domains , with one performing ray tracing operations and the others acting as servers .",
    "mpi does not therefore offer significant speedup in the ray tracing component of the calculations .",
    "it does however offer speed up in other components of the pdr calculation and offers excellent speedup for the monte carlo radiative transfer part of the calculation @xcite .      as explained in @xcite , the 3d - pdr code stores information on every intersection point for every ray .",
    "although this offers the ability to perform pdr calculations directly on any sph or grid - based simulation without further modifications , it has disadvantages with regards to the large memory requirements . in the new coupled code , we perform calculations on a cell - by - cell basis . we take advantage of the fact that torus moves recursively through the amr grid throughout the calculations .",
    "in addition to the domain decomposition we simultaneously parallelize the code using open multi - processing ( openmp ) over intensive loops in the calculation . on each computational node",
    ", one ( or more ) cores are assigned the role of mpi threads and the others are used for openmp parallelization .",
    "use of mpi and openmp in this hybrid manner provides us with a flexible parallelization scheme that both reduces calculation wall time and memory demands . for the tests performed here , we find that the computational expense depends strongly on each different application . the one - dimensional hii / pdr calculation presented in ",
    "[ ssec : photopdr ] , required approximately 22 cpu minutes .",
    "the pdr calculations in the three - dimensional ( excluding the monte carlo photoionization part ) required @xmath155 cpu hours for @xmath77 healpix refinement , @xmath156 cpu hours for @xmath157 and @xmath158 cpu hours for @xmath123 . these show that an @xmath123 simulation is about an order of magnitude more expensive than one at @xmath77 .",
    "we are currently upgrading the openmp parallelization and with recent developments by @xcite , the computational cost will be reduced in future versions of torus-3dpdr .",
    "these further optimizations will make computationally more tractable complicated post processing of 3d simulations .",
    "figure [ fig : flowchart ] shows the basic flowchart describing how torus-3dpdr converges in evaluating the photoionization ( upper half of the figure ) and pdr ( lower half of the figure ) calculations .",
    "each solid box represents a do - loop over grid cells .",
    "the dashed box represents iterations over the ionization and the thermal balance in the photoionization calculations .",
    "the code starts by reading all input model parameters , such as the density distribution , the abundances of species , and the location and properties of each ionizing source .",
    "it then starts the monte carlo based propagation of ionizing photons and it iterates in order to obtain equilibrium in the h  ii region .",
    "once torus-3dpdr reaches photoionization convergence , it stores the direction of the uv radiation field in each cell .",
    "the code then proceeds further in performing the pdr calculations .",
    "in particular healpix - based rays emanate from each cell flagged as pdr , and it moves along them to calculate the column densities for every cell in every direction .",
    "a cell is flagged as pdr if the value of the hydrogen ionization fraction is below @xmath152 , corresponding to a gas temperature of @xmath153 .",
    "any further pdr calculation follows the flowchart presented in appendix a of @xcite .",
    "once torus-3dpdr is fully converged it writes the outputs and terminates .",
    "the flux , @xmath159 , at a given point point @xmath160 is given by the equation @xmath161 where @xmath162 is the luminosity of the source ( in this case a single star ) .",
    "at the position of the ionization front ( if ) , the above equation leads to @xmath163 at a given position , @xmath26 , inside the pdr ( hence at a distance @xmath164 from the star ) , eqn.([eqn : app.1 ] ) takes the form @xmath165 which when combined with eqn.([eqn : app.2 ] ) leads to @xmath166 from the above it turns that the factor @xmath167 corresponds to the geometrical dilution of the uv radiation when account is taken of the dilution inside the h  ii region .",
    "hence , if we additionally take into account the exctinction of the radiation along distance @xmath26 , it leads to eqn.([eqn : geomdil ] ) . neglecting the dilution of the radiation inside the h  ii region ,",
    "the corresponding factor is simply @xmath168 , leading to eqn.([eqn : uvtest ] ) .",
    "we note that a full treatment of the h  ii / pdr complex using the mc method takes into account the dilution inside the ionized region , hence it is in agreement with eqn.([eqn : geomdil ] ) .",
    "in addition , for simplified cases such as in the plane - parallel approximation , torus-3dpdr is able to treat the uv field as discussed in @xcite ."
  ],
  "abstract_text": [
    "<S> the interaction of ionizing and far - ultraviolet radiation with the interstellar medium is of great importance . </S>",
    "<S> it results in the formation of regions in which the gas is ionized , beyond which are photodissociation regions ( pdrs ) in which the gas transitions to its atomic and molecular form . </S>",
    "<S> several numerical codes have been implemented to study these two main phases of the interstellar medium either dynamically or chemically . in this paper </S>",
    "<S> we present torus-3dpdr , a new self - consistent code for treating the chemistry of three - dimensional photoionization and photodissociation regions . </S>",
    "<S> it is an integrated code coupling the two codes torus , a hydrodynamics and monte carlo radiation transport code , and 3d - pdr , a photodissociation regions code . </S>",
    "<S> the new code uses a monte carlo radiative transfer scheme to account for the propagation of the ionizing radiation including the diffusive component as well as a ray - tracing scheme based on the healpix package in order to account for the escape probability and column density calculations . here , we present the numerical techniques we followed and we show the capabilities of the new code in modelling three - dimensional objects including single or multiple sources . </S>",
    "<S> we discuss the effects introduced by the diffusive component of the uv field in determining the thermal balance of pdrs as well as the effects introduced by a multiple sources treatment of the radiation field . </S>",
    "<S> we find that diffuse radiation can positively contribute to the formation of co. with this new code , three - dimensional synthetic observations for the major cooling lines are possible , for making feasible a detailed comparison between hydrodynamical simulations and observations .    </S>",
    "<S> ism : abundances  astrochemistry  radiative transfer  methods : numerical </S>"
  ]
}