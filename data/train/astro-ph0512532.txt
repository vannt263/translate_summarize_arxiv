{
  "article_text": [
    "snsph is a particle - based code , using smooth particle hydrodynamics ( sph ) to model the euler equations and a flux - limited diffusion package to model radiation transport .",
    "its tree algorithm is designed for fast traversal on parallel systems ( warren & salmon 1993,1995 ) and has been shown to scale well up to high processor number on a wide variety of computer architectures .",
    "the increased synchronization required for the transport algorithm limits this scalability to roughly 512 processors on current parallel computers for the 1 - 10 million particle core - collapse calculations that are feasible with our current codes and current computing power .",
    "snsph has now been used in several papers appearing in the literature studying a range of problems from stellar collapse ( fryer & warren 2002,2004 ; fryer 2004 ; fryer & kusenko 2005 ) to supernova explosions and supernova remnants ( hungerford et al .",
    "2003 , 2005 ; young et al . 2005 ; rockefeller et al .",
    "2005a ; fryer et al .",
    "2005 ) to models of massive binaries and winds from these binaries ( fryer & heger 2005 ; fryer , rockefeller , & young 2005 ) to models of both the gas and disk evolution in the galactic center ( rockefeller et al .",
    "2004 , 2005b , 2005c ) . but",
    "none of these papers has provided a detailed description of the snsph code itself . here",
    "we describe these details :  2 describes much of the physics implementation from gravity to hydrodynamics to radiation transport ; and  3 describes many of the numerical techniques used in this particle - based code , focusing on many of the computational techniques required to make such a scheme scalable . in  4 , we show the results of snsph for a number of tests ( both standard and new ) used to confirm the validity of snsph for core - collapse simulations .",
    "astrophysics problems tend to be too complex for most standard code tests to completely confirm the validity of the code for that specific astrophysics problem .",
    "we present a small suite of tests to show the broad range of physics that must be tested to model core - collapse .",
    "these tests demonstrate the wide applicability of this snsph code , but further testing is required to truly test all the physics in the code .",
    "we conclude with a list of strengths and weaknesses of snsph .",
    "as with many astrophysics problems , solving the supernova problem requires a wide range of physics .",
    "this physics must be , in one way or another , implemented into the numerical code simulating this phenomena . in this section",
    ", we describe the major aspects of the physics incorporated into snsph : gravity , hydrodynamics ( including the equation of state ) , and radiation transport ( including opacities ) .",
    "where possible , we have sought to make the code modular to facilitate modifications in the different microphysics packages from the equation of state to neutrino cross - sections and emission routines .",
    "newton s second law of motion and law of gravitation provide an expression for the acceleration of one body under the combined gravitational influence of a set of @xmath0 other bodies , according to @xmath1 where @xmath2 . using this equation to calculate",
    "the acceleration for one body requires @xmath3 evaluations of the term inside the sum , so determining the accelerations of all @xmath4 bodies in a simulation requires @xmath5 or @xmath6 operations . performing this type of pairwise summation to calculate gravitational interactions",
    "is prohibitively expensive for all but the smallest sets of bodies , even on the fastest supercomputers .",
    "a number of approximate methods have been developed to calculate gravitational forces among large numbers of bodies by considering as one interaction the total effect of a set of bodies on one body , or the effect of one set of bodies on another set , with time requirements that scale as @xmath7 or @xmath8 , respectively .",
    "codes that use adaptive tree structures to subdivide the volume of a simulation and distinguish between nearby and distant bodies can easily implement such accelerated techniques ; our code uses such a tree and is therefore one of a class of codes called `` treecodes '' .",
    "this class includes many sph codes such as gadget @xcite and gasoline @xcite as well as particle mesh codes @xcite and some adaptive mesh refinement codes such as rage @xcite .",
    "knowledge of the spatial arrangement of bodies in a simulation allows the treecode to distinguish between `` nearby '' bodies , for which direct pairwise calculation of gravitational forces is appropriate , and `` distant '' bodies , for which an approximate technique will yield a sufficiently accurate value for the force .",
    "the simplest approximation combines a set of distant bodies into one object with a total mass equal to the sum of the masses of the individual bodies in the group , positioned at the location of the center of mass of the group : @xmath9 where @xmath10 , @xmath11 is the location of the center of mass of the group of bodies , and @xmath12 is the total mass of the group . in principle",
    "this equation could include additional terms on the right - hand side to account for the quadrupole and higher moments of the mass distribution . in practice ,",
    "equivalent accuracy and higher performance is obtained for moderate levels of accuracy ( @xmath13 0.1 percent ) by including only the monopole contribution ( and , implicitly , the dipole contribution , which is equal to zero ) and using an appropriate criterion for determining when the approximation is accurate enough .",
    "some criterion must be used to determined when the multipole approximation in equation  [ eqn : multipole ] is sufficiently accurate to use instead of direct summation of the accelerations due to each body in the set .",
    "this criterion is called the `` multipole acceptability criterion '' or mac .",
    "many different macs have been proposed , and several are in widespread use .",
    "salmon & warren ( 1994 ) analyzed the worst - case behavior of several different macs and developed a technique to determine a strict upper limit on the errors in each acceleration calculation .",
    "as described in ( warren & salmon 1993,1995 ) , we use a mac that incorporates such an error estimate into the calculation of a critical radius , according to @xmath14 where @xmath15 is the size of the cell and @xmath16 is the trace of the quadrupole moment tensor .",
    "a body and cell separated by a distance greater than @xmath17 can use equation  [ eqn : multipole ] to evaluate the acceleration , and the absolute error is guaranteed to be less than @xmath18 ; a body and cell closer than @xmath17 must use pairwise summation for each body in the cell , or subdivide the cell into smaller cells and reconsider the interactions , to ensure that the error is not larger than that tolerance .",
    "the particle - based structure of our code allows us to easily implement the smooth particle hydrodynamics ( sph ) to model the euler ( inviscid ) equations .",
    "sph , invented in 1977 ( lucy 1977 , gingold & monaghan 1977 ) , has become the primary multi - dimensional lagrangian technique used in astrophysics .",
    "its versatility allows it to be used on a variety of astrophysics problems ( see benz 1988 ; monaghan 1992 for a review ) .",
    "many variants of sph have been developed and a number of excellent reviews on the sph technique , and its variations , already exist ( benz 1989 ; monaghan 1992 ; morris 1996 ; rasio 1999 ; monaghan 2005 ) ; we provide a brief review here and direct readers interested in more details to the above reviews .",
    "our code was developed using the benz version of sph ( benz 1984 , 1988 , 1989 ) as a model and is nearly identical to those codes based on this version of sph .",
    "sph is a particle based method where particles act as interpolation points to determine matter conditions throughout the simulation space .",
    "consider the following integral representation of the quantity @xmath19 : @xmath20 where @xmath21 ( the `` kernel '' ) has the following properties : @xmath22 and @xmath23 by integrating @xmath19 with our kernel , @xmath24 is the `` smoothed '' version of @xmath19 ( hence the origin of the `` smooth '' in sph ) .",
    "note that @xmath24 approaches @xmath19 as @xmath25 .",
    "if we expand @xmath26 in a taylor series , we find that : @xmath27 this sph formulism introduces an error of order @xmath28 in the estimate of the quantity @xmath29 .",
    "discretizing this method , the integral over @xmath19 is reduced to a summation over a number of points ( particles ) in space : @xmath30 where @xmath31 , @xmath32 , and @xmath33 are the respective values of @xmath19 , the mass , and the density of particle @xmath34 .",
    "the structure of the smoothing is determined by the kernel @xmath21 where @xmath35 denotes the size over which the smoothing occurs ( see below ) .",
    "although any kernel will work as long as it satisfies equations [ eq : kernelint ] and [ eq : kernellim ] , determining the best kernel for a given problem can be a black art .",
    "one of the simplest kernels , and the one we use for most of our calculations ( although we also use other spline kernels ) is a cubic spline kernel : @xmath36 where @xmath37 . with this kernel , a given interpolation point ( particle )",
    "contributes to the value of @xmath29 only if @xmath38 is within @xmath39 of that particle .",
    "the value of @xmath35 for a given particle @xmath40 , termed the `` smoothing length '' , is allowed to vary with time using the relation presented in benz ( 1989 ) : @xmath41 this variation is necessary to ensure full spatial coverage by the particles ( we would like any position to overlap with a base number of particles ) and , as long as @xmath35 varies on a scale similar to other variables , the errors remain of @xmath42 ( hernquist & katz 1989 ) .",
    "we define the interaction between a particle @xmath40 and a neighboring particle @xmath34 by evaluating a mean value @xmath43 .",
    "we additionally set limits for the number of neighbors ( the standard range for our 3-dimensional models is between @xmath1340 and @xmath1380 neighbors ) . in the extreme case that the number of neighbors falls above ( or below ) these maximum ( minimum ) values , we additionally lower ( raise ) @xmath44 by a configurable amount on each timestep ( typically a factor of 0.002 - 0.1 ) to enforce this range of neighbors ( this occurs rarely , if at all , for a given particle during the course of a simulation ) .",
    "we can now use our interpolation points to calculate the value of any quantity and its derivatives over our spatial domain .",
    "the density at position @xmath40 is simply : @xmath45 as with any numerical technique , there is more than one way to discretize our system .",
    "this is most apparent in the calculation of derivatives .",
    "for example , in principal , the gradient of a function @xmath19 at particle @xmath40 is just : @xmath46 in practice , it is more accurate to use , @xmath47 \\\\ & = &              1/\\rho_i \\sum_j ( a_j - a_i ) m_j \\nabla              w(\\vec{r}_i-\\vec{r}_j , h ) .",
    "\\end{aligned}\\ ] ] the morris ( 1996 ) review includes quite a bit of discussion about these `` techniques '' used to improve sph , also noting the situations when one technique might be better than another .",
    "we follow the benz version of sph for all our discretization assumptions in solving the hydrodynamics equations .",
    "the benz version of sph is a true lagrangian code - the mass and number of particles is conserved , so the total mass in the system is also conserved .",
    "we evaluate momentum and energy conservation for the particles themselves and assume an inviscid gas .",
    "hence , the hydrodynamic equations reduce to the lagrangian form of the euler equations : @xmath48 where @xmath49 and @xmath50 is the pressure of particle @xmath40 .",
    "if we simply use equation [ eq : trick ] , the pressure gradient for particle @xmath40 is written : @xmath51 where @xmath52 .",
    "although such a scheme can be used , it is not symmetric ( and hence does not conserve linear and angular momentum ) .",
    "we can instead write : @xmath53 now using equation [ eq : trick ] on this representation ,",
    "we get : @xmath54 let s confirm that this algorithm conserves linear momentum .",
    "the force on particle @xmath40 due to particle @xmath34 is equal to the negative force on particle @xmath34 due to particle @xmath40 : @xmath55 where we have taken advantage of the fact that the kernels are anti - symmetric @xmath56 .",
    "we will show that angular momentum is conserved in section [ sec : angm ] .",
    "most hydrodynamics codes evolve either the total energy ( kinetic + internal ) or the internal ( thermal ) energy alone . in a system with gravity , the total energy also can include the gravitational potential energy . evolving the total energy ensures a better conservation of the total energy .",
    "but in astrophysics , accurate temperatures ( and hence energies ) are important even in cases where the gravitational potential and kinetic energies dominate the total energy by many orders of magnitude . to obtain reliable internal energies , it is often better to evolve the internal energy alone in the energy equation .",
    "the evolution of the specific internal energy @xmath57 is @xmath58 corresponding to the following sph formulation : @xmath59 see morris ( 1996 ) for other valid sph formulations of the energy equation .",
    "it is easy to show that this formulation combined with our momentum equation conserves total energy ( kinetic and thermal energies ) .",
    "the total energy for all particles is given by : @xmath60 by interchanging indices and again making use of the identity @xmath61 , we get @xmath62 comparing this to equation [ eq : mom ] , we find : @xmath63 which shows that the work done by pressure forces changing the kinetic energy comes at the expense of the internal energy , ensuring the conservation of total energy .    in core - collapse , it is often better to follow the entropy , instead of the internal energy , of matter . for degenerate matter , the temperature can vary wildly over small changes of the internal energy .",
    "entropy varies more rapidly with temperature in degenerate conditions . by using entropy as the energy parameter",
    ", we get more stable temperature values .",
    "we use the same hydrodynamics equations , setting @xmath64 where @xmath65 is the matter temperature .",
    "we have limited our description of hydrodynamics to inviscid ( euler ) equations .",
    "it is well known that any euler method with finite resolution is unable to describe shocks and will result in large , unphysical , oscillations unless one includes some sort of viscosity , low order diffusion or a riemann solver .",
    "although godunov - type methods have been developed for sph ( inutsuka 1994 ; monaghan 1997 ; inutsuka 2002 ) , most techniques introduce a viscosity term to handle shocks ( benz 1989 ; monaghan 1992 , monaghan 2005 ) : @xmath66 where @xmath67 @xmath68 and @xmath69 are the average of the densities and sound speeds of the interacting particles , @xmath70 and @xmath71 are the bulk and von neumann - richtmyer viscosity coefficients respectively ( typically set to 1.5 and 3.0 ) , and @xmath72 is a factor to avoid divergences at small separations ( typically set to 0.01 ) .",
    "the momentum and energy ( internal + kinetic ) equations can now be rewritten to include this viscosity : @xmath73 and @xmath74 clearly , the addition of the artificial viscosity term retains our total ( kinetic + internal ) energy conservation .      to complete these equations",
    ", we must include an equation of state to determine pressures from internal energies or entropies .",
    "our basic sph scheme includes equations of state for isothermal and ideal gases .",
    "but we have also included a number of equations of state and the code has thusfar not encountered any problems incorporating new equations of state .    the most complex equation of state we have in the code is the one we have used in most of our supernova simulations . for the core - collapse problem",
    "we use an equation of state combining the nuclear equation of state by lattimer & swesty ( 1991 ) at high densities and the blinnikov et al .",
    "( 1996 ) equation of state at low densities .",
    "nuclear burning is approximated by a nuclear statistical equilibrium scheme ( hix & thielemann 1996 ) .",
    "the lattimer & swesty ( 1991 ) equation of state can be used from densities below @xmath75 up to densities above @xmath76 .",
    "however , an error in the energy levels of this equation of state cause it to give incorrect answers below @xmath77 ( timmes et al . 2005 ) and be aware that we do not know the true behavior of matter above nuclear densities and we expect this part of the equation of state to change with time .",
    "it is valid for electron fractions from 0.03 up to 0.5 .",
    "if the electron fraction exceeds this value , we assume the pressure is set to 0.5 . in typical simulations",
    ", we use the lattimer & swesty equation of state for matter above @xmath77 . below @xmath78",
    ", we use the blinnikov equation of state .",
    "this equation of state is valid to densities as low as @xmath79 .",
    "below these densities , the equation of state is comparable to an ideal gas equation of state .",
    "the nuclear statistical equilibrium scheme is used for material in the blinnikov equation of state with temperatures above @xmath80k ( depending upon the problem , this value is sometimes set a factor of 2 lower or higher ) .",
    "this scheme uses 16 species , focusing on the iron - peak elements from @xmath81 to @xmath82kr with typical q - values for reactions among stable nuclei heavier than silicon lying between 8 - 12mev .",
    "the version of the equation of state we describe here is not tabular , but a set of analytic function calls .",
    "timmes et al .",
    "( 2006 ) have developed a tabular version of this equation of state which is currently being tested .",
    "we have added small networks , such as the 14-element alpha network by benz , thielemann , & hills ( 1989 ) to the code to follow the burning in the non - steady state .",
    "in general , the burning time - step is much shorter than the hydrodynamic timestep , so the burning is done in a sub - cycle using newton - raphson iterations to converge . for most core - collapse calculations where we include this network ,",
    "burning is only considered for temperatures above @xmath83k and the network is switched over to nuclear statistical equilibrium at @xmath84k .",
    "comparisons with large networks have shown that this network does not produce accurate yields , but the energies are reasonable ( young et al .",
    "2005 ) .",
    "we have also added an equation of state to model the basalt and iron material in planetary cores ( tillotson 1962 ) .",
    "the addition of new equations of state is a straightforward exercise ( @xmath85 day of work ) .",
    "the radiation transport scheme currently implemented in the sph code is based on the 2-dimensional explicit , flux - limited transport scheme developed by herant et al .",
    "flux - limited diffusion is a moment closure technique where the equations are closed in the first moment . for neutrino diffusion ,",
    "we transport the neutrino number and the advection term in the flux limited diffusion equation is simply : @xmath86 where @xmath87 is the neutrino number , c is the speed of the neutrinos ( set to the speed of light ) and @xmath88 is the flux - limiter . here we describe the 3-dimensional adaptation of this scheme .",
    "we also comment on a number of peculiarities of this scheme that should be understood before its use .",
    "in the current version of the code , we consider the transport of 3 neutrino species ( @xmath89 where @xmath90 corresponds to the @xmath91 neutrinos and their anti - particles that are all treated equally ) . because neutrino number is the conserved quantity , we transport neutrino number and then determine the energy transport by using the mean neutrino energies . the radiation transport scheme in our sph code",
    "is modeled after the technique to calculate forces in sph : we calculate symmetric interactions between all neighbor particles .",
    "hence , our flux - limited diffusion scheme calculates the radiation diffusion in or out of a particle by summing the transport over all neighbors ( the equivalent of all bordering cells in a grid calculation ) . the neutrino transport for particle i is given by : @xmath92 and the corresponding energy transport is : @xmath93 where @xmath94 are , respectively , the neutrino density and energy density in particle i for species @xmath95",
    ", @xmath96 is the mean neutrino energy ( an average energy taking into account the @xmath97 dependence of the neutrino opacity ) , and @xmath98 is the redshift correction for @xmath99 as seen by particle i. @xmath100 are the fermion blocking factors for neutrinos .",
    "@xmath101 is effectively the limiter for the flux - limited transport scheme ( we have modified the definition slightly to fit in our numerical equations ) .",
    "the simplest such scheme for 3-dimensions is : @xmath102 where @xmath103 is the speed of light , @xmath104 is the harmonic mean of the diffusion coefficients for the species @xmath95 of particles i and j and @xmath105 is the distance between particles i and j. this limiter was used by herant et al .",
    "( 1994 ) and , for comparison with herant et al .",
    "( 1994 ) , by fryer & warren ( 2002 ) , but we have used a number of other flux - limiters , all of which are valid under this transport scheme ( fryer et al .",
    "the opacities used to determine the diffusion coefficients are given in herant et al .",
    "( 1994 ) .    beyond some radius in a core - collapse simulation ,",
    "neutrinos are essentially in the free - streaming regime where transport is not necessary ( unless one wants to truly follow the radiation wave as it progresses through the star ) .",
    "we do not model transport beyond this `` trapping '' radius .",
    "instead we sum up all neutrinos that transport beyond this radius and emit them using a light - bulb approximation .",
    "that is , the material beyond this radius sees a constant flux and we can determine the amount of energy a particle gains ( @xmath106 ) from neutrino interactions simply by using the free - streaming limit : @xmath107 where @xmath108 is the neutrino luminosity and @xmath109 is the optical depth of a particle @xmath40 .",
    "this assumption is only valid if the total amount of energy imparted ( @xmath110 ) from the neutrinos onto the matter is much less than the total neutrino flux ( @xmath108 ) . to guarantee this , we determine this trapping radius by evolving it with time such that @xmath111 is always less than some value . this value was originally set to 0.1 by herant et al .",
    "( 1994 ) , but in recent calculations , we use 0.05 .    such a scheme can be easily converted into multi - group , but such modifications have not yet been done .",
    "the scheme scales reasonably well on multiple processors ( for a 5 million particle run , the code has scaled nearly linearly up to 256 processors on the space simulator beowulf cluster and up to 512 processors on the asc q machine at los alamos national laboratory ) . in part , this scalability is due to the explicit nature of the transport scheme . in general ,",
    "explicit transport schemes strongly limits timesteps as the speed of light , not sound , constrains the duration of the timestep . in core - collapse supernovae",
    ", this constraint is not too onerous because the sound speed is nearly a third the speed of light anyway , so the explicit transport scheme leads to only a factor of 3 decrease in the timestep . but this explicit flux - limited transport scheme can be used in a much wider variety of problems where the mean free path is very short for the smallest particles .",
    "such scenarios occur in many astrophysics problems .",
    "before we show how well snsph performs on our suite of test problems , let s describe the computational techniques used to make this code run efficiently on parallel architectures .",
    "on a single processor , careful attention to the computational details can significantly accelerate a code s performance . for large - scale parallel architectures ,",
    "these details are critical to taking full advantage of these supercomputers .",
    "unfortunately , the more complex the code becomes , the more ingenuous the computational techniques must be to preserve scalability .",
    "here we discuss just the basic computational issues , focusing on our tree algorithm ( see also warren & salmon 1993 , 1995 ) and the basic parallelization issues arising from use of this tree .",
    "we conclude with a discussion of the timestep integrator .",
    "the calculation of gravitational forces between bodies in a n - body simulation and the identification of neighbors in a sph calculation are both accelerated significantly through the use of a treecode , in which a hierarchical `` tree '' data structure is constructed to represent the spatial arrangement of bodies in a simulation .",
    "our code uses a `` parallel hashed oct - tree algorithm '' ( warren & salmon 1993 , 1995 ) , in which each node in the tree can have up to eight `` daughter '' nodes below it .",
    "the `` root '' of the tree ( often imagined to be at the top of the tree in computer science discussions ) represents the entire volume of a simulation ; each of the root s eight daughter nodes represents one octant of that overall volume .",
    "a complete hierarchical representation of the volume can be created by recursively subdividing each octant and adding more levels of daughter nodes to the tree until some stopping condition is reached . in our implementation of a treecode , we stop subdividing a volume when that volume contains zero particles or only one particle ; the node representing that volume in the tree is called a `` leaf '' node and has no daughters of its own . by performing traversals of the hierarchical tree structure",
    ", the treecode can rapidly distinguish between nearby and distant particles and accelerate the calculation of gravitational and pressure forces in simulations .    in descriptions of n - body techniques ,",
    "the term `` body '' generally refers to one of the fundamental entities being simulated . in smoothed particle hydrodynamics",
    ", the interacting entities are logically called `` particles '' . in the following discussion ,",
    "the terms `` particle '' and `` body '' are used interchangeably ; both refer to a data - carrying entity in a simulation .",
    "the term `` cell '' refers to a cubical region of space containing ( possibly zero ) particles ; a cell is represented as a node in the tree data structure that stores data used by the treecode , and phrases like `` daughter cell '' refer to the combined knowledge about a spatial region in the simulation and its topological location within the tree .",
    "conventional implementations of tree structures represent connections between nodes within the tree as pointers stored in parent nodes that point to the memory locations of the daughters .",
    "this technique is difficult to implement on a parallel machine : a parent node on one processor may have daughter nodes located on different processors .",
    "our treecode instead uses multi - bit `` keys '' to identify particles and cells in the tree ; a hash table translates keys into actual memory locations where cell data is stored ( hence the word `` hashed '' in the phrase `` parallel hashed oct - tree algorithm '' ) .",
    "this level of indirection enables uniform handling of local and non - local cell data ; the algorithm that maps hash keys to cell data can request non - local data from other processors and only make it available to the local process once it has arrived .",
    "as was mentioned above , each body and cell in the tree is identified by a key ; by using the key as an index into a hash table , the code can quickly locate or request delivery of data about any entity in a simulation , and the hash algorithm transparently handles retrieval of data stored on other processors in a parallel machine .",
    "the algorithm described below generates keys that , when sorted , arrange the particles into morton order within the volume of solution ; such keys are often called `` morton keys '' .",
    "morton ordering results in a list of particles that fairly well reflects spatial locality of bodies in the tree , i.e. particles with morton keys that fall near each other in the sorted list of keys generally lie near each other in the simulated volume .",
    "however , particles sorted into e.g. peano - hilbert order can exhibit an even higher correlation between proximity in the sorted key list and proximity in space , which can lead to more efficient distribution of data on a parallel computer , so modern treecodes have tended to use peano - hilbert keys to refer to particles ( see , e.g. , springel 2005 ) .",
    "our treecode supports both morton and peano - hilbert keys , but in practice we have found no noticeable difference in performance ; we generally use morton keys , as described below .",
    "each morton key is a set of @xmath112 bits derived from the @xmath113 floating point coordinates of a body in @xmath113-dimensional space .",
    "one bit is reserved as a placeholder , for reasons explained below , which leaves @xmath114 bits to represent each of the coordinates of a body . to generate a key for each particle in a simulation ,",
    "we start by calculating the spatial extent of the simulation and then divide the largest spatial dimension into @xmath115 equal intervals ; the intervals can then be indexed by a @xmath116-bit integer . for simplicity , the same interval spacing is used for the other ( smaller ) spatial dimensions as well .",
    "each floating point coordinate of each body in the simulation is mapped to the @xmath116-bit integer index of the spatial interval containing that coordinate .    to construct a key from the @xmath113 integers derived from the spatial coordinates of a body , the integers are interleaved bit - by - bit .",
    "the result is a key composed of @xmath116 groups of bits , each of length @xmath113 , where the bits in the @xmath40th group are the @xmath40th bits of each of the integers identifying the body , arranged in dimension order .",
    "the mapping between keys and pointers to cell data is maintained via a hash table .",
    "the actual hashing function is very simple  we select the @xmath35 least - significant bits of the key  but because a key reflects the spatial location of the associated cell , the spatial distribution of bodies and cells determines which hash table entries are filled . each hash table entry is stored in a `` hcell '' ; the hcell contains a pointer to the actual cell data ( if the data is local ) and maintains knowledge of the state of the cell data  whether it is local or nonlocal , or if it has been requested from another processor .",
    "the key length @xmath112 determines how many levels of cells the tree can represent , or how close two particles can be , relative to the spatial extent of the simulation , and still be stored separately in the tree .",
    "intermediate ( i.e. non - leaf ) cells in the tree can be represented in the same key space as individual bodies if the highest bit of every key is set to 1 as a placeholder ; the position of this placeholder ( the highest non - zero bit ) in a cell s key indicates the depth of that cell in the tree . given a key for any cell or body , the key of the parent cell can be found by right - shifting the key by @xmath113 bits ( i.e. the number of spatial dimensions ) .",
    "the root of the tree has a key of `` 1''the placeholder bit is the lowest ( and only ) bit in the key .    keys constructed for bodies are used first to sort the particles and distribute them across the set of processors used in a parallel calculation ( see  [ code : parallel ] ) .",
    "after each processor receives the bodies assigned to it , a tree of cells is constructed and all local bodies are inserted into the tree .",
    "the key associated with a body is not changed when the body is added to the tree ; instead , the body is associated with a cell , and the cell key represents the location and depth of the cell in the tree .",
    "the first body is inserted into a cell immediately below the root .",
    "subsequent cells are inserted by starting from the location of the previous cell and searching for the appropriate location in the tree ; because the bodies are already sorted , the correct location is usually very close to the previously - inserted cell .",
    "often the insertion of a new cell will require a previously - inserted cell to be split , and both the old and new cell will be moved to a lower location in the tree ; empty cells are inserted at each tree level between the old and new locations .",
    "an intermediate cell is `` finished '' when it is clear that no new bodies will be inserted below it  because the bodies have already been sorted into morton order , it is easy to determine when no additional bodies will be inserted below a particular cell .",
    "the process of `` finishing '' includes calculating the total mass and spatial extent of the set of all daughter cells , which permits fast evaluation of multipole contributions during calculation of gravitational forces among groups of particles .      sorting the list of body keys is equivalent to arranging the bodies in morton order .",
    "morton ordering does a reasonably good job of maintaining locality of data in the sorted list ; bodies that are close together in space end up close to each other in the list .",
    "this ordering of bodies also allows easy domain decomposition for parallelization ; data can be distributed over a set of processors in a parallel machine by cutting the list of bodies into `` equal - work '' lengths and sending each list section to a different processor .",
    "the `` work '' required to update a particle is usually defined as the number of interactions in which the particle participated during the previous timestep , which generally results in good load - balancing .",
    "it is also possible to adjust the estimated work associated with any set of particles to account for , e.g. , complex equation of state calculations which take a predictable number of iterations to converge .",
    "parallel tree construction adds one additional step to the process described in ",
    "[ code : tree ] ; after building a local tree , each processor finds and transmits a set of `` branch cells '' to all other nodes .",
    "the set of branch cells on a given processor is the coarsest set of cells that contains all of the data stored on that processor .",
    "branch cells are the highest `` finished '' cells in the local tree ; all cells and bodies below a branch cell are also stored on the processor , while cells above the branch cell include regions of space containing particles stored on other processors .",
    "every processor broadcasts its branch cells to every other processor , so that each processor can directly request non - local cell data from the correct processor during traversals of the tree .",
    "characterizing the performance of parallel scientific codes is difficult , and trying to doing so for snsph presents all the usual pitfalls . per - processor",
    "performance metrics , and scaling of performance with number of processors in a parallel calculation , both vary strongly depending on the size of simulation under consideration , the hardware platform on which the simulation is run , and even the particular physical or numerical conditions present in the simulation . scaling for snsph",
    "is linear on hundreds through thousands of processors on modern supercomputers , as long as the problem being simulated is sufficiently large , and the definition of `` large '' for a given computer depends on the details of the cpu architecture , memory subsystem , node interconnects , and other system components . for a core - collapse simulation including all physics modules within snsph ,",
    "a 4-million - particle set of initial conditions is sufficiently large to support nearly linear scaling on up to 256 processors on pink at los alamos national laboratory .",
    "the fraction of time spent on different tasks during a typical core - collapse simulation at least identifies the most time - consuming portions of snsph .",
    "a typical core - collapse simulation spends most of its time ( @xmath117% ) calculation forces and updating flow quantities in the innermost loop over individual sph particles ; of this time , typically only 10% is spent in the equation of state or performing neutrino transport , but this number can grow dramatically in pathological cases when the iterative procedures in the eos are unable to quickly converge to a solution .",
    "@xmath118% of the cpu time is spent updating gravitational forces among groups of particles , though this percentage can change depending on the desired accuracy for the gravitational force calculations .",
    "the treecode accelerates both of these calculations , but the gravitational force calculations benefit more , since the use of a tree accelerations both identification of nearby particles and evaluation of the gravitational forces themselves . updating quantities for sph particles",
    "benefits only from the fast neighbor - finding provided by the treecode . calculating keys for each particle , performing a parallel sort of the keys across all processors in a calculation , and building the tree typically consumes @xmath119% of the total time in a calculation , and most of this time is spent shifting particles between processors .",
    "overall , delays associated with message - passing typically account for @xmath120% of the time per timestep in a typical calculation on a gigabit ethernet network such as the one used in the space simulator at los alamos national laboratory .",
    "more sophisticated interconnects , such as the myrinet interconnect used on pink , reduce this percentage dramatically ( generally to less than 5% ) .",
    "after the rates of change of all flow variables are calculated via the sph equations , we apply an integration scheme to advance all quantities to the next timestep . to update the specific internal energy @xmath57 of each particle",
    ", we use the 2nd - order adams - bashforth method , a 2nd - order method for 1st - order odes : @xmath121 the smoothing length @xmath35 of each sph particle is updated using the 2nd - order leapfrog method : @xmath122 we update the position @xmath123 and velocity @xmath124 of each sph and n - body particle using the press method , a 2nd - order method for 2nd - order odes : @xmath125 @xmath126 note that @xmath127 depends on @xmath128 and @xmath129 , and @xmath130 depends on @xmath131 and @xmath132 ( not @xmath131 and @xmath133 ) .",
    "equations  [ eqn : energy ] , [ eqn : velocity ] , and [ eqn : position ] are not self - starting ; when a simulation is started ( or restarted from an intermediate point ) , we assume that @xmath134 and @xmath135 . at all other times , @xmath133 is updated only for the benefit of the user ; the press method updates the position of each particle using the current and previous position .",
    "the term @xmath136 in equation  [ eqn : velocity ] can suffer from large floating - point roundoff errors if @xmath137 is small , the current and previous positions are nearly equal , and the precision of the variables used to store the positions is low ; for this reason , the code stores current and previous positions in double - precision variables .",
    "the core - collapse supernova problem is so complex that testing one piece of physics is not sufficient to ensure that the code will work on the entire supernova problem . as an example , the shock tube , sedov , and sod problems all essentially test how well a hydrodynamics code works on shocks ( along with some additional tests of boundary conditions ) , but shock formation is not the only physical process relevant to core - collapse .",
    "for example , our rotating models require strict conservation of angular momentum and minimal artificial angular momentum transport . we must make sure our tests actually verify our code in conditions similar to what we expect in our simulations .",
    "another issue we must worry about in code - testing is fine - tuning the code so that it performs well on a particular simplified test .",
    "this sort of fine - tuning occurs fairly often by those modeling the shock tube problem .",
    "the shock moves along the grid so one can easily add code to model the shock well under these conditions .",
    "but will these modifications actually help the code perform when the shock is more complex and not parallel to the grid ? the shock tube / sedov / sod problems should be considered 1st order tests of a code s ability to model shocks .",
    "more complex tests are necessary to fully trust a numerical algorithm .",
    "there are a number of ways to verify and/or validate a numerical code .",
    "these two words have specific meaning in the computational community : verification refers to testing that a code is solving correctly the physical equations it is supposed to be solving .",
    "validation is defined as making sure the physical equations used are the right set of equations required for that problem .",
    "validation is often interpreted as any test comparing to experiment .",
    "this is only strictly true if the comparison experiment is ( or nearly is identical to ) the problem for which one is validating the code .",
    "most tests in astrophysics are verification tests , and we will focus on these here . in astrophysics verification tests",
    "include comparisons to analytics ( good for testing specific pieces of physics ) , convergence studies , and comparisons to other codes .",
    "code comparison is the only true way to test a code s validity on a complex problem .",
    "this mode of code verification fails if the codes in the comparison problem get the same erroneous result because of different weaknesses in the different codes .",
    "although such coincidencies are not unheard of , they are rare in code comparisons we have modeled .",
    "the snsph code has already been tested in many of the previous papers using this code .",
    "fryer & warren ( 2002 ) presented a code - comparison test comparing the 3-dimensional results of the newly developed snsph code to the 2-dimensional results from the code described in herant et al.(1994 ) .",
    "the techniques in both these codes are similar , but the codes themselves are very different .",
    "glaring differences due to coding errors would likely have been caught .",
    "we are also conducting a detailed comparison of rayleigh - taylor and richtmeyer - meshkov instabilities between snsph and the rage adaptive mesh refinement ( fryer et al .",
    "we have also run precessing disk calculations ( rockefeller et al .",
    "2005c ) , comparing the results to both analytical estimates and past sph calculations ( nelson & papaloizou 2000 ) testing angular momentum transport in the code .",
    "another test of the angular momentum run by fryer & warren ( 2004 ) is discussed in more detail in  [ sec : angm ] .    here",
    "we present five additional tests of our code to try to cover some of the more important pieces of physics for core - collapse supernovae .",
    "we use the same code for all five tests and the code was not fine - tuned to produce better results for any specific test .",
    "two of these calculations test shocks : a sedov blast wave and a more complex set of shocks using the galactic center as an experimental test .",
    "the sedov blast wave has an analytic solution and our code can be tested to high precision .",
    "but nature is more complex , and the galactic center experiment allows us to test how our code models complex shock structures , albeit with much less precision than our simple test . if the effects of standing accretion shocks are as critical as some in supernova believe ( blondin et al .",
    "2003 ; burrows et al . 2005 ) , these may be the most important tests for the supernova problem .",
    "issues in the gravity algorithm have also led to many erroneous results in core - collapse calculations .",
    "to test gravity in the code , we have run an adiabatic collapse calculation and a binary orbit calculation .",
    "the binary orbit calculation can also be used to test angular momentum conservation . in the binary calculation subsection",
    ", we also describe techniques in sph to test the amount of numerical angular momentum transport .",
    "lastly , we have run a check of our neutrino diffusion algorithm .",
    "these tests do not cover all the physics necessary for this calculation and it is important to continue to search for ideal tests for core - collapse supernovae . but",
    "these five tests provide a basis by which we can test a range of the important physics necessary to model stellar collapse as well as many other astrophysically - relevant problems .",
    "the sedov - taylor blast wave problem was first discussed by sedov ( 1982 ) and taylor ( 1950 ) ; sedov ultimately developed an analytic solution to the problem .",
    "an amount of energy @xmath138 is deposited at time @xmath139 into a small volume at the center of a uniform - density , low - pressure medium ( density @xmath140 and specific internal energy @xmath141 in our test ) with a gamma - law equation of state @xmath142 where @xmath143 , the ratio of specific heats in the medium , is chosen to be @xmath144 .",
    "the deposited energy heats the gas and drives a spherical shock wave outward through the medium .",
    "the radius of the blast wave @xmath145 evolves according to the equation @xmath146 where @xmath147 is the time elapsed since the explosion and @xmath148 is a function of the ratio of specific heats .",
    "the density , pressure , and radial velocity behind the shock evolve self - similarly according to @xmath149 where @xmath150 and @xmath151 are the density and pressure of the ambient medium and @xmath152 , @xmath153 , and @xmath154 are all functions of @xmath155 .",
    "the simplicity of the initial conditions and the existence of an analytic solution make the sedov - taylor problem one of the most frequently - used tests of a code s ability to model strong shocks .",
    "figure  [ fig : sedov ] shows the angle - averaged density , velocity , and pressure profiles taken at time @xmath156 from two sedov explosions simulated using sph .",
    "the two simulations differ only in the specific arrangement of particles used for the initial conditions ; both sets of initial conditions were constructed from concentric spherical shells of particles , but the simulation shown in the right - hand plot had an inner shell radius ten times smaller than the inner shell radius used in the left - hand simulation .",
    "each circle represents the mass - weighted mean flow quantity and location of particles in a single radial bin ( where the width of each bin is 0.01 ) .",
    "the error bars indicate one ( mass - weighted ) standard deviation around the weighted mean .",
    "the blue line indicates the analytic solution .",
    "part of the scatter in the particle densities and pressures at a given radius arises from uncertainties in the initial density profile .",
    "one drawback of sph is that there is an intrinsic scatter in the density because of the dependence and variability of the smoothing length .",
    "even if we fine - tune the initial model , the scatter will develop after a few timesteps .",
    "this scatter places a low - level perturbation to seed any convection . in most past simulations by snsph , this scatter had a 1-sigma error of 10% in the density .",
    "although we now can reduce this scatter somewhat , it is still an issue with snsph calcuations . in stellar collapse",
    ", it is likely that the explosive burning just prior to collapse produces density perturbations at this level .",
    "if anything , the 10% scatter in our sph set - up is on par with what we expect to be the true initial conditions .",
    "we have run calculations with a factor of 2 larger scatter , and it did not alter our convection or mixing results in the explosion calculation .",
    "the two simulations also illustrate the effect of different initial particle arrangements on flow quantities throughout the simulation . decreasing the radius of the innermost shell of particles results in a pressure profile that more accurately matches the analytic solution behind the shock front .",
    "additionally , the density profile in the left - hand simulation falls slightly below the analytic value , while the density in the right - hand simulation is slightly higher than the analytic value .",
    "this variation demonstrates the sensitivity of sph to the initial arrangements of particles in a simulation and emphasizes the importance of carefully constructing and testing sets of initial conditions .    from these calculations",
    ", we see that the sph calculation produces fairly accurate shock velocities , but densities and pressures that are low ( although the shock entropy is more accurate ) .",
    "these errors decrease with resolution but , in most of our core - collapse simulations , we have not yet reached a satisfactory convergence on the shock modeling .",
    "a more realistic , but less standard , test would have a shock traverse a density gradient instead of a constant density profile .",
    "fryer et al .",
    "( 2006 ) compares the results of such a test for a number of coding techniques , including this snsph code .",
    "the sedov blast wave tests a single , spherically - symmetric strong shock . in a grid code , such a test calculation can be easily fine - tuned by using a spherically symmetric grid and using solvers that assume that the shock front will be parallel to the grid .",
    "unfortunately , the supernova problem does not have such a well - defined shock and fine - tuning the solver for a parallel grid may well give a worse answer for the specific case of stellar collapse .    devising a test for more chaotic shocks is difficult .",
    "few have analytic solutions .",
    "instead we present here an experimental test .",
    "the x - ray emission in the galactic center has been recently studied in detail by the chandra x - ray observatory .",
    "this x - ray emission is dominated by a point source sgr a@xmath157 , believed to be a @xmath158m@xmath159 black hole ( see ghez et al .",
    "2005 , although rockefeller et al .",
    "2004 used a @xmath160m@xmath159 black hole ) accreting the gas around it .",
    "but there is also a diffuse x - ray component which is believed to be produced by colliding gas in the galactic center .",
    "this gas arises from stellar winds from 25 wind - producing stars .",
    "since the x - ray emission is proportional to the square of the density of the gas , it is an ideal probe of the shocks in this system . as with any experimental test , there are uncertainies both in the initial conditions , the relevant physics , and the final measurement .",
    "let s consider both of these sets of uncertainties .    the initial conditions for this problem consist of 25 mass - losing stars ( the contribution by the other stars near the galactic center is negligible ) .",
    "indeed , most of the wind matter arises from the 7 strongest wind sources .",
    "table [ tab : gc ] ( from rockefeller et al .",
    "2004 ) gives the positions , wind velocities , and mass - loss rates for all of these stars .",
    "although the x and y ( projected ) positions are fairly well - known , the z ( radial ) positions are completely unknown .",
    "rockefeller et al . (",
    "2004 ) found that taking extreme positions for the coordinates of these wind sources led to 15% variation in the x - ray flux .",
    "the other uncertainties lie in the wind velocities and mass - loss rates of each of these stars . those stars for which we have observations of the he i line emission have wind velocities that are known , but for many stars , the wind velocities and their associated mass - loss rates are merely estimated ( see rockefeller et al .",
    "2004 for details ) . however , the total mass lost in winds as well as the wind structure of the 7 dominant mass - losing stars are better constrained , so despite uncertainties in some of the stars , these initial wind conditions appear sufficiently constrained to use this experiment . and with time , these initial conditions will only become better known .",
    "the relevant physics for this problem is fairly straightforward .",
    "the equation of state is accurately modeled by an ideal gas with a @xmath161 power law .",
    "the gravitational force is dominated by the central black hole ( see rockefeller et al .",
    "2004 for details ) .",
    "it is unlikely that global magnetic fields will be sufficiently strong to play a role in the diffuse x - ray emission ( although they may effect the x - ray emission from the point source ) . at the temperatures and densities that these shocks produce , the dominant components of the continuum emissivity are electron - ion ( @xmath162 ) and electron - electron ( @xmath163 ) bremsstrahlung ( rockefeller et al .",
    "2004 used the standard simplified representations for these emission processes ) .",
    "the only other physics that need be considered is the possibility of surrounding molecular clouds which confine the wind material .",
    "but these clouds mostly affect the spatial distribution of the x - ray emission .",
    "this effect is limited to the low - level contours of the x - ray emission , and hence does not effect the total x - ray emission considerably .",
    "the strongest observational constraint we can currently apply from the galactic center is the total diffuse x - ray luminosity .",
    "observations currently place this luminosity at @xmath164 . in principal",
    ", the x - ray contours can be used as a constraint , but the low - level contours are very sensitive to the positions of the stars and the structure of the surrounding gas . at this time , more detailed tests of this multi - shock problem are best limited to code comparisons .",
    "we provide 3-dimensional density and energy plots on our website ( http://qso.lanl.gov/@xmath13clf/codetest ) for comparison .      the adiabatic collapse of an initially isothermal spherical cloud of gas has been used in several investigations of sph codes with gravity ( steinmetz & mller 1993 ; thacker et  al . 2000 ; springel et  al .",
    "2001 , wadsley et  al . , 2004 ) .",
    "we follow the units used in the first presentation of this problem ( evrard , 1988 ) . with @xmath165 ,",
    "the initial density distribution is : @xmath166 where @xmath12 is the total mass of the system within the cut - off radius @xmath145 .",
    "the initial internal energy of the system is chosen as @xmath167 , with the adiabatic index @xmath168 .",
    "the initial physical density distribution was applied to a grid with hexagonal symmetry using the technique of davies , benz & hills ( 1992 ) .",
    "the gravitational potential was smoothed with a plummer softening of 0.01 r ( plummer 1911 ) .",
    "the sph kernel was initially set to give roughly 60 neighbors for each particle , and the sph smoothing length was allowed to evolve within the constraints of @xmath169 and @xmath170 .",
    "we show results for simulations with 47,000 particles , and with 864,000 particles in figure  [ fig : t_vs_e ] .",
    "the 864k simulation conserves total ( kinetic + internal + potential ) energy to the 1% level at t=2.1 using 1475 timesteps .",
    "the 47k simulation conserves total energy to 1.2% at t=3.0 using 600 timesteps .",
    "our version of sph gives very similar results to the version of sph presented in steinmetz & mller ( 1993 ) .",
    "as we increase resolution , our solution approaches the solution from their 1-dimensional ppm simulation which has a much higher effective resolution per dimension .",
    "one of the true strengths of the sph method is that it can conserve both linear and angular momentum at the same time .",
    "this feature makes sph an ideal technique in modeling binary interactions and rotation in core - collapse calculations .",
    "however , even though sph conserves angular momentum between particle interactions and hence is globally conserved , a code may still numerically transport that angular momentum and one must test both the conservation and artificial transport before running simulations that depend heavily on angular momentum . in this subsection , we will focus on a test to determine the level at which angular momentum is conserved in our sph code .",
    "we first show how the sph equations lead to angular and linear momentum conservation . to test the actual application of these equations ,",
    "we follow the evolution of a close binary system for over 15 orbits .",
    "this test allows an ideal measurement of the angular momentum conservation in a system .",
    "we end with a discussion of methods to test the importance of numerical angular momentum transport .",
    "angular momentum is conserved by noting that the forces are always directed along a line joining the particle pairs ( eq . [ eq : momcons ] ) .",
    "recall that the torque on a given particle @xmath40 by particle j is @xmath171 where @xmath172 is the vector from a reference point to particle @xmath40 and @xmath173 is the force on particle @xmath40 due to particle @xmath34 .",
    "figure [ fig : pair ] shows our particle pair . because the acceleration of our particles is along the line joining these particles , the torque on any two particles are equal in magnitude , but opposite in sign , balancing each other and leading to angular momentum conservation : @xmath174 where we have used from equation [ eq : momcons ] the relation @xmath175 .",
    "the sph equations strictly conserve linear and angular momentum .    to test how well such a formulism works in an applied problem",
    ", we consider the problem of a binary system in an extremely close orbit .",
    "we use two equal - massed stars with a semi - major axis of @xmath176 .",
    "the initial stars were evolved for the equivalent of 6 orbits as single stars before being placed into this binary system .",
    "these two single stars were then placed in a close orbit around each other with spin periods set to the orbital period .",
    "this close orbit was chosen to study the angular momentum conservation in an extreme situation , but bear in mind that the stellar radius is roughly 20% larger than its roche - radius , so as time proceeds , the stars will gradually lose matter .",
    "but since we run our simulations only for 18 orbits , we shall see that this is only a large effect at late times .",
    "such a binary test simulation , but under less extreme orbital conditions , has been done with grid - based codes ( e.g. motl , tohline , & frank 2002 ) and we compare , where possible , with these simulations .",
    "[ fig : partp ] shows a slice ( @xmath177 code units ) in particle distribution for our binary system at 6 different times ( roughly corresponding to the same point in the orbit except for the last time which corresponds to our final time dump ) .",
    "no particles leave the system ( all particles remain bound to their star ) .",
    "however , because they are both overfilling their roche - radius , the stars slowly expand with time , preferentially building up mass at the l1 lagrange point . fig .",
    "[ fig : angm ] shows the angular momentum as a function of time ( bottom ) and the orbital radius as a function of time ( top ) for the binary .",
    "the orbital radius oscillates because of a slight error in our choice of the orbital velocity in the initial condition .",
    "as we shall see , this ultimately causes the code to break .",
    "as we are using our tests to find weaknesses in the code , we believe this initial deviation from a circular orbit a nice additional test to the code .",
    "in addition , the orbital serpartion drops by nearly 1% after 18 orbits .",
    "this is mostly because material is piling up at the l1 point , causing the mass - weighted center of the stars to move slightly toward that lagrange point .",
    "the orbital angular momentum remains much better conserved , deviating by only 0.01% after 15 orbits .",
    "this occurred with fairly lenient error tolerances on our mac and no tuning of the code to address this problem .",
    "the lack of angular momentum conservation is a result of the distortion in the stars coupled to the lenient tolerances on the mac ( leading to growing errors in the gravitational acceleration ) .",
    "a circular orbit initial condition , or more stringent mac tolerances could reduce this error . in comparison , the tuned simulations",
    "( the best we have seen thusfar by grid codes ) by motl et al . ( 2002 ) using grid methods found deviations of nearly 0.08% after only 5 orbits !    but",
    "not all of the expansion of the star is due to roche - lobe overflow .",
    "the tidal forces in this problem lead to friction that , with our artificial viscosity , causes the star to heat up and expand .",
    "this numerical artifact of codes with artificial viscosity leads to poor energy conservation .",
    "many fixes exist ( balsara 1995 ; owen 2004 ) , but in most of the problems we have study , shocks develop quickly and are fairly extensive . for such problems with widespread shocks",
    ", these fixes do not seem to make a noticeable difference in the simulation and we do not include these techniques in any of the current simulations done with this code .",
    "figure [ fig : energy ] shows the absolute value of the energy components as a function of time in units of the total energy .",
    "the potential ( dotted line ) and , because the stars are bound , the total ( solid ) energies are negative . the magnitude of the total , potential , and thermal energy all decrease with time because of the expansion of the stars . the kinetic energy , the primary diagnostic of the orbits , remains relatively constant ( which is a simple reflection of the conserved angular momentum and the rough conservation in the orbital radius ) . because of the high artificial viscosity in this simulation , the system gains 10% of its total energy after 10 orbits , and another 15% after 18 orbits .",
    "the artificial viscosity terms were reduced slightly from our standard set : @xmath178 , but varying this value did not change our momentum conservation noticeably . at the expense of shock modeling , we could decrease the artificial viscosity to reduce the errors in the energy conservation .    the artificial viscosity in sph , acting like any viscosity ( real or numerical ) , leads also to angular momentum transport .",
    "fryer & warren ( 2004 ) worried about this specific effect in their collapse calculations of rotating supernovae .",
    "fortunately , numerical viscosity can be controlled and its effects can be understood .",
    "figure [ fig : angtra ] shows the angular momentum profile versus mass ( top ) for a standard model ( 1 million particles - solid line ) , a model with high resolution ( 5 million particles - dashed line ) and a module with the artificial viscosity reduced by a factor of 10 ( dotted line ) . the high resolution and reduced viscosity simulations",
    "reduce the effect of numerical angular momentum transport ( in the reduced viscosity simulation , by nearly a factor of 10 ) .",
    "the bottom panel of figure [ fig : angtra ] shows the ratio of angular velocities of the two modified simulations with respect to the standard simulation .",
    "what we find is roughly 20% more angular momentum in the core . with our extreme reduction in viscosity",
    ", this corresponds to the maximum errors in the angular momentum transport caused by numerical viscosity .",
    "this result eased the concerns fryer & warren ( 2004 ) had regarding the effects of numerical viscosity on the angular momentum transport in their collapse calculations .",
    "both the conservation and numerical transport of angular momentum must be studied when modeling rotating systems . in most cases ,",
    "snsph exhibits very few numerical errors with angular momentum and is an ideal technique for rotating problems .",
    "the flux - limited diffusion scheme described in  [ code : radtran ] follows the radiation diffusion between a particle and all of its sph neighbors .",
    "this scheme , originally developed by herant et al .",
    "( 1994 ) , uses the neighbor list generated to evaluate sph forces and can be parallelized using the same techniques used to parallelize sph .",
    "its major limitation on the scalability arises from converting from the flux - limited diffusion algorithm to the free - streaming solution . at this point , a global sum must be made over all processors , placing a synchronization point in the code .",
    "but , in general , it is both fast and easy to implement .    testing radiation transport schemes in general would , and has , comprised many papers in itself . here",
    "we focus on a simple test comparing the sph flux - limited scheme to a 1-dimensional grid - based flux - limited transport scheme .",
    "this test does not prove the applicability of flux - limited diffusion to the supernova problem , but it does show that our scheme for putting flux - limited diffusion into sph does work .    for the initial conditions of this test , we use a spherically - symmetric neutron star atmosphere ( material below @xmath179g@xmath180 ) for a neutron star roughly 130ms after bounce .",
    "we map this structure onto our sph particles , setting up the particles in a series of spherical shells .",
    "the shells are produced by placing particles randomly on a sphere and using repulsive forces to evenly separate these particles within a predetermined tolerance .",
    "we make a similar setup in a 1-dimensional grid using one zone per shell of sph particles . with this setup ,",
    "we minimize the differences between the density and temperature structure of our 1- and 3-dimensional models .",
    "we determine the trapping radius to be 25 km .",
    "below this radius , we set the electron neutrino fraction ( @xmath181 ) to 0.15 with a mean energy of 10mev . above this radius , @xmath181 is set to zero .",
    "our test focuses on the neutrino transport alone ; we evolve only the electron neutrino fraction with time and hold the density , temperature , and electron fraction fixed .",
    "we allow no new neutrino emission .",
    "the flux arising from our neutrino trapping radius versus time for both our 1-dimensional grid simulation and our 3-dimensional sph calculation is plotted in figure [ fig : nulum ] .",
    "the initial flux of the sph calculation is higher , since the neighbors of any particle extend beyond the equivalent of an adjacent cell for the 1-dimensional calculation . in general , the luminosity for both these calculations agree to better than 3% .",
    "more detailed tests are required to truly trust this transport scheme .",
    "sufficiently complex tests can not be solved analytically and we are currently developing a set of comparison calculations using monte carlo ( with its well - defined errors ) as a solution ( hungerford et al .",
    "the snsph code is built upon the parallel tree code of warren & salmon ( 1993,1995 ) .",
    "this code has proven extremely portable and scalable ( beyond 1000 processors ) on a number of computer architectures from large supercomputers  the advanced simulation and computing program ( e.g. red , pink , q ) and national energy research scientific computing center ( e.g. seaborg )  to local beowulf clusters  e.g. space simulator . snsph uses the benz version ( benz 1989 ) of smooth particle hydrodynamics to model the euler equations . a number of equations of state have been implemented to close these equations , from ideal and perfect gas equations of state to planetary equations of state ( benz , slattery , & cameron 1986 ) to the equation of state cocktail used to model core - collapse ( herant et al . 1994 ) .",
    "snsph also includes an explicit flux - limited diffusion scheme to moderate neutrino transport ( herant et al .",
    "1994 , fryer & warren 2002 ) .",
    "this transport scheme is even now being modified to model photon transport .",
    "although the focus of snsph has been to study stellar collapse ( fryer & warren 2002,2004 ; fryer 2004 ) it has also been adapted to model stellar explosions ( hungerford et al .",
    "2003 , 2005 ) and the galactic center ( rockefeller et al .",
    "2004 , 2005 ) with a list of ongoing projects that spreads even further to planet formation and cosmology .",
    "but , as with any computational technique , this code has both advantages and disadvantages .",
    "we have presented a number of tests of this snsph code .",
    "these test problems go beyond the standard `` shock '' tests ( sedov , sod problem , shock tube ) common in most test suites and include tests of the broad range of physics modelled in core - collapse .",
    "our tests mark just the beginning set of tests snsph must pass if it is to become a multi - purpose radiation hydrodynamics code .",
    "even so , we can already outline the strengths and weaknesses of the snsph technique .",
    "the particle based scheme allows modellers to preserve many advantages of a lagrangian scheme in turbulent flows where typical grid - based lagrangian cells become tangled .",
    "we have shown that the hydrodynamics scheme conserves both total energy and momentum .",
    "our scheme is easily modified to include a wide variety of equations of state and external forces and the transport scheme can be modified to model the transport of photons as well as neutrinos .",
    "the advantages include :    * lagrangian technique allows the resolution to follow the mass .",
    "this is ideal for problems that cover a large range of spatial scales , but that focus the mass in one place ( e.g. supernova explosions ) .",
    "it is also ideal for problems where the area of interest moves with time ( e.g. in neutron star kicks and in binaries ) .",
    "* the lagrangian scheme also avoids any numerical diffusion ( either heat or elemental abundances ) that plague any euler scheme during the advection step .",
    "such artificial diffusion can lead to disastrous results in problems where the abundances must be tracked exactly ( e.g. nucleosynthesis issues in supernova explosions ) and abundance gradients are large .",
    "the same is true for problems where the temperature gradient is large .",
    "* sph conserves angular momentum and linear momentum at the same time . * the explicit flux - limited diffusion transport scheme scales well ( for transport schemes ) .      *",
    "sph initial conditions tend to have small perturbations on the 5 - 10% level that will artificially seed convection .",
    "such perturbations are difficult to reduce completely and their effects must be understood when interpreting simulation results . * the artificial viscosity term added to model shocks does not work as well as riemann methods when the shock moves along the grid . however , when the shock is not so well behaved , we believe ( and propose a test for comparison ) that sph behaves as well as most grid codes .",
    "the artificial viscosity also leads to both an artificial angular momentum and artificial heating term . in shear flows",
    ", such numerical effects can lead to unrealistic heating .",
    "we have shown ( fryer & warren 2004 ) that this is not an issue for even our fast - rotating supernova cores .",
    "* transport schemes are generally designed for grid - based codes . the flux - limited transport scheme in this code works at a basic level , but more sophisticated schemes have not been incorporated into sph , and much more work must be done to prove that more sophisticated schemes can be added smoothly .    no code is ideal for all problems . without the development of a more sophisticated transport scheme for sph ( whether it be a direct discretization method such as @xmath182 or a monte - carlo technique ) , our snsph code will not be able to model the detailed neutrino transport many believe is necessary to get a final solution to the core - collapse supernova problem .",
    "new transport schemes applicable for sph are being pursued and the current dearth of schemes may not prove a long - term limitation .",
    "there are many problems that are most easily solved with a lagrangian technique : from supernova explosions to binary mergers to galaxy collisions .",
    "snsph is ideally suited for these problems and has the versatility to adapt to these problems quickly . with other problems , such as black hole accretion disks , the gas accretion during the formation of jovian planets or the complex shock structure in the galactic center",
    ", snsph has its advantages and disadvantages over grid - based codes .",
    "snsph is a powerful tool in developing a solution to these outstanding astrophysical problems .",
    "* acknowledgments * this work was funded under the auspices of the u.s .",
    "dept .  of energy , and supported by its contract w-7405-eng-36 to los alamos national laboratory , by a doe scidac grant number de - fc02 - 01er41176 and by nasa grant swif03 - 0047 - 0037 .",
    "the simulations were conducted on the space simulator and asc pink at los alamos national laboratory .",
    "irs 16ne & @xmath1832.6 & 0.8 & 2.2 & 6.8 & 550 & 9.5 + irs 16nw & 0.2 & 1.0 & @xmath1838.3 & @xmath1835.5 & 750 & 5.3 + irs 16c & @xmath1831.0 & 0.2 & 4.5 & 2.1 & 650 & 10.5 + irs 16sw & @xmath1830.6 & @xmath1831.3 & @xmath1832.5 & @xmath1831.2 & 650 & 15.5 + irs 13e1 & 3.4 & @xmath1831.7 & @xmath1830.3 & 1.3 & 1,000 & 79.1 + irs 7w & 4.1 & 4.8 & @xmath1835.5 & @xmath1832.8 & 1,000 & 20.7 + af & 7.3 & @xmath1836.7 & 6.2 & @xmath1831.2 & 700 & 8.7 + irs 15sw & 1.5 & 10.1 & 8.7 & 0.3 & 700 & 16.5 + irs 15ne & @xmath1831.6 & 11.4 & 0.7 & @xmath1831.1 & 750 & 18.0 + irs 29n & 1.6 & 1.4 & 8.3 & 3.2 & 750 & 7.3 + irs 33e & 0.0 & @xmath1833.0 & 0.6 & 6.0 & 750 & 7.3 + irs 34w & 3.9 & 1.6 & 4.0 & @xmath1834.8 & 750 & 7.3 + irs 1w & @xmath1835.3 & 0.3 & @xmath1830.2 & @xmath1834.5 & 750 & 7.3 + irs 9nw & @xmath1832.5 & @xmath1836.2 & @xmath1833.5 & @xmath1834.1 & 750 & 7.3 + irs 6w & 8.1 & 1.6 & 3.1 & @xmath1830.4 & 750 & 7.3 + af nw & 8.3 & @xmath1833.1 & @xmath1830.1 & @xmath1832.4 & 750 & 7.3 + blum & 9.2 & @xmath1835.0 & @xmath1834.1 & 0.2 & 750 & 7.3 + irs 9s & @xmath1835.5 & @xmath1839.2 & @xmath1835.9 & @xmath1830.3 & 750 & 7.3 + unnamed 1 & 1.3 & @xmath1830.6 & @xmath1835.4 & 5.5 & 750 & 7.3 + irs 16se & @xmath1831.4 & @xmath1831.4 & @xmath1838.1 & @xmath1835.7 & 750 & 7.3 + irs 29ne & 1.1 & 1.8 & 3.1 & @xmath1833.1 & 750 & 7.3 + irs 7se & @xmath1832.7 & 3.0 & 2.3 & @xmath1835.4 & 750 & 7.3 + unnamed 2 & 3.8 & @xmath1834.2 & @xmath1838.5 & 4.5 & 750 & 7.3 + irs 7e & @xmath1834.2 & 4.9 & 8.6 & 1.3 & 750 & 7.3 + af nww & 10.2 & @xmath1832.7 & @xmath1831.9 & 3.9 & 750 & 7.3 +"
  ],
  "abstract_text": [
    "<S> we provide a description of the snsph code  a parallel 3-dimensional radiation hydrodynamics code implementing treecode gravity , smooth particle hydrodynamics , and flux - limited diffusion transport schemes . </S>",
    "<S> we provide descriptions of the physics and parallelization techniques for this code . </S>",
    "<S> we present performance results on a suite of code tests ( both standard and new ) , showing the versatility of such a code , but focusing on what we believe are important aspects of modeling core - collapse supernovae . </S>"
  ]
}