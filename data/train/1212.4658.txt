{
  "article_text": [
    "the first tests with a virtual host ( vm ) based scientific computing environment were performed at the laboratori nazionali del gran sasso ( lngs ) around the second half of year 2008 .",
    "starting from year 2010 the it department staff has been working at the development of a vm based computer cluster to be used by the local experimental collaborations for their computational needs .",
    "a constraint was set to only employ open source software tools for every aspect of the cluster management .",
    "+ the aforementioned computing facility is in production at lngs since july 2011 as part of u - lite ( unified lngs it environment ) , a broader project that aims at creating an integrated it infrastructure that can be used to manage the whole life cycle of data produced by lngs experiments : storage and backup , long term archiving , distribution over the network , plus data analysis and detector simulation . + the u - lite computing cluster must be able to dynamically provide computing resources in the form of virtual hosts in response to user requests that come in the form of jobs submitted to a batch queue system .",
    "the same hardware infrastructure must be used by different workgroups , each running its jobs on a customized software platform - vms cloned from a dedicated template - and sharing fairly and efficiently a limited set of computing resources .",
    "+ the u - lite computing cluster was designed to meet the very specific requirements of a restricted community of researchers , with no plan to be distributed outside lngs , nevertheless we think that the approach we adopted can be of interest for persons involved in host virtualization for hpc and htc computing . +",
    "the u - lite computing cluster is made of a relatively small number of heterogeneous multicore computers running the debian based proxmox ve virtualization platform and using the kvm hypervisor .",
    "the only function of the physical servers is to provide hardware resources for the vms they house .",
    "+ the cluster computers intercommunicate on a dedicated lan that has a gateway towards the outside world and are connected via an iscsi san to a shared storage system that serves vm images ( figure  [ fig : storage layout ] ) .",
    "+ all vms are clones of a limited number of templates , each template being set up for a project or for a workgroup .      the storage area that contains vm images is shared among all the cluster computers , vm images are stored as lvm logical volumes and are available to all the cluster computers as well .",
    "this means that the migration of a vm from one server to another is always possible and , if it is powered off , it only requires the few seconds needed to transfer the vm configuration file from the source server to the destination .",
    "+ this storage setup is very flexible and allows for very fast vm provisioning but it is not the one that offers the best performances as far as disk i / o is concerned .",
    "a few points must be taken into account , though :    vm images are only used to load the os and sometimes the applications to be run .",
    "apart from this the i / o activity towards the system disk is very limited .",
    "i / o is usually performed over network file systems ( nfs and afs ) . the computing cluster lan bandwidth and the bandwidth of the uplink towards the lngs lan",
    "are critical for i / o performance .",
    "a storage area that is local to the hosting server can be created and mounted on a vm at boot time and destroyed when the vm is powered off .",
    "this storage area is available as a relatively high performance , temporary data buffer .",
    "one disadvantage of keeping all vm images within the same storage system is that it can become a single point of failure .",
    "using a raid storage with redundant controllers and power supplies reduces the risk of failure of the vm repository .",
    "different storage architectures deploying higher availability standards might be investigated .",
    "each server belonging to the computing cluster provides hardware resources to be allocated and used by vms .",
    "these resources are :    ram ;    cpu cores ;    local disk space for temporary data storage .",
    "a server usually makes all its cpu cores available for vm hosting as well as a configurable portion of a local disk and almost all of its ram , reserving a relatively small amount of it ( 512 mb or 1 gb are reasonable values ) for processes running on the server os itself . + vm slots are an extra resource type , not strictly related to the server hardware , that could be used to limit the number of vms to be run on a single server .",
    "the vm slot number ( which can be chosen arbitrarily ) associated to each server represents the maximum number of vms it should host .",
    "+ each running vm allocates a configurable quantity of ram , a configurable number or cpu cores and optionally some local disk space .",
    "besides that , it occupies one vm slot on the hosting server .",
    "a vm can only be started on a server if the latter has enough resources available among those dedicated to vm hosting .",
    "job submission is performed through a traditional batch queue system based on the torque software for job delivery and on the maui scheduler for a fair and balanced sharing of resources . + a third software element , called crm , was developed at lngs .",
    "crm collects information from the physical servers , from the proxmox ve cluster management system , from the torque server and from the maui scheduler and operates with the goal of providing the resources requested by users via the batch system and releasing unused resources .",
    "crm acts on vms in the following ways :    it makes running vms available or unavailable to the batch queue system by toggling their offline[multiblock footnote omitted ] flag ;    it powers vms on , optionally migrating them before start - up , or off ;    it deletes vms or creates new ones as clones of an existing template , when necessary .    the torque , maui and crm server processes all run on the same , dedicated host , that can be a vm as well .",
    "as this node is of critical importance for the correct operation of the whole computing cluster , a strong effort has been made to have a replica node that can be activated in a few seconds in case of a planned downtime and activates automatically thanks to an high availability mechanism if the primary node fails .",
    "the takeover procedure does not affect the computing cluster operation and is transparent to users .",
    "resource requests are triggered by users submitting jobs to a batch queue system .",
    "batch job submission is performed using the _ qsub _ command belonging to the torque software suite .",
    "users do not necessarily need to know how hardware resources are accessed , they may very well think to be working on a traditional system where all computing nodes are real computers .",
    "+ the main reason for using different queues is to allow users select the vm type , and thus the software platform , to employ for a specific job .",
    "each batch queue is associated to a single vm type , a group of vms that are clones of the same template .",
    "each vm type can be associated to one or more queues .",
    "usually each vm type and its associated queues belong to a single project or working group , while a single project or working group may own one or more queues and the associated vm types ( figure  [ fig : relationships ] ) .",
    "the use of vms that can be automatically powered on or off gives each user or collaboration the chance of using all the cluster capabilities when needed and allows for quick , automatic reallocation of idle resources .",
    "+      the torque and maui batch job submission tools were developed long before host virtualization took over , so torque and maui were not designed to deal with computing nodes that are not always on - line and with a system that is able to power computing nodes on or off in order to optimize resource usage .",
    "+ also , torque and maui were born in an era where computing resources were scarce and precious , so they were conceived with the idea in mind that jobs must never exceed the maximum cpu time allowed for the queue they run on and that users have to know how long their jobs need to run and submit them to the appropriate queue .",
    "today this scenario is obsolete : jobs must be able to run for as much time as they need to complete successfully and users do not have to worry about the resources their jobs need .",
    "queues are used for selecting the software platform ( vm group ) a job must run on or in order to control the priority a computing job must be assigned .",
    "+ maui is highly configurable and is capable of sophisticated scheduling decisions , particularly in environments where concurrent resource requests must be evenly balanced .",
    "its behavior though can be altered in a situation where only a part of the computing resources seem to be available for job submission .",
    "+ in order to have maui correctly perform resource sharing in such an environment , the status of the computing nodes must somehow be hidden to the scheduler , either by giving to the scheduler the illusion of having infinite resources at its disposal or by disabling all unused resources , checking how the scheduler would prioritize queued jobs , and provisioning vms for the batch system in the same order .",
    "+ the solution that was adopted at lngs is an approximation of the latter .",
    "as briefly mentioned before , crm administers hardware resources by powering vms on or off and migrating them if needed before starting them up .",
    "hot migration of powered on vms towards faster servers has been implemented but it has not been activated in the production environment for the following reasons :    the cpu speed span among the cluster computers is not so high as to justify the activation of such a feature ;    it is quite difficult to define a hot migration algorithm that is able to safely and efficiently optimize resource usage .",
    "hot migration of powered - on vms is not considered reliable enough to be activated in a production environment ( e.g. hot migration of active nodes may fail if the servers software versions are not aligned ) ;    as mentioned earlier , crm does not only turn vms on or off .",
    "a mechanism has been implemented that reduces the computing overhead due to boot and shutdown procedures : vms can be made unavailable / available to the batch queue software by just setting / clearing their offline flag on torque with no need of power them off or on . +",
    "a very important task crm is in charge of is making sure that the resources shared by each physical server are not overbooked .",
    "this means that the total amount of ram , cpu cores and disk space allocated by the vms on a server must never exceed the resources that the server can provide .",
    "it is particularly important that a portion of the server ram is always available for the processes running on its os , otherwise memory swapping may occur , making the server and its vms unusable or even causing processes on the server ( vms are in fact processes on a server ) die for lack of ram space .",
    "+ the computing cluster is not strictly reserved for vms dedicated to batch job processing .",
    "crm will take into account resources allocated by vms not belonging to the batch system but will not modify their status .",
    "the same computing environment can thus be used both for batch job processing and for the delivery of other network services .",
    "whenever a job is submitted it is given by maui a priority which depends on the scheduler setup . at every scheduler iteration ( typically once or twice a minute ) , queued job priorities are updated .",
    "the calculation of job priorities can take into account many parameters and is highly configurable by administrators .",
    "+ at every iteration crm obtains the list of queued jobs , ordered by priority , from the job scheduler and takes care of providing resources according to the list order .",
    "+ in order to optimize the response time to job requests , for each job it processes , crm first checks if there is a suitable running vm and , if it finds one , it clears the vm offline flag thus making it ready to run jobs ( figure  [ fig : toggle offline before ] ) . when the system is idle , or lightly loaded , a job queue time is around 30 to 35 seconds if crm only needs to toggle the vm offline flag .",
    "+ if crm does not find a running vm for the job it is processing , it starts one that is powered off ( figure  [ fig : power on ] ) , given that there are enough available hardware resources on one of the physical servers .",
    "crm optionally migrates each vm , before starting it , towards the fastest server , in terms of cpu frequency , that has enough resources to host it .",
    "the total sum of cpu cores allocated by the vms should never exceed the total number of cpu cores mounted on the server they run on .",
    "the computing resources required by the guest os are considered negligible .",
    "if , due to a clumsy manual intervention , the number of cpu cores allocated by the vms should exceed the total number or cpu cores of the server the only consequence will be a non - optimal resource usage .    the total quantity of ram allocated by vms should always be less than the total quantity of physical ram mounted on the server .",
    "it is very important that a reasonable quantity of ram is reserved for the processes running on the guest server os , otherwise it may start using the swap area on disk and start performing unacceptably slow together with the vms it hosts .    the total quantity of disk space , if any , allocated by vms should never exceed the size of the partition dedicated to this purpose .",
    "the system partition should not be used for disk images .    in the case crm",
    "needs to power on a vm before a queued job can be started , and in case of low cluster load , the job queue time is around 90 to 120 seconds .",
    "+ if there is no suitable vm on the system , there are enough available hardware resources on the computing cluster , and there is enough disk space on the storage system dedicated to hosting vm images , crm can create one from an existing template .",
    "in this case the job queue time depends on the size of the vm image and may range from 5 to 15 minutes .",
    "+ if the storage area that holds vm images is large enough compared to the cluster size , the creation and/or destruction of a vm is expected to be a rare event .        [ cols=\"<,<\",options=\"header \" , ]              whenever a job starts on a vm , crm marks the latter offline for the batch job scheduler .",
    "this means that the vm is not available for new jobs to run .",
    "when the job ends the vm remains powered on but with the offline flag set ( figure  [ fig : toggle offline after ] ) .",
    "+ if there are queued jobs requiring a different vm type , idle vms may be powered off ( figure  [ fig : power off ] ) in order to release resources ( cpu cores , ram , local disk space ) and may be destroyed if there is need of disk space for new vms on the dedicated storage area .",
    "+ if there are unused vms running , a few of them can be powered off or destroyed in order to free a configurable amount of ram , number of cpu cores and disk space with the goal of improving the system response time when jobs requiring nodes that are powered off will be queued .",
    "+ crm also employs a mechanism by which it powers off the first vm that becomes idle on a server that , for any reason , has been overbooked .",
    "the mechanism for administering hardware resources described in the previous paragraphs has been designed so that it does not influence the job scheduling process .",
    "resource sharing among users or working groups is always in full control of the scheduler .",
    "+ the model just described has been extended to cope with different needs and to optimize resource usage .",
    "part of the computing nodes , be they vms or real computers ( with no virtualization support activated ) can be configured to never have their offline flag set , never be powered off , and always be ready to accept jobs .",
    "this allows working groups to have a set of resources reserved for their needs and always ready for use .",
    "it also allows working groups to integrate those hardware resources that for some reason can not be used for host virtualization into the common computing environment .",
    "the computing capabilities of each vm can be extended by increasing the number of cpu cores ( and ram size accordingly ) assigned to it .",
    "this feature has quite important implications that are better described in the next section .",
    "enabling multicore vms has some evident advantages :    multiple jobs can run on the same vm concurrently ;    multi processor and parallel jobs are supported ;    less disk space must be allocated to vm images on the dedicated storage area ;    the cpu , memory and network overhead due to running operating systems and system services is reduced ;    on the other hand , the fact that a vm can run multiple jobs concurrently has a negative impact on the granularity of the resource sharing mechanism .",
    "suppose that the vms associated to a certain queue are configured to start with 4 cpu cores and that one of them is started in order to provide resources for one single processor job .",
    "should crm flag the node offline after the first job starts running , three cpu cores would be unavailable to the batch system and resource utilization would be far from optimal .",
    "presently crm does not flag vms offline after the start of the first job and the idle cpu cores are allocated to the queue or group of queues the hosting vm is associated to . the resource sharing system may become unbalanced because these computing resources are seen by the batch scheduler as immediately available and the workgroup owning them is privileged in the short term .",
    "+ the maui scheduler can be configured so to balance resource usage in the medium or long term , but this short term unbalance might still be a problem in periods of high workload . in the worst case , if one workgroup keeps on submitting jobs to its queues not allowing the associated vms to be powered off , jobs belonging to other collaborations may never get the slots they need .",
    "+ one solution would be to only allow jobs to be submitted to a vm for a fixed time window after power on and to set it offline after the end of this time window , regardless of the number of jobs it is running or has run .",
    "this stratagem would avoid starvation of jobs belonging to other queues but would not optimize resource usage .",
    "the code implementing this feature has been written but has not been activated on crm as serious job starvation issues never showed up yet .",
    "the development of the u - lite computing cluster started in 2010 and even though new features and functionalities are still being added , it is today a productive system and the official scientific computing facility at lngs .",
    "its strengths are the exclusive use of open source software , the fast provisioning of computing resources and the transparency from the user point of view .",
    "+ the hardware and software architecture it is based on makes the computing facility best fit for small to medium computing environments .",
    "no critical scalability issues should show up if the cluster was to grow by one order of magnitude in terms of computing capability , although some minor infrastructural and software adjustments might be required , while no prediction has been made on how it would behave and what changes would be required if it was to grow further .",
    "+ a lot of room remains for new features and developments .",
    "items to work on in the future , given the availability of human resources , include :        run time customization of resources in accordance to user requirements ( e.g. a user wants to submit a job to a node with 2 computing cores , 4 gbytes of ram and 20 gbytes of temporary disk space and a dedicated vm is started accordingly ) ;"
  ],
  "abstract_text": [
    "<S> in the last ten years host virtualization has brought a revolution in the way almost every activity related to information technology is thought of and performed . the use of virtualization for hpc and htc computing , while eagerly desired , has probably been one of the last steps of this revolution , the performance loss due to the hardware abstraction layer being the cause that slowed down a process that has been much faster in other fields . </S>",
    "<S> + nowadays the widespread diffusion of virtualization and of new virtualization techniques seem to have helped breaking this last barrier and virtual host computing infrastructures for hpc and htc are found in many data centers . </S>",
    "<S> + in this document the approach adopted at the infn laboratori nazionali del gran sasso for providing computational resources via a virtual host based computing facility is described . </S>",
    "<S> particular evidence is given to the storage layout , to the middleware architecture and to resource allocation strategies , as these are issues for which a personalized solution was adopted . </S>",
    "<S> other aspects may be covered in the future within other documents .    2 </S>"
  ]
}