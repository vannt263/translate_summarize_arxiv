{
  "article_text": [
    "nowcasting convective precipitation has long been an important problem in the field of weather forecasting .",
    "the goal of this task is to give precise and timely prediction of rainfall intensity in a local region over a relatively short period of time ( e.g. , 0 - 6 hours ) .",
    "it is essential for taking such timely actions as generating society - level emergency rainfall alerts , producing weather guidance for airports , and seamless integration with a longer - term numerical weather prediction ( nwp ) model .",
    "since the forecasting resolution and time accuracy required are much higher than other traditional forecasting tasks like weekly average temperature prediction , the precipitation nowcasting problem is quite challenging and has emerged as a hot research topic in the meteorology community  @xcite .",
    "existing methods for precipitation nowcasting can roughly be categorized into two classes  @xcite , namely , nwp based methods and radar echo extrapolation based methods . for the nwp approach , making predictions at the nowcasting timescale requires a complex and meticulous simulation of the physical equations in the atmosphere model .",
    "thus the current state - of - the - art operational precipitation nowcasting systems  @xcite often adopt the faster and more accurate extrapolation based methods .",
    "specifically , some computer vision techniques , especially optical flow based methods , have proven useful for making accurate extrapolation of radar maps  @xcite .",
    "one recent progress along this path is the _ real - time optical flow by variational methods for echoes of radar _ ( rover ) algorithm  @xcite proposed by the hong kong observatory ( hko ) for its _ short - range warning of intense rainstorms in localized system _ ( swirls )  @xcite .",
    "rover calculates the optical flow of consecutive radar maps using the algorithm in  @xcite and performs semi - lagrangian advection  @xcite on the flow field , which is assumed to be still , to accomplish the prediction .",
    "however , the success of these optical flow based methods is limited because the flow estimation step and the radar echo extrapolation step are separated and it is challenging to determine the model parameters to give good prediction performance .    these technical issues may be addressed by viewing the problem from the machine learning perspective . in essence ,",
    "precipitation nowcasting is a spatiotemporal sequence forecasting problem with the sequence of past radar maps as input and the sequence of a fixed number ( usually larger than 1 ) of future radar maps as output .",
    "however , such learning problems , regardless of their exact applications , are nontrivial in the first place due to the high dimensionality of the spatiotemporal sequences especially when multi - step predictions have to be made , unless the spatiotemporal structure of the data is captured well by the prediction model .",
    "moreover , building an effective prediction model for the radar echo data is even more challenging due to the chaotic nature of the atmosphere .",
    "recent advances in deep learning , especially recurrent neural network ( rnn ) and long short - term memory ( lstm ) models  @xcite , provide some useful insights on how to tackle this problem . according to the philosophy underlying the deep learning approach ,",
    "if we have a reasonable end - to - end model and sufficient data for training it , we are close to solving the problem .",
    "the precipitation nowcasting problem satisfies the data requirement because it is easy to collect a huge amount of radar echo data continuously .",
    "what is needed is a suitable model for end - to - end learning .",
    "the pioneering lstm encoder - decoder framework proposed in  @xcite provides a general framework for sequence - to - sequence learning problems by training temporally concatenated lstms , one for the input sequence and another for the output sequence . in  @xcite",
    ", it is shown that prediction of the next video frame and interpolation of intermediate frames can be done by building an rnn based language model on the visual words obtained by quantizing the image patches .",
    "they propose a recurrent convolutional neural network to model the spatial relationships but the model only predicts one frame ahead and the size of the convolutional kernel used for state - to - state transition is restricted to 1 .",
    "their work is followed up later in  @xcite which points out the importance of multi - step prediction in learning useful representations .",
    "they build an lstm encoder - decoder - predictor model which reconstructs the input sequence and predicts the future sequence simultaneously . although their method can also be used to solve our spatiotemporal sequence forecasting problem , the _ fully connected lstm _",
    "( fc - lstm ) layer adopted by their model does not take spatial correlation into consideration .    in this paper",
    ", we propose a novel _ convolutional lstm _",
    "( convlstm ) network for precipitation nowcasting .",
    "we formulate precipitation nowcasting as a spatiotemporal sequence forecasting problem that can be solved under the general sequence - to - sequence learning framework proposed in  @xcite . in order to model well the spatiotemporal relationships , we extend the idea of fc - lstm to which has convolutional structures in both the input - to - state and state - to - state transitions . by stacking multiple convlstm layers and forming an encoding - forecasting structure",
    ", we can build an end - to - end trainable model for precipitation nowcasting . for evaluation ,",
    "we have created a new real - life radar echo dataset which can facilitate further research especially on devising machine learning algorithms for the problem . when evaluated on a synthetic moving - mnist dataset  @xcite and the radar echo dataset ,",
    "our convlstm model consistently outperforms both the fc - lstm and the state - of - the - art operational rover algorithm .",
    "the goal of precipitation nowcasting is to use the previously observed radar echo sequence to forecast a fixed length of the future radar maps in a local region ( e.g. , hong kong , new york , or tokyo ) . in real applications ,",
    "the radar maps are usually taken from the weather radar every 6 - 10 minutes and nowcasting is done for the following 1 - 6 hours , i.e. , to predict the 6 - 60 frames ahead . from the machine learning perspective",
    ", this problem can be regarded as a spatiotemporal sequence forecasting problem .",
    "suppose we observe a dynamical system over a spatial region represented by an @xmath0 grid which consists of @xmath1 rows and @xmath2 columns .",
    "inside each cell in the grid , there are @xmath3 measurements which vary over time .",
    "thus , the observation at any time can be represented by a tensor @xmath4 , where @xmath5 denotes the domain of the observed features .",
    "if we record the observations periodically , we will get a sequence of tensors @xmath6 .",
    "the spatiotemporal sequence forecasting problem is to predict the most likely length-@xmath7 sequence in the future given the previous @xmath8 observations which include the current one : @xmath9 for precipitation nowcasting , the observation at every timestamp is a 2d radar echo map .",
    "if we divide the map into tiled non - overlapping patches and view the pixels inside a patch as its measurements ( see fig .  [",
    "fig : img - to - tensor ] ) , the nowcasting problem naturally becomes a spatiotemporal sequence forecasting problem .",
    "we note that our spatiotemporal sequence forecasting problem is different from the one - step time series forecasting problem because the prediction target of our problem is a sequence which contains both spatial and temporal structures .",
    "although the number of free variables in a length-@xmath7 sequence can be up to @xmath10 , in practice we may exploit the structure of the space of possible predictions to reduce the dimensionality and hence make the problem tractable .",
    "for general - purpose sequence modeling , lstm as a special rnn structure has proven stable and powerful for modeling long - range dependencies in various previous studies  @xcite .",
    "the major innovation of lstm is its memory cell @xmath11 which essentially acts as an accumulator of the state information .",
    "the cell is accessed , written and cleared by several self - parameterized controlling gates . every time a new input comes",
    ", its information will be accumulated to the cell if the input gate @xmath12 is activated .",
    "also , the past cell status @xmath13 could be `` forgotten '' in this process if the forget gate @xmath14 is on . whether the latest cell output @xmath11 will be propagated to the final state @xmath15",
    "is further controlled by the output gate @xmath16 .",
    "one advantage of using the memory cell and gates to control information flow is that the gradient will be trapped in the cell ( also known as constant error carousels  @xcite ) and be prevented from vanishing too quickly , which is a critical problem for the vanilla rnn model  @xcite .",
    "fc - lstm may be seen as a multivariate version of lstm where the input , cell output and states are all 1d vectors . in this paper , we follow the formulation of fc - lstm as in  @xcite .",
    "the key equations are shown in   below , where ` @xmath17 ' denotes the hadamard product : @xmath18 multiple lstms can be stacked and temporally concatenated to form more complex structures .",
    "such models have been applied to solve many real - life sequence modeling problems  @xcite .",
    "we now present our convlstm network .",
    "although the fc - lstm layer has proven powerful for handling temporal correlation , it contains too much redundancy for spatial data . to address this problem",
    ", we propose an extension of fc - lstm which has convolutional structures in both the input - to - state and state - to - state transitions . by stacking multiple convlstm layers and forming an encoding - forecasting structure ,",
    "we are able to build a network model not only for the precipitation nowcasting problem but also for more general spatiotemporal sequence forecasting problems .",
    "the major drawback of fc - lstm in handling spatiotemporal data is its usage of full connections in input - to - state and state - to - state transitions in which no spatial information is encoded . to overcome this problem ,",
    "a distinguishing feature of our design is that all the inputs @xmath19 , cell outputs @xmath20 , hidden states @xmath21 , and gates @xmath22 of the convlstm are 3d tensors whose last two dimensions are spatial dimensions ( rows and columns ) . to get a better picture of the inputs and states",
    ", we may imagine them as vectors standing on a spatial grid .",
    "the convlstm determines the future state of a certain cell in the grid by the inputs and past states of its local neighbors .",
    "this can easily be achieved by using a convolution operator in the state - to - state and input - to - state transitions ( see fig .  [",
    "fig : convlstm - structure ] ) .",
    "the key equations of convlstm are shown in below , where ` @xmath23 ' denotes the convolution operator and ` @xmath17 ' , as before , denotes the hadamard product : @xmath24 if we view the states as the hidden representations of moving objects , a convlstm with a larger transitional kernel should be able to capture faster motions while one with a smaller kernel can capture slower motions . also , if we adopt a similar view as  @xcite , the inputs , cell outputs and hidden states of the traditional fc - lstm represented by   may also be seen as 3d tensors with the last two dimensions being 1 . in this sense",
    ", fc - lstm is actually a special case of convlstm with all features standing on a single cell .    to ensure that the states have the same number of rows and same number of columns as the inputs , padding is needed before applying the convolution operation . here ,",
    "padding of the hidden states on the boundary points can be viewed as using the _ state of the outside world _ for calculation .",
    "usually , before the first input comes , we initialize all the states of the lstm to zero which corresponds to `` total ignorance '' of the future . similarly ,",
    "if we perform zero - padding ( which is used in this paper ) on the hidden states , we are actually setting the _ state of the outside world _ to zero and assume no prior knowledge about the outside . by padding on the states",
    ", we can treat the boundary points differently , which is helpful in many cases .",
    "for example , imagine that the system we are observing is a moving ball surrounded by walls .",
    "although we can not see these walls , we can infer their existence by finding the ball bouncing over them again and again , which can hardly be done if the boundary points have the same state transition dynamics as the inner points .",
    "[ fig : convlstm - encoding - forecasting ]    like fc - lstm , convlstm can also be adopted as a building block for more complex structures .",
    "for our spatiotemporal sequence forecasting problem , we use the structure shown in fig .  [ fig : convlstm - encoding - forecasting ] which consists of two networks , an encoding network and a forecasting network . like in  @xcite ,",
    "the initial states and cell outputs of the forecasting network are copied from the last state of the encoding network .",
    "both networks are formed by stacking several convlstm layers . as our prediction target has the same dimensionality as the input , we concatenate all the states in the forecasting network and feed them into a @xmath25 convolutional layer to generate the final prediction .",
    "we can interpret this structure using a similar viewpoint as  @xcite .",
    "the _ encoding _ lstm compresses the whole input sequence into a hidden state tensor and the _ forecasting _",
    "lstm unfolds this hidden state to give the final prediction : @xmath26 this structure is also similar to the lstm future predictor model in  @xcite except that our input and output elements are all 3d tensors which preserve all the spatial information . since the network has multiple stacked convlstm layers , it has strong representational power which makes it suitable for giving predictions in complex dynamical systems like the precipitation nowcasting problem we study here .",
    "we first compare our convlstm network with the fc - lstm network on a synthetic moving - mnist dataset to gain some basic understanding of the behavior of our model .",
    "we run our model with different number of layers and kernel sizes and also study some `` out - of - domain '' cases as in @xcite . to verify the effectiveness of our model on the more challenging precipitation nowcasting problem",
    ", we build a new radar echo dataset and compare our model with the state - of - the - art rover algorithm based on several commonly used precipitation nowcasting metrics .",
    "the results of the experiments conducted on these two datasets lead to the following findings :    * convlstm is better than fc - lstm in handling spatiotemporal correlations . * making the size of state - to - state convolutional kernel bigger than 1 is essential for capturing the spatiotemporal motion patterns . *",
    "deeper models can produce better results with fewer parameters . * convlstm performs better than rover for precipitation nowcasting .",
    "our implementations of the models are in python with the help of theano  @xcite .",
    "we run all the experiments on a computer with a single nvidia k20 gpu .",
    "also , more illustrative `` gif '' examples are included in the appendix .      for this synthetic dataset",
    ", we use a generation process similar to that described in  @xcite .",
    "all data instances in the dataset are 20 frames long ( 10 frames for the input and 10 frames for the prediction ) and contain two handwritten digits bouncing inside a @xmath27 patch .",
    "the moving digits are chosen randomly from a subset of 500 digits in the mnist dataset .",
    "the starting position and velocity direction are chosen uniformly at random and the velocity amplitude is chosen randomly in @xmath28 .",
    "this generation process is repeated 15000 times , resulting in a dataset with 10000 training sequences , 2000 validation sequences , and 3000 testing sequences .",
    "we train all the lstm models by minimizing the cross - entropy loss and the ground - truth frame @xmath29 is defined as @xmath30 .",
    "] using back - propagation through time ( bptt )  @xcite and _ _",
    "@xcite with a learning rate of @xmath31 and a decay rate of @xmath32 .",
    "also , we perform early - stopping on the validation set .    despite the simple generation process , there exist strong nonlinearities in the resulting dataset because the moving digits can exhibit complicated appearance and will occlude and bounce during their movement .",
    "it is hard for a model to give accurate predictions on the test set without learning the inner dynamics of the system .",
    "for the fc - lstm network , we use the same structure as the unconditional future predictor model in  @xcite with two 2048-node lstm layers . for our convlstm network , we set the patch size to @xmath33 so that each @xmath27 frame is represented by a @xmath34 tensor .",
    "we test three variants of our model with different number of layers .",
    "the 1-layer network contains one convlstm layer with 256 hidden states , the 2-layer network has two convlstm layers with 128 hidden states each , and the 3-layer network has 128 , 64 , and 64 hidden states respectively in the three convlstm layers .",
    "all the input - to - state and state - to - state kernels are of size @xmath35 .",
    "our experiments show that the convlstm networks perform consistently better than the fc - lstm network .",
    "also , deeper models can give better results although the improvement is not so significant between the 2-layer and 3-layer networks .",
    "moreover , we also try other network configurations with the state - to - state and input - to - state kernels of the 2-layer and 3-layer networks changed to @xmath25 and @xmath36 , respectively . although the number of parameters of the new 2-layer network is close to the original one , the result becomes much worse because it is hard to capture the spatiotemporal motion patterns with only @xmath25 state - to - state transition",
    ". meanwhile , the new 3-layer network performs better than the new 2-layer network since the higher layer can see a wider scope of the input .",
    "nevertheless , its performance is inferior to networks with larger state - to - state kernel size .",
    "this provides evidence that larger state - to - state kernels are more suitable for capturing spatiotemporal correlations .",
    "in fact , for @xmath25 kernel , the receptive field of states will not grow as time advances .",
    "but for larger kernels , later states have larger receptive fields and are related to a wider range of the input .",
    "the average cross - entropy loss ( cross - entropy loss per sequence ) of each algorithm on the test set is shown in table  [ tbl : movingmnist - result ] .",
    "we need to point out that our experiment setting is different from  @xcite where an infinite number of training data is assumed to be available .",
    "the current offline setting is chosen in order to understand how different models perform in occasions where not so much data is available .",
    "comparison of the 3-layer convlstm and fc - lstm in the online setting is included in the appendix .",
    ".*comparison of convlstm networks with fc - lstm network on the moving - mnist dataset . *",
    "` -5x5 ' and ` -1x1 ' represent the corresponding state - to - state kernel size , which is either @xmath35 or @xmath25 . `",
    "256 ' , ` 128 ' , and ` 64 ' refer to the number of hidden states in the convlstm layers . `",
    "( 5x5 ) ' and ` ( 9x9 ) ' represent the input - to - state kernel size . [",
    "cols=\"<,>,>\",options=\"header \" , ]            -axis is the number of data cases ( starting from 25600 ) and the @xmath37-axis is the average cross entropy of the mini - batches . we can find that the loss of convlstm decreases faster than fc - lstm.,scaledwidth=80.0% ]"
  ],
  "abstract_text": [
    "<S> the goal of precipitation nowcasting is to predict the future rainfall intensity in a local region over a relatively short period of time . </S>",
    "<S> very few previous studies have examined this crucial and challenging weather forecasting problem from the machine learning perspective . in this paper , we formulate precipitation nowcasting as a spatiotemporal sequence forecasting problem in which both the input and the prediction target are spatiotemporal sequences . by extending the _ fully connected lstm _ ( fc - lstm ) to have convolutional structures in both the input - to - state and state - to - state transitions , we propose the _ convolutional lstm _ ( convlstm ) and use it to build an end - to - end trainable model for the precipitation nowcasting problem . </S>",
    "<S> experiments show that our convlstm network captures spatiotemporal correlations better and consistently outperforms fc - lstm and the state - of - the - art operational rover algorithm for precipitation nowcasting . </S>"
  ]
}