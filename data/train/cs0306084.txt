{
  "article_text": [
    "babar is a major particle physics experiment@xcite running at the stanford linear accelerator center ( slac ) , which has already produced many billions of events , both real and simulated , in thousands of files .",
    "these events are processed , re - processed and selected by standard production jobs .",
    "in addition the collaboration numbers 500 + physicists , many of whom are active in running individual analysis jobs . while certainly smaller than the impending experiments at the lhc , babar s requirements approach them in several respects , and meeting the challenge of babar is an invaluable rehearsal for the challenge of the lhc .",
    "babar data processing creates a very high demand for computing resources , both in storage space and cpu time .",
    "largely as a consequence of this , the collaboration has moved from a system which was basically central , with all resources being provided at the slac site , to a distributed model with large and medium sites ( ` tier a ' and ` tier c ' ) spread across the usa and europe .",
    "grid technology provides the obvious means to make these resources available .",
    "however , unlike the lhc experiments , the babar system evolved in the pre - grid era , and tools have to be provided which can be used with the current system , rather than building in grid concepts from the start .",
    "there is also a difference in timing : we require solutions that can be used today rather than in 2007 .",
    "we therefore set out as an exercise to see what could be done with existing grid technology , such as globus and afs , rather than the more complete but longer term solutions offered by the edg @xcite and similar projects .",
    "we encountered the problems familiar to other developers - authentication , authorisation , data location , the input sandbox and data retrieval - and were able to solve them , in some cases in more than one way .",
    "the work went through two phases .",
    "the first was a project to provide a grid based babar system that would act as proof of principle - the ` demonstrator ' .",
    "the user runs a web browser through their desktop or laptop , and for portability no extra software is required on this platform .",
    "the user selects the data to be analysed according to pre - existing babar criteria , and they are processed by the standard analysis job ( ` the workbook example')@xcite .",
    "the http server is used for file transport .",
    "standard ntuples are written , and these are retrieved to the user platform where they can be analysed using root .",
    "the demonstrator was successfully used at escience events in the summer of 2002 @xcite .",
    "the second phase is a command line system - gsub , which gives easy flexibility for the typical physics analyst .",
    "the user is presumed to have the standard babar environment ( which enables compilation , data location , etc ) running on their platform .",
    "afs is used for the input and output sandboxes , and the tokens are maintained using the gsiklog client and gsiklogd server@xcite , so that gsiklogd must be running as a server on the user home system .",
    "this places demands on the user system but not on the remote sites - a reasonable scenario given that the user is presumed to want to make use of resources at the remote sites , whereas the remote sites have no great incentive to provide special facilities for the user .",
    "we describe the two systems , their good features and also those features which we hope to improve by incorporation of the more sophisticated middleware currently being written .",
    "developments involved a number of clusters of pcs running linux .",
    "several of these were at uk institutes ( manchester , birmingham , rutherford , imperial , bristol , liverpool , qmul and rhul ) and comprised identical 40 node pc farms .",
    "facilities at in2p3 and dresden were also included at some stage .",
    "there was good communication and co - operation between the sites and their system managers .",
    "standard grid certificates were used for authentication .",
    "sites involved had a mutual policy of recognising those authorities accepted by the edg and this covered the uk and french institutes .",
    "the doe and german authorities came into being during this period ; before they were available in2p3 offered the facility for babar users to acquire a certificate .",
    "we resisted early calls for babar itself to become a ca . by maintaining a clear distinction between authentication and authorisation we realised that the proper r^ ole of the experimental organisation was with the latter and not the former .      for an authorisation system we set up a vo ( virtual organisation ) @xcite for babar .",
    "this is maintained at manchester and published using the ldap system in the usual way .",
    "the babargrid sites are available to all members of babar . in some cases ( rutherford and in2p3 , the tier a sites )",
    "this means equal access for all members .",
    "the tier c university sites require a system whereby in principle ( or even in practice ) priority can be given to local members : institutes are responsible for the cost and maintenance of their sites , and while they are generally happy for them to be put to use by outside members , they do not want their local machines taken over by heavy outside use to an extent that impinges on the productivity of locals .    a ` member of babar ' has a precise definition @xcite .",
    "all members have an account at slac , and this has specific ` babar ' authorisation on the afs acl list .",
    "obtaining this requires user signatures , consent by the slac computer center , authorisation by the group leader , and the list is kept up to date to weed out members who have moved on elsewhere .",
    "it makes sense to use this existing well - audited system rather than involving users in further paperwork .",
    "any babargrid user has also , by definition , got a grid certificate .",
    "we therefore set up a system whereby all a user has to do to be entered in the babar vo is to copy the dn ( distinguished name ) from their grid certificate into a specifically named file in their home area at slac . a cron job scans for such files , checks the ( slac ) userid against the afs acl list , and forwards the dn to the vo server at manchester .",
    "a second cron job runs at each participating site , and picks up the list of authorised users from the vo .",
    "the local system manager retain control over this job and can readily modify it , if necessary , to remove any known rogues .",
    "this has not been necessary and we do not expect it to be , but it is a useful factor in making the system acceptable to local managements .",
    "this list is appended to the site s",
    "gridmap file with the generic userid prefix babar . appending the list has the desirable effect that if a user has a specific account at the site , and this is put into the gridmap file by other means , then a grid request for their dn will take the specific account rather than the generic one .    the generic account system @xcite provides a pool of accounts ( babar01 , babar02 ... babar99 or whatever ) and the user is mapped onto the first free pool account .",
    "this gives outsiders the facility to use the site , while providing accountability : if a particular account behaves ( inadvertantly or deliberately ) in an anti - social way , the dn that was given this account is known .",
    "furthermore these accounts can , if desired , be given lower priorities and privileges than local ones .    if a dn has finished with the account and then submits a subsequent request , it will be given the same account as last time .",
    "this is useful for retrieving output from jobs .",
    "we thus have a system of authorisation and accounting which scales , i.e. for @xmath0 users at @xmath1 sites it requires @xmath2 transactions rather than @xmath3 , and yet which enables local users to have priority .",
    "the system has proved easy to operate and is reliable .",
    "data in babar is organised into runs , sets of approximately 600,000 events recorded by the experiment . when a run is finished",
    "the run number is incremented and the next run started .",
    "the mapping of datafiles to runs is many - to - one : each file contains the events from a particular run , there are many such files containing different processing and selection stages but for each ( complete ) processing specification there is a unique file for each run .",
    "all the necessary metadata information can thus be contained in the dataset name , which includes the run number , processing version , selection program version , selection type and other information@xcite .",
    "the data catalog is maintained centrally at slac , and is thus also the metadata catalog : each filename contains a full and systematic description of what it contains .",
    "each site contains a copy of the main metadata catalog , updated nightly .",
    "it also contains an extra flag for each file which is set if a local copy exists .",
    "this is maintained by the skimtools facilities @xcite which are used , for example , to request datasets fulfilling certain criteria to be copied from slac to the local site if they do not exist .",
    "the name of each file is the same in all sites . to accommodate the fact that different sites have different disk organisations , each file name starts with the unix symbolic variable $ bfroot",
    "this is defined in a login script to point to an appropriate node in the file system for that particular site .",
    "this system does not map particularly usefully onto the ` replica catalog ' concept @xcite .",
    "for this reason , and because of the problems of speed and usability then being encountered with the general ldap based replica catalog of edg , we decided to develop our own system for these specific purposes .",
    "this catalog can be queried with the skimdata command , which responds to requests for lists of the files satisfying user - defined criteria that exist locally .",
    "this list of files is actually produced as a series of tcl commands , and hence known as ` the .tcl files ' , and for convenience in splitting a complete analysis into jobs the skimdata command is usually used to produce a number of .tcl files .",
    "a typical analysis might involve @xmath4 such .tcl files , each containing a list of @xmath4 data files .      for the demonstrator",
    ", use was made of the fact that skimdata can respond to requests from a remote site .",
    "the user specifies the file selection criteria through as simple web interface perl / cgi script .",
    "they then specify , through a similar script , a list of sites in priority order .",
    "skimdata is then invoked to produce .tcl",
    "files for all runs available at the first site .",
    "it is then invoked for the second site , using the list of runs found at the first site as a set of runs for which information is not desired , ( a facility originally provided to avoid undesirable data and hence called ` badruns ' ) generating a second set of .tcl files .",
    "this process is then repeated for all sites specified .",
    "although this method worked , the time taken for remote skimdata queries could be inconveniently long ( typically a few minutes ) .",
    "the method was therefore improved by adding to the catalog a list of availability at all sites .",
    "this is maintained gathering the information by a nightly cron job . for convenience",
    "it could be maintained centrally and copied by local sites as it is done for the rest of the metadata .",
    "the system this scales for @xmath1 sites as @xmath5 rather than @xmath6 .",
    "the information is not quite up to date but this is not a practical drawback .",
    "this produces a single .tcl file , and an index file which describes which runs are available at which sites .",
    "another perl / cgi script is used to divide these into .tcl files to be run at each site according to rather simple user criteria .",
    "a babar analysis job is performed by running a binary which takes as its first and only argument the name of a .tcl file .",
    "typically it takes the form betaapp myanalysis.tcl , where myanalysis.tcl is a small file which contains specific user instructions ; it sources one of the .tcl files produced by skimdata to locate the event data it is to run on , and also various standard babar .tcl files , which in turn source other similar .tcl files .    in the standard ( pre - grid ) system",
    ", such a job is run from a ` working directory ' within the standard babar environment , i.e. various symbolic links and environment variables are provided to all the files that will be needed @xcite .",
    "this includes the standard babar .tcl files and also some files used in processing ( such as tabulated efficiencies of particle identification . )",
    "these other ( non - tcl ) files pose a particular problem as there is no easy way of knowing which files will be required .",
    "an analysis may run satisfactorily in a test job , but in production there is nothing to stop a low probability branch in the analysis requiring the reading of an unforeseen file .",
    "there is a collaboration policy that the information contained in such files should be moved to a central file ( the conditions database ) , but this is not yet complete",
    ".    it would be possible to build a system which relied on such an environment also being available at the remote site .",
    "however we felt this to be unduly restrictive - it requires not just that _ a _ babar environment be available , but that _ the _ corresponding babar environment , which changes from release to release , be available .",
    "so these files ( .tcl and others ) must be provided in the input sandbox for the job .    to run a job one needs    *",
    "the event data * the binary * the skimdata .tcl file * the myanalysis.tcl file * the other .tcl files * the other non-.tcl files    only the first does not present a problem .",
    "we adopted throughout the philosophy of taking the job to the data , rather than moving the data to the job . from the way the .tcl files",
    "have been produced , the data will be present and accessible with the appropriate definition of $ bfroot .",
    "as the demonstrator used a unique binary , this was compiled ( at slac ) copied to a location ( at manchester ) where it was accessible via http .",
    "this was then copied ( sucked ) to the remote site at the start of each job .",
    "the skimdata.tcl file for the job was sent in the input stream as part of the input generated by the perl / cgi script .",
    "the myanalysis.tcl file was then expanded , i.e. each sourced .tcl file was replaced by the actual contents , iteratively until the file was self - complete .",
    "this was a major task to do by hand , though a facility has now been provided to do this automatically , if necessary .",
    "this large .tcl file was then shipped to the remote sites in a similar manner to the binary , as were the few but large non - tcl files the standard job requires .      in the second version we use afs to circumvent the input sandbox problem .",
    "the user s working directory must be within an afs filesystem at a site running a gsiklogd server .",
    "an afs filesystem is not a problem as many babar working environments use , or have the option of using , afs based user directories ( e.g. slac and ral ) .",
    "the second is a requirement which does require the co - operation of the system manager , but there are no major problems associated with it .    at the start of each job gsiklog",
    "is run ( as a client ) at the remote site .",
    "the binary is copied if it is not available on the system , so this does not restrict the choice of target sites .",
    "this essentially provides an afs token on the authority of the grid proxy , which is used to run the job .",
    "the job can then change directory to the user s working directory , and all the links are available .",
    "all the .tcl files , and the non - tcl files , and the binary are then available .",
    "some initialisation of environment variables is required but can readily be done through standard login scripts - the only point where care is needed is to avoid confusion between the $ bfroot appropriate for the remote site and for the user s home site .",
    "afs access is well known to be slow and inappropriate for large data transfers , owing to the time taken due to local caching etc .",
    "this is not a major drawback , as these files are small and read only once during for each node .",
    "the data itself is read locally , using nfs .",
    "having set up the .tcl files , or before , the user creates a grid proxy on their local platform .",
    "this is then uploaded into the web server .",
    "this temporarily delegates the user s identity to the web server . using an unmodified web browser with the user s certificate ,",
    "the user can then instruct the server to perform remote job submission and other operations on the grid .",
    "the server dispatches a set of jobs , one for each of the .tcl files . for convenience in data collection ,",
    "the set of jobs for each site is called superjob , and each superjob starts with a job0 which copies the binary , the expanded babar .tcl file , and the identified other files to the remote site making them available for the subsequent jobs .",
    "the set of all superjobs ( the hyperjob ) is the complete ` job ' in the sense that it is often used .",
    "some initialisation of environment variables is required but can readily be done through standard login scripts - the only point where care is need is in possible confusion between the appropriate $ bfroot for the remote site and that for the user s home site .",
    "individual jobs run at the remote sites , usually through submission to pbs .",
    "their progress can be monitored and their log files retrieved , though this is rather slow and incovenient other than for test purposes .",
    "the basic betaapp myanalysis.tcl commands are sent by globus - job - submit to the appropriate remote sites ( again , usually to the pbs batch system ) in a simple wrapper that does the gsiklog and cd to the working directory .",
    "each is preceded by a globus - job - run -stage to provide gsiklog if necessary , and other simple tasks .    for each .tcl file the user ( or a simple script ) gives the command gsub < site > betaapp myanalysis.tcl .",
    "there is no need to categorise them into hyper and superjob collections .",
    "the log files are not of much interest .",
    "each analysis job produces as useful output a set of ntuple / histogram files in hbook ( or root ) format .",
    "the job jobnn typically processes a .tcl",
    "file data-nn.tcl and produces a file output-nn.root .",
    "as each job finishes it moves its output file ( stored on the farm node ) to a directory on the gatekeeper for that site , and tars together all the jobs there to form a single file .",
    "thus as jobs start to finish , there is always one file on the site that contains all the presently available output data .    the user - again from a web browser running perl / cgi - can then invoke a job which runs on the server and copies all the tarred superjob files back to a directory using grid - ftp .",
    "they are untarred and tarred into a single directory , and renamed as necessary so that missing / unfinished / failed jobs do not give holes in the sequence .",
    "a link is provided to the total tarred file , and a specific mime type assigned .",
    "the browser has this mime type specified such that when the link is clicked on , the file is downloaded to the browser and untarred , and a small root program run to produce a set of histograms from the total results .          by contrast , this is absolutely trivial .",
    "afs also provides the output sandbox .",
    "the ntuple files are written directly back to the users work directory and can be analysed there .",
    "we have found what appears to be a simple and stable solution to the three a s problem .",
    "the demonstrator has shown that simple grid tools can be used to locate data across remote sites , run appropriate analysis jobs , retrieve and combine the outputs .",
    "the gsub command will be made available within babar . whether it is picked up and exploited by users",
    "will be an interesting test .",
    "the globus - job - submit commands will be replaced by edg - job - submit as soon as the system becomes stable and supported .",
    "99 the babar collaboration , ` the babar detector ' nucl .",
    "instr & meth .",
    "p1 2002 http://eu-datagrid.web.cern.ch/eu-datagrid http://www.slac.stanford.edu/bfroot/www/doc/ workbook / workbook.html t. adye , r. barlow , a. forti , a. mcnab d. smith , building the grid for babar , all hands 2 - 4 september 2002 http://marianne.in2p3.fr/datagrid/documentation/ edg - installation - guide / node9_ct.html i. foster , c. kesselman , steve tuecke , the anatomy of the grid : enabling scalable virtual organizations , international j. supercomputer applications , 15(3 ) , 2001 .",
    "/ babargrid / registration.html http://www.gridpp.ac.uk/authz/gridmapdir http://www.slac.stanford.edu/bfroot/www/physics/ skims / skimdata.html t. adye , a. dorigo , a. forti , e. leonardi , distributing file - based data to remote sites within babar collaboration , in proceedings of computing in high energy and nuclear physics ( chep 2001 ) 9/3/2001 - 9/7/2001 , beijing , china http://www.globus.org/datagrid/ replica-catalog.html http://www.slac.stanford.edu/bfroot/www/doc/ workbook / workdir / workdir.html"
  ],
  "abstract_text": [
    "<S> we present two versions of a grid job submission system produced for the babar experiment . both use globus job submission to process data spread across various sites , producing output which can be combined for analysis . </S>",
    "<S> the problems encountered with authorisation and authentication , data location , job submission , and the input and output sandboxes are described , as are the solutions . </S>",
    "<S> the total system is still some way short of the aims of enterprises such as the edg , but represent a significant step along the way . </S>"
  ]
}