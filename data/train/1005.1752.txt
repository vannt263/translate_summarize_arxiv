{
  "article_text": [
    "@xcite introduced a plummer potential @xcite for gravitational @xmath14-body simulations in order to eliminate the divergence of the potential that occurs when two particles undergo a close encounter . with a plummer softening",
    ", the modified gravitational potential between two particles @xmath0 and @xmath2 is given by @xmath18 where @xmath5 , @xmath19 , @xmath6 , and @xmath20 are the gravitational constant , the distance between particles @xmath0 and @xmath2 , the mass of particle @xmath2 and the gravitational softening length , respectively .",
    "the increase in the calculation cost due to this modification of the potential is quite small .",
    "thus , it is widely used in simulations of self - gravitating systems and the grape ( gravity pipe ) series also adopts this form of the gravitational potential @xcite . due to the wide adoption of the plummer potential , there have been several studies on the choice of the optimal gravitational softening length @xcite .    in simulations of self - gravitating systems , it is necessary to deal with a wide range in both space and time .",
    "for example , one needs to cover the range of @xmath21 ( for the tidal field ) to @xmath22 or less ( for the structure of the interstellar medium ) in galaxy formation simulations .",
    "usually , the outer region of the target galaxy is represented by massive particles in order to reduce the calculation cost ( e.g. , * ? ? ?",
    "* ; * ? ? ?",
    "* ) . in simulations of the coevolution of the galactic center and star cluster ,",
    "it is necessary to use different masses for different components , since required accuracies and spatial resolutions are different @xcite .",
    "thus we need to use different gravitational softening lengths for different types of particles .    if one uses the direct summation method to calculate the gravitational force , it is possible to use an arbitrary symmetric form for the softening length ; for example , @xmath23^{1/2}$ ] , @xmath24 , or @xmath25 . on the other hand ,",
    "when one uses the tree method @xcite , one needs to use separate trees for each of the different groups of particles with the same gravitational softening length ( e.g. * ? ? ?",
    "* ) , since otherwise there will be an error in the force calculation of the order @xmath26 . if one were to calculate the force from the center of mass of two particles with widely different gravitational softening values , it is not clear how one would take into account the gravitational softening length . however , if one uses different trees for particles with different gravitational softening lengths , the calculation cost increases by a large factor .",
    "@xcite proposed a different approach for softening .",
    "they assumed that each particle has a finite size and mass distribution given by a function with a compact support , e.g. a spline function .",
    "the advantage of this gravity kernel is that it becomes a purely keplarian potential for distances larger than the particle size .",
    "thus , for particles separated by distances larger than their sizes , one can use the center - of - mass approximation or the multipole expansion of a purely keplarian potential . however , spline functions require a few conditional branches and the evaluation of a polynomial .",
    "these operations lead to a non - negligible slowdown in the force and potential calculations on modern cpus / gpus which have simd execution units . as a result ,",
    "the calculation cost of a spline function is higher than that of the simple plummer softening .",
    "moreover , the tree approximation can not be used for particles within the softening length .",
    "thus , if there are many particles within the softening length , they can cause a large increase in the calculation cost .    in this paper , we propose a symmetrized gravitational potential between two particles with different softenings , which is a natural extension of the plummer potential .",
    "we derive the multipole expansion of a group of such particles with this symmetrized potential .",
    "we then show that , in terms of accuracy , it is the best to use the second moment of the softening lengths of the particles in order to obtain the averaged softening length for the group .",
    "the multipole moment up to the second order has a simple form , which is easy and inexpensive to calculate .",
    "this paper is structured as follows : in section [ sec : sym ] , we present a symmetrized gravitational potential for a pair of particles with different gravitational softening lengths and then introduce an averaged gravitational softening length for a group of such particles . the use of this potential with the tree method is also discussed in the section .",
    "results of numerical tests are given in section [ sec : tests ] . a summary and discussion are shown in section [ sec : discussion ] .",
    "we modify the plummer potential ( eq . [ eq : plummer_pot ] ) so that it is symmetric between two particles even when their gravitational softening lengths are different . here , we consider the following form : @xmath27 formally , this form can be regarded as the @xmath28 potential in the five dimensional space ( @xmath29 ) . this form has been used before to model the gravitational interaction between galaxy particles with different size and mass @xcite . when we take the gradients of eq .",
    "[ eq : pot_sym ] in the @xmath10 and @xmath11 directions , we obtain the gravitational accelerations , _ i.e. _",
    "@xmath30 this gravitational acceleration satisfies newton s third law .      in this section , we derive the multipole expansion of the gravitational potential for a group of particles with the symmetrized plummer potential by introducing an averaged softening for the group of particles . using eq .",
    "[ eq : pot_sym ] , we obtain the most suitable form of the averaged softening which minimizes the potential / force error .",
    "this form can easily be used with a tree code @xcite .",
    "we consider the gravitational potential at @xmath31 due to a group of particles @xmath32 with the total mass @xmath33 .",
    "the three - dimensional position of particle @xmath2 is expressed as @xmath34 . here",
    "we choose the center of mass of particles @xmath2 as the coordinate center . by taking the summation over @xmath2 ,",
    "the potential at @xmath31 is @xmath35 where @xmath36 .",
    "we consider the following form as the monopole potential of the group : @xmath37 where @xmath38 is an arbitrary form of the averaged softening length for the group of particles @xmath2 .",
    "as shown below , in terms of accuracy , we can obtain the most suitable form of the averaged softening length for the group of particles .    by using @xmath38 ,",
    "we can rewrite eq .",
    "[ eq : pot_sym_sum ] as follows : @xmath39 where @xmath40 .",
    "the taylor expansion of eq .",
    "[ eq : pot_sym_sum_diff ] up to the second order of @xmath34 and @xmath41 is @xmath42 ^ 2}{4 { r}^4 }   + \\mathcal o \\left ( \\left [ \\frac{{\\boldsymbol          { r}}_{j}}{r}+\\frac{d({\\epsilon_j}^2)}{r^2 } \\right]^3 \\right ) \\biggl \\ } \\label{eq : pot_sym_sum_exp } \\end{aligned}\\ ] ] where @xmath43 the zeroth term of the taylor expansion is @xmath44 itself ( eq . [ eq : pot_sym_sum_averaged ] ) .",
    "the term of the order of @xmath45 vanishes by definition .",
    "since @xmath40 , the first order term of @xmath41 vanishes if we adopt the second moment of @xmath9 as the averaged softening length : @xmath46 hence , choosing the second moment of @xmath9 to be the averaged softening length is the most favourable option ; using other forms such as @xmath24 , @xmath25 and @xmath47 result in a second - order error term .    for the convergence of the multipole expansion , it is necessary to take into account not only the ordinary three - dimensional distance but also the distribution of the softenings , @xmath9 .",
    "we will discuss this point in the next subsection .      in the tree method ,",
    "the force and potential of a group of particles are approximated by that of the corresponding tree node . the opening criterion @xcite , @xmath48 is widely used to determine whether the multipole approximation can be used or not .",
    "here , @xmath49 is called the opening angle and controls the force / potential accuracies , @xmath50 is the size of the tree node and @xmath51 is the distance between the barycenter of the tree node and the position where we want to calculate the force and potential . since the multipole expansion of the @xmath28 potential around @xmath52 is a series of @xmath53 where @xmath54 and @xmath55 , eq . [ eq : tolerant ] corresponds to the convergence condition for the multipole expansion of the @xmath28 potential . for the plummer potential ,",
    "the plummer distance , @xmath56 , is adopted instead of @xmath57 .",
    "typically , a value of @xmath58 is used . note that",
    ", unless @xmath59 , the barnes & hut s opening criterion causes unbound errors in force calculation , resulting in `` detonating galaxies '' @xcite .",
    "they studied other opening criteria so that one can avoid these large errors .",
    "here , we use eq .",
    "[ eq : tolerant ] with sufficiently small @xmath49 . hence our results , which will appear in section [ sec : energyerror ] , are free from this problem .    as shown in section [ sec : multipole ] , the potential induced by a group of particles with the symmetrized form of the potential is expanded by two parameters , @xmath60 and @xmath61 .",
    "thus , the following two constraints together should satisfy the conditions for convergence : @xmath62 and @xmath63 here , @xmath64 and @xmath65 are the tolerance parameters for the multipole expansion of the symmetrized plummer potential . by replacing @xmath34 with @xmath50 and @xmath61 with @xmath66 , where @xmath67 and @xmath68 are the maximum and minimum softening lengths in a tree node , respectively , we obtain @xmath69 and @xmath70 for the convergence conditions of the multipole expansion .    note that @xmath71 corresponds to the size of the `` box '' in the fifth dimension . in our current implementation ,",
    "the tree structure is still an oct - tree in three dimensions .",
    "thus , if a node contains two particles which have widely different gravitational softening lengths , its `` size '' can be dominated by the softening if its physical size is small .",
    "when we calculate the force from this node to a nearby particle with a distance @xmath72^{1/2}$ ] , this node is always opened up even if the physical size of the node in three dimensions is much smaller than the distance .",
    "this behavior could cause an unnecessary increase in the calculation cost . in principle",
    ", we can easily solve this problem by making a tree structure in four - dimensional space , but so far we have not used such treatment .    in the",
    "tree - with - grape method @xcite , a similar opening criterion , a set of eqs [ eq : tolerant_sym_r ] and [ eq : tolerant_sym_eps ] , can be used with two modifications based on an argument for the convergence condition of the taylor expansion .",
    "the modifications are as follows : first , we employ the minimum node - to - node distance in the ordinary three dimensions as the separation distance , @xmath31 , in eq .",
    "[ eq : plummer_distance ] .",
    "then , we use the minimum gravitational softening length in the particles which share an interaction list , instead of @xmath8 in eq .",
    "[ eq : plummer_distance ] .",
    "these modifications give a sufficient accuracy when used with the tree - with - grape method .",
    "the averaged gravitational softening length for each tree node can be calculated in the tree building phase with a recursive operation that is the same as that for the multipole expansion .",
    "the averaged gravitational softening length for a parent node , @xmath73 , is @xmath74 where @xmath75 is the number of child nodes , @xmath76 and @xmath77 are the mass and the averaged gravitational softening length of the @xmath78-th child node , respectively , and @xmath79 is the mass of the parent node .      in this section ,",
    "we discuss the application of the symmetric softening to the fast multipole method ( fmm ) @xcite . unlike the tree method , in fmm ,",
    "multipole expansions are first translated to local expansion , which is then evaluated at the positions of multiple particles .",
    "thus , the calculation order in fmm is proportional to @xmath14 .",
    "the calculation cost in fmm depends on the expansion order of the multipole moments in the local / external particles . in the standard fmm @xcite , spherical harmonics",
    "is used to express expansion and thus the calculation cost is @xmath80 , where @xmath81 is the order of the multipole expansion . @xcite successfully reduced the calculation cost in fmm from @xmath80 to @xmath82 by using a fast fourier transformation and optimal choice of the tree level .",
    "@xcite proposed a cartesian fmm , however , its calculation cost is estimated as @xmath83 .",
    "again this cost can be reduced to @xmath84 by following @xcite .    with the @xmath28 potential in the five dimensions presented here , one can not use a spherical harmonic function for the expansion .",
    "thus , it is necessary to use a straightforward expansion such as what is used in the cartesian fmm @xcite to implement our symmetrized plummer potential . in the multipole expansions , because it is necessary to expand the fourth or fifth dimension for the local and external field , the calculation cost is @xmath85 and the reduced calculation cost is @xmath86 .",
    "when the multipole expansion is applied , the softening lengths of the particles are usually smaller than the size of the node and therefore one usually needs to take into account only the first cross term in eq .",
    "[ eq : pot_sym_sum_exp ] . in this case , the calculation cost is similar to that of the cartesian fmm .",
    "moreover , gravitational softening is used in simulations where the required force accuracy is not very high .",
    "therefore the multipole expansion can be truncated in relatively low orders .",
    "thus , the increase in the calculation cost is not so large if one incorporates the symmetrized plummer potential into fmm .",
    "here , we present the measured acceleration error of the force calculated using a tree and our symmetrized form of the plummer potential .",
    "we take two groups of @xmath87 particles , each with a different mass and softening length .",
    "the particles are randomly distributed within a uniform sphere of radius @xmath88 .",
    "table [ tab : runs ] shows the different combinations of masses and gravitational softening lengths used for this test .",
    "the accuracy of the accelerations depends strongly on the distribution of particles @xcite .",
    "however , for simplicity , we consider only a uniform sphere here . in this test",
    ", we adopt the center - of - mass approximation for the force calculation and we use the set of eqs [ eq : tolerant_sym_r ] and [ eq : tolerant_sym_eps ] for the opening criterion . for this criterion , the tolerance",
    "is always kept the same and is represented by @xmath49 instead of @xmath64 and @xmath65 for simplicity .    [ cols=\"^,^,^,^,^\",options=\"header \" , ]      +    the numerical simulations were performed using asura ( saitoh , in preparation ) .",
    "asura adopts the tree - with - grape method to calculate the gravitational force and potential @xcite . for this test , asura only uses the center - of - mass of the tree nodes to calculate the force , with their averaged gravitational softening lengths determined according to eq .",
    "[ eq : averaged_e ] and the tolerance is set to @xmath89 .",
    "the maximum number of particles which shares the same interaction list @xcite was set to @xmath90 and @xmath91 .",
    "time - integration scheme used is an ordinary leap - frog method .",
    "figure [ fig : errors ] shows the relative error in the total energy of the system , @xmath92 , at time @xmath93 ( which is approximately the time of maximum collapse ) as a function of the size of the time - step . here",
    "@xmath92 is defined as @xmath94 where @xmath95 is the total energy of the system at @xmath96 .    from figure",
    "[ fig : errors ] , we can see that the mass ratio between groups of particles does not affect the relative error . for small time - steps ( @xmath97 ) , the relative error of the tree method is larger than that of the direct method .",
    "this is because the error in the calculated force from using a tree dominates the integration error .",
    "the contribution of the tree approximation to the relative error is smaller for large @xmath98 , since a larger number of nearby particles is included in the direct calculation @xcite .",
    "in this paper , we introduced a natural symmetrization of the plummer potential .",
    "this symmetrization is quite simple and hence , easy for anyone to implement into their own code , providing their code adopts the traditional plummer potential for gravity .    by applying this potential to a group of particles , we derived an averaged gravitational softening length for the group .",
    "consequently , we can use this potential in the tree method .",
    "the multipole expansion of the symmetrized plummer potential allows us to use a single tree to calculate forces and potentials for a system of particles that have different softening lengths .",
    "thus the calculation cost of our method is less than that of previous implementations .",
    "since the modification is quite simple , the modified plummer potential can be easily implemented in modern grapes ( _ i.e. _ , grape-7   and grape - dr ) as they can modify the force law via software libraries . however , for older grapes , the gravity pipelines are implemented on the hardware layer and so it is impossible to use this modified potential .",
    "the latest version of the grape - dr library supports this new symmetrized plummer potential .",
    "pure software libraries , _",
    "i.e. _ those that run on typical cpus without special hardware , can easily include our calculation model .",
    "phantom - grape ( nitadori et al , in preparation ) is an optimized library that utilizes the simd instructions of x86 cpus and has application interfaces comparable with grape-5 @xcite . for this software , we can easily modify the gravity kernel in the library .",
    "we used this modified phantom - grape for the tests described in section [ sec : tests ] .",
    "the implementation of our modified plummer potential on gpgpus @xcite is also straightforward .",
    "the authors thank an anonymous referee for his / her insightful comments which helped us to improve our manuscript .",
    "the authors also thank simon white and piet hut for helpful discussion and william robert priestley for careful reading of the manuscript .",
    "some of the numerical tests were carried out on cray xt4 and grape system at the center for computational astrophysics at the national astronomical observatory of japan .",
    "this project is supported by grant - in - aid for scientific researches ( 17340059 & 21244020 ) .",
    "trs is financially supported by a research fellowship from the japan society for the promotion of science for young scientists .",
    "hamada , t. , narumi , t. , yokota , r. , yasuoka , k. , nitadori , k. , & taiji , m. 2009 , in sc 09 : proceedings of the conference on high performance computing networking , storage and analysis ( new york , ny , usa : acm ) , 112"
  ],
  "abstract_text": [
    "<S> we propose a symmetrized form of the softened gravitational potential which is a natural extension of the plummer potential . </S>",
    "<S> the gravitational potential at the position of particle @xmath0 @xmath1 , induced by particle @xmath2 at @xmath3 , is given by : @xmath4 where @xmath5 is the gravitational constant , @xmath6 is the mass of particle @xmath2 , @xmath7 and @xmath8 and @xmath9 are the gravitational softening lengths of particles @xmath0 and @xmath2 , respectively . </S>",
    "<S> this form is formally an extension of the newtonian potential to five dimensions . </S>",
    "<S> the derivative of this equation in the @xmath10 , and @xmath11 directions correspond to the gravitational accelerations in these directions and these are always symmetric between two particles .    </S>",
    "<S> when one applies this potential to a group of particles with different softening lengths , as is the case with a tree code , an averaged gravitational softening length for the group can be used . </S>",
    "<S> we find that the most suitable averaged softening length for a group of particles is @xmath12 , where @xmath13 and @xmath14 are the mass and number of all particles in the group , respectively . </S>",
    "<S> the leading error related to the softening length is @xmath15 , where @xmath16 is the distance between particle @xmath2 and the center of mass of the group and @xmath17 . using this averaged gravitational softening length with the tree method </S>",
    "<S> , one can use a single tree to evaluate the gravitational forces for a system of particles with a wide variety of gravitational softening lengths . </S>",
    "<S> consequently , this will reduce the calculation cost of the gravitational force for such a system with different softenings without the need for complicated forms of softening . </S>",
    "<S> we present the result of simple numerical tests . </S>",
    "<S> we found that our modification of the plummer potential works well .    </S>",
    "<S> methods:@xmath14-body simulations  methods : numerical </S>"
  ]
}