{
  "article_text": [
    "terrestrial planets and cores of giant planets are generally considered to have formed through accretion of many small bodies called planetesimals . to simulate accretion processes of planets ,",
    "two methods , which are complementary to each other , have been applied .",
    "the first one is @xmath0-body simulations in which orbits of all bodies are numerically integrated and gravitational accelerations due to other bodies are calculated in every time step ( e.g. , kokubo and ida , 1996 ; chambers and wetherill , 1998 ; richardson et al . , 2000 ;",
    "morishima et al . , 2010 ) .",
    "@xmath0-body simulations are accurate and can automatically handle any complicated phenomena , such as resonant interactions and spatially non - uniform distributions of planetesimals .",
    "gravity calculations are accelerated by such as tree - methods ( richardson et al . , 2000 ) or special hardwares ( kokubo and ida , 1996 ; grimm and stadel , 2014 ) , and a large time step can be used with sophisticated integrators , such as mixed variable symplectic ( mvs ) or wisdom - holman integrators ( duncan et al . , 1998 ; chambers , 1999 ) .",
    "even with these novel techniques , @xmath0-body simulations are computationally intense and the number of particles or the number of time steps in a simulation is severely limited .",
    "the second approach is statistical calculations in which planetesimals are placed in two dimensional ( distance and mass ) eulerian grids , and the time evolutions of the number and the mean velocity of an ensemble of planetesimals in each grid are calculated using the phase - averaged collision and stirring rates ( e.g. , greenberg et al . , 1978 ; wetherill and stewart , 1989 , 1993 ; inaba et al . , 2001 ; morbidelli et al . , 2009 ; kobayashi et al . ,",
    "while this approach does not directly follow orbits of individual particles , it can handle many particles , even numerous collisional fragments .",
    "largest bodies , called planetary embryos , are handled in a different manner than small bodies , taking into account their orbital isolation . the mutual orbital separation between neighboring embryos is usually assumed to be 10 mutual hill radii .",
    "the last assumption is not always guaranteed , particularly in the late stage of planetary accretion ( e.g. , chambers and wetherill , 1998 ) . to handle orbital evolution of embryos more accurately , eulerian hybrid codes - body calculations . ]",
    "have been developed ( spaute et al . , 1991 ; weidenschilling et al .",
    ", 1997 ; bromley and kenyon , 2006 ; glaschke et al . , 2014 ) , in which small planetesimals are still handled by the eulerian approach whereas orbital evolutions of largest embryos are individually followed by such as @xmath0-body integrations .",
    "gravitational and collisional interactions between embryos and small planetesimals are handled using analytic prescriptions .",
    "glaschke et al .",
    "( 2014 ) took into account radial diffusion of planetesimals due to gravitational scattering of embryos and their code can approximately handle gap opening around embryos orbits .",
    "a lagrangian hybrid method has also been introduced by levison et al .",
    "( 2012 ) ( ldt12 hereafter ) . in their lipad code , a large number of planetesimals",
    "are represented by a small number of lagrangian tracers .",
    "this type of approach is called a super - particle approximation and is also employed in modeling of debris disks ( kral et al . , 2013 ; nesvold et al . , 2013 ) and planetesimal formation ( johansen et al",
    ". , 2007 ; rein et al . , 2010 ) .",
    "orbits of individual tracers are directly followed by numerical integrations , and interactions between planetesimals ( stirring and collisions ) in tracers are handled by a statistical routine .",
    "embryos are represented by single particles and the accelerations of any bodies due to gravity of embryos are handled in the @xmath0-body routine .",
    "lagrangian hybrid methods have several advantages than eulerian hybrid methods .",
    "for example , lagrangian methods can accurately handle spatial inhomogeneity in a planetesimal disk ( e.g. , gap opening by embryos ) , planetesimal - driven migration , resonant interactions between embryos and small planetesimals , and eccentric ringlets .",
    "a drawback of lagrangian methods would be computational cost as orbits of all tracers need to be directly integrated .",
    "therefore , it is desirable that lagrangian hybrid methods can handle various problems accurately even with a moderately small number of tracers .    in this paper , we develop a new lagrangian hybrid code for planet formation . while we follow the basic concept of particle classes introduced by ldt12 , recipes used in our code are different from those used in the lipad code in many places .",
    "the largest difference appears in the methods to handle viscous stirring and dynamical friction .",
    "the lipad code solves pair - wise interactions while our method gives the accelerations of tracers using the phase - averaged stirring and dynamical friction rates .",
    "while the lipad code conducts a series of three body integrations in the stirring routine ( in the shear dominant regime ) and in the routine of sub - embryo migration during a simulation , our code avoids them by using unique routines .",
    "the complete list of comparison with the lipad code turns out to be rather long and is given in appenedix  g.    in section  2 , we explain our method . in section  3 ,",
    "we show various tests of the new hybrid code and compare them with analytic estimates and pure @xmath0-body simulations .",
    "the computational speed and limitations of our code are discussed in section  4 .",
    "the summary is given in section  5 .",
    "for the sake of clarity , specific derivations are deferred to appendices .",
    ". schematic illustration of our hybrid code . accelerations due to gravity of embryos are handled by the @xmath0-body routine .",
    "tracer - tracer interactions and back reaction of tracers on sub - embryos including collision are handled by the statistical routine .",
    "the particle classes in our hybrid code are the same as those introduced by ldt12 .",
    "the code has three classes of particles : tracers , sub - embryos , and full - embryos ( fig .  1 ) . in the present paper",
    ", we do not consider fragmentation of planetesimals and dust - tracers are not introduced .",
    "a tracer represents a large number of equal - mass planetesimals on roughly the same orbits .",
    "the mass of a planetesimal and the number of planetesimals in the tracer @xmath1 ( @xmath1 for the index of the tracer ) are defined to be @xmath2 and @xmath3 .",
    "therefore , the tracer mass is given by @xmath4 . through collisional growth ,",
    "@xmath2 increases and @xmath3 decreases while @xmath4 remains close to its original value .",
    "we allow mass exchanges between tracers through collisions so the tracer mass , @xmath4 , is not necessarily fixed but has the upper and lower limits , @xmath5 and @xmath6 ( @xmath7 ) .",
    "we employ @xmath8 and @xmath9 in this paper , where @xmath10 is the minimum mass of a sub - embryo .",
    "the mass @xmath10 is usually the initial mass of a tracer , which is the same for all tracers at the beginning of a simulation . if @xmath11 and @xmath12 , the tracer is promoted to a sub - embryo . if @xmath13 , the sub - embryo is further promoted to a full - embryo , where we employ the numerical factor @xmath14 of 100 , as recommended by ldt12 .",
    "the number @xmath3 is an integer in our model .",
    "orbits of any types of particles are directly integrated .",
    "we use a mixed variable symplectic integrator known as symba ( duncan et al . , 1998 ) , which can handle close encounters between particles .",
    "this integrator is also used by ldt12 .",
    "the collisional and gravitational interactions between full - embryos with tracers are directly handled in every time step of orbital integrations , as is the case of pure @xmath0-body simulations .",
    "on the other hand , tracer - tracer interactions are handled in a statistical routine which is described in subsequent sections in great detail . while the time step for the orbital integration @xmath15 is @xmath16 of the orbital period , the time step @xmath17 for the statistical routine can be taken to be much larger as long as @xmath18 is sufficiently smaller than the stirring and collisional timescales . in this paper , we employ @xmath19 for all test simulations .",
    "we confirmed that almost the same outcome is obtained even with a smaller @xmath18 for all the test simulations .    in interactions between a tracer and a full - embryo in the @xmath0-body routine ,",
    "the tracer is assumed to be a single particle with the mass equivalent to the total mass of planetesimals in the tracer .",
    "this is not a problem as long as the embryo is sufficiently massive compared with tracers .",
    "however , if the embryo mass is similar to tracer masses as is the case immediately after its promotion , and if embryo - tracer interactions are handled by the direct @xmath0-body routine , the embryo suffers artificially strong kicks from tracers . to avoid this issue , sub - embryos are introduced .",
    "accelerations of sub - embryos due to gravitational interactions with tracers are handled by the statistical routine whereas accelerations of tracers due to gravitational interactions with sub - embryos are handled by the direct @xmath0-body routine ( fig .  1 ) .",
    "collisions of planetesimals in tracers with sub - embryos are also handled in the statistical routine to avoid artificially large mass jumps in sub - embryos , contrary to ldt12 ( see appendix  g for more discussion ) .",
    "fig .  2 .",
    "schematic illustration of neighboring tracer search .",
    "the filled circle is the target tracer and open circles are interloping tracers ( interlopers ) .",
    "the surface number density of planetesimals in an interloper is simply given by the number of planetesimal in the interloper divided by the area of the region between two arcs .",
    "our statistical routine uses the surface number density of nearby tracers .",
    "we first describe how we determine the surface number density for tracer - tracer interactions .",
    "the surface number density of tracers for interactions between a sub - embryo and tracers is derived in a similar way , but slightly modified so that close and distant encounters are treated differently ( section  2.5 ) .",
    "consider a target tracer @xmath1 , surrounded by nearby interloping tracers .",
    "the cylindrical co - ordinate system @xmath20 is introduced and we consider a curved region , called the region @xmath1 , located at @xmath21 and centered at the position of the tracer @xmath1 ( fig .  2 ) . the radial half width and the angular half width in the @xmath22 direction of the region @xmath1 are given by @xmath23 and @xmath24 , respectively .",
    "the area of this region is given by @xmath25 for neighboring tracer search , tracers are sorted into 2d @xmath26 grids and only nearby cells of the target tracer are checked whether other tracers are in the designated region . if the interloper @xmath27 is in the region @xmath1 , the surface number density of planetesimals in the interloper @xmath27 around the target @xmath1 is simply expressed as @xmath28 the density @xmath29 is an instantaneous density . at other times , the interloper @xmath27 may not be in the region @xmath1 but other interlopers having planetesimal masses similar to @xmath30 may be in the region @xmath1 .",
    "after averaging over time , the encounter rate with planetesimals in a certain mass range is expected to converge regardless of the size of @xmath31 .",
    "a small @xmath32 is favorable to capture a small radial structure accurately .",
    "however , it is not reasonable to use @xmath32 smaller than a typical radial length of gravitational influence of a planetesimal , which is usually about @xmath33 . here",
    ", @xmath34 is the hill radius given by @xmath35 where @xmath36 is the semi - major axis of the tracer @xmath1 and @xmath37 is the mass of the central star .",
    "since the mass of a possible largest planetesimal is @xmath10 , we employ @xmath38 for tracer - tracer interactions . for interactions between a sub - embryo and tracers ,",
    "a larger @xmath23 needs to be used and we employ 10 hill radii of a possible largest sub - embryo with the mass of @xmath39 .    an advantage of the choice of @xmath23 given by eq .",
    "( [ eq : drt0 ] ) is that we can omit the procedure for orbital isolation of planetesimals .",
    "orbital isolation of the largest bodies occurs if the sum of orbital spaces of these bodies is less than the width of the region of interest ( wetherill and stewart , 1993 ) . if a planetesimal is assumed to occupy an orbital space of 10 hill radii ( kokubo and ida , 1998 ) and if the tracer masses are @xmath10 , the sum of the orbital spaces of planetesimals in a pair of tracers are always larger than @xmath40 .",
    "since our model allows a tracer mass lower than @xmath10 , isolation can potentially occur if the tracer masses and the numbers of planetesimals in the tracers are both small .",
    "such cases are rather rare and we can ignore them .",
    "therefore , orbital isolation can occur only for embryos and that is handled by the @xmath0-body routine .",
    "an additional discussion is given in appendix  g.    a small @xmath24 is favorable to handle non - axisymmetric structures , in which the surface density is not azimuthally uniform .",
    "such structures usually appear if external massive bodies exist ( kortenkamp and wetherill , 2000 ; nagasawa et al .",
    ", 2005 ; levison and morbidelli , 2007 ; queck et al . , 2007 ) .",
    "a small @xmath24 can also be chosen , if we want to suppress the number of interlopers to save computational costs ( section  4.1 ) . in this paper , we usually adopt @xmath41 , but dependency on @xmath24 is also examined .    even if the tracer @xmath27 is in the region @xmath1 ,",
    "the tracer @xmath1 is occasionally outside the region @xmath27 used in neighboring search around the tracer @xmath27 . to make sure that the tracer @xmath1 and the tracer @xmath27 are mutually counted ( or excluded ) as interlopers",
    ", the number density @xmath29 is evaluated using eq .",
    "( [ eq : nj ] ) only if @xmath42 or @xmath43 for @xmath44 .",
    "otherwise and only if the tracer @xmath1 is in the region @xmath27 , @xmath29 is given by @xmath45 , where @xmath46 is the area of the region @xmath27 .",
    "although we only considered encounters with interlopers , planetesimals in the target @xmath1 may encounter with other planetesimals in the same target if @xmath47 .",
    "appendix  a describes how we correct this effect .",
    "this effect is found to be too small to be identified .",
    "let the semimajor axis , the orbital eccentricity , the orbital inclination , the longitudes of pericenter and ascending node , and the mean longitude of the target be @xmath36 , @xmath48 , @xmath49 , @xmath50 , @xmath51 , and @xmath52 , and those for the interloper be @xmath53 , @xmath54 , @xmath55 , @xmath56 , @xmath57 , and @xmath58 .",
    "the difference between the semimajor axes is defined as @xmath59 .",
    "when the target encounters with the interloper , they may collide with each other at a certain probability .",
    "their orbital elements are also modified by mutual gravitational scattering . to handle these processes in the statistical routine in a simple manner , we make following assumptions .    1",
    ".   we use the collision probability and the mean change rates of orbital elements derived by previous studies which usually solved hill s equations .",
    "the equations of motion are reduced to hill s equations if hill s approximation is applied ( hill , 1878 ; nakazawa et al . , 1989 ) .",
    "the conditions to apply hill s approximation are 1 .",
    "@xmath48 , @xmath49 , @xmath54 , @xmath55 @xmath60 , 2 .",
    "@xmath2 , @xmath30 @xmath61 , and 3 .",
    "2 .   the semimajor axis differences @xmath63 and the phases of the interlopers , @xmath56 , @xmath57 , @xmath58 are uniformly distributed .",
    "namely , if a certain interloper in the region @xmath1 is found , we assume that other interlopers with the same @xmath54 , @xmath55 , but different @xmath63 , @xmath56 , @xmath57 , and @xmath58 are distributed uniformly over the region @xmath1 .",
    "3 .   the longitudes , @xmath50 and @xmath51 , of the target change randomly and large enough on the evolution timescales of @xmath48 and @xmath49 .",
    "this approximation is unnecessary if approximation 2 is valid and either @xmath64 or @xmath65 , because the collision and stirring rates do not depend on @xmath50 and @xmath51 in such a situation .",
    "assumption 1 ( hill s approximation ) seems to work well in most of cases of planetary accretion .",
    "greenzweig and lissauer ( 1990 ) showed that the collision probability of a planet with planetesimals on circular and co - planar orbits agrees with that based on hill s approximation within @xmath66 as long as @xmath67 .",
    "our test simulations for late stage planetary accretion ( section  3.5 ) indicate that hill s approximation also works well even at moderately high orbital eccentricities ( @xmath68 ) .",
    "assumption 2 is acceptable if many planetesimals mutually interact via gravitational scattering and collisions without orbital isolation .",
    "these interactions lead to randomization of spatial positions and phases .",
    "we extensively adopt these uniformities even if the target is a sub - embryo isolated from other embryos , but with some approximated cares ( section  2.6 ) .",
    "assumption 3 is likely to be reasonable since the timescale of phase change is comparable to the stirring timescale in general ( e.g , tanaka and ida , 1996 ) . with assumptions 2 and 3",
    ", we can assume that the time averaged stirring and collision rates of an individual target are equivalent to the stirring and collision rates averaged over phase space .",
    "while this equivalence resembles the so - called ergodic hypothesis , the difference is that we assume the equivalence on a short timescale .",
    "although assumption 3 may not be strictly correct , it greatly simplifies the problem and it is worthwhile to examine its validity or usefulness .",
    "fig .  3 .",
    "definitions of the eccentricity vectors .",
    "the inclination vectors are defined in a similar manner .",
    "integrations over distributions of orbital elements of interlopers can be transformed to integrations over relative orbital elements of interlopers with respect to the target ( nakazawa et al . , 1989 ) .",
    "the eccentricity and inclination vectors of the target @xmath1 are given as @xmath69 the same characters but with the subscript @xmath27 represent the eccentricity and inclination vectors for the interloper @xmath27 .",
    "the relative eccentricity and inclination vectors are given as ( fig .",
    "3 ) @xmath70 where @xmath71 and @xmath72 are the longitudes for the relative vectors .",
    "nakazawa et al .",
    "( 1989 ) adopted assumptions 1 - 3 and derived the number of planetesimals @xmath73 colliding with the target @xmath1 during a time interval @xmath17 as [ their eq .",
    "( 49 ) ] @xmath74 where @xmath75 and @xmath76 are the mean squares of @xmath54 and @xmath55 of interlopers , @xmath29 is the surface number density of interlopers , @xmath77 is the mean semi - major axis , @xmath78 is the orbital frequency at @xmath79 , @xmath80 is the distribution function of @xmath81 and @xmath82 normalized as @xmath83 , and @xmath84 is the non - dimensional collision rate averaged over @xmath63 , @xmath71 , and @xmath72 ( appendix  b.1 ) . in the above , the reduced mutual hill radius , @xmath85 , is given as @xmath86    the expression of @xmath87 for the case of the rayleigh distributions of @xmath54 and @xmath55 is given by eq .",
    "( 35 ) of nakazawa et al .",
    "( 1989 ) . in our method , on the other hand , @xmath87 for a certain interloper is given by the dirac delta function .",
    "thus , the expected number of planetesimals @xmath73 in the interloper @xmath27 colliding with the target @xmath1 during @xmath17 is given as @xmath88 where @xmath29 is given by eq .",
    "( [ eq : nj ] ) .",
    "the stirring rates can be derived in a similar manner using the non - dimensional stirring rates ( section  2.5 ) . in our method , the averaging over distributions of eccentricities and inclinations of interlopers will be made by averaging over multiple interlopers .",
    "although it is not necessary to assume the distribution functions of eccentricities and inclinations of interlopers in calculations of the collision and stirring rates , our stirring routine naturally reproduces rayleigh distributions ( section  3.2 ) .    if the system is perturbed by a massive external body and the forced eccentricity is much larger than free eccentricities , the phases , @xmath56 and @xmath57 , may not be uniformly distributed .",
    "even in such a case , our approach may still be applied by replacing the eccentricity and inclination vectors by the free eccentricity and inclination vectors whose directions are uniformly distributed , provided that the forced eccentricity vectors are roughly the same between the target and interlopers .",
    "thus , while uniformities of @xmath71 and @xmath72 are assumed , we do not necessarily assume uniformities of the relative longitudes @xmath89 and @xmath90 . the averaging over @xmath91 and @xmath92 is done by averaging over interlopers [ @xmath93 . while this relaxing of the assumption does not alter eq .",
    "( [ eq : dndt ] ) , it is important for dynamical friction ( section  2.5 )",
    ". the forced eccentricity vectors are not necessarily the same between the target and interlopers , for example , if the mass - dependent dissipative force works .",
    "in such a situation , our approach is not valid , although it is still worthwhile to examine how inaccurate it is .",
    "the expected change rate of the mass @xmath2 of a planetesimal in the tracer @xmath1 due to collisions with planetesimals in the interloper @xmath27 is simply given by multiplying the planetesimal mass @xmath30 to eq .",
    "( [ eq : dndt ] ) ( ida and nakazawa , 1989 ; greenzweig and lissauer , 1990 ; inaba et al . ,",
    "2001 ) @xmath94    to avoid double counting , we only consider a case for @xmath42 or @xmath43 for @xmath44 .",
    "using the mass change rate , the probability that the mass of a planetesimal in the target @xmath1 increases by @xmath95 due to a collision with a planetesimal in the interloper @xmath27 during the time step @xmath17 is given as @xmath96 .",
    "if this probability is larger than a random number which takes between 0 and 1 , we assume that all planetesimals in the target @xmath1 collide with planetesimals in the interloper .",
    "the same procedure is applied to all other interlopers in the region @xmath1 to check whether collisions occur between planetesimals in the target and those in interlopers .",
    "if a collision occurs and mutually colliding bodies merge , the changes in the masses and the numbers of planetesimals in the tracers are given as follows : @xmath97 where the characters with the additional subscript @xmath98 mean those after the merging .",
    "note that the total mass is conserved in the collisions : @xmath99 .    before determining whether a collision occurs or not , we need to choose an appropriate @xmath95 .",
    "the mass @xmath95 is usually the mass of the interloping planetesimal @xmath30 , but can take different values for convenience as follows : @xmath100 & \\mbox{case ( a ) ; $ k_{jb } > 0 $ } , \\\\   k_j m_{j}/k_i & \\mbox{case ( b ) ; $ k_{jb } = 0 $ } , \\end{array}\\right .",
    "\\label{eq : delm}\\ ] ] where int ( ) means the decimals are dropped off for the number in the parentheses .",
    "the form in the upper row of eq .",
    "( [ eq : delm ] ) means that if @xmath30 is smaller than the threshold mass , we do not consider individual collisions but the accumulated mass change of the target planetesimal .",
    "we adopt the threshold mass of @xmath101 .",
    "we first estimate the post - collision mass of the interloper @xmath102 using eq .",
    "( [ eq : inte ] ) and @xmath95 for case ( a ) of eq .",
    "( [ eq : delm ] ) for any interlopers .",
    "if the resulting mass , @xmath102 , is found to be smaller than the lower limit of the tracer mass , @xmath6 , we use @xmath95 of case ( b ) given by the lower row in eq .",
    "( [ eq : delm ] ) instead of that of case ( a ) .",
    "if a collision occurs for case ( b ) , all the planetesimals in the interloper @xmath27 merge with those in the target @xmath1 and the interloper is deleted .",
    "therefore , the mass of any tracer is kept to be lager than @xmath6 .",
    "while we adopt @xmath103 , this value can be arbitrarily chosen : a small lower limit may be able to give accurate mass evolution while increase of the number of tracers can be suppressed with a large lower limit .",
    "the procedure to change masses and orbital elements of planetesimals due to collisional merging is schematically summarized in fig .  4 . for case ( a ) in eq .",
    "( [ eq : delm ] ) , in which @xmath104 and @xmath105 , only some of planetesimals in the interloper @xmath27 collide with planetesimals in the target @xmath1 . in this case",
    ", we split the interloper @xmath27 into two tracers : the interloper @xmath27 and the impactor .",
    "the number of planetesimals in the interloper after the split is given by @xmath106 in eq .",
    "( [ eq : inte ] ) and the position and velocity of the post - split interloper are unchanged during the collision between the target and the impactor . for case",
    "( b ) , all the planetesimal in the interloper are involved in the collision and we call the interloper the impactor . in both cases , the planetesimal mass and the number of planetesimals in the impactor",
    "are given by @xmath95 and @xmath3 , respectively , and the collision process is almost the same except some small differences .",
    "schematic illustration of the procedure to handle collisional merging between planetesimals in two tracers ( the target and the interloper ) .",
    "the figure shows how the masses of planetesimal ( @xmath2 and @xmath30 ) , the numbers of planetesimals in the tracers ( @xmath3 and @xmath107 ) , the semimajor axes ( @xmath36 and @xmath53 ) , and the orbital eccentricities ( @xmath48 and @xmath54 ) change during the procedure .",
    "when the target and the impactor are judged to collide , they do not physically contact each other .",
    "even their stream lines do not usually cross each other . since we assume uniformity in semimajor axis of an interloper , it is possible to make two stream lines cross each other by changing the semi - major axis of the impactor without changing other orbital elements .",
    "the crossing point of the stream lines is the location where the impact takes place .",
    "this impact point can be found as follows .",
    "first , @xmath22 and @xmath108 of the target and the impactor are aligned by changing the true anomaly of the target @xmath109 by @xmath110 and that for the impactor @xmath111 by @xmath112 .",
    "the angular changes , @xmath110 and @xmath112 , are derived by solving the following set of equations : @xmath113 where @xmath114 is the longitude of the impacting position measured from the reference direction @xmath115 .",
    "( [ eq : xx0 ] ) and ( [ eq : xx ] ) give two solutions for @xmath110 mutually shifted by @xmath116 , and we choose one with a smaller absolute value .",
    "then , the true anomalies are changed by moving the colliding pair along their keplerian orbits .",
    "second , the semimajor axis of the impactor is scaled by @xmath117 .",
    "this is done by scaling the impactor position by @xmath117 and the velocity by @xmath118 .",
    "the positions of the target and the impactor become almost identical through these procedures without changing their eccentricity and inclination vectors .",
    "then , the merging between the target and the impactor takes place . the position and velocity of the target after the merging with the impactor",
    "are given by the mass weighted mean values ( i.e. , the mass center for the position ) .",
    "after that , the semi - major axis of the target is adjusted to @xmath119 by scaling the position and the velocity so that the @xmath120-component of the total orbital angular momentum of the target and the interloper is conserved during the merging : @xmath121 where @xmath122 and @xmath123 are the orbital eccentricity and inclination of the target after the merging .    if the target tracer mass is equal to or exceeds the upper limit , @xmath124 , we split it into two tracers .",
    "if @xmath125 and @xmath126 , we also split the tracer to avoid simultaneous emerging of two sub - embryos .",
    "the numbers of planetesimals in the split tracers are given by @xmath127 if @xmath128 is even , and @xmath129 if @xmath128 is odd .",
    "we give weak velocity changes , symmetrically in momenta , to the two new tracers so that their relative eccentricity and inclination are about @xmath85 .",
    "this will avoid an encounter velocity artificially too low between them in the next encounter .",
    "the semi - major axes of the two tracers are adjusted so that the orbital separation between two tracers is randomly chosen between 0 to @xmath23 but the @xmath120-component of the total orbital angular momentum is conserved . for case",
    "( b ) , we set the semi - major axis of one of the new tracers be the one for the deleted interloper instead of choosing the orbital separation randomly . finally ,",
    "the true anomalies of the two tracers ( or one if no splitting is made ) are changed by @xmath130 and @xmath131 .    through the processes described above , tracer masses remain between @xmath6 and @xmath5 .",
    "the number of tracers remains unchanged or increases for case ( a ) of eq .",
    "( [ eq : delm ] ) whereas it remains unchanged or decreases for case ( b ) . as a result , the total number of tracers remains similar to the initial value even after many collisions between planetesimals .",
    "our several experiments show that increase of the tracer number from the initial value is suppressed less than 30@xmath132 in most cases .",
    "our current code also has an option of hit - and - run collisions and the procedure is described in detail in appendix  e. in this case , neither the number of planetesimals nor that of tracers changes .",
    "the orbital elements of planetesimals evolve due to gravitational interactions between them .",
    "the interactions are separated into viscous stirring ( vs ) and dynamical friction ( df ) .",
    "viscous stirring increases eccentricities and inclinations in expense of the tidal potential ( i.e. , radial diffusion ) and dynamical friction leads to energy equipartition between particles ( ida , 1990 , stewart and ida , 2000 ; ohtsuki et al . , 2002 ) .",
    "dynamical friction can be separated into stirring and damping parts ( dfs and dfd ) and sometimes the latter part only is called dynamical friction ( binney and tremaine , 1987 ; rafikov , 2003 ; ldt12 ) .",
    "we handle the stirring and damping parts of dynamical friction separately as shown below .",
    "the evolution of eccentricity @xmath48 and inclination @xmath49 of the target @xmath1 due to viscous stirring and dynamical friction caused by interactions with the interloper @xmath27 is given as ( ida , 1990 ; tanaka and ida , 1996 ) @xmath133 where @xmath134 , @xmath135 , @xmath136 , @xmath137 , and @xmath138 are the non - dimensional rates of viscous stirring and dynamical friction .",
    "the expressions of these rates are given in appendix b.2 .",
    "since we do not assume uniformities of @xmath89 and @xmath90 to handle eccentric and/or inclined ringlets , as discussed in section  2.3 , the terms with these relative angles remain in the expressions for dynamical friction .",
    "the way to split dynamical friction into the two terms is explained in detail in appendix  c.    the evolutions of @xmath48 due to viscous stirring and dynamical friction are then given as @xmath139 similar expressions can be obtained for @xmath49 .",
    "mutual encounters between planetesimals causes random walk in their semimajor axes .",
    "the radial diffusion coefficient @xmath140 for the target @xmath1 is approximately given by ( appendix  d ) @xmath141 .",
    "\\label{eq : di0}\\ ] ] ignoring the effect of curvature , the probability function of the change in @xmath36 after the time step @xmath17 is given by @xmath142 where the function is normalized as @xmath143 .",
    "we choose @xmath144 at random with a weight given by @xmath145 . if @xmath146 , we set @xmath147 .",
    "this is rare but can occur if @xmath148 .",
    "the stirring and damping rates of orbital elements need to be converted into the acceleration of the tracer . since the time step for the statistical routine @xmath17 is usually much smaller than the stirring time , @xmath149 , the absolute values of the changes in the orbital elements during @xmath17 are much smaller than the magnitudes of the orbital elements themselves .",
    "consider a situation that encounters between planetesimals occur randomly in directions of velocities .",
    "a certain acceleration occurs to a planetesimal in an encounter , and in another encounter an acceleration with the same magnitude to the first encounter but in the opposite direction can occur . in first order ,",
    "the changes of orbital elements cancel out in these two encounters . however , in second order , the orbital eccentricity and inclination increase a little on average , because the orbital elements are slightly changed after the first encounter .",
    "this is the way how viscous stirring works , and to handle it , we introduce second order gauss planetary equations .",
    "the stirring part of dynamical friction is also handled by these equations .",
    "on the other hand , the damping part of dynamical friction is handled by the standard gauss planetary equations of first order ( e.g. , murray and dermott , 1999 ) .",
    "if we use the standard gauss planetary equations for the stirring part of dynamical friction , the standard deviations of orbital eccentricity and inclination become unphysically small for equal - mass planetesimals or mass - dependent segregation of these orbital elements occurs for a case of a mass distribution .",
    "we assume that @xmath150 and @xmath151 in the following formulation .",
    "note that these assumptions are already used in hill s approximation .    in this subsection",
    "only , we drop the subscript @xmath1 for the tracer @xmath1 to avoid long , confusing subscripts .",
    "the expected changes of orbital elements during the time step @xmath17 are @xmath152 , @xmath153 , @xmath154 , @xmath155 , and @xmath156 , where @xmath157 , @xmath158 , @xmath159 , and similar expressions are obtained for the inclination .",
    "the change of the velocity vector is split into three components as @xmath160 where @xmath161 and @xmath162 are the components of the velocity change in the radial and tangential directions in the orbital plane , @xmath163 is the velocity change normal to the orbital plane , @xmath164 , @xmath165 , and @xmath166 are unit vectors .",
    "the velocity vector of the tracer itself is given as @xmath167 , where @xmath168 and @xmath169 are the radial and tangential components .",
    "all the components of the velocity change are further split into the stirring and damping terms with subscripts s and d , respectively : @xmath170 in our stirring routine , all the components of the stirring part are chosen using random numbers , but their averaged functional forms follow gaussian distributions with the zero mean values : @xmath171 , where the angle brackets in this subsection mean averaging over multiple velocity changes . the acceleration due to an individual encounter may not necessarily follow gaussian . on the other hand , since we handle the time averaged accelerations of tracers due to multiple encounters that occur in a random fashion , their distributions are limited to gaussian .",
    "first we consider the velocity changes in the orbital plane .",
    "the energy conservation gives the following equation , if we take up to the second order terms @xmath172 where @xmath173 .",
    "if we ignore the second order terms and the first term in the r.h.s . of eq .",
    "( [ eq : enec ] ) as @xmath174 , this gives @xmath175 as @xmath176 note again that @xmath152 is given by eq .",
    "( [ eq : pda ] ) and thus @xmath175 is gaussian .",
    "the angular momentum conservation gives @xmath177 where @xmath178 is the change of @xmath179 and @xmath180 is the distance from the central star .",
    "inserting eq .",
    "( [ eq : angc ] ) into eq .",
    "( [ eq : enec ] ) , we have @xmath181    averaging eq .",
    "( [ eq : angc2 ] ) over time , the first order terms vanish and we have only the second order terms . using @xmath182 , we have @xmath183 where we used @xmath184 and @xmath185 [ @xmath186 ; eq .",
    "( [ eq : di0 ] ) or eq .",
    "( [ eq : db2 ] ) ] , and ignored the term proportional to @xmath187 as it is small enough as compared with other terms for @xmath188 . inserting @xmath189 into eq .",
    "( [ eq : de2 ] ) , we have @xmath190 we give @xmath191 assuming it is gaussian .",
    "if the r.h.s side of eq .  ( [ eq : vrs ] ) is negative , we set @xmath192 , add the r.h.s divided by @xmath193 to @xmath194 , and re - calculate @xmath154 , which will be handled as shown below .",
    "this occurs in the shear dominant regime [ @xmath195 .    to give the velocity changes @xmath196 and @xmath197 for the damping parts of dynamical friction , we use the standard first order gauss planetary equation for @xmath179 ( murray and dermott , 1999 ) that can also be derived from eq .",
    "( [ eq : angc2 ] ) : @xmath198 , \\label{eq : dedf}\\ ] ] where @xmath87 and @xmath199 are the true and eccentric anomalies .",
    "we employ the following forms @xmath200 setting @xmath201 in eq .",
    "( [ eq : dedf ] ) , we have @xmath202 where we assumed @xmath203 .",
    "next , we consider the velocity change perpendicular to the orbital plane .",
    "the specific angular momentum vector @xmath204 after the velocity change @xmath163 in the inertial cartesian coordinate system are given as @xmath205 where @xmath206 , @xmath207 , @xmath208 , and @xmath209 are the rotation matrices given by eqs .",
    "( 2.119 ) and ( 2.120 ) of murray and dermott ( 1999 ) .",
    "using @xmath210 , the @xmath120-component of eq .",
    "( [ eq : ang4 ] ) is given as @xmath211 where @xmath212 is the change of @xmath1 and @xmath213 is the argument of pericenter .",
    "this equation leads to the standard gauss planetary equation for @xmath1 ( murray and dermott , 1999 ) , if we ignore the second order terms .",
    "averaging eq .",
    "( [ eq : ang5 ] ) over time , the first term in the r.h.s . vanishes . setting the mean change of @xmath214 as @xmath215 and using @xmath216 , we have @xmath217 we give @xmath218 , assuming it is gaussian . for the damping part of dynamical friction",
    ", we adopt the form @xmath219 ignoring the second order terms in eq .",
    "( [ eq : ang5 ] ) , and setting @xmath220 , we have @xmath221 where we took averaging over the orbital period and used @xmath222 .",
    "if the planetesimal mass @xmath2 is equal to or exceeds @xmath10 , the tracer is promoted to a sub - embryo .",
    "the acceleration of a sub - embryo due to gravitational interactions with a single planetesimal in a tracer is taken into account in the @xmath0-body routine to hold the correct mutual hill radius .",
    "on the other hand , the acceleration of the sub - embryo due to interactions with other @xmath223 planetesimals in the tracer is handled by the statistical routine .",
    "collisions of planetesimals with sub - embryos are also handled in the statistical routine .",
    "a large embryo tends to form a gap around in its feeding zone ( tanaka and ida , 1997 ) , although other nearby embryos , if they exit , tend to fill the gap .",
    "the surface density in the feeding zone usually decreases through this process .",
    "we take into account a possible difference of surface densities inside and outside of the feeding zone whereas spatial variation of the surface density inside of the feeding zone is not considered .",
    "this assumption allows us to still use the stirring and collision rates averaged over phases and semi - major axis for interactions between a sub - embryo and tracers .",
    "a collision between the sub - embryo @xmath1 and the tracer @xmath27 occurs only if @xmath224 , where @xmath225 is the jacobi integral of hill s equations given by @xmath226 where @xmath59 and @xmath227 is the half width of the feeding zone given by @xmath228 even if @xmath224 , collisions do not occur with trojans or if @xmath229 is too small ( see fig .  2 of ohtsuki and ida , 1998 ) .",
    "ida and nakazawa ( 1989 ) showed that collisions occur only if @xmath230^{1/2}a_ih_{ij},\\ ] ] where @xmath231 is the minimum orbital separation for occurrence of collision .",
    "we do not consider interactions with trojans in the statistical routine .",
    "planetesimals in the feeding zone ( @xmath224 and @xmath232 ) can potentially enter the hill sphere of the embryo and orbits of planetesimals are strongly deflected by close encounters with the embryo .    for tracer - tracer interactions ,",
    "the number density is calculated by eqs .",
    "( [ eq : ss ] ) and ( [ eq : nj ] ) .",
    "if a sub - embryo is the target , however , we search for planetesimals in the feeding zone .",
    "their surface number density is given by @xmath233 we miss some of tracers in the feeding zone if they are radially outside of the region @xmath1 of neighboring search .",
    "the factor @xmath234 in eq .",
    "( [ eq : nj2 ] ) is introduced to correct this effect , where @xmath235 is the orbital period of the tracer @xmath27 , and @xmath236 is the period in which the tracer @xmath27 is radially in the region @xmath1 during @xmath235 provided that the tracer @xmath27 is azimuthally in the range of the region @xmath1 .",
    "the expression of @xmath236 is given in appendix  f. in the stirring routine , we use @xmath223 in eq .",
    "( [ eq : nj2 ] ) instead of @xmath107 as the back reaction from a single planetesimal is taken into account in the @xmath0-body routine .",
    "using eq .",
    "( [ eq : nj2 ] ) , collisional growth and velocity changes of sub - embryos are handled in the statistical routine in the same manner as tracer - tracer interactions .",
    "if there is no spatial density variation between the inside and outside of the feeding zone , the same collision and stirring rates are derived whether the target is a tracer or a sub - embryo .",
    "even if the mutual distance between the centers of a tracer and a sub - embryo is less than the sum of the radii of the constituent planetesimal and the sub - embryo , orbital integrations of both bodies are continued in the @xmath0-body routine using softened forces that avoid singularity .",
    "we employ the k1 kernel of dehnen ( 2001 ) for the softening .",
    "gravitational interactions occur even if @xmath237 due to distant encounters ( weidenschilling 1989 , hasegawa and nakazawa , 1990 ) .",
    "we evaluate the change rates of the orbital elements of the sub - embryo due to individual distant encounters without assuming uniformity in @xmath63 .",
    "let the changes of the squared relative orbital eccentricity and inclination due to a single distant encounter be @xmath238 and @xmath239 . hasegawa and nakazawa ( 1990 ) derived the changes @xmath240 and @xmath241 averaged over @xmath71 and @xmath72 [ their eqs .",
    "( 38 ) and ( 39 ) ] .",
    "the averaged changes of @xmath242 and @xmath243 of the sub - embryo @xmath1 during a single encounter with a planetesimal in the interloper @xmath27 are given by @xmath244 and @xmath245 ( ida , 1990 ) .",
    "using the keplerian shear velocity given by ( bromley and kenyon , 2011 ) @xmath246 the frequency of encounters is given as @xmath247 , where we used eq .",
    "( [ eq : nj ] ) and @xmath23 in this case is the radial extent of planetesimals in the tracer @xmath27 and is assumed to be infinitesimally small .",
    "the change rates of @xmath242 and @xmath243 due to distant encounters with the interloper @xmath27 are then given as @xmath248 where @xmath249 and @xmath250 .",
    "the rates given by eqs .",
    "( [ eq : dedis ] ) and ( [ eq : didis ] ) are added to eqs .",
    "( [ eq : devs ] ) and ( [ eq : divs ] ) if @xmath237 .",
    "dynamical friction due to distant encounters is negligible ( ida , 1990 ) .",
    "an embryo gravitationally scatters surrounding planetesimals .",
    "back reaction on the embryo causes its radial migration .",
    "individual gravitational encounters usually cause a random walk of the embryo .",
    "however , if the accumulated torque is not cancelled out , the embryo migrates over a long distance .",
    "this is called planetesimal - driven migration ( ida et al . , 2000 ;",
    "kirsh et al . ,",
    "planetesimal - driven migration of full - embryos is automatically taken into account in the @xmath0-body routine .",
    "we developed a unique method to handle planetesimal - driven migration of sub - embryos explained in the following .    in our code , the angular momentum change @xmath251 of the sub - embryo @xmath1 due to gravitational interactions with tracers during @xmath17 is stored in the @xmath0-body routine . if @xmath251 is released instantaneously by giving the tangential acceleration , the sub - embryo may migrate unrealistically too fast due to strong kicks from tracers that have masses similar to the sub - embryo .",
    "the direction of migration may change rapidly in such a situation .",
    "this problem can be avoided by limiting the angular momentum released during @xmath17 to the theoretical prediction , @xmath252 , derived from the statistical routine . if @xmath253 , @xmath251 is fully released .",
    "if @xmath254 , on the other hand , the remaining portion @xmath255 is added to @xmath251 stored during the next time step interval .",
    "what is done by the scheme is basically time averaging of the torque on the sub - embryo over a timescale much longer than @xmath17 so that strong spikes of the torque due to close encounters are smoothed out .",
    "more explanations are given in section  3.3 , together with test results .",
    "the predicted angular momentum change , @xmath252 , is determined from the surface density and velocities of planetesimals in neighboring tracers .",
    "bromley and kenyon ( 2011 , 2013 ) and ormel et al . ( 2012 ) showed three different modes of planetesimal - driven migration , referred to as type i  iii migration analogous to gas - driven migration .",
    "type i and iii migration occurs when an embryo interacts with planetesimals in close encounters .",
    "type i migration is considered to occur when the velocity dispersion of planetesimals is large , and its migration rate is very slow as is determined by the difference between torques from outer and inner disks . on the other hand , type iii migration is fast self - sustained migration that occurs when the velocity dispersion of planetesimals is relatively small , and the embryo migrates due to the torque from the one side ( inner or outer side ) of the disk , leaving a relatively enhanced disk in the other side ( ida et al . , 2000 ;",
    "kirsh et al .",
    ", 2009 ; levison et al . , 2010 ; capobianco et al . , 2011 ) .",
    "we ignore type i migration in the evaluation below , as the migration rate is well represented by the formula for type iii migration even at large velocity dispersions ( kirsh et al .",
    ", 2009 ; bromley and kenyon , 2011 ) .",
    "type ii migration occurs when an embryo opens up a gap in the planetesimal disk so the torque is primarily from planetesimals in distant encounters .",
    "this torque is particularly important if the asymmetries of the surface density and the velocity dispersion between the inner and outer disks are large .",
    "such a situation occurs if an embryo in a gaseous disk shepherds outer small planetesimals that rapidly spiral toward the central star without the embryo .",
    "the radial migration rate of type iii planetesimal - driven migration due to an interaction with the tracer @xmath27 is ( ida et al . , 2000 )",
    "@xmath256 where the sign is positive if @xmath257 and vice versa , and @xmath258 is the non - dimensional migration rate given in appendix  b.3 . if @xmath259 stored in the @xmath0-body routine is positive / negative , we count only tracers with semimajor axes larger / smaller than @xmath36 because planetesimals in close encounters cause attractive forces . in the evaluation of @xmath29 in eq .",
    "( [ eq : dat3j ] ) , we use @xmath260 instead of @xmath31 used in eq .",
    "( [ eq : nj ] ) .",
    "the type iii migration rate is then given as @xmath261 where @xmath262 is the factor that represents slowing down for massive embryos .",
    "the slowing down occurs when the embryo can not migrate over the feeding zone during the synodic period for that width , as cancellation of angular momentum exchange occurs in the second encounter ( ida et al . , 2000 , kirsh et al . , 2009 ) .",
    "bromley and kenyon ( 2011 ) showed that the slowing down factor is given by a migration length during the synodic period for the half - width of the feeding zone @xmath263 relative to @xmath263 , if this ratio is less than unity : @xmath264 .",
    "\\label{eq : slow}\\ ] ] we employ @xmath265 after bromley and kenyon ( 2011 ) .",
    "this length is somewhat shorter than the actual half - length of the feeding zone , @xmath227 [ eq .  ( [ eq : de0 ] ) ] , and the reason for this value being applied is because the strong attractive force comes from a relatively narrow region . if the embryo mass is small enough , @xmath266 ; in this regime , the migration rate is independent of the embryo mass .    one may think that the migration rate can be simply estimated by summing up the torques from both sides in eqs .",
    "( [ eq : dat3j ] ) and ( [ eq : dat3 ] ) rather than summing up for one side and that @xmath259 calculated in the @xmath0-body routine is unnecessary .",
    "however , we find that such an approach can work only if the embryo is massive enough so that @xmath267 . in this case",
    ", the all tracers in the feeding zone strongly interact with the embryo and this produces large velocity asymmetry between the unperturbed side and the other side that the embryo migrated through . on the other hand ,",
    "if the embryo is small , it migrates over the feeding zone through interactions with a small fraction of tracers in the feeding zone , and only small velocity asymmetry is produced .",
    "in such a situation , the evaluated torques from both sides roughly cancel out each other and the fast migration can not be reproduced .",
    "if we evaluate the torques from tracers in an azimuthally limited region , where velocity asymmetry exists , summation of both sides may work .",
    "however , an appropriate choice of the azimuthal width is unclear to us and the number of tracers in a narrow region is too few to give a reliable migration rate .",
    "this is why we evaluate the migration rate due to the one - sided torque as an upper limit , while the actual angular momentum change is evaluated in the @xmath0-body routine .    for type ii migration",
    ", we evaluate the torques from tracers in both sides of the disk as done for the stirring rate due to distant encounters . the change in the semimajor axis difference , @xmath268 , during a single encounter for @xmath269",
    "is given as ( bromley and kenyon , 2011 ) @xmath270 where @xmath271 and @xmath272 .",
    "this formula is expected to be independent of @xmath81 and @xmath82 after averaged over @xmath71 and @xmath72 ( hasegawa and nakazawa , 1990 ) . in a similar manner of eq .",
    "( [ eq : dedis ] ) , the change rate of the semimajor axis of the embryo is given as @xmath273 the type ii migration rate is then given as @xmath274 if the surface density is symmetric for the inner and outer disk , the first term in the parentheses in the r.h.s .",
    "( [ eq : dat20 ] ) vanishes after summation . in this case",
    ", the embryo slowly migrate inward .",
    "if density asymmetry exists , the first term remains and relatively fast migration takes place in either inward or outward direction .",
    "the migration rate of the embryo suggested from the statistical routine is given as @xmath275 the predicted angular momentum change during @xmath17 is given as @xmath276 where @xmath277 is the angular momentum of the sub - embryo . to produce smooth type iii migration , at least a few , preferably @xmath278",
    ", tracers need to exist constantly in the feeding zone in the region @xmath1 . if we choose a very small @xmath24 for the region @xmath1 , that makes sub - embryo migration noisy .",
    "we find that a large @xmath259 sometimes remains unreleased even when an embryo reaches a disk edge .",
    "this usually causes the embryo migrate artificially further away from the disk edge . to avoid this problem ,",
    "we remove @xmath259 quickly on the timescale of @xmath279 orbital periods at the disk edge , although this violates conservation of the total angular momentum of the system .",
    "we regard the embryo being at the disk edge if the total mass of tracers in the feeding zone ahead of the embryo in the migrating direction is less than the embryo mass . for a small embryo ,",
    "sometimes no tracer exists in the feeding zone due to statistical fluctuations even if the embryo is not at the disk edge . to avoid this issue , we also count tracers within @xmath280 ahead of the embryo even if they are not in the feeding zone .",
    "the global gravitational forces of tracers are added to the equations of motion for tracers and sub - embryos . to calculate the forces , we assume that the disk is axisymmetric and the vertical distribution is given by gaussian for tracers . for simplicity , at each radial location",
    ", we consider only one scale height of tracers with various planetesimal masses whereas in reality different mass groups have different scale heights .",
    "the scale height of planetesimals in a radial grid at @xmath281 is given by @xmath282 where the summation is done for each radial bin , and the total mass of the tracers @xmath283 in the grid is @xmath284 the surface density of tracers are given by @xmath285 , where @xmath286 is the radial grid width .",
    "the spatial density of tracers is given as @xmath287    the @xmath281 and @xmath120 components of the tracers global gravitational force are given by ( nagasawa et al .",
    ", 2000 ) @xmath288 dr'dz ' \\nonumber \\\\ f_{{\\rm tr } , z}(r , z ) & = & -4 g   \\int^{\\infty}_{-\\infty } \\int_{r ' } \\frac{\\rho_{\\rm tr}(r',z')r'(z - z')}{\\sqrt{(r+r')^2 + ( z - z')^2 } } \\nonumber \\\\ & & \\times \\left[\\frac{e(\\xi)}{(r - r')^2 + ( z - z')^2}\\right]dr'dz',\\end{aligned}\\ ] ] where @xmath289 is the gravitational constant , @xmath290 and @xmath291 are the first and second kind of elliptic integrals , and @xmath292 is given by @xmath293 these components of the force are tabulated in ( @xmath294 ) grids and interpolated for use in simulations . for the accelerations on sub - embryos",
    ", @xmath295 is used instead of @xmath3 in eqs .",
    "( [ eq : htr ] ) and ( [ eq : mtr ] ) .",
    "it is not necessary to calculate the global gravitational force components frequently and we usually update them every @xmath296 times the shortest orbital period of particles .",
    "the global gravitational force modifies the precession rates of the longitudes of pericenter and ascending node ; it usually accelerates the absolute precession rates .",
    "the precession rates do not usually matter to dynamics of tracers in terms of such as encounter velocities .",
    "these rates are , however , likely to be important for stability of the system , when multiple sub - embryos appear in the system .",
    "the embryos mutually interact through secular resonances which cause oscillations in eccentricities and inclinations of embryos .",
    "the global gravitational force reduces these oscillation periods . as a result ,",
    "the maximum eccentricities and inclinations of sub - embryos during the oscillations are suppressed to relatively small values .",
    "we identify this effect in simulations in section  3.5 ( results without the global gravitational force are not shown there , though ) .",
    "although its effect is much smaller than dynamical friction , it does not seem to be negligible .",
    "[ cols=\"^,^,^,^,^,^,^ \" , ]     table  1 .",
    "parameters used for hybrid simulations .",
    "theme is a very brief expression of what experiments are performed .",
    "@xmath297 is the initial total mass of planetesimals .",
    "region represents the initial inner and outer edges of the planetesimal disk .",
    "@xmath298 is the power - law exponent for the surface density of planetesimals ( @xmath299 ) .",
    "@xmath0 is the initial number of planetesimals .",
    "@xmath300 is the initial total number of tracers .",
    "@xmath301 is the initial number of embryos ( @xmath302 means that no embryo is introduced in the initial state but embryos appear as a result of collisional growth ) .",
    "@xmath303 is the initial root - mean - square eccentricity of tracers .",
    "@xmath15 is the time step for orbital integrations .",
    "@xmath24 is the angular half - width of the region used in neighboring search ( fig .  2 ) .",
    "collision represents collisional outcome .",
    "gas disk represents whether damping effects due to a gas disk are taken into account . in all the simulations , the physical density of any body is 2.0 g @xmath304 .",
    "the initial distributions of @xmath179 and @xmath1 are given by the rayleigh distributions with @xmath303 = 2@xmath305 .",
    "we show six different types of tests of the hybrid code : collisional damping and stirring ( section  3.1 ) , gravitational scattering and radial diffusion ( section  3.2 ) , planetesimal - driven migration of sub - embryos ( section  3.3 ) , runaway to oligarchic growth ( section  3.4 ) , accretion of terrestrial planets from narrow annuli ( section  3.5 ) , and accretion of cores of jovian planets ( section  3.6 ) .",
    "the parameters used in the test simulations are summarized in table  1 .",
    "time evolution of @xmath303 and @xmath305 of planetesimals due to mutual collisions only for ( a ) @xmath306 = 0 and ( b ) @xmath306 = 0.8 .",
    "all effects related to mutual gravity are ignored . the total number of planetesimals is @xmath307 represented by 2000 ( solid curves ) and 500 ( dotted curves ) tracers .",
    "planetesimals are placed between 0.95 au and 1.05 au and the total mass is 0.1 @xmath308 . in the hybrid simulations",
    ", we only use tracers between 0.96 and 1.04 au in calculations of @xmath303 and @xmath305 to avoid the effect due to radial expansion .",
    "evolution curves calculated using the analytic formula ( ohtsuki , 1999 ) are also shown by dashed curves for comparison . in the panel ( b ) , @xmath306 = 0.72 is used for the analytic curves .    the first test we present is velocity evolution of tracers due to mutual collisions only to check whether the collision probability and the velocity changes at collisions are calculated accurately .",
    "all mutual - gravity related effects are ignored in the test : gravitational scattering , gravitational focusing in the collisional probability [ the second term in the bracket of the r.h.s of eq .",
    "( [ eq : pcol ] ) ] , and enhancement of the impact velocity ( appendix  e.2 ) .",
    "collisions are assumed to result in inelastic re - bounds ( hit - and - run collisions ) , and post collision velocities are characterized by the normal and tangential restitution coefficients , @xmath306 and @xmath309 .",
    "appendix  e.2 explains how to handle hit - and - run collisions between planetesimals in two tracers , with assumptions of @xmath310 and @xmath311 [ see eq .",
    "( [ eq : vnd ] ) for more detail ] .",
    "these coefficients , however , can be modified to any values . in the tests , we assume no friction ( i.e. , @xmath311 ) . collisional velocity evolution is a well - studied problem for planetary rings and several authors have developed analytical formulae ( goldreich and tremaine , 1978 ; hmeen - antilla , 1978 ; ohtsuki , 1992 , 1999 ) .",
    "we compare our simulation results with analytic estimates of ohtsuki ( 1999 ) because of the easiness of use .",
    "figure  5 shows the time evolution of @xmath303 and @xmath305 of @xmath307 planetesimals for ( a ) @xmath306 = 0 and ( b ) @xmath306 = 0.8 .",
    "the radius of all planetesimals is 0.4 km .",
    "the planetesimal disk extends from 0.95 to 1.05 au and its total mass is 0.1 @xmath308 .",
    "these parameters give the disk normal optical depth of @xmath312 .",
    "two simulations are performed to see resolution effects for both fig .",
    "5a and 5b : one with @xmath313 and @xmath314 and another one with @xmath315 and @xmath316 , where @xmath300 is the total number of tracers . the total angular momentum , @xmath317 , is well conserved for all test simulations shown in fig .  5 ; @xmath318 .    for @xmath310 ( fig .",
    "5a ) , we find excellent agreements between our results and the analytic estimates of ohtsuki ( 1999 ) , in particular for the case of @xmath319 .",
    "however , the decreases in @xmath303 and @xmath305 stall at certain values in hybrid simulations  @xmath320 for @xmath319 ( 500 )  whereas in the analytic curves , @xmath179 and @xmath1 decrease down to @xmath321 , where @xmath322 is the particle radius . in the hybrid simulations , eccentric ringlets form , in which the longitudes of pericenter of all particles are nearly aligned . this issue is probably related to the initial condition . in creation of the initial positions and velocities , the longitudes of pericenter",
    "are randomly chosen , and the sum of the eccentricity vectors of all tracers is not exactly zero .",
    "the eccentricities of the ringlets in the end state are , in fact , close to the expected values of the residual eccentricity , @xmath323 . since the residual eccentricity decreases with increasing the number of tracers , the eccentricity of the ringlet in the end state decreases .",
    "even if the residual eccentricity is fixed to be zero , the same problem is likely to occur unless all particles effectively interact with each other .",
    "the ringlets are not only eccentric but also inclined because a similar discussion is applied to inclination .",
    "the evolution curves of @xmath179 and @xmath1 also weakly depends on @xmath24 ; a small @xmath24 gives a better agreement with the analytic curves .",
    "it is found that relative velocities are slightly underestimated if @xmath24 is large and radial excursions of particles are larger than @xmath23 .",
    "this leads a slightly lower damping rate .",
    "collisions cause not only damping but also stirring as the collisional viscosity converts the tidal potential to the kinetic energy .",
    "if @xmath324 , where @xmath325 is the critical restitution coefficient , the stirring rate exceeds the damping rate and @xmath303 and @xmath305 increase with collisions ( goldreich and tremaine , 1978 ; ohtsuki , 1999 ) .",
    "we find that our method is slightly more dissipative than the analytic estimate and gives @xmath326 for reasons that we were not able to figure out .",
    "figure  5b shows the same as fig .",
    "5a but for the case of @xmath327 .",
    "it is found that our result for @xmath327 and @xmath313 ( 500 ) well agrees with the analytic estimate with @xmath328 ( 0.70 ) .",
    "overall , our method can reproduce analytic results using a @xmath329 higher @xmath306 . in simulations of planetary accretion , we use @xmath310 for hit - and - run collisions and",
    "the offset in @xmath306 is not a problem .",
    "note that orbital alignments do not occur for the case of fig .  5b , because collisional stirring randomizes orbital phases .",
    "fig .  6 .        fig .",
    "time evolution of @xmath303 and @xmath305 of planetesimals due to gravitational interactions : ( a ) @xmath330 , @xmath331 , @xmath332 , ( b ) @xmath333 , @xmath331 , @xmath332 , and ( c ) @xmath334 , @xmath335 , @xmath336 ( see table  1 for the characters ) .",
    "the panel ( c ) is the case of the bimodal size distribution with @xmath337 , @xmath338 , @xmath339 , and @xmath340 , where the characters with the subscripts 1 and 2 are those for small and large planetesimals , and the mass ratio of a large planetesimal to a small one is 5 . in all cases ,",
    "planetesimals are placed between 0.95 au and 1.05 au , and @xmath303 and @xmath305 are calculated using tracers between 0.96 au and 1.04 au .",
    "evolution curves calculated using the analytic formula ( ohtsuki et al . , 2002 ) and from the pure @xmath0-body simulations ( only for the panels ( a ) and ( c ) ) are also shown for comparison .",
    "fig .  7 .",
    "snapshots on the @xmath341 plane for the simulations shown in fig .",
    "6a : ( a ) the hybrid simulation and ( b ) the pure @xmath0-body simulation .",
    "time evolutions of the standard deviation of @xmath342 for the simulations shown in fig .  7 .",
    "results for six individual hybrid simulations are shown by colored dotted curves , whereas their mean value is shown by a black solid curve .",
    "the result for the hybrid simulation shown in fig .",
    "7a is a black dotted curve . for comparison , the result from the pure n - body simulation ( fig .",
    "7b ) is shown by a black dashed curve .",
    "the next test we present is velocity evolution of tracers due to mutual gravity only in the absence of any collisional effects .",
    "figure  6 shows evolution of @xmath303 and @xmath305 for a planetesimal disk extending from 0.95 and 1.05 au .",
    "the panels ( a ) and ( b ) are for mono - sized planetesimals represented by 200 tracers and the numbers of planetesimals @xmath0 are @xmath343 and @xmath344 , respectively .",
    "the panel ( c ) is for a bimodal size distribution case ; 1500 small planetesimals and 200 large planetesimals are placed in the disk .",
    "the mass ratio of a large planetesimal to a small one is 5 .",
    "the number of tracers for small planetesimals is 150 and that for large planetesimals is 100 .",
    "the results are compared with analytic estimates of ohtsuki et al .",
    "for the panels ( a ) and ( c ) , we also performed pure @xmath0-body simulations using the parallel - tree code pkdgrav2 ( morishima et al . , 2010 ) with the same initial conditions .",
    "the agreements between the analytic estimates and pure @xmath0-body simulation results are excellent , so results from both methods are trustable as benchmarks .",
    "overall , we find good agreements between the results from the hybrid code and the analytic estimates , although our model gives slightly lower @xmath303 and @xmath305 than the analytic estimates , except fig .",
    "6b shows a good agreement .",
    "we also perform the same hybrid simulations with different values of @xmath300 and @xmath24 , and the absolute levels of @xmath303 and @xmath305 at a certain time are found to be almost independent of these parameters , unless @xmath300 and @xmath24 are too small .",
    "the underestimates of @xmath303 and @xmath305 of our calculations is probably caused by the underestimates of @xmath136 and @xmath137 that we employ .",
    "the analytic calculations of tanaka and ida ( 1996 ) give slightly lower @xmath136 and @xmath137 for @xmath345 and @xmath346 than those from direct three - body orbital integrations ( ida , 1990 , rafikov and slepian , 2010 ) .",
    "the influence of this difference is less important for large @xmath347 and @xmath348 and that is why the hybrid simulation in fig .",
    "6b shows an excellent agreement with the analytic result , contrary to fig .",
    "figure  7 shows snapshots on the @xmath341 plane for the simulation of fig .",
    "snapshots of the corresponding pure @xmath0-body simulation are also shown for comparison .",
    "the hybrid code can reproduce not only @xmath303 and @xmath305 but also the distributions of @xmath179 and @xmath1 .",
    "ida and makino ( 1992 ) carried out @xmath0-body simulations and found that the distributions of @xmath179 and @xmath1 can be well approximated by a rayleigh distribution .",
    "we perform the kolmogorov - smirnov ( ks ) test to check whether the distributions of @xmath179 and @xmath1 in the hybrid simulations resemble a rayleigh distribution .",
    "the test gives the significance level , @xmath349 ( @xmath350 ) ( press et al . ,",
    "a large @xmath349 means that the likelihood that two functions are the same is high .",
    "the time - averaged ( @xmath351 yr ) values of @xmath349 for the distributions of @xmath179 and @xmath1 are 0.44 and 0.57 , respectively .",
    "we also perform the same ks test using the outputs of the pure @xmath0-body simulation , and the values of @xmath349 for @xmath179 and @xmath1 are 0.62 and 0.19 .",
    "thus , the distributions of @xmath179 and @xmath1 from our hybrid simulations resemble a rayleigh distribution at a level similar to those from pure @xmath0-body simulations .",
    "figure  7 also shows that a planetesimal disk radially expands with time due to viscous diffusion at a rate similar to that for the pure @xmath0-body simulation . to compare more quantitatively",
    ", we plot the time evolution of the standard deviation of @xmath342 ( the normalized orbital energy ) of the disk in fig .",
    "8 . since the radial diffusion of a low resolution hybrid simulation",
    "is found to be noisy , we take average over several simulations .",
    "the off - sets between simulations at @xmath352 are caused by random numbers that are used for choosing initial semimajor axes of tracers .",
    "we find a good agreement in the increasing rates of the standard deviations of @xmath342 between the hybrid simulations and the pure @xmath0-body simulation .",
    "this comparison indicates that the diffusion coefficient given by eq .",
    "( [ eq : di0 ] ) is a good approximation .",
    "contrary to collisional velocity evolution shown in section  3.1 , conservation of the angular momentum is violated by gravitational scattering as we do not explicitly solve pair - wise gravitational interactions in the statistical routine .",
    "provided that the radial migration distance of a tracer due to random walk is about @xmath353 , the error in the total angular momentum is estimated as @xmath354 , which we found consistent with the actual errors in the test simulations .",
    "fig .  9 .",
    "self - sustained ( type iii ) migration of a sub - embryo .",
    "we employ @xmath355 ( where @xmath2 is the embryo mass ) , @xmath356 , and @xmath357 .",
    "the embryo is displayed as a red filled circle with a horizontal bar with a half length of 10 hill radii .",
    "fig .  10 .",
    "time evolution of the semi - major axis of a sub - embryo due to self - sustained migration : ( a ) @xmath358 and @xmath359 , ( b ) @xmath360 and @xmath359 , and ( c ) @xmath358 and @xmath361 . for all cases , @xmath356 and @xmath362 .",
    "analytic migration rates ( bromley and kenyon , 2011 ) are shown by dashed lines .    in section  2.6.2",
    ", we described how we handle migration of sub - embryos . to test the routine of sub - embryo migration",
    ", we perform a suite of hybrid simulations starting with initial conditions similar to those in kirsh et al .",
    "( 2009 ) and bromley and kenyon ( 2011 ) .",
    "the initial planetesimal disk extends from 14.5 au to 35.5 au and its total mass is 230 @xmath308 represented by 230 tracers ( thus @xmath363 ) . a sub - embryo with a mass of @xmath2 is initially placed at 25 au and growth of the embryo is turned off . in this subsection , the index @xmath1 is given to a sub - embryo .",
    "each tracer has 10000 planetesimals and tracer - tracer interactions are quite small compared with gravitational effects of the embryo .",
    "an example of migration of an earth - mass embryo ( @xmath364 ) is shown in fig .",
    "9 using four snapshots on the @xmath365-@xmath179 plane . for this example , the migration is in the mass independent regime [ @xmath266 ; eq .",
    "( [ eq : slow ] ) ] .",
    "the embryo first has some strong encounters with tracers and a stirred region is produced .",
    "the embryo tends to migrate away from the stirred region due to strong torques exerted by tracers in the unperturbed region .",
    "this process trigers fast self - sustained migration . during the migration",
    ", the embryo continuously encounters with unperturbed tracers on the leading side while leaving the stirred tracers in the trailing side .",
    "the fast migration continues until the embryo reaches the disk edge .",
    "embryo migrations for three cases with different embryo masses and initial velocity dispersions are shown in fig .",
    "10 . in each case ,",
    "six simulations are performed , using different random number seeds to generate initial orbital elements of tracers .",
    "the migration rates suggested by bromley and kenyon ( 2011 ) are shown by dotted lines .",
    "they confirmed good agreements between their formula and @xmath0-body simulations .",
    "overall , our method can reproduce migration rates suggested by bromley and kenyon ( 2011 ) .",
    "however , our method gives almost the same probabilities of inward and outward migrations if @xmath366 , whereas @xmath0-body simulations show that inward migration is predominant ( kirsh et al .",
    ", 2009 ; bromley and kenyon , 2011 ) .",
    "if the embryo is small , the direction of migration is determined by first few strong encounters , and once migration starts it is self - sustained regardless of its direction .",
    "in realistic planetary accretion , even if inward migration is predominant , the embryo encounters with inner massive embryos and then turns its migration direction outward ( minton and levison , 2014 ) . therefore , we believe that the artificially high occurrence of outward migration is not a problem . for a large sub - embryo ,",
    "inward migration is clearly predominant even in our hybrid simulations ( fig .",
    "10c ) .    to understand these trends and why our method works , we consider conditions necessary to produce smooth self - sustained migration",
    ". if planetesimals are small enough compared with the embryo , smooth self - sustained migration of the embryo takes place ( ordered migration ) .",
    "if planetesimals are large , on the other hand , the embryo suffers strong kicks and the direction of its migration may change rapidly in a random fashion ( stochastic migration ) . whether migration is ordered or stochastic is determined by the size distribution of planetesimals .",
    "this argument is similar to that discussed for planetary spins ( dones and tremaine , 1993 ) .",
    "the relative contributions of the ordered and stochastic components are estimated as follows .",
    "consider that an embryo migrates over a distance @xmath367 through @xmath368 encounters with surrounding planetesimals : @xmath369 where again @xmath370 and @xmath371 is the change of @xmath98 @xmath372 $ ] during a single encounter . in the above ,",
    "the angle brackets mean the averaging over encountered planetesimals .",
    "the expected value of @xmath373 is given as @xmath374 ,     \\label{eq : stoch }                      \\end{aligned}\\ ] ] where we assume that @xmath375 and that there is no correlation between @xmath376 and @xmath371 to transform to the second row .",
    "if the first term in the r.h.s of eq .",
    "( [ eq : stoch ] ) is larger than the second term , the migration is stochastic rather than ordered .",
    "this means that the embryo is likely to migrate over @xmath367 via random walk rather than self - sustained migration .",
    "if we assume that the ordered torque exerted on the embryo is the one - sided ( type iii ) torque , @xmath377 is determined by the non - dimensional migration rate @xmath258 ( appendices  b.3 ) . the value of @xmath378 is estimated using the non - dimensional viscous stirring rates , @xmath136 and @xmath137 ( appendix  d ) , and we consider contribution of planetesimals in one side assuming that large velocity asymmetry exists .",
    "using these non - dimensional rates , we have @xmath379 .",
    "this ratio is @xmath380 for the shear dominant regime [ @xmath195 and @xmath381 for the dispersion dominant regime ( we assume @xmath382 ) .",
    "therefore , even with planetesimals as massive as the embryo ( @xmath383 ) , the migration is likely to be self - sustained migration rather than random walk if the embryo migrates longer than @xmath384 .",
    "this length is comparable to the feeding zone width .    in the above discussion",
    ", the planetesimal mass @xmath30 can be replaced by the tracer mass @xmath385 to discuss migration calculated in our @xmath0-body routine .",
    "therefore , our @xmath0-body routine can reproduce self - sustained migration of the embryo even with tracers as massive as the embryo .",
    "this is true only if the ordered torque exerted on the embryo is as strong as the one - sided torque .",
    "this is not always the case .",
    "the torque becomes nearly one - sided if a strong velocity asymmetry of planetesimals exists around the embryo .",
    "if the embryo jumps over its feeding zone due to a strong kick from a tracer that is as massive as the embryo , the embryo can not see velocity asymmetry at that radial location .",
    "thus , the condition to apply the one - sided torque is that radial migration distance of the embryo due to a single encounter is much smaller than its feeding zone .",
    "this condition generally turns out to be @xmath386 .",
    "it is likely that the condition @xmath387 or less recommended by various authors ( kirsh et al .",
    "2009 ; ldt12 ; minton and levison , 2014 ) comes from this criterion . in our method , alternatively , instantaneous large changes of @xmath36 of the sub - embryo are suppressed by limiting the migration distance of the sub - embryo to the theoretical prediction that is derived assuming that planetesimals are much less massive than the embryo .",
    "therefore , our method can reproduce a long distance self - sustained migration .",
    "the condition to reproduce predominant inward migration is more severe because we need to consider migration of an embryo due to torques from both sides of the disk . in an unperturbed state ,",
    "the total torque from both sides is order of @xmath85 of the one - sided torque in the shear dominant regime ( bromley and kenyon , 2011 ) and is order of @xmath81 of the one - sided torque in the dispersion dominant regime ( ormel et al . , 2012 ) .",
    "thus , ( @xmath388 ) is multiplied to the second term in the r.h.s .",
    "( [ eq : stoch ] ) .",
    "then , the condition that the migration is ordered when the embryo migrates over the feeding zone is roughly given by @xmath389 .",
    "the initial condition of fig .",
    "10c barely satisfies this criterion provided that @xmath30 is the tracer mass instead of the planetesimal mass .",
    "our method indeed reproduces predominant inward migration .",
    "once the embryo migrates over the feeding zone , velocity asymmetry is obvious and self - sustained migration immerses .",
    "snapshots on the @xmath341 plane for the hybrid simulations ; ( a ) @xmath300 = 400 and ( b ) @xmath300 = 4000 .",
    "tracers are displayed as colored circles and their colors represent the mass of a planetesimal as shown by the color bar .",
    "sub - embryos are displayed as red filled circles with a horizontal bar with a half length of 10 hill radii [ for the panel ( b ) , only sub - embryos more massive than @xmath390 have a horizontal bar for consistency with the panel ( a ) ] .",
    "a radius of a circle is proportional to @xmath391 .",
    "snapshots of the cumulative number and the horizontal velocity ( @xmath392 , where @xmath393 is the keplerian velocity at 1au ) for ( a ) @xmath300 = 400 and ( b ) @xmath300 = 4000 .",
    "the diagonal dashed line is the number of planetesimals represented by a single tracer with a mass of @xmath10 for each run .",
    "the vertical dotted line represents @xmath10 . for comparison ,",
    "the results from ( c ) wetherill and stewart ( 1993 ) and ( d ) inaba et al .",
    "( 2001 ) are shown ; both from fig .",
    "10 of inaba et al .",
    "( 2001 ) .",
    "fig .  12 . continued .",
    "most of the authors who developed statistical planetary accretion codes ( weidenschilling et al . , 1997 ;",
    "kenyon and luu , 1998 ; inaba et al .",
    ", 2001 ; morbidelli et al . , 2009 ; ormel et al . ,",
    "2010a ; ldt12 ; amaro - seoane et al . , 2014 ) tested their codes using fig .",
    "12 of wetherill and stewart ( 1993 ) as a benchmark .",
    "we also perform simulations starting with the same condition of wetherill and stewart ( 1993 ) .",
    "inaba et al .",
    "( 2001 ) performed the same statistical simulations using their own coagulation code and the code of wetherill and stewart ( 1993 ) after modifying settings of these two codes as close as possible .",
    "both results are shown in fig .",
    "10 of inaba et al .",
    "( 2001 ) and we compare them with our results . as the initial condition , @xmath394 planetesimals are placed between 0.915 au and 1.085 au .",
    "individual planetesimals have an equal - mass of @xmath395 g. the nebular gas is included and the gas / solid ratio is 44.4 .",
    "see table  1 of wetherill and stewart ( 1993 ) for more details .",
    "we take into account aerodynamic gas drag ( adachi et el . , 1976 ) instead of 2.0 used in morishima et al .",
    "( 2010 ) . ] and tidal damping ( papaloizou and larwood , 2000 ) , but not type i gas - driven migration .",
    "the gas disk model is described in morishima et al .",
    "( 2010 ) in detail . in our simulations , the planetesimal disk radially expands with time , while the solid surface density remains constant in the previous statistical simulations .",
    "however , the effect of radial expansion is small on the timescale of the simulation ( @xmath396 yr ) .",
    "figure  11 shows snapshots on the @xmath341 plane for the two hybrid simulations with different initial numbers of tracers , @xmath397 and 4000 . in the early stage of evolution ( @xmath398 = 10,000 yr ) ,",
    "large embryos grow very quickly and @xmath179 is enhanced locally where large embryos exist .",
    "this stage is called the runaway growth stage .",
    "once large embryos dominantly control the velocity of the entire planetesimal disk ( @xmath399 yr ) , growth of embryos slows down ( ida and makino , 1993 ) .",
    "this stage is called the oligarchic growth stage . even though large embryos tend to open up gaps around their orbits , the gaps are not cleared out because the embryos migrate quickly due to occasional short - distance planetesimal - driven migrations and embryo - embryo interactions and because other embryos tend to fill gaps . during the oligarchic growth stage ,",
    "the orbital separation between neighboring embryos is typically 10 hill radii as found by kokubo and ida ( 1998 , 2000 ) .",
    "tanaka and ida ( 1997 ) showed that gaps open up only if the orbital separation of neighboring embryos is larger than 20 hill radii .",
    "thus , formation of clear gaps is unlikely to occur in this stage .",
    "figure  12 shows the mass and velocity distributions at different times for two hybrid simulations shown in fig .",
    "the mass spectra of the hybrid simulations are smooth at the transition mass @xmath10 at which a tracer is promoted to a sub - embryo ( see also appendix  g ) . for comparison , the results from wetherill and stewart ( 1993 ) and inaba et al .",
    "( 2001 ) are also shown .",
    "the hybrid simulations agree well with these statistical simulations , although some small differences are seen . in the hybrid simulations ,",
    "the number of planetesimals represented by tracers has a lower limit shown by a dashed line in fig .",
    "thus , the tail of the mass spectrum in the massive side during the runaway growth is not correctly described .",
    "this causes a systematic delay in growth of large bodies , as already discussed by ldt12 .",
    "the delay is particularly clear in the low - resolution hybrid simulation at 10,000 yr , although the delay is small .",
    "this resolution effect should be seen even in the high resolution hybrid simulation while we see a good agreement with the statistical simulations at 10,000 yr .",
    "this is probably because our stirring routine slightly underestimates eccentricities and inclinations ( section  3.2 ) and this effect cancels out with the resolution effect to some degree .",
    "once the growth mode reaches oligarchic growth ( @xmath400 25,000 yr ) , the masses of the largest bodies in the low resolution simulation almost catch up with those in the high resolution simulation and those in the statistical simulations .",
    "13 . snapshots on the @xmath341 plane for the simulations starting from equal - mass 2000 planetesimals in a narrow annulus between 0.7 au and 1.0 au : ( a ) the hybrid simulation starting with 200 tracers and ( b ) the pure @xmath0-body simulation . in the panel ( a )",
    ", tracers are displayed as colored circles , and the colors represent the mass of planetesimal .",
    "sub - embryos are displayed as red filled circles .",
    "sub - embryos more massive than @xmath390 @xmath401 have a horizontal blue bar with a half length of 10 hill radii .",
    "the same color code is used in the pure @xmath0-body simulation .",
    "a radius of a circle is proportional to @xmath391 ( for the pure @xmath0-body simulation , @xmath11 for all particles ) .",
    "fig .  14 .        fig .  14 .",
    "time evolutions of various quantities for three hybrid simulations ( orange , brown , and red solid curves ) and three pure @xmath0-body simulations ( blue , purple , and black dashed curves ) : ( a ) the mass - weighted root - mean - square eccentricity and inclination , @xmath402 and @xmath403 , for embryos and planetesimals , ( b ) the total number of all bodies @xmath0 , the total number of embryos @xmath301 , the total number of tracers @xmath300 , ( c ) the total mass of embryos @xmath404 , the effective mass of the system @xmath405 , and the mass of the largest body @xmath406 .",
    "the last section focused only on the early stages of planetary accretion .",
    "further , the damping effects due to the gas disk make it difficult to judge whether the code works appropriately . here",
    "we test our code for the entire stages of accretion without the gas disk .",
    "we perform hybrid simulations of accretion of terrestrial planets starting from a narrow annulus , similarly to those adopted in morishima et al .",
    "( 2008 ) and hansen ( 2009 ) , until completion of accretion ( @xmath407 myr ) . as the initial condition , 2000 equal - mass planetesimals ( @xmath408 )",
    "are placed between 0.7 au to 1.0 au , and the total disk mass is @xmath409 .",
    "the initial number of tracers is 200 . for comparison",
    ", we also perform pure @xmath0-body simulations with the same initial condition using pkdgrav2 .",
    "a hybrid simulation takes about three days using a single core whereas a pure @xmath0-body simulation takes a few weeks using eight cores . as found in morishima et al .",
    "( 2008 ) , the evolution is almost deterministic due to efficient dynamical friction if the initial number of planetesimals is large enough ( @xmath410 ) .",
    "if the initial @xmath0 is small while keeping the same total mass , the evolution becomes rather stochastic and the final systems have relatively large diversity ( hansen , 2009 ) .",
    "an example of the hybrid simulations is shown in fig .",
    "13 together with an example of the pure @xmath0-body simulations . through the runaway growth stage , tens of embryos form ( @xmath411 myr )",
    ". with increasing masses of embryos , mutual orbital crossings and impacts occur , and a few distinctively large embryos emerge ( @xmath412= 1 myr ) . in the late stage , the largest embryos sweep up small remnant planetesimals ( @xmath413 myr ) . at the end of accretion ,",
    "the largest three embryos have orbital eccentricities and inclinations as small as those for the present - day earth and venus due to dynamical friction of remnant bodies ( @xmath414 myr ) . in the hybrid simulation ,",
    "all the largest embryos are sub - embryos until the end of the simulation .",
    "we perform three hybrid simulations and three pure @xmath0-body simulations in total , and all simulations show similar results , except one hybrid simulation produces only two distinctively large embryos .    to see the accretion history more in detail , we plot various quantities as a function of time in fig .  14 . overall agreements between the hybrid simulations and the pure @xmath0-body simulations are excellent . good agreements between the hybrid and pure @xmath0-body simulations suggest that our statistical routine works well even in the late stages of planetary accretion .",
    "figure  14a shows the evolution of the mass - weighted root - mean - square eccentricity and inclination , @xmath415 and @xmath416 , for embryos and planetesimals . with",
    "increasing time , @xmath417 and @xmath418 for both embryos and planetesimals increase primarily due to viscous stirring of largest bodies .",
    "after @xmath419 10 myr , @xmath417 and @xmath418 of embryos starts to decrease because small embryos with large @xmath179 and @xmath1 collide with large embryos with low @xmath179 and @xmath1 .",
    "figure  14b shows the evolution of the total number of all bodies @xmath0 and the total number of embryos @xmath301 .",
    "the number @xmath301 has a peak around 1 myr both in the hybrid and pure @xmath0-body simulations .",
    "the number of bodies which orbits are numerically integrated , @xmath420 , increases by @xmath421 at maximum and the maximum value is taken around 1 myr ( fig .",
    "figure  14c shows the total mass of embryos , @xmath404 , the effective mass of the system @xmath405 , which is sensitive to masses of largest embryos , and the mass of the largest body , @xmath406 .",
    "it is found that the values of @xmath405 and @xmath406 in the hybrid simulations are slightly lower than those in the pure @xmath0-body simulations at @xmath422 myr . during the giant impact stage roughly between @xmath398 = 0.2 myr and a few myr ,",
    "the contribution of embryo - embryo impacts to mass gain of embryos is significant , comparably to embryo - planetesimal impacts .",
    "the embryo - embryo collision rate sensitively depends on @xmath179 and @xmath1 of embryos .",
    "the hybrid simulations give slightly higher @xmath179 and @xmath1 ( fig .",
    "14a ) and thus lower growth rates of embryos than those in the pure @xmath0-body simulations during the giant impact stage .",
    "this is likely to be a resolution effect . in the low resolution hybrid simulations",
    ", the number of nearby tracers around embryos fluctuates and that makes dynamical friction somewhat noisy .",
    "we also perform the same simulations but starting with a larger number of tracers ( @xmath300 = 400 ) and find better agreements in @xmath405 with the pure @xmath0-body simulations .",
    "fig .  15 .",
    "snapshots on the @xmath341 plane for the hybrid simulation in the jovian planet region .",
    "the simulation starts with equal - mass @xmath423 planetesimals .",
    "tracers are displayed as colored circles and colors represent the mass of a planetesimal .",
    "sub - embryos ( @xmath424 ) are displayed as red filled circles and full - embryos ( @xmath425 ) are displayed as blue filled circles .",
    "a radius of a circle is proportional to @xmath391 , but enhanced by a factor of 6 for embryos for good visibility .",
    "fig .  16 .",
    "time evolutions of ( a ) semimajor axes and ( b ) masses of embryos that are more massive than 0.4@xmath308 at 2 myr .",
    "the same color is used for the same embryo in both panels . the embryos represented by blue , red , and purple curves",
    "are called embryo 1 , 2 , and 3 , respectively , in the main text .",
    "the final test we present is accretion of cores of jovian planets starting with a wide planetesimal disk .",
    "levison et al . ( 2010 ) and capobianco et al . ( 2011 ) showed importance of self - sustained outward migration of embryos , as they can grow rapidly via collisions with little - perturbed outer bodies .",
    "however , these authors placed large embryos in the disk of small planetesimals in the initial conditions , and it is not clarified if outward migration plays a significant role in more realistic accretion scenarios .",
    "we set the initial condition similar to that employed by levison et al .",
    "( 2010 ) , but without any embryos .",
    "we place @xmath423 equal - mass planetesimals between 4 au and 16 au represented by 10000 tracers .",
    "the initial planetesimal mass @xmath426 is @xmath427 g and the radius is 2.4 km .",
    "the total mass of planetesimals is 200 @xmath308 and this gives the solid surface density about seven times the minimum - mass solar nebula ( hayashi , 1981 ) .",
    "the simulation is performed up to 2 myr and it takes roughly five days to complete using a single core .",
    "the nebula gas effects are included in the same manner as the simulations in section  3.4 , and the gas - to - solid ratio is 56.7 , which is the same as the minimum - mass solar nebula beyond the snow line ( hayashi , 1981 ) . we do not consider enhanced cross sections of embryos due to their atmospheres ( inaba and ikoma , 2003 ) . the nebular gas is assumed to dissipate exponentially on the timescale of 2 myr .",
    "capobianco et al .",
    "( 2011 ) showed that outward migration of an embryo is usually triggered in the nebular gas , if the planetesimal radius is in a certain range .",
    "the planetesimal radius we employ is in this range in the region inside of @xmath41910 au [ see their eq .  ( 21 ) ] .",
    "note that , however , planetesimal radii increase with time in our simulation unlike those in levison et al .",
    "( 2010 ) and capobianco et al .",
    "( 2011 ) .",
    "the snapshots on the @xmath341 plane are shown in fig .",
    "15 and the time evolutions of the masses and the semimajor axes of six largest embryos at the end of the simulation are shown in fig .",
    "several embryos appear near the inner edge of the disk after 0.1 myr .",
    "after some embryo - embryo interactions , one of the embryos ( embryo 1 ) starts self - sustained outward migration . since embryo 1 encounters with unperturbed planetesimals on its way , it grows very rapidly from 0.1 @xmath308 to 3 @xmath308 during only 50,000 yr .",
    "after embryo 1 reaches the outer edge , it turns its migration direction inward .",
    "however , it encounters with another smaller embryo ( embryo 2 ) and inward migration is halted .",
    "there , embryo 1 opens up a gap and starts slow outward migration due to distant encounters with inner planetesimals .",
    "embryo 1 is promoted to a full - embryo at @xmath428 0.2 myr during its inward migration .",
    "embryo 2 and another embryo ( embryo 3 ) also migrate outward during the outward migration of embryo 1 , and they also grow more rapidly than inner embryos , but not as rapidly as embryo 1 .",
    "they eventually change their migration directions inward and come back to near the inner edge .",
    "embryo 2 occasionally attempts to migrate outward even after that , although its outward migration is not sustained .",
    "two outward migrations at @xmath428 0.55 and 0.65 myr are halted by encounters with another embryo at @xmath419 7 au , which merges with embryo 2 at @xmath428 0.65 myr .",
    "embryo 2 is promoted to a full - embryo at this time .",
    "we do not clearly understand what prevents embryo 2 from subsequent outward migrations .",
    "the radial profile of the surface density of planetesimals is no longer smooth due to occasional gap formation by embryos , and the outward migrations of embryo 2 seem to be halted at local low density regions .",
    "another possibility is that migrations of full - embryos are halted by stochastic effects since they are not massive enough as compared with tracers .",
    "this possibility may be tested using different transition masses from a sub - embryo to a full embryo .",
    "the masses of embryo 2 and embryo 3 respectively reach 3.6 @xmath308 and 2.5 @xmath308 at 2 myr .",
    "their growth is slow at this time as they open up a gap in the planetesimal disk .",
    "obviously , we need to perform more simulations with different parameter sets and conduct more careful analysis .",
    "nevertheless , the example we showed here is a good demonstration that our code can produce rapid growth of embryos during their outward migrations .",
    "ngo ( 2012 ) performed simulations of accretion of cores of jovian planets using the lipad code .",
    "the initial conditions of his simulations are similar to ours . in his simulations without fragmentation ( his figs .",
    "5.14 and 5.15 ) , sub - embryos are almost radially stationary even though the routine of sub - embryo migration is included .",
    "once sub - embryos are promoted to full - embryos , they suddenly start rapid radial migrations .",
    "it is unclear to us why such large differences between sub - embryos and full - embryos are seen in his simulations . in spite of the large difference of embryo migration between",
    "his and our simulations , the final masses of the largest embryos are close to each other .",
    "the cpu time @xmath429 per timestep of orbital integration as a function of the number of embryos @xmath301 and the number of tracers @xmath300 is roughly given as @xmath430 where @xmath431 , @xmath432 , and @xmath433 are the cpu times for a single orbital integration ( a kepler drift ) , for a single direct gravity calculation of a pair in the @xmath0-body routine , and for a single set of calculations for a pair in the statistical routine , and @xmath434 is the typical number of interlopers in the neighboring search region ( fig .  2 ) .",
    "for a standard latest computer , @xmath435 s. from some of simulations , we find that @xmath436 and @xmath437 .    as seen in eq .",
    "( [ eq : tcpu ] ) , the load on the statistical routine is controllable by modifying @xmath434 and @xmath438 . since the radial width of the neighboring search region",
    "is given by eq .",
    "( [ eq : drt0 ] ) , @xmath439 for a fixed surface density .",
    "if we choose an azimuthal width as @xmath440 , @xmath434 becomes independent of @xmath300 and the cpu time for the statistical routine can be linearly scaled with @xmath300 .",
    "practically , one may choose a @xmath24 so that the load on the statistical routine does not exceed the load on the @xmath0-body routine .",
    "the actual computational load on the statistical routine in some of our simulations is as follows .",
    "recall that in the present paper , we call the statistical routine every 30 steps of orbital integrations ( @xmath441 ) . if the time step of the statistical routine is halved , its load is doubled . in the hybrid simulations shown in fig .  5 ( @xmath331 and @xmath442 ) , the load on the statistical routine is only 10 % relative to the total load .",
    "the rest of 90 % is on the @xmath0-body routine and more than half of it is occupied by the kepler equation solver .",
    "there is no direct gravity calculation in these simulations , as no embryo is included . in the hybrid simulation shown in fig .",
    "15 ( @xmath443 and @xmath444 ) , the load on the statistical routine is about 60 % before embryos appear .",
    "if the number of embryos is larger than about 10 , the load on the direct gravity calculation exceeds that for the kepler equation solver , and the relative load on the statistical routine decreases . at 1.6 myr of fig .",
    "15 , at which 21 embryos exist , the load on the statistical routine is about 45 % , that on the direct gravity calculation is 35 % , and that on the orbital integration is 20 % .",
    "overall , the load of the statistical routine is comparable to or less than that on the @xmath0-body routine",
    ".    we also comment on parallelization .",
    "the current version of our code is serial .",
    "however , the direct @xmath0-body routine is already parallelized and we test how much simulations are accelerated by parallelization in case without the statistical routine . in the tests , we fix the number of embryos to be 10 and vary the number of tracers .",
    "we find that simulations are accelerated only if the number of tracers is more than @xmath396 .",
    "in contrast , the pure @xmath0-body simulations using the tree code , pkdgrav2 , are accelerated by parallelization if @xmath445 ( morishima et al . , 2010 ) .",
    "the difference comes from the cpu times per step . to be benefitted by parallelization",
    ", the cpu time needs to be somewhat long to ignore latency .",
    "the computational cost per step for hybrid simulations is as small as those for @xmath0-body simulations without particle - particle interactions .",
    "that ironically makes parallelization inefficient .",
    "we consider only random walk of tracers in tracer - tracer interactions .",
    "thus , self - sustained migration occurs only to embryos in our code although small bodies ( @xmath446 ) may migrate in reality . to examine",
    "if migrations of small bodies play an important role for overall accretion history of embryos , high resolution simulations ( with smaller @xmath10 ) are necessary .",
    "minton and levison ( 2014 ) showed that self - sustained migration occurs only if the embryo is much more massive than surrounding planetesimals and sufficiently separated from other embryos .",
    "such conditions are usually fulfilled near the transition from the runaway growth stage to the oligarchic growth stage .",
    "the mass of the largest embryo at the transition is roughly given by @xmath447 ( ormel et al .",
    ", 2010b ; morishima et al . ,",
    "2013 ) , where @xmath448 is the isolation mass and @xmath426 is the initial mass of planetesimals .",
    "therefore , if @xmath426 is very small ( e.g. , weidenschilling , 2011 ) , a very large number of tracers is necessary to represent an embryo at the transition by a single particle in our code .",
    "however , minton and levison ( 2014 ) also pointed out that the growth time scale needs to be longer than the migration time for an embryo to avoid encounters with other embryos during migration .",
    "if @xmath426 is very small , this criterion is not generally fulfilled for the largest embryo at the transition due to a very short growth time scale .",
    "thus , masses of candidate embryos for self - sustained migration are probably not too small to be practically resolved by our code even if @xmath426 is very small . the argument here , of course , depends on disk parameters and radial location and needs more careful estimates .",
    "our code can probably handle eccentric / inclined ringlets that are usually produced by external massive bodies ( see section  2.3 ) .",
    "however , we have not tested such simulations in this paper , and they remain for future work . a potential issue of our code in handling eccentric / inclined ringlets is accuracy of the global gravity forces ( section  2.7 ) . only for this calculation",
    ", we assume that a ring is axisymmetric and symmetric with respect to the invariant plane .",
    "these assumptions may not be appropriate if the radial / vertical thickness or the ringlet is much smaller than the radial / vertical excursion of individual particles .",
    "this is the case of some of narrow ringlets seen around solar system giant planets .",
    "if the global self - gravity plays an important role in structure evolution of narrow ringlets , we need a more advanced method to calculate it .",
    "the current code includes an option of hit - and - run bouncing ( appendix  e ) but not fragmentation .",
    "we plan to implement collisional fragmentation to our code in subsequent work .",
    "since gas drag damps @xmath179 and @xmath1 of small fragments effectively , growth of embryos is accelerated by fragmentation of planetesimals , particularly in the oligarchic growth stage . on the other hand , since the total solid mass available for planetary accretion decreases due to rapid inward migration of fragments in the gaseous disk , the final masses of planets also decrease , unless planetary atmospheres effectively capture fragments .",
    "these conclusions were derived by simulations using statistical accretion codes ( e.g. , inaba et al . , 2003 ; chambers , 2008 ; kobayashi et al . , 2010 , 2011 ; amaro - seoane et al . ,",
    "2014 ) . in these studies ,",
    "the torques on embryos exerted by small fragments were not taken into account .",
    "levison et al . ( 2010 ) showed that small fragments shepherded by embryos push bash the embryos toward the central star , leading to rapid inward migration of the embryos . on the other hand , kobayashi et al .",
    "( 2010 ) pointed out that shepherded fragments are quickly ground down due to mutual collisions and very small ground fragments collide with or migrate past the embryos before pushing back the embryos .",
    "however , this has not been confirmed by direct lagrangian type simulations and is of interest in future work .",
    "we developed a new particle - based hybrid code for planetary accretion .",
    "the code uses an @xmath0-body routine for interactions with embryos while it can handle a large number of planetesimals using a super - particle approximation , in which a large number of small planetesimals are represented by a small number of tracers .",
    "tracer - tracer interactions are handled by a statistical routine .",
    "if the embryo mass is similar to tracer masses and if embryo - tracer interactions are handled by the direct @xmath0-body routine , the embryo suffers artificially strong kicks from tracers . to avoid this issue ,",
    "sub - embryos are introduced .",
    "accelerations of sub - embryos due to gravitational interactions with tracers are handled by the statistical routine whereas accelerations of tracers due to gravitational interactions with sub - embryos are handled by the direct @xmath0-body routine .",
    "our statistical routine first calculates the surface number densities and the orbital elements of interloping planetesimals around each target tracer ( section  2.2 ) . using the phase - averaged collision probability , whether a collision between the interloper and the target occurs is determined ( section  2.4 ) .",
    "if a collision occurs , the velocity changes are accurately calculated by matching the positions of the interloper and the target without changing their eccentricity and inclination vectors . using the phase - averaged stirring and dynamical friction rates ,",
    "the change rates of the orbital elements of the tracers are calculated ( section  2.5 ) .",
    "these rates are converted into the accelerations of the tracers using both first and second order gauss planetary equations .",
    "planetesimal - driven migration of sub - embryos is basically handled by the @xmath0-body routine but the migration rate is limited to the theoretical prediction derived by the statistical routine ( section  2.6 ) .",
    "this unique routine can reproduce smooth , long - distance migrations of sub - embryos .",
    "we performed various tests using the new hybrid code : velocity evolution due to collisions , and that due to gravitational stirring and dynamical friction , self - sustained migration of sub - embryos , formation of terrestrial planets both in the presence and absence of the gaseous disk , and formation of cores of jovian planets .",
    "all the test simulations showed good agreements with analytic predictions and/or pure @xmath0-body simulations for all cases , except that the last test did not have a robust benchmark .",
    "the computational load on the portion of the statistical routine is comparable to or less than that for the @xmath0-body routine .",
    "the current code includes an option of hit - and - run bouncing but not fragmentation that remains for future work .",
    "we are grateful to the reviewers for their many valuable comments , which greatly improved the manuscript .",
    "we also thank satoshi inaba for kindly giving us his simulation data .",
    "this research was carried out in part at the jet propulsion laboratory , california institute of technology , under contract with nasa .",
    "government sponsorship acknowledged .",
    "simulations were performed using jpl supercomputers , aurora and halo .",
    "in section  2.2 , we only consider encounters with interlopers .",
    "however , planetesimals in the target @xmath1 may encounter with other planetesimals in the same target if @xmath47 . to take into account this effect",
    ", we modify apparent planetesimal numbers in interlopers , if masses of interloping planetesimals are similar to those in the target tracer . for this purpose only , we assume axisymmetric distribution of planetesimals and introduce the mass bin for planetesimals .",
    "we also use the radial bin used in the neighboring search .",
    "we first calculate the total mass of tracers , @xmath449 , in the radial and mass bins where the target locates .",
    "the summation is done for tracers in any azimuthal locations , excluding the target . since the actual total mass seen from an individual planetesimal in the target tracer",
    "is @xmath450 , we use a corrected @xmath451 for the interloper , @xmath452 if it is in the same radial and mass bins with the target . if there is no other tracer in the same radial and mass bins , the correction is not applied .",
    "we find that this self - encounter effect is very small at all as we do not identify any difference in simulations with and without the correction .",
    "the effect can also be checked by simulations with a same total number of planetesimals but using different numbers of tracers .",
    "although a simulation with a small number of tracers has larger statistical fluctuations in various physical quantities , such as the mean eccentricity , any differences in time - averaged quantities are not well identified .",
    "thus , we can omit this correction , and mass bins are unnecessary in our code .",
    "with hill s approximation , the equations of motion for the relative motion between the target and the interloper are reduced to hill s equations ( hill 1878 ; nakazawa et al . , 1989 ) .",
    "the time and the distance of hill s equations can be normalized by the inverse of orbital frequency , @xmath453 , and @xmath454 , respectively , where @xmath455 is the mean semimajor axis and @xmath85 is the reduced mutual hill radius [ eq .",
    "( [ eq : rhill ] ) ] .",
    "the solution of the relative motion in the absence of mutual gravity is expressed by non - dimensional relative orbital elements , @xmath98 , @xmath456 , @xmath457 , @xmath71 and @xmath72 .",
    "the elements @xmath98 , @xmath456 and @xmath457 are given as @xmath458 where @xmath459 is the difference of the semimajor axes , the relative eccentricity @xmath81 and the relative inclination @xmath82 are defined in eq .",
    "( [ eq : relei ] ) together with the phases @xmath71 and @xmath72 .",
    "the non - dimensional collision rate @xmath460 is defined as @xmath461 where @xmath462 is unity for collisional orbits and zero otherwise .    in the dispersion dominant regime [ @xmath463 , @xmath464",
    "is given as ( greenzweig and lissauer , 1990 ; inaba et al .",
    ", 2001 ) @xmath465 where @xmath466 with the physical radii @xmath467 and @xmath468 , @xmath469 and @xmath470 are the complete elliptic integrals of the first and second kinds , respectively , and @xmath471 .    in the shear dominant regime [ @xmath472 ,",
    "if the inclination is small enough ( @xmath473 ; see goldreich et al .",
    "( 2004 ) for this criterion ) all pairs of particles entering the mutual hill sphere collide , and @xmath464 becomes independent of @xmath456 and @xmath457 as ( ida and nakazawa , 1989 ) @xmath474 in the shear dominant regime with moderate inclinations ( @xmath475 ) , @xmath464 depends only on @xmath476 as ( ida and nakazawa , 1989 ) @xmath477    following inaba et al .",
    "( 2001 ) , we connect the collision rates in different regimes as @xmath478.\\ ] ] the collision rate given by this expression well agrees with that derived by numerical integrations ( ida and nakazawa , 1989 ; greenzweig and lissauer , 1990 ) .      the non - dimensional stirring and dynamical friction rates are defined as @xmath479 where @xmath480 , @xmath481 , and @xmath482 are the changes of @xmath483 , @xmath484 , and @xmath485 [ eq .  ( [ eq : relei ] ) ] during a single encounter .",
    "the non - dimensional dynamical friction rate for inclination is obtained by replacing @xmath486 by @xmath487 in eq .",
    "( [ eq : pdfd ] ) and is known to be the same with @xmath138 ( tanaka and ida , 1996 ) .",
    "the rates for the shear dominant regime are ( ida 1990 , ohtsuki et al . , 2002 )",
    "@xmath488 for @xmath489 , we adopt a functional form that is similar to the one with the rayleigh distribution ( ohtsuki et al . ,",
    "2002 ) but the factors are modified .",
    "the rates for the dispersion dominant regime are given as ( tanaka and ida , 1996 ) @xmath490 \\nonumber \\\\ & & \\times \\ln{(\\lambda^2 + 1)},\\\\ q_{\\rm vs , high } & = &   \\frac{36}{\\pi \\tilde{i}_{\\rm r } \\sqrt{\\tilde{e}_{\\rm r}^2 + \\tilde{i}_{\\rm r}^2 } } \\left[k(\\zeta)- \\frac{12\\tilde{i}_{\\rm r}^2}{\\tilde{e}_{\\rm r}^2 + 4\\tilde{i}_{\\rm r}^2}e(\\zeta)\\right ] \\nonumber \\\\ & & \\times \\ln{(\\lambda^2 + 1)},\\\\ p_{\\rm df , high } & = &   \\frac{288}{\\pi \\tilde{i}_{\\rm r } ( \\tilde{e}_{\\rm r}^2 + 4\\tilde{i}_{\\rm r}^2 ) \\sqrt{\\tilde{e}_{\\rm r}^2 + \\tilde{i}_{\\rm r}^2 } } e(\\zeta ) \\ln{(\\lambda^2 + 1)},\\end{aligned}\\ ] ] where @xmath491 in @xmath492 and @xmath493 , we omit the term @xmath494 as it is negligible compared with @xmath495 in the dispersion dominant regime .",
    "we connect the stirring and dynamical friction rate at the shear and dispersion dominant regimes in a similar manner of ohtsuki et al .",
    "( 2002 ) : @xmath496 the coefficients are @xmath497 the approximated formulae well agree with the rates derived by three - body orbital integrations [ fig .  8 of ida ( 1990 ) and fig .  1 of ohtsuki et al .",
    "( 2002 ) ] , except for the region with @xmath498 and @xmath499 ( see section  3.2 ) .",
    "the non - dimensional migration rate @xmath258 for one - sided torque is defined as @xmath500 where @xmath371 is the change of @xmath98 during a single encounter and the negative sign represents the back reaction on the embryo . at @xmath501 , @xmath502 [ ida et al . , 2000",
    "; their eq .",
    "it is expected that @xmath503 in the shear dominant regime is about the same value as the migration rate is almost constant in this regime ( kirsh et al . , 2009 ) :",
    "@xmath504 for the dispersion dominant regime , ida et al .",
    "( 2000 ) derived the migration rate averaged over @xmath71 and @xmath72 as [ their eq .",
    "( 18 ) ] @xmath505 inserting this equation into eq .",
    "( [ eq : rmig ] ) , we have @xmath506 where the integration range of @xmath98 is limited between @xmath507 and @xmath456 , and @xmath508 is approximately treated as a constant in the integration .",
    "analogous to the stirring rates , we connect the migration rates at the shear and dispersion dominant regimes but the value is assumed not to exceed @xmath509 @xmath510.\\ ] ] while this expression must be correct in the low and high velocity limits , its accuracy at the intermediate regime needs to be confirmed by comparing with the rate derived from three - body orbital integrations .",
    "when the non - dimensional collisional and stirring rates are derived , uniformities of @xmath71 and @xmath72 are assumed .",
    "however , we do not assume uniformities of the relative longitudes , @xmath89 and @xmath511 .",
    "alignments of the longitudes occur , for example , if the system is perturbed by a giant planet and the forced eccentricity is much larger than the free eccentricities .",
    "ida ( 1990 ) showed that the eccentricity evolution of a particle @xmath1 due to dynamical friction of particles @xmath27 is @xmath512p_{\\rm df }   \\label{eq : dfj0 }    \\\\ & = & \\frac{c_1}{\\nu_{j}h_{ij}^2}\\left[\\nu_{j}{e}_{j}^2 - \\nu_{i}e^2_{i } + ( \\nu_{i}-\\nu_{j})e_{i}e_{j}\\cos{\\varpi_{ij } } \\right]p_{\\rm df } , \\label{eq : dfj1 } \\end{aligned}\\ ] ] where the characters appeared in these equations are defined around eqs .",
    "( [ eq : dedfs ] ) and ( [ eq : dedfd ] ) .",
    "if @xmath91 s of interlopers are randomly distributed and the distribution of @xmath513 is the rayleigh distribution , the term with @xmath514 becomes small enough after averaging over interlopers ( ida , 1990 ) .",
    "the equilibrium state for this case leads to the well - known energy equipartitioning ( @xmath515 ) with dynamical friction only . with viscous stirring ,",
    "however , the energy equipartitioning is achieved only if the mass distribution is very steep ( rafikov , 2003 ) .    if the distribution of @xmath91 is not random , as may be the case of a forced system , the term with @xmath514 in eq .",
    "( [ eq : dfj1 ] ) can not be ignored . in a forced system ,",
    "the eccentricity vectors may be split as @xmath516 and @xmath517 , where @xmath518 is the forced eccentricity vector , @xmath519 and @xmath520 are the free eccentricity vectors , respectively ( murray and dermott , 1999 ) . inserting these forms into eq .",
    "( [ eq : dfj0 ] ) and setting @xmath521 due to the uniformity of @xmath71 , we can find an equation similar to eq .",
    "( [ eq : dfj1 ] ) but @xmath48 and @xmath54 replaced by the free eccentricities @xmath522 and @xmath523 and @xmath91 replaced by the relative longitude of the free eccentricities . since there is no correlation between the directions of @xmath520 and @xmath519 , the third term in the square bracket of the r.h.s of eq .",
    "( [ eq : dfj1 ] ) can be neglected .",
    "thus , dynamical friction tends to lead the energy equipartitioning of the free eccentricities , if @xmath518 is shared for all particles . a similar conclusion can be derived for inclinations .",
    "now we consider splitting eq .",
    "( [ eq : dfj1 ] ) into two terms : a stirring term that is preferably larger than the viscous stirring term [ as required in eq .",
    "( [ eq : vrs ] ) ] and a damping term that decreases the free eccentricity .",
    "we find the forms that can fulfill such conditions as @xmath524 the same equations are given in eqs .",
    "( [ eq : dedfs ] ) and ( [ eq : dedfd ] ) . in a forced system , the terms in the parenthesis of the r.h.s . of eq .",
    "( [ eq : dedfdap ] ) are reduced to @xmath525 using @xmath521 and @xmath526 due to the uniformity of @xmath71 . the l.h.s . of eq .",
    "( [ eq : dedfdap ] ) is also reduced to @xmath527 because the orientation of @xmath519 changes randomly due to gravitational interactions with other tracers [ @xmath528 . thus , the damping term [ eq .",
    "( [ eq : dedfdap ] ) ] decreases the free eccentricity , as required . usually in astrophysics",
    ", only this damping term is called dynamical friction ( binney and tremaine , 1987 ) . a similar splitting is possible for inclinations , and the split terms",
    "are given by eqs .",
    "( [ eq : didfs ] ) and ( [ eq : didfd ] ) .",
    "the classical theory of random walk shows that the diffusion coefficient @xmath140 for the one dimensional problem is @xmath529 , where @xmath144 is the change in the semimajor axis for the tracer @xmath1 during the time step @xmath17 and the angle brackets mean averaging over multiple changes .",
    "the change of @xmath36 due to a single encounter with other planetesimal is defined to be @xmath530 , where @xmath371 is again the change of @xmath98 during an encounter .",
    "thus , the diffusion coefficient @xmath531 for the tracer @xmath1 due to encounters with planetesimals in the tracer @xmath27 is given as @xmath532 where @xmath533 is the change of @xmath98 during @xmath17 and the subscript for the angle brackets means averaging over planetesimals in the tracer @xmath27 .",
    "petit and hnon ( 1987 ) performed three - body orbital integrations and showed that @xmath534 for @xmath535 .",
    "although it is unclear if this factor is applicable for @xmath536 , we use the relationship for any cases .",
    "this gives @xmath537/2 , using @xmath538 .",
    "the averaged change @xmath539 is given by @xmath540 where we used @xmath541 that is derived from the jacobi integral of hill s equations [ eq .",
    "( [ eq : jaco ] ) ] , and @xmath136 and @xmath137 are defined in eqs .",
    "( [ eq : pvs3 ] ) and  ( [ eq : qvs3 ] ) .    inserting eq .",
    "( [ eq : db2 ] ) into eq .",
    "( [ eq : did ] ) , the diffusion coefficient @xmath531 is given as @xmath542 finally , the diffusion coefficient due to encounters with all interlopers is given by @xmath543 .",
    "ohtsuki and tanaka ( 2003 ) derived the viscosity for the equal - mass planetesimals disk and their viscosity is @xmath544 .",
    "the diffusion coefficients derived by ormel et al .",
    "( 2012 ) and glaschke et al .",
    "( 2014 ) are similar to ours .",
    "in section  2.4 , we show how the total number of tracers changes due to merging between planetesimals . on the other hand , in hit - and - run collisions",
    ", there should be no change in the number . before describing how to handle hit - and - run collisions between planetesimals in two tracers ,",
    "we first show how to handle a hit - and - run collision between embryos or between a full embryo and a tracer .",
    "consider an impact between the target with mass @xmath2 and the impactor with mass @xmath30 ( @xmath545 ) .",
    "let the impact velocity and the impact angle be @xmath546 and @xmath547 ( @xmath548 for a head - on collision ) .",
    "if @xmath549 , where @xmath550 is the critical velocity , the collision results in escape of the projectile after bouncing on the target . based on thousands of sph simulations , genda et al . ( 2012 ) derived the formula of @xmath550 as @xmath551 where @xmath552 is the mutual escape velocity , @xmath553 , and @xmath554 .",
    "the coefficients are @xmath555 , @xmath556 , @xmath557 , @xmath558 , and @xmath559 .    if the impact is judged as a hit - and - run collision ( @xmath549 ) , the post - impact velocities of the projectile and the target are determined as follows .",
    "we do not consider any mass exchanges between the target and the impactor for simplicity following kokubo and genda ( 2010 ) .",
    "the impact velocity vector is decomposed to the normal and tangential components ( @xmath560 and @xmath561 ) relative to the vector pointing toward the center of the target from the center of the impactor .",
    "the tangential component of the post - impact relative velocity @xmath562 is assumed to be the same as @xmath561 .",
    "the normal component of the post - impact relative velocity is given as @xmath563 the velocity change described here is similar to but slightly different from that of kokubo and genda ( 2010 ) , who always set @xmath564 and adjust @xmath565 .",
    "the normal and restitution coefficients , @xmath306 and @xmath309 , are defined as @xmath566 and @xmath567 . while the above case basically assumes @xmath310 and @xmath311 , these coefficients",
    "can be changed to any values in simulations ( in section  3.1 , we use @xmath310 and 0.8 ) .",
    "now we consider hit - and - run collisions between planetesimals in two tracers .",
    "we will handle them as consistent as possible with those between embryos .",
    "if a collision is judged to occur in the statistical routine , the target and the impactor are moved to the impact position without changing their eccentricity and inclination vectors , as described in section  2.4.2 .",
    "the relative velocity , @xmath568 , at infinity ( without acceleration due to mutual gravity ) is calculated at this impact position . if @xmath569 , only some fraction of planetesimals in the tracer @xmath27 are involved in the collision ( fig .",
    "the impact velocity is given as @xmath570 .",
    "we ignore deflection of the relative orbit during acceleration due to mutual gravity so that the direction of the impact velocity vector is identical to that of the relative velocity vector @xmath571 .",
    "the problem is that we can not directly use the relative position vector of the tracers because their mutual separation is not exactly the sum of the radii of a colliding pair after matching their positions . instead of using the actual relative position vector",
    ", we make a fictitious relative position vector @xmath572 . the fictitious impact angle @xmath547 is given by @xmath573 .",
    "assuming there is no correlation between @xmath571 and @xmath572 , the probability that the impact angle is between @xmath547 and @xmath574 is given as @xmath575 ( e.g. , shoemaker and wolfe , 1982 ) .",
    "we choose an arbitrary @xmath547 between 0 and 90 degrees following this distribution and also choose the tangential direction of @xmath572 relative to @xmath571 at random .",
    "then , we judge whether the collision results in merging or bouncing using eq .",
    "( [ eq : gen ] ) in which @xmath30 is replaced by @xmath95",
    ". if it is merging , we follow the process described in section  2.4.2 , using @xmath571 as the impact velocity vector .",
    "if it turns out to be a hit - and - run collision , we calculate the post impact velocities using @xmath576 and @xmath577 from eq .",
    "( [ eq : vnd ] ) .",
    "then their velocities are modified so that their relative velocity at infinity is given as @xmath578 , again ignoring deflection of the orbits due to mutual gravity . if the interloper is split into two tracers [ case ( a ) in eq .",
    "( [ eq : delm ] ) ] before the collision , we merge them by summing their momenta after matching their positions .",
    "the merged tracer has the same @xmath30 and @xmath107 as those of the original interloper before splitting .",
    "the semimajor axis of the interloper is adjusted so that the @xmath120-component of the total angular momentum of is conserved .",
    "finally , the mean longitudes of the target and interloper are placed to the original values .",
    "here we explain how to derive the correction factor @xmath234 appeared in eq .",
    "( [ eq : nj2 ] ) .",
    "let us define the inner and outer radii of the region @xmath1 for neighboring search around the embryo be @xmath579 and @xmath580 ( fig .  2 ) .",
    "the interloper @xmath27 has the semimajor axis @xmath53 , the eccentricity @xmath54 , and the inclination @xmath55 .",
    "the maximum and minimum distances of the interloper @xmath27 , @xmath581 and @xmath582 , from the central star projected on the invariant plane ( @xmath21 ) are given by @xmath583    if @xmath584 , we define the eccentric anomaly @xmath585 ( @xmath586 ) at @xmath587 as @xmath588 and the mean anomaly is also defined as @xmath589 . if @xmath590 , we set @xmath591 . in a similar manner ,",
    "if @xmath592 , we define the eccentric anomaly @xmath593 ( @xmath586 ) at @xmath594 as @xmath595 and the mean anomaly @xmath596 . if @xmath597 , we set @xmath598",
    ". then , the period @xmath236 in which the interloper @xmath27 is radially in the region @xmath1 during the orbital period @xmath235 is given as @xmath599",
    "here we summarize the differences between the lipad code ( ldt12 ) and our new code .      in the lipad code , to derive the spatial density of planetesimals ,",
    "tracers are placed in mass and radial grids and the vertical distribution is assumed to be gaussian .",
    "our code has neither these fixed grids nor the assumption for the vertical distribution ( except for the global gravity calculation described in section  2.7 ) .",
    "thus , our code has lagrangian natures more than the lipad code , although these differences are probably not fundamental for the test simulations shown in this paper .",
    "our scheme is more beneficial for systems with non - axisymmetric and/or inclined structures .",
    "the advantage of the assumption of the vertical distribution in the lipad code is that changes in collision and stirring rates at different @xmath120 are explicitly taken into account .",
    "changes in collision rates with z are taken into account in our model too , although implicitly , as we move both the target and the interloper to the collisional point ( section  2.4 ) ; collisions occur more often near the mid - plane than at high @xmath600 . in the stirring routine ( section  2.5 )",
    ", our method ignores this effect and this probably introduces some inaccuracies in orbital evolutions of individual particles .",
    "nevertheless , the velocity evolution of the system as a whole is reproduced reasonably well by our method as shown in the test simulations ( see more discussion for viscous stirring and dynamical friction given below ) .",
    "the number of planetesimals in a tracer , @xmath3 , is an integer in our model ( section  2.1 ) , contrary to ldt12 .",
    "if a tracer with a non - integer number of planetesimals is promoted to a single sub - embryo , the extra mass , @xmath601 ( if @xmath602 ) , needs to be incorporated into the sub - embryo or transferred to other tracers which may have very different planetesimal masses . both are not accurate although it is not clear to us how it is handled in the lipad code .      in our code , orbital isolation between planetesimals",
    "does not occur as we choose a narrow radial half width @xmath23 of the neighboring search region given by eq .",
    "( [ eq : drt0 ] ) .",
    "if we adopt a larger @xmath23 , orbital isolation can potentially occur . in this case",
    "we may need to consider how isolated bodies interact through distant perturbations .",
    "in general , however , the radial resolution is sacrificed with a large @xmath23 . in our current scheme ,",
    "interactions between runaway bodies are approximately represented by occasional close encounters rather than distant perturbations .",
    "the lipad code explicitly handles orbital isolation and distant perturbations ( e.g. , their fig .",
    "this means that they use the radial grid size larger than ours .",
    "even with a large @xmath23 , the exitisting lagrangian codes can not handle orbital isolation of planetesimals that are much less massive than @xmath10 , because a small number of runaway bodies can not be represented by tracers with nearly fixed masses .",
    "collisions between tracers and sub - embryos are handled in the @xmath0-body routine in the lipad code .",
    "thus , after the promotion the first impact of a tracer doubles the mass of a sub - embryo .",
    "this makes artificial kinks in mass spectra at the transition mass , @xmath10 .",
    "the influence of this effect on evolution of the overall system is small as discussed by ldt12 , particularly if the masses of the largest embryos are much larger than @xmath10 .    in our method ,",
    "collisions of planetesimals with sub - embryos are handled by the statistical routine ( secs .",
    "2.4 and 2.6 ) .",
    "the mass spectra are smooth at @xmath10 ( see fig .",
    "12 ) , because only some of planetesimals in a tracer collide with a sub - embryo .",
    "note that we assume uniformities in phase space ( section  2.3 ) that seem to be valid at least in test simulations shown in this paper , while no assumption for phase - space is necessary for the @xmath0-body routine .",
    "the impact velocity between tracers is calculated more accurately in our code than the lipad code .",
    "as described in section  2.4 , we estimate the impact velocity between tracers by matching their positions without changing their eccentricity and inclination vectors .    in the lipad code , only the interloper s longitude is aligned to that of the target by rotating the interloper s coordinates , not letting the interloper move along its keplerian orbit .",
    "this changes the longitude of pericenter of the interloper by the rotation angle .",
    "ldt12 managed to minimize this issue by choosing the azimuthally closest interloper for the collision with the target , as originally done in levison and morbidelli ( 2007 ) . on the other hand , our method allows any interlopers to collide with the target .",
    "the timescale of collisional damping shown in fig .",
    "2 of ldt12 is clearly too short , probably because they described the initial condition of a wrong simulation .",
    "the largest difference between our code and the lipad code probably appears in the methods to handle viscous stirring and dynamical friction . in the lipad code ,",
    "the probability that an interloper enters within a mutual hill radius of the target is calculated .",
    "if an encounter occurs , the acceleration of a smaller body of the pair is given by solving a pair - wise gravitational interaction .",
    "the acceleration of a lager body of the pair is not calculated in this routine , but the damping forces are given by the chandrasekhar s formula of dynamical friction .",
    "instead of taking into account stirring on the larger body , they set lower limits of @xmath179 and @xmath1 of the larger body based on energy equipartitioning .",
    "some inaccuracies seem to be introduced in their approach .",
    "first , energy equipartitioning is not usually achieved except with a very steep mass spectrum ( rafikov , 2003 ) .",
    "second , the chandrasekhar s formula of dynamical friction is not applicable to the shear - dominant regime ( e.g. , ida , 1990 ; ohtsuki et al . , 2002 ) .",
    "in our method , we do not solve individual pair - wise gravitational interactions .",
    "instead , we calculate the time averaged changes of the orbital elements due to multiple encounters with tracers , using the phase - averaged stirring rates ( section  2.5.1 )",
    ". these changes of orbital elements are then converted into the accelerations of tracers ( section  2.5.2 ) .",
    "this approach allows us to handle viscous stirring , the stirring and damping parts of dynamical friction due to interactions between all pairs in the same manners regardless of their mass ratios .",
    "our approach is based on uniformities of the phases ( section  2.3 ) , and methods which explicitly solves pair - wise gravitational interactions ( i.e. , the acceleration of a smaller body in the lipad code ) are probably more accurate than ours .",
    "we would like to point out , however , that the lipad code also partly assumes uniformities of the phases because it uses the phase - averaged collision / encounter probability of greenzweig and lissauer ( 1990 ) ; note that @xmath464 we use and @xmath603 in the lipad code are the same quantity in different formats .",
    "ldt12 included planetesimal - driven migration of sub - embryos by adding torques on them calculated by a series of three - body integrations ( sun , the target , and the interloper ) during lipad simulations .",
    "each interloper is randomly chosen from one in seven hill radii of the target .",
    "it has the same semimajor axis , orbital eccentricity , and inclination as one of the tracers but its phases are modified . as far as we understand",
    ", their point is that the torque on the sub - embryo is smoothed by phase averaging",
    ". this may be true in the dispersion dominant regime ( @xmath604 ) . in the shear dominant regime",
    ", however , the phase dependence of the torque is weak and the averaged toque turns out to be as strong as the torque from a single interloping tracer at all [ see fig .  8 of ohtsuki and tanaka ( 2003 ) , for example ] .",
    "thus , sub - embryos should occasionally suffer strong kicks from tracers . although it is unclear to us whether the point described above is indeed an issue for the lipad code , sub - embryos in lipad simulations ( ngo , 2012 ) look radially much more stationary than those in our simulations ( section  3.6 ) .    in our method ,",
    "the angular momentum change of a sub - embryo is stored in the @xmath0-body routine but its release rate is limited to the theoretical prediction derived by the statistical routine ( section  2.6.2 ) .",
    "theoretical justifications of our method are discussed in section  3.3 .",
    "the lipad code performs a series of three - body integrations during a simulation for two cases .",
    "the first one is for the routine of sub - embryo migration .",
    "the another one is for the stirring routine in the shear dominant regime .",
    "our code does not need to perform three body integrations .",
    "migration of sub - embryos are handled as explained above . stirring in the shear dominant regime",
    "is handled using the approximated formulae of the phase - averaged stirring rates ( section  2.5 and appendix  b ) .",
    "adachi , i. , hayashi , c. , nakazawa , k. 1976 .",
    "the gas drag effect on the elliptical motion of a solid body in the primordial solar nebula .",
    "56 , 17561771 .",
    "kortenkamp , s.j . , wetherill g.w , 2000 . terrestrial planet and asteroid formation in the presence of giant planets .",
    "i. relative velocities of planetesimals subject to jupiter and saturn perturbations .",
    "icarus 143 , 6073 .",
    "morishima , r. , schmidt , m.w . ,",
    "stadel , j. , moore , b. 2008 . formation and accretion history of terrestrial planets from runaway growth through to late time : implications for orbital eccentricity .",
    "j. 685 , 12471261 .",
    "nagasawa , m. , lin , d.n.c . ,",
    "thommes , e.w . , 2005 .",
    "dynamical shake - up of planetary systems .",
    "i. embryo trapping and induced collisions by the sweeping secular resonance and embryo - disk tidal interaction .",
    "j. 635 , 578598 ."
  ],
  "abstract_text": [
    "<S> we introduce a new particle - based hybrid code for planetary accretion . </S>",
    "<S> the code uses an @xmath0-body routine for interactions with planetary embryos while it can handle a large number of planetesimals using a super - particle approximation , in which a large number of small planetesimals are represented by a small number of tracers . </S>",
    "<S> tracer - tracer interactions are handled by a statistical routine which uses the phase - averaged stirring and collision rates . </S>",
    "<S> we compare hybrid simulations with analytic predictions and pure @xmath0-body simulations for various problems in detail and find good agreements for all cases . </S>",
    "<S> the computational load on the portion of the statistical routine is comparable to or less than that for the @xmath0-body routine . </S>",
    "<S> the present code includes an option of hit - and - run bouncing but not fragmentation , which remains for future work .    </S>",
    "<S> accretion ; planetary formation ; planetary rings ; planets , migration ; origin , solar system </S>"
  ]
}