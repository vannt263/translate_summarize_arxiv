{
  "article_text": [
    "the free electron laser ( fel ) is now established as the brightest source of coherent hard x - rays in the world , with facilities currently operational in the usa  @xcite and japan  @xcite , and about to come online in switzerland  @xcite and hamburg  @xcite in the near future .",
    "owing to its flexibility and capacity for improvement , methods to further advance the radiation output are currently a topic of much research , and there are many methods proposed to improve the temporal coherence , increase the ouput power , and produce otherwise different types of output , such as multi - peaked spectra , pulse trains , x - rays with orbital angular momentum , or isolated short pulse output ( see @xcite-@xcite ; see also @xcite and references therein ) .",
    "there is also great interest in reducing the size and cost of future fels by utilizing novel accelerator technology .",
    "plasma accelerators are considered a promising future driver of fels , with their high accelerating gradients and large peak currents .",
    "the electron beams typical of plasma accelerators possess small emittance , a large energy spread , and are very short compared to beams from more conventional linac sources .",
    "these characteristics provide challenges in beam transport both to and through the undulator . with regard to the fel gain ,",
    "the large energy spread is potentially the most deleterious feature at first glance , but measurements and simulations imply that a large proportion of the energy spread is corellated with the temporal bunch coordinate .",
    "this chirp in the beam energy causes a detuning in the fel resonant frequency along the length of the bunch , and it is well known that this can be compensated for with an appropriate tapering of the undulator magnetic field  @xcite . the energy difference between the front and the back of the electron bunch will result in a velocity dispersion as the beam propagates , but it has generally been assumed that this can be neglected in the fel . thus , previous analytic work describing the use of undulator field tapering to compensate the beam chirp neglected this consideration . however , with the increased interest in novel accelerator concepts as fel drivers , _",
    "e.g. _ use of plasma accelerators @xcite-@xcite or the synthesis of broadband beams from linacs as in  @xcite , the case of larger chirps has become more relevant . in this regime ,",
    "dispersive effects can no longer be ignored , and the beam current and energy spread are a function of propagation distance through the undulator . consequently , the gain length of the fel is then itself a function of distance .",
    "in addition , dispersion due to the chirp will cause the gradient of the chirp to vary upon propagation , meaning that the taper necessary to compensate the chirp is also a function of undulator propagation length , and will not be linear .",
    "fel codes which employ ` slices ' with periodic boundaries to model the electron beam  @xcite-@xcite can not model this dispersion properly , as the electrons can not travel between slices , and so can not model any current redistribution through the undulator .",
    "the length of an individual slice is fixed and thus can not model the disperions - induced locally varying decompression .",
    "in addition , the slowly varying envelope approximation ( svea )  @xcite means that they can not model a broadband range of frequencies produced by large energy differences due to the chirp and/or a large taper .",
    "so - called ` unaveraged ' fel codes @xcite-@xcite are free of these limitations .",
    "for this reason , the unaveraged 3d fel code puffin  @xcite is used in the following analysis .    in the following ,",
    "the theory of compensating a beam chirp with an undulator taper is revisited , now including the effects of a velocity dispersion . the limits on when this dispersion is important",
    "are identified , and a more general expression for the taper required to compensate for an initially linear chirp is found .",
    "it is found that the limit of negligible dispersion is different , and more prohibitive , than the previously identified limit .",
    "the resulting beam compression or decompression varies the peak current , impacting the gain , even when cancelling the detuning effect with a taper .",
    "using an initially linear chirp and compensating for the detuning with the new , correct taper , the effect on the gain from the beam compression is isolated from the detuning effect , and calculated analytically , and is compared to numerical simulations .",
    "it is shown that a linear energy chirp does not disperse linearly , and so in this case the detuning effect can not be completely compensated for with a linear taper . finally , 3d fel simulations are presented to illustrate the effects on the output power of including significant velocity dispersion .",
    "note that typically the term ` taper ' refers to the technique of reducing the undulator magnetic field , and ` reverse - taper ' refers to the opposite ; in the following , for brevity , we use the term ` taper ' in a more general sense as altering the magnetic field , either increasing or decreasing .",
    "using the scaled notation of  @xcite , the propagation distance through the undulator is scaled to the 1d gain length , and the temporal coordinate in the stationary radiation frame is scaled to the 1d cooperation length , so that , respectively , @xmath0    the scaled axial velocity of the j@xmath1 electron is defined as @xmath2 where @xmath3 is the @xmath4 velocity in the undulator normalised to the speed of light .",
    "the subscript @xmath5 denotes some reference velocity , which is usually sensible to take as the mean velocity of the beam , but which in general may be any velocity , as the model presented in  @xcite allows a broadband description of both the radiation field and the electron energies . the resonant frequency corresponding to this reference velocity",
    "is then determined by @xmath6 and so , from eqn ( [ p2eqn ] ) , the electrons with @xmath7 are resonant with this reference frequency .",
    "tapering is achieved by varying @xmath8 , which is the relative change in the magnetic undulator field from its initial value , as defined in  @xcite .",
    "the gradient of an electron beam chirp may then be defined as @xmath9 only when assuming small deviations in energy , assuming a small chirp so that @xmath10 and assuming small deviations in the undulator magnetic field , @xmath11 .    rewriting the formula for the taper required to compensate the detuning effect  @xcite from a chirp in the above notation",
    ", we obtain @xmath12",
    "to take into account dispersive effects , it is convenient to describe the system using the @xmath13 phase space . @xmath14",
    "is the scaled velocity of the j@xmath1 electron in the @xmath15 frame , and so describes , linearly , how the beam will disperse .",
    "it also linearly measures the resonant wavelength of the electron ; from eqn ( [ p2eqn ] ) @xmath16 so it is the inverse of the frequency scaled to the reference frequency .     by variation of the undulator magnetic field @xmath17 . by altering the magnetic field , one may guide the blue electron to the correct value of @xmath13 to be resonant with the radiation in the slice indicated.,width=377 ]    relaxing the constraint on the energies - once again allowing large energy changes - then eqn ( [ oldtap ] ) is no longer correct . in the 1d limit , and using a helical wiggler , from equation ( [ p2eqn ] ) , @xmath14 may be defined as a function of @xmath17 and @xmath18 as @xmath19 under the approximation that @xmath20 , ignoring any transverse velocity spread ( 1d limit ) , and ignoring any interaction with the radiation field ( in the planar wiggler , one obtains the equivalent expression for @xmath14 averaged over the wiggle motion ) .    using this definition ,",
    "figure  [ z2p2comp ] shows the effect of tapering in the @xmath21 phase space , and shows what occurs when compensating for energy changes correlated in @xmath15 .",
    "the red electron , initially in the slice indicated , emits radiation at frequency @xmath22 before slipping back to the right .",
    "recall this is the stationary radiation frame , and the head of the pulse is to the left .",
    "the blue electron , slipping back into the thin slice , finds itself interacting with radiation it is not resonant with . by varying , or tapering , the magnetic field @xmath17 ,",
    "the value of @xmath13 of the blue electron can be manipulated , and reduced to the red electron s original value of @xmath13 ; therefore it is now resonant with the radiation in the slice originally emitted by the red electron .     as a function of scaled temporal coordinate @xmath15 at the start ( red ) and end ( blue ) of the undulator .",
    "bottom : same beam , now plotting the mean @xmath13 of the beam .",
    "the conversion from @xmath13 to @xmath18 can be obtained from eqn ( [ p2falpha ] ) .",
    "this is the stationary radiation frame , and the head of the beam is to the left , so the beam slips backwards through the field from left to right.,width=340 ]    consequently , if an electron beam has an initial linear chirp in @xmath13 , so that @xmath23 then the correct magnetic field taper to ensure the beam stays resonant should cause each electron to follow the line of the chirp defined by @xmath24 .",
    "figure  [ linp2 ] shows this .",
    "it plots the mean energy of a beam , and the corresponding mean @xmath13 , as a function of @xmath15 , at the start ( @xmath25 ) and end of an undulator tapered to compensate for the chirp .",
    "the taper may be derived from equations ( [ p2falpha ] ) and ( [ p2eqn ] ) , forcing @xmath26 and @xmath27 , and solving for @xmath17 .",
    "the solution is found to be : @xmath28 which reduces to the solution of equation ( [ oldtap ] ) only when @xmath29 for fel s using magnetic undulators , where @xmath30 , condition ( [ cond2 ] ) is satisfied .    to measure the beam compression or decompression from this linear @xmath13 chirp ,",
    "remembering that @xmath13 is the velocity of the electron in @xmath15 , then the change in the pulse width @xmath31 is @xmath32 so a stretch factor @xmath33 may be defined as @xmath34 from this , it is seen that condition ( [ cond1 ] ) is the limit of negligible dispersion in the undulator .",
    "this is different from the limit of a small chirp as previously identified in eqn ( [ oldcond2 ] ) , which is simply @xmath35 long , so the dispersive condition at the end of the undulator is more restrictive than the previously defined ` small chirp ' limit by around an order of magnitude . for lpwa fels , which have a larger slice energy spread and larger @xmath36",
    ", the undulator length may even be @xmath37 ( recall @xmath38 is scaled to the 1d gain length ) .    )",
    "( green ) compared to the gain length , measured from the numerical result produced in puffin ( blue , circles ) .",
    "the result from puffin is averaged over 10 shots , with the error bars indicating the standard deviation of the result.,width=453 ]",
    "the dispersion has an effect on the ` 3d ' gain length  @xcite , as the compression / decompression will cause a change in the peak current and energy spread of the beam .",
    "the change in peak current can be analytically estimated very simply by @xmath39    the dispersion will also alter the localised , or ` slice ' energy spread of the beam .",
    "however , in this case , when using a linear chirp in @xmath13 with the taper in equation ( [ corralpha ] ) , every electron follows the line with gradient @xmath24 in the @xmath40 phase space ( see figure  [ linp2 ] ) , so the slice @xmath13 spread does not change despite the compression / decompression .",
    "this corresponds to a variation in the peak transverse velocity , which is controlled by the peak magnetic field ( it is , of course , this control of the magnitude of the transverse wiggle which allows one to control the resonant frequency of the fel through the undulator magnetic field ) .    , now using an initially linear chirp in energy @xmath18 .",
    "the undulator is now tapered to try to keep the mean electron beam @xmath13 constant at @xmath41 . in this case , so that it is resonant with the reference frequency @xmath22 , @xmath42 at @xmath43 .",
    "the undulator taper is calcluated numerically , and is not linear.,width=340 ]    the other consideration is that the gain length is different for each frequency ; here , the frequency is linearly corellated with @xmath15 , and , because the taper is compensating perfectly , this correlation is fixed across the full undulator . again refering to figure  [ linp2 ] ,",
    "the mean @xmath13 at an instantaneous point in @xmath15 remains constant , but the corresponding mean energy ( from the top plot ) is very different .",
    "picking a coordinate initially in the center of the beam , @xmath44 , with corresponding beam energy @xmath45 , which is a function of @xmath38 , then the normailised energy of the electron resonant with the fixed frequency is given by @xmath46 where @xmath47 .    from the definition of the fel parameter",
    ", the gain length then varies as @xmath48 where @xmath49 is the gain length at @xmath25 , and the gain length as referred to here is the m. xie gain length , with only the energy spread parameter included .",
    "a comparison of this analytic expression with the unaveraged fel code puffin is shown in figure  [ lgvar ] .",
    "relevant parameters used are @xmath50 , @xmath51 , @xmath52 and @xmath53 , and slice spread of @xmath54 .",
    "the gain length from puffin is measured numerically from the radiated energy narrowly filtered around the frequency at @xmath44 , and compares well with the analytic result .",
    "note that the exponential gain region is @xmath55 to @xmath56 ; before this is the startup regime where there is no gain , and after this the system is in saturation .",
    "there is good agreement in the exponential gain regime .    by using a linear chirp in _ energy _",
    ", the beam compresses asymmetrically , and it is not possible the compensate for the detuning effect for all frequencies simultaneously .",
    "figure [ lingam ] plots the same quantities as figure [ linp2 ] , but with a linear energy chirp , and the taper is calculated numerically to keep the reference frequency at @xmath43 interacting with electrons resonant with it ( so , in this case , keeping @xmath42 ) .",
    "the same can be done for any frequency emitted , so it is possible to preferentially compensate for certain frequencies , but it is not possible to properly compensate for all frequencies across the bunch simultaneously .    however , this does not necessarly result in a higher power at that frequency .",
    "other factors , such as the energy and slice spread , change differently for each frequency .",
    "only the detuning effect is being compensated for ; the other quantities ( _ e.g. _ current ) , varying asymmetrically across the bunch , may result in less or more gain at other frequencies when all effects are accounted for .",
    "consequently , there is a large range of tapers which can be considered ` optimum ' .",
    "but the detuning effect can only be completely removed across the whole bunch , for all frequencies , when the beam has a linear chirp in @xmath13 , and using the taper described in equation ( [ corralpha ] ) . in that case , the effect on the gain length can be easily predicted .",
    "note that , in the above , only 1d effects have been taken into account .",
    "there is no examination of the change in diffraction parameter , beam divergence parameter _ etc _ ( from @xcite ) occuring as a result of the dispersion .",
    "to illustrate the effects in a practical example , results from 3d puffin simulations using parameters which may be expected from a laser plasma accelerator driven sase fel are now shown , displaying strong dispersive effects .",
    "the simulation uses a beam charge of @xmath57 , energy @xmath58 , length of @xmath59 in a flat - top current profile , homogeneous or ` slice ' spread of @xmath60 , and normalised emittance of @xmath61 .",
    "the beam is longer than might be expected from a ` typical ' lwa , to minimize the effects of a varying interaction length @xcite , which would further complicate the behaviour . to keep the current similar to our generic lwa case",
    ", the total beam charge is consequently increased from a usual scenario .",
    "note that in puffin it is necessary to tail off the edges of the flat top current profile with a short gaussian profile to remove the effects of self - amplified cse ( sacse ) @xcite , leaving only the sase process .",
    "this beam is injected into a helical undulator with initial undulator parameters @xmath62 , @xmath63 , giving a fel parameter @xmath64 , a 1d gain length of @xmath65 , and resonant wavelength @xmath66 nm .",
    "the previous @xmath67d analysis described an idealised system with linear chirps in the scaled velocity @xmath13 , and used non - linear tapers . in practice ,",
    "non - linear tapers as described in equation ( [ corralpha ] ) can be mechanically more difficult to realise than linear tapers , and the beam energy chirp is usually taken as linear .",
    "for this reason , in this example only linear _ energy _ chirps and magnetic field tapers are considered .",
    "two cases are considered ; the first with no chirp and no taper , and the second with a linear energy chirp ( such that the higher energies are towards the front of the bunch ) and a linear compensating taper ( such that @xmath68 increases along the undulator ) .",
    "the chirp gives an energy change of @xmath69 over @xmath70 m , giving @xmath71 at the center of the bunch , so condition ( [ smallm ] ) is perhaps satisfied ; however , because the undulator is @xmath72 @xmath67d gain lengths long , condition ( [ cond1 ] ) is _ not _ satisfied , and the fel interaction is strongly affected by the velocity dispersion .",
    "3d effects here introduce more complicated effects on the gain , which include a varying betatron wavenumber with beam energy and a varying diffraction length with frequency . as a result ,",
    "the effect on the gain is inherently more complex than in the 1d case .",
    "the beam radius is matched to the natural focusing channel of the undulator using the mean beam energy and the initial @xmath73 , so that the whole beam has this same initial radius for both cases ; but this may not be the optimal way to transversely match the beam in the chirped case .",
    "the compensating linear tapers are scanned over a range of values to achieve an optimum output for the chirped case . as noted in the previous section , due to the chirp varying with the undulator distance in the case of a linear _ energy _ chirp",
    ", there is a range of linear tapers which appear to maximise the radiated energy .",
    "for example , here it was found that tapers of @xmath74 all give extremely similar results in terms of the radiated energy .",
    "a value of @xmath75 is used here .",
    "m through the undulator , for a single shot of each case .",
    "each case has been normalised to its own maximum value to easily see the relative wavelengths of the spectral peaks . ,",
    "width=491 ]    figure [ example1 ] shows the comparison between the chirped and unchirped cases . in both cases ,",
    "the plotted result is the average over 5 shots .",
    "there is a significant difference in the energy output of over an order of magnitude , despite the undulator magnetic field taper used to minimize the detuning effect in the chirped case . in that case , where the beam decompresses , the peak current and slice spread are both reduced , producing an overall benefit to the gain .",
    "note that depending on the initial slice energy spread of the beam , the opposite may be true : that compression aids the fel process , and the decompression hinders it",
    ".    the current profile at the undulator exit in each case is also plotted , showing the differences in the final beam profile .",
    "in addition to the different peak current and beam length , the mean positions of the beams are also different due to the extra slippage induced when changing the undulator magnetic field in the tapered case , implying a change in the mean amplified frequency .    the beam is short enough that the radiation slips from the tail to the head of the bunch more than once within the undulator , meaning the taper shifts the peak in the amplified frequencies - a single frequency can not be maintained at resonance for the full undulator distance .",
    "lwa generated beams are typically roughly an order of magnitude shorter than the beam used here , so this can be an expected feature whilst tapering to help an lwa beam lase .",
    "this changing frequency , due to the taper and the shortness of the bunch , further complicates the previous 1d analysis , which examined the gain at a _ fixed _ frequency .",
    "the spectra at the end of the @xmath76 m undulator from a single shot from each case , also shown in figure [ example1 ] , exhibits this change in the amplified frequency in the chirped / tapered case , which is also implied by the different slippages from the plots of the current .",
    "one may see from eqn ( [ oldtap ] ) that the relative frequency change when using linear tapers to compensate for an energy chirp will be reduced for larger @xmath73 .",
    "also note that the bandwidth of amplified radiation in the chirped case is larger , as may be expected .",
    "these 3d examples show the beam dispersion playing an important role in the fel gain , and that this should be considered when measuring the gain if the expected beam chirp does not satisfy condition ( [ cond1 ] ) , as it may not in the case of lwa s .",
    "it has been shown that the beam dispersion in the undulator may be more important than previously acknowledged for presently achievable cases , especially in the realm of plasma driven fel s , and the constraint on when it is relevant is actually @xmath77 an order of magnitude tighter than the previously identified condition of a ` small ' chirp .",
    "a simple model was presented to take the dispersion into account , which allows an analytic solution for a matched taper to eliminate the detuning effect , and allows one to isolate the effects of the dispersion and measure them .",
    "it is shown that the unaveraged code puffin agrees with this result , in an extreme regime of fel operation .",
    "finally , an example shows the relevance of this work to laser plasma accelerator driven fel s .    in the case of lwa s , a chicane may be used to stretch the beam before insertion into the unduator as in@xcite to control or diminish these effects , if they are deemed to be undesirable .",
    "if the beam disperses within the undulator , then this may need to be considered while optimizing the chicane parameters .",
    "the discussion need not be limited to plasma accelerators , however , and the analysis presented here is entirely general , and can be applied to any case where a larger energy chirp is anticipated . in conventional linac driven uv / xray fels it is unlikely that the dispersion will be an issue at @xmath78gev , but for example at facilities used for a proof - of - principle demonstration of new fel techniques at lower energy ( _ e.g _ the proposed uk clara facility @xcite with energy @xmath79mev ) , these effects may also be important .",
    "we gratefully acknowledge the support of science and technology facilities council agreement number 4163192 release # 3 ; archie - west high performance computer , epsrc grant ep / k000586/1 ; epsrc grant ep / m011607/1 ; and john von neumann institute for computing ( nic ) on juropa at jlich supercomputing centre ( jsc ) , under project hhh20 .",
    "99    p. emma _ et al .",
    "_ , nat . photonics * 4 * , 641 ( 2010 ) h. tanaka _",
    "et al . _ , nat .",
    "photonics * 6 * , 540 ( 2012 ) r. ganter",
    "_ et al . _ ( eds ) , swissfel conceptual design report ( psi , 2011 ) altarelli , m. _ et al . _ ( eds ) .",
    "xfel : the european x - ray free - electron laser technical design report .",
    "desy 2006 - 097 ( desy , 2007 )                e.l .",
    "et al _ , phys . rev .",
    "beams * 9 * , 050702 ( 2006 ) a.r . maier _",
    "et al _ , phys .",
    "x * 2 * ( 2012 ) 031019 a. aschikhin _",
    "et al _ , the flashforward facility at desy , arxiv:1508.03192 , ( 2015 ) b.hidding _ et al _ , phys .",
    ". lett . * 108 * ( 2012 ) 035001 z. huang _",
    "et al _ , phys .",
    "lett . * 109 * ( 2012 ) 204801 e. hemsing , g. stupakov and d. xiang , rev .",
    "* 86 * , 897 ( 2014 ) j.r .",
    "henderson , l.t .",
    "campbell and b.w.j.mcneil , new j. phys .",
    "* 17 * 083017 h.p .",
    "freund , phys .",
    "e , * 52 * , 5401 ( 1995 ) s. reiche , nucl .",
    "instr . and meth .",
    "res . a * 429 * , 243 - 248 ( 1999 ) e.l .",
    "et al _ , nucl",
    ". instr . and meth .",
    "res . a * 429 * , 233 - 237 ( 1999 ) w.m .",
    "fawley , proceedings of fel 2006 , bessy , berlin , germany , 218 - 221 ( 2006 ) f.t .",
    "arecchi and r. bonifacio , ieee j. quantum electron . *",
    "qe-1 * , 169 ( 1965 ) l.t .",
    "campbell and b.w.j .",
    "mcneil , physics of plasmas * 19 * , 093119 ( 2012 ) n. piovella , phys .",
    "plasmas * 6 * , 3358 ( 1999 ) b.w.j .",
    "mcneil , g.r.m .",
    "robb and d.a .",
    "jaroszynski , optics comm .",
    "* 165 * , 65 ( 1999 ) s.i .",
    "bajlekov , s.m . hooker and r.",
    "bartolini , proc .",
    "fel 2009 liverpool , mopc42 ( 2009 ) c. maroli , v. petrillo and m. ferrario , phys . rev .",
    "beams * 14 * , 070703 ( 2011 )"
  ],
  "abstract_text": [
    "<S> the effects of a correlated linear energy / velocity chirp in the electron beam in the fel , and how to compensate for its effects by using an appropriate taper ( or reverse - taper ) of the undulator magnetic field , is well known . </S>",
    "<S> the theory , as described thus far , ignores velocity dispersion from the chirp in the undulator , taking the limit of a ` small ' chirp . in the following , </S>",
    "<S> the physics of compensating for chirp in the beam is revisited , including the effects of velocity dispersion , or beam compression or decompression , in the undulator . </S>",
    "<S> it is found that the limit of negligible velocity dispersion in the undulator is different from that previously identified as the small chirp limit , and is more significant than previously considered . </S>",
    "<S> the velocity dispersion requires a taper which is non - linear to properly compensate for the effects of the detuning , and also results in a varying peak current ( end thus a varying gain length ) over the length of the undulator . </S>",
    "<S> the results may be especially significant for plasma driven fels and low energy linac driven fel test facilities . </S>"
  ]
}