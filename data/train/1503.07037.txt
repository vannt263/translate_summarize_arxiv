{
  "article_text": [
    "materials properties such as electric conductivity , magnetic susceptibility or electrical polarizabilities , are defined from their response to perturbations that are governed by the quantum nature of the electrons .",
    "the calculation of such quantum response properties represents a major challenge because of the high cost involved . in traditional calculations",
    "the computational complexity scales cubically , @xmath0 , or worse , with the number of atoms @xmath1 , even when effective mean field models or density functional theory are used @xcite . by using the locality of the electronic solutions it is possible to reduce the computational cost for sufficiently large , non - metallic , materials to scale only linearly , @xmath2 , with the system size @xcite .",
    "initially , the development of linear scaling electronic structure theory was aimed at calculating ground state properties and not until recently has the focus shifted towards the computationally more demanding task of calculating the quantum response .",
    "a number of approaches to a quantum perturbation theory with reduced complexity have now been proposed and analyzed @xcite .",
    "linear scaling quantum perturbation theory has so far mainly concerned properties at zero electronic temperature .",
    "here we extend the idea behind linear scaling density matrix perturbation theory @xcite to calculations of static response properties valid also at finite electronic temperatures with fractional occupation of the states . our proposed canonical density matrix perturbation theory , which is applicable within effective single - particle formulations , such as tight - binding , hartree - fock or kohn - sham density functional theory ,",
    "can be applied to calculate temperature dependent response properties from the solution of the coupled perturbed self - consistent field equations @xcite as in density functional perturbation theory @xcite .",
    "the canonical density matrix perturbation scheme should be directly applicable in a number of existing program packages for linear scaling electronic structure calculations , including conquest @xcite , cp2k @xcite , ergo @xcite , femteck @xcite , freeon @xcite , honpas @xcite , latte @xcite , onetep @xcite , open - mx @xcite , and siesta @xcite . while originally motivated by its ability to achieve linear scaling complexity , our canonical density matrix perturbation theory is quite general and straightforward to use with high efficiency also for material systems that are too small to reach the linear scaling regime .",
    "the computational kernel of the algorithm is centered around generalized matrix - matrix multiplications that are well known to provide close to peak performance on many computer platforms using dense algebra , including graphics processing units ( gpu s ) @xcite .",
    "the paper is outlined as follows ; first we present the canonical density matrix perturbation theory .",
    "thereafter we show how it can be used to calculate temperature dependent free energy response properties , such as static polarizabilities and hyperpolarizabilities .",
    "we discuss the alternative of using finite difference schemes and its potential problems .",
    "we conclude by discussing the capability of the canonical density matrix perturbation theory to reach linear scaling complexity in the computational cost .",
    "a canonical density matrix response expansion , @xmath18 where @xmath19 = 0 $ ] for @xmath20 , with respect to a perturbation in the hamiltonian , @xmath21 can be constructed at finite electronic temperatures , @xmath22 , based on the recursive fermi operator expansion in eqs .",
    "( [ rec_f_1 ] ) and ( [ rec_f_2 ] ) above .",
    "the technique is given by a free energy generalization of the zero temperature linear scaling density matrix perturbation theory @xcite .",
    "the idea is to transfer the perturbations up to some specific order in each iteration step in the recursive fermi - operator expansion , i.e. @xmath23 for @xmath24 , where @xmath25 .",
    "the additional problem of conserving the number of particles in a canonical ensemble , which requires @xmath19 = 0 $ ] for @xmath20 , is achieved by including the corresponding perturbative expansion of the chemical potential , i.e. @xmath26 the values of @xmath27 ( @xmath28 ) can be found by an iterative newton - raphson optimization of the occupation error with respect to the chemical potential using the relation @xmath29 which for the approximate expanded density matrix , eqs .",
    "( [ rec_f_1 ] ) and ( [ rec_f_2 ] ) , is exact in the limit @xmath30 .",
    "the trace of @xmath31 , defined here , gives the change in occupation with respect to a change in @xmath8 .",
    "the small deviation from the exact analytic derivative for a finite expansion order @xmath15 is in practice insignificant , though for very low values of @xmath15 the rate of convergence will be slightly lower than quadratic in analogy to quasi newton schemes . in combination with low temperatures , low values of @xmath15 may also lead to loss of convergence ( see table [ tab_conv ] ) .",
    "however , in this case we could typically use regular zero temperature response theory , or alternatively , a modified search routine to adjust for the correct occupation would be needed .    the canonical density matrix perturbation theory based on eqs .",
    "( [ rec_f_1]-[newtraphs ] ) above , which is our first key result , is summarized by algorithm  [ canonical_fermi_op_prt ] for up to third order response .",
    "each inner loop requires the solution of a system of linear equations , which can be achieved with the conjugate gradient method using @xmath32 as initial guesses .",
    "the linear conjugate gradient method @xcite is ideal for this purpose , since it efficiently can take advantage of matrix sparsity to reduce the scaling of the computational cost @xcite .",
    "generalizations and modifications to higher order response , grand canonical schemes ( with a fixed value of @xmath8 ) , or spin - polarized ( unrestricted ) systems are straightforward .",
    "it is interesting to note that the system matrices on the left hand - side of the inner loop of algorithm  [ canonical_fermi_op_prt ] are all the same , i.  e. @xmath33 .",
    "the same inverse of @xmath33 would therefore give the response @xmath34 for all orders @xmath35 .",
    "the conditioning of the response algorithm should therefore be the same as for the original 0th - order expansion .",
    "the system matrix @xmath33 is very well conditioned with a spectral condition number smaller than or equal to 2 @xcite at any point of the algorithm . in the limit of low temperature and high @xmath36 , @xmath37 and in the opposite limit of high temperatures",
    "does the condition number go to 1 as @xmath38 .",
    "the well behaved conditioning is independent of the condition number of the hamiltonian used in the initialization .",
    "@xmath39 @xmath40 @xmath41 @xmath42 @xmath43 @xmath44 @xmath45 @xmath46 @xmath47 @xmath48 @xmath49 @xmath50 @xmath51)/tr[p_\\mu]$ ] @xmath52/tr[p_\\mu ] , ~~ \\{i = 1,2,3\\}$ ] @xmath53 - n_e| +   \\sum_{i = 1}^3 |tr[p^{(i)}]|$ ]",
    "@xmath54 @xmath55 @xmath56 @xmath57",
    "to study the quantum response valid at finite electronic temperatures , the electronic entropy contribution to the free energy has to be considered .",
    "we will look at two different situations : a ) non self - consistent band energy response as in regular tight - binding theory using an orthogonal matrix representation and b ) self - consistent free energy response as in density functional or hartree - fock theory using a non - orthogonal formulation .",
    "to clearly separate the two cases we will use two different notations . for the orthogonal tight - binding like formulation we keep using @xmath5 and @xmath3 , which is consistent with the previous sections , and for the self - consistent free energy response we use @xmath58 and @xmath59 for the non - orthogonal matrix representations and @xmath60 and @xmath61 for the orthogonalized representations , as is explained in the sections below .      in a simple tight - binding like formulation , the expansion terms for the canonical free energy , @xmath62 - t_e{\\cal s}[p(\\lambda ) ] = \\\\ ~\\\\ ~~ = \\omega^{(0 ) } + \\lambda \\omega^{(1 ) } + \\lambda^2 \\omega^{(2 ) } + \\ldots , \\end{array}\\ ] ] generated by a perturbation in @xmath63 , eq .",
    "( [ h_prt ] ) , with the electronic entropy @xcite , @xmath64 = - k_b tr[p\\ln(p ) + ( i - p)\\ln(i - p)],\\ ] ] are given by @xmath65.\\ ] ] this expression , with @xmath66 calculated from our canonical density matrix perturbation scheme in algorithm [ canonical_fermi_op_prt ] , is a straightforward generalization of the conventional @xmath67 limit of the `` @xmath68 '' rule @xcite and follows directly from the fact that the first order response term @xmath69 $ ] is cancelled by the response in the entropy @xcite .",
    "higher - order derivatives of order @xmath68 therefore contain at most a derivative of order @xmath36 in the density matrix .",
    "this generalization is possible only by including the entropy term in eq .",
    "( [ freee ] ) , which is required to provide a variationally correct description of the energetics .",
    "we have not been able to find any explicit density matrix expressions for wigner s @xmath70 rule @xcite that are valid also at finite temperatures .",
    "a more detailed derivation of eq ( [ resp_0 ] ) is given in the appendix .",
    "in self - consistent first principles approaches such as hartree - fock theory @xcite ( density functional and self - consistent tight - binding theory , although different , follow equivalently ) the free energy in the restricted case ( without spin polarization ) is given by a constrained minimization of the functional @xmath71 = 2tr[hd ] + tr[dg(d ) ] - 2 t_e { \\cal s}[d^\\perp ] , \\ ] ] under the condition that @xmath72 = n_e$ ] , where @xmath73 is the number of electrons ( two in each occupied state ) . here",
    "@xmath61 is the orthogonalized representation of the hartree - fock density matrix @xmath59 such that @xmath74 , and the orthogonalized effective single - particle hamiltonian is given by @xmath75 , where the fockian @xmath76 and @xmath77 is the inverse factor of the basis set overlap matrix @xmath78 such that @xmath79 .",
    "the density matrix , @xmath59 , is thus given by @xmath80^{-1 } z^t,\\ ] ] which can be calculated through the recursive fermi operator expansion in eqs .",
    "( [ rec_f_1 ] ) and ( [ rec_f_2 ] ) . here",
    "@xmath81 is the usual one - electron term and @xmath82 is the conventional two - electron part including the coulomb @xmath83 and exchange term @xmath84 , respectively @xcite . in density",
    "functional theory , the fockian @xmath58 is replaced by the corresponding kohn - sham hamiltonian , where the exchange term @xmath84 is substituted with the exchange - correlation potential term . notice that to make a clear distinction to the non - self - consistent response we use the notation @xmath59 and @xmath58 for the self - consistent hartree - fock density matrix and fockian , i.e. the effective single - particle hamiltonian .",
    "an alternative to the canonical density matrix perturbation theory is to perform calculations with finite perturbations and use finite difference approximations of the free energy derivatives .",
    "however , this can be far from trivial because the numerical errors are sometimes difficult to estimate and control , in particular for high temperature hyperpolarizabilities .",
    "nevertheless , by using finite steps @xmath91 of the perturbations in @xmath81 , combined with multi - point high - order finite difference schemes , it is sometimes possible to reach good accuracy .",
    "this is illustrated in fig .",
    "[ fig_1 ] , which shows the finite difference error in the approximation of the second order free energy response , @xmath92 , with respect to an external electric field for a self - consistent tight - binding model @xcite as implemented in the electronic structure program package latte @xcite .",
    "finite difference calculations of higher - order hyperpolarizabilities show similar behavior .    in a finite difference approximation",
    "it is difficult to know _ a priori _ what step size @xmath93 to use for the perturbations @xmath94 in eq .",
    "( [ firstorderprt ] ) .",
    "errors may be large unless careful numerical testing is performed",
    ". this can be expensive and even when an optimal step size has been found , the computational cost is still higher than the analytical approach .",
    "for example , to calculate the second order response using the five point finite difference scheme has a computational cost of about 5 times a ground state calculation , whereas the cost for the density matrix perturbation theory is only about 3 times larger .",
    "this cost estimate does not include the additional entropy calculations .",
    "the calculation of the entropy is difficult ( or impossible ) to perform accurately within linear scaling complexity .",
    "computationally favorable formulations that are based on approximate expansions of @xmath95 $ ] in eq .",
    "( [ sed ] ) are typically poor .",
    "for example , when any of the approximate entropy expressions , @xmath96 \\approx -k_b \\sum_{i = 1}^{m } c_i(m ) tr[p^m(p - i)^m],\\ ] ] with the coefficients @xmath97 in tab .",
    "[ tab_coef ] are used , the relative error of the polarizability in fig .",
    "[ fig_1 ] is increased by over 6 orders of magnitude for the most accurate 9 point finite difference approximation .",
    "the accuracy is at best only about 0.5 percent with any of the entropy approximations in eq .",
    "( [ s_approx ] ) and tab .",
    "[ tab_coef ] . only by avoiding explicit entropy calculations it is possible to reach a meaningful accuracy .",
    "this is possible in a finite difference approximation by using the finite differences of the dipole moments instead of the free energies .",
    "such calculations ( not shown ) avoid calculating the explicit entropy term and the numerical accuracy is similar to the finite difference approximations using the free energies with the exact entropy expression as illustrated in fig .",
    "[ fig_1 ] .",
    ".coefficients for the approximate entropy expression in eq .",
    "( [ s_approx ] ) .",
    "the coefficients are determined from the ansatz in eq .",
    "( [ s_approx ] ) with the requirement that the function value and a few of its derivatives are correct at the midpoint 0.5 of the interval [ 0,1 ] in which @xmath3 has its eigenvalues . [ cols=\"^,<,<,<\",options=\"header \" , ]      it is easy to understand the potential for a linear scaling implementation of canonical density matrix perturbation theory . owing to nearsightedness",
    "@xcite , both the hamiltonian and its perturbations , as well as the density matrix and its response , have sparse matrix representations for non - metallic materials when local basis set representations are used .",
    "the number of significant matrix elements above some small numerical threshold ( or machine precision ) then scales only linearly with the number of atoms for sufficiently large systems . in this case , since all operations in the canonical density matrix perturbation scheme in algorithm [ canonical_fermi_op_prt ] are based on matrix - matrix operations , the computational cost scales only linearly with system size if sparse matrix algebra is used in the calculations .",
    "this is not possible in regular rayleigh - schrdinger perturbation theory , which requires the calculation of individual eigenvalues and eigenfunctions .",
    "figure [ fig_scaling ] shows the number of non - zero elements above threshold as a function of system size for the density matrix and its first and second order response with respect to an electric dipole perturbation .",
    "the test systems are simple one - dimensional hydrocarbon chains of various lengths and the calculations where performed based on hartree - fock theory using a small gaussian ( sto-3 g ) basis .",
    "gaussian basis sets were not designed for the high - temperature expansions demonstrated here and we can expect that the accuracy is limited .",
    "the simulations therefore only serve as a schematic demonstration of the expected behavior . for example , at higher temperatures the locality , i.e.  the matrix sparsity , is increased similar to what is found for larger homo - lumo gaps @xcite , and for higher order response the locality decreases , as has been seen in previous studies of the zero temperature case @xcite . using a larger gaussian basis set should not change this general behavior of the locality and the results would still be uncertain .",
    "matrix sparsity may also suffer and numerical problems may arise due to ill - conditioning from linear dependencies between many gaussians",
    ". however , this will not affect the conditioning of the canonical density matrix response algorithm , alg .",
    "[ canonical_fermi_op_prt ] , and the low spectral condition number of @xmath98 , which is always @xmath99 , but it would affect the congruence transformation from the non - orthogonal atomic orbital representation of @xmath58 to @xmath60 .",
    "the input data of the response algorithm would thus be less accurate .",
    "localized numerical atomic orbital basis sets that have been tailored specifically for high - temperature expansions ( and with low condition numbers of the overlap matrix ) would then be a more appropriate choice .",
    "in summary , we have presented a canonical single - particle density matrix perturbation scheme that enables the calculation of temperature dependent quantum response properties .",
    "since our approach avoids the calculation of individual eigenvalues and eigenfunctions as well as the entropy , the theory is well adapted for reduced complexity calculations with a computational effort that scales only linearly with the system size .",
    "however , we may expect very fast parallel performance also for smaller systems in the limit of dense matrix algebra , since the computational kernel is centered around matrix - matrix multiplications that often can reach close to peak performance on modern hardware",
    ". the perturbation scheme should be applicable to a number of existing program packages for linear scaling electronic structure calculations .",
    "the los alamos national laboratory is operated by los alamos national security , llc for the nnsa of the us - doe under contract no .",
    "de - ac52 - 06na25396 .",
    "we gratefully acknowledge the support of the united states department of energy ( u.s .",
    "doe ) through lanl ldrd program , the gran gustafsson foundation , the swedish research council ( grant no . 621 - 2012 - 3861 ) , and the swedish national strategic e - science research program ( essence ) as well as stimulating contributions from travis peery at the t - division ten - bar java group .",
    "there are several techniques to calculate matrix exponentials . for example , if we start with @xmath100 a first order taylor expansion gives @xmath101 using this expansion we can approximate the fermi - dirac distribution function , @xmath102 , with @xmath103^{-1 } = \\lim_{n \\rightarrow \\infty } \\frac{(2n - x)^n}{(2n+x)^n + ( 2n - x)^n},\\ ] ] such that @xmath104 which is accurate for large values of @xmath36 .",
    "the pad polynomial function @xmath105 can be expanded recursively , since @xmath106 this particular property enables a rapid high - order expansions in only a few iterations in the recursive fermi - operator expansion , @xmath107 = { \\phi}(2n - 4nx_i ) \\\\ ~~\\\\ \\approx { f}_{n}(x_i ) = { f}_2({f}_2 ( \\ldots { f}_2(x_i ) \\ldots ) ) , \\end{array}\\ ] ] where @xmath108 with the recursion repeated @xmath109 times , i.  e.  for @xmath110 . in 30 steps ( @xmath111 ) this gives an expansion order of the pad polynomial of over 1 billion , but often less than 10 steps are needed .    the density matrix at finite electronic temperatures , @xmath112^{-1 } = { \\phi}\\left[\\beta(h-\\mu i)\\right],\\ ] ]",
    "can now be calculated with the recursive grand canonical fermi operator expansion , @xmath113 which forms the starting point in eq .",
    "( [ rec_f_2 ] ) , with @xmath114 .",
    "the recursive grand canonical fermi operator expansion , derivations , convergence analysis , and tests with various basis sets have been published previously in refs .",
    "@xcite .",
    "[ [ perturbation - response - for - the - non - self - consistent - single - particle - free - energy ] ] perturbation response for the non - self - consistent single particle free energy ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~    to derive eq .",
    "( [ resp_0 ] ) we start by noting that from the definition of the density matrix response and the perturbations in the hamiltonian , eqs .",
    "( [ p_resp ] ) and ( [ h_prt ] ) , we have @xmath115 } = k!p^{(k)}\\ ] ] and @xmath116 } = k!h^{(k)},\\ ] ] where we use square brackets for the regular taylor expansion terms , @xmath117}$ ] and @xmath118}$ ] , and round brackets , @xmath119 and @xmath66 , for the perturbation expansions as in eqs .",
    "( [ p_resp ] ) and ( [ h_prt ] ) .",
    "thereafter we can calculate the response terms @xmath120 from the derivatives of the free energy expression in eq .",
    "( [ freee ] ) , i.  e. @xmath121 it is easy to see that the first derivative of the entropy term @xmath122 $ ] in eq .",
    "( [ sed ] ) is given by @xmath123\\right\\lvert_{\\lambda = 0 } = - k_b tr\\left[(\\ln(p ) -\\ln(i - p))p^{[1]}\\right ] \\\\",
    "= - k_b tr\\left[\\ln\\left(p(i - p)^{-1}\\right)p^{[1]}\\right ] = -k_b tr\\left",
    "[ \\ln(e^{-\\beta(h-\\mu i)})p^{[1]}\\right ] \\\\ = k_b \\beta",
    "tr[hp^{(1 ) } ] , \\end{array}\\ ] ] since we have a canonical perturbation @xmath124 } ] = 0 $ ] and @xmath125^{-1}$ ] .",
    "this means that the first order response in the free energy @xmath126 is given by @xmath127 + tr[h^{(0)}p^{(1 ) } ] - t_e k_b \\beta tr[hp^{(1 ) } ] \\\\ = tr[h^{[1]}p^{[0 ] } ] = tr[h^{(1)}p^{(0 ) } ] . \\end{array}\\ ] ] for the second order expansion we find that @xmath128}p^{[1 ] } + h^{[2]}p^{[0 ] } ] \\\\ = \\frac{1}{2 } \\left(tr[h^{(1)}p^{(1 ) } ] + 2tr[h^{(2)}p^{(0)}]\\right ) .",
    "\\end{array}\\ ] ] for the third order expansion we find that @xmath129}p^{[2 ] } + h^{[2]}p^{[1 ] } + h^{[3]}p^{[0 ] } + h^{[2]}p^{[1 ] } ] \\\\",
    "= \\frac{1}{6 } tr[2h^{(1)}p^{(2 ) } + 2h^{(2)}p^{(1 ) } + 6h^{(3)}p^{(0 ) } + 2h^{(2)}p^{(1 ) } ] \\\\ = \\frac{1}{3 } \\left(tr[h^{(1)}p^{(2 ) } ] + 2tr[h^{(2)}p^{(1 ) } ] + 3tr[h^{(3)}p^{(0)}]\\right ) .",
    "\\end{array}\\ ] ] the straightforward @xmath109th - order generalization from consecutive derivatives gives eq .",
    "( [ resp_0 ] ) .      to derive the basis - set independent response of the free energy in eq .",
    "( [ resp_omega ] ) we first calculate the first order derivative of @xmath130 = 2tr[hd ] + tr[dg(d ) ] - 2 t_e { \\cal s}[d^\\perp ] , \\ ] ] with respect to @xmath87 in eq .",
    "( [ firstorderprt ] ) , i.  e. @xmath131\\right\\lvert_{\\lambda = 0 }   \\\\ = 2tr[h^{(1 ) } d + h d^{[1 ] } ] + 2tr[d^{[1 ] } g(d ) ] - 2 t_e k_b \\beta tr [ f^\\perp { d^{\\perp}}^{[1 ] } ] \\\\ = 2tr[h^{(1 ) } d ] + 2tr[(h+g(d))d^{[1 ] } ] -2 tr [ f^\\perp { d^{\\perp}}^{[1 ] } ] \\\\ = 2tr[h^{(1 ) } d^{[0 ] } ] + 2 tr[fd^{[1 ] } ] - 2 tr [ z^t fz { d^{\\perp}}^{[1]}]\\\\ = 2tr[h^{(1 ) } d^{[0 ] } ] + 2 tr[fd^{[1 ] } ] - 2 tr [ f d^{[1 ] } ] = 2tr[h^{(1 ) } d^{[0 ] } ] \\end{array}\\ ] ] where we have derived the entropy derivative as in eq .",
    "( [ entder ] ) above , used the definition of the fockian , @xmath132 , applied the congruence transformation between the orthogonal and non - orthogonal representations , e.  g. @xmath133 , and the cyclic permutation under the trace .",
    "subsequent derivatives , analogous to the previous appendix subsection above , gives eq .",
    "( [ resp_omega ] ) ."
  ],
  "abstract_text": [
    "<S> density matrix perturbation theory [ niklasson and challacombe , phys .  </S>",
    "<S> rev .  </S>",
    "<S> lett .  * 92 * , 193001 ( 2004 ) ] is generalized to canonical ( nvt ) free energy ensembles in tight - binding , hartree - fock or kohn - sham density functional theory . </S>",
    "<S> the canonical density matrix perturbation theory can be used to calculate temperature dependent response properties from the coupled perturbed self - consistent field equations as in density functional perturbation theory . </S>",
    "<S> the method is well suited to take advantage of sparse matrix algebra to achieve linear scaling complexity in the computational cost as a function of system size for sufficiently large non - metallic materials and metals at high temperatures . </S>"
  ]
}