{
  "article_text": [
    "much of the information about astronomical sources comes from spectral lines , requiring reliable analysis of multi - level line emission .",
    "most current methods for exact solutions involve accelerated @xmath1-iteration ( ali ) techniques in which the radiation intensity is obtained from the repeated action of an operator designated @xmath1 on the source function ( e.g. , rybicki 1991 , hubeny 1992 ) . the ali method utilizing short characteristics with parabolic interpolation of the source function ( hereafter scp ; olson , auer & buchler 1986 ) is a standard against which the efficiency of other line transfer techniques can be measured .    because of the complexity and computational demands of exact methods , many simulation codes that attempt to implement as many realistic physical ingredients as possible are altogether bypassing solution of the radiative transfer equation , employing instead the escape probability technique . in this approach",
    "only the level populations are considered , calculated from rate equations that include photon escape factors which are meant to account approximately for the effects of radiative transfer ( see dumont et al 2003 for a recent discussion and comparison with ali calculations ) . since this approach",
    "is founded on a plausibility assumption right from the start , its results amount to an uncontrolled approximation without any means for internal error estimates .",
    "nevertheless , this inherent shortcoming is often tolerated because of the simplicity and usefulness of the escape probability approach .",
    "we present here a new exact method , the coupled escape probability ( cep ) , that retains all the advantages of the naive escape probability approach . in this new technique",
    "the source is divided into zones , and formal level population equations that are fully consistent with radiative transfer are derived rigorously from first principles .",
    "different zones are coupled through terms resembling standard escape probability expressions , resulting in a set of level population equations with non - linear coefficients .",
    "solution of this set of coupled algebraic equations produces level populations that are self - consistent with the line radiation they generate .",
    "any desired level of accuracy can be achieved by increasing the number of zones .",
    "we introduce our new method in  2 . in ",
    "3 we study the 2-level model in both a semi - infinite atmosphere and finite slabs , presenting results and comparison with scp calculations .",
    "the new cep method attains the exact solutions , outperforming the scp method by substantial margins .",
    "we present the equations for multi - level systems in  4 and include as an example an application to the @xmath0p system of .",
    "section 5 contains a discussion that , among other things , covers various technical details .",
    "consider the transfer of a line with frequency @xmath2 .",
    "the dimensionless line profile is @xmath3 , normalized so that @xmath4 , where @xmath5 is the dimensionless frequency shift from line center and is the doppler width .",
    "we consider here only the case of @xmath3 that does not change its shape throughout the source and frequency independent line source function @xmath6 .",
    "these assumptions are adopted to simplify the presentation .",
    "they do not reflect inherent limitations of our new method .      for the geometry",
    "we adopt a plane - parallel slab whose physical properties vary only perpendicular to the surface . optical depth at frequency @xmath7 along a path orthogonal to the surface is @xmath8 , and @xmath9 can be used as a coordinate that uniquely specifies locations in the slab ( see figure [ fig : geometry ] ) .",
    "the optical depth along a ray slanted at @xmath10 from normal is @xmath11 , and the intensity along the ray obeys the radiative transfer equation the equation for the flux @xmath12 is obtained from integration over angles .",
    "the overall line flux @xmath13 obeys at every position in the slab where is the intensity averaged over both angles and line profile . denoting by @xmath14 the overall optical thickness and accounting for the emission from both faces of the slab ,",
    "the line contribution to the cooling rate per unit area is the line cooling factor  is introduced for convenience when  is constant in the slab . integrating equation [ eq : flux ] over @xmath9 yields here we introduced a quantity that has been called the net radiative bracket ( athay & skumanich 1971 ) . from the formal solution of the radiative transfer equation , when there is no external radiation entering the slab .",
    "0.2 in      denote by @xmath15 , with @xmath16 , the populations per sub - state of a given transition at position @xmath9 ; that is , @xmath17 where @xmath18 is the level degeneracy and @xmath19 is the overall level population",
    ". then the line source function is where @xmath20 and @xmath21 are the einstein coefficients of the transition .",
    "the populations are obtained from steady - state rate equations of the form @xmath22 .",
    "the term corresponding to exchanges between the transition levels , separated by @xmath23 , is where @xmath24 is the collision rate ; exchanges with other levels have similar form and are listed in  [ sec : multi ] .",
    "the common approach of exact solution methods is to handle radiative transfer and the level population distribution as two distinct problems , coupled through the results each of them gives .",
    "the problem is initialized with populations ( and the corresponding source functions ) obtained in some limiting case , e.g. , thermal equilibrium . with these populations , radiative transfer ( eq .  [ eq : rad_tran ] )",
    "is solved for the intensity to determine  ( eq .  [ eq : jbar ] ) , which is then plugged into the rate terms ( eq . [ eq : rate1 ] ) to determine new populations , and so on . however , from eqs .",
    "[ eq : p1 ] and [ eq : s ] , the rate term can be written as showing that the only radiative quantity actually needed for the calculation of level populations at every position is the net radiative bracket @xmath25 ; given this factor we could compute the level populations that are consistent with the radiation they produce without solving for the intensity . and as is evident from equations [ eq : p2 ] and [ eq : s ] , the factor @xmath25 itself can be computed from the level populations , again without solving for the intensity . therefore , inserting @xmath25 from equation [ eq : p2 ] into the rate terms ( eq .  [ eq : r21 ] ) produces _ level population equations that properly account for all the effects of radiative transfer without actually calculating the intensity itself _ ; the radiative transfer equation has been incorporated through its formal solution in equation [ eq : p2 ] .",
    "a numerical solution of the resulting level population equations requires a spatial grid , partitioning the source into zones such that all properties can be considered uniform within each zone .",
    "the degree of actual deviations from uniformity , and the accuracy of the solution , can be controlled by decreasing each zone size through finer divisions with an increasing number of zones .",
    "figure [ fig : geometry ] shows the slab partitioning into @xmath26 zones .",
    "the @xmath27-th zone , @xmath28 , occupies the range @xmath29 , with @xmath30 and @xmath31 .",
    "the optical depth between any pair of zone boundaries is so that the optical thickness of the @xmath27-th zone is @xmath32 .",
    "the temperature and collision rates are constant in the zone , and the corresponding rate term for its ( constant ) level populations is where the superscript @xmath27 is used as a zone label .",
    "the factor @xmath25 varies in the zone and has been replaced by a constant @xmath33 that should adequately represent its value there , for example @xmath34 $ ] or @xmath35)\\right)$ ] .",
    "there are no set rules for this replacement other than it must obey @xmath36 when @xmath37 .",
    "we choose for @xmath33 the zone average and this choice proved to be very successful in our numerical calculations . from eq .",
    "[ eq : p2 ] , calculation of @xmath33 requires an integration over the entire slab , which can be broken into a sum of integrals over the zones . in each term of the sum",
    ", the zone source function can be pulled out of the @xmath9-integration so that the remaining integrals can be expressed in terms of common functions .",
    "consider for example the contribution of zone @xmath27 itself to @xmath33 .",
    "it is straightforward to show that @xmath38 , where this function was first introduced by capriotti ( 1965 ) ; it is the probability for photon escape from a slab of thickness @xmath9 , averaged over the photon direction , frequency and position in the slab .",
    "the contribution of zone @xmath39 to the remaining sum can be handled similarly , and the final expression for the coefficient @xmath33 is where and where @xmath40 .",
    "the quantity @xmath41 obeys @xmath42 and @xmath43 , therefore @xmath44 and @xmath45 .",
    ", the first term could be incorporated into the sum in eq .",
    "[ eq : pi ] as the @xmath46 term . ]",
    "the first term in the expression for @xmath33 is the average probability for photon escape from zone @xmath27 , reproducing one of the common variants of the escape probability method in which the whole slab is treated as a single zone ( e.g. , krolik & mckee 1978 ) .",
    "the subsequent sum describes the effect on the level populations in zone @xmath27 of radiation produced in all other zones .",
    "each term in the sum has a simple interpretation in terms of the probability that photons generated elsewhere in the slab traverse every other zone and get absorbed in zone @xmath27 , where their effect on the level populations is similar to that of radiation external to the slab ( see appendix [ sec : external ] ) .    inserting the coefficients @xmath33 from eq .",
    "[ eq : pi ] into the rate terms ( eq .  [ eq : rate ] ) in every zone produces a set of non - linear algebraic equations for the unknown level populations @xmath47 .",
    "the procedure was outlined here only for the diffuse radiation of a single transition ; we describe the extension to multi - levels in  [ sec : multi ] and the inclusion of external radiation in appendix [ sec : external ] .",
    "_ solution of these equations yields the full solution of the line transfer problem by considering only level populations _ ; the computed populations are self - consistent with their internally generated radiation even though the radiative transfer equation is not handled at all .",
    "once the populations are found , radiative quantities can be calculated in a straightforward manner from summations over the zones .",
    "the emerging intensity at direction @xmath48 is the flux density emerging from each face of the slab obeys where @xmath49 is the third exponential integral ( e.g. , abramowitz & stegun 1972 ) .",
    "the line cooling coefficient is    the solution method just described is exact  the discretized equations are mathematically identical to the original ones when @xmath37 for every @xmath27 .",
    "as is usually the case , the only approximation in actual numerical calculations is the finite size of the discretization , i.e. , the finite number of zones .",
    "a desired accuracy is achieved when * * , * * upon further division * * , * * the relative change in all level populations is smaller than the prescribed tolerance .",
    "( see eq .",
    "[ eq : beta ] ) and @xmath50 ( eq .  [ eq : alpha ] ) . ]",
    "the level populations of all zones are described by a set of non - linear algebraic equations .",
    "the equations are readily solved by the newton method , which utilizes the jacobian of the set .",
    "since the dependence on the unknown variables is explicit in all the rate terms , the jacobian can be computed from analytic expressions .",
    "the functions @xmath51 ( see eq .",
    "[ eq : beta ] ) , @xmath50 and their derivatives are conveniently calculated from the representations    where @xmath52 is the second exponential integral .",
    "figure [ fig : alpha_beta ] plots @xmath51 and @xmath53 .",
    "while @xmath51 is a monotonically decreasing function , @xmath53 is monotonically increasing and its asymptotic behavior when @xmath54 is @xmath55 .",
    "this divergent behavior does not pose any problems because @xmath53 cancels to first order in the thickness of the zones in the linear combinations defining @xmath56 ( eq .  [ eq : m ] ) .",
    "only the second order terms , involving the second derivative @xmath57 , survive .    since our aim is to explore the intrinsic accuracy of our new method , the integrals in eq .",
    "[ eq : alpha ] were computed repeatedly with an 80 points gaussian quadrature to ensure that these integrations do not compromise the precision of the outcome .",
    "the @xmath58 functions were evaluated with a rapidly convergent series from press et al .",
    "the integration range was truncated at @xmath59 , which we have verified is sufficient in all cases thanks to the rapid decrease with @xmath60 of the integrands .    in order to test the new method , the radiative transfer problem was also solved using the ali method for comparison .",
    "the technique is based on a modified @xmath1 iteration in which the statistical equilibrium equations are linearized via the rybicky & hummer ( 1992 ) preconditioning scheme .",
    "the method also takes advantage of an operator splitting scheme by introducing an approximate operator @xmath61 , the diagonal of the exact operator @xmath1 in the formal solution @xmath62 $ ] of the radiative transfer equation .",
    "it has been shown that the introduction of this operator leads to an optimal balance between the convergence rate and computing time per iteration ( olson , auer & buchler 1986 ; carlsson 1991 ) .",
    "the ali calculations presented in this paper utilize a formal solver based on the short - characteristics scheme with parabolic precision ( olson , auer & buchler 1986 ) , currently considered the method of choice for complicated line transfer problems ( e.g. , kunasz & auer 1988 ; auer , fabiani bendicho & trujillo bueno 1994 ; van noort , hubeny & lanz 2002 ; fabiani bendicho 2003 ) . with this scp method ,",
    "equation [ eq : rad_tran ] was solved for many frequencies and ray inclinations , and the mean intensity computed from angular and frequency integrations ( eq .  [ eq : jbar ] ) by numerical quadratures . to ensure the high precision required in this comparative study ,",
    "the angular integration was done with a gaussian quadrature with 24 points in the variable @xmath48 .",
    "the frequency integrals were done with trapezoidal integration extending to @xmath63 with 33 frequency points , which we have verified yields the desired precision .",
    "we proceed now to present solutions and comparisons of the newly developed cep method with the scp method for a number of standard problems . in all the examples we employ uniform physical conditions and the doppler shape for the line profile , @xmath64 ; note that the line center optical depth is then @xmath65 .",
    "in the two - level problem , the steady - state rate equation @xmath66 = 0 ( eq . [ eq : rate1 ] ) yields the familiar expression for the source function where @xmath21 is the planck function and where here @xmath67 is the density of the collision partners and  the standard critical density with a slight modification that incorporates the boltzmann factor correction . replacing  with @xmath68 ( eq .  [ eq : p1 ] ) , the equation for the source function becomes this result also follows directly from eq .",
    "[ eq : r21 ] with @xmath66 = 0 .",
    "when the 2-level problem is formulated with optical depth as the independent variable , it is fully characterized by the two input quantities @xmath69 and @xmath70 ( or , equivalently , @xmath71 ) specified as functions of @xmath9 .",
    "there is no need to specify intrinsic properties of the transition such as , for example , @xmath72 or @xmath73 . instead of solving for the population of each of the two levels , this single equation for the unknown @xmath6 provides the complete solution of the problem .",
    "dividing the slab into zones , the rate equation @xmath74 = 0 ( eq.[eq : rate ] ) produces a similar expression for the @xmath27-th zone , with @xmath75 and @xmath76 corresponding to the physical conditions in the zone . inserting the expression for @xmath33 from equation [ eq : pi ] , the cep set of equations for the unknown @xmath77 is since the factors @xmath78 and",
    "@xmath56 depend only on optical depth , they are independent of the unknown variables ( the zone source functions @xmath77 ) in this case .",
    "therefore , _ the cep technique transforms the two - level problem to a set of linear equations_. this is a reflection of the linear relation between @xmath79 and @xmath6 in eq .",
    "[ eq : rad_tran ] that is maintained when the complete problem is handled in terms of optical depth as the independent variable .",
    "the cep formulation produces directly the explicit linear equations in this case .",
    "we proceed now with solutions for semi - infinite atmospheres and finite - thickness slabs with constant physical conditions .",
    "when the temperature is constant , @xmath69 merely sets the intensity scale and only the dependence on @xmath70 need be studied .",
    "( eq.[eq : epsilon ] ) in a semi - infinite atmosphere .",
    "the top panel of each plot shows the variation of the source function with depth into the atmosphere .",
    "the two other panels show the convergence to the exact solution as the number of zones @xmath26 is increased for the cep and scp methods .",
    "note the change in scale of the vertical axis between different panels.,title=\"fig : \" ]   ( eq.[eq : epsilon ] ) in a semi - infinite atmosphere .",
    "the top panel of each plot shows the variation of the source function with depth into the atmosphere .",
    "the two other panels show the convergence to the exact solution as the number of zones @xmath26 is increased for the cep and scp methods .",
    "note the change in scale of the vertical axis between different panels.,title=\"fig : \" ]   ( eq.[eq : epsilon ] ) in a semi - infinite atmosphere .",
    "the top panel of each plot shows the variation of the source function with depth into the atmosphere .",
    "the two other panels show the convergence to the exact solution as the number of zones @xmath26 is increased for the cep and scp methods .",
    "note the change in scale of the vertical axis between different panels.,title=\"fig : \" ]   ( eq.[eq : epsilon ] ) in a semi - infinite atmosphere .",
    "the top panel of each plot shows the variation of the source function with depth into the atmosphere .",
    "the two other panels show the convergence to the exact solution as the number of zones @xmath26 is increased for the cep and scp methods .",
    "note the change in scale of the vertical axis between different panels.,title=\"fig : \" ]    .runtime ( in seconds , on the same computer ) required by the scp and cep methods to solve an atmosphere with @xmath80 for the number of zones listed in the first column ; in the scp method this corresponds to the number of grid points .",
    "omitted entries were too short for meaningful timing .",
    "the listed error is the percent deviation from the result of an scp calculation with 3,000 zones . [ cols= \" > ,",
    "> , > , > , > , > , > \" , ]     .",
    "the top panel of each plot shows the exact solution and the result of a single - zone cep calculation .",
    "the two other panels show the convergence to the exact solution with the number of zones @xmath26 for the cep and scp methods.,title=\"fig : \" ] .",
    "the top panel of each plot shows the exact solution and the result of a single - zone cep calculation .",
    "the two other panels show the convergence to the exact solution with the number of zones @xmath26 for the cep and scp methods.,title=\"fig : \" ] .",
    "the top panel of each plot shows the exact solution and the result of a single - zone cep calculation .",
    "the two other panels show the convergence to the exact solution with the number of zones @xmath26 for the cep and scp methods.,title=\"fig : \" ] .",
    "the top panel of each plot shows the exact solution and the result of a single - zone cep calculation .",
    "the two other panels show the convergence to the exact solution with the number of zones @xmath26 for the cep and scp methods.,title=\"fig : \" ]      the advantages offered by the cep method are even more pronounced for slab emission calculations .",
    "figure [ fig : slab_j ] shows a striking result : when @xmath70 = ( i.e. , @xmath81 ) , the cep method produces with a single zone the correct line cooling coefficient for all slabs with @xmath82 ! this result is easy to understand . from the behavior of the function @xmath51 at small and large @xmath9 ( capriotti 1965 )",
    "it follows that @xmath83 when @xmath84 and that @xmath85 when @xmath86 , so that @xmath87 .",
    "therefore , slabs with @xmath88 have @xmath89 everywhere . from equations",
    "[ eq : s2 ] and [ eq : j ] it follows that in this case the expression for  involves only input properties . that is , _",
    "the line cooling coefficient can be calculated in this regime without even solving the problem_. this result does not seem to have been recognized in the published literature . when the physical conditions are constant , @xmath90 ; the source is optically thick yet its emission increases linearly with optical depth .",
    "the slab remains `` effectively - thin '' at large optical depths as long as @xmath91 ( i.e. , @xmath92 ) . and because the cep method employs discretized forms of these expressions , it reproduces the correct line emission irrespective of the division into zones .",
    "since @xmath93 can be calculated without solving any equations , the single - zone calculation produces the correct emission even though it does not reproduce the correct population distribution  as is evident from both eq.[eq : j_thin ] and figure [ fig : slab_s_epse-5 ] , the source function varies in the slab while the one - zone result is constant .",
    "still , this constant value is just the right average to reproduce correctly the slab luminosity .",
    "another perspective on this result is provided by the spectral shape of the emergent radiation , shown in figure [ fig : profile ] .",
    "the exact solution properly displays a self - absorption dip around line center ( see , e.g. , avrett & hummer 1965 ) .",
    "the single - zone calculation is incapable of producing this feature , but its flat - top shape does enclose the same area , reproducing the correct line luminosity .",
    "the simple one - zone calculation properly reproduces the overall number of photons emitted in the line , though not the frequencies where they emerge .    when the problem is formulated in terms of @xmath9 , eq .",
    "[ eq : j_thin ] gives the line emission directly from the input properties .",
    "when the problem is formulated instead in terms of densities and distances , eq .",
    "[ eq : j_thin ] implies that by d.  neufeld in benchmark testing of radiative transfer codes , posted at http://www.mpifr-bonn.mpg.de/staff/fvandertak/h2o/radxfrtest.pdf .",
    "note that the line cooling always obeys @xmath94 @xmath95 as is evident from eqs .",
    "[ eq : j ] , [ eq : s ] and [ eq : r21 ] . ]",
    "although the condition @xmath89 ensures that @xmath96 when @xmath97 , @xmath98 need not be negligible when @xmath99 .",
    "therefore , the solution must be executed in this case to determine the population distribution and the actual value of @xmath14 .",
    "since the single - zone calculation does not produce the correct population distribution , its result for the overall optical depth can be wrong . to ensure the correct assignment of @xmath14 to the prescribed input",
    ", the problem must be solved properly , including the division into zones .",
    "when @xmath70 increases , the slab ceases to be  effectively thin \" and the line luminosity begins to deviate from the one - zone cep result , as is evident from figure [ fig : slab_j ] .",
    "eventually , line thermalization sets in with further increase in @xmath70 , and the single - zone result again becomes adequate .",
    "this behavior is further illustrated in figure [ fig : j_eps ] . at a fixed @xmath14 ,",
    "the deviation from the single - zone cep calculation reaches a maximum when @xmath100 .",
    "when @xmath14 = 50 the maximal deviation is  20% at @xmath70  0.1 , when @xmath14 = 500 it is  70% at @xmath70  0.01 .",
    "varying @xmath70 away from that peak in either direction , the one - zone cep calculation gives a progressively better approximation .    with  = 43  @xmath101 at @xmath102 = 75 k ,",
    "the 158  line of is in the regime @xmath103 ( @xmath104 ) in most cases of interest",
    ". therefore single - zone cep calculations for this line are expected to produce cooling rates accurate to better than  10% under most circumstances .     = and optical depths as marked .",
    "the thick lines are the result of the exact solution , the thin lines of a single zone cep calculation . ]     in two - level models with various slab thicknesses . ]",
    "( # 1)^#1_ul ( # 1)^#1_ul    consider @xmath105 energy levels .",
    "a trivial change from the two - level case is the addition of some bookkeeping indices .",
    "we designate level numbers with subscripts and zone numbers with superscripts . in zone @xmath27 ,",
    "the population per sub - state of level @xmath106 is @xmath47 and the overall population is where @xmath18 is the level degeneracy . unlike the two - level system",
    ", locations in the slab can not be specified by optical depth anymore because each transition has a different optical depth , which can be determined only after the unknown @xmath47 are calculated . instead , the partition into zones is done in terms of the geometrical distance from one surface .",
    "denote by @xmath107 the width of the @xmath27-th zone , then its optical thickness in the transition between lower level @xmath108 and upper level @xmath109 is where @xmath110 is the energy separation between levels @xmath109 and @xmath108 .",
    "the equivalent of equation [ eq : tij ] is then when @xmath111 . in complete analogy with equations [ eq : rate ] ,",
    "[ eq : pi ] and [ eq : m ] , the level population equations are here where and where @xmath112 and @xmath113 .",
    "this provides a set of @xmath114 independent equations for the @xmath105 unknown populations in each zone , @xmath47 .",
    "equation [ eq : norm ] for the overall density in the zone closes the system .",
    "the overall system of non - linear algebraic equations for the level populations in all zones is readily solved with the newton method .",
    "it is convenient to switch to the scaled quantities @xmath115 as the unknown variables and introduce the overall column density neither densities nor physical dimensions need then be specified since only enters as an independent variable ; the zone partition is done in terms of rather than @xmath116 .",
    "the problem is fully specified by three input parameters : density @xmath67 of collision partners and temperature @xmath102 , which together determine the collision terms , and  ( in fact , / ) , which sets the scale for all optical depths .",
    "p cooling lines of with the number of zones in cep calculations . shown are the ratios to the exact solutions for slabs with @xmath102 = 100 k , various h densities , as marked , and three representative oxygen column densities . at ( o ) @xmath117 @xmath118 , the single - zone calculation produces the exact result for both lines .",
    "the critical density for each line is listed in the top figure.,title=\"fig : \" ] p cooling lines of with the number of zones in cep calculations . shown",
    "are the ratios to the exact solutions for slabs with @xmath102 = 100 k , various h densities , as marked , and three representative oxygen column densities . at ( o ) @xmath117 @xmath118 , the single - zone calculation produces the exact result for both lines .",
    "the critical density for each line is listed in the top figure.,title=\"fig : \" ] p cooling lines of with the number of zones in cep calculations . shown",
    "are the ratios to the exact solutions for slabs with @xmath102 = 100 k , various h densities , as marked , and three representative oxygen column densities . at ( o ) @xmath117 @xmath118 , the single - zone calculation produces the exact result for both lines .",
    "the critical density for each line is listed in the top figure.,title=\"fig : \" ]      +    +        together with the 158 , the @xmath0p lines of at 63  and 145  dominate the gas cooling of warm pdr .",
    "ratios and peak intensities of these lines are used to measure the gas density and temperature ( tielens & hollenbach 1985 ) . in  [ sec : slab_j ] we found that simple escape probability calculations do reproduce the proper 158 emission .",
    "we now examine the behavior of lines through an exact cep calculation of the three levels of the @xmath0p system .",
    "we solve for slabs with constant physical conditions , specified by temperature , hydrogen density and oxygen column density ( o ) .",
    "figure [ fig : oi_zones ] shows the effect of varying the number of zones on the cooling lines emission at @xmath102 = 100 k ; the results are similar for @xmath102 = 300 k and 500 k. single - zone cep calculations produce the exact result at @xmath119 @xmath118 , but deviate from it at larger column densities by amounts that increase with ( o ) .",
    "the deviation is different for each line , reflecting their different critical densities , which are listed in the figure , and optical depths ; for reference , at ( o ) = @xmath118 @xmath120  100 while @xmath121 varies from 0.6 to 2 , depending on the density .",
    "because of the different trends displayed by the emission in the two cooling lines , the one - zone calculation generally misses the exact result for their ratio @xmath122 .",
    "figure [ fig : oi_ratios ] shows the variation of @xmath123 with column density and the deviations of the results of a one - zone calculation from the exact values .",
    "the single - zone results differ from the exact values by amounts that vary with temperature , density and oxygen column density .",
    "the deviations are generally largest at hydrogen densities around 3   4  @xmath101 .",
    "as is evident from this figure , the variation range of @xmath123 is comparable to the error that can be introduced by its calculation with a single - zone .",
    "a reliance on such calculations can lead to erroneous conclusions regarding the physical conditions in a source .",
    "indeed , from the observed ratio of the two [ oi ] lines and escape probability calculations , caux et al ( 1999 ) deduced a mean gas temperature of 26@xmath1240.5 k , an h@xmath125 density @xmath126 34 @xmath101 and an [ oi ] column density @xmath126 5 @xmath118 .",
    "however , as is evident from figure [ fig : oi_ratios ] , the large values which they observed ( @xmath127 ) can be reached at lower columns for a wide range of somewhat higher temperatures .",
    "one - zone cep calculations of the cooling lines are not as reliable as they are for the 158 .",
    "however , it does not take too many zones for the cep method to achieve adequate accuracy .",
    "as is evident from figure [ fig : oi_zones ] , 20 zones suffice for accomplishing better than 10% accuracy , and the exact solution is reached to within 1% with 40 zones in all cases .",
    "the test cases presented here show that our new method not only provides an exact solution of the line transfer problem , it also outperforms the leading ali solver by a margin even larger than that among different implementations of the ali technique .",
    "two fundamental properties give the cep method intrinsic advantages .",
    "the first is the calculation of , the only radiative quantity required for solving the level populations . in the standard approach",
    ", @xmath128 is determined from a solution of eq .",
    "[ eq : rad_tran ] and is calculated from eq .",
    "[ eq : jbar ] in angular and frequency integrations that involve a - priori unknown dependencies on these two variables . determining",
    "the dependence of @xmath128 on @xmath7 and @xmath48 is a major task for the solution of the radiative transfer equation .",
    "deviations of the computed @xmath128 from its exact angular shape and frequency profile contribute to the error in the computed  in each iteration .",
    "in contrast , the cep method determines  from the integration in eq .",
    "[ eq : p2 ] that involves known dependencies on both @xmath7 and @xmath48 ; the dependence on these variables enters only from the optical depth @xmath129 , and it is a - priori known from the input to the problem .",
    "the angular and frequency integrations are exact in the cep method ; the fact that the dependence of @xmath128 on @xmath7 and @xmath48 is unknown is altogether irrelevant .",
    "the other intrinsic strength of the cep method is that it involves only level populations and thus takes full advantage of thermalization wherever that sets in .",
    "in contrast , the ali technique must repeatedly solve the radiative transfer equation in the entire source , even in thermalized regions , to determine the radiation field everywhere .",
    "the great efficiency of the newton method in solving non - linear equations is another advantage of the cep method .",
    "the prerequisite for a successful solution is a reasonable initial guess .",
    "an efficient strategy for working implementations of cep is to start from the actual populations of a previous solution for similar physical conditions .",
    "a particularly useful approach is to start from the optically thin limit in which @xmath68 = 1 everywhere and solve the level populations from the corresponding linear equations .",
    "the column density  is now increased in small steps until the desired value is reached , using in each step the populations from the previous one as the initial distribution .",
    "this technique can also work in the opposite direction  start from thermal equilibrium populations and a very large , and decrease  in small steps .",
    "an added advantage of this approach is that each step also provides information about the number of zones required for cep convergence .",
    "the newton method requires inversion of the jacobian matrix , and the number of operations in this process increases as the third power of the matrix dimension .",
    "although this rapid rise did not have a serious effect in the examples presented here , it could degrade the performance in cases of very large numbers of levels and zones .",
    "matrix inversion is avoided in the iterative scheme designed by van der vorst ( 1992 ) for solution of the linear system of the newton method . in this scheme ,",
    "geared toward sparse jacobian matrices , only the non - zero matrix elements are stored and used .",
    "we have experimented with this method and found it to be quite useful for the cep technique .",
    "it is particularly suitable for multi - level problems because they tend to produce sparse matrices , as each level generally couples to only a limited number of other levels .",
    "other alternatives are to use quasi - newton schemes ( e.g. , broyden s method ) like those employed by koesterke et al .",
    "( 1992 ) , or evolve the set of differential equations [ eq : final ] until reaching steady state .    the efficiency of cep computations can be further enhanced with better grid design .",
    "our solutions of the semi - infinite atmosphere employed grids with equal logarithmic spacing in @xmath9 over ten orders of magnitude , resulting in extremely thick zones deep inside the atmosphere . for example , even with @xmath26 = 600 , the zone thickness was @xmath130 in the @xmath131 region .",
    "these extremely thick zones do not pose any difficulties to cep computations because they occur in regions where the populations are thermalized .",
    "indeed , the zones could be even thicker in a much larger fraction of the source without compromising accuracy .",
    "it should thus be possible to achieve the same accuracy with fewer zones by concentrating them in the regions were the populations deviate from thermal equilibrium .",
    "since the number of zones is the single most important factor in determining cep runtime , a more sophisticated grid construction will make the method even more efficient .",
    "we intend to investigate the implementation of adaptive gridding algorithms in future work .",
    "an additional increase in efficiency can be easily gained in practical applications that do not require the extreme precision we imposed in this comparative study . here the functions @xmath53 and @xmath51 were calculated using the integral definition in eq .",
    "[ eq : alpha ] , repeatedly performing highly accurate quadrature .",
    "instead , one could employ the approximate series expansion derived by capriotti ( 1965 ) for the function @xmath51 .",
    "we have verified that this rapidly convergent series is always within 3% of the exact result .",
    "portions of the expansion were joined at line - center optical depth @xmath132 = 5 .",
    "they should be joined instead at @xmath132 = 3.41 for a smooth transition . ]",
    "another option is to calculate once a finely spaced table of the @xmath53 and @xmath51 functions and interpolate between its elements with an efficient algorithm .",
    "the cep method is suitable for solution also with the ali approach .",
    "starting from eq .",
    "[ eq : jbar ] in the operator form @xmath133 , the ali technique is based on the operator splitting @xmath134 , where @xmath61 is an approximation to the @xmath1 operator .",
    "the mean intensity is obtained from the approximate expression @xmath135 that involves the source function from the current and previous iterations .",
    "this approximation becomes exact upon convergence , when @xmath136 .",
    "as already noted , it has been shown that the optimal choice for @xmath61 is the diagonal of @xmath1 .",
    "equation [ eq : p1 ] gives @xmath137 , the @xmath1-operator form of the cep method . from eq .",
    "[ eq : pi ] , the matrix elements of the cep @xmath1-operator are simply where @xmath138 is the kronecker delta .",
    "thanks to the known dependence on @xmath7 and @xmath48 in the cep approach , this expression allows the usage of approximate operators @xmath61 of increasing complexity without any additional computational effort in the calculation of the matrix elements . in standard ali techniques",
    "@xmath61 is the diagonal of @xmath1 , i.e. , @xmath139 .",
    "we have implemented this choice in an ali solution of eq .",
    "[ eq : s2a ] and performed the two - level model calculations presented in this paper also with this technique . in all cases ,",
    "the solution converged to the exact same results as the algebraic cep equations [ eq : s2cep ] .",
    "runtime for this ali implementation of the cep method was on par with the scp method up to 200 zones , but fell behind at larger @xmath26 . given that in the cep ali implementation we have adopted the standard choice for @xmath61 , the optimal choice in the cep approach could well be different , improving the performance .",
    "it is also important to point out that the cep method could , in principle , be implemented in the framework of the gauss - seidel and successive overrelaxation iterative methods .",
    "these methods were first applied in radiative transfer problems by trujillo bueno & fabiani bendicho ( 1995 ) using scp as the formal solver . they can lead to an order of magnitude improvement in the number of iterations used to reach convergence , with a time per iteration that is virtually the same as the method based on the jacobi iteration .",
    "also of interest is the possibility of implementing the cep method in the linear ( steiner 1991 ) or the non - linear ( fabiani bendicho , trujillo bueno & auer 1997 ) multi - grid methods .",
    "all of these issues will be addressed in future investigations .",
    "all the examples presented in this paper involved constant physical conditions .",
    "variable conditions are handled by simply starting with zones that have constant physical conditions and proceeding to refine those divisions as required by the cep solution accuracy .",
    "equation [ eq : final ] for the level populations already incorporates the handling of variable conditions by allowing the temperature and collision rates to vary between the zones .    for simplicity ,",
    "our method was introduced in the context of a quiescent slab with the doppler line profile .",
    "none of these simplifications represents an inherent limitation of the cep method .",
    "the formal expressions do not specify the shape of @xmath3 , and other line profiles can be implemented just the same .",
    "extension from the slab to other geometries , although straightforward , requires some more work .",
    "thanks to the planar symmetry , the angular variation of optical depth in a slab is simply @xmath140 , independent of either position or density profile .",
    "this symmetry does not carry to any other geometry ; even in the case of spherical symmetry , the angular variation of @xmath9 can not be calculated at any point other than the center without specifying the density profile .",
    "however , generalizing the basic cep relation eq .",
    "[ eq : p2 ] to handle any geometry is straightforward , and the fundamental advantage of integration over known frequency and angular variations remains intact . finally , recalling that large velocity gradients was the context in which the escape probability approximation was originally introduced by sobolev , the cep method is well suited for exact handling of this case too .    the escape probability approach has been used in a number of simplified calculations of complex problems .",
    "these include : overlapping of spectral lines ( so called  line fluorescence \" ) , important for various ionic transitions ( e.g. , bowen lines ) in photoionized regions and oh lines in molecular clouds ( guilloteau , lucas & omont 1981 , elitzur & netzer 1985 , lockett & elitzur 1989 ) ; the effect of line overlap with underlying continuum ( netzer , elitzur & ferland 1985 ) ; and photoionization ( elitzur 1984 ) .",
    "importing these applications into the cep framework is straightforward . finally , another extension is the application of the cep method to the self - consistent solution of the radiative transfer equations for polarized radiation and of the statistical equilibrium equations for the density matrix , the so - called non - lte problem of the 2@xmath141 kind ( see , e.g. , landi deglinnocenti 2003 ) .",
    "we plan to provide these extensions in future publications .",
    "while our new method outperforms the current leading techniques , its greatest advantage is its simplicity and ease of implementation .",
    "the cep method employs a set of algebraic equations ( eq .",
    "[ eq : final ] ) that are already incorporated in numerous widely used codes based on the escape probability approximation .",
    "all that is required for an exact solution with these existing codes is to augment the escape probability with the zone - coupling sum on the right - hand - side of eq .",
    "[ eq : p_ul ] . with this simple modification ,",
    "the multi - level line transfer problem is solved exactly .",
    "we thank riccardo cesaroni , floris van der tak and stphane guilloteau for valuable remarks that helped us considerably in the preparation of this manuscript .",
    "this research was supported by nsf , nasa , the european commission through the solar magnetism network ( contract hprn - ct-2002 - 00313 ) and by the spanish ministerio de educacin y ciencia through project aya2004 - 05792 .",
    "=    abramowitz , m. , & stegun , i.  a.  1972 , handbook of mathematical functions , ( new york : dover ) apruzese , j.p . , et al 1980 , jqsrt 23 , 479 athay , r.g . ,",
    "& skumanich , a. , 1971 , apj 170 , 605 auer , l. , fabiani bendicho , p. , & trujillo bueno , j. 1994 , a&a , 292 , 599 avrett , e.h . & hummer , d.g .",
    "1965 , mnras 130 , 295 avrett , e.h .",
    "& loeser , r. 1987 , in numerical radiative transfer , ed",
    ". w. kalkofen ( cambridge : university press ) , 135 capriotti , e.r . , 1965 ,",
    "apj 142 , 1101 carlsson , m. 1991 , in stellar atmospheres : beyond classical models , eds .",
    "l. crivellari , i. hubeny , & d.g .",
    "hummer ( dordrecht : kluwer ) , 39 caux , e. , et al 1999 , a&a 347 , l1 dumont , a .- m . , et al 2003 , a&a 407 , 13 elitzur , m.  1984 , apj , 280 , 653 elitzur , m. , & netzer , h.  1985 , apj , 291 , 464 fabiani bendicho , p. , 2003",
    ", in stellar atmosphere modeling , eds .",
    "i. hubeny , d. mihalas & k. werner , asp conf .",
    "288 , p. 419",
    "fabiani bendicho , p. , trujillo bueno , j. & auer , l. h. 1997 , 324 , 161 guilloteau , s. , lucas , r. , & omont , a.  1981 , a&a , 97 , 347 hubeny , i. , 1992 , in the atmospheres of early - type stars , eds .",
    "u. heber & c. s. jeffery ( berlin : springer - verlag ) , 377 jacobi , c. g. 1845 , astron .",
    "nachr . , 32 , 297 koesterke , l. , hamann , w .- r . , & kosmol , p. , 1992 ,",
    "a&a , 255 , 490 krolik , j.h . , & mckee , c.f",
    ". , 1978 , apjs 37 , 459 kunasz p.b . , &",
    "auer l.h . , 1988 ,",
    "67 landi deglinnocenti , e. , 2003 , in proceedings of the xii canary islands winter school of astrophysics , eds . j. trujillo bueno , f. moreno - insertis , & f. snchez , ( cambridge university press : cambridge ) , 1 lockett , p. , & elitzur , m.  1989 , apj , 344 , 525 netzer , h. , elitzur , m. , & ferland , g.  j.  1985 , apj , 299 , 752 ng , k. c. 1974 , j. chem .",
    "phys . , 61 , 2680 olson , g. l. , auer , l. h. , & buchler , j. r. 1986 , jqsrt , 35 , 431 press , w. h. , teukolsky , s. a , vetterling , w. t , & flannery , b. p. 1986",
    ", numerical recipes , cambridge university press rybicki , g.b . , 1991 , in stellar atmospheres : beyond classical models , eds .  l. crivellari , i. hubeny , & d.g .",
    "hummer ( dordrecht : kluwer ) , 1 rybicki , g. b. , & hummer , d. g. 1992 , a&a , 262 , 209 steiner , o. 1991 , a&a , 242 , 290 tielens , a.g.g.m .",
    ", & hollenbach , d. , 1985 , apj 291 , 722 trujillo bueno , j. , & fabiani bendicho , p.  1995 , apj , 455 , 646 trujillo bueno , j. , 2001 , in the promise of the herschel space observatory , eds .  g.l .",
    "pilbratt , j. cernicharo , a.m. heras , t. prusti , & r. harris , esa - sp 460 , p. 261",
    "van der vorst , h. 1992 , siam j. sci .",
    "13 , 631 van noort , m. , hubeny , i. , & lanz , t. 2002 , apj , 568 , 1066 van zadelhoff , g .- j . , et al 2002 , a&a , 395 , 373",
    "the only effect of external radiation on the rate equations is to modify the exchange rate @xmath142 between levels @xmath109 and @xmath108 in the @xmath27-th zone ( see eq .",
    "[ eq : rate ] ) according to where  is the zone average ( as in eq .",
    "[ eq : avg ] ) of the contribution of the external radiation to the local @xmath143 .",
    "when the external radiation corresponds to the emission from dust which permeates the source ,  is simply the angle - averaged intensity of the local dust emission in the @xmath27-th zone .",
    "when the external radiation originates from outside the slab and has an isotropic distribution with intensity  ( @xmath144 ) in contact with the @xmath145 face , then when the slab is illuminated by parallel rays with intensity  ( @xmath146 ) entering at direction ( @xmath147 ) to the @xmath148 face then where"
  ],
  "abstract_text": [
    "<S> we present a new method , the coupled escape probability ( cep ) , for exact calculation of line emission from multi - level systems , solving only algebraic equations for the level populations . </S>",
    "<S> the cep formulation of the classical two - level problem is a set of _ linear equations _ , and we uncover an exact analytic expression for the emission from two - level optically thick sources that holds as long as they are in the  effectively thin \" regime . in comparative study of a number of standard problems , </S>",
    "<S> the cep method outperformed the leading line transfer methods by substantial margins .    </S>",
    "<S> the algebraic equations employed by our new method are already incorporated in numerous codes based on the escape probability approximation . </S>",
    "<S> all that is required for an exact solution with these existing codes is to augment the expression for the escape probability with simple zone - coupling terms . as an application </S>",
    "<S> , we find that standard escape probability calculations generally produce the correct cooling emission by the 158  line but not by the @xmath0p lines of .    </S>",
    "<S> [ firstpage ]    radiative transfer  line : formation  methods : numerical  ism : lines and bands </S>"
  ]
}