{
  "article_text": [
    "in earlier papers , monte carlo ( mc ) methods were used to construct spectral synthesis codes for sne in their photospheric phases .",
    "because the emphasis was on coarse analyses of the spectra of newly - discovered sne , major simplifying approximations were made to minimize computing time and to ensure robustness .",
    "thus , in the first code ( lucy 1987 ; mazzali & lucy 1993 ) , the sn s atmosphere is spherically - symmetric and homologously expanding , the radiation field is stationary ( @xmath4 ) , continuum formation is confined to a sharply - defined lower boundary ( schuster - schwarzschild approximation ) , and line formation results from the coherent scattering of this continuum as it propagates through the outer layers .",
    "moreover , the stratifications of temperature , ionization and excitation are derived not from first principles but from formulae that approximate the effects of dilution in the sn s extended atmosphere .    in a subsequent paper ( lucy 1999b )",
    ", two innovations significantly improved this code .",
    "first , coherent scattering was replaced by downward branching as the mechanism of line formation .",
    "secondly , a computed spectrum s sampling errors were greatly reduced by using the formal integral for the emergent intensity instead of simply binning the escaping photon packets .",
    "although these codes have proved their worth diagnostically , they can not compute spectra for explosion models , a challenge that must be faced if explosion mechanisms and progenitor scenarios are to be confronted with observed spectra and light curves . evidently , simplifying assumptions",
    "must be reconsidered in planning a more powerful and versatile code .",
    "first , the assumption of stationarity must be abandoned . as arnett ( 1980 , 1982 ) long ago demonstrated for sne both of types i and ii , the luminosity @xmath5 at elapsed time @xmath6 does not in general closely approximate the instantaneous energy deposition rate by @xmath2-rays emitted in radioactive decays .",
    "accordingly , the time - dependent diffusion of radiant energy through the expanding ejecta must be treated explicitly if we wish to compute the emergent luminosity density @xmath7 as a function of time .",
    "similarly , artificially creating radiant energy by means of a continuum - emitting lower boundary is no longer acceptable",
    ". the computational domain must be the complete configuration , not just a reversing layer ; and continuum formation must be treated explicitly . escaping radiant energy then derives ultimately from radioactive decays or from the energy content of the ejecta at @xmath8 , the time at which the output from an explosion calculation is used to initiate the spectral synthesis code .",
    "removal of the constraint of spherical symmetry is also highly desirable in view of accumulating observational evidence and theoretical arguments implying that most and perhaps all sn explosions are significantly aspherical - see wheeler ( 2004 ) for a recent review .    of the assumptions in the earlier codes ,",
    "the only one retained is that of homologous expansion .",
    "this requires that the explosion calculation , which of necessity includes gas dynamics , be continued until all mass elements are to a good approximation coasting ballistically .    with the assumptions",
    "to be dropped identified , the problem is now defined : to solve the time - dependent , 3-d nlte transfer problem for uvoir radiation in the homologously expanding ejecta of a sn , given the distribution of mass and composition at an initial time @xmath8 .",
    "of course , this problem is coupled to a corresponding 3-d transport problem for the @xmath2-rays emitted by radioactive isotopes .",
    "this coupling occurs via the equations describing the deposition and degradation of @xmath2-ray energy .    in view of the magnitude of this problem",
    ", this paper is restricted to describing an exploratory mc code in which the uvoir radiation s interaction with matter is governed by a grey absorption coefficient .",
    "this problem was previously treated by pinto & eastman ( 2000 ) in order to explore the sensitivity of type ia light curves to parameters . here",
    "the aim is to create a software platform onto which more realistic physics can be subsequently added and with which numerical techniques can be tested .",
    "monte carlo methods are a natural choice for this problem given the experience with the earlier codes . moreover , mc methods are commonly favoured for transport phenomena in geometrically - complex configurations with no symmetries .",
    "nevertheless , the conventional approach in which the derivatives in the time - dependent transfer equation ( rte ) are approximated by differences has already been partially implemented for 3-d sne by hflich ( 2003 ) . with regard to the application of mc methods",
    ", the most advanced work seems to be that of kasen et al .",
    "( 2004 ) who carry out 2-d time - independent calculations to compute the observable characteristics of a type ia model with a conical hole .",
    "in this section , after some preliminaries , recent developments in mc technique that are relevant for a general spectral synthesis code are summarized .",
    "these remarks are not restricted to the grey case considered in this paper .",
    "random numbers are obtained with a double precision version of the routine ran2 of press et al .",
    "such numbers are always denoted by @xmath9 , with each @xmath9 denoting an independent call to ran2 .      as in earlier codes",
    ", the mc quanta are energy packets . in general , these are referred to as @xmath10-packets except when specifying the nature of the contained energy ( paper i , sect .",
    "2 ) . thus @xmath11-packets and @xmath2-packets are monochromatic photon packets of uvoir radiation and of @xmath2-rays , respectively . on the other hand ,",
    "@xmath12-packets and @xmath13-packets contain not radiation but thermal kinetic energy and ionization energy , respectively .",
    "in addition , a full treatment of radioactive decay and @xmath2-ray deposition will require consideration of @xmath14- and @xmath15-packets containing non - thermal electrons and positrons , respectively .      the sn is enclosed in a cartesian grid containing @xmath16 identical cubic cells .",
    "this grid expands with the ejecta so that each cell contains a fixed parcel of matter .",
    "physical variables do not vary spatially within cells .",
    "the expansion itself is discretized into @xmath17 time steps .",
    "expansion occurs in instantaneous jumps at times @xmath18 separated by a constant value of @xmath19 . during every time interval ( @xmath20 ) , the density @xmath21 of each cell is held fixed at the value predicted by homologous expansion at time @xmath22 .    here , and",
    "throughout the paper , @xmath6 is the elapsed time since explosion and is measured in the sn s centre - of - mass rest frame ( rf ) .    with this time - stepping",
    ", the calculation is divided into @xmath17 separate mc experiments , each of which updates the radiation field throughout the grid from time @xmath18 to @xmath23 for @xmath24 .",
    "given the modest accuracy with which we can currently treat many of the physical processes in sn ejecta , all terms of @xmath25 in radiative transfer could be neglected except for doppler frequency shifts , which are essential in line transfer .",
    "nevertheless , looking forward to a time when the relevant cross sections will be known to high precision , terms of @xmath25 are now included .",
    "the basic transfer calculations are carried out in the rf , but transformations to and from the local co - moving frame ( cmf ) are convenient in treating interactions with matter . the motion of an @xmath10-packet is thus given by @xmath26 , its position as a function of time @xmath6 in the rf cartesian coordinate system with origin at the sn s centre of mass .",
    "when the grid attached to the ejecta expands instantaneously at times @xmath18 , the coordinates @xmath27 and direction vectors of the @xmath10-packets remain unchanged .      in the context of this discretization of space and time",
    ", energy conservation implies @xmath28 constraints that the solution must satisfy .",
    "thus , for each cell and every time step , the net emissivity of radiant energy per unit mass must be balanced by energy created within the mass element after subtracting the increase @xmath29 in its internal energy and the @xmath30 work done by gas pressure .    with conventional transfer techniques ,",
    "a solution satisfying this huge number of constraints - perhaps @xmath31 - has to be achieved iteratively - and convergence is never rapid . in contrast , if the quanta in a mc calculation are _ indestructible _ and _ indivisible _ @xmath10-packets , local energy conservation is automatically and rigorously obeyed , even if physical variables have not converged to their final values ( lucy 1999a ) .    to a good approximation",
    ", energy conservation can be simplified to the condition of thermal equilibrium by neglecting the gas terms @xmath32 ( arnett 1980 ; pinto & eastman 2000a ) . with this simplification ,",
    "the net emissivity for uvoir radiation in the cmf is equal to the rate of energy deposition by @xmath2- rays .",
    "thermal equilibrium is rigorously obeyed by the mc calculation because the effective cmf emissivity @xmath33 implied by using indivisible @xmath10-packets is subject to the integral constraint @xmath34 where @xmath35 is the cmf absorption coefficient per unit volume , @xmath36 is the cmf mean intensity , and @xmath37 is the cmf @xmath2-ray energy deposition rate per unit volume . in contrast ,",
    "when the rte is solved conventionally , the cmf emissivity @xmath38 is given by the fundamental nlte formulae relating the emission of photons by bound - bound ( b - b ) and free - bound ( f - b ) transitions to the level populations and the electron temperature .",
    "( 1 ) is then only satisfied asymptotically as the iterative procedure converges .",
    "note that , in contrast to @xmath38 derived from first priniples , the mc emissivity @xmath33 is not defined by mathematical formulae .",
    "rather it is defined operationally by the rules governing the re - emission of absorbed @xmath10-packets ( papers i , ii ) .",
    "in addition to the constraints demanded by thermal equilibrium , an even larger number of constraints are required by statistical equilibrium . during each time step and for each cell ,",
    "the number of excitations of an atomic level must balance the number of de - excitations .",
    "with accurate models for the atoms in the multi - species plasma , the total number of levels might be @xmath39 .",
    "this is therefore the number of constraints per cell per time step implied by statistical equilibrium . combining this with the earlier estimate of @xmath28",
    ", we see that @xmath40 constraints must be satisfied in the course of computing nlte light curves and spectra of a 3-d sn .",
    "indivisible @xmath10-packets allow the constraint of statistical equilibrium to be incorporated automatically and rigorously , even when excitation and de - excitation rates computed from basic formulae do not balance .",
    "this is achieved with the macro - atom formalism ( paper i ) , according to which the rate of de - excitation of an excited state is not determined by its level population but by the rates at which radiative and collisional processes from all other levels populate the level in question , either directly or through the internal transitions of the macro - atom .",
    "if the radiation field is computed from the rte , errors in level populations , such as those present prior to convergence , result in the non - physical creation or destruction of radiant energy .",
    "this problem is a consequence of the generality of the rte equation with the nlte emissivity @xmath38 . because of this generality",
    ", the nlte rte could be used to follow the time - dependent relaxation to statistical equilibrium . in contrast , with the macro - atom formalism , spurious sources or sinks of radiant energy are eliminated .",
    "this is achieved by effectively solving a _ less _ general transfer equation , namely one that incorporates the constraint of statistical equilibrium and one , therefore , that can not be used for a relaxation calculation .",
    "a consequence of computing de - excitation rates with the macro - atom machinery is that these rates and the corresponding emissivity @xmath33 are insensitive to errors in the populations of the emitting levels ( paper i , sect .",
    "in contrast , with the rte , errors in level populations translate directly into errors in @xmath38 and therefore in the derived radiation field .",
    "evidently , the macro - atom approach is more tolerant of departures from the nlte solution than is the conventional approach .    as thus far developed",
    ", the macro - atom approach imposes the constraint of thermal equilibrium simultaneously with that of statistical equilibrium .",
    "thus when a @xmath12-packet is created ( paper ii , sect .",
    "4.3.1 ) , it is instantaneously eliminated ( paper ii , sect . 4.3.2 ) .",
    "thus , there is no net energy transfer to or from the thermal pool .",
    "moreover , this holds even if the electron temperature does not imply thermal equilibrium .",
    "note also that if a @xmath12-packet is created by the de - activation of a macro - atom of one atomic species , it may be eliminated by the activation of a macro - atom of another species .",
    "for sne ejecta at late times , the assumptions of ionization and thermal equilibrium break down ( fransson & kozma 1993 ) .",
    "but this does not preclude the use of indivisible @xmath10-packets , since these are fundamentally a means of tracking energy .",
    "departures from equilibrium can be modelled by allowing for the finite life time of a non - radiative @xmath10-packet before it converts back into an @xmath11-packet .",
    "thus a @xmath41 process creates a @xmath12-packet or an @xmath13-packet , but neither should be immediately eliminated if the recombination time is not short compared to the elapsed time @xmath6 .",
    "moreover , while awaiting elimination , the @xmath12-packet s energy declines due to @xmath42 work .",
    "if , during such non - equilibrium phases , statistical equilibrium remains a good approximation for the excited levels of each ion separately , then this constraint can be imposed by introducing macro - ions adapting the procedures of paper i.    the above remarks strongly suggest that non - equilibrium phases can be treated with closely similar techniques .",
    "nevertheless , this must be confirmed with test problems as in paper i.      the robustness of the emissivities derived with the macro - atom formalism suggests that useful predictions of @xmath44 may be obtained without converging to the exact nlte solution .",
    "instead , estimates of the excitation , ionization and temperature in each cell could be derived using the characteristics of the local mc radiation field as in abbott & lucy ( 1985 ) and in the previous diagnostic codes ( sect .",
    "the accuracy of this approach in computing ionization fractions has been confirmed by springmann & puls ( 1998 ) for an o - star wind .    nevertheless , for definitive results , the nlte solution must be obtained .",
    "fortunately , the use of indivisible @xmath10-packets and the macro - atom formalism facilitate this task . because the thermal and statistical equilibrium constraints are directly incorporated into the mc calculation , convergence to the nlte solution can be achieved with geometry - independent @xmath43-iterations ( lucy 1999a ; paper ii ) .",
    "thus , by simply repeating the process of bringing matter into thermal and statistical equilibrium with the mc radiation field and then recomputing the latter , the solution converges to the required equilibria .",
    "moreover , convergence is rapid .    with regard to thermal equilibrium",
    ", this success with @xmath43-iterations was initially demonstrated for a 1-d problem ( lucy 1999a ) .",
    "recently , the geometric independence of the technique has been demonstrated with its successful application to demanding 3-d problems ( harries et al .",
    "2004 ; kurosawa et al .",
    "2004 ) . with regard to thermal",
    "_ and _ statistical equilibrium , experience is thus far limited to a simple 1-d problem ( paper ii ) .",
    "a nlte calculation requires the radiative rates of excitation , ionization and heating . with the rte ,",
    "these are obtained by numerical integration .",
    "but computing these quantities in a mc simulation is not so straightforward .",
    "the obvious approach is simply to count the relevant events - e.g , photoionizations - in each cell in time @xmath45 , thereby deriving the rate empirically .",
    "this is akin to a physics experiment in which detectors are distributed throughout an apparatus to record events .",
    "but , though appealing , this fails to make full use of the mc radiation field .",
    "for example , even if no photoionizations occur in a cell , a non - zero ionization rate must surely be derivable if it was traversed by @xmath11-packets containing ionizing photons .",
    "to derive mc estimators of radiative rates , a summation procedure based on volume elements is preferred ( lucy 1999 ) to the more obvious choice of reference surfaces . the basic building block from which the required estimators are derived",
    "will now be stated in a more general form than in earlier papers ( lucy 1999 ; paper ii ) .",
    "if , at a given position and time , @xmath46 is the specific intensity at frequency @xmath47 of a pencil of radiation propagating in direction @xmath48 , then @xmath49 is the instantaneous energy density of radiation in the frequency interval @xmath50 propagating within solid angle @xmath51 about the specified direction .",
    "this basic formula allows the mc radiation field to be converted into the conventional description in terms of @xmath52 .    if , during @xmath45 , an @xmath11-packet of energy @xmath53 with @xmath54 propagates in a cell of volume v , and if for a time @xmath55 its trajectory is in the solid angle element @xmath51 , then @xmath56 is the packet s contribution to the cell s time - integrated radiant energy in @xmath57 .",
    "accordingly , the volume- and time - averaged estimator of the specific intensity is given by @xmath58 here @xmath59 is the reference value for the energy of the @xmath10-packets ( sect .",
    "3.2 ) .    equation ( 2 ) , when multiplied by the appropriate weight functions and integrated over @xmath47 and @xmath60 , yields mc estimators for any required property of the radiation field .",
    "estimators of this type were used initially to compute integrated mean intensities and absorption rates in a 1-d non - grey atmosphere in lte ( lucy 1999a ) .",
    "similar applications to dusty circumstellar envelopes have been reported by wolf ( 2003 ) and by niccolini et al .",
    "estimators for the radiative rates needed for nlte calculations can also be derived ( paper ii ) .    the class of mc estimators derived from eq .",
    "( 2 ) can be described as optimum and non - parametric .",
    "optimum because they use all the mc information and non - parametric because no assumption is made about the radiation field .",
    "these estimators are appropriate when the simulation is large enough that in each @xmath45 every cell is traversed by many @xmath10-packets . if not , a functional form can be assumed for @xmath52 or @xmath61 - e.g. , a dilute black body - and its parameters estimated from the limited number of trajectories in @xmath62 .",
    "this functional form can then be multiplied by the appropriate weight functions to derive an estimate of the required quantity by numerical integration .",
    "this second procedure dampens the effects of sampling errors but , insofar as the functional form is inexact , yields biased estimators - i.e. , ones that do not converge to their exact values as @xmath63 , where @xmath1 is the number of packets in the simulation .",
    "an application where the extra generality provided by eq.(2 ) is essential is in constructing an estimator for the source function in a medium with non - isotropic scattering .",
    "the emergent rf spectrum for a mc simulation can be derived simply by counting escaping @xmath11-packets into frequency bins , with light travel - time taken into account as in sect .",
    "but even in the spherical case , large @xmath1 is then required to keep sampling errors small enough to allow a useful comparison with obseved spectra .",
    "the solution is to extract the source function from the simulation and then calculate the emergent flux from the formal integral ( lucy 1999b ) . in a particular 1-d case ,",
    "the errors in the resulting spectrum correspond to those of a binned spectrum from a simulation with @xmath1 increased by a factor of @xmath64 . for a 3-d sn ,",
    "where spectra for multiple lines - of - sight must be computed , the binning option is almost useless , and the already large gain factor with the formal integral will be vastly increased .",
    "in a previous paper ( paper ii ) on the nlte transfer of uvoir radiation in a sn envelope , the @xmath10-packets were all created at the lower boundary , thus implicitly representing the outward diffusion of the energy released by radioactive decays in the deeper interior .",
    "but with the computational domain now being the entire ejecta , the creation and transport of @xmath2-rays must be treated explicitly . in this section , therefore , the concept of indivisible @xmath10-packets is extended to cover this aspect of the general spectral synthesis problem for sne .    in a very recent paper , milne et al .",
    "( 2004 ) have compared results with various @xmath2-ray transport codes and reviewed the physical processes that must be treated .",
    "their emphasis is on the prediction of @xmath2-ray spectra rather on the powering of optical emission .",
    "the radioactive decays @xmath65 and @xmath66 each occur with the emission of a spectrum of @xmath2-ray lines - see table 1 in ambwani & sutherland ( 1988 ) .",
    "gamma - rays of energy @xmath67 are emitted with probability @xmath68 when a parent nucleus decays .",
    "the total energy emitted per decay is therefore @xmath69 , giving @xmath70 and @xmath71mev for the @xmath0 and @xmath3 nuclei , respectively .",
    "the @xmath72-folding times for these decays are @xmath73 and @xmath74 days .",
    "the total @xmath2-ray energy emitted by the decay sequence @xmath75 in the limit @xmath76 is @xmath77 where @xmath78 is the initial mass of @xmath0 , and @xmath79 is the mass of the @xmath0 nucleus .",
    "the initial mass of radioactive matter @xmath78 is quantized into @xmath1 pellets , where @xmath80 .",
    "these pellets have the following property : they emit a _ single",
    "_ @xmath2-packet with cmf energy @xmath59 and containing @xmath2-rays whose cmf photon energy @xmath81 corresponds to _ one _ of the lines emitted in the decay sequence @xmath75 . following this event ,",
    "a pellet is permanently inert .",
    "as @xmath63 , this model must yield the correct time - dependent @xmath2-ray line emissivities . to achieve this ,",
    "we first identify two kinds of pellet : a fraction @xmath82 are @xmath83 pellets that collectively emit the @xmath0 spectrum , while the remainder are @xmath84 pellets , and they account for the @xmath3 spectrum .",
    "if a pellet is designated as a @xmath83 pellet , its decay time is randomly chosen as @xmath85 ; and the emitted @xmath2-packet is assigned to line @xmath86 from the @xmath0 spectrum with probability @xmath87 . on the other hand ,",
    "a @xmath84 pellet s decay time is @xmath88 , where @xmath89 and @xmath90 are independent random numbers from ( 0,1 ) .",
    "two terms are required for the @xmath84 pellets since each @xmath3 nucleus is created in the decay of @xmath0 nucleus .",
    "having thus selected @xmath91 for a @xmath84 pellet , we select a line from the @xmath3 spectrum as with @xmath0 .    when a pellet decays , the emitted @xmath2-packet is assigned a cmf direction vector @xmath92 in accordance with isotropic emission .",
    "thus @xmath93 , with @xmath94 and @xmath95 .",
    "the corresponding rf vector is obtained with the exact aberration formula - e.g. , castor ( 1972 , eq.(5 ) ) .",
    "the @xmath2-packet s initial rf energy is then @xmath96 , where the local rf velocity @xmath97 .",
    "the positions of the pellets at @xmath8 are obtained by sampling the distribution of @xmath0 predicted by the explosion model .",
    "their positions when they decay are then given by the assumption of homologous expansion .",
    "the @xmath2-packets emitted in the interval @xmath98 are added to the @xmath2- and @xmath11-packets still propagating in the ejecta at time @xmath18 to form a list of active @xmath10-packets whose trajectories are up - dated during this time step .      in propagating through the ejecta",
    ", @xmath2-rays create cascades of non - thermal electrons in multiple compton scatterings off free and bound electrons as well as being absorbed in photoionizations .",
    "this redistribution of the energy of the emitted @xmath2-ray into numerous channels over a substantial volume can nevertheless be modelled with indivisible @xmath2-packets in such a way that the correct physics emerges as @xmath63 .      as a @xmath2-packet propagates",
    ", it undergoes events , both numerical and physical .",
    "the numerical events are : escaping from the grid , reaching the surface of a cell , or coming to the end of the current time step at @xmath99 .",
    "the currently - included physical events are compton scattering and photoelectric absorption .    in describing how a @xmath2-packet s trajectory is computed , it suffices to explain how to find the next event along the trajectory of one packet ( cf .",
    "paper ii , sect.5 ) .    given the rf position and direction vector following an event , the next event is identified by computing the distances along the trajectory to all possible events and then selecting the event reached first .",
    "since calculating distances to the numerical events is trivial , we here treat only the physical events .    if @xmath100 is the rf energy of photons in a @xmath2-packet , the cmf energy is @xmath101 .",
    "accordingly , in the cmf the @xmath2-packet sees compton scattering coefficient @xmath102 and absorption coefficient @xmath103 .",
    "but in the rf these transform to @xmath104 and @xmath105 .",
    "thus , when the radiative transport is carried out in the rf , the absorption , scattering ( and emission ) coefficients are direction - dependent - e.g. , castor ( 1972 , eqs .",
    "( 2 ) and ( 3 ) ) .    with these rf coefficients determined , we select the distance @xmath106 along the trajectory",
    "at which a physical event will occur from the standard mc formula @xmath107 and this event happens if @xmath106 is smaller than the distances to the numerical events .",
    "morever , when a physical event happens , it is a compton scattering if @xmath108 and a photoelectic absorption if not .    if @xmath106 is the distance to the selected event , the updated space - time rf coordinates are @xmath109 and @xmath110 .      starting with numerical events",
    ", we now describe subsequent actions .",
    "if the @xmath2-packet exits the grid , it escapes to @xmath111 , and attention then turns to the next @xmath2-packet in the list of those active during the current time step .",
    "but if the @xmath2-packet exits only the current cell and not the grid , then it enters the neighbouring cell and the search for the next event proceeds as above . finally , if the event is the end of the time step at @xmath23 , computation of the trajectory is suspended , and the @xmath2-packet s current rf data string , @xmath6,,@xmath112,@xmath100 is stored to await the next time step .    with regard to physical events ,",
    "the following actions are taken : in the event of a photoelectric absorption , the @xmath10-packet s trajectory as a @xmath2-packet terminates .",
    "it now becomes a @xmath12- or @xmath13-packet ( cf .",
    "2.7 ) with the same cmf energy @xmath113 as the absorbed @xmath2-packet .",
    "then , since energy storage in the gas is neglected ( sect . 2.4 ) , this @xmath12- or @xmath13-packet converts immediately to an @xmath11-packet . in a general code , the frequency @xmath47 of photons in this @xmath11-packet are determined by continuum emission ( f - b or f - f ) or line emission following collisional excitation , and these are treatable with the macro - atom formalism ( papers i & ii ) . but here , with grey transport for uvoir radiation , the emitted @xmath11-packet can be regarded as bolometric .",
    "its cmf energy is @xmath114 and its cmf direction vector @xmath92 is selected according to isotropic emission .",
    "the rf direction vector then follows from the aberration formula , and the rf energy is @xmath115 . these quantities together with and @xmath6 comprise the data string required to initiate the @xmath11-packet s trajectory in the 3-d code for uvoir radiation ( sect .",
    "4 ) .    in the event of a compton scattering ,",
    "we first find the scattering angle @xmath116 by randomly selecting @xmath117 from a look - up table of the percentiles of the @xmath117 probability distribution as functions of the incident @xmath2-ray energy .",
    "a @xmath2-ray scattered through angle @xmath116 has its incident energy @xmath118 reduced to @xmath119 , where @xmath120 $ ] , with the remaining energy transferred to a compton electon . thus the energy is divided in the ratio @xmath121 .",
    "accordingly , since @xmath10-packets are indivisible , the @xmath2-packet continues as a @xmath2-packet if @xmath122 .",
    "if not , it becomes an @xmath14 packet .",
    "if the packet continues as a @xmath2-packet , its cmf energy remains @xmath113 but it now contains @xmath2-rays of cmf energy @xmath119 . to derive the rf values of these quantities , we must select a new direction vector . in the cmf ,",
    "the incident @xmath123 and emergent @xmath92 direction vectors are such that @xmath123@xmath92 @xmath124 .",
    "the combination of this with azimuthal angle @xmath125 , where azimuth is defined with respect to polar direction @xmath123 , determines @xmath92 .",
    "the aberration formula then gives and so , in the rf , the emergent @xmath2-packet has energy @xmath126 and contains @xmath2-rays with photon energies @xmath127 . the next event for this @xmath2-packet",
    "is now searched for as described in sect .",
    "3.3.1 .    on the other hand ,",
    "if the @xmath2-packet converts to an @xmath14 packet , we assume in situ degradation into a bolometric @xmath11-packet with cmf energy @xmath114 .",
    "the rf data string needed to initiate its subsequent trajectory is now computed as for an @xmath11-packet created by photoelectric absorption - see above .",
    "the above treatment is a straightforward extension of the indivisible @xmath10-packet idea to @xmath2-ray transport .",
    "nevertheless , it should still be tested against the traditional mc treatment in which the mc quanta are photons ( e.g. colgate et al .",
    "1980 ; ambwani & sutherland 1988 ) .",
    "such a test has been carried out by computing @xmath2-ray deposition in a spherical sn . for simplicity ,",
    "effects of @xmath25 are neglected and photoelectric absorption acts only as a guillotine when @xmath100 drops below 100kev .    in one calculation ,",
    "the pellets emit a single @xmath2-packet as described above . in the comparison calculation ,",
    "each pellet emits multiple photon packets with photon energies @xmath67 and weights @xmath128 , thus representing the appropriate @xmath2-ray line spectrum .",
    "each such packet then undergoes several compton scatterings , at each of which the energy of the compton electron is deposited in situ .",
    "this continues until a photoelectric absorption deposits the remaining energy .",
    "the two deposition profiles converge to one another as @xmath63 .      in the present code ,",
    "an explicit determination of @xmath37 , the heating rate due to the deposition of @xmath2-ray energy is not required .",
    "the assumption of local thermal equilibrium implies that absorbed @xmath2-packets are immediately re - emitted as @xmath11-packets ( sect .",
    "3.3.2 ) and their subsequent propagation is through matter with a temperature - independent grey absorption coefficient .",
    "but in a more general code , the thermal history of the ejecta must be calculated , and this requires @xmath37 . in any case , this quantity is needed here for the solution with moment equations ( sect . 5 ) .    in sect .",
    "3.3 , two deposition processes are considered .",
    "first there is the loss of energy to compton electrons , which occurs at the rate @xmath129 where @xmath130 is the expected fraction of @xmath131 transferred to the compton electron and @xmath132 is the cmf mean intensity at photon energy @xmath131 .",
    "second , there is the loss in photoionizations , which occurs at the rate @xmath133 estimators for these rates can be derived by applying eq .",
    "( 2 ) in the cmf .",
    "but note that the transport of packets is carried out in the rf .",
    "if @xmath106 is the distance between consecutive events for a @xmath2-packet propagating in the rf , then , to @xmath25 , in the cmf , @xmath134 .",
    "accordingly , since we also have @xmath135 , the reqired estimators are @xmath136 and @xmath137 these summations are over all trajectory segments @xmath106 in @xmath62 .",
    "thus there is no restriction to packets that undergo compton scatterings ( eq.[7 ] ) or photoelectric absorptions ( eq.[8 ] ) in @xmath62 .",
    "accordingly , the resulting deposition rate @xmath138 is more accurate than the crude estimate obtained by summing the cmf energies of @xmath2-packets that terminate their trajectories in @xmath62",
    ".      a by - product of this 3-d time - dependent treatment of @xmath2-ray transport is the prediction of @xmath2-ray spectra , observations of which have potential for detecting asymmetries in sn explosions ( hflich 2002 ; hungerford et al .",
    "crude spectra can be obtained simply by binning escaping @xmath2-packets according to their rf energies @xmath100 .",
    "but for high quality results , especially for the orientation - dependent spectra of an asymmetric sn , the formal integral should be used ( sect .",
    "2.10 ) .",
    "additional physical processes can be readily incorporated into this @xmath10-packet treatment of @xmath2-ray transport .",
    "following ambwani & sutherland ( 1988 , table 1 ) , positrons emitted in @xmath3 are here assumed to annihilate in situ .",
    "but at late times , the transport of positrons should be followed until they escape or deposit their rest and kinetic energies in the ejecta .",
    "this requires that we allow the @xmath84 pellets to emit @xmath15 packets instead of the @xmath2-packets with @xmath139mev .      in treating compton scattering",
    ", we assume that compton electrons degrade in situ . the basis for this",
    "is the short stopping distance of mev electrons compared to mev @xmath2-rays ( colgate et al .",
    "nevertheless , we may eventually wish to follow the motion of the @xmath14-packets , especially at late epochs .",
    "in addition to compton scattering and photoelectric absorption , a @xmath2-ray with @xmath140 can tranform to an @xmath141 pair as it passes an atomic nucleus - see , e.g. , ambwani & sutherland ( 1988 ) - with each of the pair having kinetic energy ( ke ) @xmath142 . in stopping , the positron releases energy @xmath143 , comprising its ke plus",
    "the rest energy @xmath144 radiated when the positron annihilates with an ambient electron .",
    "in contrast , stopping the electron releases only its ke .",
    "accordingly , when treated with indivisible @xmath10-packets , pair production converts a @xmath2-packet into an @xmath15-packet with probability @xmath145 or into an @xmath14-packet with probability @xmath146 , where @xmath147 . in either case",
    ", the cmf energy of the packet is that of the incident @xmath2-packet @xmath113 .",
    "if in situ deposition is not assumed , the selected packet s motion is then followed to escape or deposition .",
    "note that a return to the pair production event to follow the other member of the pair is not required ( cf .",
    "paper i , sect .",
    "1 ) .      if the evolution of the ejecta is followed to late epochs ( @xmath148 days ) , then rare but long - lived radioactive isotopes such as @xmath149 and @xmath150 must be included ( e.g. , woosley et al .",
    "this just requires additional types of pellet .",
    "in a previous paper ( paper ii ) the nlte transfer of uvoir radiation in a sn envelope of pure h was treated using and extending the macro - atom formalism ( paper i ) . here ,",
    "given the emphasis on time dependence and 3-d , we simplify to a grey absorption coefficient .      as with @xmath2-packets , the transport of @xmath11-packets",
    "is carried out in a sequence of mc simulations for the time steps @xmath151 .",
    "each of these simulations directly follows the corresponding one for @xmath2-packets ( sect .",
    "3.3 ) .",
    "the @xmath11-packets that propagate in the ejecta in the time interval ( @xmath20 ) have several sources .",
    "first are those that did not escape during the previous time step . for these",
    ", we have the rf data string ( , @xmath6,,@xmath152 ) , and so their trajectories can be continued from time @xmath18 .",
    "second are those created during the current time step as @xmath2-packets are eliminated .",
    "this occurs either by photoelectric absorption or by the stopping of compton electrons ( sect .",
    "3.3.2 ) . in either case",
    ", the @xmath2 transport routine provides the rf data string ( , @xmath6,,@xmath152 ) needed to initiate their trajectories as @xmath11-packets .",
    "a third source is specific to the first time step .",
    "radiant energy emitted by pellets that decay at times prior to @xmath8 must be accounted for .",
    "an approximate treatment is as follows : a @xmath2-packet emitted at @xmath153 and position @xmath154 is assumed to have converted to an @xmath11-packet by time @xmath8 but to have diffused negligibly relative to matter ( position coupling ) in the time interval ( @xmath155 ) so that at @xmath8 its rf position is @xmath156 .",
    "this is justified by the short mean free paths of photons in these early , high - density phases . the rf direction vector at @xmath8 is computed on the assumption of isotropic emission in the cmf .",
    "the energies of these packets must also be specified . although position coupled , they still do work on the expanding ejecta . an @xmath11-packet s energy at @xmath8 is therefore @xmath157 .",
    "an additional source of @xmath11-packets at @xmath8 is the radiation generated by shock heating during the explosion .",
    "the explosion model s prediction of this radiation can be discretized into @xmath11-packets of energy @xmath59 , the same quantum of energy as for the radioactive pellets ( sect .",
    "however , such @xmath11-packets are neglected in this test code .      as an @xmath11-packet propagates",
    ", it undergoes numerical and physical events .",
    "the numerical events are identical to those for @xmath2-packets ( sect .",
    "the physical events are absorptions .    in describing how a @xmath11-packet s trajectory is computed",
    ", it suffices to explain how to find the next event along the trajectory of one packet .",
    "given the rf data string ( , @xmath6,,@xmath152 ) , the next event is identified by computing the distances along the trajectory to all possible events and then selecting the event reached first .",
    "as with @xmath2-packets , we treat only physical events .    because the transport of @xmath11-packets is also carried out in the rf , the anisotropy of the rf absorption coefficient",
    "must again be allowed for , as it was for @xmath2-packets in sect.3.3.1 .",
    "if the grey absorption coefficient per unit volume in the cmf is @xmath158 , the effective value in the rf is @xmath159 , and so the distance @xmath106 to the absorption event is given by @xmath160 .",
    "this event happens if this is smaller than the distance to any numerical event . with @xmath106 thus determined , the coordinates ( @xmath161 )",
    "are updated as for @xmath2-packets ( sect .",
    "3.3.1 ) .      for numerical events ,",
    "the subsequent actions correspond to those for @xmath2-packets ( sect .",
    "3.3.2 ) .",
    "if the event is an absorption , we assume instantaneous isotropic re - emission in the cmf .",
    "accordingly , the new rf direction vector is calculated as it was for emitted @xmath2-packets in sect . 3.2 .",
    "the energy content of the bolometric @xmath11-packet must also be updated .",
    "if the incident packet has rf energy @xmath162 and direction vector @xmath163 , its cmf energy is @xmath164 .",
    "since this is conserved by the absorption - emission event , the updated rf energy is @xmath165 .",
    "calculation of the post - event data string ( , @xmath6,,@xmath152 ) is now complete , and the search for the next event can begin .",
    "consider an @xmath11-packet with post - event data string ( , @xmath6,,@xmath152 ) that is an escapee from the grid .",
    "a distant observer at rest in the rf who detects this packet records its arrival at what he perceives to be a time @xmath166 after the explosion .",
    "thus the pairs @xmath167 detected by one such observer is the data set from which he can construct the bolometric light curve of the 3-d sn as seen from his orientation .    in this paper ,",
    "the 3-d code is tested by applying it to a spherically - symmetric sn .",
    "accordingly , we use _ all _ pairs @xmath167 to construct its orientation - averaged bolometric light curve ( sect .",
    "in order to test the 3-d code described in sects . 3 and 4 , we apply it in sect . 6 to a spherically - symmetric sn .",
    "this allows the code to be tested against a solution of the same problem obtained by numerical integration of the time - dependent rte .",
    "castor ( 1972 ) has given a general treatment , accurate to @xmath25 , of radiative transfer in spherically - symmetric flows .",
    "in particular , he derives the zeroth and first frequency - integrated moment equations in the cmf .",
    "these two equations , applied to a homologously expanding flow with grey absorption , are the basis of the comparison calculation .    if we again neglect the contributions of the gas to energy balance ( sect .",
    "2.4 ) , the zeroth moment equation is @xmath168 where the dependent variables are @xmath169 , the cmf energy density of radiation , and @xmath170 , the cmf luminosity variable .",
    "the independent variables are elapsed time @xmath6 and the mass coordinate @xmath171 . note",
    "that time derivatives in the moment equations are lagrangian .",
    "the first moment equation is @xmath172 where @xmath173 , @xmath174 , and the third dependent variable @xmath175 is the cmf radiation pressure .      to make this system determinate , an approximate formula relating the three moments",
    "must be imposed . here",
    "we adopt eddington s approximation , @xmath176 which is used to eliminate @xmath175 from eq.(10 ) .",
    "this leaves two partial differential equations ( pdes ) in the two variables @xmath177 and @xmath178 .",
    "the pdes must be solved subject to appropriate boundary conditions .",
    "clearly , at the sn s centre , @xmath179 while , at the surface , eddington s boundary condition @xmath180 gives @xmath181 here @xmath182 , and @xmath183 is the total mass of the ejecta .",
    "in addition , initial conditions are required at @xmath184 . as in the mc code",
    "4.1.1 ) , we assume that diffusion of radiation relative to matter is still negligible ( sect .",
    "4.1.1 ) at @xmath8 , and so @xmath185 an initial condition for @xmath169 is derived as follows : for @xmath186 , negligible relative diffusion of @xmath2-rays implies in situ deposition , so that @xmath187 , the integrated @xmath2-ray emissivity in the cmf .",
    "accordingly , from eq.(9 ) , the required initial condition is given by integrating the ordinary differential equation ( ode ) @xmath188 which can be done analytically .    if @xmath189 is the mass fraction of @xmath0 in the mass shell @xmath171 at @xmath190 , then @xmath191 where @xmath192 , the energy released per @xmath0 nucleus , is given by @xmath193 since each term in eq .",
    "( 17 ) has the same form and eq .",
    "( 15 ) is linear , we consider a single exponential - i.e. , @xmath194 , and we note also that homologous expansion implies that @xmath195 .",
    "integration of eq.(15 ) then gives @xmath196 e^{-t / t _ { * } } \\right )      \\ , f \\ , \\rho \\ , / \\",
    ", m_{ni}\\ ] ] this solution can be applied to each term in eq .",
    "( 17 ) to construct the complete solution . but",
    "with @xmath197 , the first ( @xmath0 ) term suffices .",
    "note that , in deriving eq.(18 ) , we assumed @xmath198 at @xmath190 .",
    "this is consistent with the neglect of shock heating in the mc code ( sect .",
    "4.1.1 ) .",
    "( 9 ) and ( 10 ) are solved in the same way as are the equations of stellar evolution when the @xmath199 and @xmath200 terms are included in the energy equation ( e.g. , schwarzschild 1958 , p. 100 ) .",
    "thus , the time derivatives of @xmath201 and @xmath170 are replaced by  backward difference formulae . then , since the solution at earlier time steps is known , the pde problem is effectively simplified to a two - point boundary value problem for odes .",
    "when the space derivatives in the odes are approximated by difference formulae , the resulting algebraic system can be solved with an elimination procedure ( henyey method ) . here , a slight generalization of the procedure described by richtmyer ( 1957 , pp .",
    "101 - 104 ) has been followed .    in stellar evolution codes , it is still current practice ( a. weiss , private communication ) to approximate the time derivative of a variable @xmath202 at time @xmath18 with the formula @xmath203 where @xmath204 denotes the forward difference operator , so that @xmath205 . this formula is not centred and thus has error @xmath206 . but higher accuracy can be achieved by using more than one previous model - e.g , richtmyer ( 1957 , p.94 , item 9 ) .",
    "if the two previous models at @xmath207 and @xmath208 are used , the appropriate difference approximation is obtained by fitting a parobola and then evaluating its derivative at @xmath18 .",
    "the resulting formula is @xmath209 where @xmath210 .",
    "thus , with constant time steps , @xmath211 . the gain in accuracy is investigated in sect .",
    "6.2 .    in starting the integration of the pdes , the theory of sect .",
    "5.4 is used to provide the previous solutions required by eqs .",
    "( 19 ) and ( 20 ) as well as initial estimates of @xmath201 and @xmath170 for the first henyey iteration .",
    "the solution of the pdes yields the two functions @xmath177 and @xmath212 .",
    "thus we directly get the bolometric light curve @xmath213 seen by a cmf observer at @xmath214 , the surface of the sn .",
    "but the quantity of interest is the light curve seen by a distant observer at rest in the rf .",
    "this can be calculated using @xmath10-packets as follows :    in a small interval @xmath45 at @xmath6 , the surface emits @xmath17 @xmath11-packets at random times @xmath18 in @xmath45 . these all have cmf energy @xmath215 , and their direction cosines are @xmath216 , corresponding to zero limb - darkening , an assumption consistent with eddington s approximations .",
    "their direction cosines @xmath217 in the rf are given by the aberration formula , and their rf energies are then @xmath218 .",
    "the distant observer perceives the @xmath219th packet as having been emitted at elapsed time @xmath220 , and so the @xmath17 pairs ( @xmath221 ) represent the contribution of the interval @xmath45 to the bolometric light curve seen by this observer .",
    "summing over all intervals @xmath45 then gives the complete light curve ( cf .",
    "after first investigating the accuracy of bolometric light curves for spherical sn obtained with the cmf moment equations , this section uses such a light curve to check the 3-d mc code described in sects . 3 and 4 .",
    "the model sn is closely similar to that used by pinto & eastman ( 2000 ) to investigate the parameter sensitivity of type ia light curves .",
    "the ejecta has uniform density and its basic parameters are : @xmath222 , @xmath223 , and @xmath224 km s@xmath225 .",
    "the @xmath0 is assumed to be stongly concentrated in the central core .",
    "thus , @xmath226 for @xmath227 and then drops linearly to zero at @xmath228 .",
    "the grey absorption coefficient for uvoir radiation is @xmath229 @xmath230 g@xmath225 , and the photoelectric absorption coefficient @xmath231 for @xmath2-rays is derived from eq .",
    "( 3 ) of ambwani & sutherland ( 1988 ) with nuclear charge @xmath232 .",
    "numerical solutions of castor s equations have been obtained in order to test the mc code against an rte treatment accurate to @xmath25 .",
    "but the neglect of higher order terms in @xmath233 is not the only source of error in the rte solutions .",
    "larger errors may arise due to the closure approximation ( sect .",
    "5.2 ) and the difference approximation of time derivatives ( sect .",
    "the moment equations are solved on a uniformly - spaced grid with @xmath234 grid points , the innermost at @xmath235 .",
    "the energy deposition rate @xmath37 in eq .",
    "( 9 ) is derived with a 1-d version of the mc code described in sect .",
    "3 using the estimators given in eqs . ( 7 ) and ( 8) . the number of radioactive pellets is @xmath236 .    to investigate sensitivity to the approximation of time derivatives ,",
    "two sequences of light curves are computed , one using eq.(19 ) to evaluate @xmath237 and @xmath238 , the other using eq.(20 ) . along each sequence",
    ", @xmath239 varies , thereby determining the rate of convergence as @xmath240 . for each light curve , @xmath241",
    ", the peak rf bolometric magnitude , is obtained by parabolic fitting .",
    "the values of @xmath241 as a function of @xmath239 are plotted in fig . 1 , together with the value @xmath242 obtained by extrapolating to infinitesimal time step . error bands of @xmath243 mag .",
    "are also drawn .",
    "1 shows , as expected , that errors grow linearly with eq .",
    "( 19 ) and quadratically with eq .",
    "( 20 ) . from this plot",
    ", we find that accuracy @xmath244mag .",
    "requires @xmath245 with eq.(20 ) but @xmath246 with eq.(19 ) . clearly , for high precision , eq ( 20 ) is preferred and is indeed used in sect .",
    "although this test refers to the cmf moment equations , it is surely relevant generally to numerical solutions of the time - dependent rte . accurate difference approximations for time derivatives are necessary to limit the accumulation of errors as one integrates forward in time .",
    "and of course the same remark applies to stellar evolution codes .      in fig .",
    "2 , the rf bolometric light curve computed with the 3-d mc code is compared with that derived from the cmf moment equations .",
    "the mc light curve is from a simulation in which the initial distribution of radioactive matter is represented by @xmath247 pellets , with the resulting @xmath2- and @xmath11-packets propagating in a @xmath248 grid .",
    "the calculation starts at @xmath249 , and the time steps are @xmath250 . the rf light curve is derived from escaping @xmath11-packets as described in sect . 4.2 . thus , for packets with arrival times @xmath251 in the interval @xmath98 , the values of @xmath152 are summed to obtain an estimate of @xmath252 .",
    "the rf light curve derived from the pdes of sect .",
    "5.1 is also plotted in fig .",
    "this is derived from the cmf light curve @xmath253 as described in sect .",
    "5.6 . as for the calculations of sect .",
    "6.2 , the spherical sn is modelled with @xmath234 shells , and @xmath236 in the 1-d @xmath2-ray code .",
    "2 shows that the two bolometric light curves are in good agreement over an extended time interval , from well before to long after maximum light at @xmath254 days .",
    "this implies a corresponding degree of agreement in the @xmath2-ray energy deposition rates .",
    "nevertheless , these are also plotted in fig .",
    "2 . for the 3-d code , the deposition rate",
    "is calculated simply by summing the energies of @xmath2-packets as they convert to @xmath11-packets .",
    "but for the 1-d code , the estimators defined by eqs .",
    "( 7 ) and ( 8) are used to calculate @xmath37 , which is then summed over shells .    to investigate the precision of the 3-d light curve in more detail , the residuals relative to the pde solution are plotted in fig.3 .",
    "this plot reveals large systematic residuals at early times on the rising branch of the light curve but that these decrease with time becoming quite small for @xmath255dys . for the interval",
    "@xmath256 days , the mean residual is -0.008 mag .",
    "a residual of this order may reflect errors in the pde solution since this relies on eddington s approximations .",
    "the large residuals on the rising branch have been traced to inadequate spatial resolution of the distribution of @xmath0 in the 3-d code , despite the @xmath248 grid . because @xmath0 is uniformly distributed within each cubical cell , the function @xmath189 ( sect .",
    "6.1 ) is slightly broadened relative to its more accurate representation in the 1-d calculation .",
    "this results in some released radioactive energy reaching the surface slightly early , giving a brighter mc light curve .",
    "this explanation is confirmed by finding that these residuals become larger with a coarser grid . to illustrate this , fig .",
    "3 includes the residuals for @xmath257 days with a @xmath258 grid .",
    "this comparison with the pde solution shows that , with a fine enough grid , the mc code described in sects .",
    "3 and 4 is capable of carrying out high precision transport calculations accurate to @xmath25 for @xmath2-rays and uvoir radiation propagating in a 3-d sn .      among the merits of using @xmath10-packets",
    "is conservation of energy to high precision and the ready monitoring of energy transformations within the configuration .",
    "energy conservation for the ejecta implies that @xmath259 here @xmath260 is the total energy released by radioactive decays in the time interval @xmath261 , @xmath262 is the total energy lost through the surface in ( 0,t ) , and @xmath263 is the radiant energy stored in the ejecta at time @xmath6 , all these quantities being evaluated in the rf .",
    "finally , @xmath264 is the total work done in @xmath261 by radiation interacting with the expanding ejecta",
    ".    estimators for the quantities in eq .",
    "( 21 ) are sums over packets .",
    "thus , @xmath260 is the sum of the initial rf energies @xmath112 of @xmath2-packets emitted by radioactive pellets ( sect .",
    "3.2 ) ; @xmath262 is the sum of the rf energies @xmath112 and @xmath152 of @xmath2- and @xmath11-packets that escape the grid in ( 0,t ) ; and @xmath263 is the sum of the rf energies of packets still propagating within the ejecta at time @xmath6 . finally , @xmath264 is the sum over all physical events in @xmath261 of @xmath265 , where @xmath162 and @xmath266 are an @xmath10-packet s incident and emergent rf energies , respectively .    at all time steps in the calculation of sect .",
    "6.3 , the left- and right - hand sides of eq .",
    "( 21 ) agree to better than @xmath267 part in @xmath268 .",
    "the time variations of the quantities in eq .",
    "( 21 ) are plotted in fig.4 , where the unit of energy is @xmath269 from eq .",
    "( 3 ) . for the adopted parameters , @xmath270 .",
    "4 illustrates the strong departures from stationarity . in the early dense phases ( @xmath271 days ) , energy released by radioactive decays",
    "is trapped within the ejecta , resulting in increasing @xmath263 while @xmath262 remains close to zero .",
    "this continues until @xmath263 reaches a maximum of @xmath272 at @xmath273 days .",
    "thereafter , the dropping density allows the trapped radiation to be released , resulting in a sharp increase in @xmath262 and concomitant decrease in @xmath263 . for @xmath274 days ,",
    "energy storage is inconsequential ( @xmath275 ) ; stationarity then becomes a good approximation , as is evident from the closely similar slopes of @xmath260 and @xmath262 .",
    "the maximum of @xmath263 is a rough measure of the highest fraction of @xmath10-packets active at one time and for which , therefore , storage space must be allocated .",
    "in fact , because many of the packets trapped at @xmath273 days have lost energy by doing work on the expanding ejecta , the active fraction is larger . in the calculation reported here ,",
    "the peak active number is @xmath276 at @xmath277 days - i.e. , @xmath278 .",
    "non - stationarity is also illustrated by fig .",
    "5 , which plots residence against escape times for @xmath10-packets in a small simulation with @xmath279 . for @xmath280 days",
    ", we see that it is not uncommon for escaping @xmath11-packets to have residence times close to the age of the sn .",
    "thereafter , the lowered density allows packets to escape readily and typical residence times drop to @xmath281 a few days .",
    "note also that no @xmath2-packets escape until @xmath282 days .",
    "in stationary problems , or this problem with @xmath4 , a mc simulation must continue until all packets have escaped .",
    "this limits the usefulness of mc methods for optically thick media .",
    "but here a packet initially at large optical depth escapes when that depth has dropped to @xmath283 because of expansion . fig .",
    "5 illustrates this effect .    for this problem , the difficulty with an unacceptably large number of events before escape would reappear if @xmath284 were necessary for accuracy .",
    "fortunately , the position coupling assumption ( sect .",
    "4.1.1 ) is well justified for @xmath285 day .",
    "the aim of this paper has been to initiate a mc approach to computing light curves and spectra for 3-d sn explosions .",
    "the adopted procedure is based on indestructible and indivisible @xmath10-packets as the mc quanta .",
    "although not called upon for this test problem , the attraction of this approach in the long - term for this and other multi - dimensional nlte problems is that it allows the constraints of thermal and statistical equilibrium to be incorporated into the scheme via the concept of macro - atoms .",
    "moreover , the iterations required to achieve full self - consistency between radiation , level populations and the electron temperature can be carried out with geometry - independent @xmath43-iterations .",
    "the calculations reported in sect . 6 demonstrate that high photometric precision can be achieved with mc methods for time - dependent transport calculations in 3-d . contributing strongly to maintaining accuracy",
    "are the radioactive pellets introduced in sect .",
    "3.2 since they result in a seamless transition from energy transport by @xmath2-rays to that by uvoir radiation .",
    "this avoids the loss of accuracy that might arise if the @xmath2-ray deposition profile were separately calculated and then randomly sampled to create uvoir radiation .",
    "an incidental benefit is simplified coding .    in sect .",
    "1 , this investigation was described as providing a platform onto which more detailed treatments of matter - radiation interactions can be added .",
    "thus the already detailed modelling of @xmath2-ray transport can be further improved as discussed in sect .",
    "also @xmath286 , the rate of energy deposition in the form of compton electrons , is available from eq .",
    "( 7 ) as the source term for a spencer - fano calculation of the rates at which non - thermal electrons lose energy to thermal electrons and in ionizing and exciting atoms .",
    "finally , the nlte transfer of uvoir radiation can be implemented following the successful test for a pure h envelope in paper ii .",
    "an encouraging aspect of this agenda is that the physics missing from the present code is well understood , even though many relevant cross sections are still poorly known .",
    "but a discouraging aspect is that the demands on computer power are such that useful results for a physically- realistic 3-d model are not feasible at present with a single workstation . nevertheless ,",
    "as argued in paper ii , an attractive option is to implement these methods on a computer with numerous parallel processors .",
    "but even then , it is probably desirable and necessary to approach the full problem via simplified versions that are less demanding on computer time and storage space .",
    "specifically , as in previous diagnostic codes , the iterations required at each time step for full self - consistency should initially be omitted in favour of approximate formulae relating gas characteristics to the local mc radiation field ."
  ],
  "abstract_text": [
    "<S> monte carlo techniques based on indivisible energy packets are described for computing light curves and spectra for 3-d supernovae . </S>",
    "<S> the radiative transfer is time - dependent and includes all effects of o(v / c ) . </S>",
    "<S> monte carlo quantization is achieved by discretizing the initial distribution of @xmath0 into @xmath1 radioactive pellets . </S>",
    "<S> each pellet decays with the emission of a _ single _ energy packet comprising @xmath2-ray photons representing _ one _ line from either the @xmath0 or the @xmath3 decay spectrum . </S>",
    "<S> subsequently , these energy packets propagate through the homologously - expanding ejecta with appropriate changes in the nature of their contained energy as they undergo compton scatterings and pure absorptions .    the 3-d code is tested by applying it to a spherically - symmetric sn in which the transfer of optical radiation is treated with a grey absorption coefficient . </S>",
    "<S> this 1-d problem is separately solved using castor s co - moving frame moment equations . </S>",
    "<S> satisfactory agreement is obtained .    </S>",
    "<S> the monte carlo code is a platform onto which more advanced treatments of the interactions of matter and radiation can be added . some of these have already been developed and tested in previous papers and are summarized here . </S>"
  ]
}