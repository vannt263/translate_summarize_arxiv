{
  "article_text": [
    "the calculation of long range interactions due to coulomb , gravitational , or dipolar particles is of broad interest from the astrophysics , the biophysics up to the solid state community .",
    "these interactions present a formidable challenge even to modern computers .",
    "sophisticated methods such as fast multipole methods , tree code algorithms , poisson grid solvers , or ewald mesh methods , bring the complexity of n interacting particles down to an almost linear scaling for three - dimensional periodic systems .",
    "often , however , one is interested in slab - like systems which are only periodic in two space dimensions and finite in the third , for example in problems involving electrolyte solutions between charged surfaces , proteins near charged membranes , thin films of ferrofluids , wigner crystals , charged films , membranes , solid surfaces decorated with dipoles etc .    for such systems ewald based formulas",
    "are only slowly convergent , have mostly @xmath0 scalings and no `` a priori '' error estimates exist @xcite . fast",
    "ewald based methods have been recently put forward in @xcite , and a non - ewald method has been put forward in ref.@xcite that is based on a resummation of the force sum . however",
    ", these methods are hampered due to non - controllable errors and an @xmath0 scaling respectively .",
    "recently we proposed a new method called * mmm2d*@xcite which has an @xmath1 complexity and full error control that is based on a convergence factor approach similar to * mmm*@xcite .",
    "however , this will still only allow simulations including up to a few thousand charges",
    ". there have been early attempts to use a 3d ewald sum for these slab problems .",
    "the main idea is to fill only parts of the simulation box with charges and to leave some space empty , in an attempt to decouple the interactions in the third dimension @xcite .",
    "since each image layer is globally neutral , one hopes that their interactions decay as they become more and more distant , i.e. as the size of the gap is increased . in this way",
    "one could make use of any advanced 3d ewald implementation , see also ref .",
    "@xcite for a variant of this idea .    in this paper we will follow the last suggestion and derive a term , called electrostatic layer correction ( * elc * ) , which subtracts the interactions due to the unwanted layers . the combination of that term with any three dimensional summation method with slab  wise summation order will yield the exact electrostatic energy . since the change in the summation order is done by adding a very simple term , any three dimensional summation method with the standard spherical summation order can be used .",
    "the new term can be evaluated easily in a time linear in the number of charges , hence the whole method scales like the underlying standard summation method .",
    "we develop also an error formula for the maximal pairwise error in the energy and forces of the layer correction term , hence the precision of this method can be tuned to any desired value , when used in conjunction with other error estimates for the standard summation method@xcite . in the first section we will recapitulate the way how to correct the summation order via a modified dipole term . in the second section we will derive the layer correction term , and develop in",
    "the following section error estimates for its value .",
    "the applicability of our method will be demonstrated by a numerical analysis in the following section , and we end with our conclusion .",
    "we consider a system of @xmath2 particles with charges @xmath3 and positions @xmath4 that reside in a box of edges @xmath5 , where @xmath6 is the maximal @xmath7distance of two particles .",
    "the basic idea is to expand this slab system in the non - periodic @xmath7coordinate to a system with periodicity in all three dimensions .",
    "more precisely , the original box of size @xmath5 is placed inside a box of size @xmath8 where @xmath9 sufficiently large .",
    "then this box is replicated periodically in all three dimensions .",
    "the result is a three - dimensional periodic system with empty space regions ( `` gaps '' ) of height @xmath10 ( see fig .",
    "[ fig : periodicity ] ) .",
    "@xmath11 will be called gap size in the following .        since the electrostatic potential is only finite if the total system is charge neutral , the additional image layers ( those layers above or below the original slab system ) are charge neutral , too .",
    "now let us consider the @xmath12 image layer which has an offset of @xmath13 to the original layer .",
    "if @xmath13 is large enough , each particle of charge @xmath14 at position @xmath15 and its replicas in the @xmath16-plane can be viewed as constituting a homogeneous charged sheet of charge density @xmath17 .",
    "the potential of such a charged sheet at distance @xmath7 is @xmath18 .",
    "now we consider the contribution from a pair of image layers located at @xmath19 , @xmath20 to the energy of a charge @xmath3 at position @xmath21 in the central layer .",
    "since @xmath22 , we have @xmath23 and @xmath24 , and hence the interaction energy from those two image layers with the charge @xmath3 vanishes by charge neutrality : @xmath25 the only errors occurring are those coming from the approximation of assuming homogeneously charged , infinite sheets instead of discrete charges .",
    "this assumption should become better when increasing the distance @xmath13 from the central layer .",
    "however , in a naive implementation , even large gap sizes will result in large errors @xcite .",
    "this is due to the order of summation for the three dimensional coulomb sum , which is spherical by convention .",
    "this order implies that with increasing shell cutoff @xmath26 the number of image shells grows faster than the number of shells of the primary layer , namely @xmath27 versus @xmath28 ( see fig .",
    "[ fig : spherical ] ) .",
    "in other words , we include the unwanted terms faster than the actually wanted terms . also the image layers are not really infinite charged sheets but are truncated due to the cut - off .",
    "yeh and berkowitz@xcite already suggested that this problem can be solved by changing the order of summation .",
    "smith has shown that by adding to the coulomb energy the term @xmath29 where @xmath30 is the total dipole moment , one obtains the result of a slab  wise summation instead of the spherical limit @xcite . slab ",
    "wise summation refers to the sum @xmath31 , where @xmath32 denotes the energy , calculated in spherical summation order , resulting from the image layer with shift @xmath13 in the @xmath7coordinate .",
    "technically this is the order where we first treat the original layer and then add the image layers grouped in symmetrical pairs ( see fig .",
    "[ fig : planewise ] ) .",
    "obviously this summation order fits much better to the charged sheet argumentation given above .",
    "although this is a major change in the summation order , the difference given by eq .   is a very simple term .",
    "in fact , smith shows that changes of the summation order always result in a difference that depends only on the total dipole moment .    applying this slab  wise summation order , yeh and berkowitz showed that a gap size of at least @xmath33 is normally sufficient to obtain an moderately accurate result .",
    "therefore the result of a standard three dimensional summation method plus the shape ",
    "dependent term given by eq .  , which we refer to as a _ slab ",
    "wise method _ , can be used to obtain a good approximation to the result for the slab geometry with the same computational effort as for the underlying three dimensional summation method ( no matter if a simple or sophisticated method is used ) .",
    "one drawback is that no theoretical estimates exist for the error introduced by the image layers .",
    "therefore one might be forced to use even larger gaps to assure that no artifacts are produced by the image layers .",
    "one simple deducible artifact is that the pairwise error will be position dependant .",
    "particles in the middle of the slab will see no effect of the image layers due to symmetry , and particles near the surface will encounter for the same reason the largest errors , which is definitely an unwanted feature for studying surface effects . therefore averaging error measures like the commonly used rms force error should not be applied without additional checks for the particles near the surfaces .",
    "the other drawback is that normally the box now will have a significantly larger @xmath34 .",
    "but at least for ewald type methods the computation time is proportional to this fraction .",
    "this is easy to see as the number of @xmath35space vectors in the @xmath7 direction must be proportional to @xmath36 to maintain a fixed resolution and therefore error .",
    "it is verified experimentally that a gap of at least @xmath33 is needed . for a cubic system @xmath37 therefore the computation time at least doubles .    nevertheless because of the bad scaling of the known methods for slab geometries like the one by parry @xcite ( @xmath0 ) or * mmm2d * @xcite ( @xmath1 ) , for particle numbers above @xmath38 using slab  wise methods is a great improvement .",
    "we will now derive a term that allows to calculate the _ exact _ contribution of the image layers very efficiently , which we will call the electrostatic layer correction ( elc ) in the following . for the following analysis there is no special restriction on @xmath33 except for @xmath39 , which is true even if the @xmath8box is completely filled .",
    "the method presented here is heavily based on parts of * mmm2d * @xcite .",
    "we start with a formal definition of the coulomb energy of the slab system @xmath40 @xmath41 is a diagonal matrix describing the shape of the box .",
    "the image boxes are denoted with the vector @xmath42 , where @xmath43 for now .",
    "the prime on the inner summation indicates the omission of the self ",
    "interaction @xmath44 in the primary box @xmath45 ( i.  e. the singular case ) . for the surrounding dielectric medium",
    "we assume vacuum boundary conditions .",
    "we now expand the system to a fully three - dimensional periodic system , where @xmath36 determines the period in the @xmath7-coordinate as in the previous section .",
    "we can rewrite the energy as @xmath46 where @xmath47 denotes the standard three - dimensional coulomb  sum with spherical limit . to evaluate this expression one can use any of the efficient algorithms , starting with the classical ewald summation up to modern methods like fast multipole methods @xcite or mesh based algorithms@xcite .",
    "@xmath48 again denotes the shape ",
    "dependent term given by eq .",
    "and finally @xmath49 denotes the contribution of the image layers , for which we are going to derive a new expression in the following .",
    "we start with the expression for the energy induced by an image layer at @xmath7offset @xmath50 : @xmath51    it can be shown rigorously , although this is non  trivial , that @xmath52 this is a convergence factor approach with a convergence factor of @xmath53 .",
    "note that this approach is exact only for two - dimensional systems , for three - dimensional systems eqs .   and differ by a multiple of the dipole moment @xcite .    in @xcite one",
    "can find a proof for this equation and an efficient way of calculating @xmath54 for charge neutral systems .",
    "we do not want to go through the full derivation again ; it consists of the application of poisson s summation formula along both periodic coordinates and performing the limit @xmath55 analytically .",
    "one obtains @xmath56 where @xmath57 is given by @xmath58 @xmath59 is a fourier variable with integer values .",
    "@xmath57 is an artificial pairwise potential that yields the total coulomb energy and its derivative produces the pairwise forces for the periodic system .",
    "for now we only have a formula for the contribution of one image layer , so we still have to sum over all @xmath60 .",
    "this task can be performed analytically .",
    "the terms @xmath61 can be omitted since they are exactly the homogeneous sheet potential and we have seen before that this cancels out for charge neutral systems ( see eq . ) .",
    "the summation over @xmath60 of the remaining sums over @xmath62 and @xmath63 is fairly easy to perform using the geometric series ( as these sums are absolutely convergent , exchanging the summation over @xmath60 and the summations over @xmath64 is possible ) . combining the terms for @xmath65",
    "again we obtain @xmath66 where @xmath67    the forces can be obtained from that by simple differentiation since the sums are absolutely convergent .",
    "although the form in eq . has a much better convergence than the original form in eq .",
    ", its main advantage is a linear computation time with respect to the number of particles @xmath2 . to see this",
    ", the equation has to be rewritten using the addition theorems for the cosine and the hyperbolic cosine . for each @xmath68 one",
    "first calculates the sixteen terms @xmath69 where the indices in the obvious way determine which of the functions cosine ( hyperbolicus ) or sinus ( hyperbolicus ) are used .",
    "then we evaluate @xmath70    similar expansions using the same sixteen terms can also be found for the forces .",
    "obviously this has linear computation time with respect to the number of particles , as the only summations over all the particles occur in the @xmath71 .",
    "but up to now there is still the infinite summation over @xmath68 .",
    "so the next task is to derive an estimate for the error induced by the replacement of the infinite sum by a finite one .",
    "since @xmath72 is written as sum over an alternative potential @xmath73 , it is reasonable to derive an upper bound for the error from the calculation of @xmath73 only with a finite cutoff . from this upper bound ,",
    "crude estimates for other error measures such as the rms ( root - mean - square ) force error can be derived .",
    "again these error estimates are taken from * mmm2d * @xcite . as we will show later , the error distribution is not uniform along the @xmath7axis .",
    "the error gets maximal for particles near the borders .",
    "since these particles will normally be those of special interest , the maximal pairwise error should be some magnitudes smaller than the thermal noise .    while the error bounds for * mmm2d * were only used to tune the algorithm , the error estimates for @xmath72",
    "can also be used to obtain an error bound for the slab  wise method from ref .",
    "@xcite , and hence one can determine `` a priori '' the necessary gap size to reach a preset precision .",
    "therefore we also have to deal with small cutoffs , especially the case when no terms of @xmath72 are added .",
    "first we choose a cutoff @xmath74 and then evaluate @xmath72 only over the area @xmath75 the three sets correspond to the three sums in eq .. therefore we actually evaluate @xmath76    @xmath77 may look more complicated then necessary . but this form enables us to find a rigorous upper bound for the error .",
    "an upper bound for the absolute value of the summands is @xmath78 of course because the cosine hyperbolicus is monotonous , one could use any larger value for @xmath33 .",
    "this is for example necessary in a priori estimations . using this we find the upper bound for the maximal pairwise error in the potential by a simple approximation of the sums by integrals as @xmath79 details",
    "can again be found in @xcite . by an analogous derivation one",
    "can also find an upper bound on the maximal pairwise error on each of the three force components as @xmath80 this is also an weaker bound for the potential .",
    "in other words , the maximal pairwise error on the forces is larger than the error in the potential . for @xmath81",
    "one obtains an overall estimate of the magnitude of the contribution of the image layers , i.  e. an error estimate for the slab  wise methods .",
    "note that eq .",
    "shows that the error in the potential or the force for a single particle will be largest if it is located near the gap , since there @xmath82 will be maximal .",
    "this effect will increase with increasing @xmath83 .",
    "therefore when using the layer correction one must apply non  averaging error estimates such as our maximal pairwise error . averaging error estimates such as the rms force error might be misleading about the error on the particles of interest .",
    "moreover the error will decrease exponentially with the distance from the gap .",
    "since the particles near the gap ( i.e. the surface ) are normally of special interest in simulations with slab geometry , averaging error measures like the rms force error might be misleading about the effect of these errors .",
    "all our error estimates show that the error drops exponential both with @xmath83 and @xmath34 .",
    "the decay in @xmath83 means that it is easy to achieve high accuracies with our layer correction formula , while the decay in @xmath34 shows that slab  wise methods can achieve good accuracies without increasing @xmath34 too much .",
    "although we do not encourage using the rms error measure as we explained above , we still want to give an upper bound on the average error in @xmath72 and the rms force error .",
    "we assume that the pairwise potentials of the different particle pairs are independent identically distributed random variables , which is true for homogenous random systems and normally a good assumption otherwise .",
    "of course the self interaction of the particles , i.  e. @xmath84 has to be omitted .",
    "let @xmath85 be the variance of this random variable , then it is easy to see that @xmath86 . using",
    "this one can show that @xmath87 where @xmath88 .",
    "similarly we define @xmath89 as the variance of the forces measured in the euclidian norm .",
    "then because of the component  wise maximal error estimate for the force , we have @xmath90 , and one obtains @xmath91 where @xmath92 denotes the error in the layer correction force on particle @xmath93 .",
    "note that both estimates and are much larger than the real error as one expects @xmath94 to be _ much _ smaller the maximal error ( about @xmath95 magnitudes ) .",
    ", @xmath96 for different cutoff radii @xmath83 ]    in this section we want to show results from our implementation of the layer correction term ( * elc * ) .",
    "first we want to show that our maximal pairwise error bounds are correct .",
    "to this aim we place two particles randomly in a box of size @xmath98 , so that we leave a gap of @xmath99 in a box of dimensions @xmath100 . fig .",
    "[ fig : pw ] shows the maximal potential and force error that occurred during 10000 evaluations and our estimates @xmath101 and @xmath96 .",
    "moreover we have included the result for a particle pair with a relative position of @xmath102 , the worst case position .",
    "for such a position the error estimate is exact up to the approximation of the sum by an integral . as `` exact '' force we used @xmath103 .",
    "one can see that the maximal error estimates are always above the measured deviations .",
    "even after 10000 random evaluations the maximum error is considerably lower than for the special pair with relative position @xmath102 , and the error is still not very smooth .",
    "this effects are due to the fourier representation with exponentially decaying coefficients , which makes the worst case error extremely rare .",
    "but in a real simulation the particle distribution is not necessarily homogeneous and to be on the safe side one has to deal also with the rare worst case error .",
    "nevertheless fig .",
    "[ fig : pw ] shows that the error coming from the image layers can be strictly controlled .",
    "next we investigate the computation times of our implementation of the elc term . for different gap sizes @xmath104 and @xmath105 we show in fig .  [",
    "fig : cpu ] the computation time @xmath106 for different numbers of particles @xmath2 .",
    "the systems were again consisting of uniformly randomly distributed particles of charges @xmath107 .",
    "the maximal pairwise error was fixed to be @xmath108 .",
    "the times are averages over 10 runs on a compaq xp1000 .",
    "the computation time for the same system consisting of 1000 charges using p@xmath109 m is @xmath110 for a typical rms force error of @xmath108 .",
    "therefore even the small gap of @xmath111 gives just the same order of computation time .",
    "for the normally used gap sizes of @xmath112 the computation time is negligible compared to p@xmath109 m . in fig .",
    "[ fig : err ] we show the rms force errors that occurred .",
    "one can see the predicted @xmath113 behavior .",
    "we also show the theoretical upper bound @xmath114 for @xmath115 and @xmath99 , which is considerably above as expected .",
    "axis for 100 random systems with 100 particles ]    as the last important fact we demonstrate that the errors for the layer correction indeed are maximal near the gap ( i.e. near the surface ) . for fig .",
    "[ fig : zerr ] 100 particles were put 100 times randomly in a box with a gap of @xmath116 .",
    "then for every particle the magnitude of the layer correction for @xmath117 , which is a good approximation to the full @xmath72 , and the difference in the layer correction between @xmath118 and @xmath117 was drawn against the @xmath7-coordinate .",
    "clearly the error always is largest near the gap .",
    "this effect increases with increasing @xmath83 , which is easy to understand from the error formula .",
    "therefore the full rms error of the system might be completely misleading about the effect the errors have on the particles near the gap as we mentioned before .",
    "nevertheless the figure shows that @xmath72 with @xmath118 reduces the error near the surfaces by a factor of @xmath119 .",
    "we have derived a term called * elc * to efficiently calculate the contribution of the image layers in three dimensionally periodically replicated slab systems .",
    "* elc * scales as the number @xmath2 of particles and has a rigorous error bound .",
    "moreover this error bound can be used to estimate the size of the image layer contribution and therefore gives a bound on the error introduced by slab  wise methods as proposed by yeh and berkowitz .",
    "we have found that the error for these methods decays exponentially in @xmath34 .",
    "however , the errors are not uniformly distributed over the slab , namely they are worst at the surfaces of the slabs .",
    "this strongly suggests to restrict the maximal pairwise error instead of the usually assumed rms - errors .    in a forthcoming paper @xcite",
    "we will focus on the application of * elc * to the standard ewald method and to * p@xmath109m*. we will show how the error formulas of kolafa and perram @xcite have to be adapted to allow non  cubic simulation boxes which is essential for using * elc * with @xmath81 , i.  e. a slab  wise method . for all combinations we present numerical results which allow easily to decide which method is optimal for use in a real simulation .",
    "financial support from the dfg `` schwerpunkt polyelektrolyte '' is gratefully acknowledged .",
    "a.  arnold , berechnung der elektrostatischen wechselwirkung in 2d + h periodischen systemen , + diploma thesis , johannes gutenberg - universitt , 2001 + url http://www.mpip-mainz.mpg.de/www/theory/phd_work/dipl-arnold.ps.gz ."
  ],
  "abstract_text": [
    "<S> we propose a new method to sum up electrostatic interactions in 2d slab geometries . </S>",
    "<S> it consists of a combination of two recently proposed methods , the 3d ewald variant of yeh and berkowitz , j. chem . </S>",
    "<S> phys . 111 </S>",
    "<S> ( 1999 ) 3155 , and the purely 2d method mmm2d by arnold and holm , to appear in chem . </S>",
    "<S> phys . lett . </S>",
    "<S> 2002 . </S>",
    "<S> the basic idea involves two steps . </S>",
    "<S> first we use a three dimensional summation method whose summation order is changed to sum up the interactions in a slab - wise fashion . </S>",
    "<S> second we subtract the unwanted interactions with the replicated layers analytically . </S>",
    "<S> the resulting method has full control over the introduced errors . </S>",
    "<S> the time to evaluate the layer correction term scales linearly with the number of charges , so that the full method scales like an ordinary 3d ewald method , with an almost linear scaling in a mesh based implementation . in this paper we will introduce the basic ideas , derive the layer correction term and numerically verify our analytical results . </S>"
  ]
}