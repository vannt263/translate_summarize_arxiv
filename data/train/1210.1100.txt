{
  "article_text": [
    "formalizing confluence criteria has a long history in @xmath0-calculus .",
    "huet  @xcite proved a stronger variant of the parallel moves lemma in coq .",
    "isabelle / holwas used in  @xcite to prove the church - rosser property of @xmath1 , @xmath2 , and @xmath3 . for @xmath1-reduction",
    "the standard tait / martin - lf proof as well as takahashi s proof  @xcite were formalized .",
    "the first mechanically verified proof of the church - rosser property of @xmath1-reduction was done using the boyer - moore theorem prover  @xcite .",
    "the formalization in twelf  @xcite was used to formalize the confluence proof of a specific higher - order rewrite system in  @xcite .",
    "newman s lemma ( for abstract rewrite systems ) and knuth and bendix critical pair theorem ( for first - order rewrite systems ) have been proved in  @xcite using acl .",
    "an alternative proof of the latter in pvs , following the higher - order structure of huet s proof , is presented in  @xcite .",
    "pvsis also used in the formalization of the lemmas of newman and yokouchi in  @xcite .",
    "knuth and bendix criterion has also been formalized in coq  @xcite and isabelle / hol  @xcite .",
    "decreasing diagrams  @xcite are a complete characterization of confluence for abstract rewrite systems whose convertibility classes are countable . as a criterion for abstract rewrite systems",
    ", they can easily be applied for first- and higher - order rewriting , including term rewriting and the @xmath0-calculus . furthermore , decreasing diagrams yield constructive proofs of confluence  @xcite ( in the sense that the joining sequences can be computed based on the divergence ) .",
    "we are not aware of a ( complete ) formalization of decreasing diagrams in any theorem prover ( see remarks in section  [ con : main ] ) .    in this paper",
    "we discuss a formalization of decreasing diagrams in the theorem prover isabelle / hol .",
    "( in the sequel we just call it isabelle . )",
    "we closely follow the proofs in  @xcite . for alternative proofs see  @xcite or  @xcite where proof orders play an essential role .",
    "the main contributions of this paper are ( two ) mechanical proofs of theorem  [ thm : main ] in isabelle .",
    "[ thm : main ] a locally decreasing abstract rewrite system is confluent .    as a consequence all definitions ( lemmata ) in this paper have been formalized ( proved ) in isabelle .",
    "the definitions from the paper are ( modulo notation ) identical to the ones used in isabelle . our formalization ( , available from  @xcite ) consists of approximately 1600 lines of isabellecode in the isarstyle and contains 31 definitions and 122 lemmata . the valley version  @xcite amounts to ca .  1000 lines , 22 definitions , and 97 lemmata while the conversion version  @xcite has additional 600 lines of isabellecomprising 9 definitions and 25 lemmata .",
    "our formalization imports the theory from the isabellelibrary and  @xcite from the archive of formal proofs .",
    "we used isabelle2012 and the archive of formal proofs from july 30 , 2012 .",
    "the remainder of this paper is organized as follows . in the next section we recall helpful preliminaries for our formalization of  @xcite , which is described in section  [ for : main ] .",
    "the conversion version of decreasing diagrams  @xcite is the topic of section  [ for : cv ] . in section  [ mea : main ] we highlight changes to ( and omissions in ) the proofs from  @xcite before we conclude in section  [ con : main ] . appendix  [ def : main ] presents the most important definitions in isabellenotation .",
    "we assume familiarity with rewriting  @xcite and decreasing diagrams  @xcite .",
    "basic knowledge of isabelle  @xcite is not essential but may be helpful .    given a relation @xmath4 we write @xmath5 for its inverse , @xmath6 for its transitive closure , and @xmath7 ( in pictures also @xmath8 ) for its reflexive closure .",
    "we write @xmath9 for @xmath4 or @xmath5 and denote sets by @xmath10 , @xmath11 ,  @xmath12 , multisets by @xmath13 , @xmath14 , @xmath15 , @xmath16 , @xmath17 , @xmath18 , single labels by @xmath19 , @xmath1 , and @xmath20 , and lists of labels by @xmath21 , @xmath22 , @xmath23 , @xmath24 , @xmath25 , and @xmath26 ( possibly primed or indexed )",
    ".    .predefined isabelleoperators . [ cols=\"<,<,<,<,<\",options=\"header \" , ]     table  [ tab : op ] gives an overview of several predefined operators in isabellefor sets , multisets , and lists ( sequences ) where we also incorporated the notation from  @xcite in the rightmost column . in the paper",
    "we will use the isabellenotation , but drop the @xmath27 for concatenating sequences and write @xmath19 instead of @xmath28 $ ] .",
    "in addition to the operators provided by isabelle , we need the difference ( intersection ) of a multiset with a set . here",
    "@xmath29 ( @xmath30 ) removes ( keeps ) all occurrences of elements in  @xmath13 that are in  @xmath10 .",
    "sometimes it will be necessary to convert e.g.  a multiset to a set ( or a list ) . in the paper",
    "we leave these conversions implicit , since no confusion can arise .",
    "we establish the following useful equivalences :    [ lemmaa_3 ]    1 .",
    "@xmath31 2 .",
    "@xmath32 3 .",
    "@xmath33 4 .",
    "@xmath34    by unfolding the definitions of multiset and the operators .",
    "we assume familiarity with the original proof of decreasing diagrams in  @xcite , upon which our formalization in this section is based .",
    "nevertheless we will recall the important definitions and lemmata .",
    "however , we only give proofs if our proof deviates from the original argument .",
    "in addition we state ( sometimes small ) key results , since an effective collection of lemmata is crucial for completely formal proofs .",
    "the remainder of this section is organized as follows : section  [ for : mul ] describes our results on multisets .",
    "section  [ for : dd ] is dedicated to decreasingness ( of sequences of labels ) and section  [ for : ld ] is concerned with an alternative formulation of local decreasingness .",
    "afterwards , section  [ for : rew ] lifts decreasingness ( from labels ) to diagrams .",
    "well - foundedness of the measure ( on peaks ) is proved in section  [ for : mr ] , where we also establish the main result .      in the sequel",
    "we assume @xmath35 to be a transitive and irreflexive binary relation .",
    "[ def : multiset ]    1 .",
    "the set @xmath36 is the strict order ideal generated by ( or _ down - set _ of ) @xmath19 , defined by @xmath37 .",
    "this is extended to sets @xmath38 .",
    "we define @xmath39 and @xmath40 to be the down - set generated by the set of elements in @xmath13 and @xmath21 , respectively .",
    "2 .   the _ ( standard ) multiset extension _ ( denoted by @xmath41 ) of @xmath35 is defined by @xmath42 the relation @xmath43 is obtained by removing the last condition ( @xmath44 ) .",
    "note that @xmath43 is the reflexive closure of @xmath41 ( cf .",
    "lemma  [ lem : multeq ] in section  [ mea : main ] ) .",
    "the following result is not mentioned in  @xcite  while ( * ? ? ?",
    "* proposition  1.4.8(3 ) ) shows a more general result  but turned out handy for our formalization .",
    "[ lem : ds_ds_subseteq_ds ] @xmath45    assume @xmath46 . by definition  [ def : multiset ] there must be a @xmath47 with @xmath48 . from @xmath47",
    "we obtain a @xmath49 with @xmath50",
    ". then @xmath51 by transitivity of  @xmath35 and hence @xmath52 .",
    "the multiset extension inherits some properties of the base relation , which we will implicitly use in the sequel .",
    "let @xmath35 be a transitive and well - founded relation .",
    "then @xmath41 is transitive and well - founded , and @xmath43 is reflexive and transitive .    by lemmata  [ lem : mult ] and  [ lem : multeq ] in combination with existing results in .",
    "we can now establish the following properties .",
    "[ lemma2_6 ]    1 .",
    "@xmath53 and @xmath54 and @xmath55 2 .",
    "@xmath56 3 .",
    "@xmath57 4 .",
    "@xmath58 5 .",
    "@xmath59 6 .",
    "@xmath60 7 .",
    "@xmath61 8 .",
    "@xmath62 9 .",
    "@xmath63    note that statements ( 5 ) and ( 6 ) slightly differ from  ( * ? ? ?",
    "* lemma  2.6)(5,6 ) , but are easier to apply .",
    "the ( easy ) the statements of ( 8) and ( 9 ) are not mentioned in  @xcite , which we required for ( * ? ? ?",
    "* lemmata  3.5 and  3.6 ) .",
    "we define the _ lexicographic maximum _ measure , which maps lists to multisets , inductively .    [ def : lexmax ]    * @xmath64}| = \\{\\#\\}$ ] * @xmath65    the next lemma establishes properties of the lexicographic maximum measure .",
    "[ lemma3_2 ]    1 .",
    "@xmath66 2 .",
    "@xmath67    1 .   by induction on",
    "the base case is trivial . using lemma  [ lemma2_6](1 ) the inductive step amounts to @xmath68 the inclusion from left to right follows from the induction hypothesis . for the inclusion from right to",
    "left we proceed by case analysis . if @xmath69 then the result immediately follows . if @xmath70 then @xmath71 and from the induction hypothesis @xmath72",
    ". furthermore @xmath70 using lemma  [ lem : ds_ds_subseteq_ds ] also yields @xmath73 . hence @xmath74 and from lemma  [ lemma2_6](1 )",
    "we obtain @xmath75 , from which the result follows .",
    "2 .   by induction on  @xmath21 , see  @xcite .    _",
    "decreasingness _ is defined on quadruples ( of sequences of labels ) .",
    "[ def : decreasing ] the quadruple of labels @xmath76 is _ decreasing _",
    "( d ) if @xmath77 for a visualization see figure  [ fig : dd ] . and  [ for : ld ] are on labels only for visualization we already use diagrams . ]",
    "we write d into a diagram to indicate that its labels are decreasing .",
    "decreasingness can also be stated differently .",
    "[ lem : decreasing ] the following two statements are equivalent :    1 .",
    "@xmath78 and @xmath79 2 .",
    "@xmath80 and @xmath81    by lemma  [ lemma3_2](2 ) and lemma  [ lemma2_6](6 ) .    we have followed the ( involved ) proofs in  @xcite that pasting preserves decreasingness ( lemma  [ lemma3_5 ] ) and that pasting is hypothesis decreasing ( lemma  [ lemma3_6 ] ) without big changes .",
    "[ lemma3_5 ] if @xmath76 and @xmath82 are decreasing , then @xmath83 is decreasing ( see figure  [ fig : lemma3_5 ] ) .",
    "as in  @xcite but we show @xmath84 ( instead of @xmath85 ) where we needed lemma  [ lemma2_6](8 ) ( in the last sequence in ( * ? ? ?",
    "* proof of lemma  3.5 ) ) .",
    "[ lemma3_6 ] if @xmath22 is non - empty and we have that @xmath76 is decreasing ( see figure  [ fig : lemma3_6 ] ) then @xmath86 .    as in  @xcite using lemma  [ lemma2_6](9 ) in the second step .",
    "labels @xmath87 are _ locally decreasing _ ( ld ) if they are decreasing and both @xmath19 and @xmath1 consist of exactly one label ( see figure  [ fig : ld ] ) .",
    "now , ld can also be formulated differently :    [ proposition3_4 ] the form of locally decreasing labels is specified in figure  [ fig : ld ] .    to show lemma  [ proposition3_4 ] we give names to the joining sequences as in figure  [ fig : ld2 ] .",
    "then the condition of figure  [ fig : ld ] can be expressed as : @xmath88    local decreasingness of the labels in the diagram of figure  [ fig : ld ] ( using lemma  [ lem : decreasing ] ) yields @xmath89 hence lemma  [ proposition3_4 ] states that @xmath90 .",
    "this means that    * if a local diagram satisfies the conditions in figure  [ fig : ld ] , i.e.  @xmath91 , then it is decreasing and * local decreasingness implies that the joining sequences @xmath92 and @xmath93 in figure  [ fig : ld ] can be decomposed into @xmath94 and @xmath95 such that the properties of the local diagram in figure  [ fig : ld ] , i.e.  @xmath91 , are satisfied .",
    "lemma  [ proposition3_4_step ] will be the key result for ( i ) , but first we establish a useful lemma .",
    "[ proposition3_4_aux ] @xmath96    by induction on @xmath21 .",
    "the base case is trivial .",
    "the step case amounts to @xmath97 using definition  [ def : lexmax ] in the first step and the induction hypothesis in the second step .    in the sequel",
    "we will view @xmath98 and @xmath21 as sets and use @xmath99 .",
    "now we can prove the following key result to establish ( i ) .",
    "[ proposition3_4_step ] @xmath100    we show @xmath101 which is equivalent to the conclusion by lemmata  [ lemma3_2](2 ) , [ lemmaa_3](1 ) and definition  [ def : lexmax ] .",
    "the hypothesis contains @xmath102 , which together with lemma  [ proposition3_4_aux ] yields @xmath103 and hence @xmath104 we get @xmath105 and hence @xmath106 from the hypothesis we have two cases to consider for  @xmath107 .    *",
    "if @xmath108}$ ] then @xmath109 and from ( 3 ) we have @xmath110 using lemma  [ lemmaa_3](2 ) . then @xmath111 follows immediately from ( 1 ) , ( 2 ) , and ( 3 ) . *",
    "if @xmath112 $ ] then we get ( 2 ) @xmath113 $ with definition~\\ref{def : lexmax } } \\\\ & { \\preccurlyeq_\\textsf{mul}}\\{\\#\\alpha\\#\\ } & \\text{lemma~\\ref{lemma2_6}(8)}\\end{aligned}\\ ] ] and ( because @xmath114 ) , similar as in the other case from ( 3 ) we get @xmath115 from ( 1 ) , ( 2 ) , and ( 3  ) we conclude ( @xmath116 ) .",
    "next we prepare for the key lemma to establish ( ii ) , i.e. , lemma  [ proposition3_4_inv_step ] , after establishing useful intermediate results .",
    "note that lemma  [ proposition3_4_inv_aux](2 ) can be seen as an inverse of lemma  [ proposition3_4_aux ] .",
    "[ proposition3_4_inv_aux ]    1 .",
    "@xmath117 2 .",
    "@xmath118 3 .",
    "@xmath119    1 .",
    "by induction on @xmath21 .",
    "the base case is trivial . in the step case",
    "we can assume that @xmath120 .",
    "we proceed by case analysis . *",
    "if @xmath121 then we are done with @xmath122}$ ] and @xmath123 . * in the other case we have @xmath124 and @xmath125 from definition  [ def : lexmax ] .",
    "the induction hypothesis yields @xmath126 and @xmath127 with @xmath128 such that @xmath129 . because @xmath125 we can conclude with @xmath130 and @xmath131 using lemma  [ lemma2_6](1 ) .",
    "2 .   assume @xmath132 .",
    "if @xmath124 then we are done by the hypothesis . in the other case there must be a @xmath133 ( easy induction on @xmath21 ) with @xmath134 . from the hypothesis we get that @xmath135 and by transitivity also @xmath136 , which finishes the proof .",
    "3 .   by monotonicity of @xmath137 ( (",
    "* proposition  1.4.8(2 ) ) ) the assumption yields @xmath138 .",
    "lemma  [ lem : ds_ds_subseteq_ds ] finishes the proof .    with lemma  [ proposition3_4_inv_aux ]",
    "we can now prove the following key result to establish ( ii ) :    [ proposition3_4_inv_step ] @xmath139    to show the result we perform a case analysis .",
    "* if @xmath140 then lemma  [ proposition3_4_inv_aux](1 ) yields @xmath141 and @xmath142 with @xmath143 and @xmath144 .",
    "hence from the hypothesis and lemma  [ lemma3_2](2 ) we get @xmath145 and since @xmath144 and @xmath125 it follows that @xmath146 now , lemma  [ lemmaa_3](2 ) yields @xmath147 and from lemma  [ proposition3_4_inv_aux](2 ) we get @xmath148 the latter simplifies to @xmath149 using @xmath150 ( from lemma  [ proposition3_4_inv_aux](3 ) ) and lemma  [ lemma2_6](1 ) . hence in this case the result follows with @xmath112 $ ] . *",
    "if @xmath151 @xmath152 in this case the result follows with empty @xmath141 , empty @xmath107 , and @xmath153 .",
    "now lemma  [ proposition3_4 ] follows from lemma  [ proposition3_4_step ] ( @xmath154 ) and lemma  [ proposition3_4_inv_step ] ( @xmath155 ) .",
    "so far we have only considered sequences of labels . however , for the main result ( section  [ for : mr ] ) we need labeled rewriting .",
    "hence this section sketches how we formalized _ labeled _ ( abstract ) rewriting before lifting the results from section  [ for : dd ] from labels to labeled rewriting ( a step which is left implicit in  @xcite ) . in the theory",
    "an _ abstract rewrite system _ ( ars ) is a set of pairs of objects of the same type , i.e. , a binary relation .",
    "confluence is also defined in , but the theory does not provide support for _ labeled _ abstract rewrite systems . in the sequel we write @xmath156 ( @xmath157 ) for ( labeled ) arss .",
    "a _ labeled ars _",
    "@xmath157 is a ternary relation .",
    "we call @xmath158 a _ ( labeled rewrite ) step _ and write @xmath159 . next we define _ ( labeled rewrite ) sequences _ inductively , i.e. , for each object @xmath160 there is the empty sequence @xmath161}}{\\to\\!\\!\\!\\!\\!\\to } } a$ ] and if @xmath159 is a step and @xmath162 is a sequence then @xmath163 is a sequence .",
    "[ ex : seq ] let @xmath157 be the labeled ars @xmath164",
    ". then @xmath165 ( or @xmath166 ) is a sequence in @xmath157 . the empty sequence @xmath167}{\\to\\!\\!\\!\\!\\!\\to } } a$ ] we also write as @xmath160 .",
    "we prove useful properties for sequences , i.e. , that chopping off a segment of a sequence again yields a sequence and that two sequences can be concatenated ( provided the last element of the first sequence coincides with the first element of the second sequence ) .",
    "[ lem : seq ] let @xmath168 and @xmath169 be sequences .    1 .",
    "then @xmath170 and @xmath171 are sequences for any @xmath172 .",
    "2 .   if @xmath173 then @xmath174 is a sequence .    by induction on @xmath168 .    as a next step",
    "we introduce diagrams .",
    "[ def : diagram ] a _ diagram _ is a quadruple of sequences @xmath175 such that the start and endpoints of the sequences satisfy the picture in figure  [ fig : dd ] .",
    "a diagram is called _ decreasing _ if its labels are .",
    "we lift lemma  [ lemma3_5 ] from labels to diagrams .",
    "[ lemma3_5_dd ] pasting two decreasing diagrams yields a decreasing diagram . for a picture see figure  [ fig : lemma3_5 ] .    with the help of lemma  [ lem : seq](2 )",
    "we show that pasting two diagrams again yields a diagram . that pasting preserves decreasingness follows from lemma  [ lemma3_5 ] .",
    "we establish that if all local peaks of a labeled ars  @xmath157 are decreasing then all peaks of  @xmath157 are decreasing , following the structure of the proof of ( * ? ? ?",
    "* theorem  3.7 ) .",
    "( changes are discussed in section  [ mea : main ] ) .",
    "note that only here we need that @xmath35 is well - founded , from which irreflexivity immediately follows ( to satisfy our global assumption from section  [ pre : main ] ) .",
    "first we introduce ( local ) peaks .",
    "[ def : peak ] a _ peak _ @xmath176 is a pair of labeled rewrite sequences which originate from the same object .",
    "local peak _ is a peak where the sequences consist of a single step .    to prove the main result we introduce a measure on _ peaks _",
    "( actually on pairs of sequences ) .",
    "[ def : measure ] let @xmath177 @xmath178 .",
    "then we can lift @xmath35 as a relation on labels to a relation on pairs of sequences  @xmath179 , i.e. , @xmath180 .    for proofs of induction",
    "we establish that @xmath179 is well - founded .",
    "[ lem : wf ] let @xmath35 be well - founded .",
    "then @xmath179 is well - founded .    from  @xcite we get that @xmath41 is well - founded (",
    "this proof is contained in ) .",
    "we proceed by contraposition .",
    "assume the measure on peaks is not well - founded .",
    "then we obtain an infinite sequence @xmath181 which entails an infinite sequence on multisets @xmath182 showing the result .",
    "[ def : pd ] a peak @xmath176 in a labeled ars is _ decreasing _ if it can be completed into a decreasing diagram , i.e. , there are @xmath183 and @xmath184 such that the conditions of figure  [ fig : dd ] are satisfied .",
    "a peak is _ locally decreasing _",
    ", if it is decreasing and a local peak .    [ lem : ld_imp_d ] let @xmath157 be a labeled ars and @xmath35 be a transitive and well - founded relation on the labels",
    ". if all local peaks of  @xmath157 are decreasing , then all peaks of  @xmath157 are decreasing .    to show that all peaks are decreasing we fix a peak @xmath176 and show that this peak can be completed into a decreasing diagram .",
    "the proof is by well - founded induction on @xmath179 and there only is the step case .",
    "the interesting situation is when neither @xmath22 nor @xmath21 are empty , i.e. , ( using lemma  [ lem : seq](1 ) we obtain ) @xmath185 and @xmath186 ( see figure  [ fig : main ] ) .",
    "hence @xmath187 is a local peak and from the assumption we obtain a decreasing diagram with joining sequences @xmath188 and @xmath189 .",
    "we obtain that @xmath190 is a peak and want to show that the measure of this peak is smaller than that of @xmath176 ( to apply the induction hypothesis ) .",
    "since @xmath1 is not empty with lemma  [ lemma3_6 ] we establish that @xmath191 is smaller than @xmath192 and from @xmath193this step is not mentioned in  @xcite but hinted at in  @xcite . ]",
    "we obtain the desired result .",
    "now , the induction hypothesis yields that ih@xmath194 is a decreasing diagram . concatenating ( using lemma  [ lem : seq](2 ) ) @xmath189 and @xmath195 into a sequence @xmath184 , using lemma  [ lemma3_5_dd ] we can paste the diagrams d and ih@xmath194 into a decreasing diagram ( dih@xmath194 , see figure  [ fig : dih ] ) .",
    "the peak @xmath196 is smaller than the peak @xmath176 by a mirrored version of lemma  [ lemma3_6 ] and hence the induction hypothesis yields the decreasing diagram ih@xmath197 .",
    "finally , a mirrored version of lemma  [ lemma3_5_dd ] pastes dih@xmath194 and ih@xmath198 into a decreasing diagram .",
    "we define local decreasingness for arss .",
    "[ def : ld ] an ars  @xmath156 is _ locally decreasing _ if there exists a transitive and well - founded relation @xmath35 on the labels such that all local peaks are decreasing for ( a labeled version of )  @xmath156 .",
    "finally we arrive at the main result for soundness :    [ cor : d_imp_cr ] a locally decreasing ars is confluent .    from local decreasingness we get a transitive and well - founded relation @xmath35 such that all local peaks are decreasing in a labeled version of the ars .",
    "lemma  [ lem : ld_imp_d ] yields that all peaks are decreasing .",
    "the result follows by dropping labels from the labeled rewrite sequences .",
    "in this section we give a formal proof for the main result underlying that local decreasingness with respect to conversions ( see  @xcite ) implies confluence . to this end",
    "we formally introduce ( labeled ) conversions , similarly to labeled rewrite sequences . for each object",
    "@xmath160 there is the empty conversion @xmath167}{\\leftrightarrow\\!\\!\\!\\!\\!\\leftrightarrow } } a$ ] ( also just written @xmath160 ) and if @xmath159 ( @xmath199 ) is a labeled rewrite step and @xmath200 is a conversion then @xmath201 ( @xmath202 ) is a conversion ( often written @xmath203 ) . for conversions we prove similar properties as for sequences ( see lemma  [ lem : seq ] ) . in addition",
    "we establish that mirroring a conversion again yields a conversion ( with the same set of labels ) and that every sequence is a conversion .",
    "[ lem : conv ] let @xmath204 and @xmath205 be conversions .    1 .",
    "then @xmath206 and @xmath207 are conversions for any @xmath172 .",
    "2 .   if @xmath173 then @xmath208 is a conversion .",
    "3 .   then @xmath209 is a conversion and @xmath210 .",
    "if @xmath211 is a sequence then @xmath212 is a conversion .",
    "items ( 1)-(3 ) are proved by induction on the first conversion , item ( 4 ) is proved by induction on the sequence .",
    "we will also use the following easy lemma being a direct consequence of definition  [ def : multiset ] .",
    "[ lem : mul_eq_ds ] if @xmath213 and @xmath214 then @xmath215 .",
    "the following result ( stated as observation in @xcite ) follows from lemma  [ lem : mul_eq_ds ] .",
    "[ lem : dd_ds ] if @xmath175 is a decreasing diagram and @xmath216 then also @xmath217 .",
    "a local peak @xmath187 is _ _ decreasing with respect to conversions _ _ ) . ] if there exist conversions such that the constraints from figure  [ fig : ldc ] are satisfied .",
    "now we can state the main result underlying soundness of the conversion version of decreasing diagrams .",
    "[ lem : main : conv ] let  @xmath157 be a labeled ars and @xmath35 be a transitive and well - founded relation on the labels . if all local peaks of  @xmath157 are decreasing with respect to conversions , then all peaks of  @xmath157 are decreasing ( with respect to valleys ) .",
    "similar to  @xcite we follow the proof of the valley version ( see lemma  [ lem : ld_imp_d ] ) .",
    "in contrast to lemma  [ lem : ld_imp_d ] we do not get decreasingness of the local peak @xmath187 ( in figure  [ fig : main ] ) by assumption . instead our assumption yields local decreasingness with respect to conversions , i.e. , as depicted in figure  [ fig : ldc ] .",
    "we close the conversion into a valley as outlined in figure  [ fig : ldc2 ] . to this end",
    "we use lemmata  [ lem : key1 ] and  [ lem : key2 ] ( see below ) and conclude the valleys as shown in figure  [ fig : ldc2 ] .",
    "note that for the final application of lemma  [ lem : key1 ] we apply lemma  [ lem : conv ] first , to combine the sequences and conversions into a single conversion .",
    "lemma  [ proposition3_4 ] ( lifted to rewriting sequences ) then shows decreasingness of the diagram .",
    "the main structure of our proof follows the one from  @xcite",
    ". however , there the proofs of two key results are sketchy and informal .",
    "we identified the statements as lemmata  [ lem : key1 ] and  [ lem : key2 ] and provide formal proofs .",
    "note that to establish these properties we can use the induction hypothesis ( from the proof of lemma  [ lem : main : conv ] ) , e.g. , peaks whose measure is smaller than @xmath218 can be completed into a decreasing diagram .",
    "[ lem : key1 ] let all peaks smaller than @xmath218 have a decreasing diagram .",
    "then for any @xmath13 with @xmath219 we have @xmath220 .    by induction on the conversion @xmath221 .",
    "the base case is trivial . in the step case",
    "we have @xmath222 . the induction hypothesis yields @xmath223 .",
    "we consider two cases .",
    "if the first step is from left to right , i.e. , @xmath224 then the result follows from lemma  [ lem : conv](2 ) ( see figure  [ fig : key1a ] ) . in the other case",
    "we have @xmath225 .",
    "since the peak @xmath226 has a smaller measure than @xmath187 it can be completed into a decreasing diagram and lemma  [ lem : dd_ds ] in combination with lemma  [ lem : conv](2 ) yields the result ( see figure  [ fig : key1b ] ) .    to show the second key result we establish a useful decomposition result on sequences .",
    "[ lem : seq_dec ] let @xmath227 be a sequence and @xmath228 .",
    "then there are sequences @xmath229 and @xmath230 such that @xmath231 .",
    "by induction on the sequence @xmath227 .    below @xmath232 stands for @xmath233 ( one step ) or @xmath234}{\\to\\!\\!\\!\\!\\!\\to}}$ ] ( zero steps ) .",
    "please note the similarity of the following result to the explicit characterization of local decreasingness ( cf .",
    "figure  [ fig : ld ] ) .",
    "[ lem : key2 ] let all peaks smaller than @xmath218 have a decreasing diagram",
    ". then the peak @xmath235 can be closed by @xmath236 ( see figure  [ fig : key2b ] ) .",
    "since @xmath237 is smaller than @xmath218 , it can be completed into a decreasing diagram @xmath175 ( see figure  [ fig : key2a ] ) .",
    "first we show @xmath238 . from decreasingness and lemma  [",
    "lem : decreasing ] we get @xmath80 .",
    "the assumption @xmath239 and lemma  [ proposition3_4_aux ] yields @xmath240 . using lemma  [ lem : mul_eq_ds ]",
    "we obtain @xmath241 , i.e.  @xmath242 .",
    "the assumption @xmath243 yields @xmath244 and hence we conclude by lemmata  [ lemma2_6](1 ) and  [ proposition3_4_inv_aux](2 ) .",
    "next we show that @xmath183 can be decomposed into @xmath229 , @xmath245 , and @xmath246 with @xmath247 , @xmath248 , @xmath249 , and @xmath250 . to this end",
    "we first observe that lemma  [ proposition3_4_inv_step ] also holds if @xmath1 is not a single label but a sequence ( here @xmath22 ) .",
    "then from decreasingness we obtain @xmath251 .",
    "lemma  [ lem : seq_dec ] lifts the decomposition of labels to a decomposition of sequences and we can conclude .",
    "an ars  @xmath156 is _ locally decreasing with respect to conversions _ if there exists a transitive and well - founded relation @xmath35 on the labels such that all local peaks are decreasing with respect to conversions for ( a labeled version of )  @xmath156 .",
    "finally we arrive at the main result for soundness :    [ cor : ldc_imp_cr ] a locally decreasing with respect to conversions ars is confluent .",
    "in this section we discuss differences between our formalization and ( proofs from )  @xcite .    within isabelle ( ) an ars is a binary relation while in  @xcite the ars also contains the domain of the relation .",
    "a similar statement holds for labeled arss .",
    "_ general multisets _ are used in @xcite , which can represent sets and finite multisets in one go where s our formalization clearly separates the two concepts .",
    "the reason is purely practical , i.e. , the isabellelibrary already contains the dedicated theories and .",
    "the only ( negligible ) disadvantage we have experienced from this design choice is the need for multiple definitions of the down - set ( for lists , sets , and multisets ) and for lemma  [ lemma2_6](1 ) . on the other hand , this saved us from formalizing _ general multisets _ , which we anticipate as a significant endeavour on its own . moreover ,  @xcite uses a different multiset extension than .",
    "the latter defines the multiset extension as the transitive closure of the `` one - step '' multiset extension .",
    "the _ one - step multiset extension _ ( denoted by @xmath252 ) of  @xmath35 is defined by @xmath253 and the _ multiset extension _ of @xmath35 ( denoted by @xmath254 ) is the transitive closure of @xmath252 .",
    "based on the results in and definition  [ def : multiset](1 ) we have proven these two definitions equivalent for any transitive base relation .",
    "[ lem : mult ] if @xmath35 is transitive then @xmath254 and @xmath41 coincide .",
    "moreover we proved the claim in definition  [ def : multiset ] .",
    "[ lem : multeq ] we have that @xmath43 is the reflexive closure of @xmath41 .",
    "first we show the inclusion from left to right .",
    "let @xmath213 . if @xmath255 then @xmath256 and the result follows .",
    "if @xmath44 then @xmath257 and we are done .    for the reverse inclusion let @xmath258 be in the reflexive closure of @xmath41 . if @xmath256 then we finish with @xmath259 , @xmath260 .",
    "in the other case we get suitable @xmath15 , @xmath16 , and @xmath17 from the definition of @xmath41 .",
    "our formalization is first performed for sequences ( of labels ) and then lifted to labeled rewrite sequences ( conversions ) , a step which is left implicit in  @xcite . after introducing labeled rewriting , we proved useful results in isabelle ( lemmata  [ lem : seq ] and  [ lem : conv ] ) .",
    "in addition to the algebraic proof of lemma  [ lemma2_6](3 ) from  @xcite our formalization contains an alternative one .",
    "our proof of  lemma  [ lemma3_2](1 ) differs from the informal one in  @xcite .",
    "also the formal proof of lemma  [ proposition3_4 ] differs from the sketch given for ( * ? ? ?",
    "* proposition  3.4 ) , requiring auxiliary results ( lemmata  [ proposition3_4_aux ] and  [ proposition3_4_inv_aux ] ) .",
    "there are some ( tiny ) differences between  ( * ? ? ?",
    "* theorem  3.7 ) and lemma  [ lem : ld_imp_d ] . in @xcite a measure on",
    "_ diagrams _ is used . however , since the closing / joining steps of the diagram are just obtained by the induction hypothesis the measure must be on _ peaks _ ( which is used in  @xcite ) . moreover , since in either case the measure is a multiset it is hard to relate arbitrary multisets to a peak .",
    "hence we lifted the order on labels @xmath35 to peaks @xmath179 ( section  [ for : mr ] ) and used well - founded induction on this order . in the formalization of lemma  [ lem : ld_imp_d ] ( footnote  [ foot ] )",
    "we identified a necessary step to apply the induction hypothesis .",
    "another aspect where our formalization deviates from  @xcite is that the original work uses families of labeled arss whereas our formalization considers a single labeled ars only .",
    "hence ( * ? ? ?",
    "* theorem  3.7 ) states the main result on families of arss whereas our lemma  [ lem : ld_imp_d ] makes a statement about a single ars .",
    "concerning  @xcite our formal proofs for the alternative formulation of local decreasingness ( lemma  [ proposition3_4 ] ) differs from the one in  @xcite . while this alternative formulation of local decreasingness was not needed to obtain the main result underlying the valley version ( ( * ? ? ?",
    "* main  theorem  3.7 ) ,",
    "i.e. , lemma  [ lem : ld_imp_d ] ) , it was ( in a generalized formulation ) essential for the main result underlying the conversion version ( ( * ? ? ? * theorem  3 ) , i.e. , lemma  [ lem : main : conv ] ) .",
    "furthermore we gave formal proofs for two ( informal ) key observations made in the proof of  ( * ? ? ?",
    "* theorem  3 ) , resulting in lemmata  [ lem : key1 ] and  [ lem : key2 ] . especially the latter has a non - trivial formal proof , since the induction hypothesis yields decreasingness ( see figure  [ fig : key2a ] ) but not the desired decomposition of the joining sequences ( see figure  [ fig : key2b ] ) , in contrast to what the proof in @xcite conveys .",
    "in this paper we have described a formalization of decreasing diagrams in the theorem prover  isabellefollowing the original proofs from  @xcite . in sections  [ for : ld ] and [ for : rew ] our formal proofs deviate from the either informal or implicit ones in  @xcite and we also elaborate on lemma  [ lem : key2 ] , a result which is implicitly used in  @xcite . to show the applicability of our formalization we performed a mechanical proof of newman s lemma using decreasing diagrams ( following  ( * ? ? ? * corollary  4.4 ) ) .",
    "our formalization has few dependencies on existing theories . from",
    "we employ some properties for unlabeled abstract rewriting ( and the definition of confluence ) .",
    "the theory provides standard multiset operations and a well - foundedness proof of the multiset extension of a well - founded relation .",
    "note that some of our results on multisets ( a formalized proof of  ( * ? ? ?",
    "* lemma  2.6(3 ) ) , i.e. , lemma  [ lemma2_6](3 ) ) might be of interest for a larger community .    in  @xcite a `` point version '' of decreasing diagrams",
    "is introduced , where objects are labeled instead of steps .",
    "it is unknown if the point version is equivalent to the standard one .",
    "parts of  @xcite have been formalized in coqbut 29 axioms are assumed , i.e. , not proven in the theorem prover .",
    "furthermore the more useful alternative representation of local decreasingness ( lemma  [ proposition3_4 ] ) is not considered in  @xcite .",
    "the same holds for the conversion version .",
    "hence  @xcite is only a _ partial _ formalization and essentially different from ours .",
    "we anticipate that our contribution paves the way for future work in several directions .",
    "one possibility is the formalization of confluence results that can be proven with decreasing diagrams ( e.g.  toyama s theorem  @xcite ) .",
    "the benefit might be two - fold .",
    "on the one hand side the proof by decreasing diagrams might be easier to formalize and furthermore proofs by decreasing diagrams are constructive , cf .",
    "another idea would be the certification of confluence proofs ( based on decreasing diagrams ) given by automated confluence provers .",
    "both aims require to lift our formalization from abstract rewriting to term rewriting , which is a natural idea for future work .    _",
    "acknowledgments : _ this research is supported by fwf p22467 . we thank the anonymous reviewers , bertram felgenhauer , nao hirokawa , and aart middeldorp for helpful comments .",
    "bertram felgenhauer contributed an initial proof of lemma  [ lemma2_6](3 ) and located the formalization of  @xcite .",
    "10    bezem , m. , klop , j. , v.  van oostrom : diagram techniques for confluence .",
    "i&c 141(2 ) , 172204 ( 1998 )    bognar , m. : a point version of decreasing diagrams . in : proceedings accolade 1996 .",
    "dutch graduate school in logic .",
    "pp . 114 ( 1997 ) .",
    "the formalization is available from http://web.archive.org/web/20051226052550/http://www.cs.vu.nl/~mirna/    contejean , e. , courtieu , p. , forest , j. , pons , o. , urbain , x. : automated certified proofs with cime3 . in : proc .",
    "lipics , vol .",
    "10 , pp . 2130 ( 2011 )    dershowitz , n. , manna , z. : proving termination with multiset orderings .",
    "acm 22(8 ) , 465476 ( 1979 )    felgenhauer , b. : a proof order for decreasing diagrams . in : proc .",
    "714 ( 2012 )    galdino , a. , ayala - rincn , m. : a formalization of newman s and yokouchi s lemmas in a higher - order language .",
    "jfr 1(1 ) , 3950 ( 2008 )    galdino , a. , ayala - rincn , m. : a formalization of the knuth - bendix(-huet ) critical pair theorem . jar 45(3 ) , 301325 ( 2010 )    huet , g. : residual theory in lambda - calculus : a formal development .",
    "jfp 4(3 ) , 371394 ( 1994 )    jouannaud , j.p . , van oostrom , v. : diagrammatic confluence and completion . in : proc .",
    "36th icalp .",
    "lncs , vol . 5556 , pp .",
    "212222 ( 2009 )    klop , j. , van oostrom , v. , de  vrijer , r. : a geometric proof of confluence by decreasing diagrams .",
    "jlp 10(3 ) , 437460 ( 2000 )    nipkow , t. : more church - rosser proofs .",
    "jar 26(1 ) , 5166 ( 2001 )    nipkow , t. , paulson , l. , wenzel , m. : isabelle / hol  a proof assistant for higher - order logic . vol .",
    "2283 of lncs .",
    "springer ( 2002 )    , v. : confluence by decreasing diagrams .",
    "tcs 126(2 ) , 259280 ( 1994 )    , v. : confluence for abstract and higher - order rewriting .",
    "phd thesis , vrije universiteit , amsterdam ( 1994 )    , v. : confluence by decreasing diagrams  converted . in : proc .",
    "lncs , vol . 5117 , pp .",
    "306320 ( 2008 )    , v. : modularity of confluence constructed . in : proc .",
    "4th ijcar .",
    "lncs , vol . 5195 ,",
    "pp . 348363 ( 2008 )",
    "van oostrom , v. : decreasing proof orders  interpreting conversions in involutive monoids . in : proc .",
    "14 ( 2012 )    pfenning , f. : a proof of the church - rosser theorem and its representation in a logical framework .",
    "technical report cmu - cs-92 - 186 , school of computer science , carnegie mellon university ( 1992 )    ruiz - reina , j.l . ,",
    "alonso , j.a . ,",
    "hidalgo , m.j .",
    ", martn - mateos , f.j . : formal proofs about rewriting using acl2 .",
    "amai 36(3 ) , 239262 ( 2002 )    shankar , n. : a mechanical proof of the church - rosser theorem .",
    "jacm 35(3 ) , 475522 ( 1988 )    sternagel , c. , thiemann , r. : abstract rewriting .",
    "afp ( 2010 )    stvring , k. : extending the extensional lambda calculus with surjective pairing is conservative .",
    "lmcs 2(2 ) , 14 pages ( 2006 )    takahashi , m. : parallel reductions in @xmath0-calculus .",
    "i&c 118(1 ) , 120127 ( 1995 )    terese : term rewriting systems .",
    "55 of cambridge tracts in theoretical computer science .",
    "cambridge university press ( 2003 )    thiemann , r. : certification of confluence proofs using ceta . in : proc .",
    "( 2012 )    toyama , y. : on the church - rosser property for the direct sum of term rewriting systems .",
    "jacm 34(1 ) , 128143 ( 1987 )    zankl , h. : confluence by decreasing diagrams  formalized .",
    "corr abs/1210.1100v2 , 15 pages ( 2013 )",
    "definition  [ def : multiset ] can easily be mimicked in isabelle(here // defines the down - set for a set / multiset / list ) : by within code listings . ]",
    "definition decreasing::``a rel @xmath261 a list @xmath261 a list @xmath261 a list @xmath261 a list @xmath261 bool '' where `` decreasing r @xmath22 @xmath21 @xmath21 @xmath22 = ( ( r|@xmath21@@xmath22| , r|@xmath22| + r|@xmath21| ) @xmath263 mult_eq r @xmath264 ( r|@xmath22@@xmath21| , r|@xmath22| + r|@xmath21| ) @xmath263 mult_eq r ) ''    in the sequel objects will have type and labels will have type . a labeled rewrite step carries the label between its two objects and is hence of type .",
    "a labeled ars is a set of labeled rewrite steps .",
    "inductive_set seq : : `` ( a,b ) lars @xmath261 ( a,b ) seq set '' for @xmath157 where `` ( a , [ ] ) @xmath263 seq @xmath157 '' | `` ( a,@xmath19,b ) @xmath263 @xmath157 @xmath267 ( b , ss ) @xmath263 seq @xmath157 @xmath267 ( a,(@xmath19,b ) # ss ) @xmath263 seq @xmath157 ''        from now on we use @xmath22 , @xmath21 , etc .  also to denote ( labeled rewrite ) sequences in isabelle .",
    "the type information clarifies if labels or rewrite sequences are meant .",
    "we mimic definition  [ def : diagram ] in isabelle .",
    "definition diagram : : `` ( a,b ) lars @xmath261 ( a,b ) seq @xmath266 ( a,b ) seq @xmath266 ( a,b ) seq @xmath266 ( a,b ) seq @xmath261 bool '' where `` diagram @xmath157 d = ( let ( @xmath22,@xmath21,@xmath21,@xmath22 ) = d in @xmath21,@xmath22,@xmath21,@xmath22 @xmath85 seq @xmath157 @xmath264 fst @xmath21",
    "= fst @xmath22 @xmath264 lst @xmath21 = fst @xmath22 @xmath264 lst @xmath22 = fst @xmath21 @xmath264 lst @xmath21 = lst @xmath22 ) ''    next we introduce a function , which extracts the labels of a sequence , e.g. , @xmath268 $ ] . with the help of this function",
    "we can define a predicate , which holds if a quadruple of sequences forms a decreasing diagram .",
    "definition dd : : `` ( a,b ) lars @xmath261 b rel @xmath261 @xmath261 bool '' where `` dd @xmath157 r d = ( let ( @xmath22,@xmath21,@xmath21,@xmath22 ) = d in diagram @xmath157 d @xmath264 decreasing r ( labels @xmath22 ) ( labels @xmath21 ) ( labels @xmath21 ) ( labels @xmath22 ) ) ''            definition peak : : `` ( a,b ) lars @xmath261 ( a,b ) seq @xmath266 ( a,b ) seq @xmath261 bool '' where `` peak lars p = ( let ( @xmath22,@xmath21 ) = p in @xmath22,@xmath21 @xmath85 seq lars @xmath264 fst @xmath22 = fst @xmath21 ) ''    definition local_peak : : `` ( a,b ) lars @xmath261 ( a,b ) seq @xmath266 ( a,b ) seq @xmath261 bool '' where `` local_peak lars p = ( let ( @xmath22,@xmath21 ) = p in peak lars p @xmath264 length ( snd @xmath22 ) = 1 @xmath264 length ( snd @xmath21 ) = 1 ) ''    the following definition ( corresponding to definition  [ def : ld ] ) shows that the labeled version of @xmath156 can be chosen freely since we only demand the existence of a labeled version of @xmath156 satisfying decreasingness of all local peaks .",
    "definition ld : : `` b set @xmath261 a rel @xmath261 bool '' where `` ld l @xmath156 = ( @xmath262 r @xmath157 .",
    "( @xmath156 = unlabel @xmath157 ) @xmath264 trans r @xmath264 wf r @xmath264 ( @xmath269p .",
    "( local_peak @xmath157 p @xmath270 ( @xmath262 @xmath21 @xmath22. ( dd @xmath157 r ( fst p , snd p,@xmath21,@xmath22 ) ) ) ) ) ) ''",
    "inductive_set conv : : `` ( a,b ) lars @xmath261 ( a,b ) conv set '' for ars where `` ( a , [ ] ) @xmath263 conv ars '' | `` ( a,@xmath19,b ) @xmath263 ars @xmath267 ( b , ss ) @xmath263 conv ars @xmath267 ( a,(true,@xmath19,b ) # ss ) @xmath263 conv ars '' | `` ( b,@xmath19,a ) @xmath263 ars @xmath267 ( b , ss ) @xmath263 conv ars @xmath267 ( a,(false,@xmath19,b ) # ss ) @xmath263 conv ars ''"
  ],
  "abstract_text": [
    "<S> this paper presents a formalization of decreasing diagrams in the theorem prover isabelle . </S>",
    "<S> it discusses mechanical proofs showing that any locally decreasing abstract rewrite system is confluent . </S>",
    "<S> the valley and the conversion version of decreasing diagrams are considered . </S>"
  ]
}