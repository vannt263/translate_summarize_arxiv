{
  "article_text": [
    "the problem of sampling complex energy surfaces , characterized by metastable states separated by large energy barriers , has recently received considerable attention . a list that is by no means exhaustive of the possible remedies suggested includes transition path sampling  @xcite , umbrella sampling  @xcite , local elevation  @xcite , wang - landau  @xcite , adaptive biasing force  @xcite , metadynamics  @xcite and self healing umbrella sampling  @xcite .",
    "we focus here on metadynamics ( metad )  @xcite . in this approach one",
    "starts by identifying a set of appropriately chosen collective variables @xmath0 which are function of the microscopic variables @xmath1 . in order to accelerate sampling ,",
    "a bias potential is dynamically added during the simulation .",
    "the bias has the effect of helping the system to overcome large free - energy barriers so as to accelerate sampling .",
    "asymptotically , the negative of the bias provides an estimate of the free energy @xmath2 associated with the collective variable @xmath0 .",
    "the estimate has been demonstrated to be free of systematic errors , if the cvs are properly chosen  @xcite .",
    "metadynamics has been successfully used in several different contexts , for a recent review see for instance ref .",
    "@xcite . in most cases",
    "the bias is constructed by periodically adding a repulsive gaussian potential  @xcite which is a function of the @xmath0 .",
    "this implies defining the height and width of the gaussians .",
    "the first is related to the energy deposition rate while the latter is taken small enough to resolve the free - energy surface features .",
    "prescriptions on how to choose these parameters have been given and the dependence of the statistical error on their choice has been discussed  @xcite .",
    "still one is not guaranteed _ a priori _ of making the best choice .",
    "more recently , a new flavor of metadynamics has been introduced which goes under the name of well - tempered metadynamics ( wtmetad).@xcite in wtmetad the speed at which the bias is added decreases during the simulation .",
    "wtmetad maintains the property that the asymptotic bias is related to @xmath2 by a simple relation but , at variance with standard metadynamics , the final free - energy estimate converges to a definite limit .",
    "a useful property of wtmetad is that the dependence of the final result on the speed with which the bias grows is smaller than in standard metadynamics  @xcite , reducing the impact of an improper choice of this parameter .",
    "here we want to move further towards making the method even more efficient and robust with respect to parameters choice .",
    "a natural step in this direction is to add the possibility of adapting the gaussian width to the local free energy so as to speedup sampling .",
    "for instance a free - energy surface may present minima with rather different curvature and a gaussian width optimal for one might be not appropriate for another ( see supplementary information , section  [ sec : supplementary ] ) .",
    "this problem is amplified in the case of cvs that are are highly non - linear functions of the atomic coordinates .    in the past",
    "this need was recognized .",
    "therefore _ ad hoc _",
    "solutions for speeding up free - energy surface exploration were developed @xcite and some form of metadynamics that uses adaptive gaussians was implemented in publicly available codes @xcite .",
    "very recently tribello _ et al _",
    "@xcite also used adaptive gaussians in a related but distinct context .",
    "however , the effect of these choices on the free - energy reconstruction has never been systematically investigated .",
    "another common assumption in multidimensional metad simulations is to adopt gaussian functions whose axes are aligned to the chosen cvs , i.e.  with a diagonal covariance matrix .",
    "this is clearly a simplification which reduces the number of input parameters , but an optimal choice might require gaussian axes which are not aligned to the cvs .",
    "this was pointed out in ref .",
    "@xcite and successively has been used for crystal - structure prediction  @xcite .    in this paper",
    ", we discuss the possibility of performing metadynamics simulations using multivariate gaussian potentials with a full covariance matrix computed on the fly .",
    "we first introduce two possible different schemes for choosing the shape and width of the gaussian potentials .",
    "one is dynamical and based on the mean square displacement of the cvs in a predetermined time interval .",
    "the other is geometrical and based on the local mean square displacement of the cvs due to a hypothetical change in the microscopic coordinates .",
    "subsequently we observe that the adoption of either of these two position - dependent covariances requires modifying the free - energy estimator in order to reconstruct accurately the free - energy landscape .",
    "furthermore , we show that this new scheme applies also when the added gaussian potentials or some other chosen form of potentials are coarser than the underlying free energy .",
    "the algorithms and their efficiency are numerically tested in the standard case of alanine dipeptide in vacuum .",
    "details of the simulations and error calculations are discussed in the appendix .",
    "in metad , a time - dependent bias potential @xmath3 is used to discourage the system from visiting already explored regions in the cvs space @xcite . at the beginning of the simulation",
    "the bias is everywhere equal to zero .",
    "subsequently it is evolved according to the following expression : @xmath4 where @xmath5 is a short - ranged kernel function .",
    "here @xmath6 is an energy which can be used to tune the region of free energy explored , and @xmath7 is the initial filling rate .",
    "it has been shown in ref .",
    "@xcite that for large times the bias is related to the free energy by @xmath8~.\\ ] ] where @xmath9 does not depend on @xmath0 .",
    "we notice here that even if @xmath9 eventually diverges , its impact on the result is completely irrelevant as it disappears in any free - energy difference calculation .",
    "the limiting behavior of @xmath9 is discussed in section  [ sec : bias - divergence - law ] .",
    "these two expressions covers both the case of wtmetad@xcite ( where @xmath6 is finite and is an additional tuning parameter ) and non - wtmetad@xcite , which is simply recovered in the limit @xmath10 and corresponds to the case where the filling rate is kept constant during the simulation .",
    "the properties of equation  [ eq : wt - delta ] were extensively discussed in ref .",
    "equation  [ eq : fes - wt ] is of practical use since it offers an estimate of the free energy up to an arbitrary constant if one assumes its validity also at finite time @xmath11~.\\ ] ]    in most practical applications , the kernel @xmath5 of equation  [ eq : wt - delta ] has been replaced by a smooth function of the cvs , typically a product of one dimensional gaussians .",
    "we choose here a generic multivariate gaussian function : @xmath12\\sigma_{ij}^{-2}[s_j - s_j(t)]\\right ) .\\end{gathered}\\ ] ] here , @xmath13 determines the shape of the gaussian potential . in conventional metad simulations ,",
    "@xmath13 have almost always been assumed diagonal with only few exceptions @xcite .",
    "we stress once again that in all these cases metad was not employed to estimate the underlying free energy , but only to speedup the exploration of configuration space and no attention has been paid to the effect of these protocols on the free - energy reconstruction .    passing from a diagonal @xmath13 to a non - diagonal",
    "one increases the number of parameters that have to be chosen when setting up the simulation , so that it would be convenient to give a prescription that simplifies this choice . in standard",
    "metad the diagonal elements of @xmath13 are obtained by computing the cv standard deviation during a short preliminary simulation .",
    "a simple extension is to consider also the correlation between different variables    @xmath14    this choice is completely invariant with respect to an arbitrary linear transformation in the cv space and reduces to a diagonal @xmath13 by a suitable transformation @xcite .",
    "in addition it allows easy mixing of cvs of different units and nature .",
    "however an optimal @xmath13 over the entire cvs domain requires that is made position dependent .",
    "thus we shall still use equation  [ eq : cov ] to estimate the gaussian covariance but , in the same spirit of ref .",
    "@xcite  , we shall give a time dependent estimation of @xmath15 so as to reflect the local properties of the free energy .",
    "we finally note that the use of equation  [ eq : cov ] still preserves the property of invariance relative to linear combination of the @xmath0 variables .",
    "however , the covariance matrix can not be reduced to a diagonal form everywhere by means of a single linear transformation of the cvs since the matrices @xmath13 at different times or positions can not be expected in general to commute .      to define a time - dependent adaptive covariance at time @xmath16",
    "we compute the average value of the cvs and all the elements of the covariance matrix from the last part of the trajectory .",
    "the center of the gaussian is placed at the computed average value . to select the segment of trajectory over which we perform the average we found convenient to introduce an exponential weighting function with characteristic decay time @xmath17 , such that the gaussians centers @xmath18 and their covariances at time @xmath16 are given by : @xmath19 and @xmath20[s_j(t^{\\prime})-\\bar s_j(t^{\\prime } ) ] \\ e^{-(t - t^{\\prime})/\\tau_d}. \\label{eq : expavg_fluct}\\ ] ] with this choice",
    "the gaussian location and covariance change smoothly and can be very easily evaluated . to this effect",
    "we take the time derivative of equation  [ eq : expavg ] and equation  [ eq : expavg_fluct ]    @xmath21    @xmath22[s_j(t)-\\bar{s}_j(t)]-\\sigma^2_{ij}(t)}{\\tau_d } \\label{eq : expavg_fluct_der}\\ ] ]    and then consider @xmath23 and @xmath24 as additional variables to be evolved together with the system dynamics",
    ". integrating equation  [ eq : expavg_der ] and equation  [ eq : expavg_fluct_der ] with the initial conditions @xmath25 and @xmath26 the values of @xmath23 and @xmath24 as defined by equation  [ eq : expavg ] and equation  [ eq : expavg_fluct ] are recovered .",
    "we name this scheme _ dynamically - adapted _ ( da ) . using partial time averages to determine @xmath27 is somewhat natural and it has the practical benefit that only one parameter @xmath17 determines the whole covariance matrix .    within this scheme",
    "@xmath17 determines the time window which is used to estimate the cv fluctuations and thus to choose the gaussian width .",
    "it is instructive to see how the latter depends on the dynamical properties of the system at least in the simplified case of langevin dynamics ( see example in the supplementary information , section  [ sec : supplementary ] ) . in this case , two regimes can be identified , for short and long value of the simulation time . at the beginning of the simulation",
    "the dynamics is still stuck in the metastable minima .",
    "if @xmath17 is larger than the typical autocorrelation time of the cv the gaussian shape will be equal to the shape of the corresponding free - energy minimum , thus providing an optimal filling . at the end of the simulation , when the barriers have been smoothed out by the adaptive bias ,",
    "the dynamics is close to a free diffusion , with a diffusion coefficient which is possibly position dependent .",
    "simple dimensional considerations can be used to show that the computed @xmath28 matrix becomes proportional to the position - dependent diffusion tensor @xmath29 , which has a relevant role in describing many important phenomena.@xcite      we shall now discuss an alternative protocol for choosing the @xmath30 matrices .",
    "our starting point will be again equation  [ eq : cov ] . for small displacements of the microscopic variables",
    "@xmath1 the associated change in each cv can be linearly approximated as @xmath31 then in this approximation it can be easily seen that the cvs covariance is linearly related to that of the atomic displacements @xmath32 . if we assume these to be gaussian distributed with standard deviation @xmath33 we have @xmath34 leading to @xmath35 we use this expression to define the shape of the gaussian covariance via the gram matrix : @xmath36 with this choice , @xmath37 depends explicitly on the microscopic variables @xmath1 .",
    "we shall refer to this case as _ geometry - adapted _ ( ga ) .",
    "as in the da case only one parameter suffices to determine the whole covariance matrix .",
    "we note that in metad the gaussian spread plays a role similar to that of the histogram bin size for other methods and determines which configurations are considered as equivalent .",
    "thus here we are assuming as equivalent all the microscopic configurations whose a root square distance of the atoms involved in the cvs is within @xmath33 making possible for the choice of @xmath33 to be guided by physical considerations .",
    "for instance , if one were to choose a different set of cvs still the choice of sigma would be determined by the typical atomic displacements .",
    "similarly to the da scheme , the ga one is invariant with respect to linear transformations of the cvs .",
    "one of the most interesting features of metadynamics is the link it establishes between the free - energy surface and the bias both in its classical and well - tempered versions .",
    "having changed the protocol of gaussians deposition it is crucial to establish such a link in the case of gaussians of variable covariance .",
    "we consider first the case in which the gaussians have a size smaller than the relevant features in the free - energy surface , as normally done in metad .",
    "this was the assumption of ref .",
    "@xcite where one went as far as to assimilate the gaussians to @xmath38 functions .    within our schemes",
    "this limit can be achieved by choosing @xmath17 or @xmath33 small enough . in this regime , for the da scheme , one can also neglect the difference between the actual position @xmath0 and the center of the deposited gaussian @xmath39 .",
    "therefore the only adjustment necessary is to take into account the fact that the change in covariance induces a change in gaussians volume .",
    "thus in equation  [ eq : wt - delta ] we replace the kernel @xmath5 with a dirac delta with the same normalization , @xmath40 , where @xmath30 is either a function of the trajectory in cvs space ( da scheme ) or of the microscopic coordinates at a specific time ( ga scheme ) and @xmath41 is the number of cvs : @xmath42 as in ref .",
    "@xcite , we notice that for large times the probability distribution becomes @xmath43 and one has @xmath44/t}\\end{gathered}\\ ] ] where the average @xmath45 is taken in the canonical ensemble at a fixed value of the gaussian center .",
    "now , setting @xmath46 in the last equation , where @xmath9 is constant with respect to the cvs , we find that the asymptotic solution for @xmath3 is @xmath47 + c(t)~. \\label{eq : bias - new}\\ ] ] this means that the bias is no longer proportional to @xmath2 as in equation  [ eq : fes - wt ] but rather to @xmath48 in the case of ga scheme of section  [ sec : geometry - adapted - gaussian ] , @xmath49 turns out to be the gauge invariant free - energy discussed in refs .",
    "@xcite which is not changed by an arbitrary non - linear monotonic transformation of the cvs . instead in the da case of section  [ sec : diffusion - adapted - gaussian ] when @xmath17 is chosen so that @xmath30 is proportional to the diffusion matrix , our bias potential is closely connected with that used in flux - tempered metadynamics @xcite which is also gauge invariant and has been designed to optimize the round trip time .",
    "while gauge invariance is esthetically pleasing it does not bring particular advantages since for physical applications it is @xmath2 that is needed .",
    "this can be simply obtained by rewriting equation  [ eq : bias - new ] as @xmath50+t\\ln\\langle \\det\\sigma \\rangle_{s}\\ ] ] which is the appropriate generalization of equation  [ eq : fes - wt ] to the case of small adaptive gaussians .      as discussed in the previous sections , for non - standard biasing protocols the relationship between the asymptotic bias and the underlying free - energy landscape",
    "is not known _",
    "a priori_. only in the small width limit it is possible to estimate explicitly the correction of equation  [ eq : fes - geometric ]",
    ". however it would be nice to have an estimator that is valid for large gaussians .",
    "this is provided by the relation : @xmath51 where @xmath52 is the accumulated histogram of the variable @xmath0 up to time @xmath16 .",
    "if the bias is time - independent this relation is strictly true and is normally used in umbrella sampling . in this present context",
    "it is valid only for large times when @xmath3 has converged .",
    "more precisely it is only necessary that the rate of bias deposition goes to zero sufficiently rapidly",
    ". therefore it will be valid whether the gaussian width is small or large and whether the width is determined by diffusion or geometry .",
    "this relation was also used in deriving a free - energy estimator for wtmetad  @xcite where this expression was manipulated in a manner similar to section  [ sec : small - width - limit ] leading to the estimator in equation  [ eq : fes - old - estimator ] .",
    "however , @xmath53 is more generally valid and gives a correct estimate of free energy even when adaptive gaussians are used . in the following",
    "we will show how this new estimator can be of use in a practical case .",
    "the case of non - wt metadynamics ( i.e. for @xmath54 ) where the bias oscillates in the long time limit needs separate consideration and will be discussed elsewhere .",
    "and @xmath55 .",
    "this graphics was produced with vmd@xcite . ]    before discussing the performance of the adaptive gaussians we shall first validate the estimator of equation  [ eq : fes - estimator ] when using standard wtmetad and compare two very different choices of gaussian width . in this way we show that it is advantageous to use equation  [ eq : fes - estimator ] even when using gaussians with fixed covariance .    to this effect we performed a number of wtmetad simulations of alanine dipeptide in vacuum ( see figure  [ fig : diala ] ) using as collective variables the two ramachandran @xcite dihedral angles @xmath56 and @xmath55 .",
    "the initial gaussian height was chosen to be 0.287 @xmath57 and gaussian potentials were deposited every 120 fs , corresponding to an energy deposition rate of 2.39 @xmath58 .",
    "the @xmath6 parameter for wtmetad was set to 1200 k. other technical details can be found in section  [ sec : simulation - details ] .",
    "we first performed a long calculation to obtain a reference free - energy landscape .",
    "this was done in two steps : we performed a 5 ns long wtmetad run with a gaussian width @xmath30= 0.35 rad for both @xmath59 and @xmath60 and the bias thus accumulated was then kept constant in a long ( 1@xmath61s ) biased simulation .",
    "then , by using equation  [ eq : fes - estimator ] which is exact for a static bias , we obtained the reference free energy .",
    "the error of the reference landscape was estimated by comparing the free energy derived from the histogram from the first and the second half of the simulation and was obtained using the procedure reported in section  [ sec : error - estimate ] .",
    "the error is approximately 0.01 kcal mol@xmath62 , which is negligible as compared to the error of more than 0.05 kcal mol@xmath62 made in the test runs described below .",
    "we did not bin the @xmath0 to evaluate the histogram @xmath52 in equation  [ eq : fes - estimator ] but instead we used gaussian functions of width 0.01 rad .",
    "this led to a smooth @xmath52 and a smooth free energy as shown in figure  [ fig : panel_rama]a .",
    "we then performed two different sets of simulations using the same @xmath30 for both dihedral angles . in one case @xmath30 was smaller than the free - energy features ( @xmath30= 0.35 rad ) , in the other larger ( @xmath30= 0.7 rad ) .",
    "each set of simulations consisted of 100 wtmetad runs of 20 ns each .",
    "the error relative to the reference free energy committed using the standard estimator of equation  [ eq : fes - old - estimator ] and the new one in equation  [ eq : fes - estimator ] was then compared .    from figure",
    "[ fig : small_vs_big ] it can be seen that in all cases the new estimator produces consistent results and the expected asymptotic @xmath63 behavior .",
    "the old one works well for small gaussians but in the case of the large ones is affected by a systematic error , due to the fact that it is not able to resolve the smaller features of the free energy landscape .     of equation  [ eq : fes - estimator ] for two different choices of @xmath30",
    "is compared to the choice of @xmath64 of equation  [ eq : fes - old - estimator ] .",
    "it is possible to appreciate that equation  [ eq : fes - estimator ] always delivers results that are comparable to the equation  [ eq : fes - old - estimator ] or better , when large gaussians are adopted . in the inset",
    "it is shown the time dependence of the error that decreases linearly with @xmath65 predicting an error that goes to zero for infinite time .",
    "on the contrary , for large gaussians , the standard estimate is not able to resolve the features of the free energy resulting in a significant residual error even for infinite time . ]",
    "having assessed the usefulness of equation  [ eq : fes - estimator ] we turn to the evaluation of the performance of gaussians of variable covariance using the da scheme .",
    "this requires defining the parameter @xmath17 that is a measure of the time required to sample two bins that we consider as different . in order to choose @xmath17 in a manner which allows a fair comparison of constant and variable gaussians covariance we performed a preliminary 1 ns of standard wtmetad with gaussians of a constant @xmath30=0.35 rad width",
    "we then tested different @xmath17 values and we choose the one that was able to fill on average the same volume deposited in the standard run . in this way we ensured that the system was subject to a comparable filling rate .",
    "this gave the value @xmath17= 300 fs .",
    "in analogy to the previous protocol , we performed 100 runs of 20 ns each and calculated the average error made in the region of free - energy surface which is within lowest 5 @xmath66 from the minimum of the reference surface .",
    "the results are displayed in figure  [ fig : err_phi_psi ] , where the failure of the old estimator of equation  [ eq : fes - old - estimator ] is evident .",
    "instead the new estimator gives correct results even when the covariance of the gaussians is let to vary .",
    "we now turn to a test of the ga scheme for the same system using an identical protocol .",
    "the choice of a comparable @xmath33 was performed as before imposing the condition of the same volume filling rate with respect to a preliminary standard wtmetad .",
    "this led to a value @xmath33 = 0.2   .",
    "the results are again displayed in figure  [ fig : err_phi_psi ] .",
    "the free energy calculated through @xmath64 of equation  [ eq : fes - old - estimator ] is expected to converge to the gauge invariant free - energy landscape , which is different from the standard one .",
    "thus , even for long times , there is a systematic residual error . on the other hand",
    ", the new estimator does give the correct result , with a convergence rate which is very similar to that obtained with the standard calculation reported in figure  [ fig : small_vs_big ] .     ) and da ( denoted with @xmath17 ) schemes for alanine dipeptide as a function of time .",
    "the average error was calculated through a set of 100 runs and averaged every 120 ps .",
    "two free - energy estimates are employed : the one of equation  [ eq : fes - estimator ] denoted with @xmath67 and the one of equation  [ eq : fes - old - estimator ] denoted with @xmath64 .",
    "the performance of equation  [ eq : fes - estimator ] is always superior to that of equation  [ eq : fes - old - estimator ] which is dramatically incorrect when da or ga are employed . in the inset",
    "it can be appreciated that the error scales linearly with @xmath65 as expected in wtmetad .",
    "the use of equation  [ eq : fes - estimator ] leads to the correct asymptotic behavior in contrast to equation  [ eq : fes - old - estimator ] . ]        in figure  [ fig : panel_rama]b , we give a pictorial view of the shape of the gaussian potentials obtained by using equation  [ eq : define - metric ] .",
    "we also report in figure  [ fig : panel_rama]c the correction due to the change in volume of the gaussians , which measures the error made by using the old estimator .",
    "it can be seen that in this case the maximum error is as small as  0.6 @xmath66 .",
    "however this is by no means generally the case as we shall see in the next section .",
    "we examine now the role that a different choice of collective variables might have on the error made by using the old estimator .",
    "while for the angle @xmath56 and @xmath55 the error was small we expect it to be larger when dealing with cvs that are strongly nonlinear functions of the atomic coordinates .",
    "one such example are for instance cvs that measure the mean square deviation ( msd ) from a reference structure or coordination functions that have sigmoidal dependence on the distance of two atoms or groups of atoms .",
    "thus we studied once again alanine dipeptide in vacuum and used as cvs the msd from the two conformers @xmath68 and @xmath69 rather than the two torsional angles .",
    "the msds were calculated through optimal alignment by using kearsley s algorithm @xcite and only the heavy atoms were considered in the metrics . in order to obtain reference values as accurate as possible rather than reweighting the configurations previously generated , we repeated the simulation with the same protocol as before .",
    "the result of this run which also lasted 1@xmath61s is shown in figure  [ fig : panel_msd]a where it can be seen that in these new variables the free energy surface has two minima one very narrow and the other wider .    by comparing figure  [ fig : panel_msd]b and figure  [ fig : panel_rama]b",
    "it is evident that the double msd space induces a much larger change in shapes and volumes of the deposited gaussian potentials .",
    "correspondingly the error made using the old estimator of equation  [ eq : fes - old - estimator ] becomes larger ( see figure  [ fig : panel_msd]c ) .",
    "the benefit of using variable gaussians becomes very apparent since we do not have to choose small gaussians to resolve the narrow minima paying the price of a slow convergence , nor do we have to use larger gaussians and sacrifice accuracy .",
    "this is exemplified in figure  [ fig : big_small_rmsd ] where we show the typical convergence behavior obtained by using the ga scheme of equation  [ eq : define - metric ] and compare it to fixed-@xmath30 runs , where @xmath30 was chosen to be appropriate either to the narrow minimum ( @xmath30=0.01 @xmath70 ) or to the larger one ( @xmath30=0.3 @xmath70 ) . using the new estimator all three calculation appear to converge to the same limit , but with different rates . for narrow gaussians ( @xmath30=0.01 @xmath70 )",
    "the calculation converges to the right limit albeit rather slowly . similarly for very large gaussians ( @xmath30=0.3 @xmath70 ) the convergence was very slow for reasons similar to those discussed earlier ( see section  [ sec : small_vs_large ] ) . when the ga scheme of section  [ sec : geometry - adapted - gaussian ] is chosen the asymptotic limit is reached faster and with a much smaller error .",
    ", 100 runs of 4 ns each were performed and the average error respect to the reference free energy was calculated as function of time .",
    "two different choices of @xmath30 are made and compared with the result obtained using the ga scheme with gaussian width @xmath33 .",
    "the ga scheme is always superior and converges faster to the correct value . ]",
    "in summary , we have investigated in detail the possibility of performing metadynamics simulations where the repulsive gaussian potentials have a width chosen on the fly and are not aligned with respect to the cvs .",
    "we have shown that using adaptive widths can lead to artifacts in the estimation of the free - energy landscape , which can be recovered by using a suitable estimator . moreover ,",
    "we have discussed two independent recipes to adapt the gaussian shape , one based on the time evolution of the collective variables and another based on the intrinsic metrics of the microscopic coordinates .",
    "both methods can be implemented using the same ingredients as standard metadynamics calculations , namely collective - variable values and first derivatives with respect to atomic positions .",
    "they are effective and have been shown to produce unbiased results on a standard benchmark .",
    "additionally they can remarkably improve the filling speed especially when collective variables which are highly non - linear functions for the atomic positions are used .",
    "this is particularly helpful for msd and msd - based variables @xcite or contact map - based variables which are widely employed for systems of biological and condensed matter interest . for such variables , the usual choice of the gaussian width fixed once and for all to the value of the cvs fluctuation measured in an initial unbiased run may in fact turn to be suboptimal whenever the system is far from its initial configuration . in this respect",
    "the gradient - adapted choice is of great help .",
    "these methods simplify the choice of the input parameters for a metadynamics simulation , significantly reducing the time which is usually spent in trial and errors .",
    "both approaches can be used with cvs which are bounded , either by their intrinsic definition or by artificially added potentials . in the latter case ,",
    "the version based on time evolution of the cvs might be more effective .",
    "finally , they both can be straightforwardly combined with versions of metad which are based on multiple replicas  @xcite .",
    "the work has been performed under the hpc - europa2 project ( project number : 228398 ) with the support of the european commission - capacities area - research infrastructures .",
    "g.b .  acknowledges miur grant `` firb - futuro in ricerca '' no .",
    "rbfr102py5 for funding .",
    "the relation between the absolute free energy and the bias [ equation  [ eq : fes - wt ] and equation  [ eq : fes - geometric ] ] contains a shift @xmath9 which does not depend on @xmath0 but grows with the time . as already noted , this constant is irrelevant in the calculation of free - energy differences .",
    "however , it is instructive to compute explicitly its behavior in the long time limit . in the following",
    "we shall do it in the small - width approximation , which is usually applied in the analysis of wtmetad simulations . according to equation  [ eq : wt - average ]",
    "the time derivative of the bias is @xmath71 as in the long time limit the bias grows uniformly in @xmath0 , its time derivative is equal to the one of @xmath9 . by combining equation  [ eq : v - dot ] and equation  [ eq : bias - new ]",
    "one obtains @xmath72 by solving the differential equation equation  [ eq : c - dot ] , it can be seen that @xmath9 diverges logarithmically with time as @xmath73 we underline that this is just the limiting behavior of @xmath9 . if its actual value is needed , for instance to align estimates of the free energy made at different times , the procedure illustrated in ref .",
    "@xcite could be used to estimate it .",
    "note however that in ref .",
    "@xcite a different sign convention is used .",
    "in all the simulations shown we employed alanine dipeptide ( ace - ala - nme ) in vacuum as a model system , with molecular interactions described by the charmm27@xcite force field . this system ( see figure  [ fig : diala ] ) is a widely known benchmark for free - energy calculations @xcite .",
    "indeed , it displays two main basins , namely @xmath68 and @xmath69 separated by a sizable barrier of several @xmath74 at 300k .",
    "a timestep of 2 fs was employed and all the covalent bonds involving an hydrogen atom were constrained to the equilibrium distance by means of shake@xcite algorithm . a langevin thermostat was used with a temperature of 300k and a damping factors of 5 @xmath75 .",
    "namd 2.8@xcite molecular dynamics code was used and modified to add the adaptive shape wtmetad capability .",
    "here we describe the procedure adopted to evaluate the error between two free - energy landscapes for the numerical examples reported in the main text .",
    "we first note that wtmetad for finite @xmath6 produces a more accurate histogram in low free - energy regions .",
    "therefore we selected a reference region in cvs space defined by those points lying within a value of @xmath76 free - energy units respect to the minimum of one of the free - energy surfaces , here termed reference free energy @xmath77 . in all the calculations performed the value of @xmath76 was set to be 5 @xmath57 .",
    "in particular , being @xmath2 the free - energy surface whose error is required and @xmath0 a point of the collective variables space , the error between the two surfaces is defined as : @xmath78 ^ 2 \\",
    "\\theta(v- f_r(s ) ) \\ d s } { \\int_{s}\\ \\theta(v-   f_r(s ) )   d s }   } .\\end{aligned}\\ ] ] here @xmath79 is the multidimensional space in which the calculation is performed , being @xmath56 and @xmath55 for the ramachandran plot , and @xmath80 is a heaviside step function .",
    "this equation amounts in calculating the average squared root difference between the two free energies @xmath81 and @xmath82 in the cvs space defined within @xmath76 @xmath57 from the minimum in the reference free energy @xmath81 .",
    "the @xmath81 is related to @xmath77 by a rigid shift of the free - energy surface respect to the average value in the reference region : @xmath83 and a similar relation holds for the other free energy @xmath2 where , for consistency , the reference region is again defined on the reference free energy @xmath84",
    "we want here to show how the need of using adaptive gaussians arises from a simple one - dimensional langevin model .",
    "consider an energy landscape composed by the sum of three gaussian potentials ( @xmath85=-1.5 , @xmath86=0.1 , @xmath87=-3 , @xmath88=1.5 , @xmath89=1.0 , @xmath90=-3 , @xmath91=0 , @xmath92=2.5 , @xmath93=-3 ) , namely : @xmath94 and a particle of unitary mass that moves in this potential with a temperature of 0.2 energy units .",
    "the timestep was set to 0.0025 time units and the friction was set to 0.8 inverse time units .",
    "the particle is initially placed in the rightmost minimum ( around 1.5 ) and the evolution is observed for @xmath95 steps of langevin dynamics . after this ,",
    "the standard deviation of the position is calculated and used as width ( @xmath96=0.26 ) for a well - tempered metadynamics ( wtmetad ) run during @xmath97 steps of dynamics .",
    "additional parameters for the wtmetad are a @xmath6=2.8 and a energy deposition rate of @xmath98 energy units / step . in figure",
    "[ large ] the result of this wtmetad is shown along with the model potential ( solid black line ) .",
    "a set of estimates of the underlying free - energy landscape ( identical to the potential energy in this one - dimensional case ) along the time of wtmetad run are reported and aligned to the value of potential energy of the rightmost minimum .",
    "it is evident that the @xmath96 which was suitable for the larger minimum is not suitable for the minimum on the left side thus seriously affecting both the free - energy difference between the minima as well as the barrier estimate .",
    "= 0.26 and stays constant along time . in solid",
    "black the energy profile of the model potential is reported . in color",
    "different estimates of the free - energy landscape along the wtmetad run are reported .",
    "all the free - energy profiles are aligned to the free - energy value of the rightmost minimum in the model potential . ]    on the contrary , in figure  [ taud ] we report results obtained by setting the @xmath96 equal to the displacement of the system in the last 250 steps of the langevin dynamics by means of our dynamical adapted algorithm ( see main text ) . here",
    "the narrow features of the free - energy are adequately resolved and the free - energy profiles and barrier result improved and present a faster convergence .",
    "is adapted to the displacement along the last @xmath17=250 steps of langevin dynamics . in solid",
    "black the energy profile of the model potential is reported .",
    "in color different estimates of the free - energy landscape along the wtmetad run are reported .",
    "all the free - energy profiles are aligned to the free - energy value of the rightmost minimum in the model potential . ]",
    "bolhuis ,  p. ; chandler ,  d. ; dellago ,  c. ; geissler ,  p. _ annu .",
    "chem . _ * 2002 * , _ 53 _ , 291318 torrie ,  g.  m. ; valleau ,  j.  p. _",
    "j.  comput .",
    "phys . _ * 1977 * , _ 23 _ , 187199 roux ,  b. _ comp .",
    "comm . _ * 1995 * , _ 91 _ , 275282 huber ,  t. ; torda ,  a.  e. ; van gunsteren ,  w.  f. _ j. comput .- aided mol . des . _ * 1994 * , _ 8 _ , 695708 wang ,  f. ; landau ,  d.  p. _ phys .",
    "lett . _ * 2001 * , _ 86 _ , 20502053 darve ,  e. ; pohorille ,  a. _ j.  chem .  phys . _ * 2001 * , _ 115 _ , 91699183 laio ,  a. ; parrinello ,  m. _ proc .",
    "* 2002 * , _ 99 _ , 1256212566 laio ,  a. ; rodriguez - fortea ,  a. ; gervasio ,  f.  l. ; ceccarelli ,  m. ; parrinello ,  m. _ j.  phys .",
    "b _ * 2005 * , _ 109 _ , 67146721 bussi ,  g. ; laio ,  a. ; parrinello ,  m. _ phys .",
    "_ * 2006 * , _ 96 _ , 090601 barducci ,  a. ; bonomi ,  m. ; parrinello ,  m. _ wiley interdiscip .",
    "sci . _ * 2011 * , _ 1 _ , 826843 marsili ,  s. ; barducci ,  a. ; chelli ,  r. ; procacci ,  p. ; schettino ,  v. _ j.  phys .",
    "b _ * 2006 * , _ 110 _ , 1401114013 barducci ,  a. ; bussi ,  g. ; parrinello ,  m. _ phys .",
    "lett . _ * 2008 * , _ 100 _ , 020603 iannuzzi ,  m. ; laio ,  a. ; parrinello ,  m. _ phys .",
    "_ * 2003 * , _ 90 _ , 238302 .",
    "http://www.cpmd.org/ , copyright ibm corp 1990 - 2008 , copyright mpi fr festkrperforschung stuttgart 1997 - 2000 tribello ,  g.  a. ; ceriotti ,  m. ; parrinello ,  m. _ proc .",
    "natl .  acad .",
    "* 2010 * , _ 107 _ , 1750917414 martok ,  r. ; donadio ,  d. ; oganov ,  a. ; parrinello ,  m. _ nat",
    ". mater . _ * 2006 * , _ 5 _ , 6236 martok ,  r. ; donadio ,  d. ; oganov ,  a. ; parrinello ,  m. _ phys .",
    "b _ * 2007 * , _ 76 _ , 14120 best ,  r. ; hummer ,  g. _ proc .",
    "_ * 2010 * , _ 107 _ , 1088 e ,  w. ; vanden - eijnden ,  e. in _ multiscale , modelling , and simulation _ ; attinger ,  s. , koumoutsakos ,  p. , eds .",
    "; springer , berlin , 2004 ; p 3568 vanden - eijnden ,  e. ; tal ,  f. _ j.  chem .",
    "* 2005 * , _ 123 _ , 184103 hartmann ,  c. ; schtte ,  c. _ phys .",
    "d _ * 2007 * , _ 228 _ , 5963 singh ,  s. ; chiu ,  c. ; de  pablo ,  j. _ j. stat .",
    "phys . _ * 2011 * , _ 145 _ , 932945 humphrey ,  w. ; dalke ,  a. ; schulten ,  k. _ j. molec . graphics _ * 1996 * , _ 14 _ , 3338 ramachandran ,  g.  n. ; ramakrishnan ,  c. ; sasisekharan ,  v. _ j. mol . biol . _",
    "* 1963 * , _ 7 _ , 95 kearsley ,  s.  k. _ acta cryst .",
    "* 1989 * , _ 45 _ , 208210 branduardi ,  d. ; gervasio ,  f.  l. ; parrinello ,  m. _ j.  chem .",
    "phys . _ * 2007 * , _ 126 _ , 054103 raiteri ,  p. ; laio ,  a. ; gervasio ,  f.  l. ; micheletti ,  c. ; parrinello ,  m. _ j.  phys .",
    "b _ * 2006 * , _ 110 _ , 35333539 bussi ,  g. ; gervasio ,  f.  l. ; laio ,  a. ; parrinello ,  m. _ j.  am .",
    "chem .  soc .",
    "_ * 2006 * , _ 128 _ , 1343513441 piana ,  s. ; laio ,  a. _ j.  phys .",
    "b _ * 2007 * , _ 111 _ , 45534559 bonomi .",
    ",  m. ; barducci ,  a. ; parrinello ,  m. _ j.  comp .",
    "chem . _ * 2009 * , _ 30 _ , 16151621 ,  a.  d. et  al .",
    "_ j. phys .",
    "b _ * 1998 * , _ 102 _ , 35863616 maragliano ,  l. ; fischer ,  a. ; vanden - eijnden ,  e. _ j. chem . phys . _ * 2006 * , _ 125 _ , 024106 lazaridis ,  t. ; tobias ,  d.  j. ; brooks ,  c. ; paulaitis ,  m.  e. _ j. chem . phys . _ * 1991 * , _ 95 _ , 76127625 tobias ,  d.  j. ; brooks ,  c.  l. _ j. phys .",
    "chem . _ * 1992 * , _ 96 _ , 38643870 bartels ,  c. ; karplus ,  m. _ j. comput .",
    "chem . _ * 1997 * , _ 18 _ , 14501462 apostolakis ,  j. ; ferrara ,  p. ; caflisch ,  a. _ j. chem .",
    "* 1999 * , _ 110 _ , 20992108 smith ,  p.  e. _ j. chem . phys . _ * 1999 * , _ 111 _ , 55685579 ryckaert ,  j.  p. ; ciccotti ,  g. ; berendsen ,  h. j.  c. _ j. comput .",
    "phys . _ * 1977 * , _ 23 _ , 327341 phillips ,  j.  c. ; braun ,  r. ; wang ,  w. ; gumbart ,  j. ; tajkhorshid ,  e. ; villa ,  e. ; chipot ,  c. ; skeel ,  r.  d. ; kal ,  l. ; schulten ,  k. _ j. comput .",
    "chem . _ * 2005 * , _ 26 _ , 1781802"
  ],
  "abstract_text": [
    "<S> metadynamics is an established sampling method aimed at reconstructing the free - energy surface relative to a set of appropriately chosen collective variables . in standard metadynamics </S>",
    "<S> the free - energy surface is filled by the addition of gaussian potentials of pre - assigned and typically diagonal covariance . </S>",
    "<S> asymptotically the free - energy surface is proportional to the bias deposited . </S>",
    "<S> here we consider the possibility of using gaussians whose variance is adjusted on the fly to the local properties of the free - energy surface . </S>",
    "<S> we suggest two different prescriptions : one is based on the local diffusivity and the other on the local geometrical properties . </S>",
    "<S> we further examine the problem of extracting the free - energy surface when using adaptive gaussians . </S>",
    "<S> we show that the standard relation between the bias and the free energy does not hold . in the limit of narrow gaussians </S>",
    "<S> an explicit correction can be evaluated . in the general case </S>",
    "<S> we propose to use instead a relation between bias and free energy borrowed from umbrella sampling . </S>",
    "<S> this relation holds for all kinds of incrementally deposited bias . </S>",
    "<S> we illustrate on the case of alanine dipeptide the advantage of using adaptive gaussians in conjunction with the new free - energy estimator both in terms of accuracy and speed of convergence . </S>"
  ]
}