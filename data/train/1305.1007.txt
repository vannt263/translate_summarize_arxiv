{
  "article_text": [
    "magic ( major atmospheric gamma imaging cherenkov , @xcite ) is a system of two imaging atmospheric cherenkov telescopes ( iacts , @xcite ) , each equipped with a mirror dish of 17@xmath0 m diameter .",
    "magic is located on the canary island of la palma at the height of 2200 m a.s.l .",
    "the telescopes are built to measure gamma rays in the energy range from about 50 gev to 50 tev by detection of short and weak cherenkov light flashes from the extensive air showers .",
    "this requires fast time response and high sampling rate of the system in order to decrease the exposure to noise .",
    "presently both telescopes are using a readout based on the domino ring sampler version 4 chip ( drs4 )  @xcite operated at a sampling speed of 2 gsamples / s .",
    "such sampling speeds , larger than in other iacts  @xcite , are used in magic since 2007 , and allow us to exploit the timing information in recordered showers .",
    "another presently operating iact using the drs4 chip in its readout , is fact  @xcite .",
    "in addition , the drs4 is the heart of the dragon system @xcite , one of the possible readout systems considered for the next generation major iact project called cherenkov telescope array ( cta ,  @xcite ) . among",
    "the other analogue memories which are considered for the readout of cta are target @xcite and nectar @xcite .    in this paper",
    ", we describe the pre - processing analysis procedures used to extract and calibrate the signal in each channel of the magic telescopes .",
    "we also evaluate the performance of the basic parameters of the signal extraction .",
    "in addition , we describe methods used in the analysis of the data taken with the previous readout ( based on the drs2 chip , @xcite ) of the magic  ii telescope . the older readout systems of the magic  i telescope are described in detail in  @xcite .",
    "very high energy ( vhe , @xmath1gev ) gamma rays entering the atmosphere produce cascades of secondary particles .",
    "the charged particles moving faster than the propagation speed of light in the atmosphere will produce very short ( of the order of @xmath2ns ) flashes of optical and uv light ( the so - called cherenkov radiation , @xcite ) .",
    "this light is emitted in a narrow cone with small half - opening angles of @xmath3 and illuminates an area on the ground with a radius of about @xmath4 m .",
    "iacts , such as the magic telescopes , can focus the cherenkov light onto the camera composed of the order of @xmath5 individual photodetectors ( pixels ) .",
    "until summer 2012 the cameras of the magic  i and magic  ii telescopes were equipped with 577 and 1039 photomultipliers ( pmts ) , respectively . at that time",
    "the magic  i camera was equipped with two kinds of pixels : 397 smaller , inner pixels with a fov of @xmath6 , and 180 larger , outer pixels with a fov of @xmath7 @xcite .",
    "the magic  ii camera is composed only of smaller pixels .",
    "the full electronic chain of the magic telescopes is schematically shown in fig .",
    "[ fig : chain ] .        the electrical signal from each pixel is converted into an optical one using a vertical - cavity surface emitting laser ( vcsel ) diode in the camera @xcite .",
    "afterwards it is transmitted , still as an analog signal , via an optical fiber to the control house hosting the readout electronics .",
    "the signal then arrives to the so - called receivers where it is converted back into an electrical pulse and split into a trigger and readout branches . between february 2007 and june 2011 ,",
    "the magic  i readout was based on optical multiplexer and off - the - shelf fadcs  @xcite . the second magic telescope , in operation since 2009 ,",
    "was first equipped with the domino ring sampler version 2 chip ( drs2 ,  @xcite ) . during the first stage of the magic upgrade in 2011 ,",
    "both telescopes were equipped with a readout based on the drs4 chip @xcite . in a second stage of the upgrade , the camera of magic",
    "i has been replaced by a close copy of the one presently installed in magic  ii .",
    "as bigger outer pixels covered only the outer part of one of the magic cameras and in the present system there are only small pixels , in this paper we concentrate on those .    the drs4 readout system is based on an array of 1024 capacitors for each channel . when running the system with a sampling speed of 2 gsamples / s , the input signal is stored in the analog form in the capacitors with a switching period of 500 ps , which results in a 512 ns deep buffer .",
    "after a trigger occurs , the sampling is stopped and the charges of the capacitors are read out by an adc of 14bit precision at a speed of 32 mhz @xcite . the studies presented in this paper are based on data in which the waveforms for a time span of 40 ns ( 80 samples ) around the pulse position ( the so - called region of interest , roi ) were stored for each event and each pixel . very recently the number of saved samples have been reduced to 60 . with this sampling range , even large showers with long time development",
    "are contained in the readout time window .",
    "such a readout window also ensures that the pulses will not be truncated due to the jitter or drifts of the trigger signal .",
    "the calibration of the readout signals is done using calibration laser pulses of a wavelength of 355 nm and with a full width half maximum ( fwhm ) of @xmath8ns that illuminate homogeneously the entire camera .",
    "the intensity of the light in the calibration pulses can be set to various values , spanning the whole dynamic range of the readout .",
    "each stored event is tagged with a time stamp from a rubidium clock synchronized with a gps system .",
    "the purpose of the pre - processing analysis is to obtain two pieces of information for each pixel in a given event : the total signal ( charge ) and the arrival time .",
    "the signal is converted from the integrated readout counts ( i.e. summed up adc counts from 6 consecutive time samples ) to photoelectrons ( phe ) according to the f - factor ( excess noise factor ) method  ( see e.g. * ? ? ?",
    "* ; * ? ? ?",
    "for the presently used integration window of 6 time samples ( i.e. @xmath9ns ) , the conversion factor is typically @xmath10 readout counts per phe .",
    "a single photoelectron generates a signal with an amplitude of the order of @xmath11 readout counts .",
    "however , it should be noted that the individual photoelectrons come at slightly different times , both due to the time spread in the pmt and due to the intrinsic time spread of the calibration / cherenkov light flashes . by scaling down a @xmath12phe pulse which includes all those time spreads we obtain an effective photoelectron which is broader and has the amplitude of @xmath13 readout counts .",
    "the full span of 14 bit adc used in the readout is @xmath14v , thus one readout count corresponds to 122@xmath15 output voltage .",
    "however as the drs4 has a differential gain of 2 , one readout count corresponds to @xmath16 at the board input .",
    "the position of the integration window is adjusted for each pulse such that it maximizes the obtained signal over the whole readout window ( the so - called `` sliding window '' method ) . for each event , we select the pixels , which are likely to contain information about the shower based on their signals and arrival times in the so - called time image cleaning procedure @xcite .",
    "the individual pixel charges are later used in the parametrization of the shower images  @xcite .",
    "in addition , timing parameters , if determined precisely enough , can be used to further enhance the performance of the telescopes e.g. in gamma / hadron discrimination  @xcite .",
    "all the procedures described in this paper are included in the standard analysis software for the magic telescopes ( mars ,  @xcite ) and used in the automatic data processing chain .",
    "moreover , some of them ( e.g. the baseline correction ) are done online during data taking by the magic data acquisition program .      in fig .",
    "[ fig : baseline ] we show the mean cell offset ( baseline ) and its rms , as a function of the absolute position of the capacitor in the domino ring for a typical drs4 channel .",
    "capacitor is marked with thick line in red color .",
    "the inside panel zooms into some of the capacitors . ]",
    "each capacitor of each drs4 channel has its own cell offset .",
    "the differences in the mean offset caused by the physical differences in the storage cells are much larger than the rms of the baseline of the individual cells . also due to the internal construction of the drs4 , there is a relatively large step in the baseline in the middle of the readout ring ( i.e. at capacitor position 512 ) .",
    "thus , the offset of the individual capacitors has to be calibrated in order to assure low electronic noise of the readout . in principle",
    ", one can apply a relatively simple calibration by computing the mean offset as a function of the capacitor number , using dedicated pedestal runs .",
    "this mean offset can then be subtracted from the signal in a given capacitor .    however , as one can see in fig .",
    "[ fig : baseline ] , in the roi operation mode every 32@xmath17 capacitor in the drs4 ring has a larger rms than the rest of the capacitors . also its two neighbouring capacitors are partially affected . note that as the triggers can occur at arbitrary times their relative position in the roi will differ from one event to another .",
    "in fact the offset value of those capacitors depends on the relative position of the capacitor in the roi .",
    "such an effect , if not taken into account , would produce a small spike in every 32@xmath17 capacitor of the readout .",
    "in principle one can interpolate every 32@xmath17 capacitor , but this would result in loss of about 3% of the total pulse shape information , which we found unacceptable .",
    "therefore , we perform an improved calibration by computing the mean offset as a function of both the absolute position in the domino ring ( 1024 individual capacitors ) and its relative position ( 80 possibilities in the roi80 , mode of operation ) .",
    "such a procedure removes nearly all of those spikes . as a result also",
    "the fluctuations of the pedestal are reduced ( the rms of the baseline obtained from values of 80 capacitors in each event is reduced from @xmath18 to @xmath19 counts for the readout stand - alone noise ) .",
    "the offset values for such a pedestal calibration are computed using a dedicated @xmath20min run taken before each observation night .",
    "we observed that a change of the temperature of the receivers and the readout electronics of about 2 degrees can change the baseline level by about 6 readout counts .",
    "as the temperature of the readout boards is maintained constant within @xmath21degree c during the data taking , the baseline calibration normally does not have to be repeated during the observations .",
    "the above described calibration is performed online by the data aquisition software before storing the data on the disk . during the data taking",
    "we take additional interleaved pedestal events to correct for any slow drifts of the baseline .      even after applying the calibration described in section  [ sec : baseline ] , the baseline of the drs4 channel is not fully stable for randomly arriving triggers .",
    "in fact , the drs4 chip exhibits a dependence of the baseline on the time lapse to the last reading of a given capacitor .",
    "since for each event the drs4 stops at a different part of the ring and only a limited number of capacitors are read out , it may happen that a part of the capacitors of the current readout region has been read out more recently than the rest .",
    "if not corrected , such an effect would produce a step in the baseline , even within one event when a discontinuity in the time readout lapse lies within the current readout window .",
    "typically the time between two consecutive readings of the same capacitor is of the order of @xmath22ms , but if two events trigger very fast one after another , and happen to occur in the same part of the ring , it may go down to few tens of microseconds .",
    "the time lapse dependence of the cell offset can produce a jump in the baseline up to 200 counts ( equivalent to an amplitude of @xmath23phe ) .",
    "this time lapse dependence of the baseline is very similar ( within a few % ) for all the drs4 chips and can be fitted with a simple power - law function ( see fig .",
    "[ fig : drs_timeped ] ) . this power - law function is used to correct the cell offsets ( see fig .  [",
    "fig : pedjumps ] ) .",
    "+     phe signal corresponds to @xmath24counts .",
    ", title=\"fig : \" ] phe signal corresponds to @xmath24counts .",
    ", title=\"fig : \" ] + phe signal corresponds to @xmath24counts .",
    ", title=\"fig : \" ] phe signal corresponds to @xmath24counts .",
    ", title=\"fig : \" ]    after applying this correction , the steps in the baseline of the drs4 channels disappear . apart from these effects ,",
    "the baseline remains stable within 1 - 2 counts at the time scale of an hour , and can be estimated either with a dedicated pedestal run ( taken before the data taking ) , or with interleaved pedestal events ( taken at regular time intervals during data taking ) . for normal observations this calibration is performed online by the data aquisition software before storing the data on disk .",
    "compared to that , the drs2 baseline was more unstable .",
    "it showed jumps of the baseline of tens of counts between consecutive events and had to be estimated on event - by - event basis from the waveform in the same event .",
    "the first 16 time samples of the readout window , which normally do not contain signals , neither from the calibration pulses nor from the cosmic showers , had been used for this baseline estimation .",
    "the need for such a procedure naturally increases the variation of the reconstructed signal . assuming non - correlated noise in consecutive time samples , the value of the baseline can be estimated to a precision of @xmath25 . after subtracting this baseline the noise in an 8-samples window increases by a factor of @xmath26 with respect to the case of a perfectly constant and known baseline .",
    "the shape of the waveform of a calibration laser pulse is shown in fig .",
    "[ fig : pulseshape ] .",
    "the main pulse is followed by a second smaller peak ( overshoot ) @xcite .",
    "in addition , the pulses in the drs4 based readout are typically narrower than those from the drs2 , due to the bandwidth limitation of the latter .",
    "the average pulse shape can be relatively well fitted with a sum of 3 gaussian distributions ( one of them with a negative amplitude ) , however the fit parameters vary from one channel to another .",
    "the overshoot has an amplitude of @xmath27 of the main peak and occurs between @xmath9ns and @xmath28ns after the peak of the main pulse . in most of the channels",
    "there is an undershoot between the main peak and the overshoot .",
    "+     the pulse shape of an individual channel ( the top panel of fig .",
    "[ fig : pulseshape ] ) is very stable .",
    "however , the average pulse shapes are different for different readout channels .",
    "this effect depends on both the position of the channel inside the drs4 chip and the high voltage ( hv ) applied to the pmt .",
    "the distributions of the full width half maxima ( fwhm ) of the calibration pulses for various camera / readout setups used in magic are shown in fig .",
    "[ fig : fwhm ] . the smallest fwhm ( @xmath29ns )",
    "is obtained for inner pixels of the magic  i camera , equipped with the drs4 readout . the outer , bigger pixels show , mainly due to lower hv , a slower response and also a broader distribution of the fwhm .",
    "magic  ii pmts are operated at a lower voltage and do not have a fixed voltage between the photocatode and the first dynode , thus their response is in general slower , resulting in a broader fwhm .",
    "in addition , the type of the pmts ( produced by electron tubes enterprises ) used in magic  i camera is intrinsically faster than the one used in magic  ii .",
    "the second component at @xmath30ns for magic  ii ( see thick blue line in fig .  [",
    "fig : fwhm ] ) is composed largely of pixels whose hv had to be reduced in the hv flat - fielding procedure ( see section  [ sec : flatfield ] ) because the gain in the pmt or rest of electronic chain was especially high .        since ,",
    "contrary to the previous 0.3  gsamples / s readout used in the magic  i telescope until 2007 ( cf .",
    "@xcite ) , the waveform is sufficiently fine - sampled , we can use a relatively simple algorithm to extract the signal , the so - called `` sliding window '' .",
    "we integrate the waveform in a fixed number of time samples ( typically 6 ) , but we scan the integration range over the entire readout window ( of 80 time samples , i.e. 40  ns ) in order to obtain the highest value of the integral . since the size of the extraction window is smaller than the range of the overshoot , the extractor is not influenced by the secondary peaks .",
    "the sliding window provides also an estimator of the arrival time of the pulse as the mean time sample weighted with the signals in individual time samples .",
    "the signal extraction is done offline .    in fig .",
    "[ fig : extraction ] we show how the mean reconstructed number of photoelectrons depends on the size of the extraction window .        having a small integration window",
    "is desirable as it maximizes the signal to noise ratio , but the size of the window should be large enough to cover most of the pulse .",
    "the difference in the reconstructed number of photoelectrons is @xmath31 for the largest extraction window , covering the entire pulse , compared to the smaller , 6  time samples wide extractor window .",
    "for example , for a typical light intensity at which the calibration is performed the reconstructed number of photoelectrons is 82.8 phe for a 6-sample window and 86.6 phe for a 10-sample window .      in order to achieve a good reconstruction even for faint images we want to have an optimised signal to noise ratio , also for small signals .",
    "the gains of the pmts can be set by the applied high voltage ( hv ) .",
    "different hv settings vary the ratio between the noise from the light of the night sky ( lons ) and the electronic noise .",
    "however , reducing the influence of the electronic noise at a cost of increased hv will decrease the dynamic range .",
    "in addition we want to obtain a homogeneous response of all pixels to a signal that flashes the camera with a homogeneous density of photons .",
    "this procedure is called the hv flat - fielding and it is performed with the calibration laser light pulses at the wavelength of 355@xmath0 nm .",
    "the hv were tuned to correspond to about 7000 counts in readout for a photon density of the order of 300 per pmt .",
    "this photon density corresponds on average to about 90 photoelectrons per pixel .      due to small differences in the length of the optical fibers , in electronic paths and mainly the transit times of the electrons inside the pmt , ( mainly caused by different high voltage settings ) , a synchronous short light pulse illuminating the camera",
    "will not be recorded in identical drs samples for all readout channels .",
    "we found individual channel - to - channel delays of a few nanoseconds .",
    "moreover , both the drs2 and drs4 chips exhibit an additional delay of typically @xmath2ns ( up to @xmath32ns ) , depending on the absolute location of the signal pulse in the domino ring .    as long as both the electronic path ( optical fiber , receiver , drs etc ) and the hv of the pixel are not changed ,",
    "the differences can be calibrated with the use of calibration pulses .",
    "the computed mean arrival time of a pulse in a channel is a rather complicated function of the time sample position in the ring ( see fig .",
    "[ fig : drs_timecalib ] ) and differs from one drs chip to another .",
    "+     for each channel we expand this function into a fourier series to obtain the correction function .",
    "most of the drs chips have a moderate jitter with a total spread of @xmath331 ns , however in the distribution of all the drs chips , one can see a long tail .",
    "this calibration of the arrival time is done offline .    in the top panel of fig .",
    "[ fig : drs_timecalib2 ] , we show the distribution of the arrival times of the calibration pulses , before and after such a calibration .",
    "+     the distribution of the uncalibrated arrival times shows multiple peaks due to the discrete values that the pulse integration boundaries can take . since the spread of the drs time delay is larger than one time sample , this structure is not visible anymore after the time calibration .",
    "the time calibration significantly reduces the standard deviation of this distribution for a @xmath34phe light pulse down to @xmath35ns ( see the bottom panel of fig .",
    "[ fig : drs_timecalib2 ] ) .",
    "note , that this includes also the global jitter of the calibration pulse trigger ( which was measured to be a flat distribution with a total width of @xmath36ns , i.e. corresponding to an rms of about @xmath37ns ) .    in fig .",
    "[ fig : tvsq ] we show the two - dimensional distribution of the reconstructed arrival times and signals from events triggered by cosmic - ray showers .",
    "each entry is for one pixel in a cosmic event , in total @xmath38 random cosmic events have been used for this plot .",
    "as the shower images usually cover only a small part of the camera , the low signal part of the distribution ( for individual pixel signals of @xmath39phe ) is dominated by the tail of the baseline and noise fluctuations as well as afterpulses .",
    "the timing of the trigger signal is adjusted such that most of the pixels with signals belonging to cosmic - ray showers are centered around the middle of the readout window . however",
    ", very large cosmic - ray showers with large impact parameters produce long images in the cameras with a long tail in the time distribution .",
    "in this section we report on the study of the most important performance parameters connected with the signal extraction of magic data .",
    "they have an influence on high - level performance parameters of the telescopes , such as the energy threshold , the sensitivity and the angular resolution @xcite .",
    "the size of the extraction window has to be large enough to accommodate most of the signal .",
    "on the other hand , a too large window will spoil the performance of the extractor for low amplitude signals .",
    "we study the bias and the rms ( defined as the second central moment of the distribution ) of the extractor . for the calculation of the bias",
    ", we allow the extractor window to search throughout the whole readout window of @xmath40ns .",
    "we calculate the rms both with a biased extractor ( the so - called `` sliding window '' ) and with an unbiased one ( the so - called `` fixed window '' ) . in the case of the fixed window",
    "we integrate a given number of samples starting at a random position in the total readout window , while for the sliding window we search for an integration window that provides the largest charge . in the case of small ( or lack of )",
    "signals the fluctuations of noise determine the position of the extraction window .",
    "therefore the corresponding value of the pedestal rms is dominated by the `` signal '' positions found by the sliding window extractor .",
    "on the other hand if the signal is sufficiently larger than the fluctuations of the noise , the extraction window is determined by the pulse . the proper quantity to consider for the additional reconstructed pulse fluctuation",
    "is rather approximated by the pedestal rms from a fixed window extractor .",
    "note that we estimate the rms by directly computing the square root of variance of the estimated signal and not by fitting a gaussian to the distribution of the obtained signals .",
    "this way , we take into account also non - gaussian tails of the electronic noise , and the afterpulses generated by lons photons .",
    "the sigma of the pure gaussian part of the noise is @xmath41 lower than the rms .",
    "the results for both magic cameras equipped with the drs4 readout are shown in fig .",
    "[ fig : bias_rms ] .",
    "both the bias and the unbiased rms of the pedestal are similar for both telescopes .",
    "the bias of the sliding window extractor is largely determined by the size of the total readout window , and only weakly depends on the integration window . for the total window of 40ns",
    "the bias is nearly constant at a value of @xmath42phe . on the other hand the rms of the pedestal increases with the size of the window as more noise is integrated .",
    "note that while the bias of the `` sliding window '' extractor is rather large , an additional precise information on pulse arrival times obtained from this extractor is required for constructing intelligent image cleaning algorithms @xcite .",
    "assuming a rate of @xmath43phe / ns produced by the lons from a dark extragalactic patch of sky  @xcite , we performed a toy mc simulation , computing the number of photoelectrons in the search window of @xmath9ns within the total time window of @xmath40ns .",
    "we obtained that the mean value of such a bias is 1.5@xmath0phe with ac coupling of the signal .",
    "thus we conclude that the bias value of @xmath29phe per @xmath40ns window seen in the data is mostly produced by the lons .",
    "part of the noise computed in section  [ sec : ped_rms_bias ] can not be described by a gaussian distribution .",
    "we estimate its contribution by computing the fraction of pedestal events with signals above a given threshold .    the distribution of the noise is shown in fig .",
    "[ fig : pedestal_hist ] .",
    "+     the deviations from the gaussian distribution is at the level of a fraction of one per cent .",
    "analysis of a constant frequency pedestal run shows that about 1.2% of events are affected by non - gaussian electronic noise . in those events",
    "there is an artificial signal ( only due to noise fluctuations ) greater than 100 counts in at least one capacitor .",
    "note that a single photoelectron produces on average a signal of an amplitude of @xmath44 counts , and typically the integrated charge in a 6 sample extraction window is 90 counts ) .",
    "the noise computed in section  [ sec : ped_rms_bias ] can be either induced by the lons or by the electronics . in order to find the dominant source of the noise in the magic telescopes",
    ", we took a series of runs with random trigger in various hardware setups :    1 .",
    "normal run with the open camera 2 .",
    "run with the closed camera 3 .",
    "run with the hv switched off 4 .",
    "run with the camera powered down , i.e. the vcsels switched off    the last run allowed us to measure the noise induced by the drs4 readout and the receivers ( dominated by the drs4 noise ) . in order to check the noise produced in the camera ( mostly generated by the vcsels )",
    ", one can subtract in quadrature the noise of the run 4 from the noise of the run 3 .",
    "similarly , the second run minus the third run gives an estimation of the noise introduced by the hv , and the first run minus the second run tells the noise due to lons .",
    "the results of those calculations are summarized in table  [ tab : noise ]    .",
    "contribution to noise from different hardware components for inner magic  i pixels ( in parentheses values for outer pixels ) and magic  ii , both equipped with the drs4 readout . [ cols=\"^,^,^,^\",options=\"header \" , ]     the `` natural '' noise connected with the lons is of the order of the electronic noise .",
    "the dominant electronic noise comes from the readout in the control house , but in the case of the old magic  i camera , the noise produced inside the camera was slightly larger . in the magic  i camera a small noise of @xmath45phe is also induced by powering up the hv .",
    "this noise might be caused by the proximity of the hv and lv lines in the old magic  i camera .",
    "the noise has been only measured shortly before the decommissioning of this camera . due to a different design such noise",
    "is not observed in the case of the magic  ii camera , and the noise value falls below accuracy of the measurement , @xmath46 phe . as explained in section  [ sec : flatfield ] , both the inner and the outer pixels were tuned to have the same response ( measured in readout counts ) to the same photon density . since the outer pixels are 4 times larger in area , all the noise , which is not generated in the pmt itself ( e.g. drs4 noise ) , corresponds to 4 times larger noise , expressed in photoelectrons , for the outer pixels , compared with the inner ones . on the other hand ,",
    "the lons - induced noise of outer pixels is less than a factor 4 larger than in the case of the inner pixels .",
    "that noise is generated from a larger number of photoelectrons with smaller gain that in the inner pixels , which results in smaller relative fluctuations .",
    "following the approach presented in @xcite we also investigate the noise autocorrelation function in magic  ii operating with the drs  4 readout .",
    "the noise autocorrelation function , @xmath47 , is defined as the correlation between the read - out samples @xmath48 and @xmath49 : @xmath50 where @xmath51 and @xmath52 are the calibrated drs4 sample content in time samples @xmath48 and @xmath49 , and averaging is done over many events taken with random trigger . in fig .",
    "[ fig : noise_corr ] we show the noise autocorrelation function for a time sample @xmath53 ( i.e. in the middle of the readout window ) for various hardware setups .",
    "the main peak corresponds to the response of the readout to a single phe and/or noise .",
    "the secondary peaks are the result of the overshoot of the readout ( compare with fig .  [ fig : pulseshape ] ) .",
    "the long wavy behaviour of combined drs4 and receivers noise is a @xmath40mhz noise visible in some drs4 chips ( note however that the contribution of this noise to the total electronic noise is small ) .",
    "one of the advantages of the drs4 with respect to the drs2 chip is the possibility to read out only a fragment of the ring , the `` roi '' . in the roi80 mode of operation we read 100 samples , but exclude on the fly the first and the last 10 samples , as they sometimes show higher noise than the 80 samples in between .",
    "this significantly decreases the dead - time per event from @xmath54 for the drs2 down to @xmath55 for the drs4 .",
    "the dead - time is constant and the same for all the drs4 chips , thus it produces a sharp cut - off in the distribution of the time lapses between consecutive events ( see fig .  [",
    "fig : deadtime ] ) .",
    "the latency of the trigger systems used in the magic telescopes ( @xmath56ns for the individual telescope trigger and @xmath57ns for the stereo trigger ) is even smaller than this dead time .",
    "as most of the events are recorded at the same time by both telescopes , the dead - time does not add up and the total dead - time of the present setup of magic telescopes is also @xmath55 .",
    "a small fraction of events ( @xmath58 ) with apparent time lapses lower than the dead - time is due to rare jumps in the clock bits due to asynchronous latching of information .",
    "we have cross - checked the distribution of time lapses between the events using the internal clock of the readout and obtained a similar distribution .",
    "both the rubidium clock time - stamp and the drs clock value are read using this method , thus the fraction of events with corrupted time lapses is similar .",
    "but since the information from both clocks is supplied with different cables the events for which it happens are different .",
    "the upgrade of the readout from drs2 to drs4 thus allowed us to reduce the total fraction of events lost due to the dead - time from @xmath59 down to a value of @xmath60 for a typical data taking rate of @xmath61hz .",
    "we investigate the charge resolution as a function of the signal strength .",
    "we used both the calibration light pulses with different intensities , as well as electric pulses injected at the base of the pmt with various intensities . in fig .",
    "[ fig : chargeres ] left and middle panels we show the distribution of the reconstructed charges for pulse injection and light pulses .",
    "we apply the same conversion factors from the integrated readout counts to photoelectrons and calibrate pulse injection data in equivalent photoelectrons to allow for an easy comparison .",
    "the distribution of the reconstructed charge for the pulse injection can be well described with a gaussian . on the contrary ,",
    "the number of photoelectrons registered with a pmt follows poissonian statistics ( corrected for an assumed excess noise factor ) , and its distribution is much broader than for the pulse injection case .",
    "the distributions in the very low signals range ( @xmath62phe ) are affected by the bias of the extractor .",
    "the charge resolution ( defined as the rms of the reconstructed charge distribution divided by its mean ) is @xmath63 for pulse injection signals that resemble the ones produced by @xmath64phe in the pmts and drops inversely proportionally to the signal strength .",
    "for very large signals it approaches a constant value of @xmath65 . in turn the signal resolution for light pulses is strongly limitted by the poissonian fluctuations of the number of generated photoelectrons . at a light intensity of @xmath64phe",
    "it is @xmath66 and drops with the square root of the number of photoelectrons .",
    "one should note that the pulse injection data , contrary to the light pulses , do not include the noise of the light of the night sky . including it would spoil the charge resolution at the low and medium signals by 30 - 40% ( compare with table  [ tab : noise ] ) .",
    "however even including this effect the charge resolution is a factor of a few worse for light pulses than for electric pulses .",
    "we conclude that the charge resolution of the drs4-based readout can not be fully exploited due to the large fluctuations of the number of photoelectrons registered in the pmt .",
    "one of the important signal processing performance parameters is the time resolution for signals of different light intensities .",
    "the time resolution curve can be parametrized by 3 parameters ( see  @xcite for details ) : @xmath67    the @xmath68 parameter includes contributions of all poissonian processes .",
    "in particular the intrinsic time spread of the photons and different travel times of individual photo - electrons produced at different places in the photocatode ( and amplifying dynodes ) contribute to @xmath68 .",
    "the @xmath69 parameter mostly depends on the pulse shape and the signal reconstruction resolution .",
    "the constant component , @xmath70 , can be produced e.g. by a jitter of the clock of the readout or instrinsic time jitters of electronic components .    in order to study the time resolution as a function of the signal strength",
    ", we took a series of data runs with calibration pulses of different laser light intensities . using standard magic simulation software",
    ", we also generated mc runs with different light intensities .",
    "note that the intrinsic time spread of the laser pulse ( fwhm = @xmath71ns , as measured in the lab , corresponding to a standard deviation of a gaussian of @xmath72ns ) will contribute quadratically to the @xmath68 parameter .",
    "compared to that , the intrinsic time spread of photons produced in a gamma - ray shower in a single pixel is very similar and of the order of fwhm=@xmath2ns , or @xmath73ns .",
    "however , as the laser light directly illuminates the camera ( without being reflected from the mirror ) , the staggering of the mirrors of the magic  i telescopecm ] is not included in this study .",
    "the staggering of the mirrors will result in an arrival time distribution of individual photons from the showers convoluted with a bimodal distribution of the total spread of @xmath74ns .",
    "we used toy mc simulations and determined that this is equivalent to adding in quadrature half of the time difference , i.e.  0.3ns , to the @xmath68 parameter of eq .",
    "[ eq : timeres ] .",
    "the trigger of the calibration pulse has a small jitter ( a flat distribution with the total spread of @xmath75ns ) .",
    "as this is a global trigger jitter , all the channels jitter uniformly , and there is no effect on the relative time differences between the signals in different channels .",
    "however , it is important to take this into account when checking the time response of a single channel .",
    "therefore , for each event , we first calculate the mean arrival time from all channels , and subsequently the standard deviation of the distribution of the arrival time in a given pixel , minus the mean arrival time of all pixels .",
    "the time distributions could be fitted well with a single gaussian for medium and large signals . for small signals of just a few photoelectrons in addition to the gaussian peak there is a second flat component ( which reflects the case where the signal extractor was confused by the residual noise or no photoelectron at all from the calibration light pulser arrived at the first dynode of the pmt ) , but the fitting range was adjusted to keep only the main gaussian peak .",
    "the results are shown in fig .",
    "[ fig : timeres ] .",
    "one can see that the mc simulations can well reproduce the behavior of the data .",
    "the time resolution for large pulses ( @xmath1phe ) approaches @xmath76ns .",
    "for the low signals of about @xmath77phe it is still as good as @xmath78ns . due to",
    "different pmt type and hv settings the transit time spread in magic  i is lower than in magic  ii , resulting in a lower @xmath68 coefficient ( @xmath79ns for magic  i , @xmath80ns for magic  ii ) . since both telescopes are equipped with the same readout and have similar noise , the @xmath81ns parameter is the same for both of them .",
    "the error on the fit parameters given above has been estimated by performing a similar fit to each pixel separately and computing the rms of the distribution of the obtained values .",
    "therefore they should be treated as systematic errors arising from differences between individual pixels / channels .",
    "taking into account the staggering of the mirrors and the typical time spread of photons from gamma - ray showers ( adding quadratically 0.3ns and 0.4ns and subtracting 0.47ns ) , we expect thus for magic  i gamma - ray showers : @xmath82 and for magic  ii ( adding quadratically 0.4ns and subtracting 0.47ns ) : @xmath83    as one can see , the correction from calibration light pulses to gamma - ray showers reflected by the mirrors , does not change the results within a precision 100ps . for the reference value of @xmath22phe",
    "the time resolution is equal to @xmath84ns and @xmath85ns , while for @xmath86phe @xmath87ns and @xmath88ns .",
    "the drs2 readout , used previously in the magic  ii telescope , was highly non - linear .",
    "moreover , the non - linear response of the system could vary from one capacitor to another , even in a single readout channel .",
    "the non - linearity could be calibrated by applying a set of constant voltages at the input of the drs2 and comparing them with the resulting signals ( uncalibrated counts ) in different capacitors .",
    "+     the slope of the curve changes from about 6 for small signals down to 2.5 for medium signals ( see fig .",
    "[ fig : lindrs2 ] ) . very large signals ( @xmath89 900  phe ) saturated the drs2 readout . knowing the linearity curves for each capacitor , the linearization could be done off - line .    in contrary to that",
    ", the drs4 readout has an excellent linear behaviour up to its saturation at the value of @xmath3313000 drs4 counts in a single capacitor above the baseline . the apparent 3 - 5% deviation from the linearity at the lowest charges",
    "are dominated by uncertainty of the input voltage used for the measurement .",
    "since a single photoelectron produces a signal with an amplitude of @xmath90readout counts this would naively correspond to saturation starting at @xmath91phe . a large pulse which includes the intrinsic time spread of the calibration / cherenkov light flashes and the time spread in the pmt",
    "has an effective amplitude of @xmath13 readout counts per photoelectron ( see section  [ sec : signal_processing ] ) . on top of that",
    "the integration window of 6 samples is less sensitive to the saturation than just the amplitude the pulse .",
    "therefore , for a typical light pulse the saturation in drs4 becomes important only above @xmath92  phe .",
    "readout counts . ]    the deviations from linearity are typically @xmath93 ( see fig .",
    "[ fig : lindrs4 ] ) .",
    "the drs chips exhibit cross - talk between the channels of the same chip , the shapes of which are shown in fig .",
    "[ fig : xtalk_shape ] .        the cross - talk matrices ( giving the fraction of the original signal injected into another channel )",
    "are shown in fig .",
    "[ fig : xtalk ] for typical drs2 and drs4 chips .",
    "the values of the cross - talk in fig .",
    "[ fig : xtalk ] are computed for the signal extraction with integration windows normally used in the analysis of drs2 and drs4 data , i.e. 8 and 6 time samples respectively .    in the case of the drs2 readout ,",
    "a significant cross - talk ( up to @xmath94 of the orignal signal ) was observed in most of the combinations of channels . as the cross - talk from different channels can pile up ,",
    "the total cross - talk from 9 channels with the same signal can easily add up to @xmath95 of the original signal .",
    "for large showers , signals of the order of 100  phe are common , and this would produce artificial signals of the order of 10  phe , which can easily exceed the thresholds set by the image cleaning . in order to correct for the cross - talk , we invert the cross - talk matrix and apply it to the reconstructed signals .",
    "this procedure was done only for the data taken with the drs2 readout .    in the case of drs4 ,",
    "only a moderate cross - talk ( @xmath96 ) is visible in the neighbouring channels .",
    "farther channels in the same drs4 chip have much lower cross - talk ( of the order of @xmath97 ) . on top of that ,",
    "the total number of channels used in one drs chip is lower ( 8 in the drs4 chip compared to 10 in drs2 ) , thus pile - up of cross - talk is smaller .",
    "we presented analysis methods used to extract and calibrate the charge and time information from individual pixels of the magic telescopes .",
    "the upgrade of the readout of the magic telescopes from drs2 to drs4 based has significantly improved the performance of the system . an advanced pedestal subtraction procedure in drs4 data results in a stable baseline . for typical observation conditions",
    ", the noise in both telescopes lies below one photo - electron , with comparable contributions from the electronic noise and the lons .",
    "the pulses are being extracted with the `` sliding window '' extractor of a width of @xmath9ns .",
    "the calibration of the time response of the drs4 chip allows to obtain excellent time resolution of @xmath37ns for signals larger than a few tens of photoelectrons . even for small signals of a few photoelectrons ,",
    "the time resolution is still as good as @xmath98ns .",
    "the upgrade of the readout to drs4 allowed to decrease the dead time from 12% to a negligible fraction . in contrary to the large non - linearity of the drs2 readout , the linearity of the new system was proven to be very good up to the saturation at @xmath99 counts above the baseline . for the typical light pulse time spread the saturation occurs for signals above @xmath100phe resulting in a nearly three orders of magnitude dynamic range .",
    "also the cross - talk was reduced by a factor of a few to a value , which normally does not influence the data any more .",
    "all the here presented low - level performance has been proven to be sufficiently good for the application of a drs4-based readout in iacts .",
    "moreover the magic telescopes have been successfully using such a readout for the past 1.5 years .",
    "this makes the drs4 a viable candidate for the signal digitization of the future cta project .",
    "however , one should be aware that the excellent performance has been achieved only after complex software preprocessing of the raw data . in the case of highly integrated cameras and electronics of telescopes",
    "such preprocessing may become challenging .",
    "we would like to thank the magic collaboration for allowing us the usage of hardware and software tools that were needed to perform this study .",
    "we would especially like to thank rudolf bock , juan cortina , david fink , razmik mirzoyan , and david paneque for many discussions and careful reading of the manuscript .",
    "we also thank the two anonymous referees for their comments and suggestions which helped to improve the manuscript .",
    "00 actis , m. et al . exp .",
    "32 , 193 ( 2011 ) .",
    "albert , j. , et al . , 2008 , nim a , 594 , 407 aleksi , j. , et al .",
    ", 2012 , astropart .",
    "phys . , 35 , 435 aliu , e. , et al . , 2009 , astropart .",
    "phys . , 30 , 293 anderhub , h. , et al . , 2011 , nim a , 639 , 58 bartko , h. , goebel , f. , mirzoyan , r. , pimpl , w. , & teshima , m. , 2005 , nim a , 548 , 464 bechtol , k. , funk , s. , okumura , a. , ruckman , l. l. , simons , a. , tajima , h. , vandenbroucke , j. , varner , g. s. , 2012 , astropart .",
    "phys . , 36 , 156 bitossi , m. , phd thesis , universit di pisa , february 2009 bitossi , m. , paoletti , r. , tescaro , d. , ieee transactions on nuclear science , in preparation cogan , p. , 2008 , international cosmic ray conference , 3 , 1369 cortina , j.  2005 , ap&ss , 297 , 245 cortina , j. , 2011 , international cosmic ray conference , arxiv:1110.4747 delagnes , e. , degerli , y. , goret , p. , nayman , p. , toussenel , f. , vincent , p. , 2006",
    ", nim a , 567 , 21 gaug , m. , bartko , h. , cortina , j. , & rico , j.  2005 , proc . of the 29th icrc , 5 , 375 hillas , a.  m. , 1985 , 19th icrc , 3 , 445 jelley , j.  v.  1955 , british journal of applied physics , 6 , 227 kubo , h. , & paoletti , r.  2011 , international cosmic ray conference , 9 , 177 lombardi , s. , berger , k. , colin , p. , diago ortega , a. , klepser , s. , 2011 , proc of the 32nd icrc , beijing , china , 3 , 262 mirzoyan , r. , lorenz , e. , proc . of the 25th icrc , durban ,",
    "south africa,1997 moralejo , a. , et al . , 2009 , arxiv:0907.0943 , proc .",
    "of 31st icrc , d naumann , c.  l. , et al . , 2012 , nim a , 695 , 44 pegna , r. , cecchi , r. , paoletti , r. , piccioli , a. , ritt , s. , turini , n. , 2006 , nim a , 567 , 218 ritt , s. , proc .",
    "of the ieee national science symposium , 2004 ritt , s. , dinapoli , r. , & hartmann , u.  2010 , nim a , 623 , 486 schweizer , t. , & magic collaboration , 2010 , 38th cospar scientific assembly , 38 , 2330 tescaro , d. , et al .",
    "2009 , arxiv:0907.0466 weekes , t.  c. , et al . , 1989 , apj , 342 , 379 zapatero , j. , 2006 , diploma thesis , uab , barcelona"
  ],
  "abstract_text": [
    "<S> recently the readout of the magic telescopes has been upgraded to a new system based on the domino ring sampler version 4 chip . </S>",
    "<S> we present the analysis techniques and the signal extraction performance studies of this system . </S>",
    "<S> we study the behaviour of the baseline , the noise , the cross - talk , the linearity and the time resolution . </S>",
    "<S> we investigate also the optimal signal extraction . </S>",
    "<S> in addition we show some of the analysis techniques specific to the readout based on the domino ring sampler version 2 chip , previously used in the magic  ii telescope .    </S>",
    "<S> gamma - ray astronomy , cherenkov telescopes , signal extraction </S>"
  ]
}