{
  "article_text": [
    "quantitative studies on the mechanism of core - collapse supernovae ( ccsne ) require detailed numerical simulations . except for low - mass ( @xmath2 ) progenitors , elaborate one - dimensional ( 1d ) simulations under spherical symmetry have not reproduced the supernova explosion .",
    "last decade , most of supernova modelers have focused on the multi - dimensional ( multi - d ) aspects of dynamics ( see e.g. , @xcite for recent review ) . in the post - bounce phase , instabilitities drive post - shock accretion flows into turbulence , making dynamics intrinsically multi - d .",
    "this may be crucial for the supernova explosion , since the non - spherical turbulent motions increase the dwell time of material in the gain region , enhancing its absorption of hot neutrinos , boosting the post shock pressure , and eventually pushing the shock wave outwards @xcite .    as a matter of fact",
    ", we have recently witnessed shock revival in some of the currently most advanced simulations @xcite , which has raised our hope that we will finally unveil the mechanism of ccsne .",
    "unfortunately , however , success or failure of the supernova explosion is a delicate problem .",
    "in fact , the latest results of multi - d simulations by different groups are still at odds with one another and no consensus has yet emerged concerning which ingredient(s ) is ( are ) essential for explosion .",
    "although various approaches , both phenomenological and ab initio , are being undertaken at present , only better simulations possibly with a boltzmann - equation solver that incorporate detailed microphysics and general relativity ( gr ) may give the conclusive answer .",
    "towards this goal , we are developing a numerical code for neutrino transfer , which solves the boltzmann equations @xcite .",
    "our code is based on the discrete - ordinate @xmath3 method , which finite - differences the boltzmann equations , deploying multi - angle and multi - energy bins in momentum space .",
    "using some snapshots from three - dimensional ( 3d ) supernova simulations , @xcite demonstrated the capabilities of this new code , which implements the minimum set of neutrino reactions ( see also @xcite ) .",
    "these simulations concerned neutrino transfer in static backgrounds , however , and no back - reactions to matter were taken into account .",
    "the next step should be a coupling of this code with a hydrodynamical code .",
    "this may not be so simple , though .",
    "spherically symmetric 1d computations may be easier , since they can adopt lagrangian formulations both for neutrino transfer and hydrodynamics @xcite .",
    "such formalisms as they are could not be applied in multi - d , however , and different formulations should be developed for the multi - d boltzmann - hydro simulations , i.e. the simulations that solve the boltzmann equations and hydrodynamical equations simultaneously in multi - dimensions .",
    "unlike the previous 1d codes , we adopt an eulerian picture in this paper .",
    "there are several reasons for this choice . among other things , we have in mind that the boltzmann solver will be coupled with a multi - d eulerian hydrodynamics and gravity solvers , which have been well established and widely used in the high - energy astrophysical community . in addition , the eulerian picture has a benefit to easily handle the left hand side of boltzmann equation , i.e. , advection terms .",
    "in general , lagrangian formulations need to treat derivatives with respect to neutrino energy , which correspond to the doppler s effect caused by spatial and/or temporal variations in fluid velocities .",
    "this may cause problems particularly at a shock wave , where fluid velocities are discontinuous . for these reasons , we have opted the eulerian approach .",
    "it should be noted , however , that the eulerian approach has its own demerits .",
    "for example , we normally need to handle transformations between the laboratory frame and the fluid - rest frame defined locally , which are nothing but lorentz transformations for flat space - time , since neutrino - matter interactions are best described in the fluid - rest frame .",
    "physically consistent treatments of both advection and collision terms in the multi - d boltzmann solver are technically difficult particularly in the @xmath3 method , since special relativistic ( sr ) effects such as doppler shifts and aberrations should be handled on a rather coarse grid in the momentum space ( see section  [ sec : difficulty ] for more details ) .",
    "previous studies have attempted to alleviate this difficulty by employing an expansion of basic equations up to @xmath4 ( see e.g. , @xcite ) . in ccsne ,",
    "the maximum fluid velocity is around @xmath5 of the speed of light and such a first - order approximation may be justified .",
    "the resultant equations are fairly complex and not easy to treat numerically , however , and the formulation is certainly not applicable to highly relativistic phenomena .",
    "it should be also mentioned that several groups @xcite are developing different formulations for multi - d boltzmann - hydro simulations , which are yet to be implemented .",
    "@xcite performed detailed 2d boltzmann - hydro supernova simulations in the post bounce phase but they ignored sr effects .",
    "as shown later , consistent treatments of sr effects are indispensable to obtain correct behaviors in neutrino transfer .",
    "they are also the first step towards fully gr boltzmann simulations , which will be needed to study more extreme phenomena such as black hole formations .    in this paper , we propose a novel formulation for the numerical computations of multi - d sr boltzmann transfer based on the @xmath3 method , which treats sr effects to all orders of @xmath0 , where @xmath6 and @xmath7 denote the speed of light and fluid velocity , respectively .",
    "the accuracy of our new method is checked by the standard tests as well as by a realistic simulation of spherical collapse of a @xmath1 progenitor . as explained in the next section ,",
    "the appropriate treatment of sr effects is crucial for numerically capturing the neutrino - trapping and the subsequent evolution up to bounce . in this paper , we particularly focus on this issue , and more detailed quantitative analyses of realistic supernova simulations by our boltzmann - hydro code will be reported later separately .",
    "this paper is organized as follows . to facilitate readers understanding",
    ", we first give intuitive arguments on the importance of sr effect from the perspective of phase space ( in section  [ sec : neutrinotrap ] ) , which will make clear why non - relativistic boltzmann - hydro simulations fail to capture neutrino advections with matter and yield qualitatively wrong distributions of neutrinos . in section  [ sec :",
    "difficulty ] , it is also emphasized that the treatment of sr effects is not so easy practically , and it is explained what is the main obstacle . then the basic equations and formulations are presented in section  [ sec : srbeqneutri ] . after introducing two independent energy - grids ( which are essential for our sr treatment ) in section  [ sec : twoenegrids ] ,",
    "the numerical algorithms are given in section  [ sec : numeimple ] .",
    "we examine the accuracy of our new method by a series of sr boltzmann and boltzmann - hydro simulations in section  [ sec : validation ] .",
    "finally we conclude the paper with a summary and discussions on further extensions of our code to a gr version in section  [ sec : summary ] . throughout this paper , greek and latin",
    "subscripts denote space - time and space components , respectively .",
    "we use the metric signature of @xmath8 .",
    "unless otherwise stated , we work in units with @xmath9 , where @xmath10 is the gravitational constant .",
    "before going to details of our sr boltzmann formulation and its numerical algorithm , we first give intuitive arguments on the importance of sr effects .",
    "as will be observed below , the ignorance of sr effects yields qualitatively wrong behaviors in neutrino distributions .",
    "the key ingredient is the angular distribution in phase space : isotropic distributions in the fluid - rest frame become _ anisotropic _ in the laboratory frame after lorentz transformations , the fact that ensures advection of neutrinos with matter and eventually the neutrino trapping .    in the following , we will explain this in a simplified and idealized set - up .",
    "we consider neutrino transfer in moving matter that has uniform velocity and thermodynamic quantities .",
    "we assume in addition that neutrinos and matter are strongly coupled with each other via scattering and , as a result , the neutrino distribution function in phase space , @xmath11 , is isotropic in the fluid - rest frame .",
    "this is a situation similar to the ones we see locally in the neutrino trapping phase .",
    "then the neutrino flux at each point vanishes in the fluid - rest frame and there is no net flux traversing fluid elements ( see the left panel in figure  [ schema1 ] ) . the neutrino number in each fluid element is conserved as the fluid element moves at the finite velocity .",
    "this is the advection of neutrinos with matter and it should be evident why the lagrangian approach is advantageous in dealing with it .    for comparison",
    ", the right panel in figure  [ schema1 ] describes the same situation except in the laboratory frame . here",
    ", we assume that the fluid is advected inwards ( or leftwards in the figure ) .",
    "since the neutrinos should be advected in the same direction as the fluid in the laboratory frame , the in - coming neutrino flux is larger than the out - going one , which means that the angular distribution of neutrinos is _ anisotropic _ in this frame . from the sr point of view , such anisotropies arise from the doppler shift and relativistic beaming by lorentz transformations .",
    "the mathematical expression of sr boltzmann equations will be given in section  [ sec : srbeqneutri ] .",
    "if we neglected all sr effects , not distinguishing the laboratory and fluid - rest frames , we would not obtain the neutrino advection with matter , which is crucial for the neutrino trapping in the collapsing phase .",
    "in fact , neutrinos would be left behind as fluids are advected .",
    "the supernova core is not homogeneous in reality and both matter and neutrino densities are highest at the center . in the absence of advection , neutrinos would always flow outwards when they actually should move inwards , keeping pace with matter , and be effectively trapped in the core . as we will show later in section  [ subsec:1dsrboltz_hydro ] ,",
    "the number density of electron - type neutrinos becomes significantly smaller near the center for non - relativistic simulations .",
    "it affects in turn the evolution of electron fraction and the size of inner core and eventually all the supernova dynamics thereafter .",
    "we give intuitive explanations more in detail on why sr treatments are not easy in the @xmath3 method , which we employ in this paper .",
    "the main source of the difficulties is scatterings , particularly those between neutrinos and nucleons ( and nuclei ) .",
    "other reactions such as neutrino absorptions and emissions have no technical difficulties .",
    "we hence focus only on the isoenergetic scatterings in this section .",
    "as mentioned in the previous sections , our boltzmann - hydro code is based on the eulerian picture , and we discretize 6d phase space in the laboratory frame , as shown in the the left panel in figure  [ momspacedist ] . in this picture ,",
    "spherical coordinates in momentum space are adopted with the azimuthal dimension being collapsed .",
    "the radial direction corresponds to neutrino energy .",
    "although the picture is drawn that way , gridding in each dimension is not necessarily uniform .",
    "we first consider the isoenergetic scattering under the condition that fluid is at rest and , as a consequence , the laboratory fame coincides with the fluid - rest frame .",
    "when a neutrino undergoes the isoenergetic scattering , it changes its flight direction specified by two angles , preserving energy . in the discretized momentum space , the neutrino moves from a bin to another with the same radial - grid number .",
    "the important thing is that only the angular - grid number is changed . in this case",
    ", there is no difficulty and , indeed , it has been implemented in @xcite .    in the presence of non - vanishing fluid velocities ,",
    "the problem becomes qualitatively different . in this case",
    ", the laboratory frame is different from the fluid - rest frame and they are related with each other via a lorentz transformation .",
    "the point is that the lorentz transformation induces changes in both energy and angles .",
    "these energy shift and aberration are determined by the doppler factor , which depends on the fluid velocity and neutrino angles ( see section  [ sec : srbeqneutri ] ) .",
    "this is most clearly demonstrated in the right panel of figure  [ momspacedist ] , in which the spherical coordinates given in the laboratory frame are lorentz - transformed to the fluid - rest frame .",
    "it is evident that they are no longer spherically symmetric and distorted in the latter frame .",
    "this picture summarizes the difficulties in the treatment of scatterings even if they are isoenergetic . as is well known , the neutrino distribution function @xmath11 is a lorentz invariant and its values at corresponding points in different frames are identical . the important point , however , is the fact that grid points are shifted by lorentz transformations and concentric ( equivalently isoenergetic ) spheres in the laboratory frame are no longer spheres in the fluid - rest frame . as a consequence ,",
    "some interpolations are inevitable in evaluating the collision terms for scatterings in the fluid - rest frame if one were to avoid the @xmath0 expansion .",
    "there are several difficulties to carry out this interpolation particularly in neutrino energy , though .",
    "the reasons are described shortly .",
    "the rather low energy resolution we can afford in the boltzmann code is one of the reasons .",
    "we can deploy at most @xmath12 energy bins ( see @xcite ) . the distribution function",
    "@xmath11 depends strongly on the neutrino energy in general .",
    "in particular , it decreases almost exponentially at high energies . on the numerical mesh",
    ", @xmath11 may change several orders of magnitude between adjacent energy - grid points .",
    "highly accurate interpolations of @xmath11 are hence required on the coarse mesh .",
    "note that since the isoenergetic scatterings between neutrinos and nucleons and/or nuclei dominate other reactions in ccsne , the time step ( @xmath13 ) of simulations is mostly determined by these processes . if the interpolations of @xmath11 are not accurate at high energies , we might find that @xmath13 becomes unreasonably small because of a large number of artificial scatterings .",
    "the fact that high energy neutrinos have larger cross sections makes matter worse . not to mention , in the interpolation we further have to care about the conservation of neutrino numbers in scatterings .",
    "after giving the sr boltzmann equations in the next section , we present our idea to overcome these difficulties .",
    "we then demonstrate our successful handling of the isoenergetic scatterings in the realistic supernova simulations ( see section  [ sec : validation ] ) .",
    "we start with the covariant form of boltzmann equation : @xmath14 which is valid even in curved space - time . in the above expression , @xmath11(@xmath15 )",
    "denotes the neutrino distribution function in phase space ; @xmath16 and @xmath17 are space - time coordinates and four - momentum of neutrino , respectively ; since the latter satisfies the on - shell condition : @xmath18 , in which @xmath19 is a neutrino mass , only three of four components are independent and this is why only spatial components appear in the second term on the left hand side ; @xmath20 stands for the affine parameter of neutrino trajectory .",
    "the left hand side of eq .",
    "( [ eq : basicboltz ] ) expresses a geodesic motion in the phase space , while the right hand side denotes symbolically the so - called collision terms , i.e. , the terms that give the rate of changes in @xmath11 due to neutrino - matter interactions .    on the spherical",
    "coordinates in flat space - time , which are the coordinates we employ for the laboratory frame in our eulerian approach , eq .  ( [ eq : basicboltz ] ) is cast into the following conservation form : @xmath21 \\nonumber \\\\ & & - \\frac{\\sqrt{1-\\mu_{\\nu}^{2}}}{r }     \\frac{{\\rm cos}~\\theta}{{\\rm sin}~\\theta }    \\frac{\\partial}{\\partial \\phi_{\\nu } } ( { \\rm sin}~\\phi_{\\nu } f ) = \\bigl ( \\frac{\\delta f}{\\delta t } \\bigr)_{{\\rm col}}^{{\\rm lb } } ,   \\label{eqn : eqtransfin - spherical } \\ ] ] where @xmath22 , @xmath23 , @xmath24 denote the spatial variables ; as three independent components of neutrino four - momentum , we do not use its spacial components but adopt energy and two angles , @xmath25 and @xmath26 ( see figure  [ neutrinomompic ] ) ; @xmath27 is defined as @xmath28 . in eq .",
    "( [ eqn : eqtransfin - spherical ] ) and the rest of this paper , we assume that neutrinos are massless , which is well justified as long as neutrino oscillations are ignored .    the collision term in eq .",
    "( [ eqn : eqtransfin - spherical ] ) , which is expressed with the laboratory time @xmath29 , is related with the original collision term in equation  ( [ eq : basicboltz ] ) as @xmath30 where @xmath31 denotes the neutrino energy measured in the laboratory frame .",
    "similarly , the collision term in the fluid - rest frame can be expressed with the proper time of each fluid element ( @xmath32 ) as @xmath33 where @xmath34 denotes the neutrino energy in the fluid - rest frame . here",
    "@xmath35 is the four - velocity of matter .",
    "the lorentz transformation of four - momentum gives the relation of neutrino energies in the fluid - rest and laboratory frames as @xmath36 where @xmath7 , @xmath37 denote the three - velocity and corresponding lorentz factor of matter and @xmath38 is the unit vector that indicates the flight direction of neutrino in the laboratory frame .",
    "the factor @xmath39 in eq .",
    "( [ eqn : lorentz - energy ] ) expresses the doppler shift of neutrino energy . from eqs .",
    "( [ eq : colintocova ] ) - ( [ eqn : lorentz - energy ] ) , we can obtain the relation between the collision terms in the two frames as @xmath40    the lorentz transformation also gives the relation between the flight directions in the fluid - rest and laboratory frames as @xmath41 .",
    "\\label{eq : energytrans } \\end{aligned}\\ ] ] here @xmath42 denotes the unit vector that specifies the flight direction of neutrino in the fluid - rest frame . using the doppler factor",
    "@xmath43 , we obtain @xmath44 .",
    "\\label{eqn : lorentz - direction}\\ ] ] note that this relation no longer contains neutrino energy and the angle - transformations are decoupled from the energy transformations .",
    "this is a great simplification , which we make full use of in the following , and is a consequence of the assumption that neutrinos are massless .",
    "the solid - angle element is then transformed as @xmath45    in the boltzmann equation , neutrino - matter interactions are described in the collision terms .",
    "as is well known , they are obtained most easily in the fluid - rest frame .",
    "we hence evaluate the collision term in this frame and use eq .",
    "( [ eq : collisionrela ] ) to obtain the expression in the laboratory frame .",
    "the interactions that we take into account in this paper are the same as those in @xcite , the minimum set for supernova simulations . since @xcite worked in the newtonian approximation , we need the following replacements to employ their collision terms : @xmath46 & \\rightarrow & \\bigl ( \\frac{\\delta f}{\\delta \\tilde{t } } \\bigr)_{{\\rm col}}^{\\rm{fr } } , \\nonumber \\\\",
    "\\varepsilon & \\rightarrow & \\varepsilon^{\\rm{fr } } , \\nonumber \\\\   \\omega & \\rightarrow & \\omega^{\\rm{fr } } , \\nonumber \\\\",
    "r _ { * } & \\rightarrow & r_{*}^{\\rm{fr } } , \\label{eq : replacement}\\end{aligned}\\ ] ] where @xmath47 denotes reaction kernels .",
    "here we take the collision terms for the isoenergetic scatterings in the laboratory frame and see how the neutrino - number conservation is ensured , which will be useful in the next section . following @xcite and implementing the above replacements",
    ", we can write them as @xmath48 where @xmath49 and @xmath50 denote the isoenergetic scattering - kernel and neutrino distribution function @xmath11 in the fluid - rest frame , respectively .",
    "the integration of eq .",
    "( [ eq : isoenergyscatkenel ] ) over the solid angle @xmath51 vanishes due to symmetric properties of scattering kernel : @xmath52 .",
    "this represents the conservation of neutrino number for the isoenergetic scatterings at each energy in the fluid - rest frame .",
    "the origin of difficulties in the sr treatments is the fact that the neutrino momentum space is distorted by lorentz transformations , i.e. , the isoenergy surfaces in the laboratory frame do not coincide with the counterparts in the fluid - rest frame .",
    "we then need highly accurate interpolations in energy of @xmath11 , taking care of neutrino - number conservation , whose difficulties in the @xmath3 method were elucidated in section  [ sec : difficulty ] .",
    "we overcome these difficulties by employing not the grid shown in the left panel of fig .",
    "[ momspacedist ] but the so - called lagrangian remapped grid ( hereafter _ lrg _ ) in the laboratory frame , which is lorentz - transformed from the fluid - rest frame .",
    "it is emphasized that _ lrg _ is the one we mainly use in our eulerian approach . in figure",
    "[ momspacedist_laremap ] , we display the schematic picture of our _ lrg _ ( see also figure  [ momspacedist ] for comparison ) . in this method , the energy grid is constructed so that it should be isotropic in the fluid - rest frame .    as a consequence ,",
    "it becomes anisotropic in the laboratory frame as observed in the left panel .",
    "the energy grids obtained in the laboratory frame that way are different from point to point at each time and change also in time because of inhomogeneous fluid motions .",
    "thanks to the isotropic energy grids in the fluid - rest frame , no special care is needed in the treatment of the isoenergetic scatterings on this grid . note that the angular mapping is independent of energy .",
    "the angular grid is constructed , on the other hand , so that it should be uniform in the laboratory frame .",
    "it implies that the angular mesh is non - uniform in the fluid - rest frame as shown in the right panel .",
    "in contrast to the energy grid , the non - uniform angular grid in the fluid - rest frame causes no practical problems ( see eq .",
    "( [ eq : omegainteg ] ) for the correction by angular aberration ) .",
    "one may say that the lagrangian remapping method is nothing but the canonical lagrangian approach , but there are several differences between the two .",
    "one of the important differences lies in the treatment of advection terms on the left hand side of the boltzmann equation . as we have already mentioned in section  [ sec",
    ": intro ] , the advection terms are fairly complicated in the lagrangian approach due to the spatial inhomogeneities and temporal changes of matter velocity . we demonstrate this in a simplified situation in figure  [ lagremap_com_labo ] . here , we consider neutrinos propagating outwards ( or rightwards in the figure ) in optically thin matter .",
    "we further assume that the matter is moving inwards ( or leftwards in the figure ) at velocities that are piecewise constant with @xmath53 ( see the bottom panel in this figure ) .",
    "the discontinuity may be regarded as a standing shock wave .    in this situation ,",
    "the neutrino - energy spectrum in the laboratory frame is uniform in space , since neutrinos are not interacting with matter at all ( see the upper picture ) .",
    "this is not the case in the fluid - rest frame , however .",
    "it is in fact blue - shifted at the discontinuity of matter velocity ( see the middle picture in figure  [ lagremap_com_labo ] ) . in the lagrangian picture , such energy shifts are expressed as the advection in energy space and given by the partial derivative with respect to energy on the left hand side of the boltzmann equation . in the present case , there should be an infinite energy flux at the discontinuity . in our lagrangian remapping method ,",
    "on the other hand , we work in the laboratory frame , in which the energy grid is anisotropic as shown in the left panel of figure  [ momspacedist_laremap ] and the blue - shift in the spectrum is just compensated for by the contraction of the energy grid in the outward direction and , as a consequence , the energy spectrum is unchanged across the discontinuity ( see the upper picture in figure  [ lagremap_com_labo ] ) .",
    "it is easily understood that the use of _ lrg _ , which is anisotropic and spatially non - uniform , complicates the calculation of spatial and neutrino - angular advection , a problem similar to the one in the ordinary lagrangian method .",
    "this is mitigated in our method , however , by the introduction of yet another energy grid , which is isotropic and identical at all spatial grid points in the laboratory frame ( referred hereafter to as the laboratory - fixed grid or _",
    "lfg _ ; see also section  [ subsec : step4 ] for more details ) .",
    "_ lfg _ is employed only to calculate the neutrino advection .",
    "note that as long as we work in the laboratory frame , energy - derivative terms do not appear explicitly on the left hand side of the boltzmann equation and the advection on the _ lfg _ is particularly simple .",
    "it should be repeated that _",
    "lfg _ is a grid only for temporary use to treat the neutrino advection .",
    "accordingly @xmath11 on the _ lfg _ , which is obtained by interpolation in our method , is also a temporal variable . instead",
    ", @xmath11 on _ lrg _ is the quantity to be solved and stored in our code .",
    "in this section , we explain the detailed numerical algorithm to implement various elements described above to our boltzmann - hydro solver , paying particular attention to the usage of different energy grids .",
    "figure  [ flowchartboltzhydro ] summarizes multiple steps needed to update a numerical solution from @xmath54 to @xmath55 , where the superscripts represent the time steps . in the following ,",
    "we describe each step in order in detail .      in our boltzmann - hydro solver ,",
    "the operator splitting is employed : we first compute hydrodynamics , neglecting neutrino interactions , i.e. , in the adiabatic manner ; then from step  2 through step  4 we perform neutrino transfer for the matter distribution given in the first step as described below ; feedbacks from neutrino interactions to the internal energy , velocity and electron fraction of matter are taken into account in step  5 .",
    "the numerical code for the hydrodynamical evolution is essentially the same as that in @xcite .",
    "it is based on the so - called central scheme with an explicit time evolution @xcite .",
    "the code was successfully applied to the simulations of standing accretion shock instability ( sasi ) in the post - bounce phase in our previous study @xcite .",
    "it is also noted that a series of standard tests for hydrodynamical schemes ( e.g. , shock tube problems ) were carried out in @xcite .",
    "although our boltzmann solver is fully sr , the hydrodynamics solver is newtonian . as a matter of fact , it is fully general relativistic @xcite except for its gravity solver , which is newtonian and based on the miccg technique @xcite .",
    "the implementation of an einstein equation solver is currently underway , the perspective of which will be mentioned in section  [ sec : summary ] .    the basic equations of newtonian hydrodynamics in spherical coordinates are written in the following form : @xmath56 where each term is given as @xmath57 note that @xmath58 corresponds to the interactions between neutrinos and matter ( the explicit expressions will be presented in step  5 ) and @xmath59 denotes the volume factor in the spherical coordinates .",
    "other variables , @xmath60 , @xmath61 , @xmath62 , @xmath63 , @xmath64 , and @xmath65 , are the mass density , pressure , internal energy density , electron fraction , fluid velocity , and newtonian gravitational potential , respectively .",
    "the newtonian self - gravity is solved with the poisson s equation , @xmath66    in our central scheme , the above system of equations is finite - differenced in space with the piecewise parabolic ( ppm ) interpolation and the total - variation diminishing ( tvd ) runge - kutta method is employed for time integration , which achieves second - order accuracy in both space and time .",
    "we adopt the procedure proposed by @xcite in solving the energy equation ( the 5th component in eq .",
    "( [ eq : hydroconservativeform ] ) ) , which reduces secular errors in the energy conservation .    throughout this paper ,",
    "we use shen s equation of state ( eos ) @xcite with lepton and photon contributions being added .",
    "( see e.g. , @xcite ) .",
    "the original eos table is rather coarse for the simulation of ccsne . indeed",
    ", we have found that tri - linear interpolations in the original table reduce the accuracy of simulations particularly at the transition from inhomogeneous to homogeneous nuclear matter .",
    "we have hence reconstructed a new eos table by interpolating all quantities with the tricubic hermite functions .",
    "it is several times finer in @xmath67 and @xmath68 than the original table .      in our boltzmann solver ,",
    "transformations between different energy grids are frequently performed . as mentioned in section",
    "[ sec : difficulty ] , we will be able to deploy at most @xmath12 energy bins , a rather coarse resolution .",
    "we hence need a subgrid modeling of neutrino - energy spectrum .",
    "it is also important for computing fluxes at grid boundaries . as a matter of fact ,",
    "if we did not take into account such subgrid distributions and assumed instead that neutrinos are populated uniformly in each grid , then a large number of neutrinos could artificially leak to neighboring grids either by inaccurate numerical fluxes or by imprecise interpolations ( see also step  4 on this issue ) .    in the reconstruction one should pay an adequate attention to the following two conditions :    * monotonicity * conservation of neutrino numbers    the first condition is familiar in the numerical treatment of hyperbolic systems and necessary to avoid artificial generation of extrema in spectra , which may cause numerical instabilities .",
    "the importance of the second condition is rather obvious .",
    "in fact , if it were violated , neutrinos would appear or disappear just by changing energy grids .",
    "as shown later , this condition is particularly important in the evaluation of @xmath11 on _ lfg_. note that the value of @xmath11 on each grid point actually represents the average in the energy bin in our formulation .",
    "the reconstruction procedures are schematically shown in figure  [ reconstruction_notmono ] , in which we are going to construct the subgrid energy spectrum for energy bin a in _ lrg_. in so doing , not only grid point a but also neighboring grid points b and c are utilized .",
    "we distinguish two cases :",
    "( 1 ) @xmath11 takes an extremal value locally on grid point a , i.e. , both of @xmath11 s on grid points b and c are either larger or smaller than @xmath11 on grid point a ; ( 2 ) otherwise .",
    "the left panels in figure  [ reconstruction_notmono ] correspond to the first case .",
    "as shown there , we assume in this case a flat spectrum in the energy bin .",
    "this is not a bad approximation , since the actual spectrum is indeed nearly flat in the vicinity of a local extremum . in the second case ,",
    "in which @xmath11 changes monotonically over the neighboring three grid points , we reconstruct a subgrid spectrum as follows , which is shown in the right panels in figure  [ reconstruction_notmono ] .",
    "we first determine the value of @xmath11 on the left and right interfaces of energy bin a as the averages of adjacent grid - point values in the logarithmic scale .",
    "they are referred to as @xmath69 ( @xmath70 ) , respectively .",
    "we use the grid widths for the weight in the average .",
    "we also define @xmath71 and @xmath72 as the largest ( smallest ) of @xmath69 and @xmath70 . denoting the grid - point value of @xmath11 by @xmath73",
    ", we first construct a trial spectrum @xmath74 as follows : @xmath75 where @xmath76 , @xmath77 , and @xmath78 are the energies at the left and right interfaces and grid point , respectively ; @xmath79 , @xmath80 and @xmath81 are the corresponding values of @xmath10 given as @xmath82 it is clear that this expression becomes exactly correct if neutrinos are in thermal equilibrium and take a fermi - dirac distribution .",
    "it is obvious , however , that @xmath83 does not ensure the conservation of neutrino number .",
    "we hence need to modify @xmath83 .",
    "we first integrate @xmath84 in the energy bin to obtain the neutrino number , @xmath85 in it .",
    "this should have been equal to @xmath86 , the true value .",
    "using the ratio , @xmath87 we scale the temporary spectrum as @xmath88 to obtain a new subgrid spectrum , which by definition satisfies the conservation of neutrino number exactly .",
    "the new spectrum so obtained do not satisfy the monotonicity condition in general , which requires that @xmath11 should always lie between @xmath71 and @xmath72 .",
    "we hence apply a limiter if @xmath84 exceeds @xmath71 and/or @xmath72 : @xmath84 are modified so that they would lie in between . owing to this limiter ,",
    "@xmath85 obtained by integration of the new subgrid spectrum , again deviates from @xmath86 .",
    "we repeat the above procedure until the following condition is satisfied : @xmath89 is a measure of convergence and is set to @xmath90 .",
    "it is important that the convergence of this iteration is guaranteed mathematically and that no artificial extremum emerges in the reconstructed spectrum .      here",
    "we carry out the lagrangian remapping of neutrino - energy grids and compute the change in @xmath11 on _ lrg_. the subgrid energy spectrum , which is obtained in the previous step , play an important in this process .",
    "the procedure is summarized in figure  [ eneshiftfreconst ] .",
    "suppose that @xmath91 time integrations have been finished and all quantities associated with matter and neutrinos have been obtained at @xmath92 .",
    "the upper panel shows the grid - point values of @xmath11 as well as subgrid spectra in three consecutive energy binges on _ lrg _ at @xmath54 .",
    "note that the angular dimensions are suppressed in the figure .",
    "in step  1 , matter velocities are changed . as explained in section  [ sec : twoenegrids ] , _ lrg _ is determined so that the neutrino - energy grid be identical in each instantaneous fluid - rest frame .",
    "we hence need to update _ lrg _ accordingly as shown with green lines in the middle panel of figure  [ eneshiftfreconst ] .",
    "it is then evident that @xmath11 should be also changed on account of the shifts of the grid boundaries .",
    "as shown in the figure , neutrinos in the shaded areas determine the change of @xmath11 due to this remapping .",
    "to evaluate the numbers of neutrinos in these regions , we use @xmath93 , the interface value of @xmath11 on the old _ lrg _ at @xmath54 .",
    "it is obtained as the smaller one of the two interface values derived from the subgrid spectra in the adjacent grids in order to prevent the moving of too many neutrinos . with this @xmath93 and the energies at the grid interfaces on the old ( @xmath94 ) and new ( @xmath95 ) _ lrg _ s ,",
    "the number of neutrinos to be moved to the adjacent grid @xmath96 is given by @xmath97 where @xmath98 is the extent of solid angle of the bin . ] .",
    "note that the conservation of neutrino number is automatically guarantied in this process .",
    "we end up this step with a construction of the subgrid spectrum for the modified neutrino number ( and accordingly @xmath11 ) in each energy bin just in the same way as in step  2 .",
    "it is emphasized that no interactions of neutrinos with matter have been taken into account yet up to this point .",
    "the change in @xmath11 considered above is induced by the acceleration or deceleration of matter ( and hence of the local fluid - rest frame ) . as explained in section  [ sec : twoenegrids ] in detail ,",
    "if such a change in matter velocity occurred in optically thin matter , the neutrino energy spectrum should not change in the laboratory frame .",
    "the red or blue shifts of the energy spectrum in the fluid - rest frame are compensated for by the lagrangian remapping in our method .",
    "it should be also noted that the energy shift is proportional to the time step @xmath13 and is small as a consequence , the fact which is true even in the shock wave .",
    "this not only justifies the above estimation of @xmath96 but also is a huge advantage in the use of _ lrg _ compared with other lagrangian formulations , in which large energy shifts may occur .",
    "now that the energy shift induced by matter motions has been treated , the remaining task is to consider the spatial advections and collisions of neutrinos .",
    "the latter is easy on _ lrg _ , which is essentially the comoving grid , and will be briefly explained at the end of this section .",
    "the former , on the other hand , is fairly complicated , since _",
    "lrg _ is not uniform in space .",
    "in contrast to the ordinary lagrangian formulation , in which the spatial advection is expressed as complicated partial derivatives , our method utilizes the fact that the advection is very simple in the laboratory frame .",
    "_ lfg _ defined in section  [ sec : twoenegrids ] is the main tool here .    as explained in section  [ sec : twoenegrids ] , _ lfg _ is defined so that the energy grids are identical everywhere in space and it does not depend on the flight direction of neutrino .",
    "in addition _ lfg _ should have the following properties :    * _ lfg _ covers the union of all energy ranges in _ lrg_. * each energy bin in _ lrg _ is covered by more than one energy bins in _",
    "these conditions are important to ensure the accuracy in the evaluation of the advection terms .",
    "figure  [ lrg_lfggrids ] displays the example of the relation between the two grids in the laboratory frame .",
    "given _ lfg _ , we evaluate the advection term as follows .",
    "we suppose that the n - th time step has been completed and @xmath99 is given on each _ lrg _ and the subgrid spectrum has also been constructed according to step  2 ( see panel  a in figure  [ lfgridfigure ] ) . using this subgrid spectrum , which is denoted by @xmath100 in this section , we assign @xmath11 to each grid point in _ lfg _ , which is denoted as @xmath101 : @xmath102 where @xmath103 corresponds to the neutrino energy at the grid point in _ lfg _ ( see panel  b in the same figure , in which _",
    "lfg _ is presented in green while _",
    "lrg _ is shown with black dots . ) . here",
    "we would like to emphasize again that the spatial and angular advection terms on _ lfg _ ( the left hand side of eq .",
    "( [ eqn : eqtransfin - spherical ] ) ) are very simple .",
    "in fact , we can employ the same method as used in @xcite , which is linearly interpolated from _",
    "lrg _ to _ lfg _ in the present formulation .",
    "since @xmath104 takes a value in the range of 0.5 to 1 and does not strongly depend on the neutrino energy unlike @xmath11 , the simple linear interpolation is justified . ] .",
    "once the numerical fluxes for the spatial and angular advections are obtained on _ lfg _ , we then calculate the corresponding numerical fluxes for _ lrg _ as follows .",
    "we take as an example panel b in figure  [ lfgridfigure ] . as mentioned earlier , _ lfg",
    "_ is finer than _ lrg_. energy bin a in _ lrg _",
    ", for instance , is covered by three bins c , d and e in _ lfg_.",
    "let us look at bin e in _ lfg _ , which overlaps with bins a and c in _",
    "lrg_. the numerical flux in _ lfg _ should be hence shared with the latter two bins in _",
    "lrg_. for that purpose , we introduce a factor , @xmath105 , as defined shortly and divide the numerical flux @xmath106 into @xmath107 and @xmath108 .",
    "@xmath105 is defined as @xmath109 with @xmath110 where @xmath111 is the neutrino energy at the interface of bins a and c in _ lrg _ and @xmath112 is the energy at the left ( right ) boundary of bin e in _ lfg _ ; @xmath113 is the grid - point value of @xmath11 for bin a(b ) in _ lrg_. the numerical flux for bin a of _ lrg _ is a sum of the contributions from bins c , d and e in _ lfg _ , each obtained in this manner .",
    "so far we have explained our treatment of the spatial and angular advection terms as if they were finite - differenced explicitly in time . as a matter of fact",
    ", we treat them implicitly in our method .",
    "this is important from a point of view of numerical stability and computational times . in the following",
    ", the detailed procedure is described .",
    "we first rewrite the boltzmann equation ( eq .",
    "( [ eqn : eqtransfin - spherical ] ) ) as @xmath114 in which the second term on the left hand side is the sum of spatial and angular advection terms .",
    "since the following treatment is common to each term in the sum , we drop the subscript @xmath115 hereafter .    in the implicit approach ,",
    "both the advection and collision terms are evaluated at @xmath116 and the finite - differenced equation is written as @xmath117 it is noted , however , that @xmath118 in sr is evaluated via the complex interpolation of @xmath11 between _ lfg _ and _ lrg _ and is nonlinear and highly complicated .",
    "this prevents us even from linearizing the equation and the implicit treatment of advection terms seems impossible .",
    "it is noteworthy , however , that in the newtonian approximation , in which no distinction is made between the fluid - rest and laboratory frames , the advection term is linear and can be treated completely implicitly .",
    "in fact the resultant non - relativistic ( nr ) equation can be cast into the following form ( see also @xcite ) : @xmath119 where @xmath120 is the nr advection term and the subscript @xmath121 indicates the spatial and angular grid points symbolically .",
    "coefficients @xmath122 , and @xmath123 are written as a function of space and flight directions .",
    "this fact suggests the following scheme for the advection term in sr : @xmath124 the first term on the right hand side is the relativistic advection term evaluated with @xmath99 and the second term in the parenthesis is a correction term .",
    "( [ eq : stabilizationa ] ) is only semi - implicit as it is .",
    "we hence replace @xmath99 in eq .",
    "( [ eq : stabilizationa ] ) by a trial value , @xmath125 and repeatedly solve the boltzmann equation ( eq .",
    "( [ eq : conboltzrewrite ] ) ) , updating @xmath125 with @xmath126 obtained for @xmath125 until they coincide with each other within a certain error .",
    "this ensures full - implicitness of our method as explained shortly",
    ".    the idea behind this method should be clear .",
    "if matter motion is not very fast compared with the speed of light , which is indeed the case in ccsne , @xmath127 is almost equal to @xmath128 , and @xmath118 will be dominated by @xmath129 .",
    "then this scheme is close to the nr implicit scheme .",
    "in addition , there are other important properties in the prescription : firstly if @xmath125 coincides with @xmath126 , as is the case at the end of iterations , the correction term vanishes and only @xmath130 remains .",
    "this property guarantees the full implicitness of our scheme .",
    "it is also mentioned that @xmath13 is actually limited most of times by the requirement that @xmath11 should not change by more than a few percent in a single time step , and the correction term is a small correction to the first term in most situations ( but see below for the exceptional case . ) . in spite of this",
    ", we find that this correction term significantly improves the numerical stability , enabling us to take larger @xmath13 .",
    "although the above method works fairly well most of times , it fails sometimes when the matter velocity reaches several tens percent of the speed of light and the correction term becomes significantly larger than @xmath127 . in such cases",
    "the iteration does not converge unless we reduce @xmath13 . to avoid too small a value of @xmath13",
    ", however , we introduce a limiter @xmath131 @xmath132 in which @xmath131 is determined so that the correction term should not exceed the first term .",
    "it is stressed that such a prescription is just a technique to improve the convergence and does not affect the final result , since the second term vanishes in the end anyway .",
    "we turn to the collision terms before closing this section .",
    "there are no new difficulties in their treatment , since _",
    "lrg _ is essentially the same as the fluid - rest frame employed in the ordinary lagrangian methods .",
    "there is one feature , however , which is original in our method .",
    "the angular dimensions in momentum space are discretized in the same manner everywhere on _",
    "( see the left panel of figure  [ momspacedist_laremap ] ) .",
    "this means that the angular gridding is not uniform in the fluid - rest frame due to aberration by lorentz transformation .",
    "the angular integration as shown in eq .",
    "( [ eq : isoenergyscatkenel ] ) for the isoenergetic scattering is normally performed in the fluid - rest frame . in our approach , however , that is done on _ lrg _ in the laboratory frame . in so doing ,",
    "the aberration effect is taken account of as the jacobian as follows @xmath133 where @xmath134 is an arbitrary function of @xmath51 and @xmath135 is defined as @xmath136 .",
    "the jacobian ( @xmath137 ) has already been derived in eq .",
    "( [ eqn : solidrela ] ) .",
    "as mentioned earlier , the collision terms are treated fully implicitly .",
    "the point is that the matrix structure originated from the collision terms is exactly the same as the one for the nr case , which implies that the numerical tools developed for our newtonian code @xcite can be utilized for the present code as they are . as a matter of fact , thanks to this implicit treatment of collision terms the time steps @xmath13 in the 1d test simulation of ccsne ( see section  [ subsec:1dsrboltz_hydro ] ) are comparable to those in our previous simulations with a 1d implicit gr lagrangian boltzmann - hydro code @xcite .      solving the boltzmann equations in the previous step , we now treat feedbacks from the neutrino - matter interactions to hydrodynamics .",
    "the hydrodynamics equations and the conservation equation for electron number are written as)([eq : systemeqcompo ] ) ] @xmath138 where the right hand sides correspond to the feedbacks and are written as @xmath139 in these expressions , the invariant volume in the momentum space is denoted by @xmath140 and the subscript `` @xmath141 '' indicates the neutrino species .    at the very end of all steps , we again perform steps  2 and 3 , since matter velocities are changed due to the momentum exchange between matter and neutrinos .",
    "this closes the update from @xmath54 to @xmath116 .",
    "we iterate these steps as many times as needed .",
    "in order to validate our new formulation of sr boltzmann radiation - hydrodynamics , we carry out a series of code tests .",
    "we first focus on the boltzmann solver , i.e. , the feedbacks to hydrodynamics are ignored .",
    "we test the advections and collisions separately in idealized setups in order to see the code performance in each sector clearly . in these tests , only electron - type neutrinos are taken into account , since the treatments of sr effects are common to other species .",
    "we then perform sr boltzmann - hydro simulations of 1d spherical core collapse for the @xmath1 progenitor . in these test runs ,",
    "we consider 3 species of neutrinos ( @xmath142 , @xmath143 , and @xmath144 ) and implement minimal but essential microphysics . for comparison , a nr simulation is also performed .",
    "based on the two results , we discuss the importance of sr effects .      as discussed in section  [ sec : difficulty ] , the isoenergetic scattering is the primary source of difficulties in the @xmath3 method for the sr boltzmann equation .",
    "this test is meant to see whether our code can properly handle this process .",
    "this is a single zone calculation , in which we deploy only one spatial grid and the advection term is neglected .",
    "we are concerned only with the collision term .",
    "hydrodynamical quantities are assumed to be constant in time and set as @xmath145 , @xmath146mev , and @xmath147 , where @xmath60 , @xmath68 , and @xmath148 denote the density , temperature and electron fraction , respectively . under this thermodynamical condition ,",
    "free nucleons and nuclei are both existent .",
    "we hence consider the following isoenergetic scatterings : @xmath149    although we drop the advection term in this test , we set a non - vanishing velocity as follows : @xmath150 where @xmath151 , @xmath152 , and @xmath153 denote the radial , @xmath23 , and @xmath24 components , respectively .",
    "they are assumed to be constant in time and are controlled by three parameters , @xmath7 , @xmath154 and @xmath155 . in this test",
    ", we set @xmath156 , @xmath157 , and @xmath158 , respectively .",
    "note that this velocity is considerably large by the ccsne standard .",
    "we assume that neutrinos are distributed isotropically in the laboratory frame initially , and they have fermi - dirac distributions in energy .",
    "the neutrino chemical potential can be obtained by the assumption that neutrinos are chemical equilibrium with matter . since matter has a non - vanishing velocity ,",
    "neutrinos are initially _ anistropic _ in the fluid - rest frame .",
    "then , @xmath11 should evolve towards an isotropic distribution in the latter frame by the isoenergetic scattering .    for this test ,",
    "momentum space is covered with a grid of @xmath159 points in energy and @xmath160 points in angles .",
    "the gridding of _ lrg _ has been explained in detail in section  [ sec : twoenegrids ] and figure  [ momspacedist_laremap ] ( see also @xcite for the construction of angular grid ) .",
    "we show the numerical results in figures  [ scattest1 ] to [ scattest5 ] .",
    "figure  [ scattest1 ] displays the evolutions of @xmath11 for different angles but with the same energy ( @xmath161  mev ) in the fluid - rest frame .",
    "as is expected , initially different values of @xmath11 are changed by the isoenergetic scatterings and converge to a certain value by the time @xmath162s .",
    "note that we work on _ lrg _ in the laboratory frame and these results are obtained by the lorentz transformation to the fluid - rest frame .",
    "the final isotropic distribution , @xmath163 , can be obtained analytically from the initial condition , @xmath164 , since isoenergetic scatterings do not change the number of neutrinos : @xmath165 where the subscript @xmath141 specifies the angular grid points .",
    "it is evident from the figure that the correct results are obtained numerically .",
    "figure  [ scattest2 ] shows the angular evolution of @xmath11 on an iso - energy surface with @xmath161  mev in the fluid - rest frame . in the figure ,",
    "wire - framed pictures are drawn as follows : for each angular grid point , a node is placed at a distance proportional to the value of @xmath11 in the corresponding direction ; the neighboring nodes are then connected by lines ; we use the normalization , in which the maximum distance should be unity . as a consequence , an isotropic distribution corresponds to the unit sphere in this figure .    at the beginning ( top left panel ) , the wire frame is elongated in one direction , indicating that the angular distribution is highly anisotropic .",
    "as time passes , however , it changes shapes and eventually ( @xmath162s ) becomes isotropic although it may not appear so .",
    "this is due to the rather low resolution in this computation .",
    "indeed , figure  [ scattest3 ] , which presents the result for a higher resolution ( @xmath166 , @xmath167 ) , more clearly isotropy of the final distribution .",
    "it is also reminded that the angular grid is not uniform in the fluid - rest frame due to aberration ( it is uniform in the laboratory frame . see section  [ sec : twoenegrids ] ) .    as an alternative presentation of isotropization",
    ", we show in figure  [ scattest4 ] the initial and final energy spectra for two different angles in the fluid - rest frame .",
    "as demonstrated evidently in this figure , the initially different spectra converge at the end , implying that neutrino distributions become isotropic at all energies . in figure  [ scattest5 ]",
    "we show the same evolution in the laboratory frame , which is actually the frame we use for simulations .",
    "contrary to the previous case , the initially identical spectrum for different angles is separated as time passes in the laboratory frame , indicating that the final distribution is anisotropic in this frame as it should .      to the isoenergetic scatterings , we add emissions and absorptions on nucleons and nuclei :",
    "@xmath168 the initial condition and computational set - up are the same as those in the previous test .",
    "figure  [ allreactiontest1 ] shows the evolution of @xmath11 for different angles but with the same energy ( @xmath161  mev ) in the fluid rest frame , which corresponds to figure  [ scattest1 ] . at first",
    "the isoenergetic scatterings isotropize the distribution in the fluid - rest frame just as in the previous case . by the time @xmath162s ,",
    "the neutrino distribution is almost isotropic .",
    "note that it is not a fermi - dirac distribution at this time , i.e. , neutrinos have not yet achieved chemical equilibrium with matter via emissions and absorptions .",
    "it is eventually established at @xmath169s for this energy of neutrinos .",
    "neutrinos with other energies undergo similar evolutions and reach fermi - dirac distributions at different times .",
    "it is stressed again that this computation is done on _ lrg _ and the distribution in the fluid - rest frame is obtained via a lorentz transformation .",
    "we now turn to the advection term .",
    "note that this is the main source of difficulties in the ordinary lagrangian methods .",
    "our formulation treats the spatial and angular advections in the laboratory frame but employs interpolations between two grids ( _ lrg _ and _ lfg _ ) as detailed in section  [ subsec : step4 ] .",
    "it is hence important to confirm that the scheme indeed works properly .    here",
    ", we consider the advection in matter that has a discontinuous velocity distribution .",
    "this is certainly the most difficult situation for our method .",
    "in contrast to the previous tests , we cut off all neutrino - matter reactions , assuming that the matter is optically thin , and consider the advection term alone . note that in this case , the energy spectrum of neutrinos is unchanged as they propagate through the discontinuity in the laboratory frame whereas it undergoes a discontinuous change there in the fluid - rest frame ( see also figure  [ lagremap_com_labo ] ) .",
    "we further assume spherical symmetry in this test , i.e. , we omit derivative terms with respect to @xmath23 , @xmath24 , and @xmath26 in eq .",
    "( [ eqn : eqtransfin - spherical ] ) .",
    "the computational set - up is as follows . to avoid geometrical complications",
    ", we consider the advection in a wafer - thin spherical shell : the computational domain covers the range of @xmath170  cm by a uniform radial grid of 6 bins .",
    "the matter velocity is piecewise constant with a discontinuity between the 3rd and 4th grid points : v=0 for the first 3 grid points and @xmath171 for the rest of grid points .",
    "these velocities are again fixed during the computation .",
    "we inject out - going neutrinos from the radial inner boundary with the fermi - dirac distribution that is the same as in the previous tests and follow the subsequent evolution until a steady state is obtained .",
    "we deploy an _ lrg _ of @xmath172 and @xmath173 .",
    "figure  [ trasfertest1dvelodisco ] shows that the energy spectra for out - going neutrinos ( @xmath174 ) in the vicinity of the velocity discontinuity in the laboratory frame ( left panel ) and in the fluid - rest frame ( right panel ) .",
    "as is expected , neutrinos advect without any change of their spectrum when they pass through the discontinuity in the laboratory frame .",
    "we can also see in this figure that the energy bins for the outer two radial grid points are shifted from those for the inner two .",
    "the right panel shows the same spectrum but observed in the fluid - rest frame . due to the negative radial velocity in the outer region , neutrinos are blue shifted there ( see also figure  [ lagremap_com_labo ] ) . as demonstrated clearly in this test",
    ", our new formulation can reproduce the results just as expected without any numerical problems .",
    "this test is meant to check the multi - d advection in the optically thin matter with an inhomogeneous non - radial velocity distribution .",
    "we assume that the neutrino distribution is spherically symmetric in space .",
    "this is no problem , since the matter is optically thin and there is no interaction between the matter and neutrinos .",
    "this poses a challenge in our method , however , since _",
    "lrg _ is not spherically symmetric in space and , as a consequence , there is no guarantee that the neutrino distribution remains spherically symmetric in our formulation .",
    "this test is hence good diagnostics on our handling of the spatial advection .",
    "the 3d velocity distribution is set in a similar way to that in the previous test , eq .",
    "( [ eq : vdistri_forcol ] ) , but with an additional spatial dependence : @xmath175 we again set a non - vanishing non - radial velocity by choosing @xmath157 , and @xmath158 .",
    "@xmath176 is given as follows : @xmath177 where @xmath178 and @xmath179 denote , respectively , the maximum and minimum radii of the computational region , which is the spherical shell with @xmath180 cm , @xmath181 and @xmath182 .",
    "we deploy to this computational domain an _ lrg _ with @xmath183 . in the following",
    "we demonstrate that the neutrino distribution remains spherically symmetric with this small number of spatial and angular grid points .",
    "we inject from the inner boundary out - going neutrinos with the fermi - dirac distribution employed in the previous tests .",
    "the simulation is continued until the neutrino distribution becomes steady .",
    "we summarily display the results of this test in figure  [ 3dtransfertest ] .",
    "the upper left panel shows the energy spectra for different @xmath184 s ( with @xmath174 being fixed ) at @xmath185 and @xmath186 in the laboratory frame .",
    "note that if the neutrino distribution is exactly spherically symmetric , these spectra should coincide with each other . as seen in this figure , they agree quite well despite they are computed on the _ lrg _ , which is not spherically symmetric .",
    "the upper right panel is the same as the upper left , but for @xmath187 .",
    "note that these neutrinos propagate in a non - radial direction .",
    "again their spectra depend on @xmath26 very weakly . finally , we display in the bottom panel the energy spectra at a different radial location @xmath188 .",
    "this time , @xmath174 and @xmath189 are fixed and @xmath190 is varied .",
    "we can confirm also in this case that all energy spectra are in good agreement .",
    "it is emphasized again that these results are not trivial and , in fact , the test is very severe , since we assume here very fast matter motions ( @xmath191 of the speed of light ) with large inhomogeneities .",
    "we hence think that our new method works satisfactorily .",
    "so far we have tested the advection and collision separately in simplified set - ups . in reality , however , they are non - linearly coupled with each other and dictate the neutrino transfer and , as a consequence , the dynamics of ccsne . in order to confirm that our new method is indeed applicable to realistic simulations of ccsne , we conduct here a 1d spherically symmetric boltzmann - hydro simulation for the collapse of @xmath1 progenitor ( a non - rotating star with the solar metallicity referred to as s15.0 in @xcite ) .",
    "we employ an _ lrg _ with @xmath192 covering the computational domain of @xmath193 cm .",
    "for comparison , we also perform a nr simulation for the same set - up .",
    "although the simulation is continued after bounce until the shock wave is stalled , we focus here on the collapsing phase , since the infall velocity is largest and sr effects are most clearly discernible .",
    "figure  [ neutrinonumberevo ] shows that the evolution of the number density of @xmath142 at the center for both the sr and nr simulations . initially these two simulations follow almost the same evolutionary path . after the central density reaches @xmath194 , however , they start to deviate and become different by more than a factor of @xmath195 at @xmath196 . during the latter period , neutrinos undergo isoenergetic scatterings on nuclei",
    "called coherent scatterings and , as shown shortly , this is the source of discrepancy in fact .    in order to clearly see the sr effects by the matter motion , the left panels of figure  [ neutrinofluxcompare ] show as a function of radius the radial component of the number flux , i.e. , the energy - integrated first - angular moment of @xmath197 in the laboratory frame : @xmath198 where @xmath199 denotes the volume element of energy space in the laboratory frame .",
    "the upper panel corresponds to the time when the central density reaches @xmath200 whereas the bottom one shows the result at the time of @xmath201 , respectively . on the right panels ,",
    "matter velocities are displayed as a function of time for the same times .",
    "as is evident in the left panels , the number flux behaves qualitatively differently in the sr and nr cases : @xmath202 in the sr simulation is negative in the inner region ( @xmath203 km ) , whereas it is positive everywhere in the nr .",
    "simply put , neutrinos are moving in the opposite direction if sr is ignored .",
    "this is understood as follows ( see also section  [ sec : neutrinotrap ] ) : matter is optically thick to neutrinos in the inner region and neutrinos tend to diffuse outwards as observed in the nr simulation ; the matter is infalling , on the other hand , and tends to drag neutrinos inwards ; this is made possible by frequent interactions between the matter and neutrinos ; in fact , as demonstrated in sections  [ subsec : colisoenesca ] and [ subsec : colisoenesca_emiabs ] , scatterings and emissions / absorptions render the neutrino distribution isotropic in the fluid - rest frame and , as a consequence , produce a flux in the direction of velocity in the laboratory frame after lorentz transformation ; if sr is neglected , neutrinos are isotropically distributed even in the laboratory frame and no dragging occurs ; this is the cause for the discrepancy .",
    "note that this dragging ( and hence sr ) is crucially important for neutrino trapping as shown next .    in figure  [ ylevolutioncompare ]",
    ", we display the radial distribution of lepton fraction at two different times when the central density reaches @xmath204 and @xmath205 .",
    "the left panel presents the results of the sr simulation , while the right panel gives the nr counterpart .",
    "we can immediately recognize a remarkable difference . in the sr simulation ,",
    "two lines are almost the same , in particular for @xmath206 , where @xmath207 denotes the mass coordinate .",
    "this means that the lepton number is conserved in each fluid element as it should after neutrino trapping . for the nr case ,",
    "on the other hand , the lepton fraction is decreased even in the central region , while it is increased in the outer region .",
    "this means that neutrinos are diffusing outwards in the lagrangian frame even after neutrino trapping , which is consistent with what we observed in the number flux above .    in the lagrangian method ,",
    "the lepton - number conservation after neutrino trapping is handled almost trivially .",
    "our boltzmann - hydro solver is based on the eulerian picture , in which @xmath208 does evolve as a function of radius even after neutrino trapping .",
    "only when sr is taken into account appropriately , can we reproduce the correct evolutions .",
    "the results of this test simulation are hence the clearest evidence that our new method properly handles the neutrino advection .",
    "incidentally , we have also made a comparison with the result of 1d lagrangian gr simulations @xcite before bounce . ] and confirmed reasonable agreement between them ( although not shown here ) .    finally , we present the mass shell trajectories during the post - bounce phase ( until 150 ms after the bounce ) in figure  [ shmassshell ] . after bounce ,",
    "the shock wave propagates outwards initially through optically thick matter and generates a neutronization burst of @xmath142 when it breaks out of the neutrino sphere and is eventually stagnated at a certain radius in optically thin matter .",
    "these phases are , in general , difficult numerically for our method , since neutrino distributions evolve quite rapidly , and both optically thick and thin regions are involved , and a shock wave , i.e. a discontinuity in matter velocities , exists . in spite of these difficulties , our sr boltzmann - hydro code has run stably without problems .",
    "although we have to wait for more detailed quantitative analyses of this model and others in multi - d , which will be reported elsewhere as a sequel , the results shown so far indicate that our new code will be applicable to realistic ccsne simulations .",
    "in this paper we have presented a novel method to solve numerically the sr boltzmann equation in the laboratory frame based on the @xmath3 method , which overcomes technical difficulties inherent to the conventional approaches irrespective of the lagrangian or eulerian pictures .",
    "our method is hybrid , deploying the lagrangian remapped grids in the laboratory frame .",
    "the employment of _ lrg _ simply solves the difficulties in the treatment of scatterings , which plague the conventional eulerian approaches . as a trade - off ,",
    "the numerical treatment of the advection term becomes complicated as in the ordinary lagrangian approaches .",
    "this problem is mitigated by the use of _ lfg _ , which is nothing but the ordinary grid fixed to the laboratory frame and adopted in the conventional eulerian approaches .",
    "the advection becomes simplest on _",
    "lfg_. we have developed a scheme for the interpolation between _ lrg _ and _ lfg _ , which ensures the neutrino number conservation .    by carrying out a series of code tests",
    ", we have demonstrated that our new method works as expected , correctly handling both the collision and advection terms . with the same code , we have also conducted a 1d ccsne simulations from core collapse through bounce till shock stall for a realistic progenitor model of @xmath1 with the minimal set of microphysics .",
    "we have paid particular attention to the collapsing phase , in which matter velocities reach maximum and our code faces the greatest challenge .",
    "we have found that the neutrino - dragging due to matter motions , which is crucially important in neutrino trapping , is correctly captured in the sr simulation but not in the nr one .",
    "we have also observed only in the sr computation that the lepton fraction as a function of the lagrangian mass coordinates does not change in time in the optically thick region .",
    "these results clearly indicate that the adequate treatment of sr effects is critically important to obtain the lepton fraction correctly .",
    "the simulation was continued until the shock wave generated at bounce is stalled in the core .",
    "we have found no problem in the later phase , either , and we are now confident that our new method is applicable to the realistic simulation of ccsne .",
    "in fact , we have already started such simulations in 2d and their results will be reported together with further tests in multi - d in our forthcoming paper .",
    "it is finally stressed that our method could be applied to other more relativistic phenomena such as photon transfer in agn or grbs , since sr effects are taken into account to all orders of @xmath0 in our boltzmann code .",
    "these possibilities will be studied in the future .    at the very end of the paper we comment on the extension of our formulation to gr boltzmann - hydro simulations .",
    "we have recently published a paper on the conservative form of gr boltzmann equation @xcite , which , in flat space time , would reduce to the one used in the current study .",
    "it turns out that our lagrangian remapping method can be extended to this form of gr boltzmann equation with some modifications . as shown in eq .",
    "( 21 ) of that paper , gr modifies only the advection terms with the collision terms being essentially unchanged from the sr case . in the gr case , the choice of _ lfg _ is non - trivial",
    ". we may be able to use a local tetrad with a time - like unit vector , @xmath209 , orthogonal to the spatial hypersurface of @xmath210const .",
    "then one important difference from the sr case is that @xmath209 depends on space and time , which implies that the gr boltzmann equation has energy - derivative terms on the left hand side even in the laboratory frame , which is nothing but gravitational redshift .",
    "it is noted , however , these terms may not pose problems , since gravitational field change only gradually both in time and space .",
    "such extension is currently underway and will be published elsewhere .",
    "we are grateful to y. sekiguchi , a. mezzacappa , w. iwakami and s. furusawa for valuable comments on the multi - d neutrino transfer simulations .",
    "we also thank a. imakura , t. sakurai and h. matsufuru for the development of the matrix solver for the boltzmann equation .",
    "the numerical computations were partially performed on the supercomputers at high energy accelerator research organization ( kek ) under the support of its large scale simulation program ( 13/14 - 10 ) .",
    "we acknowledge the supercomputing resources at yukawa institute for theoretical physics ( yitp ) in kyoto university .",
    "this work was supported by grant - in - aid for the scientific research from the ministry of education , culture , sports , science and technology ( mext ) , japan ( 22540296 , 24103006 , 24740165 , 24244036 ) and hpci strategic program of japanese mext and k computer at the riken",
    "( project i d : hpci 130025 , 140211 ) .",
    "bruenn , s.  w.  1985 , , 58 , 771 burrows , a. , livne , e. , dessart , l. , ott , c.  d. , & murphy , j.  2006 , , 640 , 878 burrows , a. , dessart , l. , & livne , e.  2007 , supernova 1987a : 20 years after : supernovae and gamma - ray bursters , 937 , 370 burrows , a.  2013 , reviews of modern physics , 85 , 245 cardall , c.  y. , lentz , e.  j. , & mezzacappa , a.  2005 , , 72 , 043007 cardall , c.  y. , endeve , e. , & mezzacappa , a.  2013 , , 88 , 023011 dolence , j.  c. , burrows , a. , murphy , j.  w. , & nordhaus , j.  2013 , , 765 , 110 hubeny , i. , & burrows , a.  2007 , , 659 , 1458 janka , h .-",
    "2012 , annual review of nuclear and particle science , 62 , 407 kitaura , f.  s. , janka , h .-",
    "t . , & hillebrandt , w.  2006 , , 450 , 345 kotake , k. , takiwaki , t. , suwa , y. , et al .",
    "2012 , advances in astronomy , 2012 , kotake , k. , sumiyoshi , k. , yamada , s. , et al .  2012 ,",
    "arxiv:1205.6284 kurganov , a. , & tadmor , e.  2000 , journal of computational physics , 160 , 241 lentz , e. , bruenn , s.  w. , harris , j.  a. , et al .",
    "2012 , nuclei in the cosmos ( nic xii ) , liebendrfer , m. , rampp , m. , janka , h .-",
    "t . , & mezzacappa , a.  2005 , , 620 , 840 marek , a. , & janka , h .-",
    "2009 , , 694 , 664 mezzacappa , a. , & bruenn , s.  w.  1993 , , 405 , 669 mezzacappa , a. , liebendrfer , m. , messer , o.  e. , et al .  2001 , physical review letters , 86 , 1935 misner , c.  w. , & sharp , d.  h.  1964 , physical review , 136 , 571 mller , b. , janka , h .-",
    "dimmelmeier , h.  2010 , , 189 , 104 mller , b. , janka , h .-",
    ", & heger , a.  2012 , , 761 , 72 mller , b. , janka , h .-",
    ", & marek , a.  2012 , , 756 , 84 nagakura , h. , & yamada , s.  2008 , , 689 , 391 nagakura , h. , ito , h. , kiuchi , k. , & yamada , s.  2011 , , 731 , 80 nagakura , h. , yamamoto , y. , & yamada , s.  2013 , , 765 , 123 ott , c.  d. , burrows , a. , dessart , l. , & livne , e.  2008 , , 685 , 1069 peres , b. , penner , a.  j. , novak , j. , & bonazzola , s.  2013 , arxiv:1307.1666 shen , h. , toki , h. , oyamatsu , k. , & sumiyoshi , k.  2011 , , 197 , 20 shibata , m. , nagakura , h. , sekiguchi , y. , & yamada , s.  2014 , , 89 , 084073 sumiyoshi , k. , yamada , s. , suzuki , h. , et al .",
    "2005 , , 629 , 922 sumiyoshi , k. , yamada , s. , & suzuki , h.  2007 , , 667 , 382 sumiyoshi , k. , & yamada , s.  2012 , , 199 , 17 sumiyoshi , k. , takiwaki , t. , matsufuru , h. , & yamada , s.  2014 , arxiv:1403.4476 suwa , y. , kotake , k. , takiwaki , t. , et al .",
    "2010 , , 62 , l49 takiwaki , t. , kotake , k. , & suwa , y.  2012 , , 749 , 98 takiwaki , t. , kotake , k. , & suwa , y.  2013 , arxiv:1308.5755 woosley , s.  e. , heger , a. , & weaver , t.  a.  2002 , reviews of modern physics , 74 , 1015"
  ],
  "abstract_text": [
    "<S> we propose a novel numerical method for solving multi - dimensional , special relativistic boltzmann equations for neutrinos coupled to hydrodynamics equations . </S>",
    "<S> it is meant to be applied to simulations of core - collapse supernovae . </S>",
    "<S> we handle special relativity in a non - conventional way , taking account of all orders of @xmath0 . </S>",
    "<S> consistent treatment of advection and collision terms in the boltzmann equations is the source of difficulties , which we overcome by employing two different energy grids : _ lagrangian remapped _ and _ laboratory fixed _ grids . </S>",
    "<S> we conduct a series of basic tests and perform a one - dimensional simulation of core - collapse , bounce and shock - stall for a @xmath1 progenitor model with a minimum but essential set of microphysics . </S>",
    "<S> we demonstrate in the latter simulation that our new code is capable of handling all phases in core - collapse supernova . for comparison , </S>",
    "<S> a non - relativistic simulation is also conducted with the same code , and we show that they produce qualitatively wrong results in neutrino transfer . finally , we discuss a possible incorporation of general relativistic effects in our method . </S>"
  ]
}