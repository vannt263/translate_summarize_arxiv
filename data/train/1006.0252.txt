{
  "article_text": [
    "one of the most difficult challenges in computational statistical physics is sampling the low temperature equilibrium states of systems with complex free energy landscapes such as occur , for example , in spin glasses , configurational glasses and biomolecules .",
    "standard markov chain monte carlo ( mcmc ) methods such as the metropolis algorithm become stuck in local minima and are unable to correctly sample the equilibrium distribution . attempts to solve this difficulty generally involve simulating a broadened distribution that smooths the free energy landscape .",
    "one of the most widely used of these methods is parallel tempering or replica exchange monte carlo @xcite . in parallel",
    "tempering , many replicas of the system are simultaneously simulated using a standard mcmc method with each replica at a different temperature .",
    "the sequence of temperatures spans a range from high temperatures where the free energy landscape is smooth to the low temperatures of interest where it is rough .",
    "replica exchanges are allowed that permit replicas to move between low and high temperatures .",
    "the hope is that visits to high temperatures allow more rapid mixing of the markov chain and equilibration between different minima .",
    "closely related to the problem of sampling equilibrium is the problem of finding ground states of systems with complex energy landscapes . in computer science",
    "the same question arises for np - hard combinatorial optimization problems .",
    "one generic method for finding ground states or at least low lying states is simulated annealing  @xcite . in simulated annealing the system is subject to an equilibrating mcmc procedure at a sequence of temperatures .",
    "following this ` annealing schedule ' the system is gradually cooled through the sequence of temperatures from a high temperature where the free energy landscape is smooth to a low temperature where it is rough .",
    "the hope is that the system will explore many minima while the temperature is high and settle into the deepest minima as the temperature is gradually lowered .",
    "the population annealing algorithm introduced by hukushima and iba  @xcite is based on simulated annealing  @xcite but also shares features with parallel tempering , histogram re - weighting  @xcite and diffusion monte carlo  @xcite . like simulated annealing ,",
    "it is a single pass algorithm with an annealing schedule .",
    "a population of replicas of the system is simultaneously cooled following the annealing schedule . unlike simulated annealing , the population is maintained in equilibrium throughout the annealing process and an equilibrium sample is generated at every temperature .",
    "equilibrium is maintained by differential reproduction ( resampling ) of replicas according to their relative boltzmann weights .",
    "a useful by - product of the calculation of relative boltzmann weights is direct access to the equilibrium free energy at every temperature .",
    "methods for extracting free energy differences from population annealing are related to jarzinski s equality  @xcite .",
    "population annealing is an example of a sequential monte carlo scheme @xcite and is related to nested sampling methods  @xcite .    in  @xcite , hukushima and iba",
    "compare population annealing to parallel tempering and show that they produce results with comparable efficiency .",
    "however , they note that population annealing suffers biases for small population size .",
    "the main contribution of this work is to show that these biases , together with statistical errors , can be made arbitrarily small by using appropriate weighted averages over many independent runs of the algorithm .",
    "the weight factor is obtained from the free energy estimator from each run and the variance of this estimator serves as a useful diagnostic for the algorithm . as proof of principle of the method",
    ", we apply it to 1d and 3d spin glasses .    in the next section of the paper population annealing",
    "is described . in section",
    "[ sec : weight ] the weighted averaging procedure is introduced .",
    "section [ sec : sg ] describes simulations of the ising spin glass and the paper closes with a discussion .",
    "we now describe our implementation of the algorithm in detail . we start with a population of @xmath0 replicas of the system . for disordered spin systems , each replica has the same set of couplings .",
    "each replica is initialized at infinite temperature , @xmath1 , thus each replica is in an independent microstate chosen at random with equal probability from among the @xmath2 microstates of the system . for ising systems with @xmath3 spins , the microstates @xmath4",
    "are described by @xmath3 binary variables and @xmath5 . without loss of generality ,",
    "suppose that the average energy of the system at infinite temperature is zero , @xmath6 as is the case for the ising model .",
    "the algorithm can also be used with a finite initial temperature but then absolute measurements of the free energy are not available .",
    "the temperature of the set of replicas is now lowered while keeping the ensemble in equilibrium . in order to accomplish this ,",
    "the population is resampled ",
    "some replicas are reproduced and others are eliminated with the expected number of replicas held fixed .",
    "suppose we have a population of @xmath7 replicas chosen from an equilibrium ensemble at temperature @xmath8 and we want to lower the temperature to @xmath9 with @xmath10 .",
    "for a replica @xmath11 , with energy @xmath12 the ratio of the statistical weight at @xmath13 and @xmath14 is @xmath15 $ ] .",
    "this reweighting factor is typically large so that a normalization is needed to keep the population size reasonable .",
    "we compute normalized weights @xmath16 whose sum over the ensemble is @xmath7 , @xmath17}{{q}(\\beta,\\beta^\\prime)}\\ ] ] where @xmath18 is the normalization given by @xmath19}{\\tilde{r}_\\beta } .\\ ] ]    the new population of replicas is generated by resampling the original population .",
    "the number of copies of state @xmath11 in the new population is @xmath20 $ ] where @xmath21 $ ] is a poisson random variate with expected value @xmath22 .",
    "if @xmath20=0 $ ] , the configuration @xmath11 is eliminated .",
    "the size , @xmath23 of the population after the temperature step has expectation @xmath24 . in our implementation ,",
    "the size of the population is variable but stays close to the set of target values @xmath25 in contrast to the fixed population method introduced in  @xcite .    of course",
    ", the new population is now more correlated than before since several replicas may be in the same microstate .",
    "furthermore , to the extent that the energy distributions at the two temperatures do not overlap , the equilibrium distribution may no longer be adequately sampled at the lower temperature . in order to mitigate both of these difficulties , all replicas are now subject to an equilibrating mcmc process at the new temperature .",
    "the algorithm thus consists of a sequence of temperature steps with differential reproduction within the population according to the relative boltzmann weights followed by additional equilibration at the new temperature using a standard mcmc procedure . the ordered sequence of @xmath26 inverse temperatures",
    ", @xmath27 determines the annealing schedule .",
    "the population of @xmath28 replicas is equilibrated at @xmath29 using @xmath30 sweeps of the mcmc process .",
    "the temperature is now lowered to @xmath31 with differential reproduction as described above followed by @xmath32 mcmc sweeps .",
    "at each temperature , observables are measured after the mcmc sweeps and @xmath33 is recorded . in the present implementation , observables are measured _",
    "after _ resampling so that no weight factors are needed in taking averages .",
    "the temperature is lowered until @xmath34 is reached . in the simplest version of the algorithm",
    "the target population sizes and number of mcmc sweeps are independent of temperature , @xmath35 and @xmath36 for all @xmath13 .    either the mcmc process or the differential reproduction steps are in principle sufficient to produce equilibrium at the new temperature though neither one individually is efficient .",
    "however , the combined processes are substantially more efficient than either alone .",
    "one advantage of the algorithm is that it gives direct access to the free energy at each temperature .",
    "the normalization factor @xmath37 is an estimator of the ratio of the partition functions at the two temperatures , @xmath38 thus , the estimator of the free energy , @xmath39 at each simulated temperature @xmath40 is , @xmath41 this section concludes with pseudocode for the algorithm :    * population annealing *    initialize @xmath0 replicas at @xmath1 compute the partition function ratio @xmath42 compute the relative weight @xmath43 resample : make @xmath44 $ ] copies of replica @xmath45 + compute the population size @xmath46 equilibrate replica @xmath45 for @xmath32 monte carlo sweeps compute observables and the free energy at @xmath31",
    "unless the population size , number of temperature steps and number of mcmc sweeps / step are sufficiently large , the result of a single run of population annealing is significantly biased because the equilibrium distribution is not fully sampled .",
    "simple averaging over an ensemble of independent runs does not reduce this bias . however , an appropriate _ weighted average _ over an ensemble of independent runs effectively reduces both statistical errors and biases .",
    "the free energy estimator from a given run of the algorithm represents the weight that should be assigned to the observations made during that run . in particular , suppose that an observable @xmath47 is estimated in run @xmath48 to be @xmath49 at temperature @xmath8 .",
    "an unbiased estimate of @xmath50 from the entire simulation is the weighted average over the ensemble of @xmath51 independent runs of population annealing , @xmath52 where the weight for run @xmath48 is given by @xmath53 and @xmath54 is the free energy estimator ( [ eq : sumq ] ) for the @xmath55 run of the algorithm at temperature @xmath8 .",
    "the weight factors @xmath56 are needed because they represent the total weight at that temperature that would have been associated with @xmath55 run if the normalization factor in ( [ eq : wn ] ) had not been used to keep the population size near the target size",
    ". runs with different but fixed target populations sizes @xmath57 can be combined using ( [ eq : weight ] ) with @xmath56 replaced by @xmath58 in both the numerator and denominator of ( [ eq : omega ] ) .",
    "the free energy appears to require a more complicated weighting formula because it is the sum of terms from all temperatures .",
    "however , as shown below it may be expressed as a simple average .",
    "the quantity that is directly averaged at each temperature is @xmath18 , not @xmath33 , so the logarithm must be taken after the weighted average .",
    "the unbiased estimate of the free energy @xmath59 is given by , @xmath60 + \\ln \\omega \\\\ \\nonumber & = & \\sum_{\\ell = k}^{k+1 } \\ln \\left [ \\frac{\\sum_{r=1}^m \\exp(-\\beta_{\\ell-1 } { { \\tilde f}}(\\beta_{\\ell-1}))}{\\sum_{r=1}^m \\exp(-\\beta_{\\ell } { { \\tilde f}}(\\beta_{\\ell}))}\\right]\\\\ & = & \\ln \\left[\\frac{1}{m } \\sum_{r=1}^m \\exp(-\\beta_{k } { { \\tilde f}}(\\beta_{k}))\\right ]   .\\end{aligned}\\ ] ] the inner summation indexed by @xmath48 is over the ensemble of independent runs while the outer summation indexed by @xmath61 is over the temperature steps between the highest temperature @xmath62 and the temperature of interest @xmath63 .",
    "the second expression follows from the first via ( [ eq : sumq ] ) and ( [ eq : omega ] ) .",
    "the last expression shows that @xmath64 may be directly averaged .",
    "errors in the weighted averages can be obtained by resampling .",
    "here we use the bootstraps method  @xcite where the error is the standard deviation of a large number ( @xmath65 ) of resampled ensembles , each of size @xmath51 .",
    "statistical and systematic errors in the method are determined by the probability distribution of the dimensionless free energy @xmath66 .",
    "if this distribution has a variance that is much smaller than unity and tails that decay faster than exponentially then the important weight factors ( [ eq : omega ] ) do not vary much and the tails of the distribution are unimportant . on the other hand ,",
    "if the variance is larger than one , @xmath67 is controlled by the upper tail of the distribution and the ensemble size @xmath51 must be large to reduce errors . in the case that @xmath66 is normally distributed , the typical value of @xmath66 that dominates the sum in ( [ eq : weight ] ) is one variance ( not one standard deviation ! ) above the mean .",
    "the variance of @xmath66 is thus a criteria for the performance of the algorithm .",
    "if it is smaller than about 0.5 then a modest ensemble of independent runs will be sufficient to yield accurate results .",
    "optimizing population annealing should be guided by minimizing the variance of the free energy estimator for a fixed amount of computational effort .",
    "of course , it is always possible that the actual @xmath66 distribution has significant weight far above its mean because of important low energy states that have never been explored",
    ". this diabolical situation would similarly fool equilibration tests for parallel tempering  @xcite .",
    "population annealing using @xmath51 independent runs with population size @xmath68 is less accurate than a single run with population size @xmath69 .",
    "if @xmath70 is small , the loss of accuracy is small and vice versa . nonetheless , an ensemble of independent runs has several important advantages .",
    "first , independent runs with moderate @xmath68 require only a single processor or simple parallelism without communication between processors .",
    "large values of @xmath68 are only practical with true parallelism involving communication between processor .",
    "second , the measurement of the variance of @xmath71 over the ensemble provides a diagnostic for the method .",
    "third , error bars are simply obtained from an ensemble using resampling .",
    "to illustrate the effectiveness of population annealing for high precision simulations we apply it to the ising spin glass in one and three dimensions . ising",
    "spin glasses are notoriously difficult to equilibrate at low temperature .",
    "the ising spin glass is defined by the energy @xmath72 where @xmath73 is the ising spin at site @xmath74 and the summation is over the nearest neighbor bonds @xmath75 of the lattice .",
    "we consider the simple cubic lattice ( 3d ) with periodic boundary conditions and a periodic chain of spins ( 1d ) .",
    "the couplings @xmath76 are quenched random variables chosen independently for each bond from a gaussian distribution with mean zero and variance one .",
    "the 3d ising spin glass with gaussian couplings has a continuous phase transition at transition temperature @xmath77 @xcite .",
    "the low temperature phase of this model is still the subject of controversy . on the other hand ,",
    "the 1d ising spin glass is a trivial model .",
    "nonetheless , it has a rough free energy landscape and is difficult to equilibrate using generic monte carlo methods including parallel tempering  @xcite .",
    "the 1d spin glass has the advantage that the monte carlo results can be compared with exact transfer matrix calculations .    for the 1d spin glass we simulated 18 disorder realizations for a chain with @xmath78 spins using population annealing .",
    "we report results for the lowest temperature , @xmath79 .",
    "we used a mean population size @xmath80 with @xmath81 temperatures and @xmath82 metropolis sweeps at each temperature .",
    "of the 99 temperature steps , 19 are equally spaced in inverse temperature between @xmath1 and @xmath83 while the remaining 80 are equally spaced in temperature .",
    "each run used @xmath84 metropolis sweeps and for each realization the ensemble consisted of @xmath85 independent runs .",
    "first we report results for a single 1d disorder realization at the lowest temperature , @xmath86 .",
    "figure [ fig : free ] shows the histogram of the dimensionless free energy @xmath87 .     for population annealing applied to a single realization of a 1d ising spin glass",
    ". the exact value for this realization is @xmath88.,scaledwidth=45.0% ]    the variance of @xmath87 is 0.34 and the distribution does not appear to have fat tails .",
    "therefore , we expect weighted averages should be useful in calculating observables . using ( [ eq : weight ] ) to compute @xmath89 and the bootstraps method to find the one standard deviation error , we obtain @xmath90 compared to the exact value , @xmath91 obtained from numerically summing the transfer matrices . on the other hand , the unweighted average energy of the ensemble is @xmath92 . thus , the unweighted average is significantly biased while the weighted average shows no bias to within the statistical errors .",
    "the ground state energy for this disorder realization is @xmath93 so at @xmath86 the system is quite close to its ground state . for the free energy of the same realization we have @xmath94",
    "while the weighted average is @xmath95 and the unweighted average is @xmath96 .",
    "again , the weighted estimator is not significantly biased while the unweighted estimator is biased .",
    "next we consider the set of 18 disorder realizations and investigate how the bias decreases as the size of the ensemble of runs increases .",
    "we divide the 200 independent runs for each disorder realization into @xmath97 blocks of size @xmath98 and then perform weighted averages for the energy within each of these blocks .",
    "next we take the mean over the set of blocks and finally average these means over the 18 disorder realizations .",
    "let @xmath99 be this disorder averaged bias , @xmath100\\ ] ] where @xmath101 is the weighted energy estimator in block @xmath102 with block size @xmath98 .",
    "we can similarly obtain the standard error of the mean from the @xmath97 blocks .",
    "figure [ fig : mukk ] shows the bias @xmath99 as a function of block size @xmath103 .",
    "the case @xmath104 corresponds to unweighted averages . by the time an ensemble of 8 runs is used ,",
    "the bias is reduced by approximately a factor of 6 .",
    "the weighted energy estimator for the full ensemble of @xmath105 runs for each disorder realization yields a mean bias of @xmath106 where the error estimate is obtained using the bootstraps method .",
    "this weighted average displays no bias within the error bars .",
    "similar results hold for the free energy .",
    "the @xmath105 weighted estimate of @xmath107 averaged over the 18 disorder realizations deviates from the exact value by @xmath108 , which is again indistinguishable from zero , while the unweighted free energy averaged over the same 18 realizations deviates from the exact answer by @xmath109 .     for ensemble size",
    "@xmath103 averaged over 18 disorder realizations for the 1d ising spin glass.,scaledwidth=45.0% ]    for the 3d ising spin glass we studied 25 disorder realizations using population annealing for system size 8@xmath110 .",
    "the target population size is @xmath111 , @xmath81 temperatures are evenly spaced between @xmath112 and @xmath79 with @xmath113 metropolis sweeps performed after every temperature step .",
    "each run requires 2@xmath114 metropolis sweeps .",
    "in addition to the energy and free energy , we considered the observable @xmath115 , the probability that the overlap is less than 0.2 , @xmath116 . the overlap is defined as @xmath117 where the superscripts refer to two independent spin configurations of the system .",
    "the probability distribution for the overlap reflects features of the free energy landscape .",
    "when there is substantial weight for small @xmath118 , there are two or more free energy minima that are widely separated but with comparable free energies . for parallel tempering this situation",
    "is expected to lead to long equilibration times  @xcite .",
    "thus , it is interesting to look for correlations between the variance of @xmath71 and @xmath115 . in the study of spin glasses",
    ", @xmath115 is important in distinguishing the competing pictures of the low temperature phase of the 3d ising spin glass  @xcite .",
    "since @xmath115 involves the correlation between two independent replicas , we use pairs of independent runs to construct @xmath118 . for each pair of runs",
    ", we compute @xmath118 by averaging over pairs of replicas , one from each run and then evaluate @xmath119 for that pair .",
    "the appropriate weighted estimator @xmath120 is @xmath121 with @xmath122 where the superscripts refer to the two of independent runs from which @xmath123 is constructed .",
    "we did @xmath124 pairs of independent runs to compute @xmath125 .",
    "figure [ fig : varvspqs ] shows a scatter plot of @xmath126 vs.  @xmath120 for the 25 disorder realizations .",
    "the values of @xmath115 along the line @xmath127 are estimated as zero by the algorithm on the basis of @xmath128 measurements of the overlap .",
    "most realizations have very small values of @xmath115 , with only a few realizations dominating the disorder average .",
    "the variance of the free energy estimator for the 25 realizations never exceeds 0.6 .",
    "there appears to be a correlation between a large variance of the free energy and a large value of @xmath115 .",
    "realizations with free energy variances less than 0.05 are all associated with very small values of the overlap near zero .",
    "this correlation can be understood by realizing that @xmath129 implies that there are at least two free energy minima with comparable free energies . if @xmath68 is not sufficiently large , the population of replicas may be dominated by one or another free energy minima in a single run and thus display a large variance in free energy from one run to another .     vs.  variance of the free energy @xmath126 , for a sample of 25 disorder realizations of the 3d ising spin glass.,scaledwidth=45.0% ]    of the 25 disorder realizations we now look more closely at the realization with the largest variance of @xmath87 .",
    "this ` worst ' realization has is @xmath130 .",
    "for this realization we obtained data from an ensemble of 125 runs ( with @xmath111 , @xmath81 and @xmath113 ) .",
    "the histogram of @xmath131 is shown in fig .  4 ( left panel ) .",
    "it should be noted that for the 3d simulations the highest temperature is not infinite , however , as we shall see below , a negligible contribution to @xmath126 arises from high temperatures .",
    "the mean of @xmath87 is 0.521 below the best estimate @xmath132 , and this deviation is roughly equal to @xmath126 as expected .",
    "the value of @xmath115 from these runs is @xmath133 and the value of the energy is @xmath134 .",
    "for this realization we also did simulations with a larger target population size without changing @xmath135 or @xmath136 .",
    "the histogram of @xmath131 for population size @xmath137 is shown in fig .  4 ( right panel ) .",
    "for the larger population size @xmath138 so increasing the population size by a factor of 5 has reduced the variance by nearly the same factor .",
    "the estimate for @xmath115 from this larger population size is @xmath139 , which is consistent with the results from the smaller population size .",
    "the estimate for the energy is @xmath140 , which is marginally consistent with the smaller run . for comparison we simulated the same disorder realization using parallel tempering with two sets of 18 replicas",
    "each equally spaced in temperature with the same high and low temperatures .",
    "the system was equilibrated for @xmath141 sweeps and data was collected for @xmath141 sweeps .",
    "we ran this simulation 200 times to obtain means and errors .",
    "thus the total number of metropolis sweeps for the parallel tempering runs was approximately @xmath142 compared to approximately @xmath143 for population annealing .",
    "parallel tempering runs yielded @xmath144 and @xmath145 .",
    "results are marginally consistent for both @xmath115 and @xmath146 .",
    "[ fig : free3d ]    [ cols=\"^,^ \" , ]     next we consider an initial attempt to improve the performance of the algorithm .",
    "the variance of the free energy estimator should be minimized to optimize the algorithm . from ( [ eq : sumq ] ) we see that @xmath147 at each temperature is a sum of positive terms so that successively lower temperatures have successively larger variances .",
    "figure [ fig : vbf ] shows @xmath70 as a function of temperature for the ` worst ' disorder realizations with the largest variance discussed above .",
    "the variance at each temperature is obtained from 50 iterations of the algorithm .",
    "the upper points ( blue online ) show the results from runs where the average population size is fixed , @xmath148 for all @xmath13 .",
    "the variance increases slowly for small @xmath13 and then much more rapidly for large @xmath13 .",
    "the upward curvature of @xmath70 suggests that more replicas should be used at low temperature .",
    "the total computational work remains nearly fixed if @xmath149 for @xmath150 and @xmath151 for @xmath152 .",
    "the lower points ( red online ) in fig .",
    "[ fig : vbf ] show the results for this choice of target population size and demonstrates that , indeed , a significant reduction in @xmath70 from 0.57 to 0.36 is achieved at the lowest temperature .",
    "this attempt at optimizing the algorithm shows that there is room for improving its performance by careful choice of the parameters .     vs.  @xmath13 for one disorder realization for the 3d ising spin glass .",
    "the upper ( blue square ) points show the result for a fixed population size ( @xmath148 for all @xmath13 ) while the lower ( red circle ) is for a population that grows for low temperature ( @xmath149 for @xmath150 and @xmath151 for @xmath152 ) .",
    "both simulations involve the same amount of computational work.,scaledwidth=75.0% ]",
    "population annealing is a promising tool for measuring the free energy and other observables in spin glasses and perhaps other systems with rough free energy landscapes . by using weighted averages over an ensemble of runs , biases inherent in a single run",
    "can be made small and high precision results can be obtained . if the variance of the dimensionless free energy estimator @xmath153 is less than about 0.5 , high precision results can be obtained from a relatively small ensemble of runs .",
    "this variance thus serves as measure of the convergence of the algorithm .",
    "the method can be optimized by minimizing the variance of the free energy estimator . in future work",
    "it would be important to optimize the method and study its efficiency and scaling with system size in comparison with well - established methods such as parallel tempering .    compared to parallel tempering , population annealing is better suited to parallelization .",
    "parallel tempering is optimized with a relatively small number of replicas . increasing the number of replicas in parallel tempering",
    "improves the acceptance rate of replica exchange moves but also lengthens the round trip distance between the warmest and coldest replicas .",
    "thus , the optimum number of replicas is relatively small in practice . on the other hand ,",
    "population annealing is monotonically improved by increasing the population size .",
    "for example , for the @xmath154 ,",
    "3d ising spin glasses studied here population annealing makes effective use of thousands of replicas while parallel tempering is optimized with tens of replicas .",
    "population annealing may find use in quickly equilibrating large systems using a very large population spread over many processors .",
    "this work was supported in part from nsf grant dmr-0907235 .",
    "i thank helmut katzgraber , burcu yucesoy and yukita iba for helpful discussions .",
    "i thank the santa fe institute for their hospitality and support ."
  ],
  "abstract_text": [
    "<S> the population annealing algorithm introduced by hukushima and iba is described . </S>",
    "<S> population annealing combines simulated annealing and boltzmann weighted differential reproduction within a population of replicas to sample equilibrium states . </S>",
    "<S> population annealing gives direct access to the free energy . </S>",
    "<S> it is shown that unbiased measurements of observables can be obtained by weighted averages over many runs with weight factors related to the free energy estimate from the run . </S>",
    "<S> population annealing is well suited to parallelization and may be a useful alternative to parallel tempering for systems with rough free energy landscapes such as spin glasses . </S>",
    "<S> the method is demonstrated for spin glasses . </S>"
  ]
}